(window.webpackJsonp=window.webpackJsonp||[]).push([[191],{"+K+b":function(se,Z,C){var D=C("JHRd");function N(z){var k=new z.constructor(z.byteLength);return new D(k).set(new D(z)),k}se.exports=N},"+Qka":function(se,Z,C){var D=C("fmRc"),N=C("t2Dn"),z=C("cq/+"),k=C("T1AV"),v=C("GoyQ"),L=C("mTTR"),U=C("itsj");function K(q,fe,ue,rt,Ne){q!==fe&&z(fe,function(nt,wt){if(Ne||(Ne=new D),v(nt))k(q,fe,wt,ue,K,rt,Ne);else{var ht=rt?rt(U(q,wt),nt,wt+"",q,fe,Ne):void 0;ht===void 0&&(ht=nt),N(q,wt,ht)}},L)}se.exports=K},"+iFO":function(se,Z,C){var D=C("dTAl"),N=C("LcsW"),z=C("6sVZ");function k(v){return typeof v.constructor=="function"&&!z(v)?D(N(v)):{}}se.exports=k},"/ezw":function(se,Z,C){"use strict";var D=C("rePB"),N=C("wx14"),z=C("U8pU"),k=C("q1tI"),v=C("TSYQ"),L=C.n(v),U=function(le){var Me=le.prefixCls,Re=le.className,yt=le.width,At=le.style;return k.createElement("h3",{className:L()(Me,Re),style:Object(N.a)({width:yt},At)})},K=U,q=C("KQm4"),fe=function(le){var Me=function(Cr){var Br=le.width,pn=le.rows,Fr=pn===void 0?2:pn;if(Array.isArray(Br))return Br[Cr];if(Fr-1===Cr)return Br},Re=le.prefixCls,yt=le.className,At=le.style,ae=le.rows,It=Object(q.a)(Array(ae)).map(function(lr,Cr){return k.createElement("li",{key:Cr,style:{width:Me(Cr)}})});return k.createElement("ul",{className:L()(Re,yt),style:At},It)},ue=fe,rt=C("H84U"),Ne=function(le){var Me,Re,yt=le.prefixCls,At=le.className,ae=le.style,It=le.size,lr=le.shape,Cr=L()((Me={},Object(D.a)(Me,"".concat(yt,"-lg"),It==="large"),Object(D.a)(Me,"".concat(yt,"-sm"),It==="small"),Me)),Br=L()((Re={},Object(D.a)(Re,"".concat(yt,"-circle"),lr==="circle"),Object(D.a)(Re,"".concat(yt,"-square"),lr==="square"),Object(D.a)(Re,"".concat(yt,"-round"),lr==="round"),Re)),pn=typeof It=="number"?{width:It,height:It,lineHeight:"".concat(It,"px")}:{};return k.createElement("span",{className:L()(yt,Cr,Br,At),style:Object(N.a)(Object(N.a)({},pn),ae)})},nt=Ne,wt=C("bT9E"),ht=function(le){var Me=function(yt){var At=yt.getPrefixCls,ae=le.prefixCls,It=le.className,lr=le.active,Cr=At("skeleton",ae),Br=Object(wt.a)(le,["prefixCls","className"]),pn=L()(Cr,"".concat(Cr,"-element"),Object(D.a)({},"".concat(Cr,"-active"),lr),It);return k.createElement("div",{className:pn},k.createElement(nt,Object(N.a)({prefixCls:"".concat(Cr,"-avatar")},Br)))};return k.createElement(rt.a,null,Me)};ht.defaultProps={size:"default",shape:"circle"};var We=ht,St=function(le){var Me=function(yt){var At,ae=yt.getPrefixCls,It=le.prefixCls,lr=le.className,Cr=le.active,Br=le.block,pn=Br===void 0?!1:Br,Fr=ae("skeleton",It),Pn=Object(wt.a)(le,["prefixCls"]),ni=L()(Fr,"".concat(Fr,"-element"),(At={},Object(D.a)(At,"".concat(Fr,"-active"),Cr),Object(D.a)(At,"".concat(Fr,"-block"),pn),At),lr);return k.createElement("div",{className:ni},k.createElement(nt,Object(N.a)({prefixCls:"".concat(Fr,"-button")},Pn)))};return k.createElement(rt.a,null,Me)};St.defaultProps={size:"default"};var Je=St,Ft=function(le){var Me=function(yt){var At=yt.getPrefixCls,ae=le.prefixCls,It=le.className,lr=le.active,Cr=At("skeleton",ae),Br=Object(wt.a)(le,["prefixCls"]),pn=L()(Cr,"".concat(Cr,"-element"),Object(D.a)({},"".concat(Cr,"-active"),lr),It);return k.createElement("div",{className:pn},k.createElement(nt,Object(N.a)({prefixCls:"".concat(Cr,"-input")},Br)))};return k.createElement(rt.a,null,Me)};Ft.defaultProps={size:"default"};var tr=Ft,yr="M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z",Dr=function(le){var Me=function(yt){var At=yt.getPrefixCls,ae=le.prefixCls,It=le.className,lr=le.style,Cr=At("skeleton",ae),Br=L()(Cr,"".concat(Cr,"-element"),It);return k.createElement("div",{className:Br},k.createElement("div",{className:L()("".concat(Cr,"-image"),It),style:lr},k.createElement("svg",{viewBox:"0 0 1098 1024",xmlns:"http://www.w3.org/2000/svg",className:"".concat(Cr,"-image-svg")},k.createElement("path",{d:yr,className:"".concat(Cr,"-image-path")}))))};return k.createElement(rt.a,null,Me)},Mr=Dr;function jt(zt){return zt&&Object(z.a)(zt)==="object"?zt:{}}function He(zt,le){return zt&&!le?{size:"large",shape:"square"}:{size:"large",shape:"circle"}}function Dt(zt,le){return!zt&&le?{width:"38%"}:zt&&le?{width:"50%"}:{}}function Ut(zt,le){var Me={};return(!zt||!le)&&(Me.width="61%"),!zt&&le?Me.rows=3:Me.rows=2,Me}var Ce=function(le){var Me=function(yt){var At=yt.getPrefixCls,ae=yt.direction,It=le.prefixCls,lr=le.loading,Cr=le.className,Br=le.style,pn=le.children,Fr=le.avatar,Pn=le.title,ni=le.paragraph,Nn=le.active,Kn=le.round,Yn=At("skeleton",It);if(lr||!("loading"in le)){var Ar,mr=!!Fr,Xt=!!Pn,Wt=!!ni,Ir;if(mr){var Ue=Object(N.a)(Object(N.a)({prefixCls:"".concat(Yn,"-avatar")},He(Xt,Wt)),jt(Fr));Ir=k.createElement("div",{className:"".concat(Yn,"-header")},k.createElement(nt,Ue))}var he;if(Xt||Wt){var ie;if(Xt){var B=Object(N.a)(Object(N.a)({prefixCls:"".concat(Yn,"-title")},Dt(mr,Wt)),jt(Pn));ie=k.createElement(K,B)}var Ae;if(Wt){var Xe=Object(N.a)(Object(N.a)({prefixCls:"".concat(Yn,"-paragraph")},Ut(mr,Xt)),jt(ni));Ae=k.createElement(ue,Xe)}he=k.createElement("div",{className:"".concat(Yn,"-content")},ie,Ae)}var bt=L()(Yn,(Ar={},Object(D.a)(Ar,"".concat(Yn,"-with-avatar"),mr),Object(D.a)(Ar,"".concat(Yn,"-active"),Nn),Object(D.a)(Ar,"".concat(Yn,"-rtl"),ae==="rtl"),Object(D.a)(Ar,"".concat(Yn,"-round"),Kn),Ar),Cr);return k.createElement("div",{className:bt,style:Br},Ir,he)}return pn};return k.createElement(rt.a,null,Me)};Ce.defaultProps={avatar:!1,title:!0,paragraph:!0},Ce.Button=Je,Ce.Avatar=We,Ce.Input=tr,Ce.Image=Mr;var ve=Ce,Ie=Z.a=ve},"/kpp":function(se,Z,C){"use strict";var D=C("rePB"),N=C("wx14"),z=C("U8pU"),k=C("q1tI"),v=C.n(k),L=C("TSYQ"),U=C.n(L),K=C("o/2+"),q=C("H84U"),fe=function(nt,wt){var ht={};for(var We in nt)Object.prototype.hasOwnProperty.call(nt,We)&&wt.indexOf(We)<0&&(ht[We]=nt[We]);if(nt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var St=0,We=Object.getOwnPropertySymbols(nt);St<We.length;St++)wt.indexOf(We[St])<0&&Object.prototype.propertyIsEnumerable.call(nt,We[St])&&(ht[We[St]]=nt[We[St]]);return ht};function ue(nt){return typeof nt=="number"?"".concat(nt," ").concat(nt," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(nt)?"0 0 ".concat(nt):nt}var rt=["xs","sm","md","lg","xl","xxl"],Ne=k.forwardRef(function(nt,wt){var ht,We=k.useContext(q.b),St=We.getPrefixCls,Je=We.direction,Ft=k.useContext(K.a),tr=Ft.gutter,yr=Ft.wrap,Dr=Ft.supportFlexGap,Mr=nt.prefixCls,jt=nt.span,He=nt.order,Dt=nt.offset,Ut=nt.push,Ce=nt.pull,ve=nt.className,Ie=nt.children,zt=nt.flex,le=nt.style,Me=fe(nt,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),Re=St("col",Mr),yt={};rt.forEach(function(Cr){var Br,pn={},Fr=nt[Cr];typeof Fr=="number"?pn.span=Fr:Object(z.a)(Fr)==="object"&&(pn=Fr||{}),delete Me[Cr],yt=Object(N.a)(Object(N.a)({},yt),(Br={},Object(D.a)(Br,"".concat(Re,"-").concat(Cr,"-").concat(pn.span),pn.span!==void 0),Object(D.a)(Br,"".concat(Re,"-").concat(Cr,"-order-").concat(pn.order),pn.order||pn.order===0),Object(D.a)(Br,"".concat(Re,"-").concat(Cr,"-offset-").concat(pn.offset),pn.offset||pn.offset===0),Object(D.a)(Br,"".concat(Re,"-").concat(Cr,"-push-").concat(pn.push),pn.push||pn.push===0),Object(D.a)(Br,"".concat(Re,"-").concat(Cr,"-pull-").concat(pn.pull),pn.pull||pn.pull===0),Object(D.a)(Br,"".concat(Re,"-rtl"),Je==="rtl"),Br))});var At=U()(Re,(ht={},Object(D.a)(ht,"".concat(Re,"-").concat(jt),jt!==void 0),Object(D.a)(ht,"".concat(Re,"-order-").concat(He),He),Object(D.a)(ht,"".concat(Re,"-offset-").concat(Dt),Dt),Object(D.a)(ht,"".concat(Re,"-push-").concat(Ut),Ut),Object(D.a)(ht,"".concat(Re,"-pull-").concat(Ce),Ce),ht),ve,yt),ae={};if(tr&&tr[0]>0){var It=tr[0]/2;ae.paddingLeft=It,ae.paddingRight=It}if(tr&&tr[1]>0&&!Dr){var lr=tr[1]/2;ae.paddingTop=lr,ae.paddingBottom=lr}return zt&&(ae.flex=ue(zt),yr===!1&&!ae.minWidth&&(ae.minWidth=0)),k.createElement("div",Object(N.a)({},Me,{style:Object(N.a)(Object(N.a)({},ae),le),className:At,ref:wt}),Ie)});Ne.displayName="Col",Z.a=Ne},"0JQy":function(se,Z){var C="\\ud800-\\udfff",D="\\u0300-\\u036f",N="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",k=D+N+z,v="\\ufe0e\\ufe0f",L="["+C+"]",U="["+k+"]",K="\\ud83c[\\udffb-\\udfff]",q="(?:"+U+"|"+K+")",fe="[^"+C+"]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",rt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="\\u200d",nt=q+"?",wt="["+v+"]?",ht="(?:"+Ne+"(?:"+[fe,ue,rt].join("|")+")"+wt+nt+")*",We=wt+nt+ht,St="(?:"+[fe+U+"?",U,ue,rt,L].join("|")+")",Je=RegExp(K+"(?="+K+")|"+St+We,"g");function Ft(tr){return tr.match(Je)||[]}se.exports=Ft},"0Q2g":function(se,Z,C){var D=C("W6/K");function N(z,k){return z&&z.length&&k&&k.length?D(z,k):z}se.exports=N},"0ZTe":function(se,Z,C){var D=C("wy8a"),N=C("quyA"),z=C("Em2t"),k=C("dt0z");function v(L){return function(U){U=k(U);var K=N(U)?z(U):void 0,q=K?K[0]:U.charAt(0),fe=K?D(K,1).join(""):U.slice(1);return q[L]()+fe}}se.exports=v},"0gSV":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.tagged=void 0;var D=C("GXnB"),N=C("Ztfv");function z(k,v){return function(L,U,K){var q=new D.Metadata(k,v);typeof K=="number"?N.tagParameter(L,U,K,q):N.tagProperty(L,U,q)}}Z.tagged=z},"1+5i":function(se,Z,C){var D=C("w/wX"),N=C("sEf8"),z=C("mdPL"),k=z&&z.isSet,v=k?N(k):D;se.exports=v},"1ABj":function(se,Z){function C(D,N){throw new Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},"2GsC":function(se,Z){function C(D,N,z,k){for(var v=z-1,L=D.length;++v<L;)if(k(D[v],N))return v;return-1}se.exports=C},"2ajD":function(se,Z){function C(D){return D!==D}se.exports=C},"3L5V":function(se,Z,C){(function(D){(function(N,z){se.exports=z()})(this,function(){"use strict";function N(Ue,he){if(!(Ue instanceof he))throw new TypeError("Cannot call a class as a function")}function z(Ue,he){for(var ie=0;ie<he.length;ie++){var B=he[ie];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(Ue,B.key,B)}}function k(Ue,he,ie){return he&&z(Ue.prototype,he),ie&&z(Ue,ie),Ue}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var v=function(){function Ue(he,ie){this.next=null,this.key=he,this.data=ie,this.left=null,this.right=null}return Ue}();function L(Ue,he){return Ue>he?1:Ue<he?-1:0}function U(Ue,he,ie){for(var B=new v(null,null),Ae=B,Xe=B;;){var bt=ie(Ue,he.key);if(bt<0){if(he.left===null)break;if(ie(Ue,he.left.key)<0){var Gt=he.left;if(he.left=Gt.right,Gt.right=he,he=Gt,he.left===null)break}Xe.left=he,Xe=he,he=he.left}else if(bt>0){if(he.right===null)break;if(ie(Ue,he.right.key)>0){var Gt=he.right;if(he.right=Gt.left,Gt.left=he,he=Gt,he.right===null)break}Ae.right=he,Ae=he,he=he.right}else break}return Ae.right=he.left,Xe.left=he.right,he.left=B.right,he.right=B.left,he}function K(Ue,he,ie,B){var Ae=new v(Ue,he);if(ie===null)return Ae.left=Ae.right=null,Ae;ie=U(Ue,ie,B);var Xe=B(Ue,ie.key);return Xe<0?(Ae.left=ie.left,Ae.right=ie,ie.left=null):Xe>=0&&(Ae.right=ie.right,Ae.left=ie,ie.right=null),Ae}function q(Ue,he,ie){var B=null,Ae=null;if(he){he=U(Ue,he,ie);var Xe=ie(he.key,Ue);Xe===0?(B=he.left,Ae=he.right):Xe<0?(Ae=he.right,he.right=null,B=he):(B=he.left,he.left=null,Ae=he)}return{left:B,right:Ae}}function fe(Ue,he,ie){return he===null?Ue:(Ue===null||(he=U(Ue.key,he,ie),he.left=Ue),he)}function ue(Ue,he,ie,B,Ae){if(Ue){B(""+he+(ie?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ae(Ue)+`
`);var Xe=he+(ie?"    ":"\u2502   ");Ue.left&&ue(Ue.left,Xe,!1,B,Ae),Ue.right&&ue(Ue.right,Xe,!0,B,Ae)}}var rt=function(){function Ue(he){he===void 0&&(he=L),this._root=null,this._size=0,this._comparator=he}return Ue.prototype.insert=function(he,ie){return this._size++,this._root=K(he,ie,this._root,this._comparator)},Ue.prototype.add=function(he,ie){var B=new v(he,ie);this._root===null&&(B.left=B.right=null,this._size++,this._root=B);var Ae=this._comparator,Xe=U(he,this._root,Ae),bt=Ae(he,Xe.key);return bt===0?this._root=Xe:(bt<0?(B.left=Xe.left,B.right=Xe,Xe.left=null):bt>0&&(B.right=Xe.right,B.left=Xe,Xe.right=null),this._size++,this._root=B),this._root},Ue.prototype.remove=function(he){this._root=this._remove(he,this._root,this._comparator)},Ue.prototype._remove=function(he,ie,B){var Ae;if(ie===null)return null;ie=U(he,ie,B);var Xe=B(he,ie.key);return Xe===0?(ie.left===null?Ae=ie.right:(Ae=U(he,ie.left,B),Ae.right=ie.right),this._size--,Ae):ie},Ue.prototype.pop=function(){var he=this._root;if(he){for(;he.left;)he=he.left;return this._root=U(he.key,this._root,this._comparator),this._root=this._remove(he.key,this._root,this._comparator),{key:he.key,data:he.data}}return null},Ue.prototype.findStatic=function(he){for(var ie=this._root,B=this._comparator;ie;){var Ae=B(he,ie.key);if(Ae===0)return ie;Ae<0?ie=ie.left:ie=ie.right}return null},Ue.prototype.find=function(he){return this._root&&(this._root=U(he,this._root,this._comparator),this._comparator(he,this._root.key)!==0)?null:this._root},Ue.prototype.contains=function(he){for(var ie=this._root,B=this._comparator;ie;){var Ae=B(he,ie.key);if(Ae===0)return!0;Ae<0?ie=ie.left:ie=ie.right}return!1},Ue.prototype.forEach=function(he,ie){for(var B=this._root,Ae=[],Xe=!1;!Xe;)B!==null?(Ae.push(B),B=B.left):Ae.length!==0?(B=Ae.pop(),he.call(ie,B),B=B.right):Xe=!0;return this},Ue.prototype.range=function(he,ie,B,Ae){for(var Xe=[],bt=this._comparator,Gt=this._root,sr;Xe.length!==0||Gt;)if(Gt)Xe.push(Gt),Gt=Gt.left;else{if(Gt=Xe.pop(),sr=bt(Gt.key,ie),sr>0)break;if(bt(Gt.key,he)>=0&&B.call(Ae,Gt))return this;Gt=Gt.right}return this},Ue.prototype.keys=function(){var he=[];return this.forEach(function(ie){var B=ie.key;return he.push(B)}),he},Ue.prototype.values=function(){var he=[];return this.forEach(function(ie){var B=ie.data;return he.push(B)}),he},Ue.prototype.min=function(){return this._root?this.minNode(this._root).key:null},Ue.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},Ue.prototype.minNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.left;)he=he.left;return he},Ue.prototype.maxNode=function(he){if(he===void 0&&(he=this._root),he)for(;he.right;)he=he.right;return he},Ue.prototype.at=function(he){for(var ie=this._root,B=!1,Ae=0,Xe=[];!B;)if(ie)Xe.push(ie),ie=ie.left;else if(Xe.length>0){if(ie=Xe.pop(),Ae===he)return ie;Ae++,ie=ie.right}else B=!0;return null},Ue.prototype.next=function(he){var ie=this._root,B=null;if(he.right){for(B=he.right;B.left;)B=B.left;return B}for(var Ae=this._comparator;ie;){var Xe=Ae(he.key,ie.key);if(Xe===0)break;Xe<0?(B=ie,ie=ie.left):ie=ie.right}return B},Ue.prototype.prev=function(he){var ie=this._root,B=null;if(he.left!==null){for(B=he.left;B.right;)B=B.right;return B}for(var Ae=this._comparator;ie;){var Xe=Ae(he.key,ie.key);if(Xe===0)break;Xe<0?ie=ie.left:(B=ie,ie=ie.right)}return B},Ue.prototype.clear=function(){return this._root=null,this._size=0,this},Ue.prototype.toList=function(){return wt(this._root)},Ue.prototype.load=function(he,ie,B){ie===void 0&&(ie=[]),B===void 0&&(B=!1);var Ae=he.length,Xe=this._comparator;if(B&&St(he,ie,0,Ae-1,Xe),this._root===null)this._root=Ne(he,ie,0,Ae),this._size=Ae;else{var bt=We(this.toList(),nt(he,ie),Xe);Ae=this._size+Ae,this._root=ht({head:bt},0,Ae)}return this},Ue.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(Ue.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(Ue.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),Ue.prototype.toString=function(he){he===void 0&&(he=function(Ae){return String(Ae.key)});var ie=[];return ue(this._root,"",!0,function(B){return ie.push(B)},he),ie.join("")},Ue.prototype.update=function(he,ie,B){var Ae=this._comparator,Xe=q(he,this._root,Ae),bt=Xe.left,Gt=Xe.right;Ae(he,ie)<0?Gt=K(ie,B,Gt,Ae):bt=K(ie,B,bt,Ae),this._root=fe(bt,Gt,Ae)},Ue.prototype.split=function(he){return q(he,this._root,this._comparator)},Ue}();function Ne(Ue,he,ie,B){var Ae=B-ie;if(Ae>0){var Xe=ie+Math.floor(Ae/2),bt=Ue[Xe],Gt=he[Xe],sr=new v(bt,Gt);return sr.left=Ne(Ue,he,ie,Xe),sr.right=Ne(Ue,he,Xe+1,B),sr}return null}function nt(Ue,he){for(var ie=new v(null,null),B=ie,Ae=0;Ae<Ue.length;Ae++)B=B.next=new v(Ue[Ae],he[Ae]);return B.next=null,ie.next}function wt(Ue){for(var he=Ue,ie=[],B=!1,Ae=new v(null,null),Xe=Ae;!B;)he?(ie.push(he),he=he.left):ie.length>0?(he=Xe=Xe.next=ie.pop(),he=he.right):B=!0;return Xe.next=null,Ae.next}function ht(Ue,he,ie){var B=ie-he;if(B>0){var Ae=he+Math.floor(B/2),Xe=ht(Ue,he,Ae),bt=Ue.head;return bt.left=Xe,Ue.head=Ue.head.next,bt.right=ht(Ue,Ae+1,ie),bt}return null}function We(Ue,he,ie){for(var B=new v(null,null),Ae=B,Xe=Ue,bt=he;Xe!==null&&bt!==null;)ie(Xe.key,bt.key)<0?(Ae.next=Xe,Xe=Xe.next):(Ae.next=bt,bt=bt.next),Ae=Ae.next;return Xe!==null?Ae.next=Xe:bt!==null&&(Ae.next=bt),B.next}function St(Ue,he,ie,B,Ae){if(!(ie>=B)){for(var Xe=Ue[ie+B>>1],bt=ie-1,Gt=B+1;;){do bt++;while(Ae(Ue[bt],Xe)<0);do Gt--;while(Ae(Ue[Gt],Xe)>0);if(bt>=Gt)break;var sr=Ue[bt];Ue[bt]=Ue[Gt],Ue[Gt]=sr,sr=he[bt],he[bt]=he[Gt],he[Gt]=sr}St(Ue,he,ie,Gt,Ae),St(Ue,he,Gt+1,B,Ae)}}var Je=function(he,ie){return he.ll.x<=ie.x&&ie.x<=he.ur.x&&he.ll.y<=ie.y&&ie.y<=he.ur.y},Ft=function(he,ie){if(ie.ur.x<he.ll.x||he.ur.x<ie.ll.x||ie.ur.y<he.ll.y||he.ur.y<ie.ll.y)return null;var B=he.ll.x<ie.ll.x?ie.ll.x:he.ll.x,Ae=he.ur.x<ie.ur.x?he.ur.x:ie.ur.x,Xe=he.ll.y<ie.ll.y?ie.ll.y:he.ll.y,bt=he.ur.y<ie.ur.y?he.ur.y:ie.ur.y;return{ll:{x:B,y:Xe},ur:{x:Ae,y:bt}}},tr=Number.EPSILON;tr===void 0&&(tr=Math.pow(2,-52));var yr=tr*tr,Dr=function(he,ie){if(-tr<he&&he<tr&&-tr<ie&&ie<tr)return 0;var B=he-ie;return B*B<yr*he*ie?0:he<ie?-1:1},Mr=function(){function Ue(){N(this,Ue),this.reset()}return k(Ue,[{key:"reset",value:function(){this.xRounder=new jt,this.yRounder=new jt}},{key:"round",value:function(ie,B){return{x:this.xRounder.round(ie),y:this.yRounder.round(B)}}}]),Ue}(),jt=function(){function Ue(){N(this,Ue),this.tree=new rt,this.round(0)}return k(Ue,[{key:"round",value:function(ie){var B=this.tree.add(ie),Ae=this.tree.prev(B);if(Ae!==null&&Dr(B.key,Ae.key)===0)return this.tree.remove(ie),Ae.key;var Xe=this.tree.next(B);return Xe!==null&&Dr(B.key,Xe.key)===0?(this.tree.remove(ie),Xe.key):ie}}]),Ue}(),He=new Mr,Dt=function(he,ie){return he.x*ie.y-he.y*ie.x},Ut=function(he,ie){return he.x*ie.x+he.y*ie.y},Ce=function(he,ie,B){var Ae={x:ie.x-he.x,y:ie.y-he.y},Xe={x:B.x-he.x,y:B.y-he.y},bt=Dt(Ae,Xe);return Dr(bt,0)},ve=function(he){return Math.sqrt(Ut(he,he))},Ie=function(he,ie,B){var Ae={x:ie.x-he.x,y:ie.y-he.y},Xe={x:B.x-he.x,y:B.y-he.y};return Dt(Xe,Ae)/ve(Xe)/ve(Ae)},zt=function(he,ie,B){var Ae={x:ie.x-he.x,y:ie.y-he.y},Xe={x:B.x-he.x,y:B.y-he.y};return Ut(Xe,Ae)/ve(Xe)/ve(Ae)},le=function(he,ie,B){return ie.y===0?null:{x:he.x+ie.x/ie.y*(B-he.y),y:B}},Me=function(he,ie,B){return ie.x===0?null:{x:B,y:he.y+ie.y/ie.x*(B-he.x)}},Re=function(he,ie,B,Ae){if(ie.x===0)return Me(B,Ae,he.x);if(Ae.x===0)return Me(he,ie,B.x);if(ie.y===0)return le(B,Ae,he.y);if(Ae.y===0)return le(he,ie,B.y);var Xe=Dt(ie,Ae);if(Xe==0)return null;var bt={x:B.x-he.x,y:B.y-he.y},Gt=Dt(bt,ie)/Xe,sr=Dt(bt,Ae)/Xe,at=he.x+sr*ie.x,Ot=B.x+Gt*Ae.x,or=he.y+sr*ie.y,Tr=B.y+Gt*Ae.y,Or=(at+Ot)/2,jn=(or+Tr)/2;return{x:Or,y:jn}},yt=function(){k(Ue,null,[{key:"compare",value:function(ie,B){var Ae=Ue.comparePoints(ie.point,B.point);return Ae!==0?Ae:(ie.point!==B.point&&ie.link(B),ie.isLeft!==B.isLeft?ie.isLeft?1:-1:ae.compare(ie.segment,B.segment))}},{key:"comparePoints",value:function(ie,B){return ie.x<B.x?-1:ie.x>B.x?1:ie.y<B.y?-1:ie.y>B.y?1:0}}]);function Ue(he,ie){N(this,Ue),he.events===void 0?he.events=[this]:he.events.push(this),this.point=he,this.isLeft=ie}return k(Ue,[{key:"link",value:function(ie){if(ie.point===this.point)throw new Error("Tried to link already linked events");for(var B=ie.point.events,Ae=0,Xe=B.length;Ae<Xe;Ae++){var bt=B[Ae];this.point.events.push(bt),bt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ie=this.point.events.length,B=0;B<ie;B++){var Ae=this.point.events[B];if(Ae.segment.consumedBy===void 0)for(var Xe=B+1;Xe<ie;Xe++){var bt=this.point.events[Xe];bt.consumedBy===void 0&&Ae.otherSE.point.events===bt.otherSE.point.events&&Ae.segment.consume(bt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ie=[],B=0,Ae=this.point.events.length;B<Ae;B++){var Xe=this.point.events[B];Xe!==this&&!Xe.segment.ringOut&&Xe.segment.isInResult()&&ie.push(Xe)}return ie}},{key:"getLeftmostComparator",value:function(ie){var B=this,Ae=new Map,Xe=function(Gt){var sr=Gt.otherSE;Ae.set(Gt,{sine:Ie(B.point,ie.point,sr.point),cosine:zt(B.point,ie.point,sr.point)})};return function(bt,Gt){Ae.has(bt)||Xe(bt),Ae.has(Gt)||Xe(Gt);var sr=Ae.get(bt),at=sr.sine,Ot=sr.cosine,or=Ae.get(Gt),Tr=or.sine,Or=or.cosine;return at>=0&&Tr>=0?Ot<Or?1:Ot>Or?-1:0:at<0&&Tr<0?Ot<Or?-1:Ot>Or?1:0:Tr<at?-1:Tr>at?1:0}}}]),Ue}(),At=0,ae=function(){k(Ue,null,[{key:"compare",value:function(ie,B){var Ae=ie.leftSE.point.x,Xe=B.leftSE.point.x,bt=ie.rightSE.point.x,Gt=B.rightSE.point.x;if(Gt<Ae)return 1;if(bt<Xe)return-1;var sr=ie.leftSE.point.y,at=B.leftSE.point.y,Ot=ie.rightSE.point.y,or=B.rightSE.point.y;if(Ae<Xe){if(at<sr&&at<Ot)return 1;if(at>sr&&at>Ot)return-1;var Tr=ie.comparePoint(B.leftSE.point);if(Tr<0)return 1;if(Tr>0)return-1;var Or=B.comparePoint(ie.rightSE.point);return Or!==0?Or:-1}if(Ae>Xe){if(sr<at&&sr<or)return-1;if(sr>at&&sr>or)return 1;var jn=B.comparePoint(ie.leftSE.point);if(jn!==0)return jn;var Jr=ie.comparePoint(B.rightSE.point);return Jr<0?1:Jr>0?-1:1}if(sr<at)return-1;if(sr>at)return 1;if(bt<Gt){var xn=B.comparePoint(ie.rightSE.point);if(xn!==0)return xn}if(bt>Gt){var An=ie.comparePoint(B.rightSE.point);if(An<0)return 1;if(An>0)return-1}if(bt!==Gt){var ii=Ot-sr,pi=bt-Ae,Si=or-at,wa=Gt-Xe;if(ii>pi&&Si<wa)return 1;if(ii<pi&&Si>wa)return-1}return bt>Gt?1:bt<Gt||Ot<or?-1:Ot>or?1:ie.id<B.id?-1:ie.id>B.id?1:0}}]);function Ue(he,ie,B,Ae){N(this,Ue),this.id=++At,this.leftSE=he,he.segment=this,he.otherSE=ie,this.rightSE=ie,ie.segment=this,ie.otherSE=he,this.rings=B,this.windings=Ae}return k(Ue,[{key:"replaceRightSE",value:function(ie){this.rightSE=ie,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ie=this.leftSE.point.y,B=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ie<B?ie:B},ur:{x:this.rightSE.point.x,y:ie>B?ie:B}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ie){return ie.x===this.leftSE.point.x&&ie.y===this.leftSE.point.y||ie.x===this.rightSE.point.x&&ie.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ie){if(this.isAnEndpoint(ie))return 0;var B=this.leftSE.point,Ae=this.rightSE.point,Xe=this.vector();if(B.x===Ae.x)return ie.x===B.x?0:ie.x<B.x?1:-1;var bt=(ie.y-B.y)/Xe.y,Gt=B.x+bt*Xe.x;if(ie.x===Gt)return 0;var sr=(ie.x-B.x)/Xe.x,at=B.y+sr*Xe.y;return ie.y===at?0:ie.y<at?-1:1}},{key:"getIntersection",value:function(ie){var B=this.bbox(),Ae=ie.bbox(),Xe=Ft(B,Ae);if(Xe===null)return null;var bt=this.leftSE.point,Gt=this.rightSE.point,sr=ie.leftSE.point,at=ie.rightSE.point,Ot=Je(B,sr)&&this.comparePoint(sr)===0,or=Je(Ae,bt)&&ie.comparePoint(bt)===0,Tr=Je(B,at)&&this.comparePoint(at)===0,Or=Je(Ae,Gt)&&ie.comparePoint(Gt)===0;if(or&&Ot)return Or&&!Tr?Gt:!Or&&Tr?at:null;if(or)return Tr&&bt.x===at.x&&bt.y===at.y?null:bt;if(Ot)return Or&&Gt.x===sr.x&&Gt.y===sr.y?null:sr;if(Or&&Tr)return null;if(Or)return Gt;if(Tr)return at;var jn=Re(bt,this.vector(),sr,ie.vector());return jn===null||!Je(Xe,jn)?null:He.round(jn.x,jn.y)}},{key:"split",value:function(ie){var B=[],Ae=ie.events!==void 0,Xe=new yt(ie,!0),bt=new yt(ie,!1),Gt=this.rightSE;this.replaceRightSE(bt),B.push(bt),B.push(Xe);var sr=new Ue(Xe,Gt,this.rings.slice(),this.windings.slice());return yt.comparePoints(sr.leftSE.point,sr.rightSE.point)>0&&sr.swapEvents(),yt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ae&&(Xe.checkForConsuming(),bt.checkForConsuming()),B}},{key:"swapEvents",value:function(){var ie=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ie,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var B=0,Ae=this.windings.length;B<Ae;B++)this.windings[B]*=-1}},{key:"consume",value:function(ie){for(var B=this,Ae=ie;B.consumedBy;)B=B.consumedBy;for(;Ae.consumedBy;)Ae=Ae.consumedBy;var Xe=Ue.compare(B,Ae);if(Xe!==0){if(Xe>0){var bt=B;B=Ae,Ae=bt}if(B.prev===Ae){var Gt=B;B=Ae,Ae=Gt}for(var sr=0,at=Ae.rings.length;sr<at;sr++){var Ot=Ae.rings[sr],or=Ae.windings[sr],Tr=B.rings.indexOf(Ot);Tr===-1?(B.rings.push(Ot),B.windings.push(or)):B.windings[Tr]+=or}Ae.rings=null,Ae.windings=null,Ae.consumedBy=B,Ae.leftSE.consumedBy=B.leftSE,Ae.rightSE.consumedBy=B.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ie=this.prev.consumedBy||this.prev;this._beforeState=ie.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ie=this.beforeState();this._afterState={rings:ie.rings.slice(0),windings:ie.windings.slice(0),multiPolys:[]};for(var B=this._afterState.rings,Ae=this._afterState.windings,Xe=this._afterState.multiPolys,bt=0,Gt=this.rings.length;bt<Gt;bt++){var sr=this.rings[bt],at=this.windings[bt],Ot=B.indexOf(sr);Ot===-1?(B.push(sr),Ae.push(at)):Ae[Ot]+=at}for(var or=[],Tr=[],Or=0,jn=B.length;Or<jn;Or++)if(Ae[Or]!==0){var Jr=B[Or],xn=Jr.poly;if(Tr.indexOf(xn)===-1)if(Jr.isExterior)or.push(xn);else{Tr.indexOf(xn)===-1&&Tr.push(xn);var An=or.indexOf(Jr.poly);An!==-1&&or.splice(An,1)}}for(var ii=0,pi=or.length;ii<pi;ii++){var Si=or[ii].multiPoly;Xe.indexOf(Si)===-1&&Xe.push(Si)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ie=this.beforeState().multiPolys,B=this.afterState().multiPolys;switch(Yn.type){case"union":{var Ae=ie.length===0,Xe=B.length===0;this._isInResult=Ae!==Xe;break}case"intersection":{var bt,Gt;ie.length<B.length?(bt=ie.length,Gt=B.length):(bt=B.length,Gt=ie.length),this._isInResult=Gt===Yn.numMultiPolys&&bt<Gt;break}case"xor":{var sr=Math.abs(ie.length-B.length);this._isInResult=sr%2==1;break}case"difference":{var at=function(or){return or.length===1&&or[0].isSubject};this._isInResult=at(ie)!==at(B);break}default:throw new Error("Unrecognized operation type found ".concat(Yn.type))}return this._isInResult}}],[{key:"fromRing",value:function(ie,B,Ae){var Xe,bt,Gt,sr=yt.comparePoints(ie,B);if(sr<0)Xe=ie,bt=B,Gt=1;else if(sr>0)Xe=B,bt=ie,Gt=-1;else throw new Error("Tried to create degenerate segment at [".concat(ie.x,", ").concat(ie.y,"]"));var at=new yt(Xe,!0),Ot=new yt(bt,!1);return new Ue(at,Ot,[Ae],[Gt])}}]),Ue}(),It=function(){function Ue(he,ie,B){if(N(this,Ue),!Array.isArray(he)||he.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ie,this.isExterior=B,this.segments=[],typeof he[0][0]!="number"||typeof he[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ae=He.round(he[0][0],he[0][1]);this.bbox={ll:{x:Ae.x,y:Ae.y},ur:{x:Ae.x,y:Ae.y}};for(var Xe=Ae,bt=1,Gt=he.length;bt<Gt;bt++){if(typeof he[bt][0]!="number"||typeof he[bt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var sr=He.round(he[bt][0],he[bt][1]);sr.x===Xe.x&&sr.y===Xe.y||(this.segments.push(ae.fromRing(Xe,sr,this)),sr.x<this.bbox.ll.x&&(this.bbox.ll.x=sr.x),sr.y<this.bbox.ll.y&&(this.bbox.ll.y=sr.y),sr.x>this.bbox.ur.x&&(this.bbox.ur.x=sr.x),sr.y>this.bbox.ur.y&&(this.bbox.ur.y=sr.y),Xe=sr)}(Ae.x!==Xe.x||Ae.y!==Xe.y)&&this.segments.push(ae.fromRing(Xe,Ae,this))}return k(Ue,[{key:"getSweepEvents",value:function(){for(var ie=[],B=0,Ae=this.segments.length;B<Ae;B++){var Xe=this.segments[B];ie.push(Xe.leftSE),ie.push(Xe.rightSE)}return ie}}]),Ue}(),lr=function(){function Ue(he,ie){if(N(this,Ue),!Array.isArray(he))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new It(he[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var B=1,Ae=he.length;B<Ae;B++){var Xe=new It(he[B],this,!1);Xe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Xe.bbox.ll.x),Xe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Xe.bbox.ll.y),Xe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Xe.bbox.ur.x),Xe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Xe.bbox.ur.y),this.interiorRings.push(Xe)}this.multiPoly=ie}return k(Ue,[{key:"getSweepEvents",value:function(){for(var ie=this.exteriorRing.getSweepEvents(),B=0,Ae=this.interiorRings.length;B<Ae;B++)for(var Xe=this.interiorRings[B].getSweepEvents(),bt=0,Gt=Xe.length;bt<Gt;bt++)ie.push(Xe[bt]);return ie}}]),Ue}(),Cr=function(){function Ue(he,ie){if(N(this,Ue),!Array.isArray(he))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof he[0][0][0]=="number"&&(he=[he])}catch(bt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var B=0,Ae=he.length;B<Ae;B++){var Xe=new lr(he[B],this);Xe.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=Xe.bbox.ll.x),Xe.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=Xe.bbox.ll.y),Xe.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=Xe.bbox.ur.x),Xe.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=Xe.bbox.ur.y),this.polys.push(Xe)}this.isSubject=ie}return k(Ue,[{key:"getSweepEvents",value:function(){for(var ie=[],B=0,Ae=this.polys.length;B<Ae;B++)for(var Xe=this.polys[B].getSweepEvents(),bt=0,Gt=Xe.length;bt<Gt;bt++)ie.push(Xe[bt]);return ie}}]),Ue}(),Br=function(){k(Ue,null,[{key:"factory",value:function(ie){for(var B=[],Ae=0,Xe=ie.length;Ae<Xe;Ae++){var bt=ie[Ae];if(!(!bt.isInResult()||bt.ringOut)){for(var Gt=null,sr=bt.leftSE,at=bt.rightSE,Ot=[sr],or=sr.point,Tr=[];Gt=sr,sr=at,Ot.push(sr),sr.point!==or;)for(;;){var Or=sr.getAvailableLinkedEvents();if(Or.length===0){var jn=Ot[0].point,Jr=Ot[Ot.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(jn.x,",")+" ".concat(jn.y,"]. Last matching segment found ends at")+" [".concat(Jr.x,", ").concat(Jr.y,"]."))}if(Or.length===1){at=Or[0].otherSE;break}for(var xn=null,An=0,ii=Tr.length;An<ii;An++)if(Tr[An].point===sr.point){xn=An;break}if(xn!==null){var pi=Tr.splice(xn)[0],Si=Ot.splice(pi.index);Si.unshift(Si[0].otherSE),B.push(new Ue(Si.reverse()));continue}Tr.push({index:Ot.length,point:sr.point});var wa=sr.getLeftmostComparator(Gt);at=Or.sort(wa)[0].otherSE;break}B.push(new Ue(Ot))}}return B}}]);function Ue(he){N(this,Ue),this.events=he;for(var ie=0,B=he.length;ie<B;ie++)he[ie].segment.ringOut=this;this.poly=null}return k(Ue,[{key:"getGeom",value:function(){for(var ie=this.events[0].point,B=[ie],Ae=1,Xe=this.events.length-1;Ae<Xe;Ae++){var bt=this.events[Ae].point,Gt=this.events[Ae+1].point;Ce(bt,ie,Gt)!==0&&(B.push(bt),ie=bt)}if(B.length===1)return null;var sr=B[0],at=B[1];Ce(sr,ie,at)===0&&B.shift(),B.push(B[0]);for(var Ot=this.isExteriorRing()?1:-1,or=this.isExteriorRing()?0:B.length-1,Tr=this.isExteriorRing()?B.length:-1,Or=[],jn=or;jn!=Tr;jn+=Ot)Or.push([B[jn].x,B[jn].y]);return Or}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ie=this.enclosingRing();this._isExteriorRing=ie?!ie.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ie=this.events[0],B=1,Ae=this.events.length;B<Ae;B++){var Xe=this.events[B];yt.compare(ie,Xe)>0&&(ie=Xe)}for(var bt=ie.segment.prevInResult(),Gt=bt?bt.prevInResult():null;;){if(!bt)return null;if(!Gt)return bt.ringOut;if(Gt.ringOut!==bt.ringOut)return Gt.ringOut.enclosingRing()!==bt.ringOut?bt.ringOut:bt.ringOut.enclosingRing();bt=Gt.prevInResult(),Gt=bt?bt.prevInResult():null}}}]),Ue}(),pn=function(){function Ue(he){N(this,Ue),this.exteriorRing=he,he.poly=this,this.interiorRings=[]}return k(Ue,[{key:"addInterior",value:function(ie){this.interiorRings.push(ie),ie.poly=this}},{key:"getGeom",value:function(){var ie=[this.exteriorRing.getGeom()];if(ie[0]===null)return null;for(var B=0,Ae=this.interiorRings.length;B<Ae;B++){var Xe=this.interiorRings[B].getGeom();Xe!==null&&ie.push(Xe)}return ie}}]),Ue}(),Fr=function(){function Ue(he){N(this,Ue),this.rings=he,this.polys=this._composePolys(he)}return k(Ue,[{key:"getGeom",value:function(){for(var ie=[],B=0,Ae=this.polys.length;B<Ae;B++){var Xe=this.polys[B].getGeom();Xe!==null&&ie.push(Xe)}return ie}},{key:"_composePolys",value:function(ie){for(var B=[],Ae=0,Xe=ie.length;Ae<Xe;Ae++){var bt=ie[Ae];if(!bt.poly)if(bt.isExteriorRing())B.push(new pn(bt));else{var Gt=bt.enclosingRing();Gt.poly||B.push(new pn(Gt)),Gt.poly.addInterior(bt)}}return B}}]),Ue}(),Pn=function(){function Ue(he){var ie=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ae.compare;N(this,Ue),this.queue=he,this.tree=new rt(ie),this.segments=[]}return k(Ue,[{key:"process",value:function(ie){var B=ie.segment,Ae=[];if(ie.consumedBy)return ie.isLeft?this.queue.remove(ie.otherSE):this.tree.remove(B),Ae;var Xe=ie.isLeft?this.tree.insert(B):this.tree.find(B);if(!Xe)throw new Error("Unable to find segment #".concat(B.id," ")+"[".concat(B.leftSE.point.x,", ").concat(B.leftSE.point.y,"] -> ")+"[".concat(B.rightSE.point.x,", ").concat(B.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var bt=Xe,Gt=Xe,sr=void 0,at=void 0;sr===void 0;)bt=this.tree.prev(bt),bt===null?sr=null:bt.key.consumedBy===void 0&&(sr=bt.key);for(;at===void 0;)Gt=this.tree.next(Gt),Gt===null?at=null:Gt.key.consumedBy===void 0&&(at=Gt.key);if(ie.isLeft){var Ot=null;if(sr){var or=sr.getIntersection(B);if(or!==null&&(B.isAnEndpoint(or)||(Ot=or),!sr.isAnEndpoint(or)))for(var Tr=this._splitSafely(sr,or),Or=0,jn=Tr.length;Or<jn;Or++)Ae.push(Tr[Or])}var Jr=null;if(at){var xn=at.getIntersection(B);if(xn!==null&&(B.isAnEndpoint(xn)||(Jr=xn),!at.isAnEndpoint(xn)))for(var An=this._splitSafely(at,xn),ii=0,pi=An.length;ii<pi;ii++)Ae.push(An[ii])}if(Ot!==null||Jr!==null){var Si=null;if(Ot===null)Si=Jr;else if(Jr===null)Si=Ot;else{var wa=yt.comparePoints(Ot,Jr);Si=wa<=0?Ot:Jr}this.queue.remove(B.rightSE),Ae.push(B.rightSE);for(var lo=B.split(Si),Lo=0,as=lo.length;Lo<as;Lo++)Ae.push(lo[Lo])}Ae.length>0?(this.tree.remove(B),Ae.push(ie)):(this.segments.push(B),B.prev=sr)}else{if(sr&&at){var Pi=sr.getIntersection(at);if(Pi!==null){if(!sr.isAnEndpoint(Pi))for(var re=this._splitSafely(sr,Pi),J=0,me=re.length;J<me;J++)Ae.push(re[J]);if(!at.isAnEndpoint(Pi))for(var we=this._splitSafely(at,Pi),ze=0,mt=we.length;ze<mt;ze++)Ae.push(we[ze])}}this.tree.remove(B)}return Ae}},{key:"_splitSafely",value:function(ie,B){this.tree.remove(ie);var Ae=ie.rightSE;this.queue.remove(Ae);var Xe=ie.split(B);return Xe.push(Ae),ie.consumedBy===void 0&&this.tree.insert(ie),Xe}}]),Ue}(),ni=typeof D!="undefined"&&Object({NODE_ENV:"production"}).POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Nn=typeof D!="undefined"&&Object({NODE_ENV:"production"}).POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,Kn=function(){function Ue(){N(this,Ue)}return k(Ue,[{key:"run",value:function(ie,B,Ae){Yn.type=ie,He.reset();for(var Xe=[new Cr(B,!0)],bt=0,Gt=Ae.length;bt<Gt;bt++)Xe.push(new Cr(Ae[bt],!1));if(Yn.numMultiPolys=Xe.length,Yn.type==="difference")for(var sr=Xe[0],at=1;at<Xe.length;)Ft(Xe[at].bbox,sr.bbox)!==null?at++:Xe.splice(at,1);if(Yn.type==="intersection"){for(var Ot=0,or=Xe.length;Ot<or;Ot++)for(var Tr=Xe[Ot],Or=Ot+1,jn=Xe.length;Or<jn;Or++)if(Ft(Tr.bbox,Xe[Or].bbox)===null)return[]}for(var Jr=new rt(yt.compare),xn=0,An=Xe.length;xn<An;xn++)for(var ii=Xe[xn].getSweepEvents(),pi=0,Si=ii.length;pi<Si;pi++)if(Jr.insert(ii[pi]),Jr.size>ni)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var wa=new Pn(Jr),lo=Jr.size,Lo=Jr.pop();Lo;){var as=Lo.key;if(Jr.size===lo){var Pi=as.segment;throw new Error("Unable to pop() ".concat(as.isLeft?"left":"right"," SweepEvent ")+"[".concat(as.point.x,", ").concat(as.point.y,"] from segment #").concat(Pi.id," ")+"[".concat(Pi.leftSE.point.x,", ").concat(Pi.leftSE.point.y,"] -> ")+"[".concat(Pi.rightSE.point.x,", ").concat(Pi.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Jr.size>ni)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(wa.segments.length>Nn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var re=wa.process(as),J=0,me=re.length;J<me;J++){var we=re[J];we.consumedBy===void 0&&Jr.insert(we)}lo=Jr.size,Lo=Jr.pop()}He.reset();var ze=Br.factory(wa.segments),mt=new Fr(ze);return mt.getGeom()}}]),Ue}(),Yn=new Kn,Ar=function(he){for(var ie=arguments.length,B=new Array(ie>1?ie-1:0),Ae=1;Ae<ie;Ae++)B[Ae-1]=arguments[Ae];return Yn.run("union",he,B)},mr=function(he){for(var ie=arguments.length,B=new Array(ie>1?ie-1:0),Ae=1;Ae<ie;Ae++)B[Ae-1]=arguments[Ae];return Yn.run("intersection",he,B)},Xt=function(he){for(var ie=arguments.length,B=new Array(ie>1?ie-1:0),Ae=1;Ae<ie;Ae++)B[Ae-1]=arguments[Ae];return Yn.run("xor",he,B)},Wt=function(he){for(var ie=arguments.length,B=new Array(ie>1?ie-1:0),Ae=1;Ae<ie;Ae++)B[Ae-1]=arguments[Ae];return Yn.run("difference",he,B)},Ir={union:Ar,intersection:mr,xor:Xt,difference:Wt};return Ir})}).call(this,C("Q2Ig"))},"3L66":function(se,Z,C){var D=C("MMmD"),N=C("ExA7");function z(k){return N(k)&&D(k)}se.exports=z},"3cYt":function(se,Z){function C(D){return function(N){return D==null?void 0:D[N]}}se.exports=C},"406g":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingOnSyntax=void 0;var D=C("z4Hk"),N=function(){function z(k){this._binding=k}return z.prototype.onActivation=function(k){return this._binding.onActivation=k,new D.BindingWhenSyntax(this._binding)},z}();Z.BindingOnSyntax=N},"44Ds":function(se,Z,C){var D=C("e4Nc"),N="Expected a function";function z(k,v){if(typeof k!="function"||v!=null&&typeof v!="function")throw new TypeError(N);var L=function(){var U=arguments,K=v?v.apply(this,U):U[0],q=L.cache;if(q.has(K))return q.get(K);var fe=k.apply(this,U);return L.cache=q.set(K,fe)||q,fe};return L.cache=new(z.Cache||D),L}z.Cache=D,se.exports=z},"4ZJM":function(se,Z,C){(function(D,N){se.exports=N()})(this,function(){"use strict";var D,N,z;function k(v,L){if(!D)D=L;else if(!N)N=L;else{var U="var sharedChunk = {}; ("+D+")(sharedChunk); ("+N+")(sharedChunk);",K={};D(K),z=L(K),typeof window!="undefined"&&(z.workerUrl=window.URL.createObjectURL(new Blob([U],{type:"text/javascript"})))}}return k(["exports"],function(v){"use strict";function L(s,u){return s(u={exports:{}},u.exports),u.exports}var U=K;function K(s,u,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(g-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=g,this.p2x=f,this.p2y=g}K.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},K.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},K.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},K.prototype.solveCurveX=function(s,u){var f,g,b,E,T;for(u===void 0&&(u=1e-6),b=s,T=0;T<8;T++){if(E=this.sampleCurveX(b)-s,Math.abs(E)<u)return b;var R=this.sampleCurveDerivativeX(b);if(Math.abs(R)<1e-6)break;b-=E/R}if((b=s)<(f=0))return f;if(b>(g=1))return g;for(;f<g;){if(E=this.sampleCurveX(b),Math.abs(E-s)<u)return b;s>E?f=b:g=b,b=.5*(g-f)+f}return b},K.prototype.solve=function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))};var q=fe;function fe(s,u){this.x=s,this.y=u}fe.prototype={clone:function(){return new fe(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,f){return this.clone()._rotateAround(u,f)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var f=u.x-this.x,g=u.y-this.y;return f*f+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,f){return Math.atan2(this.x*f-this.y*u,this.x*u+this.y*f)},_matMult:function(u){var f=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=f,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var f=Math.cos(u),g=Math.sin(u),b=g*this.x+f*this.y;return this.x=f*this.x-g*this.y,this.y=b,this},_rotateAround:function(u,f){var g=Math.cos(u),b=Math.sin(u),E=f.y+b*(this.x-f.x)+g*(this.y-f.y);return this.x=f.x+g*(this.x-f.x)-b*(this.y-f.y),this.y=E,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fe.convert=function(s){return s instanceof fe?s:Array.isArray(s)?new fe(s[0],s[1]):s};var ue=typeof self!="undefined"?self:{},rt=Math.pow(2,53)-1;function Ne(s,u,f,g){var b=new U(s,u,f,g);return function(E){return b.solve(E)}}var nt=Ne(.25,.1,.25,1);function wt(s,u,f){return Math.min(f,Math.max(u,s))}function ht(s,u,f){var g=f-u,b=((s-u)%g+g)%g+u;return b===u?f:b}function We(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var g=0,b=u;g<b.length;g+=1){var E=b[g];for(var T in E)s[T]=E[T]}return s}var St=1;function Je(){return St++}function Ft(){return function s(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function tr(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function yr(s,u){s.forEach(function(f){u[f]&&(u[f]=u[f].bind(u))})}function Dr(s,u){return s.indexOf(u,s.length-u.length)!==-1}function Mr(s,u,f){var g={};for(var b in s)g[b]=u.call(f||this,s[b],b,s);return g}function jt(s,u,f){var g={};for(var b in s)u.call(f||this,s[b],b,s)&&(g[b]=s[b]);return g}function He(s){return Array.isArray(s)?s.map(He):typeof s=="object"&&s?Mr(s,He):s}var Dt={};function Ut(s){Dt[s]||(typeof console!="undefined"&&console.warn(s),Dt[s]=!0)}function Ce(s,u,f){return(f.y-s.y)*(u.x-s.x)>(u.y-s.y)*(f.x-s.x)}function ve(s){for(var u=0,f=0,g=s.length,b=g-1,E=void 0,T=void 0;f<g;b=f++)u+=((T=s[b]).x-(E=s[f]).x)*(E.y+T.y);return u}function Ie(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function zt(s){var u={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(g,b,E,T){var R=E||T;return u[b]=!R||R.toLowerCase(),""}),u["max-age"]){var f=parseInt(u["max-age"],10);isNaN(f)?delete u["max-age"]:u["max-age"]=f}return u}var le=null;function Me(s){if(le==null){var u=s.navigator?s.navigator.userAgent:null;le=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return le}function Re(s){try{var u=ue[s];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(f){return!1}}var yt,At,ae,It,lr=ue.performance&&ue.performance.now?ue.performance.now.bind(ue.performance):Date.now.bind(Date),Cr=ue.requestAnimationFrame||ue.mozRequestAnimationFrame||ue.webkitRequestAnimationFrame||ue.msRequestAnimationFrame,Br=ue.cancelAnimationFrame||ue.mozCancelAnimationFrame||ue.webkitCancelAnimationFrame||ue.msCancelAnimationFrame,pn={now:lr,frame:function(u){var f=Cr(u);return{cancel:function(){return Br(f)}}},getImageData:function(u,f){f===void 0&&(f=0);var g=ue.document.createElement("canvas"),b=g.getContext("2d");if(!b)throw new Error("failed to create canvas 2d context");return g.width=u.width,g.height=u.height,b.drawImage(u,0,0,u.width,u.height),b.getImageData(-f,-f,u.width+2*f,u.height+2*f)},resolveURL:function(u){return yt||(yt=ue.document.createElement("a")),yt.href=u,yt.href},hardwareConcurrency:ue.navigator&&ue.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ue.devicePixelRatio},get prefersReducedMotion(){return!!ue.matchMedia&&(At==null&&(At=ue.matchMedia("(prefers-reduced-motion: reduce)")),At.matches)}},Fr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Pn={supported:!1,testSupport:function(u){!ni&&It&&(Nn?Kn(u):ae=u)}},ni=!1,Nn=!1;function Kn(s){var u=s.createTexture();s.bindTexture(s.TEXTURE_2D,u);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,It),s.isContextLost())return;Pn.supported=!0}catch(f){}s.deleteTexture(u),ni=!0}ue.document&&((It=ue.document.createElement("img")).onload=function(){ae&&Kn(ae),ae=null,Nn=!0},It.onerror=function(){ni=!0,ae=null},It.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Yn="01",Ar=function(u,f){this._transformRequestFn=u,this._customAccessToken=f,this._createSkuToken()};function mr(s){return s.indexOf("mapbox:")===0}Ar.prototype._createSkuToken=function(){var s=function(){for(var u="",f=0;f<10;f++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Yn,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt},Ar.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ar.prototype.transformRequest=function(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}},Ar.prototype.normalizeStyleURL=function(s,u){if(!mr(s))return s;var f=Ue(s);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},Ar.prototype.normalizeGlyphsURL=function(s,u){if(!mr(s))return s;var f=Ue(s);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},Ar.prototype.normalizeSourceURL=function(s,u){if(!mr(s))return s;var f=Ue(s);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||u)},Ar.prototype.normalizeSpriteURL=function(s,u,f,g){var b=Ue(s);return mr(s)?(b.path="/styles/v1"+b.path+"/sprite"+u+f,this._makeAPIURL(b,this._customAccessToken||g)):(b.path+=""+u+f,he(b))},Ar.prototype.normalizeTileURL=function(s,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!mr(s))return s;var f=Ue(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(pn.devicePixelRatio>=2||u===512?"@2x":"")+(Pn.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var g=this._customAccessToken||function(b){for(var E=0,T=b;E<T.length;E+=1){var R=T[E].match(/^access_token=(.*)$/);if(R)return R[1]}return null}(f.params)||Fr.ACCESS_TOKEN;return Fr.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,g)},Ar.prototype.canonicalizeTileURL=function(s,u){var f=Ue(s);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return s;var g="mapbox://tiles/";g+=f.path.replace("/v4/","");var b=f.params;return u&&(b=b.filter(function(E){return!E.match(/^access_token=/)})),b.length&&(g+="?"+b.join("&")),g},Ar.prototype.canonicalizeTileset=function(s,u){for(var f=!!u&&mr(u),g=[],b=0,E=s.tiles||[];b<E.length;b+=1){var T=E[b];Wt(T)?g.push(this.canonicalizeTileURL(T,f)):g.push(T)}return g},Ar.prototype._makeAPIURL=function(s,u){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",g=Ue(Fr.API_URL);if(s.protocol=g.protocol,s.authority=g.authority,s.protocol==="http"){var b=s.params.indexOf("secure");b>=0&&s.params.splice(b,1)}if(g.path!=="/"&&(s.path=""+g.path+s.path),!Fr.REQUIRE_ACCESS_TOKEN)return he(s);if(!(u=u||Fr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return s.params=s.params.filter(function(E){return E.indexOf("access_token")===-1}),s.params.push("access_token="+u),he(s)};var Xt=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Wt(s){return Xt.test(s)}var Ir=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ue(s){var u=s.match(Ir);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function he(s){var u=s.params.length?"?"+s.params.join("&"):"";return s.protocol+"://"+s.authority+s.path+u}function ie(s){if(!s)return null;var u=s.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(ue.atob(u[1]).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(f){return null}}var B=function(u){this.type=u,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};B.prototype.getStorageKey=function(s){var u,f=ie(Fr.ACCESS_TOKEN);return u=f&&f.u?ue.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,function(g,b){return String.fromCharCode(Number("0x"+b))})):Fr.ACCESS_TOKEN||"",s?"mapbox.eventData."+s+":"+u:"mapbox.eventData:"+u},B.prototype.fetchEventData=function(){var s=Re("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{var g=ue.localStorage.getItem(u);g&&(this.eventData=JSON.parse(g));var b=ue.localStorage.getItem(f);b&&(this.anonId=b)}catch(E){Ut("Unable to read from LocalStorage")}},B.prototype.saveEventData=function(){var s=Re("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{ue.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ue.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(g){Ut("Unable to write to LocalStorage")}},B.prototype.processRequests=function(s){},B.prototype.postEvent=function(s,u,f,g){var b=this;if(Fr.EVENTS_URL){var E=Ue(Fr.EVENTS_URL);E.params.push("access_token="+(g||Fr.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(s).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:Yn,userId:this.anonId},R=u?We(T,u):T,j={url:he(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=Pi(j,function(G){b.pendingRequest=null,f(G),b.saveEventData(),b.processRequests(g)})}},B.prototype.queueRequest=function(s,u){this.queue.push(s),this.processRequests(u)};var Ae,Xe,bt=function(s){function u(){s.call(this,"map.load"),this.success={},this.skuToken=""}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(f,g,b,E){this.skuToken=b;var T=!(!E&&!Fr.ACCESS_TOKEN),R=Array.isArray(f)&&f.some(function(j){return mr(j)||Wt(j)});Fr.EVENTS_URL&&T&&R&&this.queueRequest({id:g,timestamp:Date.now()},E)},u.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),E=b.id,T=b.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),tr(this.anonId)||(this.anonId=Ft()),this.postEvent(T,{skuToken:this.skuToken},function(R){R||E&&(g.success[E]=!0)},f))}},u}(B),Gt=new(function(s){function u(f){s.call(this,"appUserTurnstile"),this._customAccessToken=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(f,g){Fr.EVENTS_URL&&Fr.ACCESS_TOKEN&&Array.isArray(f)&&f.some(function(b){return mr(b)||Wt(b)})&&this.queueRequest(Date.now(),g)},u.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=ie(Fr.ACCESS_TOKEN),E=b?b.u:Fr.ACCESS_TOKEN,T=E!==this.eventData.tokenU;tr(this.anonId)||(this.anonId=Ft(),T=!0);var R=this.queue.shift();if(this.eventData.lastSuccess){var j=new Date(this.eventData.lastSuccess),G=new Date(R),$=(R-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||j.getDate()!==G.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(R,{"enabled.telemetry":!1},function(te){te||(g.eventData.lastSuccess=R,g.eventData.tokenU=E)},f)}},u}(B)),sr=Gt.postTurnstileEvent.bind(Gt),at=new bt,Ot=at.postMapLoadEvent.bind(at),or=500,Tr=50;function Or(){ue.caches&&!Ae&&(Ae=ue.caches.open("mapbox-tiles"))}function jn(s){var u=s.indexOf("?");return u<0?s:s.slice(0,u)}var Jr,xn=1/0;function An(){return Jr==null&&(Jr=ue.OffscreenCanvas&&new ue.OffscreenCanvas(1,1).getContext("2d")&&typeof ue.createImageBitmap=="function"),Jr}var ii={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ii);var pi=function(s){function u(f,g,b){g===401&&Wt(b)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),s.call(this,f),this.status=g,this.url=b,this.name=this.constructor.name,this.message=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),Si=Ie()?function(){return self.worker&&self.worker.referrer}:function(){return(ue.location.protocol==="blob:"?ue.parent:ue).location.href},wa,lo,Lo=function(u,f){if(!(/^file:/.test(g=u.url)||/^file:/.test(Si())&&!/^\w+:/.test(g))){if(ue.fetch&&ue.Request&&ue.AbortController&&ue.Request.prototype.hasOwnProperty("signal"))return function(b,E){var T,R=new ue.AbortController,j=new ue.Request(b.url,{method:b.method||"GET",body:b.body,credentials:b.credentials,headers:b.headers,referrer:Si(),signal:R.signal}),G=!1,$=!1,te=(T=j.url).indexOf("sku=")>0&&Wt(T);b.type==="json"&&j.headers.set("Accept","application/json");var ne=function(Le,ct,ft){if(!$){if(Le&&Le.message!=="SecurityError"&&Ut(Le),ct&&ft)return Se(ct);var Rt=Date.now();ue.fetch(j).then(function(Ht){if(Ht.ok){var nr=te?Ht.clone():null;return Se(Ht,nr,Rt)}return E(new pi(Ht.statusText,Ht.status,b.url))}).catch(function(Ht){Ht.code!==20&&E(new Error(Ht.message))})}},Se=function(Le,ct,ft){(b.type==="arrayBuffer"?Le.arrayBuffer():b.type==="json"?Le.json():Le.text()).then(function(Rt){$||(ct&&ft&&function(Ht,nr,Rr){if(Or(),Ae){var gr={status:nr.status,statusText:nr.statusText,headers:new ue.Headers};nr.headers.forEach(function(on,kn){return gr.headers.set(kn,on)});var rn=zt(nr.headers.get("Cache-Control")||"");rn["no-store"]||(rn["max-age"]&&gr.headers.set("Expires",new Date(Rr+1e3*rn["max-age"]).toUTCString()),new Date(gr.headers.get("Expires")).getTime()-Rr<42e4||function(on,kn){if(Xe===void 0)try{new Response(new ReadableStream),Xe=!0}catch(Gn){Xe=!1}Xe?kn(on.body):on.blob().then(kn)}(nr,function(on){var kn=new ue.Response(on,gr);Or(),Ae&&Ae.then(function(Gn){return Gn.put(jn(Ht.url),kn)}).catch(function(Gn){return Ut(Gn.message)})}))}}(j,ct,ft),G=!0,E(null,Rt,Le.headers.get("Cache-Control"),Le.headers.get("Expires")))}).catch(function(Rt){$||E(new Error(Rt.message))})};return te?function(Ve,Le){if(Or(),!Ae)return Le(null);var ct=jn(Ve.url);Ae.then(function(ft){ft.match(ct).then(function(Rt){var Ht=function(nr){if(!nr)return!1;var Rr=new Date(nr.headers.get("Expires")||0),gr=zt(nr.headers.get("Cache-Control")||"");return Rr>Date.now()&&!gr["no-cache"]}(Rt);ft.delete(ct),Ht&&ft.put(ct,Rt.clone()),Le(null,Rt,Ht)}).catch(Le)}).catch(Le)}(j,ne):ne(null,null),{cancel:function(){$=!0,G||R.abort()}}}(u,f);if(Ie()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,f,void 0,!0)}var g;return function(b,E){var T=new ue.XMLHttpRequest;for(var R in T.open(b.method||"GET",b.url,!0),b.type==="arrayBuffer"&&(T.responseType="arraybuffer"),b.headers)T.setRequestHeader(R,b.headers[R]);return b.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=b.credentials==="include",T.onerror=function(){E(new Error(T.statusText))},T.onload=function(){if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){var j=T.response;if(b.type==="json")try{j=JSON.parse(T.response)}catch(G){return E(G)}E(null,j,T.getResponseHeader("Cache-Control"),T.getResponseHeader("Expires"))}else E(new pi(T.statusText,T.status,b.url))},T.send(b.body),{cancel:function(){return T.abort()}}}(u,f)},as=function(u,f){return Lo(We(u,{type:"arrayBuffer"}),f)},Pi=function(u,f){return Lo(We(u,{method:"POST"}),f)},re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";wa=[],lo=0;var J=function s(u,f){if(Pn.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),lo>=Fr.MAX_PARALLEL_IMAGE_REQUESTS){var g={requestParameters:u,callback:f,cancelled:!1,cancel:function(){this.cancelled=!0}};return wa.push(g),g}lo++;var b=!1,E=function(){if(!b)for(b=!0,lo--;wa.length&&lo<Fr.MAX_PARALLEL_IMAGE_REQUESTS;){var j=wa.shift();j.cancelled||(j.cancel=s(j.requestParameters,j.callback).cancel)}},T=as(u,function(R,j,G,$){E(),R?f(R):j&&(An()?function(te,ne){var Se=new ue.Blob([new Uint8Array(te)],{type:"image/png"});ue.createImageBitmap(Se).then(function(Ve){ne(null,Ve)}).catch(function(Ve){ne(new Error("Could not load image because of "+Ve.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(j,f):function(te,ne,Se,Ve){var Le=new ue.Image,ct=ue.URL;Le.onload=function(){ne(null,Le),ct.revokeObjectURL(Le.src),Le.onload=null,ue.requestAnimationFrame(function(){Le.src=re})},Le.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ft=new ue.Blob([new Uint8Array(te)],{type:"image/png"});Le.cacheControl=Se,Le.expires=Ve,Le.src=te.byteLength?ct.createObjectURL(ft):re}(j,f,G,$))});return{cancel:function(){T.cancel(),E()}}};function me(s,u,f){f[s]&&f[s].indexOf(u)!==-1||(f[s]=f[s]||[],f[s].push(u))}function we(s,u,f){if(f&&f[s]){var g=f[s].indexOf(u);g!==-1&&f[s].splice(g,1)}}var ze=function(u,f){f===void 0&&(f={}),We(this,f),this.type=u},mt=function(s){function u(f,g){g===void 0&&(g={}),s.call(this,"error",We({error:f},g))}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(ze),Tt=function(){};Tt.prototype.on=function(s,u){return this._listeners=this._listeners||{},me(s,u,this._listeners),this},Tt.prototype.off=function(s,u){return we(s,u,this._listeners),we(s,u,this._oneTimeListeners),this},Tt.prototype.once=function(s,u){return this._oneTimeListeners=this._oneTimeListeners||{},me(s,u,this._oneTimeListeners),this},Tt.prototype.fire=function(s,u){typeof s=="string"&&(s=new ze(s,u||{}));var f=s.type;if(this.listens(f)){s.target=this;for(var g=0,b=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];g<b.length;g+=1)b[g].call(this,s);for(var E=0,T=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];E<T.length;E+=1){var R=T[E];we(f,R,this._oneTimeListeners),R.call(this,s)}var j=this._eventedParent;j&&(We(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),j.fire(s))}else s instanceof mt&&console.error(s.error);return this},Tt.prototype.listens=function(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)},Tt.prototype.setEventedParent=function(s,u){return this._eventedParent=s,this._eventedParentData=u,this};var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Qe=function(u,f,g,b){this.message=(u?u+": ":"")+g,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)};function Nt(s){var u=s.value;return u?[new Qe(s.key,u,"constants have been deprecated as of v8")]:[]}function wr(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var g=0,b=u;g<b.length;g+=1){var E=b[g];for(var T in E)s[T]=E[T]}return s}function Vr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function pr(s){if(Array.isArray(s))return s.map(pr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){var u={};for(var f in s)u[f]=pr(s[f]);return u}return Vr(s)}var De=function(s){function u(f,g){s.call(this,g),this.message=g,this.key=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Error),et=function(u,f){f===void 0&&(f=[]),this.parent=u,this.bindings={};for(var g=0,b=f;g<b.length;g+=1){var E=b[g];this.bindings[E[0]]=E[1]}};et.prototype.concat=function(s){return new et(this,s)},et.prototype.get=function(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(s+" not found in scope.")},et.prototype.has=function(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)};var Lt={kind:"null"},ut={kind:"number"},Te={kind:"string"},dn={kind:"boolean"},yn={kind:"color"},ci={kind:"object"},vn={kind:"value"},Ai={kind:"collator"},Zi={kind:"formatted"},Bi={kind:"resolvedImage"};function $i(s,u){return{kind:"array",itemType:s,N:u}}function zi(s){if(s.kind==="array"){var u=zi(s.itemType);return typeof s.N=="number"?"array<"+u+", "+s.N+">":s.itemType.kind==="value"?"array":"array<"+u+">"}return s.kind}var $o=[Lt,ut,Te,dn,yn,Zi,ci,$i(vn),Bi];function Ii(s,u){if(u.kind==="error")return null;if(s.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Ii(s.itemType,u.itemType))&&(typeof s.N!="number"||s.N===u.N))return null}else{if(s.kind===u.kind)return null;if(s.kind==="value"){for(var f=0,g=$o;f<g.length;f+=1)if(!Ii(g[f],u))return null}}return"Expected "+zi(s)+" but found "+zi(u)+" instead."}function ja(s,u){return u.some(function(f){return f.kind===s.kind})}function Wi(s,u){return u.some(function(f){return f==="null"?s===null:f==="array"?Array.isArray(s):f==="object"?s&&!Array.isArray(s)&&typeof s=="object":f===typeof s})}var Ni=L(function(s,u){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function g(R){return(R=Math.round(R))<0?0:R>255?255:R}function b(R){return g(R[R.length-1]==="%"?parseFloat(R)/100*255:parseInt(R))}function E(R){return(j=R[R.length-1]==="%"?parseFloat(R)/100:parseFloat(R))<0?0:j>1?1:j;var j}function T(R,j,G){return G<0?G+=1:G>1&&(G-=1),6*G<1?R+(j-R)*G*6:2*G<1?j:3*G<2?R+(j-R)*(2/3-G)*6:R}try{u.parseCSSColor=function(R){var j,G=R.replace(/ /g,"").toLowerCase();if(G in f)return f[G].slice();if(G[0]==="#")return G.length===4?(j=parseInt(G.substr(1),16))>=0&&j<=4095?[(3840&j)>>4|(3840&j)>>8,240&j|(240&j)>>4,15&j|(15&j)<<4,1]:null:G.length===7&&(j=parseInt(G.substr(1),16))>=0&&j<=16777215?[(16711680&j)>>16,(65280&j)>>8,255&j,1]:null;var $=G.indexOf("("),te=G.indexOf(")");if($!==-1&&te+1===G.length){var ne=G.substr(0,$),Se=G.substr($+1,te-($+1)).split(","),Ve=1;switch(ne){case"rgba":if(Se.length!==4)return null;Ve=E(Se.pop());case"rgb":return Se.length!==3?null:[b(Se[0]),b(Se[1]),b(Se[2]),Ve];case"hsla":if(Se.length!==4)return null;Ve=E(Se.pop());case"hsl":if(Se.length!==3)return null;var Le=(parseFloat(Se[0])%360+360)%360/360,ct=E(Se[1]),ft=E(Se[2]),Rt=ft<=.5?ft*(ct+1):ft+ct-ft*ct,Ht=2*ft-Rt;return[g(255*T(Ht,Rt,Le+1/3)),g(255*T(Ht,Rt,Le)),g(255*T(Ht,Rt,Le-1/3)),Ve];default:return null}}return null}}catch(R){}}).parseCSSColor,di=function(u,f,g,b){b===void 0&&(b=1),this.r=u,this.g=f,this.b=g,this.a=b};di.parse=function(s){if(s){if(s instanceof di)return s;if(typeof s=="string"){var u=Ni(s);if(u)return new di(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},di.prototype.toString=function(){var s=this.toArray(),u=s[1],f=s[2],g=s[3];return"rgba("+Math.round(s[0])+","+Math.round(u)+","+Math.round(f)+","+g+")"},di.prototype.toArray=function(){var s=this.a;return s===0?[0,0,0,0]:[255*this.r/s,255*this.g/s,255*this.b/s,s]},di.black=new di(0,0,0,1),di.white=new di(1,1,1,1),di.transparent=new di(0,0,0,0),di.red=new di(1,0,0,1);var ao=function(u,f,g){this.sensitivity=u?f?"variant":"case":f?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ao.prototype.compare=function(s,u){return this.collator.compare(s,u)},ao.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Bs=function(u,f,g,b,E){this.text=u,this.image=f,this.scale=g,this.fontStack=b,this.textColor=E},wo=function(u){this.sections=u};wo.fromString=function(s){return new wo([new Bs(s,null,null,null,null)])},wo.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(s){return s.text.length!==0||s.image&&s.image.name.length!==0})},wo.factory=function(s){return s instanceof wo?s:wo.fromString(s)},wo.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(s){return s.text}).join("")},wo.prototype.serialize=function(){for(var s=["format"],u=0,f=this.sections;u<f.length;u+=1){var g=f[u];if(g.image)s.push(["image",g.image.name]);else{s.push(g.text);var b={};g.fontStack&&(b["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(b["font-scale"]=g.scale),g.textColor&&(b["text-color"]=["rgba"].concat(g.textColor.toArray())),s.push(b)}}return s};var Yo=function(u){this.name=u.name,this.available=u.available};function il(s,u,f,g){return typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof f=="number"&&f>=0&&f<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:"Invalid rgba value ["+[s,u,f,g].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof g=="number"?[s,u,f,g]:[s,u,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Oo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof di||s instanceof ao||s instanceof wo||s instanceof Yo)return!0;if(Array.isArray(s)){for(var u=0,f=s;u<f.length;u+=1)if(!Oo(f[u]))return!1;return!0}if(typeof s=="object"){for(var g in s)if(!Oo(s[g]))return!1;return!0}return!1}function Ea(s){if(s===null)return Lt;if(typeof s=="string")return Te;if(typeof s=="boolean")return dn;if(typeof s=="number")return ut;if(s instanceof di)return yn;if(s instanceof ao)return Ai;if(s instanceof wo)return Zi;if(s instanceof Yo)return Bi;if(Array.isArray(s)){for(var u,f=s.length,g=0,b=s;g<b.length;g+=1){var E=Ea(b[g]);if(u){if(u===E)continue;u=vn;break}u=E}return $i(u||vn,f)}return ci}function al(s){var u=typeof s;return s===null?"":u==="string"||u==="number"||u==="boolean"?String(s):s instanceof di||s instanceof wo||s instanceof Yo?s.toString():JSON.stringify(s)}Yo.prototype.toString=function(){return this.name},Yo.fromString=function(s){return s?new Yo({name:s,available:!1}):null},Yo.prototype.serialize=function(){return["image",this.name]};var Ro=function(u,f){this.type=u,this.value=f};Ro.parse=function(s,u){if(s.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(!Oo(s[1]))return u.error("invalid value");var f=s[1],g=Ea(f),b=u.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Ro(g,f)},Ro.prototype.evaluate=function(){return this.value},Ro.prototype.eachChild=function(){},Ro.prototype.outputDefined=function(){return!0},Ro.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof di?["rgba"].concat(this.value.toArray()):this.value instanceof wo?this.value.serialize():this.value};var Oa=function(u){this.name="ExpressionEvaluationError",this.message=u};Oa.prototype.toJSON=function(){return this.message};var Ko={string:Te,number:ut,boolean:dn,object:ci},ca=function(u,f){this.type=u,this.args=f};ca.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f,g=1,b=s[0];if(b==="array"){var E,T;if(s.length>2){var R=s[1];if(typeof R!="string"||!(R in Ko)||R==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ko[R],g++}else E=vn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=s[2],g++}f=$i(E,T)}else f=Ko[b];for(var j=[];g<s.length;g++){var G=u.parse(s[g],g,vn);if(!G)return null;j.push(G)}return new ca(f,j)},ca.prototype.evaluate=function(s){for(var u=0;u<this.args.length;u++){var f=this.args[u].evaluate(s);if(!Ii(this.type,Ea(f)))return f;if(u===this.args.length-1)throw new Oa("Expected value to be of type "+zi(this.type)+", but found "+zi(Ea(f))+" instead.")}return null},ca.prototype.eachChild=function(s){this.args.forEach(s)},ca.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},ca.prototype.serialize=function(){var s=this.type,u=[s.kind];if(s.kind==="array"){var f=s.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);var g=s.N;(typeof g=="number"||this.args.length>1)&&u.push(g)}}return u.concat(this.args.map(function(b){return b.serialize()}))};var Eo=function(u){this.type=Zi,this.sections=u};Eo.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");for(var g=[],b=!1,E=1;E<=s.length-1;++E){var T=s[E];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;var R=null;if(T["font-scale"]&&!(R=u.parse(T["font-scale"],1,ut)))return null;var j=null;if(T["text-font"]&&!(j=u.parse(T["text-font"],1,$i(Te))))return null;var G=null;if(T["text-color"]&&!(G=u.parse(T["text-color"],1,yn)))return null;var $=g[g.length-1];$.scale=R,$.font=j,$.textColor=G}else{var te=u.parse(s[E],1,vn);if(!te)return null;var ne=te.type.kind;if(ne!=="string"&&ne!=="value"&&ne!=="null"&&ne!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:te,scale:null,font:null,textColor:null})}}return new Eo(g)},Eo.prototype.evaluate=function(s){return new wo(this.sections.map(function(u){var f=u.content.evaluate(s);return Ea(f)===Bi?new Bs("",f,null,null,null):new Bs(al(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))},Eo.prototype.eachChild=function(s){for(var u=0,f=this.sections;u<f.length;u+=1){var g=f[u];s(g.content),g.scale&&s(g.scale),g.font&&s(g.font),g.textColor&&s(g.textColor)}},Eo.prototype.outputDefined=function(){return!1},Eo.prototype.serialize=function(){for(var s=["format"],u=0,f=this.sections;u<f.length;u+=1){var g=f[u];s.push(g.content.serialize());var b={};g.scale&&(b["font-scale"]=g.scale.serialize()),g.font&&(b["text-font"]=g.font.serialize()),g.textColor&&(b["text-color"]=g.textColor.serialize()),s.push(b)}return s};var qo=function(u){this.type=Bi,this.input=u};qo.parse=function(s,u){if(s.length!==2)return u.error("Expected two arguments.");var f=u.parse(s[1],1,Te);return f?new qo(f):u.error("No image name provided.")},qo.prototype.evaluate=function(s){var u=this.input.evaluate(s),f=Yo.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f},qo.prototype.eachChild=function(s){s(this.input)},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){return["image",this.input.serialize()]};var ol={"to-boolean":dn,"to-color":yn,"to-number":ut,"to-string":Te},Qo=function(u,f){this.type=u,this.args=f};Qo.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f=s[0];if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");for(var g=ol[f],b=[],E=1;E<s.length;E++){var T=u.parse(s[E],E,vn);if(!T)return null;b.push(T)}return new Qo(g,b)},Qo.prototype.evaluate=function(s){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(s));if(this.type.kind==="color"){for(var u,f,g=0,b=this.args;g<b.length;g+=1){if(f=null,(u=b[g].evaluate(s))instanceof di)return u;if(typeof u=="string"){var E=s.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(f=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":il(u[0],u[1],u[2],u[3])))return new di(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Oa(f||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,R=0,j=this.args;R<j.length;R+=1){if((T=j[R].evaluate(s))===null)return 0;var G=Number(T);if(!isNaN(G))return G}throw new Oa("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?wo.fromString(al(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?Yo.fromString(al(this.args[0].evaluate(s))):al(this.args[0].evaluate(s))},Qo.prototype.eachChild=function(s){this.args.forEach(s)},Qo.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Qo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Eo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new qo(this.args[0]).serialize();var s=["to-"+this.type.kind];return this.eachChild(function(u){s.push(u.serialize())}),s};var sl=["Unknown","Point","LineString","Polygon"],oo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};oo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},oo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?sl[this.feature.type]:this.feature.type:null},oo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},oo.prototype.canonicalID=function(){return this.canonical},oo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},oo.prototype.parseColor=function(s){var u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=di.parse(s)),u};var qi=function(u,f,g,b){this.name=u,this.type=f,this._evaluate=g,this.args=b};qi.prototype.evaluate=function(s){return this._evaluate(s,this.args)},qi.prototype.eachChild=function(s){this.args.forEach(s)},qi.prototype.outputDefined=function(){return!1},qi.prototype.serialize=function(){return[this.name].concat(this.args.map(function(s){return s.serialize()}))},qi.parse=function(s,u){var f,g=s[0],b=qi.definitions[g];if(!b)return u.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,R=T.filter(function(zn){var Rn=zn[0];return!Array.isArray(Rn)||Rn.length===s.length-1}),j=null,G=0,$=R;G<$.length;G+=1){var te=$[G],ne=te[0],Se=te[1];j=new ju(u.registry,u.path,null,u.scope);for(var Ve=[],Le=!1,ct=1;ct<s.length;ct++){var ft=s[ct],Rt=Array.isArray(ne)?ne[ct-1]:ne.type,Ht=j.parse(ft,1+Ve.length,Rt);if(!Ht){Le=!0;break}Ve.push(Ht)}if(!Le)if(Array.isArray(ne)&&ne.length!==Ve.length)j.error("Expected "+ne.length+" arguments, but found "+Ve.length+" instead.");else{for(var nr=0;nr<Ve.length;nr++){var Rr=Array.isArray(ne)?ne[nr]:ne.type,gr=Ve[nr];j.concat(nr+1).checkSubtype(Rr,gr.type)}if(j.errors.length===0)return new qi(g,E,Se,Ve)}}if(R.length===1)(f=u.errors).push.apply(f,j.errors);else{for(var rn=(R.length?R:T).map(function(zn){var Rn;return Rn=zn[0],Array.isArray(Rn)?"("+Rn.map(zi).join(", ")+")":"("+zi(Rn.type)+"...)"}).join(" | "),on=[],kn=1;kn<s.length;kn++){var Gn=u.parse(s[kn],1+on.length);if(!Gn)return null;on.push(zi(Gn.type))}u.error("Expected arguments of type "+rn+", but found ("+on.join(", ")+") instead.")}return null},qi.register=function(s,u){for(var f in qi.definitions=u,u)s[f]=qi};var pt=function(u,f,g){this.type=Ai,this.locale=g,this.caseSensitive=u,this.diacriticSensitive=f};function pe(s,u){s[0]=Math.min(s[0],u[0]),s[1]=Math.min(s[1],u[1]),s[2]=Math.max(s[2],u[0]),s[3]=Math.max(s[3],u[1])}function Ke(s,u){return!(s[0]<=u[0]||s[2]>=u[2]||s[1]<=u[1]||s[3]>=u[3])}function ar(s,u){var f=(180+s[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,b=Math.pow(2,u.z);return[Math.round(f*b*8192),Math.round(g*b*8192)]}function qr(s,u,f){return u[1]>s[1]!=f[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]}function Cn(s,u){for(var f,g,b,E,T,R,j,G=!1,$=0,te=u.length;$<te;$++)for(var ne=u[$],Se=0,Ve=ne.length;Se<Ve-1;Se++){if((E=(f=s)[0]-(g=ne[Se])[0])*(j=f[1]-(b=ne[Se+1])[1])-(R=f[0]-b[0])*(T=f[1]-g[1])==0&&E*R<=0&&T*j<=0)return!1;qr(s,ne[Se],ne[Se+1])&&(G=!G)}return G}function ji(s,u){for(var f=0;f<u.length;f++)if(Cn(s,u[f]))return!0;return!1}function ka(s,u,f,g){var b=g[0]-f[0],E=g[1]-f[1],T=(s[0]-f[0])*E-b*(s[1]-f[1]),R=(u[0]-f[0])*E-b*(u[1]-f[1]);return T>0&&R<0||T<0&&R>0}function So(s,u,f){for(var g=0,b=f;g<b.length;g+=1)for(var E=b[g],T=0;T<E.length-1;++T)if((te=[($=E[T+1])[0]-(G=E[T])[0],$[1]-G[1]])[0]*(ne=[(j=u)[0]-(R=s)[0],j[1]-R[1]])[1]-te[1]*ne[0]!=0&&ka(R,j,G,$)&&ka(G,$,R,j))return!0;var R,j,G,$,te,ne;return!1}function os(s,u){for(var f=0;f<s.length;++f)if(!Cn(s[f],u))return!1;for(var g=0;g<s.length-1;++g)if(So(s[g],s[g+1],u))return!1;return!0}function Cs(s,u){for(var f=0;f<u.length;f++)if(os(s,u[f]))return!0;return!1}function uu(s,u,f){for(var g=[],b=0;b<s.length;b++){for(var E=[],T=0;T<s[b].length;T++){var R=ar(s[b][T],f);pe(u,R),E.push(R)}g.push(E)}return g}function Bf(s,u,f){for(var g=[],b=0;b<s.length;b++){var E=uu(s[b],u,f);g.push(E)}return g}function Ml(s,u,f,g){if(s[0]<f[0]||s[0]>f[2]){var b=.5*g,E=s[0]-f[0]>b?-g:f[0]-s[0]>b?g:0;E===0&&(E=s[0]-f[2]>b?-g:f[2]-s[0]>b?g:0),s[0]+=E}pe(u,s)}function lp(s,u,f,g){for(var b=8192*Math.pow(2,g.z),E=[8192*g.x,8192*g.y],T=[],R=0,j=s;R<j.length;R+=1)for(var G=0,$=j[R];G<$.length;G+=1){var te=$[G],ne=[te.x+E[0],te.y+E[1]];Ml(ne,u,f,b),T.push(ne)}return T}function rc(s,u,f,g){for(var b,E=8192*Math.pow(2,g.z),T=[8192*g.x,8192*g.y],R=[],j=0,G=s;j<G.length;j+=1){for(var $=[],te=0,ne=G[j];te<ne.length;te+=1){var Se=ne[te],Ve=[Se.x+T[0],Se.y+T[1]];pe(u,Ve),$.push(Ve)}R.push($)}if(u[2]-u[0]<=E/2){(b=u)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(var Le=0,ct=R;Le<ct.length;Le+=1)for(var ft=0,Rt=ct[Le];ft<Rt.length;ft+=1)Ml(Rt[ft],u,f,E)}return R}pt.parse=function(s,u){if(s.length!==2)return u.error("Expected one argument.");var f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");var g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,dn);if(!g)return null;var b=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,dn);if(!b)return null;var E=null;return f.locale&&!(E=u.parse(f.locale,1,Te))?null:new pt(g,b,E)},pt.prototype.evaluate=function(s){return new ao(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)},pt.prototype.eachChild=function(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)},pt.prototype.outputDefined=function(){return!1},pt.prototype.serialize=function(){var s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]};var Ra=function(u,f){this.type=dn,this.geojson=u,this.geometries=f};function ul(s){if(s instanceof qi&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ra)return!1;var u=!0;return s.eachChild(function(f){u&&!ul(f)&&(u=!1)}),u}function ll(s){if(s instanceof qi&&s.name==="feature-state")return!1;var u=!0;return s.eachChild(function(f){u&&!ll(f)&&(u=!1)}),u}function lu(s,u){if(s instanceof qi&&u.indexOf(s.name)>=0)return!1;var f=!0;return s.eachChild(function(g){f&&!lu(g,u)&&(f=!1)}),f}Ra.parse=function(s,u){if(s.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(Oo(s[1])){var f=s[1];if(f.type==="FeatureCollection")for(var g=0;g<f.features.length;++g){var b=f.features[g].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Ra(f,f.features[g].geometry)}else if(f.type==="Feature"){var E=f.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Ra(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Ra(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Ra.prototype.evaluate=function(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=uu(f.coordinates,b,E),R=lp(u.geometry(),g,b,E);if(!Ke(g,b))return!1;for(var j=0,G=R;j<G.length;j+=1)if(!Cn(G[j],T))return!1}if(f.type==="MultiPolygon"){var $=Bf(f.coordinates,b,E),te=lp(u.geometry(),g,b,E);if(!Ke(g,b))return!1;for(var ne=0,Se=te;ne<Se.length;ne+=1)if(!ji(Se[ne],$))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(f.type==="Polygon"){var T=uu(f.coordinates,b,E),R=rc(u.geometry(),g,b,E);if(!Ke(g,b))return!1;for(var j=0,G=R;j<G.length;j+=1)if(!os(G[j],T))return!1}if(f.type==="MultiPolygon"){var $=Bf(f.coordinates,b,E),te=rc(u.geometry(),g,b,E);if(!Ke(g,b))return!1;for(var ne=0,Se=te;ne<Se.length;ne+=1)if(!Cs(Se[ne],$))return!1}return!0}(s,this.geometries)}return!1},Ra.prototype.eachChild=function(){},Ra.prototype.outputDefined=function(){return!0},Ra.prototype.serialize=function(){return["within",this.geojson]};var xu=function(u,f){this.type=f.type,this.name=u,this.boundExpression=f};xu.parse=function(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var f=s[1];return u.scope.has(f)?new xu(f,u.scope.get(f)):u.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},xu.prototype.evaluate=function(s){return this.boundExpression.evaluate(s)},xu.prototype.eachChild=function(){},xu.prototype.outputDefined=function(){return!1},xu.prototype.serialize=function(){return["var",this.name]};var ju=function(u,f,g,b,E){f===void 0&&(f=[]),b===void 0&&(b=new et),E===void 0&&(E=[]),this.registry=u,this.path=f,this.key=f.map(function(T){return"["+T+"]"}).join(""),this.scope=b,this.errors=E,this.expectedType=g};function af(s,u){for(var f,g=s.length-1,b=0,E=g,T=0;b<=E;)if((f=s[T=Math.floor((b+E)/2)])<=u){if(T===g||u<s[T+1])return T;b=T+1}else{if(!(f>u))throw new Oa("Input is not a number.");E=T-1}return 0}ju.prototype.parse=function(s,u,f,g,b){return b===void 0&&(b={}),u?this.concat(u,f,g)._parse(s,b):this._parse(s,b)},ju.prototype._parse=function(s,u){function f(G,$,te){return te==="assert"?new ca($,[G]):te==="coerce"?new Qo($,[G]):G}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var g=s[0];if(typeof g!="string")return this.error("Expression name must be a string, but found "+typeof g+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[g];if(b){var E=b.parse(s,this);if(!E)return null;if(this.expectedType){var T=this.expectedType,R=E.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(T,R))return null}else E=f(E,T,u.typeAnnotation||"coerce");else E=f(E,T,u.typeAnnotation||"assert")}if(!(E instanceof Ro)&&E.type.kind!=="resolvedImage"&&function G($){if($ instanceof xu)return G($.boundExpression);if($ instanceof qi&&$.name==="error"||$ instanceof pt||$ instanceof Ra)return!1;var te=$ instanceof Qo||$ instanceof ca,ne=!0;return $.eachChild(function(Se){ne=te?ne&&G(Se):ne&&Se instanceof Ro}),!!ne&&ul($)&&lu($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var j=new oo;try{E=new Ro(E.type,E.evaluate(j))}catch(G){return this.error(G.message),null}}return E}return this.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof s+" instead.")},ju.prototype.concat=function(s,u,f){var g=typeof s=="number"?this.path.concat(s):this.path,b=f?this.scope.concat(f):this.scope;return new ju(this.registry,g,u||null,b,this.errors)},ju.prototype.error=function(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];var g=""+this.key+u.map(function(b){return"["+b+"]"}).join("");this.errors.push(new De(g,s))},ju.prototype.checkSubtype=function(s,u){var f=Ii(s,u);return f&&this.error(f),f};var go=function(u,f,g){this.type=u,this.input=f,this.labels=[],this.outputs=[];for(var b=0,E=g;b<E.length;b+=1){var T=E[b],R=T[1];this.labels.push(T[0]),this.outputs.push(R)}};function Xa(s,u,f){return s*(1-f)+u*f}go.parse=function(s,u){if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");var f=u.parse(s[1],1,ut);if(!f)return null;var g=[],b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(var E=1;E<s.length;E+=2){var T=E===1?-1/0:s[E],R=s[E+1],j=E,G=E+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);var $=u.parse(R,G,b);if(!$)return null;b=b||$.type,g.push([T,$])}return new go(b,f,g)},go.prototype.evaluate=function(s){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);var b=u.length;return g>=u[b-1]?f[b-1].evaluate(s):f[af(u,g)].evaluate(s)},go.prototype.eachChild=function(s){s(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)s(f[u])},go.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},go.prototype.serialize=function(){for(var s=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&s.push(this.labels[u]),s.push(this.outputs[u].serialize());return s};var nc=Object.freeze({__proto__:null,number:Xa,color:function(u,f,g){return new di(Xa(u.r,f.r,g),Xa(u.g,f.g,g),Xa(u.b,f.b,g),Xa(u.a,f.a,g))},array:function(u,f,g){return u.map(function(b,E){return Xa(b,f[E],g)})}}),Ui=6/29*3*(6/29),zu=Math.PI/180,Uu=180/Math.PI;function Rc(s){return s>.008856451679035631?Math.pow(s,1/3):s/Ui+4/29}function Ah(s){return s>6/29?s*s*s:Ui*(s-4/29)}function Th(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Ch(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function cp(s){var u=Ch(s.r),f=Ch(s.g),g=Ch(s.b),b=Rc((.4124564*u+.3575761*f+.1804375*g)/.95047),E=Rc((.2126729*u+.7151522*f+.072175*g)/1);return{l:116*E-16,a:500*(b-E),b:200*(E-Rc((.0193339*u+.119192*f+.9503041*g)/1.08883)),alpha:s.a}}function Lf(s){var u=(s.l+16)/116,f=isNaN(s.a)?u:u+s.a/500,g=isNaN(s.b)?u:u-s.b/200;return u=1*Ah(u),f=.95047*Ah(f),g=1.08883*Ah(g),new di(Th(3.2404542*f-1.5371385*u-.4985314*g),Th(-.969266*f+1.8760108*u+.041556*g),Th(.0556434*f-.2040259*u+1.0572252*g),s.alpha)}function wh(s,u,f){var g=u-s;return s+f*(g>180||g<-180?g-360*Math.round(g/360):g)}var Eu={forward:cp,reverse:Lf,interpolate:function(u,f,g){return{l:Xa(u.l,f.l,g),a:Xa(u.a,f.a,g),b:Xa(u.b,f.b,g),alpha:Xa(u.alpha,f.alpha,g)}}},eu={forward:function(u){var f=cp(u),g=f.l,b=f.a,E=f.b,T=Math.atan2(E,b)*Uu;return{h:T<0?T+360:T,c:Math.sqrt(b*b+E*E),l:g,alpha:u.a}},reverse:function(u){var f=u.h*zu,g=u.c;return Lf({l:u.l,a:Math.cos(f)*g,b:Math.sin(f)*g,alpha:u.alpha})},interpolate:function(u,f,g){return{h:wh(u.h,f.h,g),c:Xa(u.c,f.c,g),l:Xa(u.l,f.l,g),alpha:Xa(u.alpha,f.alpha,g)}}},cr=Object.freeze({__proto__:null,lab:Eu,hcl:eu}),hn=function(u,f,g,b,E){this.type=u,this.operator=f,this.interpolation=g,this.input=b,this.labels=[],this.outputs=[];for(var T=0,R=E;T<R.length;T+=1){var j=R[T],G=j[1];this.labels.push(j[0]),this.outputs.push(G)}};function ic(s,u,f,g){var b=g-f,E=s-f;return b===0?0:u===1?E/b:(Math.pow(u,E)-1)/(Math.pow(u,b)-1)}hn.interpolationFactor=function(s,u,f,g){var b=0;if(s.name==="exponential")b=ic(u,s.base,f,g);else if(s.name==="linear")b=ic(u,1,f,g);else if(s.name==="cubic-bezier"){var E=s.controlPoints;b=new U(E[0],E[1],E[2],E[3]).solve(ic(u,1,f,g))}return b},hn.parse=function(s,u){var f=s[0],g=s[1],b=s[2],E=s.slice(3);if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){var T=g[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:T}}else{if(g[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(g[0]),1,0);var R=g.slice(1);if(R.length!==4||R.some(function(ct){return typeof ct!="number"||ct<0||ct>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:R}}if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(b=u.parse(b,2,ut)))return null;var j=[],G=null;f==="interpolate-hcl"||f==="interpolate-lab"?G=yn:u.expectedType&&u.expectedType.kind!=="value"&&(G=u.expectedType);for(var $=0;$<E.length;$+=2){var te=E[$],ne=E[$+1],Se=$+3,Ve=$+4;if(typeof te!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Se);if(j.length&&j[j.length-1][0]>=te)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Se);var Le=u.parse(ne,Ve,G);if(!Le)return null;G=G||Le.type,j.push([te,Le])}return G.kind==="number"||G.kind==="color"||G.kind==="array"&&G.itemType.kind==="number"&&typeof G.N=="number"?new hn(G,f,g,b,j):u.error("Type "+zi(G)+" is not interpolatable.")},hn.prototype.evaluate=function(s){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);var b=u.length;if(g>=u[b-1])return f[b-1].evaluate(s);var E=af(u,g),T=hn.interpolationFactor(this.interpolation,g,u[E],u[E+1]),R=f[E].evaluate(s),j=f[E+1].evaluate(s);return this.operator==="interpolate"?nc[this.type.kind.toLowerCase()](R,j,T):this.operator==="interpolate-hcl"?eu.reverse(eu.interpolate(eu.forward(R),eu.forward(j),T)):Eu.reverse(Eu.interpolate(Eu.forward(R),Eu.forward(j),T))},hn.prototype.eachChild=function(s){s(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)s(f[u])},hn.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},hn.prototype.serialize=function(){var s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,s,this.input.serialize()],f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u};var Pl=function(u,f){this.type=u,this.args=f};Pl.parse=function(s,u){if(s.length<2)return u.error("Expectected at least one argument.");var f=null,g=u.expectedType;g&&g.kind!=="value"&&(f=g);for(var b=[],E=0,T=s.slice(1);E<T.length;E+=1){var R=u.parse(T[E],1+b.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,b.push(R)}var j=g&&b.some(function(G){return Ii(g,G.type)});return new Pl(j?vn:f,b)},Pl.prototype.evaluate=function(s){for(var u,f=null,g=0,b=0,E=this.args;b<E.length&&(g++,(f=E[b].evaluate(s))&&f instanceof Yo&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f===null);b+=1);return f},Pl.prototype.eachChild=function(s){this.args.forEach(s)},Pl.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Pl.prototype.serialize=function(){var s=["coalesce"];return this.eachChild(function(u){s.push(u.serialize())}),s};var tu=function(u,f){this.type=f.type,this.bindings=[].concat(u),this.result=f};tu.prototype.evaluate=function(s){return this.result.evaluate(s)},tu.prototype.eachChild=function(s){for(var u=0,f=this.bindings;u<f.length;u+=1)s(f[u][1]);s(this.result)},tu.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found "+(s.length-1)+" instead.");for(var f=[],g=1;g<s.length-1;g+=2){var b=s[g];if(typeof b!="string")return u.error("Expected string, but found "+typeof b+" instead.",g);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",g);var E=u.parse(s[g+1],g+1);if(!E)return null;f.push([b,E])}var T=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return T?new tu(f,T):null},tu.prototype.outputDefined=function(){return this.result.outputDefined()},tu.prototype.serialize=function(){for(var s=["let"],u=0,f=this.bindings;u<f.length;u+=1){var g=f[u];s.push(g[0],g[1].serialize())}return s.push(this.result.serialize()),s};var Il=function(u,f,g){this.type=u,this.index=f,this.input=g};Il.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,ut),g=u.parse(s[2],2,$i(u.expectedType||vn));return f&&g?new Il(g.type.itemType,f,g):null},Il.prototype.evaluate=function(s){var u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new Oa("Array index out of bounds: "+u+" < 0.");if(u>=f.length)throw new Oa("Array index out of bounds: "+u+" > "+(f.length-1)+".");if(u!==Math.floor(u))throw new Oa("Array index must be an integer, but found "+u+" instead.");return f[u]},Il.prototype.eachChild=function(s){s(this.index),s(this.input)},Il.prototype.outputDefined=function(){return!1},Il.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var cu=function(u,f){this.type=dn,this.needle=u,this.haystack=f};cu.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,vn),g=u.parse(s[2],2,vn);return f&&g?ja(f.type,[dn,Te,ut,Lt,vn])?new cu(f,g):u.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(f.type)+" instead"):null},cu.prototype.evaluate=function(s){var u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!Wi(u,["boolean","string","number","null"]))throw new Oa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Ea(u))+" instead.");if(!Wi(f,["string","array"]))throw new Oa("Expected second argument to be of type array or string, but found "+zi(Ea(f))+" instead.");return f.indexOf(u)>=0},cu.prototype.eachChild=function(s){s(this.needle),s(this.haystack)},cu.prototype.outputDefined=function(){return!0},cu.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var cl=function(u,f,g){this.type=ut,this.needle=u,this.haystack=f,this.fromIndex=g};cl.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,vn),g=u.parse(s[2],2,vn);if(!f||!g)return null;if(!ja(f.type,[dn,Te,ut,Lt,vn]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(f.type)+" instead");if(s.length===4){var b=u.parse(s[3],3,ut);return b?new cl(f,g,b):null}return new cl(f,g)},cl.prototype.evaluate=function(s){var u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!Wi(u,["boolean","string","number","null"]))throw new Oa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Ea(u))+" instead.");if(!Wi(f,["string","array"]))throw new Oa("Expected second argument to be of type array or string, but found "+zi(Ea(f))+" instead.");if(this.fromIndex){var g=this.fromIndex.evaluate(s);return f.indexOf(u,g)}return f.indexOf(u)},cl.prototype.eachChild=function(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)},cl.prototype.outputDefined=function(){return!1},cl.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ru=function(u,f,g,b,E,T){this.inputType=u,this.type=f,this.input=g,this.cases=b,this.outputs=E,this.otherwise=T};ru.parse=function(s,u){if(s.length<5)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if(s.length%2!=1)return u.error("Expected an even number of arguments.");var f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);for(var b={},E=[],T=2;T<s.length-1;T+=2){var R=s[T],j=s[T+1];Array.isArray(R)||(R=[R]);var G=u.concat(T);if(R.length===0)return G.error("Expected at least one branch label.");for(var $=0,te=R;$<te.length;$+=1){var ne=te[$];if(typeof ne!="number"&&typeof ne!="string")return G.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return G.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ne=="number"&&Math.floor(ne)!==ne)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,Ea(ne)))return null}else f=Ea(ne);if(b[String(ne)]!==void 0)return G.error("Branch labels must be unique.");b[String(ne)]=E.length}var Se=u.parse(j,T,g);if(!Se)return null;g=g||Se.type,E.push(Se)}var Ve=u.parse(s[1],1,vn);if(!Ve)return null;var Le=u.parse(s[s.length-1],s.length-1,g);return Le?Ve.type.kind!=="value"&&u.concat(1).checkSubtype(f,Ve.type)?null:new ru(f,g,Ve,b,E,Le):null},ru.prototype.evaluate=function(s){var u=this.input.evaluate(s);return(Ea(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)},ru.prototype.eachChild=function(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)},ru.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})&&this.otherwise.outputDefined()},ru.prototype.serialize=function(){for(var s=this,u=["match",this.input.serialize()],f=[],g={},b=0,E=Object.keys(this.cases).sort();b<E.length;b+=1){var T=E[b];(te=g[this.cases[T]])===void 0?(g[this.cases[T]]=f.length,f.push([this.cases[T],[T]])):f[te][1].push(T)}for(var R=function(Ve){return s.inputType.kind==="number"?Number(Ve):Ve},j=0,G=f;j<G.length;j+=1){var $=G[j],te=$[0],ne=$[1];u.push(ne.length===1?R(ne[0]):ne.map(R)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var fl=function(u,f,g){this.type=u,this.branches=f,this.otherwise=g};fl.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found only "+(s.length-1)+".");if(s.length%2!=0)return u.error("Expected an odd number of arguments.");var f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);for(var g=[],b=1;b<s.length-1;b+=2){var E=u.parse(s[b],b,dn);if(!E)return null;var T=u.parse(s[b+1],b+1,f);if(!T)return null;g.push([E,T]),f=f||T.type}var R=u.parse(s[s.length-1],s.length-1,f);return R?new fl(f,g,R):null},fl.prototype.evaluate=function(s){for(var u=0,f=this.branches;u<f.length;u+=1){var g=f[u],b=g[1];if(g[0].evaluate(s))return b.evaluate(s)}return this.otherwise.evaluate(s)},fl.prototype.eachChild=function(s){for(var u=0,f=this.branches;u<f.length;u+=1){var g=f[u],b=g[1];s(g[0]),s(b)}s(this.otherwise)},fl.prototype.outputDefined=function(){return this.branches.every(function(s){return s[1].outputDefined()})&&this.otherwise.outputDefined()},fl.prototype.serialize=function(){var s=["case"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Dl=function(u,f,g,b){this.type=u,this.input=f,this.beginIndex=g,this.endIndex=b};function fp(s,u){return s==="=="||s==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function hp(s,u,f,g){return g.compare(u,f)===0}function ba(s,u,f){var g=s!=="=="&&s!=="!=";return function(){function b(E,T,R){this.type=dn,this.lhs=E,this.rhs=T,this.collator=R,this.hasUntypedArgument=E.type.kind==="value"||T.type.kind==="value"}return b.parse=function(E,T){if(E.length!==3&&E.length!==4)return T.error("Expected two or three arguments.");var R=E[0],j=T.parse(E[1],1,vn);if(!j)return null;if(!fp(R,j.type))return T.concat(1).error('"'+R+`" comparisons are not supported for type '`+zi(j.type)+"'.");var G=T.parse(E[2],2,vn);if(!G)return null;if(!fp(R,G.type))return T.concat(2).error('"'+R+`" comparisons are not supported for type '`+zi(G.type)+"'.");if(j.type.kind!==G.type.kind&&j.type.kind!=="value"&&G.type.kind!=="value")return T.error("Cannot compare types '"+zi(j.type)+"' and '"+zi(G.type)+"'.");g&&(j.type.kind==="value"&&G.type.kind!=="value"?j=new ca(G.type,[j]):j.type.kind!=="value"&&G.type.kind==="value"&&(G=new ca(j.type,[G])));var $=null;if(E.length===4){if(j.type.kind!=="string"&&G.type.kind!=="string"&&j.type.kind!=="value"&&G.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(E[3],3,Ai)))return null}return new b(j,G,$)},b.prototype.evaluate=function(E){var T=this.lhs.evaluate(E),R=this.rhs.evaluate(E);if(g&&this.hasUntypedArgument){var j=Ea(T),G=Ea(R);if(j.kind!==G.kind||j.kind!=="string"&&j.kind!=="number")throw new Oa('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+j.kind+", "+G.kind+") instead.")}if(this.collator&&!g&&this.hasUntypedArgument){var $=Ea(T),te=Ea(R);if($.kind!=="string"||te.kind!=="string")return u(E,T,R)}return this.collator?f(E,T,R,this.collator.evaluate(E)):u(E,T,R)},b.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},b.prototype.outputDefined=function(){return!0},b.prototype.serialize=function(){var E=[s];return this.eachChild(function(T){E.push(T.serialize())}),E},b}()}Dl.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,vn),g=u.parse(s[2],2,ut);if(!f||!g)return null;if(!ja(f.type,[$i(vn),Te,vn]))return u.error("Expected first argument to be of type array or string, but found "+zi(f.type)+" instead");if(s.length===4){var b=u.parse(s[3],3,ut);return b?new Dl(f.type,f,g,b):null}return new Dl(f.type,f,g)},Dl.prototype.evaluate=function(s){var u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!Wi(u,["string","array"]))throw new Oa("Expected first argument to be of type array or string, but found "+zi(Ea(u))+" instead.");if(this.endIndex){var g=this.endIndex.evaluate(s);return u.slice(f,g)}return u.slice(f)},Dl.prototype.eachChild=function(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)},Dl.prototype.outputDefined=function(){return!1},Dl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ld=ba("==",function(s,u,f){return u===f},hp),Nf=ba("!=",function(s,u,f){return u!==f},function(s,u,f,g){return!hp(0,u,f,g)}),Oh=ba("<",function(s,u,f){return u<f},function(s,u,f,g){return g.compare(u,f)<0}),co=ba(">",function(s,u,f){return u>f},function(s,u,f,g){return g.compare(u,f)>0}),Rh=ba("<=",function(s,u,f){return u<=f},function(s,u,f,g){return g.compare(u,f)<=0}),pp=ba(">=",function(s,u,f){return u>=f},function(s,u,f,g){return g.compare(u,f)>=0}),Ls=function(u,f,g,b,E){this.type=Te,this.number=u,this.locale=f,this.currency=g,this.minFractionDigits=b,this.maxFractionDigits=E};Ls.parse=function(s,u){if(s.length!==3)return u.error("Expected two arguments.");var f=u.parse(s[1],1,ut);if(!f)return null;var g=s[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");var b=null;if(g.locale&&!(b=u.parse(g.locale,1,Te)))return null;var E=null;if(g.currency&&!(E=u.parse(g.currency,1,Te)))return null;var T=null;if(g["min-fraction-digits"]&&!(T=u.parse(g["min-fraction-digits"],1,ut)))return null;var R=null;return g["max-fraction-digits"]&&!(R=u.parse(g["max-fraction-digits"],1,ut))?null:new Ls(f,b,E,T,R)},Ls.prototype.evaluate=function(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))},Ls.prototype.eachChild=function(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){var s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]};var hl=function(u){this.type=ut,this.input=u};hl.parse=function(s,u){if(s.length!==2)return u.error("Expected 1 argument, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+zi(f.type)+" instead."):new hl(f):null},hl.prototype.evaluate=function(s){var u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Oa("Expected value to be of type string or array, but found "+zi(Ea(u))+" instead.")},hl.prototype.eachChild=function(s){s(this.input)},hl.prototype.outputDefined=function(){return!1},hl.prototype.serialize=function(){var s=["length"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Vu={"==":ld,"!=":Nf,">":co,"<":Oh,">=":pp,"<=":Rh,array:ca,at:Il,boolean:ca,case:fl,coalesce:Pl,collator:pt,format:Eo,image:qo,in:cu,"index-of":cl,interpolate:hn,"interpolate-hcl":hn,"interpolate-lab":hn,length:hl,let:tu,literal:Ro,match:ru,number:ca,"number-format":Ls,object:ca,slice:Dl,step:go,string:ca,"to-boolean":Qo,"to-color":Qo,"to-number":Qo,"to-string":Qo,var:xu,within:Ra};function kl(s,u){var f=u[0],g=u[1],b=u[2],E=u[3];f=f.evaluate(s),g=g.evaluate(s),b=b.evaluate(s);var T=E?E.evaluate(s):1,R=il(f,g,b,T);if(R)throw new Oa(R);return new di(f/255*T,g/255*T,b/255*T,T)}function jf(s,u){return s in u}function Mc(s,u){var f=u[s];return f===void 0?null:f}function Su(s){return{type:s}}function of(s){return{result:"success",value:s}}function Fl(s){return{result:"error",value:s}}function pl(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Mh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function sf(s){return!!s.expression&&s.expression.interpolated}function Fa(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function zf(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function cd(s){return s}function Bl(s,u,f){return s!==void 0?s:u!==void 0?u:f!==void 0?f:void 0}function uf(s,u,f,g,b){return Bl(typeof f===b?g[f]:void 0,s.default,u.default)}function Ph(s,u,f){if(Fa(f)!=="number")return Bl(s.default,u.default);var g=s.stops.length;if(g===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[g-1][0])return s.stops[g-1][1];var b=af(s.stops.map(function(E){return E[0]}),f);return s.stops[b][1]}function Uf(s,u,f){var g=s.base!==void 0?s.base:1;if(Fa(f)!=="number")return Bl(s.default,u.default);var b=s.stops.length;if(b===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[b-1][0])return s.stops[b-1][1];var E=af(s.stops.map(function(te){return te[0]}),f),T=function(te,ne,Se,Ve){var Le=Ve-Se,ct=te-Se;return Le===0?0:ne===1?ct/Le:(Math.pow(ne,ct)-1)/(Math.pow(ne,Le)-1)}(f,g,s.stops[E][0],s.stops[E+1][0]),R=s.stops[E][1],j=s.stops[E+1][1],G=nc[u.type]||cd;if(s.colorSpace&&s.colorSpace!=="rgb"){var $=cr[s.colorSpace];G=function(ne,Se){return $.reverse($.interpolate($.forward(ne),$.forward(Se),T))}}return typeof R.evaluate=="function"?{evaluate:function(){for(var ne=[],Se=arguments.length;Se--;)ne[Se]=arguments[Se];var Ve=R.evaluate.apply(void 0,ne),Le=j.evaluate.apply(void 0,ne);if(Ve!==void 0&&Le!==void 0)return G(Ve,Le,T)}}:G(R,j,T)}function dl(s,u,f){return u.type==="color"?f=di.parse(f):u.type==="formatted"?f=wo.fromString(f.toString()):u.type==="resolvedImage"?f=Yo.fromString(f.toString()):Fa(f)===u.type||u.type==="enum"&&u.values[f]||(f=void 0),Bl(f,s.default,u.default)}qi.register(Vu,{error:[{kind:"error"},[Te],function(s,u){throw new Oa(u[0].evaluate(s))}],typeof:[Te,[vn],function(s,u){return zi(Ea(u[0].evaluate(s)))}],"to-rgba":[$i(ut,4),[yn],function(s,u){return u[0].evaluate(s).toArray()}],rgb:[yn,[ut,ut,ut],kl],rgba:[yn,[ut,ut,ut,ut],kl],has:{type:dn,overloads:[[[Te],function(s,u){return jf(u[0].evaluate(s),s.properties())}],[[Te,ci],function(s,u){var f=u[1];return jf(u[0].evaluate(s),f.evaluate(s))}]]},get:{type:vn,overloads:[[[Te],function(s,u){return Mc(u[0].evaluate(s),s.properties())}],[[Te,ci],function(s,u){var f=u[1];return Mc(u[0].evaluate(s),f.evaluate(s))}]]},"feature-state":[vn,[Te],function(s,u){return Mc(u[0].evaluate(s),s.featureState||{})}],properties:[ci,[],function(s){return s.properties()}],"geometry-type":[Te,[],function(s){return s.geometryType()}],id:[vn,[],function(s){return s.id()}],zoom:[ut,[],function(s){return s.globals.zoom}],"heatmap-density":[ut,[],function(s){return s.globals.heatmapDensity||0}],"line-progress":[ut,[],function(s){return s.globals.lineProgress||0}],accumulated:[vn,[],function(s){return s.globals.accumulated===void 0?null:s.globals.accumulated}],"+":[ut,Su(ut),function(s,u){for(var f=0,g=0,b=u;g<b.length;g+=1)f+=b[g].evaluate(s);return f}],"*":[ut,Su(ut),function(s,u){for(var f=1,g=0,b=u;g<b.length;g+=1)f*=b[g].evaluate(s);return f}],"-":{type:ut,overloads:[[[ut,ut],function(s,u){var f=u[1];return u[0].evaluate(s)-f.evaluate(s)}],[[ut],function(s,u){return-u[0].evaluate(s)}]]},"/":[ut,[ut,ut],function(s,u){var f=u[1];return u[0].evaluate(s)/f.evaluate(s)}],"%":[ut,[ut,ut],function(s,u){var f=u[1];return u[0].evaluate(s)%f.evaluate(s)}],ln2:[ut,[],function(){return Math.LN2}],pi:[ut,[],function(){return Math.PI}],e:[ut,[],function(){return Math.E}],"^":[ut,[ut,ut],function(s,u){var f=u[1];return Math.pow(u[0].evaluate(s),f.evaluate(s))}],sqrt:[ut,[ut],function(s,u){return Math.sqrt(u[0].evaluate(s))}],log10:[ut,[ut],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN10}],ln:[ut,[ut],function(s,u){return Math.log(u[0].evaluate(s))}],log2:[ut,[ut],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN2}],sin:[ut,[ut],function(s,u){return Math.sin(u[0].evaluate(s))}],cos:[ut,[ut],function(s,u){return Math.cos(u[0].evaluate(s))}],tan:[ut,[ut],function(s,u){return Math.tan(u[0].evaluate(s))}],asin:[ut,[ut],function(s,u){return Math.asin(u[0].evaluate(s))}],acos:[ut,[ut],function(s,u){return Math.acos(u[0].evaluate(s))}],atan:[ut,[ut],function(s,u){return Math.atan(u[0].evaluate(s))}],min:[ut,Su(ut),function(s,u){return Math.min.apply(Math,u.map(function(f){return f.evaluate(s)}))}],max:[ut,Su(ut),function(s,u){return Math.max.apply(Math,u.map(function(f){return f.evaluate(s)}))}],abs:[ut,[ut],function(s,u){return Math.abs(u[0].evaluate(s))}],round:[ut,[ut],function(s,u){var f=u[0].evaluate(s);return f<0?-Math.round(-f):Math.round(f)}],floor:[ut,[ut],function(s,u){return Math.floor(u[0].evaluate(s))}],ceil:[ut,[ut],function(s,u){return Math.ceil(u[0].evaluate(s))}],"filter-==":[dn,[Te,vn],function(s,u){var f=u[0],g=u[1];return s.properties()[f.value]===g.value}],"filter-id-==":[dn,[vn],function(s,u){var f=u[0];return s.id()===f.value}],"filter-type-==":[dn,[Te],function(s,u){var f=u[0];return s.geometryType()===f.value}],"filter-<":[dn,[Te,vn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],E=g.value;return typeof b==typeof E&&b<E}],"filter-id-<":[dn,[vn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g<b}],"filter->":[dn,[Te,vn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],E=g.value;return typeof b==typeof E&&b>E}],"filter-id->":[dn,[vn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g>b}],"filter-<=":[dn,[Te,vn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],E=g.value;return typeof b==typeof E&&b<=E}],"filter-id-<=":[dn,[vn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g<=b}],"filter->=":[dn,[Te,vn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],E=g.value;return typeof b==typeof E&&b>=E}],"filter-id->=":[dn,[vn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g>=b}],"filter-has":[dn,[vn],function(s,u){return u[0].value in s.properties()}],"filter-has-id":[dn,[],function(s){return s.id()!==null&&s.id()!==void 0}],"filter-type-in":[dn,[$i(Te)],function(s,u){return u[0].value.indexOf(s.geometryType())>=0}],"filter-id-in":[dn,[$i(vn)],function(s,u){return u[0].value.indexOf(s.id())>=0}],"filter-in-small":[dn,[Te,$i(vn)],function(s,u){var f=u[0];return u[1].value.indexOf(s.properties()[f.value])>=0}],"filter-in-large":[dn,[Te,$i(vn)],function(s,u){var f=u[0],g=u[1];return function(b,E,T,R){for(;T<=R;){var j=T+R>>1;if(E[j]===b)return!0;E[j]>b?R=j-1:T=j+1}return!1}(s.properties()[f.value],g.value,0,g.value.length-1)}],all:{type:dn,overloads:[[[dn,dn],function(s,u){var f=u[1];return u[0].evaluate(s)&&f.evaluate(s)}],[Su(dn),function(s,u){for(var f=0,g=u;f<g.length;f+=1)if(!g[f].evaluate(s))return!1;return!0}]]},any:{type:dn,overloads:[[[dn,dn],function(s,u){var f=u[1];return u[0].evaluate(s)||f.evaluate(s)}],[Su(dn),function(s,u){for(var f=0,g=u;f<g.length;f+=1)if(g[f].evaluate(s))return!0;return!1}]]},"!":[dn,[dn],function(s,u){return!u[0].evaluate(s)}],"is-supported-script":[dn,[Te],function(s,u){var f=s.globals&&s.globals.isSupportedScript;return!f||f(u[0].evaluate(s))}],upcase:[Te,[Te],function(s,u){return u[0].evaluate(s).toUpperCase()}],downcase:[Te,[Te],function(s,u){return u[0].evaluate(s).toLowerCase()}],concat:[Te,Su(vn),function(s,u){return u.map(function(f){return al(f.evaluate(s))}).join("")}],"resolved-locale":[Te,[Ai],function(s,u){return u[0].evaluate(s).resolvedLocale()}]});var Ll=function(u,f){this.expression=u,this._warningHistory={},this._evaluator=new oo,this._defaultValue=f?function(g){return g.type==="color"&&zf(g.default)?new di(0,0,0,0):g.type==="color"?di.parse(g.default)||null:g.default===void 0?null:g.default}(f):null,this._enumValues=f&&f.type==="enum"?f.values:null};function ac(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Vu}function Pc(s,u){var f=new ju(Vu,[],u?function(b){var E={color:yn,string:Te,number:ut,enum:Te,boolean:dn,formatted:Zi,resolvedImage:Bi};return b.type==="array"?$i(E[b.value]||vn,b.length):E[b.type]}(u):void 0),g=f.parse(s,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?of(new Ll(g,u)):Fl(f.errors)}Ll.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,E){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},Ll.prototype.evaluate=function(s,u,f,g,b,E){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Oa("Expected value to be one of "+Object.keys(this._enumValues).map(function(R){return JSON.stringify(R)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console!="undefined"&&console.warn(R.message)),this._defaultValue}};var oc=function(u,f){this.kind=u,this._styleExpression=f,this.isStateDependent=u!=="constant"&&!ll(f.expression)};oc.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,E){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,b,E)},oc.prototype.evaluate=function(s,u,f,g,b,E){return this._styleExpression.evaluate(s,u,f,g,b,E)};var fi=function(u,f,g,b){this.kind=u,this.zoomStops=g,this._styleExpression=f,this.isStateDependent=u!=="camera"&&!ll(f.expression),this.interpolationType=b};function Ih(s,u){if((s=Pc(s,u)).result==="error")return s;var f=s.value.expression,g=ul(f);if(!g&&!pl(u))return Fl([new De("","data expressions not supported")]);var b=lu(f,["zoom"]);if(!b&&!Mh(u))return Fl([new De("","zoom expressions not supported")]);var E=function T(R){var j=null;if(R instanceof tu)j=T(R.result);else if(R instanceof Pl)for(var G=0,$=R.args;G<$.length&&!(j=T($[G]));G+=1);else(R instanceof go||R instanceof hn)&&R.input instanceof qi&&R.input.name==="zoom"&&(j=R);return j instanceof De||R.eachChild(function(te){var ne=T(te);ne instanceof De?j=ne:!j&&ne?j=new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):j&&ne&&j!==ne&&(j=new De("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),j}(f);return E||b?E instanceof De?Fl([E]):E instanceof hn&&!sf(u)?Fl([new De("",'"interpolate" expressions cannot be used with this property')]):of(E?new fi(g?"camera":"composite",s.value,E.labels,E instanceof hn?E.interpolation:void 0):new oc(g?"constant":"source",s.value)):Fl([new De("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}fi.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,E){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,b,E)},fi.prototype.evaluate=function(s,u,f,g,b,E){return this._styleExpression.evaluate(s,u,f,g,b,E)},fi.prototype.interpolationFactor=function(s,u,f){return this.interpolationType?hn.interpolationFactor(this.interpolationType,s,u,f):0};var sc=function(u,f){this._parameters=u,this._specification=f,wr(this,function g(b,E){var T,R,j,G=E.type==="color",$=b.stops&&typeof b.stops[0][0]=="object",te=$||!($||b.property!==void 0),ne=b.type||(sf(E)?"exponential":"interval");if(G&&((b=wr({},b)).stops&&(b.stops=b.stops.map(function(zn){return[zn[0],di.parse(zn[1])]})),b.default=di.parse(b.default?b.default:E.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!cr[b.colorSpace])throw new Error("Unknown color space: "+b.colorSpace);if(ne==="exponential")T=Uf;else if(ne==="interval")T=Ph;else if(ne==="categorical"){T=uf,R=Object.create(null);for(var Se=0,Ve=b.stops;Se<Ve.length;Se+=1){var Le=Ve[Se];R[Le[0]]=Le[1]}j=typeof b.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');T=dl}if($){for(var ct={},ft=[],Rt=0;Rt<b.stops.length;Rt++){var Ht=b.stops[Rt],nr=Ht[0].zoom;ct[nr]===void 0&&(ct[nr]={zoom:nr,type:b.type,property:b.property,default:b.default,stops:[]},ft.push(nr)),ct[nr].stops.push([Ht[0].value,Ht[1]])}for(var Rr=[],gr=0,rn=ft;gr<rn.length;gr+=1){var on=rn[gr];Rr.push([ct[on].zoom,g(ct[on],E)])}var kn={name:"linear"};return{kind:"composite",interpolationType:kn,interpolationFactor:hn.interpolationFactor.bind(void 0,kn),zoomStops:Rr.map(function(zn){return zn[0]}),evaluate:function(Rn,yi){var Jn=Rn.zoom;return Uf({stops:Rr,base:b.base},E,Jn).evaluate(Jn,yi)}}}if(te){var Gn=ne==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:Gn,interpolationFactor:hn.interpolationFactor.bind(void 0,Gn),zoomStops:b.stops.map(function(zn){return zn[0]}),evaluate:function(Rn){return T(b,E,Rn.zoom,R,j)}}}return{kind:"source",evaluate:function(Rn,yi){var Jn=yi&&yi.properties?yi.properties[b.property]:void 0;return Jn===void 0?Bl(b.default,E.default):T(b,E,Jn,R,j)}}}(this._parameters,this._specification))};function Ws(s){var u=s.key,f=s.value,g=s.valueSpec||{},b=s.objectElementValidators||{},E=s.style,T=s.styleSpec,R=[],j=Fa(f);if(j!=="object")return[new Qe(u,f,"object expected, "+j+" found")];for(var G in f){var $=G.split(".")[0],te=g[$]||g["*"],ne=void 0;if(b[$])ne=b[$];else if(g[$])ne=Qi;else if(b["*"])ne=b["*"];else{if(!g["*"]){R.push(new Qe(u,f[G],'unknown property "'+G+'"'));continue}ne=Qi}R=R.concat(ne({key:(u&&u+".")+G,value:f[G],valueSpec:te,style:E,styleSpec:T,object:f,objectKey:G},f))}for(var Se in g)b[Se]||g[Se].required&&g[Se].default===void 0&&f[Se]===void 0&&R.push(new Qe(u,f,'missing required property "'+Se+'"'));return R}function lf(s){var u=s.value,f=s.valueSpec,g=s.style,b=s.styleSpec,E=s.key,T=s.arrayElementValidator||Qi;if(Fa(u)!=="array")return[new Qe(E,u,"array expected, "+Fa(u)+" found")];if(f.length&&u.length!==f.length)return[new Qe(E,u,"array length "+f.length+" expected, length "+u.length+" found")];if(f["min-length"]&&u.length<f["min-length"])return[new Qe(E,u,"array length at least "+f["min-length"]+" expected, length "+u.length+" found")];var R={type:f.value,values:f.values};b.$version<7&&(R.function=f.function),Fa(f.value)==="object"&&(R=f.value);for(var j=[],G=0;G<u.length;G++)j=j.concat(T({array:u,arrayIndex:G,value:u[G],valueSpec:R,style:g,styleSpec:b,key:E+"["+G+"]"}));return j}function Dh(s){var u=s.key,f=s.value,g=s.valueSpec,b=Fa(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new Qe(u,f,"number expected, "+b+" found")]:"minimum"in g&&f<g.minimum?[new Qe(u,f,f+" is less than the minimum value "+g.minimum)]:"maximum"in g&&f>g.maximum?[new Qe(u,f,f+" is greater than the maximum value "+g.maximum)]:[]}function kh(s){var u,f,g,b=s.valueSpec,E=Vr(s.value.type),T={},R=E!=="categorical"&&s.value.property===void 0,j=!R,G=Fa(s.value.stops)==="array"&&Fa(s.value.stops[0])==="array"&&Fa(s.value.stops[0][0])==="object",$=Ws({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Ve){if(E==="identity")return[new Qe(Ve.key,Ve.value,'identity function may not have a "stops" property')];var Le=[],ct=Ve.value;return Le=Le.concat(lf({key:Ve.key,value:ct,valueSpec:Ve.valueSpec,style:Ve.style,styleSpec:Ve.styleSpec,arrayElementValidator:te})),Fa(ct)==="array"&&ct.length===0&&Le.push(new Qe(Ve.key,ct,"array must have at least one stop")),Le},default:function(Ve){return Qi({key:Ve.key,value:Ve.value,valueSpec:b,style:Ve.style,styleSpec:Ve.styleSpec})}}});return E==="identity"&&R&&$.push(new Qe(s.key,s.value,'missing required property "property"')),E==="identity"||s.value.stops||$.push(new Qe(s.key,s.value,'missing required property "stops"')),E==="exponential"&&s.valueSpec.expression&&!sf(s.valueSpec)&&$.push(new Qe(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(j&&!pl(s.valueSpec)?$.push(new Qe(s.key,s.value,"property functions not supported")):R&&!Mh(s.valueSpec)&&$.push(new Qe(s.key,s.value,"zoom functions not supported"))),E!=="categorical"&&!G||s.value.property!==void 0||$.push(new Qe(s.key,s.value,'"property" property is required')),$;function te(Se){var Ve=[],Le=Se.value,ct=Se.key;if(Fa(Le)!=="array")return[new Qe(ct,Le,"array expected, "+Fa(Le)+" found")];if(Le.length!==2)return[new Qe(ct,Le,"array length 2 expected, length "+Le.length+" found")];if(G){if(Fa(Le[0])!=="object")return[new Qe(ct,Le,"object expected, "+Fa(Le[0])+" found")];if(Le[0].zoom===void 0)return[new Qe(ct,Le,"object stop key must have zoom")];if(Le[0].value===void 0)return[new Qe(ct,Le,"object stop key must have value")];if(g&&g>Vr(Le[0].zoom))return[new Qe(ct,Le[0].zoom,"stop zoom values must appear in ascending order")];Vr(Le[0].zoom)!==g&&(g=Vr(Le[0].zoom),f=void 0,T={}),Ve=Ve.concat(Ws({key:ct+"[0]",value:Le[0],valueSpec:{zoom:{}},style:Se.style,styleSpec:Se.styleSpec,objectElementValidators:{zoom:Dh,value:ne}}))}else Ve=Ve.concat(ne({key:ct+"[0]",value:Le[0],valueSpec:{},style:Se.style,styleSpec:Se.styleSpec},Le));return ac(pr(Le[1]))?Ve.concat([new Qe(ct+"[1]",Le[1],"expressions are not allowed in function stops.")]):Ve.concat(Qi({key:ct+"[1]",value:Le[1],valueSpec:b,style:Se.style,styleSpec:Se.styleSpec}))}function ne(Se,Ve){var Le=Fa(Se.value),ct=Vr(Se.value),ft=Se.value!==null?Se.value:Ve;if(u){if(Le!==u)return[new Qe(Se.key,ft,Le+" stop domain type must match previous stop domain type "+u)]}else u=Le;if(Le!=="number"&&Le!=="string"&&Le!=="boolean")return[new Qe(Se.key,ft,"stop domain value must be a number, string, or boolean")];if(Le!=="number"&&E!=="categorical"){var Rt="number expected, "+Le+" found";return pl(b)&&E===void 0&&(Rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qe(Se.key,ft,Rt)]}return E!=="categorical"||Le!=="number"||isFinite(ct)&&Math.floor(ct)===ct?E!=="categorical"&&Le==="number"&&f!==void 0&&ct<f?[new Qe(Se.key,ft,"stop domain values must appear in ascending order")]:(f=ct,E==="categorical"&&ct in T?[new Qe(Se.key,ft,"stop domain values must be unique")]:(T[ct]=!0,[])):[new Qe(Se.key,ft,"integer expected, found "+ct)]}}function Nl(s){var u=(s.expressionContext==="property"?Ih:Pc)(pr(s.value),s.valueSpec);if(u.result==="error")return u.value.map(function(g){return new Qe(""+s.key+g.key,s.value,g.message)});var f=u.value.expression||u.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!f.outputDefined())return[new Qe(s.key,s.value,'Invalid data expression for "'+s.propertyKey+'". Output values must be contained as literals within the expression.')];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ll(f))return[new Qe(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!ll(f))return[new Qe(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!lu(f,["zoom","feature-state"]))return[new Qe(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!ul(f))return[new Qe(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hu(s){var u=s.key,f=s.value,g=s.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(Vr(f))===-1&&b.push(new Qe(u,f,"expected one of ["+g.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(g.values).indexOf(Vr(f))===-1&&b.push(new Qe(u,f,"expected one of ["+Object.keys(g.values).join(", ")+"], "+JSON.stringify(f)+" found")),b}function Ic(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(var u=0,f=s.slice(1);u<f.length;u+=1){var g=f[u];if(!Ic(g)&&typeof g!="boolean")return!1}return!0;default:return!0}}sc.deserialize=function(s){return new sc(s._parameters,s._specification)},sc.serialize=function(s){return{_parameters:s._parameters,_specification:s._specification}};var Dc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Wu(s){if(s==null)return{filter:function(){return!0},needGeometry:!1};Ic(s)||(s=Hf(s));var u=Pc(s,Dc);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return{filter:function(g,b,E){return u.value.evaluate(g,b,{},E)},needGeometry:function f(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(var b=1;b<g.length;b++)if(f(g[b]))return!0;return!1}(s)}}function Vf(s,u){return s<u?-1:s>u?1:0}function Hf(s){if(!s)return!0;var u,f=s[0];return s.length<=1?f!=="any":f==="=="?Fh(s[1],s[2],"=="):f==="!="?Gf(Fh(s[1],s[2],"==")):f==="<"||f===">"||f==="<="||f===">="?Fh(s[1],s[2],f):f==="any"?(u=s.slice(1),["any"].concat(u.map(Hf))):f==="all"?["all"].concat(s.slice(1).map(Hf)):f==="none"?["all"].concat(s.slice(1).map(Hf).map(Gf)):f==="in"?Wf(s[1],s.slice(2)):f==="!in"?Gf(Wf(s[1],s.slice(2))):f==="has"?dp(s[1]):f==="!has"?Gf(dp(s[1])):f!=="within"||s}function Fh(s,u,f){switch(s){case"$type":return["filter-type-"+f,u];case"$id":return["filter-id-"+f,u];default:return["filter-"+f,s,u]}}function Wf(s,u){if(u.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(f){return typeof f!=typeof u[0]})?["filter-in-large",s,["literal",u.sort(Vf)]]:["filter-in-small",s,["literal",u]]}}function dp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Gf(s){return["!",s]}function Xf(s){return Ic(pr(s.value))?Nl(wr({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(f){var g=f.value,b=f.key;if(Fa(g)!=="array")return[new Qe(b,g,"array expected, "+Fa(g)+" found")];var E,T=f.styleSpec,R=[];if(g.length<1)return[new Qe(b,g,"filter array must have at least 1 element")];switch(R=R.concat(Hu({key:b+"[0]",value:g[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),Vr(g[0])){case"<":case"<=":case">":case">=":g.length>=2&&Vr(g[1])==="$type"&&R.push(new Qe(b,g,'"$type" cannot be use with operator "'+g[0]+'"'));case"==":case"!=":g.length!==3&&R.push(new Qe(b,g,'filter array for operator "'+g[0]+'" must have 3 elements'));case"in":case"!in":g.length>=2&&(E=Fa(g[1]))!=="string"&&R.push(new Qe(b+"[1]",g[1],"string expected, "+E+" found"));for(var j=2;j<g.length;j++)E=Fa(g[j]),Vr(g[1])==="$type"?R=R.concat(Hu({key:b+"["+j+"]",value:g[j],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&R.push(new Qe(b+"["+j+"]",g[j],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var G=1;G<g.length;G++)R=R.concat(u({key:b+"["+G+"]",value:g[G],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":E=Fa(g[1]),g.length!==2?R.push(new Qe(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):E!=="string"&&R.push(new Qe(b+"[1]",g[1],"string expected, "+E+" found"));break;case"within":E=Fa(g[1]),g.length!==2?R.push(new Qe(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):E!=="object"&&R.push(new Qe(b+"[1]",g[1],"object expected, "+E+" found"))}return R}(s)}function cf(s,u){var f=s.key,g=s.style,b=s.styleSpec,E=s.value,T=s.objectKey,R=b[u+"_"+s.layerType];if(!R)return[];var j=T.match(/^(.*)-transition$/);if(u==="paint"&&j&&R[j[1]]&&R[j[1]].transition)return Qi({key:f,value:E,valueSpec:b.transition,style:g,styleSpec:b});var G,$=s.valueSpec||R[T];if(!$)return[new Qe(f,E,'unknown property "'+T+'"')];if(Fa(E)==="string"&&pl($)&&!$.tokens&&(G=/^{([^}]+)}$/.exec(E)))return[new Qe(f,E,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(G[1])+" }`.")];var te=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&te.push(new Qe(f,E,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&zf(pr(E))&&Vr(E.type)==="identity"&&te.push(new Qe(f,E,'"text-font" does not support identity functions'))),te.concat(Qi({key:s.key,value:E,valueSpec:$,style:g,styleSpec:b,expressionContext:"property",propertyType:u,propertyKey:T}))}function Bh(s){return cf(s,"paint")}function vl(s){return cf(s,"layout")}function Lh(s){var u=[],f=s.value,g=s.key,b=s.style,E=s.styleSpec;f.type||f.ref||u.push(new Qe(g,f,'either "type" or "ref" is required'));var T,R=Vr(f.type),j=Vr(f.ref);if(f.id)for(var G=Vr(f.id),$=0;$<s.arrayIndex;$++){var te=b.layers[$];Vr(te.id)===G&&u.push(new Qe(g,f.id,'duplicate layer id "'+f.id+'", previously used at line '+te.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in f&&u.push(new Qe(g,f[Ve],'"'+Ve+'" is prohibited for ref layers'))}),b.layers.forEach(function(Ve){Vr(Ve.id)===j&&(T=Ve)}),T?T.ref?u.push(new Qe(g,f.ref,"ref cannot reference another ref layer")):R=Vr(T.type):u.push(new Qe(g,f.ref,'ref layer "'+j+'" not found'));else if(R!=="background")if(f.source){var ne=b.sources&&b.sources[f.source],Se=ne&&Vr(ne.type);ne?Se==="vector"&&R==="raster"?u.push(new Qe(g,f.source,'layer "'+f.id+'" requires a raster source')):Se==="raster"&&R!=="raster"?u.push(new Qe(g,f.source,'layer "'+f.id+'" requires a vector source')):Se!=="vector"||f["source-layer"]?Se==="raster-dem"&&R!=="hillshade"?u.push(new Qe(g,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!f.paint||!f.paint["line-gradient"]||Se==="geojson"&&ne.lineMetrics||u.push(new Qe(g,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Qe(g,f,'layer "'+f.id+'" must specify a "source-layer"')):u.push(new Qe(g,f.source,'source "'+f.source+'" not found'))}else u.push(new Qe(g,f,'missing required property "source"'));return u=u.concat(Ws({key:g,value:f,valueSpec:E.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Qi({key:g+".type",value:f.type,valueSpec:E.layer.type,style:s.style,styleSpec:s.styleSpec,object:f,objectKey:"type"})},filter:Xf,layout:function(Le){return Ws({layer:f,key:Le.key,value:Le.value,style:Le.style,styleSpec:Le.styleSpec,objectElementValidators:{"*":function(ft){return vl(wr({layerType:R},ft))}}})},paint:function(Le){return Ws({layer:f,key:Le.key,value:Le.value,style:Le.style,styleSpec:Le.styleSpec,objectElementValidators:{"*":function(ft){return Bh(wr({layerType:R},ft))}}})}}}))}function jl(s){var u=s.value,f=s.key,g=Fa(u);return g!=="string"?[new Qe(f,u,"string expected, "+g+" found")]:[]}var Ba={promoteId:function(u){var f=u.key,g=u.value;if(Fa(g)==="string")return jl({key:f,value:g});var b=[];for(var E in g)b.push.apply(b,jl({key:f+"."+E,value:g[E]}));return b}};function Zf(s){var u=s.value,f=s.key,g=s.styleSpec,b=s.style;if(!u.type)return[new Qe(f,u,'"type" is required')];var E,T=Vr(u.type);switch(T){case"vector":case"raster":case"raster-dem":return Ws({key:f,value:u,valueSpec:g["source_"+T.replace("-","_")],style:s.style,styleSpec:g,objectElementValidators:Ba});case"geojson":if(E=Ws({key:f,value:u,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:Ba}),u.cluster)for(var R in u.clusterProperties){var j=u.clusterProperties[R],G=j[0],$=typeof G=="string"?[G,["accumulated"],["get",R]]:G;E.push.apply(E,Nl({key:f+"."+R+".map",value:j[1],expressionContext:"cluster-map"})),E.push.apply(E,Nl({key:f+"."+R+".reduce",value:$,expressionContext:"cluster-reduce"}))}return E;case"video":return Ws({key:f,value:u,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return Ws({key:f,value:u,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new Qe(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Hu({key:f+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:g})}}function Gu(s){var u=s.value,f=s.styleSpec,g=f.light,b=s.style,E=[],T=Fa(u);if(u===void 0)return E;if(T!=="object")return E.concat([new Qe("light",u,"object expected, "+T+" found")]);for(var R in u){var j=R.match(/^(.*)-transition$/);E=E.concat(j&&g[j[1]]&&g[j[1]].transition?Qi({key:R,value:u[R],valueSpec:f.transition,style:b,styleSpec:f}):g[R]?Qi({key:R,value:u[R],valueSpec:g[R],style:b,styleSpec:f}):[new Qe(R,u[R],'unknown property "'+R+'"')])}return E}var zl={"*":function(){return[]},array:lf,boolean:function(u){var f=u.value,g=u.key,b=Fa(f);return b!=="boolean"?[new Qe(g,f,"boolean expected, "+b+" found")]:[]},number:Dh,color:function(u){var f=u.key,g=u.value,b=Fa(g);return b!=="string"?[new Qe(f,g,"color expected, "+b+" found")]:Ni(g)===null?[new Qe(f,g,'color expected, "'+g+'" found')]:[]},constants:Nt,enum:Hu,filter:Xf,function:kh,layer:Lh,object:Ws,source:Zf,light:Gu,string:jl,formatted:function(u){return jl(u).length===0?[]:Nl(u)},resolvedImage:function(u){return jl(u).length===0?[]:Nl(u)}};function Qi(s){var u=s.value,f=s.valueSpec,g=s.styleSpec;return f.expression&&zf(Vr(u))?kh(s):f.expression&&ac(pr(u))?Nl(s):f.type&&zl[f.type]?zl[f.type](s):Ws(wr({},s,{valueSpec:f.type?g[f.type]:f}))}function La(s){var u=s.value,f=s.key,g=jl(s);return g.length||(u.indexOf("{fontstack}")===-1&&g.push(new Qe(f,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&g.push(new Qe(f,u,'"glyphs" url must include a "{range}" token'))),g}function Ns(s,u){u===void 0&&(u=xe);var f=[];return f=f.concat(Qi({key:"",value:s,valueSpec:u.$root,styleSpec:u,style:s,objectElementValidators:{glyphs:La,"*":function(){return[]}}})),s.constants&&(f=f.concat(Nt({key:"constants",value:s.constants,style:s,styleSpec:u}))),ff(f)}function ff(s){return[].concat(s).sort(function(u,f){return u.line-f.line})}function kc(s){return function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return ff(s.apply(this,u))}}Ns.source=kc(Zf),Ns.light=kc(Gu),Ns.layer=kc(Lh),Ns.filter=kc(Xf),Ns.paintProperty=kc(Bh),Ns.layoutProperty=kc(vl);var $f=Ns,hf=$f.light,Nh=$f.paintProperty,Yf=$f.layoutProperty;function Ul(s,u){var f=!1;if(u&&u.length)for(var g=0,b=u;g<b.length;g+=1)s.fire(new mt(new Error(b[g].message))),f=!0;return f}var V=Va;function Va(s,u,f){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var b=new Int32Array(this.arrayBuffer);s=b[0],this.d=(u=b[1])+2*(f=b[2]);for(var E=0;E<this.d*this.d;E++){var T=b[3+E],R=b[3+E+1];g.push(T===R?null:b.subarray(T,R))}var j=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],j),this.bboxes=b.subarray(j),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var G=0;G<this.d*this.d;G++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;var $=f/u*s;this.min=-$,this.max=s+$}Va.prototype.insert=function(s,u,f,g,b){this._forEachCell(u,f,g,b,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b)},Va.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Va.prototype._insertCell=function(s,u,f,g,b,E){this.cells[b].push(E)},Va.prototype.query=function(s,u,f,g,b){var E=this.min,T=this.max;if(s<=E&&u<=E&&T<=f&&T<=g&&!b)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(s,u,f,g,this._queryCell,R,{},b),R},Va.prototype._queryCell=function(s,u,f,g,b,E,T,R){var j=this.cells[b];if(j!==null)for(var G=this.keys,$=this.bboxes,te=0;te<j.length;te++){var ne=j[te];if(T[ne]===void 0){var Se=4*ne;(R?R($[Se+0],$[Se+1],$[Se+2],$[Se+3]):s<=$[Se+2]&&u<=$[Se+3]&&f>=$[Se+0]&&g>=$[Se+1])?(T[ne]=!0,E.push(G[ne])):T[ne]=!1}}},Va.prototype._forEachCell=function(s,u,f,g,b,E,T,R){for(var j=this._convertToCellCoord(s),G=this._convertToCellCoord(u),$=this._convertToCellCoord(f),te=this._convertToCellCoord(g),ne=j;ne<=$;ne++)for(var Se=G;Se<=te;Se++){var Ve=this.d*Se+ne;if((!R||R(this._convertFromCellCoord(ne),this._convertFromCellCoord(Se),this._convertFromCellCoord(ne+1),this._convertFromCellCoord(Se+1)))&&b.call(this,s,u,f,g,Ve,E,T,R))return}},Va.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},Va.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},Va.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=3+this.cells.length+1+1,f=0,g=0;g<this.cells.length;g++)f+=this.cells[g].length;var b=new Int32Array(u+f+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var E=u,T=0;T<s.length;T++){var R=s[T];b[3+T]=E,b.set(R,E),E+=R.length}return b[3+s.length]=E,b.set(this.keys,E),b[3+s.length+1]=E+=this.keys.length,b.set(this.bboxes,E),E+=this.bboxes.length,b.buffer};var pf=ue.ImageData,df=ue.ImageBitmap,yo={};function On(s,u,f){f===void 0&&(f={}),Object.defineProperty(u,"_classRegistryKey",{value:s,writeable:!1}),yo[s]={klass:u,omit:f.omit||[],shallow:f.shallow||[]}}for(var ss in On("Object",Object),V.serialize=function(s,u){var f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}},V.deserialize=function(s){return new V(s.buffer)},On("Grid",V),On("Color",di),On("Error",Error),On("ResolvedImage",Yo),On("StylePropertyFunction",sc),On("StyleExpression",Ll,{omit:["_evaluator"]}),On("ZoomDependentExpression",fi),On("ZoomConstantExpression",oc),On("CompoundExpression",qi,{omit:["_evaluate"]}),Vu)Vu[ss]._classRegistryKey||On("Expression_"+ss,Vu[ss]);function vf(s){return s&&typeof ArrayBuffer!="undefined"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Fc(s){return df&&s instanceof df}function ms(s,u){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(vf(s)||Fc(s))return u&&u.push(s),s;if(ArrayBuffer.isView(s)){var f=s;return u&&u.push(f.buffer),f}if(s instanceof pf)return u&&u.push(s.data.buffer),s;if(Array.isArray(s)){for(var g=[],b=0,E=s;b<E.length;b+=1)g.push(ms(E[b],u));return g}if(typeof s=="object"){var T=s.constructor,R=T._classRegistryKey;if(!R)throw new Error("can't serialize object of unregistered class");var j=T.serialize?T.serialize(s,u):{};if(!T.serialize){for(var G in s)if(s.hasOwnProperty(G)&&!(yo[R].omit.indexOf(G)>=0)){var $=s[G];j[G]=yo[R].shallow.indexOf(G)>=0?$:ms($,u)}s instanceof Error&&(j.message=s.message)}if(j.$name)throw new Error("$name property is reserved for worker serialization logic.");return R!=="Object"&&(j.$name=R),j}throw new Error("can't serialize object of type "+typeof s)}function Ma(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||vf(s)||Fc(s)||ArrayBuffer.isView(s)||s instanceof pf)return s;if(Array.isArray(s))return s.map(Ma);if(typeof s=="object"){var u=s.$name||"Object",f=yo[u].klass;if(!f)throw new Error("can't deserialize unregistered class "+u);if(f.deserialize)return f.deserialize(s);for(var g=Object.create(f.prototype),b=0,E=Object.keys(s);b<E.length;b+=1){var T=E[b];if(T!=="$name"){var R=s[T];g[T]=yo[u].shallow.indexOf(T)>=0?R:Ma(R)}}return g}throw new Error("can't deserialize object of type "+typeof s)}var mf=function(){this.first=!0};mf.prototype.update=function(s,u){var f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))};var cn={"Latin-1 Supplement":function(u){return u>=128&&u<=255},Arabic:function(u){return u>=1536&&u<=1791},"Arabic Supplement":function(u){return u>=1872&&u<=1919},"Arabic Extended-A":function(u){return u>=2208&&u<=2303},"Hangul Jamo":function(u){return u>=4352&&u<=4607},"Unified Canadian Aboriginal Syllabics":function(u){return u>=5120&&u<=5759},Khmer:function(u){return u>=6016&&u<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(u){return u>=6320&&u<=6399},"General Punctuation":function(u){return u>=8192&&u<=8303},"Letterlike Symbols":function(u){return u>=8448&&u<=8527},"Number Forms":function(u){return u>=8528&&u<=8591},"Miscellaneous Technical":function(u){return u>=8960&&u<=9215},"Control Pictures":function(u){return u>=9216&&u<=9279},"Optical Character Recognition":function(u){return u>=9280&&u<=9311},"Enclosed Alphanumerics":function(u){return u>=9312&&u<=9471},"Geometric Shapes":function(u){return u>=9632&&u<=9727},"Miscellaneous Symbols":function(u){return u>=9728&&u<=9983},"Miscellaneous Symbols and Arrows":function(u){return u>=11008&&u<=11263},"CJK Radicals Supplement":function(u){return u>=11904&&u<=12031},"Kangxi Radicals":function(u){return u>=12032&&u<=12255},"Ideographic Description Characters":function(u){return u>=12272&&u<=12287},"CJK Symbols and Punctuation":function(u){return u>=12288&&u<=12351},Hiragana:function(u){return u>=12352&&u<=12447},Katakana:function(u){return u>=12448&&u<=12543},Bopomofo:function(u){return u>=12544&&u<=12591},"Hangul Compatibility Jamo":function(u){return u>=12592&&u<=12687},Kanbun:function(u){return u>=12688&&u<=12703},"Bopomofo Extended":function(u){return u>=12704&&u<=12735},"CJK Strokes":function(u){return u>=12736&&u<=12783},"Katakana Phonetic Extensions":function(u){return u>=12784&&u<=12799},"Enclosed CJK Letters and Months":function(u){return u>=12800&&u<=13055},"CJK Compatibility":function(u){return u>=13056&&u<=13311},"CJK Unified Ideographs Extension A":function(u){return u>=13312&&u<=19903},"Yijing Hexagram Symbols":function(u){return u>=19904&&u<=19967},"CJK Unified Ideographs":function(u){return u>=19968&&u<=40959},"Yi Syllables":function(u){return u>=40960&&u<=42127},"Yi Radicals":function(u){return u>=42128&&u<=42191},"Hangul Jamo Extended-A":function(u){return u>=43360&&u<=43391},"Hangul Syllables":function(u){return u>=44032&&u<=55215},"Hangul Jamo Extended-B":function(u){return u>=55216&&u<=55295},"Private Use Area":function(u){return u>=57344&&u<=63743},"CJK Compatibility Ideographs":function(u){return u>=63744&&u<=64255},"Arabic Presentation Forms-A":function(u){return u>=64336&&u<=65023},"Vertical Forms":function(u){return u>=65040&&u<=65055},"CJK Compatibility Forms":function(u){return u>=65072&&u<=65103},"Small Form Variants":function(u){return u>=65104&&u<=65135},"Arabic Presentation Forms-B":function(u){return u>=65136&&u<=65279},"Halfwidth and Fullwidth Forms":function(u){return u>=65280&&u<=65519}};function Vl(s){for(var u=0,f=s;u<f.length;u+=1)if(gf(f[u].charCodeAt(0)))return!0;return!1}function gf(s){return!(s!==746&&s!==747&&(s<4352||!(cn["Bopomofo Extended"](s)||cn.Bopomofo(s)||cn["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||cn["CJK Compatibility Ideographs"](s)||cn["CJK Compatibility"](s)||cn["CJK Radicals Supplement"](s)||cn["CJK Strokes"](s)||!(!cn["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||cn["CJK Unified Ideographs Extension A"](s)||cn["CJK Unified Ideographs"](s)||cn["Enclosed CJK Letters and Months"](s)||cn["Hangul Compatibility Jamo"](s)||cn["Hangul Jamo Extended-A"](s)||cn["Hangul Jamo Extended-B"](s)||cn["Hangul Jamo"](s)||cn["Hangul Syllables"](s)||cn.Hiragana(s)||cn["Ideographic Description Characters"](s)||cn.Kanbun(s)||cn["Kangxi Radicals"](s)||cn["Katakana Phonetic Extensions"](s)||cn.Katakana(s)&&s!==12540||!(!cn["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!cn["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||cn["Unified Canadian Aboriginal Syllabics"](s)||cn["Unified Canadian Aboriginal Syllabics Extended"](s)||cn["Vertical Forms"](s)||cn["Yijing Hexagram Symbols"](s)||cn["Yi Syllables"](s)||cn["Yi Radicals"](s))))}function Kf(s){return!(gf(s)||function(u){return!!(cn["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||cn["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||cn["Letterlike Symbols"](u)||cn["Number Forms"](u)||cn["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||cn["Control Pictures"](u)&&u!==9251||cn["Optical Character Recognition"](u)||cn["Enclosed Alphanumerics"](u)||cn["Geometric Shapes"](u)||cn["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||cn["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||cn["CJK Symbols and Punctuation"](u)||cn.Katakana(u)||cn["Private Use Area"](u)||cn["CJK Compatibility Forms"](u)||cn["Small Form Variants"](u)||cn["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(s))}function fu(s){return s>=1424&&s<=2303||cn["Arabic Presentation Forms-A"](s)||cn["Arabic Presentation Forms-B"](s)}function Sa(s,u){return!(!u&&fu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||cn.Khmer(s))}function jh(s){for(var u=0,f=s;u<f.length;u+=1)if(fu(f[u].charCodeAt(0)))return!0;return!1}var yf=null,ws="unavailable",Xu=null,fd=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(ws="error"),yf&&yf(u)};function Zu(){Bc.fire(new ze("pluginStateChange",{pluginStatus:ws,pluginURL:Xu}))}var Bc=new Tt,Lc=function(){return ws},Gs=function(){if(ws!=="deferred"||!Xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws="loading",Zu(),Xu&&as({url:Xu},function(u){u?fd(u):(ws="loaded",Zu())})},js={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ws==="loaded"||js.applyArabicShaping!=null},isLoading:function(){return ws==="loading"},setState:function(u){ws=u.pluginStatus,Xu=u.pluginURL},isParsed:function(){return js.applyArabicShaping!=null&&js.processBidirectionalText!=null&&js.processStyledBidirectionalText!=null},getPluginURL:function(){return Xu}},Ti=function(u,f){this.zoom=u,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mf,this.transition={})};Ti.prototype.isSupportedScript=function(s){return function(u,f){for(var g=0,b=u;g<b.length;g+=1)if(!Sa(b[g].charCodeAt(0),f))return!1;return!0}(s,js.isLoaded())},Ti.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ti.prototype.getCrossfadeParameters=function(){var s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}};var Xs=function(u,f){this.property=u,this.value=f,this.expression=function(g,b){if(zf(g))return new sc(g,b);if(ac(g)){var E=Ih(g,b);if(E.result==="error")throw new Error(E.value.map(function(R){return R.key+": "+R.message}).join(", "));return E.value}var T=g;return typeof g=="string"&&b.type==="color"&&(T=di.parse(g)),{kind:"constant",evaluate:function(){return T}}}(f===void 0?u.specification.default:f,u.specification)};Xs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Xs.prototype.possiblyEvaluate=function(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)};var hu=function(u){this.property=u,this.value=new Xs(u,void 0)};hu.prototype.transitioned=function(s,u){return new uc(this.property,this.value,u,We({},s.transition,this.transition),s.now)},hu.prototype.untransitioned=function(){return new uc(this.property,this.value,null,{},0)};var Jo=function(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)};Jo.prototype.getValue=function(s){return He(this._values[s].value.value)},Jo.prototype.setValue=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new hu(this._values[s].property)),this._values[s].value=new Xs(this._values[s].property,u===null?void 0:He(u))},Jo.prototype.getTransition=function(s){return He(this._values[s].transition)},Jo.prototype.setTransition=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new hu(this._values[s].property)),this._values[s].transition=He(u)||void 0},Jo.prototype.serialize=function(){for(var s={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u],b=this.getValue(g);b!==void 0&&(s[g]=b);var E=this.getTransition(g);E!==void 0&&(s[g+"-transition"]=E)}return s},Jo.prototype.transitioned=function(s,u){for(var f=new gs(this._properties),g=0,b=Object.keys(this._values);g<b.length;g+=1){var E=b[g];f._values[E]=this._values[E].transitioned(s,u._values[E])}return f},Jo.prototype.untransitioned=function(){for(var s=new gs(this._properties),u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u];s._values[g]=this._values[g].untransitioned()}return s};var uc=function(u,f,g,b,E){this.property=u,this.value=f,this.begin=E+b.delay||0,this.end=this.begin+b.duration||0,u.specification.transition&&(b.delay||b.duration)&&(this.prior=g)};uc.prototype.possiblyEvaluate=function(s,u,f){var g=s.now||0,b=this.value.possiblyEvaluate(s,u,f),E=this.prior;if(E){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return E.possiblyEvaluate(s,u,f);var T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(s,u,f),b,function(R){if(R<=0)return 0;if(R>=1)return 1;var j=R*R,G=j*R;return 4*(R<.5?G:3*(R-j)+G-.75)}(T))}return b};var gs=function(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)};gs.prototype.possiblyEvaluate=function(s,u,f){for(var g=new _f(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];g._values[T]=this._values[T].possiblyEvaluate(s,u,f)}return g},gs.prototype.hasTransition=function(){for(var s=0,u=Object.keys(this._values);s<u.length;s+=1)if(this._values[u[s]].prior)return!0;return!1};var pu=function(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)};pu.prototype.getValue=function(s){return He(this._values[s].value)},pu.prototype.setValue=function(s,u){this._values[s]=new Xs(this._values[s].property,u===null?void 0:He(u))},pu.prototype.serialize=function(){for(var s={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u],b=this.getValue(g);b!==void 0&&(s[g]=b)}return s},pu.prototype.possiblyEvaluate=function(s,u,f){for(var g=new _f(this._properties),b=0,E=Object.keys(this._values);b<E.length;b+=1){var T=E[b];g._values[T]=this._values[T].possiblyEvaluate(s,u,f)}return g};var ys=function(u,f,g){this.property=u,this.value=f,this.parameters=g};ys.prototype.isConstant=function(){return this.value.kind==="constant"},ys.prototype.constantOr=function(s){return this.value.kind==="constant"?this.value.value:s},ys.prototype.evaluate=function(s,u,f,g){return this.property.evaluate(this.value,this.parameters,s,u,f,g)};var _f=function(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)};_f.prototype.get=function(s){return this._values[s]};var qn=function(u){this.specification=u};qn.prototype.possiblyEvaluate=function(s,u){return s.expression.evaluate(u)},qn.prototype.interpolate=function(s,u,f){var g=nc[this.specification.type];return g?g(s,u,f):s};var Fn=function(u,f){this.specification=u,this.overrides=f};Fn.prototype.possiblyEvaluate=function(s,u,f,g){return new ys(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,g)}:s.expression,u)},Fn.prototype.interpolate=function(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new ys(this,{kind:"constant",value:void 0},s.parameters);var g=nc[this.specification.type];return g?new ys(this,{kind:"constant",value:g(s.value.value,u.value.value,f)},s.parameters):s},Fn.prototype.evaluate=function(s,u,f,g,b,E){return s.kind==="constant"?s.value:s.evaluate(u,f,g,b,E)};var Zs=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,g,b,E){if(f.value===void 0)return new ys(this,{kind:"constant",value:void 0},g);if(f.expression.kind==="constant"){var T=f.expression.evaluate(g,null,{},b,E),R=f.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,j=this._calculate(R,R,R,g);return new ys(this,{kind:"constant",value:j},g)}if(f.expression.kind==="camera"){var G=this._calculate(f.expression.evaluate({zoom:g.zoom-1}),f.expression.evaluate({zoom:g.zoom}),f.expression.evaluate({zoom:g.zoom+1}),g);return new ys(this,{kind:"constant",value:G},g)}return new ys(this,f.expression,g)},u.prototype.evaluate=function(f,g,b,E,T,R){if(f.kind==="source"){var j=f.evaluate(g,b,E,T,R);return this._calculate(j,j,j,g)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(g.zoom)-1},b,E),f.evaluate({zoom:Math.floor(g.zoom)},b,E),f.evaluate({zoom:Math.floor(g.zoom)+1},b,E),g):f.value},u.prototype._calculate=function(f,g,b,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:f,to:g}:{from:b,to:g}},u.prototype.interpolate=function(f){return f},u}(Fn),us=function(u){this.specification=u};us.prototype.possiblyEvaluate=function(s,u,f,g){if(s.value!==void 0){if(s.expression.kind==="constant"){var b=s.expression.evaluate(u,null,{},f,g);return this._calculate(b,b,b,u)}return this._calculate(s.expression.evaluate(new Ti(Math.floor(u.zoom-1),u)),s.expression.evaluate(new Ti(Math.floor(u.zoom),u)),s.expression.evaluate(new Ti(Math.floor(u.zoom+1),u)),u)}},us.prototype._calculate=function(s,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}},us.prototype.interpolate=function(s){return s};var $s=function(u){this.specification=u};$s.prototype.possiblyEvaluate=function(s,u,f,g){return!!s.expression.evaluate(u,null,{},f,g)},$s.prototype.interpolate=function(){return!1};var Za=function(u){for(var f in this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],u){var g=u[f];g.specification.overridable&&this.overridableProperties.push(f);var b=this.defaultPropertyValues[f]=new Xs(g,void 0),E=this.defaultTransitionablePropertyValues[f]=new hu(g);this.defaultTransitioningPropertyValues[f]=E.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}};On("DataDrivenProperty",Fn),On("DataConstantProperty",qn),On("CrossFadedDataDrivenProperty",Zs),On("CrossFadedProperty",us),On("ColorRampProperty",$s);var nu=function(s){function u(f,g){if(s.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),g.layout&&(this._unevaluatedLayout=new pu(g.layout)),g.paint)){for(var b in this._transitionablePaint=new Jo(g.paint),f.paint)this.setPaintProperty(b,f.paint[b],{validate:!1});for(var E in f.layout)this.setLayoutProperty(E,f.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _f(g.paint)}}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},u.prototype.setLayoutProperty=function(f,g,b){b===void 0&&(b={}),g!=null&&this._validate(Yf,"layers."+this.id+".layout."+f,f,g,b)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,g):this.visibility=g)},u.prototype.getPaintProperty=function(f){return Dr(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-"-transition".length)):this._transitionablePaint.getValue(f)},u.prototype.setPaintProperty=function(f,g,b){if(b===void 0&&(b={}),g!=null&&this._validate(Nh,"layers."+this.id+".paint."+f,f,g,b))return!1;if(Dr(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-"-transition".length),g||void 0),!1;var E=this._transitionablePaint._values[f],T=E.property.specification["property-type"]==="cross-faded-data-driven",R=E.value.isDataDriven(),j=E.value;this._transitionablePaint.setValue(f,g),this._handleSpecialPaintPropertyUpdate(f);var G=this._transitionablePaint._values[f].value;return G.isDataDriven()||R||T||this._handleOverridablePaintPropertyUpdate(f,j,G)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){},u.prototype._handleOverridablePaintPropertyUpdate=function(f,g,b){return!1},u.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(f,g){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,g)},u.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),jt(f,function(g,b){return!(g===void 0||b==="layout"&&!Object.keys(g).length||b==="paint"&&!Object.keys(g).length)})},u.prototype._validate=function(f,g,b,E,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Ul(this,f.call($f,{key:g,layerType:this.type,objectKey:b,value:E,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var f in this.paint._values){var g=this.paint.get(f);if(g instanceof ys&&pl(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1},u}(Tt),$u={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},lc=function(u,f){this._structArray=u,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},fa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Mo(s,u){u===void 0&&(u=1);var f=0,g=0;return{members:s.map(function(b){var E=$u[b.type].BYTES_PER_ELEMENT,T=f=zh(f,Math.max(u,E)),R=b.components||1;return g=Math.max(g,E),f+=E*R,{name:b.name,type:b.type,components:R,offset:T}}),size:zh(f,Math.max(g,u)),alignment:u}}function zh(s,u){return Math.ceil(s/u)*u}fa.serialize=function(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}},fa.deserialize=function(s){var u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},fa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},fa.prototype.clear=function(){this.length=0},fa.prototype.resize=function(s){this.reserve(s),this.length=s},fa.prototype.reserve=function(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},fa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Hl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var E=2*f;return this.int16[E+0]=g,this.int16[E+1]=b,f},u}(fa);Hl.prototype.bytesPerElement=4,On("StructArrayLayout2i4",Hl);var qf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,E)},u.prototype.emplace=function(f,g,b,E,T){var R=4*f;return this.int16[R+0]=g,this.int16[R+1]=b,this.int16[R+2]=E,this.int16[R+3]=T,f},u}(fa);qf.prototype.bytesPerElement=8,On("StructArrayLayout4i8",qf);var ml=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R){var j=this.length;return this.resize(j+1),this.emplace(j,f,g,b,E,T,R)},u.prototype.emplace=function(f,g,b,E,T,R,j){var G=6*f;return this.int16[G+0]=g,this.int16[G+1]=b,this.int16[G+2]=E,this.int16[G+3]=T,this.int16[G+4]=R,this.int16[G+5]=j,f},u}(fa);ml.prototype.bytesPerElement=12,On("StructArrayLayout2i4i12",ml);var Ys=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R){var j=this.length;return this.resize(j+1),this.emplace(j,f,g,b,E,T,R)},u.prototype.emplace=function(f,g,b,E,T,R,j){var G=4*f,$=8*f;return this.int16[G+0]=g,this.int16[G+1]=b,this.uint8[$+4]=E,this.uint8[$+5]=T,this.uint8[$+6]=R,this.uint8[$+7]=j,f},u}(fa);Ys.prototype.bytesPerElement=8,On("StructArrayLayout2i4ub8",Ys);var cc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var E=2*f;return this.float32[E+0]=g,this.float32[E+1]=b,f},u}(fa);cc.prototype.bytesPerElement=8,On("StructArrayLayout2f8",cc);var gl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R,j,G,$,te){var ne=this.length;return this.resize(ne+1),this.emplace(ne,f,g,b,E,T,R,j,G,$,te)},u.prototype.emplace=function(f,g,b,E,T,R,j,G,$,te,ne){var Se=10*f;return this.uint16[Se+0]=g,this.uint16[Se+1]=b,this.uint16[Se+2]=E,this.uint16[Se+3]=T,this.uint16[Se+4]=R,this.uint16[Se+5]=j,this.uint16[Se+6]=G,this.uint16[Se+7]=$,this.uint16[Se+8]=te,this.uint16[Se+9]=ne,f},u}(fa);gl.prototype.bytesPerElement=20,On("StructArrayLayout10ui20",gl);var Qf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R,j,G,$,te,ne,Se){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,f,g,b,E,T,R,j,G,$,te,ne,Se)},u.prototype.emplace=function(f,g,b,E,T,R,j,G,$,te,ne,Se,Ve){var Le=12*f;return this.int16[Le+0]=g,this.int16[Le+1]=b,this.int16[Le+2]=E,this.int16[Le+3]=T,this.uint16[Le+4]=R,this.uint16[Le+5]=j,this.uint16[Le+6]=G,this.uint16[Le+7]=$,this.int16[Le+8]=te,this.int16[Le+9]=ne,this.int16[Le+10]=Se,this.int16[Le+11]=Ve,f},u}(fa);Qf.prototype.bytesPerElement=24,On("StructArrayLayout4i4ui4i24",Qf);var Nc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var E=this.length;return this.resize(E+1),this.emplace(E,f,g,b)},u.prototype.emplace=function(f,g,b,E){var T=3*f;return this.float32[T+0]=g,this.float32[T+1]=b,this.float32[T+2]=E,f},u}(fa);Nc.prototype.bytesPerElement=12,On("StructArrayLayout3f12",Nc);var jc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.uint32[1*f+0]=g,f},u}(fa);jc.prototype.bytesPerElement=4,On("StructArrayLayout1ul4",jc);var bf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R,j,G,$){var te=this.length;return this.resize(te+1),this.emplace(te,f,g,b,E,T,R,j,G,$)},u.prototype.emplace=function(f,g,b,E,T,R,j,G,$,te){var ne=10*f,Se=5*f;return this.int16[ne+0]=g,this.int16[ne+1]=b,this.int16[ne+2]=E,this.int16[ne+3]=T,this.int16[ne+4]=R,this.int16[ne+5]=j,this.uint32[Se+3]=G,this.uint16[ne+8]=$,this.uint16[ne+9]=te,f},u}(fa);bf.prototype.bytesPerElement=20,On("StructArrayLayout6i1ul2ui20",bf);var yl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R){var j=this.length;return this.resize(j+1),this.emplace(j,f,g,b,E,T,R)},u.prototype.emplace=function(f,g,b,E,T,R,j){var G=6*f;return this.int16[G+0]=g,this.int16[G+1]=b,this.int16[G+2]=E,this.int16[G+3]=T,this.int16[G+4]=R,this.int16[G+5]=j,f},u}(fa);yl.prototype.bytesPerElement=12,On("StructArrayLayout2i2i2i12",yl);var Wl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T){var R=this.length;return this.resize(R+1),this.emplace(R,f,g,b,E,T)},u.prototype.emplace=function(f,g,b,E,T,R){var j=4*f,G=8*f;return this.float32[j+0]=g,this.float32[j+1]=b,this.float32[j+2]=E,this.int16[G+6]=T,this.int16[G+7]=R,f},u}(fa);Wl.prototype.bytesPerElement=16,On("StructArrayLayout2f1f2i16",Wl);var Jf=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,E)},u.prototype.emplace=function(f,g,b,E,T){var R=12*f,j=3*f;return this.uint8[R+0]=g,this.uint8[R+1]=b,this.float32[j+1]=E,this.float32[j+2]=T,f},u}(fa);Jf.prototype.bytesPerElement=12,On("StructArrayLayout2ub2f12",Jf);var Au=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var E=this.length;return this.resize(E+1),this.emplace(E,f,g,b)},u.prototype.emplace=function(f,g,b,E){var T=3*f;return this.uint16[T+0]=g,this.uint16[T+1]=b,this.uint16[T+2]=E,f},u}(fa);Au.prototype.bytesPerElement=6,On("StructArrayLayout3ui6",Au);var Tu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt){var Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt)},u.prototype.emplace=function(f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt,Ht){var nr=24*f,Rr=12*f,gr=48*f;return this.int16[nr+0]=g,this.int16[nr+1]=b,this.uint16[nr+2]=E,this.uint16[nr+3]=T,this.uint32[Rr+2]=R,this.uint32[Rr+3]=j,this.uint32[Rr+4]=G,this.uint16[nr+10]=$,this.uint16[nr+11]=te,this.uint16[nr+12]=ne,this.float32[Rr+7]=Se,this.float32[Rr+8]=Ve,this.uint8[gr+36]=Le,this.uint8[gr+37]=ct,this.uint8[gr+38]=ft,this.uint32[Rr+10]=Rt,this.int16[nr+22]=Ht,f},u}(fa);Tu.prototype.bytesPerElement=48,On("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Tu);var eh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt,Ht,nr,Rr,gr,rn,on,kn,Gn,zn,Rn,yi){var Jn=this.length;return this.resize(Jn+1),this.emplace(Jn,f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt,Ht,nr,Rr,gr,rn,on,kn,Gn,zn,Rn,yi)},u.prototype.emplace=function(f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le,ct,ft,Rt,Ht,nr,Rr,gr,rn,on,kn,Gn,zn,Rn,yi,Jn){var Xn=34*f,Ki=17*f;return this.int16[Xn+0]=g,this.int16[Xn+1]=b,this.int16[Xn+2]=E,this.int16[Xn+3]=T,this.int16[Xn+4]=R,this.int16[Xn+5]=j,this.int16[Xn+6]=G,this.int16[Xn+7]=$,this.uint16[Xn+8]=te,this.uint16[Xn+9]=ne,this.uint16[Xn+10]=Se,this.uint16[Xn+11]=Ve,this.uint16[Xn+12]=Le,this.uint16[Xn+13]=ct,this.uint16[Xn+14]=ft,this.uint16[Xn+15]=Rt,this.uint16[Xn+16]=Ht,this.uint16[Xn+17]=nr,this.uint16[Xn+18]=Rr,this.uint16[Xn+19]=gr,this.uint16[Xn+20]=rn,this.uint16[Xn+21]=on,this.uint16[Xn+22]=kn,this.uint32[Ki+12]=Gn,this.float32[Ki+13]=zn,this.float32[Ki+14]=Rn,this.float32[Ki+15]=yi,this.float32[Ki+16]=Jn,f},u}(fa);eh.prototype.bytesPerElement=68,On("StructArrayLayout8i15ui1ul4f68",eh);var Zt=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.float32[1*f+0]=g,f},u}(fa);Zt.prototype.bytesPerElement=4,On("StructArrayLayout1f4",Zt);var Be=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var E=this.length;return this.resize(E+1),this.emplace(E,f,g,b)},u.prototype.emplace=function(f,g,b,E){var T=3*f;return this.int16[T+0]=g,this.int16[T+1]=b,this.int16[T+2]=E,f},u}(fa);Be.prototype.bytesPerElement=6,On("StructArrayLayout3i6",Be);var Uh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var E=this.length;return this.resize(E+1),this.emplace(E,f,g,b)},u.prototype.emplace=function(f,g,b,E){var T=4*f;return this.uint32[2*f+0]=g,this.uint16[T+2]=b,this.uint16[T+3]=E,f},u}(fa);Uh.prototype.bytesPerElement=8,On("StructArrayLayout1ul2ui8",Uh);var be=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var E=2*f;return this.uint16[E+0]=g,this.uint16[E+1]=b,f},u}(fa);be.prototype.bytesPerElement=4,On("StructArrayLayout2ui4",be);var th=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.uint16[1*f+0]=g,f},u}(fa);th.prototype.bytesPerElement=2,On("StructArrayLayout1ui2",th);var Po=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,E){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,E)},u.prototype.emplace=function(f,g,b,E,T){var R=4*f;return this.float32[R+0]=g,this.float32[R+1]=b,this.float32[R+2]=E,this.float32[R+3]=T,f},u}(fa);Po.prototype.bytesPerElement=16,On("StructArrayLayout4f16",Po);var m=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new q(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,f),u}(lc);m.prototype.size=20;var d=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new m(this,f)},u}(bf);On("CollisionBoxArray",d);var h=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(g){this._structArray.uint8[this._pos1+37]=g},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(g){this._structArray.uint8[this._pos1+38]=g},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+10]=g},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,f),u}(lc);h.prototype.size=48;var y=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new h(this,f)},u}(Tu);On("PlacedSymbolArray",y);var S=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+12]=g},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,f),u}(lc);S.prototype.size=68;var O=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new S(this,f)},u}(eh);On("SymbolInstanceArray",O);var M=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getoffsetX=function(f){return this.float32[1*f+0]},u}(Zt);On("GlyphOffsetArray",M);var F=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getx=function(f){return this.int16[3*f+0]},u.prototype.gety=function(f){return this.int16[3*f+1]},u.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},u}(Be);On("SymbolLineVertexArray",F);var X=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,f),u}(lc);X.prototype.size=8;var ee=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new X(this,f)},u}(Uh);On("FeatureIndexArray",ee);var ge=Mo([{name:"a_pos",components:2,type:"Int16"}],4).members,_e=function(u){u===void 0&&(u=[]),this.segments=u};function Ee(s,u){return 256*(s=wt(Math.floor(s),0,255))+wt(Math.floor(u),0,255)}_e.prototype.prepareSegment=function(s,u,f,g){var b=this.segments[this.segments.length-1];return s>_e.MAX_VERTEX_ARRAY_LENGTH&&Ut("Max vertices per segment is "+_e.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+s),(!b||b.vertexLength+s>_e.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b},_e.prototype.get=function(){return this.segments},_e.prototype.destroy=function(){for(var s=0,u=this.segments;s<u.length;s+=1){var f=u[s];for(var g in f.vaos)f.vaos[g].destroy()}},_e.simpleSegment=function(s,u,f,g){return new _e([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])},_e.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,On("SegmentVector",_e);var qe=Mo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),$e=L(function(s){s.exports=function(u,f){var g,b,E,T,R,j,G,$;for(b=u.length-(g=3&u.length),E=f,R=3432918353,j=461845907,$=0;$<b;)G=255&u.charCodeAt($)|(255&u.charCodeAt(++$))<<8|(255&u.charCodeAt(++$))<<16|(255&u.charCodeAt(++$))<<24,++$,E=27492+(65535&(T=5*(65535&(E=(E^=G=(65535&(G=(G=(65535&G)*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*j+(((G>>>16)*j&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(G=0,g){case 3:G^=(255&u.charCodeAt($+2))<<16;case 2:G^=(255&u.charCodeAt($+1))<<8;case 1:E^=G=(65535&(G=(G=(65535&(G^=255&u.charCodeAt($)))*R+(((G>>>16)*R&65535)<<16)&4294967295)<<15|G>>>17))*j+(((G>>>16)*j&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),dt=L(function(s){s.exports=function(u,f){for(var g,b=u.length,E=f^b,T=0;b>=4;)g=1540483477*(65535&(g=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:E^=(255&u.charCodeAt(T+2))<<16;case 2:E^=(255&u.charCodeAt(T+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(T)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Ye=$e,ot=dt;Ye.murmur3=$e,Ye.murmur2=ot;var Mt=function(){this.ids=[],this.positions=[],this.indexed=!1};Mt.prototype.add=function(s,u,f,g){this.ids.push(dr(s)),this.positions.push(u,f,g)},Mt.prototype.getPositions=function(s){for(var u=dr(s),f=0,g=this.ids.length-1;f<g;){var b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}for(var E=[];this.ids[f]===u;)E.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return E},Mt.serialize=function(s,u){var f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return function b(E,T,R,j){for(;R<j;){for(var G=E[R+j>>1],$=R-1,te=j+1;;){do $++;while(E[$]<G);do te--;while(E[te]>G);if($>=te)break;Jt(E,$,te),Jt(T,3*$,3*te),Jt(T,3*$+1,3*te+1),Jt(T,3*$+2,3*te+2)}te-R<j-te?(b(E,T,R,te),R=te+1):(b(E,T,te+1,j),j=te)}}(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}},Mt.deserialize=function(s){var u=new Mt;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u};var Pt=Math.pow(2,53)-1;function dr(s){var u=+s;return!isNaN(u)&&u<=Pt?u:Ye(String(s))}function Jt(s,u,f){var g=s[u];s[u]=s[f],s[f]=g}On("FeaturePositionMap",Mt);var br=function(u,f){this.gl=u.gl,this.location=f},Er=function(s){function u(f,g){s.call(this,f,g),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},u}(br),en=function(s){function u(f,g){s.call(this,f,g),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},u}(br),Xr=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},u}(br),gn=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},u}(br),In=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},u}(br),Vn=function(s){function u(f,g){s.call(this,f,g),this.current=di.transparent}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},u}(br),oi=new Float32Array(16),Di=function(s){function u(f,g){s.call(this,f,g),this.current=oi}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var g=1;g<16;g++)if(f[g]!==this.current[g]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},u}(br);function Ji(s){return[Ee(255*s.r,255*s.g),Ee(255*s.b,255*s.a)]}var Tn=function(u,f,g){this.value=u,this.uniformNames=f.map(function(b){return"u_"+b}),this.type=g};Tn.prototype.setUniform=function(s,u,f){s.set(f.constantOr(this.value))},Tn.prototype.getBinding=function(s,u,f){return this.type==="color"?new Vn(s,u):new en(s,u)};var Ei=function(u,f){this.uniformNames=f.map(function(g){return"u_"+g}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ei.prototype.setConstantPatternPositions=function(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr},Ei.prototype.setUniform=function(s,u,f,g){var b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&s.set(b)},Ei.prototype.getBinding=function(s,u,f){return f.substr(0,9)==="u_pattern"?new In(s,u):new en(s,u)};var vi=function(u,f,g,b){this.expression=u,this.type=g,this.maxValue=0,this.paintVertexAttributes=f.map(function(E){return{name:"a_"+E,type:"Float32",components:g==="color"?2:1,offset:0}}),this.paintVertexArray=new b};vi.prototype.populatePaintArray=function(s,u,f,g,b){var E=this.paintVertexArray.length,T=this.expression.evaluate(new Ti(0),u,{},g,[],b);this.paintVertexArray.resize(s),this._setPaintValue(E,s,T)},vi.prototype.updatePaintArray=function(s,u,f,g){var b=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(s,u,b)},vi.prototype._setPaintValue=function(s,u,f){if(this.type==="color")for(var g=Ji(f),b=s;b<u;b++)this.paintVertexArray.emplace(b,g[0],g[1]);else{for(var E=s;E<u;E++)this.paintVertexArray.emplace(E,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},vi.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Hn=function(u,f,g,b,E,T){this.expression=u,this.uniformNames=f.map(function(R){return"u_"+R+"_t"}),this.type=g,this.useIntegerZoom=b,this.zoom=E,this.maxValue=0,this.paintVertexAttributes=f.map(function(R){return{name:"a_"+R,type:"Float32",components:g==="color"?4:2,offset:0}}),this.paintVertexArray=new T};Hn.prototype.populatePaintArray=function(s,u,f,g,b){var E=this.expression.evaluate(new Ti(this.zoom),u,{},g,[],b),T=this.expression.evaluate(new Ti(this.zoom+1),u,{},g,[],b),R=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(R,s,E,T)},Hn.prototype.updatePaintArray=function(s,u,f,g){var b=this.expression.evaluate({zoom:this.zoom},f,g),E=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(s,u,b,E)},Hn.prototype._setPaintValue=function(s,u,f,g){if(this.type==="color")for(var b=Ji(f),E=Ji(g),T=s;T<u;T++)this.paintVertexArray.emplace(T,b[0],b[1],E[0],E[1]);else{for(var R=s;R<u;R++)this.paintVertexArray.emplace(R,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}},Hn.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Hn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Hn.prototype.setUniform=function(s,u){var f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=wt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)},Hn.prototype.getBinding=function(s,u,f){return new en(s,u)};var Ci=function(u,f,g,b,E,T){this.expression=u,this.type=f,this.useIntegerZoom=g,this.zoom=b,this.layerId=T,this.zoomInPaintVertexArray=new E,this.zoomOutPaintVertexArray=new E};Ci.prototype.populatePaintArray=function(s,u,f){var g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,u.patterns&&u.patterns[this.layerId],f)},Ci.prototype.updatePaintArray=function(s,u,f,g,b){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],b)},Ci.prototype._setPaintValues=function(s,u,f,g){if(g&&f){var b=g[f.min],E=g[f.mid],T=g[f.max];if(b&&E&&T)for(var R=s;R<u;R++)this.zoomInPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],E.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],E.pixelRatio,T.pixelRatio)}},Ci.prototype.upload=function(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,qe.members,this.expression.isStateDependent))},Ci.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ti=function(u,f,g){this.binders={},this._buffers=[];var b=[];for(var E in u.paint._values)if(g(E)){var T=u.paint.get(E);if(T instanceof ys&&pl(T.property.specification)){var R=Yi(E,u.type),j=T.value,G=T.property.specification.type,$=T.property.useIntegerZoom,te=T.property.specification["property-type"],ne=te==="cross-faded"||te==="cross-faded-data-driven";if(j.kind==="constant")this.binders[E]=ne?new Ei(j.value,R):new Tn(j.value,R,G),b.push("/u_"+E);else if(j.kind==="source"||ne){var Se=za(E,G,"source");this.binders[E]=ne?new Ci(j,G,$,f,Se,u.id):new vi(j,R,G,Se),b.push("/a_"+E)}else{var Ve=za(E,G,"composite");this.binders[E]=new Hn(j,R,G,$,f,Ve),b.push("/z_"+E)}}}this.cacheKey=b.sort().join("")};ti.prototype.getMaxValue=function(s){var u=this.binders[s];return u instanceof vi||u instanceof Hn?u.maxValue:0},ti.prototype.populatePaintArrays=function(s,u,f,g,b){for(var E in this.binders){var T=this.binders[E];(T instanceof vi||T instanceof Hn||T instanceof Ci)&&T.populatePaintArray(s,u,f,g,b)}},ti.prototype.setConstantPatternPositions=function(s,u){for(var f in this.binders){var g=this.binders[f];g instanceof Ei&&g.setConstantPatternPositions(s,u)}},ti.prototype.updatePaintArrays=function(s,u,f,g,b){var E=!1;for(var T in s)for(var R=0,j=u.getPositions(T);R<j.length;R+=1){var G=j[R],$=f.feature(G.index);for(var te in this.binders){var ne=this.binders[te];if((ne instanceof vi||ne instanceof Hn||ne instanceof Ci)&&ne.expression.isStateDependent===!0){var Se=g.paint.get(te);ne.expression=Se.value,ne.updatePaintArray(G.start,G.end,$,s[T],b),E=!0}}}return E},ti.prototype.defines=function(){var s=[];for(var u in this.binders){var f=this.binders[u];(f instanceof Tn||f instanceof Ei)&&s.push.apply(s,f.uniformNames.map(function(g){return"#define HAS_UNIFORM_"+g}))}return s},ti.prototype.getBinderAttributes=function(){var s=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof vi||f instanceof Hn)for(var g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof Ci)for(var b=0;b<qe.members.length;b++)s.push(qe.members[b].name)}return s},ti.prototype.getBinderUniforms=function(){var s=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof Tn||f instanceof Ei||f instanceof Hn)for(var g=0,b=f.uniformNames;g<b.length;g+=1)s.push(b[g])}return s},ti.prototype.getPaintVertexBuffers=function(){return this._buffers},ti.prototype.getUniforms=function(s,u){var f=[];for(var g in this.binders){var b=this.binders[g];if(b instanceof Tn||b instanceof Ei||b instanceof Hn)for(var E=0,T=b.uniformNames;E<T.length;E+=1){var R=T[E];if(u[R]){var j=b.getBinding(s,u[R],R);f.push({name:R,property:g,binding:j})}}}return f},ti.prototype.setUniforms=function(s,u,f,g){for(var b=0,E=u;b<E.length;b+=1){var T=E[b],R=T.name,j=T.property;this.binders[j].setUniform(T.binding,g,f.get(j),R)}},ti.prototype.updatePaintBuffers=function(s){for(var u in this._buffers=[],this.binders){var f=this.binders[u];if(s&&f instanceof Ci){var g=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof vi||f instanceof Hn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},ti.prototype.upload=function(s){for(var u in this.binders){var f=this.binders[u];(f instanceof vi||f instanceof Hn||f instanceof Ci)&&f.upload(s)}this.updatePaintBuffers()},ti.prototype.destroy=function(){for(var s in this.binders){var u=this.binders[s];(u instanceof vi||u instanceof Hn||u instanceof Ci)&&u.destroy()}};var _i=function(u,f,g){g===void 0&&(g=function(){return!0}),this.programConfigurations={};for(var b=0,E=u;b<E.length;b+=1){var T=E[b];this.programConfigurations[T.id]=new ti(T,f,g)}this.needsUpload=!1,this._featureMap=new Mt,this._bufferOffset=0};function Yi(s,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(u+"-","").replace(/-/g,"_")]}function za(s,u,f){var g={color:{source:cc,composite:Po},number:{source:Zt,composite:cc}},b=function(E){return{"line-pattern":{source:gl,composite:gl},"fill-pattern":{source:gl,composite:gl},"fill-extrusion-pattern":{source:gl,composite:gl}}[E]}(s);return b&&b[f]||g[u][f]}_i.prototype.populatePaintArrays=function(s,u,f,g,b,E){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(s,u,g,b,E);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0},_i.prototype.updatePaintArrays=function(s,u,f,g){for(var b=0,E=f;b<E.length;b+=1){var T=E[b];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(s,this._featureMap,u,T,g)||this.needsUpload}},_i.prototype.get=function(s){return this.programConfigurations[s]},_i.prototype.upload=function(s){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}},_i.prototype.destroy=function(){for(var s in this.programConfigurations)this.programConfigurations[s].destroy()},On("ConstantBinder",Tn),On("CrossFadedConstantBinder",Ei),On("SourceExpressionBinder",vi),On("CrossFadedCompositeBinder",Ci),On("CompositeExpressionBinder",Hn),On("ProgramConfiguration",ti,{omit:["_buffers"]}),On("ProgramConfigurationSet",_i);var Aa=Math.pow(2,14)-1,No=-Aa-1;function $a(s){for(var u=8192/s.extent,f=s.loadGeometry(),g=0;g<f.length;g++)for(var b=f[g],E=0;E<b.length;E++){var T=b[E],R=Math.round(T.x*u),j=Math.round(T.y*u);T.x=wt(R,No,Aa),T.y=wt(j,No,Aa),(R<T.x||R>T.x+1||j<T.y||j>T.y+1)&&Ut("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Ya(s,u){return{type:s.type,id:s.id,properties:s.properties,geometry:u?$a(s):[]}}function Ks(s,u,f,g,b){s.emplaceBack(2*u+(g+1)/2,2*f+(b+1)/2)}var jo=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Hl,this.indexArray=new Au,this.segments=new _e,this.programConfigurations=new _i(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};function Yu(s,u){for(var f=0;f<s.length;f++)if(mu(u,s[f]))return!0;for(var g=0;g<u.length;g++)if(mu(s,u[g]))return!0;return!!fc(s,u)}function Ku(s,u,f){return!!mu(s,u)||!!du(u,s,f)}function _s(s,u){if(s.length===1)return vu(u,s[0]);for(var f=0;f<u.length;f++)for(var g=u[f],b=0;b<g.length;b++)if(mu(s,g[b]))return!0;for(var E=0;E<s.length;E++)if(vu(u,s[E]))return!0;for(var T=0;T<u.length;T++)if(fc(s,u[T]))return!0;return!1}function bs(s,u,f){if(s.length>1){if(fc(s,u))return!0;for(var g=0;g<u.length;g++)if(du(u[g],s,f))return!0}for(var b=0;b<s.length;b++)if(du(s[b],u,f))return!0;return!1}function fc(s,u){if(s.length===0||u.length===0)return!1;for(var f=0;f<s.length-1;f++)for(var g=s[f],b=s[f+1],E=0;E<u.length-1;E++)if(xf(g,b,u[E],u[E+1]))return!0;return!1}function xf(s,u,f,g){return Ce(s,f,g)!==Ce(u,f,g)&&Ce(s,u,f)!==Ce(s,u,g)}function du(s,u,f){var g=f*f;if(u.length===1)return s.distSqr(u[0])<g;for(var b=1;b<u.length;b++)if(Gl(s,u[b-1],u[b])<g)return!0;return!1}function Gl(s,u,f){var g=u.distSqr(f);if(g===0)return s.distSqr(u);var b=((s.x-u.x)*(f.x-u.x)+(s.y-u.y)*(f.y-u.y))/g;return s.distSqr(b<0?u:b>1?f:f.sub(u)._mult(b)._add(u))}function vu(s,u){for(var f,g,b,E=!1,T=0;T<s.length;T++)for(var R=0,j=(f=s[T]).length-1;R<f.length;j=R++)(g=f[R]).y>u.y!=(b=f[j]).y>u.y&&u.x<(b.x-g.x)*(u.y-g.y)/(b.y-g.y)+g.x&&(E=!E);return E}function mu(s,u){for(var f=!1,g=0,b=s.length-1;g<s.length;b=g++){var E=s[g],T=s[b];E.y>u.y!=T.y>u.y&&u.x<(T.x-E.x)*(u.y-E.y)/(T.y-E.y)+E.x&&(f=!f)}return f}function _l(s,u,f){var g=f[0],b=f[2];if(s.x<g.x&&u.x<g.x||s.x>b.x&&u.x>b.x||s.y<g.y&&u.y<g.y||s.y>b.y&&u.y>b.y)return!1;var E=Ce(s,u,f[0]);return E!==Ce(s,u,f[1])||E!==Ce(s,u,f[2])||E!==Ce(s,u,f[3])}function ls(s,u,f){var g=u.paint.get(s).value;return g.kind==="constant"?g.value:f.programConfigurations.get(u.id).getMaxValue(s)}function so(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function cs(s,u,f,g,b){if(!u[0]&&!u[1])return s;var E=q.convert(u)._mult(b);f==="viewport"&&E._rotate(-g);for(var T=[],R=0;R<s.length;R++)T.push(s[R].sub(E));return T}jo.prototype.populate=function(s,u,f){var g=this.layers[0],b=[],E=null;g.type==="circle"&&(E=g.layout.get("circle-sort-key"));for(var T=0,R=s;T<R.length;T+=1){var j=R[T],G=j.feature,$=j.id,te=j.index,ne=j.sourceLayerIndex,Se=this.layers[0]._featureFilter.needGeometry,Ve=Ya(G,Se);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),Ve,f)){var Le=E?E.evaluate(Ve,{},f):void 0,ct={id:$,properties:G.properties,type:G.type,sourceLayerIndex:ne,index:te,geometry:Se?Ve.geometry:$a(G),patterns:{},sortKey:Le};b.push(ct)}}E&&b.sort(function(on,kn){return on.sortKey-kn.sortKey});for(var ft=0,Rt=b;ft<Rt.length;ft+=1){var Ht=Rt[ft],nr=Ht.geometry,Rr=Ht.index,gr=Ht.sourceLayerIndex,rn=s[Rr].feature;this.addFeature(Ht,nr,Rr,f),u.featureIndex.insert(rn,nr,Rr,gr,this.index)}},jo.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},jo.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,ge),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},jo.prototype.addFeature=function(s,u,f,g){for(var b=0,E=u;b<E.length;b+=1)for(var T=0,R=E[b];T<R.length;T+=1){var j=R[T],G=j.x,$=j.y;if(!(G<0||G>=8192||$<0||$>=8192)){var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),ne=te.vertexLength;Ks(this.layoutVertexArray,G,$,-1,-1),Ks(this.layoutVertexArray,G,$,1,-1),Ks(this.layoutVertexArray,G,$,1,1),Ks(this.layoutVertexArray,G,$,-1,1),this.indexArray.emplaceBack(ne,ne+1,ne+2),this.indexArray.emplaceBack(ne,ne+3,ne+2),te.vertexLength+=4,te.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},g)},On("CircleBucket",jo,{omit:["layers"]});var bl=new Za({"circle-sort-key":new Fn(xe.layout_circle["circle-sort-key"])}),iu={paint:new Za({"circle-radius":new Fn(xe.paint_circle["circle-radius"]),"circle-color":new Fn(xe.paint_circle["circle-color"]),"circle-blur":new Fn(xe.paint_circle["circle-blur"]),"circle-opacity":new Fn(xe.paint_circle["circle-opacity"]),"circle-translate":new qn(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new qn(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new qn(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new qn(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fn(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fn(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fn(xe.paint_circle["circle-stroke-opacity"])}),layout:bl},fo=typeof Float32Array!="undefined"?Float32Array:Array;function zo(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Ka(s,u,f){var g=u[0],b=u[1],E=u[2],T=u[3],R=u[4],j=u[5],G=u[6],$=u[7],te=u[8],ne=u[9],Se=u[10],Ve=u[11],Le=u[12],ct=u[13],ft=u[14],Rt=u[15],Ht=f[0],nr=f[1],Rr=f[2],gr=f[3];return s[0]=Ht*g+nr*R+Rr*te+gr*Le,s[1]=Ht*b+nr*j+Rr*ne+gr*ct,s[2]=Ht*E+nr*G+Rr*Se+gr*ft,s[3]=Ht*T+nr*$+Rr*Ve+gr*Rt,s[4]=(Ht=f[4])*g+(nr=f[5])*R+(Rr=f[6])*te+(gr=f[7])*Le,s[5]=Ht*b+nr*j+Rr*ne+gr*ct,s[6]=Ht*E+nr*G+Rr*Se+gr*ft,s[7]=Ht*T+nr*$+Rr*Ve+gr*Rt,s[8]=(Ht=f[8])*g+(nr=f[9])*R+(Rr=f[10])*te+(gr=f[11])*Le,s[9]=Ht*b+nr*j+Rr*ne+gr*ct,s[10]=Ht*E+nr*G+Rr*Se+gr*ft,s[11]=Ht*T+nr*$+Rr*Ve+gr*Rt,s[12]=(Ht=f[12])*g+(nr=f[13])*R+(Rr=f[14])*te+(gr=f[15])*Le,s[13]=Ht*b+nr*j+Rr*ne+gr*ct,s[14]=Ht*E+nr*G+Rr*Se+gr*ft,s[15]=Ht*T+nr*$+Rr*Ve+gr*Rt,s}Math.hypot||(Math.hypot=function(){for(var s=arguments,u=0,f=arguments.length;f--;)u+=s[f]*s[f];return Math.sqrt(u)});var fs,xs=Ka;function Cu(s,u,f){var g=u[0],b=u[1],E=u[2],T=u[3];return s[0]=f[0]*g+f[4]*b+f[8]*E+f[12]*T,s[1]=f[1]*g+f[5]*b+f[9]*E+f[13]*T,s[2]=f[2]*g+f[6]*b+f[10]*E+f[14]*T,s[3]=f[3]*g+f[7]*b+f[11]*E+f[15]*T,s}fs=new fo(3),fo!=Float32Array&&(fs[0]=0,fs[1]=0,fs[2]=0),function(){var s=new fo(4);fo!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0)}();var Ef=(function(){var s=new fo(2);fo!=Float32Array&&(s[0]=0,s[1]=0)}(),function(s){function u(f){s.call(this,f,iu)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new jo(f)},u.prototype.queryRadius=function(f){var g=f;return ls("circle-radius",this,g)+ls("circle-stroke-width",this,g)+so(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,E,T,R,j,G){for(var $=cs(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,j),te=this.paint.get("circle-radius").evaluate(g,b)+this.paint.get("circle-stroke-width").evaluate(g,b),ne=this.paint.get("circle-pitch-alignment")==="map",Se=ne?$:function(rn,on){return rn.map(function(kn){return zc(kn,on)})}($,G),Ve=ne?te*j:te,Le=0,ct=E;Le<ct.length;Le+=1)for(var ft=0,Rt=ct[Le];ft<Rt.length;ft+=1){var Ht=Rt[ft],nr=ne?Ht:zc(Ht,G),Rr=Ve,gr=Cu([],[Ht.x,Ht.y,0,1],G);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Rr*=gr[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Rr*=R.cameraToCenterDistance/gr[3]),Ku(Se,nr,Rr))return!0}return!1},u}(nu));function zc(s,u){var f=Cu([],[s.x,s.y,0,1],u);return new q(f[0]/f[3],f[1]/f[3])}var hc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(jo);function es(s,u,f,g){var b=u.width,E=u.height;if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==b*E*f)throw new RangeError("mismatched image size")}else g=new Uint8Array(b*E*f);return s.width=b,s.height=E,s.data=g,s}function Vh(s,u,f){var g=u.width,b=u.height;if(g!==s.width||b!==s.height){var E=es({},{width:g,height:b},f);Uc(s,E,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,g),height:Math.min(s.height,b)},f),s.width=g,s.height=b,s.data=E.data}}function Uc(s,u,f,g,b,E){if(b.width===0||b.height===0)return u;if(b.width>s.width||b.height>s.height||f.x>s.width-b.width||f.y>s.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>u.width||b.height>u.height||g.x>u.width-b.width||g.y>u.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=s.data,R=u.data,j=0;j<b.height;j++)for(var G=((f.y+j)*s.width+f.x)*E,$=((g.y+j)*u.width+g.x)*E,te=0;te<b.width*E;te++)R[$+te]=T[G+te];return u}On("HeatmapBucket",hc,{omit:["layers"]});var qu=function(u,f){es(this,u,1,f)};qu.prototype.resize=function(s){Vh(this,s,1)},qu.prototype.clone=function(){return new qu({width:this.width,height:this.height},new Uint8Array(this.data))},qu.copy=function(s,u,f,g,b){Uc(s,u,f,g,b,1)};var zs=function(u,f){es(this,u,4,f)};zs.prototype.resize=function(s){Vh(this,s,4)},zs.prototype.replace=function(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s},zs.prototype.clone=function(){return new zs({width:this.width,height:this.height},new Uint8Array(this.data))},zs.copy=function(s,u,f,g,b){Uc(s,u,f,g,b,4)},On("AlphaImage",qu),On("RGBAImage",zs);var uv={paint:new Za({"heatmap-radius":new Fn(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fn(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new qn(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new $s(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new qn(xe.paint_heatmap["heatmap-opacity"])})};function hd(s){var u={},f=s.resolution||256,g=s.clips?s.clips.length:1,b=s.image||new zs({width:f,height:g}),E=function(Le,ct,ft){u[s.evaluationKey]=ft;var Rt=s.expression.evaluate(u);b.data[Le+ct+0]=Math.floor(255*Rt.r/Rt.a),b.data[Le+ct+1]=Math.floor(255*Rt.g/Rt.a),b.data[Le+ct+2]=Math.floor(255*Rt.b/Rt.a),b.data[Le+ct+3]=Math.floor(255*Rt.a)};if(s.clips)for(var T=0,R=0;T<g;++T,R+=4*f)for(var j=0,G=0;j<f;j++,G+=4){var $=j/(f-1),te=s.clips[T];E(R,G,te.start*(1-$)+te.end*$)}else for(var ne=0,Se=0;ne<f;ne++,Se+=4)E(0,Se,ne/(f-1));return b}var Sf=function(s){function u(f){s.call(this,f,uv),this._updateColorRamp()}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new hc(f)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=hd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(nu),Yg={paint:new Za({"hillshade-illumination-direction":new qn(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new qn(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new qn(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new qn(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new qn(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new qn(xe.paint_hillshade["hillshade-accent-color"])})},Kg=function(s){function u(f){s.call(this,f,Yg)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(nu),Rm=Mo([{name:"a_pos",components:2,type:"Int16"}],4).members,vp=mp,Mm=mp;function mp(s,u,f){f=f||2;var g,b,E,T,R,j,G,$=u&&u.length,te=$?u[0]*f:s.length,ne=lv(s,0,te,f,!0),Se=[];if(!ne||ne.next===ne.prev)return Se;if($&&(ne=function(Le,ct,ft,Rt){var Ht,nr,Rr,gr=[];for(Ht=0,nr=ct.length;Ht<nr;Ht++)(Rr=lv(Le,ct[Ht]*Rt,Ht<nr-1?ct[Ht+1]*Rt:Le.length,Rt,!1))===Rr.next&&(Rr.steiner=!0),gr.push(_p(Rr));for(gr.sort(fv),Ht=0;Ht<gr.length;Ht++)yp(gr[Ht],ft),ft=Vc(ft,ft.next);return ft}(s,u,ne,f)),s.length>80*f){g=E=s[0],b=T=s[1];for(var Ve=f;Ve<te;Ve+=f)(R=s[Ve])<g&&(g=R),(j=s[Ve+1])<b&&(b=j),R>E&&(E=R),j>T&&(T=j);G=(G=Math.max(E-g,T-b))!==0?1/G:0}return Hh(ne,Se,f,g,b,G),Se}function lv(s,u,f,g,b){var E,T;if(b===wu(s,u,f,g)>0)for(E=u;E<f;E+=g)T=Es(E,s[E],s[E+1],T);else for(E=f-g;E>=u;E-=g)T=Es(E,s[E],s[E+1],T);return T&&nh(T,T.next)&&(ea(T),T=T.next),T}function Vc(s,u){if(!s)return s;u||(u=s);var f,g=s;do if(f=!1,g.steiner||!nh(g,g.next)&&_o(g.prev,g,g.next)!==0)g=g.next;else{if(ea(g),(g=u=g.prev)===g.next)break;f=!0}while(f||g!==u);return u}function Hh(s,u,f,g,b,E,T){if(s){!T&&E&&function($,te,ne,Se){var Ve=$;do Ve.z===null&&(Ve.z=Wh(Ve.x,Ve.y,te,ne,Se)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==$);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(Le){var ct,ft,Rt,Ht,nr,Rr,gr,rn,on=1;do{for(ft=Le,Le=null,nr=null,Rr=0;ft;){for(Rr++,Rt=ft,gr=0,ct=0;ct<on&&(gr++,Rt=Rt.nextZ);ct++);for(rn=on;gr>0||rn>0&&Rt;)gr!==0&&(rn===0||!Rt||ft.z<=Rt.z)?(Ht=ft,ft=ft.nextZ,gr--):(Ht=Rt,Rt=Rt.nextZ,rn--),nr?nr.nextZ=Ht:Le=Ht,Ht.prevZ=nr,nr=Ht;ft=Rt}nr.nextZ=null,on*=2}while(Rr>1)}(Ve)}(s,g,b,E);for(var R,j,G=s;s.prev!==s.next;)if(R=s.prev,j=s.next,E?cv(s,g,b,E):gp(s))u.push(R.i/f),u.push(s.i/f),u.push(j.i/f),ea(s),s=j.next,G=j.next;else if((s=j)===G){T?T===1?Hh(s=qg(Vc(s),u,f),u,f,g,b,E,2):T===2&&Pm(s,u,f,g,b,E):Hh(Vc(s),u,f,g,b,E,1);break}}}function gp(s){var u=s.prev,f=s,g=s.next;if(_o(u,f,g)>=0)return!1;for(var b=s.next.next;b!==s.prev;){if(Hc(u.x,u.y,f.x,f.y,g.x,g.y,b.x,b.y)&&_o(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function cv(s,u,f,g){var b=s.prev,E=s,T=s.next;if(_o(b,E,T)>=0)return!1;for(var R=b.x>E.x?b.x>T.x?b.x:T.x:E.x>T.x?E.x:T.x,j=b.y>E.y?b.y>T.y?b.y:T.y:E.y>T.y?E.y:T.y,G=Wh(b.x<E.x?b.x<T.x?b.x:T.x:E.x<T.x?E.x:T.x,b.y<E.y?b.y<T.y?b.y:T.y:E.y<T.y?E.y:T.y,u,f,g),$=Wh(R,j,u,f,g),te=s.prevZ,ne=s.nextZ;te&&te.z>=G&&ne&&ne.z<=$;){if(te!==s.prev&&te!==s.next&&Hc(b.x,b.y,E.x,E.y,T.x,T.y,te.x,te.y)&&_o(te.prev,te,te.next)>=0||(te=te.prevZ,ne!==s.prev&&ne!==s.next&&Hc(b.x,b.y,E.x,E.y,T.x,T.y,ne.x,ne.y)&&_o(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;te&&te.z>=G;){if(te!==s.prev&&te!==s.next&&Hc(b.x,b.y,E.x,E.y,T.x,T.y,te.x,te.y)&&_o(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;ne&&ne.z<=$;){if(ne!==s.prev&&ne!==s.next&&Hc(b.x,b.y,E.x,E.y,T.x,T.y,ne.x,ne.y)&&_o(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function qg(s,u,f){var g=s;do{var b=g.prev,E=g.next.next;!nh(b,E)&&ih(b,g,g.next,E)&&Xl(b,E)&&Xl(E,b)&&(u.push(b.i/f),u.push(g.i/f),u.push(E.i/f),ea(g),ea(g.next),g=s=E),g=g.next}while(g!==s);return Vc(g)}function Pm(s,u,f,g,b,E){var T=s;do{for(var R=T.next.next;R!==T.prev;){if(T.i!==R.i&&bp(T,R)){var j=ah(T,R);return T=Vc(T,T.next),j=Vc(j,j.next),Hh(T,u,f,g,b,E),void Hh(j,u,f,g,b,E)}R=R.next}T=T.next}while(T!==s)}function fv(s,u){return s.x-u.x}function yp(s,u){if(u=function(g,b){var E,T=b,R=g.x,j=g.y,G=-1/0;do{if(j<=T.y&&j>=T.next.y&&T.next.y!==T.y){var $=T.x+(j-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=R&&$>G){if(G=$,$===R){if(j===T.y)return T;if(j===T.next.y)return T.next}E=T.x<T.next.x?T:T.next}}T=T.next}while(T!==b);if(!E)return null;if(R===G)return E;var te,ne=E,Se=E.x,Ve=E.y,Le=1/0;T=E;do R>=T.x&&T.x>=Se&&R!==T.x&&Hc(j<Ve?R:G,j,Se,Ve,j<Ve?G:R,j,T.x,T.y)&&(te=Math.abs(j-T.y)/(R-T.x),Xl(T,g)&&(te<Le||te===Le&&(T.x>E.x||T.x===E.x&&rh(E,T)))&&(E=T,Le=te)),T=T.next;while(T!==ne);return E}(s,u)){var f=ah(u,s);Vc(u,u.next),Vc(f,f.next)}}function rh(s,u){return _o(s.prev,s,u.prev)<0&&_o(u.next,s,s.next)<0}function Wh(s,u,f,g,b){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-f)*b)|s<<8))|s<<4))|s<<2))|s<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-g)*b)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function _p(s){var u=s,f=s;do(u.x<f.x||u.x===f.x&&u.y<f.y)&&(f=u),u=u.next;while(u!==s);return f}function Hc(s,u,f,g,b,E,T,R){return(b-T)*(u-R)-(s-T)*(E-R)>=0&&(s-T)*(g-R)-(f-T)*(u-R)>=0&&(f-T)*(E-R)-(b-T)*(g-R)>=0}function bp(s,u){return s.next.i!==u.i&&s.prev.i!==u.i&&!function(f,g){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==g.i&&b.next.i!==g.i&&ih(b,b.next,f,g))return!0;b=b.next}while(b!==f);return!1}(s,u)&&(Xl(s,u)&&Xl(u,s)&&function(f,g){var b=f,E=!1,T=(f.x+g.x)/2,R=(f.y+g.y)/2;do b.y>R!=b.next.y>R&&b.next.y!==b.y&&T<(b.next.x-b.x)*(R-b.y)/(b.next.y-b.y)+b.x&&(E=!E),b=b.next;while(b!==f);return E}(s,u)&&(_o(s.prev,s,u.prev)||_o(s,u.prev,u))||nh(s,u)&&_o(s.prev,s,s.next)>0&&_o(u.prev,u,u.next)>0)}function _o(s,u,f){return(u.y-s.y)*(f.x-u.x)-(u.x-s.x)*(f.y-u.y)}function nh(s,u){return s.x===u.x&&s.y===u.y}function ih(s,u,f,g){var b=dc(_o(s,u,f)),E=dc(_o(s,u,g)),T=dc(_o(f,g,s)),R=dc(_o(f,g,u));return b!==E&&T!==R||!(b!==0||!pc(s,f,u))||!(E!==0||!pc(s,g,u))||!(T!==0||!pc(f,s,g))||!(R!==0||!pc(f,u,g))}function pc(s,u,f){return u.x<=Math.max(s.x,f.x)&&u.x>=Math.min(s.x,f.x)&&u.y<=Math.max(s.y,f.y)&&u.y>=Math.min(s.y,f.y)}function dc(s){return s>0?1:s<0?-1:0}function Xl(s,u){return _o(s.prev,s,s.next)<0?_o(s,u,s.next)>=0&&_o(s,s.prev,u)>=0:_o(s,u,s.prev)<0||_o(s,s.next,u)<0}function ah(s,u){var f=new Ha(s.i,s.x,s.y),g=new Ha(u.i,u.x,u.y),b=s.next,E=u.prev;return s.next=u,u.prev=s,f.next=b,b.prev=f,g.next=f,f.prev=g,E.next=g,g.prev=E,g}function Es(s,u,f,g){var b=new Ha(s,u,f);return g?(b.next=g.next,b.prev=g,g.next.prev=b,g.next=b):(b.prev=b,b.next=b),b}function ea(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ha(s,u,f){this.i=s,this.x=u,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wu(s,u,f,g){for(var b=0,E=u,T=f-g;E<f;E+=g)b+=(s[T]-s[E])*(s[E+1]+s[T+1]),T=E;return b}function Im(s,u,f,g,b){(function E(T,R,j,G,$){for(;G>j;){if(G-j>600){var te=G-j+1,ne=R-j+1,Se=Math.log(te),Ve=.5*Math.exp(2*Se/3),Le=.5*Math.sqrt(Se*Ve*(te-Ve)/te)*(ne-te/2<0?-1:1);E(T,R,Math.max(j,Math.floor(R-ne*Ve/te+Le)),Math.min(G,Math.floor(R+(te-ne)*Ve/te+Le)),$)}var ct=T[R],ft=j,Rt=G;for(vc(T,j,R),$(T[G],ct)>0&&vc(T,j,G);ft<Rt;){for(vc(T,ft,Rt),ft++,Rt--;$(T[ft],ct)<0;)ft++;for(;$(T[Rt],ct)>0;)Rt--}$(T[j],ct)===0?vc(T,j,Rt):vc(T,++Rt,G),Rt<=R&&(j=Rt+1),R<=Rt&&(G=Rt-1)}})(s,u,f||0,g||s.length-1,b||oh)}function vc(s,u,f){var g=s[u];s[u]=s[f],s[f]=g}function oh(s,u){return s<u?-1:s>u?1:0}function pd(s,u){var f=s.length;if(f<=1)return[s];for(var g,b,E=[],T=0;T<f;T++){var R=ve(s[T]);R!==0&&(s[T].area=Math.abs(R),b===void 0&&(b=R<0),b===R<0?(g&&E.push(g),g=[s[T]]):g.push(s[T]))}if(g&&E.push(g),u>1)for(var j=0;j<E.length;j++)E[j].length<=u||(Im(E[j],u,1,E[j].length-1,dd),E[j]=E[j].slice(0,u));return E}function dd(s,u){return u.area-s.area}function vd(s,u,f){for(var g=f.patternDependencies,b=!1,E=0,T=u;E<T.length;E+=1){var R=T[E].paint.get(s+"-pattern");R.isConstant()||(b=!0);var j=R.constantOr(null);j&&(b=!0,g[j.to]=!0,g[j.from]=!0)}return b}function md(s,u,f,g,b){for(var E=b.patternDependencies,T=0,R=u;T<R.length;T+=1){var j=R[T],G=j.paint.get(s+"-pattern").value;if(G.kind!=="constant"){var $=G.evaluate({zoom:g-1},f,{},b.availableImages),te=G.evaluate({zoom:g},f,{},b.availableImages),ne=G.evaluate({zoom:g+1},f,{},b.availableImages);te=te&&te.name?te.name:te,ne=ne&&ne.name?ne.name:ne,E[$=$&&$.name?$.name:$]=!0,E[te]=!0,E[ne]=!0,f.patterns[j.id]={min:$,mid:te,max:ne}}}return f}mp.deviation=function(s,u,f,g){var b=u&&u.length,E=Math.abs(wu(s,0,b?u[0]*f:s.length,f));if(b)for(var T=0,R=u.length;T<R;T++)E-=Math.abs(wu(s,u[T]*f,T<R-1?u[T+1]*f:s.length,f));var j=0;for(T=0;T<g.length;T+=3){var G=g[T]*f,$=g[T+1]*f,te=g[T+2]*f;j+=Math.abs((s[G]-s[te])*(s[$+1]-s[G+1])-(s[G]-s[$])*(s[te+1]-s[G+1]))}return E===0&&j===0?0:Math.abs((j-E)/E)},mp.flatten=function(s){for(var u=s[0][0].length,f={vertices:[],holes:[],dimensions:u},g=0,b=0;b<s.length;b++){for(var E=0;E<s[b].length;E++)for(var T=0;T<u;T++)f.vertices.push(s[b][E][T]);b>0&&f.holes.push(g+=s[b-1].length)}return f},vp.default=Mm;var xl=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Hl,this.indexArray=new Au,this.indexArray2=new be,this.programConfigurations=new _i(u.layers,u.zoom),this.segments=new _e,this.segments2=new _e,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};xl.prototype.populate=function(s,u,f){this.hasPattern=vd("fill",this.layers,u);for(var g=this.layers[0].layout.get("fill-sort-key"),b=[],E=0,T=s;E<T.length;E+=1){var R=T[E],j=R.feature,G=R.id,$=R.index,te=R.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Se=Ya(j,ne);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),Se,f)){var Ve=g?g.evaluate(Se,{},f,u.availableImages):void 0,Le={id:G,properties:j.properties,type:j.type,sourceLayerIndex:te,index:$,geometry:ne?Se.geometry:$a(j),patterns:{},sortKey:Ve};b.push(Le)}}g&&b.sort(function(rn,on){return rn.sortKey-on.sortKey});for(var ct=0,ft=b;ct<ft.length;ct+=1){var Rt=ft[ct],Ht=Rt.geometry,nr=Rt.index,Rr=Rt.sourceLayerIndex;if(this.hasPattern){var gr=md("fill",this.layers,Rt,this.zoom,u);this.patternFeatures.push(gr)}else this.addFeature(Rt,Ht,nr,f,{});u.featureIndex.insert(s[nr].feature,Ht,nr,Rr,this.index)}},xl.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},xl.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var E=b[g];this.addFeature(E,E.geometry,E.index,u,f)}},xl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},xl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},xl.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Rm),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0},xl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},xl.prototype.addFeature=function(s,u,f,g,b){for(var E=0,T=pd(u,500);E<T.length;E+=1){for(var R=T[E],j=0,G=0,$=R;G<$.length;G+=1)j+=$[G].length;for(var te=this.segments.prepareSegment(j,this.layoutVertexArray,this.indexArray),ne=te.vertexLength,Se=[],Ve=[],Le=0,ct=R;Le<ct.length;Le+=1){var ft=ct[Le];if(ft.length!==0){ft!==R[0]&&Ve.push(Se.length/2);var Rt=this.segments2.prepareSegment(ft.length,this.layoutVertexArray,this.indexArray2),Ht=Rt.vertexLength;this.layoutVertexArray.emplaceBack(ft[0].x,ft[0].y),this.indexArray2.emplaceBack(Ht+ft.length-1,Ht),Se.push(ft[0].x),Se.push(ft[0].y);for(var nr=1;nr<ft.length;nr++)this.layoutVertexArray.emplaceBack(ft[nr].x,ft[nr].y),this.indexArray2.emplaceBack(Ht+nr-1,Ht+nr),Se.push(ft[nr].x),Se.push(ft[nr].y);Rt.vertexLength+=ft.length,Rt.primitiveLength+=ft.length}}for(var Rr=vp(Se,Ve),gr=0;gr<Rr.length;gr+=3)this.indexArray.emplaceBack(ne+Rr[gr],ne+Rr[gr+1],ne+Rr[gr+2]);te.vertexLength+=j,te.primitiveLength+=Rr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},On("FillBucket",xl,{omit:["layers","patternFeatures"]});var Wc=new Za({"fill-sort-key":new Fn(xe.layout_fill["fill-sort-key"])}),hv={paint:new Za({"fill-antialias":new qn(xe.paint_fill["fill-antialias"]),"fill-opacity":new Fn(xe.paint_fill["fill-opacity"]),"fill-color":new Fn(xe.paint_fill["fill-color"]),"fill-outline-color":new Fn(xe.paint_fill["fill-outline-color"]),"fill-translate":new qn(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new qn(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zs(xe.paint_fill["fill-pattern"])}),layout:Wc},pv=function(s){function u(f){s.call(this,f,hv)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(f){return new xl(f)},u.prototype.queryRadius=function(){return so(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,E,T,R,j){return _s(cs(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,j),E)},u.prototype.isTileClipped=function(){return!0},u}(nu),dv=Mo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,vv=Af;function Af(s,u,f,g,b){this.properties={},this.extent=f,this.type=0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=b,s.readFields(mv,this,u)}function mv(s,u,f){s==1?u.id=f.readVarint():s==2?function(g,b){for(var E=g.readVarint()+g.pos;g.pos<E;){var T=b._keys[g.readVarint()],R=b._values[g.readVarint()];b.properties[T]=R}}(f,u):s==3?u.type=f.readVarint():s==4&&(u._geometry=f.pos)}function Zl(s){for(var u,f,g=0,b=0,E=s.length,T=E-1;b<E;T=b++)g+=((f=s[T]).x-(u=s[b]).x)*(u.y+f.y);return g}Af.types=["Unknown","Point","LineString","Polygon"],Af.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var u,f=s.readVarint()+s.pos,g=1,b=0,E=0,T=0,R=[];s.pos<f;){if(b<=0){var j=s.readVarint();g=7&j,b=j>>3}if(b--,g===1||g===2)E+=s.readSVarint(),T+=s.readSVarint(),g===1&&(u&&R.push(u),u=[]),u.push(new q(E,T));else{if(g!==7)throw new Error("unknown command "+g);u&&u.push(u[0].clone())}}return u&&R.push(u),R},Af.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var u=s.readVarint()+s.pos,f=1,g=0,b=0,E=0,T=1/0,R=-1/0,j=1/0,G=-1/0;s.pos<u;){if(g<=0){var $=s.readVarint();f=7&$,g=$>>3}if(g--,f===1||f===2)(b+=s.readSVarint())<T&&(T=b),b>R&&(R=b),(E+=s.readSVarint())<j&&(j=E),E>G&&(G=E);else if(f!==7)throw new Error("unknown command "+f)}return[T,j,R,G]},Af.prototype.toGeoJSON=function(s,u,f){var g,b,E=this.extent*Math.pow(2,f),T=this.extent*s,R=this.extent*u,j=this.loadGeometry(),G=Af.types[this.type];function $(Se){for(var Ve=0;Ve<Se.length;Ve++){var Le=Se[Ve];Se[Ve]=[360*(Le.x+T)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(Le.y+R)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(g=0;g<j.length;g++)te[g]=j[g][0];$(j=te);break;case 2:for(g=0;g<j.length;g++)$(j[g]);break;case 3:for(j=function(Se){var Ve=Se.length;if(Ve<=1)return[Se];for(var Le,ct,ft=[],Rt=0;Rt<Ve;Rt++){var Ht=Zl(Se[Rt]);Ht!==0&&(ct===void 0&&(ct=Ht<0),ct===Ht<0?(Le&&ft.push(Le),Le=[Se[Rt]]):Le.push(Se[Rt]))}return Le&&ft.push(Le),ft}(j),g=0;g<j.length;g++)for(b=0;b<j[g].length;b++)$(j[g][b])}j.length===1?j=j[0]:G="Multi"+G;var ne={type:"Feature",geometry:{type:G,coordinates:j},properties:this.properties};return"id"in this&&(ne.id=this.id),ne};var gd=Tf;function Tf(s,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Gc,this,u),this.length=this._features.length}function Gc(s,u,f){s===15?u.version=f.readVarint():s===1?u.name=f.readString():s===5?u.extent=f.readVarint():s===2?u._features.push(f.pos):s===3?u._keys.push(f.readString()):s===4&&u._values.push(function(g){for(var b=null,E=g.readVarint()+g.pos;g.pos<E;){var T=g.readVarint()>>3;b=T===1?g.readString():T===2?g.readFloat():T===3?g.readDouble():T===4?g.readVarint64():T===5?g.readVarint():T===6?g.readSVarint():T===7?g.readBoolean():null}return b}(f))}function gv(s,u,f){if(s===3){var g=new gd(f,f.readVarint()+f.pos);g.length&&(u[g.name]=g)}}Tf.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var u=this._pbf.readVarint()+this._pbf.pos;return new vv(this._pbf,u,this.extent,this._keys,this._values)};var Xc={VectorTile:function(u,f){this.layers=u.readFields(gv,{},f)},VectorTileFeature:vv,VectorTileLayer:gd},xp=Xc.VectorTileFeature.types,Ep=Math.pow(2,13);function Os(s,u,f,g,b,E,T,R){s.emplaceBack(u,f,2*Math.floor(g*Ep)+T,b*Ep*2,E*Ep*2,Math.round(R))}var Rs=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new ml,this.indexArray=new Au,this.programConfigurations=new _i(u.layers,u.zoom),this.segments=new _e,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};function Uo(s,u){return s.x===u.x&&(s.x<0||s.x>8192)||s.y===u.y&&(s.y<0||s.y>8192)}Rs.prototype.populate=function(s,u,f){this.features=[],this.hasPattern=vd("fill-extrusion",this.layers,u);for(var g=0,b=s;g<b.length;g+=1){var E=b[g],T=E.feature,R=E.id,j=E.index,G=E.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,te=Ya(T,$);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),te,f)){var ne={id:R,sourceLayerIndex:G,index:j,geometry:$?te.geometry:$a(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(md("fill-extrusion",this.layers,ne,this.zoom,u)):this.addFeature(ne,ne.geometry,j,f,{}),u.featureIndex.insert(T,ne.geometry,j,G,this.index,!0)}}},Rs.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.features;g<b.length;g+=1){var E=b[g];this.addFeature(E,E.geometry,E.index,u,f)}},Rs.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},Rs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Rs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Rs.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,dv),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Rs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Rs.prototype.addFeature=function(s,u,f,g,b){for(var E=0,T=pd(u,500);E<T.length;E+=1){for(var R=T[E],j=0,G=0,$=R;G<$.length;G+=1)j+=$[G].length;for(var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ne=0,Se=R;ne<Se.length;ne+=1){var Ve=Se[ne];if(Ve.length!==0&&!((Ki=Ve).every(function(Mi){return Mi.x<0})||Ki.every(function(Mi){return Mi.x>8192})||Ki.every(function(Mi){return Mi.y<0})||Ki.every(function(Mi){return Mi.y>8192})))for(var Le=0,ct=0;ct<Ve.length;ct++){var ft=Ve[ct];if(ct>=1){var Rt=Ve[ct-1];if(!Uo(ft,Rt)){te.vertexLength+4>_e.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ht=ft.sub(Rt)._perp()._unit(),nr=Rt.dist(ft);Le+nr>32768&&(Le=0),Os(this.layoutVertexArray,ft.x,ft.y,Ht.x,Ht.y,0,0,Le),Os(this.layoutVertexArray,ft.x,ft.y,Ht.x,Ht.y,0,1,Le),Os(this.layoutVertexArray,Rt.x,Rt.y,Ht.x,Ht.y,0,0,Le+=nr),Os(this.layoutVertexArray,Rt.x,Rt.y,Ht.x,Ht.y,0,1,Le);var Rr=te.vertexLength;this.indexArray.emplaceBack(Rr,Rr+2,Rr+1),this.indexArray.emplaceBack(Rr+1,Rr+2,Rr+3),te.vertexLength+=4,te.primitiveLength+=2}}}}if(te.vertexLength+j>_e.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(j,this.layoutVertexArray,this.indexArray)),xp[s.type]==="Polygon"){for(var gr=[],rn=[],on=te.vertexLength,kn=0,Gn=R;kn<Gn.length;kn+=1){var zn=Gn[kn];if(zn.length!==0){zn!==R[0]&&rn.push(gr.length/2);for(var Rn=0;Rn<zn.length;Rn++){var yi=zn[Rn];Os(this.layoutVertexArray,yi.x,yi.y,0,0,1,1,0),gr.push(yi.x),gr.push(yi.y)}}}for(var Jn=vp(gr,rn),Xn=0;Xn<Jn.length;Xn+=3)this.indexArray.emplaceBack(on+Jn[Xn],on+Jn[Xn+2],on+Jn[Xn+1]);te.primitiveLength+=Jn.length/3,te.vertexLength+=j}}var Ki;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},On("FillExtrusionBucket",Rs,{omit:["layers","features"]});var gu={paint:new Za({"fill-extrusion-opacity":new qn(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fn(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new qn(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new qn(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zs(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fn(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fn(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new qn(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},yv=function(s){function u(f){s.call(this,f,gu)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new Rs(f)},u.prototype.queryRadius=function(){return so(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(f,g,b,E,T,R,j,G){var $=cs(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,j),te=this.paint.get("fill-extrusion-height").evaluate(g,b),ne=this.paint.get("fill-extrusion-base").evaluate(g,b),Se=function(Le,ct,ft,Rt){for(var Ht=[],nr=0,Rr=Le;nr<Rr.length;nr+=1){var gr=Rr[nr],rn=[gr.x,gr.y,0,1];Cu(rn,rn,ct),Ht.push(new q(rn[0]/rn[3],rn[1]/rn[3]))}return Ht}($,G),Ve=function(Le,ct,ft,Rt){for(var Ht=[],nr=[],Rr=Rt[8]*ct,gr=Rt[9]*ct,rn=Rt[10]*ct,on=Rt[11]*ct,kn=Rt[8]*ft,Gn=Rt[9]*ft,zn=Rt[10]*ft,Rn=Rt[11]*ft,yi=0,Jn=Le;yi<Jn.length;yi+=1){for(var Xn=[],Ki=[],Mi=0,ya=Jn[yi];Mi<ya.length;Mi+=1){var li=ya[Mi],ta=li.x,Qa=li.y,Wa=Rt[0]*ta+Rt[4]*Qa+Rt[12],ho=Rt[1]*ta+Rt[5]*Qa+Rt[13],po=Rt[2]*ta+Rt[6]*Qa+Rt[14],Ao=Rt[3]*ta+Rt[7]*Qa+Rt[15],Is=po+rn,Go=Ao+on,qs=Wa+kn,Xo=ho+Gn,au=po+zn,ua=Ao+Rn,Ja=new q((Wa+Rr)/Go,(ho+gr)/Go);Ja.z=Is/Go,Xn.push(Ja);var bo=new q(qs/ua,Xo/ua);bo.z=au/ua,Ki.push(bo)}Ht.push(Xn),nr.push(Ki)}return[Ht,nr]}(E,ne,te,G);return function(Le,ct,ft){var Rt=1/0;_s(ft,ct)&&(Rt=_v(ft,ct[0]));for(var Ht=0;Ht<ct.length;Ht++)for(var nr=ct[Ht],Rr=Le[Ht],gr=0;gr<nr.length-1;gr++){var rn=nr[gr],on=[rn,nr[gr+1],Rr[gr+1],Rr[gr],rn];Yu(ft,on)&&(Rt=Math.min(Rt,_v(ft,on)))}return Rt!==1/0&&Rt}(Ve[0],Ve[1],Se)},u}(nu);function Gh(s,u){return s.x*u.x+s.y*u.y}function _v(s,u){if(s.length===1){for(var f,g=0,b=u[g++];!f||b.equals(f);)if(!(f=u[g++]))return 1/0;for(;g<u.length;g++){var E=u[g],T=s[0],R=f.sub(b),j=E.sub(b),G=T.sub(b),$=Gh(R,R),te=Gh(R,j),ne=Gh(j,j),Se=Gh(G,R),Ve=Gh(G,j),Le=$*ne-te*te,ct=(ne*Se-te*Ve)/Le,ft=($*Ve-te*Se)/Le,Rt=b.z*(1-ct-ft)+f.z*ct+E.z*ft;if(isFinite(Rt))return Rt}return 1/0}for(var Ht=1/0,nr=0,Rr=u;nr<Rr.length;nr+=1)Ht=Math.min(Ht,Rr[nr].z);return Ht}var Dm=Mo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,km=Mo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,bv=Xc.VectorTileFeature.types,Fm=Math.cos(Math.PI/180*37.5),xv=Math.pow(2,14)/.5,Ms=function(u){var f=this;this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(g){f.gradients[g.id]={}}),this.layoutVertexArray=new Ys,this.layoutVertexArray2=new cc,this.indexArray=new Au,this.programConfigurations=new _i(u.layers,u.zoom),this.segments=new _e,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id})};Ms.prototype.populate=function(s,u,f){this.hasPattern=vd("line",this.layers,u);for(var g=this.layers[0].layout.get("line-sort-key"),b=[],E=0,T=s;E<T.length;E+=1){var R=T[E],j=R.feature,G=R.id,$=R.index,te=R.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Se=Ya(j,ne);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),Se,f)){var Ve=g?g.evaluate(Se,{},f):void 0,Le={id:G,properties:j.properties,type:j.type,sourceLayerIndex:te,index:$,geometry:ne?Se.geometry:$a(j),patterns:{},sortKey:Ve};b.push(Le)}}g&&b.sort(function(rn,on){return rn.sortKey-on.sortKey});for(var ct=0,ft=b;ct<ft.length;ct+=1){var Rt=ft[ct],Ht=Rt.geometry,nr=Rt.index,Rr=Rt.sourceLayerIndex;if(this.hasPattern){var gr=md("line",this.layers,Rt,this.zoom,u);this.patternFeatures.push(gr)}else this.addFeature(Rt,Ht,nr,f,{});u.featureIndex.insert(s[nr].feature,Ht,nr,Rr,this.index)}},Ms.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},Ms.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var E=b[g];this.addFeature(E,E.geometry,E.index,u,f)}},Ms.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ms.prototype.upload=function(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,km)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ms.prototype.lineFeatureClips=function(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}},Ms.prototype.addFeature=function(s,u,f,g,b){var E=this.layers[0].layout,T=E.get("line-join").evaluate(s,{}),R=E.get("line-cap"),j=E.get("line-miter-limit"),G=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(var $=0,te=u;$<te.length;$+=1)this.addLine(te[$],s,T,R,j,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},Ms.prototype.addLine=function(s,u,f,g,b,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<s.length-1;T++)this.totalDistance+=s[T].dist(s[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var R=bv[u.type]==="Polygon",j=s.length;j>=2&&s[j-1].equals(s[j-2]);)j--;for(var G=0;G<j-1&&s[G].equals(s[G+1]);)G++;if(!(j<(R?3:2))){f==="bevel"&&(b=1.05);var $,te=this.overscaling<=16?122880/(512*this.overscaling):0,ne=this.segments.prepareSegment(10*j,this.layoutVertexArray,this.indexArray),Se=void 0,Ve=void 0,Le=void 0,ct=void 0;this.e1=this.e2=-1,R&&(ct=s[G].sub($=s[j-2])._unit()._perp());for(var ft=G;ft<j;ft++)if(!(Ve=ft===j-1?R?s[G+1]:void 0:s[ft+1])||!s[ft].equals(Ve)){ct&&(Le=ct),$&&(Se=$),$=s[ft],ct=Ve?Ve.sub($)._unit()._perp():Le;var Rt=(Le=Le||ct).add(ct);Rt.x===0&&Rt.y===0||Rt._unit();var Ht=Le.x*ct.x+Le.y*ct.y,nr=Rt.x*ct.x+Rt.y*ct.y,Rr=nr!==0?1/nr:1/0,gr=2*Math.sqrt(2-2*nr),rn=nr<Fm&&Se&&Ve,on=Le.x*ct.y-Le.y*ct.x>0;if(rn&&ft>G){var kn=$.dist(Se);if(kn>2*te){var Gn=$.sub($.sub(Se)._mult(te/kn)._round());this.updateDistance(Se,Gn),this.addCurrentVertex(Gn,Le,0,0,ne),Se=Gn}}var zn=Se&&Ve,Rn=zn?f:R?"butt":g;if(zn&&Rn==="round"&&(Rr<E?Rn="miter":Rr<=2&&(Rn="fakeround")),Rn==="miter"&&Rr>b&&(Rn="bevel"),Rn==="bevel"&&(Rr>2&&(Rn="flipbevel"),Rr<b&&(Rn="miter")),Se&&this.updateDistance(Se,$),Rn==="miter")Rt._mult(Rr),this.addCurrentVertex($,Rt,0,0,ne);else if(Rn==="flipbevel"){if(Rr>100)Rt=ct.mult(-1);else{var yi=Rr*Le.add(ct).mag()/Le.sub(ct).mag();Rt._perp()._mult(yi*(on?-1:1))}this.addCurrentVertex($,Rt,0,0,ne),this.addCurrentVertex($,Rt.mult(-1),0,0,ne)}else if(Rn==="bevel"||Rn==="fakeround"){var Jn=-Math.sqrt(Rr*Rr-1),Xn=on?Jn:0,Ki=on?0:Jn;if(Se&&this.addCurrentVertex($,Le,Xn,Ki,ne),Rn==="fakeround")for(var Mi=Math.round(180*gr/Math.PI/20),ya=1;ya<Mi;ya++){var li=ya/Mi;if(li!==.5){var ta=li-.5;li+=li*ta*(li-1)*((1.0904+Ht*(Ht*(3.55645-1.43519*Ht)-3.2452))*ta*ta+(.848013+Ht*(.215638*Ht-1.06021)))}var Qa=ct.sub(Le)._mult(li)._add(Le)._unit()._mult(on?-1:1);this.addHalfVertex($,Qa.x,Qa.y,!1,on,0,ne)}Ve&&this.addCurrentVertex($,ct,-Xn,-Ki,ne)}else if(Rn==="butt")this.addCurrentVertex($,Rt,0,0,ne);else if(Rn==="square"){var Wa=Se?1:-1;this.addCurrentVertex($,Rt,Wa,Wa,ne)}else Rn==="round"&&(Se&&(this.addCurrentVertex($,Le,0,0,ne),this.addCurrentVertex($,Le,1,1,ne,!0)),Ve&&(this.addCurrentVertex($,ct,-1,-1,ne,!0),this.addCurrentVertex($,ct,0,0,ne)));if(rn&&ft<j-1){var ho=$.dist(Ve);if(ho>2*te){var po=$.add(Ve.sub($)._mult(te/ho)._round());this.updateDistance($,po),this.addCurrentVertex(po,ct,0,0,ne),$=po}}}}},Ms.prototype.addCurrentVertex=function(s,u,f,g,b,E){E===void 0&&(E=!1);var T=u.y*g-u.x,R=-u.y-u.x*g;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,E,!1,f,b),this.addHalfVertex(s,T,R,E,!0,-g,b),this.distance>xv/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,u,f,g,b,E))},Ms.prototype.addHalfVertex=function(s,u,f,g,b,E,T){var R=.5*(this.lineClips?this.scaledDistance*(xv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s.x<<1)+(g?1:0),(s.y<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(E===0?0:E<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var j=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),T.primitiveLength++),b?this.e2=j:this.e1=j},Ms.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ms.prototype.updateDistance=function(s,u){this.distance+=s.dist(u),this.updateScaledDistance()},On("LineBucket",Ms,{omit:["layers","patternFeatures"]});var Bm=new Za({"line-cap":new qn(xe.layout_line["line-cap"]),"line-join":new Fn(xe.layout_line["line-join"]),"line-miter-limit":new qn(xe.layout_line["line-miter-limit"]),"line-round-limit":new qn(xe.layout_line["line-round-limit"]),"line-sort-key":new Fn(xe.layout_line["line-sort-key"])}),yd={paint:new Za({"line-opacity":new Fn(xe.paint_line["line-opacity"]),"line-color":new Fn(xe.paint_line["line-color"]),"line-translate":new qn(xe.paint_line["line-translate"]),"line-translate-anchor":new qn(xe.paint_line["line-translate-anchor"]),"line-width":new Fn(xe.paint_line["line-width"]),"line-gap-width":new Fn(xe.paint_line["line-gap-width"]),"line-offset":new Fn(xe.paint_line["line-offset"]),"line-blur":new Fn(xe.paint_line["line-blur"]),"line-dasharray":new us(xe.paint_line["line-dasharray"]),"line-pattern":new Zs(xe.paint_line["line-pattern"]),"line-gradient":new $s(xe.paint_line["line-gradient"])}),layout:Bm},_d=new(function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,g){return g=new Ti(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),s.prototype.possiblyEvaluate.call(this,f,g)},u.prototype.evaluate=function(f,g,b,E){return g=We({},g,{zoom:Math.floor(g.zoom)}),s.prototype.evaluate.call(this,f,g,b,E)},u}(Fn))(yd.paint.properties["line-width"].specification);_d.useIntegerZoom=!0;var Ev=function(s){function u(f){s.call(this,f,yd),this.gradientVersion=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof go,this.gradientVersion=(this.gradientVersion+1)%rt)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g),this.paint._values["line-floorwidth"]=_d.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},u.prototype.createBucket=function(f){return new Ms(f)},u.prototype.queryRadius=function(f){var g=f,b=Cf(ls("line-width",this,g),ls("line-gap-width",this,g)),E=ls("line-offset",this,g);return b/2+Math.abs(E)+so(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,E,T,R,j){var G=cs(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,j),$=j/2*Cf(this.paint.get("line-width").evaluate(g,b),this.paint.get("line-gap-width").evaluate(g,b)),te=this.paint.get("line-offset").evaluate(g,b);return te&&(E=function(ne,Se){for(var Ve=[],Le=new q(0,0),ct=0;ct<ne.length;ct++){for(var ft=ne[ct],Rt=[],Ht=0;Ht<ft.length;Ht++){var nr=ft[Ht],Rr=ft[Ht+1],gr=Ht===0?Le:nr.sub(ft[Ht-1])._unit()._perp(),rn=Ht===ft.length-1?Le:Rr.sub(nr)._unit()._perp(),on=gr._add(rn)._unit();on._mult(1/(on.x*rn.x+on.y*rn.y)),Rt.push(on._mult(Se)._add(nr))}Ve.push(Rt)}return Ve}(E,te*j)),function(ne,Se,Ve){for(var Le=0;Le<Se.length;Le++){var ct=Se[Le];if(ne.length>=3){for(var ft=0;ft<ct.length;ft++)if(mu(ne,ct[ft]))return!0}if(bs(ne,ct,Ve))return!0}return!1}(G,E,$)},u.prototype.isTileClipped=function(){return!0},u}(nu);function Cf(s,u){return u>0?u+2*s:s}var Sp=Mo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ap=Mo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Sv=(Mo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Mo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),bd=(Mo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Mo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Q=Mo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function de(s,u,f){return s.sections.forEach(function(g){g.text=function(b,E,T){var R=E.layout.get("text-transform").evaluate(T,{});return R==="uppercase"?b=b.toLocaleUpperCase():R==="lowercase"&&(b=b.toLocaleLowerCase()),js.applyArabicShaping&&(b=js.applyArabicShaping(b)),b}(g.text,u,f)}),s}Mo([{name:"triangle",components:3,type:"Uint16"}]),Mo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Mo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Mo([{type:"Float32",name:"offsetX"}]),Mo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var st={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},qt=function(u,f,g,b,E){var T,R,j=8*E-b-1,G=(1<<j)-1,$=G>>1,te=-7,ne=g?E-1:0,Se=g?-1:1,Ve=u[f+ne];for(ne+=Se,T=Ve&(1<<-te)-1,Ve>>=-te,te+=j;te>0;T=256*T+u[f+ne],ne+=Se,te-=8);for(R=T&(1<<-te)-1,T>>=-te,te+=b;te>0;R=256*R+u[f+ne],ne+=Se,te-=8);if(T===0)T=1-$;else{if(T===G)return R?NaN:1/0*(Ve?-1:1);R+=Math.pow(2,b),T-=$}return(Ve?-1:1)*R*Math.pow(2,T-b)},Sr=function(u,f,g,b,E,T){var R,j,G,$=8*T-E-1,te=(1<<$)-1,ne=te>>1,Se=E===23?Math.pow(2,-24)-Math.pow(2,-77):0,Ve=b?0:T-1,Le=b?1:-1,ct=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(j=isNaN(f)?1:0,R=te):(R=Math.floor(Math.log(f)/Math.LN2),f*(G=Math.pow(2,-R))<1&&(R--,G*=2),(f+=R+ne>=1?Se/G:Se*Math.pow(2,1-ne))*G>=2&&(R++,G/=2),R+ne>=te?(j=0,R=te):R+ne>=1?(j=(f*G-1)*Math.pow(2,E),R+=ne):(j=f*Math.pow(2,ne-1)*Math.pow(2,E),R=0));E>=8;u[g+Ve]=255&j,Ve+=Le,j/=256,E-=8);for(R=R<<E|j,$+=E;$>0;u[g+Ve]=255&R,Ve+=Le,R/=256,$-=8);u[g+Ve-Le]|=128*ct},_r=Bt;function Bt(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Bt.Varint=0,Bt.Fixed64=1,Bt.Bytes=2,Bt.Fixed32=5;var Ur=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function $r(s){return s.type===Bt.Bytes?s.readVarint()+s.pos:s.pos+1}function tn(s,u,f){return f?4294967296*u+(s>>>0):4294967296*(u>>>0)+(s>>>0)}function Kr(s,u,f){var g=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));f.realloc(g);for(var b=f.pos-1;b>=s;b--)f.buf[b+g]=f.buf[b]}function nn(s,u){for(var f=0;f<s.length;f++)u.writeVarint(s[f])}function mn(s,u){for(var f=0;f<s.length;f++)u.writeSVarint(s[f])}function sn(s,u){for(var f=0;f<s.length;f++)u.writeFloat(s[f])}function Yr(s,u){for(var f=0;f<s.length;f++)u.writeDouble(s[f])}function rr(s,u){for(var f=0;f<s.length;f++)u.writeBoolean(s[f])}function Qt(s,u){for(var f=0;f<s.length;f++)u.writeFixed32(s[f])}function Wr(s,u){for(var f=0;f<s.length;f++)u.writeSFixed32(s[f])}function bn(s,u){for(var f=0;f<s.length;f++)u.writeFixed64(s[f])}function xr(s,u){for(var f=0;f<s.length;f++)u.writeSFixed64(s[f])}function Zn(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+16777216*s[u+3]}function jr(s,u,f){s[f]=u,s[f+1]=u>>>8,s[f+2]=u>>>16,s[f+3]=u>>>24}function an(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+(s[u+3]<<24)}function Lr(s,u,f){s===1&&f.readMessage(un,u)}function un(s,u,f){if(s===3){var g=f.readMessage($n,{}),b=g.width,E=g.height,T=g.left,R=g.top,j=g.advance;u.push({id:g.id,bitmap:new qu({width:b+6,height:E+6},g.bitmap),metrics:{width:b,height:E,left:T,top:R,advance:j}})}}function $n(s,u,f){s===1?u.id=f.readVarint():s===2?u.bitmap=f.readBytes():s===3?u.width=f.readVarint():s===4?u.height=f.readVarint():s===5?u.left=f.readSVarint():s===6?u.top=f.readSVarint():s===7&&(u.advance=f.readVarint())}function bi(s){for(var u=0,f=0,g=0,b=s;g<b.length;g+=1){var E=b[g];u+=E.w*E.h,f=Math.max(f,E.w)}s.sort(function(Le,ct){return ct.h-Le.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),f),h:1/0}],R=0,j=0,G=0,$=s;G<$.length;G+=1)for(var te=$[G],ne=T.length-1;ne>=0;ne--){var Se=T[ne];if(!(te.w>Se.w||te.h>Se.h)){if(te.x=Se.x,te.y=Se.y,j=Math.max(j,te.y+te.h),R=Math.max(R,te.x+te.w),te.w===Se.w&&te.h===Se.h){var Ve=T.pop();ne<T.length&&(T[ne]=Ve)}else te.h===Se.h?(Se.x+=te.w,Se.w-=te.w):te.w===Se.w?(Se.y+=te.h,Se.h-=te.h):(T.push({x:Se.x+te.w,y:Se.y,w:Se.w-te.w,h:te.h}),Se.y+=te.h,Se.h-=te.h);break}}return{w:R,h:j,fill:u/(R*j)||0}}Bt.prototype={destroy:function(){this.buf=null},readFields:function(u,f,g){for(g=g||this.length;this.pos<g;){var b=this.readVarint(),E=b>>3,T=this.pos;this.type=7&b,u(E,f,this),this.pos===T&&this.skip(b)}return f},readMessage:function(u,f){return this.readFields(u,f,this.readVarint()+this.pos)},readFixed32:function(){var u=Zn(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=an(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Zn(this.buf,this.pos)+4294967296*Zn(this.buf,this.pos+4);return this.pos+=8,u},readSFixed64:function(){var u=Zn(this.buf,this.pos)+4294967296*an(this.buf,this.pos+4);return this.pos+=8,u},readFloat:function(){var u=qt(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=qt(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var f,g,b=this.buf;return f=127&(g=b[this.pos++]),g<128?f:(f|=(127&(g=b[this.pos++]))<<7,g<128?f:(f|=(127&(g=b[this.pos++]))<<14,g<128?f:(f|=(127&(g=b[this.pos++]))<<21,g<128?f:function(E,T,R){var j,G,$=R.buf;if(j=(112&(G=$[R.pos++]))>>4,G<128||(j|=(127&(G=$[R.pos++]))<<3,G<128)||(j|=(127&(G=$[R.pos++]))<<10,G<128)||(j|=(127&(G=$[R.pos++]))<<17,G<128)||(j|=(127&(G=$[R.pos++]))<<24,G<128)||(j|=(1&(G=$[R.pos++]))<<31,G<128))return tn(E,j,T);throw new Error("Expected varint not more than 10 bytes")}(f|=(15&(g=b[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var u=this.readVarint()+this.pos,f=this.pos;return this.pos=u,u-f>=12&&Ur?function(g,b,E){return Ur.decode(g.subarray(b,E))}(this.buf,f,u):function(g,b,E){for(var T="",R=b;R<E;){var j,G,$,te=g[R],ne=null,Se=te>239?4:te>223?3:te>191?2:1;if(R+Se>E)break;Se===1?te<128&&(ne=te):Se===2?(192&(j=g[R+1]))==128&&(ne=(31&te)<<6|63&j)<=127&&(ne=null):Se===3?(G=g[R+2],(192&(j=g[R+1]))==128&&(192&G)==128&&((ne=(15&te)<<12|(63&j)<<6|63&G)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):Se===4&&(G=g[R+2],$=g[R+3],(192&(j=g[R+1]))==128&&(192&G)==128&&(192&$)==128&&((ne=(15&te)<<18|(63&j)<<12|(63&G)<<6|63&$)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,Se=1):ne>65535&&(ne-=65536,T+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),T+=String.fromCharCode(ne),R+=Se}return T}(this.buf,f,u)},readBytes:function(){var u=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,u);return this.pos=u,f},readPackedVarint:function(u,f){if(this.type!==Bt.Bytes)return u.push(this.readVarint(f));var g=$r(this);for(u=u||[];this.pos<g;)u.push(this.readVarint(f));return u},readPackedSVarint:function(u){if(this.type!==Bt.Bytes)return u.push(this.readSVarint());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Bt.Bytes)return u.push(this.readBoolean());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Bt.Bytes)return u.push(this.readFloat());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Bt.Bytes)return u.push(this.readDouble());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Bt.Bytes)return u.push(this.readFixed32());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Bt.Bytes)return u.push(this.readSFixed32());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Bt.Bytes)return u.push(this.readFixed64());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Bt.Bytes)return u.push(this.readSFixed64());var f=$r(this);for(u=u||[];this.pos<f;)u.push(this.readSFixed64());return u},skip:function(u){var f=7&u;if(f===Bt.Varint)for(;this.buf[this.pos++]>127;);else if(f===Bt.Bytes)this.pos=this.readVarint()+this.pos;else if(f===Bt.Fixed32)this.pos+=4;else{if(f!==Bt.Fixed64)throw new Error("Unimplemented type: "+f);this.pos+=8}},writeTag:function(u,f){this.writeVarint(u<<3|f)},realloc:function(u){for(var f=this.length||16;f<this.pos+u;)f*=2;if(f!==this.length){var g=new Uint8Array(f);g.set(this.buf),this.buf=g,this.length=f}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),jr(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),jr(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),jr(this.buf,-1&u,this.pos),jr(this.buf,Math.floor(u*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),jr(this.buf,-1&u,this.pos),jr(this.buf,Math.floor(u*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(f,g){var b,E;if(f>=0?(b=f%4294967296|0,E=f/4294967296|0):(E=~(-f/4294967296),4294967295^(b=~(-f%4294967296))?b=b+1|0:(b=0,E=E+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(T,R,j){j.buf[j.pos++]=127&T|128,T>>>=7,j.buf[j.pos++]=127&T|128,T>>>=7,j.buf[j.pos++]=127&T|128,T>>>=7,j.buf[j.pos++]=127&T|128,j.buf[j.pos]=127&(T>>>=7)}(b,0,g),function(T,R){var j=(7&T)<<4;R.buf[R.pos++]|=j|((T>>>=3)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T)))))}(E,g)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(Boolean(u))},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var f=this.pos;this.pos=function(b,E,T){for(var R,j,G=0;G<E.length;G++){if((R=E.charCodeAt(G))>55295&&R<57344){if(!j){R>56319||G+1===E.length?(b[T++]=239,b[T++]=191,b[T++]=189):j=R;continue}if(R<56320){b[T++]=239,b[T++]=191,b[T++]=189,j=R;continue}R=j-55296<<10|R-56320|65536,j=null}else j&&(b[T++]=239,b[T++]=191,b[T++]=189,j=null);R<128?b[T++]=R:(R<2048?b[T++]=R>>6|192:(R<65536?b[T++]=R>>12|224:(b[T++]=R>>18|240,b[T++]=R>>12&63|128),b[T++]=R>>6&63|128),b[T++]=63&R|128)}return T}(this.buf,u,this.pos);var g=this.pos-f;g>=128&&Kr(f,g,this),this.pos=f-1,this.writeVarint(g),this.pos+=g},writeFloat:function(u){this.realloc(4),Sr(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),Sr(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var f=u.length;this.writeVarint(f),this.realloc(f);for(var g=0;g<f;g++)this.buf[this.pos++]=u[g]},writeRawMessage:function(u,f){this.pos++;var g=this.pos;u(f,this);var b=this.pos-g;b>=128&&Kr(g,b,this),this.pos=g-1,this.writeVarint(b),this.pos+=b},writeMessage:function(u,f,g){this.writeTag(u,Bt.Bytes),this.writeRawMessage(f,g)},writePackedVarint:function(u,f){f.length&&this.writeMessage(u,nn,f)},writePackedSVarint:function(u,f){f.length&&this.writeMessage(u,mn,f)},writePackedBoolean:function(u,f){f.length&&this.writeMessage(u,rr,f)},writePackedFloat:function(u,f){f.length&&this.writeMessage(u,sn,f)},writePackedDouble:function(u,f){f.length&&this.writeMessage(u,Yr,f)},writePackedFixed32:function(u,f){f.length&&this.writeMessage(u,Qt,f)},writePackedSFixed32:function(u,f){f.length&&this.writeMessage(u,Wr,f)},writePackedFixed64:function(u,f){f.length&&this.writeMessage(u,bn,f)},writePackedSFixed64:function(u,f){f.length&&this.writeMessage(u,xr,f)},writeBytesField:function(u,f){this.writeTag(u,Bt.Bytes),this.writeBytes(f)},writeFixed32Field:function(u,f){this.writeTag(u,Bt.Fixed32),this.writeFixed32(f)},writeSFixed32Field:function(u,f){this.writeTag(u,Bt.Fixed32),this.writeSFixed32(f)},writeFixed64Field:function(u,f){this.writeTag(u,Bt.Fixed64),this.writeFixed64(f)},writeSFixed64Field:function(u,f){this.writeTag(u,Bt.Fixed64),this.writeSFixed64(f)},writeVarintField:function(u,f){this.writeTag(u,Bt.Varint),this.writeVarint(f)},writeSVarintField:function(u,f){this.writeTag(u,Bt.Varint),this.writeSVarint(f)},writeStringField:function(u,f){this.writeTag(u,Bt.Bytes),this.writeString(f)},writeFloatField:function(u,f){this.writeTag(u,Bt.Fixed32),this.writeFloat(f)},writeDoubleField:function(u,f){this.writeTag(u,Bt.Fixed64),this.writeDouble(f)},writeBooleanField:function(u,f){this.writeVarintField(u,Boolean(f))}};var fn=function(u,f){var g=f.pixelRatio,b=f.version,E=f.stretchX,T=f.stretchY,R=f.content;this.paddedRect=u,this.pixelRatio=g,this.stretchX=E,this.stretchY=T,this.content=R,this.version=b},Gr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gr.tlbr.get=function(){return this.tl.concat(this.br)},Gr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(fn.prototype,Gr);var Pr=function(u,f){var g={},b={};this.haveRenderCallbacks=[];var E=[];this.addImages(u,g,E),this.addImages(f,b,E);var T=bi(E),R=new zs({width:T.w||1,height:T.h||1});for(var j in u){var G=u[j],$=g[j].paddedRect;zs.copy(G.data,R,{x:0,y:0},{x:$.x+1,y:$.y+1},G.data)}for(var te in f){var ne=f[te],Se=b[te].paddedRect,Ve=Se.x+1,Le=Se.y+1,ct=ne.data.width,ft=ne.data.height;zs.copy(ne.data,R,{x:0,y:0},{x:Ve,y:Le},ne.data),zs.copy(ne.data,R,{x:0,y:ft-1},{x:Ve,y:Le-1},{width:ct,height:1}),zs.copy(ne.data,R,{x:0,y:0},{x:Ve,y:Le+ft},{width:ct,height:1}),zs.copy(ne.data,R,{x:ct-1,y:0},{x:Ve-1,y:Le},{width:1,height:ft}),zs.copy(ne.data,R,{x:0,y:0},{x:Ve+ct,y:Le},{width:1,height:ft})}this.image=R,this.iconPositions=g,this.patternPositions=b};Pr.prototype.addImages=function(s,u,f){for(var g in s){var b=s[g],E={x:0,y:0,w:b.data.width+2,h:b.data.height+2};f.push(E),u[g]=new fn(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}},Pr.prototype.patchUpdatedImages=function(s,u){for(var f in s.dispatchRenderCallbacks(this.haveRenderCallbacks),s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)},Pr.prototype.patchUpdatedImage=function(s,u,f){if(s&&u&&s.version!==u.version){s.version=u.version;var g=s.tl;f.update(u.data,void 0,{x:g[0],y:g[1]})}},On("ImagePosition",fn),On("ImageAtlas",Pr);var Qn={horizontal:1,vertical:2,horizontalOnly:3},Vi=function(){this.scale=1,this.fontStack="",this.imageName=null};Vi.forText=function(s,u){var f=new Vi;return f.scale=s||1,f.fontStack=u,f},Vi.forImage=function(s){var u=new Vi;return u.imageName=s,u};var En=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function wi(s,u,f,g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le){var ct,ft=En.fromFeature(s,b);te===Qn.vertical&&ft.verticalizePunctuation();var Rt=js.processBidirectionalText,Ht=js.processStyledBidirectionalText;if(Rt&&ft.sections.length===1){ct=[];for(var nr=0,Rr=Rt(ft.toString(),Do(ft,G,E,u,g,Se,Ve));nr<Rr.length;nr+=1){var gr=Rr[nr],rn=new En;rn.text=gr,rn.sections=ft.sections;for(var on=0;on<gr.length;on++)rn.sectionIndex.push(0);ct.push(rn)}}else if(Ht){ct=[];for(var kn=0,Gn=Ht(ft.text,ft.sectionIndex,Do(ft,G,E,u,g,Se,Ve));kn<Gn.length;kn+=1){var zn=Gn[kn],Rn=new En;Rn.text=zn[0],Rn.sectionIndex=zn[1],Rn.sections=ft.sections,ct.push(Rn)}}else ct=function(Xn,Ki){for(var Mi=[],ya=Xn.text,li=0,ta=0,Qa=Ki;ta<Qa.length;ta+=1){var Wa=Qa[ta];Mi.push(Xn.substring(li,Wa)),li=Wa}return li<ya.length&&Mi.push(Xn.substring(li,ya.length)),Mi}(ft,Do(ft,G,E,u,g,Se,Ve));var yi=[],Jn={positionedLines:yi,text:ft.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(Xn,Ki,Mi,ya,li,ta,Qa,Wa,ho,po,Ao,Is){for(var Go=0,qs=-17,Xo=0,au=0,ua=Wa==="right"?1:Wa==="left"?0:.5,Ja=0,bo=0,na=li;bo<na.length;bo+=1){var Li=na[bo];Li.trim();var va=Li.getMaxScale(),Na=24*(va-1),ou={positionedGlyphs:[],lineOffset:0};Xn.positionedLines[Ja]=ou;var eo=ou.positionedGlyphs,to=0;if(Li.length()){for(var ds=0;ds<Li.length();ds++){var ia=Li.getSection(ds),Rf=Li.getSectionIndex(ds),Sl=Li.getCharCode(ds),mc=0,Qu=null,Ts=null,uh=null,gc=24,Zc=!(ho===Qn.horizontal||!Ao&&!gf(Sl)||Ao&&(gi[Sl]||(Yc=Sl,cn.Arabic(Yc)||cn["Arabic Supplement"](Yc)||cn["Arabic Extended-A"](Yc)||cn["Arabic Presentation Forms-A"](Yc)||cn["Arabic Presentation Forms-B"](Yc))));if(ia.imageName){var Td=ya[ia.imageName];if(!Td)continue;uh=ia.imageName,Xn.iconsInText=Xn.iconsInText||!0,Ts=Td.paddedRect;var $c=Td.displaySize;ia.scale=24*ia.scale/Is,mc=Na+(24-$c[1]*ia.scale),gc=(Qu={width:$c[0],height:$c[1],left:1,top:-3,advance:Zc?$c[1]:$c[0]}).advance;var Mf=Zc?$c[0]*ia.scale-24*va:$c[1]*ia.scale-24*va;Mf>0&&Mf>to&&(to=Mf)}else{var Cd=Mi[ia.fontStack],Cp=Cd&&Cd[Sl];if(Cp&&Cp.rect)Ts=Cp.rect,Qu=Cp.metrics;else{var Vm=Ki[ia.fontStack],wd=Vm&&Vm[Sl];if(!wd)continue;Qu=wd.metrics}mc=24*(va-ia.scale)}Zc?(Xn.verticalizable=!0,eo.push({glyph:Sl,imageName:uh,x:Go,y:qs+mc,vertical:Zc,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Rf,metrics:Qu,rect:Ts}),Go+=gc*ia.scale+po):(eo.push({glyph:Sl,imageName:uh,x:Go,y:qs+mc,vertical:Zc,scale:ia.scale,fontStack:ia.fontStack,sectionIndex:Rf,metrics:Qu,rect:Ts}),Go+=Qu.advance*ia.scale+po)}eo.length!==0&&(Xo=Math.max(Go-po,Xo),ko(eo,0,eo.length-1,ua,to)),Go=0;var Hm=ta*va+to;ou.lineOffset=Math.max(to,Na),qs+=Hm,au=Math.max(Hm,au),++Ja}else qs+=ta,++Ja}var Yc,wp=qs- -17,wv=Pa(Qa),Op=wv.horizontalAlign,lh=wv.verticalAlign;(function(Ov,Od,Rp,Kh,Rv,Ju,Mp,Mv,Rd){var qh,Md=(Od-Rp)*Rv;qh=Ju!==Mp?-Mv*Kh- -17:(-Kh*Rd+.5)*Mp;for(var Kc=0,Pd=Ov;Kc<Pd.length;Kc+=1)for(var ch=0,Pp=Pd[Kc].positionedGlyphs;ch<Pp.length;ch+=1){var fh=Pp[ch];fh.x+=Md,fh.y+=qh}})(Xn.positionedLines,ua,Op,lh,Xo,au,ta,wp,li.length),Xn.top+=-lh*wp,Xn.bottom=Xn.top+wp,Xn.left+=-Op*Xo,Xn.right=Xn.left+Xo}(Jn,u,f,g,ct,T,R,j,te,G,ne,Le),!function(Xn){for(var Ki=0,Mi=Xn;Ki<Mi.length;Ki+=1)if(Mi[Ki].positionedGlyphs.length!==0)return!1;return!0}(yi)&&Jn}En.fromFeature=function(s,u){for(var f=new En,g=0;g<s.sections.length;g++){var b=s.sections[g];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f},En.prototype.length=function(){return this.text.length},En.prototype.getSection=function(s){return this.sections[this.sectionIndex[s]]},En.prototype.getSectionIndex=function(s){return this.sectionIndex[s]},En.prototype.getCharCode=function(s){return this.text.charCodeAt(s)},En.prototype.verticalizePunctuation=function(){this.text=function(s){for(var u="",f=0;f<s.length;f++){var g=s.charCodeAt(f+1)||null,b=s.charCodeAt(f-1)||null;u+=g&&Kf(g)&&!st[s[f+1]]||b&&Kf(b)&&!st[s[f-1]]||!st[s[f]]?s[f]:st[s[f]]}return u}(this.text)},En.prototype.trim=function(){for(var s=0,u=0;u<this.text.length&&gi[this.text.charCodeAt(u)];u++)s++;for(var f=this.text.length,g=this.text.length-1;g>=0&&g>=s&&gi[this.text.charCodeAt(g)];g--)f--;this.text=this.text.substring(s,f),this.sectionIndex=this.sectionIndex.slice(s,f)},En.prototype.substring=function(s,u){var f=new En;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f},En.prototype.toString=function(){return this.text},En.prototype.getMaxScale=function(){var s=this;return this.sectionIndex.reduce(function(u,f){return Math.max(u,s.sections[f].scale)},0)},En.prototype.addTextSection=function(s,u){this.text+=s.text,this.sections.push(Vi.forText(s.scale,s.fontStack||u));for(var f=this.sections.length-1,g=0;g<s.text.length;++g)this.sectionIndex.push(f)},En.prototype.addImageSection=function(s){var u=s.image?s.image.name:"";if(u.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Vi.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ut("Reached maximum number of images 6401")}else Ut("Can't add FormattedSection with an empty image.")},En.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var gi={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},si={};function oa(s,u,f,g,b,E){if(u.imageName){var T=g[u.imageName];return T?T.displaySize[0]*u.scale*24/E+b:0}var R=f[u.fontStack],j=R&&R[s];return j?j.metrics.advance*u.scale+b:0}function Io(s,u,f,g){var b=Math.pow(s-u,2);return g?s<u?b/2:2*b:b+Math.abs(f)*f}function hs(s,u,f){var g=0;return s===10&&(g-=1e4),f&&(g+=150),s!==40&&s!==65288||(g+=50),u!==41&&u!==65289||(g+=50),g}function Gi(s,u,f,g,b,E){for(var T=null,R=Io(u,f,b,E),j=0,G=g;j<G.length;j+=1){var $=G[j],te=Io(u-$.x,f,b,E)+$.badness;te<=R&&(T=$,R=te)}return{index:s,x:u,priorBreak:T,badness:R}}function Do(s,u,f,g,b,E,T){if(E!=="point")return[];if(!s)return[];for(var R,j=[],G=function(ct,ft,Rt,Ht,nr,Rr){for(var gr=0,rn=0;rn<ct.length();rn++){var on=ct.getSection(rn);gr+=oa(ct.getCharCode(rn),on,Ht,nr,ft,Rr)}return gr/Math.max(1,Math.ceil(gr/Rt))}(s,u,f,g,b,T),$=s.text.indexOf("\u200B")>=0,te=0,ne=0;ne<s.length();ne++){var Se=s.getSection(ne),Ve=s.getCharCode(ne);if(gi[Ve]||(te+=oa(Ve,Se,g,b,u,T)),ne<s.length()-1){var Le=!((R=Ve)<11904||!(cn["Bopomofo Extended"](R)||cn.Bopomofo(R)||cn["CJK Compatibility Forms"](R)||cn["CJK Compatibility Ideographs"](R)||cn["CJK Compatibility"](R)||cn["CJK Radicals Supplement"](R)||cn["CJK Strokes"](R)||cn["CJK Symbols and Punctuation"](R)||cn["CJK Unified Ideographs Extension A"](R)||cn["CJK Unified Ideographs"](R)||cn["Enclosed CJK Letters and Months"](R)||cn["Halfwidth and Fullwidth Forms"](R)||cn.Hiragana(R)||cn["Ideographic Description Characters"](R)||cn["Kangxi Radicals"](R)||cn["Katakana Phonetic Extensions"](R)||cn.Katakana(R)||cn["Vertical Forms"](R)||cn["Yi Radicals"](R)||cn["Yi Syllables"](R)));(si[Ve]||Le||Se.imageName)&&j.push(Gi(ne+1,te,G,j,hs(Ve,s.getCharCode(ne+1),Le&&$),!1))}}return function ct(ft){return ft?ct(ft.priorBreak).concat(ft.index):[]}(Gi(s.length(),te,G,j,0,!0))}function Pa(s){var u=.5,f=.5;switch(s){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:u,verticalAlign:f}}function ko(s,u,f,g,b){if(g||b)for(var E=s[f],T=(s[f].x+E.metrics.advance*E.scale)*g,R=u;R<=f;R++)s[R].x-=T,s[R].y+=b}function Fo(s,u,f,g,b,E){var T,R=s.image;if(R.content){var j=R.content,G=R.pixelRatio||1;T=[j[0]/G,j[1]/G,R.displaySize[0]-j[2]/G,R.displaySize[1]-j[3]/G]}var $,te,ne,Se,Ve=u.left*E,Le=u.right*E;f==="width"||f==="both"?(Se=b[0]+Ve-g[3],te=b[0]+Le+g[1]):te=(Se=b[0]+(Ve+Le-R.displaySize[0])/2)+R.displaySize[0];var ct=u.top*E,ft=u.bottom*E;return f==="height"||f==="both"?($=b[1]+ct-g[0],ne=b[1]+ft+g[2]):ne=($=b[1]+(ct+ft-R.displaySize[1])/2)+R.displaySize[1],{image:R,top:$,right:te,bottom:ne,left:Se,collisionPadding:T}}si[10]=!0,si[32]=!0,si[38]=!0,si[40]=!0,si[41]=!0,si[43]=!0,si[45]=!0,si[47]=!0,si[173]=!0,si[183]=!0,si[8203]=!0,si[8208]=!0,si[8211]=!0,si[8231]=!0;var uo=function(s){function u(f,g,b,E){s.call(this,f,g),this.angle=b,E!==void 0&&(this.segment=E)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(q);function ts(s,u){var f=u.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Ti(s+1))};if(f.kind==="source")return{kind:"source"};for(var g=f.zoomStops,b=f.interpolationType,E=0;E<g.length&&g[E]<=s;)E++;for(var T=E=Math.max(0,E-1);T<g.length&&g[T]<s+1;)T++;T=Math.min(g.length-1,T);var R=g[E],j=g[T];return f.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:j,interpolationType:b}:{kind:"camera",minZoom:R,maxZoom:j,minSize:f.evaluate(new Ti(R)),maxSize:f.evaluate(new Ti(j)),interpolationType:b}}function Ps(s,u,f){var g=u.uSize,b=f.lowerSize;return s.kind==="source"?b/128:s.kind==="composite"?Xa(b/128,f.upperSize/128,u.uSizeT):g}function Vo(s,u){var f=0,g=0;if(s.kind==="constant")g=s.layoutSize;else if(s.kind!=="source"){var b=s.interpolationType,E=b?wt(hn.interpolationFactor(b,u,s.minZoom,s.maxZoom),0,1):0;s.kind==="camera"?g=Xa(s.minSize,s.maxSize,E):f=E}return{uSizeT:f,uSize:g}}On("Anchor",uo);var ki=Object.freeze({__proto__:null,getSizeData:ts,evaluateSizeForFeature:Ps,evaluateSizeForZoom:Vo,SIZE_PACK_FACTOR:128});function Ss(s,u,f,g,b){if(u.segment===void 0)return!0;for(var E=u,T=u.segment+1,R=0;R>-f/2;){if(--T<0)return!1;R-=s[T].dist(E),E=s[T]}R+=s[T].dist(s[T+1]),T++;for(var j=[],G=0;R<f/2;){var $=s[T],te=s[T+1];if(!te)return!1;var ne=s[T-1].angleTo($)-$.angleTo(te);for(ne=Math.abs((ne+3*Math.PI)%(2*Math.PI)-Math.PI),j.push({distance:R,angleDelta:ne}),G+=ne;R-j[0].distance>g;)G-=j.shift().angleDelta;if(G>b)return!1;T++,R+=$.dist(te)}return!0}function ha(s){for(var u=0,f=0;f<s.length-1;f++)u+=s[f].dist(s[f+1]);return u}function ui(s,u,f){return s?.6*u*f:0}function Oi(s,u){return Math.max(s?s.right-s.left:0,u?u.right-u.left:0)}function ra(s,u,f,g,b,E){for(var T=ui(f,b,E),R=Oi(f,g)*E,j=0,G=ha(s)/2,$=0;$<s.length-1;$++){var te=s[$],ne=s[$+1],Se=te.dist(ne);if(j+Se>G){var Ve=(G-j)/Se,Le=Xa(te.x,ne.x,Ve),ct=Xa(te.y,ne.y,Ve),ft=new uo(Le,ct,ne.angleTo(te),$);return ft._round(),!T||Ss(s,ft,R,T,u)?ft:void 0}j+=Se}}function ps(s,u,f,g,b,E,T,R,j){var G=ui(g,E,T),$=Oi(g,b),te=$*T,ne=s[0].x===0||s[0].x===j||s[0].y===0||s[0].y===j;return u-te<u/4&&(u=te+u/4),function Se(Ve,Le,ct,ft,Rt,Ht,nr,Rr,gr){for(var rn=Ht/2,on=ha(Ve),kn=0,Gn=Le-ct,zn=[],Rn=0;Rn<Ve.length-1;Rn++){for(var yi=Ve[Rn],Jn=Ve[Rn+1],Xn=yi.dist(Jn),Ki=Jn.angleTo(yi);Gn+ct<kn+Xn;){var Mi=((Gn+=ct)-kn)/Xn,ya=Xa(yi.x,Jn.x,Mi),li=Xa(yi.y,Jn.y,Mi);if(ya>=0&&ya<gr&&li>=0&&li<gr&&Gn-rn>=0&&Gn+rn<=on){var ta=new uo(ya,li,Ki,Rn);ta._round(),ft&&!Ss(Ve,ta,Ht,ft,Rt)||zn.push(ta)}}kn+=Xn}return Rr||zn.length||nr||(zn=Se(Ve,kn/2,ct,ft,Rt,Ht,nr,!0,gr)),zn}(s,ne?u/2*R%u:($/2+2*E)*T*R%u,u,G,f,te,ne,!1,j)}function Us(s,u,f,g,b){for(var E=[],T=0;T<s.length;T++)for(var R=s[T],j=void 0,G=0;G<R.length-1;G++){var $=R[G],te=R[G+1];$.x<u&&te.x<u||($.x<u?$=new q(u,$.y+(u-$.x)/(te.x-$.x)*(te.y-$.y))._round():te.x<u&&(te=new q(u,$.y+(u-$.x)/(te.x-$.x)*(te.y-$.y))._round()),$.y<f&&te.y<f||($.y<f?$=new q($.x+(f-$.y)/(te.y-$.y)*(te.x-$.x),f)._round():te.y<f&&(te=new q($.x+(f-$.y)/(te.y-$.y)*(te.x-$.x),f)._round()),$.x>=g&&te.x>=g||($.x>=g?$=new q(g,$.y+(g-$.x)/(te.x-$.x)*(te.y-$.y))._round():te.x>=g&&(te=new q(g,$.y+(g-$.x)/(te.x-$.x)*(te.y-$.y))._round()),$.y>=b&&te.y>=b||($.y>=b?$=new q($.x+(b-$.y)/(te.y-$.y)*(te.x-$.x),b)._round():te.y>=b&&(te=new q($.x+(b-$.y)/(te.y-$.y)*(te.x-$.x),b)._round()),j&&$.equals(j[j.length-1])||E.push(j=[$]),j.push(te)))))}return E}function Ze(s,u,f,g){var b=[],E=s.image,T=E.pixelRatio,R=E.paddedRect.w-2,j=E.paddedRect.h-2,G=s.right-s.left,$=s.bottom-s.top,te=E.stretchX||[[0,R]],ne=E.stretchY||[[0,j]],Se=function(li,ta){return li+ta[1]-ta[0]},Ve=te.reduce(Se,0),Le=ne.reduce(Se,0),ct=R-Ve,ft=j-Le,Rt=0,Ht=Ve,nr=0,Rr=Le,gr=0,rn=ct,on=0,kn=ft;if(E.content&&g){var Gn=E.content;Rt=fr(te,0,Gn[0]),nr=fr(ne,0,Gn[1]),Ht=fr(te,Gn[0],Gn[2]),Rr=fr(ne,Gn[1],Gn[3]),gr=Gn[0]-Rt,on=Gn[1]-nr,rn=Gn[2]-Gn[0]-Ht,kn=Gn[3]-Gn[1]-Rr}var zn=function(li,ta,Qa,Wa){var ho=Sn(li.stretch-Rt,Ht,G,s.left),po=Ri(li.fixed-gr,rn,li.stretch,Ve),Ao=Sn(ta.stretch-nr,Rr,$,s.top),Is=Ri(ta.fixed-on,kn,ta.stretch,Le),Go=Sn(Qa.stretch-Rt,Ht,G,s.left),qs=Ri(Qa.fixed-gr,rn,Qa.stretch,Ve),Xo=Sn(Wa.stretch-nr,Rr,$,s.top),au=Ri(Wa.fixed-on,kn,Wa.stretch,Le),ua=new q(ho,Ao),Ja=new q(Go,Ao),bo=new q(Go,Xo),na=new q(ho,Xo),Li=new q(po/T,Is/T),va=new q(qs/T,au/T),Na=u*Math.PI/180;if(Na){var ou=Math.sin(Na),eo=Math.cos(Na),to=[eo,-ou,ou,eo];ua._matMult(to),Ja._matMult(to),na._matMult(to),bo._matMult(to)}var ds=li.stretch+li.fixed,ia=ta.stretch+ta.fixed;return{tl:ua,tr:Ja,bl:na,br:bo,tex:{x:E.paddedRect.x+1+ds,y:E.paddedRect.y+1+ia,w:Qa.stretch+Qa.fixed-ds,h:Wa.stretch+Wa.fixed-ia},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Li,pixelOffsetBR:va,minFontScaleX:rn/T/G,minFontScaleY:kn/T/$,isSDF:f}};if(g&&(E.stretchX||E.stretchY))for(var Rn=Kt(te,ct,Ve),yi=Kt(ne,ft,Le),Jn=0;Jn<Rn.length-1;Jn++)for(var Xn=Rn[Jn],Ki=Rn[Jn+1],Mi=0;Mi<yi.length-1;Mi++)b.push(zn(Xn,yi[Mi],Ki,yi[Mi+1]));else b.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:j+1}));return b}function fr(s,u,f){for(var g=0,b=0,E=s;b<E.length;b+=1){var T=E[b];g+=Math.max(u,Math.min(f,T[1]))-Math.max(u,Math.min(f,T[0]))}return g}function Kt(s,u,f){for(var g=[{fixed:-1,stretch:0}],b=0,E=s;b<E.length;b+=1){var T=E[b],R=T[0],j=T[1],G=g[g.length-1];g.push({fixed:R-G.stretch,stretch:G.stretch}),g.push({fixed:R-G.stretch,stretch:G.stretch+(j-R)})}return g.push({fixed:u+1,stretch:f}),g}function Sn(s,u,f,g){return s/u*f+g}function Ri(s,u,f,g){return s-u*f/g}var xa=function(u,f,g,b,E,T,R,j,G,$){if(this.boxStartIndex=u.length,G){var te=T.top,ne=T.bottom,Se=T.collisionPadding;Se&&(te-=Se[1],ne+=Se[3]);var Ve=ne-te;Ve>0&&(Ve=Math.max(10,Ve),this.circleDiameter=Ve)}else{var Le=T.top*R-j,ct=T.bottom*R+j,ft=T.left*R-j,Rt=T.right*R+j,Ht=T.collisionPadding;if(Ht&&(ft-=Ht[0]*R,Le-=Ht[1]*R,Rt+=Ht[2]*R,ct+=Ht[3]*R),$){var nr=new q(ft,Le),Rr=new q(Rt,Le),gr=new q(ft,ct),rn=new q(Rt,ct),on=$*Math.PI/180;nr._rotate(on),Rr._rotate(on),gr._rotate(on),rn._rotate(on),ft=Math.min(nr.x,Rr.x,gr.x,rn.x),Rt=Math.max(nr.x,Rr.x,gr.x,rn.x),Le=Math.min(nr.y,Rr.y,gr.y,rn.y),ct=Math.max(nr.y,Rr.y,gr.y,rn.y)}u.emplaceBack(f.x,f.y,ft,Le,Rt,ct,g,b,E)}this.boxEndIndex=u.length},ye=function(u,f){if(u===void 0&&(u=[]),f===void 0&&(f=ke),this.data=u,this.length=this.data.length,this.compare=f,this.length>0)for(var g=(this.length>>1)-1;g>=0;g--)this._down(g)};function ke(s,u){return s<u?-1:s>u?1:0}function it(s,u,f){u===void 0&&(u=1),f===void 0&&(f=!1);for(var g=1/0,b=1/0,E=-1/0,T=-1/0,R=s[0],j=0;j<R.length;j++){var G=R[j];(!j||G.x<g)&&(g=G.x),(!j||G.y<b)&&(b=G.y),(!j||G.x>E)&&(E=G.x),(!j||G.y>T)&&(T=G.y)}var $=Math.min(E-g,T-b),te=$/2,ne=new ye([],er);if($===0)return new q(g,b);for(var Se=g;Se<E;Se+=$)for(var Ve=b;Ve<T;Ve+=$)ne.push(new $t(Se+te,Ve+te,te,s));for(var Le=function(Rt){for(var Ht=0,nr=0,Rr=0,gr=Rt[0],rn=0,on=gr.length,kn=on-1;rn<on;kn=rn++){var Gn=gr[rn],zn=gr[kn],Rn=Gn.x*zn.y-zn.x*Gn.y;nr+=(Gn.x+zn.x)*Rn,Rr+=(Gn.y+zn.y)*Rn,Ht+=3*Rn}return new $t(nr/Ht,Rr/Ht,0,Rt)}(s),ct=ne.length;ne.length;){var ft=ne.pop();(ft.d>Le.d||!Le.d)&&(Le=ft,f&&console.log("found best %d after %d probes",Math.round(1e4*ft.d)/1e4,ct)),ft.max-Le.d<=u||(ne.push(new $t(ft.p.x-(te=ft.h/2),ft.p.y-te,te,s)),ne.push(new $t(ft.p.x+te,ft.p.y-te,te,s)),ne.push(new $t(ft.p.x-te,ft.p.y+te,te,s)),ne.push(new $t(ft.p.x+te,ft.p.y+te,te,s)),ct+=4)}return f&&(console.log("num probes: "+ct),console.log("best distance: "+Le.d)),Le.p}function er(s,u){return u.max-s.max}function $t(s,u,f,g){this.p=new q(s,u),this.h=f,this.d=function(b,E){for(var T=!1,R=1/0,j=0;j<E.length;j++)for(var G=E[j],$=0,te=G.length,ne=te-1;$<te;ne=$++){var Se=G[$],Ve=G[ne];Se.y>b.y!=Ve.y>b.y&&b.x<(Ve.x-Se.x)*(b.y-Se.y)/(Ve.y-Se.y)+Se.x&&(T=!T),R=Math.min(R,Gl(b,Se,Ve))}return(T?1:-1)*Math.sqrt(R)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}ye.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},ye.prototype.pop=function(){if(this.length!==0){var s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}},ye.prototype.peek=function(){return this.data[0]},ye.prototype._up=function(s){for(var u=this.data,f=this.compare,g=u[s];s>0;){var b=s-1>>1,E=u[b];if(f(g,E)>=0)break;u[s]=E,s=b}u[s]=g},ye.prototype._down=function(s){for(var u=this.data,f=this.compare,g=this.length>>1,b=u[s];s<g;){var E=1+(s<<1),T=u[E],R=E+1;if(R<this.length&&f(u[R],T)<0&&(E=R,T=u[R]),f(T,b)>=0)break;u[s]=T,s=E}u[s]=b};var gt=Number.POSITIVE_INFINITY;function Et(s,u){return u[1]!==gt?function(f,g,b){var E=0,T=0;switch(g=Math.abs(g),b=Math.abs(b),f){case"top-right":case"top-left":case"top":T=b-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-b}switch(f){case"top-right":case"bottom-right":case"right":E=-g;break;case"top-left":case"bottom-left":case"left":E=g}return[E,T]}(s,u[0],u[1]):function(f,g){var b=0,E=0;g<0&&(g=0);var T=g/Math.sqrt(2);switch(f){case"top-right":case"top-left":E=T-7;break;case"bottom-right":case"bottom-left":E=7-T;break;case"bottom":E=7-g;break;case"top":E=g-7}switch(f){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=g;break;case"right":b=-g}return[b,E]}(s,u[0])}function Ct(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ge(s,u,f,g,b,E,T,R,j,G,$,te,ne,Se,Ve){var Le=function(nr,Rr,gr,rn,on,kn,Gn,zn){for(var Rn=rn.layout.get("text-rotate").evaluate(kn,{})*Math.PI/180,yi=[],Jn=0,Xn=Rr.positionedLines;Jn<Xn.length;Jn+=1)for(var Ki=Xn[Jn],Mi=0,ya=Ki.positionedGlyphs;Mi<ya.length;Mi+=1){var li=ya[Mi];if(li.rect){var ta=li.rect||{},Qa=4,Wa=!0,ho=1,po=0,Ao=(on||zn)&&li.vertical,Is=li.metrics.advance*li.scale/2;if(zn&&Rr.verticalizable&&(po=Ki.lineOffset/2-(li.imageName?-(24-li.metrics.width*li.scale)/2:24*(li.scale-1))),li.imageName){var Go=Gn[li.imageName];Wa=Go.sdf,Qa=1/(ho=Go.pixelRatio)}var qs=on?[li.x+Is,li.y]:[0,0],Xo=on?[0,0]:[li.x+Is+gr[0],li.y+gr[1]-po],au=[0,0];Ao&&(au=Xo,Xo=[0,0]);var ua=(li.metrics.left-Qa)*li.scale-Is+Xo[0],Ja=(-li.metrics.top-Qa)*li.scale+Xo[1],bo=ua+ta.w*li.scale/ho,na=Ja+ta.h*li.scale/ho,Li=new q(ua,Ja),va=new q(bo,Ja),Na=new q(ua,na),ou=new q(bo,na);if(Ao){var eo=new q(-Is,Is- -17),to=-Math.PI/2,ds=12-Is,ia=new q(22-ds,-(li.imageName?ds:0)),Rf=new(Function.prototype.bind.apply(q,[null].concat(au)));Li._rotateAround(to,eo)._add(ia)._add(Rf),va._rotateAround(to,eo)._add(ia)._add(Rf),Na._rotateAround(to,eo)._add(ia)._add(Rf),ou._rotateAround(to,eo)._add(ia)._add(Rf)}if(Rn){var Sl=Math.sin(Rn),mc=Math.cos(Rn),Qu=[mc,-Sl,Sl,mc];Li._matMult(Qu),va._matMult(Qu),Na._matMult(Qu),ou._matMult(Qu)}var Ts=new q(0,0),uh=new q(0,0);yi.push({tl:Li,tr:va,bl:Na,br:ou,tex:ta,writingMode:Rr.writingMode,glyphOffset:qs,sectionIndex:li.sectionIndex,isSDF:Wa,pixelOffsetTL:Ts,pixelOffsetBR:uh,minFontScaleX:0,minFontScaleY:0})}}return yi}(0,f,R,b,E,T,g,s.allowVerticalPlacement),ct=s.textSizeData,ft=null;ct.kind==="source"?(ft=[128*b.layout.get("text-size").evaluate(T,{})])[0]>32640&&Ut(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ct.kind==="composite"&&((ft=[128*Se.compositeTextSizes[0].evaluate(T,{},Ve),128*Se.compositeTextSizes[1].evaluate(T,{},Ve)])[0]>32640||ft[1]>32640)&&Ut(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),s.addSymbols(s.text,Le,ft,R,E,T,G,u,j.lineStartIndex,j.lineLength,ne,Ve);for(var Rt=0,Ht=$;Rt<Ht.length;Rt+=1)te[Ht[Rt]]=s.text.placedSymbolArray.length-1;return 4*Le.length}function _t(s){for(var u in s)return s[u];return null}function Pe(s,u,f,g){var b=s.compareText;if(u in b){for(var E=b[u],T=E.length-1;T>=0;T--)if(g.dist(E[T])<f)return!0}else b[u]=[];return b[u].push(g),!1}var xt=Xc.VectorTileFeature.types,hr=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function vr(s,u,f,g,b,E,T,R,j,G,$,te,ne){var Se=R?Math.min(32640,Math.round(R[0])):0,Ve=R?Math.min(32640,Math.round(R[1])):0;s.emplaceBack(u,f,Math.round(32*g),Math.round(32*b),E,T,(Se<<1)+(j?1:0),Ve,16*G,16*$,256*te,256*ne)}function Nr(s,u,f){s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f)}function kr(s){for(var u=0,f=s.sections;u<f.length;u+=1)if(jh(f[u].text))return!0;return!1}var Hr=function(u){this.layoutVertexArray=new Qf,this.indexArray=new Au,this.programConfigurations=u,this.segments=new _e,this.dynamicLayoutVertexArray=new Nc,this.opacityVertexArray=new jc,this.placedSymbolArray=new y};Hr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Hr.prototype.upload=function(s,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Sp.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Ap.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,hr,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))},Hr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},On("SymbolBuffers",Hr);var Wn=function(u,f,g){this.layoutVertexArray=new u,this.layoutAttributes=f,this.indexArray=new g,this.segments=new _e,this.collisionVertexArray=new Jf};Wn.prototype.upload=function(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Sv.members,!0)},Wn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},On("CollisionBuffers",Wn);var Dn=function(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(T){return T.id}),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zo([]),this.placementViewportMatrix=zo([]);var f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=ts(this.zoom,f["text-size"]),this.iconSizeData=ts(this.zoom,f["icon-size"]);var g=this.layers[0].layout,b=g.get("symbol-sort-key"),E=g.get("symbol-z-order");this.canOverlap=g.get("text-allow-overlap")||g.get("icon-allow-overlap")||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=E!=="viewport-y"&&b.constantOr(1)!==void 0,this.sortFeaturesByY=(E==="viewport-y"||E==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(function(T){return Qn[T]})),this.stateDependentLayerIds=this.layers.filter(function(T){return T.isStateDependent()}).map(function(T){return T.id}),this.sourceID=u.sourceID};Dn.prototype.createArrays=function(){this.text=new Hr(new _i(this.layers,this.zoom,function(s){return/^text/.test(s)})),this.icon=new Hr(new _i(this.layers,this.zoom,function(s){return/^icon/.test(s)})),this.glyphOffsetArray=new M,this.lineVertexArray=new F,this.symbolInstances=new O},Dn.prototype.calculateGlyphDependencies=function(s,u,f,g,b){for(var E=0;E<s.length;E++)if(u[s.charCodeAt(E)]=!0,(f||g)&&b){var T=st[s.charAt(E)];T&&(u[T.charCodeAt(0)]=!0)}},Dn.prototype.populate=function(s,u,f){var g=this.layers[0],b=g.layout,E=b.get("text-font"),T=b.get("text-field"),R=b.get("icon-image"),j=(T.value.kind!=="constant"||T.value.value instanceof wo&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),G=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,$=b.get("symbol-sort-key");if(this.features=[],j||G){for(var te=u.iconDependencies,ne=u.glyphDependencies,Se=u.availableImages,Ve=new Ti(this.zoom),Le=0,ct=s;Le<ct.length;Le+=1){var ft=ct[Le],Rt=ft.feature,Ht=ft.id,nr=ft.index,Rr=ft.sourceLayerIndex,gr=g._featureFilter.needGeometry,rn=Ya(Rt,gr);if(g._featureFilter.filter(Ve,rn,f)){gr||(rn.geometry=$a(Rt));var on=void 0;if(j){var kn=g.getValueAndResolveTokens("text-field",rn,f,Se),Gn=wo.factory(kn);kr(Gn)&&(this.hasRTLText=!0),(!this.hasRTLText||Lc()==="unavailable"||this.hasRTLText&&js.isParsed())&&(on=de(Gn,g,rn))}var zn=void 0;if(G){var Rn=g.getValueAndResolveTokens("icon-image",rn,f,Se);zn=Rn instanceof Yo?Rn:Yo.fromString(Rn)}if(on||zn){var yi=this.sortFeaturesByKey?$.evaluate(rn,{},f):void 0;if(this.features.push({id:Ht,text:on,icon:zn,index:nr,sourceLayerIndex:Rr,geometry:rn.geometry,properties:Rt.properties,type:xt[Rt.type],sortKey:yi}),zn&&(te[zn.name]=!0),on){var Jn=E.evaluate(rn,{},f).join(","),Xn=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Qn.vertical)>=0;for(var Ki=0,Mi=on.sections;Ki<Mi.length;Ki+=1){var ya=Mi[Ki];if(ya.image)te[ya.image.name]=!0;else{var li=Vl(on.toString()),ta=ya.fontStack||Jn,Qa=ne[ta]=ne[ta]||{};this.calculateGlyphDependencies(ya.text,Qa,Xn,this.allowVerticalPlacement,li)}}}}}}b.get("symbol-placement")==="line"&&(this.features=function(Wa){var ho={},po={},Ao=[],Is=0;function Go(eo){Ao.push(Wa[eo]),Is++}function qs(eo,to,ds){var ia=po[eo];return delete po[eo],po[to]=ia,Ao[ia].geometry[0].pop(),Ao[ia].geometry[0]=Ao[ia].geometry[0].concat(ds[0]),ia}function Xo(eo,to,ds){var ia=ho[to];return delete ho[to],ho[eo]=ia,Ao[ia].geometry[0].shift(),Ao[ia].geometry[0]=ds[0].concat(Ao[ia].geometry[0]),ia}function au(eo,to,ds){var ia=ds?to[0][to[0].length-1]:to[0][0];return eo+":"+ia.x+":"+ia.y}for(var ua=0;ua<Wa.length;ua++){var Ja=Wa[ua],bo=Ja.geometry,na=Ja.text?Ja.text.toString():null;if(na){var Li=au(na,bo),va=au(na,bo,!0);if(Li in po&&va in ho&&po[Li]!==ho[va]){var Na=Xo(Li,va,bo),ou=qs(Li,va,Ao[Na].geometry);delete ho[Li],delete po[va],po[au(na,Ao[ou].geometry,!0)]=ou,Ao[Na].geometry=null}else Li in po?qs(Li,va,bo):va in ho?Xo(Li,va,bo):(Go(ua),ho[Li]=Is-1,po[va]=Is-1)}else Go(ua)}return Ao.filter(function(eo){return eo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wa,ho){return Wa.sortKey-ho.sortKey})}},Dn.prototype.update=function(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))},Dn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Dn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Dn.prototype.upload=function(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Dn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Dn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Dn.prototype.addToLineVertexArray=function(s,u){var f=this.lineVertexArray.length;if(s.segment!==void 0){for(var g=s.dist(u[s.segment+1]),b=s.dist(u[s.segment]),E={},T=s.segment+1;T<u.length;T++)E[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(var R=s.segment||0;R>=0;R--)E[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:b},R>0&&(b+=u[R-1].dist(u[R]));for(var j=0;j<u.length;j++){var G=E[j];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},Dn.prototype.addSymbols=function(s,u,f,g,b,E,T,R,j,G,$,te){for(var ne=s.indexArray,Se=s.layoutVertexArray,Ve=s.segments.prepareSegment(4*u.length,Se,ne,this.canOverlap?E.sortKey:void 0),Le=this.glyphOffsetArray.length,ct=Ve.vertexLength,ft=this.allowVerticalPlacement&&T===Qn.vertical?Math.PI/2:0,Rt=E.text&&E.text.sections,Ht=0;Ht<u.length;Ht++){var nr=u[Ht],Rr=nr.tl,gr=nr.tr,rn=nr.bl,on=nr.br,kn=nr.tex,Gn=nr.pixelOffsetTL,zn=nr.pixelOffsetBR,Rn=nr.minFontScaleX,yi=nr.minFontScaleY,Jn=nr.glyphOffset,Xn=nr.isSDF,Ki=nr.sectionIndex,Mi=Ve.vertexLength,ya=Jn[1];vr(Se,R.x,R.y,Rr.x,ya+Rr.y,kn.x,kn.y,f,Xn,Gn.x,Gn.y,Rn,yi),vr(Se,R.x,R.y,gr.x,ya+gr.y,kn.x+kn.w,kn.y,f,Xn,zn.x,Gn.y,Rn,yi),vr(Se,R.x,R.y,rn.x,ya+rn.y,kn.x,kn.y+kn.h,f,Xn,Gn.x,zn.y,Rn,yi),vr(Se,R.x,R.y,on.x,ya+on.y,kn.x+kn.w,kn.y+kn.h,f,Xn,zn.x,zn.y,Rn,yi),Nr(s.dynamicLayoutVertexArray,R,ft),ne.emplaceBack(Mi,Mi+1,Mi+2),ne.emplaceBack(Mi+1,Mi+2,Mi+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Jn[0]),Ht!==u.length-1&&Ki===u[Ht+1].sectionIndex||s.programConfigurations.populatePaintArrays(Se.length,E,E.index,{},te,Rt&&Rt[Ki])}s.placedSymbolArray.emplaceBack(R.x,R.y,Le,this.glyphOffsetArray.length-Le,ct,j,G,R.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,$)},Dn.prototype._addCollisionDebugVertex=function(s,u,f,g,b,E){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,b,Math.round(E.x),Math.round(E.y))},Dn.prototype.addCollisionDebugVertices=function(s,u,f,g,b,E,T){var R=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),j=R.vertexLength,G=b.layoutVertexArray,$=b.collisionVertexArray,te=T.anchorX,ne=T.anchorY;this._addCollisionDebugVertex(G,$,E,te,ne,new q(s,u)),this._addCollisionDebugVertex(G,$,E,te,ne,new q(f,u)),this._addCollisionDebugVertex(G,$,E,te,ne,new q(f,g)),this._addCollisionDebugVertex(G,$,E,te,ne,new q(s,g)),R.vertexLength+=4;var Se=b.indexArray;Se.emplaceBack(j,j+1),Se.emplaceBack(j+1,j+2),Se.emplaceBack(j+2,j+3),Se.emplaceBack(j+3,j),R.primitiveLength+=4},Dn.prototype.addDebugCollisionBoxes=function(s,u,f,g){for(var b=s;b<u;b++){var E=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,g?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,f)}},Dn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wn(yl,bd.members,be),this.iconCollisionBox=new Wn(yl,bd.members,be);for(var s=0;s<this.symbolInstances.length;s++){var u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Dn.prototype._deserializeCollisionBoxesForSymbol=function(s,u,f,g,b,E,T,R,j){for(var G={},$=u;$<f;$++){var te=s.get($);G.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},G.textFeatureIndex=te.featureIndex;break}for(var ne=g;ne<b;ne++){var Se=s.get(ne);G.verticalTextBox={x1:Se.x1,y1:Se.y1,x2:Se.x2,y2:Se.y2,anchorPointX:Se.anchorPointX,anchorPointY:Se.anchorPointY},G.verticalTextFeatureIndex=Se.featureIndex;break}for(var Ve=E;Ve<T;Ve++){var Le=s.get(Ve);G.iconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},G.iconFeatureIndex=Le.featureIndex;break}for(var ct=R;ct<j;ct++){var ft=s.get(ct);G.verticalIconBox={x1:ft.x1,y1:ft.y1,x2:ft.x2,y2:ft.y2,anchorPointX:ft.anchorPointX,anchorPointY:ft.anchorPointY},G.verticalIconFeatureIndex=ft.featureIndex;break}return G},Dn.prototype.deserializeCollisionBoxes=function(s){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},Dn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Dn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Dn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Dn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Dn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Dn.prototype.addIndicesForPlacedSymbol=function(s,u){for(var f=s.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs,b=f.vertexStartIndex;b<g;b+=4)s.indexArray.emplaceBack(b,b+1,b+2),s.indexArray.emplaceBack(b+1,b+2,b+3)},Dn.prototype.getSortedSymbolIndexes=function(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(s),f=Math.cos(s),g=[],b=[],E=[],T=0;T<this.symbolInstances.length;++T){E.push(T);var R=this.symbolInstances.get(T);g.push(0|Math.round(u*R.anchorX+f*R.anchorY)),b.push(R.featureIndex)}return E.sort(function(j,G){return g[j]-g[G]||b[G]-b[j]}),E},Dn.prototype.addToSortKeyRanges=function(s,u){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})},Dn.prototype.sortFeatures=function(s){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,g=this.symbolInstanceIndexes;f<g.length;f+=1){var b=this.symbolInstances.get(g[f]);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(E,T,R){E>=0&&R.indexOf(E)===T&&u.addIndicesForPlacedSymbol(u.text,E)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},On("SymbolBucket",Dn,{omit:["layers","collisionBoxArray","features","compareText"]}),Dn.MAX_GLYPHS=65535,Dn.addDynamicAttributes=Nr;var Bn=new Za({"symbol-placement":new qn(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new qn(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new qn(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fn(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new qn(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new qn(xe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new qn(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new qn(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new qn(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fn(xe.layout_symbol["icon-size"]),"icon-text-fit":new qn(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new qn(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fn(xe.layout_symbol["icon-image"]),"icon-rotate":new Fn(xe.layout_symbol["icon-rotate"]),"icon-padding":new qn(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new qn(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new Fn(xe.layout_symbol["icon-offset"]),"icon-anchor":new Fn(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new qn(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new qn(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new qn(xe.layout_symbol["text-rotation-alignment"]),"text-field":new Fn(xe.layout_symbol["text-field"]),"text-font":new Fn(xe.layout_symbol["text-font"]),"text-size":new Fn(xe.layout_symbol["text-size"]),"text-max-width":new Fn(xe.layout_symbol["text-max-width"]),"text-line-height":new qn(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new Fn(xe.layout_symbol["text-letter-spacing"]),"text-justify":new Fn(xe.layout_symbol["text-justify"]),"text-radial-offset":new Fn(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new qn(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new Fn(xe.layout_symbol["text-anchor"]),"text-max-angle":new qn(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new qn(xe.layout_symbol["text-writing-mode"]),"text-rotate":new Fn(xe.layout_symbol["text-rotate"]),"text-padding":new qn(xe.layout_symbol["text-padding"]),"text-keep-upright":new qn(xe.layout_symbol["text-keep-upright"]),"text-transform":new Fn(xe.layout_symbol["text-transform"]),"text-offset":new Fn(xe.layout_symbol["text-offset"]),"text-allow-overlap":new qn(xe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new qn(xe.layout_symbol["text-ignore-placement"]),"text-optional":new qn(xe.layout_symbol["text-optional"])}),ai={paint:new Za({"icon-opacity":new Fn(xe.paint_symbol["icon-opacity"]),"icon-color":new Fn(xe.paint_symbol["icon-color"]),"icon-halo-color":new Fn(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fn(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fn(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new qn(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new qn(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fn(xe.paint_symbol["text-opacity"]),"text-color":new Fn(xe.paint_symbol["text-color"],{runtimeType:yn,getOverride:function(u){return u.textColor},hasOverride:function(u){return!!u.textColor}}),"text-halo-color":new Fn(xe.paint_symbol["text-halo-color"]),"text-halo-width":new Fn(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new Fn(xe.paint_symbol["text-halo-blur"]),"text-translate":new qn(xe.paint_symbol["text-translate"]),"text-translate-anchor":new qn(xe.paint_symbol["text-translate-anchor"])}),layout:Bn},hi=function(u){this.type=u.property.overrides?u.property.overrides.runtimeType:Lt,this.defaultValue=u};hi.prototype.evaluate=function(s){if(s.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default},hi.prototype.eachChild=function(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)},hi.prototype.outputDefined=function(){return!1},hi.prototype.serialize=function(){return null},On("FormatSectionOverride",hi,{omit:["defaultValue"]});var pa=function(s){function u(f){s.call(this,f,ai)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(f,g){if(s.prototype.recalculate.call(this,f,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var E=[],T=0,R=b;T<R.length;T+=1){var j=R[T];E.indexOf(j)<0&&E.push(j)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(f,g,b,E){var T=this.layout.get(f).evaluate(g,{},b,E),R=this._unevaluatedLayout._values[f];return R.isDataDriven()||ac(R.value)||!T?T:function(j,G){return G.replace(/{([^{}]+)}/g,function($,te){return te in j?String(j[te]):""})}(g.properties,T)},u.prototype.createBucket=function(f){return new Dn(f)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var f=0,g=ai.paint.overridableProperties;f<g.length;f+=1){var b=g[f];if(u.hasPaintOverride(this.layout,b)){var E,T=this.paint.get(b),R=new hi(T),j=new Ll(R,T.property.specification);E=T.value.kind==="constant"||T.value.kind==="source"?new oc("source",j):new fi("composite",j,T.value.zoomStops,T.value._interpolationType),this.paint._values[b]=new ys(T.property,E,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(f,g,b){return!(!this.layout||g.isDataDriven()||b.isDataDriven())&&u.hasPaintOverride(this.layout,f)},u.hasPaintOverride=function(f,g){var b=f.get("text-field"),E=ai.paint.properties[g],T=!1,R=function(te){for(var ne=0,Se=te;ne<Se.length;ne+=1)if(E.overrides&&E.overrides.hasOverride(Se[ne]))return void(T=!0)};if(b.value.kind==="constant"&&b.value.value instanceof wo)R(b.value.value.sections);else if(b.value.kind==="source"){var j=function $(te){T||(te instanceof Ro&&Ea(te.value)===Zi?R(te.value.sections):te instanceof Eo?R(te.sections):te.eachChild($))},G=b.value;G._styleExpression&&j(G._styleExpression.expression)}return T},u}(nu),Ho={paint:new Za({"background-color":new qn(xe.paint_background["background-color"]),"background-pattern":new us(xe.paint_background["background-pattern"]),"background-opacity":new qn(xe.paint_background["background-opacity"])})},El=function(s){function u(f){s.call(this,f,Ho)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(nu),xd={paint:new Za({"raster-opacity":new qn(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new qn(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new qn(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new qn(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new qn(xe.paint_raster["raster-saturation"]),"raster-contrast":new qn(xe.paint_raster["raster-contrast"]),"raster-resampling":new qn(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new qn(xe.paint_raster["raster-fade-duration"])})},Ou=function(s){function u(f){s.call(this,f,xd)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(nu),Ed=function(s){function u(f){s.call(this,f,{}),this.implementation=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},u.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},u}(nu),$l={circle:Ef,heatmap:Sf,hillshade:Kg,fill:pv,"fill-extrusion":yv,line:Ev,symbol:pa,background:El,raster:Ou},Sd=ue.HTMLImageElement,Qg=ue.HTMLCanvasElement,Jg=ue.HTMLVideoElement,ey=ue.ImageData,Av=ue.ImageBitmap,Xh=function(u,f,g,b){this.context=u,this.format=g,this.texture=u.gl.createTexture(),this.update(f,b)};Xh.prototype.update=function(s,u,f){var g=s.width,b=s.height,E=!(this.size&&this.size[0]===g&&this.size[1]===b||f),T=this.context,R=T.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[g,b],s instanceof Sd||s instanceof Qg||s instanceof Jg||s instanceof ey||Av&&s instanceof Av?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,s):R.texImage2D(R.TEXTURE_2D,0,this.format,g,b,0,this.format,R.UNSIGNED_BYTE,s.data);else{var j=f||{x:0,y:0},G=j.x,$=j.y;s instanceof Sd||s instanceof Qg||s instanceof Jg||s instanceof ey||Av&&s instanceof Av?R.texSubImage2D(R.TEXTURE_2D,0,G,$,R.RGBA,R.UNSIGNED_BYTE,s):R.texSubImage2D(R.TEXTURE_2D,0,G,$,g,b,R.RGBA,R.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)},Xh.prototype.bind=function(s,u,f){var g=this.context.gl;g.bindTexture(g.TEXTURE_2D,this.texture),f!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=g.LINEAR),s!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f||s),this.filter=s),u!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,u),this.wrap=u)},Xh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Xh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Lm=function(u){var f=this;this._callback=u,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){f._triggered=!1,f._callback()})};Lm.prototype.trigger=function(){var s=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){s._triggered=!1,s._callback()},0))},Lm.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Zh=function(u,f,g){this.target=u,this.parent=f,this.mapId=g,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yr(["receive","process"],this),this.invoker=new Lm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ie()?u:ue};function Nm(s,u,f){var g=2*Math.PI*6378137/256/Math.pow(2,f);return[s*g-2*Math.PI*6378137/2,u*g-2*Math.PI*6378137/2]}Zh.prototype.send=function(s,u,f,g,b){var E=this;b===void 0&&(b=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[T]=f);var R=Me(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:s,hasCallback:!!f,targetMapId:g,mustQueue:b,sourceMapId:this.mapId,data:ms(u,R)},R),{cancel:function(){f&&delete E.callbacks[T],E.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:E.mapId})}}},Zh.prototype.receive=function(s){var u=s.data,f=u.id;if(f&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[f];var g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g()}else Ie()||u.mustQueue?(this.tasks[f]=u,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,u)},Zh.prototype.process=function(){if(this.taskQueue.length){var s=this.taskQueue.shift(),u=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(s,u)}},Zh.prototype.processTask=function(s,u){var f=this;if(u.type==="<response>"){var g=this.callbacks[s];delete this.callbacks[s],g&&(u.error?g(Ma(u.error)):g(null,Ma(u.data)))}else{var b=!1,E=Me(this.globalScope)?void 0:[],T=u.hasCallback?function($,te){b=!0,delete f.cancelCallbacks[s],f.target.postMessage({id:s,type:"<response>",sourceMapId:f.mapId,error:$?ms($):null,data:ms(te,E)},E)}:function($){b=!0},R=null,j=Ma(u.data);if(this.parent[u.type])R=this.parent[u.type](u.sourceMapId,j,T);else if(this.parent.getWorkerSource){var G=u.type.split(".");R=this.parent.getWorkerSource(u.sourceMapId,G[0],j.source)[G[1]](j,T)}else T(new Error("Could not find function "+u.type));!b&&R&&R.cancel&&(this.cancelCallbacks[s]=R.cancel)}},Zh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Wo=function(u,f){u&&(f?this.setSouthWest(u).setNorthEast(f):u.length===4?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1]))};Wo.prototype.setNorthEast=function(s){return this._ne=s instanceof qa?new qa(s.lng,s.lat):qa.convert(s),this},Wo.prototype.setSouthWest=function(s){return this._sw=s instanceof qa?new qa(s.lng,s.lat):qa.convert(s),this},Wo.prototype.extend=function(s){var u,f,g=this._sw,b=this._ne;if(s instanceof qa)u=s,f=s;else{if(!(s instanceof Wo))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Wo.convert(s)):this.extend(qa.convert(s)):this;if(f=s._ne,!(u=s._sw)||!f)return this}return g||b?(g.lng=Math.min(u.lng,g.lng),g.lat=Math.min(u.lat,g.lat),b.lng=Math.max(f.lng,b.lng),b.lat=Math.max(f.lat,b.lat)):(this._sw=new qa(u.lng,u.lat),this._ne=new qa(f.lng,f.lat)),this},Wo.prototype.getCenter=function(){return new qa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Wo.prototype.getSouthWest=function(){return this._sw},Wo.prototype.getNorthEast=function(){return this._ne},Wo.prototype.getNorthWest=function(){return new qa(this.getWest(),this.getNorth())},Wo.prototype.getSouthEast=function(){return new qa(this.getEast(),this.getSouth())},Wo.prototype.getWest=function(){return this._sw.lng},Wo.prototype.getSouth=function(){return this._sw.lat},Wo.prototype.getEast=function(){return this._ne.lng},Wo.prototype.getNorth=function(){return this._ne.lat},Wo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Wo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Wo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Wo.prototype.contains=function(s){var u=qa.convert(s),f=u.lng,g=u.lat,b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&b},Wo.convert=function(s){return!s||s instanceof Wo?s:new Wo(s)};var qa=function(u,f){if(isNaN(u)||isNaN(f))throw new Error("Invalid LngLat object: ("+u+", "+f+")");if(this.lng=+u,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};qa.prototype.wrap=function(){return new qa(ht(this.lng,-180,180),this.lat)},qa.prototype.toArray=function(){return[this.lng,this.lat]},qa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},qa.prototype.distanceTo=function(s){var u=Math.PI/180,f=this.lat*u,g=s.lat*u,b=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(b,1))},qa.prototype.toBounds=function(s){s===void 0&&(s=0);var u=360*s/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Wo(new qa(this.lng-f,this.lat-u),new qa(this.lng+f,this.lat+u))},qa.convert=function(s){if(s instanceof qa)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new qa(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new qa(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var ty=2*Math.PI*63710088e-1;function ry(s){return ty*Math.cos(s*Math.PI/180)}function jm(s){return(180+s)/360}function ny(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function iy(s,u){return s/ry(u)}function zm(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}var $h=function(u,f,g){g===void 0&&(g=0),this.x=+u,this.y=+f,this.z=+g};$h.fromLngLat=function(s,u){u===void 0&&(u=0);var f=qa.convert(s);return new $h(jm(f.lng),ny(f.lat),iy(u,f.lat))},$h.prototype.toLngLat=function(){return new qa(360*this.x-180,zm(this.y))},$h.prototype.toAltitude=function(){return this.z*ry(zm(this.y))},$h.prototype.meterInMercatorCoordinateUnits=function(){return 1/ty*(s=zm(this.y),1/Math.cos(s*Math.PI/180));var s};var Yh=function(u,f,g){this.z=u,this.x=f,this.y=g,this.key=Ad(0,u,u,f,g)};Yh.prototype.equals=function(s){return this.z===s.z&&this.x===s.x&&this.y===s.y},Yh.prototype.url=function(s,u){var f,g,b,E,T,R=(g=this.y,b=this.z,E=Nm(256*(f=this.x),256*(g=Math.pow(2,b)-g-1),b),T=Nm(256*(f+1),256*(g+1),b),E[0]+","+E[1]+","+T[0]+","+T[1]),j=function(G,$,te){for(var ne,Se="",Ve=G;Ve>0;Ve--)Se+=($&(ne=1<<Ve-1)?1:0)+(te&ne?2:0);return Se}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",j).replace("{bbox-epsg-3857}",R)},Yh.prototype.getTilePoint=function(s){var u=Math.pow(2,this.z);return new q(8192*(s.x*u-this.x),8192*(s.y*u-this.y))},Yh.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var ay=function(u,f){this.wrap=u,this.canonical=f,this.key=Ad(u,f.z,f.z,f.x,f.y)},rs=function(u,f,g,b,E){this.overscaledZ=u,this.wrap=f,this.canonical=new Yh(g,+b,+E),this.key=Ad(f,u,g,b,E)};function Ad(s,u,f,g,b){(s*=2)<0&&(s=-1*s-1);var E=1<<f;return(E*E*s+E*b+g).toString(36)+f.toString(36)+u.toString(36)}rs.prototype.equals=function(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)},rs.prototype.scaledTo=function(s){var u=this.canonical.z-s;return s>this.canonical.z?new rs(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new rs(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)},rs.prototype.calculateScaledKey=function(s,u){var f=this.canonical.z-s;return s>this.canonical.z?Ad(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):Ad(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)},rs.prototype.isChildOf=function(s){if(s.wrap!==this.wrap)return!1;var u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u},rs.prototype.children=function(s){if(this.overscaledZ>=s)return[new rs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new rs(u,this.wrap,u,f,g),new rs(u,this.wrap,u,f+1,g),new rs(u,this.wrap,u,f,g+1),new rs(u,this.wrap,u,f+1,g+1)]},rs.prototype.isLessThan=function(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))},rs.prototype.wrapped=function(){return new rs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},rs.prototype.unwrapTo=function(s){return new rs(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)},rs.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},rs.prototype.toUnwrapped=function(){return new ay(this.wrap,this.canonical)},rs.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},rs.prototype.getTilePoint=function(s){return this.canonical.getTilePoint(new $h(s.x-this.wrap,s.y))},On("CanonicalTileID",Yh),On("OverscaledTileID",rs,{omit:["posMatrix"]});var wf=function(u,f,g){if(this.uid=u,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(g&&g!=="mapbox"&&g!=="terrarium")return Ut('"'+g+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=f.height;var b=this.dim=f.height-2;this.data=new Uint32Array(f.data.buffer),this.encoding=g||"mapbox";for(var E=0;E<b;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(b,E)]=this.data[this._idx(b-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,b)]=this.data[this._idx(E,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)]};wf.prototype.get=function(s,u){var f=new Uint8Array(this.data.buffer),g=4*this._idx(s,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])},wf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},wf.prototype._idx=function(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)},wf.prototype._unpackMapbox=function(s,u,f){return(256*s*256+256*u+f)/10-1e4},wf.prototype._unpackTerrarium=function(s,u,f){return 256*s+u+f/256-32768},wf.prototype.getPixels=function(){return new zs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},wf.prototype.backfillBorder=function(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");var g=u*this.dim,b=u*this.dim+this.dim,E=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=b-1;break;case 1:b=g+1}switch(f){case-1:E=T-1;break;case 1:T=E+1}for(var R=-u*this.dim,j=-f*this.dim,G=E;G<T;G++)for(var $=g;$<b;$++)this.data[this._idx($,G)]=s.data[this._idx($+R,G+j)]},On("DEMData",wf);var Tv=function(u){this._stringToNumber={},this._numberToString=[];for(var f=0;f<u.length;f++){var g=u[f];this._stringToNumber[g]=f,this._numberToString[f]=g}};Tv.prototype.encode=function(s){return this._stringToNumber[s]},Tv.prototype.decode=function(s){return this._numberToString[s]};var Cv=function(u,f,g,b,E){this.type="Feature",this._vectorTileFeature=u,u._z=f,u._x=g,u._y=b,this.properties=u.properties,this.id=E},Um={geometry:{configurable:!0}};Um.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Um.geometry.set=function(s){this._geometry=s},Cv.prototype.toJSON=function(){var s={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s},Object.defineProperties(Cv.prototype,Um);var Tp=function(){this.state={},this.stateChanges={},this.deletedStates={}};Tp.prototype.updateState=function(s,u,f){var g=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},We(this.stateChanges[s][g],f),this.deletedStates[s]===null)for(var b in this.deletedStates[s]={},this.state[s])b!==g&&(this.deletedStates[s][b]=null);else if(this.deletedStates[s]&&this.deletedStates[s][g]===null)for(var E in this.deletedStates[s][g]={},this.state[s][g])f[E]||(this.deletedStates[s][g][E]=null);else for(var T in f)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][T]===null&&delete this.deletedStates[s][g][T]},Tp.prototype.removeFeatureState=function(s,u,f){if(this.deletedStates[s]!==null){var g=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},f&&u!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][f]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(f in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][f]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}},Tp.prototype.getState=function(s,u){var f=String(u),g=We({},(this.state[s]||{})[f],(this.stateChanges[s]||{})[f]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){var b=this.deletedStates[s][u];if(b===null)return{};for(var E in b)delete g[E]}return g},Tp.prototype.initializeTileState=function(s,u){s.setFeatureState(this.state,u)},Tp.prototype.coalesceChanges=function(s,u){var f={};for(var g in this.stateChanges){this.state[g]=this.state[g]||{};var b={};for(var E in this.stateChanges[g])this.state[g][E]||(this.state[g][E]={}),We(this.state[g][E],this.stateChanges[g][E]),b[E]=this.state[g][E];f[g]=b}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var R={};if(this.deletedStates[T]===null)for(var j in this.state[T])R[j]={},this.state[T][j]={};else for(var G in this.deletedStates[T]){if(this.deletedStates[T][G]===null)this.state[T][G]={};else for(var $=0,te=Object.keys(this.deletedStates[T][G]);$<te.length;$+=1)delete this.state[T][G][te[$]];R[G]=this.state[T][G]}f[T]=f[T]||{},We(f[T],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var ne in s)s[ne].setFeatureState(f,u)};var Of=function(u,f){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new V(8192,16,0),this.grid3D=new V(8192,16,0),this.featureIndexArray=new ee,this.promoteId=f};function oy(s,u,f,g,b){return Mr(s,function(E,T){var R=u instanceof _f?u.get(T):null;return R&&R.evaluate?R.evaluate(f,g,b):R})}function sy(s){for(var u=1/0,f=1/0,g=-1/0,b=-1/0,E=0,T=s;E<T.length;E+=1){var R=T[E];u=Math.min(u,R.x),f=Math.min(f,R.y),g=Math.max(g,R.x),b=Math.max(b,R.y)}return{minX:u,minY:f,maxX:g,maxY:b}}function g_(s,u){return u-s}Of.prototype.insert=function(s,u,f,g,b,E){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,b);for(var R=E?this.grid3D:this.grid,j=0;j<u.length;j++){for(var G=u[j],$=[1/0,1/0,-1/0,-1/0],te=0;te<G.length;te++){var ne=G[te];$[0]=Math.min($[0],ne.x),$[1]=Math.min($[1],ne.y),$[2]=Math.max($[2],ne.x),$[3]=Math.max($[3],ne.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&R.insert(T,$[0],$[1],$[2],$[3])}},Of.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Xc.VectorTile(new _r(this.rawTileData)).layers,this.sourceLayerCoder=new Tv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Of.prototype.query=function(s,u,f,g){var b=this;this.loadVTLayers();for(var E=s.params||{},T=8192/s.tileSize/s.scale,R=Wu(E.filter),j=s.queryGeometry,G=s.queryPadding*T,$=sy(j),te=this.grid.query($.minX-G,$.minY-G,$.maxX+G,$.maxY+G),ne=sy(s.cameraQueryGeometry),Se=this.grid3D.query(ne.minX-G,ne.minY-G,ne.maxX+G,ne.maxY+G,function(nr,Rr,gr,rn){return function(on,kn,Gn,zn,Rn){for(var yi=0,Jn=on;yi<Jn.length;yi+=1){var Xn=Jn[yi];if(kn<=Xn.x&&Gn<=Xn.y&&zn>=Xn.x&&Rn>=Xn.y)return!0}var Ki=[new q(kn,Gn),new q(kn,Rn),new q(zn,Rn),new q(zn,Gn)];if(on.length>2){for(var Mi=0,ya=Ki;Mi<ya.length;Mi+=1)if(mu(on,ya[Mi]))return!0}for(var li=0;li<on.length-1;li++)if(_l(on[li],on[li+1],Ki))return!0;return!1}(s.cameraQueryGeometry,nr-G,Rr-G,gr+G,rn+G)}),Ve=0,Le=Se;Ve<Le.length;Ve+=1)te.push(Le[Ve]);te.sort(g_);for(var ct,ft={},Rt=function(Rr){var gr=te[Rr];if(gr!==ct){ct=gr;var rn=b.featureIndexArray.get(gr),on=null;b.loadMatchingFeature(ft,rn.bucketIndex,rn.sourceLayerIndex,rn.featureIndex,R,E.layers,E.availableImages,u,f,g,function(kn,Gn,zn){return on||(on=$a(kn)),Gn.queryIntersectsFeature(j,kn,zn,on,b.z,s.transform,T,s.pixelPosMatrix)})}},Ht=0;Ht<te.length;Ht++)Rt(Ht);return ft},Of.prototype.loadMatchingFeature=function(s,u,f,g,b,E,T,R,j,G,$){var te=this.bucketLayerIDs[u];if(!E||function(on,kn){for(var Gn=0;Gn<on.length;Gn++)if(kn.indexOf(on[Gn])>=0)return!0;return!1}(E,te)){var ne=this.sourceLayerCoder.decode(f),Se=this.vtLayers[ne].feature(g);if(b.needGeometry){var Ve=Ya(Se,!0);if(!b.filter(new Ti(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!b.filter(new Ti(this.tileID.overscaledZ),Se))return;for(var Le=this.getId(Se,ne),ct=0;ct<te.length;ct++){var ft=te[ct];if(!(E&&E.indexOf(ft)<0)){var Rt=R[ft];if(Rt){var Ht={};Le!==void 0&&G&&(Ht=G.getState(Rt.sourceLayer||"_geojsonTileLayer",Le));var nr=We({},j[ft]);nr.paint=oy(nr.paint,Rt.paint,Se,Ht,T),nr.layout=oy(nr.layout,Rt.layout,Se,Ht,T);var Rr=!$||$(Se,Rt,Ht);if(Rr){var gr=new Cv(Se,this.z,this.x,this.y,Le);gr.layer=nr;var rn=s[ft];rn===void 0&&(rn=s[ft]=[]),rn.push({featureIndex:g,feature:gr,intersectionZ:Rr})}}}}}},Of.prototype.lookupSymbolFeatures=function(s,u,f,g,b,E,T,R){var j={};this.loadVTLayers();for(var G=Wu(b),$=0,te=s;$<te.length;$+=1)this.loadMatchingFeature(j,f,g,te[$],G,E,T,R,u);return j},Of.prototype.hasLayer=function(s){for(var u=0,f=this.bucketLayerIDs;u<f.length;u+=1)for(var g=0,b=f[u];g<b.length;g+=1)if(s===b[g])return!0;return!1},Of.prototype.getId=function(s,u){var f=s.id;return this.promoteId&&typeof(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(f=Number(f)),f},On("FeatureIndex",Of,{omit:["rawTileData","sourceLayerCoder"]});var As=function(u,f){this.tileID=u,this.uid=Je(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};As.prototype.registerFadeDuration=function(s){var u=s+this.timeAdded;u<pn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},As.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},As.prototype.loadVectorData=function(s,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){for(var g in s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(G,$){var te={};if(!$)return te;for(var ne=function(){var ct=Ve[Se],ft=ct.layerIds.map(function(nr){return $.getLayer(nr)}).filter(Boolean);if(ft.length!==0){ct.layers=ft,ct.stateDependentLayerIds&&(ct.stateDependentLayers=ct.stateDependentLayerIds.map(function(nr){return ft.filter(function(Rr){return Rr.id===nr})[0]}));for(var Rt=0,Ht=ft;Rt<Ht.length;Rt+=1)te[Ht[Rt].id]=ct}},Se=0,Ve=G;Se<Ve.length;Se+=1)ne();return te}(s.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[g];if(b instanceof Dn){if(this.hasSymbolBuckets=!0,!f)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var T=this.buckets[E];if(T instanceof Dn&&T.hasRTLText){this.hasRTLText=!0,js.isLoading()||js.isLoaded()||Lc()!=="deferred"||Gs();break}}for(var R in this.queryPadding=0,this.buckets){var j=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(R).queryRadius(j))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new d},As.prototype.unloadVectorData=function(){for(var s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},As.prototype.getBucket=function(s){return this.buckets[s.id]},As.prototype.upload=function(s){for(var u in this.buckets){var f=this.buckets[u];f.uploadPending()&&f.upload(s)}var g=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Xh(s,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Xh(s,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)},As.prototype.prepare=function(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)},As.prototype.queryRenderedFeatures=function(s,u,f,g,b,E,T,R,j,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:E,tileSize:this.tileSize,pixelPosMatrix:G,transform:R,params:T,queryPadding:this.queryPadding*j},s,u,f):{}},As.prototype.querySourceFeatures=function(s,u){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var g=f.loadVTLayers(),b=u?u.sourceLayer:"",E=g._geojsonTileLayer||g[b];if(E)for(var T=Wu(u&&u.filter),R=this.tileID.canonical,j=R.z,G=R.x,$=R.y,te={z:j,x:G,y:$},ne=0;ne<E.length;ne++){var Se=E.feature(ne);if(T.needGeometry){var Ve=Ya(Se,!0);if(!T.filter(new Ti(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!T.filter(new Ti(this.tileID.overscaledZ),Se))continue;var Le=f.getId(Se,b),ct=new Cv(Se,j,G,$,Le);ct.tile=te,s.push(ct)}}},As.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},As.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},As.prototype.setExpiryData=function(s){var u=this.expirationTime;if(s.cacheControl){var f=zt(s.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){var g=Date.now(),b=!1;if(this.expirationTime>g)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{var E=this.expirationTime-u;E?this.expirationTime=g+Math.max(E,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},As.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},As.prototype.setFeatureState=function(s,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var g in this.buckets)if(u.style.hasLayer(g)){var b=this.buckets[g],E=b.layers[0].sourceLayer||"_geojsonTileLayer",T=f[E],R=s[E];if(T&&R&&Object.keys(R).length!==0){b.update(R,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var j=u&&u.style&&u.style.getLayer(g);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(b)))}}}},As.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},As.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<pn.now()},As.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},As.prototype.setHoldDuration=function(s){this.symbolFadeHoldUntil=pn.now()+s},As.prototype.setDependencies=function(s,u){for(var f={},g=0,b=u;g<b.length;g+=1)f[b[g]]=!0;this.dependencies[s]=f},As.prototype.hasDependency=function(s,u){for(var f=0,g=s;f<g.length;f+=1){var b=this.dependencies[g[f]];if(b){for(var E=0,T=u;E<T.length;E+=1)if(b[T[E]])return!0}}return!1};var sh=ue.performance,uy=function(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},sh.mark(this._marks.start)};uy.prototype.finish=function(){sh.mark(this._marks.end);var s=sh.getEntriesByName(this._marks.measure);return s.length===0&&(sh.measure(this._marks.measure,this._marks.start,this._marks.end),s=sh.getEntriesByName(this._marks.measure),sh.clearMarks(this._marks.start),sh.clearMarks(this._marks.end),sh.clearMeasures(this._marks.measure)),s},v.Actor=Zh,v.AlphaImage=qu,v.CanonicalTileID=Yh,v.CollisionBoxArray=d,v.Color=di,v.DEMData=wf,v.DataConstantProperty=qn,v.DictionaryCoder=Tv,v.EXTENT=8192,v.ErrorEvent=mt,v.EvaluationParameters=Ti,v.Event=ze,v.Evented=Tt,v.FeatureIndex=Of,v.FillBucket=xl,v.FillExtrusionBucket=Rs,v.ImageAtlas=Pr,v.ImagePosition=fn,v.LineBucket=Ms,v.LngLat=qa,v.LngLatBounds=Wo,v.MercatorCoordinate=$h,v.ONE_EM=24,v.OverscaledTileID=rs,v.Point=q,v.Point$1=q,v.Properties=Za,v.Protobuf=_r,v.RGBAImage=zs,v.RequestManager=Ar,v.RequestPerformance=uy,v.ResourceType=ii,v.SegmentVector=_e,v.SourceFeatureState=Tp,v.StructArrayLayout1ui2=th,v.StructArrayLayout2f1f2i16=Wl,v.StructArrayLayout2i4=Hl,v.StructArrayLayout3ui6=Au,v.StructArrayLayout4i8=qf,v.SymbolBucket=Dn,v.Texture=Xh,v.Tile=As,v.Transitionable=Jo,v.Uniform1f=en,v.Uniform1i=Er,v.Uniform2f=Xr,v.Uniform3f=gn,v.Uniform4f=In,v.UniformColor=Vn,v.UniformMatrix4f=Di,v.UnwrappedTileID=ay,v.ValidationError=Qe,v.WritingMode=Qn,v.ZoomHistory=mf,v.add=function(s,u,f){return s[0]=u[0]+f[0],s[1]=u[1]+f[1],s[2]=u[2]+f[2],s},v.addDynamicAttributes=Nr,v.asyncAll=function(s,u,f){if(!s.length)return f(null,[]);var g=s.length,b=new Array(s.length),E=null;s.forEach(function(T,R){u(T,function(j,G){j&&(E=j),b[R]=G,--g==0&&f(E,b)})})},v.bezier=Ne,v.bindAll=yr,v.browser=pn,v.cacheEntryPossiblyAdded=function(s){++xn>Tr&&(s.getActor().send("enforceCacheSizeLimit",or),xn=0)},v.clamp=wt,v.clearTileCache=function(s){var u=ue.caches.delete("mapbox-tiles");s&&u.catch(s).then(function(){return s()})},v.clipLine=Us,v.clone=function(s){var u=new fo(16);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},v.clone$1=He,v.clone$2=function(s){var u=new fo(3);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u},v.collisionCircleLayout=Q,v.config=Fr,v.create=function(){var s=new fo(16);return fo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},v.create$1=function(){var s=new fo(9);return fo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s},v.create$2=function(){var s=new fo(4);return fo!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},v.createCommonjsModule=L,v.createExpression=Pc,v.createLayout=Mo,v.createStyleLayer=function(s){return s.type==="custom"?new Ed(s):new $l[s.type](s)},v.cross=function(s,u,f){var g=u[0],b=u[1],E=u[2],T=f[0],R=f[1],j=f[2];return s[0]=b*j-E*R,s[1]=E*T-g*j,s[2]=g*R-b*T,s},v.deepEqual=function s(u,f){if(Array.isArray(u)){if(!Array.isArray(f)||u.length!==f.length)return!1;for(var g=0;g<u.length;g++)if(!s(u[g],f[g]))return!1;return!0}if(typeof u=="object"&&u!==null&&f!==null){if(typeof f!="object"||Object.keys(u).length!==Object.keys(f).length)return!1;for(var b in u)if(!s(u[b],f[b]))return!1;return!0}return u===f},v.dot=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]},v.dot$1=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]*u[3]},v.ease=nt,v.emitValidationErrors=Ul,v.endsWith=Dr,v.enforceCacheSizeLimit=function(s){Or(),Ae&&Ae.then(function(u){u.keys().then(function(f){for(var g=0;g<f.length-s;g++)u.delete(f[g])})})},v.evaluateSizeForFeature=Ps,v.evaluateSizeForZoom=Vo,v.evaluateVariableOffset=Et,v.evented=Bc,v.extend=We,v.featureFilter=Wu,v.filterObject=jt,v.fromRotation=function(s,u){var f=Math.sin(u),g=Math.cos(u);return s[0]=g,s[1]=f,s[2]=0,s[3]=-f,s[4]=g,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},v.getAnchorAlignment=Pa,v.getAnchorJustification=Ct,v.getArrayBuffer=as,v.getImage=J,v.getJSON=function(s,u){return Lo(We(s,{type:"json"}),u)},v.getRTLTextPluginStatus=Lc,v.getReferrer=Si,v.getVideo=function(s,u){var f,g,b=ue.document.createElement("video");b.muted=!0,b.onloadstart=function(){u(null,b)};for(var E=0;E<s.length;E++){var T=ue.document.createElement("source");f=s[E],g=void 0,(g=ue.document.createElement("a")).href=f,(g.protocol!==ue.document.location.protocol||g.host!==ue.document.location.host)&&(b.crossOrigin="Anonymous"),T.src=s[E],b.appendChild(T)}return{cancel:function(){}}},v.identity=zo,v.invert=function(s,u){var f=u[0],g=u[1],b=u[2],E=u[3],T=u[4],R=u[5],j=u[6],G=u[7],$=u[8],te=u[9],ne=u[10],Se=u[11],Ve=u[12],Le=u[13],ct=u[14],ft=u[15],Rt=f*R-g*T,Ht=f*j-b*T,nr=f*G-E*T,Rr=g*j-b*R,gr=g*G-E*R,rn=b*G-E*j,on=$*Le-te*Ve,kn=$*ct-ne*Ve,Gn=$*ft-Se*Ve,zn=te*ct-ne*Le,Rn=te*ft-Se*Le,yi=ne*ft-Se*ct,Jn=Rt*yi-Ht*Rn+nr*zn+Rr*Gn-gr*kn+rn*on;return Jn?(s[0]=(R*yi-j*Rn+G*zn)*(Jn=1/Jn),s[1]=(b*Rn-g*yi-E*zn)*Jn,s[2]=(Le*rn-ct*gr+ft*Rr)*Jn,s[3]=(ne*gr-te*rn-Se*Rr)*Jn,s[4]=(j*Gn-T*yi-G*kn)*Jn,s[5]=(f*yi-b*Gn+E*kn)*Jn,s[6]=(ct*nr-Ve*rn-ft*Ht)*Jn,s[7]=($*rn-ne*nr+Se*Ht)*Jn,s[8]=(T*Rn-R*Gn+G*on)*Jn,s[9]=(g*Gn-f*Rn-E*on)*Jn,s[10]=(Ve*gr-Le*nr+ft*Rt)*Jn,s[11]=(te*nr-$*gr-Se*Rt)*Jn,s[12]=(R*kn-T*zn-j*on)*Jn,s[13]=(f*zn-g*kn+b*on)*Jn,s[14]=(Le*Ht-Ve*Rr-ct*Rt)*Jn,s[15]=($*Rr-te*Ht+ne*Rt)*Jn,s):null},v.isChar=cn,v.isMapboxURL=mr,v.keysDifference=function(s,u){var f=[];for(var g in s)g in u||f.push(g);return f},v.makeRequest=Lo,v.mapObject=Mr,v.mercatorXfromLng=jm,v.mercatorYfromLat=ny,v.mercatorZfromAltitude=iy,v.mul=xs,v.multiply=Ka,v.mvt=Xc,v.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},v.normalize=function(s,u){var f=u[0],g=u[1],b=u[2],E=f*f+g*g+b*b;return E>0&&(E=1/Math.sqrt(E)),s[0]=u[0]*E,s[1]=u[1]*E,s[2]=u[2]*E,s},v.number=Xa,v.offscreenCanvasSupported=An,v.ortho=function(s,u,f,g,b,E,T){var R=1/(u-f),j=1/(g-b),G=1/(E-T);return s[0]=-2*R,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*j,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*G,s[11]=0,s[12]=(u+f)*R,s[13]=(b+g)*j,s[14]=(T+E)*G,s[15]=1,s},v.parseGlyphPBF=function(s){return new _r(s).readFields(Lr,[])},v.pbf=_r,v.performSymbolLayout=function(s,u,f,g,b,E,T){s.createArrays(),s.tilePixelRatio=8192/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;var R=s.layers[0].layout,j=s.layers[0]._unevaluatedLayout._values,G={};if(s.textSizeData.kind==="composite"){var $=s.textSizeData,te=$.maxZoom;G.compositeTextSizes=[j["text-size"].possiblyEvaluate(new Ti($.minZoom),T),j["text-size"].possiblyEvaluate(new Ti(te),T)]}if(s.iconSizeData.kind==="composite"){var ne=s.iconSizeData,Se=ne.maxZoom;G.compositeIconSizes=[j["icon-size"].possiblyEvaluate(new Ti(ne.minZoom),T),j["icon-size"].possiblyEvaluate(new Ti(Se),T)]}G.layoutTextSize=j["text-size"].possiblyEvaluate(new Ti(s.zoom+1),T),G.layoutIconSize=j["icon-size"].possiblyEvaluate(new Ti(s.zoom+1),T),G.textMaxSize=j["text-size"].possiblyEvaluate(new Ti(18));for(var Ve=24*R.get("text-line-height"),Le=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ct=R.get("text-keep-upright"),ft=R.get("text-size"),Rt=function(){var gr=nr[Ht],rn=R.get("text-font").evaluate(gr,{},T).join(","),on=ft.evaluate(gr,{},T),kn=G.layoutTextSize.evaluate(gr,{},T),Gn=G.layoutIconSize.evaluate(gr,{},T),zn={horizontal:{},vertical:void 0},Rn=gr.text,yi=[0,0];if(Rn){var Jn=Rn.toString(),Xn=24*R.get("text-letter-spacing").evaluate(gr,{},T),Ki=function(na){for(var Li=0,va=na;Li<va.length;Li+=1)if(Na=va[Li].charCodeAt(0),cn.Arabic(Na)||cn["Arabic Supplement"](Na)||cn["Arabic Extended-A"](Na)||cn["Arabic Presentation Forms-A"](Na)||cn["Arabic Presentation Forms-B"](Na))return!1;var Na;return!0}(Jn)?Xn:0,Mi=R.get("text-anchor").evaluate(gr,{},T),ya=R.get("text-variable-anchor");if(!ya){var li=R.get("text-radial-offset").evaluate(gr,{},T);yi=li?Et(Mi,[24*li,gt]):R.get("text-offset").evaluate(gr,{},T).map(function(na){return 24*na})}var ta=Le?"center":R.get("text-justify").evaluate(gr,{},T),Qa=R.get("symbol-placement"),Wa=Qa==="point"?24*R.get("text-max-width").evaluate(gr,{},T):0,ho=function(){s.allowVerticalPlacement&&Vl(Jn)&&(zn.vertical=wi(Rn,u,f,b,rn,Wa,Ve,Mi,"left",Ki,yi,Qn.vertical,!0,Qa,kn,on))};if(!Le&&ya){for(var po=ta==="auto"?ya.map(function(na){return Ct(na)}):[ta],Ao=!1,Is=0;Is<po.length;Is++){var Go=po[Is];if(!zn.horizontal[Go])if(Ao)zn.horizontal[Go]=zn.horizontal[0];else{var qs=wi(Rn,u,f,b,rn,Wa,Ve,"center",Go,Ki,yi,Qn.horizontal,!1,Qa,kn,on);qs&&(zn.horizontal[Go]=qs,Ao=qs.positionedLines.length===1)}}ho()}else{ta==="auto"&&(ta=Ct(Mi));var Xo=wi(Rn,u,f,b,rn,Wa,Ve,Mi,ta,Ki,yi,Qn.horizontal,!1,Qa,kn,on);Xo&&(zn.horizontal[ta]=Xo),ho(),Vl(Jn)&&Le&&ct&&(zn.vertical=wi(Rn,u,f,b,rn,Wa,Ve,Mi,ta,Ki,yi,Qn.vertical,!1,Qa,kn,on))}}var au=void 0,ua=!1;if(gr.icon&&gr.icon.name){var Ja=g[gr.icon.name];Ja&&(au=function(na,Li,va){var Na=Pa(va),ou=Li[0]-na.displaySize[0]*Na.horizontalAlign,eo=Li[1]-na.displaySize[1]*Na.verticalAlign;return{image:na,top:eo,bottom:eo+na.displaySize[1],left:ou,right:ou+na.displaySize[0]}}(b[gr.icon.name],R.get("icon-offset").evaluate(gr,{},T),R.get("icon-anchor").evaluate(gr,{},T)),ua=Ja.sdf,s.sdfIcons===void 0?s.sdfIcons=Ja.sdf:s.sdfIcons!==Ja.sdf&&Ut("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ja.pixelRatio!==s.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}var bo=_t(zn.horizontal)||zn.vertical;s.iconsInText=!!bo&&bo.iconsInText,(bo||au)&&function(na,Li,va,Na,ou,eo,to,ds,ia,Rf,Sl){var mc=eo.textMaxSize.evaluate(Li,{});mc===void 0&&(mc=to);var Qu,Ts=na.layers[0].layout,uh=Ts.get("icon-offset").evaluate(Li,{},Sl),gc=_t(va.horizontal),Zc=to/24,Td=na.tilePixelRatio*Zc,$c=na.tilePixelRatio*mc/24,Mf=na.tilePixelRatio*ds,Cd=na.tilePixelRatio*Ts.get("symbol-spacing"),Cp=Ts.get("text-padding")*na.tilePixelRatio,Vm=Ts.get("icon-padding")*na.tilePixelRatio,wd=Ts.get("text-max-angle")/180*Math.PI,Hm=Ts.get("text-rotation-alignment")==="map"&&Ts.get("symbol-placement")!=="point",Yc=Ts.get("icon-rotation-alignment")==="map"&&Ts.get("symbol-placement")!=="point",wp=Ts.get("symbol-placement"),wv=Cd/2,Op=Ts.get("icon-text-fit");Na&&Op!=="none"&&(na.allowVerticalPlacement&&va.vertical&&(Qu=Fo(Na,va.vertical,Op,Ts.get("icon-text-fit-padding"),uh,Zc)),gc&&(Na=Fo(Na,gc,Op,Ts.get("icon-text-fit-padding"),uh,Zc)));var lh=function(ly,Ip){Ip.x<0||Ip.x>=8192||Ip.y<0||Ip.y>=8192||function(xo,Al,y_,hh,Gm,Xm,Dp,_c,Dd,kd,kv,kp,Zm,cy,ph,Fv,fy,Fp,hy,py,el,Bv,dy,qc,__){var vy,dh,Bp,Lp,Np,jp=xo.addToLineVertexArray(Al,y_),gy=0,yy=0,$m=0,_y=0,Ym=-1,Km=-1,Pf={},zp=Ye(""),Lv=0,qm=0;if(_c._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Lv=(vy=_c.layout.get("text-offset").evaluate(el,{},qc).map(function(Ay){return 24*Ay}))[0],qm=vy[1]):(Lv=24*_c.layout.get("text-radial-offset").evaluate(el,{},qc),qm=gt),xo.allowVerticalPlacement&&hh.vertical){var Nv=_c.layout.get("text-rotate").evaluate(el,{},qc)+90;Lp=new xa(Dd,Al,kd,kv,kp,hh.vertical,Zm,cy,ph,Nv),Dp&&(Np=new xa(Dd,Al,kd,kv,kp,Dp,fy,Fp,ph,Nv))}if(Gm){var Qm=_c.layout.get("icon-rotate").evaluate(el,{}),by=_c.layout.get("icon-text-fit")!=="none",jv=Ze(Gm,Qm,dy,by),Fd=Dp?Ze(Dp,Qm,dy,by):void 0;Bp=new xa(Dd,Al,kd,kv,kp,Gm,fy,Fp,!1,Qm),gy=4*jv.length;var zv=xo.iconSizeData,Bd=null;zv.kind==="source"?(Bd=[128*_c.layout.get("icon-size").evaluate(el,{})])[0]>32640&&Ut(xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):zv.kind==="composite"&&((Bd=[128*Bv.compositeIconSizes[0].evaluate(el,{},qc),128*Bv.compositeIconSizes[1].evaluate(el,{},qc)])[0]>32640||Bd[1]>32640)&&Ut(xo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),xo.addSymbols(xo.icon,jv,Bd,py,hy,el,!1,Al,jp.lineStartIndex,jp.lineLength,-1,qc),Ym=xo.icon.placedSymbolArray.length-1,Fd&&(yy=4*Fd.length,xo.addSymbols(xo.icon,Fd,Bd,py,hy,el,Qn.vertical,Al,jp.lineStartIndex,jp.lineLength,-1,qc),Km=xo.icon.placedSymbolArray.length-1)}for(var xy in hh.horizontal){var Up=hh.horizontal[xy];if(!dh){zp=Ye(Up.text);var Jm=_c.layout.get("text-rotate").evaluate(el,{},qc);dh=new xa(Dd,Al,kd,kv,kp,Up,Zm,cy,ph,Jm)}var Ey=Up.positionedLines.length===1;if($m+=Ge(xo,Al,Up,Xm,_c,ph,el,Fv,jp,hh.vertical?Qn.horizontal:Qn.horizontalOnly,Ey?Object.keys(hh.horizontal):[xy],Pf,Ym,Bv,qc),Ey)break}hh.vertical&&(_y+=Ge(xo,Al,hh.vertical,Xm,_c,ph,el,Fv,jp,Qn.vertical,["vertical"],Pf,Km,Bv,qc));var yb=dh?dh.boxStartIndex:xo.collisionBoxArray.length,Qr=dh?dh.boxEndIndex:xo.collisionBoxArray.length,b_=Lp?Lp.boxStartIndex:xo.collisionBoxArray.length,x_=Lp?Lp.boxEndIndex:xo.collisionBoxArray.length,Yt=Bp?Bp.boxStartIndex:xo.collisionBoxArray.length,E_=Bp?Bp.boxEndIndex:xo.collisionBoxArray.length,S_=Np?Np.boxStartIndex:xo.collisionBoxArray.length,Sy=Np?Np.boxEndIndex:xo.collisionBoxArray.length,Qc=-1,Ld=function(eg,tg){return eg&&eg.circleDiameter?Math.max(eg.circleDiameter,tg):tg};Qc=Ld(dh,Qc),Qc=Ld(Lp,Qc),Qc=Ld(Bp,Qc);var Vp=(Qc=Ld(Np,Qc))>-1?1:0;Vp&&(Qc*=__/24),xo.glyphOffsetArray.length>=Dn.MAX_GLYPHS&&Ut("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),el.sortKey!==void 0&&xo.addToSortKeyRanges(xo.symbolInstances.length,el.sortKey),xo.symbolInstances.emplaceBack(Al.x,Al.y,Pf.right>=0?Pf.right:-1,Pf.center>=0?Pf.center:-1,Pf.left>=0?Pf.left:-1,Pf.vertical||-1,Ym,Km,zp,yb,Qr,b_,x_,Yt,E_,S_,Sy,kd,$m,_y,gy,yy,Vp,0,Zm,Lv,qm,Qc)}(na,Ip,ly,va,Na,ou,Qu,na.layers[0],na.collisionBoxArray,Li.index,Li.sourceLayerIndex,na.index,Td,Cp,Hm,ia,Mf,Vm,Yc,uh,Li,eo,Rf,Sl,to)};if(wp==="line")for(var Ov=0,Od=Us(Li.geometry,0,0,8192,8192);Ov<Od.length;Ov+=1)for(var Rp=Od[Ov],Kh=0,Rv=ps(Rp,Cd,wd,va.vertical||gc,Na,24,$c,na.overscaling,8192);Kh<Rv.length;Kh+=1){var Ju=Rv[Kh];gc&&Pe(na,gc.text,wv,Ju)||lh(Rp,Ju)}else if(wp==="line-center")for(var Mp=0,Mv=Li.geometry;Mp<Mv.length;Mp+=1){var Rd=Mv[Mp];if(Rd.length>1){var qh=ra(Rd,wd,va.vertical||gc,Na,24,$c);qh&&lh(Rd,qh)}}else if(Li.type==="Polygon")for(var Md=0,Kc=pd(Li.geometry,0);Md<Kc.length;Md+=1){var Pd=Kc[Md],ch=it(Pd,16);lh(Pd[0],new uo(ch.x,ch.y,0))}else if(Li.type==="LineString")for(var Pp=0,fh=Li.geometry;Pp<fh.length;Pp+=1){var Pv=fh[Pp];lh(Pv,new uo(Pv[0].x,Pv[0].y,0))}else if(Li.type==="Point")for(var Id=0,Iv=Li.geometry;Id<Iv.length;Id+=1)for(var Dv=0,Wm=Iv[Id];Dv<Wm.length;Dv+=1){var yc=Wm[Dv];lh([yc],new uo(yc.x,yc.y,0))}}(s,gr,zn,au,g,G,kn,Gn,yi,ua,T)},Ht=0,nr=s.features;Ht<nr.length;Ht+=1)Rt();E&&s.generateCollisionDebugBuffers()},v.perspective=function(s,u,f,g,b){var E,T=1/Math.tan(u/2);return s[0]=T/f,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,b!=null&&b!==1/0?(s[10]=(b+g)*(E=1/(g-b)),s[14]=2*b*g*E):(s[10]=-1,s[14]=-2*g),s},v.pick=function(s,u){for(var f={},g=0;g<u.length;g++){var b=u[g];b in s&&(f[b]=s[b])}return f},v.plugin=js,v.polygonIntersectsPolygon=Yu,v.postMapLoadEvent=Ot,v.postTurnstileEvent=sr,v.potpack=bi,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=On,v.registerForPluginStateChange=function(s){return s({pluginStatus:ws,pluginURL:Xu}),Bc.on("pluginStateChange",s),s},v.renderColorRamp=hd,v.rotate=function(s,u,f){var g=u[0],b=u[1],E=u[2],T=u[3],R=Math.sin(f),j=Math.cos(f);return s[0]=g*j+E*R,s[1]=b*j+T*R,s[2]=g*-R+E*j,s[3]=b*-R+T*j,s},v.rotateX=function(s,u,f){var g=Math.sin(f),b=Math.cos(f),E=u[4],T=u[5],R=u[6],j=u[7],G=u[8],$=u[9],te=u[10],ne=u[11];return u!==s&&(s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[4]=E*b+G*g,s[5]=T*b+$*g,s[6]=R*b+te*g,s[7]=j*b+ne*g,s[8]=G*b-E*g,s[9]=$*b-T*g,s[10]=te*b-R*g,s[11]=ne*b-j*g,s},v.rotateZ=function(s,u,f){var g=Math.sin(f),b=Math.cos(f),E=u[0],T=u[1],R=u[2],j=u[3],G=u[4],$=u[5],te=u[6],ne=u[7];return u!==s&&(s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[0]=E*b+G*g,s[1]=T*b+$*g,s[2]=R*b+te*g,s[3]=j*b+ne*g,s[4]=G*b-E*g,s[5]=$*b-T*g,s[6]=te*b-R*g,s[7]=ne*b-j*g,s},v.scale=function(s,u,f){var g=f[0],b=f[1],E=f[2];return s[0]=u[0]*g,s[1]=u[1]*g,s[2]=u[2]*g,s[3]=u[3]*g,s[4]=u[4]*b,s[5]=u[5]*b,s[6]=u[6]*b,s[7]=u[7]*b,s[8]=u[8]*E,s[9]=u[9]*E,s[10]=u[10]*E,s[11]=u[11]*E,s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},v.scale$1=function(s,u,f){return s[0]=u[0]*f,s[1]=u[1]*f,s[2]=u[2]*f,s[3]=u[3]*f,s},v.scale$2=function(s,u,f){return s[0]=u[0]*f,s[1]=u[1]*f,s[2]=u[2]*f,s},v.setCacheLimits=function(s,u){or=s,Tr=u},v.setRTLTextPlugin=function(s,u,f){if(f===void 0&&(f=!1),ws==="deferred"||ws==="loading"||ws==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Xu=pn.resolveURL(s),ws="deferred",yf=u,Zu(),f||Gs()},v.sphericalToCartesian=function(s){var u=s[0],f=s[1],g=s[2];return f+=90,f*=Math.PI/180,g*=Math.PI/180,{x:u*Math.cos(f)*Math.sin(g),y:u*Math.sin(f)*Math.sin(g),z:u*Math.cos(g)}},v.sqrLen=function(s){var u=s[0],f=s[1];return u*u+f*f},v.styleSpec=xe,v.sub=function(s,u,f){return s[0]=u[0]-f[0],s[1]=u[1]-f[1],s[2]=u[2]-f[2],s},v.symbolSize=ki,v.transformMat3=function(s,u,f){var g=u[0],b=u[1],E=u[2];return s[0]=g*f[0]+b*f[3]+E*f[6],s[1]=g*f[1]+b*f[4]+E*f[7],s[2]=g*f[2]+b*f[5]+E*f[8],s},v.transformMat4=Cu,v.translate=function(s,u,f){var g,b,E,T,R,j,G,$,te,ne,Se,Ve,Le=f[0],ct=f[1],ft=f[2];return u===s?(s[12]=u[0]*Le+u[4]*ct+u[8]*ft+u[12],s[13]=u[1]*Le+u[5]*ct+u[9]*ft+u[13],s[14]=u[2]*Le+u[6]*ct+u[10]*ft+u[14],s[15]=u[3]*Le+u[7]*ct+u[11]*ft+u[15]):(b=u[1],E=u[2],T=u[3],R=u[4],j=u[5],G=u[6],$=u[7],te=u[8],ne=u[9],Se=u[10],Ve=u[11],s[0]=g=u[0],s[1]=b,s[2]=E,s[3]=T,s[4]=R,s[5]=j,s[6]=G,s[7]=$,s[8]=te,s[9]=ne,s[10]=Se,s[11]=Ve,s[12]=g*Le+R*ct+te*ft+u[12],s[13]=b*Le+j*ct+ne*ft+u[13],s[14]=E*Le+G*ct+Se*ft+u[14],s[15]=T*Le+$*ct+Ve*ft+u[15]),s},v.triggerPluginCompletionEvent=fd,v.uniqueId=Je,v.validateCustomStyleLayer=function(s){var u=[],f=s.id;return f===void 0&&u.push({message:"layers."+f+': missing required property "id"'}),s.render===void 0&&u.push({message:"layers."+f+': missing required method "render"'}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&u.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),u},v.validateLight=hf,v.validateStyle=$f,v.values=function(s){var u=[];for(var f in s)u.push(s[f]);return u},v.vectorTile=Xc,v.version="1.13.3",v.warnOnce=Ut,v.webpSupported=Pn,v.window=ue,v.wrap=ht}),k(["./shared"],function(v){"use strict";function L(re){var J=typeof re;if(J==="number"||J==="boolean"||J==="string"||re==null)return JSON.stringify(re);if(Array.isArray(re)){for(var me="[",we=0,ze=re;we<ze.length;we+=1)me+=L(ze[we])+",";return me+"]"}for(var mt=Object.keys(re).sort(),Tt="{",xe=0;xe<mt.length;xe++)Tt+=JSON.stringify(mt[xe])+":"+L(re[mt[xe]])+",";return Tt+"}"}function U(re){for(var J="",me=0,we=v.refProperties;me<we.length;me+=1)J+="/"+L(re[we[me]]);return J}var K=function(J){this.keyCache={},J&&this.replace(J)};K.prototype.replace=function(re){this._layerConfigs={},this._layers={},this.update(re,[])},K.prototype.update=function(re,J){for(var me=this,we=0,ze=re;we<ze.length;we+=1){var mt=ze[we];this._layerConfigs[mt.id]=mt;var Tt=this._layers[mt.id]=v.createStyleLayer(mt);Tt._featureFilter=v.featureFilter(Tt.filter),this.keyCache[mt.id]&&delete this.keyCache[mt.id]}for(var xe=0,Qe=J;xe<Qe.length;xe+=1){var Nt=Qe[xe];delete this.keyCache[Nt],delete this._layerConfigs[Nt],delete this._layers[Nt]}this.familiesBySource={};for(var wr=0,Vr=function(dn,yn){for(var ci={},vn=0;vn<dn.length;vn++){var Ai=yn&&yn[dn[vn].id]||U(dn[vn]);yn&&(yn[dn[vn].id]=Ai);var Zi=ci[Ai];Zi||(Zi=ci[Ai]=[]),Zi.push(dn[vn])}var Bi=[];for(var $i in ci)Bi.push(ci[$i]);return Bi}(v.values(this._layerConfigs),this.keyCache);wr<Vr.length;wr+=1){var pr=Vr[wr].map(function(dn){return me._layers[dn.id]}),De=pr[0];if(De.visibility!=="none"){var et=De.source||"",Lt=this.familiesBySource[et];Lt||(Lt=this.familiesBySource[et]={});var ut=De.sourceLayer||"_geojsonTileLayer",Te=Lt[ut];Te||(Te=Lt[ut]=[]),Te.push(pr)}}};var q=function(J){var me={},we=[];for(var ze in J){var mt=J[ze],Tt=me[ze]={};for(var xe in mt){var Qe=mt[+xe];if(Qe&&Qe.bitmap.width!==0&&Qe.bitmap.height!==0){var Nt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};we.push(Nt),Tt[xe]={rect:Nt,metrics:Qe.metrics}}}}var wr=v.potpack(we),Vr=new v.AlphaImage({width:wr.w||1,height:wr.h||1});for(var pr in J){var De=J[pr];for(var et in De){var Lt=De[+et];if(Lt&&Lt.bitmap.width!==0&&Lt.bitmap.height!==0){var ut=me[pr][et].rect;v.AlphaImage.copy(Lt.bitmap,Vr,{x:0,y:0},{x:ut.x+1,y:ut.y+1},Lt.bitmap)}}}this.image=Vr,this.positions=me};v.register("GlyphAtlas",q);var fe=function(J){this.tileID=new v.OverscaledTileID(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.uid=J.uid,this.zoom=J.zoom,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.returnDependencies=!!J.returnDependencies,this.promoteId=J.promoteId};function ue(re,J,me){for(var we=new v.EvaluationParameters(J),ze=0,mt=re;ze<mt.length;ze+=1)mt[ze].recalculate(we,me)}function rt(re,J){var me=v.getArrayBuffer(re.request,function(we,ze,mt,Tt){we?J(we):ze&&J(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(ze)),rawData:ze,cacheControl:mt,expires:Tt})});return function(){me.cancel(),J()}}fe.prototype.parse=function(re,J,me,we,ze){var mt=this;this.status="parsing",this.data=re,this.collisionBoxArray=new v.CollisionBoxArray;var Tt=new v.DictionaryCoder(Object.keys(re.layers).sort()),xe=new v.FeatureIndex(this.tileID,this.promoteId);xe.bucketLayerIDs=[];var Qe,Nt,wr,Vr,pr={},De={featureIndex:xe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:me},et=J.familiesBySource[this.source];for(var Lt in et){var ut=re.layers[Lt];if(ut){ut.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Lt+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Te=Tt.encode(Lt),dn=[],yn=0;yn<ut.length;yn++){var ci=ut.feature(yn),vn=xe.getId(ci,Lt);dn.push({feature:ci,id:vn,index:yn,sourceLayerIndex:Te})}for(var Ai=0,Zi=et[Lt];Ai<Zi.length;Ai+=1){var Bi=Zi[Ai],$i=Bi[0];$i.minzoom&&this.zoom<Math.floor($i.minzoom)||$i.maxzoom&&this.zoom>=$i.maxzoom||$i.visibility!=="none"&&(ue(Bi,this.zoom,me),(pr[$i.id]=$i.createBucket({index:xe.bucketLayerIDs.length,layers:Bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Te,sourceID:this.source})).populate(dn,De,this.tileID.canonical),xe.bucketLayerIDs.push(Bi.map(function(Wi){return Wi.id})))}}}var zi=v.mapObject(De.glyphDependencies,function(Wi){return Object.keys(Wi).map(Number)});Object.keys(zi).length?we.send("getGlyphs",{uid:this.uid,stacks:zi},function(Wi,Ni){Qe||(Qe=Wi,Nt=Ni,ja.call(mt))}):Nt={};var $o=Object.keys(De.iconDependencies);$o.length?we.send("getImages",{icons:$o,source:this.source,tileID:this.tileID,type:"icons"},function(Wi,Ni){Qe||(Qe=Wi,wr=Ni,ja.call(mt))}):wr={};var Ii=Object.keys(De.patternDependencies);function ja(){if(Qe)return ze(Qe);if(Nt&&wr&&Vr){var Wi=new q(Nt),Ni=new v.ImageAtlas(wr,Vr);for(var di in pr){var ao=pr[di];ao instanceof v.SymbolBucket?(ue(ao.layers,this.zoom,me),v.performSymbolLayout(ao,Nt,Wi.positions,wr,Ni.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):ao.hasPattern&&(ao instanceof v.LineBucket||ao instanceof v.FillBucket||ao instanceof v.FillExtrusionBucket)&&(ue(ao.layers,this.zoom,me),ao.addFeatures(De,this.tileID.canonical,Ni.patternPositions))}this.status="done",ze(null,{buckets:v.values(pr).filter(function(Bs){return!Bs.isEmpty()}),featureIndex:xe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wi.image,imageAtlas:Ni,glyphMap:this.returnDependencies?Nt:null,iconMap:this.returnDependencies?wr:null,glyphPositions:this.returnDependencies?Wi.positions:null})}}Ii.length?we.send("getImages",{icons:Ii,source:this.source,tileID:this.tileID,type:"patterns"},function(Wi,Ni){Qe||(Qe=Wi,Vr=Ni,ja.call(mt))}):Vr={},ja.call(this)};var Ne=function(J,me,we,ze){this.actor=J,this.layerIndex=me,this.availableImages=we,this.loadVectorData=ze||rt,this.loading={},this.loaded={}};Ne.prototype.loadTile=function(re,J){var me=this,we=re.uid;this.loading||(this.loading={});var ze=!!(re&&re.request&&re.request.collectResourceTiming)&&new v.RequestPerformance(re.request),mt=this.loading[we]=new fe(re);mt.abort=this.loadVectorData(re,function(Tt,xe){if(delete me.loading[we],Tt||!xe)return mt.status="done",me.loaded[we]=mt,J(Tt);var Qe=xe.rawData,Nt={};xe.expires&&(Nt.expires=xe.expires),xe.cacheControl&&(Nt.cacheControl=xe.cacheControl);var wr={};if(ze){var Vr=ze.finish();Vr&&(wr.resourceTiming=JSON.parse(JSON.stringify(Vr)))}mt.vectorTile=xe.vectorTile,mt.parse(xe.vectorTile,me.layerIndex,me.availableImages,me.actor,function(pr,De){if(pr||!De)return J(pr);J(null,v.extend({rawTileData:Qe.slice(0)},De,Nt,wr))}),me.loaded=me.loaded||{},me.loaded[we]=mt})},Ne.prototype.reloadTile=function(re,J){var me=this,we=this.loaded,ze=re.uid,mt=this;if(we&&we[ze]){var Tt=we[ze];Tt.showCollisionBoxes=re.showCollisionBoxes;var xe=function(Nt,wr){var Vr=Tt.reloadCallback;Vr&&(delete Tt.reloadCallback,Tt.parse(Tt.vectorTile,mt.layerIndex,me.availableImages,mt.actor,Vr)),J(Nt,wr)};Tt.status==="parsing"?Tt.reloadCallback=xe:Tt.status==="done"&&(Tt.vectorTile?Tt.parse(Tt.vectorTile,this.layerIndex,this.availableImages,this.actor,xe):xe())}},Ne.prototype.abortTile=function(re,J){var me=this.loading,we=re.uid;me&&me[we]&&me[we].abort&&(me[we].abort(),delete me[we]),J()},Ne.prototype.removeTile=function(re,J){var me=this.loaded,we=re.uid;me&&me[we]&&delete me[we],J()};var nt=v.window.ImageBitmap,wt=function(){this.loaded={}};function ht(re,J){if(re.length!==0){We(re[0],J);for(var me=1;me<re.length;me++)We(re[me],!J)}}function We(re,J){for(var me=0,we=0,ze=0,mt=re.length,Tt=mt-1;ze<mt;Tt=ze++){var xe=(re[ze][0]-re[Tt][0])*(re[Tt][1]+re[ze][1]),Qe=me+xe;we+=Math.abs(me)>=Math.abs(xe)?me-Qe+xe:xe-Qe+me,me=Qe}me+we>=0!=!!J&&re.reverse()}wt.prototype.loadTile=function(re,J){var me=re.uid,we=re.encoding,ze=re.rawImageData,mt=nt&&ze instanceof nt?this.getImageData(ze):ze,Tt=new v.DEMData(me,mt,we);this.loaded=this.loaded||{},this.loaded[me]=Tt,J(null,Tt)},wt.prototype.getImageData=function(re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);var J=this.offscreenCanvasContext.getImageData(-1,-1,re.width+2,re.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:J.width,height:J.height},J.data)},wt.prototype.removeTile=function(re){var J=this.loaded,me=re.uid;J&&J[me]&&delete J[me]};var St=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,Je=function(J){this._feature=J,this.extent=v.EXTENT,this.type=J.type,this.properties=J.tags,"id"in J&&!isNaN(J.id)&&(this.id=parseInt(J.id,10))};Je.prototype.loadGeometry=function(){if(this._feature.type===1){for(var re=[],J=0,me=this._feature.geometry;J<me.length;J+=1){var we=me[J];re.push([new v.Point$1(we[0],we[1])])}return re}for(var ze=[],mt=0,Tt=this._feature.geometry;mt<Tt.length;mt+=1){for(var xe=[],Qe=0,Nt=Tt[mt];Qe<Nt.length;Qe+=1){var wr=Nt[Qe];xe.push(new v.Point$1(wr[0],wr[1]))}ze.push(xe)}return ze},Je.prototype.toGeoJSON=function(re,J,me){return St.call(this,re,J,me)};var Ft=function(J){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=J.length,this._features=J};Ft.prototype.feature=function(re){return new Je(this._features[re])};var tr=v.vectorTile.VectorTileFeature,yr=Dr;function Dr(re,J){this.options=J||{},this.features=re,this.length=re.length}function Mr(re,J){this.id=typeof re.id=="number"?re.id:void 0,this.type=re.type,this.rawGeometry=re.type===1?[re.geometry]:re.geometry,this.properties=re.tags,this.extent=J||4096}Dr.prototype.feature=function(re){return new Mr(this.features[re],this.options.extent)},Mr.prototype.loadGeometry=function(){var re=this.rawGeometry;this.geometry=[];for(var J=0;J<re.length;J++){for(var me=re[J],we=[],ze=0;ze<me.length;ze++)we.push(new v.Point$1(me[ze][0],me[ze][1]));this.geometry.push(we)}return this.geometry},Mr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var re=this.geometry,J=1/0,me=-1/0,we=1/0,ze=-1/0,mt=0;mt<re.length;mt++)for(var Tt=re[mt],xe=0;xe<Tt.length;xe++){var Qe=Tt[xe];J=Math.min(J,Qe.x),me=Math.max(me,Qe.x),we=Math.min(we,Qe.y),ze=Math.max(ze,Qe.y)}return[J,we,me,ze]},Mr.prototype.toGeoJSON=tr.prototype.toGeoJSON;var jt=Dt,He=yr;function Dt(re){var J=new v.pbf;return function(me,we){for(var ze in me.layers)we.writeMessage(3,Ut,me.layers[ze])}(re,J),J.finish()}function Ut(re,J){var me;J.writeVarintField(15,re.version||1),J.writeStringField(1,re.name||""),J.writeVarintField(5,re.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(me=0;me<re.length;me++)we.feature=re.feature(me),J.writeMessage(2,Ce,we);var ze=we.keys;for(me=0;me<ze.length;me++)J.writeStringField(3,ze[me]);var mt=we.values;for(me=0;me<mt.length;me++)J.writeMessage(4,Me,mt[me])}function Ce(re,J){var me=re.feature;me.id!==void 0&&J.writeVarintField(1,me.id),J.writeMessage(2,ve,re),J.writeVarintField(3,me.type),J.writeMessage(4,le,me)}function ve(re,J){var me=re.feature,we=re.keys,ze=re.values,mt=re.keycache,Tt=re.valuecache;for(var xe in me.properties){var Qe=mt[xe];Qe===void 0&&(we.push(xe),mt[xe]=Qe=we.length-1),J.writeVarint(Qe);var Nt=me.properties[xe],wr=typeof Nt;wr!=="string"&&wr!=="boolean"&&wr!=="number"&&(Nt=JSON.stringify(Nt));var Vr=wr+":"+Nt,pr=Tt[Vr];pr===void 0&&(ze.push(Nt),Tt[Vr]=pr=ze.length-1),J.writeVarint(pr)}}function Ie(re,J){return(J<<3)+(7&re)}function zt(re){return re<<1^re>>31}function le(re,J){for(var me=re.loadGeometry(),we=re.type,ze=0,mt=0,Tt=me.length,xe=0;xe<Tt;xe++){var Qe=me[xe],Nt=1;we===1&&(Nt=Qe.length),J.writeVarint(Ie(1,Nt));for(var wr=we===3?Qe.length-1:Qe.length,Vr=0;Vr<wr;Vr++){Vr===1&&we!==1&&J.writeVarint(Ie(2,wr-1));var pr=Qe[Vr].x-ze,De=Qe[Vr].y-mt;J.writeVarint(zt(pr)),J.writeVarint(zt(De)),ze+=pr,mt+=De}we===3&&J.writeVarint(Ie(7,1))}}function Me(re,J){var me=typeof re;me==="string"?J.writeStringField(1,re):me==="boolean"?J.writeBooleanField(7,re):me==="number"&&(re%1!=0?J.writeDoubleField(3,re):re<0?J.writeSVarintField(6,re):J.writeVarintField(5,re))}function Re(re,J,me,we){yt(re,me,we),yt(J,2*me,2*we),yt(J,2*me+1,2*we+1)}function yt(re,J,me){var we=re[J];re[J]=re[me],re[me]=we}function At(re,J,me,we){var ze=re-me,mt=J-we;return ze*ze+mt*mt}jt.fromVectorTileJs=Dt,jt.fromGeojsonVt=function(re,J){J=J||{};var me={};for(var we in re)me[we]=new yr(re[we].features,J),me[we].name=we,me[we].version=J.version,me[we].extent=J.extent;return Dt({layers:me})},jt.GeoJSONWrapper=He;var ae=function(J){return J[0]},It=function(J){return J[1]},lr=function(J,me,we,ze,mt){me===void 0&&(me=ae),we===void 0&&(we=It),ze===void 0&&(ze=64),mt===void 0&&(mt=Float64Array),this.nodeSize=ze,this.points=J;for(var Tt=J.length<65536?Uint16Array:Uint32Array,xe=this.ids=new Tt(J.length),Qe=this.coords=new mt(2*J.length),Nt=0;Nt<J.length;Nt++)xe[Nt]=Nt,Qe[2*Nt]=me(J[Nt]),Qe[2*Nt+1]=we(J[Nt]);(function wr(Vr,pr,De,et,Lt,ut){if(!(Lt-et<=De)){var Te=et+Lt>>1;(function dn(yn,ci,vn,Ai,Zi,Bi){for(;Zi>Ai;){if(Zi-Ai>600){var $i=Zi-Ai+1,zi=vn-Ai+1,$o=Math.log($i),Ii=.5*Math.exp(2*$o/3),ja=.5*Math.sqrt($o*Ii*($i-Ii)/$i)*(zi-$i/2<0?-1:1);dn(yn,ci,vn,Math.max(Ai,Math.floor(vn-zi*Ii/$i+ja)),Math.min(Zi,Math.floor(vn+($i-zi)*Ii/$i+ja)),Bi)}var Wi=ci[2*vn+Bi],Ni=Ai,di=Zi;for(Re(yn,ci,Ai,vn),ci[2*Zi+Bi]>Wi&&Re(yn,ci,Ai,Zi);Ni<di;){for(Re(yn,ci,Ni,di),Ni++,di--;ci[2*Ni+Bi]<Wi;)Ni++;for(;ci[2*di+Bi]>Wi;)di--}ci[2*Ai+Bi]===Wi?Re(yn,ci,Ai,di):Re(yn,ci,++di,Zi),di<=vn&&(Ai=di+1),vn<=di&&(Zi=di-1)}})(Vr,pr,Te,et,Lt,ut%2),wr(Vr,pr,De,et,Te-1,ut+1),wr(Vr,pr,De,Te+1,Lt,ut+1)}})(xe,Qe,ze,0,xe.length-1,0)};lr.prototype.range=function(re,J,me,we){return function(ze,mt,Tt,xe,Qe,Nt,wr){for(var Vr,pr,De=[0,ze.length-1,0],et=[];De.length;){var Lt=De.pop(),ut=De.pop(),Te=De.pop();if(ut-Te<=wr)for(var dn=Te;dn<=ut;dn++)pr=mt[2*dn+1],(Vr=mt[2*dn])>=Tt&&Vr<=Qe&&pr>=xe&&pr<=Nt&&et.push(ze[dn]);else{var yn=Math.floor((Te+ut)/2);pr=mt[2*yn+1],(Vr=mt[2*yn])>=Tt&&Vr<=Qe&&pr>=xe&&pr<=Nt&&et.push(ze[yn]);var ci=(Lt+1)%2;(Lt===0?Tt<=Vr:xe<=pr)&&(De.push(Te),De.push(yn-1),De.push(ci)),(Lt===0?Qe>=Vr:Nt>=pr)&&(De.push(yn+1),De.push(ut),De.push(ci))}}return et}(this.ids,this.coords,re,J,me,we,this.nodeSize)},lr.prototype.within=function(re,J,me){return function(we,ze,mt,Tt,xe,Qe){for(var Nt=[0,we.length-1,0],wr=[],Vr=xe*xe;Nt.length;){var pr=Nt.pop(),De=Nt.pop(),et=Nt.pop();if(De-et<=Qe)for(var Lt=et;Lt<=De;Lt++)At(ze[2*Lt],ze[2*Lt+1],mt,Tt)<=Vr&&wr.push(we[Lt]);else{var ut=Math.floor((et+De)/2),Te=ze[2*ut],dn=ze[2*ut+1];At(Te,dn,mt,Tt)<=Vr&&wr.push(we[ut]);var yn=(pr+1)%2;(pr===0?mt-xe<=Te:Tt-xe<=dn)&&(Nt.push(et),Nt.push(ut-1),Nt.push(yn)),(pr===0?mt+xe>=Te:Tt+xe>=dn)&&(Nt.push(ut+1),Nt.push(De),Nt.push(yn))}}return wr}(this.ids,this.coords,re,J,me,this.nodeSize)};var Cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(J){return J}},Br=function(J){this.options=Yn(Object.create(Cr),J),this.trees=new Array(this.options.maxZoom+1)};function pn(re,J,me,we,ze){return{x:re,y:J,zoom:1/0,id:me,parentId:-1,numPoints:we,properties:ze}}function Fr(re,J){var me=re.geometry.coordinates,we=me[1];return{x:Nn(me[0]),y:Kn(we),zoom:1/0,index:J,parentId:-1}}function Pn(re){return{type:"Feature",id:re.id,properties:ni(re),geometry:{type:"Point",coordinates:[(we=re.x,360*(we-.5)),(J=re.y,me=(180-360*J)*Math.PI/180,360*Math.atan(Math.exp(me))/Math.PI-90)]}};var J,me,we}function ni(re){var J=re.numPoints,me=J>=1e4?Math.round(J/1e3)+"k":J>=1e3?Math.round(J/100)/10+"k":J;return Yn(Yn({},re.properties),{cluster:!0,cluster_id:re.id,point_count:J,point_count_abbreviated:me})}function Nn(re){return re/360+.5}function Kn(re){var J=Math.sin(re*Math.PI/180),me=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return me<0?0:me>1?1:me}function Yn(re,J){for(var me in J)re[me]=J[me];return re}function Ar(re){return re.x}function mr(re){return re.y}function Xt(re,J,me,we,ze,mt){var Tt=ze-me,xe=mt-we;if(Tt!==0||xe!==0){var Qe=((re-me)*Tt+(J-we)*xe)/(Tt*Tt+xe*xe);Qe>1?(me=ze,we=mt):Qe>0&&(me+=Tt*Qe,we+=xe*Qe)}return(Tt=re-me)*Tt+(xe=J-we)*xe}function Wt(re,J,me,we){var ze={id:re===void 0?null:re,type:J,geometry:me,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(mt){var Tt=mt.geometry,xe=mt.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Ir(mt,Tt);else if(xe==="Polygon"||xe==="MultiLineString")for(var Qe=0;Qe<Tt.length;Qe++)Ir(mt,Tt[Qe]);else if(xe==="MultiPolygon")for(Qe=0;Qe<Tt.length;Qe++)for(var Nt=0;Nt<Tt[Qe].length;Nt++)Ir(mt,Tt[Qe][Nt])}(ze),ze}function Ir(re,J){for(var me=0;me<J.length;me+=3)re.minX=Math.min(re.minX,J[me]),re.minY=Math.min(re.minY,J[me+1]),re.maxX=Math.max(re.maxX,J[me]),re.maxY=Math.max(re.maxY,J[me+1])}function Ue(re,J,me,we){if(J.geometry){var ze=J.geometry.coordinates,mt=J.geometry.type,Tt=Math.pow(me.tolerance/((1<<me.maxZoom)*me.extent),2),xe=[],Qe=J.id;if(me.promoteId?Qe=J.properties[me.promoteId]:me.generateId&&(Qe=we||0),mt==="Point")he(ze,xe);else if(mt==="MultiPoint")for(var Nt=0;Nt<ze.length;Nt++)he(ze[Nt],xe);else if(mt==="LineString")ie(ze,xe,Tt,!1);else if(mt==="MultiLineString"){if(me.lineMetrics){for(Nt=0;Nt<ze.length;Nt++)ie(ze[Nt],xe=[],Tt,!1),re.push(Wt(Qe,"LineString",xe,J.properties));return}B(ze,xe,Tt,!1)}else if(mt==="Polygon")B(ze,xe,Tt,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(Nt=0;Nt<J.geometry.geometries.length;Nt++)Ue(re,{id:Qe,geometry:J.geometry.geometries[Nt],properties:J.properties},me,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Nt=0;Nt<ze.length;Nt++){var wr=[];B(ze[Nt],wr,Tt,!0),xe.push(wr)}}re.push(Wt(Qe,mt,xe,J.properties))}}function he(re,J){J.push(Ae(re[0])),J.push(Xe(re[1])),J.push(0)}function ie(re,J,me,we){for(var ze,mt,Tt=0,xe=0;xe<re.length;xe++){var Qe=Ae(re[xe][0]),Nt=Xe(re[xe][1]);J.push(Qe),J.push(Nt),J.push(0),xe>0&&(Tt+=we?(ze*Nt-Qe*mt)/2:Math.sqrt(Math.pow(Qe-ze,2)+Math.pow(Nt-mt,2))),ze=Qe,mt=Nt}var wr=J.length-3;J[2]=1,function Vr(pr,De,et,Lt){for(var ut,Te=Lt,dn=et-De>>1,yn=et-De,ci=pr[De],vn=pr[De+1],Ai=pr[et],Zi=pr[et+1],Bi=De+3;Bi<et;Bi+=3){var $i=Xt(pr[Bi],pr[Bi+1],ci,vn,Ai,Zi);if($i>Te)ut=Bi,Te=$i;else if($i===Te){var zi=Math.abs(Bi-dn);zi<yn&&(ut=Bi,yn=zi)}}Te>Lt&&(ut-De>3&&Vr(pr,De,ut,Lt),pr[ut+2]=Te,et-ut>3&&Vr(pr,ut,et,Lt))}(J,0,wr,me),J[wr+2]=1,J.size=Math.abs(Tt),J.start=0,J.end=J.size}function B(re,J,me,we){for(var ze=0;ze<re.length;ze++){var mt=[];ie(re[ze],mt,me,we),J.push(mt)}}function Ae(re){return re/360+.5}function Xe(re){var J=Math.sin(re*Math.PI/180),me=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return me<0?0:me>1?1:me}function bt(re,J,me,we,ze,mt,Tt,xe){if(we/=J,mt>=(me/=J)&&Tt<we)return re;if(Tt<me||mt>=we)return null;for(var Qe=[],Nt=0;Nt<re.length;Nt++){var wr=re[Nt],Vr=wr.geometry,pr=wr.type,De=ze===0?wr.minX:wr.minY,et=ze===0?wr.maxX:wr.maxY;if(De>=me&&et<we)Qe.push(wr);else if(!(et<me||De>=we)){var Lt=[];if(pr==="Point"||pr==="MultiPoint")Gt(Vr,Lt,me,we,ze);else if(pr==="LineString")sr(Vr,Lt,me,we,ze,!1,xe.lineMetrics);else if(pr==="MultiLineString")Ot(Vr,Lt,me,we,ze,!1);else if(pr==="Polygon")Ot(Vr,Lt,me,we,ze,!0);else if(pr==="MultiPolygon")for(var ut=0;ut<Vr.length;ut++){var Te=[];Ot(Vr[ut],Te,me,we,ze,!0),Te.length&&Lt.push(Te)}if(Lt.length){if(xe.lineMetrics&&pr==="LineString"){for(ut=0;ut<Lt.length;ut++)Qe.push(Wt(wr.id,pr,Lt[ut],wr.tags));continue}pr!=="LineString"&&pr!=="MultiLineString"||(Lt.length===1?(pr="LineString",Lt=Lt[0]):pr="MultiLineString"),pr!=="Point"&&pr!=="MultiPoint"||(pr=Lt.length===3?"Point":"MultiPoint"),Qe.push(Wt(wr.id,pr,Lt,wr.tags))}}}return Qe.length?Qe:null}function Gt(re,J,me,we,ze){for(var mt=0;mt<re.length;mt+=3){var Tt=re[mt+ze];Tt>=me&&Tt<=we&&(J.push(re[mt]),J.push(re[mt+1]),J.push(re[mt+2]))}}function sr(re,J,me,we,ze,mt,Tt){for(var xe,Qe,Nt=at(re),wr=ze===0?Tr:Or,Vr=re.start,pr=0;pr<re.length-3;pr+=3){var De=re[pr],et=re[pr+1],Lt=re[pr+2],ut=re[pr+3],Te=re[pr+4],dn=ze===0?De:et,yn=ze===0?ut:Te,ci=!1;Tt&&(xe=Math.sqrt(Math.pow(De-ut,2)+Math.pow(et-Te,2))),dn<me?yn>me&&(Qe=wr(Nt,De,et,ut,Te,me),Tt&&(Nt.start=Vr+xe*Qe)):dn>we?yn<we&&(Qe=wr(Nt,De,et,ut,Te,we),Tt&&(Nt.start=Vr+xe*Qe)):or(Nt,De,et,Lt),yn<me&&dn>=me&&(Qe=wr(Nt,De,et,ut,Te,me),ci=!0),yn>we&&dn<=we&&(Qe=wr(Nt,De,et,ut,Te,we),ci=!0),!mt&&ci&&(Tt&&(Nt.end=Vr+xe*Qe),J.push(Nt),Nt=at(re)),Tt&&(Vr+=xe)}var vn=re.length-3;De=re[vn],et=re[vn+1],Lt=re[vn+2],(dn=ze===0?De:et)>=me&&dn<=we&&or(Nt,De,et,Lt),vn=Nt.length-3,mt&&vn>=3&&(Nt[vn]!==Nt[0]||Nt[vn+1]!==Nt[1])&&or(Nt,Nt[0],Nt[1],Nt[2]),Nt.length&&J.push(Nt)}function at(re){var J=[];return J.size=re.size,J.start=re.start,J.end=re.end,J}function Ot(re,J,me,we,ze,mt){for(var Tt=0;Tt<re.length;Tt++)sr(re[Tt],J,me,we,ze,mt,!1)}function or(re,J,me,we){re.push(J),re.push(me),re.push(we)}function Tr(re,J,me,we,ze,mt){var Tt=(mt-J)/(we-J);return re.push(mt),re.push(me+(ze-me)*Tt),re.push(1),Tt}function Or(re,J,me,we,ze,mt){var Tt=(mt-me)/(ze-me);return re.push(J+(we-J)*Tt),re.push(mt),re.push(1),Tt}function jn(re,J){for(var me=[],we=0;we<re.length;we++){var ze,mt=re[we],Tt=mt.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")ze=Jr(mt.geometry,J);else if(Tt==="MultiLineString"||Tt==="Polygon"){ze=[];for(var xe=0;xe<mt.geometry.length;xe++)ze.push(Jr(mt.geometry[xe],J))}else if(Tt==="MultiPolygon")for(ze=[],xe=0;xe<mt.geometry.length;xe++){for(var Qe=[],Nt=0;Nt<mt.geometry[xe].length;Nt++)Qe.push(Jr(mt.geometry[xe][Nt],J));ze.push(Qe)}me.push(Wt(mt.id,Tt,ze,mt.tags))}return me}function Jr(re,J){var me=[];me.size=re.size,re.start!==void 0&&(me.start=re.start,me.end=re.end);for(var we=0;we<re.length;we+=3)me.push(re[we]+J,re[we+1],re[we+2]);return me}function xn(re,J){if(re.transformed)return re;var me,we,ze,mt=1<<re.z,Tt=re.x,xe=re.y;for(me=0;me<re.features.length;me++){var Qe=re.features[me],Nt=Qe.geometry,wr=Qe.type;if(Qe.geometry=[],wr===1)for(we=0;we<Nt.length;we+=2)Qe.geometry.push(An(Nt[we],Nt[we+1],J,mt,Tt,xe));else for(we=0;we<Nt.length;we++){var Vr=[];for(ze=0;ze<Nt[we].length;ze+=2)Vr.push(An(Nt[we][ze],Nt[we][ze+1],J,mt,Tt,xe));Qe.geometry.push(Vr)}}return re.transformed=!0,re}function An(re,J,me,we,ze,mt){return[Math.round(me*(re*we-ze)),Math.round(me*(J*we-mt))]}function ii(re,J,me,we,ze){for(var mt=J===ze.maxZoom?0:ze.tolerance/((1<<J)*ze.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:me,y:we,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<re.length;xe++){Tt.numFeatures++,pi(Tt,re[xe],mt,ze);var Qe=re[xe].minX,Nt=re[xe].minY,wr=re[xe].maxX,Vr=re[xe].maxY;Qe<Tt.minX&&(Tt.minX=Qe),Nt<Tt.minY&&(Tt.minY=Nt),wr>Tt.maxX&&(Tt.maxX=wr),Vr>Tt.maxY&&(Tt.maxY=Vr)}return Tt}function pi(re,J,me,we){var ze=J.geometry,mt=J.type,Tt=[];if(mt==="Point"||mt==="MultiPoint")for(var xe=0;xe<ze.length;xe+=3)Tt.push(ze[xe]),Tt.push(ze[xe+1]),re.numPoints++,re.numSimplified++;else if(mt==="LineString")Si(Tt,ze,re,me,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for(xe=0;xe<ze.length;xe++)Si(Tt,ze[xe],re,me,mt==="Polygon",xe===0);else if(mt==="MultiPolygon")for(var Qe=0;Qe<ze.length;Qe++){var Nt=ze[Qe];for(xe=0;xe<Nt.length;xe++)Si(Tt,Nt[xe],re,me,!0,xe===0)}if(Tt.length){var wr=J.tags||null;if(mt==="LineString"&&we.lineMetrics){for(var Vr in wr={},J.tags)wr[Vr]=J.tags[Vr];wr.mapbox_clip_start=ze.start/ze.size,wr.mapbox_clip_end=ze.end/ze.size}var pr={geometry:Tt,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:wr};J.id!==null&&(pr.id=J.id),re.features.push(pr)}}function Si(re,J,me,we,ze,mt){var Tt=we*we;if(we>0&&J.size<(ze?Tt:we))me.numPoints+=J.length/3;else{for(var xe=[],Qe=0;Qe<J.length;Qe+=3)(we===0||J[Qe+2]>Tt)&&(me.numSimplified++,xe.push(J[Qe]),xe.push(J[Qe+1])),me.numPoints++;ze&&function(Nt,wr){for(var Vr=0,pr=0,De=Nt.length,et=De-2;pr<De;et=pr,pr+=2)Vr+=(Nt[pr]-Nt[et])*(Nt[pr+1]+Nt[et+1]);if(Vr>0===wr)for(pr=0,De=Nt.length;pr<De/2;pr+=2){var Lt=Nt[pr],ut=Nt[pr+1];Nt[pr]=Nt[De-2-pr],Nt[pr+1]=Nt[De-1-pr],Nt[De-2-pr]=Lt,Nt[De-1-pr]=ut}}(xe,mt),re.push(xe)}}function wa(re,J){var me=(J=this.options=function(ze,mt){for(var Tt in mt)ze[Tt]=mt[Tt];return ze}(Object.create(this.options),J)).debug;if(me&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");var we=function(ze,mt){var Tt=[];if(ze.type==="FeatureCollection")for(var xe=0;xe<ze.features.length;xe++)Ue(Tt,ze.features[xe],mt,xe);else Ue(Tt,ze.type==="Feature"?ze:{geometry:ze},mt);return Tt}(re,J);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(we=function(ze,mt){var Tt=mt.buffer/mt.extent,xe=ze,Qe=bt(ze,1,-1-Tt,Tt,0,-1,2,mt),Nt=bt(ze,1,1-Tt,2+Tt,0,-1,2,mt);return(Qe||Nt)&&(xe=bt(ze,1,-Tt,1+Tt,0,-1,2,mt)||[],Qe&&(xe=jn(Qe,1).concat(xe)),Nt&&(xe=xe.concat(jn(Nt,-1)))),xe}(we,J)).length&&this.splitTile(we,0,0,0),me&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function lo(re,J,me){return 32*((1<<re)*me+J)+re}function Lo(re,J){var me=re.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);var we=this._geoJSONIndex.getTile(me.z,me.x,me.y);if(!we)return J(null,null);var ze=new Ft(we.features),mt=jt(ze);mt.byteOffset===0&&mt.byteLength===mt.buffer.byteLength||(mt=new Uint8Array(mt)),J(null,{vectorTile:ze,rawData:mt.buffer})}Br.prototype.load=function(re){var J=this.options,me=J.log,we=J.minZoom,ze=J.maxZoom,mt=J.nodeSize;me&&console.time("total time");var Tt="prepare "+re.length+" points";me&&console.time(Tt),this.points=re;for(var xe=[],Qe=0;Qe<re.length;Qe++)re[Qe].geometry&&xe.push(Fr(re[Qe],Qe));this.trees[ze+1]=new lr(xe,Ar,mr,mt,Float32Array),me&&console.timeEnd(Tt);for(var Nt=ze;Nt>=we;Nt--){var wr=+Date.now();xe=this._cluster(xe,Nt),this.trees[Nt]=new lr(xe,Ar,mr,mt,Float32Array),me&&console.log("z%d: %d clusters in %dms",Nt,xe.length,+Date.now()-wr)}return me&&console.timeEnd("total time"),this},Br.prototype.getClusters=function(re,J){var me=((re[0]+180)%360+360)%360-180,we=Math.max(-90,Math.min(90,re[1])),ze=re[2]===180?180:((re[2]+180)%360+360)%360-180,mt=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)me=-180,ze=180;else if(me>ze){var Tt=this.getClusters([me,we,180,mt],J),xe=this.getClusters([-180,we,ze,mt],J);return Tt.concat(xe)}for(var Qe=this.trees[this._limitZoom(J)],Nt=[],wr=0,Vr=Qe.range(Nn(me),Kn(mt),Nn(ze),Kn(we));wr<Vr.length;wr+=1){var pr=Qe.points[Vr[wr]];Nt.push(pr.numPoints?Pn(pr):this.points[pr.index])}return Nt},Br.prototype.getChildren=function(re){var J=this._getOriginId(re),me=this._getOriginZoom(re),we="No cluster with the specified id.",ze=this.trees[me];if(!ze)throw new Error(we);var mt=ze.points[J];if(!mt)throw new Error(we);for(var Tt=this.options.radius/(this.options.extent*Math.pow(2,me-1)),xe=[],Qe=0,Nt=ze.within(mt.x,mt.y,Tt);Qe<Nt.length;Qe+=1){var wr=ze.points[Nt[Qe]];wr.parentId===re&&xe.push(wr.numPoints?Pn(wr):this.points[wr.index])}if(xe.length===0)throw new Error(we);return xe},Br.prototype.getLeaves=function(re,J,me){var we=[];return this._appendLeaves(we,re,J=J||10,me=me||0,0),we},Br.prototype.getTile=function(re,J,me){var we=this.trees[this._limitZoom(re)],ze=Math.pow(2,re),mt=this.options,Tt=mt.radius/mt.extent,xe=(me-Tt)/ze,Qe=(me+1+Tt)/ze,Nt={features:[]};return this._addTileFeatures(we.range((J-Tt)/ze,xe,(J+1+Tt)/ze,Qe),we.points,J,me,ze,Nt),J===0&&this._addTileFeatures(we.range(1-Tt/ze,xe,1,Qe),we.points,ze,me,ze,Nt),J===ze-1&&this._addTileFeatures(we.range(0,xe,Tt/ze,Qe),we.points,-1,me,ze,Nt),Nt.features.length?Nt:null},Br.prototype.getClusterExpansionZoom=function(re){for(var J=this._getOriginZoom(re)-1;J<=this.options.maxZoom;){var me=this.getChildren(re);if(J++,me.length!==1)break;re=me[0].properties.cluster_id}return J},Br.prototype._appendLeaves=function(re,J,me,we,ze){for(var mt=0,Tt=this.getChildren(J);mt<Tt.length;mt+=1){var xe=Tt[mt],Qe=xe.properties;if(Qe&&Qe.cluster?ze+Qe.point_count<=we?ze+=Qe.point_count:ze=this._appendLeaves(re,Qe.cluster_id,me,we,ze):ze<we?ze++:re.push(xe),re.length===me)break}return ze},Br.prototype._addTileFeatures=function(re,J,me,we,ze,mt){for(var Tt=0,xe=re;Tt<xe.length;Tt+=1){var Qe=J[xe[Tt]],Nt=Qe.numPoints,wr={type:1,geometry:[[Math.round(this.options.extent*(Qe.x*ze-me)),Math.round(this.options.extent*(Qe.y*ze-we))]],tags:Nt?ni(Qe):this.points[Qe.index].properties},Vr=void 0;Nt?Vr=Qe.id:this.options.generateId?Vr=Qe.index:this.points[Qe.index].id&&(Vr=this.points[Qe.index].id),Vr!==void 0&&(wr.id=Vr),mt.features.push(wr)}},Br.prototype._limitZoom=function(re){return Math.max(this.options.minZoom,Math.min(+re,this.options.maxZoom+1))},Br.prototype._cluster=function(re,J){for(var me=[],we=this.options,ze=we.reduce,mt=we.minPoints,Tt=we.radius/(we.extent*Math.pow(2,J)),xe=0;xe<re.length;xe++){var Qe=re[xe];if(!(Qe.zoom<=J)){Qe.zoom=J;for(var Nt=this.trees[J+1],wr=Nt.within(Qe.x,Qe.y,Tt),Vr=Qe.numPoints||1,pr=Vr,De=0,et=wr;De<et.length;De+=1){var Lt=Nt.points[et[De]];Lt.zoom>J&&(pr+=Lt.numPoints||1)}if(pr>=mt){for(var ut=Qe.x*Vr,Te=Qe.y*Vr,dn=ze&&Vr>1?this._map(Qe,!0):null,yn=(xe<<5)+(J+1)+this.points.length,ci=0,vn=wr;ci<vn.length;ci+=1){var Ai=Nt.points[vn[ci]];if(!(Ai.zoom<=J)){Ai.zoom=J;var Zi=Ai.numPoints||1;ut+=Ai.x*Zi,Te+=Ai.y*Zi,Ai.parentId=yn,ze&&(dn||(dn=this._map(Qe,!0)),ze(dn,this._map(Ai)))}}Qe.parentId=yn,me.push(pn(ut/pr,Te/pr,yn,pr,dn))}else if(me.push(Qe),pr>1)for(var Bi=0,$i=wr;Bi<$i.length;Bi+=1){var zi=Nt.points[$i[Bi]];zi.zoom<=J||(zi.zoom=J,me.push(zi))}}}return me},Br.prototype._getOriginId=function(re){return re-this.points.length>>5},Br.prototype._getOriginZoom=function(re){return(re-this.points.length)%32},Br.prototype._map=function(re,J){if(re.numPoints)return J?Yn({},re.properties):re.properties;var me=this.points[re.index].properties,we=this.options.map(me);return J&&we===me?Yn({},we):we},wa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},wa.prototype.splitTile=function(re,J,me,we,ze,mt,Tt){for(var xe=[re,J,me,we],Qe=this.options,Nt=Qe.debug;xe.length;){we=xe.pop(),me=xe.pop(),J=xe.pop(),re=xe.pop();var wr=1<<J,Vr=lo(J,me,we),pr=this.tiles[Vr];if(!pr&&(Nt>1&&console.time("creation"),pr=this.tiles[Vr]=ii(re,J,me,we,Qe),this.tileCoords.push({z:J,x:me,y:we}),Nt)){Nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,me,we,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));var De="z"+J;this.stats[De]=(this.stats[De]||0)+1,this.total++}if(pr.source=re,ze){if(J===Qe.maxZoom||J===ze)continue;var et=1<<ze-J;if(me!==Math.floor(mt/et)||we!==Math.floor(Tt/et))continue}else if(J===Qe.indexMaxZoom||pr.numPoints<=Qe.indexMaxPoints)continue;if(pr.source=null,re.length!==0){Nt>1&&console.time("clipping");var Lt,ut,Te,dn,yn,ci,vn=.5*Qe.buffer/Qe.extent,Ai=.5-vn,Zi=.5+vn,Bi=1+vn;Lt=ut=Te=dn=null,yn=bt(re,wr,me-vn,me+Zi,0,pr.minX,pr.maxX,Qe),ci=bt(re,wr,me+Ai,me+Bi,0,pr.minX,pr.maxX,Qe),re=null,yn&&(Lt=bt(yn,wr,we-vn,we+Zi,1,pr.minY,pr.maxY,Qe),ut=bt(yn,wr,we+Ai,we+Bi,1,pr.minY,pr.maxY,Qe),yn=null),ci&&(Te=bt(ci,wr,we-vn,we+Zi,1,pr.minY,pr.maxY,Qe),dn=bt(ci,wr,we+Ai,we+Bi,1,pr.minY,pr.maxY,Qe),ci=null),Nt>1&&console.timeEnd("clipping"),xe.push(Lt||[],J+1,2*me,2*we),xe.push(ut||[],J+1,2*me,2*we+1),xe.push(Te||[],J+1,2*me+1,2*we),xe.push(dn||[],J+1,2*me+1,2*we+1)}}},wa.prototype.getTile=function(re,J,me){var we=this.options,ze=we.extent,mt=we.debug;if(re<0||re>24)return null;var Tt=1<<re,xe=lo(re,J=(J%Tt+Tt)%Tt,me);if(this.tiles[xe])return xn(this.tiles[xe],ze);mt>1&&console.log("drilling down to z%d-%d-%d",re,J,me);for(var Qe,Nt=re,wr=J,Vr=me;!Qe&&Nt>0;)Nt--,wr=Math.floor(wr/2),Vr=Math.floor(Vr/2),Qe=this.tiles[lo(Nt,wr,Vr)];return Qe&&Qe.source?(mt>1&&console.log("found parent tile z%d-%d-%d",Nt,wr,Vr),mt>1&&console.time("drilling down"),this.splitTile(Qe.source,Nt,wr,Vr,re,J,me),mt>1&&console.timeEnd("drilling down"),this.tiles[xe]?xn(this.tiles[xe],ze):null):null};var as=function(re){function J(me,we,ze,mt){re.call(this,me,we,ze,Lo),mt&&(this.loadGeoJSON=mt)}return re&&(J.__proto__=re),(J.prototype=Object.create(re&&re.prototype)).constructor=J,J.prototype.loadData=function(me,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=we,this._pendingLoadDataParams=me,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},J.prototype._loadData=function(){var me=this;if(this._pendingCallback&&this._pendingLoadDataParams){var we=this._pendingCallback,ze=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var mt=!!(ze&&ze.request&&ze.request.collectResourceTiming)&&new v.RequestPerformance(ze.request);this.loadGeoJSON(ze,function(Tt,xe){if(Tt||!xe)return we(Tt);if(typeof xe!="object")return we(new Error("Input data given to '"+ze.source+"' is not a valid GeoJSON object."));(function pr(De,et){var Lt,ut=De&&De.type;if(ut==="FeatureCollection")for(Lt=0;Lt<De.features.length;Lt++)pr(De.features[Lt],et);else if(ut==="GeometryCollection")for(Lt=0;Lt<De.geometries.length;Lt++)pr(De.geometries[Lt],et);else if(ut==="Feature")pr(De.geometry,et);else if(ut==="Polygon")ht(De.coordinates,et);else if(ut==="MultiPolygon")for(Lt=0;Lt<De.coordinates.length;Lt++)ht(De.coordinates[Lt],et);return De})(xe,!0);try{if(ze.filter){var Qe=v.createExpression(ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Qe.result==="error")throw new Error(Qe.value.map(function(pr){return pr.key+": "+pr.message}).join(", "));var Nt=xe.features.filter(function(pr){return Qe.value.evaluate({zoom:0},pr)});xe={type:"FeatureCollection",features:Nt}}me._geoJSONIndex=ze.cluster?new Br(function(pr){var De=pr.superclusterOptions,et=pr.clusterProperties;if(!et||!De)return De;for(var Lt={},ut={},Te={accumulated:null,zoom:0},dn={properties:null},yn=Object.keys(et),ci=0,vn=yn;ci<vn.length;ci+=1){var Ai=vn[ci],Zi=et[Ai],Bi=Zi[0],$i=v.createExpression(Zi[1]),zi=v.createExpression(typeof Bi=="string"?[Bi,["accumulated"],["get",Ai]]:Bi);Lt[Ai]=$i.value,ut[Ai]=zi.value}return De.map=function($o){dn.properties=$o;for(var Ii={},ja=0,Wi=yn;ja<Wi.length;ja+=1){var Ni=Wi[ja];Ii[Ni]=Lt[Ni].evaluate(Te,dn)}return Ii},De.reduce=function($o,Ii){dn.properties=Ii;for(var ja=0,Wi=yn;ja<Wi.length;ja+=1){var Ni=Wi[ja];Te.accumulated=$o[Ni],$o[Ni]=ut[Ni].evaluate(Te,dn)}},De}(ze)).load(xe.features):function(pr,De){return new wa(pr,De)}(xe,ze.geojsonVtOptions)}catch(pr){return we(pr)}me.loaded={};var wr={};if(mt){var Vr=mt.finish();Vr&&(wr.resourceTiming={},wr.resourceTiming[ze.source]=JSON.parse(JSON.stringify(Vr)))}we(null,wr)})}},J.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},J.prototype.reloadTile=function(me,we){var ze=this.loaded;return ze&&ze[me.uid]?re.prototype.reloadTile.call(this,me,we):this.loadTile(me,we)},J.prototype.loadGeoJSON=function(me,we){if(me.request)v.getJSON(me.request,we);else{if(typeof me.data!="string")return we(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."));try{return we(null,JSON.parse(me.data))}catch(ze){return we(new Error("Input data given to '"+me.source+"' is not a valid GeoJSON object."))}}},J.prototype.removeSource=function(me,we){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),we()},J.prototype.getClusterExpansionZoom=function(me,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(me.clusterId))}catch(ze){we(ze)}},J.prototype.getClusterChildren=function(me,we){try{we(null,this._geoJSONIndex.getChildren(me.clusterId))}catch(ze){we(ze)}},J.prototype.getClusterLeaves=function(me,we){try{we(null,this._geoJSONIndex.getLeaves(me.clusterId,me.limit,me.offset))}catch(ze){we(ze)}},J}(Ne),Pi=function(J){var me=this;this.self=J,this.actor=new v.Actor(J,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ne,geojson:as},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(we,ze){if(me.workerSourceTypes[we])throw new Error('Worker source with name "'+we+'" already registered.');me.workerSourceTypes[we]=ze},this.self.registerRTLTextPlugin=function(we){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=we.applyArabicShaping,v.plugin.processBidirectionalText=we.processBidirectionalText,v.plugin.processStyledBidirectionalText=we.processStyledBidirectionalText}};return Pi.prototype.setReferrer=function(re,J){this.referrer=J},Pi.prototype.setImages=function(re,J,me){for(var we in this.availableImages[re]=J,this.workerSources[re]){var ze=this.workerSources[re][we];for(var mt in ze)ze[mt].availableImages=J}me()},Pi.prototype.setLayers=function(re,J,me){this.getLayerIndex(re).replace(J),me()},Pi.prototype.updateLayers=function(re,J,me){this.getLayerIndex(re).update(J.layers,J.removedIds),me()},Pi.prototype.loadTile=function(re,J,me){this.getWorkerSource(re,J.type,J.source).loadTile(J,me)},Pi.prototype.loadDEMTile=function(re,J,me){this.getDEMWorkerSource(re,J.source).loadTile(J,me)},Pi.prototype.reloadTile=function(re,J,me){this.getWorkerSource(re,J.type,J.source).reloadTile(J,me)},Pi.prototype.abortTile=function(re,J,me){this.getWorkerSource(re,J.type,J.source).abortTile(J,me)},Pi.prototype.removeTile=function(re,J,me){this.getWorkerSource(re,J.type,J.source).removeTile(J,me)},Pi.prototype.removeDEMTile=function(re,J){this.getDEMWorkerSource(re,J.source).removeTile(J)},Pi.prototype.removeSource=function(re,J,me){if(this.workerSources[re]&&this.workerSources[re][J.type]&&this.workerSources[re][J.type][J.source]){var we=this.workerSources[re][J.type][J.source];delete this.workerSources[re][J.type][J.source],we.removeSource!==void 0?we.removeSource(J,me):me()}},Pi.prototype.loadWorkerSource=function(re,J,me){try{this.self.importScripts(J.url),me()}catch(we){me(we.toString())}},Pi.prototype.syncRTLPluginState=function(re,J,me){try{v.plugin.setState(J);var we=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&we!=null){this.self.importScripts(we);var ze=v.plugin.isParsed();me(ze?void 0:new Error("RTL Text Plugin failed to import scripts from "+we),ze)}}catch(mt){me(mt.toString())}},Pi.prototype.getAvailableImages=function(re){var J=this.availableImages[re];return J||(J=[]),J},Pi.prototype.getLayerIndex=function(re){var J=this.layerIndexes[re];return J||(J=this.layerIndexes[re]=new K),J},Pi.prototype.getWorkerSource=function(re,J,me){var we=this;return this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][J]||(this.workerSources[re][J]={}),this.workerSources[re][J][me]||(this.workerSources[re][J][me]=new this.workerSourceTypes[J]({send:function(mt,Tt,xe){we.actor.send(mt,Tt,xe,re)}},this.getLayerIndex(re),this.getAvailableImages(re))),this.workerSources[re][J][me]},Pi.prototype.getDEMWorkerSource=function(re,J){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][J]||(this.demWorkerSources[re][J]=new wt),this.demWorkerSources[re][J]},Pi.prototype.enforceCacheSizeLimit=function(re,J){v.enforceCacheSizeLimit(J)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Pi(self)),Pi}),k(["./shared"],function(v){"use strict";var L=v.createCommonjsModule(function(m){function d(S){return!h(S)}function h(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,F,X=new Blob([""],{type:"text/javascript"}),ee=URL.createObjectURL(X);try{F=new Worker(ee),M=!0}catch(ge){M=!1}return F&&F.terminate(),URL.revokeObjectURL(ee),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var F=M.getContext("2d");if(!F)return!1;var X=F.getImageData(0,0,1,1);return X&&X.width===M.width}()?(y[O=S&&S.failIfMajorPerformanceCaveat]===void 0&&(y[O]=function(M){var F=function(ee){var ge=document.createElement("canvas"),_e=Object.create(d.webGLContextAttributes);return _e.failIfMajorPerformanceCaveat=ee,ge.probablySupportsContext?ge.probablySupportsContext("webgl",_e)||ge.probablySupportsContext("experimental-webgl",_e):ge.supportsContext?ge.supportsContext("webgl",_e)||ge.supportsContext("experimental-webgl",_e):ge.getContext("webgl",_e)||ge.getContext("experimental-webgl",_e)}(M);if(!F)return!1;var X=F.createShader(F.VERTEX_SHADER);return!(!X||F.isContextLost())&&(F.shaderSource(X,"void main() {}"),F.compileShader(X),F.getShaderParameter(X,F.COMPILE_STATUS)===!0)}(O)),y[O]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var O}m.exports?m.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=h);var y={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),U={create:function(d,h,y){var S=v.window.document.createElement(d);return h!==void 0&&(S.className=h),y&&y.appendChild(S),S},createNS:function(d,h){return v.window.document.createElementNS(d,h)}},K=v.window.document&&v.window.document.documentElement.style;function q(m){if(!K)return m[0];for(var d=0;d<m.length;d++)if(m[d]in K)return m[d];return m[0]}var fe,ue=q(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);U.disableDrag=function(){K&&ue&&(fe=K[ue],K[ue]="none")},U.enableDrag=function(){K&&ue&&(K[ue]=fe)};var rt=q(["transform","WebkitTransform"]);U.setTransform=function(m,d){m.style[rt]=d};var Ne=!1;try{var nt=Object.defineProperty({},"passive",{get:function(){Ne=!0}});v.window.addEventListener("test",nt,nt),v.window.removeEventListener("test",nt,nt)}catch(m){Ne=!1}U.addEventListener=function(m,d,h,y){y===void 0&&(y={}),m.addEventListener(d,h,"passive"in y&&Ne?y:y.capture)},U.removeEventListener=function(m,d,h,y){y===void 0&&(y={}),m.removeEventListener(d,h,"passive"in y&&Ne?y:y.capture)};var wt=function m(d){d.preventDefault(),d.stopPropagation(),v.window.removeEventListener("click",m,!0)};function ht(m){var d=m.userImage;return!!(d&&d.render&&d.render())&&(m.data.replace(new Uint8Array(d.data.buffer)),!0)}U.suppressClick=function(){v.window.addEventListener("click",wt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",wt,!0)},0)},U.mousePos=function(m,d){var h=m.getBoundingClientRect();return new v.Point(d.clientX-h.left-m.clientLeft,d.clientY-h.top-m.clientTop)},U.touchPos=function(m,d){for(var h=m.getBoundingClientRect(),y=[],S=0;S<d.length;S++)y.push(new v.Point(d[S].clientX-h.left-m.clientLeft,d[S].clientY-h.top-m.clientTop));return y},U.mouseButton=function(m){return v.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button},U.remove=function(m){m.parentNode&&m.parentNode.removeChild(m)};var We=function(m){function d(){m.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(h){if(this.loaded!==h&&(this.loaded=h,h)){for(var y=0,S=this.requestors;y<S.length;y+=1){var O=S[y];this._notify(O.ids,O.callback)}this.requestors=[]}},d.prototype.getImage=function(h){return this.images[h]},d.prototype.addImage=function(h,y){this._validate(h,y)&&(this.images[h]=y)},d.prototype._validate=function(h,y){var S=!0;return this._validateStretch(y.stretchX,y.data&&y.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(y.stretchY,y.data&&y.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+h+'" has invalid "stretchY" value'))),S=!1),this._validateContent(y.content,y)||(this.fire(new v.ErrorEvent(new Error('Image "'+h+'" has invalid "content" value'))),S=!1),S},d.prototype._validateStretch=function(h,y){if(!h)return!0;for(var S=0,O=0,M=h;O<M.length;O+=1){var F=M[O];if(F[0]<S||F[1]<F[0]||y<F[1])return!1;S=F[1]}return!0},d.prototype._validateContent=function(h,y){return!(h&&(h.length!==4||h[0]<0||y.data.width<h[0]||h[1]<0||y.data.height<h[1]||h[2]<0||y.data.width<h[2]||h[3]<0||y.data.height<h[3]||h[2]<h[0]||h[3]<h[1]))},d.prototype.updateImage=function(h,y){y.version=this.images[h].version+1,this.images[h]=y,this.updatedImages[h]=!0},d.prototype.removeImage=function(h){var y=this.images[h];delete this.images[h],delete this.patterns[h],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(h,y){var S=!0;if(!this.isLoaded())for(var O=0,M=h;O<M.length;O+=1)this.images[M[O]]||(S=!1);this.isLoaded()||S?this._notify(h,y):this.requestors.push({ids:h,callback:y})},d.prototype._notify=function(h,y){for(var S={},O=0,M=h;O<M.length;O+=1){var F=M[O];this.images[F]||this.fire(new v.Event("styleimagemissing",{id:F}));var X=this.images[F];X?S[F]={data:X.data.clone(),pixelRatio:X.pixelRatio,sdf:X.sdf,version:X.version,stretchX:X.stretchX,stretchY:X.stretchY,content:X.content,hasRenderCallback:Boolean(X.userImage&&X.userImage.render)}:v.warnOnce('Image "'+F+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}y(null,S)},d.prototype.getPixelSize=function(){var h=this.atlasImage;return{width:h.width,height:h.height}},d.prototype.getPattern=function(h){var y=this.patterns[h],S=this.getImage(h);if(!S)return null;if(y&&y.position.version===S.version)return y.position;if(y)y.position.version=S.version;else{var O={w:S.data.width+2,h:S.data.height+2,x:0,y:0},M=new v.ImagePosition(O,S);this.patterns[h]={bin:O,position:M}}return this._updatePatternAtlas(),this.patterns[h].position},d.prototype.bind=function(h){var y=h.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(h,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var h=[];for(var y in this.patterns)h.push(this.patterns[y].bin);var S=v.potpack(h),O=S.w,M=S.h,F=this.atlasImage;for(var X in F.resize({width:O||1,height:M||1}),this.patterns){var ee=this.patterns[X].bin,ge=ee.x+1,_e=ee.y+1,Ee=this.images[X].data,qe=Ee.width,$e=Ee.height;v.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ge,y:_e},{width:qe,height:$e}),v.RGBAImage.copy(Ee,F,{x:0,y:$e-1},{x:ge,y:_e-1},{width:qe,height:1}),v.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ge,y:_e+$e},{width:qe,height:1}),v.RGBAImage.copy(Ee,F,{x:qe-1,y:0},{x:ge-1,y:_e},{width:1,height:$e}),v.RGBAImage.copy(Ee,F,{x:0,y:0},{x:ge+qe,y:_e},{width:1,height:$e})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(h){for(var y=0,S=h;y<S.length;y+=1){var O=S[y];if(!this.callbackDispatchedThisFrame[O]){this.callbackDispatchedThisFrame[O]=!0;var M=this.images[O];ht(M)&&this.updateImage(O,M)}}},d}(v.Evented),St=tr,Je=tr,Ft=1e20;function tr(m,d,h,y,S,O){this.fontSize=m||24,this.buffer=d===void 0?3:d,this.cutoff=y||.25,this.fontFamily=S||"sans-serif",this.fontWeight=O||"normal",this.radius=h||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function yr(m,d,h,y,S,O,M){for(var F=0;F<d;F++){for(var X=0;X<h;X++)y[X]=m[X*d+F];for(Dr(y,S,O,M,h),X=0;X<h;X++)m[X*d+F]=S[X]}for(X=0;X<h;X++){for(F=0;F<d;F++)y[F]=m[X*d+F];for(Dr(y,S,O,M,d),F=0;F<d;F++)m[X*d+F]=Math.sqrt(S[F])}}function Dr(m,d,h,y,S){h[0]=0,y[0]=-Ft,y[1]=+Ft;for(var O=1,M=0;O<S;O++){for(var F=(m[O]+O*O-(m[h[M]]+h[M]*h[M]))/(2*O-2*h[M]);F<=y[M];)M--,F=(m[O]+O*O-(m[h[M]]+h[M]*h[M]))/(2*O-2*h[M]);h[++M]=O,y[M]=F,y[M+1]=+Ft}for(O=0,M=0;O<S;O++){for(;y[M+1]<O;)M++;d[O]=(O-h[M])*(O-h[M])+m[h[M]]}}tr.prototype.draw=function(m){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(m,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),h=new Uint8ClampedArray(this.size*this.size),y=0;y<this.size*this.size;y++){var S=d.data[4*y+3]/255;this.gridOuter[y]=S===1?0:S===0?Ft:Math.pow(Math.max(0,.5-S),2),this.gridInner[y]=S===1?Ft:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(yr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),yr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),y=0;y<this.size*this.size;y++)h[y]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[y]-this.gridInner[y])/this.radius+this.cutoff))));return h},St.default=Je;var Mr=function(d,h){this.requestManager=d,this.localIdeographFontFamily=h,this.entries={}};Mr.prototype.setURL=function(m){this.url=m},Mr.prototype.getGlyphs=function(m,d){var h=this,y=[];for(var S in m)for(var O=0,M=m[S];O<M.length;O+=1)y.push({stack:S,id:M[O]});v.asyncAll(y,function(F,X){var ee=F.stack,ge=F.id,_e=h.entries[ee];_e||(_e=h.entries[ee]={glyphs:{},requests:{},ranges:{}});var Ee=_e.glyphs[ge];if(Ee===void 0){if(Ee=h._tinySDF(_e,ee,ge))return _e.glyphs[ge]=Ee,void X(null,{stack:ee,id:ge,glyph:Ee});var qe=Math.floor(ge/256);if(256*qe>65535)X(new Error("glyphs > 65535 not supported"));else if(_e.ranges[qe])X(null,{stack:ee,id:ge,glyph:Ee});else{var $e=_e.requests[qe];$e||($e=_e.requests[qe]=[],Mr.loadGlyphRange(ee,qe,h.url,h.requestManager,function(dt,Ye){if(Ye){for(var ot in Ye)h._doesCharSupportLocalGlyph(+ot)||(_e.glyphs[+ot]=Ye[+ot]);_e.ranges[qe]=!0}for(var Mt=0,Pt=$e;Mt<Pt.length;Mt+=1)(0,Pt[Mt])(dt,Ye);delete _e.requests[qe]})),$e.push(function(dt,Ye){dt?X(dt):Ye&&X(null,{stack:ee,id:ge,glyph:Ye[ge]||null})})}}else X(null,{stack:ee,id:ge,glyph:Ee})},function(F,X){if(F)d(F);else if(X){for(var ee={},ge=0,_e=X;ge<_e.length;ge+=1){var Ee=_e[ge],qe=Ee.stack,$e=Ee.id,dt=Ee.glyph;(ee[qe]||(ee[qe]={}))[$e]=dt&&{id:dt.id,bitmap:dt.bitmap.clone(),metrics:dt.metrics}}d(null,ee)}})},Mr.prototype._doesCharSupportLocalGlyph=function(m){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](m)||v.isChar["Hangul Syllables"](m)||v.isChar.Hiragana(m)||v.isChar.Katakana(m))},Mr.prototype._tinySDF=function(m,d,h){var y=this.localIdeographFontFamily;if(y&&this._doesCharSupportLocalGlyph(h)){var S=m.tinySDF;if(!S){var O="400";/bold/i.test(d)?O="900":/medium/i.test(d)?O="500":/light/i.test(d)&&(O="200"),S=m.tinySDF=new Mr.TinySDF(24,3,8,.25,y,O)}return{id:h,bitmap:new v.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(h))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Mr.loadGlyphRange=function(m,d,h,y,S){var O=256*d,M=O+255,F=y.transformRequest(y.normalizeGlyphsURL(h).replace("{fontstack}",m).replace("{range}",O+"-"+M),v.ResourceType.Glyphs);v.getArrayBuffer(F,function(X,ee){if(X)S(X);else if(ee){for(var ge={},_e=0,Ee=v.parseGlyphPBF(ee);_e<Ee.length;_e+=1){var qe=Ee[_e];ge[qe.id]=qe}S(null,ge)}})},Mr.TinySDF=St;var jt=function(){this.specification=v.styleSpec.light.position};jt.prototype.possiblyEvaluate=function(m,d){return v.sphericalToCartesian(m.expression.evaluate(d))},jt.prototype.interpolate=function(m,d,h){return{x:v.number(m.x,d.x,h),y:v.number(m.y,d.y,h),z:v.number(m.z,d.z,h)}};var He=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new jt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Dt=function(m){function d(h){m.call(this),this._transitionable=new v.Transitionable(He),this.setLight(h),this._transitioning=this._transitionable.untransitioned()}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(h,y){if(y===void 0&&(y={}),!this._validate(v.validateLight,h,y))for(var S in h){var O=h[S];v.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-"-transition".length),O):this._transitionable.setValue(S,O)}},d.prototype.updateTransitions=function(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(h){this.properties=this._transitioning.possiblyEvaluate(h)},d.prototype._validate=function(h,y,S){return(!S||S.validate!==!1)&&v.emitValidationErrors(this,h.call(v.validateStyle,v.extend({value:y,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},d}(v.Evented),Ut=function(d,h){this.width=d,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ut.prototype.getDash=function(m,d){var h=m.join(",")+String(d);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(m,d)),this.dashEntry[h]},Ut.prototype.getDashRanges=function(m,d,h){var y=[],S=m.length%2==1?-m[m.length-1]*h:0,O=m[0]*h,M=!0;y.push({left:S,right:O,isDash:M,zeroLength:m[0]===0});for(var F=m[0],X=1;X<m.length;X++){var ee=m[X];y.push({left:S=F*h,right:O=(F+=ee)*h,isDash:M=!M,zeroLength:ee===0})}return y},Ut.prototype.addRoundDash=function(m,d,h){for(var y=d/2,S=-h;S<=h;S++)for(var O=this.width*(this.nextRow+h+S),M=0,F=m[M],X=0;X<this.width;X++){X/F.right>1&&(F=m[++M]);var ee=Math.abs(X-F.left),ge=Math.abs(X-F.right),_e=Math.min(ee,ge),Ee=void 0,qe=S/h*(y+1);if(F.isDash){var $e=y-Math.abs(qe);Ee=Math.sqrt(_e*_e+$e*$e)}else Ee=y-Math.sqrt(_e*_e+qe*qe);this.data[O+X]=Math.max(0,Math.min(255,Ee+128))}},Ut.prototype.addRegularDash=function(m){for(var d=m.length-1;d>=0;--d){var h=m[d],y=m[d+1];h.zeroLength?m.splice(d,1):y&&y.isDash===h.isDash&&(y.left=h.left,m.splice(d,1))}var S=m[0],O=m[m.length-1];S.isDash===O.isDash&&(S.left=O.left-this.width,O.right=S.right+this.width);for(var M=this.width*this.nextRow,F=0,X=m[F],ee=0;ee<this.width;ee++){ee/X.right>1&&(X=m[++F]);var ge=Math.abs(ee-X.left),_e=Math.abs(ee-X.right),Ee=Math.min(ge,_e);this.data[M+ee]=Math.max(0,Math.min(255,(X.isDash?Ee:-Ee)+128))}},Ut.prototype.addDash=function(m,d){var h=d?7:0,y=2*h+1;if(this.nextRow+y>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var S=0,O=0;O<m.length;O++)S+=m[O];if(S!==0){var M=this.width/S,F=this.getDashRanges(m,this.width,M);d?this.addRoundDash(F,M,h):this.addRegularDash(F)}var X={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:S};return this.nextRow+=y,this.dirty=!0,X},Ut.prototype.bind=function(m){var d=m.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Ce=function m(d,h){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var y=this.workerPool.acquire(this.id),S=0;S<y.length;S++){var O=new m.Actor(y[S],h,this.id);O.name="Worker "+S,this.actors.push(O)}};function ve(m,d,h){var y=function(O,M){if(O)return h(O);if(M){var F=v.pick(v.extend(M,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(F.vectorLayers=M.vector_layers,F.vectorLayerIds=F.vectorLayers.map(function(X){return X.id})),F.tiles=d.canonicalizeTileset(F,m.url),h(null,F)}};return m.url?v.getJSON(d.transformRequest(d.normalizeSourceURL(m.url),v.ResourceType.Source),y):v.browser.frame(function(){return y(null,m)})}Ce.prototype.broadcast=function(m,d,h){v.asyncAll(this.actors,function(y,S){y.send(m,d,S)},h=h||function(){})},Ce.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ce.prototype.remove=function(){this.actors.forEach(function(m){m.remove()}),this.actors=[],this.workerPool.release(this.id)},Ce.Actor=v.Actor;var Ie=function(d,h,y){this.bounds=v.LngLatBounds.convert(this.validateBounds(d)),this.minzoom=h||0,this.maxzoom=y||24};Ie.prototype.validateBounds=function(m){return Array.isArray(m)&&m.length===4?[Math.max(-180,m[0]),Math.max(-90,m[1]),Math.min(180,m[2]),Math.min(90,m[3])]:[-180,-90,180,90]},Ie.prototype.contains=function(m){var d=Math.pow(2,m.z),h=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*d),y=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*d),S=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*d),O=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*d);return m.x>=h&&m.x<S&&m.y>=y&&m.y<O};var zt=function(m){function d(h,y,S,O){if(m.call(this),this.id=h,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(y,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(O)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ve(this._options,this.map._requestManager,function(y,S){h._tileJSONRequest=null,h._loaded=!0,y?h.fire(new v.ErrorEvent(y)):S&&(v.extend(h,S),S.bounds&&(h.tileBounds=new Ie(S.bounds,h.minzoom,h.maxzoom)),v.postTurnstileEvent(S.tiles,h.map._requestManager._customAccessToken),v.postMapLoadEvent(S.tiles,h.map._getMapId(),h.map._requestManager._skuToken,h.map._requestManager._customAccessToken),h.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setSourceProperty=function(h){this._tileJSONRequest&&this._tileJSONRequest.cancel(),h(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(h){var y=this;return this.setSourceProperty(function(){y._options.tiles=h}),this},d.prototype.setUrl=function(h){var y=this;return this.setSourceProperty(function(){y.url=h,y._options.url=h}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return v.extend({},this._options)},d.prototype.loadTile=function(h,y){var S=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),O={request:this.map._requestManager.transformRequest(S,v.ResourceType.Tile),uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(F,X){return delete h.request,h.aborted?y(null):F&&F.status!==404?y(F):(X&&X.resourceTiming&&(h.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&h.setExpiryData(X),h.loadVectorData(X,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),y(null),void(h.reloadCallback&&(this.loadTile(h,h.reloadCallback),h.reloadCallback=null)))}O.request.collectResourceTiming=this._collectResourceTiming,h.actor&&h.state!=="expired"?h.state==="loading"?h.reloadCallback=y:h.request=h.actor.send("reloadTile",O,M.bind(this)):(h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",O,M.bind(this)))},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.actor&&h.actor.send("abortTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(h){h.unloadVectorData(),h.actor&&h.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(v.Evented),le=function(m){function d(h,y,S,O){m.call(this),this.id=h,this.dispatcher=S,this.setEventedParent(O),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},y),v.extend(this,v.pick(y,["url","scheme","tileSize"]))}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ve(this._options,this.map._requestManager,function(y,S){h._tileJSONRequest=null,h._loaded=!0,y?h.fire(new v.ErrorEvent(y)):S&&(v.extend(h,S),S.bounds&&(h.tileBounds=new Ie(S.bounds,h.minzoom,h.maxzoom)),v.postTurnstileEvent(S.tiles),v.postMapLoadEvent(S.tiles,h.map._getMapId(),h.map._requestManager._skuToken),h.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),h.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return v.extend({},this._options)},d.prototype.hasTile=function(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)},d.prototype.loadTile=function(h,y){var S=this,O=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);h.request=v.getImage(this.map._requestManager.transformRequest(O,v.ResourceType.Tile),function(M,F){if(delete h.request,h.aborted)h.state="unloaded",y(null);else if(M)h.state="errored",y(M);else if(F){S.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var X=S.map.painter.context,ee=X.gl;h.texture=S.map.painter.getTileTexture(F.width),h.texture?h.texture.update(F,{useMipmap:!0}):(h.texture=new v.Texture(X,F,ee.RGBA,{useMipmap:!0}),h.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),X.extTextureFilterAnisotropic&&ee.texParameterf(ee.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),h.state="loaded",v.cacheEntryPossiblyAdded(S.dispatcher),y(null)}})},d.prototype.abortTile=function(h,y){h.request&&(h.request.cancel(),delete h.request),y()},d.prototype.unloadTile=function(h,y){h.texture&&this.map.painter.saveTileTexture(h.texture),y()},d.prototype.hasTransition=function(){return!1},d}(v.Evented),Me=function(m){function d(h,y,S,O){m.call(this,h,y,S,O),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(h,y){var S=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function O(M,F){M&&(h.state="errored",y(M)),F&&(h.dem=F,h.needsHillshadePrepare=!0,h.state="loaded",y(null))}h.request=v.getImage(this.map._requestManager.transformRequest(S,v.ResourceType.Tile),function(M,F){if(delete h.request,h.aborted)h.state="unloaded",y(null);else if(M)h.state="errored",y(M);else if(F){this.map._refreshExpiredTiles&&h.setExpiryData(F),delete F.cacheControl,delete F.expires;var X=v.window.ImageBitmap&&F instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?F:v.browser.getImageData(F,1),ee={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:X,encoding:this.encoding};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",ee,O.bind(this)))}}.bind(this)),h.neighboringTiles=this._getNeighboringTiles(h.tileID)},d.prototype._getNeighboringTiles=function(h){var y=h.canonical,S=Math.pow(2,y.z),O=(y.x-1+S)%S,M=y.x===0?h.wrap-1:h.wrap,F=(y.x+1+S)%S,X=y.x+1===S?h.wrap+1:h.wrap,ee={};return ee[new v.OverscaledTileID(h.overscaledZ,M,y.z,O,y.y).key]={backfilled:!1},ee[new v.OverscaledTileID(h.overscaledZ,X,y.z,F,y.y).key]={backfilled:!1},y.y>0&&(ee[new v.OverscaledTileID(h.overscaledZ,M,y.z,O,y.y-1).key]={backfilled:!1},ee[new v.OverscaledTileID(h.overscaledZ,h.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},ee[new v.OverscaledTileID(h.overscaledZ,X,y.z,F,y.y-1).key]={backfilled:!1}),y.y+1<S&&(ee[new v.OverscaledTileID(h.overscaledZ,M,y.z,O,y.y+1).key]={backfilled:!1},ee[new v.OverscaledTileID(h.overscaledZ,h.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},ee[new v.OverscaledTileID(h.overscaledZ,X,y.z,F,y.y+1).key]={backfilled:!1}),ee},d.prototype.unloadTile=function(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded",h.actor&&h.actor.send("removeDEMTile",{uid:h.uid,source:this.id})},d}(le),Re=function(m){function d(h,y,S,O){m.call(this),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(O),this._data=y.data,this._options=v.extend({},y),this._collectResourceTiming=y.collectResourceTiming,this._resourceTiming=[],y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;var M=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*M,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*M,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?Math.min(y.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:v.EXTENT,radius:(y.clusterRadius||50)*M,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var h=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)h.fire(new v.ErrorEvent(y));else{var S={dataType:"source",sourceDataType:"metadata"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new v.Event("data",S))}})},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setData=function(h){var y=this;return this._data=h,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)y.fire(new v.ErrorEvent(S));else{var O={dataType:"source",sourceDataType:"content"};y._collectResourceTiming&&y._resourceTiming&&y._resourceTiming.length>0&&(O.resourceTiming=y._resourceTiming,y._resourceTiming=[]),y.fire(new v.Event("data",O))}}),this},d.prototype.getClusterExpansionZoom=function(h,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},y),this},d.prototype.getClusterChildren=function(h,y){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},y),this},d.prototype.getClusterLeaves=function(h,y,S,O){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:y,offset:S},O),this},d.prototype._updateWorkerData=function(h){var y=this;this._loaded=!1;var S=v.extend({},this.workerOptions),O=this._data;typeof O=="string"?(S.request=this.map._requestManager.transformRequest(v.browser.resolveURL(O),v.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(O),this.actor.send(this.type+".loadData",S,function(M,F){y._removed||F&&F.abandoned||(y._loaded=!0,F&&F.resourceTiming&&F.resourceTiming[y.id]&&(y._resourceTiming=F.resourceTiming[y.id].slice(0)),y.actor.send(y.type+".coalesce",{source:S.source},null),h(M))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(h,y){var S=this,O=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(O,{type:this.type,uid:h.uid,tileID:h.tileID,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,F){return delete h.request,h.unloadVectorData(),h.aborted?y(null):M?y(M):(h.loadVectorData(F,S.map.painter,O==="reloadTile"),y(null))})},d.prototype.abortTile=function(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0},d.prototype.unloadTile=function(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(v.Evented),yt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),At=function(m){function d(h,y,S,O){m.call(this),this.id=h,this.dispatcher=S,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(O),this.options=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(h,y){var S=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(O,M){S._loaded=!0,O?S.fire(new v.ErrorEvent(O)):M&&(S.image=M,h&&(S.coordinates=h),y&&y(),S._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(h){var y=this;return this.image&&h.url?(this.options.url=h.url,this.load(h.coordinates,function(){y.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(h){this.map=h,this.load()},d.prototype.setCoordinates=function(h){var y=this;this.coordinates=h;var S=h.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var F=1/0,X=1/0,ee=-1/0,ge=-1/0,_e=0,Ee=M;_e<Ee.length;_e+=1){var qe=Ee[_e];F=Math.min(F,qe.x),X=Math.min(X,qe.y),ee=Math.max(ee,qe.x),ge=Math.max(ge,qe.y)}var $e=Math.max(ee-F,ge-X),dt=Math.max(0,Math.floor(-Math.log($e)/Math.LN2)),Ye=Math.pow(2,dt);return new v.CanonicalTileID(dt,Math.floor((F+ee)/2*Ye),Math.floor((X+ge)/2*Ye))}(S),this.minzoom=this.maxzoom=this.tileID.z;var O=S.map(function(M){return y.tileID.getTilePoint(M)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(O[0].x,O[0].y,0,0),this._boundsArray.emplaceBack(O[1].x,O[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(O[3].x,O[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(O[2].x,O[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var h=this.map.painter.context,y=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(h,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var O=this.tiles[S];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}}},d.prototype.loadTile=function(h,y){this.tileID&&this.tileID.equals(h.tileID.canonical)?(this.tiles[String(h.tileID.wrap)]=h,h.buckets={},y(null)):(h.state="errored",y(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(v.Evented),ae=function(m){function d(h,y,S,O){m.call(this,h,y,S,O),this.roundZoom=!0,this.type="video",this.options=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var h=this;this._loaded=!1;var y=this.options;this.urls=[];for(var S=0,O=y.urls;S<O.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(O[S],v.ResourceType.Source).url);v.getVideo(this.urls,function(M,F){h._loaded=!0,M?h.fire(new v.ErrorEvent(M)):F&&(h.video=F,h.video.loop=!0,h.video.setAttribute("playsinline",""),h.video.addEventListener("playing",function(){h.map.triggerRepaint()}),h.map&&h.video.play(),h._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(h){if(this.video){var y=this.video.seekable;h<y.start(0)||h>y.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+y.start(0)+" and "+y.end(0)+"-second mark."))):this.video.currentTime=h}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var h=this.map.painter.context,y=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(h,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var O=this.tiles[S];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(At),It=function(m){function d(h,y,S,O){m.call(this,h,y,S,O),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(F){return typeof F!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+h,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+h,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+h,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+h,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+h,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var y=this.map.painter.context,S=y.gl;for(var O in this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,yt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(y,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[O];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var h=0,y=[this.canvas.width,this.canvas.height];h<y.length;h+=1){var S=y[h];if(isNaN(S)||S<=0)return!0}return!1},d}(At),lr={vector:zt,raster:le,"raster-dem":Me,geojson:Re,video:ae,image:At,canvas:It};function Cr(m,d){var h=v.identity([]);return v.translate(h,h,[1,1,0]),v.scale(h,h,[.5*m.width,.5*m.height,1]),v.multiply(h,h,m.calculatePosMatrix(d.toUnwrapped()))}function Br(m,d,h,y,S,O){var M=function(dt,Ye,ot){if(dt)for(var Mt=0,Pt=dt;Mt<Pt.length;Mt+=1){var dr=Ye[Pt[Mt]];if(dr&&dr.source===ot&&dr.type==="fill-extrusion")return!0}else for(var Jt in Ye){var br=Ye[Jt];if(br.source===ot&&br.type==="fill-extrusion")return!0}return!1}(S&&S.layers,d,m.id),F=O.maxPitchScaleFactor(),X=m.tilesIn(y,F,M);X.sort(pn);for(var ee=[],ge=0,_e=X;ge<_e.length;ge+=1){var Ee=_e[ge];ee.push({wrappedTileID:Ee.tileID.wrapped().key,queryResults:Ee.tile.queryRenderedFeatures(d,h,m._state,Ee.queryGeometry,Ee.cameraQueryGeometry,Ee.scale,S,O,F,Cr(m.transform,Ee.tileID))})}var qe=function(dt){for(var Ye={},ot={},Mt=0,Pt=dt;Mt<Pt.length;Mt+=1){var dr=Pt[Mt],Jt=dr.queryResults,br=dr.wrappedTileID,Er=ot[br]=ot[br]||{};for(var en in Jt)for(var Xr=Jt[en],gn=Er[en]=Er[en]||{},In=Ye[en]=Ye[en]||[],Vn=0,oi=Xr;Vn<oi.length;Vn+=1){var Di=oi[Vn];gn[Di.featureIndex]||(gn[Di.featureIndex]=!0,In.push(Di))}}return Ye}(ee);for(var $e in qe)qe[$e].forEach(function(dt){var Ye=dt.feature,ot=m.getFeatureState(Ye.layer["source-layer"],Ye.id);Ye.source=Ye.layer.source,Ye.layer["source-layer"]&&(Ye.sourceLayer=Ye.layer["source-layer"]),Ye.state=ot});return qe}function pn(m,d){var h=m.tileID,y=d.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}var Fr=function(d,h){this.max=d,this.onRemove=h,this.reset()};Fr.prototype.reset=function(){for(var m in this.data)for(var d=0,h=this.data[m];d<h.length;d+=1){var y=h[d];y.timeout&&clearTimeout(y.timeout),this.onRemove(y.value)}return this.data={},this.order=[],this},Fr.prototype.add=function(m,d,h){var y=this,S=m.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var O={value:d,timeout:void 0};if(h!==void 0&&(O.timeout=setTimeout(function(){y.remove(m,O)},h)),this.data[S].push(O),this.order.push(S),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Fr.prototype.has=function(m){return m.wrapped().key in this.data},Fr.prototype.getAndRemove=function(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null},Fr.prototype._getAndRemoveByKey=function(m){var d=this.data[m].shift();return d.timeout&&clearTimeout(d.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),d.value},Fr.prototype.getByKey=function(m){var d=this.data[m];return d?d[0].value:null},Fr.prototype.get=function(m){return this.has(m)?this.data[m.wrapped().key][0].value:null},Fr.prototype.remove=function(m,d){if(!this.has(m))return this;var h=m.wrapped().key,y=d===void 0?0:this.data[h].indexOf(d),S=this.data[h][y];return this.data[h].splice(y,1),S.timeout&&clearTimeout(S.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(S.value),this.order.splice(this.order.indexOf(h),1),this},Fr.prototype.setMaxSize=function(m){for(this.max=m;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Fr.prototype.filter=function(m){var d=[];for(var h in this.data)for(var y=0,S=this.data[h];y<S.length;y+=1){var O=S[y];m(O.value)||d.push(O)}for(var M=0,F=d;M<F.length;M+=1){var X=F[M];this.remove(X.value.tileID,X)}};var Pn=function(d,h,y){this.context=d;var S=d.gl;this.buffer=S.createBuffer(),this.dynamicDraw=Boolean(y),this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),S.bufferData(S.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Pn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Pn.prototype.updateData=function(m){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,m.arrayBuffer)},Pn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ni={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Nn=function(d,h,y,S){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=S,this.context=d;var O=d.gl;this.buffer=O.createBuffer(),d.bindVertexBuffer.set(this.buffer),O.bufferData(O.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?O.DYNAMIC_DRAW:O.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer};Nn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Nn.prototype.updateData=function(m){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,m.arrayBuffer)},Nn.prototype.enableAttributes=function(m,d){for(var h=0;h<this.attributes.length;h++){var y=d.attributes[this.attributes[h].name];y!==void 0&&m.enableVertexAttribArray(y)}},Nn.prototype.setVertexAttribPointers=function(m,d,h){for(var y=0;y<this.attributes.length;y++){var S=this.attributes[y],O=d.attributes[S.name];O!==void 0&&m.vertexAttribPointer(O,S.components,m[ni[S.type]],!1,this.itemSize,S.offset+this.itemSize*(h||0))}},Nn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Kn=function(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Kn.prototype.get=function(){return this.current},Kn.prototype.set=function(m){},Kn.prototype.getDefault=function(){return this.default},Kn.prototype.setDefault=function(){this.set(this.default)};var Yn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return v.Color.transparent},d.prototype.set=function(h){var y=this.current;(h.r!==y.r||h.g!==y.g||h.b!==y.b||h.a!==y.a||this.dirty)&&(this.gl.clearColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Kn),Ar=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearDepth(h),this.current=h,this.dirty=!1)},d}(Kn),mr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.clearStencil(h),this.current=h,this.dirty=!1)},d}(Kn),Xt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||h[3]!==y[3]||this.dirty)&&(this.gl.colorMask(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Kn),Wt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthMask(h),this.current=h,this.dirty=!1)},d}(Kn),Ir=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.stencilMask(h),this.current=h,this.dirty=!1)},d}(Kn),Ue=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(h){var y=this.current;(h.func!==y.func||h.ref!==y.ref||h.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(h.func,h.ref,h.mask),this.current=h,this.dirty=!1)},d}(Kn),he=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.KEEP,h.KEEP,h.KEEP]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(h[0],h[1],h[2]),this.current=h,this.dirty=!1)},d}(Kn),ie=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=h,this.dirty=!1}},d}(Kn),B=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||this.dirty)&&(this.gl.depthRange(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Kn),Ae=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=h,this.dirty=!1}},d}(Kn),Xe=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.depthFunc(h),this.current=h,this.dirty=!1)},d}(Kn),bt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.BLEND):y.disable(y.BLEND),this.current=h,this.dirty=!1}},d}(Kn),Gt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[h.ONE,h.ZERO]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(h[0],h[1]),this.current=h,this.dirty=!1)},d}(Kn),sr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return v.Color.transparent},d.prototype.set=function(h){var y=this.current;(h.r!==y.r||h.g!==y.g||h.b!==y.b||h.a!==y.a||this.dirty)&&(this.gl.blendColor(h.r,h.g,h.b,h.a),this.current=h,this.dirty=!1)},d}(Kn),at=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.blendEquation(h),this.current=h,this.dirty=!1)},d}(Kn),Ot=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;h?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=h,this.dirty=!1}},d}(Kn),or=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.cullFace(h),this.current=h,this.dirty=!1)},d}(Kn),Tr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.frontFace(h),this.current=h,this.dirty=!1)},d}(Kn),Or=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)},d}(Kn),jn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(h){(h!==this.current||this.dirty)&&(this.gl.activeTexture(h),this.current=h,this.dirty=!1)},d}(Kn),Jr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var h=this.gl;return[0,0,h.drawingBufferWidth,h.drawingBufferHeight]},d.prototype.set=function(h){var y=this.current;(h[0]!==y[0]||h[1]!==y[1]||h[2]!==y[2]||h[3]!==y[3]||this.dirty)&&(this.gl.viewport(h[0],h[1],h[2],h[3]),this.current=h,this.dirty=!1)},d}(Kn),xn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,h),this.current=h,this.dirty=!1}},d}(Kn),An=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Kn),ii=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindTexture(y.TEXTURE_2D,h),this.current=h,this.dirty=!1}},d}(Kn),pi=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,h),this.current=h,this.dirty=!1}},d}(Kn),Si=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){var y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,h),this.current=h,this.dirty=!1},d}(Kn),wa=function(m){function d(h){m.call(this,h),this.vao=h.extVertexArrayObject}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(h){this.vao&&(h!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(h),this.current=h,this.dirty=!1)},d}(Kn),lo=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,h),this.current=h,this.dirty=!1}},d}(Kn),Lo=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h),this.current=h,this.dirty=!1}},d}(Kn),as=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(h){if(h!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,h),this.current=h,this.dirty=!1}},d}(Kn),Pi=function(m){function d(h,y){m.call(this,h),this.context=h,this.parent=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(Kn),re=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,h,0),this.current=h,this.dirty=!1}},d}(Pi),J=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.set=function(h){if(h!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,h),this.current=h,this.dirty=!1}},d}(Pi),me=function(d,h,y,S){this.context=d,this.width=h,this.height=y;var O=this.framebuffer=d.gl.createFramebuffer();this.colorAttachment=new re(d,O),S&&(this.depthAttachment=new J(d,O))};me.prototype.destroy=function(){var m=this.context.gl,d=this.colorAttachment.get();if(d&&m.deleteTexture(d),this.depthAttachment){var h=this.depthAttachment.get();h&&m.deleteRenderbuffer(h)}m.deleteFramebuffer(this.framebuffer)};var we=function(d,h,y){this.func=d,this.mask=h,this.range=y};we.ReadOnly=!1,we.ReadWrite=!0,we.disabled=new we(519,we.ReadOnly,[0,1]);var ze=function(d,h,y,S,O,M){this.test=d,this.ref=h,this.mask=y,this.fail=S,this.depthFail=O,this.pass=M};ze.disabled=new ze({func:519,mask:0},0,0,7680,7680,7680);var mt=function(d,h,y){this.blendFunction=d,this.blendColor=h,this.mask=y};mt.disabled=new mt(mt.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),mt.unblended=new mt(mt.Replace,v.Color.transparent,[!0,!0,!0,!0]),mt.alphaBlended=new mt([1,771],v.Color.transparent,[!0,!0,!0,!0]);var Tt=function(d,h,y){this.enable=d,this.mode=h,this.frontFace=y};Tt.disabled=new Tt(!1,1029,2305),Tt.backCCW=new Tt(!0,1029,2305);var xe=function(d){this.gl=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Yn(this),this.clearDepth=new Ar(this),this.clearStencil=new mr(this),this.colorMask=new Xt(this),this.depthMask=new Wt(this),this.stencilMask=new Ir(this),this.stencilFunc=new Ue(this),this.stencilOp=new he(this),this.stencilTest=new ie(this),this.depthRange=new B(this),this.depthTest=new Ae(this),this.depthFunc=new Xe(this),this.blend=new bt(this),this.blendFunc=new Gt(this),this.blendColor=new sr(this),this.blendEquation=new at(this),this.cullFace=new Ot(this),this.cullFaceSide=new or(this),this.frontFace=new Tr(this),this.program=new Or(this),this.activeTexture=new jn(this),this.viewport=new Jr(this),this.bindFramebuffer=new xn(this),this.bindRenderbuffer=new An(this),this.bindTexture=new ii(this),this.bindVertexBuffer=new pi(this),this.bindElementBuffer=new Si(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new wa(this),this.pixelStoreUnpack=new lo(this),this.pixelStoreUnpackPremultiplyAlpha=new Lo(this),this.pixelStoreUnpackFlipY=new as(this),this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=d.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(d.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE)};xe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},xe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},xe.prototype.createIndexBuffer=function(m,d){return new Pn(this,m,d)},xe.prototype.createVertexBuffer=function(m,d,h){return new Nn(this,m,d,h)},xe.prototype.createRenderbuffer=function(m,d,h){var y=this.gl,S=y.createRenderbuffer();return this.bindRenderbuffer.set(S),y.renderbufferStorage(y.RENDERBUFFER,m,d,h),this.bindRenderbuffer.set(null),S},xe.prototype.createFramebuffer=function(m,d,h){return new me(this,m,d,h)},xe.prototype.clear=function(m){var d=m.color,h=m.depth,y=this.gl,S=0;d&&(S|=y.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(S|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y.clear(S)},xe.prototype.setCullFace=function(m){m.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(m.mode),this.frontFace.set(m.frontFace))},xe.prototype.setDepthMode=function(m){m.func!==this.gl.ALWAYS||m.mask?(this.depthTest.set(!0),this.depthFunc.set(m.func),this.depthMask.set(m.mask),this.depthRange.set(m.range)):this.depthTest.set(!1)},xe.prototype.setStencilMode=function(m){m.test.func!==this.gl.ALWAYS||m.mask?(this.stencilTest.set(!0),this.stencilMask.set(m.mask),this.stencilOp.set([m.fail,m.depthFail,m.pass]),this.stencilFunc.set({func:m.test.func,ref:m.ref,mask:m.test.mask})):this.stencilTest.set(!1)},xe.prototype.setColorMode=function(m){v.deepEqual(m.blendFunction,mt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(m.blendFunction),this.blendColor.set(m.blendColor)),this.colorMask.set(m.mask)},xe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Qe=function(m){function d(h,y,S){var O=this;m.call(this),this.id=h,this.dispatcher=S,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(O._sourceLoaded=!0),O._sourceLoaded&&!O._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(O.reload(),O.transform&&O.update(O.transform))}),this.on("error",function(){O._sourceErrored=!0}),this._source=function(M,F,X,ee){var ge=new lr[F.type](M,F,X,ee);if(ge.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+ge.id);return v.bindAll(["load","abort","unload","serialize","prepare"],ge),ge}(h,y,S,this),this._tiles={},this._cache=new Fr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.onAdd=function(h){this.map=h,this._maxTileCacheSize=h?h._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(h)},d.prototype.onRemove=function(h){this._source&&this._source.onRemove&&this._source.onRemove(h)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var h in this._tiles){var y=this._tiles[h];if(y.state!=="loaded"&&y.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var h=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,h&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(h,y){return this._source.loadTile(h,y)},d.prototype._unloadTile=function(h){if(this._source.unloadTile)return this._source.unloadTile(h,function(){})},d.prototype._abortTile=function(h){if(this._source.abortTile)return this._source.abortTile(h,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(h){for(var y in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[y];S.upload(h),S.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return v.values(this._tiles).map(function(h){return h.tileID}).sort(Nt).map(function(h){return h.key})},d.prototype.getRenderableIds=function(h){var y=this,S=[];for(var O in this._tiles)this._isIdRenderable(O,h)&&S.push(this._tiles[O]);return h?S.sort(function(M,F){var X=M.tileID,ee=F.tileID,ge=new v.Point(X.canonical.x,X.canonical.y)._rotate(y.transform.angle),_e=new v.Point(ee.canonical.x,ee.canonical.y)._rotate(y.transform.angle);return X.overscaledZ-ee.overscaledZ||_e.y-ge.y||_e.x-ge.x}).map(function(M){return M.tileID.key}):S.map(function(M){return M.tileID}).sort(Nt).map(function(M){return M.key})},d.prototype.hasRenderableParent=function(h){var y=this.findLoadedParent(h,0);return!!y&&this._isIdRenderable(y.tileID.key)},d.prototype._isIdRenderable=function(h,y){return this._tiles[h]&&this._tiles[h].hasData()&&!this._coveredTiles[h]&&(y||!this._tiles[h].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var h in this._cache.reset(),this._tiles)this._tiles[h].state!=="errored"&&this._reloadTile(h,"reloading")},d.prototype._reloadTile=function(h,y){var S=this._tiles[h];S&&(S.state!=="loading"&&(S.state=y),this._loadTile(S,this._tileLoaded.bind(this,S,h,y)))},d.prototype._tileLoaded=function(h,y,S,O){if(O)return h.state="errored",void(O.status!==404?this._source.fire(new v.ErrorEvent(O,{tile:h})):this.update(this.transform));h.timeAdded=v.browser.now(),S==="expired"&&(h.refreshedUponExpiration=!0),this._setTileReloadTimer(y,h),this.getSource().type==="raster-dem"&&h.dem&&this._backfillDEM(h),this._state.initializeTileState(h,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:h,coord:h.tileID}))},d.prototype._backfillDEM=function(h){for(var y=this.getRenderableIds(),S=0;S<y.length;S++){var O=y[S];if(h.neighboringTiles&&h.neighboringTiles[O]){var M=this.getTileByID(O);F(h,M),F(M,h)}}function F(X,ee){X.needsHillshadePrepare=!0;var ge=ee.tileID.canonical.x-X.tileID.canonical.x,_e=ee.tileID.canonical.y-X.tileID.canonical.y,Ee=Math.pow(2,X.tileID.canonical.z),qe=ee.tileID.key;ge===0&&_e===0||Math.abs(_e)>1||(Math.abs(ge)>1&&(Math.abs(ge+Ee)===1?ge+=Ee:Math.abs(ge-Ee)===1&&(ge-=Ee)),ee.dem&&X.dem&&(X.dem.backfillBorder(ee.dem,ge,_e),X.neighboringTiles&&X.neighboringTiles[qe]&&(X.neighboringTiles[qe].backfilled=!0)))}},d.prototype.getTile=function(h){return this.getTileByID(h.key)},d.prototype.getTileByID=function(h){return this._tiles[h]},d.prototype._retainLoadedChildren=function(h,y,S,O){for(var M in this._tiles){var F=this._tiles[M];if(!(O[M]||!F.hasData()||F.tileID.overscaledZ<=y||F.tileID.overscaledZ>S)){for(var X=F.tileID;F&&F.tileID.overscaledZ>y+1;){var ee=F.tileID.scaledTo(F.tileID.overscaledZ-1);(F=this._tiles[ee.key])&&F.hasData()&&(X=ee)}for(var ge=X;ge.overscaledZ>y;)if(h[(ge=ge.scaledTo(ge.overscaledZ-1)).key]){O[X.key]=X;break}}}},d.prototype.findLoadedParent=function(h,y){if(h.key in this._loadedParentTiles){var S=this._loadedParentTiles[h.key];return S&&S.tileID.overscaledZ>=y?S:null}for(var O=h.overscaledZ-1;O>=y;O--){var M=h.scaledTo(O),F=this._getLoadedTile(M);if(F)return F}},d.prototype._getLoadedTile=function(h){var y=this._tiles[h.key];return y&&y.hasData()?y:this._cache.getByKey(h.wrapped().key)},d.prototype.updateCacheSize=function(h){var y=Math.ceil(h.width/this._source.tileSize)+1,S=Math.ceil(h.height/this._source.tileSize)+1,O=Math.floor(y*S*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,O):O;this._cache.setMaxSize(M)},d.prototype.handleWrapJump=function(h){var y=Math.round((h-(this._prevLng===void 0?h:this._prevLng))/360);if(this._prevLng=h,y){var S={};for(var O in this._tiles){var M=this._tiles[O];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+y),S[M.tileID.key]=M}for(var F in this._tiles=S,this._timers)clearTimeout(this._timers[F]),delete this._timers[F];for(var X in this._tiles)this._setTileReloadTimer(X,this._tiles[X])}},d.prototype.update=function(h){var y=this;if(this.transform=h,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(h),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=h.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Er){return new v.OverscaledTileID(Er.canonical.z,Er.wrap,Er.canonical.z,Er.canonical.x,Er.canonical.y)}):(S=h.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(Er){return y._source.hasTile(Er)}))):S=[];var O=h.coveringZoomLevel(this._source),M=Math.max(O-d.maxOverzooming,this._source.minzoom),F=Math.max(O+d.maxUnderzooming,this._source.minzoom),X=this._updateRetainedTiles(S,O);if(wr(this._source.type)){for(var ee={},ge={},_e=0,Ee=Object.keys(X);_e<Ee.length;_e+=1){var qe=Ee[_e],$e=X[qe],dt=this._tiles[qe];if(dt&&!(dt.fadeEndTime&&dt.fadeEndTime<=v.browser.now())){var Ye=this.findLoadedParent($e,M);Ye&&(this._addTile(Ye.tileID),ee[Ye.tileID.key]=Ye.tileID),ge[qe]=$e}}for(var ot in this._retainLoadedChildren(ge,O,F,X),ee)X[ot]||(this._coveredTiles[ot]=!0,X[ot]=ee[ot])}for(var Mt in X)this._tiles[Mt].clearFadeHold();for(var Pt=0,dr=v.keysDifference(this._tiles,X);Pt<dr.length;Pt+=1){var Jt=dr[Pt],br=this._tiles[Jt];br.hasSymbolBuckets&&!br.holdingForFade()?br.setHoldDuration(this.map._fadeDuration):br.hasSymbolBuckets&&!br.symbolFadeFinished()||this._removeTile(Jt)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var h in this._tiles)this._tiles[h].holdingForFade()&&this._removeTile(h)},d.prototype._updateRetainedTiles=function(h,y){for(var S={},O={},M=Math.max(y-d.maxOverzooming,this._source.minzoom),F=Math.max(y+d.maxUnderzooming,this._source.minzoom),X={},ee=0,ge=h;ee<ge.length;ee+=1){var _e=ge[ee],Ee=this._addTile(_e);S[_e.key]=_e,Ee.hasData()||y<this._source.maxzoom&&(X[_e.key]=_e)}this._retainLoadedChildren(X,y,F,S);for(var qe=0,$e=h;qe<$e.length;qe+=1){var dt=$e[qe],Ye=this._tiles[dt.key];if(!Ye.hasData()){if(y+1>this._source.maxzoom){var ot=dt.children(this._source.maxzoom)[0],Mt=this.getTile(ot);if(Mt&&Mt.hasData()){S[ot.key]=ot;continue}}else{var Pt=dt.children(this._source.maxzoom);if(S[Pt[0].key]&&S[Pt[1].key]&&S[Pt[2].key]&&S[Pt[3].key])continue}for(var dr=Ye.wasRequested(),Jt=dt.overscaledZ-1;Jt>=M;--Jt){var br=dt.scaledTo(Jt);if(O[br.key]||(O[br.key]=!0,!(Ye=this.getTile(br))&&dr&&(Ye=this._addTile(br)),Ye&&(S[br.key]=br,dr=Ye.wasRequested(),Ye.hasData())))break}}}return S},d.prototype._updateLoadedParentTileCache=function(){for(var h in this._loadedParentTiles={},this._tiles){for(var y=[],S=void 0,O=this._tiles[h].tileID;O.overscaledZ>0;){if(O.key in this._loadedParentTiles){S=this._loadedParentTiles[O.key];break}y.push(O.key);var M=O.scaledTo(O.overscaledZ-1);if(S=this._getLoadedTile(M))break;O=M}for(var F=0,X=y;F<X.length;F+=1)this._loadedParentTiles[X[F]]=S}},d.prototype._addTile=function(h){var y=this._tiles[h.key];if(y)return y;(y=this._cache.getAndRemove(h))&&(this._setTileReloadTimer(h.key,y),y.tileID=h,this._state.initializeTileState(y,this.map?this.map.painter:null),this._cacheTimers[h.key]&&(clearTimeout(this._cacheTimers[h.key]),delete this._cacheTimers[h.key],this._setTileReloadTimer(h.key,y)));var S=Boolean(y);return S||(y=new v.Tile(h,this._source.tileSize*h.overscaleFactor()),this._loadTile(y,this._tileLoaded.bind(this,y,h.key,y.state))),y?(y.uses++,this._tiles[h.key]=y,S||this._source.fire(new v.Event("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y):null},d.prototype._setTileReloadTimer=function(h,y){var S=this;h in this._timers&&(clearTimeout(this._timers[h]),delete this._timers[h]);var O=y.getExpiryTimeout();O&&(this._timers[h]=setTimeout(function(){S._reloadTile(h,"expired"),delete S._timers[h]},O))},d.prototype._removeTile=function(h){var y=this._tiles[h];y&&(y.uses--,delete this._tiles[h],this._timers[h]&&(clearTimeout(this._timers[h]),delete this._timers[h]),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._cache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))},d.prototype.clearTiles=function(){for(var h in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(h);this._cache.reset()},d.prototype.tilesIn=function(h,y,S){var O=this,M=[],F=this.transform;if(!F)return M;for(var X=S?F.getCameraQueryGeometry(h):h,ee=h.map(function(Jt){return F.pointCoordinate(Jt)}),ge=X.map(function(Jt){return F.pointCoordinate(Jt)}),_e=this.getIds(),Ee=1/0,qe=1/0,$e=-1/0,dt=-1/0,Ye=0,ot=ge;Ye<ot.length;Ye+=1){var Mt=ot[Ye];Ee=Math.min(Ee,Mt.x),qe=Math.min(qe,Mt.y),$e=Math.max($e,Mt.x),dt=Math.max(dt,Mt.y)}for(var Pt=function(br){var Er=O._tiles[_e[br]];if(!Er.holdingForFade()){var en=Er.tileID,Xr=Math.pow(2,F.zoom-Er.tileID.overscaledZ),gn=y*Er.queryPadding*v.EXTENT/Er.tileSize/Xr,In=[en.getTilePoint(new v.MercatorCoordinate(Ee,qe)),en.getTilePoint(new v.MercatorCoordinate($e,dt))];if(In[0].x-gn<v.EXTENT&&In[0].y-gn<v.EXTENT&&In[1].x+gn>=0&&In[1].y+gn>=0){var Vn=ee.map(function(Di){return en.getTilePoint(Di)}),oi=ge.map(function(Di){return en.getTilePoint(Di)});M.push({tile:Er,tileID:en,queryGeometry:Vn,cameraQueryGeometry:oi,scale:Xr})}}},dr=0;dr<_e.length;dr++)Pt(dr);return M},d.prototype.getVisibleCoordinates=function(h){for(var y=this,S=this.getRenderableIds(h).map(function(X){return y._tiles[X].tileID}),O=0,M=S;O<M.length;O+=1){var F=M[O];F.posMatrix=this.transform.calculatePosMatrix(F.toUnwrapped())}return S},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(wr(this._source.type))for(var h in this._tiles){var y=this._tiles[h];if(y.fadeEndTime!==void 0&&y.fadeEndTime>=v.browser.now())return!0}return!1},d.prototype.setFeatureState=function(h,y,S){this._state.updateState(h=h||"_geojsonTileLayer",y,S)},d.prototype.removeFeatureState=function(h,y,S){this._state.removeFeatureState(h=h||"_geojsonTileLayer",y,S)},d.prototype.getFeatureState=function(h,y){return this._state.getState(h=h||"_geojsonTileLayer",y)},d.prototype.setDependencies=function(h,y,S){var O=this._tiles[h];O&&O.setDependencies(y,S)},d.prototype.reloadTilesForDependencies=function(h,y){for(var S in this._tiles)this._tiles[S].hasDependency(h,y)&&this._reloadTile(S,"reloading");this._cache.filter(function(O){return!O.hasDependency(h,y)})},d}(v.Evented);function Nt(m,d){var h=Math.abs(2*m.wrap)-+(m.wrap<0),y=Math.abs(2*d.wrap)-+(d.wrap<0);return m.overscaledZ-d.overscaledZ||y-h||d.canonical.y-m.canonical.y||d.canonical.x-m.canonical.x}function wr(m){return m==="raster"||m==="image"||m==="video"}function Vr(){return new v.window.Worker(Po.workerUrl)}Qe.maxOverzooming=10,Qe.maxUnderzooming=3;var pr="mapboxgl_preloaded_worker_pool",De=function(){this.active={}};De.prototype.acquire=function(m){if(!this.workers)for(this.workers=[];this.workers.length<De.workerCount;)this.workers.push(new Vr);return this.active[m]=!0,this.workers.slice()},De.prototype.release=function(m){delete this.active[m],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},De.prototype.isPreloaded=function(){return!!this.active[pr]},De.prototype.numActive=function(){return Object.keys(this.active).length};var et,Lt=Math.floor(v.browser.hardwareConcurrency/2);function ut(){return et||(et=new De),et}function Te(m,d){var h={};for(var y in m)y!=="ref"&&(h[y]=m[y]);return v.refProperties.forEach(function(S){S in d&&(h[S]=d[S])}),h}function dn(m){m=m.slice();for(var d=Object.create(null),h=0;h<m.length;h++)d[m[h].id]=m[h];for(var y=0;y<m.length;y++)"ref"in m[y]&&(m[y]=Te(m[y],d[m[y].ref]));return m}De.workerCount=Math.max(Math.min(Lt,6),1);var yn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ci(m,d,h){h.push({command:yn.addSource,args:[m,d[m]]})}function vn(m,d,h){d.push({command:yn.removeSource,args:[m]}),h[m]=!0}function Ai(m,d,h,y){vn(m,h,y),ci(m,d,h)}function Zi(m,d,h){var y;for(y in m[h])if(m[h].hasOwnProperty(y)&&y!=="data"&&!v.deepEqual(m[h][y],d[h][y]))return!1;for(y in d[h])if(d[h].hasOwnProperty(y)&&y!=="data"&&!v.deepEqual(m[h][y],d[h][y]))return!1;return!0}function Bi(m,d,h,y,S,O){var M;for(M in d=d||{},m=m||{})m.hasOwnProperty(M)&&(v.deepEqual(m[M],d[M])||h.push({command:O,args:[y,M,d[M],S]}));for(M in d)d.hasOwnProperty(M)&&!m.hasOwnProperty(M)&&(v.deepEqual(m[M],d[M])||h.push({command:O,args:[y,M,d[M],S]}))}function $i(m){return m.id}function zi(m,d){return m[d.id]=d,m}var $o=function(d,h){this.reset(d,h)};$o.prototype.reset=function(m,d){this.points=m||[],this._distances=[0];for(var h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},$o.prototype.lerp=function(m){if(this.points.length===1)return this.points[0];m=v.clamp(m,0,1);for(var d=1,h=this._distances[d],y=m*this.paddedLength+this.padding;h<y&&d<this._distances.length;)h=this._distances[++d];var S=d-1,O=this._distances[S],M=h-O,F=M>0?(y-O)/M:0;return this.points[S].mult(1-F).add(this.points[d].mult(F))};var Ii=function(d,h,y){var S=this.boxCells=[],O=this.circleCells=[];this.xCellCount=Math.ceil(d/y),this.yCellCount=Math.ceil(h/y);for(var M=0;M<this.xCellCount*this.yCellCount;M++)S.push([]),O.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=h,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0};function ja(m,d,h,y,S){var O=v.create();return d?(v.scale(O,O,[1/S,1/S,1]),h||v.rotateZ(O,O,y.angle)):v.multiply(O,y.labelPlaneMatrix,m),O}function Wi(m,d,h,y,S){if(d){var O=v.clone(m);return v.scale(O,O,[S,S,1]),h||v.rotateZ(O,O,-y.angle),O}return y.glCoordMatrix}function Ni(m,d){var h=[m.x,m.y,0,1];Oa(h,h,d);var y=h[3];return{point:new v.Point(h[0]/y,h[1]/y),signedDistanceFromCamera:y}}function di(m,d){return .5+m/d*.5}function ao(m,d){var h=m[0]/m[3],y=m[1]/m[3];return h>=-d[0]&&h<=d[0]&&y>=-d[1]&&y<=d[1]}function Bs(m,d,h,y,S,O,M,F){var X=y?m.textSizeData:m.iconSizeData,ee=v.evaluateSizeForZoom(X,h.transform.zoom),ge=[256/h.width*2+1,256/h.height*2+1],_e=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;_e.clear();for(var Ee=m.lineVertexArray,qe=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,$e=h.transform.width/h.transform.height,dt=!1,Ye=0;Ye<qe.length;Ye++){var ot=qe.get(Ye);if(ot.hidden||ot.writingMode===v.WritingMode.vertical&&!dt)Ro(ot.numGlyphs,_e);else{dt=!1;var Mt=[ot.anchorX,ot.anchorY,0,1];if(v.transformMat4(Mt,Mt,d),ao(Mt,ge)){var Pt=di(h.transform.cameraToCenterDistance,Mt[3]),dr=v.evaluateSizeForFeature(X,ee,ot),Jt=M?dr/Pt:dr*Pt,br=new v.Point(ot.anchorX,ot.anchorY),Er=Ni(br,S).point,en={},Xr=il(ot,Jt,!1,F,d,S,O,m.glyphOffsetArray,Ee,_e,Er,br,en,$e);dt=Xr.useVertical,(Xr.notEnoughRoom||dt||Xr.needsFlipping&&il(ot,Jt,!0,F,d,S,O,m.glyphOffsetArray,Ee,_e,Er,br,en,$e).notEnoughRoom)&&Ro(ot.numGlyphs,_e)}else Ro(ot.numGlyphs,_e)}}y?m.text.dynamicLayoutVertexBuffer.updateData(_e):m.icon.dynamicLayoutVertexBuffer.updateData(_e)}function wo(m,d,h,y,S,O,M,F,X,ee,ge){var _e=F.glyphStartIndex+F.numGlyphs,Ee=F.lineStartIndex,qe=F.lineStartIndex+F.lineLength,$e=d.getoffsetX(F.glyphStartIndex),dt=d.getoffsetX(_e-1),Ye=Ea(m*$e,h,y,S,O,M,F.segment,Ee,qe,X,ee,ge);if(!Ye)return null;var ot=Ea(m*dt,h,y,S,O,M,F.segment,Ee,qe,X,ee,ge);return ot?{first:Ye,last:ot}:null}function Yo(m,d,h,y){return m===v.WritingMode.horizontal&&Math.abs(h.y-d.y)>Math.abs(h.x-d.x)*y?{useVertical:!0}:(m===v.WritingMode.vertical?d.y<h.y:d.x>h.x)?{needsFlipping:!0}:null}function il(m,d,h,y,S,O,M,F,X,ee,ge,_e,Ee,qe){var $e,dt=d/24,Ye=m.lineOffsetX*dt,ot=m.lineOffsetY*dt;if(m.numGlyphs>1){var Mt=m.glyphStartIndex+m.numGlyphs,Pt=m.lineStartIndex,dr=m.lineStartIndex+m.lineLength,Jt=wo(dt,F,Ye,ot,h,ge,_e,m,X,O,Ee);if(!Jt)return{notEnoughRoom:!0};var br=Ni(Jt.first.point,M).point,Er=Ni(Jt.last.point,M).point;if(y&&!h){var en=Yo(m.writingMode,br,Er,qe);if(en)return en}$e=[Jt.first];for(var Xr=m.glyphStartIndex+1;Xr<Mt-1;Xr++)$e.push(Ea(dt*F.getoffsetX(Xr),Ye,ot,h,ge,_e,m.segment,Pt,dr,X,O,Ee));$e.push(Jt.last)}else{if(y&&!h){var gn=Ni(_e,S).point,In=m.lineStartIndex+m.segment+1,Vn=new v.Point(X.getx(In),X.gety(In)),oi=Ni(Vn,S),Di=oi.signedDistanceFromCamera>0?oi.point:Oo(_e,Vn,gn,1,S),Ji=Yo(m.writingMode,gn,Di,qe);if(Ji)return Ji}var Tn=Ea(dt*F.getoffsetX(m.glyphStartIndex),Ye,ot,h,ge,_e,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,X,O,Ee);if(!Tn)return{notEnoughRoom:!0};$e=[Tn]}for(var Ei=0,vi=$e;Ei<vi.length;Ei+=1){var Hn=vi[Ei];v.addDynamicAttributes(ee,Hn.point,Hn.angle)}return{}}function Oo(m,d,h,y,S){var O=Ni(m.add(m.sub(d)._unit()),S).point,M=h.sub(O);return h.add(M._mult(y/M.mag()))}function Ea(m,d,h,y,S,O,M,F,X,ee,ge,_e){var Ee=y?m-d:m+d,qe=Ee>0?1:-1,$e=0;y&&(qe*=-1,$e=Math.PI),qe<0&&($e+=Math.PI);for(var dt=qe>0?F+M:F+M+1,Ye=S,ot=S,Mt=0,Pt=0,dr=Math.abs(Ee),Jt=[];Mt+Pt<=dr;){if((dt+=qe)<F||dt>=X)return null;if(ot=Ye,Jt.push(Ye),(Ye=_e[dt])===void 0){var br=new v.Point(ee.getx(dt),ee.gety(dt)),Er=Ni(br,ge);if(Er.signedDistanceFromCamera>0)Ye=_e[dt]=Er.point;else{var en=dt-qe;Ye=Oo(Mt===0?O:new v.Point(ee.getx(en),ee.gety(en)),br,ot,dr-Mt+1,ge)}}Mt+=Pt,Pt=ot.dist(Ye)}var Xr=(dr-Mt)/Pt,gn=Ye.sub(ot),In=gn.mult(Xr)._add(ot);In._add(gn._unit()._perp()._mult(h*qe));var Vn=$e+Math.atan2(Ye.y-ot.y,Ye.x-ot.x);return Jt.push(In),{point:In,angle:Vn,path:Jt}}Ii.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ii.prototype.insert=function(m,d,h,y,S){this._forEachCell(d,h,y,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(m),this.bboxes.push(d),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(S)},Ii.prototype.insertCircle=function(m,d,h,y){this._forEachCell(d-y,h-y,d+y,h+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(m),this.circles.push(d),this.circles.push(h),this.circles.push(y)},Ii.prototype._insertBoxCell=function(m,d,h,y,S,O){this.boxCells[S].push(O)},Ii.prototype._insertCircleCell=function(m,d,h,y,S,O){this.circleCells[S].push(O)},Ii.prototype._query=function(m,d,h,y,S,O){if(h<0||m>this.width||y<0||d>this.height)return!S&&[];var M=[];if(m<=0&&d<=0&&this.width<=h&&this.height<=y){if(S)return!0;for(var F=0;F<this.boxKeys.length;F++)M.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(var X=0;X<this.circleKeys.length;X++){var ee=this.circles[3*X],ge=this.circles[3*X+1],_e=this.circles[3*X+2];M.push({key:this.circleKeys[X],x1:ee-_e,y1:ge-_e,x2:ee+_e,y2:ge+_e})}return O?M.filter(O):M}return this._forEachCell(m,d,h,y,this._queryCell,M,{hitTest:S,seenUids:{box:{},circle:{}}},O),S?M.length>0:M},Ii.prototype._queryCircle=function(m,d,h,y,S){var O=m-h,M=m+h,F=d-h,X=d+h;if(M<0||O>this.width||X<0||F>this.height)return!y&&[];var ee=[];return this._forEachCell(O,F,M,X,this._queryCellCircle,ee,{hitTest:y,circle:{x:m,y:d,radius:h},seenUids:{box:{},circle:{}}},S),y?ee.length>0:ee},Ii.prototype.query=function(m,d,h,y,S){return this._query(m,d,h,y,!1,S)},Ii.prototype.hitTest=function(m,d,h,y,S){return this._query(m,d,h,y,!0,S)},Ii.prototype.hitTestCircle=function(m,d,h,y){return this._queryCircle(m,d,h,!0,y)},Ii.prototype._queryCell=function(m,d,h,y,S,O,M,F){var X=M.seenUids,ee=this.boxCells[S];if(ee!==null)for(var ge=this.bboxes,_e=0,Ee=ee;_e<Ee.length;_e+=1){var qe=Ee[_e];if(!X.box[qe]){X.box[qe]=!0;var $e=4*qe;if(m<=ge[$e+2]&&d<=ge[$e+3]&&h>=ge[$e+0]&&y>=ge[$e+1]&&(!F||F(this.boxKeys[qe]))){if(M.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[qe],x1:ge[$e],y1:ge[$e+1],x2:ge[$e+2],y2:ge[$e+3]})}}}var dt=this.circleCells[S];if(dt!==null)for(var Ye=this.circles,ot=0,Mt=dt;ot<Mt.length;ot+=1){var Pt=Mt[ot];if(!X.circle[Pt]){X.circle[Pt]=!0;var dr=3*Pt;if(this._circleAndRectCollide(Ye[dr],Ye[dr+1],Ye[dr+2],m,d,h,y)&&(!F||F(this.circleKeys[Pt]))){if(M.hitTest)return O.push(!0),!0;var Jt=Ye[dr],br=Ye[dr+1],Er=Ye[dr+2];O.push({key:this.circleKeys[Pt],x1:Jt-Er,y1:br-Er,x2:Jt+Er,y2:br+Er})}}}},Ii.prototype._queryCellCircle=function(m,d,h,y,S,O,M,F){var X=M.circle,ee=M.seenUids,ge=this.boxCells[S];if(ge!==null)for(var _e=this.bboxes,Ee=0,qe=ge;Ee<qe.length;Ee+=1){var $e=qe[Ee];if(!ee.box[$e]){ee.box[$e]=!0;var dt=4*$e;if(this._circleAndRectCollide(X.x,X.y,X.radius,_e[dt+0],_e[dt+1],_e[dt+2],_e[dt+3])&&(!F||F(this.boxKeys[$e])))return O.push(!0),!0}}var Ye=this.circleCells[S];if(Ye!==null)for(var ot=this.circles,Mt=0,Pt=Ye;Mt<Pt.length;Mt+=1){var dr=Pt[Mt];if(!ee.circle[dr]){ee.circle[dr]=!0;var Jt=3*dr;if(this._circlesCollide(ot[Jt],ot[Jt+1],ot[Jt+2],X.x,X.y,X.radius)&&(!F||F(this.circleKeys[dr])))return O.push(!0),!0}}},Ii.prototype._forEachCell=function(m,d,h,y,S,O,M,F){for(var X=this._convertToXCellCoord(m),ee=this._convertToYCellCoord(d),ge=this._convertToXCellCoord(h),_e=this._convertToYCellCoord(y),Ee=X;Ee<=ge;Ee++)for(var qe=ee;qe<=_e;qe++)if(S.call(this,m,d,h,y,this.xCellCount*qe+Ee,O,M,F))return},Ii.prototype._convertToXCellCoord=function(m){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(m*this.xScale)))},Ii.prototype._convertToYCellCoord=function(m){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(m*this.yScale)))},Ii.prototype._circlesCollide=function(m,d,h,y,S,O){var M=y-m,F=S-d,X=h+O;return X*X>M*M+F*F},Ii.prototype._circleAndRectCollide=function(m,d,h,y,S,O,M){var F=(O-y)/2,X=Math.abs(m-(y+F));if(X>F+h)return!1;var ee=(M-S)/2,ge=Math.abs(d-(S+ee));if(ge>ee+h)return!1;if(X<=F||ge<=ee)return!0;var _e=X-F,Ee=ge-ee;return _e*_e+Ee*Ee<=h*h};var al=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ro(m,d){for(var h=0;h<m;h++){var y=d.length;d.resize(y+4),d.float32.set(al,3*y)}}function Oa(m,d,h){var y=d[0],S=d[1];return m[0]=h[0]*y+h[4]*S+h[12],m[1]=h[1]*y+h[5]*S+h[13],m[3]=h[3]*y+h[7]*S+h[15],m}var Ko=function(d,h,y){h===void 0&&(h=new Ii(d.width+200,d.height+200,25)),y===void 0&&(y=new Ii(d.width+200,d.height+200,25)),this.transform=d,this.grid=h,this.ignoredGrid=y,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+100,this.screenBottomBoundary=d.height+100,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200};function ca(m,d,h){return d*(v.EXTENT/(m.tileSize*Math.pow(2,h-m.tileID.overscaledZ)))}Ko.prototype.placeCollisionBox=function(m,d,h,y,S){var O=this.projectAndGetPerspectiveRatio(y,m.anchorPointX,m.anchorPointY),M=h*O.perspectiveRatio,F=m.x1*M+O.point.x,X=m.y1*M+O.point.y,ee=m.x2*M+O.point.x,ge=m.y2*M+O.point.y;return!this.isInsideGrid(F,X,ee,ge)||!d&&this.grid.hitTest(F,X,ee,ge,S)?{box:[],offscreen:!1}:{box:[F,X,ee,ge],offscreen:this.isOffscreen(F,X,ee,ge)}},Ko.prototype.placeCollisionCircles=function(m,d,h,y,S,O,M,F,X,ee,ge,_e,Ee){var qe=[],$e=new v.Point(d.anchorX,d.anchorY),dt=Ni($e,O),Ye=di(this.transform.cameraToCenterDistance,dt.signedDistanceFromCamera),ot=(ee?S/Ye:S*Ye)/v.ONE_EM,Mt=Ni($e,M).point,Pt=wo(ot,y,d.lineOffsetX*ot,d.lineOffsetY*ot,!1,Mt,$e,d,h,M,{}),dr=!1,Jt=!1,br=!0;if(Pt){for(var Er=.5*_e*Ye+Ee,en=new v.Point(-100,-100),Xr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),gn=new $o,In=Pt.first,Vn=Pt.last,oi=[],Di=In.path.length-1;Di>=1;Di--)oi.push(In.path[Di]);for(var Ji=1;Ji<Vn.path.length;Ji++)oi.push(Vn.path[Ji]);var Tn=2.5*Er;if(F){var Ei=oi.map(function(bs){return Ni(bs,F)});oi=Ei.some(function(bs){return bs.signedDistanceFromCamera<=0})?[]:Ei.map(function(bs){return bs.point})}var vi=[];if(oi.length>0){for(var Hn=oi[0].clone(),Ci=oi[0].clone(),ti=1;ti<oi.length;ti++)Hn.x=Math.min(Hn.x,oi[ti].x),Hn.y=Math.min(Hn.y,oi[ti].y),Ci.x=Math.max(Ci.x,oi[ti].x),Ci.y=Math.max(Ci.y,oi[ti].y);vi=Hn.x>=en.x&&Ci.x<=Xr.x&&Hn.y>=en.y&&Ci.y<=Xr.y?[oi]:Ci.x<en.x||Hn.x>Xr.x||Ci.y<en.y||Hn.y>Xr.y?[]:v.clipLine([oi],en.x,en.y,Xr.x,Xr.y)}for(var _i=0,Yi=vi;_i<Yi.length;_i+=1){var za;gn.reset(Yi[_i],.25*Er),za=gn.length<=.5*Er?1:Math.ceil(gn.paddedLength/Tn)+1;for(var Aa=0;Aa<za;Aa++){var No=Aa/Math.max(za-1,1),$a=gn.lerp(No),Ya=$a.x+100,Ks=$a.y+100;qe.push(Ya,Ks,Er,0);var jo=Ya-Er,Yu=Ks-Er,Ku=Ya+Er,_s=Ks+Er;if(br=br&&this.isOffscreen(jo,Yu,Ku,_s),Jt=Jt||this.isInsideGrid(jo,Yu,Ku,_s),!m&&this.grid.hitTestCircle(Ya,Ks,Er,ge)&&(dr=!0,!X))return{circles:[],offscreen:!1,collisionDetected:dr}}}}return{circles:!X&&dr||!Jt?[]:qe,offscreen:br,collisionDetected:dr}},Ko.prototype.queryRenderedSymbols=function(m){if(m.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],h=1/0,y=1/0,S=-1/0,O=-1/0,M=0,F=m;M<F.length;M+=1){var X=F[M],ee=new v.Point(X.x+100,X.y+100);h=Math.min(h,ee.x),y=Math.min(y,ee.y),S=Math.max(S,ee.x),O=Math.max(O,ee.y),d.push(ee)}for(var ge={},_e={},Ee=0,qe=this.grid.query(h,y,S,O).concat(this.ignoredGrid.query(h,y,S,O));Ee<qe.length;Ee+=1){var $e=qe[Ee],dt=$e.key;if(ge[dt.bucketInstanceId]===void 0&&(ge[dt.bucketInstanceId]={}),!ge[dt.bucketInstanceId][dt.featureIndex]){var Ye=[new v.Point($e.x1,$e.y1),new v.Point($e.x2,$e.y1),new v.Point($e.x2,$e.y2),new v.Point($e.x1,$e.y2)];v.polygonIntersectsPolygon(d,Ye)&&(ge[dt.bucketInstanceId][dt.featureIndex]=!0,_e[dt.bucketInstanceId]===void 0&&(_e[dt.bucketInstanceId]=[]),_e[dt.bucketInstanceId].push(dt.featureIndex))}}return _e},Ko.prototype.insertCollisionBox=function(m,d,h,y,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:y,collisionGroupID:S},m[0],m[1],m[2],m[3])},Ko.prototype.insertCollisionCircles=function(m,d,h,y,S){for(var O=d?this.ignoredGrid:this.grid,M={bucketInstanceId:h,featureIndex:y,collisionGroupID:S},F=0;F<m.length;F+=4)O.insertCircle(M,m[F],m[F+1],m[F+2])},Ko.prototype.projectAndGetPerspectiveRatio=function(m,d,h){var y=[d,h,0,1];return Oa(y,y,m),{point:new v.Point((y[0]/y[3]+1)/2*this.transform.width+100,(-y[1]/y[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}},Ko.prototype.isOffscreen=function(m,d,h,y){return h<100||m>=this.screenRightBoundary||y<100||d>this.screenBottomBoundary},Ko.prototype.isInsideGrid=function(m,d,h,y){return h>=0&&m<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary},Ko.prototype.getViewportMatrix=function(){var m=v.identity([]);return v.translate(m,m,[-100,-100,0]),m};var Eo=function(d,h,y,S){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?h:-h))):S&&y?1:0,this.placed=y};Eo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var qo=function(d,h,y,S,O){this.text=new Eo(d?d.text:null,h,y,O),this.icon=new Eo(d?d.icon:null,h,S,O)};qo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var ol=function(d,h,y){this.text=d,this.icon=h,this.skipFade=y},Qo=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},sl=function(d,h,y,S,O){this.bucketInstanceId=d,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=S,this.tileID=O},oo=function(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}};function qi(m,d,h,y,S){var O=v.getAnchorAlignment(m),M=-(O.horizontalAlign-.5)*d,F=-(O.verticalAlign-.5)*h,X=v.evaluateVariableOffset(m,y);return new v.Point(M+X[0]*S,F+X[1]*S)}function pt(m,d,h,y,S,O){var M=m.x1,F=m.x2,X=m.y1,ee=m.y2,ge=m.anchorPointX,_e=m.anchorPointY,Ee=new v.Point(d,h);return y&&Ee._rotate(S?O:-O),{x1:M+Ee.x,y1:X+Ee.y,x2:F+Ee.x,y2:ee+Ee.y,anchorPointX:ge,anchorPointY:_e}}oo.prototype.get=function(m){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[m]){var d=++this.maxGroupID;this.collisionGroups[m]={ID:d,predicate:function(y){return y.collisionGroupID===d}}}return this.collisionGroups[m]};var pe=function(d,h,y,S){this.transform=d.clone(),this.collisionIndex=new Ko(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new oo(y),this.collisionCircleArrays={},this.prevPlacement=S,S&&(S.prevPlacement=void 0),this.placedOrientations={}};function Ke(m,d,h,y,S){m.emplaceBack(d?1:0,h?1:0,y||0,S||0),m.emplaceBack(d?1:0,h?1:0,y||0,S||0),m.emplaceBack(d?1:0,h?1:0,y||0,S||0),m.emplaceBack(d?1:0,h?1:0,y||0,S||0)}pe.prototype.getBucketParts=function(m,d,h,y){var S=h.getBucket(d),O=h.latestFeatureIndex;if(S&&O&&d.id===S.layerIds[0]){var M=h.collisionBoxArray,F=S.layers[0].layout,X=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),ee=h.tileSize/v.EXTENT,ge=this.transform.calculatePosMatrix(h.tileID.toUnwrapped()),_e=F.get("text-pitch-alignment")==="map",Ee=F.get("text-rotation-alignment")==="map",qe=ca(h,1,this.transform.zoom),$e=ja(ge,_e,Ee,this.transform,qe),dt=null;if(_e){var Ye=Wi(ge,_e,Ee,this.transform,qe);dt=v.multiply([],this.transform.labelPlaneMatrix,Ye)}this.retainedQueryData[S.bucketInstanceId]=new sl(S.bucketInstanceId,O,S.sourceLayerIndex,S.index,h.tileID);var ot={bucket:S,layout:F,posMatrix:ge,textLabelPlaneMatrix:$e,labelToScreenMatrix:dt,scale:X,textPixelRatio:ee,holdingForFade:h.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(y)for(var Mt=0,Pt=S.sortKeyRanges;Mt<Pt.length;Mt+=1){var dr=Pt[Mt];m.push({sortKey:dr.sortKey,symbolInstanceStart:dr.symbolInstanceStart,symbolInstanceEnd:dr.symbolInstanceEnd,parameters:ot})}else m.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:ot})}},pe.prototype.attemptAnchorPlacement=function(m,d,h,y,S,O,M,F,X,ee,ge,_e,Ee,qe,$e){var dt,Ye=[_e.textOffset0,_e.textOffset1],ot=qi(m,h,y,Ye,S),Mt=this.collisionIndex.placeCollisionBox(pt(d,ot.x,ot.y,O,M,this.transform.angle),ge,F,X,ee.predicate);if(!$e||this.collisionIndex.placeCollisionBox(pt($e,ot.x,ot.y,O,M,this.transform.angle),ge,F,X,ee.predicate).box.length!==0)return Mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(dt=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:Ye,width:h,height:y,anchor:m,textBoxScale:S,prevAnchor:dt},this.markUsedJustification(Ee,m,_e,qe),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,qe,_e),this.placedOrientations[_e.crossTileID]=qe),{shift:ot,placedGlyphBoxes:Mt}):void 0},pe.prototype.placeLayerBucketPart=function(m,d,h){var y=this,S=m.parameters,O=S.bucket,M=S.layout,F=S.posMatrix,X=S.textLabelPlaneMatrix,ee=S.labelToScreenMatrix,ge=S.textPixelRatio,_e=S.holdingForFade,Ee=S.collisionBoxArray,qe=S.partiallyEvaluatedTextSize,$e=S.collisionGroup,dt=M.get("text-optional"),Ye=M.get("icon-optional"),ot=M.get("text-allow-overlap"),Mt=M.get("icon-allow-overlap"),Pt=M.get("text-rotation-alignment")==="map",dr=M.get("text-pitch-alignment")==="map",Jt=M.get("icon-text-fit")!=="none",br=M.get("symbol-z-order")==="viewport-y",Er=ot&&(Mt||!O.hasIconData()||Ye),en=Mt&&(ot||!O.hasTextData()||dt);!O.collisionArrays&&Ee&&O.deserializeCollisionBoxes(Ee);var Xr=function(Tn,Ei){if(!d[Tn.crossTileID])if(_e)y.placements[Tn.crossTileID]=new ol(!1,!1,!1);else{var vi,Hn=!1,Ci=!1,ti=!0,_i=null,Yi={box:null,offscreen:null},za={box:null,offscreen:null},Aa=null,No=null,$a=0,Ya=0,Ks=0;Ei.textFeatureIndex?$a=Ei.textFeatureIndex:Tn.useRuntimeCollisionCircles&&($a=Tn.featureIndex),Ei.verticalTextFeatureIndex&&(Ya=Ei.verticalTextFeatureIndex);var jo=Ei.textBox;if(jo){var Yu=function(Ka){var fs=v.WritingMode.horizontal;if(O.allowVerticalPlacement&&!Ka&&y.prevPlacement){var xs=y.prevPlacement.placedOrientations[Tn.crossTileID];xs&&(y.placedOrientations[Tn.crossTileID]=xs,y.markUsedOrientation(O,fs=xs,Tn))}return fs},Ku=function(Ka,fs){if(O.allowVerticalPlacement&&Tn.numVerticalGlyphVertices>0&&Ei.verticalTextBox)for(var xs=0,Cu=O.writingModes;xs<Cu.length&&(Cu[xs]===v.WritingMode.vertical?(Yi=fs(),za=Yi):Yi=Ka(),!(Yi&&Yi.box&&Yi.box.length));xs+=1);else Yi=Ka()};if(M.get("text-variable-anchor")){var _s=M.get("text-variable-anchor");if(y.prevPlacement&&y.prevPlacement.variableOffsets[Tn.crossTileID]){var bs=y.prevPlacement.variableOffsets[Tn.crossTileID];_s.indexOf(bs.anchor)>0&&(_s=_s.filter(function(zo){return zo!==bs.anchor})).unshift(bs.anchor)}var fc=function(Ka,fs,xs){for(var Cu=Ka.x2-Ka.x1,Ef=Ka.y2-Ka.y1,zc=Tn.textBoxScale,hc=Jt&&!Mt?fs:null,es={box:[],offscreen:!1},Vh=ot?2*_s.length:_s.length,Uc=0;Uc<Vh;++Uc){var qu=y.attemptAnchorPlacement(_s[Uc%_s.length],Ka,Cu,Ef,zc,Pt,dr,ge,F,$e,Uc>=_s.length,Tn,O,xs,hc);if(qu&&(es=qu.placedGlyphBoxes)&&es.box&&es.box.length){Hn=!0,_i=qu.shift;break}}return es};Ku(function(){return fc(jo,Ei.iconBox,v.WritingMode.horizontal)},function(){var zo=Ei.verticalTextBox;return O.allowVerticalPlacement&&!(Yi&&Yi.box&&Yi.box.length)&&Tn.numVerticalGlyphVertices>0&&zo?fc(zo,Ei.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Yi&&(Hn=Yi.box,ti=Yi.offscreen);var xf=Yu(Yi&&Yi.box);if(!Hn&&y.prevPlacement){var du=y.prevPlacement.variableOffsets[Tn.crossTileID];du&&(y.variableOffsets[Tn.crossTileID]=du,y.markUsedJustification(O,du.anchor,Tn,xf))}}else{var Gl=function(Ka,fs){var xs=y.collisionIndex.placeCollisionBox(Ka,ot,ge,F,$e.predicate);return xs&&xs.box&&xs.box.length&&(y.markUsedOrientation(O,fs,Tn),y.placedOrientations[Tn.crossTileID]=fs),xs};Ku(function(){return Gl(jo,v.WritingMode.horizontal)},function(){var zo=Ei.verticalTextBox;return O.allowVerticalPlacement&&Tn.numVerticalGlyphVertices>0&&zo?Gl(zo,v.WritingMode.vertical):{box:null,offscreen:null}}),Yu(Yi&&Yi.box&&Yi.box.length)}}if(Hn=(vi=Yi)&&vi.box&&vi.box.length>0,ti=vi&&vi.offscreen,Tn.useRuntimeCollisionCircles){var vu=O.text.placedSymbolArray.get(Tn.centerJustifiedTextSymbolIndex),mu=v.evaluateSizeForFeature(O.textSizeData,qe,vu),_l=M.get("text-padding");Aa=y.collisionIndex.placeCollisionCircles(ot,vu,O.lineVertexArray,O.glyphOffsetArray,mu,F,X,ee,h,dr,$e.predicate,Tn.collisionCircleDiameter,_l),Hn=ot||Aa.circles.length>0&&!Aa.collisionDetected,ti=ti&&Aa.offscreen}if(Ei.iconFeatureIndex&&(Ks=Ei.iconFeatureIndex),Ei.iconBox){var ls=function(Ka){var fs=Jt&&_i?pt(Ka,_i.x,_i.y,Pt,dr,y.transform.angle):Ka;return y.collisionIndex.placeCollisionBox(fs,Mt,ge,F,$e.predicate)};Ci=za&&za.box&&za.box.length&&Ei.verticalIconBox?(No=ls(Ei.verticalIconBox)).box.length>0:(No=ls(Ei.iconBox)).box.length>0,ti=ti&&No.offscreen}var so=dt||Tn.numHorizontalGlyphVertices===0&&Tn.numVerticalGlyphVertices===0,cs=Ye||Tn.numIconVertices===0;if(so||cs?cs?so||(Ci=Ci&&Hn):Hn=Ci&&Hn:Ci=Hn=Ci&&Hn,Hn&&vi&&vi.box&&y.collisionIndex.insertCollisionBox(vi.box,M.get("text-ignore-placement"),O.bucketInstanceId,za&&za.box&&Ya?Ya:$a,$e.ID),Ci&&No&&y.collisionIndex.insertCollisionBox(No.box,M.get("icon-ignore-placement"),O.bucketInstanceId,Ks,$e.ID),Aa&&(Hn&&y.collisionIndex.insertCollisionCircles(Aa.circles,M.get("text-ignore-placement"),O.bucketInstanceId,$a,$e.ID),h)){var bl=O.bucketInstanceId,iu=y.collisionCircleArrays[bl];iu===void 0&&(iu=y.collisionCircleArrays[bl]=new Qo);for(var fo=0;fo<Aa.circles.length;fo+=4)iu.circles.push(Aa.circles[fo+0]),iu.circles.push(Aa.circles[fo+1]),iu.circles.push(Aa.circles[fo+2]),iu.circles.push(Aa.collisionDetected?1:0)}y.placements[Tn.crossTileID]=new ol(Hn||Er,Ci||en,ti||O.justReloaded),d[Tn.crossTileID]=!0}};if(br)for(var gn=O.getSortedSymbolIndexes(this.transform.angle),In=gn.length-1;In>=0;--In){var Vn=gn[In];Xr(O.symbolInstances.get(Vn),O.collisionArrays[Vn])}else for(var oi=m.symbolInstanceStart;oi<m.symbolInstanceEnd;oi++)Xr(O.symbolInstances.get(oi),O.collisionArrays[oi]);if(h&&O.bucketInstanceId in this.collisionCircleArrays){var Di=this.collisionCircleArrays[O.bucketInstanceId];v.invert(Di.invProjMatrix,F),Di.viewportMatrix=this.collisionIndex.getViewportMatrix()}O.justReloaded=!1},pe.prototype.markUsedJustification=function(m,d,h,y){var S;S=y===v.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(d)];for(var O=0,M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];O<M.length;O+=1){var F=M[O];F>=0&&(m.text.placedSymbolArray.get(F).crossTileID=S>=0&&F!==S?0:h.crossTileID)}},pe.prototype.markUsedOrientation=function(m,d,h){for(var y=d===v.WritingMode.horizontal||d===v.WritingMode.horizontalOnly?d:0,S=d===v.WritingMode.vertical?d:0,O=0,M=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];O<M.length;O+=1)m.text.placedSymbolArray.get(M[O]).placedOrientation=y;h.verticalPlacedTextSymbolIndex&&(m.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=S)},pe.prototype.commit=function(m){this.commitTime=m,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,h=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var y=d?d.symbolFadeChange(m):1,S=d?d.opacities:{},O=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(var F in this.placements){var X=this.placements[F],ee=S[F];ee?(this.opacities[F]=new qo(ee,y,X.text,X.icon),h=h||X.text!==ee.text.placed||X.icon!==ee.icon.placed):(this.opacities[F]=new qo(null,y,X.text,X.icon,X.skipFade),h=h||X.text||X.icon)}for(var ge in S){var _e=S[ge];if(!this.opacities[ge]){var Ee=new qo(_e,y,!1,!1);Ee.isHidden()||(this.opacities[ge]=Ee,h=h||_e.text.placed||_e.icon.placed)}}for(var qe in O)this.variableOffsets[qe]||!this.opacities[qe]||this.opacities[qe].isHidden()||(this.variableOffsets[qe]=O[qe]);for(var $e in M)this.placedOrientations[$e]||!this.opacities[$e]||this.opacities[$e].isHidden()||(this.placedOrientations[$e]=M[$e]);h?this.lastPlacementChangeTime=m:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:m)},pe.prototype.updateLayerOpacities=function(m,d){for(var h={},y=0,S=d;y<S.length;y+=1){var O=S[y],M=O.getBucket(m);M&&O.latestFeatureIndex&&m.id===M.layerIds[0]&&this.updateBucketOpacities(M,h,O.collisionBoxArray)}},pe.prototype.updateBucketOpacities=function(m,d,h){var y=this;m.hasTextData()&&m.text.opacityVertexArray.clear(),m.hasIconData()&&m.icon.opacityVertexArray.clear(),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexArray.clear(),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexArray.clear();var S=m.layers[0].layout,O=new qo(null,0,!1,!1,!0),M=S.get("text-allow-overlap"),F=S.get("icon-allow-overlap"),X=S.get("text-variable-anchor"),ee=S.get("text-rotation-alignment")==="map",ge=S.get("text-pitch-alignment")==="map",_e=S.get("icon-text-fit")!=="none",Ee=new qo(null,0,M&&(F||!m.hasIconData()||S.get("icon-optional")),F&&(M||!m.hasTextData()||S.get("text-optional")),!0);!m.collisionArrays&&h&&(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData())&&m.deserializeCollisionBoxes(h);for(var qe=function(Mt,Pt,dr){for(var Jt=0;Jt<Pt/4;Jt++)Mt.opacityVertexArray.emplaceBack(dr)},$e=function(Mt){var Pt=m.symbolInstances.get(Mt),dr=Pt.numHorizontalGlyphVertices,Jt=Pt.numVerticalGlyphVertices,br=Pt.crossTileID,Er=y.opacities[br];d[br]?Er=O:Er||(y.opacities[br]=Er=Ee),d[br]=!0;var en=Pt.numIconVertices>0,Xr=y.placedOrientations[Pt.crossTileID],gn=Xr===v.WritingMode.vertical,In=Xr===v.WritingMode.horizontal||Xr===v.WritingMode.horizontalOnly;if(dr>0||Jt>0){var Vn=Cs(Er.text);qe(m.text,dr,gn?uu:Vn),qe(m.text,Jt,In?uu:Vn);var oi=Er.text.isHidden();[Pt.rightJustifiedTextSymbolIndex,Pt.centerJustifiedTextSymbolIndex,Pt.leftJustifiedTextSymbolIndex].forEach(function(Yi){Yi>=0&&(m.text.placedSymbolArray.get(Yi).hidden=oi||gn?1:0)}),Pt.verticalPlacedTextSymbolIndex>=0&&(m.text.placedSymbolArray.get(Pt.verticalPlacedTextSymbolIndex).hidden=oi||In?1:0);var Di=y.variableOffsets[Pt.crossTileID];Di&&y.markUsedJustification(m,Di.anchor,Pt,Xr);var Ji=y.placedOrientations[Pt.crossTileID];Ji&&(y.markUsedJustification(m,"left",Pt,Ji),y.markUsedOrientation(m,Ji,Pt))}if(en){var Tn=Cs(Er.icon),Ei=!(_e&&Pt.verticalPlacedIconSymbolIndex&&gn);Pt.placedIconSymbolIndex>=0&&(qe(m.icon,Pt.numIconVertices,Ei?Tn:uu),m.icon.placedSymbolArray.get(Pt.placedIconSymbolIndex).hidden=Er.icon.isHidden()),Pt.verticalPlacedIconSymbolIndex>=0&&(qe(m.icon,Pt.numVerticalIconVertices,Ei?uu:Tn),m.icon.placedSymbolArray.get(Pt.verticalPlacedIconSymbolIndex).hidden=Er.icon.isHidden())}if(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData()){var vi=m.collisionArrays[Mt];if(vi){var Hn=new v.Point(0,0);if(vi.textBox||vi.verticalTextBox){var Ci=!0;if(X){var ti=y.variableOffsets[br];ti?(Hn=qi(ti.anchor,ti.width,ti.height,ti.textOffset,ti.textBoxScale),ee&&Hn._rotate(ge?y.transform.angle:-y.transform.angle)):Ci=!1}vi.textBox&&Ke(m.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||gn,Hn.x,Hn.y),vi.verticalTextBox&&Ke(m.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||In,Hn.x,Hn.y)}var _i=Boolean(!In&&vi.verticalIconBox);vi.iconBox&&Ke(m.iconCollisionBox.collisionVertexArray,Er.icon.placed,_i,_e?Hn.x:0,_e?Hn.y:0),vi.verticalIconBox&&Ke(m.iconCollisionBox.collisionVertexArray,Er.icon.placed,!_i,_e?Hn.x:0,_e?Hn.y:0)}}},dt=0;dt<m.symbolInstances.length;dt++)$e(dt);if(m.sortFeatures(this.transform.angle),this.retainedQueryData[m.bucketInstanceId]&&(this.retainedQueryData[m.bucketInstanceId].featureSortOrder=m.featureSortOrder),m.hasTextData()&&m.text.opacityVertexBuffer&&m.text.opacityVertexBuffer.updateData(m.text.opacityVertexArray),m.hasIconData()&&m.icon.opacityVertexBuffer&&m.icon.opacityVertexBuffer.updateData(m.icon.opacityVertexArray),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexBuffer&&m.iconCollisionBox.collisionVertexBuffer.updateData(m.iconCollisionBox.collisionVertexArray),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexBuffer&&m.textCollisionBox.collisionVertexBuffer.updateData(m.textCollisionBox.collisionVertexArray),m.bucketInstanceId in this.collisionCircleArrays){var Ye=this.collisionCircleArrays[m.bucketInstanceId];m.placementInvProjMatrix=Ye.invProjMatrix,m.placementViewportMatrix=Ye.viewportMatrix,m.collisionCircleArray=Ye.circles,delete this.collisionCircleArrays[m.bucketInstanceId]}},pe.prototype.symbolFadeChange=function(m){return this.fadeDuration===0?1:(m-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},pe.prototype.zoomAdjustment=function(m){return Math.max(0,(this.transform.zoom-m)/1.5)},pe.prototype.hasTransitions=function(m){return this.stale||m-this.lastPlacementChangeTime<this.fadeDuration},pe.prototype.stillRecent=function(m,d){var h=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*h>m},pe.prototype.setStale=function(){this.stale=!0};var ar=Math.pow(2,25),qr=Math.pow(2,24),Cn=Math.pow(2,17),ji=Math.pow(2,16),ka=Math.pow(2,9),So=Math.pow(2,8),os=Math.pow(2,1);function Cs(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;var d=m.placed?1:0,h=Math.floor(127*m.opacity);return h*ar+d*qr+h*Cn+d*ji+h*ka+d*So+h*os+d}var uu=0,Bf=function(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Bf.prototype.continuePlacement=function(m,d,h,y,S){for(var O=this._bucketParts;this._currentTileIndex<m.length;)if(d.getBucketParts(O,y,m[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort(function(M,F){return M.sortKey-F.sortKey}));this._currentPartIndex<O.length;)if(d.placeLayerBucketPart(O[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,S())return!0;return!1};var Ml=function(d,h,y,S,O,M,F){this.placement=new pe(d,O,M,F),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=S,this._done=!1};Ml.prototype.isDone=function(){return this._done},Ml.prototype.continuePlacement=function(m,d,h){for(var y=this,S=v.browser.now(),O=function(){var ee=v.browser.now()-S;return!y._forceFullPlacement&&ee>2};this._currentPlacementIndex>=0;){var M=d[m[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=F)&&(!M.maxzoom||M.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new Bf(M)),this._inProgressLayer.continuePlacement(h[M.source],this.placement,this._showCollisionBoxes,M,O))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ml.prototype.commit=function(m){return this.placement.commit(m),this.placement};var lp=512/v.EXTENT/2,rc=function(d,h,y){this.tileID=d,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(var S=0;S<h.length;S++){var O=h.get(S),M=O.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:O.crossTileID,coord:this.getScaledCoordinates(O,d)})}};rc.prototype.getScaledCoordinates=function(m,d){var h=lp/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*v.EXTENT+m.anchorX)*h),y:Math.floor((d.canonical.y*v.EXTENT+m.anchorY)*h)}},rc.prototype.findMatches=function(m,d,h){for(var y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),S=0;S<m.length;S++){var O=m.get(S);if(!O.crossTileID){var M=this.indexedSymbolInstances[O.key];if(M)for(var F=this.getScaledCoordinates(O,d),X=0,ee=M;X<ee.length;X+=1){var ge=ee[X];if(Math.abs(ge.coord.x-F.x)<=y&&Math.abs(ge.coord.y-F.y)<=y&&!h[ge.crossTileID]){h[ge.crossTileID]=!0,O.crossTileID=ge.crossTileID;break}}}}};var Ra=function(){this.maxCrossTileID=0};Ra.prototype.generate=function(){return++this.maxCrossTileID};var ul=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};ul.prototype.handleWrapJump=function(m){var d=Math.round((m-this.lng)/360);if(d!==0)for(var h in this.indexes){var y=this.indexes[h],S={};for(var O in y){var M=y[O];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),S[M.tileID.key]=M}this.indexes[h]=S}this.lng=m},ul.prototype.addBucket=function(m,d,h){if(this.indexes[m.overscaledZ]&&this.indexes[m.overscaledZ][m.key]){if(this.indexes[m.overscaledZ][m.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(m.overscaledZ,this.indexes[m.overscaledZ][m.key])}for(var y=0;y<d.symbolInstances.length;y++)d.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[m.overscaledZ]||(this.usedCrossTileIDs[m.overscaledZ]={});var S=this.usedCrossTileIDs[m.overscaledZ];for(var O in this.indexes){var M=this.indexes[O];if(Number(O)>m.overscaledZ)for(var F in M){var X=M[F];X.tileID.isChildOf(m)&&X.findMatches(d.symbolInstances,m,S)}else{var ee=M[m.scaledTo(Number(O)).key];ee&&ee.findMatches(d.symbolInstances,m,S)}}for(var ge=0;ge<d.symbolInstances.length;ge++){var _e=d.symbolInstances.get(ge);_e.crossTileID||(_e.crossTileID=h.generate(),S[_e.crossTileID]=!0)}return this.indexes[m.overscaledZ]===void 0&&(this.indexes[m.overscaledZ]={}),this.indexes[m.overscaledZ][m.key]=new rc(m,d.symbolInstances,d.bucketInstanceId),!0},ul.prototype.removeBucketCrossTileIDs=function(m,d){for(var h in d.indexedSymbolInstances)for(var y=0,S=d.indexedSymbolInstances[h];y<S.length;y+=1)delete this.usedCrossTileIDs[m][S[y].crossTileID]},ul.prototype.removeStaleBuckets=function(m){var d=!1;for(var h in this.indexes){var y=this.indexes[h];for(var S in y)m[y[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,y[S]),delete y[S],d=!0)}return d};var ll=function(){this.layerIndexes={},this.crossTileIDs=new Ra,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ll.prototype.addLayer=function(m,d,h){var y=this.layerIndexes[m.id];y===void 0&&(y=this.layerIndexes[m.id]=new ul);var S=!1,O={};y.handleWrapJump(h);for(var M=0,F=d;M<F.length;M+=1){var X=F[M],ee=X.getBucket(m);ee&&m.id===ee.layerIds[0]&&(ee.bucketInstanceId||(ee.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(X.tileID,ee,this.crossTileIDs)&&(S=!0),O[ee.bucketInstanceId]=!0)}return y.removeStaleBuckets(O)&&(S=!0),S},ll.prototype.pruneUnusedLayers=function(m){var d={};for(var h in m.forEach(function(y){d[y]=!0}),this.layerIndexes)d[h]||delete this.layerIndexes[h]};var lu=function(d,h){return v.emitValidationErrors(d,h&&h.filter(function(y){return y.identifier!=="source.canvas"}))},xu=v.pick(yn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ju=v.pick(yn,["setCenter","setZoom","setBearing","setPitch"]),af=function(){var m={},d=v.styleSpec.$version;for(var h in v.styleSpec.$root){var y,S=v.styleSpec.$root[h];S.required&&(y=h==="version"?d:S.type==="array"?[]:{})!=null&&(m[h]=y)}return m}(),go=function(m){function d(h,y){var S=this;y===void 0&&(y={}),m.call(this),this.map=h,this.dispatcher=new Ce(ut(),this),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new Mr(h._requestManager,y.localIdeographFontFamily),this.lineAtlas=new Ut(256,512),this.crossTileSymbolIndex=new ll,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var O=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(M){O.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(F,X){if(v.triggerPluginCompletionEvent(F),X&&X.every(function(ge){return ge}))for(var ee in O.sourceCaches)O.sourceCaches[ee].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var F=S.sourceCaches[M.sourceId];if(F){var X=F.getSource();if(X&&X.vectorLayerIds)for(var ee in S._layers){var ge=S._layers[ee];ge.source===X.id&&S._validateLayer(ge)}}}})}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.loadURL=function(h,y){var S=this;y===void 0&&(y={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var O=typeof y.validate=="boolean"?y.validate:!v.isMapboxURL(h);h=this.map._requestManager.normalizeStyleURL(h,y.accessToken);var M=this.map._requestManager.transformRequest(h,v.ResourceType.Style);this._request=v.getJSON(M,function(F,X){S._request=null,F?S.fire(new v.ErrorEvent(F)):X&&S._load(X,O)})},d.prototype.loadJSON=function(h,y){var S=this;y===void 0&&(y={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){S._request=null,S._load(h,y.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(af,!1)},d.prototype._load=function(h,y){if(!y||!lu(this,v.validateStyle(h))){for(var S in this._loaded=!0,this.stylesheet=h,h.sources)this.addSource(S,h.sources[S],{validate:!1});h.sprite?this._loadSprite(h.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(h.glyphs);var O=dn(this.stylesheet.layers);this._order=O.map(function(ee){return ee.id}),this._layers={},this._serializedLayers={};for(var M=0,F=O;M<F.length;M+=1){var X=F[M];(X=v.createStyleLayer(X)).setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Dt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},d.prototype._loadSprite=function(h){var y=this;this._spriteRequest=function(S,O,M){var F,X,ee,ge=v.browser.devicePixelRatio>1?"@2x":"",_e=v.getJSON(O.transformRequest(O.normalizeSpriteURL(S,ge,".json"),v.ResourceType.SpriteJSON),function($e,dt){_e=null,ee||(ee=$e,F=dt,qe())}),Ee=v.getImage(O.transformRequest(O.normalizeSpriteURL(S,ge,".png"),v.ResourceType.SpriteImage),function($e,dt){Ee=null,ee||(ee=$e,X=dt,qe())});function qe(){if(ee)M(ee);else if(F&&X){var $e=v.browser.getImageData(X),dt={};for(var Ye in F){var ot=F[Ye],Mt=ot.width,Pt=ot.height,dr=ot.x,Jt=ot.y,br=ot.sdf,Er=ot.pixelRatio,en=ot.stretchX,Xr=ot.stretchY,gn=ot.content,In=new v.RGBAImage({width:Mt,height:Pt});v.RGBAImage.copy($e,In,{x:dr,y:Jt},{x:0,y:0},{width:Mt,height:Pt}),dt[Ye]={data:In,pixelRatio:Er,sdf:br,stretchX:en,stretchY:Xr,content:gn}}M(null,dt)}}return{cancel:function(){_e&&(_e.cancel(),_e=null),Ee&&(Ee.cancel(),Ee=null)}}}(h,this.map._requestManager,function(S,O){if(y._spriteRequest=null,S)y.fire(new v.ErrorEvent(S));else if(O)for(var M in O)y.imageManager.addImage(M,O[M]);y.imageManager.setLoaded(!0),y._availableImages=y.imageManager.listImages(),y.dispatcher.broadcast("setImages",y._availableImages),y.fire(new v.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(h){var y=this.sourceCaches[h.source];if(y){var S=h.sourceLayer;if(S){var O=y.getSource();(O.type==="geojson"||O.vectorLayerIds&&O.vectorLayerIds.indexOf(S)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+O.id+'" as specified by style layer "'+h.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var h in this.sourceCaches)if(!this.sourceCaches[h].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(h){for(var y=[],S=0,O=h;S<O.length;S+=1){var M=this._layers[O[S]];M.type!=="custom"&&y.push(M.serialize())}return y},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(var y in this._layers)if(this._layers[y].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(h){if(this._loaded){var y=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),O=Object.keys(this._removedLayers);for(var M in(S.length||O.length)&&this._updateWorkerLayers(S,O),this._updatedSources){var F=this._updatedSources[M];F==="reload"?this._reloadSource(M):F==="clear"&&this._clearSource(M)}for(var X in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[X].updateTransitions(h);this.light.updateTransitions(h),this._resetUpdates()}var ee={};for(var ge in this.sourceCaches){var _e=this.sourceCaches[ge];ee[ge]=_e.used,_e.used=!1}for(var Ee=0,qe=this._order;Ee<qe.length;Ee+=1){var $e=this._layers[qe[Ee]];$e.recalculate(h,this._availableImages),!$e.isHidden(h.zoom)&&$e.source&&(this.sourceCaches[$e.source].used=!0)}for(var dt in ee){var Ye=this.sourceCaches[dt];ee[dt]!==Ye.used&&Ye.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:dt}))}this.light.recalculate(h),this.z=h.zoom,y&&this.fire(new v.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var h=Object.keys(this._changedImages);if(h.length){for(var y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["icons","patterns"],h);this._changedImages={}}},d.prototype._updateWorkerLayers=function(h,y){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(h),removedIds:y})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(h){var y=this;if(this._checkLoaded(),lu(this,v.validateStyle(h)))return!1;(h=v.clone$1(h)).layers=dn(h.layers);var S=function(M,F){if(!M)return[{command:yn.setStyle,args:[F]}];var X=[];try{if(!v.deepEqual(M.version,F.version))return[{command:yn.setStyle,args:[F]}];v.deepEqual(M.center,F.center)||X.push({command:yn.setCenter,args:[F.center]}),v.deepEqual(M.zoom,F.zoom)||X.push({command:yn.setZoom,args:[F.zoom]}),v.deepEqual(M.bearing,F.bearing)||X.push({command:yn.setBearing,args:[F.bearing]}),v.deepEqual(M.pitch,F.pitch)||X.push({command:yn.setPitch,args:[F.pitch]}),v.deepEqual(M.sprite,F.sprite)||X.push({command:yn.setSprite,args:[F.sprite]}),v.deepEqual(M.glyphs,F.glyphs)||X.push({command:yn.setGlyphs,args:[F.glyphs]}),v.deepEqual(M.transition,F.transition)||X.push({command:yn.setTransition,args:[F.transition]}),v.deepEqual(M.light,F.light)||X.push({command:yn.setLight,args:[F.light]});var ee={},ge=[];(function(Ee,qe,$e,dt){var Ye;for(Ye in qe=qe||{},Ee=Ee||{})Ee.hasOwnProperty(Ye)&&(qe.hasOwnProperty(Ye)||vn(Ye,$e,dt));for(Ye in qe)qe.hasOwnProperty(Ye)&&(Ee.hasOwnProperty(Ye)?v.deepEqual(Ee[Ye],qe[Ye])||(Ee[Ye].type==="geojson"&&qe[Ye].type==="geojson"&&Zi(Ee,qe,Ye)?$e.push({command:yn.setGeoJSONSourceData,args:[Ye,qe[Ye].data]}):Ai(Ye,qe,$e,dt)):ci(Ye,qe,$e))})(M.sources,F.sources,ge,ee);var _e=[];M.layers&&M.layers.forEach(function(Ee){ee[Ee.source]?X.push({command:yn.removeLayer,args:[Ee.id]}):_e.push(Ee)}),X=X.concat(ge),function(Ee,qe,$e){qe=qe||[];var dt,Ye,ot,Mt,Pt,dr,Jt,br=(Ee=Ee||[]).map($i),Er=qe.map($i),en=Ee.reduce(zi,{}),Xr=qe.reduce(zi,{}),gn=br.slice(),In=Object.create(null);for(dt=0,Ye=0;dt<br.length;dt++)Xr.hasOwnProperty(ot=br[dt])?Ye++:($e.push({command:yn.removeLayer,args:[ot]}),gn.splice(gn.indexOf(ot,Ye),1));for(dt=0,Ye=0;dt<Er.length;dt++)gn[gn.length-1-dt]!==(ot=Er[Er.length-1-dt])&&(en.hasOwnProperty(ot)?($e.push({command:yn.removeLayer,args:[ot]}),gn.splice(gn.lastIndexOf(ot,gn.length-Ye),1)):Ye++,$e.push({command:yn.addLayer,args:[Xr[ot],dr=gn[gn.length-dt]]}),gn.splice(gn.length-dt,0,ot),In[ot]=!0);for(dt=0;dt<Er.length;dt++)if(Mt=en[ot=Er[dt]],Pt=Xr[ot],!In[ot]&&!v.deepEqual(Mt,Pt))if(v.deepEqual(Mt.source,Pt.source)&&v.deepEqual(Mt["source-layer"],Pt["source-layer"])&&v.deepEqual(Mt.type,Pt.type)){for(Jt in Bi(Mt.layout,Pt.layout,$e,ot,null,yn.setLayoutProperty),Bi(Mt.paint,Pt.paint,$e,ot,null,yn.setPaintProperty),v.deepEqual(Mt.filter,Pt.filter)||$e.push({command:yn.setFilter,args:[ot,Pt.filter]}),v.deepEqual(Mt.minzoom,Pt.minzoom)&&v.deepEqual(Mt.maxzoom,Pt.maxzoom)||$e.push({command:yn.setLayerZoomRange,args:[ot,Pt.minzoom,Pt.maxzoom]}),Mt)Mt.hasOwnProperty(Jt)&&Jt!=="layout"&&Jt!=="paint"&&Jt!=="filter"&&Jt!=="metadata"&&Jt!=="minzoom"&&Jt!=="maxzoom"&&(Jt.indexOf("paint.")===0?Bi(Mt[Jt],Pt[Jt],$e,ot,Jt.slice(6),yn.setPaintProperty):v.deepEqual(Mt[Jt],Pt[Jt])||$e.push({command:yn.setLayerProperty,args:[ot,Jt,Pt[Jt]]}));for(Jt in Pt)Pt.hasOwnProperty(Jt)&&!Mt.hasOwnProperty(Jt)&&Jt!=="layout"&&Jt!=="paint"&&Jt!=="filter"&&Jt!=="metadata"&&Jt!=="minzoom"&&Jt!=="maxzoom"&&(Jt.indexOf("paint.")===0?Bi(Mt[Jt],Pt[Jt],$e,ot,Jt.slice(6),yn.setPaintProperty):v.deepEqual(Mt[Jt],Pt[Jt])||$e.push({command:yn.setLayerProperty,args:[ot,Jt,Pt[Jt]]}))}else $e.push({command:yn.removeLayer,args:[ot]}),dr=gn[gn.lastIndexOf(ot)+1],$e.push({command:yn.addLayer,args:[Pt,dr]})}(_e,F.layers,X)}catch(Ee){console.warn("Unable to compute style diff:",Ee),X=[{command:yn.setStyle,args:[F]}]}return X}(this.serialize(),h).filter(function(M){return!(M.command in ju)});if(S.length===0)return!1;var O=S.filter(function(M){return!(M.command in xu)});if(O.length>0)throw new Error("Unimplemented: "+O.map(function(M){return M.command}).join(", ")+".");return S.forEach(function(M){M.command!=="setTransition"&&y[M.command].apply(y,M.args)}),this.stylesheet=h,!0},d.prototype.addImage=function(h,y){if(this.getImage(h))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(h,y),this._afterImageUpdated(h)},d.prototype.updateImage=function(h,y){this.imageManager.updateImage(h,y)},d.prototype.getImage=function(h){return this.imageManager.getImage(h)},d.prototype.removeImage=function(h){if(!this.getImage(h))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(h),this._afterImageUpdated(h)},d.prototype._afterImageUpdated=function(h){this._availableImages=this.imageManager.listImages(),this._changedImages[h]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(h,y,S){var O=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[h]!==void 0)throw new Error("There is already a source with this ID");if(!y.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(y).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(y.type)>=0&&this._validate(v.validateStyle.source,"sources."+h,y,null,S))){this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);var M=this.sourceCaches[h]=new Qe(h,y,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:O.loaded(),source:M.serialize(),sourceId:h}}),M.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(h){if(this._checkLoaded(),this.sourceCaches[h]===void 0)throw new Error("There is no source with this ID");for(var y in this._layers)if(this._layers[y].source===h)return this.fire(new v.ErrorEvent(new Error('Source "'+h+'" cannot be removed while layer "'+y+'" is using it.')));var S=this.sourceCaches[h];delete this.sourceCaches[h],delete this._updatedSources[h],S.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:h})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(h,y){this._checkLoaded(),this.sourceCaches[h].getSource().setData(y),this._changed=!0},d.prototype.getSource=function(h){return this.sourceCaches[h]&&this.sourceCaches[h].getSource()},d.prototype.addLayer=function(h,y,S){S===void 0&&(S={}),this._checkLoaded();var O=h.id;if(this.getLayer(O))this.fire(new v.ErrorEvent(new Error('Layer with id "'+O+'" already exists on this map')));else{var M;if(h.type==="custom"){if(lu(this,v.validateCustomStyleLayer(h)))return;M=v.createStyleLayer(h)}else{if(typeof h.source=="object"&&(this.addSource(O,h.source),h=v.clone$1(h),h=v.extend(h,{source:O})),this._validate(v.validateStyle.layer,"layers."+O,h,{arrayIndex:-1},S))return;M=v.createStyleLayer(h),this._validateLayer(M),M.setEventedParent(this,{layer:{id:O}}),this._serializedLayers[M.id]=M.serialize()}var F=y?this._order.indexOf(y):this._order.length;if(y&&F===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.')));else{if(this._order.splice(F,0,O),this._layerOrderChanged=!0,this._layers[O]=M,this._removedLayers[O]&&M.source&&M.type!=="custom"){var X=this._removedLayers[O];delete this._removedLayers[O],X.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},d.prototype.moveLayer=function(h,y){if(this._checkLoaded(),this._changed=!0,this._layers[h]){if(h!==y){var S=this._order.indexOf(h);this._order.splice(S,1);var O=y?this._order.indexOf(y):this._order.length;y&&O===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.'))):(this._order.splice(O,0,h),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(h){this._checkLoaded();var y=this._layers[h];if(y){y.setEventedParent(null);var S=this._order.indexOf(h);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[h]=y,delete this._layers[h],delete this._serializedLayers[h],delete this._updatedLayers[h],delete this._updatedPaintProps[h],y.onRemove&&y.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(h){return this._layers[h]},d.prototype.hasLayer=function(h){return h in this._layers},d.prototype.setLayerZoomRange=function(h,y,S){this._checkLoaded();var O=this.getLayer(h);O?O.minzoom===y&&O.maxzoom===S||(y!=null&&(O.minzoom=y),S!=null&&(O.maxzoom=S),this._updateLayer(O)):this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(h,y,S){S===void 0&&(S={}),this._checkLoaded();var O=this.getLayer(h);if(O){if(!v.deepEqual(O.filter,y))return y==null?(O.filter=void 0,void this._updateLayer(O)):void(this._validate(v.validateStyle.filter,"layers."+O.id+".filter",y,null,S)||(O.filter=v.clone$1(y),this._updateLayer(O)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(h){return v.clone$1(this.getLayer(h).filter)},d.prototype.setLayoutProperty=function(h,y,S,O){O===void 0&&(O={}),this._checkLoaded();var M=this.getLayer(h);M?v.deepEqual(M.getLayoutProperty(y),S)||(M.setLayoutProperty(y,S,O),this._updateLayer(M)):this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(h,y){var S=this.getLayer(h);if(S)return S.getLayoutProperty(y);this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(h,y,S,O){O===void 0&&(O={}),this._checkLoaded();var M=this.getLayer(h);M?v.deepEqual(M.getPaintProperty(y),S)||(M.setPaintProperty(y,S,O)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[h]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+h+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(h,y){return this.getLayer(h).getPaintProperty(y)},d.prototype.setFeatureState=function(h,y){this._checkLoaded();var S=h.source,O=h.sourceLayer,M=this.sourceCaches[S];if(M!==void 0){var F=M.getSource().type;F==="geojson"&&O?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):F!=="vector"||O?(h.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(O,h.id,y)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(h,y){this._checkLoaded();var S=h.source,O=this.sourceCaches[S];if(O!==void 0){var M=O.getSource().type,F=M==="vector"?h.sourceLayer:void 0;M!=="vector"||F?y&&typeof h.id!="string"&&typeof h.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):O.removeFeatureState(F,h.id,y):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(h){this._checkLoaded();var y=h.source,S=h.sourceLayer,O=this.sourceCaches[y];if(O!==void 0){if(O.getSource().type!=="vector"||S)return h.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),O.getFeatureState(S,h.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(h){return h.serialize()}),layers:this._serializeLayers(this._order)},function(h){return h!==void 0})},d.prototype._updateLayer=function(h){this._updatedLayers[h.id]=!0,h.source&&!this._updatedSources[h.source]&&this.sourceCaches[h.source].getSource().type!=="raster"&&(this._updatedSources[h.source]="reload",this.sourceCaches[h.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(h){for(var y=this,S=function(Xr){return y._layers[Xr].type==="fill-extrusion"},O={},M=[],F=this._order.length-1;F>=0;F--){var X=this._order[F];if(S(X)){O[X]=F;for(var ee=0,ge=h;ee<ge.length;ee+=1){var _e=ge[ee][X];if(_e)for(var Ee=0,qe=_e;Ee<qe.length;Ee+=1)M.push(qe[Ee])}}}M.sort(function(en,Xr){return Xr.intersectionZ-en.intersectionZ});for(var $e=[],dt=this._order.length-1;dt>=0;dt--){var Ye=this._order[dt];if(S(Ye))for(var ot=M.length-1;ot>=0;ot--){var Mt=M[ot].feature;if(O[Mt.layer.id]<dt)break;$e.push(Mt),M.pop()}else for(var Pt=0,dr=h;Pt<dr.length;Pt+=1){var Jt=dr[Pt][Ye];if(Jt)for(var br=0,Er=Jt;br<Er.length;br+=1)$e.push(Er[br].feature)}}return $e},d.prototype.queryRenderedFeatures=function(h,y,S){y&&y.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",y.filter,null,y);var O={};if(y&&y.layers){if(!Array.isArray(y.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,F=y.layers;M<F.length;M+=1){var X=F[M],ee=this._layers[X];if(!ee)return this.fire(new v.ErrorEvent(new Error("The layer '"+X+"' does not exist in the map's style and cannot be queried for features."))),[];O[ee.source]=!0}}var ge=[];for(var _e in y.availableImages=this._availableImages,this.sourceCaches)y.layers&&!O[_e]||ge.push(Br(this.sourceCaches[_e],this._layers,this._serializedLayers,h,y,S));return this.placement&&ge.push(function(Ee,qe,$e,dt,Ye,ot,Mt){for(var Pt={},dr=ot.queryRenderedSymbols(dt),Jt=[],br=0,Er=Object.keys(dr).map(Number);br<Er.length;br+=1)Jt.push(Mt[Er[br]]);Jt.sort(pn);for(var en=function(){var Di=gn[Xr],Ji=Di.featureIndex.lookupSymbolFeatures(dr[Di.bucketInstanceId],qe,Di.bucketIndex,Di.sourceLayerIndex,Ye.filter,Ye.layers,Ye.availableImages,Ee);for(var Tn in Ji){var Ei=Pt[Tn]=Pt[Tn]||[],vi=Ji[Tn];vi.sort(function(ti,_i){var Yi=Di.featureSortOrder;if(Yi){var za=Yi.indexOf(ti.featureIndex);return Yi.indexOf(_i.featureIndex)-za}return _i.featureIndex-ti.featureIndex});for(var Hn=0,Ci=vi;Hn<Ci.length;Hn+=1)Ei.push(Ci[Hn])}},Xr=0,gn=Jt;Xr<gn.length;Xr+=1)en();var In=function(Di){Pt[Di].forEach(function(Ji){var Tn=Ji.feature,Ei=$e[Ee[Di].source].getFeatureState(Tn.layer["source-layer"],Tn.id);Tn.source=Tn.layer.source,Tn.layer["source-layer"]&&(Tn.sourceLayer=Tn.layer["source-layer"]),Tn.state=Ei})};for(var Vn in Pt)In(Vn);return Pt}(this._layers,this._serializedLayers,this.sourceCaches,h,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ge)},d.prototype.querySourceFeatures=function(h,y){y&&y.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",y.filter,null,y);var S=this.sourceCaches[h];return S?function(O,M){for(var F=O.getRenderableIds().map(function(qe){return O.getTileByID(qe)}),X=[],ee={},ge=0;ge<F.length;ge++){var _e=F[ge],Ee=_e.tileID.canonical.key;ee[Ee]||(ee[Ee]=!0,_e.querySourceFeatures(X,M))}return X}(S,y):[]},d.prototype.addSourceType=function(h,y,S){return d.getSourceType(h)?S(new Error('A source type called "'+h+'" already exists.')):(d.setSourceType(h,y),y.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:h,url:y.workerSourceURL},S):S(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(h,y){y===void 0&&(y={}),this._checkLoaded();var S=this.light.getLight(),O=!1;for(var M in h)if(!v.deepEqual(h[M],S[M])){O=!0;break}if(O){var F={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(h,y),this.light.updateTransitions(F)}},d.prototype._validate=function(h,y,S,O,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&lu(this,h.call(v.validateStyle,v.extend({key:y,style:this.serialize(),value:S,styleSpec:v.styleSpec},O)))},d.prototype._remove=function(){for(var h in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[h].setEventedParent(null);for(var y in this.sourceCaches)this.sourceCaches[y].clearTiles(),this.sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(h){this.sourceCaches[h].clearTiles()},d.prototype._reloadSource=function(h){this.sourceCaches[h].resume(),this.sourceCaches[h].reload()},d.prototype._updateSources=function(h){for(var y in this.sourceCaches)this.sourceCaches[y].update(h)},d.prototype._generateCollisionBoxes=function(){for(var h in this.sourceCaches)this._reloadSource(h)},d.prototype._updatePlacement=function(h,y,S,O,M){M===void 0&&(M=!1);for(var F=!1,X=!1,ee={},ge=0,_e=this._order;ge<_e.length;ge+=1){var Ee=this._layers[_e[ge]];if(Ee.type==="symbol"){if(!ee[Ee.source]){var qe=this.sourceCaches[Ee.source];ee[Ee.source]=qe.getRenderableIds(!0).map(function(Mt){return qe.getTileByID(Mt)}).sort(function(Mt,Pt){return Pt.tileID.overscaledZ-Mt.tileID.overscaledZ||(Mt.tileID.isLessThan(Pt.tileID)?-1:1)})}var $e=this.crossTileSymbolIndex.addLayer(Ee,ee[Ee.source],h.center.lng);F=F||$e}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),h.zoom))&&(this.pauseablePlacement=new Ml(h,this._order,M,y,S,O,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ee),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),X=!0),F&&this.pauseablePlacement.placement.setStale()),X||F)for(var dt=0,Ye=this._order;dt<Ye.length;dt+=1){var ot=this._layers[Ye[dt]];ot.type==="symbol"&&this.placement.updateLayerOpacities(ot,ee[ot.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var h in this.sourceCaches)this.sourceCaches[h].releaseSymbolFadeTiles()},d.prototype.getImages=function(h,y,S){this.imageManager.getImages(y.icons,S),this._updateTilesForChangedImages();var O=this.sourceCaches[y.source];O&&O.setDependencies(y.tileID.key,y.type,y.icons)},d.prototype.getGlyphs=function(h,y,S){this.glyphManager.getGlyphs(y.stacks,S)},d.prototype.getResource=function(h,y,S){return v.makeRequest(y,S)},d}(v.Evented);go.getSourceType=function(m){return lr[m]},go.setSourceType=function(m,d){lr[m]=d},go.registerForPluginStateChange=v.registerForPluginStateChange;var Xa=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),nc=ba(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Ui=ba(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),zu=ba(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Uu=ba(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Rc=ba("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ah=ba(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Th=ba(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ch=ba("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),cp=ba("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Lf=ba("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),wh=ba(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Eu=ba(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),eu=ba(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),cr=ba(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),hn=ba(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ic=ba(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Pl=ba(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),tu=ba(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Il=ba(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cu=ba(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),cl=ba(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ru=ba(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),fl=ba(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Dl=ba(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fp=ba(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),hp=ba(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ba(m,d){var h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=d.match(/attribute ([\w]+) ([\w]+)/g),S=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),O=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=O?O.concat(S):S,F={};return{fragmentSource:m=m.replace(h,function(X,ee,ge,_e,Ee){return F[Ee]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
varying `+ge+" "+_e+" "+Ee+`;
#else
uniform `+ge+" "+_e+" u_"+Ee+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),vertexSource:d=d.replace(h,function(X,ee,ge,_e,Ee){var qe=_e==="float"?"vec2":"vec4",$e=Ee.match(/color/)?"color":qe;return F[Ee]?ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ge+" "+qe+" a_"+Ee+`;
varying `+ge+" "+_e+" "+Ee+`;
#else
uniform `+ge+" "+_e+" u_"+Ee+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = a_"+Ee+`;
#else
    `+ge+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+Ee+" = unpack_mix_"+$e+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ge+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
uniform lowp float u_`+Ee+`_t;
attribute `+ge+" "+qe+" a_"+Ee+`;
#else
uniform `+ge+" "+_e+" u_"+Ee+`;
#endif
`:$e==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+_e+" "+Ee+" = a_"+Ee+`;
#else
    `+ge+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ee+`
    `+ge+" "+_e+" "+Ee+" = unpack_mix_"+$e+"(a_"+Ee+", u_"+Ee+`_t);
#else
    `+ge+" "+_e+" "+Ee+" = u_"+Ee+`;
#endif
`}),staticAttributes:y,staticUniforms:M}}var ld=Object.freeze({__proto__:null,prelude:nc,background:Ui,backgroundPattern:zu,circle:Uu,clippingMask:Rc,heatmap:Ah,heatmapTexture:Th,collisionBox:Ch,collisionCircle:cp,debug:Lf,fill:wh,fillOutline:Eu,fillOutlinePattern:eu,fillPattern:cr,fillExtrusion:hn,fillExtrusionPattern:ic,hillshadePrepare:Pl,hillshade:tu,line:Il,lineGradient:cu,linePattern:cl,lineSDF:ru,raster:fl,symbolIcon:Dl,symbolSDF:fp,symbolTextAndIcon:hp}),Nf=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Oh(m){for(var d=[],h=0;h<m.length;h++)if(m[h]!==null){var y=m[h].split(" ");d.push(y.pop())}return d}Nf.prototype.bind=function(m,d,h,y,S,O,M,F){this.context=m;for(var X=this.boundPaintVertexBuffers.length!==y.length,ee=0;!X&&ee<y.length;ee++)this.boundPaintVertexBuffers[ee]!==y[ee]&&(X=!0);m.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===h&&!X&&this.boundIndexBuffer===S&&this.boundVertexOffset===O&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===F?(m.bindVertexArrayOES.set(this.vao),M&&M.bind(),S&&S.dynamicDraw&&S.bind(),F&&F.bind()):this.freshBind(d,h,y,S,O,M,F)},Nf.prototype.freshBind=function(m,d,h,y,S,O,M){var F,X=m.numAttributes,ee=this.context,ge=ee.gl;if(ee.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ee.extVertexArrayObject.createVertexArrayOES(),ee.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=m,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=y,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=O,this.boundDynamicVertexBuffer2=M;else{F=ee.currentNumAttributes||0;for(var _e=X;_e<F;_e++)ge.disableVertexAttribArray(_e)}d.enableAttributes(ge,m);for(var Ee=0,qe=h;Ee<qe.length;Ee+=1)qe[Ee].enableAttributes(ge,m);O&&O.enableAttributes(ge,m),M&&M.enableAttributes(ge,m),d.bind(),d.setVertexAttribPointers(ge,m,S);for(var $e=0,dt=h;$e<dt.length;$e+=1){var Ye=dt[$e];Ye.bind(),Ye.setVertexAttribPointers(ge,m,S)}O&&(O.bind(),O.setVertexAttribPointers(ge,m,S)),y&&y.bind(),M&&(M.bind(),M.setVertexAttribPointers(ge,m,S)),ee.currentNumAttributes=X},Nf.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var co=function(d,h,y,S,O,M){var F=d.gl;this.program=F.createProgram();for(var X=Oh(y.staticAttributes),ee=S?S.getBinderAttributes():[],ge=X.concat(ee),_e=y.staticUniforms?Oh(y.staticUniforms):[],Ee=S?S.getBinderUniforms():[],qe=[],$e=0,dt=_e.concat(Ee);$e<dt.length;$e+=1){var Ye=dt[$e];qe.indexOf(Ye)<0&&qe.push(Ye)}var ot=S?S.defines():[];M&&ot.push("#define OVERDRAW_INSPECTOR;");var Mt=ot.concat(nc.fragmentSource,y.fragmentSource).join(`
`),Pt=ot.concat(nc.vertexSource,y.vertexSource).join(`
`),dr=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(dr,Mt),F.compileShader(dr),F.attachShader(this.program,dr);var Jt=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())this.failedToCreate=!0;else{F.shaderSource(Jt,Pt),F.compileShader(Jt),F.attachShader(this.program,Jt),this.attributes={};var br={};this.numAttributes=ge.length;for(var Er=0;Er<this.numAttributes;Er++)ge[Er]&&(F.bindAttribLocation(this.program,Er,ge[Er]),this.attributes[ge[Er]]=Er);F.linkProgram(this.program),F.deleteShader(Jt),F.deleteShader(dr);for(var en=0;en<qe.length;en++){var Xr=qe[en];if(Xr&&!br[Xr]){var gn=F.getUniformLocation(this.program,Xr);gn&&(br[Xr]=gn)}}this.fixedUniforms=O(d,br),this.binderUniforms=S?S.getUniforms(d,br):[]}}};function Rh(m,d,h){var y=1/ca(h,1,d.transform.tileZoom),S=Math.pow(2,h.tileID.overscaledZ),O=h.tileSize*Math.pow(2,d.transform.tileZoom)/S,M=O*(h.tileID.canonical.x+h.tileID.wrap*S),F=O*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[M>>16,F>>16],u_pixel_coord_lower:[65535&M,65535&F]}}co.prototype.draw=function(m,d,h,y,S,O,M,F,X,ee,ge,_e,Ee,qe,$e,dt){var Ye,ot=m.gl;if(!this.failedToCreate){for(var Mt in m.program.set(this.program),m.setDepthMode(h),m.setStencilMode(y),m.setColorMode(S),m.setCullFace(O),this.fixedUniforms)this.fixedUniforms[Mt].set(M[Mt]);qe&&qe.setUniforms(m,this.binderUniforms,_e,{zoom:Ee});for(var Pt=(Ye={},Ye[ot.LINES]=2,Ye[ot.TRIANGLES]=3,Ye[ot.LINE_STRIP]=1,Ye)[d],dr=0,Jt=ge.get();dr<Jt.length;dr+=1){var br=Jt[dr],Er=br.vaos||(br.vaos={});(Er[F]||(Er[F]=new Nf)).bind(m,this,X,qe?qe.getPaintVertexBuffers():[],ee,br.vertexOffset,$e,dt),ot.drawElements(d,br.primitiveLength*Pt,ot.UNSIGNED_SHORT,br.primitiveOffset*Pt*2)}}};var pp=function(d,h,y,S){var O=h.style.light,M=O.properties.get("position"),F=[M.x,M.y,M.z],X=v.create$1();O.properties.get("anchor")==="viewport"&&v.fromRotation(X,-h.transform.angle),v.transformMat3(F,F,X);var ee=O.properties.get("color");return{u_matrix:d,u_lightpos:F,u_lightintensity:O.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+y,u_opacity:S}},Ls=function(d,h,y,S,O,M,F){return v.extend(pp(d,h,y,S),Rh(M,h,F),{u_height_factor:-Math.pow(2,O.overscaledZ)/F.tileSize/8})},hl=function(d){return{u_matrix:d}},Vu=function(d,h,y,S){return v.extend(hl(d),Rh(y,h,S))},kl=function(d,h){return{u_matrix:d,u_world:h}},jf=function(d,h,y,S,O){return v.extend(Vu(d,h,y,S),{u_world:O})},Mc=function(d,h,y,S){var O,M,F=d.transform;if(S.paint.get("circle-pitch-alignment")==="map"){var X=ca(y,1,F.zoom);O=!0,M=[X,X]}else O=!1,M=F.pixelsToGLUnits;return{u_camera_to_center_distance:F.cameraToCenterDistance,u_scale_with_map:+(S.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(h.posMatrix,y,S.paint.get("circle-translate"),S.paint.get("circle-translate-anchor")),u_pitch_with_map:+O,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:M}},Su=function(d,h,y){var S=ca(y,1,h.zoom),O=Math.pow(2,h.zoom-y.tileID.overscaledZ),M=y.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:h.cameraToCenterDistance,u_pixels_to_tile_units:S,u_extrude_scale:[h.pixelsToGLUnits[0]/(S*O),h.pixelsToGLUnits[1]/(S*O)],u_overscale_factor:M}},of=function(d,h,y){return{u_matrix:d,u_inv_matrix:h,u_camera_to_center_distance:y.cameraToCenterDistance,u_viewport_size:[y.width,y.height]}},Fl=function(d,h,y){return y===void 0&&(y=1),{u_matrix:d,u_color:h,u_overlay:0,u_overlay_scale:y}},pl=function(d){return{u_matrix:d}},Mh=function(d,h,y,S){return{u_matrix:d,u_extrude_scale:ca(h,1,y),u_intensity:S}},sf=function(d,h,y){var S=d.transform;return{u_matrix:uf(d,h,y),u_ratio:1/ca(h,1,S.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},Fa=function(d,h,y,S){return v.extend(sf(d,h,y),{u_image:0,u_image_height:S})},zf=function(d,h,y,S){var O=d.transform,M=Bl(h,O);return{u_matrix:uf(d,h,y),u_texsize:h.imageAtlasTexture.size,u_ratio:1/ca(h,1,O.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[M,S.fromScale,S.toScale],u_fade:S.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]]}},cd=function(d,h,y,S,O){var M=d.lineAtlas,F=Bl(h,d.transform),X=y.layout.get("line-cap")==="round",ee=M.getDash(S.from,X),ge=M.getDash(S.to,X),_e=ee.width*O.fromScale,Ee=ge.width*O.toScale;return v.extend(sf(d,h,y),{u_patternscale_a:[F/_e,-ee.height/2],u_patternscale_b:[F/Ee,-ge.height/2],u_sdfgamma:M.width/(256*Math.min(_e,Ee)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:ee.y,u_tex_y_b:ge.y,u_mix:O.t})};function Bl(m,d){return 1/ca(m,1,d.tileZoom)}function uf(m,d,h){return m.translatePosMatrix(d.tileID.posMatrix,d,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}var Ph=function(d,h,y,S,O){return{u_matrix:d,u_tl_parent:h,u_scale_parent:y,u_buffer_scale:1,u_fade_t:S.mix,u_opacity:S.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:(F=O.paint.get("raster-saturation"),F>0?1-1/(1.001-F):-F),u_contrast_factor:(M=O.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Uf(O.paint.get("raster-hue-rotate"))};var M,F};function Uf(m){m*=Math.PI/180;var d=Math.sin(m),h=Math.cos(m);return[(2*h+1)/3,(-Math.sqrt(3)*d-h+1)/3,(Math.sqrt(3)*d-h+1)/3]}var dl,Ll=function(d,h,y,S,O,M,F,X,ee,ge){var _e=O.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:h?h.uSizeT:0,u_size:h?h.uSize:0,u_camera_to_center_distance:_e.cameraToCenterDistance,u_pitch:_e.pitch/360*2*Math.PI,u_rotate_symbol:+y,u_aspect_ratio:_e.width/_e.height,u_fade_change:O.options.fadeDuration?O.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:F,u_coord_matrix:X,u_is_text:+ee,u_pitch_with_map:+S,u_texsize:ge,u_texture:0}},ac=function(d,h,y,S,O,M,F,X,ee,ge,_e){var Ee=O.transform;return v.extend(Ll(d,h,y,S,O,M,F,X,ee,ge),{u_gamma_scale:S?Math.cos(Ee._pitch)*Ee.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+_e})},Pc=function(d,h,y,S,O,M,F,X,ee,ge){return v.extend(ac(d,h,y,S,O,M,F,X,!0,ee,!0),{u_texsize_icon:ge,u_texture_icon:1})},oc=function(d,h,y){return{u_matrix:d,u_opacity:h,u_color:y}},fi=function(d,h,y,S,O,M){return v.extend(function(F,X,ee,ge){var _e=ee.imageManager.getPattern(F.from.toString()),Ee=ee.imageManager.getPattern(F.to.toString()),qe=ee.imageManager.getPixelSize(),$e=qe.width,dt=qe.height,Ye=Math.pow(2,ge.tileID.overscaledZ),ot=ge.tileSize*Math.pow(2,ee.transform.tileZoom)/Ye,Mt=ot*(ge.tileID.canonical.x+ge.tileID.wrap*Ye),Pt=ot*ge.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:_e.tl,u_pattern_br_a:_e.br,u_pattern_tl_b:Ee.tl,u_pattern_br_b:Ee.br,u_texsize:[$e,dt],u_mix:X.t,u_pattern_size_a:_e.displaySize,u_pattern_size_b:Ee.displaySize,u_scale_a:X.fromScale,u_scale_b:X.toScale,u_tile_units_to_pixels:1/ca(ge,1,ee.transform.tileZoom),u_pixel_coord_upper:[Mt>>16,Pt>>16],u_pixel_coord_lower:[65535&Mt,65535&Pt]}}(S,M,y,O),{u_matrix:d,u_opacity:h})},Ih={fillExtrusion:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_lightpos:new v.Uniform3f(d,h.u_lightpos),u_lightintensity:new v.Uniform1f(d,h.u_lightintensity),u_lightcolor:new v.Uniform3f(d,h.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,h.u_vertical_gradient),u_opacity:new v.Uniform1f(d,h.u_opacity)}},fillExtrusionPattern:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_lightpos:new v.Uniform3f(d,h.u_lightpos),u_lightintensity:new v.Uniform1f(d,h.u_lightintensity),u_lightcolor:new v.Uniform3f(d,h.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,h.u_vertical_gradient),u_height_factor:new v.Uniform1f(d,h.u_height_factor),u_image:new v.Uniform1i(d,h.u_image),u_texsize:new v.Uniform2f(d,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,h.u_scale),u_fade:new v.Uniform1f(d,h.u_fade),u_opacity:new v.Uniform1f(d,h.u_opacity)}},fill:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix)}},fillPattern:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_image:new v.Uniform1i(d,h.u_image),u_texsize:new v.Uniform2f(d,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,h.u_scale),u_fade:new v.Uniform1f(d,h.u_fade)}},fillOutline:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_world:new v.Uniform2f(d,h.u_world)}},fillOutlinePattern:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_world:new v.Uniform2f(d,h.u_world),u_image:new v.Uniform1i(d,h.u_image),u_texsize:new v.Uniform2f(d,h.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,h.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,h.u_scale),u_fade:new v.Uniform1f(d,h.u_fade)}},circle:function(d,h){return{u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(d,h.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(d,h.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(d,h.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(d,h.u_matrix)}},collisionBox:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(d,h.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(d,h.u_extrude_scale),u_overscale_factor:new v.Uniform1f(d,h.u_overscale_factor)}},collisionCircle:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_inv_matrix:new v.UniformMatrix4f(d,h.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(d,h.u_viewport_size)}},debug:function(d,h){return{u_color:new v.UniformColor(d,h.u_color),u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_overlay:new v.Uniform1i(d,h.u_overlay),u_overlay_scale:new v.Uniform1f(d,h.u_overlay_scale)}},clippingMask:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix)}},heatmap:function(d,h){return{u_extrude_scale:new v.Uniform1f(d,h.u_extrude_scale),u_intensity:new v.Uniform1f(d,h.u_intensity),u_matrix:new v.UniformMatrix4f(d,h.u_matrix)}},heatmapTexture:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_world:new v.Uniform2f(d,h.u_world),u_image:new v.Uniform1i(d,h.u_image),u_color_ramp:new v.Uniform1i(d,h.u_color_ramp),u_opacity:new v.Uniform1f(d,h.u_opacity)}},hillshade:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_image:new v.Uniform1i(d,h.u_image),u_latrange:new v.Uniform2f(d,h.u_latrange),u_light:new v.Uniform2f(d,h.u_light),u_shadow:new v.UniformColor(d,h.u_shadow),u_highlight:new v.UniformColor(d,h.u_highlight),u_accent:new v.UniformColor(d,h.u_accent)}},hillshadePrepare:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_image:new v.Uniform1i(d,h.u_image),u_dimension:new v.Uniform2f(d,h.u_dimension),u_zoom:new v.Uniform1f(d,h.u_zoom),u_unpack:new v.Uniform4f(d,h.u_unpack)}},line:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_ratio:new v.Uniform1f(d,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,h.u_units_to_pixels)}},lineGradient:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_ratio:new v.Uniform1f(d,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,h.u_units_to_pixels),u_image:new v.Uniform1i(d,h.u_image),u_image_height:new v.Uniform1f(d,h.u_image_height)}},linePattern:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_texsize:new v.Uniform2f(d,h.u_texsize),u_ratio:new v.Uniform1f(d,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_image:new v.Uniform1i(d,h.u_image),u_units_to_pixels:new v.Uniform2f(d,h.u_units_to_pixels),u_scale:new v.Uniform3f(d,h.u_scale),u_fade:new v.Uniform1f(d,h.u_fade)}},lineSDF:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_ratio:new v.Uniform1f(d,h.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,h.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(d,h.u_patternscale_a),u_patternscale_b:new v.Uniform2f(d,h.u_patternscale_b),u_sdfgamma:new v.Uniform1f(d,h.u_sdfgamma),u_image:new v.Uniform1i(d,h.u_image),u_tex_y_a:new v.Uniform1f(d,h.u_tex_y_a),u_tex_y_b:new v.Uniform1f(d,h.u_tex_y_b),u_mix:new v.Uniform1f(d,h.u_mix)}},raster:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_tl_parent:new v.Uniform2f(d,h.u_tl_parent),u_scale_parent:new v.Uniform1f(d,h.u_scale_parent),u_buffer_scale:new v.Uniform1f(d,h.u_buffer_scale),u_fade_t:new v.Uniform1f(d,h.u_fade_t),u_opacity:new v.Uniform1f(d,h.u_opacity),u_image0:new v.Uniform1i(d,h.u_image0),u_image1:new v.Uniform1i(d,h.u_image1),u_brightness_low:new v.Uniform1f(d,h.u_brightness_low),u_brightness_high:new v.Uniform1f(d,h.u_brightness_high),u_saturation_factor:new v.Uniform1f(d,h.u_saturation_factor),u_contrast_factor:new v.Uniform1f(d,h.u_contrast_factor),u_spin_weights:new v.Uniform3f(d,h.u_spin_weights)}},symbolIcon:function(d,h){return{u_is_size_zoom_constant:new v.Uniform1i(d,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,h.u_size_t),u_size:new v.Uniform1f(d,h.u_size),u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,h.u_pitch),u_rotate_symbol:new v.Uniform1i(d,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,h.u_fade_change),u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,h.u_coord_matrix),u_is_text:new v.Uniform1i(d,h.u_is_text),u_pitch_with_map:new v.Uniform1i(d,h.u_pitch_with_map),u_texsize:new v.Uniform2f(d,h.u_texsize),u_texture:new v.Uniform1i(d,h.u_texture)}},symbolSDF:function(d,h){return{u_is_size_zoom_constant:new v.Uniform1i(d,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,h.u_size_t),u_size:new v.Uniform1f(d,h.u_size),u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,h.u_pitch),u_rotate_symbol:new v.Uniform1i(d,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,h.u_fade_change),u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,h.u_coord_matrix),u_is_text:new v.Uniform1i(d,h.u_is_text),u_pitch_with_map:new v.Uniform1i(d,h.u_pitch_with_map),u_texsize:new v.Uniform2f(d,h.u_texsize),u_texture:new v.Uniform1i(d,h.u_texture),u_gamma_scale:new v.Uniform1f(d,h.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,h.u_is_halo)}},symbolTextAndIcon:function(d,h){return{u_is_size_zoom_constant:new v.Uniform1i(d,h.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,h.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,h.u_size_t),u_size:new v.Uniform1f(d,h.u_size),u_camera_to_center_distance:new v.Uniform1f(d,h.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,h.u_pitch),u_rotate_symbol:new v.Uniform1i(d,h.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,h.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,h.u_fade_change),u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,h.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,h.u_coord_matrix),u_is_text:new v.Uniform1i(d,h.u_is_text),u_pitch_with_map:new v.Uniform1i(d,h.u_pitch_with_map),u_texsize:new v.Uniform2f(d,h.u_texsize),u_texsize_icon:new v.Uniform2f(d,h.u_texsize_icon),u_texture:new v.Uniform1i(d,h.u_texture),u_texture_icon:new v.Uniform1i(d,h.u_texture_icon),u_gamma_scale:new v.Uniform1f(d,h.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,h.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,h.u_is_halo)}},background:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_opacity:new v.Uniform1f(d,h.u_opacity),u_color:new v.UniformColor(d,h.u_color)}},backgroundPattern:function(d,h){return{u_matrix:new v.UniformMatrix4f(d,h.u_matrix),u_opacity:new v.Uniform1f(d,h.u_opacity),u_image:new v.Uniform1i(d,h.u_image),u_pattern_tl_a:new v.Uniform2f(d,h.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(d,h.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(d,h.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(d,h.u_pattern_br_b),u_texsize:new v.Uniform2f(d,h.u_texsize),u_mix:new v.Uniform1f(d,h.u_mix),u_pattern_size_a:new v.Uniform2f(d,h.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(d,h.u_pattern_size_b),u_scale_a:new v.Uniform1f(d,h.u_scale_a),u_scale_b:new v.Uniform1f(d,h.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(d,h.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,h.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(d,h.u_tile_units_to_pixels)}}};function sc(m,d,h,y,S,O,M){for(var F=m.context,X=F.gl,ee=m.useProgram("collisionBox"),ge=[],_e=0,Ee=0,qe=0;qe<y.length;qe++){var $e=y[qe],dt=d.getTile($e),Ye=dt.getBucket(h);if(Ye){var ot=$e.posMatrix;S[0]===0&&S[1]===0||(ot=m.translatePosMatrix($e.posMatrix,dt,S,O));var Mt=M?Ye.textCollisionBox:Ye.iconCollisionBox,Pt=Ye.collisionCircleArray;if(Pt.length>0){var dr=v.create(),Jt=ot;v.mul(dr,Ye.placementInvProjMatrix,m.transform.glCoordMatrix),v.mul(dr,dr,Ye.placementViewportMatrix),ge.push({circleArray:Pt,circleOffset:Ee,transform:Jt,invTransform:dr}),Ee=_e+=Pt.length/4}Mt&&ee.draw(F,X.LINES,we.disabled,ze.disabled,m.colorModeForRenderPass(),Tt.disabled,Su(ot,m.transform,dt),h.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,m.transform.zoom,null,null,Mt.collisionVertexBuffer)}}if(M&&ge.length){var br=m.useProgram("collisionCircle"),Er=new v.StructArrayLayout2f1f2i16;Er.resize(4*_e),Er._trim();for(var en=0,Xr=0,gn=ge;Xr<gn.length;Xr+=1)for(var In=gn[Xr],Vn=0;Vn<In.circleArray.length/4;Vn++){var oi=4*Vn,Di=In.circleArray[oi+0],Ji=In.circleArray[oi+1],Tn=In.circleArray[oi+2],Ei=In.circleArray[oi+3];Er.emplace(en++,Di,Ji,Tn,Ei,0),Er.emplace(en++,Di,Ji,Tn,Ei,1),Er.emplace(en++,Di,Ji,Tn,Ei,2),Er.emplace(en++,Di,Ji,Tn,Ei,3)}(!dl||dl.length<2*_e)&&(dl=function(za){var Aa=2*za,No=new v.StructArrayLayout3ui6;No.resize(Aa),No._trim();for(var $a=0;$a<Aa;$a++){var Ya=6*$a;No.uint16[Ya+0]=4*$a+0,No.uint16[Ya+1]=4*$a+1,No.uint16[Ya+2]=4*$a+2,No.uint16[Ya+3]=4*$a+2,No.uint16[Ya+4]=4*$a+3,No.uint16[Ya+5]=4*$a+0}return No}(_e));for(var vi=F.createIndexBuffer(dl,!0),Hn=F.createVertexBuffer(Er,v.collisionCircleLayout.members,!0),Ci=0,ti=ge;Ci<ti.length;Ci+=1){var _i=ti[Ci],Yi=of(_i.transform,_i.invTransform,m.transform);br.draw(F,X.TRIANGLES,we.disabled,ze.disabled,m.colorModeForRenderPass(),Tt.disabled,Yi,h.id,Hn,vi,v.SegmentVector.simpleSegment(0,2*_i.circleOffset,_i.circleArray.length,_i.circleArray.length/2),null,m.transform.zoom,null,null,null)}Hn.destroy(),vi.destroy()}}var Ws=v.identity(new Float32Array(16));function lf(m,d,h,y,S,O){var M=v.getAnchorAlignment(m),F=-(M.horizontalAlign-.5)*d,X=-(M.verticalAlign-.5)*h,ee=v.evaluateVariableOffset(m,y);return new v.Point((F/S+ee[0])*O,(X/S+ee[1])*O)}function Dh(m,d,h,y,S,O,M,F,X,ee,ge){var _e=m.text.placedSymbolArray,Ee=m.text.dynamicLayoutVertexArray,qe=m.icon.dynamicLayoutVertexArray,$e={};Ee.clear();for(var dt=0;dt<_e.length;dt++){var Ye=_e.get(dt),ot=Ye.hidden||!Ye.crossTileID||m.allowVerticalPlacement&&!Ye.placedOrientation?null:y[Ye.crossTileID];if(ot){var Mt=new v.Point(Ye.anchorX,Ye.anchorY),Pt=Ni(Mt,h?F:M),dr=di(O.cameraToCenterDistance,Pt.signedDistanceFromCamera),Jt=S.evaluateSizeForFeature(m.textSizeData,ee,Ye)*dr/v.ONE_EM;h&&(Jt*=m.tilePixelRatio/X);for(var br=lf(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale,Jt),Er=h?Ni(Mt.add(br),M).point:Pt.point.add(d?br.rotate(-O.angle):br),en=m.allowVerticalPlacement&&Ye.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Xr=0;Xr<Ye.numGlyphs;Xr++)v.addDynamicAttributes(Ee,Er,en);ge&&Ye.associatedIconIndex>=0&&($e[Ye.associatedIconIndex]={shiftedAnchor:Er,angle:en})}else Ro(Ye.numGlyphs,Ee)}if(ge){qe.clear();for(var gn=m.icon.placedSymbolArray,In=0;In<gn.length;In++){var Vn=gn.get(In);if(Vn.hidden)Ro(Vn.numGlyphs,qe);else{var oi=$e[In];if(oi)for(var Di=0;Di<Vn.numGlyphs;Di++)v.addDynamicAttributes(qe,oi.shiftedAnchor,oi.angle);else Ro(Vn.numGlyphs,qe)}}m.icon.dynamicLayoutVertexBuffer.updateData(qe)}m.text.dynamicLayoutVertexBuffer.updateData(Ee)}function kh(m,d,h){return h.iconsInText&&d?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Nl(m,d,h,y,S,O,M,F,X,ee,ge,_e){for(var Ee=m.context,qe=Ee.gl,$e=m.transform,dt=F==="map",Ye=X==="map",ot=dt&&h.layout.get("symbol-placement")!=="point",Mt=dt&&!Ye&&!ot,Pt=h.layout.get("symbol-sort-key").constantOr(1)!==void 0,dr=!1,Jt=m.depthModeForSublayer(0,we.ReadOnly),br=h.layout.get("text-variable-anchor"),Er=[],en=0,Xr=y;en<Xr.length;en+=1){var gn=Xr[en],In=d.getTile(gn),Vn=In.getBucket(h);if(Vn){var oi=S?Vn.text:Vn.icon;if(oi&&oi.segments.get().length){var Di=oi.programConfigurations.get(h.id),Ji=S||Vn.sdfIcons,Tn=S?Vn.textSizeData:Vn.iconSizeData,Ei=Ye||$e.pitch!==0,vi=m.useProgram(kh(Ji,S,Vn),Di),Hn=v.evaluateSizeForZoom(Tn,$e.zoom),Ci=void 0,ti=[0,0],_i=void 0,Yi=void 0,za=null,Aa=void 0;if(S)_i=In.glyphAtlasTexture,Yi=qe.LINEAR,Ci=In.glyphAtlasTexture.size,Vn.iconsInText&&(ti=In.imageAtlasTexture.size,za=In.imageAtlasTexture,Aa=Ei||m.options.rotating||m.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?qe.LINEAR:qe.NEAREST);else{var No=h.layout.get("icon-size").constantOr(0)!==1||Vn.iconsNeedLinear;_i=In.imageAtlasTexture,Yi=Ji||m.options.rotating||m.options.zooming||No||Ei?qe.LINEAR:qe.NEAREST,Ci=In.imageAtlasTexture.size}var $a=ca(In,1,m.transform.zoom),Ya=ja(gn.posMatrix,Ye,dt,m.transform,$a),Ks=Wi(gn.posMatrix,Ye,dt,m.transform,$a),jo=br&&Vn.hasTextData(),Yu=h.layout.get("icon-text-fit")!=="none"&&jo&&Vn.hasIconData();ot&&Bs(Vn,gn.posMatrix,m,S,Ya,Ks,Ye,ee);var Ku=m.translatePosMatrix(gn.posMatrix,In,O,M),_s=ot||S&&br||Yu?Ws:Ya,bs=m.translatePosMatrix(Ks,In,O,M,!0),fc=Ji&&h.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,xf={program:vi,buffers:oi,uniformValues:Ji?Vn.iconsInText?Pc(Tn.kind,Hn,Mt,Ye,m,Ku,_s,bs,Ci,ti):ac(Tn.kind,Hn,Mt,Ye,m,Ku,_s,bs,S,Ci,!0):Ll(Tn.kind,Hn,Mt,Ye,m,Ku,_s,bs,S,Ci),atlasTexture:_i,atlasTextureIcon:za,atlasInterpolation:Yi,atlasInterpolationIcon:Aa,isSDF:Ji,hasHalo:fc};if(Pt&&Vn.canOverlap){dr=!0;for(var du=0,Gl=oi.segments.get();du<Gl.length;du+=1){var vu=Gl[du];Er.push({segments:new v.SegmentVector([vu]),sortKey:vu.sortKey,state:xf})}}else Er.push({segments:oi.segments,sortKey:0,state:xf})}}}dr&&Er.sort(function(bl,iu){return bl.sortKey-iu.sortKey});for(var mu=0,_l=Er;mu<_l.length;mu+=1){var ls=_l[mu],so=ls.state;if(Ee.activeTexture.set(qe.TEXTURE0),so.atlasTexture.bind(so.atlasInterpolation,qe.CLAMP_TO_EDGE),so.atlasTextureIcon&&(Ee.activeTexture.set(qe.TEXTURE1),so.atlasTextureIcon&&so.atlasTextureIcon.bind(so.atlasInterpolationIcon,qe.CLAMP_TO_EDGE)),so.isSDF){var cs=so.uniformValues;so.hasHalo&&(cs.u_is_halo=1,Hu(so.buffers,ls.segments,h,m,so.program,Jt,ge,_e,cs)),cs.u_is_halo=0}Hu(so.buffers,ls.segments,h,m,so.program,Jt,ge,_e,so.uniformValues)}}function Hu(m,d,h,y,S,O,M,F,X){var ee=y.context;S.draw(ee,ee.gl.TRIANGLES,O,M,F,Tt.disabled,X,h.id,m.layoutVertexBuffer,m.indexBuffer,d,h.paint,y.transform.zoom,m.programConfigurations.get(h.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ic(m,d,h,y,S,O,M){var F,X,ee,ge,_e,Ee=m.context.gl,qe=h.paint.get("fill-pattern"),$e=qe&&qe.constantOr(1),dt=h.getCrossfadeParameters();M?(X=$e&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=Ee.LINES):(X=$e?"fillPattern":"fill",F=Ee.TRIANGLES);for(var Ye=0,ot=y;Ye<ot.length;Ye+=1){var Mt=ot[Ye],Pt=d.getTile(Mt);if(!$e||Pt.patternsLoaded()){var dr=Pt.getBucket(h);if(dr){var Jt=dr.programConfigurations.get(h.id),br=m.useProgram(X,Jt);$e&&(m.context.activeTexture.set(Ee.TEXTURE0),Pt.imageAtlasTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Jt.updatePaintBuffers(dt));var Er=qe.constantOr(null);if(Er&&Pt.imageAtlas){var en=Pt.imageAtlas,Xr=en.patternPositions[Er.to.toString()],gn=en.patternPositions[Er.from.toString()];Xr&&gn&&Jt.setConstantPatternPositions(Xr,gn)}var In=m.translatePosMatrix(Mt.posMatrix,Pt,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(M){ge=dr.indexBuffer2,_e=dr.segments2;var Vn=[Ee.drawingBufferWidth,Ee.drawingBufferHeight];ee=X==="fillOutlinePattern"&&$e?jf(In,m,dt,Pt,Vn):kl(In,Vn)}else ge=dr.indexBuffer,_e=dr.segments,ee=$e?Vu(In,m,dt,Pt):hl(In);br.draw(m.context,F,S,m.stencilModeForClipping(Mt),O,Tt.disabled,ee,h.id,dr.layoutVertexBuffer,ge,_e,h.paint,m.transform.zoom,Jt)}}}}function Dc(m,d,h,y,S,O,M){for(var F=m.context,X=F.gl,ee=h.paint.get("fill-extrusion-pattern"),ge=ee.constantOr(1),_e=h.getCrossfadeParameters(),Ee=h.paint.get("fill-extrusion-opacity"),qe=0,$e=y;qe<$e.length;qe+=1){var dt=$e[qe],Ye=d.getTile(dt),ot=Ye.getBucket(h);if(ot){var Mt=ot.programConfigurations.get(h.id),Pt=m.useProgram(ge?"fillExtrusionPattern":"fillExtrusion",Mt);ge&&(m.context.activeTexture.set(X.TEXTURE0),Ye.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Mt.updatePaintBuffers(_e));var dr=ee.constantOr(null);if(dr&&Ye.imageAtlas){var Jt=Ye.imageAtlas,br=Jt.patternPositions[dr.to.toString()],Er=Jt.patternPositions[dr.from.toString()];br&&Er&&Mt.setConstantPatternPositions(br,Er)}var en=m.translatePosMatrix(dt.posMatrix,Ye,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Xr=h.paint.get("fill-extrusion-vertical-gradient"),gn=ge?Ls(en,m,Xr,Ee,dt,_e,Ye):pp(en,m,Xr,Ee);Pt.draw(F,F.gl.TRIANGLES,S,O,M,Tt.backCCW,gn,h.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,h.paint,m.transform.zoom,Mt)}}}function Wu(m,d,h,y,S,O){var M=m.context,F=M.gl,X=d.fbo;if(X){var ee=m.useProgram("hillshade");M.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,X.colorAttachment.get());var ge=function(_e,Ee,qe){var $e=qe.paint.get("hillshade-shadow-color"),dt=qe.paint.get("hillshade-highlight-color"),Ye=qe.paint.get("hillshade-accent-color"),ot=qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(ot-=_e.transform.angle);var Mt,Pt,dr,Jt=!_e.options.moving;return{u_matrix:_e.transform.calculatePosMatrix(Ee.tileID.toUnwrapped(),Jt),u_image:0,u_latrange:(Mt=Ee.tileID,Pt=Math.pow(2,Mt.canonical.z),dr=Mt.canonical.y,[new v.MercatorCoordinate(0,dr/Pt).toLngLat().lat,new v.MercatorCoordinate(0,(dr+1)/Pt).toLngLat().lat]),u_light:[qe.paint.get("hillshade-exaggeration"),ot],u_shadow:$e,u_highlight:dt,u_accent:Ye}}(m,d,h);ee.draw(M,F.TRIANGLES,y,S,O,Tt.disabled,ge,h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}}function Vf(m,d,h,y,S,O){var M=m.context,F=M.gl,X=d.dem;if(X&&X.data){var ee=X.dim,ge=X.stride,_e=X.getPixels();if(M.activeTexture.set(F.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||m.getTileTexture(ge),d.demTexture){var Ee=d.demTexture;Ee.update(_e,{premultiply:!1}),Ee.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else d.demTexture=new v.Texture(M,_e,F.RGBA,{premultiply:!1}),d.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);M.activeTexture.set(F.TEXTURE0);var qe=d.fbo;if(!qe){var $e=new v.Texture(M,{width:ee,height:ee,data:null},F.RGBA);$e.bind(F.LINEAR,F.CLAMP_TO_EDGE),(qe=d.fbo=M.createFramebuffer(ee,ee,!0)).colorAttachment.set($e.texture)}M.bindFramebuffer.set(qe.framebuffer),M.viewport.set([0,0,ee,ee]),m.useProgram("hillshadePrepare").draw(M,F.TRIANGLES,y,S,O,Tt.disabled,function(dt,Ye){var ot=Ye.stride,Mt=v.create();return v.ortho(Mt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Mt,Mt,[0,-v.EXTENT,0]),{u_matrix:Mt,u_image:1,u_dimension:[ot,ot],u_zoom:dt.overscaledZ,u_unpack:Ye.getUnpackVector()}}(d.tileID,X),h.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function Hf(m,d,h,y,S){var O=y.paint.get("raster-fade-duration");if(O>0){var M=v.browser.now(),F=(M-m.timeAdded)/O,X=d?(M-d.timeAdded)/O:-1,ee=h.getSource(),ge=S.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),_e=!d||Math.abs(d.tileID.overscaledZ-ge)>Math.abs(m.tileID.overscaledZ-ge),Ee=_e&&m.refreshedUponExpiration?1:v.clamp(_e?F:1-X,0,1);return m.refreshedUponExpiration&&F>=1&&(m.refreshedUponExpiration=!1),d?{opacity:1,mix:1-Ee}:{opacity:Ee,mix:0}}return{opacity:1,mix:0}}var Fh=new v.Color(1,0,0,1),Wf=new v.Color(0,1,0,1),dp=new v.Color(0,0,1,1),Gf=new v.Color(1,0,1,1),Xf=new v.Color(0,1,1,1);function cf(m,d,h,y){vl(m,0,d+h/2,m.transform.width,h,y)}function Bh(m,d,h,y){vl(m,d-h/2,0,h,m.transform.height,y)}function vl(m,d,h,y,S,O){var M=m.context,F=M.gl;F.enable(F.SCISSOR_TEST),F.scissor(d*v.browser.devicePixelRatio,h*v.browser.devicePixelRatio,y*v.browser.devicePixelRatio,S*v.browser.devicePixelRatio),M.clear({color:O}),F.disable(F.SCISSOR_TEST)}function Lh(m,d,h){var y=m.context,S=y.gl,O=h.posMatrix,M=m.useProgram("debug"),F=we.disabled,X=ze.disabled,ee=m.colorModeForRenderPass();y.activeTexture.set(S.TEXTURE0),m.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),M.draw(y,S.LINE_STRIP,F,X,ee,Tt.disabled,Fl(O,v.Color.red),"$debug",m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);var ge=d.getTileByID(h.key).latestRawTileData,_e=Math.floor((ge&&ge.byteLength||0)/1024),Ee=d.getTile(h).tileSize,qe=512/Math.min(Ee,512)*(h.overscaledZ/m.transform.zoom)*.5,$e=h.canonical.toString();h.overscaledZ!==h.canonical.z&&($e+=" => "+h.overscaledZ),function(dt,Ye){dt.initDebugOverlayCanvas();var ot=dt.debugOverlayCanvas,Mt=dt.context.gl,Pt=dt.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,ot.width,ot.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(Ye,5,5),Pt.strokeText(Ye,5,5),dt.debugOverlayTexture.update(ot),dt.debugOverlayTexture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE)}(m,$e+" "+_e+"kb"),M.draw(y,S.TRIANGLES,F,X,mt.alphaBlended,Tt.disabled,Fl(O,v.Color.transparent,qe),"$debug",m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}var jl={symbol:function(d,h,y,S,O){if(d.renderPass==="translucent"){var M=ze.disabled,F=d.colorModeForRenderPass();y.layout.get("text-variable-anchor")&&function(X,ee,ge,_e,Ee,qe,$e){for(var dt=ee.transform,Ye=Ee==="map",ot=qe==="map",Mt=0,Pt=X;Mt<Pt.length;Mt+=1){var dr=Pt[Mt],Jt=_e.getTile(dr),br=Jt.getBucket(ge);if(br&&br.text&&br.text.segments.get().length){var Er=v.evaluateSizeForZoom(br.textSizeData,dt.zoom),en=ca(Jt,1,ee.transform.zoom),Xr=ja(dr.posMatrix,ot,Ye,ee.transform,en),gn=ge.layout.get("icon-text-fit")!=="none"&&br.hasIconData();if(Er){var In=Math.pow(2,dt.zoom-Jt.tileID.overscaledZ);Dh(br,Ye,ot,$e,v.symbolSize,dt,Xr,dr.posMatrix,In,Er,gn)}}}}(S,d,y,h,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),O),y.paint.get("icon-opacity").constantOr(1)!==0&&Nl(d,h,y,S,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),M,F),y.paint.get("text-opacity").constantOr(1)!==0&&Nl(d,h,y,S,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),M,F),h.map.showCollisionBoxes&&(sc(d,h,y,S,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),sc(d,h,y,S,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))}},circle:function(d,h,y,S){if(d.renderPass==="translucent"){var O=y.paint.get("circle-opacity"),M=y.paint.get("circle-stroke-width"),F=y.paint.get("circle-stroke-opacity"),X=y.layout.get("circle-sort-key").constantOr(1)!==void 0;if(O.constantOr(1)!==0||M.constantOr(1)!==0&&F.constantOr(1)!==0){for(var ee=d.context,ge=ee.gl,_e=d.depthModeForSublayer(0,we.ReadOnly),Ee=ze.disabled,qe=d.colorModeForRenderPass(),$e=[],dt=0;dt<S.length;dt++){var Ye=S[dt],ot=h.getTile(Ye),Mt=ot.getBucket(y);if(Mt){var Pt=Mt.programConfigurations.get(y.id),dr={programConfiguration:Pt,program:d.useProgram("circle",Pt),layoutVertexBuffer:Mt.layoutVertexBuffer,indexBuffer:Mt.indexBuffer,uniformValues:Mc(d,Ye,ot,y)};if(X)for(var Jt=0,br=Mt.segments.get();Jt<br.length;Jt+=1){var Er=br[Jt];$e.push({segments:new v.SegmentVector([Er]),sortKey:Er.sortKey,state:dr})}else $e.push({segments:Mt.segments,sortKey:0,state:dr})}}X&&$e.sort(function(Vn,oi){return Vn.sortKey-oi.sortKey});for(var en=0,Xr=$e;en<Xr.length;en+=1){var gn=Xr[en],In=gn.state;In.program.draw(ee,ge.TRIANGLES,_e,Ee,qe,Tt.disabled,In.uniformValues,y.id,In.layoutVertexBuffer,In.indexBuffer,gn.segments,y.paint,d.transform.zoom,In.programConfiguration)}}}},heatmap:function(d,h,y,S){if(y.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){var O=d.context,M=O.gl,F=ze.disabled,X=new mt([M.ONE,M.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function($e,dt,Ye){var ot=$e.gl;$e.activeTexture.set(ot.TEXTURE1),$e.viewport.set([0,0,dt.width/4,dt.height/4]);var Mt=Ye.heatmapFbo;if(Mt)ot.bindTexture(ot.TEXTURE_2D,Mt.colorAttachment.get()),$e.bindFramebuffer.set(Mt.framebuffer);else{var Pt=ot.createTexture();ot.bindTexture(ot.TEXTURE_2D,Pt),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_S,ot.CLAMP_TO_EDGE),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_WRAP_T,ot.CLAMP_TO_EDGE),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MIN_FILTER,ot.LINEAR),ot.texParameteri(ot.TEXTURE_2D,ot.TEXTURE_MAG_FILTER,ot.LINEAR),Mt=Ye.heatmapFbo=$e.createFramebuffer(dt.width/4,dt.height/4,!1),function(dr,Jt,br,Er){var en=dr.gl;en.texImage2D(en.TEXTURE_2D,0,en.RGBA,Jt.width/4,Jt.height/4,0,en.RGBA,dr.extRenderToTextureHalfFloat?dr.extTextureHalfFloat.HALF_FLOAT_OES:en.UNSIGNED_BYTE,null),Er.colorAttachment.set(br)}($e,dt,Pt,Mt)}})(O,d,y),O.clear({color:v.Color.transparent});for(var ee=0;ee<S.length;ee++){var ge=S[ee];if(!h.hasRenderableParent(ge)){var _e=h.getTile(ge),Ee=_e.getBucket(y);if(Ee){var qe=Ee.programConfigurations.get(y.id);d.useProgram("heatmap",qe).draw(O,M.TRIANGLES,we.disabled,F,X,Tt.disabled,Mh(ge.posMatrix,_e,d.transform.zoom,y.paint.get("heatmap-intensity")),y.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,y.paint,d.transform.zoom,qe)}}}O.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function($e,dt){var Ye=$e.context,ot=Ye.gl,Mt=dt.heatmapFbo;if(Mt){Ye.activeTexture.set(ot.TEXTURE0),ot.bindTexture(ot.TEXTURE_2D,Mt.colorAttachment.get()),Ye.activeTexture.set(ot.TEXTURE1);var Pt=dt.colorRampTexture;Pt||(Pt=dt.colorRampTexture=new v.Texture(Ye,dt.colorRamp,ot.RGBA)),Pt.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),$e.useProgram("heatmapTexture").draw(Ye,ot.TRIANGLES,we.disabled,ze.disabled,$e.colorModeForRenderPass(),Tt.disabled,function(dr,Jt,br,Er){var en=v.create();v.ortho(en,0,dr.width,dr.height,0,0,1);var Xr=dr.context.gl;return{u_matrix:en,u_world:[Xr.drawingBufferWidth,Xr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Jt.paint.get("heatmap-opacity")}}($e,dt),dt.id,$e.viewportBuffer,$e.quadTriangleIndexBuffer,$e.viewportSegments,dt.paint,$e.transform.zoom)}}(d,y))},line:function(d,h,y,S){if(d.renderPass==="translucent"){var O=y.paint.get("line-opacity"),M=y.paint.get("line-width");if(O.constantOr(1)!==0&&M.constantOr(1)!==0)for(var F=d.depthModeForSublayer(0,we.ReadOnly),X=d.colorModeForRenderPass(),ee=y.paint.get("line-dasharray"),ge=y.paint.get("line-pattern"),_e=ge.constantOr(1),Ee=y.paint.get("line-gradient"),qe=y.getCrossfadeParameters(),$e=_e?"linePattern":ee?"lineSDF":Ee?"lineGradient":"line",dt=d.context,Ye=dt.gl,ot=!0,Mt=0,Pt=S;Mt<Pt.length;Mt+=1){var dr=Pt[Mt],Jt=h.getTile(dr);if(!_e||Jt.patternsLoaded()){var br=Jt.getBucket(y);if(br){var Er=br.programConfigurations.get(y.id),en=d.context.program.get(),Xr=d.useProgram($e,Er),gn=ot||Xr.program!==en,In=ge.constantOr(null);if(In&&Jt.imageAtlas){var Vn=Jt.imageAtlas,oi=Vn.patternPositions[In.to.toString()],Di=Vn.patternPositions[In.from.toString()];oi&&Di&&Er.setConstantPatternPositions(oi,Di)}var Ji=_e?zf(d,Jt,y,qe):ee?cd(d,Jt,y,ee,qe):Ee?Fa(d,Jt,y,br.lineClipsArray.length):sf(d,Jt,y);if(_e)dt.activeTexture.set(Ye.TEXTURE0),Jt.imageAtlasTexture.bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),Er.updatePaintBuffers(qe);else if(ee&&(gn||d.lineAtlas.dirty))dt.activeTexture.set(Ye.TEXTURE0),d.lineAtlas.bind(dt);else if(Ee){var Tn=br.gradients[y.id],Ei=Tn.texture;if(y.gradientVersion!==Tn.version){var vi=256;if(y.stepInterpolant){var Hn=h.getSource().maxzoom,Ci=dr.canonical.z===Hn?Math.ceil(1<<d.transform.maxZoom-dr.canonical.z):1;vi=v.clamp(v.nextPowerOfTwo(br.maxLineLength/v.EXTENT*1024*Ci),256,dt.maxTextureSize)}Tn.gradient=v.renderColorRamp({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:vi,image:Tn.gradient||void 0,clips:br.lineClipsArray}),Tn.texture?Tn.texture.update(Tn.gradient):Tn.texture=new v.Texture(dt,Tn.gradient,Ye.RGBA),Tn.version=y.gradientVersion,Ei=Tn.texture}dt.activeTexture.set(Ye.TEXTURE0),Ei.bind(y.stepInterpolant?Ye.NEAREST:Ye.LINEAR,Ye.CLAMP_TO_EDGE)}Xr.draw(dt,Ye.TRIANGLES,F,d.stencilModeForClipping(dr),X,Tt.disabled,Ji,y.id,br.layoutVertexBuffer,br.indexBuffer,br.segments,y.paint,d.transform.zoom,Er,br.layoutVertexBuffer2),ot=!1}}}}},fill:function(d,h,y,S){var O=y.paint.get("fill-color"),M=y.paint.get("fill-opacity");if(M.constantOr(1)!==0){var F=d.colorModeForRenderPass(),X=y.paint.get("fill-pattern"),ee=d.opaquePassEnabledForLayer()&&!X.constantOr(1)&&O.constantOr(v.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===ee){var ge=d.depthModeForSublayer(1,d.renderPass==="opaque"?we.ReadWrite:we.ReadOnly);Ic(d,h,y,S,ge,F,!1)}if(d.renderPass==="translucent"&&y.paint.get("fill-antialias")){var _e=d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,we.ReadOnly);Ic(d,h,y,S,_e,F,!0)}}},"fill-extrusion":function(d,h,y,S){var O=y.paint.get("fill-extrusion-opacity");if(O!==0&&d.renderPass==="translucent"){var M=new we(d.context.gl.LEQUAL,we.ReadWrite,d.depthRangeFor3D);if(O!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))Dc(d,h,y,S,M,ze.disabled,mt.disabled),Dc(d,h,y,S,M,d.stencilModeFor3D(),d.colorModeForRenderPass());else{var F=d.colorModeForRenderPass();Dc(d,h,y,S,M,ze.disabled,F)}}},hillshade:function(d,h,y,S){if(d.renderPass==="offscreen"||d.renderPass==="translucent"){for(var O=d.context,M=d.depthModeForSublayer(0,we.ReadOnly),F=d.colorModeForRenderPass(),X=d.renderPass==="translucent"?d.stencilConfigForOverlap(S):[{},S],ee=X[0],ge=0,_e=X[1];ge<_e.length;ge+=1){var Ee=_e[ge],qe=h.getTile(Ee);qe.needsHillshadePrepare&&d.renderPass==="offscreen"?Vf(d,qe,y,M,ze.disabled,F):d.renderPass==="translucent"&&Wu(d,qe,y,M,ee[Ee.overscaledZ],F)}O.viewport.set([0,0,d.width,d.height])}},raster:function(d,h,y,S){if(d.renderPass==="translucent"&&y.paint.get("raster-opacity")!==0&&S.length)for(var O=d.context,M=O.gl,F=h.getSource(),X=d.useProgram("raster"),ee=d.colorModeForRenderPass(),ge=F instanceof At?[{},S]:d.stencilConfigForOverlap(S),_e=ge[0],Ee=ge[1],qe=Ee[Ee.length-1].overscaledZ,$e=!d.options.moving,dt=0,Ye=Ee;dt<Ye.length;dt+=1){var ot=Ye[dt],Mt=d.depthModeForSublayer(ot.overscaledZ-qe,y.paint.get("raster-opacity")===1?we.ReadWrite:we.ReadOnly,M.LESS),Pt=h.getTile(ot),dr=d.transform.calculatePosMatrix(ot.toUnwrapped(),$e);Pt.registerFadeDuration(y.paint.get("raster-fade-duration"));var Jt=h.findLoadedParent(ot,0),br=Hf(Pt,Jt,h,y,d.transform),Er=void 0,en=void 0,Xr=y.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;O.activeTexture.set(M.TEXTURE0),Pt.texture.bind(Xr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(M.TEXTURE1),Jt?(Jt.texture.bind(Xr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),Er=Math.pow(2,Jt.tileID.overscaledZ-Pt.tileID.overscaledZ),en=[Pt.tileID.canonical.x*Er%1,Pt.tileID.canonical.y*Er%1]):Pt.texture.bind(Xr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var gn=Ph(dr,en||[0,0],Er||1,br,y);F instanceof At?X.draw(O,M.TRIANGLES,Mt,ze.disabled,ee,Tt.disabled,gn,y.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments):X.draw(O,M.TRIANGLES,Mt,_e[ot.overscaledZ],ee,Tt.disabled,gn,y.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,h,y){var S=y.paint.get("background-color"),O=y.paint.get("background-opacity");if(O!==0){var M=d.context,F=M.gl,X=d.transform,ee=X.tileSize,ge=y.paint.get("background-pattern");if(!d.isPatternMissing(ge)){var _e=!ge&&S.a===1&&O===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass===_e){var Ee=ze.disabled,qe=d.depthModeForSublayer(0,_e==="opaque"?we.ReadWrite:we.ReadOnly),$e=d.colorModeForRenderPass(),dt=d.useProgram(ge?"backgroundPattern":"background"),Ye=X.coveringTiles({tileSize:ee});ge&&(M.activeTexture.set(F.TEXTURE0),d.imageManager.bind(d.context));for(var ot=y.getCrossfadeParameters(),Mt=0,Pt=Ye;Mt<Pt.length;Mt+=1){var dr=Pt[Mt],Jt=d.transform.calculatePosMatrix(dr.toUnwrapped()),br=ge?fi(Jt,O,d,ge,{tileID:dr,tileSize:ee},ot):oc(Jt,O,S);dt.draw(M,F.TRIANGLES,qe,Ee,$e,Tt.disabled,br,y.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}}}},debug:function(d,h,y){for(var S=0;S<y.length;S++)Lh(d,h,y[S])},custom:function(d,h,y){var S=d.context,O=y.implementation;if(d.renderPass==="offscreen"){var M=O.prerender;M&&(d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),M.call(O,S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),S.setColorMode(d.colorModeForRenderPass()),S.setStencilMode(ze.disabled);var F=O.renderingMode==="3d"?new we(d.context.gl.LEQUAL,we.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,we.ReadOnly);S.setDepthMode(F),O.render(S.gl,d.transform.customLayerMatrix()),S.setDirty(),d.setBaseState(),S.bindFramebuffer.set(null)}}},Ba=function(d,h){this.context=new xe(d),this.transform=h,this._tileTextures={},this.setup(),this.numSublayers=Qe.maxUnderzooming+Qe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ll,this.gpuTimers={}};Ba.prototype.resize=function(m,d){if(this.width=m*v.browser.devicePixelRatio,this.height=d*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var h=0,y=this.style._order;h<y.length;h+=1)this.style._layers[y[h]].resize()},Ba.prototype.setup=function(){var m=this.context,d=new v.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(v.EXTENT,0),d.emplaceBack(0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=m.createVertexBuffer(d,Xa.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var h=new v.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(v.EXTENT,0),h.emplaceBack(0,v.EXTENT),h.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=m.createVertexBuffer(h,Xa.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var y=new v.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(v.EXTENT,0,v.EXTENT,0),y.emplaceBack(0,v.EXTENT,0,v.EXTENT),y.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=m.createVertexBuffer(y,yt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var S=new v.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=m.createVertexBuffer(S,Xa.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var O=new v.StructArrayLayout1ui2;O.emplaceBack(0),O.emplaceBack(1),O.emplaceBack(3),O.emplaceBack(2),O.emplaceBack(0),this.tileBorderIndexBuffer=m.createIndexBuffer(O);var M=new v.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=m.createIndexBuffer(M),this.emptyTexture=new v.Texture(m,{width:1,height:1,data:new Uint8Array([0,0,0,0])},m.gl.RGBA);var F=this.context.gl;this.stencilClearMode=new ze({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO)},Ba.prototype.clearStencil=function(){var m=this.context,d=m.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var h=v.create();v.ortho(h,0,this.width,this.height,0,0,1),v.scale(h,h,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(m,d.TRIANGLES,we.disabled,this.stencilClearMode,mt.disabled,Tt.disabled,pl(h),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ba.prototype._renderTileClippingMasks=function(m,d){if(this.currentStencilSource!==m.source&&m.isTileClipped()&&d&&d.length){this.currentStencilSource=m.source;var h=this.context,y=h.gl;this.nextStencilID+d.length>256&&this.clearStencil(),h.setColorMode(mt.disabled),h.setDepthMode(we.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var O=0,M=d;O<M.length;O+=1){var F=M[O],X=this._tileClippingMaskIDs[F.key]=this.nextStencilID++;S.draw(h,y.TRIANGLES,we.disabled,new ze({func:y.ALWAYS,mask:0},X,255,y.KEEP,y.KEEP,y.REPLACE),mt.disabled,Tt.disabled,pl(F.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ba.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var m=this.nextStencilID++,d=this.context.gl;return new ze({func:d.NOTEQUAL,mask:255},m,255,d.KEEP,d.KEEP,d.REPLACE)},Ba.prototype.stencilModeForClipping=function(m){var d=this.context.gl;return new ze({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[m.key],0,d.KEEP,d.KEEP,d.REPLACE)},Ba.prototype.stencilConfigForOverlap=function(m){var d,h=this.context.gl,y=m.sort(function(X,ee){return ee.overscaledZ-X.overscaledZ}),S=y[y.length-1].overscaledZ,O=y[0].overscaledZ-S+1;if(O>1){this.currentStencilSource=void 0,this.nextStencilID+O>256&&this.clearStencil();for(var M={},F=0;F<O;F++)M[F+S]=new ze({func:h.GEQUAL,mask:255},F+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=O,[M,y]}return[(d={},d[S]=ze.disabled,d),y]},Ba.prototype.colorModeForRenderPass=function(){var m=this.context.gl;return this._showOverdrawInspector?new mt([m.CONSTANT_COLOR,m.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mt.unblended:mt.alphaBlended},Ba.prototype.depthModeForSublayer=function(m,d,h){if(!this.opaquePassEnabledForLayer())return we.disabled;var y=1-((1+this.currentLayer)*this.numSublayers+m)*this.depthEpsilon;return new we(h||this.context.gl.LEQUAL,d,[y,y])},Ba.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ba.prototype.render=function(m,d){var h=this;this.style=m,this.options=d,this.lineAtlas=m.lineAtlas,this.imageManager=m.imageManager,this.glyphManager=m.glyphManager,this.symbolFadeChange=m.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var y=this.style._order,S=this.style.sourceCaches;for(var O in S){var M=S[O];M.used&&M.prepare(this.context)}var F,X,ee={},ge={},_e={};for(var Ee in S){var qe=S[Ee];ee[Ee]=qe.getVisibleCoordinates(),ge[Ee]=ee[Ee].slice().reverse(),_e[Ee]=qe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var $e=0;$e<y.length;$e++)if(this.style._layers[y[$e]].is3D()){this.opaquePassCutoff=$e;break}this.renderPass="offscreen";for(var dt=0,Ye=y;dt<Ye.length;dt+=1){var ot=this.style._layers[Ye[dt]];if(ot.hasOffscreenPass()&&!ot.isHidden(this.transform.zoom)){var Mt=ge[ot.source];(ot.type==="custom"||Mt.length)&&this.renderLayer(this,S[ot.source],ot,Mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(m._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){var Pt=this.style._layers[y[this.currentLayer]],dr=S[Pt.source],Jt=ee[Pt.source];this._renderTileClippingMasks(Pt,Jt),this.renderLayer(this,dr,Pt,Jt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var br=this.style._layers[y[this.currentLayer]],Er=S[br.source],en=(br.type==="symbol"?_e:ge)[br.source];this._renderTileClippingMasks(br,ee[br.source]),this.renderLayer(this,Er,br,en)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Xr){Xr.source&&!Xr.isHidden(h.transform.zoom)&&(Xr.source!==(X&&X.id)&&(X=h.style.sourceCaches[Xr.source]),(!F||F.getSource().maxzoom<X.getSource().maxzoom)&&(F=X))}),F&&jl.debug(this,F,F.getVisibleCoordinates())),this.options.showPadding&&function(Xr){var gn=Xr.transform.padding;cf(Xr,Xr.transform.height-(gn.top||0),3,Fh),cf(Xr,gn.bottom||0,3,Wf),Bh(Xr,gn.left||0,3,dp),Bh(Xr,Xr.transform.width-(gn.right||0),3,Gf);var In=Xr.transform.centerPoint;(function(Vn,oi,Di,Ji){vl(Vn,oi-1,Di-10,2,20,Ji),vl(Vn,oi-10,Di-1,20,2,Ji)})(Xr,In.x,Xr.transform.height-In.y,Xf)}(this),this.context.setDefault()},Ba.prototype.renderLayer=function(m,d,h,y){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||y.length)&&(this.id=h.id,this.gpuTimingStart(h),jl[h.type](m,d,h,y,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ba.prototype.gpuTimingStart=function(m){if(this.options.gpuTiming){var d=this.context.extTimerQuery,h=this.gpuTimers[m.id];h||(h=this.gpuTimers[m.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),h.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,h.query)}},Ba.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var m=this.context.extTimerQuery;m.endQueryEXT(m.TIME_ELAPSED_EXT)}},Ba.prototype.collectGpuTimers=function(){var m=this.gpuTimers;return this.gpuTimers={},m},Ba.prototype.queryGpuTimers=function(m){var d={};for(var h in m){var y=m[h],S=this.context.extTimerQuery,O=S.getQueryObjectEXT(y.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(y.query),d[h]=O}return d},Ba.prototype.translatePosMatrix=function(m,d,h,y,S){if(!h[0]&&!h[1])return m;var O=S?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(O){var M=Math.sin(O),F=Math.cos(O);h=[h[0]*F-h[1]*M,h[0]*M+h[1]*F]}var X=[S?h[0]:ca(d,h[0],this.transform.zoom),S?h[1]:ca(d,h[1],this.transform.zoom),0],ee=new Float32Array(16);return v.translate(ee,m,X),ee},Ba.prototype.saveTileTexture=function(m){var d=this._tileTextures[m.size[0]];d?d.push(m):this._tileTextures[m.size[0]]=[m]},Ba.prototype.getTileTexture=function(m){var d=this._tileTextures[m];return d&&d.length>0?d.pop():null},Ba.prototype.isPatternMissing=function(m){if(!m)return!1;if(!m.from||!m.to)return!0;var d=this.imageManager.getPattern(m.from.toString()),h=this.imageManager.getPattern(m.to.toString());return!d||!h},Ba.prototype.useProgram=function(m,d){this.cache=this.cache||{};var h=""+m+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[h]||(this.cache[h]=new co(this.context,m,ld[m],d,Ih[m],this._showOverdrawInspector)),this.cache[h]},Ba.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ba.prototype.setBaseState=function(){var m=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(m.FUNC_ADD)},Ba.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ba.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Zf=function(d,h){this.points=d,this.planes=h};Zf.fromInvProjectionMatrix=function(m,d,h){var y=Math.pow(2,h),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return v.transformMat4([],M,m)}).map(function(M){return v.scale$1([],M,1/M[3]/d*y)}),O=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var F=v.sub([],S[M[0]],S[M[1]]),X=v.sub([],S[M[2]],S[M[1]]),ee=v.normalize([],v.cross([],F,X)),ge=-v.dot(ee,S[M[1]]);return ee.concat(ge)});return new Zf(S,O)};var Gu=function(d,h){this.min=d,this.max=h,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Gu.prototype.quadrant=function(m){for(var d=[m%2==0,m<2],h=v.clone$2(this.min),y=v.clone$2(this.max),S=0;S<d.length;S++)h[S]=d[S]?this.min[S]:this.center[S],y[S]=d[S]?this.center[S]:this.max[S];return y[2]=this.max[2],new Gu(h,y)},Gu.prototype.distanceX=function(m){return Math.max(Math.min(this.max[0],m[0]),this.min[0])-m[0]},Gu.prototype.distanceY=function(m){return Math.max(Math.min(this.max[1],m[1]),this.min[1])-m[1]},Gu.prototype.intersects=function(m){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],h=!0,y=0;y<m.planes.length;y++){for(var S=m.planes[y],O=0,M=0;M<d.length;M++)O+=v.dot$1(S,d[M])>=0;if(O===0)return 0;O!==d.length&&(h=!1)}if(h)return 2;for(var F=0;F<3;F++){for(var X=Number.MAX_VALUE,ee=-Number.MAX_VALUE,ge=0;ge<m.points.length;ge++){var _e=m.points[ge][F]-this.min[F];X=Math.min(X,_e),ee=Math.max(ee,_e)}if(ee<0||X>this.max[F]-this.min[F])return 0}return 1};var zl=function(d,h,y,S){if(d===void 0&&(d=0),h===void 0&&(h=0),y===void 0&&(y=0),S===void 0&&(S=0),isNaN(d)||d<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(S)||S<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=h,this.left=y,this.right=S};zl.prototype.interpolate=function(m,d,h){return d.top!=null&&m.top!=null&&(this.top=v.number(m.top,d.top,h)),d.bottom!=null&&m.bottom!=null&&(this.bottom=v.number(m.bottom,d.bottom,h)),d.left!=null&&m.left!=null&&(this.left=v.number(m.left,d.left,h)),d.right!=null&&m.right!=null&&(this.right=v.number(m.right,d.right,h)),this},zl.prototype.getCenter=function(m,d){var h=v.clamp((this.left+m-this.right)/2,0,m),y=v.clamp((this.top+d-this.bottom)/2,0,d);return new v.Point(h,y)},zl.prototype.equals=function(m){return this.top===m.top&&this.bottom===m.bottom&&this.left===m.left&&this.right===m.right},zl.prototype.clone=function(){return new zl(this.top,this.bottom,this.left,this.right)},zl.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Qi=function(d,h,y,S,O){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=O===void 0||O,this._minZoom=d||0,this._maxZoom=h||22,this._minPitch=y==null?0:y,this._maxPitch=S==null?60:S,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new zl,this._posMatrixCache={},this._alignedPosMatrixCache={}},La={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Qi.prototype.clone=function(){var m=new Qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return m.tileSize=this.tileSize,m.latRange=this.latRange,m.width=this.width,m.height=this.height,m._center=this._center,m.zoom=this.zoom,m.angle=this.angle,m._fov=this._fov,m._pitch=this._pitch,m._unmodified=this._unmodified,m._edgeInsets=this._edgeInsets.clone(),m._calcMatrices(),m},La.minZoom.get=function(){return this._minZoom},La.minZoom.set=function(m){this._minZoom!==m&&(this._minZoom=m,this.zoom=Math.max(this.zoom,m))},La.maxZoom.get=function(){return this._maxZoom},La.maxZoom.set=function(m){this._maxZoom!==m&&(this._maxZoom=m,this.zoom=Math.min(this.zoom,m))},La.minPitch.get=function(){return this._minPitch},La.minPitch.set=function(m){this._minPitch!==m&&(this._minPitch=m,this.pitch=Math.max(this.pitch,m))},La.maxPitch.get=function(){return this._maxPitch},La.maxPitch.set=function(m){this._maxPitch!==m&&(this._maxPitch=m,this.pitch=Math.min(this.pitch,m))},La.renderWorldCopies.get=function(){return this._renderWorldCopies},La.renderWorldCopies.set=function(m){m===void 0?m=!0:m===null&&(m=!1),this._renderWorldCopies=m},La.worldSize.get=function(){return this.tileSize*this.scale},La.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},La.size.get=function(){return new v.Point(this.width,this.height)},La.bearing.get=function(){return-this.angle/Math.PI*180},La.bearing.set=function(m){var d=-v.wrap(m,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},La.pitch.get=function(){return this._pitch/Math.PI*180},La.pitch.set=function(m){var d=v.clamp(m,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},La.fov.get=function(){return this._fov/Math.PI*180},La.fov.set=function(m){m=Math.max(.01,Math.min(60,m)),this._fov!==m&&(this._unmodified=!1,this._fov=m/180*Math.PI,this._calcMatrices())},La.zoom.get=function(){return this._zoom},La.zoom.set=function(m){var d=Math.min(Math.max(m,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},La.center.get=function(){return this._center},La.center.set=function(m){m.lat===this._center.lat&&m.lng===this._center.lng||(this._unmodified=!1,this._center=m,this._constrain(),this._calcMatrices())},La.padding.get=function(){return this._edgeInsets.toJSON()},La.padding.set=function(m){this._edgeInsets.equals(m)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,m,1),this._calcMatrices())},La.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Qi.prototype.isPaddingEqual=function(m){return this._edgeInsets.equals(m)},Qi.prototype.interpolatePadding=function(m,d,h){this._unmodified=!1,this._edgeInsets.interpolate(m,d,h),this._constrain(),this._calcMatrices()},Qi.prototype.coveringZoomLevel=function(m){var d=(m.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/m.tileSize));return Math.max(0,d)},Qi.prototype.getVisibleUnwrappedCoordinates=function(m){var d=[new v.UnwrappedTileID(0,m)];if(this._renderWorldCopies)for(var h=this.pointCoordinate(new v.Point(0,0)),y=this.pointCoordinate(new v.Point(this.width,0)),S=this.pointCoordinate(new v.Point(this.width,this.height)),O=this.pointCoordinate(new v.Point(0,this.height)),M=Math.floor(Math.min(h.x,y.x,S.x,O.x)),F=Math.floor(Math.max(h.x,y.x,S.x,O.x)),X=M-1;X<=F+1;X++)X!==0&&d.push(new v.UnwrappedTileID(X,m));return d},Qi.prototype.coveringTiles=function(m){var d=this.coveringZoomLevel(m),h=d;if(m.minzoom!==void 0&&d<m.minzoom)return[];m.maxzoom!==void 0&&d>m.maxzoom&&(d=m.maxzoom);var y=v.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,d),O=[S*y.x,S*y.y,0],M=Zf.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),F=m.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(F=d);var X=function(gn){return{aabb:new Gu([gn*S,0,0],[(gn+1)*S,S,0]),zoom:0,x:0,y:0,wrap:gn,fullyVisible:!1}},ee=[],ge=[],_e=d,Ee=m.reparseOverscaled?h:d;if(this._renderWorldCopies)for(var qe=1;qe<=3;qe++)ee.push(X(-qe)),ee.push(X(qe));for(ee.push(X(0));ee.length>0;){var $e=ee.pop(),dt=$e.x,Ye=$e.y,ot=$e.fullyVisible;if(!ot){var Mt=$e.aabb.intersects(M);if(Mt===0)continue;ot=Mt===2}var Pt=$e.aabb.distanceX(O),dr=$e.aabb.distanceY(O),Jt=Math.max(Math.abs(Pt),Math.abs(dr));if($e.zoom===_e||Jt>3+(1<<_e-$e.zoom)-2&&$e.zoom>=F)ge.push({tileID:new v.OverscaledTileID($e.zoom===_e?Ee:$e.zoom,$e.wrap,$e.zoom,dt,Ye),distanceSq:v.sqrLen([O[0]-.5-dt,O[1]-.5-Ye])});else for(var br=0;br<4;br++){var Er=(dt<<1)+br%2,en=(Ye<<1)+(br>>1);ee.push({aabb:$e.aabb.quadrant(br),zoom:$e.zoom+1,x:Er,y:en,wrap:$e.wrap,fullyVisible:ot})}}return ge.sort(function(Xr,gn){return Xr.distanceSq-gn.distanceSq}).map(function(Xr){return Xr.tileID})},Qi.prototype.resize=function(m,d){this.width=m,this.height=d,this.pixelsToGLUnits=[2/m,-2/d],this._constrain(),this._calcMatrices()},La.unmodified.get=function(){return this._unmodified},Qi.prototype.zoomScale=function(m){return Math.pow(2,m)},Qi.prototype.scaleZoom=function(m){return Math.log(m)/Math.LN2},Qi.prototype.project=function(m){var d=v.clamp(m.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(m.lng)*this.worldSize,v.mercatorYfromLat(d)*this.worldSize)},Qi.prototype.unproject=function(m){return new v.MercatorCoordinate(m.x/this.worldSize,m.y/this.worldSize).toLngLat()},La.point.get=function(){return this.project(this.center)},Qi.prototype.setLocationAtPoint=function(m,d){var h=this.pointCoordinate(d),y=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(m),O=new v.MercatorCoordinate(S.x-(h.x-y.x),S.y-(h.y-y.y));this.center=this.coordinateLocation(O),this._renderWorldCopies&&(this.center=this.center.wrap())},Qi.prototype.locationPoint=function(m){return this.coordinatePoint(this.locationCoordinate(m))},Qi.prototype.pointLocation=function(m){return this.coordinateLocation(this.pointCoordinate(m))},Qi.prototype.locationCoordinate=function(m){return v.MercatorCoordinate.fromLngLat(m)},Qi.prototype.coordinateLocation=function(m){return m.toLngLat()},Qi.prototype.pointCoordinate=function(m){var d=[m.x,m.y,0,1],h=[m.x,m.y,1,1];v.transformMat4(d,d,this.pixelMatrixInverse),v.transformMat4(h,h,this.pixelMatrixInverse);var y=d[3],S=h[3],O=d[1]/y,M=h[1]/S,F=d[2]/y,X=h[2]/S,ee=F===X?0:(0-F)/(X-F);return new v.MercatorCoordinate(v.number(d[0]/y,h[0]/S,ee)/this.worldSize,v.number(O,M,ee)/this.worldSize)},Qi.prototype.coordinatePoint=function(m){var d=[m.x*this.worldSize,m.y*this.worldSize,0,1];return v.transformMat4(d,d,this.pixelMatrix),new v.Point(d[0]/d[3],d[1]/d[3])},Qi.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Qi.prototype.setMaxBounds=function(m){m?(this.lngRange=[m.getWest(),m.getEast()],this.latRange=[m.getSouth(),m.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Qi.prototype.calculatePosMatrix=function(m,d){d===void 0&&(d=!1);var h=m.key,y=d?this._alignedPosMatrixCache:this._posMatrixCache;if(y[h])return y[h];var S=m.canonical,O=this.worldSize/this.zoomScale(S.z),M=S.x+Math.pow(2,S.z)*m.wrap,F=v.identity(new Float64Array(16));return v.translate(F,F,[M*O,S.y*O,0]),v.scale(F,F,[O/v.EXTENT,O/v.EXTENT,1]),v.multiply(F,d?this.alignedProjMatrix:this.projMatrix,F),y[h]=new Float32Array(F),y[h]},Qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var m,d,h,y,S=-90,O=90,M=-180,F=180,X=this.size,ee=this._unmodified;if(this.latRange){var ge=this.latRange;S=v.mercatorYfromLat(ge[1])*this.worldSize,m=(O=v.mercatorYfromLat(ge[0])*this.worldSize)-S<X.y?X.y/(O-S):0}if(this.lngRange){var _e=this.lngRange;M=v.mercatorXfromLng(_e[0])*this.worldSize,d=(F=v.mercatorXfromLng(_e[1])*this.worldSize)-M<X.x?X.x/(F-M):0}var Ee=this.point,qe=Math.max(d||0,m||0);if(qe)return this.center=this.unproject(new v.Point(d?(F+M)/2:Ee.x,m?(O+S)/2:Ee.y)),this.zoom+=this.scaleZoom(qe),this._unmodified=ee,void(this._constraining=!1);if(this.latRange){var $e=Ee.y,dt=X.y/2;$e-dt<S&&(y=S+dt),$e+dt>O&&(y=O-dt)}if(this.lngRange){var Ye=Ee.x,ot=X.x/2;Ye-ot<M&&(h=M+ot),Ye+ot>F&&(h=F-ot)}h===void 0&&y===void 0||(this.center=this.unproject(new v.Point(h!==void 0?h:Ee.x,y!==void 0?y:Ee.y))),this._unmodified=ee,this._constraining=!1}},Qi.prototype._calcMatrices=function(){if(this.height){var m=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,h=this._fov*(.5+m.y/this.height),y=Math.sin(h)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-d-h,.01,Math.PI-.01)),S=this.point,O=S.x,M=S.y,F=1.01*(Math.cos(Math.PI/2-this._pitch)*y+this.cameraToCenterDistance),X=this.height/50,ee=new Float64Array(16);v.perspective(ee,this._fov,this.width/this.height,X,F),ee[8]=2*-m.x/this.width,ee[9]=2*m.y/this.height,v.scale(ee,ee,[1,-1,1]),v.translate(ee,ee,[0,0,-this.cameraToCenterDistance]),v.rotateX(ee,ee,this._pitch),v.rotateZ(ee,ee,this.angle),v.translate(ee,ee,[-O,-M,0]),this.mercatorMatrix=v.scale([],ee,[this.worldSize,this.worldSize,this.worldSize]),v.scale(ee,ee,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ee,this.invProjMatrix=v.invert([],this.projMatrix);var ge=this.width%2/2,_e=this.height%2/2,Ee=Math.cos(this.angle),qe=Math.sin(this.angle),$e=O-Math.round(O)+Ee*ge+qe*_e,dt=M-Math.round(M)+Ee*_e+qe*ge,Ye=new Float64Array(ee);if(v.translate(Ye,Ye,[$e>.5?$e-1:$e,dt>.5?dt-1:dt,0]),this.alignedProjMatrix=Ye,ee=v.create(),v.scale(ee,ee,[this.width/2,-this.height/2,1]),v.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=v.create(),v.scale(ee,ee,[1,-1,1]),v.translate(ee,ee,[-1,-1,0]),v.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ee=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ee,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var m=this.pointCoordinate(new v.Point(0,0)),d=[m.x*this.worldSize,m.y*this.worldSize,0,1];return v.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},Qi.prototype.getCameraPoint=function(){var m=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,m))},Qi.prototype.getCameraQueryGeometry=function(m){var d=this.getCameraPoint();if(m.length===1)return[m[0],d];for(var h=d.x,y=d.y,S=d.x,O=d.y,M=0,F=m;M<F.length;M+=1){var X=F[M];h=Math.min(h,X.x),y=Math.min(y,X.y),S=Math.max(S,X.x),O=Math.max(O,X.y)}return[new v.Point(h,y),new v.Point(S,y),new v.Point(S,O),new v.Point(h,O),new v.Point(h,y)]},Object.defineProperties(Qi.prototype,La);var Ns=function(d){var h,y,S,O;this._hashName=d&&encodeURIComponent(d),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(h=this._updateHashUnthrottled.bind(this),y=!1,S=null,O=function(){S=null,y&&(h(),S=setTimeout(O,300),y=!1)},function(){return y=!0,S||O(),S})};Ns.prototype.addTo=function(m){return this._map=m,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ns.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ns.prototype.getHashString=function(m){var d=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,y=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,y),O=Math.round(d.lng*S)/S,M=Math.round(d.lat*S)/S,F=this._map.getBearing(),X=this._map.getPitch(),ee="";if(ee+=m?"/"+O+"/"+M+"/"+h:h+"/"+M+"/"+O,(F||X)&&(ee+="/"+Math.round(10*F)/10),X&&(ee+="/"+Math.round(X)),this._hashName){var ge=this._hashName,_e=!1,Ee=v.window.location.hash.slice(1).split("&").map(function(qe){var $e=qe.split("=")[0];return $e===ge?(_e=!0,$e+"="+ee):qe}).filter(function(qe){return qe});return _e||Ee.push(ge+"="+ee),"#"+Ee.join("&")}return"#"+ee},Ns.prototype._getCurrentHash=function(){var m,d=this,h=v.window.location.hash.replace("#","");return this._hashName?(h.split("&").map(function(y){return y.split("=")}).forEach(function(y){y[0]===d._hashName&&(m=y)}),(m&&m[1]||"").split("/")):h.split("/")},Ns.prototype._onHashChange=function(){var m=this._getCurrentHash();if(m.length>=3&&!m.some(function(h){return isNaN(h)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:d,pitch:+(m[4]||0)}),!0}return!1},Ns.prototype._updateHashUnthrottled=function(){var m=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,m)}catch(d){}};var ff={linearity:.3,easing:v.bezier(0,0,.3,1)},kc=v.extend({deceleration:2500,maxSpeed:1400},ff),$f=v.extend({deceleration:20,maxSpeed:1400},ff),hf=v.extend({deceleration:1e3,maxSpeed:360},ff),Nh=v.extend({deceleration:1e3,maxSpeed:90},ff),Yf=function(d){this._map=d,this.clear()};function Ul(m,d){(!m.duration||m.duration<d.duration)&&(m.duration=d.duration,m.easing=d.easing)}function V(m,d,h){var y=h.maxSpeed,S=h.linearity,O=h.deceleration,M=v.clamp(m*S/(d/1e3),-y,y),F=Math.abs(M)/(O*S);return{easing:h.easing,duration:1e3*F,amount:M*(F/2)}}Yf.prototype.clear=function(){this._inertiaBuffer=[]},Yf.prototype.record=function(m){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:m})},Yf.prototype._drainInertiaBuffer=function(){for(var m=this._inertiaBuffer,d=v.browser.now();m.length>0&&d-m[0].time>160;)m.shift()},Yf.prototype._onMoveEnd=function(m){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},h=0,y=this._inertiaBuffer;h<y.length;h+=1){var S=y[h].settings;d.zoom+=S.zoomDelta||0,d.bearing+=S.bearingDelta||0,d.pitch+=S.pitchDelta||0,S.panDelta&&d.pan._add(S.panDelta),S.around&&(d.around=S.around),S.pinchAround&&(d.pinchAround=S.pinchAround)}var O=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(d.pan.mag()){var F=V(d.pan.mag(),O,v.extend({},kc,m||{}));M.offset=d.pan.mult(F.amount/d.pan.mag()),M.center=this._map.transform.center,Ul(M,F)}if(d.zoom){var X=V(d.zoom,O,$f);M.zoom=this._map.transform.zoom+X.amount,Ul(M,X)}if(d.bearing){var ee=V(d.bearing,O,hf);M.bearing=this._map.transform.bearing+v.clamp(ee.amount,-179,179),Ul(M,ee)}if(d.pitch){var ge=V(d.pitch,O,Nh);M.pitch=this._map.transform.pitch+ge.amount,Ul(M,ge)}if(M.zoom||M.bearing){var _e=d.pinchAround===void 0?d.around:d.pinchAround;M.around=_e?this._map.unproject(_e):this._map.getCenter()}return this.clear(),v.extend(M,{noMoveStart:!0})}};var Va=function(m){function d(y,S,O,M){M===void 0&&(M={});var F=U.mousePos(S.getCanvasContainer(),O),X=S.unproject(F);m.call(this,y,v.extend({point:F,lngLat:X,originalEvent:O},M)),this._defaultPrevented=!1,this.target=S}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(v.Event),pf=function(m){function d(y,S,O){var M=y==="touchend"?O.changedTouches:O.touches,F=U.touchPos(S.getCanvasContainer(),M),X=F.map(function(_e){return S.unproject(_e)}),ee=F.reduce(function(_e,Ee,qe,$e){return _e.add(Ee.div($e.length))},new v.Point(0,0)),ge=S.unproject(ee);m.call(this,y,{points:F,point:ee,lngLats:X,lngLat:ge,originalEvent:O}),this._defaultPrevented=!1}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(v.Event),df=function(m){function d(y,S,O){m.call(this,y,{originalEvent:O}),this._defaultPrevented=!1}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var h={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},h.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,h),d}(v.Event),yo=function(d,h){this._map=d,this._clickTolerance=h.clickTolerance};yo.prototype.reset=function(){delete this._mousedownPos},yo.prototype.wheel=function(m){return this._firePreventable(new df(m.type,this._map,m))},yo.prototype.mousedown=function(m,d){return this._mousedownPos=d,this._firePreventable(new Va(m.type,this._map,m))},yo.prototype.mouseup=function(m){this._map.fire(new Va(m.type,this._map,m))},yo.prototype.click=function(m,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new Va(m.type,this._map,m))},yo.prototype.dblclick=function(m){return this._firePreventable(new Va(m.type,this._map,m))},yo.prototype.mouseover=function(m){this._map.fire(new Va(m.type,this._map,m))},yo.prototype.mouseout=function(m){this._map.fire(new Va(m.type,this._map,m))},yo.prototype.touchstart=function(m){return this._firePreventable(new pf(m.type,this._map,m))},yo.prototype.touchmove=function(m){this._map.fire(new pf(m.type,this._map,m))},yo.prototype.touchend=function(m){this._map.fire(new pf(m.type,this._map,m))},yo.prototype.touchcancel=function(m){this._map.fire(new pf(m.type,this._map,m))},yo.prototype._firePreventable=function(m){if(this._map.fire(m),m.defaultPrevented)return{}},yo.prototype.isEnabled=function(){return!0},yo.prototype.isActive=function(){return!1},yo.prototype.enable=function(){},yo.prototype.disable=function(){};var On=function(d){this._map=d};On.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},On.prototype.mousemove=function(m){this._map.fire(new Va(m.type,this._map,m))},On.prototype.mousedown=function(){this._delayContextMenu=!0},On.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Va("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},On.prototype.contextmenu=function(m){this._delayContextMenu?this._contextMenuEvent=m:this._map.fire(new Va(m.type,this._map,m)),this._map.listens("contextmenu")&&m.preventDefault()},On.prototype.isEnabled=function(){return!0},On.prototype.isActive=function(){return!1},On.prototype.enable=function(){},On.prototype.disable=function(){};var ss=function(d,h){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=h.clickTolerance||1};function vf(m,d){for(var h={},y=0;y<m.length;y++)h[m[y].identifier]=d[y];return h}ss.prototype.isEnabled=function(){return!!this._enabled},ss.prototype.isActive=function(){return!!this._active},ss.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ss.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ss.prototype.mousedown=function(m,d){this.isEnabled()&&m.shiftKey&&m.button===0&&(U.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},ss.prototype.mousemoveWindow=function(m,d){if(this._active){var h=d;if(!(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)){var y=this._startPos;this._lastPos=h,this._box||(this._box=U.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",m));var S=Math.min(y.x,h.x),O=Math.max(y.x,h.x),M=Math.min(y.y,h.y),F=Math.max(y.y,h.y);U.setTransform(this._box,"translate("+S+"px,"+M+"px)"),this._box.style.width=O-S+"px",this._box.style.height=F-M+"px"}}},ss.prototype.mouseupWindow=function(m,d){var h=this;if(this._active&&m.button===0){var y=this._startPos,S=d;if(this.reset(),U.suppressClick(),y.x!==S.x||y.y!==S.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:m})),{cameraAnimation:function(M){return M.fitScreenCoordinates(y,S,h._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",m)}},ss.prototype.keydown=function(m){this._active&&m.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",m))},ss.prototype.blur=function(){this.reset()},ss.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(U.remove(this._box),this._box=null),U.enableDrag(),delete this._startPos,delete this._lastPos},ss.prototype._fireEvent=function(m,d){return this._map.fire(new v.Event(m,{originalEvent:d}))};var Fc=function(d){this.reset(),this.numTouches=d.numTouches};Fc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Fc.prototype.touchstart=function(m,d,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=m.timeStamp),h.length===this.numTouches&&(this.centroid=function(y){for(var S=new v.Point(0,0),O=0,M=y;O<M.length;O+=1)S._add(M[O]);return S.div(y.length)}(d),this.touches=vf(h,d)))},Fc.prototype.touchmove=function(m,d,h){if(!this.aborted&&this.centroid){var y=vf(h,d);for(var S in this.touches){var O=y[S];(!O||O.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Fc.prototype.touchend=function(m,d,h){if((!this.centroid||m.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){var y=!this.aborted&&this.centroid;if(this.reset(),y)return y}};var ms=function(d){this.singleTap=new Fc(d),this.numTaps=d.numTaps,this.reset()};ms.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},ms.prototype.touchstart=function(m,d,h){this.singleTap.touchstart(m,d,h)},ms.prototype.touchmove=function(m,d,h){this.singleTap.touchmove(m,d,h)},ms.prototype.touchend=function(m,d,h){var y=this.singleTap.touchend(m,d,h);if(y){var S=m.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(y)<30;if(S&&O||this.reset(),this.count++,this.lastTime=m.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}};var Ma=function(){this._zoomIn=new ms({numTouches:1,numTaps:2}),this._zoomOut=new ms({numTouches:2,numTaps:1}),this.reset()};Ma.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ma.prototype.touchstart=function(m,d,h){this._zoomIn.touchstart(m,d,h),this._zoomOut.touchstart(m,d,h)},Ma.prototype.touchmove=function(m,d,h){this._zoomIn.touchmove(m,d,h),this._zoomOut.touchmove(m,d,h)},Ma.prototype.touchend=function(m,d,h){var y=this,S=this._zoomIn.touchend(m,d,h),O=this._zoomOut.touchend(m,d,h);return S?(this._active=!0,m.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()+1,around:F.unproject(S)},{originalEvent:m})}}):O?(this._active=!0,m.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(F){return F.easeTo({duration:300,zoom:F.getZoom()-1,around:F.unproject(O)},{originalEvent:m})}}):void 0},Ma.prototype.touchcancel=function(){this.reset()},Ma.prototype.enable=function(){this._enabled=!0},Ma.prototype.disable=function(){this._enabled=!1,this.reset()},Ma.prototype.isEnabled=function(){return this._enabled},Ma.prototype.isActive=function(){return this._active};var mf={0:1,2:2},cn=function(d){this.reset(),this._clickTolerance=d.clickTolerance||1};cn.prototype.blur=function(){this.reset()},cn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},cn.prototype._correctButton=function(m,d){return!1},cn.prototype._move=function(m,d){return{}},cn.prototype.mousedown=function(m,d){if(!this._lastPoint){var h=U.mouseButton(m);this._correctButton(m,h)&&(this._lastPoint=d,this._eventButton=h)}},cn.prototype.mousemoveWindow=function(m,d){var h=this._lastPoint;if(h){if(m.preventDefault(),function(y,S){var O=mf[S];return y.buttons===void 0||(y.buttons&O)!==O}(m,this._eventButton))this.reset();else if(this._moved||!(d.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(h,d)}},cn.prototype.mouseupWindow=function(m){this._lastPoint&&U.mouseButton(m)===this._eventButton&&(this._moved&&U.suppressClick(),this.reset())},cn.prototype.enable=function(){this._enabled=!0},cn.prototype.disable=function(){this._enabled=!1,this.reset()},cn.prototype.isEnabled=function(){return this._enabled},cn.prototype.isActive=function(){return this._active};var Vl=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.mousedown=function(h,y){m.prototype.mousedown.call(this,h,y),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(h,y){return y===0&&!h.ctrlKey},d.prototype._move=function(h,y){return{around:y,panDelta:y.sub(h)}},d}(cn),gf=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype._correctButton=function(h,y){return y===0&&h.ctrlKey||y===2},d.prototype._move=function(h,y){var S=.8*(y.x-h.x);if(S)return this._active=!0,{bearingDelta:S}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(cn),Kf=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype._correctButton=function(h,y){return y===0&&h.ctrlKey||y===2},d.prototype._move=function(h,y){var S=-.5*(y.y-h.y);if(S)return this._active=!0,{pitchDelta:S}},d.prototype.contextmenu=function(h){h.preventDefault()},d}(cn),fu=function(d){this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset()};fu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},fu.prototype.touchstart=function(m,d,h){return this._calculateTransform(m,d,h)},fu.prototype.touchmove=function(m,d,h){if(this._active&&!(h.length<this._minTouches))return m.preventDefault(),this._calculateTransform(m,d,h)},fu.prototype.touchend=function(m,d,h){this._calculateTransform(m,d,h),this._active&&h.length<this._minTouches&&this.reset()},fu.prototype.touchcancel=function(){this.reset()},fu.prototype._calculateTransform=function(m,d,h){h.length>0&&(this._active=!0);var y=vf(h,d),S=new v.Point(0,0),O=new v.Point(0,0),M=0;for(var F in y){var X=y[F],ee=this._touches[F];ee&&(S._add(X),O._add(X.sub(ee)),M++,y[F]=X)}if(this._touches=y,!(M<this._minTouches)&&O.mag()){var ge=O.div(M);if(this._sum._add(ge),!(this._sum.mag()<this._clickTolerance))return{around:S.div(M),panDelta:ge}}},fu.prototype.enable=function(){this._enabled=!0},fu.prototype.disable=function(){this._enabled=!1,this.reset()},fu.prototype.isEnabled=function(){return this._enabled},fu.prototype.isActive=function(){return this._active};var Sa=function(){this.reset()};function jh(m,d,h){for(var y=0;y<m.length;y++)if(m[y].identifier===h)return d[y]}function yf(m,d){return Math.log(m/d)/Math.LN2}Sa.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Sa.prototype._start=function(m){},Sa.prototype._move=function(m,d,h){return{}},Sa.prototype.touchstart=function(m,d,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([d[0],d[1]]))},Sa.prototype.touchmove=function(m,d,h){if(this._firstTwoTouches){m.preventDefault();var y=this._firstTwoTouches,S=y[1],O=jh(h,d,y[0]),M=jh(h,d,S);if(O&&M){var F=this._aroundCenter?null:O.add(M).div(2);return this._move([O,M],F,m)}}},Sa.prototype.touchend=function(m,d,h){if(this._firstTwoTouches){var y=this._firstTwoTouches,S=y[1],O=jh(h,d,y[0]),M=jh(h,d,S);O&&M||(this._active&&U.suppressClick(),this.reset())}},Sa.prototype.touchcancel=function(){this.reset()},Sa.prototype.enable=function(m){this._enabled=!0,this._aroundCenter=!!m&&m.around==="center"},Sa.prototype.disable=function(){this._enabled=!1,this.reset()},Sa.prototype.isEnabled=function(){return this._enabled},Sa.prototype.isActive=function(){return this._active};var ws=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(h){this._startDistance=this._distance=h[0].dist(h[1])},d.prototype._move=function(h,y){var S=this._distance;if(this._distance=h[0].dist(h[1]),this._active||!(Math.abs(yf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yf(this._distance,S),pinchAround:y}},d}(Sa);function Xu(m,d){return 180*m.angleWith(d)/Math.PI}var fd=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(h){this._startVector=this._vector=h[0].sub(h[1]),this._minDiameter=h[0].dist(h[1])},d.prototype._move=function(h,y){var S=this._vector;if(this._vector=h[0].sub(h[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Xu(this._vector,S),pinchAround:y}},d.prototype._isBelowThreshold=function(h){this._minDiameter=Math.min(this._minDiameter,h.mag());var y=25/(Math.PI*this._minDiameter)*360,S=Xu(h,this._startVector);return Math.abs(S)<y},d}(Sa);function Zu(m){return Math.abs(m.y)>Math.abs(m.x)}var Bc=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(h){this._lastPoints=h,Zu(h[0].sub(h[1]))&&(this._valid=!1)},d.prototype._move=function(h,y,S){var O=h[0].sub(this._lastPoints[0]),M=h[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(O,M,S.timeStamp),this._valid)return this._lastPoints=h,this._active=!0,{pitchDelta:(O.y+M.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(h,y,S){if(this._valid!==void 0)return this._valid;var O=h.mag()>=2,M=y.mag()>=2;if(O||M){if(!O||!M)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var F=h.y>0==y.y>0;return Zu(h)&&Zu(y)&&F}},d}(Sa),Lc={panStep:100,bearingStep:15,pitchStep:10},Gs=function(){var d=Lc;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1};function js(m){return m*(2-m)}Gs.prototype.blur=function(){this.reset()},Gs.prototype.reset=function(){this._active=!1},Gs.prototype.keydown=function(m){var d=this;if(!(m.altKey||m.ctrlKey||m.metaKey)){var h=0,y=0,S=0,O=0,M=0;switch(m.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:m.shiftKey?y=-1:(m.preventDefault(),O=-1);break;case 39:m.shiftKey?y=1:(m.preventDefault(),O=1);break;case 38:m.shiftKey?S=1:(m.preventDefault(),M=-1);break;case 40:m.shiftKey?S=-1:(m.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(y=0,S=0),{cameraAnimation:function(X){var ee=X.getZoom();X.easeTo({duration:300,easeId:"keyboardHandler",easing:js,zoom:h?Math.round(ee)+h*(m.shiftKey?2:1):ee,bearing:X.getBearing()+y*d._bearingStep,pitch:X.getPitch()+S*d._pitchStep,offset:[-O*d._panStep,-M*d._panStep],center:X.getCenter()},{originalEvent:m})}}}},Gs.prototype.enable=function(){this._enabled=!0},Gs.prototype.disable=function(){this._enabled=!1,this.reset()},Gs.prototype.isEnabled=function(){return this._enabled},Gs.prototype.isActive=function(){return this._active},Gs.prototype.disableRotation=function(){this._rotationDisabled=!0},Gs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ti=function(d,h){this._map=d,this._el=d.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Ti.prototype.setZoomRate=function(m){this._defaultZoomRate=m},Ti.prototype.setWheelZoomRate=function(m){this._wheelZoomRate=m},Ti.prototype.isEnabled=function(){return!!this._enabled},Ti.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ti.prototype.isZooming=function(){return!!this._zooming},Ti.prototype.enable=function(m){this.isEnabled()||(this._enabled=!0,this._aroundCenter=m&&m.around==="center")},Ti.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ti.prototype.wheel=function(m){if(this.isEnabled()){var d=m.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*m.deltaY:m.deltaY,h=v.browser.now(),y=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,m)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),m.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=m,this._delta-=d,this._active||this._start(m)),m.preventDefault()}},Ti.prototype._onTimeout=function(m){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},Ti.prototype._start=function(m){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=U.mousePos(this._el,m);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ti.prototype.renderFrame=function(){var m=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var h=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,y=2/(1+Math.exp(-Math.abs(this._delta*h)));this._delta<0&&y!==0&&(y=1/y);var S=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(S*y))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var O,M=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,F=this._startZoom,X=this._easing,ee=!1;if(this._type==="wheel"&&F&&X){var ge=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),_e=X(ge);O=v.number(F,M,_e),ge<1?this._frameId||(this._frameId=!0):ee=!0}else O=M,ee=!0;return this._active=!0,ee&&(this._active=!1,this._finishTimeout=setTimeout(function(){m._zooming=!1,m._handler._triggerRenderFrame(),delete m._targetZoom,delete m._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ee,zoomDelta:O-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ti.prototype._smoothOutEasing=function(m){var d=v.ease;if(this._prevEase){var h=this._prevEase,y=(v.browser.now()-h.start)/h.duration,S=h.easing(y+.01)-h.easing(y),O=.27/Math.sqrt(S*S+1e-4)*.01,M=Math.sqrt(.0729-O*O);d=v.bezier(O,M,.25,1)}return this._prevEase={start:v.browser.now(),duration:m,easing:d},d},Ti.prototype.blur=function(){this.reset()},Ti.prototype.reset=function(){this._active=!1};var Xs=function(d,h){this._clickZoom=d,this._tapZoom=h};Xs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Xs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Xs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Xs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(m,d){return m.preventDefault(),{cameraAnimation:function(y){y.easeTo({duration:300,zoom:y.getZoom()+(m.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:m})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Jo=function(){this._tap=new ms({numTouches:1,numTaps:1}),this.reset()};Jo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Jo.prototype.touchstart=function(m,d,h){this._swipePoint||(this._tapTime&&m.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=d[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(m,d,h))},Jo.prototype.touchmove=function(m,d,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;var y=d[0],S=y.y-this._swipePoint.y;return this._swipePoint=y,m.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(m,d,h)},Jo.prototype.touchend=function(m,d,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(m,d,h)&&(this._tapTime=m.timeStamp)},Jo.prototype.touchcancel=function(){this.reset()},Jo.prototype.enable=function(){this._enabled=!0},Jo.prototype.disable=function(){this._enabled=!1,this.reset()},Jo.prototype.isEnabled=function(){return this._enabled},Jo.prototype.isActive=function(){return this._active};var uc=function(d,h,y){this._el=d,this._mousePan=h,this._touchPan=y};uc.prototype.enable=function(m){this._inertiaOptions=m||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},uc.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},uc.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},uc.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var gs=function(d,h,y){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y};gs.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},gs.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},gs.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},gs.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var pu=function(d,h,y,S){this._el=d,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=S,this._rotationDisabled=!1,this._enabled=!0};pu.prototype.enable=function(m){this._touchZoom.enable(m),this._rotationDisabled||this._touchRotate.enable(m),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},pu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},pu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},pu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},pu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},pu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var ys=function(d){return d.zoom||d.drag||d.pitch||d.rotate},_f=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d}(v.Event);function qn(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}var Fn=function(d,h){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Yf(d),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h),v.bindAll(["handleEvent","handleWindowEvent"],this);var y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[v.window,"blur",void 0]];for(var S=0,O=this._listeners;S<O.length;S+=1){var M=O[S],F=M[0];U.addEventListener(F,M[1],F===v.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};Fn.prototype.destroy=function(){for(var m=0,d=this._listeners;m<d.length;m+=1){var h=d[m],y=h[0];U.removeEventListener(y,h[1],y===v.window.document?this.handleWindowEvent:this.handleEvent,h[2])}},Fn.prototype._addDefaultHandlers=function(m){var d=this._map,h=d.getCanvasContainer();this._add("mapEvent",new yo(d,m));var y=d.boxZoom=new ss(d,m);this._add("boxZoom",y);var S=new Ma,O=new hu;d.doubleClickZoom=new Xs(O,S),this._add("tapZoom",S),this._add("clickZoom",O);var M=new Jo;this._add("tapDragZoom",M);var F=d.touchPitch=new Bc;this._add("touchPitch",F);var X=new gf(m),ee=new Kf(m);d.dragRotate=new gs(m,X,ee),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);var ge=new Vl(m),_e=new fu(m);d.dragPan=new uc(h,ge,_e),this._add("mousePan",ge),this._add("touchPan",_e,["touchZoom","touchRotate"]);var Ee=new fd,qe=new ws;d.touchZoomRotate=new pu(h,qe,Ee,M),this._add("touchRotate",Ee,["touchPan","touchZoom"]),this._add("touchZoom",qe,["touchPan","touchRotate"]);var $e=d.scrollZoom=new Ti(d,this);this._add("scrollZoom",$e,["mousePan"]);var dt=d.keyboard=new Gs;this._add("keyboard",dt),this._add("blockableMapEvent",new On(d));for(var Ye=0,ot=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ye<ot.length;Ye+=1){var Mt=ot[Ye];m.interactive&&m[Mt]&&d[Mt].enable(m[Mt])}},Fn.prototype._add=function(m,d,h){this._handlers.push({handlerName:m,handler:d,allowed:h}),this._handlersById[m]=d},Fn.prototype.stop=function(m){if(!this._updatingCamera){for(var d=0,h=this._handlers;d<h.length;d+=1)h[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},m),this._changes=[]}},Fn.prototype.isActive=function(){for(var m=0,d=this._handlers;m<d.length;m+=1)if(d[m].handler.isActive())return!0;return!1},Fn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Fn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Fn.prototype.isMoving=function(){return Boolean(ys(this._eventsInProgress))||this.isZooming()},Fn.prototype._blockedByActive=function(m,d,h){for(var y in m)if(y!==h&&(!d||d.indexOf(y)<0))return!0;return!1},Fn.prototype.handleWindowEvent=function(m){this.handleEvent(m,m.type+"Window")},Fn.prototype._getMapTouches=function(m){for(var d=[],h=0,y=m;h<y.length;h+=1){var S=y[h];this._el.contains(S.target)&&d.push(S)}return d},Fn.prototype.handleEvent=function(m,d){this._updatingCamera=!0;for(var h=m.type==="renderFrame"?void 0:m,y={needsRenderFrame:!1},S={},O={},M=m.touches?this._getMapTouches(m.touches):void 0,F=M?U.touchPos(this._el,M):U.mousePos(this._el,m),X=0,ee=this._handlers;X<ee.length;X+=1){var ge=ee[X],_e=ge.handlerName,Ee=ge.handler,qe=ge.allowed;if(Ee.isEnabled()){var $e=void 0;this._blockedByActive(O,qe,_e)?Ee.reset():Ee[d||m.type]&&($e=Ee[d||m.type](m,F,M),this.mergeHandlerResult(y,S,$e,_e,h),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||Ee.isActive())&&(O[_e]=Ee)}}var dt={};for(var Ye in this._previousActiveHandlers)O[Ye]||(dt[Ye]=h);this._previousActiveHandlers=O,(Object.keys(dt).length||qn(y))&&(this._changes.push([y,S,dt]),this._triggerRenderFrame()),(Object.keys(O).length||qn(y))&&this._map._stop(!0),this._updatingCamera=!1;var ot=y.cameraAnimation;ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ot(this._map))},Fn.prototype.mergeHandlerResult=function(m,d,h,y,S){if(h){v.extend(m,h);var O={handlerName:y,originalEvent:h.originalEvent||S};h.zoomDelta!==void 0&&(d.zoom=O),h.panDelta!==void 0&&(d.drag=O),h.pitchDelta!==void 0&&(d.pitch=O),h.bearingDelta!==void 0&&(d.rotate=O)}},Fn.prototype._applyChanges=function(){for(var m={},d={},h={},y=0,S=this._changes;y<S.length;y+=1){var O=S[y],M=O[0],F=O[1],X=O[2];M.panDelta&&(m.panDelta=(m.panDelta||new v.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(m.zoomDelta=(m.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(m.bearingDelta=(m.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(m.pitchDelta=(m.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(m.around=M.around),M.pinchAround!==void 0&&(m.pinchAround=M.pinchAround),M.noInertia&&(m.noInertia=M.noInertia),v.extend(d,F),v.extend(h,X)}this._updateMapTransform(m,d,h),this._changes=[]},Fn.prototype._updateMapTransform=function(m,d,h){var y=this._map,S=y.transform;if(!qn(m))return this._fireEvents(d,h,!0);var O=m.panDelta,M=m.zoomDelta,F=m.bearingDelta,X=m.pitchDelta,ee=m.around,ge=m.pinchAround;ge!==void 0&&(ee=ge),y._stop(!0),ee=ee||y.transform.centerPoint;var _e=S.pointLocation(O?ee.sub(O):ee);F&&(S.bearing+=F),X&&(S.pitch+=X),M&&(S.zoom+=M),S.setLocationAtPoint(_e,ee),this._map._update(),m.noInertia||this._inertia.record(m),this._fireEvents(d,h,!0)},Fn.prototype._fireEvents=function(m,d,h){var y=this,S=ys(this._eventsInProgress),O=ys(m),M={};for(var F in m)this._eventsInProgress[F]||(M[F+"start"]=m[F].originalEvent),this._eventsInProgress[F]=m[F];for(var X in!S&&O&&this._fireEvent("movestart",O.originalEvent),M)this._fireEvent(X,M[X]);for(var ee in O&&this._fireEvent("move",O.originalEvent),m)this._fireEvent(ee,m[ee].originalEvent);var ge,_e={};for(var Ee in this._eventsInProgress){var qe=this._eventsInProgress[Ee],$e=qe.handlerName,dt=qe.originalEvent;this._handlersById[$e].isActive()||(delete this._eventsInProgress[Ee],_e[Ee+"end"]=ge=d[$e]||dt)}for(var Ye in _e)this._fireEvent(Ye,_e[Ye]);var ot=ys(this._eventsInProgress);if(h&&(S||O)&&!ot){this._updatingCamera=!0;var Mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Pt=function(Jt){return Jt!==0&&-y._bearingSnap<Jt&&Jt<y._bearingSnap};Mt?(Pt(Mt.bearing||this._map.getBearing())&&(Mt.bearing=0),this._map.easeTo(Mt,{originalEvent:ge})):(this._map.fire(new v.Event("moveend",{originalEvent:ge})),Pt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Fn.prototype._fireEvent=function(m,d){this._map.fire(new v.Event(m,d?{originalEvent:d}:{}))},Fn.prototype._requestFrame=function(){var m=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete m._frameId,m.handleEvent(new _f("renderFrame",{timeStamp:d})),m._applyChanges()})},Fn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Zs=function(m){function d(h,y){m.call(this),this._moving=!1,this._zooming=!1,this.transform=h,this._bearingSnap=y.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(h,y){return this.jumpTo({center:h},y)},d.prototype.panBy=function(h,y,S){return h=v.Point.convert(h).mult(-1),this.panTo(this.transform.center,v.extend({offset:h},y),S)},d.prototype.panTo=function(h,y,S){return this.easeTo(v.extend({center:h},y),S)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(h,y){return this.jumpTo({zoom:h},y),this},d.prototype.zoomTo=function(h,y,S){return this.easeTo(v.extend({zoom:h},y),S)},d.prototype.zoomIn=function(h,y){return this.zoomTo(this.getZoom()+1,h,y),this},d.prototype.zoomOut=function(h,y){return this.zoomTo(this.getZoom()-1,h,y),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(h,y){return this.jumpTo({bearing:h},y),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(h,y){return this.jumpTo({padding:h},y),this},d.prototype.rotateTo=function(h,y,S){return this.easeTo(v.extend({bearing:h},y),S)},d.prototype.resetNorth=function(h,y){return this.rotateTo(0,v.extend({duration:1e3},h),y),this},d.prototype.resetNorthPitch=function(h,y){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},h),y),this},d.prototype.snapToNorth=function(h,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(h,y):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(h,y){return this.jumpTo({pitch:h},y),this},d.prototype.cameraForBounds=function(h,y){h=v.LngLatBounds.convert(h);var S=y&&y.bearing||0;return this._cameraForBoxAndBearing(h.getNorthWest(),h.getSouthEast(),S,y)},d.prototype._cameraForBoxAndBearing=function(h,y,S,O){var M={top:0,bottom:0,right:0,left:0};if(typeof(O=v.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},O)).padding=="number"){var F=O.padding;O.padding={top:F,bottom:F,right:F,left:F}}O.padding=v.extend(M,O.padding);var X=this.transform,ee=X.padding,ge=X.project(v.LngLat.convert(h)),_e=X.project(v.LngLat.convert(y)),Ee=ge.rotate(-S*Math.PI/180),qe=_e.rotate(-S*Math.PI/180),$e=new v.Point(Math.max(Ee.x,qe.x),Math.max(Ee.y,qe.y)),dt=new v.Point(Math.min(Ee.x,qe.x),Math.min(Ee.y,qe.y)),Ye=$e.sub(dt),ot=(X.width-(ee.left+ee.right+O.padding.left+O.padding.right))/Ye.x,Mt=(X.height-(ee.top+ee.bottom+O.padding.top+O.padding.bottom))/Ye.y;if(!(Mt<0||ot<0)){var Pt=Math.min(X.scaleZoom(X.scale*Math.min(ot,Mt)),O.maxZoom),dr=typeof O.offset.x=="number"?new v.Point(O.offset.x,O.offset.y):v.Point.convert(O.offset),Jt=new v.Point((O.padding.left-O.padding.right)/2,(O.padding.top-O.padding.bottom)/2).rotate(S*Math.PI/180),br=dr.add(Jt).mult(X.scale/X.zoomScale(Pt));return{center:X.unproject(ge.add(_e).div(2).sub(br)),zoom:Pt,bearing:S}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(h,y,S){return this._fitInternal(this.cameraForBounds(h,y),y,S)},d.prototype.fitScreenCoordinates=function(h,y,S,O,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(h)),this.transform.pointLocation(v.Point.convert(y)),S,O),O,M)},d.prototype._fitInternal=function(h,y,S){return h?(delete(y=v.extend(h,y)).padding,y.linear?this.easeTo(y,S):this.flyTo(y,S)):this},d.prototype.jumpTo=function(h,y){this.stop();var S=this.transform,O=!1,M=!1,F=!1;return"zoom"in h&&S.zoom!==+h.zoom&&(O=!0,S.zoom=+h.zoom),h.center!==void 0&&(S.center=v.LngLat.convert(h.center)),"bearing"in h&&S.bearing!==+h.bearing&&(M=!0,S.bearing=+h.bearing),"pitch"in h&&S.pitch!==+h.pitch&&(F=!0,S.pitch=+h.pitch),h.padding==null||S.isPaddingEqual(h.padding)||(S.padding=h.padding),this.fire(new v.Event("movestart",y)).fire(new v.Event("move",y)),O&&this.fire(new v.Event("zoomstart",y)).fire(new v.Event("zoom",y)).fire(new v.Event("zoomend",y)),M&&this.fire(new v.Event("rotatestart",y)).fire(new v.Event("rotate",y)).fire(new v.Event("rotateend",y)),F&&this.fire(new v.Event("pitchstart",y)).fire(new v.Event("pitch",y)).fire(new v.Event("pitchend",y)),this.fire(new v.Event("moveend",y))},d.prototype.easeTo=function(h,y){var S=this;this._stop(!1,h.easeId),((h=v.extend({offset:[0,0],duration:500,easing:v.ease},h)).animate===!1||!h.essential&&v.browser.prefersReducedMotion)&&(h.duration=0);var O=this.transform,M=this.getZoom(),F=this.getBearing(),X=this.getPitch(),ee=this.getPadding(),ge="zoom"in h?+h.zoom:M,_e="bearing"in h?this._normalizeBearing(h.bearing,F):F,Ee="pitch"in h?+h.pitch:X,qe="padding"in h?h.padding:O.padding,$e=v.Point.convert(h.offset),dt=O.centerPoint.add($e),Ye=O.pointLocation(dt),ot=v.LngLat.convert(h.center||Ye);this._normalizeCenter(ot);var Mt,Pt,dr=O.project(Ye),Jt=O.project(ot).sub(dr),br=O.zoomScale(ge-M);h.around&&(Mt=v.LngLat.convert(h.around),Pt=O.locationPoint(Mt));var Er={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==M,this._rotating=this._rotating||F!==_e,this._pitching=this._pitching||Ee!==X,this._padding=!O.isPaddingEqual(qe),this._easeId=h.easeId,this._prepareEase(y,h.noMoveStart,Er),this._ease(function(en){if(S._zooming&&(O.zoom=v.number(M,ge,en)),S._rotating&&(O.bearing=v.number(F,_e,en)),S._pitching&&(O.pitch=v.number(X,Ee,en)),S._padding&&(O.interpolatePadding(ee,qe,en),dt=O.centerPoint.add($e)),Mt)O.setLocationAtPoint(Mt,Pt);else{var Xr=O.zoomScale(O.zoom-M),gn=ge>M?Math.min(2,br):Math.max(.5,br),In=Math.pow(gn,1-en),Vn=O.unproject(dr.add(Jt.mult(en*In)).mult(Xr));O.setLocationAtPoint(O.renderWorldCopies?Vn.wrap():Vn,dt)}S._fireMoveEvents(y)},function(en){S._afterEase(y,en)},h),this},d.prototype._prepareEase=function(h,y,S){S===void 0&&(S={}),this._moving=!0,y||S.moving||this.fire(new v.Event("movestart",h)),this._zooming&&!S.zooming&&this.fire(new v.Event("zoomstart",h)),this._rotating&&!S.rotating&&this.fire(new v.Event("rotatestart",h)),this._pitching&&!S.pitching&&this.fire(new v.Event("pitchstart",h))},d.prototype._fireMoveEvents=function(h){this.fire(new v.Event("move",h)),this._zooming&&this.fire(new v.Event("zoom",h)),this._rotating&&this.fire(new v.Event("rotate",h)),this._pitching&&this.fire(new v.Event("pitch",h))},d.prototype._afterEase=function(h,y){if(!this._easeId||!y||this._easeId!==y){delete this._easeId;var S=this._zooming,O=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new v.Event("zoomend",h)),O&&this.fire(new v.Event("rotateend",h)),M&&this.fire(new v.Event("pitchend",h)),this.fire(new v.Event("moveend",h))}},d.prototype.flyTo=function(h,y){var S=this;if(!h.essential&&v.browser.prefersReducedMotion){var O=v.pick(h,["center","zoom","bearing","pitch","around"]);return this.jumpTo(O,y)}this.stop(),h=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},h);var M=this.transform,F=this.getZoom(),X=this.getBearing(),ee=this.getPitch(),ge=this.getPadding(),_e="zoom"in h?v.clamp(+h.zoom,M.minZoom,M.maxZoom):F,Ee="bearing"in h?this._normalizeBearing(h.bearing,X):X,qe="pitch"in h?+h.pitch:ee,$e="padding"in h?h.padding:M.padding,dt=M.zoomScale(_e-F),Ye=v.Point.convert(h.offset),ot=M.centerPoint.add(Ye),Mt=M.pointLocation(ot),Pt=v.LngLat.convert(h.center||Mt);this._normalizeCenter(Pt);var dr=M.project(Mt),Jt=M.project(Pt).sub(dr),br=h.curve,Er=Math.max(M.width,M.height),en=Er/dt,Xr=Jt.mag();if("minZoom"in h){var gn=v.clamp(Math.min(h.minZoom,F,_e),M.minZoom,M.maxZoom),In=Er/M.zoomScale(gn-F);br=Math.sqrt(In/Xr*2)}var Vn=br*br;function oi(ti){var _i=(en*en-Er*Er+(ti?-1:1)*Vn*Vn*Xr*Xr)/(2*(ti?en:Er)*Vn*Xr);return Math.log(Math.sqrt(_i*_i+1)-_i)}function Di(ti){return(Math.exp(ti)-Math.exp(-ti))/2}function Ji(ti){return(Math.exp(ti)+Math.exp(-ti))/2}var Tn=oi(0),Ei=function(_i){return Ji(Tn)/Ji(Tn+br*_i)},vi=function(_i){return Er*((Ji(Tn)*(Di(Yi=Tn+br*_i)/Ji(Yi))-Di(Tn))/Vn)/Xr;var Yi},Hn=(oi(1)-Tn)/br;if(Math.abs(Xr)<1e-6||!isFinite(Hn)){if(Math.abs(Er-en)<1e-6)return this.easeTo(h,y);var Ci=en<Er?-1:1;Hn=Math.abs(Math.log(en/Er))/br,vi=function(){return 0},Ei=function(_i){return Math.exp(Ci*br*_i)}}return h.duration="duration"in h?+h.duration:1e3*Hn/("screenSpeed"in h?+h.screenSpeed/br:+h.speed),h.maxDuration&&h.duration>h.maxDuration&&(h.duration=0),this._zooming=!0,this._rotating=X!==Ee,this._pitching=qe!==ee,this._padding=!M.isPaddingEqual($e),this._prepareEase(y,!1),this._ease(function(ti){var _i=ti*Hn,Yi=1/Ei(_i);M.zoom=ti===1?_e:F+M.scaleZoom(Yi),S._rotating&&(M.bearing=v.number(X,Ee,ti)),S._pitching&&(M.pitch=v.number(ee,qe,ti)),S._padding&&(M.interpolatePadding(ge,$e,ti),ot=M.centerPoint.add(Ye));var za=ti===1?Pt:M.unproject(dr.add(Jt.mult(vi(_i))).mult(Yi));M.setLocationAtPoint(M.renderWorldCopies?za.wrap():za,ot),S._fireMoveEvents(y)},function(){return S._afterEase(y)},h),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(h,y){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,y)}if(!h){var O=this.handlers;O&&O.stop(!1)}return this},d.prototype._ease=function(h,y,S){S.animate===!1||S.duration===0?(h(1),y()):(this._easeStart=v.browser.now(),this._easeOptions=S,this._onEaseFrame=h,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var h=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(h,y){h=v.wrap(h,-180,180);var S=Math.abs(h-y);return Math.abs(h-360-y)<S&&(h-=360),Math.abs(h+360-y)<S&&(h+=360),h},d.prototype._normalizeCenter=function(h){var y=this.transform;if(y.renderWorldCopies&&!y.lngRange){var S=h.lng-y.center.lng;h.lng+=S>180?-360:S<-180?360:0}},d}(v.Evented),us=function(d){d===void 0&&(d={}),this.options=d,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};us.prototype.getDefaultPosition=function(){return"bottom-right"},us.prototype.onAdd=function(m){var d=this.options&&this.options.compact;return this._map=m,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},us.prototype.onRemove=function(){U.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},us.prototype._setElementTitle=function(m,d){var h=this._map._getUIString("AttributionControl."+d);m.title=h,m.setAttribute("aria-label",h)},us.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},us.prototype._updateEditLink=function(){var m=this._editLink;m||(m=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(m){var h=d.reduce(function(y,S,O){return S.value&&(y+=S.key+"="+S.value+(O<d.length-1?"&":"")),y},"?");m.href=v.config.FEEDBACK_URL+"/"+h+(this._map._hash?this._map._hash.getHashString(!0):""),m.rel="noopener nofollow",this._setElementTitle(m,"MapFeedback")}},us.prototype._updateData=function(m){!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},us.prototype._updateAttributions=function(){if(this._map.style){var m=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?m=m.concat(this.options.customAttribution.map(function(F){return typeof F!="string"?"":F})):typeof this.options.customAttribution=="string"&&m.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var h=this._map.style.sourceCaches;for(var y in h){var S=h[y];if(S.used){var O=S.getSource();O.attribution&&m.indexOf(O.attribution)<0&&m.push(O.attribution)}}m.sort(function(F,X){return F.length-X.length});var M=(m=m.filter(function(F,X){for(var ee=X+1;ee<m.length;ee++)if(m[ee].indexOf(F)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,m.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},us.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var $s=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};$s.prototype.onAdd=function(m){this._map=m,this._container=U.create("div","mapboxgl-ctrl");var d=U.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},$s.prototype.onRemove=function(){U.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},$s.prototype.getDefaultPosition=function(){return"bottom-left"},$s.prototype._updateLogo=function(m){m&&m.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},$s.prototype._logoRequired=function(){if(this._map.style){var m=this._map.style.sourceCaches;for(var d in m)if(m[d].getSource().mapbox_logo)return!0;return!1}},$s.prototype._updateCompact=function(){var m=this._container.children;if(m.length){var d=m[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var Za=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Za.prototype.add=function(m){var d=++this._id;return this._queue.push({callback:m,id:d,cancelled:!1}),d},Za.prototype.remove=function(m){for(var d=this._currentlyRunning,h=0,y=d?this._queue.concat(d):this._queue;h<y.length;h+=1){var S=y[h];if(S.id===m)return void(S.cancelled=!0)}},Za.prototype.run=function(m){m===void 0&&(m=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var h=0,y=d;h<y.length;h+=1){var S=y[h];if(!S.cancelled&&(S.callback(m),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Za.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var nu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},$u=v.window.HTMLImageElement,lc=v.window.HTMLElement,fa=v.window.ImageBitmap,Mo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},zh=function(m){function d(y){var S=this;if((y=v.extend({},Mo,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var O=new Qi(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies);if(m.call(this,O,y),this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Za,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},nu,y.locale),this._clickTolerance=y.clickTolerance,this._requestManager=new v.RequestManager(y.transformRequest,y.accessToken),typeof y.container=="string"){if(this._container=v.window.document.getElementById(y.container),!this._container)throw new Error("Container '"+y.container+"' not found.")}else{if(!(y.container instanceof lc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Fn(this,y),this._hash=y.hash&&new Ns(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,v.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new us({customAttribution:y.customAttribution})),this.addControl(new $s,y.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(M){S._update(M.dataType==="style"),S.fire(new v.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){S.fire(new v.Event(M.dataType+"dataloading",M))})}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var h={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(y,S){if(S===void 0&&(S=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var O=y.onAdd(this);this._controls.push(y);var M=this._controlPositions[S];return S.indexOf("bottom")!==-1?M.insertBefore(O,M.firstChild):M.appendChild(O),this},d.prototype.removeControl=function(y){if(!y||!y.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(y);return S>-1&&this._controls.splice(S,1),y.onRemove(this),this},d.prototype.hasControl=function(y){return this._controls.indexOf(y)>-1},d.prototype.resize=function(y){var S=this._containerDimensions(),O=S[0],M=S[1];if(O===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(O,M),this.transform.resize(O,M),this.painter.resize(O,M);var F=!this._moving;return F&&this.fire(new v.Event("movestart",y)).fire(new v.Event("move",y)),this.fire(new v.Event("resize",y)),F&&this.fire(new v.Event("moveend",y)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(y){return this.transform.setMaxBounds(v.LngLatBounds.convert(y)),this._update()},d.prototype.setMinZoom=function(y){if((y=y==null?-2:y)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(y){if((y=y==null?22:y)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(y){if((y=y==null?0:y)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(y){if((y=y==null?60:y)>60)throw new Error("maxPitch must be less than or equal to 60");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(y){return this.transform.renderWorldCopies=y,this._update()},d.prototype.project=function(y){return this.transform.locationPoint(v.LngLat.convert(y))},d.prototype.unproject=function(y){return this.transform.pointLocation(v.Point.convert(y))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(y,S,O){var M,F=this;if(y==="mouseenter"||y==="mouseover"){var X=!1;return{layer:S,listener:O,delegates:{mousemove:function(_e){var Ee=F.getLayer(S)?F.queryRenderedFeatures(_e.point,{layers:[S]}):[];Ee.length?X||(X=!0,O.call(F,new Va(y,F,_e.originalEvent,{features:Ee}))):X=!1},mouseout:function(){X=!1}}}}if(y==="mouseleave"||y==="mouseout"){var ee=!1;return{layer:S,listener:O,delegates:{mousemove:function(_e){(F.getLayer(S)?F.queryRenderedFeatures(_e.point,{layers:[S]}):[]).length?ee=!0:ee&&(ee=!1,O.call(F,new Va(y,F,_e.originalEvent)))},mouseout:function(_e){ee&&(ee=!1,O.call(F,new Va(y,F,_e.originalEvent)))}}}}return{layer:S,listener:O,delegates:(M={},M[y]=function(ge){var _e=F.getLayer(S)?F.queryRenderedFeatures(ge.point,{layers:[S]}):[];_e.length&&(ge.features=_e,O.call(F,ge),delete ge.features)},M)}},d.prototype.on=function(y,S,O){if(O===void 0)return m.prototype.on.call(this,y,S);var M=this._createDelegatedListener(y,S,O);for(var F in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(M),M.delegates)this.on(F,M.delegates[F]);return this},d.prototype.once=function(y,S,O){if(O===void 0)return m.prototype.once.call(this,y,S);var M=this._createDelegatedListener(y,S,O);for(var F in M.delegates)this.once(F,M.delegates[F]);return this},d.prototype.off=function(y,S,O){var M=this;return O===void 0?m.prototype.off.call(this,y,S):(this._delegatedListeners&&this._delegatedListeners[y]&&function(F){for(var X=F[y],ee=0;ee<X.length;ee++){var ge=X[ee];if(ge.layer===S&&ge.listener===O){for(var _e in ge.delegates)M.off(_e,ge.delegates[_e]);return X.splice(ee,1),M}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(y,S){if(!this.style)return[];var O;if(S!==void 0||y===void 0||y instanceof v.Point||Array.isArray(y)||(S=y,y=void 0),S=S||{},(y=y||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof y[0]=="number")O=[v.Point.convert(y)];else{var M=v.Point.convert(y[0]),F=v.Point.convert(y[1]);O=[M,new v.Point(F.x,M.y),F,new v.Point(M.x,F.y),M]}return this.style.queryRenderedFeatures(O,S,this.transform)},d.prototype.querySourceFeatures=function(y,S){return this.style.querySourceFeatures(y,S)},d.prototype.setStyle=function(y,S){return(S=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(y,S))},d.prototype._getUIString=function(y){var S=this._locale[y];if(S==null)throw new Error("Missing UI string '"+y+"'");return S},d.prototype._updateStyle=function(y,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),y?(this.style=new go(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(y,S){var O=this;if(typeof y=="string"){var M=this._requestManager.normalizeStyleURL(y),F=this._requestManager.transformRequest(M,v.ResourceType.Style);v.getJSON(F,function(X,ee){X?O.fire(new v.ErrorEvent(X)):ee&&O._updateDiff(ee,S)})}else typeof y=="object"&&this._updateDiff(y,S)},d.prototype._updateDiff=function(y,S){try{this.style.setState(y)&&this._update(!0)}catch(O){v.warnOnce("Unable to perform style diff: "+(O.message||O.error||O)+".  Rebuilding the style from scratch."),this._updateStyle(y,S)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(y,S){return this._lazyInitEmptyStyle(),this.style.addSource(y,S),this._update(!0)},d.prototype.isSourceLoaded=function(y){var S=this.style&&this.style.sourceCaches[y];if(S!==void 0)return S.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+y+"'")))},d.prototype.areTilesLoaded=function(){var y=this.style&&this.style.sourceCaches;for(var S in y){var O=y[S]._tiles;for(var M in O){var F=O[M];if(F.state!=="loaded"&&F.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(y,S,O){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,S,O)},d.prototype.removeSource=function(y){return this.style.removeSource(y),this._update(!0)},d.prototype.getSource=function(y){return this.style.getSource(y)},d.prototype.addImage=function(y,S,O){O===void 0&&(O={});var M=O.pixelRatio;M===void 0&&(M=1);var F=O.sdf;F===void 0&&(F=!1);var X=O.stretchX,ee=O.stretchY,ge=O.content;if(this._lazyInitEmptyStyle(),S instanceof $u||fa&&S instanceof fa){var _e=v.browser.getImageData(S);this.style.addImage(y,{data:new v.RGBAImage({width:_e.width,height:_e.height},_e.data),pixelRatio:M,stretchX:X,stretchY:ee,content:ge,sdf:F,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ee=S;this.style.addImage(y,{data:new v.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:M,stretchX:X,stretchY:ee,content:ge,sdf:F,version:0,userImage:Ee}),Ee.onAdd&&Ee.onAdd(this,y)}},d.prototype.updateImage=function(y,S){var O=this.style.getImage(y);if(!O)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=S instanceof $u||fa&&S instanceof fa?v.browser.getImageData(S):S,F=M.width,X=M.height,ee=M.data;return F===void 0||X===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):F!==O.data.width||X!==O.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(O.data.replace(ee,!(S instanceof $u||fa&&S instanceof fa)),void this.style.updateImage(y,O))},d.prototype.hasImage=function(y){return y?!!this.style.getImage(y):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(y){this.style.removeImage(y)},d.prototype.loadImage=function(y,S){v.getImage(this._requestManager.transformRequest(y,v.ResourceType.Image),S)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(y,S){return this._lazyInitEmptyStyle(),this.style.addLayer(y,S),this._update(!0)},d.prototype.moveLayer=function(y,S){return this.style.moveLayer(y,S),this._update(!0)},d.prototype.removeLayer=function(y){return this.style.removeLayer(y),this._update(!0)},d.prototype.getLayer=function(y){return this.style.getLayer(y)},d.prototype.setLayerZoomRange=function(y,S,O){return this.style.setLayerZoomRange(y,S,O),this._update(!0)},d.prototype.setFilter=function(y,S,O){return O===void 0&&(O={}),this.style.setFilter(y,S,O),this._update(!0)},d.prototype.getFilter=function(y){return this.style.getFilter(y)},d.prototype.setPaintProperty=function(y,S,O,M){return M===void 0&&(M={}),this.style.setPaintProperty(y,S,O,M),this._update(!0)},d.prototype.getPaintProperty=function(y,S){return this.style.getPaintProperty(y,S)},d.prototype.setLayoutProperty=function(y,S,O,M){return M===void 0&&(M={}),this.style.setLayoutProperty(y,S,O,M),this._update(!0)},d.prototype.getLayoutProperty=function(y,S){return this.style.getLayoutProperty(y,S)},d.prototype.setLight=function(y,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(y,S),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(y,S){return this.style.setFeatureState(y,S),this._update()},d.prototype.removeFeatureState=function(y,S){return this.style.removeFeatureState(y,S),this._update()},d.prototype.getFeatureState=function(y){return this.style.getFeatureState(y)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var y=0,S=0;return this._container&&(y=this._container.clientWidth||400,S=this._container.clientHeight||300),[y,S]},d.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=U.create("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=U.create("div","mapboxgl-canvas-container",y);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=U.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var O=this._containerDimensions();this._resizeCanvas(O[0],O[1]);var M=this._controlContainer=U.create("div","mapboxgl-control-container",y),F=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(X){F[X]=U.create("div","mapboxgl-ctrl-"+X,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(y,S){var O=v.browser.devicePixelRatio||1;this._canvas.width=O*y,this._canvas.height=O*S,this._canvas.style.width=y+"px",this._canvas.style.height=S+"px"},d.prototype._setupPainter=function(){var y=v.extend({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);S?(this.painter=new Ba(S,this.transform),v.webpSupported.testSupport(S)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:y}))},d.prototype._contextRestored=function(y){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:y}))},d.prototype._onMapScroll=function(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(y){return this._update(),this._renderTaskQueue.add(y)},d.prototype._cancelRenderFrame=function(y){this._renderTaskQueue.remove(y)},d.prototype._render=function(y){var S,O=this,M=0,F=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=F.createQueryEXT(),F.beginQueryEXT(F.TIME_ELAPSED_EXT,S),M=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),!this._removed){var X=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ee=this.transform.zoom,ge=v.browser.now();this.style.zoomHistory.update(ee,ge);var _e=new v.EvaluationParameters(ee,{now:ge,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ee=_e.crossFadingFactor();Ee===1&&Ee===this._crossFadingFactor||(X=!0,this._crossFadingFactor=Ee),this.style.update(_e)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||X)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var qe=v.browser.now()-M;F.endQueryEXT(F.TIME_ELAPSED_EXT,S),setTimeout(function(){var Ye=F.getQueryObjectEXT(S,F.QUERY_RESULT_EXT)/1e6;F.deleteQueryEXT(S),O.fire(new v.Event("gpu-timing-frame",{cpuTime:qe,gpuTime:Ye}))},50)}if(this.listens("gpu-timing-layer")){var $e=this.painter.collectGpuTimers();setTimeout(function(){var Ye=O.painter.queryGpuTimers($e);O.fire(new v.Event("gpu-timing-layer",{layerTimes:Ye}))},50)}var dt=this._sourcesDirty||this._styleDirty||this._placementDirty;return dt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||dt||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var y=0,S=this._controls;y<S.length;y+=1)S[y].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var O=this.painter.context.gl.getExtension("WEBGL_lose_context");O&&O.loseContext(),Hl(this._canvasContainer),Hl(this._controlContainer),Hl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},d.prototype.triggerRepaint=function(){var y=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(S){y._frame=null,y._render(S)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(y){this._trackResize&&this.resize({originalEvent:y})._update()},h.showTileBoundaries.get=function(){return!!this._showTileBoundaries},h.showTileBoundaries.set=function(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())},h.showPadding.get=function(){return!!this._showPadding},h.showPadding.set=function(y){this._showPadding!==y&&(this._showPadding=y,this._update())},h.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},h.showCollisionBoxes.set=function(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())},h.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},h.showOverdrawInspector.set=function(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())},h.repaint.get=function(){return!!this._repaint},h.repaint.set=function(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())},h.vertices.get=function(){return!!this._vertices},h.vertices.set=function(y){this._vertices=y,this._update()},d.prototype._setCacheLimits=function(y,S){v.setCacheLimits(y,S)},h.version.get=function(){return v.version},Object.defineProperties(d.prototype,h),d}(Zs);function Hl(m){m.parentNode&&m.parentNode.removeChild(m)}var qf={showCompass:!0,showZoom:!0,visualizePitch:!1},ml=function(d){var h=this;this.options=v.extend({},qf,d),this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(y){return y.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(y){return h._map.zoomIn({},{originalEvent:y})}),U.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(y){return h._map.zoomOut({},{originalEvent:y})}),U.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(y){h.options.visualizePitch?h._map.resetNorthPitch({},{originalEvent:y}):h._map.resetNorth({},{originalEvent:y})}),this._compassIcon=U.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ml.prototype._updateZoomButtons=function(){var m=this._map.getZoom(),d=m===this._map.getMaxZoom(),h=m===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},ml.prototype._rotateCompassArrow=function(){var m=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=m},ml.prototype.onAdd=function(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ys(this._map,this._compass,this.options.visualizePitch)),this._container},ml.prototype.onRemove=function(){U.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ml.prototype._createButton=function(m,d){var h=U.create("button",m,this._container);return h.type="button",h.addEventListener("click",d),h},ml.prototype._setButtonTitle=function(m,d){var h=this._map._getUIString("NavigationControl."+d);m.title=h,m.setAttribute("aria-label",h)};var Ys=function(d,h,y){y===void 0&&(y=!1),this._clickTolerance=10,this.element=h,this.mouseRotate=new gf({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,y&&(this.mousePitch=new Kf({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),U.addEventListener(h,"mousedown",this.mousedown),U.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),U.addEventListener(h,"touchmove",this.touchmove),U.addEventListener(h,"touchend",this.touchend),U.addEventListener(h,"touchcancel",this.reset)};function cc(m,d,h){if(m=new v.LngLat(m.lng,m.lat),d){var y=new v.LngLat(m.lng-360,m.lat),S=new v.LngLat(m.lng+360,m.lat),O=h.locationPoint(m).distSqr(d);h.locationPoint(y).distSqr(d)<O?m=y:h.locationPoint(S).distSqr(d)<O&&(m=S)}for(;Math.abs(m.lng-h.center.lng)>180;){var M=h.locationPoint(m);if(M.x>=0&&M.y>=0&&M.x<=h.width&&M.y<=h.height)break;m.lng>h.center.lng?m.lng-=360:m.lng+=360}return m}Ys.prototype.down=function(m,d){this.mouseRotate.mousedown(m,d),this.mousePitch&&this.mousePitch.mousedown(m,d),U.disableDrag()},Ys.prototype.move=function(m,d){var h=this.map,y=this.mouseRotate.mousemoveWindow(m,d);if(y&&y.bearingDelta&&h.setBearing(h.getBearing()+y.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(m,d);S&&S.pitchDelta&&h.setPitch(h.getPitch()+S.pitchDelta)}},Ys.prototype.off=function(){var m=this.element;U.removeEventListener(m,"mousedown",this.mousedown),U.removeEventListener(m,"touchstart",this.touchstart,{passive:!1}),U.removeEventListener(m,"touchmove",this.touchmove),U.removeEventListener(m,"touchend",this.touchend),U.removeEventListener(m,"touchcancel",this.reset),this.offTemp()},Ys.prototype.offTemp=function(){U.enableDrag(),U.removeEventListener(v.window,"mousemove",this.mousemove),U.removeEventListener(v.window,"mouseup",this.mouseup)},Ys.prototype.mousedown=function(m){this.down(v.extend({},m,{ctrlKey:!0,preventDefault:function(){return m.preventDefault()}}),U.mousePos(this.element,m)),U.addEventListener(v.window,"mousemove",this.mousemove),U.addEventListener(v.window,"mouseup",this.mouseup)},Ys.prototype.mousemove=function(m){this.move(m,U.mousePos(this.element,m))},Ys.prototype.mouseup=function(m){this.mouseRotate.mouseupWindow(m),this.mousePitch&&this.mousePitch.mouseupWindow(m),this.offTemp()},Ys.prototype.touchstart=function(m){m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=U.touchPos(this.element,m.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return m.preventDefault()}},this._startPos))},Ys.prototype.touchmove=function(m){m.targetTouches.length!==1?this.reset():(this._lastPos=U.touchPos(this.element,m.targetTouches)[0],this.move({preventDefault:function(){return m.preventDefault()}},this._lastPos))},Ys.prototype.touchend=function(m){m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ys.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var gl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qf(m,d,h){var y=m.classList;for(var S in gl)y.remove("mapboxgl-"+h+"-anchor-"+S);y.add("mapboxgl-"+h+"-anchor-"+d)}var Nc,jc=function(m){function d(h,y){if(m.call(this),(h instanceof v.window.HTMLElement||y)&&(h=v.extend({element:h},y)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=h&&h.anchor||"center",this._color=h&&h.color||"#3FB1CE",this._scale=h&&h.scale||1,this._draggable=h&&h.draggable||!1,this._clickTolerance=h&&h.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=h&&h.rotation||0,this._rotationAlignment=h&&h.rotationAlignment||"auto",this._pitchAlignment=h&&h.pitchAlignment&&h.pitchAlignment!=="auto"?h.pitchAlignment:this._rotationAlignment,h&&h.element)this._element=h.element,this._offset=v.Point.convert(h&&h.offset||[0,0]);else{this._defaultMarker=!0,this._element=U.create("div"),this._element.setAttribute("aria-label","Map marker");var S=U.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var O=U.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"stroke","none"),O.setAttributeNS(null,"stroke-width","1"),O.setAttributeNS(null,"fill","none"),O.setAttributeNS(null,"fill-rule","evenodd");var M=U.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var F=U.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");for(var X=0,ee=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];X<ee.length;X+=1){var ge=ee[X],_e=U.createNS("http://www.w3.org/2000/svg","ellipse");_e.setAttributeNS(null,"opacity","0.04"),_e.setAttributeNS(null,"cx","10.5"),_e.setAttributeNS(null,"cy","5.80029008"),_e.setAttributeNS(null,"rx",ge.rx),_e.setAttributeNS(null,"ry",ge.ry),F.appendChild(_e)}var Ee=U.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"fill",this._color);var qe=U.createNS("http://www.w3.org/2000/svg","path");qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ee.appendChild(qe);var $e=U.createNS("http://www.w3.org/2000/svg","g");$e.setAttributeNS(null,"opacity","0.25"),$e.setAttributeNS(null,"fill","#000000");var dt=U.createNS("http://www.w3.org/2000/svg","path");dt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$e.appendChild(dt);var Ye=U.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ye.setAttributeNS(null,"fill","#FFFFFF");var ot=U.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Mt=U.createNS("http://www.w3.org/2000/svg","circle");Mt.setAttributeNS(null,"fill","#000000"),Mt.setAttributeNS(null,"opacity","0.25"),Mt.setAttributeNS(null,"cx","5.5"),Mt.setAttributeNS(null,"cy","5.5"),Mt.setAttributeNS(null,"r","5.4999962");var Pt=U.createNS("http://www.w3.org/2000/svg","circle");Pt.setAttributeNS(null,"fill","#FFFFFF"),Pt.setAttributeNS(null,"cx","5.5"),Pt.setAttributeNS(null,"cy","5.5"),Pt.setAttributeNS(null,"r","5.4999962"),ot.appendChild(Mt),ot.appendChild(Pt),M.appendChild(F),M.appendChild(Ee),M.appendChild($e),M.appendChild(Ye),M.appendChild(ot),S.appendChild(M),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=v.Point.convert(h&&h.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(dr){dr.preventDefault()}),this._element.addEventListener("mousedown",function(dr){dr.preventDefault()}),Qf(this._element,this._anchor,"marker"),this._popup=null}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.addTo=function(h){return this.remove(),this._map=h,h.getCanvasContainer().appendChild(this._element),h.on("move",this._update),h.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),U.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=v.LngLat.convert(h),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(h){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),h){if(!("offset"in h.options)){var y=Math.sqrt(Math.pow(13.5,2)/2);h.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=h,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(h){var y=h.code,S=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&S!==32&&S!==13||this.togglePopup()},d.prototype._onMapClick=function(h){var y=h.originalEvent.target,S=this._element;this._popup&&(y===S||S.contains(y))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var h=this._popup;return h?(h.isOpen()?h.remove():h.addTo(this._map),this):this},d.prototype._update=function(h){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=cc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(y="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),h&&h.type!=="moveend"||(this._pos=this._pos.round()),U.setTransform(this._element,gl[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+y)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(h){return this._offset=v.Point.convert(h),this._update(),this},d.prototype._onMove=function(h){if(!this._isDragging){var y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(h){this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(h){return this._draggable=!!h,this._map&&(h?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(h){return this._rotation=h||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(h){return this._rotationAlignment=h||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(h){return this._pitchAlignment=h&&h!=="auto"?h:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(v.Evented),bf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},yl=0,Wl=!1,Jf=function(m){function d(h){m.call(this),this.options=v.extend({},bf,h),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.onAdd=function(h){var y;return this._map=h,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,Nc!==void 0?y(Nc):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(S){y(Nc=S.state!=="denied")}):y(Nc=!!v.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),U.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,yl=0,Wl=!1},d.prototype._isOutOfMapMaxBounds=function(h){var y=this._map.getMaxBounds(),S=h.coords;return y&&(S.longitude<y.getWest()||S.longitude>y.getEast()||S.latitude<y.getSouth()||S.latitude>y.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",h)),this._finish()}},d.prototype._updateCamera=function(h){var y=new v.LngLat(h.coords.longitude,h.coords.latitude),S=h.coords.accuracy,O=this._map.getBearing(),M=v.extend({bearing:O},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(S),M,{geolocateSource:!0})},d.prototype._updateMarker=function(h){if(h){var y=new v.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var h=this._map._container.clientHeight/2,y=this._map.unproject([0,h]),S=this._map.unproject([1,h]),O=y.distanceTo(S),M=Math.ceil(2*this._accuracy/O);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Wl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",h)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(h){var y=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=U.create("button","mapboxgl-ctrl-geolocate",this._container),U.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",h===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var O=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=O,this._geolocateButton.setAttribute("aria-label",O)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new jc(this._dotElement),this._circleElement=U.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||y._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(y._watchState="BACKGROUND",y._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),y._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),y.fire(new v.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":yl--,Wl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++yl>1?(h={maximumAge:6e5,timeout:0},Wl=!0):(h=this.options.positionOptions,Wl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(v.Evented),Au={maxWidth:100,unit:"metric"},Tu=function(d){this.options=v.extend({},Au,d),v.bindAll(["_onMove","setUnit"],this)};function eh(m,d,h){var y=h&&h.maxWidth||100,S=m._container.clientHeight/2,O=m.unproject([0,S]),M=m.unproject([y,S]),F=O.distanceTo(M);if(h&&h.unit==="imperial"){var X=3.2808*F;X>5280?Zt(d,y,X/5280,m._getUIString("ScaleControl.Miles")):Zt(d,y,X,m._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Zt(d,y,F/1852,m._getUIString("ScaleControl.NauticalMiles")):F>=1e3?Zt(d,y,F/1e3,m._getUIString("ScaleControl.Kilometers")):Zt(d,y,F,m._getUIString("ScaleControl.Meters"))}function Zt(m,d,h,y){var S,O,M,F=(S=h,(O=Math.pow(10,(""+Math.floor(S)).length-1))*(M=(M=S/O)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(X){var ee=Math.pow(10,Math.ceil(-Math.log(X)/Math.LN10));return Math.round(X*ee)/ee}(M)));m.style.width=d*(F/h)+"px",m.innerHTML=F+"&nbsp;"+y}Tu.prototype.getDefaultPosition=function(){return"bottom-left"},Tu.prototype._onMove=function(){eh(this._map,this._container,this.options)},Tu.prototype.onAdd=function(m){return this._map=m,this._container=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Tu.prototype.onRemove=function(){U.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Tu.prototype.setUnit=function(m){this.options.unit=m,eh(this._map,this._container,this.options)};var Be=function(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof v.window.HTMLElement?this._container=d.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Be.prototype.onAdd=function(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=U.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Be.prototype.onRemove=function(){U.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Be.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Be.prototype._setupUI=function(){var m=this._fullscreenButton=U.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Be.prototype._updateTitle=function(){var m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m},Be.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Be.prototype._isFullscreen=function(){return this._fullscreen},Be.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Be.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Uh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},be=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),th=function(m){function d(h){m.call(this),this.options=v.extend(Object.create(Uh),h),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.addTo=function(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&U.remove(this._content),this._container&&(U.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(h){return this._lngLat=v.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(h){return this.setDOMContent(v.window.document.createTextNode(h))},d.prototype.setHTML=function(h){var y,S=v.window.document.createDocumentFragment(),O=v.window.document.createElement("body");for(O.innerHTML=h;y=O.firstChild;)S.appendChild(y);return this.setDOMContent(S)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(h){return this.options.maxWidth=h,this._update(),this},d.prototype.setDOMContent=function(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=U.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(h){this._container&&this._container.classList.add(h)},d.prototype.removeClassName=function(h){this._container&&this._container.classList.remove(h)},d.prototype.setOffset=function(h){return this.options.offset=h,this._update(),this},d.prototype.toggleClassName=function(h){if(this._container)return this._container.classList.toggle(h)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=U.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(h){this._update(h.point)},d.prototype._onMouseMove=function(h){this._update(h.point)},d.prototype._onDrag=function(h){this._update(h.point)},d.prototype._update=function(h){var y=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=U.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=U.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(_e){return y._container.classList.add(_e)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||h)){var S=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat),O=this.options.anchor,M=function _e(Ee){if(Ee){if(typeof Ee=="number"){var qe=Math.round(Math.sqrt(.5*Math.pow(Ee,2)));return{center:new v.Point(0,0),top:new v.Point(0,Ee),"top-left":new v.Point(qe,qe),"top-right":new v.Point(-qe,qe),bottom:new v.Point(0,-Ee),"bottom-left":new v.Point(qe,-qe),"bottom-right":new v.Point(-qe,-qe),left:new v.Point(Ee,0),right:new v.Point(-Ee,0)}}if(Ee instanceof v.Point||Array.isArray(Ee)){var $e=v.Point.convert(Ee);return{center:$e,top:$e,"top-left":$e,"top-right":$e,bottom:$e,"bottom-left":$e,"bottom-right":$e,left:$e,right:$e}}return{center:v.Point.convert(Ee.center||[0,0]),top:v.Point.convert(Ee.top||[0,0]),"top-left":v.Point.convert(Ee["top-left"]||[0,0]),"top-right":v.Point.convert(Ee["top-right"]||[0,0]),bottom:v.Point.convert(Ee.bottom||[0,0]),"bottom-left":v.Point.convert(Ee["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(Ee["bottom-right"]||[0,0]),left:v.Point.convert(Ee.left||[0,0]),right:v.Point.convert(Ee.right||[0,0])}}return _e(new v.Point(0,0))}(this.options.offset);if(!O){var F,X=this._container.offsetWidth,ee=this._container.offsetHeight;F=S.y+M.bottom.y<ee?["top"]:S.y>this._map.transform.height-ee?["bottom"]:[],S.x<X/2?F.push("left"):S.x>this._map.transform.width-X/2&&F.push("right"),O=F.length===0?"bottom":F.join("-")}var ge=S.add(M[O]).round();U.setTransform(this._container,gl[O]+" translate("+ge.x+"px,"+ge.y+"px)"),Qf(this._container,O,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var h=this._container.querySelector(be);h&&h.focus()}},d.prototype._onClose=function(){this.remove()},d}(v.Evented),Po={version:v.version,supported:L,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:zh,NavigationControl:ml,GeolocateControl:Jf,AttributionControl:us,ScaleControl:Tu,FullscreenControl:Be,Popup:th,Marker:jc,Style:go,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){ut().acquire(pr)},clearPrewarmedResources:function(){var d=et;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(pr),et=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(m){v.config.ACCESS_TOKEN=m},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(m){v.config.API_URL=m},get workerCount(){return De.workerCount},set workerCount(m){De.workerCount=m},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){v.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage:function(d){v.clearTileCache(d)},workerUrl:""};return Po}),z})},"4cb6":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.multiBindToService=Z.getServiceIdentifierAsString=Z.typeConstraint=Z.namedConstraint=Z.taggedConstraint=Z.traverseAncerstors=Z.decorate=Z.id=Z.MetadataReader=Z.postConstruct=Z.targetName=Z.multiInject=Z.unmanaged=Z.optional=Z.LazyServiceIdentifer=Z.inject=Z.named=Z.tagged=Z.injectable=Z.ContainerModule=Z.AsyncContainerModule=Z.TargetTypeEnum=Z.BindingTypeEnum=Z.BindingScopeEnum=Z.Container=Z.METADATA_KEY=void 0;var D=C("xfSm");Z.METADATA_KEY=D;var N=C("9Fde");Object.defineProperty(Z,"Container",{enumerable:!0,get:function(){return N.Container}});var z=C("FV85");Object.defineProperty(Z,"BindingScopeEnum",{enumerable:!0,get:function(){return z.BindingScopeEnum}}),Object.defineProperty(Z,"BindingTypeEnum",{enumerable:!0,get:function(){return z.BindingTypeEnum}}),Object.defineProperty(Z,"TargetTypeEnum",{enumerable:!0,get:function(){return z.TargetTypeEnum}});var k=C("dxzI");Object.defineProperty(Z,"AsyncContainerModule",{enumerable:!0,get:function(){return k.AsyncContainerModule}}),Object.defineProperty(Z,"ContainerModule",{enumerable:!0,get:function(){return k.ContainerModule}});var v=C("cZ5Q");Object.defineProperty(Z,"injectable",{enumerable:!0,get:function(){return v.injectable}});var L=C("0gSV");Object.defineProperty(Z,"tagged",{enumerable:!0,get:function(){return L.tagged}});var U=C("ZzCi");Object.defineProperty(Z,"named",{enumerable:!0,get:function(){return U.named}});var K=C("Yk9n");Object.defineProperty(Z,"inject",{enumerable:!0,get:function(){return K.inject}}),Object.defineProperty(Z,"LazyServiceIdentifer",{enumerable:!0,get:function(){return K.LazyServiceIdentifer}});var q=C("jYx5");Object.defineProperty(Z,"optional",{enumerable:!0,get:function(){return q.optional}});var fe=C("n2J3");Object.defineProperty(Z,"unmanaged",{enumerable:!0,get:function(){return fe.unmanaged}});var ue=C("jIg/");Object.defineProperty(Z,"multiInject",{enumerable:!0,get:function(){return ue.multiInject}});var rt=C("oaX6");Object.defineProperty(Z,"targetName",{enumerable:!0,get:function(){return rt.targetName}});var Ne=C("Sk89");Object.defineProperty(Z,"postConstruct",{enumerable:!0,get:function(){return Ne.postConstruct}});var nt=C("wnjb");Object.defineProperty(Z,"MetadataReader",{enumerable:!0,get:function(){return nt.MetadataReader}});var wt=C("d9O0");Object.defineProperty(Z,"id",{enumerable:!0,get:function(){return wt.id}});var ht=C("Ztfv");Object.defineProperty(Z,"decorate",{enumerable:!0,get:function(){return ht.decorate}});var We=C("RR/i");Object.defineProperty(Z,"traverseAncerstors",{enumerable:!0,get:function(){return We.traverseAncerstors}}),Object.defineProperty(Z,"taggedConstraint",{enumerable:!0,get:function(){return We.taggedConstraint}}),Object.defineProperty(Z,"namedConstraint",{enumerable:!0,get:function(){return We.namedConstraint}}),Object.defineProperty(Z,"typeConstraint",{enumerable:!0,get:function(){return We.typeConstraint}});var St=C("ujMp");Object.defineProperty(Z,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return St.getServiceIdentifierAsString}});var Je=C("78VC");Object.defineProperty(Z,"multiBindToService",{enumerable:!0,get:function(){return Je.multiBindToService}})},"4qC0":function(se,Z,C){var D=C("NykK"),N=C("Z0cm"),z=C("ExA7"),k="[object String]";function v(L){return typeof L=="string"||!N(L)&&z(L)&&D(L)==k}se.exports=v},"4uTw":function(se,Z,C){var D=C("Z0cm"),N=C("9ggG"),z=C("GNiM"),k=C("dt0z");function v(L,U){return D(L)?L:N(L,U)?[L]:z(k(L))}se.exports=v},"5Tg0":function(se,Z,C){(function(D){var N=C("Kz5y"),z=Z&&!Z.nodeType&&Z,k=z&&typeof D=="object"&&D&&!D.nodeType&&D,v=k&&k.exports===z,L=v?N.Buffer:void 0,U=L?L.allocUnsafe:void 0;function K(q,fe){if(fe)return q.slice();var ue=q.length,rt=U?U(ue):new q.constructor(ue);return q.copy(rt),rt}D.exports=K}).call(this,C("hOG+")(se))},"623A":function(se,Z,C){"use strict";(function(D,N){se.exports=N()})(this,function(){function D(fe){var ue=[];return fe.AMapUI&&ue.push(N(fe.AMapUI)),fe.Loca&&ue.push(z(fe.Loca)),Promise.all(ue)}function N(fe){return new Promise(function(ue,rt){var Ne=[];if(fe.plugins)for(var nt=0;nt<fe.plugins.length;nt+=1)v.AMapUI.plugins.indexOf(fe.plugins[nt])==-1&&Ne.push(fe.plugins[nt]);if(L.AMapUI===k.failed)rt("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(L.AMapUI===k.notload){L.AMapUI=k.loading,v.AMapUI.version=fe.version||v.AMapUI.version,nt=v.AMapUI.version;var wt=document.body||document.head,ht=document.createElement("script");ht.type="text/javascript",ht.src="https://webapi.amap.com/ui/"+nt+"/main.js",ht.onerror=function(We){L.AMapUI=k.failed,rt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},ht.onload=function(){if(L.AMapUI=k.loaded,Ne.length)window.AMapUI.loadUI(Ne,function(){for(var We=0,St=Ne.length;We<St;We++){var Je=Ne[We].split("/").slice(-1)[0];window.AMapUI[Je]=arguments[We]}for(ue();U.AMapUI.length;)U.AMapUI.splice(0,1)[0]()});else for(ue();U.AMapUI.length;)U.AMapUI.splice(0,1)[0]()},wt.appendChild(ht)}else L.AMapUI===k.loaded?fe.version&&fe.version!==v.AMapUI.version?rt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):Ne.length?window.AMapUI.loadUI(Ne,function(){for(var We=0,St=Ne.length;We<St;We++){var Je=Ne[We].split("/").slice(-1)[0];window.AMapUI[Je]=arguments[We]}ue()}):ue():fe.version&&fe.version!==v.AMapUI.version?rt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):U.AMapUI.push(function(We){We?rt(We):Ne.length?window.AMapUI.loadUI(Ne,function(){for(var St=0,Je=Ne.length;St<Je;St++){var Ft=Ne[St].split("/").slice(-1)[0];window.AMapUI[Ft]=arguments[St]}ue()}):ue()})})}function z(fe){return new Promise(function(ue,rt){if(v.AMap.version.startsWith("2.0"))rt("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(L.Loca===k.failed)rt("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(L.Loca===k.notload){L.Loca=k.loading,v.Loca.version=fe.version||v.Loca.version;var Ne=v.Loca.version,nt=v.key,wt=document.body||document.head,ht=document.createElement("script");ht.type="text/javascript",ht.src="https://webapi.amap.com/loca?v="+Ne+"&key="+nt,ht.onerror=function(We){L.Loca=k.failed,rt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},ht.onload=function(){for(L.Loca=k.loaded,ue();U.Loca.length;)U.Loca.splice(0,1)[0]()},wt.appendChild(ht)}else L.Loca===k.loaded?fe.version&&fe.version!==v.Loca.version?rt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):ue():fe.version&&fe.version!==v.Loca.version?rt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):U.Loca.push(function(We){We?rt(We):rt()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var k;(function(fe){fe.notload="notload",fe.loading="loading",fe.loaded="loaded",fe.failed="failed"})(k||(k={}));var v={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},L={AMap:k.notload,AMapUI:k.notload,Loca:k.notload},U={AMap:[],AMapUI:[],Loca:[]},K=[],q=function(ue){typeof ue=="function"&&(L.AMap===k.loaded?ue(window.AMap):K.push(ue))};return{load:function(ue){return new Promise(function(rt,Ne){if(L.AMap==k.failed)Ne("");else if(L.AMap==k.notload){var nt=ue.key,wt=ue.version,ht=ue.plugins;nt?(window.AMap&&location.host!=="lbs.amap.com"&&Ne("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),v.key=nt,v.AMap.version=wt||v.AMap.version,v.AMap.plugins=ht||v.AMap.plugins,L.AMap=k.loading,wt=document.body||document.head,window.___onAPILoaded=function(St){if(delete window.___onAPILoaded,St)L.AMap=k.failed,Ne(St);else for(L.AMap=k.loaded,D(ue).then(function(){rt(window.AMap)}).catch(Ne);K.length;)K.splice(0,1)[0]()},ht=document.createElement("script"),ht.type="text/javascript",ht.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+v.AMap.version+"&key="+nt+"&plugin="+v.AMap.plugins.join(","),ht.onerror=function(St){L.AMap=k.failed,Ne(St)},wt.appendChild(ht)):Ne("\u8BF7\u586B\u5199key")}else if(L.AMap==k.loaded)if(ue.key&&ue.key!==v.key)Ne("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(ue.version&&ue.version!==v.AMap.version)Ne("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(nt=[],ue.plugins)for(wt=0;wt<ue.plugins.length;wt+=1)v.AMap.plugins.indexOf(ue.plugins[wt])==-1&&nt.push(ue.plugins[wt]);nt.length?window.AMap.plugin(nt,function(){D(ue).then(function(){rt(window.AMap)}).catch(Ne)}):D(ue).then(function(){rt(window.AMap)}).catch(Ne)}else if(ue.key&&ue.key!==v.key)Ne("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(ue.version&&ue.version!==v.AMap.version)Ne("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var We=[];if(ue.plugins)for(wt=0;wt<ue.plugins.length;wt+=1)v.AMap.plugins.indexOf(ue.plugins[wt])==-1&&We.push(ue.plugins[wt]);q(function(){We.length?window.AMap.plugin(We,function(){D(ue).then(function(){rt(window.AMap)}).catch(Ne)}):D(ue).then(function(){rt(window.AMap)}).catch(Ne)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,v={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},L={AMap:k.notload,AMapUI:k.notload,Loca:k.notload},U={AMap:[],AMapUI:[],Loca:[]}}}})},"68d/":function(se,Z,C){"use strict";C.d(Z,"b",function(){return wz}),C.d(Z,"c",function(){return BV}),C.d(Z,"a",function(){return LV});var D={};C.r(D),C.d(D,"getContainer",function(){return sc}),C.d(D,"trim",function(){return Ws}),C.d(D,"splitWords",function(){return lf}),C.d(D,"create",function(){return kh}),C.d(D,"remove",function(){return Nl}),C.d(D,"addClass",function(){return Hu}),C.d(D,"removeClass",function(){return Ic}),C.d(D,"hasClass",function(){return Dc}),C.d(D,"setClass",function(){return Wu}),C.d(D,"getClass",function(){return Vf}),C.d(D,"empty",function(){return Hf}),C.d(D,"setTransform",function(){return Wf}),C.d(D,"triggerResize",function(){return dp}),C.d(D,"printCanvas",function(){return Gf}),C.d(D,"getViewPortScale",function(){return Xf}),C.d(D,"DPR",function(){return cf}),C.d(D,"addStyle",function(){return Bh}),C.d(D,"getStyleList",function(){return vl}),C.d(D,"removeStyle",function(){return Lh}),C.d(D,"css2Style",function(){return jl}),C.d(D,"getDiffRect",function(){return Ba}),C.d(D,"setChecked",function(){return Zf}),C.d(D,"clearChildren",function(){return Gu}),C.d(D,"setUnDraggable",function(){return zl}),C.d(D,"appendElementType",function(){return Qi}),C.d(D,"findParentElement",function(){return La});var N={};C.r(N),C.d(N,"max",function(){return jc}),C.d(N,"mean",function(){return Wl}),C.d(N,"min",function(){return bf}),C.d(N,"mode",function(){return Jf}),C.d(N,"sum",function(){return yl}),C.d(N,"statMap",function(){return Au}),C.d(N,"getColumn",function(){return Tu}),C.d(N,"getSatByColumn",function(){return eh});var z={};C.r(z),C.d(z,"create",function(){return dd}),C.d(z,"clone",function(){return vd}),C.d(z,"copy",function(){return md}),C.d(z,"identity",function(){return xl}),C.d(z,"fromValues",function(){return Wc}),C.d(z,"set",function(){return hv}),C.d(z,"transpose",function(){return pv}),C.d(z,"invert",function(){return dv}),C.d(z,"adjoint",function(){return vv}),C.d(z,"determinant",function(){return Af}),C.d(z,"multiply",function(){return mv}),C.d(z,"rotate",function(){return Zl}),C.d(z,"scale",function(){return gd}),C.d(z,"fromRotation",function(){return Tf}),C.d(z,"fromScaling",function(){return Gc}),C.d(z,"str",function(){return gv}),C.d(z,"frob",function(){return Xc}),C.d(z,"LDU",function(){return xp}),C.d(z,"add",function(){return Ep}),C.d(z,"subtract",function(){return Os}),C.d(z,"exactEquals",function(){return Rs}),C.d(z,"equals",function(){return Uo}),C.d(z,"multiplyScalar",function(){return gu}),C.d(z,"multiplyScalarAndAdd",function(){return yv}),C.d(z,"mul",function(){return Gh}),C.d(z,"sub",function(){return _v});var k={};C.r(k),C.d(k,"create",function(){return Dm}),C.d(k,"clone",function(){return km}),C.d(k,"copy",function(){return bv}),C.d(k,"fromValues",function(){return Fm}),C.d(k,"set",function(){return xv}),C.d(k,"identity",function(){return Ms}),C.d(k,"transpose",function(){return Bm}),C.d(k,"invert",function(){return yd}),C.d(k,"adjoint",function(){return _d}),C.d(k,"determinant",function(){return Ev}),C.d(k,"multiply",function(){return Cf}),C.d(k,"translate",function(){return Sp}),C.d(k,"scale",function(){return Ap}),C.d(k,"rotate",function(){return Sv}),C.d(k,"rotateX",function(){return bd}),C.d(k,"rotateY",function(){return Q}),C.d(k,"rotateZ",function(){return de}),C.d(k,"fromTranslation",function(){return st}),C.d(k,"fromScaling",function(){return qt}),C.d(k,"fromRotation",function(){return Sr}),C.d(k,"fromXRotation",function(){return _r}),C.d(k,"fromYRotation",function(){return Bt}),C.d(k,"fromZRotation",function(){return Ur}),C.d(k,"fromRotationTranslation",function(){return $r}),C.d(k,"fromQuat2",function(){return tn}),C.d(k,"getTranslation",function(){return Kr}),C.d(k,"getScaling",function(){return nn}),C.d(k,"getRotation",function(){return mn}),C.d(k,"fromRotationTranslationScale",function(){return sn}),C.d(k,"fromRotationTranslationScaleOrigin",function(){return Yr}),C.d(k,"fromQuat",function(){return rr}),C.d(k,"frustum",function(){return Qt}),C.d(k,"perspectiveNO",function(){return Wr}),C.d(k,"perspective",function(){return bn}),C.d(k,"perspectiveZO",function(){return xr}),C.d(k,"perspectiveFromFieldOfView",function(){return Zn}),C.d(k,"orthoNO",function(){return jr}),C.d(k,"ortho",function(){return an}),C.d(k,"orthoZO",function(){return Lr}),C.d(k,"lookAt",function(){return un}),C.d(k,"targetTo",function(){return $n}),C.d(k,"str",function(){return bi}),C.d(k,"frob",function(){return fn}),C.d(k,"add",function(){return Gr}),C.d(k,"subtract",function(){return Pr}),C.d(k,"multiplyScalar",function(){return Qn}),C.d(k,"multiplyScalarAndAdd",function(){return Vi}),C.d(k,"exactEquals",function(){return En}),C.d(k,"equals",function(){return wi}),C.d(k,"mul",function(){return gi}),C.d(k,"sub",function(){return si});var v={};C.r(v),C.d(v,"create",function(){return oa}),C.d(v,"clone",function(){return Io}),C.d(v,"fromValues",function(){return hs}),C.d(v,"copy",function(){return Gi}),C.d(v,"set",function(){return Do}),C.d(v,"add",function(){return Pa}),C.d(v,"subtract",function(){return ko}),C.d(v,"multiply",function(){return Fo}),C.d(v,"divide",function(){return uo}),C.d(v,"ceil",function(){return ts}),C.d(v,"floor",function(){return Ps}),C.d(v,"min",function(){return Vo}),C.d(v,"max",function(){return ki}),C.d(v,"round",function(){return Ss}),C.d(v,"scale",function(){return ha}),C.d(v,"scaleAndAdd",function(){return ui}),C.d(v,"distance",function(){return Oi}),C.d(v,"squaredDistance",function(){return ra}),C.d(v,"length",function(){return ps}),C.d(v,"squaredLength",function(){return Us}),C.d(v,"negate",function(){return Ze}),C.d(v,"inverse",function(){return fr}),C.d(v,"normalize",function(){return Kt}),C.d(v,"dot",function(){return Sn}),C.d(v,"cross",function(){return Ri}),C.d(v,"lerp",function(){return xa}),C.d(v,"random",function(){return ye}),C.d(v,"transformMat2",function(){return ke}),C.d(v,"transformMat2d",function(){return it}),C.d(v,"transformMat3",function(){return er}),C.d(v,"transformMat4",function(){return $t}),C.d(v,"rotate",function(){return gt}),C.d(v,"angle",function(){return Et}),C.d(v,"zero",function(){return Ct}),C.d(v,"str",function(){return Ge}),C.d(v,"exactEquals",function(){return _t}),C.d(v,"equals",function(){return Pe}),C.d(v,"len",function(){return xt}),C.d(v,"sub",function(){return hr}),C.d(v,"mul",function(){return vr}),C.d(v,"div",function(){return Nr}),C.d(v,"dist",function(){return kr}),C.d(v,"sqrDist",function(){return Hr}),C.d(v,"sqrLen",function(){return Wn}),C.d(v,"forEach",function(){return Dn});var L={};C.r(L),C.d(L,"create",function(){return Bn}),C.d(L,"clone",function(){return ai}),C.d(L,"length",function(){return hi}),C.d(L,"fromValues",function(){return pa}),C.d(L,"copy",function(){return Ho}),C.d(L,"set",function(){return El}),C.d(L,"add",function(){return xd}),C.d(L,"subtract",function(){return Ou}),C.d(L,"multiply",function(){return Ed}),C.d(L,"divide",function(){return $l}),C.d(L,"ceil",function(){return Sd}),C.d(L,"floor",function(){return Qg}),C.d(L,"min",function(){return Jg}),C.d(L,"max",function(){return ey}),C.d(L,"round",function(){return Av}),C.d(L,"scale",function(){return Xh}),C.d(L,"scaleAndAdd",function(){return Lm}),C.d(L,"distance",function(){return Zh}),C.d(L,"squaredDistance",function(){return Nm}),C.d(L,"squaredLength",function(){return Wo}),C.d(L,"negate",function(){return qa}),C.d(L,"inverse",function(){return ty}),C.d(L,"normalize",function(){return ry}),C.d(L,"dot",function(){return jm}),C.d(L,"cross",function(){return ny}),C.d(L,"lerp",function(){return iy}),C.d(L,"hermite",function(){return zm}),C.d(L,"bezier",function(){return $h}),C.d(L,"random",function(){return Yh}),C.d(L,"transformMat4",function(){return ay}),C.d(L,"transformMat3",function(){return rs}),C.d(L,"transformQuat",function(){return Ad}),C.d(L,"rotateX",function(){return wf}),C.d(L,"rotateY",function(){return Tv}),C.d(L,"rotateZ",function(){return Cv}),C.d(L,"angle",function(){return Um}),C.d(L,"zero",function(){return Tp}),C.d(L,"str",function(){return Of}),C.d(L,"exactEquals",function(){return oy}),C.d(L,"equals",function(){return sy}),C.d(L,"sub",function(){return g_}),C.d(L,"mul",function(){return As}),C.d(L,"div",function(){return sh}),C.d(L,"dist",function(){return uy}),C.d(L,"sqrDist",function(){return s}),C.d(L,"len",function(){return u}),C.d(L,"sqrLen",function(){return f}),C.d(L,"forEach",function(){return g});var U={};C.r(U),C.d(U,"create",function(){return b}),C.d(U,"clone",function(){return E}),C.d(U,"fromValues",function(){return T}),C.d(U,"copy",function(){return R}),C.d(U,"set",function(){return j}),C.d(U,"add",function(){return G}),C.d(U,"subtract",function(){return $}),C.d(U,"multiply",function(){return te}),C.d(U,"divide",function(){return ne}),C.d(U,"ceil",function(){return Se}),C.d(U,"floor",function(){return Ve}),C.d(U,"min",function(){return Le}),C.d(U,"max",function(){return ct}),C.d(U,"round",function(){return ft}),C.d(U,"scale",function(){return Rt}),C.d(U,"scaleAndAdd",function(){return Ht}),C.d(U,"distance",function(){return nr}),C.d(U,"squaredDistance",function(){return Rr}),C.d(U,"length",function(){return gr}),C.d(U,"squaredLength",function(){return rn}),C.d(U,"negate",function(){return on}),C.d(U,"inverse",function(){return kn}),C.d(U,"normalize",function(){return Gn}),C.d(U,"dot",function(){return zn}),C.d(U,"cross",function(){return Rn}),C.d(U,"lerp",function(){return yi}),C.d(U,"random",function(){return Jn}),C.d(U,"transformMat4",function(){return Xn}),C.d(U,"transformQuat",function(){return Ki}),C.d(U,"zero",function(){return Mi}),C.d(U,"str",function(){return ya}),C.d(U,"exactEquals",function(){return li}),C.d(U,"equals",function(){return ta}),C.d(U,"sub",function(){return Qa}),C.d(U,"mul",function(){return Wa}),C.d(U,"div",function(){return ho}),C.d(U,"dist",function(){return po}),C.d(U,"sqrDist",function(){return Ao}),C.d(U,"len",function(){return Is}),C.d(U,"sqrLen",function(){return Go}),C.d(U,"forEach",function(){return qs});var K=C("q1tI"),q=C.n(K),fe=Object(K.createContext)({});function ue(){return Object(K.useContext)(fe)}var rt={},Ne={},nt=function(r){return Ne[r]},wt=function(r,t){Ne[r]=t},ht=function(r){return rt[r]},We=function(r,t){rt[r]=t},St={},Je={},Ft=34,tr=10,yr=13;function Dr(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function Mr(e,r){var t=Dr(e);return function(n,i){return r(t(n),i,e)}}function jt(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function He(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function Dt(e){return e<0?"-"+He(-e,6):e>9999?"+"+He(e,6):He(e,4)}function Ut(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Dt(e.getUTCFullYear(),4)+"-"+He(e.getUTCMonth()+1,2)+"-"+He(e.getUTCDate(),2)+(i?"T"+He(r,2)+":"+He(t,2)+":"+He(n,2)+"."+He(i,3)+"Z":n?"T"+He(r,2)+":"+He(t,2)+":"+He(n,2)+"Z":t||r?"T"+He(r,2)+":"+He(t,2)+"Z":"")}var Ce=function(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(x,A){var w,I,P=i(x,function(H,W){if(w)return w(H,W-1);I=H,w=A?Mr(H,A):Dr(H)});return P.columns=I||[],P}function i(x,A){var w=[],I=x.length,P=0,H=0,W,oe=I<=0,ce=!1;x.charCodeAt(I-1)===tr&&--I,x.charCodeAt(I-1)===yr&&--I;function Oe(){if(oe)return Je;if(ce)return ce=!1,St;var je,tt=P,vt;if(x.charCodeAt(tt)===Ft){for(;P++<I&&x.charCodeAt(P)!==Ft||x.charCodeAt(++P)===Ft;);return(je=P)>=I?oe=!0:(vt=x.charCodeAt(P++))===tr?ce=!0:vt===yr&&(ce=!0,x.charCodeAt(P)===tr&&++P),x.slice(tt+1,je-1).replace(/""/g,'"')}for(;P<I;){if((vt=x.charCodeAt(je=P++))===tr)ce=!0;else if(vt===yr)ce=!0,x.charCodeAt(P)===tr&&++P;else if(vt!==t)continue;return x.slice(tt,je)}return oe=!0,x.slice(tt,I)}for(;(W=Oe())!==Je;){for(var Fe=[];W!==St&&W!==Je;)Fe.push(W),W=Oe();A&&(Fe=A(Fe,H++))==null||w.push(Fe)}return w}function a(x,A){return x.map(function(w){return A.map(function(I){return _(w[I])}).join(e)})}function o(x,A){return A==null&&(A=jt(x)),[A.map(_).join(e)].concat(a(x,A)).join(`
`)}function l(x,A){return A==null&&(A=jt(x)),a(x,A).join(`
`)}function c(x){return x.map(p).join(`
`)}function p(x){return x.map(_).join(e)}function _(x){return x==null?"":x instanceof Date?Ut(x):r.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:n,parseRows:i,format:o,formatBody:l,formatRows:c,formatRow:p,formatValue:_}},ve=Ce(","),Ie=ve.parse,zt=ve.parseRows,le=ve.format,Me=ve.formatBody,Re=ve.formatRows,yt=ve.formatRow,At=ve.formatValue,ae=C("VTBJ"),It=63710088e-1,lr={centimeters:It*100,centimetres:It*100,degrees:It/111325,feet:It*3.28084,inches:It*39.37,kilometers:It/1e3,kilometres:It/1e3,meters:It,metres:It,miles:It/1609.344,millimeters:It*1e3,millimetres:It*1e3,nauticalmiles:It/1852,radians:1,yards:It*1.0936},Cr={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/It,yards:1.0936133},Br={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function pn(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Fr(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return Pn(r).geometry;case"LineString":return Yn(r).geometry;case"Polygon":return Nn(r).geometry;case"MultiPoint":return Wt(r).geometry;case"MultiLineString":return Xt(r).geometry;case"MultiPolygon":return Ir(r).geometry;default:throw new Error(e+" is invalid")}}function Pn(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ot(e[0])||!Ot(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return pn(n,r,t)}function ni(e,r,t){return t===void 0&&(t={}),mr(e.map(function(n){return Pn(n,r)}),t)}function Nn(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return pn(l,r,t)}function Kn(e,r,t){return t===void 0&&(t={}),mr(e.map(function(n){return Nn(n,r)}),t)}function Yn(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return pn(n,r,t)}function Ar(e,r,t){return t===void 0&&(t={}),mr(e.map(function(n){return Yn(n,r)}),t)}function mr(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function Xt(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return pn(n,r,t)}function Wt(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return pn(n,r,t)}function Ir(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return pn(n,r,t)}function Ue(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return pn(n,r,t)}function he(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function ie(e,r){r===void 0&&(r="kilometers");var t=lr[r];if(!t)throw new Error(r+" units is invalid");return e*t}function B(e,r){r===void 0&&(r="kilometers");var t=lr[r];if(!t)throw new Error(r+" units is invalid");return e/t}function Ae(e,r){return bt(B(e,r))}function Xe(e){var r=e%360;return r<0&&(r+=360),r}function bt(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Gt(e){var r=e%360;return r*Math.PI/180}function sr(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return ie(B(e,r),t)}function at(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=Br[r];if(!n)throw new Error("invalid original units");var i=Br[t];if(!i)throw new Error("invalid final units");return e/n*i}function Ot(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function or(e){return!!e&&e.constructor===Object}function Tr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Ot(r))throw new Error("bbox must only contain numbers")})}function Or(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function jn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Jr(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function xn(e){if(e.length>1&&Ot(e[0])&&Ot(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return xn(e[0]);throw new Error("coordinates must only contain numbers")}function An(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function ii(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function pi(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function Si(e){return e.type==="Feature"?e.geometry:e}function wa(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function lo(e,r,t){if(e!==null)for(var n,i,a,o,l,c,p,_=0,x=0,A,w=e.type,I=w==="FeatureCollection",P=w==="Feature",H=I?e.features.length:1,W=0;W<H;W++){p=I?e.features[W].geometry:P?e.geometry:e,A=p?p.type==="GeometryCollection":!1,l=A?p.geometries.length:1;for(var oe=0;oe<l;oe++){var ce=0,Oe=0;if(o=A?p.geometries[oe]:p,o!==null){c=o.coordinates;var Fe=o.type;switch(_=t&&(Fe==="Polygon"||Fe==="MultiPolygon")?1:0,Fe){case null:break;case"Point":if(r(c,x,W,ce,Oe)===!1)return!1;x++,ce++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(r(c[n],x,W,ce,Oe)===!1)return!1;x++,Fe==="MultiPoint"&&ce++}Fe==="LineString"&&ce++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-_;i++){if(r(c[n][i],x,W,ce,Oe)===!1)return!1;x++}Fe==="MultiLineString"&&ce++,Fe==="Polygon"&&Oe++}Fe==="Polygon"&&ce++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(Oe=0,i=0;i<c[n].length;i++){for(a=0;a<c[n][i].length-_;a++){if(r(c[n][i][a],x,W,ce,Oe)===!1)return!1;x++}Oe++}ce++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(lo(o.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Lo(e,r,t,n){var i=t;return lo(e,function(a,o,l,c,p){o===0&&t===void 0?i=a:i=r(i,a,o,l,c,p)},n),i}function as(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function Pi(e,r,t){var n=t;return as(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function re(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function J(e,r,t){var n=t;return re(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function me(e){var r=[];return lo(e,function(t){r.push(t)}),r}function we(e,r){var t,n,i,a,o,l,c,p,_,x,A=0,w=e.type==="FeatureCollection",I=e.type==="Feature",P=w?e.features.length:1;for(t=0;t<P;t++){for(l=w?e.features[t].geometry:I?e.geometry:e,p=w?e.features[t].properties:I?e.properties:{},_=w?e.features[t].bbox:I?e.bbox:void 0,x=w?e.features[t].id:I?e.id:void 0,c=l?l.type==="GeometryCollection":!1,o=c?l.geometries.length:1,i=0;i<o;i++){if(a=c?l.geometries[i]:l,a===null){if(r(null,A,p,_,x)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,A,p,_,x)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],A,p,_,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function ze(e,r,t){var n=t;return we(e,function(i,a,o,l,c){a===0&&t===void 0?n=i:n=r(n,i,a,o,l,c)}),n}function mt(e,r){we(e,function(t,n,i,a,o){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(pn(t,i,{bbox:a,id:o}),n,0)===!1?!1:void 0}var c;switch(l){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var _=t.coordinates[p],x={type:c,coordinates:_};if(r(pn(x,i),n,p)===!1)return!1}})}function Tt(e,r,t){var n=t;return mt(e,function(i,a,o){a===0&&o===0&&t===void 0?n=i:n=r(n,i,a,o)}),n}function xe(e,r){mt(e,function(t,n,i){var a=0;if(!!t.geometry){var o=t.geometry.type;if(!(o==="Point"||o==="MultiPoint")){var l,c=0,p=0,_=0;if(lo(t,function(x,A,w,I,P){if(l===void 0||n>c||I>p||P>_){l=x,c=n,p=I,_=P,a=0;return}var H=Yn([l,x],t.properties);if(r(H,n,i,P,a)===!1)return!1;a++,l=x})===!1)return!1}}})}function Qe(e,r,t){var n=t,i=!1;return xe(e,function(a,o,l,c,p){i===!1&&t===void 0?n=a:n=r(n,a,o,l,c,p),i=!0}),n}function Nt(e,r){if(!e)throw new Error("geojson is required");mt(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,o=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<o.length;l++)if(r(Yn(o[l],t.properties),n,i,l)===!1)return!1;break}}})}function wr(e,r,t){var n=t;return Nt(e,function(i,a,o,l){a===0&&t===void 0?n=i:n=r(n,i,a,o,l)}),n}function Vr(e,r){if(r=r||{},!or(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,o=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":o=o||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),Yn([c[a],c[a+1]],o,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a-1),Yn([c[i][a],c[i][a+1]],o,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a-1),Yn([c[n][a],c[n][a+1]],o,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a-1),Yn([c[n][i][a],c[n][i][a+1]],o,r)}throw new Error("geojson is invalid")}function pr(e,r){if(r=r||{},!or(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,o=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":o=o||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":return Pn(c,o,r);case"MultiPoint":return n<0&&(n=c.length+n),Pn(c[n],o,r);case"LineString":return a<0&&(a=c.length+a),Pn(c[a],o,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a),Pn(c[i][a],o,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a),Pn(c[n][a],o,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a),Pn(c[n][i][a],o,r)}throw new Error("geojson is invalid")}var De=C("vuIU"),et=C("1OyB"),Lt=C("Ji7U"),ut=C("md7G"),Te=C("foSv"),dn=C("s4An");function yn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var ci=C("2WcH");function vn(e,r,t){return Object(ci.a)()?vn=Reflect.construct.bind():vn=function(i,a,o){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),p=new c;return o&&Object(dn.a)(p,o.prototype),p},vn.apply(null,arguments)}function Ai(e){var r=typeof Map=="function"?new Map:void 0;return Ai=function(n){if(n===null||!yn(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return vn(n,arguments,Object(Te.a)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(dn.a)(i,n)},Ai(e)}var Zi={REGISTERED_PROTOCOLS:{}};function Bi(e){var r=$i();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function $i(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zi=function(r){return Zi.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},$o=function(e){Object(Lt.a)(t,e);var r=Bi(t);function t(n,i,a,o){var l;return Object(et.a)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=o,l}return Object(De.a)(t)}(Ai(Error));function Ii(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new $o(t.status,t.statusText,n.toString(),o))}},t.cancel=t.abort,t.send(e.body),t}function ja(e){return new Promise(function(r,t){Ii(e,function(n,i,a,o,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:o,xhr:l})})})}function Wi(e,r){return Ii(e,r)}var Ni=function(r,t){var n=zi(r.url)||Wi;return n(Object(ae.a)(Object(ae.a)({},r),{},{type:"json"}),t)},di=function(r,t){var n=zi(r.url)||Wi;return n(Object(ae.a)(Object(ae.a)({},r),{},{type:"arrayBuffer"}),t)},ao=function(r,t){return Wi(Object(ae.a)(Object(ae.a)({},r),{},{method:"POST"}),t)},Bs=function(r,t){return Wi(Object(ae.a)(Object(ae.a)({},r),{},{method:"GET"}),t)};function wo(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Yo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function il(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Yo})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Yo}function Oo(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Ea=function(r,t,n){var i=function(o,l){if(o)t(o);else if(l){var c=typeof createImageBitmap=="function",p=n?n(l):l;c?Oo(p,t):il(p,t)}};return r.type==="json"?Ni(r,i):di(r,i)},al=function(r,t){var n=typeof createImageBitmap=="function";n?Oo(r,t):il(r,t)},Ro=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Oa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ko(e,r,t){var n=e.classList;for(var i in Oa)Oa.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var ca=function(e,r,t){e.prototype=r.prototype=t,t.constructor=e};function Eo(e,r){var t=Object.create(e.prototype);for(var n in r)t[n]=r[n];return t}function qo(){}var ol=.7,Qo=1/ol,sl="\\s*([+-]?\\d+)\\s*",oo="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",qi="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",pt=/^#([0-9a-f]{3,8})$/,pe=new RegExp("^rgb\\("+[sl,sl,sl]+"\\)$"),Ke=new RegExp("^rgb\\("+[qi,qi,qi]+"\\)$"),ar=new RegExp("^rgba\\("+[sl,sl,sl,oo]+"\\)$"),qr=new RegExp("^rgba\\("+[qi,qi,qi,oo]+"\\)$"),Cn=new RegExp("^hsl\\("+[oo,qi,qi]+"\\)$"),ji=new RegExp("^hsla\\("+[oo,qi,qi,oo]+"\\)$"),ka={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ca(qo,uu,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:So,formatHex:So,formatHsl:os,formatRgb:Cs,toString:Cs});function So(){return this.rgb().formatHex()}function os(){return ju(this).formatHsl()}function Cs(){return this.rgb().formatRgb()}function uu(e){var r,t;return e=(e+"").trim().toLowerCase(),(r=pt.exec(e))?(t=r[1].length,r=parseInt(r[1],16),t===6?Bf(r):t===3?new Ra(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):t===8?Ml(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):t===4?Ml(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=pe.exec(e))?new Ra(r[1],r[2],r[3],1):(r=Ke.exec(e))?new Ra(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=ar.exec(e))?Ml(r[1],r[2],r[3],r[4]):(r=qr.exec(e))?Ml(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=Cn.exec(e))?xu(r[1],r[2]/100,r[3]/100,1):(r=ji.exec(e))?xu(r[1],r[2]/100,r[3]/100,r[4]):ka.hasOwnProperty(e)?Bf(ka[e]):e==="transparent"?new Ra(NaN,NaN,NaN,0):null}function Bf(e){return new Ra(e>>16&255,e>>8&255,e&255,1)}function Ml(e,r,t,n){return n<=0&&(e=r=t=NaN),new Ra(e,r,t,n)}function lp(e){return e instanceof qo||(e=uu(e)),e?(e=e.rgb(),new Ra(e.r,e.g,e.b,e.opacity)):new Ra}function rc(e,r,t,n){return arguments.length===1?lp(e):new Ra(e,r,t,n==null?1:n)}function Ra(e,r,t,n){this.r=+e,this.g=+r,this.b=+t,this.opacity=+n}ca(Ra,rc,Eo(qo,{brighter:function(r){return r=r==null?Qo:Math.pow(Qo,r),new Ra(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?ol:Math.pow(ol,r),new Ra(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ul,formatHex:ul,formatRgb:ll,toString:ll}));function ul(){return"#"+lu(this.r)+lu(this.g)+lu(this.b)}function ll(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function lu(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function xu(e,r,t,n){return n<=0?e=r=t=NaN:t<=0||t>=1?e=r=NaN:r<=0&&(e=NaN),new go(e,r,t,n)}function ju(e){if(e instanceof go)return new go(e.h,e.s,e.l,e.opacity);if(e instanceof qo||(e=uu(e)),!e)return new go;if(e instanceof go)return e;e=e.rgb();var r=e.r/255,t=e.g/255,n=e.b/255,i=Math.min(r,t,n),a=Math.max(r,t,n),o=NaN,l=a-i,c=(a+i)/2;return l?(r===a?o=(t-n)/l+(t<n)*6:t===a?o=(n-r)/l+2:o=(r-t)/l+4,l/=c<.5?a+i:2-a-i,o*=60):l=c>0&&c<1?0:o,new go(o,l,c,e.opacity)}function af(e,r,t,n){return arguments.length===1?ju(e):new go(e,r,t,n==null?1:n)}function go(e,r,t,n){this.h=+e,this.s=+r,this.l=+t,this.opacity=+n}ca(go,af,Eo(qo,{brighter:function(r){return r=r==null?Qo:Math.pow(Qo,r),new go(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?ol:Math.pow(ol,r),new go(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,a=2*n-i;return new Ra(Xa(r>=240?r-240:r+120,a,i),Xa(r,a,i),Xa(r<120?r+240:r-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function Xa(e,r,t){return(e<60?r+(t-r)*e/60:e<180?t:e<240?r+(t-r)*(240-e)/60:r)*255}function nc(e){return typeof e=="string"?!!uu(e):!1}function Ui(e){var r=uu(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function zu(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function Uu(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Rc(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],o=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var c=(e.positions[l]-a)/(o-a);i.addColorStop(c,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function Ah(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],o=0;o<e.colors.length;++o){var l=Math.max((e.positions[o]-r[0])/a,0);i.addColorStop(l,e.colors[o])}n.fillStyle=i,n.fillRect(0,0,256,1);var c=n.getImageData(0,0,256,1).data,p=Lf(n,c);return t=null,n=null,p}function Th(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var o=Ui(e.colors[a]);n.data[i*4+0]=o[0]*255,n.data[i*4+1]=o[1]*255,n.data[i*4+2]=o[2]*255,n.data[i*4+3]=o[3]*255}),r=null,t=null,n}function Ch(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,o=Lf(t,a);return r=null,t=null,o}function cp(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var o=n.getImageData(0,0,256,1).data,l=Lf(n,o);return t=null,n=null,l}function Lf(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function wh(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var Eu={BACK:1029,FRONT:1028};function eu(e){switch(e){case"GAODE1.x":return Eu.BACK;case"GAODE2.x":return Eu.BACK;case"MAPBOX":return Eu.FRONT;case"SIMPLE":return Eu.FRONT;case"GLOBEL":return Eu.BACK;case"DEBAULT":return Eu.FRONT;default:return Eu.FRONT}}var cr=C("KQm4"),hn=C("ODXe"),ic=C("9nhX"),Pl=C.n(ic),tu=C("BkRI"),Il=C.n(tu),cu=C("sEfC"),cl=C.n(cu),ru=C("mwIZ"),fl=C.n(ru),Dl=C("Znm+"),fp=C.n(Dl),hp=C("Y+p1"),ba=C.n(hp),ld=C("J2iB"),Nf=C.n(ld),Oh=C("UB5X"),co=C.n(Oh),Rh=C("YO3V"),pp=C.n(Rh),Ls=C("4qC0"),hl=C.n(Ls),Vu=C("c6wG"),kl=C.n(Vu),jf=C("QkVN"),Mc=C.n(jf),Su=C("JBE3"),of=C.n(Su),Fl=C("hzCD"),pl=C.n(Fl),Mh=C("DzJC"),sf=C.n(Mh),Fa=C("7tbW"),zf=C.n(Fa),cd=C("gQMU"),Bl=C.n(cd),uf=C("lSCD"),Ph=C.n(uf),Uf=C("GoyQ"),dl=C.n(Uf),Ll=C("TP7S"),ac=C.n(Ll),Pc=C("u6S6"),oc=C.n(Pc),fi={isNil:Nf.a,merge:Mc.a,throttle:sf.a,isString:hl.a,debounce:cl.a,pull:pl.a,isTypedArray:kl.a,isPlainObject:pp.a,isNumber:co.a,isBoolean:fp.a,isEqual:ba.a,cloneDeep:Il.a,uniq:zf.a,clamp:Pl.a,upperFirst:Bl.a,get:fl.a,mergeWith:of.a,isFunction:Ph.a,isObject:dl.a,isUndefined:ac.a,camelCase:oc.a},Ih=fi.pull;function sc(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function Ws(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function lf(e){return Ws(e).split(/\s+/)}function Dh(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function kh(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Nl(e){var r=e.parentNode;r&&r.removeChild(e)}function Hu(e,r){if(e.classList!==void 0)for(var t=lf(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!Dc(e,r)){var a=Vf(e);Wu(e,(a?a+" ":"")+r)}}function Ic(e,r){if(e.classList!==void 0){var t=lf(r);t.forEach(function(n){e.classList.remove(n)})}else Wu(e,Ws((" "+Vf(e)+" ").replace(" "+r+" "," ")))}function Dc(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=Vf(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function Wu(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function Vf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Hf(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Fh=Dh(["transform","WebkitTransform"]);function Wf(e,r){e.style[Fh]=r}function dp(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Gf(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function Xf(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),o=Object(hn.a)(a,1),l=o[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var cf=Xf()<1?1:window.devicePixelRatio;function Bh(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function vl(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function Lh(e,r){var t,n=vl((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=vl(r),a=Ih.apply(void 0,[n].concat(Object(cr.a)(i)));e.setAttribute("style",a.join(";"))}function jl(e){return Object.entries(e).map(function(r){var t=Object(hn.a)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function Ba(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function Zf(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Gu(e){e.innerHTML=""}function zl(e){e.setAttribute("draggable","false")}function Qi(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,Object(cr.a)(r)):e.append(r)}function La(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(o){var l;return(l=n)===null||l===void 0?void 0:l.matches(o)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var Ns;function ff(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function kc(){return typeof importScripts=="function"}var $f=kc()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},hf=(Ns=navigator)===null||Ns===void 0?void 0:Ns.userAgent,Nh=!!hf.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Yf=hf.indexOf("Android")>-1||hf.indexOf("Adr")>-1;function Ul(){for(var e=hf,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}var V=C("rePB");function Va(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}var pf=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;Object(et.a)(this,e),Object(V.a)(this,"duration",16),Object(V.a)(this,"timestamp",new Date().getTime()),this.duration=r}return Object(De.a)(e,[{key:"run",value:function(t){var n=new Date().getTime(),i=n-this.timestamp;this.timestamp=n,i>=this.duration&&t()}}]),e}();function df(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return lo(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}df.default=df;var yo=df;function On(e){return typeof e=="number"}var ss=2*Math.PI*6378137/2;function vf(e,r){var t=Object(hn.a)(r,4),n=t[0],i=t[1],a=t[2],o=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=o}function Fc(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;ms(r,n)}),r}function ms(e,r){return Array.isArray(r[0])?r.forEach(function(t){ms(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function Ma(e,r){return mf(e,r)}function mf(e,r){return Array.isArray(e[0])?e.map(function(t){return mf(t,r)}):r(e)}function cn(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=fu(e,r);var n=e[0],i=e[1],a=n*ss/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*ss/180,t.enable&&(a=Number(a.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function Vl(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/ss*180,a=n/ss*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function gf(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Kf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function fu(e,r){if(r===!1)return e;var t=gf(e[0]),n=Kf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Sa(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,o=t*i;o=Math.log(Math.tan(Math.PI/4+o/2));var l=.5/Math.PI,c=.5,p=-.5/Math.PI;return i=.5,a=n*(l*a+c),o=n*(p*o+i),[Math.floor(a),Math.floor(o)]}function jh(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,o=Object(hn.a)(e,2),l=o[0],c=o[1];l=(l/a-t)/r,c=(c/a-i)/n,c=(Math.atan(Math.pow(Math.E,c))-Math.PI/4)*2,i=Math.PI/180;var p=c/i,_=l/i;return[_,p]}function yf(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function ws(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function Xu(e,r,t){var n=Gt(r[1]-e[1]),i=Gt(r[0]-e[0]),a=Gt(e[1]),o=Gt(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return ie(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function fd(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),o=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[o,l]}function Zu(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function Bc(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function Lc(e){return[[e[0],e[1]],[e[2],e[3]]]}function Gs(e){var r=js(e,[0,0]);return[e[0]/r,e[1]/r]}function js(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Ti(e,r){return e[0]*r[0]+e[1]*r[1]}function Xs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function hu(e,r){return Math.acos(Ti(e,r)/(Xs(e)*Xs(r)))*180/Math.PI}function Jo(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function uc(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var o=e[a],l=e[a+1],c=js(o,l);n+=c;var p=[o[0]-l[0],o[1]-l[1]],_=Jo(t,p);if(a>0){var x=i[a-1].rotation;x-_>360-x+_&&(_=_+360)}i.push({start:o,end:l,dis:c,rotation:_,duration:0})}return i.map(function(A){A.duration=r*(A.dis/n)}),i}}function gs(e){if(On(e[0]))return e;if(On(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(On(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(o){t+=o[0],n+=o[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function pu(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,o=0,l=0,c=0;c<e.length;c+=2){var p=e[c],_=e[c+1];p&&_&&(r=Math.max(p,r),t=Math.max(_,t),n=Math.min(p,n),i=Math.min(_,i),a+=p,o+=_,l++)}return{center:[a/l,o/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function ys(e){return yo(mr([Yn(e)]))}function _f(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function qn(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function Fn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var Zs=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function us(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,l=t;return o&&(l=Math.round(t*(a-1))/(a-1)),n?$u(e,r,l,n,i):$u(e,r,l,.314,i)}function $s(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function Za(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function nu(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=Za(n,[0,0]),a=Math.atan2(n[1],n[0]),o=i/2/Math.cos(t),l=a+t,c=[o*Math.cos(l)+e[0],o*Math.sin(l)+e[1]];return c}function $u(e,r,t,n,i){if(i===Zs["GAODE2.x"]){var a=yf(e[0],e[1]),o=yf(r[0],r[1]),l=nu(a,o,n),c=[a[0],l[0],o[0]],p=[a[1],l[1],o[1]];return[].concat(Object(cr.a)(ws($s(c,t),$s(p,t))),[0])}else{var _=nu(e,r,n),x=[e[0],_[0],r[0]],A=[e[1],_[1],r[1]];return[$s(x,t),$s(A,t),0]}}function lc(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,l=t;return o&&(l=Math.round(t*29)/29),Hl(e,r,l,i)}function fa(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=js(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,o=n/2/Math.cos(a),l=i+a,c=[o*Math.cos(l)+e[0],o*Math.sin(l)+e[1]];return c}function Mo(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function zh(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Hl(e,r,t,n){var i=[Gt(e[0]),Gt(e[1])],a=[Gt(r[0]),Gt(r[1])];if(n==="GAODE2.x"){var o=fa(i,a),l=[i[0],o[0],a[0]],c=[i[1],o[1],a[1]];return[Mo(l,t),Mo(c,t),0]}else{var p=zh(i,a);if(Math.abs(p-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var _=Math.sin((1-t)*p)/Math.sin(p),x=Math.sin(t*p)/Math.sin(p),A=[Math.sin(i[0]),Math.sin(i[1])],w=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],P=[Math.cos(a[0]),Math.cos(a[1])],H=_*w[1]*w[0]+x*P[1]*P[0],W=_*w[1]*A[0]+x*P[1]*I[0],oe=_*A[1]+x*I[1];return[bt(Math.atan2(W,H)),bt(Math.atan2(oe,Math.sqrt(H*H+W*W)))]}}function qf(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],o=e[i+1],l=Ys(a,o),c=t;t+=l,n.push({p1:a,p2:o,totalDistance:t,distance:l,lastTotalDistance:c})}for(var p=t*r,_,x,A=0,w=n;A<w.length;A++){var I=w[A],P=I.totalDistance;if(P>p){var H=I.p1,W=I.p2,oe=(p-I.lastTotalDistance)/I.distance,ce=ml(W,H,oe);_=ce[0],x=ce[1];break}}return{lng:_,lat:x,height:0}}function ml(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function Ys(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function cc(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=Qf(i,r);return Object(ae.a)(Object(ae.a)({},i),a)})}function gl(e,r){return new Promise(function(t){e.inited?t(cc(e,r)):e.once("update",function(){t(cc(e,r))})})}function Qf(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,o=r.segmentNumber,l=o===void 0?30:o,c=r.autoFit,p=c===void 0?!0:c,_=e.coordinates;if(n==="line")return qf(_,t);var x=_[0],A=_[1],w=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=us;break;case"greatcircle":I=lc;break;default:I=us}var P=I(x,A,t,w,a,l,p),H=Object(hn.a)(P,3),W=H[0],oe=H[1],ce=H[2];return{lng:W,lat:oe,height:ce}}var Nc=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;Object(et.a)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return Object(De.a)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function jc(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function bf(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function yl(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function Wl(e){if(e.length===0)throw new Error("mean requires at least one data point");return yl(e)/e.length}function Jf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Au={min:bf,max:jc,mean:Wl,sum:yl,mode:Jf};function Tu(e,r){return e.map(function(t){return t[r]})}function eh(e,r){return Au[e](r)}var Zt=C("HaE+"),Be=C("JX7q"),Uh=C("o0o1"),be=C.n(Uh);function th(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[t,n],l=[t,a],c=[i,a],p=[i,n];return Nn([[o,p,c,l,o]],r.properties,{bbox:e,id:r.id})}var Po=C("uhBA"),m=C.n(Po),d=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),h=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),y=0,S=1,O=2;function M(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function F(e){e.forEach(function(r){r.properties.state=y}),e.forEach(function(r){r.isCurrent&&!ee(r)&&ge(r)}),e.forEach(function(r){r.isVisible=Boolean(r.properties.state&O)})}function X(e){e.forEach(function(t){t.properties.state=y}),e.forEach(function(t){t.isCurrent&&ee(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=Boolean(t.properties.state&O),t.children.length&&(t.isVisible||t.properties.state&S)?t.children.forEach(function(n){n.properties.state=S}):t.isCurrent&&ge(t)})}function ee(e){for(;e;){if(e.isLoaded)return e.properties.state|=O,!0;e=e.parent}return!1}function ge(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=O:ge(r)})}var _e,Ee=256,qe=[-Infinity,-Infinity,Infinity,Infinity],$e=.2,dt=5,Ye=(_e={},Object(V.a)(_e,d.Realtime,M),Object(V.a)(_e,d.Overlap,F),Object(V.a)(_e,d.Replace,X),_e),ot=function(){};function Mt(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function Pt(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var dr=function(r,t,n){var i=Pt(r,t,n),a=Object(hn.a)(i,2),o=a[0],l=a[1],c=Pt(r+1,t+1,n),p=Object(hn.a)(c,2),_=p[0],x=p[1];return[o,x,_,l]};function Jt(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?Infinity:n,a=e.minZoom,o=a===void 0?0:a,l=e.zoomOffset,c=l===void 0?0:l,p=e.extent,_=p===void 0?qe:p,x=Math.ceil(r)+c;if(Number.isFinite(o)&&x<o)return[];Number.isFinite(i)&&x>i&&(x=i);for(var A=Object(hn.a)(t,4),w=A[0],I=A[1],P=A[2],H=A[3],W=[Math.max(w,_[0]),Math.max(I,_[1]),Math.min(P,_[2]),Math.min(H,_[3])],oe=[],ce=Mt(W[0],W[1],x),Oe=Object(hn.a)(ce,2),Fe=Oe[0],je=Oe[1],tt=Mt(W[2],W[3],x),vt=Object(hn.a)(tt,2),kt=vt[0],ir=vt[1],ur=Fe;ur<=kt;ur++)for(var Zr=ir;Zr<=je;Zr++)oe.push({x:ur,y:Zr,z:x});var ln=(kt+Fe)/2,_n=(je+ir)/2,Hi=function(Ga,To){return Math.abs(Ga-ln)+Math.abs(To-_n)};return oe.sort(function(io,Ga){return Hi(io.x,io.y)-Hi(Ga.x,Ga.y)}),oe}var br=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),o=a-1,l=a,c=r,p=t;return i&&(c<0?c=c+l:c>o&&(c=c%l)),{warpX:c,warpY:p}};function Er(e){var r=en();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function en(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xr=function(e){Object(Lt.a)(t,e);var r=Er(t);function t(n){var i;Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"tileSize",256),Object(V.a)(Object(Be.a)(i),"isVisible",!1),Object(V.a)(Object(Be.a)(i),"isCurrent",!1),Object(V.a)(Object(Be.a)(i),"isVisibleChange",!1),Object(V.a)(Object(Be.a)(i),"loadedLayers",0),Object(V.a)(Object(Be.a)(i),"isLayerLoaded",!1),Object(V.a)(Object(Be.a)(i),"isLoad",!1),Object(V.a)(Object(Be.a)(i),"isChildLoad",!1),Object(V.a)(Object(Be.a)(i),"parent",null),Object(V.a)(Object(Be.a)(i),"children",[]),Object(V.a)(Object(Be.a)(i),"data",null),Object(V.a)(Object(Be.a)(i),"properties",{}),Object(V.a)(Object(Be.a)(i),"loadDataId",0);var a=n.x,o=n.y,l=n.z,c=n.tileSize,p=n.warp,_=p===void 0?!0:p;return i.x=a,i.y=o,i.z=l,i.warp=_||!0,i.tileSize=c,i}return Object(De.a)(t,[{key:"isLoading",get:function(){return this.loadStatus===h.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===h.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===h.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===h.Cancelled}},{key:"isDone",get:function(){return[h.Loaded,h.Cancelled,h.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return dr(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=Object(hn.a)(this.bounds,4),a=i[0],o=i[1],l=i[2],c=i[3],p=[(l-a)/2,(c-o)/2],_=th(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:p,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l,c,p,_,x,A,w,I,P,H,W,oe,ce,Oe,Fe,je,tt;return be.a.wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:return l=o.getData,c=o.onLoad,p=o.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=h.Loading,x=null,kt.prev=7,w=this.x,I=this.y,P=this.z,H=this.bounds,W=this.tileSize,oe=this.warp,ce=br(w,I,P,oe),Oe=ce.warpX,Fe=ce.warpY,je=this.abortController.signal,tt={x:Oe,y:Fe,z:P,bounds:H,tileSize:W,signal:je,warp:oe},kt.next=14,l(tt,this);case 14:x=kt.sent,kt.next=20;break;case 17:kt.prev=17,kt.t0=kt.catch(7),A=kt.t0;case 20:if(_===this.loadDataId){kt.next=22;break}return kt.abrupt("return");case 22:if(!(this.isCancelled&&!x)){kt.next=24;break}return kt.abrupt("return");case 24:if(!(A||!x)){kt.next=28;break}return this.loadStatus=h.Failure,p(A,this),kt.abrupt("return");case 28:this.loadStatus=h.Loaded,this.data=x,c(this);case 31:case"end":return kt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=h.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(Po.EventEmitter),gn=function(r,t){var n=Lc(r),i=Zu(n,t),a=360*3-180,o=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-o),Math.min(i[1][0],a),Math.min(i[1][1],o)];return l},In=function(r,t){var n=Lc(r),i=Lc(t),a=Bc(n,i);return a};function Vn(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=oi(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function oi(e,r){if(!!e){if(typeof e=="string")return Di(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Di(e,r)}}function Di(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ji(e){var r=Tn();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Tn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ei=fi.throttle,vi=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),Hn=function(e){Object(Lt.a)(t,e);var r=Ji(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"currentTiles",[]),Object(V.a)(Object(Be.a)(i),"cacheTiles",new Map),Object(V.a)(Object(Be.a)(i),"throttleUpdate",Ei(function(a,o){i.update(a,o)},16)),Object(V.a)(Object(Be.a)(i),"onTileLoad",function(a){i.emit(vi.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),Object(V.a)(Object(Be.a)(i),"onTileError",function(a,o){i.emit(vi.TileError,{error:a,tile:o}),i.updateTileVisible(),i.loadFinished()}),Object(V.a)(Object(Be.a)(i),"onTileUnload",function(a){i.emit(vi.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:qe,getTileData:ot,warp:!0,updateStrategy:d.Replace},i.updateOptions(n),i}return Object(De.a)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,o){return a.z-o.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),o=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=Object(ae.a)(Object(ae.a)(Object(ae.a)({},this.options),i),{},{minZoom:a,maxZoom:o})}},{key:"update",value:function(i,a){var o=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&In(this.lastViewStates.latLonBoundsBuffer,a))){var c=gn(a,$e);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:c},this.currentZoom=l;var p=!1,_=this.getTileIndices(l,c).filter(function(x){return o.options.warp||x.x>=0&&x.x<Math.pow(2,l)});this.emit(vi.TilesLoadStart),this.currentTiles=_.map(function(x){var A=x.x,w=x.y,I=x.z,P=o.getTile(A,w,I);if(P){var H,W,oe=((H=P)===null||H===void 0?void 0:H.isFailure)||((W=P)===null||W===void 0?void 0:W.isCancelled);return oe&&P.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),P}return P=o.createTile(A,w,I),p=!0,P}),p&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Vn(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var o=Object(hn.a)(a.value,2),l=o[0],c=o[1];if(!this.currentTiles.includes(c)){this.cacheTiles.delete(l),this.onTileUnload(c);return}this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(p){i.e(p)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,o){var l=this.cacheTiles.get("".concat(a,",").concat(o,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,o){var l=this.getTileByLngLat(i,a,o);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var o=this,l=this.getTileIndices(a,i);l.forEach(function(c){o.reloadTileById(c.z,c.x,c.y)})}},{key:"pruneRequests",value:function(){var i=[],a=Vn(this.cacheTiles.values()),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(p){a.e(p)}finally{a.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,o){var l=this.options.zoomOffset,c=Math.ceil(o)+l,p=Mt(i,a,c),_=this.tiles.filter(function(x){return x.key==="".concat(p[0],"_").concat(p[1],"_").concat(c)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,o){var l=this.tiles.filter(function(c){return c.key==="".concat(a,"_").concat(o,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Vn(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isLoading?o.abortLoad():this.onTileUnload(o)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,o=Vn(this.cacheTiles.values()),l;try{for(o.s();!(l=o.n()).done;){var c=l.value;a.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(I){o.e(I)}finally{o.f()}var p=Vn(this.currentTiles),_;try{for(p.s();!(_=p.n()).done;){var x=_.value;x.isCurrent=!0,x.isVisible=!0}}catch(I){p.e(I)}finally{p.f()}var A=Array.from(this.cacheTiles.values());typeof i=="function"?i(A):Ye[i](A);var w=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,w=!0):I.isVisibleChange=!1}),w&&this.emit(vi.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var o=this.options,l=o.tileSize,c=o.extent,p=o.zoomOffset,_=Math.floor(this.options.maxZoom),x=Math.ceil(this.options.minZoom),A=Jt({maxZoom:_,minZoom:x,zoomOffset:p,tileSize:l,zoom:i,latLonBounds:a,extent:c});return A}},{key:"getTileId",value:function(i,a,o){var l="".concat(i,",").concat(a,",").concat(o);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(vi.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=this.cacheTiles.get(l);return c}},{key:"createTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=new Xr({x:i,y:a,z:o,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=dt*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var o=Vn(this.cacheTiles),l;try{for(o.s();!(l=o.n()).done;){var c=Object(hn.a)(l.value,2),p=c[0],_=c[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(p),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(x){o.e(x)}finally{o.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Vn(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.parent=null,o.children.length=0}}catch(x){i.e(x)}finally{i.f()}var l=Vn(this.cacheTiles.values()),c;try{for(l.s();!(c=l.n()).done;){var p=c.value,_=this.getNearestAncestor(p.x,p.y,p.z);p.parent=_,_!=null&&_.children&&_.children.push(p)}}catch(x){l.e(x)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,o){for(;o>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),o=o-1;var l=this.getTile(i,a,o);if(l)return l}return null}}]),t}(m.a);function Ci(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function ti(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var o=parseInt(t[2],10),l=parseInt(t[1],10);l<=o;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function _i(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=ti(e),o=Math.abs(t+n)%a.length,l=zi(a[o])?"".concat(a[o],"/{z}/{x}/{y}"):a[o];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,dr(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function Yi(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,o=r.version,l=o===void 0?"1.0.0":o,c=r.style,p=c===void 0?"default":c,_=r.format,x=r.service,A=x===void 0?"WMTS":x,w=r.tileMatrixset,I="".concat(e,"&SERVICE=").concat(A,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(p,"&TILEMATRIXSET=").concat(w,"&FORMAT=").concat(_,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function za(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var Aa={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},No=Aa.self||Aa.window||{},$a=Aa.window||Aa.self||{},Ya=Aa.self||Aa.window||{},Ks=Aa.document||{},jo=typeof importScripts=="function",Yu=typeof window!="undefined"&&typeof window.orientation!="undefined",Ku=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){za(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){za(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),_s=Ku,bs=new Map;function fc(e){za(e.source&&!e.url||!e.source&&e.url);var r=bs.get(e.source||e.url);return r||(e.url&&(r=xf(e.url),bs.set(e.url,r)),e.source&&(r=du(e.source),bs.set(e.source,r))),za(r),r}function xf(e){if(!e.startsWith("http"))return e;var r=Gl(e);return du(r)}function du(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function Gl(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function vu(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(mu(e))n.add(e);else if(mu(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)vu(e[i],r,n)}}return t===void 0?Array.from(n):[]}function mu(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var _l=function(){},ls=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;za(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=_l,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=_l,this.onError=_l,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||vu(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=fc({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),so=ls,cs=function(){return cs=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},cs.apply(this,arguments)},bl=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{p(n.next(_))}catch(x){o(x)}}function c(_){try{p(n.throw(_))}catch(x){o(x)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},iu=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},fo=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=cs(cs({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(a,o,l){return a.done(l)}),n===void 0&&(n=function(a,o){return a.error(o)}),bl(this,void 0,void 0,function(){var i,a=this;return iu(this,function(o){switch(o.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,o.sent()]}})})},e.prototype.startQueuedJob=function(){return bl(this,void 0,void 0,function(){var r,t,n;return iu(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new _s(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new so({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return Yu?this.maxMobileConcurrency:this.maxConcurrency},e}(),zo=fo,Ka=function(){return Ka=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ka.apply(this,arguments)},fs=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},xs={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Cu=function(){function e(r){this.workerPools=new Map,this.props=Ka({},xs),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return so.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=fs(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(o){r={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=Ka(Ka({},this.props),r);try{for(var i=fs(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var o=a.value;o.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new zo({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Ef=Cu,zc=new Map,hc=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(t){self.onmessage=function(n){if(!!Vh(n)){var i=n.data,a=i.type,o=i.payload;t(a,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=zc.get(r);t||(t=function(i){if(!!Vh(i)){var a=i.data,o=a.type,l=a.payload;r(o,l)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=zc.get(r);zc.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=vu(t);self.postMessage(n,i)}},e}(),es=hc;function Vh(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function Uc(e){return JSON.parse(qu(e))}function qu(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function zs(e){return""+e.name}function uv(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),za(i),i}var hd=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{p(n.next(_))}catch(x){o(x)}}function c(_){try{p(n.throw(_))}catch(x){o(x)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},Sf=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}};function Yg(e,r){return Ef.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function Kg(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),hd(this,void 0,void 0,function(){var i,a,o,l,c,p,_,x;return Sf(this,function(A){switch(A.label){case 0:return i=zs(e),a=uv(e,t),o=Ef.getWorkerFarm(t),l=o.getWorkerPool({name:i,url:a}),c=t.jobName||e.name,[4,l.startJob(c,Rm.bind(null,n))];case 1:return p=A.sent(),_=Uc(t),p.postMessage("process",{input:r,options:_}),[4,p.result];case 2:return x=A.sent(),[2,x.result]}})})}function Rm(e,r,t,n){return hd(this,void 0,void 0,function(){var i,a,o,l,c,p,_;return Sf(this,function(x){switch(x.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,o=n.input,l=n.options,x.label=4;case 4:return x.trys.push([4,6,,7]),e.process?[4,e.process(o,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return c=x.sent(),r.postMessage("done",{id:a,result:c}),[3,7];case 6:return p=x.sent(),_=p instanceof Error?p.message:"unknown error",r.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),x.label=9;case 9:return[2]}})})}var vp=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),Mm=vp,mp=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{p(n.next(_))}catch(x){o(x)}}function c(_){try{p(n.throw(_))}catch(x){o(x)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},lv=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},Vc=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(o){return new Promise(function(l,c){o=e[a](o),i(l,c,o.done,o.value)})}}function i(a,o,l,c){Promise.resolve(c).then(function(p){a({value:p,done:l})},o)}},Hh=0,gp,cv;function qg(e,r){var t=this;if(typeof self!="undefined"){var n={process:Pm};es.onmessage=function(i,a){return mp(t,void 0,void 0,function(){var o,l,c,p,_,x,A,w,I,P,H;return lv(this,function(W){switch(W.label){case 0:switch(W.trys.push([0,19,,20]),o=i,o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=W.sent(),es.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");gp=new Mm,cv=a.options||{},c=r(gp,cv,n),W.label=4;case 4:W.trys.push([4,9,10,15]),p=Vc(c),W.label=5;case 5:return[4,p.next()];case 6:if(_=W.sent(),!!_.done)return[3,8];x=_.value,es.postMessage("output-batch",{result:x}),W.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return A=W.sent(),P={error:A},[3,15];case 10:return W.trys.push([10,,13,14]),_&&!_.done&&(H=p.return)?[4,H.call(p)]:[3,12];case 11:W.sent(),W.label=12;case 12:return[3,14];case 13:if(P)throw P.error;return[7];case 14:return[7];case 15:return es.postMessage("done",{}),[3,18];case 16:return gp.push(a.input),[3,18];case 17:return gp.close(),[3,18];case 18:return[3,20];case 19:return w=W.sent(),I=w instanceof Error?w.message:"",es.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function Pm(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Hh++,a=function l(c,p){if(p.id===i)switch(c){case"done":es.removeEventListener(l),t(p.result);break;case"error":es.removeEventListener(l),n(p.error);break;default:}};es.addEventListener(a);var o={id:i,input:e,options:r};es.postMessage("process",o)})}var fv=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{p(n.next(_))}catch(x){o(x)}}function c(_){try{p(n.throw(_))}catch(x){o(x)}}function p(_){_.done?a(_.value):i(_.value).then(l,c)}p((n=n.apply(e,r||[])).next())})},yp=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(p){return function(_){return c([p,_])}}function c(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=p[0]&2?i.return:p[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,p[1])).done)return a;switch(i=0,a&&(p=[p[0]&2,a.value]),p[0]){case 0:case 1:a=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!a||p[1]>a[0]&&p[1]<a[3])){t.label=p[1];break}if(p[0]===6&&t.label<a[1]){t.label=a[1],a=p;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(p);break}a[2]&&t.ops.pop(),t.trys.pop();continue}p=r.call(e,t)}catch(_){p=[6,_],i=0}finally{n=a=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}},rh={};function Wh(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),fv(this,void 0,void 0,function(){return yp(this,function(n){switch(n.label){case 0:return r&&(e=_p(e,r,t)),rh[e]=rh[e]||Hc(e),[4,rh[e]];case 1:return[2,n.sent()]}})})}function _p(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(za(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):jo?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function Hc(e){return fv(this,void 0,void 0,function(){var r,t,n;return yp(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return jo?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,bp(n,e)]}})})}function bp(e,r){if(jo)return eval.call(Ya,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var _o="0.0.3",nh={id:"null",name:"null",module:"web-worker-helper",options:{}};function ih(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function pc(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function dc(e){var r=e.filter;return r?[1]:[0]}function Xl(e,r){return[r]}var ah=C("VmRL"),Es=C.n(ah),ea=1e-6,Ha=typeof Float32Array!="undefined"?Float32Array:Array,wu=Math.random;function Im(e){Ha=e}var vc=Math.PI/180;function oh(e){return e*vc}function pd(e,r){return Math.abs(e-r)<=ea*Math.max(1,Math.abs(e),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function dd(){var e=new Ha(4);return Ha!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function vd(e){var r=new Ha(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function md(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function xl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Wc(e,r,t,n){var i=new Ha(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function hv(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function pv(e,r){if(e===r){var t=r[1];e[1]=r[2],e[2]=t}else e[0]=r[0],e[1]=r[2],e[2]=r[1],e[3]=r[3];return e}function dv(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t*a-i*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=t*o,e):null}function vv(e,r){var t=r[0];return e[0]=r[3],e[1]=-r[1],e[2]=-r[2],e[3]=t,e}function Af(e){return e[0]*e[3]-e[2]*e[1]}function mv(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=t[0],c=t[1],p=t[2],_=t[3];return e[0]=n*l+a*c,e[1]=i*l+o*c,e[2]=n*p+a*_,e[3]=i*p+o*_,e}function Zl(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=Math.sin(t),c=Math.cos(t);return e[0]=n*c+a*l,e[1]=i*c+o*l,e[2]=n*-l+a*c,e[3]=i*-l+o*c,e}function gd(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=t[0],c=t[1];return e[0]=n*l,e[1]=i*l,e[2]=a*c,e[3]=o*c,e}function Tf(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=-t,e[3]=n,e}function Gc(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=r[1],e}function gv(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Xc(e){return Math.hypot(e[0],e[1],e[2],e[3])}function xp(e,r,t,n){return e[2]=n[2]/n[0],t[0]=n[0],t[1]=n[1],t[3]=n[3]-e[2]*t[1],[e,r,t]}function Ep(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function Os(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function Rs(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Uo(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=r[0],l=r[1],c=r[2],p=r[3];return Math.abs(t-o)<=ea*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(n-l)<=ea*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=ea*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-p)<=ea*Math.max(1,Math.abs(a),Math.abs(p))}function gu(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function yv(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}var Gh=mv,_v=Os;function Dm(){var e=new Ha(16);return Ha!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function km(e){var r=new Ha(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function bv(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Fm(e,r,t,n,i,a,o,l,c,p,_,x,A,w,I,P){var H=new Ha(16);return H[0]=e,H[1]=r,H[2]=t,H[3]=n,H[4]=i,H[5]=a,H[6]=o,H[7]=l,H[8]=c,H[9]=p,H[10]=_,H[11]=x,H[12]=A,H[13]=w,H[14]=I,H[15]=P,H}function xv(e,r,t,n,i,a,o,l,c,p,_,x,A,w,I,P,H){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=l,e[7]=c,e[8]=p,e[9]=_,e[10]=x,e[11]=A,e[12]=w,e[13]=I,e[14]=P,e[15]=H,e}function Ms(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bm(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],a=r[6],o=r[7],l=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=i,e[13]=o,e[14]=l}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function yd(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],p=r[7],_=r[8],x=r[9],A=r[10],w=r[11],I=r[12],P=r[13],H=r[14],W=r[15],oe=t*l-n*o,ce=t*c-i*o,Oe=t*p-a*o,Fe=n*c-i*l,je=n*p-a*l,tt=i*p-a*c,vt=_*P-x*I,kt=_*H-A*I,ir=_*W-w*I,ur=x*H-A*P,Zr=x*W-w*P,ln=A*W-w*H,_n=oe*ln-ce*Zr+Oe*ur+Fe*ir-je*kt+tt*vt;return _n?(_n=1/_n,e[0]=(l*ln-c*Zr+p*ur)*_n,e[1]=(i*Zr-n*ln-a*ur)*_n,e[2]=(P*tt-H*je+W*Fe)*_n,e[3]=(A*je-x*tt-w*Fe)*_n,e[4]=(c*ir-o*ln-p*kt)*_n,e[5]=(t*ln-i*ir+a*kt)*_n,e[6]=(H*Oe-I*tt-W*ce)*_n,e[7]=(_*tt-A*Oe+w*ce)*_n,e[8]=(o*Zr-l*ir+p*vt)*_n,e[9]=(n*ir-t*Zr-a*vt)*_n,e[10]=(I*je-P*Oe+W*oe)*_n,e[11]=(x*Oe-_*je-w*oe)*_n,e[12]=(l*kt-o*ur-c*vt)*_n,e[13]=(t*ur-n*kt+i*vt)*_n,e[14]=(P*ce-I*Fe-H*oe)*_n,e[15]=(_*Fe-x*ce+A*oe)*_n,e):null}function _d(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],p=r[7],_=r[8],x=r[9],A=r[10],w=r[11],I=r[12],P=r[13],H=r[14],W=r[15];return e[0]=l*(A*W-w*H)-x*(c*W-p*H)+P*(c*w-p*A),e[1]=-(n*(A*W-w*H)-x*(i*W-a*H)+P*(i*w-a*A)),e[2]=n*(c*W-p*H)-l*(i*W-a*H)+P*(i*p-a*c),e[3]=-(n*(c*w-p*A)-l*(i*w-a*A)+x*(i*p-a*c)),e[4]=-(o*(A*W-w*H)-_*(c*W-p*H)+I*(c*w-p*A)),e[5]=t*(A*W-w*H)-_*(i*W-a*H)+I*(i*w-a*A),e[6]=-(t*(c*W-p*H)-o*(i*W-a*H)+I*(i*p-a*c)),e[7]=t*(c*w-p*A)-o*(i*w-a*A)+_*(i*p-a*c),e[8]=o*(x*W-w*P)-_*(l*W-p*P)+I*(l*w-p*x),e[9]=-(t*(x*W-w*P)-_*(n*W-a*P)+I*(n*w-a*x)),e[10]=t*(l*W-p*P)-o*(n*W-a*P)+I*(n*p-a*l),e[11]=-(t*(l*w-p*x)-o*(n*w-a*x)+_*(n*p-a*l)),e[12]=-(o*(x*H-A*P)-_*(l*H-c*P)+I*(l*A-c*x)),e[13]=t*(x*H-A*P)-_*(n*H-i*P)+I*(n*A-i*x),e[14]=-(t*(l*H-c*P)-o*(n*H-i*P)+I*(n*c-i*l)),e[15]=t*(l*A-c*x)-o*(n*A-i*x)+_*(n*c-i*l),e}function Ev(e){var r=e[0],t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],l=e[6],c=e[7],p=e[8],_=e[9],x=e[10],A=e[11],w=e[12],I=e[13],P=e[14],H=e[15],W=r*o-t*a,oe=r*l-n*a,ce=r*c-i*a,Oe=t*l-n*o,Fe=t*c-i*o,je=n*c-i*l,tt=p*I-_*w,vt=p*P-x*w,kt=p*H-A*w,ir=_*P-x*I,ur=_*H-A*I,Zr=x*H-A*P;return W*Zr-oe*ur+ce*ir+Oe*kt-Fe*vt+je*tt}function Cf(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=r[4],c=r[5],p=r[6],_=r[7],x=r[8],A=r[9],w=r[10],I=r[11],P=r[12],H=r[13],W=r[14],oe=r[15],ce=t[0],Oe=t[1],Fe=t[2],je=t[3];return e[0]=ce*n+Oe*l+Fe*x+je*P,e[1]=ce*i+Oe*c+Fe*A+je*H,e[2]=ce*a+Oe*p+Fe*w+je*W,e[3]=ce*o+Oe*_+Fe*I+je*oe,ce=t[4],Oe=t[5],Fe=t[6],je=t[7],e[4]=ce*n+Oe*l+Fe*x+je*P,e[5]=ce*i+Oe*c+Fe*A+je*H,e[6]=ce*a+Oe*p+Fe*w+je*W,e[7]=ce*o+Oe*_+Fe*I+je*oe,ce=t[8],Oe=t[9],Fe=t[10],je=t[11],e[8]=ce*n+Oe*l+Fe*x+je*P,e[9]=ce*i+Oe*c+Fe*A+je*H,e[10]=ce*a+Oe*p+Fe*w+je*W,e[11]=ce*o+Oe*_+Fe*I+je*oe,ce=t[12],Oe=t[13],Fe=t[14],je=t[15],e[12]=ce*n+Oe*l+Fe*x+je*P,e[13]=ce*i+Oe*c+Fe*A+je*H,e[14]=ce*a+Oe*p+Fe*w+je*W,e[15]=ce*o+Oe*_+Fe*I+je*oe,e}function Sp(e,r,t){var n=t[0],i=t[1],a=t[2],o,l,c,p,_,x,A,w,I,P,H,W;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],l=r[1],c=r[2],p=r[3],_=r[4],x=r[5],A=r[6],w=r[7],I=r[8],P=r[9],H=r[10],W=r[11],e[0]=o,e[1]=l,e[2]=c,e[3]=p,e[4]=_,e[5]=x,e[6]=A,e[7]=w,e[8]=I,e[9]=P,e[10]=H,e[11]=W,e[12]=o*n+_*i+I*a+r[12],e[13]=l*n+x*i+P*a+r[13],e[14]=c*n+A*i+H*a+r[14],e[15]=p*n+w*i+W*a+r[15]),e}function Ap(e,r,t){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Sv(e,r,t,n){var i=n[0],a=n[1],o=n[2],l=Math.hypot(i,a,o),c,p,_,x,A,w,I,P,H,W,oe,ce,Oe,Fe,je,tt,vt,kt,ir,ur,Zr,ln,_n,Hi;return l<ea?null:(l=1/l,i*=l,a*=l,o*=l,c=Math.sin(t),p=Math.cos(t),_=1-p,x=r[0],A=r[1],w=r[2],I=r[3],P=r[4],H=r[5],W=r[6],oe=r[7],ce=r[8],Oe=r[9],Fe=r[10],je=r[11],tt=i*i*_+p,vt=a*i*_+o*c,kt=o*i*_-a*c,ir=i*a*_-o*c,ur=a*a*_+p,Zr=o*a*_+i*c,ln=i*o*_+a*c,_n=a*o*_-i*c,Hi=o*o*_+p,e[0]=x*tt+P*vt+ce*kt,e[1]=A*tt+H*vt+Oe*kt,e[2]=w*tt+W*vt+Fe*kt,e[3]=I*tt+oe*vt+je*kt,e[4]=x*ir+P*ur+ce*Zr,e[5]=A*ir+H*ur+Oe*Zr,e[6]=w*ir+W*ur+Fe*Zr,e[7]=I*ir+oe*ur+je*Zr,e[8]=x*ln+P*_n+ce*Hi,e[9]=A*ln+H*_n+Oe*Hi,e[10]=w*ln+W*_n+Fe*Hi,e[11]=I*ln+oe*_n+je*Hi,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function bd(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[4],o=r[5],l=r[6],c=r[7],p=r[8],_=r[9],x=r[10],A=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*i+p*n,e[5]=o*i+_*n,e[6]=l*i+x*n,e[7]=c*i+A*n,e[8]=p*i-a*n,e[9]=_*i-o*n,e[10]=x*i-l*n,e[11]=A*i-c*n,e}function Q(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],p=r[8],_=r[9],x=r[10],A=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i-p*n,e[1]=o*i-_*n,e[2]=l*i-x*n,e[3]=c*i-A*n,e[8]=a*n+p*i,e[9]=o*n+_*i,e[10]=l*n+x*i,e[11]=c*n+A*i,e}function de(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],p=r[4],_=r[5],x=r[6],A=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+p*n,e[1]=o*i+_*n,e[2]=l*i+x*n,e[3]=c*i+A*n,e[4]=p*i-a*n,e[5]=_*i-o*n,e[6]=x*i-l*n,e[7]=A*i-c*n,e}function st(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function qt(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sr(e,r,t){var n=t[0],i=t[1],a=t[2],o=Math.hypot(n,i,a),l,c,p;return o<ea?null:(o=1/o,n*=o,i*=o,a*=o,l=Math.sin(r),c=Math.cos(r),p=1-c,e[0]=n*n*p+c,e[1]=i*n*p+a*l,e[2]=a*n*p-i*l,e[3]=0,e[4]=n*i*p-a*l,e[5]=i*i*p+c,e[6]=a*i*p+n*l,e[7]=0,e[8]=n*a*p+i*l,e[9]=i*a*p-n*l,e[10]=a*a*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _r(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Bt(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ur(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $r(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=n+n,c=i+i,p=a+a,_=n*l,x=n*c,A=n*p,w=i*c,I=i*p,P=a*p,H=o*l,W=o*c,oe=o*p;return e[0]=1-(w+P),e[1]=x+oe,e[2]=A-W,e[3]=0,e[4]=x-oe,e[5]=1-(_+P),e[6]=I+H,e[7]=0,e[8]=A+W,e[9]=I-H,e[10]=1-(_+w),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function tn(e,r){var t=new Ha(3),n=-r[0],i=-r[1],a=-r[2],o=r[3],l=r[4],c=r[5],p=r[6],_=r[7],x=n*n+i*i+a*a+o*o;return x>0?(t[0]=(l*o+_*n+c*a-p*i)*2/x,t[1]=(c*o+_*i+p*n-l*a)*2/x,t[2]=(p*o+_*a+l*i-c*n)*2/x):(t[0]=(l*o+_*n+c*a-p*i)*2,t[1]=(c*o+_*i+p*n-l*a)*2,t[2]=(p*o+_*a+l*i-c*n)*2),$r(e,r,t),e}function Kr(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function nn(e,r){var t=r[0],n=r[1],i=r[2],a=r[4],o=r[5],l=r[6],c=r[8],p=r[9],_=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(a,o,l),e[2]=Math.hypot(c,p,_),e}function mn(e,r){var t=new Ha(3);nn(t,r);var n=1/t[0],i=1/t[1],a=1/t[2],o=r[0]*n,l=r[1]*i,c=r[2]*a,p=r[4]*n,_=r[5]*i,x=r[6]*a,A=r[8]*n,w=r[9]*i,I=r[10]*a,P=o+_+I,H=0;return P>0?(H=Math.sqrt(P+1)*2,e[3]=.25*H,e[0]=(x-w)/H,e[1]=(A-c)/H,e[2]=(l-p)/H):o>_&&o>I?(H=Math.sqrt(1+o-_-I)*2,e[3]=(x-w)/H,e[0]=.25*H,e[1]=(l+p)/H,e[2]=(A+c)/H):_>I?(H=Math.sqrt(1+_-o-I)*2,e[3]=(A-c)/H,e[0]=(l+p)/H,e[1]=.25*H,e[2]=(x+w)/H):(H=Math.sqrt(1+I-o-_)*2,e[3]=(l-p)/H,e[0]=(A+c)/H,e[1]=(x+w)/H,e[2]=.25*H),e}function sn(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=r[3],c=i+i,p=a+a,_=o+o,x=i*c,A=i*p,w=i*_,I=a*p,P=a*_,H=o*_,W=l*c,oe=l*p,ce=l*_,Oe=n[0],Fe=n[1],je=n[2];return e[0]=(1-(I+H))*Oe,e[1]=(A+ce)*Oe,e[2]=(w-oe)*Oe,e[3]=0,e[4]=(A-ce)*Fe,e[5]=(1-(x+H))*Fe,e[6]=(P+W)*Fe,e[7]=0,e[8]=(w+oe)*je,e[9]=(P-W)*je,e[10]=(1-(x+I))*je,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Yr(e,r,t,n,i){var a=r[0],o=r[1],l=r[2],c=r[3],p=a+a,_=o+o,x=l+l,A=a*p,w=a*_,I=a*x,P=o*_,H=o*x,W=l*x,oe=c*p,ce=c*_,Oe=c*x,Fe=n[0],je=n[1],tt=n[2],vt=i[0],kt=i[1],ir=i[2],ur=(1-(P+W))*Fe,Zr=(w+Oe)*Fe,ln=(I-ce)*Fe,_n=(w-Oe)*je,Hi=(1-(A+W))*je,io=(H+oe)*je,Ga=(I+ce)*tt,To=(H-oe)*tt,Co=(1-(A+P))*tt;return e[0]=ur,e[1]=Zr,e[2]=ln,e[3]=0,e[4]=_n,e[5]=Hi,e[6]=io,e[7]=0,e[8]=Ga,e[9]=To,e[10]=Co,e[11]=0,e[12]=t[0]+vt-(ur*vt+_n*kt+Ga*ir),e[13]=t[1]+kt-(Zr*vt+Hi*kt+To*ir),e[14]=t[2]+ir-(ln*vt+io*kt+Co*ir),e[15]=1,e}function rr(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t+t,l=n+n,c=i+i,p=t*o,_=n*o,x=n*l,A=i*o,w=i*l,I=i*c,P=a*o,H=a*l,W=a*c;return e[0]=1-x-I,e[1]=_+W,e[2]=A-H,e[3]=0,e[4]=_-W,e[5]=1-p-I,e[6]=w+P,e[7]=0,e[8]=A+H,e[9]=w-P,e[10]=1-p-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qt(e,r,t,n,i,a,o){var l=1/(t-r),c=1/(i-n),p=1/(a-o);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(t+r)*l,e[9]=(i+n)*c,e[10]=(o+a)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*p,e[15]=0,e}function Wr(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var bn=Wr;function xr(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=i*o,e[14]=i*n*o):(e[10]=-1,e[14]=-n),e}function Zn(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),o=Math.tan(r.leftDegrees*Math.PI/180),l=Math.tan(r.rightDegrees*Math.PI/180),c=2/(o+l),p=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-((o-l)*c*.5),e[9]=(i-a)*p*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function jr(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),p=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=(o+a)*p,e[15]=1,e}var an=jr;function Lr(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),p=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=a*p,e[15]=1,e}function un(e,r,t,n){var i,a,o,l,c,p,_,x,A,w,I=r[0],P=r[1],H=r[2],W=n[0],oe=n[1],ce=n[2],Oe=t[0],Fe=t[1],je=t[2];return Math.abs(I-Oe)<ea&&Math.abs(P-Fe)<ea&&Math.abs(H-je)<ea?Ms(e):(_=I-Oe,x=P-Fe,A=H-je,w=1/Math.hypot(_,x,A),_*=w,x*=w,A*=w,i=oe*A-ce*x,a=ce*_-W*A,o=W*x-oe*_,w=Math.hypot(i,a,o),w?(w=1/w,i*=w,a*=w,o*=w):(i=0,a=0,o=0),l=x*o-A*a,c=A*i-_*o,p=_*a-x*i,w=Math.hypot(l,c,p),w?(w=1/w,l*=w,c*=w,p*=w):(l=0,c=0,p=0),e[0]=i,e[1]=l,e[2]=_,e[3]=0,e[4]=a,e[5]=c,e[6]=x,e[7]=0,e[8]=o,e[9]=p,e[10]=A,e[11]=0,e[12]=-(i*I+a*P+o*H),e[13]=-(l*I+c*P+p*H),e[14]=-(_*I+x*P+A*H),e[15]=1,e)}function $n(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=n[0],c=n[1],p=n[2],_=i-t[0],x=a-t[1],A=o-t[2],w=_*_+x*x+A*A;w>0&&(w=1/Math.sqrt(w),_*=w,x*=w,A*=w);var I=c*A-p*x,P=p*_-l*A,H=l*x-c*_;return w=I*I+P*P+H*H,w>0&&(w=1/Math.sqrt(w),I*=w,P*=w,H*=w),e[0]=I,e[1]=P,e[2]=H,e[3]=0,e[4]=x*H-A*P,e[5]=A*I-_*H,e[6]=_*P-x*I,e[7]=0,e[8]=_,e[9]=x,e[10]=A,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function bi(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function fn(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Gr(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function Pr(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function Qn(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function Vi(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function En(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function wi(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],l=e[5],c=e[6],p=e[7],_=e[8],x=e[9],A=e[10],w=e[11],I=e[12],P=e[13],H=e[14],W=e[15],oe=r[0],ce=r[1],Oe=r[2],Fe=r[3],je=r[4],tt=r[5],vt=r[6],kt=r[7],ir=r[8],ur=r[9],Zr=r[10],ln=r[11],_n=r[12],Hi=r[13],io=r[14],Ga=r[15];return Math.abs(t-oe)<=ea*Math.max(1,Math.abs(t),Math.abs(oe))&&Math.abs(n-ce)<=ea*Math.max(1,Math.abs(n),Math.abs(ce))&&Math.abs(i-Oe)<=ea*Math.max(1,Math.abs(i),Math.abs(Oe))&&Math.abs(a-Fe)<=ea*Math.max(1,Math.abs(a),Math.abs(Fe))&&Math.abs(o-je)<=ea*Math.max(1,Math.abs(o),Math.abs(je))&&Math.abs(l-tt)<=ea*Math.max(1,Math.abs(l),Math.abs(tt))&&Math.abs(c-vt)<=ea*Math.max(1,Math.abs(c),Math.abs(vt))&&Math.abs(p-kt)<=ea*Math.max(1,Math.abs(p),Math.abs(kt))&&Math.abs(_-ir)<=ea*Math.max(1,Math.abs(_),Math.abs(ir))&&Math.abs(x-ur)<=ea*Math.max(1,Math.abs(x),Math.abs(ur))&&Math.abs(A-Zr)<=ea*Math.max(1,Math.abs(A),Math.abs(Zr))&&Math.abs(w-ln)<=ea*Math.max(1,Math.abs(w),Math.abs(ln))&&Math.abs(I-_n)<=ea*Math.max(1,Math.abs(I),Math.abs(_n))&&Math.abs(P-Hi)<=ea*Math.max(1,Math.abs(P),Math.abs(Hi))&&Math.abs(H-io)<=ea*Math.max(1,Math.abs(H),Math.abs(io))&&Math.abs(W-Ga)<=ea*Math.max(1,Math.abs(W),Math.abs(Ga))}var gi=Cf,si=Pr;function oa(){var e=new Ha(2);return Ha!=Float32Array&&(e[0]=0,e[1]=0),e}function Io(e){var r=new Ha(2);return r[0]=e[0],r[1]=e[1],r}function hs(e,r){var t=new Ha(2);return t[0]=e,t[1]=r,t}function Gi(e,r){return e[0]=r[0],e[1]=r[1],e}function Do(e,r,t){return e[0]=r,e[1]=t,e}function Pa(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function ko(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function Fo(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function uo(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function ts(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function Ps(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Vo(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function ki(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function Ss(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function ha(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function ui(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function Oi(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function ra(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function ps(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function Us(e){var r=e[0],t=e[1];return r*r+t*t}function Ze(e,r){return e[0]=-r[0],e[1]=-r[1],e}function fr(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function Kt(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function Sn(e,r){return e[0]*r[0]+e[1]*r[1]}function Ri(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function xa(e,r,t,n){var i=r[0],a=r[1];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e}function ye(e,r){r=r||1;var t=wu()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function ke(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i,e[1]=t[1]*n+t[3]*i,e}function it(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function er(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[3]*i+t[6],e[1]=t[1]*n+t[4]*i+t[7],e}function $t(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[4]*i+t[12],e[1]=t[1]*n+t[5]*i+t[13],e}function gt(e,r,t,n){var i=r[0]-t[0],a=r[1]-t[1],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l-a*o+t[0],e[1]=i*o+a*l+t[1],e}function Et(e,r){var t=e[0],n=e[1],i=r[0],a=r[1],o=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+a*a),l=o&&(t*i+n*a)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function Ct(e){return e[0]=0,e[1]=0,e}function Ge(e){return"vec2("+e[0]+", "+e[1]+")"}function _t(e,r){return e[0]===r[0]&&e[1]===r[1]}function Pe(e,r){var t=e[0],n=e[1],i=r[0],a=r[1];return Math.abs(t-i)<=ea*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-a)<=ea*Math.max(1,Math.abs(n),Math.abs(a))}var xt=ps,hr=ko,vr=Fo,Nr=uo,kr=Oi,Hr=ra,Wn=Us,Dn=function(){var e=oa();return function(r,t,n,i,a,o){var l,c;for(t||(t=2),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],a(e,e,o),r[l]=e[0],r[l+1]=e[1];return r}}();function Bn(){var e=new Ha(3);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ai(e){var r=new Ha(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function hi(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function pa(e,r,t){var n=new Ha(3);return n[0]=e,n[1]=r,n[2]=t,n}function Ho(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function El(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function xd(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Ou(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function Ed(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function $l(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function Sd(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function Qg(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function Jg(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function ey(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function Av(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Xh(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function Lm(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function Zh(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function Nm(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function Wo(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function qa(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function ty(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function ry(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function jm(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function ny(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],l=t[1],c=t[2];return e[0]=i*c-a*l,e[1]=a*o-n*c,e[2]=n*l-i*o,e}function iy(e,r,t,n){var i=r[0],a=r[1],o=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e}function zm(e,r,t,n,i,a){var o=a*a,l=o*(2*a-3)+1,c=o*(a-2)+a,p=o*(a-1),_=o*(3-2*a);return e[0]=r[0]*l+t[0]*c+n[0]*p+i[0]*_,e[1]=r[1]*l+t[1]*c+n[1]*p+i[1]*_,e[2]=r[2]*l+t[2]*c+n[2]*p+i[2]*_,e}function $h(e,r,t,n,i,a){var o=1-a,l=o*o,c=a*a,p=l*o,_=3*a*l,x=3*c*o,A=c*a;return e[0]=r[0]*p+t[0]*_+n[0]*x+i[0]*A,e[1]=r[1]*p+t[1]*_+n[1]*x+i[1]*A,e[2]=r[2]*p+t[2]*_+n[2]*x+i[2]*A,e}function Yh(e,r){r=r||1;var t=wu()*2*Math.PI,n=wu()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function ay(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[3]*n+t[7]*i+t[11]*a+t[15];return o=o||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/o,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/o,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/o,e}function rs(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function Ad(e,r,t){var n=t[0],i=t[1],a=t[2],o=t[3],l=r[0],c=r[1],p=r[2],_=i*p-a*c,x=a*l-n*p,A=n*c-i*l,w=i*A-a*x,I=a*_-n*A,P=n*x-i*_,H=o*2;return _*=H,x*=H,A*=H,w*=2,I*=2,P*=2,e[0]=l+_+w,e[1]=c+x+I,e[2]=p+A+P,e}function wf(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Tv(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Cv(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Um(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2],c=Math.sqrt(t*t+n*n+i*i),p=Math.sqrt(a*a+o*o+l*l),_=c*p,x=_&&jm(e,r)/_;return Math.acos(Math.min(Math.max(x,-1),1))}function Tp(e){return e[0]=0,e[1]=0,e[2]=0,e}function Of(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function oy(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function sy(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2];return Math.abs(t-a)<=ea*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-o)<=ea*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=ea*Math.max(1,Math.abs(i),Math.abs(l))}var g_=Ou,As=Ed,sh=$l,uy=Zh,s=Nm,u=hi,f=Wo,g=function(){var e=Bn();return function(r,t,n,i,a,o){var l,c;for(t||(t=3),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2];return r}}();function b(){var e=new Ha(4);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function E(e){var r=new Ha(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function T(e,r,t,n){var i=new Ha(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function R(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function j(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function G(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function $(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function te(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function ne(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function Se(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Ve(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Le(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function ct(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function ft(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function Rt(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Ht(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function nr(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function Rr(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function gr(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function rn(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function on(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function kn(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function Gn(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t*t+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function zn(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function Rn(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],o=t[0]*n[3]-t[3]*n[0],l=t[1]*n[2]-t[2]*n[1],c=t[1]*n[3]-t[3]*n[1],p=t[2]*n[3]-t[3]*n[2],_=r[0],x=r[1],A=r[2],w=r[3];return e[0]=x*p-A*c+w*l,e[1]=-(_*p)+A*o-w*a,e[2]=_*c-x*o+w*i,e[3]=-(_*l)+x*a-A*i,e}function yi(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e[3]=l+n*(t[3]-l),e}function Jn(e,r){r=r||1;var t,n,i,a,o,l;do t=wu()*2-1,n=wu()*2-1,o=t*t+n*n;while(o>=1);do i=wu()*2-1,a=wu()*2-1,l=i*i+a*a;while(l>=1);var c=Math.sqrt((1-o)/l);return e[0]=r*t,e[1]=r*n,e[2]=r*i*c,e[3]=r*a*c,e}function Xn(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,e}function Ki(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],l=t[1],c=t[2],p=t[3],_=p*n+l*a-c*i,x=p*i+c*n-o*a,A=p*a+o*i-l*n,w=-o*n-l*i-c*a;return e[0]=_*p+w*-o+x*-c-A*-l,e[1]=x*p+w*-l+A*-o-_*-c,e[2]=A*p+w*-c+_*-l-x*-o,e[3]=r[3],e}function Mi(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ya(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function li(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function ta(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=r[0],l=r[1],c=r[2],p=r[3];return Math.abs(t-o)<=ea*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(n-l)<=ea*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=ea*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-p)<=ea*Math.max(1,Math.abs(a),Math.abs(p))}var Qa=$,Wa=te,ho=ne,po=nr,Ao=Rr,Is=gr,Go=rn,qs=function(){var e=b();return function(r,t,n,i,a,o){var l,c;for(t||(t=4),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],e[3]=r[l+3],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2],r[l+3]=e[3];return r}}(),Xo=v.create(),au=v.create(),ua=v.create(),Ja=v.create(),bo=v.create();function na(e,r,t,n,i){v.add(e,t,n),v.normalize(e,e),r=v.fromValues(-e[1],e[0]);var a=v.fromValues(-t[1],t[0]);return[i/v.dot(r,a),r]}function Li(e,r){return v.set(e,-r[1],r[0])}function va(e,r,t){return v.sub(e,r,t),v.normalize(e,e),e}function Na(e,r){return e[0]===r[0]&&e[1]===r[1]}function ou(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var eo=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object(et.a)(this,e),Object(V.a)(this,"lastFlip",-1),Object(V.a)(this,"miter",v.fromValues(0,0)),Object(V.a)(this,"started",!1),Object(V.a)(this,"dash",!1),Object(V.a)(this,"totalDistance",0),Object(V.a)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Object(De.a)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,H=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(i,o,x,w,P,A,I,H);o+=W}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,H=l<n.length-1?n[l+1]:null,W=this.simpleSegment(i,o,x,w,P,A,I,H);o+=W}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,_=this.segment(n,a,l,c,p);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,_=this.simpleSegment(n,a,l,c,p);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,p){var _=0,x=t.indices,A=t.positions,w=t.normals,I=this.cap==="square",P=this.join==="bevel",H=Sa([c[0],c[1]]),W=Sa([l[0],l[1]]);va(ua,a,i);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(H,W),this.totalDistance+=oe),this.normal||(this.normal=v.create(),Li(this.normal,ua)),!this.started)if(this.started=!0,I){var ce=v.create(),Oe=v.create();v.add(ce,this.normal,ua),v.add(Oe,this.normal,ua),w.push(Oe[0],Oe[1],0),w.push(ce[0],ce[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-oe,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-oe,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-oe);if(x.push(n+0,n+1,n+2),o){Na(a,o)&&v.add(o,a,v.normalize(o,v.subtract(o,a,i))),va(Ja,o,a);var tt=na(bo,v.create(),ua,Ja,this.thickness),vt=Object(hn.a)(tt,2),kt=vt[0],ir=vt[1],ur=v.dot(bo,this.normal)<0?-1:1,Zr=P;if(!Zr&&this.join==="miter"){var ln=kt;ln>this.miterLimit&&(Zr=!0)}Zr?(w.push(this.normal[0],this.normal[1],0),w.push(ir[0],ir[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,Object(cr.a)(this.lastFlip!==-ur?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),Li(Xo,Ja),v.copy(this.normal,Xo),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,ir,kt,this.totalDistance),x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ur=-1,v.copy(this.normal,ir),_+=2),this.lastFlip=ur}else{if(Li(this.normal,ua),I){var Fe=v.create(),je=v.create();v.sub(je,ua,this.normal),v.add(Fe,ua,this.normal),w.push(je[0],je[1],0),w.push(Fe[0],Fe[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,_=t.normals,x=Sa([a[0],a[1]]),A=Sa([i[0],i[1]]);va(ua,x,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(x,A),this.totalDistance+=w),this.normal||(this.normal=v.create(),Li(this.normal,ua)),this.started||(this.started=!0,this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!o)Li(this.normal,ua),this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Sa([o[0],o[1]]);Na(x,I)&&v.add(I,x,v.normalize(I,v.subtract(I,x,A))),va(Ja,I,x);var P=na(bo,v.create(),ua,Ja,this.thickness),H=Object(hn.a)(P,2),W=H[0],oe=H[1],ce=v.dot(bo,this.normal)<0?-1:1;this.extrusions(p,_,a,oe,W,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ce=-1,v.copy(this.normal,oe),l+=2,this.lastFlip=ce}return l}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",w=Sa([a[0],a[1]]),I=Sa([i[0],i[1]]);va(ua,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=v.create(),Li(this.normal,ua)),!this.started)if(this.started=!0,x){var H=v.create(),W=v.create();v.add(H,this.normal,ua),v.add(W,this.normal,ua),_.push(W[0],W[1],0),_.push(H[0],H[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),o){var Oe=Sa([o[0],o[1]]);Na(w,Oe)&&v.add(Oe,w,v.normalize(Oe,v.subtract(Oe,w,I))),va(Ja,Oe,w);var Fe=na(bo,v.create(),ua,Ja,this.thickness),je=Object(hn.a)(Fe,2),tt=je[0],vt=je[1],kt=v.dot(bo,this.normal)<0?-1:1,ir=A;if(!ir&&this.join==="miter"){var ur=tt;ur>this.miterLimit&&(ir=!0)}ir?(_.push(this.normal[0],this.normal[1],0),_.push(vt[0],vt[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,Object(cr.a)(this.lastFlip!==-kt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Li(Xo,Ja),v.copy(this.normal,Xo),_.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,_,a,vt,tt,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),kt=-1,v.copy(this.normal,vt),l+=2),this.lastFlip=kt}else{if(Li(this.normal,ua),x){var oe=v.create(),ce=v.create();v.sub(ce,ua,this.normal),v.add(oe,ua,this.normal),_.push(ce[0],ce[1],0),_.push(oe[0],oe[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function to(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new eo({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=o[l];i.extrude_gaode2(c,p)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function ds(e){var r=gs(e.coordinates);return{vertices:[].concat(Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r)),indices:[0,1,2,2,3,0],size:r.length}}function ia(e){var r=e.coordinates,t=Es.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,o=Es()(n,a,i);return{indices:o,vertices:n,size:i}}var Rf=function(){var e=Object(Zt.a)(be.a.mark(function r(t){var n,i,a,o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.iconMap,l={a_Color:ih,a_Position:pc,filter:dc,a_vertexId:Xl,a_PickingColor:function(P){var H=P.id;return a?Uu(H):[0,0,0]},a_DistanceAndIndex:function(P,H,W,oe,ce,Oe){return Oe===void 0?[W[3],10]:[W[3],Oe]},a_Total_Distance:function(P,H,W){return[W[5]]},a_Size:function(P){var H=P.size,W=H===void 0?1:H;return Array.isArray(W)?[W[0],W[1]]:[W,0]},a_Normal:function(P,H,W,oe,ce){return ce},a_Miter:function(P,H,W){return[W[4]]},a_iconMapUV:function(P){var H=P.texture,W=o[H]||{x:0,y:0},oe=W.x,ce=W.y;return[oe,ce]}},c={sizePerElement:0,elements:[]},p=0,_=[],x=3,i.forEach(function(I,P){var H=to(I),W=H.indices,oe=H.vertices,ce=H.normals,Oe=H.size,Fe=H.indexes;W.forEach(function(kt){_.push(kt+p)}),x=Oe;var je=oe.length/Oe;c.sizePerElement=x,c.elements.push({featureIdx:P,vertices:oe,normals:ce,offset:p}),p+=je;for(var tt=function(ir){var ur=(ce==null?void 0:ce.slice(ir*3,ir*3+3))||[],Zr=oe.slice(ir*Oe,ir*Oe+Oe),ln=0;Fe&&Fe[ir]!==void 0&&(ln=Fe[ir]),n.forEach(function(_n){if(_n&&l[_n.name]){var Hi;(Hi=_n.buffer.data).push.apply(Hi,Object(cr.a)(l[_n.name](I,P,Zr,ir,ur,ln)))}})},vt=0;vt<je;vt++)tt(vt)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return w.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Sl=function(){var e=Object(Zt.a)(be.a.mark(function r(t){var n,i,a,o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.shape2d,l={a_Color:ih,a_Position:pc,filter:dc,a_vertexId:Xl,a_PickingColor:function(P){var H=P.id;return a?Uu(H):[0,0,0]},a_Shape:function(P){var H=P.shape,W=H===void 0?2:H,oe=o.indexOf(W);return[oe]},a_Extrude:function(P,H,W,oe){var ce=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],Oe=oe%4*3;return[ce[Oe],ce[Oe+1],ce[Oe+2]]},a_Size:function(P){var H=P.size,W=H===void 0?5:H;return Array.isArray(W)?[W[0]]:[W]}},c={sizePerElement:0,elements:[]},p=0,_=[],x=3,i.forEach(function(I,P){var H=ds(I),W=H.indices,oe=H.vertices,ce=H.normals,Oe=H.size,Fe=H.indexes;W.forEach(function(kt){_.push(kt+p)}),x=Oe;var je=oe.length/Oe;c.sizePerElement=x,c.elements.push({featureIdx:P,vertices:oe,normals:ce,offset:p}),p+=je;for(var tt=function(ir){var ur=(ce==null?void 0:ce.slice(ir*3,ir*3+3))||[],Zr=oe.slice(ir*Oe,ir*Oe+Oe),ln=0;Fe&&Fe[ir]!==void 0&&(ln=Fe[ir]),n.forEach(function(_n){if(_n&&l[_n.name]){var Hi;(Hi=_n.buffer.data).push.apply(Hi,Object(cr.a)(l[_n.name](I,P,Zr,ir,ur,ln)))}})},vt=0;vt<je;vt++)tt(vt)}),w.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return w.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),mc=function(){var e=Object(Zt.a)(be.a.mark(function r(t){var n,i,a,o,l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o={a_Color:ih,a_Position:pc,filter:dc,a_vertexId:Xl,a_PickingColor:function(I){var P=I.id;return a?Uu(P):[0,0,0]}},l={sizePerElement:0,elements:[]},c=0,p=[],_=3,i.forEach(function(w,I){var P=ia(w),H=P.indices,W=P.vertices,oe=P.normals,ce=P.size,Oe=P.indexes;H.forEach(function(vt){p.push(vt+c)}),_=ce;var Fe=W.length/ce;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:W,normals:oe,offset:c}),c+=Fe;for(var je=function(kt){var ir=(oe==null?void 0:oe.slice(kt*3,kt*3+3))||[],ur=W.slice(kt*ce,kt*ce+ce),Zr=0;Oe&&Oe[kt]!==void 0&&(Zr=Oe[kt]),n.forEach(function(ln){if(ln&&o[ln.name]){var _n;(_n=ln.buffer.data).push.apply(_n,Object(cr.a)(o[ln.name](w,I,ur,kt,ir,Zr)))}})},tt=0;tt<Fe;tt++)je(tt)}),A.abrupt("return",{descriptors:n,featureLayout:l,indices:p});case 8:case"end":return A.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Qu={pointFill:Sl,line:Rf,polygonFill:mc},Ts=Object(ae.a)({},Qu);function uh(e){return gc.apply(this,arguments)}function gc(){return gc=Object(Zt.a)(be.a.mark(function e(r){var t,n;return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!Ts[t]){a.next=3;break}return a.abrupt("return",Ts[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),gc.apply(this,arguments)}var Zc=new Map;function Td(e,r){Zc.set(e,r)}function $c(e){var r=Zc.get(e);return r}var Mf="l7-worker",Cd=3,Cp=!0;function Vm(e){Td(Mf,e)}function wd(){var e=$c(Mf);if(!e)throw new Error("get worker failed by workerName: ".concat(Mf,"."));return e}function Hm(e,r){return Yc.apply(this,arguments)}function Yc(){return Yc=Object(Zt.a)(be.a.mark(function e(r,t){var n,i,a,o,l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n=wd(),i=Ef.getWorkerFarm({maxConcurrency:Cd,reuseWorkers:Cp}),a=i.getWorkerPool({name:Mf,source:n}),p.next=5,a.startJob(Mf,function(_,x,A){return _.done(A)});case 5:return o=p.sent,o.postMessage("process",{input:{workerType:r,data:t}}),p.next=9,o.result;case 9:return l=p.sent,p.abrupt("return",l.result);case 11:case"end":return p.stop()}},e)})),Yc.apply(this,arguments)}var wp=C("Aib3"),wv=C.n(wp);function Op(e,r){return e.map(function(t){return t[r]*1})}function lh(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Ov(e){return Array.isArray(e)?e.length===0?!1:!!lh(e[0]):!1}function Od(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Rp(e){var r=Object.isFrozen(e)?fi.cloneDeep(e):e;return wv()(r,!0),r}function Kh(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,o=r.coordinates,l=r.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(W){return W[l]&&W[l].type&&W[l].coordinates&&W[l].coordinates.length>0}).forEach(function(W,oe){var ce=Rp(W[l]);mt(ce,function(Oe){var Fe=Jr(Oe),je=Object(ae.a)(Object(ae.a)({},W),{},{_id:oe,coordinates:Fe});c.push(je)})}),{dataArray:c};for(var p=0;p<e.length;p++){var _=e[p],x=[];if(o){var A="Polygon";Array.isArray(o[0])||(A="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(A="LineString");var w=Rp({type:A,coordinates:_[o]});x=w.coordinates}else if(t&&n&&i&&a){var I=[parseFloat(_[t]),parseFloat(_[n])],P=[parseFloat(_[i]),parseFloat(_[a])];x=[I,P]}else t&&n&&(x=[parseFloat(_[t]),parseFloat(_[n])]);var H=Object(ae.a)(Object(ae.a)({},_),{},{_id:p,coordinates:x});c.push(H)}return{dataArray:c}}function Rv(e,r){var t=Ie(e);return Kh(t,r)}var Ju=C("U8pU");function Mp(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function Mv(e,r){return r===void 0?null:Object(Ju.a)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?Mp(e.properties[r]+"")%1000019:null}function Rd(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=Rp(e),e.features.length===0?{dataArray:[],featureKeys:n}:(mt(e,function(i,a){var o=Mv(i,r==null?void 0:r.featureId);o===null&&(o=a);var l=o,c=Jr(i),p=Object(ae.a)(Object(ae.a)({},i.properties),{},{coordinates:c,_id:l});t.push(p)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function qh(e,r,t,n){for(var i=n,a=t-r>>1,o=t-r,l,c=e[r],p=e[r+1],_=e[t],x=e[t+1],A=r+3;A<t;A+=3){var w=Md(e[A],e[A+1],c,p,_,x);if(w>i)l=A,i=w;else if(w===i){var I=Math.abs(A-a);I<o&&(l=A,o=I)}}i>n&&(l-r>3&&qh(e,r,l,n),e[l+2]=i,t-l>3&&qh(e,l,t,n))}function Md(e,r,t,n,i,a){var o=i-t,l=a-n;if(o!==0||l!==0){var c=((e-t)*o+(r-n)*l)/(o*o+l*l);c>1?(t=i,n=a):c>0&&(t+=o*c,n+=l*c)}return o=e-t,l=r-n,o*o+l*l}function Kc(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Pd(i),i}function Pd(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")ch(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)ch(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)ch(e,r[n][i])}function ch(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Pp(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)fh(t,e.features[n],r,n);else e.type==="Feature"?fh(t,e,r):fh(t,{geometry:e},r);return t}function fh(e,r,t,n){if(!!r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,o=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],c=r.id;if(t.promoteId?c=r.properties[t.promoteId]:t.generateId&&(c=n||0),a==="Point")Pv(i,l);else if(a==="MultiPoint")for(var p=0;p<i.length;p++)Pv(i[p],l);else if(a==="LineString")Id(i,l,o,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(p=0;p<i.length;p++)l=[],Id(i[p],l,o,!1),e.push(Kc(c,"LineString",l,r.properties));return}else Iv(i,l,o,!1);else if(a==="Polygon")Iv(i,l,o,!0);else if(a==="MultiPolygon")for(p=0;p<i.length;p++){var _=[];Iv(i[p],_,o,!0),l.push(_)}else if(a==="GeometryCollection"){for(p=0;p<r.geometry.geometries.length;p++)fh(e,{id:c,geometry:r.geometry.geometries[p],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Kc(c,a,l,r.properties))}}function Pv(e,r){r.push(Dv(e[0])),r.push(Wm(e[1])),r.push(0)}function Id(e,r,t,n){for(var i,a,o=0,l=0;l<e.length;l++){var c=Dv(e[l][0]),p=Wm(e[l][1]);r.push(c),r.push(p),r.push(0),l>0&&(n?o+=(i*p-c*a)/2:o+=Math.sqrt(Math.pow(c-i,2)+Math.pow(p-a,2))),i=c,a=p}var _=r.length-3;r[2]=1,qh(r,0,_,t),r[_+2]=1,r.size=Math.abs(o),r.start=0,r.end=r.size}function Iv(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];Id(e[i],a,t,n),r.push(a)}}function Dv(e){return e/360+.5}function Wm(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function yc(e,r,t,n,i,a,o,l){if(t/=r,n/=r,a>=t&&o<n)return e;if(o<t||a>=n)return null;for(var c=[],p=0;p<e.length;p++){var _=e[p],x=_.geometry,A=_.type,w=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(w>=t&&I<n){c.push(_);continue}else if(I<t||w>=n)continue;var P=[];if(A==="Point"||A==="MultiPoint")gb(x,P,t,n,i);else if(A==="LineString")ly(x,P,t,n,i,!1,l.lineMetrics);else if(A==="MultiLineString")xo(x,P,t,n,i,!1);else if(A==="Polygon")xo(x,P,t,n,i,!0);else if(A==="MultiPolygon")for(var H=0;H<x.length;H++){var W=[];xo(x[H],W,t,n,i,!0),W.length&&P.push(W)}if(P.length){if(l.lineMetrics&&A==="LineString"){for(H=0;H<P.length;H++)c.push(Kc(_.id,A,P[H],_.tags));continue}(A==="LineString"||A==="MultiLineString")&&(P.length===1?(A="LineString",P=P[0]):A="MultiLineString"),(A==="Point"||A==="MultiPoint")&&(A=P.length===3?"Point":"MultiPoint"),c.push(Kc(_.id,A,P,_.tags))}}return c.length?c:null}function gb(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=t&&o<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function ly(e,r,t,n,i,a,o){for(var l=Ip(e),c=i===0?y_:hh,p=e.start,_,x,A=0;A<e.length-3;A+=3){var w=e[A],I=e[A+1],P=e[A+2],H=e[A+3],W=e[A+4],oe=i===0?w:I,ce=i===0?H:W,Oe=!1;o&&(_=Math.sqrt(Math.pow(w-H,2)+Math.pow(I-W,2))),oe<t?ce>t&&(x=c(l,w,I,H,W,t),o&&(l.start=p+_*x)):oe>n?ce<n&&(x=c(l,w,I,H,W,n),o&&(l.start=p+_*x)):Al(l,w,I,P),ce<t&&oe>=t&&(x=c(l,w,I,H,W,t),Oe=!0),ce>n&&oe<=n&&(x=c(l,w,I,H,W,n),Oe=!0),!a&&Oe&&(o&&(l.end=p+_*x),r.push(l),l=Ip(e)),o&&(p+=_)}var Fe=e.length-3;w=e[Fe],I=e[Fe+1],P=e[Fe+2],oe=i===0?w:I,oe>=t&&oe<=n&&Al(l,w,I,P),Fe=l.length-3,a&&Fe>=3&&(l[Fe]!==l[0]||l[Fe+1]!==l[1])&&Al(l,l[0],l[1],l[2]),l.length&&r.push(l)}function Ip(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function xo(e,r,t,n,i,a){for(var o=0;o<e.length;o++)ly(e[o],r,t,n,i,a,!1)}function Al(e,r,t,n){e.push(r),e.push(t),e.push(n)}function y_(e,r,t,n,i,a){var o=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*o),e.push(1),o}function hh(e,r,t,n,i,a){var o=(a-t)/(i-t);return e.push(r+(n-r)*o),e.push(a),e.push(1),o}function Gm(e,r){var t=r.buffer/r.extent,n=e,i=yc(e,1,-1-t,t,0,-1,2,r),a=yc(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=yc(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=Xm(i,1).concat(n)),a&&(n=n.concat(Xm(a,-1)))),n}function Xm(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,o;if(a==="Point"||a==="MultiPoint"||a==="LineString")o=Dp(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){o=[];for(var l=0;l<i.geometry.length;l++)o.push(Dp(i.geometry[l],r))}else if(a==="MultiPolygon")for(o=[],l=0;l<i.geometry.length;l++){for(var c=[],p=0;p<i.geometry[l].length;p++)c.push(Dp(i.geometry[l][p],r));o.push(c)}t.push(Kc(i.id,a,o,i.tags))}return t}function Dp(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function _c(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,o,l;for(a=0;a<e.features.length;a++){var c=e.features[a],p=c.geometry,_=c.type;if(c.geometry=[],_===1)for(o=0;o<p.length;o+=2)c.geometry.push(Dd(p[o],p[o+1],r,t,n,i));else for(o=0;o<p.length;o++){var x=[];for(l=0;l<p[o].length;l+=2)x.push(Dd(p[o][l],p[o][l+1],r,t,n,i));c.geometry.push(x)}}return e.transformed=!0,e}function Dd(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function kd(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){o.numFeatures++,kv(o,e[l],a,i);var c=e[l].minX,p=e[l].minY,_=e[l].maxX,x=e[l].maxY;c<o.minX&&(o.minX=c),p<o.minY&&(o.minY=p),_>o.maxX&&(o.maxX=_),x>o.maxY&&(o.maxY=x)}return o}function kv(e,r,t,n){var i=r.geometry,a=r.type,o=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)o.push(i[l]),o.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")kp(o,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)kp(o,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var c=0;c<i.length;c++){var p=i[c];for(l=0;l<p.length;l++)kp(o,p[l],e,t,!0,l===0)}if(o.length){var _=r.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var x in r.tags)_[x]=r.tags[x];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var A={geometry:o,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};r.id!==null&&(A.id=r.id),e.features.push(A)}}function kp(e,r,t,n,i,a){var o=n*n;if(n>0&&r.size<(i?o:n)){t.numPoints+=r.length/3;return}for(var l=[],c=0;c<r.length;c+=3)(n===0||r[c+2]>o)&&(t.numSimplified++,l.push(r[c]),l.push(r[c+1])),t.numPoints++;i&&Zm(l,a),e.push(l)}function Zm(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=l}}function cy(e,r){return new ph(e,r)}function ph(e,r){r=this.options=fy(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Pp(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=Gm(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}ph.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ph.prototype.splitTile=function(e,r,t,n,i,a,o){for(var l=[e,r,t,n],c=this.options,p=c.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var _=1<<r,x=Fv(r,t,n),A=this.tiles[x];if(!A&&(p>1&&console.time("creation"),A=this.tiles[x]=kd(e,r,t,n,c),this.tileCoords.push({z:r,x:t,y:n}),p)){p>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,A.numFeatures,A.numPoints,A.numSimplified),console.timeEnd("creation"));var w="z"+r;this.stats[w]=(this.stats[w]||0)+1,this.total++}if(A.source=e,i){if(r===c.maxZoom||r===i)continue;var I=1<<i-r;if(t!==Math.floor(a/I)||n!==Math.floor(o/I))continue}else if(r===c.indexMaxZoom||A.numPoints<=c.indexMaxPoints)continue;if(A.source=null,e.length!==0){p>1&&console.time("clipping");var P=.5*c.buffer/c.extent,H=.5-P,W=.5+P,oe=1+P,ce,Oe,Fe,je,tt,vt;ce=Oe=Fe=je=null,tt=yc(e,_,t-P,t+W,0,A.minX,A.maxX,c),vt=yc(e,_,t+H,t+oe,0,A.minX,A.maxX,c),e=null,tt&&(ce=yc(tt,_,n-P,n+W,1,A.minY,A.maxY,c),Oe=yc(tt,_,n+H,n+oe,1,A.minY,A.maxY,c),tt=null),vt&&(Fe=yc(vt,_,n-P,n+W,1,A.minY,A.maxY,c),je=yc(vt,_,n+H,n+oe,1,A.minY,A.maxY,c),vt=null),p>1&&console.timeEnd("clipping"),l.push(ce||[],r+1,t*2,n*2),l.push(Oe||[],r+1,t*2,n*2+1),l.push(Fe||[],r+1,t*2+1,n*2),l.push(je||[],r+1,t*2+1,n*2+1)}}},ph.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e;r=(r%o+o)%o;var l=Fv(e,r,t);if(this.tiles[l])return _c(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var c=e,p=r,_=t,x;!x&&c>0;)c--,p=Math.floor(p/2),_=Math.floor(_/2),x=this.tiles[Fv(c,p,_)];return!x||!x.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",c,p,_),a>1&&console.time("drilling down"),this.splitTile(x.source,c,p,_,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?_c(this.tiles[l],i):null)};function Fv(e,r,t){return((1<<e)*t+r)*32+e}function fy(e,r){for(var t in r)e[t]=r[t];return e}var Fp=function(){function e(r,t,n,i){Object(et.a)(this,e),Object(V.a)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return Object(De.a)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),hy={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function py(e){for(var r=0,t=0,n=e.length,i=n-1,a,o;t<n;i=t++)a=e[t],o=e[i],r+=(o.x-a.x)*(a.y+o.y);return r}function el(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var o=py(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var Bv=["Unknown","Point","LineString","Polygon"];function dy(e,r,t,n,i){var a=i.geometry,o=i.type,l=i.tags,c=i.id,p=e*Math.pow(2,n),_=e*r,x=e*t,A=Bv[o],w,I;function P(oe){for(var ce=0;ce<oe.length;ce++){var Oe=oe[ce];if(Oe[3])break;var Fe=180-(Oe[1]+x)*360/p,je=(Oe[0]+_)*360/p-180,tt=360/Math.PI*Math.atan(Math.exp(Fe*Math.PI/180))-90;oe[ce]=[je,tt,0,1]}}switch(o){case 1:var H=[];for(w=0;w<a.length;w++)H[w]=a[w][0];a=H,P(a);break;case 2:for(w=0;w<a.length;w++)P(a[w]);break;case 3:for(a=el(a),w=0;w<a.length;w++)for(I=0;I<a[w].length;I++)P(a[w][I]);break}a.length===1?a=a[0]:A="Multi"+A;var W={type:"Feature",geometry:{type:A,coordinates:a},properties:l,id:c,tileOrigin:[0,0],coord:""};return W}var qc=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c){var p=n.getTile(t.z,t.x,t.y),_=p?p.features.map(function(w){return dy(a,i.x,i.y,i.z,w)}):[],x={layers:{defaultLayer:{features:_}}},A=new Fp(x,t.x,t.y,t.z);c(A)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function __(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:Object(ae.a)(Object(ae.a)({},r),e.geojsonvtOptions)}function vy(e,r){var t=__(r),n=t.extent||4096,i=cy(e,t),a=function(c,p){return qc(p,i,c,n)},o=Object(ae.a)(Object(ae.a)(Object(ae.a)({},hy),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:o,isTile:!0}}function dh(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,o=new Promise(function(c){e instanceof HTMLImageElement||ff(e)?c([e]):Bp(e,a,function(p){c(p)})}),l={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function Bp(e,r,t){var n=[];if(typeof e=="string")Ea(Object(ae.a)(Object(ae.a)({},r),{},{url:e}),function(o,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(o){Ea(Object(ae.a)(Object(ae.a)({},r),{},{url:o}),function(l,c){a++,c&&n.push(c),a===i&&t(n)})})}return dh}var Lp=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a){var o,l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o={x:n.x,y:n.y,z:n.z},l=_i(t,o),p.abrupt("return",new Promise(function(_){a?a(o,function(x,A){if(x||!A){var w={layers:{defaultLayer:{features:[]}}},I=new Fp(w,n.x,n.y,n.z);_(I)}else{var P={layers:{defaultLayer:{features:A.features}}},H=new Fp(P,n.x,n.y,n.z);_(H)}}):Bs(Object(ae.a)(Object(ae.a)({},i),{},{url:l}),function(x,A){if(x||!A){var w={layers:{defaultLayer:{features:[]}}},I=new Fp(w,n.x,n.y,n.z);_(I)}else{var P=JSON.parse(A),H={layers:{defaultLayer:{features:P}}},W=new Fp(H,n.x,n.y,n.z);_(W)}})}));case 3:case"end":return p.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function Np(e,r){var t=function(a,o){return Lp(e,o,r==null?void 0:r.requestParameters,r.getCustomData)},n=Object(ae.a)(Object(ae.a)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var jp=C("dA7e"),gy=C("eRUA"),yy=C.n(gy),$m=function(){function e(r,t,n,i){Object(et.a)(this,e),Object(V.a)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new jp.VectorTile(new yy.a(r))}return Object(De.a)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var o=n.feature(a),l=o.toGeoJSON(this.x,this.y,this.z);i.push(Object(ae.a)(Object(ae.a)({},l),{},{properties:Object(ae.a)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),_y={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},Ym=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a,o){var l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l=_i(t,n),p.abrupt("return",new Promise(function(_){if(o)o({x:i.x,y:i.y,z:i.z},function(A,w){if(A||!w)_(void 0);else{var I=new $m(w,i.x,i.y,i.z);_(I)}});else{var x=di(Object(ae.a)(Object(ae.a)({},a),{},{url:l}),function(A,w){if(A||!w)_(void 0);else{var I=new $m(w,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return x.cancel()}}}));case 2:case"end":return p.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}();function Km(e,r){var t=Array.isArray(e)?e[0]:e,n=function(o,l){return Ym(t,o,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=Object(ae.a)(Object(ae.a)(Object(ae.a)({},_y),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function Pf(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function zp(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(w){return w.rasterData}),o=n*i,l=[],c=JSON.stringify(e),p=0;p<o;p++){var _=JSON.parse(c),x=Lv(_,a,p);if(typeof x=="number")l.push(x);else{var A=Nv(_);l.push(A)}}return l}function Lv(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:Lv(n,r,t)}})}function qm(e){var r=Object(hn.a)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],o=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,o]}function Nv(e){var r=qm(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=Nv(e[1])),Array.isArray(i)&&(i=Nv(e[2])),Pf(t,n,i)}var Qm={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:by}};function by(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],o=(r==null?void 0:r.countCut)||[2,98],l=Object(hn.a)(o,2),c=l[0],p=l[1],_=(r==null?void 0:r.RMinMax)||jv(t,c,p),x=(r==null?void 0:r.GMinMax)||jv(n,c,p),A=(r==null?void 0:r.BMinMax)||jv(i,c,p),w=0;w<t.length;w++)a.push(Math.max(0,t[w]-_[0])),a.push(Math.max(0,n[w]-x[0])),a.push(Math.max(0,i[w]-A[0]));return{rasterData:a,rMinMax:_,gMinMax:x,bMinMax:A}}function jv(e,r,t){var n=e.slice().sort(function(l,c){return l-c}),i=n.length,a=n[Math.ceil(i*r/100)],o=n[Math.ceil(i*t/100)];return[a,o]}function Fd(e,r,t){return zv.apply(this,arguments)}function zv(){return zv=Object(Zt.a)(be.a.mark(function e(r,t,n){var i,a,o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.length!==0){x.next=2;break}return x.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return x.next=4,Promise.all(r.map(function(A){var w=A.data,I=A.bands,P=I===void 0?[0]:I;return t(w,P)}));case 4:i=x.sent,a=[],i.forEach(function(A){Array.isArray(A)?a.push.apply(a,Object(cr.a)(A)):a.push(A)}),o=a[0],l=o.width,c=o.height,x.t0=Object(Ju.a)(n),x.next=x.t0==="function"?11:x.t0==="object"?13:15;break;case 11:return p=n(a),x.abrupt("break",16);case 13:return Array.isArray(n)?p={rasterData:zp(n,a)}:p=Bd(n,a),x.abrupt("break",16);case 15:p={rasterData:a[0].rasterData};case 16:return x.abrupt("return",Object(ae.a)(Object(ae.a)({},p),{},{width:l,height:c}));case 17:case"end":return x.stop()}},e)})),zv.apply(this,arguments)}function Bd(e,r){var t=Qm[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?xy(t.expression,r):{rasterData:zp(t.expression,r)}}function xy(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=zp(e.r||["band",0],r),n=zp(e.g||["band",0],r),i=zp(e.b||["band",0],r);return[t,n,i]}function Up(e,r,t,n){return Jm.apply(this,arguments)}function Jm(){return Jm=Object(Zt.a)(be.a.mark(function e(r,t,n,i){var a;return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,Fd(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),Jm.apply(this,arguments)}function Ey(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,o=r.max,l=r.format,c=r.operation,p,_,x;if(l===void 0||Od(e))p=Array.from(e),_=n,x=i;else{var A=Array.isArray(e)?e:[e];p=Fd(A,l,c)}var w={_id:1,dataArray:[{_id:1,data:p,width:_,height:x,min:a,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return w}var yb=C("mNvP"),Qr=C("4cb6"),b_=C("APxj"),x_=C.n(b_),Yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},E_=C("rxlC"),S_=C.n(E_);function Sy(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Qc(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Qc(e,r){if(!!e){if(typeof e=="string")return Ld(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ld(e,r)}}function Ld(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Vp=30;function Ay(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,o=e.mapping,l=o===void 0?{}:o,c=e.xOffset,p=c===void 0?0:c,_=e.yOffset,x=_===void 0?0:_,A=0,w=p;Array.from(r).forEach(function(P,H){if(!l[P]){var W=t(P,H);w+Vp>a&&(w=0,A++),l[P]={x:w,y:x+A*Vp,width:Vp,height:Vp,advance:W},w+=Vp}});var I=n+i*2;return{mapping:l,xOffset:w,yOffset:x+A*I,canvasHeight:_b(x+(A+1)*I)}}function eg(e,r,t){var n=0,i=0,a=0,o=[],l={},c=Sy(e),p;try{for(c.s();!(p=c.n()).done;){var _=p.value;if(!l[_.id]){var x=_.size;n+x+r>t&&(tg(l,o,i),n=0,i=a+i+r,a=0,o=[]),o.push({icon:_,xOffset:n}),n=n+x+r,a=Math.max(a,x)}}}catch(w){c.e(w)}finally{c.f()}o.length>0&&tg(l,o,i);var A=_b(a+i+r);return{mapping:l,canvasHeight:A}}function tg(e,r,t){var n=Sy(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.icon,l=a.xOffset;e[o.id]=Object(ae.a)(Object(ae.a)({},o),{},{x:l,y:t,image:o.image,width:o.width,height:o.height})}}catch(c){n.e(c)}finally{n.f()}}function _b(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var bb,xb;function Eb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=a3(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function a3(e,r){if(!!e){if(typeof e=="string")return Sb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sb(e,r)}}function Sb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function o3(e){var r=s3();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function s3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var u3=g3(),l3="sans-serif",c3="normal",f3=24,h3=3,p3=.25,d3=8,Ab=1024,v3=1,Tb=1,m3=3,nH=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function g3(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Cb(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function wb(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var y3=(bb=Object(Qr.injectable)(),bb(xb=function(e){Object(Lt.a)(t,e);var r=o3(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"fontAtlas",void 0),Object(V.a)(Object(Be.a)(n),"iconFontMap",void 0),Object(V.a)(Object(Be.a)(n),"iconFontGlyphs",{}),Object(V.a)(Object(Be.a)(n),"fontOptions",void 0),Object(V.a)(Object(Be.a)(n),"key",void 0),Object(V.a)(Object(Be.a)(n),"cache",new Nc(m3)),n}return Object(De.a)(t,[{key:"scale",get:function(){return Tb}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:l3,fontWeight:c3,characterSet:u3,fontSize:f3,buffer:h3,sdf:!0,cutoff:p3,radius:d3,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(o){a.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=Object(ae.a)(Object(ae.a)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&a.length===0)){var l=this.generateFontAtlas(this.key,a,o);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var o=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){o.emit("fontloaded",{fontFamily:i})})}catch(c){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(c)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,o){var l=this.fontOptions,c=l.fontFamily,p=l.fontWeight,_=l.fontSize,x=l.buffer,A=l.sdf,w=l.radius,I=l.cutoff,P=l.iconfont,H=o&&o.data;H||(H=window.document.createElement("canvas"),H.width=Ab);var W=H.getContext("2d",{willReadFrequently:!0});Cb(W,c,_,p);var oe=Ay(Object(ae.a)({getFontWidth:function(Co){return W.measureText(Co).width},fontHeight:_*Tb,buffer:x,characterSet:a,maxCanvasWidth:Ab},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),ce=oe.mapping,Oe=oe.canvasHeight,Fe=oe.xOffset,je=oe.yOffset,tt=W.getImageData(0,0,H.width,H.height);if(H.height=Oe,W.putImageData(tt,0,0),Cb(W,c,_,p),A){var vt=new S_.a(_,x,w,I,c,p),kt=W.getImageData(0,0,vt.size,vt.size),ir=Eb(a),ur;try{for(ir.s();!(ur=ir.n()).done;){var Zr=ur.value;if(P){var ln=String.fromCharCode(parseInt(Zr.replace("&#x","").replace(";",""),16)),_n=vt.draw(ln);wb(_n,kt)}else wb(vt.draw(Zr),kt);W.putImageData(kt,ce[Zr].x,ce[Zr].y)}}catch(To){ir.e(To)}finally{ir.f()}}else{var Hi=Eb(a),io;try{for(Hi.s();!(io=Hi.n()).done;){var Ga=io.value;W.fillText(Ga,ce[Ga].x,ce[Ga].y+_*v3)}}catch(To){Hi.e(To)}finally{Hi.f()}}return{xOffset:Fe,yOffset:je,mapping:ce,data:H,width:H.width,height:H.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,o=i.fontWeight;return"".concat(a,"_").concat(o)}},{key:"getNewChars",value:function(i,a){var o=this.cache.get(i);if(!o)return a;var l=[],c=o.mapping,p=new Set(Object.keys(c)),_=new Set(a);return _.forEach(function(x){p.has(x)||l.push(x)}),l}}]),t}(Po.EventEmitter))||xb),Ob,Rb;function _3(e){var r=b3();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function b3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x3=3,Mb=1024,rg=64,E3=(Ob=Object(Qr.injectable)(),Ob(Rb=function(e){Object(Lt.a)(t,e);var r=_3(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"canvasHeight",128),Object(V.a)(Object(Be.a)(n),"texture",void 0),Object(V.a)(Object(Be.a)(n),"canvas",void 0),Object(V.a)(Object(Be.a)(n),"iconData",void 0),Object(V.a)(Object(Be.a)(n),"iconMap",void 0),Object(V.a)(Object(Be.a)(n),"ctx",void 0),Object(V.a)(Object(Be.a)(n),"loadingImageCount",0),n}return Object(De.a)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o,l){var c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=new Image,this.loadingImageCount++,this.hasImage(o)?console.warn("Image Id already exists"):this.iconData.push({id:o,size:rg}),this.updateIconMap(),x.next=6,this.loadImage(l);case 6:c=x.sent,p=this.iconData.find(function(A){return A.id===o}),p&&(p.image=c,p.width=c.width,p.height=c.height),this.update();case 10:case"end":return x.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,o){var l=this,c=o.getSceneConfig().canvas,p=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:rg}),this.updateIconMap(),this.loadImageMini(a,c).then(function(_){p=_;var x=l.iconData.find(function(A){return A.id===i});x&&(x.image=p,x.width=p.width,x.height=p.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,o){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){o(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=Mb,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var o=i.iconMap[a],l=o.x,c=o.y,p=o.image,_=o.width,x=_===void 0?64:_,A=o.height,w=A===void 0?64:A,I=Math.max(x,w),P=I/rg,H=w/P,W=x/P;p&&i.ctx.drawImage(p,l+(rg-W)/2,c+(rg-H)/2,W,H)})}},{key:"updateIconMap",value:function(){var i=eg(this.iconData,x3,Mb),a=i.mapping,o=i.canvasHeight;this.iconMap=a,this.canvasHeight=o}},{key:"loadImageMini",value:function(i,a){return new Promise(function(o,l){var c=a.createImage();c.crossOrigin="anonymous",c.onload=function(){o(c)},c.onerror=function(){l(new Error("Could not load image at "+i))},c.src=i})}}]),t}(Po.EventEmitter))||Rb),Pb,Ib,S3=(Pb=Object(Qr.injectable)(),Pb(Ib=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"viewport",void 0),Object(V.a)(this,"overridedViewProjectionMatrix",void 0),Object(V.a)(this,"jitteredViewProjectionMatrix",void 0),Object(V.a)(this,"jitteredProjectionMatrix",void 0),Object(V.a)(this,"viewMatrixInverse",void 0),Object(V.a)(this,"cameraPosition",void 0)}return Object(De.a)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=k.create(),k.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=Object(hn.a)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=k.fromTranslation(k.create(),[t,n,0]);this.jitteredProjectionMatrix=k.multiply(k.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=k.multiply(k.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Ib),Nd=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Db,kb;function A3(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=T3(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function T3(e,r){if(!!e){if(typeof e=="string")return Fb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Fb(e,r)}}function Fb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var C3={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},w3=(Db=Object(Qr.injectable)(),Db(kb=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"container",void 0),Object(V.a)(this,"controlCorners",void 0),Object(V.a)(this,"controlContainer",void 0),Object(V.a)(this,"scene",void 0),Object(V.a)(this,"mapsService",void 0),Object(V.a)(this,"controls",[]),Object(V.a)(this,"unAddControls",[])}return Object(De.a)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Yt.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=A3(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=D.create("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=l.map(function(p){return n+p}).join(" ");t[l.filter(function(p){return!["row","column"].includes(p)}).join("")]=D.create("div",c,i)}function o(l){var c=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat(Object(cr.a)(c),[C3[l]])}Object.values(Nd).forEach(function(l){a(o(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&D.remove(this.controlCorners[t]);this.controlContainer&&D.remove(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(!!n)for(var i=function(){var c=o[a],p=c.match(/^(top|bottom)(left|right)$/);if(p){var _=Object(hn.a)(p,3),x=_[1],A=_[2],w=t.controlCorners["".concat(x).concat(A)],I=new n(function(P){var H=Object(hn.a)(P,1),W=H[0].target;w&&(w.style[x]=W.clientHeight+"px")});I.observe(t.controlCorners["".concat(A).concat(x)],{childList:!0,attributes:!0})}},a=0,o=Object.keys(this.controlCorners);a<o.length;a++)i()}}]),e}())||kb),Bb,Lb,O3=(Bb=Object(Qr.injectable)(),Bb(Lb=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"container",void 0),Object(V.a)(this,"scene",void 0),Object(V.a)(this,"mapsService",void 0),Object(V.a)(this,"markers",[]),Object(V.a)(this,"markerLayers",[]),Object(V.a)(this,"unAddMarkers",[]),Object(V.a)(this,"unAddMarkerLayers",[])}return Object(De.a)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||Lb),Nb,jb,R3=(Nb=Object(Qr.injectable)(),Nb(jb=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"scene",void 0),Object(V.a)(this,"mapsService",void 0),Object(V.a)(this,"popups",[]),Object(V.a)(this,"unAddPopups",[])}return Object(De.a)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat(Object(cr.a)(this.popups),Object(cr.a)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService)}}]),e}())||jb),Hp=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),jd=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Ty=function(e){return e.AND="and",e.OR="or",e}({}),su=function(e){return e.INIT="init",e.UPDATE="update",e}({}),M3={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},P3=M3,zb,Ub,I3=fi.merge,D3={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},k3={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Ty.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},F3=(zb=Object(Qr.injectable)(),zb(Ub=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"sceneConfigCache",{}),Object(V.a)(this,"layerConfigCache",{}),Object(V.a)(this,"layerAttributeConfigCache",{})}return Object(De.a)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return P3[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=Object(ae.a)(Object(ae.a)({},D3),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=Object(ae.a)({},I3({},this.sceneConfigCache[t],k3,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=Object(ae.a)(Object(ae.a)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Ub);function ma(e,r,t,n){!t||Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function da(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(o,l){return l(e,r,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}function iH(e,r){throw new Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}var A_=Math.PI/180,B3=512,Vb=4003e4;function Hb(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,o=e.highPrecision,l=o===void 0?!1:o,c=e.flipY,p=c===void 0?!1:c;a=a!==void 0?a:Math.pow(2,i);var _={},x=B3*a,A=Math.cos(t*A_),w=x/360,I=w/A,P=x/Vb/A;if(_.pixelsPerMeter=[P,-P,P],_.metersPerPixel=[1/P,-1/P,1/P],_.pixelsPerDegree=[w,-I,P],_.degreesPerPixel=[1/w,-1/I,1/P],l){var H=A_*Math.tan(t*A_)/A,W=w*H/2,oe=x/Vb*H,ce=oe/I*P;_.pixelsPerDegree2=[0,-W,oe],_.pixelsPerMeter2=[ce,0,ce],p&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return p&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var Yl=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),zd={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Wb,Gb,Xb,T_,Zb,L3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],N3=(Wb=Object(Qr.injectable)(),Gb=Object(Qr.inject)(Yt.ICameraService),Wb(Xb=(T_=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"needRefresh",!0),ma(this,"cameraService",Zb,this),Object(V.a)(this,"coordinateSystem",void 0),Object(V.a)(this,"viewportCenter",void 0),Object(V.a)(this,"viewportCenterProjection",void 0),Object(V.a)(this,"pixelsPerDegree",void 0),Object(V.a)(this,"pixelsPerDegree2",void 0),Object(V.a)(this,"pixelsPerMeter",void 0)}return Object(De.a)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),o=Hb({latitude:a[1],zoom:n}),l=o.pixelsPerMeter,c=o.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Yl.LNGLAT||this.coordinateSystem===Yl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Yl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===Yl.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var o=Hb({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=o.pixelsPerMeter,c=o.pixelsPerDegree,p=o.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),x=this.cameraService.getProjectionMatrix(),A=k.multiply([],x,_),w=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=U.transformMat4([],[w[0],w[1],0,1],A),_=this.cameraService.getViewMatrixUncentered()||_,A=k.multiply([],x,_),A=k.multiply([],A,L3),this.cameraService.setViewProjectionMatrix(A),this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=p}}]),e}(),Zb=da(T_.prototype,"cameraService",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T_))||Xb),$b,Yb;function j3(e){var r=z3();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U3=($b=Object(Qr.injectable)(),$b(Yb=function(e){Object(Lt.a)(t,e);var r=j3(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"renderMap",new Map),Object(V.a)(Object(Be.a)(n),"enable",!1),Object(V.a)(Object(Be.a)(n),"renderEnable",!1),Object(V.a)(Object(Be.a)(n),"cacheLogs",{}),n}return Object(De.a)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var o=this;if(!!this.enable){var l=i.split("."),c=null;l.forEach(function(p,_){c!==null?(c[p]||(c[p]={}),_!==l.length-1&&(c=c[p])):(o.cacheLogs[p]||(o.cacheLogs[p]={}),_!==l.length-1&&(c=o.cacheLogs[p])),_===l.length-1&&(c[p]=Object(ae.a)(Object(ae.a)({time:Date.now()},c[p]),a))})}}},{key:"getLog",value:function(i){var a=this;switch(Object(Ju.a)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(o){return a.cacheLogs[o]}).filter(function(o){return o!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Fn():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,Object(ae.a)(Object(ae.a)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var o=a.renderStart,l=Date.now();this.emit("renderEnd",Object(ae.a)(Object(ae.a)({},a),{},{renderEnd:l,renderDuration:l-o})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(Po.EventEmitter))||Yb),V3=C("yLV6"),ng=C.n(V3),Tl=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Kb,qb,Qb,C_,Jb;function H3(e){var r=W3();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function W3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},X3=(Kb=Object(Qr.injectable)(),qb=Object(Qr.inject)(Yt.IMapService),Kb(Qb=(C_=function(e){Object(Lt.a)(t,e);var r=H3(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"indragging",!1),ma(Object(Be.a)(n),"mapService",Jb,Object(Be.a)(n)),Object(V.a)(Object(Be.a)(n),"hammertime",void 0),Object(V.a)(Object(Be.a)(n),"lastClickTime",0),Object(V.a)(Object(Be.a)(n),"lastClickXY",[-1,-1]),Object(V.a)(Object(Be.a)(n),"clickTimer",void 0),Object(V.a)(Object(Be.a)(n),"$containter",void 0),Object(V.a)(Object(Be.a)(n),"onDrag",function(l){var c=n.interactionEvent(l);c.type=G3[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Tl.Drag,c)}),Object(V.a)(Object(Be.a)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var c=n.interactionEvent(l);n.emit(Tl.Hover,c)}),Object(V.a)(Object(Be.a)(n),"onTouch",function(l){var c=l.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),Object(V.a)(Object(Be.a)(n),"onHover",function(l){var c=l.clientX,p=l.clientY,_=c,x=p,A=l.type,w=n.mapService.getMapContainer();if(w){var I=w.getBoundingClientRect(),P=I.top,H=I.left;_=_-H-w.clientLeft,x=x-P-w.clientTop}var W=n.mapService.containerToLngLat([_,x]);if(A==="click"){n.isDoubleTap(_,x,W);return}if(A==="touch"){n.isDoubleTap(_,x,W);return}A!=="click"&&A!=="dblclick"&&n.emit(Tl.Hover,{x:_,y:x,lngLat:W,type:A,target:l})}),n}return Object(De.a)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Tl.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,o=i.y;this.emit(Tl.Hover,{x:a,y:o})}},{key:"triggerSelect",value:function(i){this.emit(Tl.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(Tl.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new ng.a.Manager(i);a.add(new ng.a.Tap({event:"dblclick",taps:2})),a.add(new ng.a.Tap({event:"click"})),a.add(new ng.a.Pan({threshold:0,pointers:0})),a.add(new ng.a.Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,o=i.pointerType,l,c;o==="touch"?(c=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var p=this.mapService.getMapContainer();if(p){var _=p.getBoundingClientRect(),x=_.top,A=_.left;l-=A,c-=x}var w=this.mapService.containerToLngLat([l,c]);return{x:l,y:c,lngLat:w,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,o){var l=this,c=new Date().getTime(),p="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),p="dblclick",this.emit(Tl.Hover,{x:i,y:a,lngLat:o,type:p})):(this.lastClickTime=c,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){p="click",l.emit(Tl.Hover,{x:i,y:a,lngLat:o,type:p})},400))}}]),t}(m.a),Jb=da(C_.prototype,"mapService",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_))||Qb),Z3=0;function $3(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Z3++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function Y3(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,o=Array.from(i.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var Y=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),ex,tx,rx,nx,ix,ax,ox,Ud,sx,ux,lx,cx,fx,K3=(ex=Object(Qr.injectable)(),tx=Object(Qr.inject)(Yt.IMapService),rx=Object(Qr.inject)(Yt.IRendererService),nx=Object(Qr.inject)(Yt.IGlobalConfigService),ix=Object(Qr.inject)(Yt.IInteractionService),ax=Object(Qr.inject)(Yt.ILayerService),ex(ox=(Ud=function(){function e(){var r=this;Object(et.a)(this,e),Object(V.a)(this,"pickedColors",void 0),Object(V.a)(this,"pickedTileLayers",[]),ma(this,"mapService",sx,this),ma(this,"rendererService",ux,this),ma(this,"configService",lx,this),ma(this,"interactionService",cx,this),ma(this,"layerService",fx,this),Object(V.a)(this,"pickingFBO",void 0),Object(V.a)(this,"width",0),Object(V.a)(this,"height",0),Object(V.a)(this,"alreadyInPicking",!1),Object(V.a)(this,"pickBufferScale",1),Object(V.a)(this,"pickFromPickingFBO",function(t,n){var i=n.x,a=n.y,o=n.lngLat,l=n.type,c=n.target,p=!1,_=r.rendererService,x=_.readPixels,A=_.getContainer,w=r.getContainerSize(A()),I=w.width,P=w.height;I*=D.DPR,P*=D.DPR;var H=t.getLayerConfig(),W=H.enableHighlight,oe=H.enableSelect,ce=i*D.DPR,Oe=a*D.DPR;if(ce>I-1*D.DPR||ce<0||Oe>P-1*D.DPR||Oe<0)return!1;var Fe=x({x:Math.floor(ce/r.pickBufferScale),y:Math.floor((P-(a+1)*D.DPR)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=Fe,Fe[0]!==0||Fe[1]!==0||Fe[2]!==0){var je=zu(Fe),tt=t.layerPickService.getFeatureById(je);je!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var vt={x:i,y:a,type:l,lngLat:o,featureId:je,feature:tt,target:c};tt&&(p=!0,t.setCurrentPickId(je),r.triggerHoverOnLayer(t,vt))}else{var kt={x:i,y:a,lngLat:o,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:c,feature:null};r.triggerHoverOnLayer(t,Object(ae.a)(Object(ae.a)({},kt),{},{type:"unpick"})),r.triggerHoverOnLayer(t,kt),t.setCurrentPickId(null)}if(W&&t.layerPickService.highlightPickedFeature(Fe),oe&&l==="click"&&(Fe==null?void 0:Fe.toString())!==[0,0,0,0].toString()){var ir=zu(Fe);t.getCurrentSelectedId()===null||ir!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(Fe),t.setCurrentSelectedId(ir)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return p})}return Object(De.a)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,o=n.getContainer,l=this.getContainerSize(o()),c=l.width,p=l.height;c*=D.DPR,p*=D.DPR,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(c/this.pickBufferScale),height:Math.round(p/this.pickBufferScale),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(Tl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a,o){var l=this,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:c=this.rendererService,p=c.useFramebuffer,_=c.clear,this.resizePickingFBO(),p(this.pickingFBO,function(){_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var w=l.pickBox(i,a);o(w)});case 3:case"end":return A.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(ir){var ur=ir<0?0:ir;return Math.floor(ur*D.DPR/i.pickBufferScale)}),o=Object(hn.a)(a,4),l=o[0],c=o[1],p=o[2],_=o[3],x=this.rendererService,A=x.readPixels,w=x.getContainer,I=this.getContainerSize(w()),P=I.width,H=I.height;if(P*=D.DPR,H*=D.DPR,l>(P-1)*D.DPR/this.pickBufferScale||p<0||c>(H-1)*D.DPR/this.pickBufferScale||_<0)return[];for(var W=Math.min(P/this.pickBufferScale,p)-l,oe=Math.min(H/this.pickBufferScale,_)-c,ce=A({x:l,y:Math.floor(H/this.pickBufferScale-(_+1)),width:W,height:oe,data:new Uint8Array(W*oe*4),framebuffer:this.pickingFBO}),Oe=[],Fe={},je=0;je<ce.length/4;je=je+1){var tt=ce.slice(je*4,je*4+4),vt=zu(tt);if(vt!==-1&&!Fe[vt]){var kt=t.layerPickService.getFeatureById(vt);Oe.push(Object(ae.a)(Object(ae.a)({},kt),{},{pickedFeatureIdx:vt})),Fe[vt]=!0}}return Oe}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,o=a===void 0?"":a,l=i.cursorEnabled;if(l){var c=this.mapService.version,p=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=p==null?void 0:p.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?p==null||p.style.setProperty("cursor",""):n==="mousemove"&&(p==null||p.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/D.DPR,height:t.height/D.DPR}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=D.DPR,a*=D.DPR,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){var a=this,o,l,c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=this.rendererService,l=o.useFramebuffer,c=o.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var x=a.layerService.getRenderList();x.filter(function(A){return A.needPick(i.type)}).reverse().some(function(A){c({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),A.layerPickService.pickRender(i);var w=a.pickFromPickingFBO(A,i);return a.layerService.pickedLayerId=w?+A.id:-1,w&&!A.getLayerConfig().enablePropagation})});case 3:case"end":return _.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Y3(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),sx=da(Ud.prototype,"mapService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=da(Ud.prototype,"rendererService",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=da(Ud.prototype,"configService",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=da(Ud.prototype,"interactionService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fx=da(Ud.prototype,"layerService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud))||ox),q3=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;Object(et.a)(this,e),Object(V.a)(this,"autoStart",void 0),Object(V.a)(this,"startTime",0),Object(V.a)(this,"oldTime",0),Object(V.a)(this,"running",!1),Object(V.a)(this,"elapsedTime",0),this.autoStart=r}return Object(De.a)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),hx,px,dx,vx,mx,ig,gx,yx,_x;function w_(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Q3(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Q3(e,r){if(!!e){if(typeof e=="string")return bx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bx(e,r)}}function bx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function J3(e){var r=eR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function eR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xx=fi.throttle,tR=(hx=Object(Qr.injectable)(),px=Object(Qr.inject)(Yt.IRendererService),dx=Object(Qr.inject)(Yt.IMapService),vx=Object(Qr.inject)(Yt.IDebugService),hx(mx=(ig=function(e){Object(Lt.a)(t,e);var r=J3(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"pickedLayerId",-1),Object(V.a)(Object(Be.a)(n),"clock",new q3),Object(V.a)(Object(Be.a)(n),"alreadyInRendering",!1),Object(V.a)(Object(Be.a)(n),"layers",[]),Object(V.a)(Object(Be.a)(n),"layerList",[]),Object(V.a)(Object(Be.a)(n),"layerRenderID",void 0),Object(V.a)(Object(Be.a)(n),"sceneInited",!1),Object(V.a)(Object(Be.a)(n),"animateInstanceCount",0),Object(V.a)(Object(Be.a)(n),"shaderPicking",!0),Object(V.a)(Object(Be.a)(n),"enableRender",!0),ma(Object(Be.a)(n),"renderService",gx,Object(Be.a)(n)),ma(Object(Be.a)(n),"mapService",yx,Object(Be.a)(n)),ma(Object(Be.a)(n),"debugService",_x,Object(Be.a)(n)),Object(V.a)(Object(Be.a)(n),"reRender",xx(function(){n.renderLayers()},32)),Object(V.a)(Object(Be.a)(n),"throttleRenderLayers",xx(function(){n.renderLayers()},16)),n}return Object(De.a)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o=this;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var p=Object(Zt.a)(be.a.mark(function _(x){return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(x.startInit){w.next=4;break}return w.next=3,x.init();case 3:o.updateLayerRenderList();case 4:case"end":return w.stop()}},_)}));return function(_){return p.apply(this,arguments)}}());case 2:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o,l){var c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:l?(c=l.layerChildren.indexOf(o),c>-1&&l.layerChildren.splice(c,1)):(p=this.layers.indexOf(o),p>-1&&this.layers.splice(p,1)),o.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return x.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){w.next=2;break}return w.abrupt("return");case 2:this.updateLayerRenderList(),o=this.debugService.generateRenderUid(),this.debugService.renderStart(o),this.alreadyInRendering=!0,this.clear(),this.renderService.beginFrame(),l=w_(this.layerList),w.prev=9,l.s();case 11:if((c=l.n()).done){w.next=24;break}if(p=c.value,_=p.getLayerConfig(),x=_.enableMask,p.masks.filter(function(I){return I.inited}).length>0&&x&&this.renderMask(p.masks),!p.getLayerConfig().enableMultiPassRenderer){w.next=20;break}return w.next=18,p.renderMultiPass();case 18:w.next=22;break;case 20:return w.next=22,p.render();case 22:w.next=11;break;case 24:w.next=29;break;case 26:w.prev=26,w.t0=w.catch(9),l.e(w.t0);case 29:return w.prev=29,l.f(),w.finish(29);case 32:this.renderService.endFrame(),this.debugService.renderEnd(o),this.alreadyInRendering=!1;case 35:case"end":return w.stop()}},a,this,[[9,26,29,32]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var o=i.length>1?jd.MULTIPLE:jd.SINGLE,l=w_(i),c;try{for(l.s();!(c=l.n()).done;){var p=c.value;p.render({isStencil:!0,stencilType:o,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,o.hooks.beforeRenderData.promise();case 2:l=p.sent,l&&this.renderLayers();case 4:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,o=i.getLayerConfig(),l=o.enableMask,c=l===void 0?!0:l,p=i.tileMask?1:0,_=i.masks.filter(function(P){return P.inited});p=p+(c?_.length:1);var x=p>1?jd.MULTIPLE:jd.SINGLE;if((i.tileMask||_.length&&c)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&c){var A=w_(_),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;I.render({isStencil:!0,stencilType:x,stencilIndex:a++})}}catch(P){A.e(P)}finally{A.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:x,stencilIndex:a++,stencilOperation:Ty.OR})}},{key:"renderTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.renderTileLayerMask(o),!o.getLayerConfig().enableMultiPassRenderer){c.next=6;break}return c.next=4,o.renderMultiPass();case 4:c.next=8;break;case 6:return c.next=8,o.render();case 8:case"end":return c.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,o){return a.zIndex-o.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=Ui(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(Po.EventEmitter),gx=da(ig.prototype,"renderService",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=da(ig.prototype,"mapService",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x=da(ig.prototype,"debugService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig))||mx),vh=C("Ff2n"),rR=fi.isNil,nR=function(){function e(r){var t=this;Object(et.a)(this,e),Object(V.a)(this,"name",void 0),Object(V.a)(this,"type",void 0),Object(V.a)(this,"scale",void 0),Object(V.a)(this,"descriptor",void 0),Object(V.a)(this,"featureBufferLayout",[]),Object(V.a)(this,"needRescale",!1),Object(V.a)(this,"needRemapping",!1),Object(V.a)(this,"needRegenerateVertices",!1),Object(V.a)(this,"featureRange",{startIndex:0,endIndex:Infinity}),Object(V.a)(this,"vertexAttribute",void 0),Object(V.a)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,o){var l,c=(l=t.scale)===null||l===void 0?void 0:l.scalers[o].func,p=c(a);return p})}),this.setProps(r)}return Object(De.a)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,Object(cr.a)(t));if(!rR(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),iR=["buffer","update","name"],aR=["buffer","update","name"],ag,Ex,Sx,Ax,O_,Tx,oR=(ag={},Object(V.a)(ag,Y.FLOAT,4),Object(V.a)(ag,Y.UNSIGNED_BYTE,1),Object(V.a)(ag,Y.UNSIGNED_SHORT,2),ag),sR=(Ex=Object(Qr.injectable)(),Sx=Object(Qr.inject)(Yt.IRendererService),Ex(Ax=(O_=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"attributesAndIndices",void 0),ma(this,"rendererService",Tx,this),Object(V.a)(this,"attributes",[]),Object(V.a)(this,"triangulation",void 0),Object(V.a)(this,"featureLayout",{sizePerElement:0,elements:[]})}return Object(De.a)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new nR(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,o=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||o&&t[o])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute(Object(ae.a)(Object(ae.a)({},n),{},{name:t})));var o=n.scale;o&&a&&(a.scale=o,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Fe){return Fe.name===t});if(l&&l.descriptor){var c=l.descriptor,p=c.update,_=c.buffer,x=c.size,A=x===void 0?0:x,w=oR[_.type||Y.FLOAT];if(p){var I=this.featureLayout,P=I.elements,H=I.sizePerElement,W=P.slice(i,a);if(!W.length)return;var oe=W[0].offset,ce=oe*A*w,Oe=W.map(function(Fe,je){for(var tt=Fe.featureIdx,vt=Fe.vertices,kt=Fe.normals,ir=vt.length/H,ur=[],Zr=0;Zr<ir;Zr++){var ln=kt?kt.slice(Zr*3,Zr*3+3):[];ur.push.apply(ur,Object(cr.a)(p(n[tt],tt,vt.slice(Zr*H,Zr*H+H),je,ln)))}return ur}).reduce(function(Fe,je){return Fe.push.apply(Fe,Object(cr.a)(je)),Fe},[]);l.vertexAttribute.updateBuffer({data:Oe,offset:ce}),o==null||o.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(W){return W.resetDescriptor(),W.descriptor}),l=0,c=0,p=[],_=3;t.forEach(function(W,oe){var ce=a.triangulation(W,i),Oe=ce.indices,Fe=ce.vertices,je=ce.normals,tt=ce.size,vt=ce.indexes,kt=ce.count;typeof kt=="number"&&(c+=kt),Oe.forEach(function(ln){p.push(ln+l)}),_=tt;var ir=Fe.length/tt;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:oe,vertices:Fe,normals:je,offset:l}),l+=ir;for(var ur=function(_n){var Hi=(je==null?void 0:je.slice(_n*3,_n*3+3))||[],io=Fe.slice(_n*tt,_n*tt+tt),Ga=0;vt&&vt[_n]!==void 0&&(Ga=vt[_n]),o.forEach(function(To,Co){if(To&&To.update){var nl;(nl=To.buffer.data).push.apply(nl,Object(cr.a)(To.update(W,oe,io,_n,Hi,Ga)))}})},Zr=0;Zr<ir;Zr++)ur(Zr)});var x=this.rendererService,A=x.createAttribute,w=x.createBuffer,I=x.createElements,P={};o.forEach(function(W,oe){if(W){var ce=W.buffer,Oe=W.update,Fe=W.name,je=Object(vh.a)(W,iR),tt=A(Object(ae.a)({buffer:w(ce)},je));P[W.name||""]=tt,a.attributes[oe].vertexAttribute=tt}});var H=I({data:p,type:Y.UNSIGNED_INT,count:p.length});return this.attributesAndIndices={attributes:P,elements:H,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(w){return w.resetDescriptor(),w.descriptor}),o=0,l=[],c=3;t.forEach(function(w,I){var P=i.triangulation(w),H=P.indices,W=P.vertices,oe=P.normals,ce=P.size,Oe=P.indexes;H.forEach(function(vt){l.push(vt+o)}),c=ce;var Fe=W.length/ce;i.featureLayout.sizePerElement=c,i.featureLayout.elements.push({featureIdx:I,vertices:W,normals:oe,offset:o}),o+=Fe;for(var je=function(kt){var ir=(oe==null?void 0:oe.slice(kt*3,kt*3+3))||[],ur=W.slice(kt*ce,kt*ce+ce),Zr=0;Oe&&Oe[kt]!==void 0&&(Zr=Oe[kt]),a.forEach(function(ln,_n){if(ln&&ln.update){var Hi;(Hi=ln.buffer.data).push.apply(Hi,Object(cr.a)(ln.update(w,I,ur,kt,ir,Zr)))}})},tt=0;tt<Fe;tt++)je(tt)});var p=this.rendererService,_=p.createAttribute,x=p.createBuffer,A={};return a.forEach(function(w,I){if(w){var P=w.buffer,H=w.update,W=w.name,oe=Object(vh.a)(w,aR),ce=_(Object(ae.a)({buffer:x(P)},oe));A[w.name||""]=ce,i.attributes[I].vertexAttribute=ce}}),{attributes:A}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),Tx=da(O_.prototype,"rendererService",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_))||Ax),Cl=C("xp6e"),Cx=C("iegG"),uR=C.n(Cx),Ox,Rx,Mx,Px,Ix,Dx,kx,Fx,Bx,Lx,Nx,jx,zx,Ux,Vx,Hx,Wx,Gx,yu,Xx,Zx,$x,Yx,Kx,qx,Qx,Jx,eE,tE,rE,nE,iE,aE,oE,sE;function lR(e){var r=cR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function cR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fR=(Ox=Object(Qr.injectable)(),Rx=Object(Qr.inject)(Yt.SceneID),Mx=Object(Qr.inject)(Yt.IIconService),Px=Object(Qr.inject)(Yt.IFontService),Ix=Object(Qr.inject)(Yt.IControlService),Dx=Object(Qr.inject)(Yt.IGlobalConfigService),kx=Object(Qr.inject)(Yt.IMapService),Fx=Object(Qr.inject)(Yt.ICoordinateSystemService),Bx=Object(Qr.inject)(Yt.IRendererService),Lx=Object(Qr.inject)(Yt.ILayerService),Nx=Object(Qr.inject)(Yt.IDebugService),jx=Object(Qr.inject)(Yt.ICameraService),zx=Object(Qr.inject)(Yt.IInteractionService),Ux=Object(Qr.inject)(Yt.IPickingService),Vx=Object(Qr.inject)(Yt.IShaderModuleService),Hx=Object(Qr.inject)(Yt.IMarkerService),Wx=Object(Qr.inject)(Yt.IPopupService),Ox(Gx=(yu=function(e){Object(Lt.a)(t,e);var r=lR(t);function t(){var n;return Object(et.a)(this,t),n=r.call(this),Object(V.a)(Object(Be.a)(n),"destroyed",!1),Object(V.a)(Object(Be.a)(n),"loaded",!1),ma(Object(Be.a)(n),"id",Xx,Object(Be.a)(n)),ma(Object(Be.a)(n),"iconService",Zx,Object(Be.a)(n)),ma(Object(Be.a)(n),"fontService",$x,Object(Be.a)(n)),ma(Object(Be.a)(n),"controlService",Yx,Object(Be.a)(n)),ma(Object(Be.a)(n),"configService",Kx,Object(Be.a)(n)),ma(Object(Be.a)(n),"map",qx,Object(Be.a)(n)),ma(Object(Be.a)(n),"coordinateSystemService",Qx,Object(Be.a)(n)),ma(Object(Be.a)(n),"rendererService",Jx,Object(Be.a)(n)),ma(Object(Be.a)(n),"layerService",eE,Object(Be.a)(n)),ma(Object(Be.a)(n),"debugService",tE,Object(Be.a)(n)),ma(Object(Be.a)(n),"cameraService",rE,Object(Be.a)(n)),ma(Object(Be.a)(n),"interactionService",nE,Object(Be.a)(n)),ma(Object(Be.a)(n),"pickingService",iE,Object(Be.a)(n)),ma(Object(Be.a)(n),"shaderModuleService",aE,Object(Be.a)(n)),ma(Object(Be.a)(n),"markerService",oE,Object(Be.a)(n)),ma(Object(Be.a)(n),"popupService",sE,Object(Be.a)(n)),Object(V.a)(Object(Be.a)(n),"inited",!1),Object(V.a)(Object(Be.a)(n),"initPromise",void 0),Object(V.a)(Object(Be.a)(n),"rendering",!1),Object(V.a)(Object(Be.a)(n),"$container",void 0),Object(V.a)(Object(Be.a)(n),"canvas",void 0),Object(V.a)(Object(Be.a)(n),"markerContainer",void 0),Object(V.a)(Object(Be.a)(n),"hooks",void 0),Object(V.a)(Object(Be.a)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),D.triggerResize(),n.coordinateSystemService.needRefresh=!0,n.render())}),Object(V.a)(Object(Be.a)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new Cl.b},n}return Object(De.a)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Object(Zt.a)(be.a.mark(function o(){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),c.next=3,new Promise(function(p){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),p()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(Tl.Drag,a.addSceneEvent.bind(a));case 10:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Object(Zt.a)(be.a.mark(function o(){var l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,c?a.$container=c:a.$container=$3(a.configService.getSceneConfig(a.id).id||""),!a.$container){x.next=13;break}return a.canvas=D.create("canvas","",a.$container),a.setCanvas(),x.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),uR()(a.$container,a.handleWindowResized),window.matchMedia&&((p=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||p===void 0||p.addListener(a.handleWindowResized)),x.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return x.stop()}},o)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Object(Zt.a)(be.a.mark(function o(){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(p){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),a.map.version!=="GAODE2.x"&&p()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(Tl.Drag,a.addSceneEvent.bind(a));case 5:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Object(Zt.a)(be.a.mark(function o(){var l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){p.next=7;break}return p.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:p.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return p.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],x.next=3,this.render();case 3:return p=o==="jpg"?c==null?void 0:c.toDataURL("image/jpeg"):c==null?void 0:c.toDataURL("image/png"),x.abrupt("return",p);case 5:case"end":return x.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=D.create("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if(Object(Cx.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var o;(o=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||o===void 0||o.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,o=D.DPR,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p&&(p.width=l*o,p.height=c*o),this.rendererService.viewport({x:0,y:0,width:o*l,height:o*c})}},{key:"setCanvas",value:function(){var i,a,o=D.DPR,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,p=this.canvas;p.width=l*o,p.height=c*o,p.style.width="100%",p.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Po.EventEmitter),Xx=da(yu.prototype,"id",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zx=da(yu.prototype,"iconService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$x=da(yu.prototype,"fontService",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yx=da(yu.prototype,"controlService",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kx=da(yu.prototype,"configService",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qx=da(yu.prototype,"map",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qx=da(yu.prototype,"coordinateSystemService",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jx=da(yu.prototype,"rendererService",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=da(yu.prototype,"layerService",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tE=da(yu.prototype,"debugService",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rE=da(yu.prototype,"cameraService",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nE=da(yu.prototype,"interactionService",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iE=da(yu.prototype,"pickingService",[Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE=da(yu.prototype,"shaderModuleService",[Vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=da(yu.prototype,"markerService",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sE=da(yu.prototype,"popupService",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yu))||Gx);function hR(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var uE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function lE(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(uE,function(n,i,a){var o=a.split(":"),l=o[0].trim(),c="";switch(o.length>1&&(c=o[1].trim()),i){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(p,_){return p.push(Number(_.trim())),p},[]):c=new Array(hR(i)).fill(0);break;default:}return t[l]=c,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function R_(e){var r=lE(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,o){o=o.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=lE(o),c=l.content,p=l.uniforms;return Object.assign(n,p),"".concat(a,`{
`).concat(c,`
};`)}),{content:t,uniforms:n}}function cE(e){var r={};return e.replace(uE,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var fE,hE,pR=fi.uniq,pE="#define PI 3.14159265359",dR=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,dE=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  mat4 u_Mvp;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  vec2 u_sceneCenterMercator;
  float u_FocalDistance;
};`,vE=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,vR=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,mR=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,gR=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,yR=`layout(location = 2) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,_R=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,mE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,bR=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,xR=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,gE=/precision\s+(high|low|medium)p\s+float/,yE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,ER=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,SR=/void\s+main\s*\([^)]*\)\s*\{\n?/,aH=/}\n?[^{}]*$/,AR=(fE=Object(Qr.injectable)(),fE(hE=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"moduleCache",{}),Object(V.a)(this,"rawContentCache",{})}return Object(De.a)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:pE,fs:pE}),this.registerModule("decode",{vs:dR,fs:""}),this.registerModule("scene_uniforms",{vs:dE,fs:dE}),this.registerModule("picking_uniforms",{vs:vE,fs:vE}),this.registerModule("projection",{vs:mE,fs:mE}),this.registerModule("project",{vs:_R,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:xR}),this.registerModule("lighting",{vs:mR,fs:""}),this.registerModule("light",{vs:vR,fs:""}),this.registerModule("picking",{vs:yR,fs:gR}),this.registerModule("rotation_2d",{vs:bR,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,o=n.uniforms,l=n.inject,c=R_(i),p=c.content,_=c.uniforms,x=R_(a),A=x.content,w=x.uniforms;this.rawContentCache[t]={fs:A,inject:l,uniforms:Object(ae.a)(Object(ae.a)(Object(ae.a)({},_),w),o),vs:p}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,o=this.rawContentCache[t].inject,l={};o!=null&&o["vs:#decl"]&&(i=(o==null?void 0:o["vs:#decl"])+i,l=R_(o==null?void 0:o["vs:#decl"]).uniforms),o!=null&&o["vs:#main-start"]&&(i=i.replace(SR,function(W){return W+(o==null?void 0:o["vs:#main-start"])})),o!=null&&o["fs:#decl"]&&(a=(o==null?void 0:o["fs:#decl"])+a);var c=this.processModule(i,[],"vs"),p=c.content,_=c.includeList,x=this.processModule(a,[],"fs"),A=x.content,w=x.includeList,I="",P=pR(_.concat(w).concat(t)).reduce(function(W,oe){return Object(ae.a)(Object(ae.a)({},W),n.rawContentCache[oe].uniforms)},Object(ae.a)({},l));gE.test(A)||(I=I+yE),I=I+A;var H="";return gE.test(p)||(H=H+yE),H=H+p,this.moduleCache[t]={fs:I.trim(),uniforms:P,vs:H.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,o=t.replace(ER,function(l,c){var p=c.split(" "),_=p[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var x=a.rawContentCache[_][i];n.push(_);var A=a.processModule(x,n,i),w=A.content;return w});return{content:o,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||hE),_a=C("ReuC"),Uv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),_E,bE,Cy=(_E=Object(Qr.injectable)(),_E(bE=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"shaderModuleService",void 0),Object(V.a)(this,"rendererService",void 0),Object(V.a)(this,"cameraService",void 0),Object(V.a)(this,"mapService",void 0),Object(V.a)(this,"interactionService",void 0),Object(V.a)(this,"layerService",void 0),Object(V.a)(this,"config",void 0)}return Object(De.a)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Uv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Yt.IRendererService),this.cameraService=t.getContainer().get(Yt.ICameraService),this.mapService=t.getContainer().get(Yt.IMapService),this.interactionService=t.getContainer().get(Yt.IInteractionService),this.layerService=t.getContainer().get(Yt.ILayerService),this.shaderModuleService=t.getContainer().get(Yt.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||bE),xE,EE;function TR(e){var r=CR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function CR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wR=(xE=Object(Qr.injectable)(),xE(EE=function(e){Object(Lt.a)(t,e);var r=TR(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Object(_a.a)(Object(Te.a)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Cy))||EE),SE,AE,TE,M_,CE;function OR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=RR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function RR(e,r){if(!!e){if(typeof e=="string")return wE(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return wE(e,r)}}function wE(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var MR=(SE=Object(Qr.injectable)(),AE=Object(Qr.inject)(Yt.IPostProcessor),SE(TE=(M_=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"passes",[]),ma(this,"postProcessor",CE,this),Object(V.a)(this,"layer",void 0),Object(V.a)(this,"renderFlag",void 0),Object(V.a)(this,"width",0),Object(V.a)(this,"height",0)}return Object(De.a)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){var i,a,o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=OR(this.passes),c.prev=1,i.s();case 3:if((a=i.n()).done){c.next=9;break}return o=a.value,c.next=7,o.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Uv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),CE=da(M_.prototype,"postProcessor",[AE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_))||TE),OE,RE;function PR(e){var r=IR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function IR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DR=(OE=Object(Qr.injectable)(),OE(RE=function(e){Object(Lt.a)(t,e);var r=PR(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"pickingFBO",void 0),Object(V.a)(Object(Be.a)(n),"layer",void 0),Object(V.a)(Object(Be.a)(n),"width",0),Object(V.a)(Object(Be.a)(n),"height",0),Object(V.a)(Object(Be.a)(n),"alreadyInRendering",!1),Object(V.a)(Object(Be.a)(n),"pickFromPickingFBO",function(l){var c=l.x,p=l.y,_=l.lngLat,x=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(x))){var A=n.rendererService,w=A.getViewportSize,I=A.readPixels,P=A.useFramebuffer,H=w(),W=H.width,oe=H.height,ce=n.layer.getLayerConfig(),Oe=ce.enableHighlight,Fe=ce.enableSelect,je=c*D.DPR,tt=p*D.DPR;if(!(je>W||je<0||tt>oe||tt<0)){var vt;P(n.pickingFBO,function(){var kt;if(vt=I({x:Math.round(je),y:Math.round(oe-(p+1)*D.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),vt[0]!==0||vt[1]!==0||vt[2]!==0){var ir=zu(vt),ur=n.layer.getSource().getFeatureById(ir),Zr={x:c,y:p,type:x,lngLat:_,featureId:ir,feature:ur};ur&&(n.layer.setCurrentPickId(ir),n.triggerHoverOnLayer(Zr))}else{var ln={x:c,y:p,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+x:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Object(ae.a)(Object(ae.a)({},ln),{},{type:"unpick"})),n.triggerHoverOnLayer(ln),n.layer.setCurrentPickId(null)}Oe&&n.highlightPickedFeature(vt),Fe&&x==="click"&&((kt=vt)===null||kt===void 0?void 0:kt.toString())!==[0,0,0,0].toString()&&n.selectFeature(vt)})}}}),n}return Object(De.a)(t,[{key:"getType",value:function(){return Uv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Object(_a.a)(Object(Te.a)(t.prototype),"init",this).call(this,i,a),this.layer=i;var o=this.rendererService,l=o.createTexture2D,c=o.createFramebuffer,p=o.getViewportSize,_=p(),x=_.width,A=_.height;this.pickingFBO=c({color:l({width:x,height:A,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.interactionService.on(Tl.Hover,this.pickFromPickingFBO),this.interactionService.on(Tl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Tl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var o=this.rendererService,l=o.getViewportSize,c=o.useFramebuffer,p=o.clear,_=l(),x=_.width,A=_.height;this.alreadyInRendering=!0,(this.width!==x||this.height!==A)&&(this.pickingFBO.resize({width:x,height:A}),this.width=x,this.height=A),c(this.pickingFBO,function(){p({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var w=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(w),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=Object(hn.a)(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeHighlight.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=Object(hn.a)(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeSelect.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,o=Uu(a);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,o=Uu(a);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(Cy))||RE),ME,PE,IE,P_,DE,kR=fi.camelCase,FR=fi.isNil,BR=fi.upperFirst,LR=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qh=(ME=Object(Qr.injectable)(),PE=Object(Qr.inject)(Yt.IShaderModuleService),ME(IE=(P_=function(){function e(){Object(et.a)(this,e),ma(this,"shaderModuleService",DE,this),Object(V.a)(this,"rendererService",void 0),Object(V.a)(this,"config",void 0),Object(V.a)(this,"quad",LR),Object(V.a)(this,"enabled",!0),Object(V.a)(this,"renderToScreen",!1),Object(V.a)(this,"model",void 0),Object(V.a)(this,"name",void 0),Object(V.a)(this,"optionsToUpdate",{})}return Object(De.a)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Uv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Yt.IRendererService),this.shaderModuleService=t.getContainer().get(Yt.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,o=i.createBuffer,l=i.createModel,c=this.setupShaders(),p=c.vs,_=c.fs,x=c.uniforms;this.model=l({vs:p,fs:_,attributes:{a_Position:a({buffer:o({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:Object(ae.a)(Object(ae.a)({u_Texture:null},x),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,l=o.useFramebuffer,c=o.getViewportSize,p=o.clear,_=c(),x=_.width,A=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){p({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var w=Object(ae.a)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[x,A]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(w.u_BloomFinal=1,w.u_Texture2=n),i.model.draw({uniforms:w})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=Object(ae.a)(Object(ae.a)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){FR(t[i])||(n["u_".concat(BR(kR(i)))]=t[i])}),n}}]),e}(),DE=da(P_.prototype,"shaderModuleService",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_))||IE),kE,FE;function NR(e){var r=jR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function jR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zR=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,UR=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,I_=fi.isNil,VR=(kE=Object(Qr.injectable)(),kE(FE=function(e){Object(Lt.a)(t,e);var r=NR(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:UR,fs:zR});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return I_(i.bloomRadius)||(a.u_radius=i.bloomRadius),I_(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),I_(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Qh))||FE),BE,LE;function HR(e){var r=WR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function WR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GR=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,XR=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ZR=fi.isNil,$R=(BE=Object(Qr.injectable)(),BE(LE=function(e){Object(Lt.a)(t,e);var r=HR(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:XR,fs:GR});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return ZR(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Qh))||LE),NE,jE;function YR(e){var r=KR();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function KR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qR=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,QR=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,JR=fi.isNil,eM=(NE=Object(Qr.injectable)(),NE(jE=function(e){Object(Lt.a)(t,e);var r=YR(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:QR,fs:qR});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return JR(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Qh))||jE),zE,UE;function tM(e){var r=rM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function rM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nM=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,iM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,aM=(zE=Object(Qr.injectable)(),zE(UE=function(e){Object(Lt.a)(t,e);var r=tM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:iM,fs:nM});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Qh))||UE),VE,HE;function oM(e){var r=sM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function sM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uM=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,lM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cM=(VE=Object(Qr.injectable)(),VE(HE=function(e){Object(Lt.a)(t,e);var r=oM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:lM,fs:uM}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Qh))||HE),WE,GE;function fM(e){var r=hM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function hM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pM=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,dM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,vM=(WE=Object(Qr.injectable)(),WE(GE=function(e){Object(Lt.a)(t,e);var r=fM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:dM,fs:pM});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Qh))||GE),XE,ZE;function mM(e){var r=gM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yM=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,_M=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bM=(XE=Object(Qr.injectable)(),XE(ZE=function(e){Object(Lt.a)(t,e);var r=mM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:_M,fs:yM});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),p=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(ae.a)(Object(ae.a)({},l),{},{u_ViewportSize:[p,_]})}}}]),t}(Qh))||ZE),$E,YE;function xM(e){var r=EM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function EM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SM=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,AM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,TM=($E=Object(Qr.injectable)(),$E(YE=function(e){Object(Lt.a)(t,e);var r=xM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:AM,fs:SM}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Qh))||YE),KE,qE;function CM(e){var r=wM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function wM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,RM=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,MM=(KE=Object(Qr.injectable)(),KE(qE=function(e){Object(Lt.a)(t,e);var r=CM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:OM,fs:RM}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Qh))||qE),QE,JE,e2,t2,Vv,r2,PM=(QE=Object(Qr.injectable)(),JE=Object(Qr.inject)(Yt.IRendererService),e2=Object(Qr.postConstruct)(),QE(t2=(Vv=function(){function e(){Object(et.a)(this,e),ma(this,"rendererService",r2,this),Object(V.a)(this,"passes",[]),Object(V.a)(this,"readFBO",void 0),Object(V.a)(this,"writeFBO",void 0)}return Object(De.a)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),o=a.width,l=a.height;return i({x:0,y:0,width:o,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a){var o,l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.getReadFBOTex();case 2:o=p.sent,l=0;case 4:if(!(l<4)){p.next=11;break}return p.next=7,a.render(i,o);case 7:this.swap(),l++,p.next=4;break;case 11:case"end":return p.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){var a,o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<this.passes.length)){c.next=15;break}if(o=this.passes[a],o.setRenderToScreen(this.isLastEnabledPass(a)),o.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,o);case 7:c.next=12;break;case 9:return c.next=11,o.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),r2=da(Vv.prototype,"rendererService",[JE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),da(Vv.prototype,"init",[e2],Object.getOwnPropertyDescriptor(Vv.prototype,"init"),Vv.prototype),Vv))||t2),n2,i2;function IM(e){var r=DM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function DM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kM=(n2=Object(Qr.injectable)(),n2(i2=function(e){Object(Lt.a)(t,e);var r=IM(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getType",value:function(){return Uv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Object(_a.a)(Object(Te.a)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,o=a.useFramebuffer,l=a.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();o(c,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(p){p.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Cy))||i2),a2,o2,s2,D_,u2;function FM(e){var r=BM();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function BM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LM=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,l2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,NM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function c2(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var jM=1,zM=(a2=Object(Qr.injectable)(),o2=Object(Qr.inject)(Yt.IShaderModuleService),a2(s2=(D_=function(e){Object(Lt.a)(t,e);var r=FM(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ma(Object(Be.a)(n),"shaderModuleService",u2,Object(Be.a)(n)),Object(V.a)(Object(Be.a)(n),"haltonSequence",[]),Object(V.a)(Object(Be.a)(n),"accumulatingId",0),Object(V.a)(Object(Be.a)(n),"frame",0),Object(V.a)(Object(Be.a)(n),"timer",void 0),Object(V.a)(Object(Be.a)(n),"sampleRenderTarget",void 0),Object(V.a)(Object(Be.a)(n),"prevRenderTarget",void 0),Object(V.a)(Object(Be.a)(n),"outputRenderTarget",void 0),Object(V.a)(Object(Be.a)(n),"copyRenderTarget",void 0),Object(V.a)(Object(Be.a)(n),"blendModel",void 0),Object(V.a)(Object(Be.a)(n),"outputModel",void 0),Object(V.a)(Object(Be.a)(n),"copyModel",void 0),n}return Object(De.a)(t,[{key:"getType",value:function(){return Uv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Object(_a.a)(Object(Te.a)(t.prototype),"init",this).call(this,i,a);var o=this.rendererService,l=o.createFramebuffer,c=o.createTexture2D;this.sampleRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:c({width:1,height:1,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE})});for(var p=0;p<30;p++)this.haltonSequence.push([c2(p,2),c2(p,3)]);this.blendModel=this.createTriangleModel("blend-pass",LM),this.outputModel=this.createTriangleModel("copy-pass",l2,{blend:{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:Y.ONE,dstAlpha:Y.ONE_MINUS_SRC_ALPHA},equation:{rgb:Y.FUNC_ADD,alpha:Y.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",l2)}},{key:"render",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,p=o.useFramebuffer,_=c(),x=_.width,A=_.height;this.sampleRenderTarget.resize({width:x,height:A}),this.prevRenderTarget.resize({width:x,height:A}),this.outputRenderTarget.resize({width:x,height:A}),this.copyRenderTarget.resize({width:x,height:A}),this.resetFrame(),this.stopAccumulating();var w=i.multiPassRenderer.getPostProcessor().getReadFBO();p(w,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:w}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function P(H){!a.accumulatingId||H!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){P(H)}))};this.accumulatingId=jM++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,p=o.useFramebuffer,_=c(),x=_.width,A=_.height,w=i.getLayerConfig(),I=w.jitterScale,P=I===void 0?1:I,H=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((H[0]*2-1)/x*P,(H[1]*2-1)/A*P),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),p(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var W=i.getLayerConfig();p(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:W.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(p(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),p(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var oe=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=oe,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,o){this.shaderModuleService.registerModule(i,{vs:NM,fs:a});var l=this.shaderModuleService.getModule(i),c=l.vs,p=l.fs,_=l.uniforms,x=this.rendererService,A=x.createAttribute,w=x.createBuffer,I=x.createModel;return I(Object(ae.a)({vs:c,fs:p,attributes:{a_Position:A({buffer:w({data:[-4,-4,4,-4,0,4],type:Y.FLOAT}),size:2})},uniforms:Object(ae.a)({},_),depth:{enable:!1},count:3},o))}}]),t}(Cy),u2=da(D_.prototype,"shaderModuleService",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_))||s2),og=new Qr.Container;og.bind(Yt.IGlobalConfigService).to(F3).inSingletonScope(),Object(Qr.decorate)(Object(Qr.injectable)(),Po.EventEmitter),og.bind(Yt.IEventEmitter).to(Po.EventEmitter);var f2=x_()(og,!1),k_=function(r){var t=f2.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},oH=function(r){var t=f2.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Kl=og,UM=0;function VM(){var e=new Qr.Container;return e.parent=og,e.bind(Yt.SceneID).toConstantValue("".concat(UM++)),e.bind(Yt.IShaderModuleService).to(AR).inSingletonScope(),e.bind(Yt.ILayerService).to(tR).inSingletonScope(),e.bind(Yt.IDebugService).to(U3).inSingletonScope(),e.bind(Yt.ISceneService).to(fR).inSingletonScope(),e.bind(Yt.ICameraService).to(S3).inSingletonScope(),e.bind(Yt.ICoordinateSystemService).to(N3).inSingletonScope(),e.bind(Yt.IInteractionService).to(X3).inSingletonScope(),e.bind(Yt.IPickingService).to(K3).inSingletonScope(),e.bind(Yt.IControlService).to(w3).inSingletonScope(),e.bind(Yt.IMarkerService).to(O3).inSingletonScope(),e.bind(Yt.IIconService).to(E3).inSingletonScope(),e.bind(Yt.IFontService).to(y3).inSingletonScope(),e.bind(Yt.IPopupService).to(R3).inSingletonScope(),e.bind(Yt.INormalPass).to(wR).whenTargetNamed("clear"),e.bind(Yt.INormalPass).to(DR).whenTargetNamed("pixelPicking"),e.bind(Yt.INormalPass).to(kM).whenTargetNamed("render"),e.bind(Yt.INormalPass).to(zM).whenTargetNamed("taa"),e.bind(Yt.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Yt.INormalPass,t)}}),e.bind(Yt.IPostProcessingPass).to(cM).whenTargetNamed("copy"),e.bind(Yt.IPostProcessingPass).to(VR).whenTargetNamed("bloom"),e.bind(Yt.IPostProcessingPass).to($R).whenTargetNamed("blurH"),e.bind(Yt.IPostProcessingPass).to(eM).whenTargetNamed("blurV"),e.bind(Yt.IPostProcessingPass).to(TM).whenTargetNamed("noise"),e.bind(Yt.IPostProcessingPass).to(MM).whenTargetNamed("sepia"),e.bind(Yt.IPostProcessingPass).to(aM).whenTargetNamed("colorHalftone"),e.bind(Yt.IPostProcessingPass).to(vM).whenTargetNamed("hexagonalPixelate"),e.bind(Yt.IPostProcessingPass).to(bM).whenTargetNamed("ink"),e.bind(Yt.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Yt.IPostProcessingPass,t);return n.setName(t),n}}),e}function sg(e){var r=new Qr.Container;return r.parent=e,r.bind(Yt.IStyleAttributeService).to(sR).inSingletonScope(),r.bind(Yt.IMultiPassRenderer).to(MR).inSingletonScope(),r.bind(Yt.IPostProcessor).to(PM).inSingletonScope(),r}var HM=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function WM(e){return HM.indexOf(e)}var h2=fi.clamp,GM=2,sH=4,XM=64,uH=128,ZM=256,$M=512,lH=8192,cH=16384,fH=32768,YM=32768*2,p2=131072,hH=262144,KM=524288,pH=1048576,qM=2097152,dH=4194304,QM=8388608,JM=16777216,eP=16777216*2;function wy(e,r){return e=h2(Math.floor(e),0,255),r=h2(Math.floor(r),0,255),256*e+r}function vH(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,o=e.opacity,l=e.stroke,c=e.strokeWidth,p=e.strokeOpacity,_=[],x=[],A=[],w=[wy(r[0],r[1]),wy(r[2],r[3])],I=[wy(l[0],l[1]),wy(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(P){var H=Object(hn.a)(P,2),W=H[0],oe=H[1];_.push([].concat(w,[(W+1)*QM+(oe+1)*qM+WM(a)*p2+t,(n+512)*KM+(i+512)*XM])),x.push([].concat(I,[c,p])),A.push([o,0,0,0])}),{packedBuffer:_,packedBuffer2:x,packedBuffer3:A}}function mH(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*eP+t*JM+n*p2+t*YM+n*$M+t*ZM+n*GM+t}var Vd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Vs={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},vo=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),Hv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),wn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),Wv=["mapload","mapchange","mapAfterFrameChange"],Oy=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Ru=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),tP=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c,p){n({x:t.x,y:t.y,z:t.z},function(_,x){if(_||x.length===0){p(_);return}x&&Up([{data:x,bands:[0]}],i,a,function(A,w){A?p(A):w&&c(w)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),rP=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n){return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(o,l){n({x:t.x,y:t.y,z:t.z},function(c,p){if(c||!p){l(c);return}p instanceof ArrayBuffer?al(p,function(_,x){_&&l(_),o(x)}):p instanceof HTMLImageElement?o(p):l(c)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function nP(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return _i(t,r)}):e.map(function(t){return{url:_i(t.url,r),bands:t.bands||[0]}}):_i(e,r)}function iP(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function d2(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var aP=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a,o){var l,c,p,_,x,A;return be.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=iP(n.url),!(l.length>1)){I.next=15;break}return I.next=4,oP(l,n);case 4:if(c=I.sent,p=c.rasterFiles,_=c.xhrList,x=c.errList,d2(t,_),!(x.length>0)){I.next=12;break}return i(x,null),I.abrupt("return");case 12:Up(p,a,o,i),I.next=17;break;case 15:A=di(n,function(P,H){if(P)i(P);else if(H){var W=[{data:H,bands:l[0].bands}];Up(W,a,o,i)}}),d2(t,[A]);case 17:case"end":return I.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}();function oP(e,r){return F_.apply(this,arguments)}function F_(){return F_=Object(Zt.a)(be.a.mark(function e(r,t){var n,i,a,o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=[],i=[],a=[],o=0;case 4:if(!(o<r.length)){P.next=20;break}return l=r[o],c=Object(ae.a)(Object(ae.a)({},t),{},{url:l.url}),p=l.bands,P.next=10,ja(Object(ae.a)(Object(ae.a)({},c),{},{type:"arrayBuffer"}));case 10:_=P.sent,x=_.err,A=_.data,w=_.xhr,x&&a.push(x),i.push(w),n.push({data:A,bands:p});case 17:o++,P.next=4;break;case 20:return P.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return P.stop()}},e)})),F_.apply(this,arguments)}var sP=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a,o){var l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return l={url:nP(t,n)},p.abrupt("return",new Promise(function(_,x){aP(i,l,function(A,w){A?x(A):w&&_(w)},a,o)}));case 2:case"end":return p.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}(),v2=function(){var e=Object(Zt.a)(be.a.mark(function r(t,n,i,a){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(c=(a==null?void 0:a.getURLFromTemplate)||Yi,o=c(l,Object(ae.a)(Object(ae.a)({},n),a.wmtsOptions))):(p=(a==null?void 0:a.getURLFromTemplate)||_i,o=p(l,n)),x.abrupt("return",new Promise(function(A,w){var I,P=Ea({url:o,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(H,W){H?w(H):W&&A(W)},a.transformResponse);i.xhrCancel=function(){return P.cancel()}}));case 3:case"end":return x.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),m2=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},uP={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},gH=[Ru.ARRAYBUFFER,Ru.RGB];function lP(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function cP(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(lP(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Ru.IMAGE;t===Ru.RGB&&(t=Ru.ARRAYBUFFER);var n=function(o,l){switch(t){case Ru.IMAGE:return v2(e,o,l,r);case Ru.CUSTOMIMAGE:case Ru.CUSTOMTERRAINRGB:return rP(l,r==null?void 0:r.getCustomData);case Ru.ARRAYBUFFER:return sP(e,o,l,(r==null?void 0:r.format)||m2,r==null?void 0:r.operation);case Ru.CUSTOMARRAYBUFFER:case Ru.CUSTOMRGB:return tP(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||m2,r==null?void 0:r.operation);default:return v2(e,o,l,r)}},i=Object(ae.a)(Object(ae.a)(Object(ae.a)({},uP),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var fP=["extent","min","max","width","height","format","operation"];function hP(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,o=r.height,l=r.format,c=r.operation,p=Object(vh.a)(r,fP),_;if(l===void 0||Od(e))_=Array.from(e);else{var x=Array.isArray(e)?e:[e];_=Fd(x,l,c)}var A={_id:1,dataArray:[Object(ae.a)(Object(ae.a)({_id:1,data:_,width:a,height:o},p),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return A}var pP={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},dP=function(){var e=Object(Zt.a)(be.a.mark(function r(t){return be.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var o=Object(hn.a)(t.bounds,4),l=o[0],c=o[1],p=o[2],_=o[3],x={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+p)/2,y:(c+_)/2},geometry:{type:"LineString",coordinates:[[p,_],[p,c],[l,c],[l,c]]}}]}}};a(x)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function vP(e,r){var t=function(a){return dP(a)},n=Object(ae.a)(Object(ae.a)(Object(ae.a)({},pP),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var mP=C("mpbz"),g2=C.n(mP);function y2(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,o=r.minZoom,l=o===void 0?0:o,c=r.zoom,p=c===void 0?2:c;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(p));return e.dataArray=gP(_),e}var x=new g2.a({radius:n,minZoom:l,maxZoom:a}),A={type:"FeatureCollection",features:[]};return A.features=e.dataArray.map(function(w){return{type:"Feature",geometry:{type:"Point",coordinates:w.coordinates},properties:Object(ae.a)({},w)}}),x.load(A.features),x}function gP(e){return e.map(function(r,t){return Object(ae.a)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function yP(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function _P(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function _2(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function bP(e){if(e.length===0)throw new Error("mean requires at least one data point");return _2(e)/e.length}var xP={min:_P,max:yP,mean:bP,sum:_2};function EP(e){var r=SP();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function SP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AP=fi.cloneDeep,b2=fi.isFunction,TP=fi.isString,CP=fi.mergeWith;function wP(e,r){if(Array.isArray(r))return r}var OP=function(e){Object(Lt.a)(t,e);var r=EP(t);function t(n,i){var a;return Object(et.a)(this,t),a=r.call(this),Object(V.a)(Object(Be.a)(a),"type","source"),Object(V.a)(Object(Be.a)(a),"isTile",!1),Object(V.a)(Object(Be.a)(a),"inited",!1),Object(V.a)(Object(Be.a)(a),"hooks",{init:new Cl.e}),Object(V.a)(Object(Be.a)(a),"parser",{type:"geojson"}),Object(V.a)(Object(Be.a)(a),"transforms",[]),Object(V.a)(Object(Be.a)(a),"cluster",!1),Object(V.a)(Object(Be.a)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),Object(V.a)(Object(Be.a)(a),"invalidExtent",!1),Object(V.a)(Object(Be.a)(a),"dataArrayChanged",!1),Object(V.a)(Object(Be.a)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return Object(De.a)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,o=this.clusterOptions,l=o.method,c=l===void 0?"sum":l,p=o.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(x){x.id||(x.properties.point_count=1)}),(p||b2(c))&&(_=_.map(function(x){var A=x.id;if(A){var w=a.clusterIndex.getLeaves(A,Infinity),I=w.map(function(W){return W.properties}),P;if(TP(c)&&p){var H=Op(I,p);P=xP[c](H)}b2(c)&&(P=c(I)),x.properties.stat=P}else x.properties.point_count=1;return x})),this.data=nt("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,o=a.type,l=o===void 0?"geojson":o,c=a.geometry;if(l==="geojson"&&!this.cluster){var p=i<this.originData.features.length?this.originData.features[i]:"null",_=AP(p);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var x=this.data.dataArray.find(function(A){return A._id===i});_.properties=x}return _}else return l==="json"&&c?this.data.dataArray.find(function(A){return A._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===i?Object(ae.a)(Object(ae.a)({},o),a):o}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var o=this.data.dataArray.find(function(l){return l[i]===a});return o==null?void 0:o._id}},{key:"setData",value:function(i,a){var o=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){o.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,o){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,o)}},{key:"reloadTileByLnglat",value:function(i,a,o){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,o)}},{key:"getTileExtent",value:function(i,a){var o;return(o=this.tileset)===null||o===void 0?void 0:o.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,o){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,o)}},{key:"reloadTileByExtent",value:function(i,a){var o;(o=this.tileset)===null||o===void 0||o.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o=this;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(p,_){try{o.excuteParser(),o.initCluster(),o.executeTrans(),p({})}catch(x){_(x)}}));case 1:case"end":return c.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=CP(this.cfg,i,wP);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=Object(ae.a)(Object(ae.a)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",o=nt(a);this.data=o(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=Fc(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new Hn(Object(ae.a)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(o){var l=o.type,c=ht(l)(i.data,o);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=y2(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=Zu(Lc(this.extent),i)),a[0].concat(a[1])}}]),t}(Po.EventEmitter);function RP(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function x2(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=MP(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function MP(e,r){if(!!e){if(typeof e=="string")return E2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return E2(e,r)}}function E2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var B_=6378e3;function PP(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*B_)*(256<<20)/2,o=IP(t,i),l=o.gridHash,c=o.gridOffset,p=BP(l,c,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:p}}function IP(e,r){var t=Infinity,n=-Infinity,i,a=x2(e),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ce){a.e(ce)}finally{a.f()}var c=(t+n)/2,p=DP(r,c);if(p.xOffset<=0||p.yOffset<=0)return{gridHash:{},gridOffset:p};var _={},x=x2(e),A;try{for(x.s();!(A=x.n()).done;){var w=A.value,I=w.coordinates[1],P=w.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(P)){var H=Math.floor((I+90)/p.yOffset),W=Math.floor((P+180)/p.xOffset),oe="".concat(H,"-").concat(W);_[oe]=_[oe]||{count:0,points:[]},_[oe].count+=1,_[oe].points.push(w)}}}catch(ce){x.e(ce)}finally{x.f()}return{gridHash:_,gridOffset:p}}function DP(e,r){var t=kP(e),n=FP(r,e);return{yOffset:t,xOffset:n}}function kP(e){return e/B_*(180/Math.PI)}function FP(e,r){return r/B_*(180/Math.PI)/Math.cos(e*Math.PI/180)}function BP(e,r,t){return Object.keys(e).reduce(function(n,i,a){var o=i.split("-"),l=parseInt(o[0],10),c=parseInt(o[1],10),p={};if(t.field&&t.method){var _=N.getColumn(e[i].points,t.field);p[t.method]=N.statMap[t.method](_)}return Object.assign(p,{_id:a,coordinates:Sa([-180+r.xOffset*(c+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(p),n},[])}var Gv=Math.PI/3,LP=[0,Gv,2*Gv,3*Gv,4*Gv,5*Gv];function NP(e){return e[0]}function jP(e){return e[1]}var zP=function(){var e=0,r=0,t=1,n=1,i=NP,a=jP,o,l,c;function p(x){var A={},w=[],I,P=x.length;for(I=0;I<P;++I)if(!(isNaN(W=+i.call(null,H=x[I],I,x))||isNaN(oe=+a.call(null,H,I,x)))){var H,W,oe,ce=Math.round(oe=oe/c),Oe=Math.round(W=W/l-(ce&1)/2),Fe=oe-ce;if(Math.abs(Fe)*3>1){var je=W-Oe,tt=Oe+(W<Oe?-1:1)/2,vt=ce+(oe<ce?-1:1),kt=W-tt,ir=oe-vt;je*je+Fe*Fe>kt*kt+ir*ir&&(Oe=tt+(ce&1?1:-1)/2,ce=vt)}var ur=Oe+"-"+ce,Zr=A[ur];Zr?Zr.push(H):(w.push(Zr=A[ur]=[H]),Zr.x=(Oe+(ce&1)/2)*l,Zr.y=ce*c)}return w}function _(x){var A=0,w=0;return LP.map(function(I){var P=Math.sin(I)*x,H=-Math.cos(I)*x,W=P-A,oe=H-w;return A=P,w=H,[W,oe]})}return p.hexagon=function(x){return"m"+_(x==null?o:+x).join("l")+"z"},p.centers=function(){for(var x=[],A=Math.round(r/c),w=Math.round(e/l),I=A*c;I<n+o;I+=c,++A)for(var P=w*l+(A&1)*l/2;P<t+l/2;P+=l)x.push([P,I]);return x},p.mesh=function(){var x=_(o).slice(0,4).join("l");return p.centers().map(function(A){return"M"+A+"m"+x}).join("")},p.x=function(x){return arguments.length?(i=x,p):i},p.y=function(x){return arguments.length?(a=x,p):a},p.radius=function(x){return arguments.length?(o=+x,l=o*2*Math.sin(Gv),c=o*1.5,p):o},p.size=function(x){return arguments.length?(e=r=0,t=+x[0],n=+x[1],p):[t-e,n-r]},p.extent=function(x){return arguments.length?(e=+x[0][0],r=+x[0][1],t=+x[1][0],n=+x[1][1],p):[[e,r],[t,n]]},p.radius(1)},UP=6378e3;function VP(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,o=a===void 0?"sum":a,l=i/(2*Math.PI*UP)*(256<<20)/2,c=t.map(function(A){var w=Sa(A.coordinates),I=Object(hn.a)(w,2),P=I[0],H=I[1];return Object(ae.a)(Object(ae.a)({},A),{},{coordinates:[P,H]})}),p=zP().radius(l).x(function(A){return A.coordinates[0]}).y(function(A){return A.coordinates[1]}),_=p(c),x={dataArray:_.map(function(A,w){var I;if(r.field&&o){var P=N.getColumn(A,r.field);A[o]=N.statMap[o](P)}return I={},Object(V.a)(I,r.method,A[o]),Object(V.a)(I,"count",A.length),Object(V.a)(I,"rawData",A),Object(V.a)(I,"coordinates",[A.x,A.y]),Object(V.a)(I,"_id",w),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return x}function HP(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(o){a[o[t]]=o}),e.dataArray=e.dataArray.map(function(o){var l=o[n];return Object(ae.a)(Object(ae.a)({},o),a[l])}),e}function WP(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}wt("rasterTile",cP),wt("mvt",Km),wt("geojsonvt",vy),wt("testTile",vP),wt("geojson",Rd),wt("jsonTile",Np),wt("image",dh),wt("csv",Rv),wt("json",Kh),wt("raster",Ey),wt("rasterRgb",hP),We("cluster",y2),We("filter",RP),We("join",HP),We("map",WP),We("grid",PP),We("hexagon",VP);var S2=OP;function GP(e){var r=XP();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function XP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A2=function(e){Object(Lt.a)(t,e);var r=GP(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"added",!1),Object(V.a)(Object(Be.a)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=Object(ae.a)(Object(ae.a)({},i.getDefault()),n),Va(["update","onMove","onMapClick"],Object(Be.a)(i)),i.init(),i}return Object(De.a)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Ro.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Yt.IMapService),this.sceneSerive=i.get(Yt.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&D.remove(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var o=this.markerOption.element;return o&&D.remove(o),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.anchor;this.updatePosition(),D.setTransform(a,"".concat(Oa[o]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.offsets,l=this.lngLat,c=l.lng,p=l.lat,_=this.mapsService.lngLatToContainer([c,p]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var x=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),A=x.containerHeight,w=x.containerWidth,I=x.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>w){var P=this.mapsService.lngLatToContainer([c-360,p]);_.x=P.x}if(_.x<0){var H=this.mapsService.lngLatToContainer([c+360,p]);_.x=H.x}}(_.x>w||_.x<0||_.y>A||_.y<0)&&(a.style.display="none"),a.style.left=_.x+o[0]+"px",a.style.top=_.y-o[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,o=this.markerOption,l=o.color,c=o.anchor;if(!a){this.defaultMarker=!0,a=D.create("div"),this.markerOption.element=a;var p=document.createElementNS("http://www.w3.org/2000/svg","svg");p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height","48px"),p.setAttributeNS(null,"width","48px"),p.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),p.appendChild(_),a.appendChild(p)}D.addClass(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(x){var A,w,I=((A=i.markerOption)===null||A===void 0?void 0:A.style)&&((w=i.markerOption)===null||w===void 0?void 0:w.style[x]);a&&(a.style[x]=I)}),Ko(a,c,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Ul()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Po.EventEmitter);function ZP(e){var r=$P();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function $P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YP=fi.merge,yH=function(e){Object(Lt.a)(t,e);var r=ZP(t);function t(n){var i,a;return Object(et.a)(this,t),a=r.call(this),Object(V.a)(Object(Be.a)(a),"markers",[]),Object(V.a)(Object(Be.a)(a),"points",[]),Object(V.a)(Object(Be.a)(a),"clusterMarkers",[]),a.markerLayerOption=YP(a.getDefault(),n),Va(["update"],Object(Be.a)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return Object(De.a)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(Yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var i=this.mapsService.getContainer();this.containerSize={containerWidth:(i==null?void 0:i.scrollWidth)||0,containerHeight:(i==null?void 0:i.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;if(i.getMarkerLayerContainerSize=this.getContainerSize.bind(this),a&&(this.addPoint(i,this.markers.length),this.mapsService)){var o=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=Zu(l,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&(this.markers.splice(a,1),this.markerLayerOption.cluster&&(this.removePoint(a),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(i,a){var o=i.getLnglat(),l=o.lng,c=o.lat,p={geometry:{type:"Point",coordinates:[l,c]},properties:Object(ae.a)(Object(ae.a)({},i.getExtData()),{},{marker_id:a})};this.points.push(p),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(i){var a=this.points.findIndex(function(o){return o.properties.marker_id===i});a>-1&&this.points.splice(a,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,o=i.minZoom,l=o===void 0?0:o,c=i.maxZoom;this.clusterIndex=new g2.a({radius:a,minZoom:l,maxZoom:c}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var o=this,l=i[0].concat(i[1]),c=this.clusterIndex.getClusters(l,a);this.clusterMarkers.forEach(function(p){p.remove()}),this.clusterMarkers=[],c.forEach(function(p){var _,x=o.markerLayerOption.clusterOption,A=x.field,w=x.method;if((_=p.properties)!==null&&_!==void 0&&_.cluster_id){var I,P=o.getLeaves((I=p.properties)===null||I===void 0?void 0:I.cluster_id);if(p.properties.clusterData=P,A&&w){var H=P==null?void 0:P.map(function(Fe){var je=Object(V.a)({},A,Fe.properties[A]);return je}),W=N.getColumn(H,A),oe=N.getSatByColumn(w,W),ce="point_"+w;p.properties[ce]=oe.toFixed(2)}}var Oe=o.clusterMarker(p);o.clusterMarkers.push(Oe),Oe.addTo(o.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,o):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,o=a,l=o.element,c=l===void 0?this.generateElement.bind(this):l,p=new A2({element:c(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return p}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!Bc(this.bbox,a))&&(this.bbox=Zu(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(i){var a=D.create("div","l7-marker-cluster"),o=D.create("div","",a),l=D.create("span","",o),c=this.markerLayerOption.clusterOption,p=c.field,_=c.method;i.properties.point_count=i.properties.point_count||1;var x=p&&_?i.properties["point_"+_]||i.properties[p]:i.properties.point_count;return l.textContent=x,a}}]),t}(Po.EventEmitter),_H=C("bpoo");function KP(e){var r=qP();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function qP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hd=function(e){Object(Lt.a)(t,e);var r=KP(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this),t.controlCount++,i.controlOption=Object(ae.a)(Object(ae.a)({},i.getDefault(n)),n||{}),i}return Object(De.a)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(o){var l=Object(hn.a)(o,2),c=l[0],p=l[1];p===void 0&&(i[c]=a[c])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=Object(ae.a)(Object(ae.a)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Yt.IMapService),this.renderService=i.get(Yt.IRendererService),this.layerService=i.get(Yt.ILayerService),this.controlService=i.get(Yt.IControlService),this.configService=i.get(Yt.IGlobalConfigService),this.scene=i.get(Yt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),D.addClass(this.container,"l7-control");var a=this.controlOption,o=a.className,l=a.style;return o&&this.setClassName(o),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;D.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return D.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;D.removeClass(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;D.addClass(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:Nd.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Nd.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,o=this.controlOption.className;o&&D.removeClass(a,o),i&&D.addClass(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var o=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?o.insertBefore(a,o.firstChild):o.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(o){return o in i})}}]),t}(m.a);Object(V.a)(Hd,"controlCount",0);function QP(e){var r=JP();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function JP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ry=function(e){Object(Lt.a)(t,e);var r=QP(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"isDisable",!1),n}return Object(De.a)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var o;(o=this.button)===null||o===void 0||o.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return D.create("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,o=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(o),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,o=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(o),Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&D.remove(this.buttonIcon),i){var a,o=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(o){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,o)}else{var c;(c=this.button)===null||c===void 0||c.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(!!this.button)if(D.removeClass(this.button,"l7-button-control--row"),D.removeClass(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var o;a=D.create("div","l7-button-control__text"),(o=this.button)===null||o===void 0||o.appendChild(a),this.buttonText=a}a.innerText=i,D.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(D.remove(this.buttonText),this.buttonText=void 0)}}]),t}(Hd);function eI(e){var r=tI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function tI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T2=function(e){Object(Lt.a)(t,e);var r=eI(t);function t(n,i){var a;return Object(et.a)(this,t),a=r.call(this),Object(V.a)(Object(Be.a)(a),"isShow",!1),Object(V.a)(Object(Be.a)(a),"timeout",null),Object(V.a)(Object(Be.a)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),D.removeClass(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(o){o!==Object(Be.a)(a)&&o.isShow&&o.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),Object(Be.a)(a)}),Object(V.a)(Object(Be.a)(a),"hide",function(){return a.isShow&&(D.addClass(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),Object(Be.a)(a)}),Object(V.a)(Object(Be.a)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){!a.isShow||(a.hide(),a.timeout=null)},300))}),Object(V.a)(Object(Be.a)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),Object(V.a)(Object(Be.a)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),Object(V.a)(Object(Be.a)(a),"onPopperUnClick",function(o){D.findParentElement(o.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),Object(V.a)(Object(Be.a)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),Object(V.a)(Object(Be.a)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push(Object(Be.a)(a)),a}return Object(De.a)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(D.clearChildren(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),D.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,o=a.container,l=a.offset,c=l===void 0?[0,0]:l,p=a.placement,_=Object(hn.a)(c,2),x=_[0],A=_[1],w=this.button.getBoundingClientRect(),I=o.getBoundingClientRect(),P=D.getDiffRect(w,I),H=P.left,W=P.right,oe=P.top,ce=P.bottom,Oe=!1,Fe=!1;/^(left|right)/.test(p)?(p.includes("left")?i.right="".concat(w.width+W,"px"):p.includes("right")&&(i.left="".concat(w.width+H,"px")),p.includes("start")?i.top="".concat(oe,"px"):p.includes("end")?i.bottom="".concat(ce,"px"):(i.top="".concat(oe+w.height/2,"px"),Fe=!0,i.transform="translate(".concat(x,"px, calc(").concat(A,"px - 50%))"))):/^(top|bottom)/.test(p)&&(p.includes("top")?i.bottom="".concat(w.height+ce,"px"):p.includes("bottom")&&(i.top="".concat(w.height+oe,"px")),p.includes("start")?i.left="".concat(H,"px"):p.includes("end")?i.right="".concat(W,"px"):(i.left="".concat(H+w.width/2,"px"),Oe=!0,i.transform="translate(calc(".concat(x,"px - 50%), ").concat(A,"px)"))),i.transform="translate(calc(".concat(x,"px - ").concat(Oe?"50%":"0%","), calc(").concat(A,"px - ").concat(Fe?"50%":"0%",")");var je=p.split("-");je.length&&D.addClass(this.popperDOM,je.map(function(tt){return"l7-popper-".concat(tt)}).join(" ")),D.addStyle(this.popperDOM,D.css2Style(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,o=i.className,l=o===void 0?"":o,c=i.content,p=D.create("div","l7-popper l7-popper-hide ".concat(l)),_=D.create("div","l7-popper-content"),x=D.create("div","l7-popper-arrow");return p.appendChild(_),p.appendChild(x),a.appendChild(p),this.popperDOM=p,this.contentDOM=_,c&&this.setContent(c),p}}]),t}(Po.EventEmitter);Object(V.a)(T2,"conflictPopperList",[]);function rI(e){var r=nI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function nI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iI={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},aI=function(e){Object(Lt.a)(t,e);var r=rI(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Object(_a.a)(Object(Te.a)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,o=Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:o.position;return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":iI[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,o=a.popperClassName,l=a.popperPlacement,c=a.popperTrigger,p=this.mapsService.getMapContainer();return this.popper=new T2(this.button,{className:o,placement:l,trigger:c,container:p,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(Ry);function oI(e){var r=sI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function sI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wp=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(Wp||{}),C2=function(e){Object(Lt.a)(t,e);var r=oI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"selectValue",[]),Object(V.a)(Object(Be.a)(n),"createNormalOption",function(l){var c=n.selectValue.includes(l.value),p=D.create("div","l7-select-control-item ".concat(c?Wp.ActiveOptionClassName:""));n.getIsMultiple()&&p.appendChild(n.createCheckbox(c)),l.icon&&p.appendChild(l.icon);var _=D.create("span");return _.innerText=l.text,p.appendChild(_),p}),Object(V.a)(Object(Be.a)(n),"onItemClick",function(l){if(n.getIsMultiple()){var c=n.selectValue.findIndex(function(p){return p===l.value});c>-1?n.selectValue.splice(c,1):n.selectValue=[].concat(Object(cr.a)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return Object(De.a)(t,[{key:"setOptions",value:function(i){Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(i);this.optionDOMList.forEach(function(c){var p=c.getAttribute(Wp.OptionValueAttrKey),_=a.getIsMultiple()?c.querySelector("input[type=checkbox]"):void 0;l.includes(p)?(D.addClass(c,Wp.ActiveOptionClassName),_&&D.setChecked(_,!0)):(D.removeClass(c,Wp.ActiveOptionClassName),_&&D.setChecked(_,!1))}),this.selectValue=l,o&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,o=this.isImageOptions(),l=D.create("div",o?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&D.addClass(l,"l7-select-control--multiple");var c=i.map(function(p,_){var x=o?a.createImageOption(p):a.createNormalOption(p);return x.setAttribute(Wp.OptionValueAttrKey,p.value),x.setAttribute(Wp.OptionIndexAttrKey,window.String(_)),x.addEventListener("click",a.onItemClick.bind(a,p)),x});return l.append.apply(l,Object(cr.a)(c)),this.optionDOMList=c,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),o=D.create("div","l7-select-control-item ".concat(a?Wp.ActiveOptionClassName:"")),l=D.create("img");l.setAttribute("src",i.img),D.setUnDraggable(l),o.appendChild(l);var c=D.create("div","l7-select-control-item-row");this.getIsMultiple()&&o.appendChild(this.createCheckbox(a));var p=D.create("span");return p.innerText=i.text,c.appendChild(p),o.appendChild(c),o}},{key:"createCheckbox",value:function(i){var a=D.create("input");return a.setAttribute("type","checkbox"),i&&D.setChecked(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(aI),Jh=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function uI(e){var r=lI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function lI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bH=function(e){Object(Lt.a)(t,e);var r=uI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"onClick",Object(Zt.a)(be.a.mark(function l(){var c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(c=n.controlOption.onExport,_.t0=c==null,_.t0){_.next=8;break}return _.t1=c,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),Object(V.a)(Object(Be.a)(n),"mergeImage",Object(Zt.a)(be.a.mark(function l(){var c,p,_,x,A,w,I,P,H,W,oe,ce,Oe,Fe,je=arguments;return be.a.wrap(function(vt){for(;;)switch(vt.prev=vt.next){case 0:for(_=n.controlOption.imageType,x=(c=(p=n.mapsService.getContainer())===null||p===void 0?void 0:p.getBoundingClientRect())!==null&&c!==void 0?c:{},A=x.width,w=A===void 0?0:A,I=x.height,P=I===void 0?0:I,H=document.createElement("canvas"),H.width=w,H.height=P,W=H.getContext("2d"),oe=je.length,ce=new Array(oe),Oe=0;Oe<oe;Oe++)ce[Oe]=je[Oe];return vt.next=9,Promise.all(ce.map(function(kt){return new Promise(function(ir){var ur=new Image;ur.onload=function(){ir(ur)},ur.src=kt})}));case 9:return Fe=vt.sent,Fe.forEach(function(kt){W==null||W.drawImage(kt,0,0,w,P)}),vt.abrupt("return",H.toDataURL("image/".concat(_)));case 12:case"end":return vt.stop()}},l)}))),n}return Object(De.a)(t,[{key:"onAdd",value:function(){var i=Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Jh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,this.mapsService.exportMap("png");case 2:return o=p.sent,p.next=5,this.scene.exportPng("png");case 5:return l=p.sent,p.abrupt("return",this.mergeImage.apply(this,Object(cr.a)([o,l].filter(function(_){return _}))));case 7:case"end":return p.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ry);function cI(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=fI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function fI(e,r){if(!!e){if(typeof e=="string")return w2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return w2(e,r)}}function w2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var O2=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],ep=function(){if(typeof document=="undefined")return!1;for(var e=O2[0],r={},t=0,n=O2;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var o=cI(i.entries()),l;try{for(o.s();!(l=o.n()).done;){var c=Object(hn.a)(l.value,2),p=c[0],_=c[1];r[e[p]]=_}}catch(x){o.e(x)}finally{o.f()}return r}}return!1}(),R2={change:ep.fullscreenchange,error:ep.fullscreenerror},bc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){bc.off("change",l),n()};bc.on("change",a);var o=r[ep.requestFullscreen](t);o instanceof Promise&&o.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!bc.isFullscreen){r();return}var n=function a(){bc.off("change",a),r()};bc.on("change",n);var i=document[ep.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return bc.isFullscreen?bc.exit():bc.request(r,t)},onchange:function(r){bc.on("change",r)},onerror:function(r){bc.on("error",r)},on:function(r,t){var n=R2[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=R2[r];n&&document.removeEventListener(n,t,!1)},raw:ep};Object.defineProperties(bc,{isFullscreen:{get:function(){return Boolean(document[ep.fullscreenElement])}},element:{enumerable:!0,get:function(){var r;return(r=document[ep.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[ep.fullscreenEnabled])}}}),ep||(bc={isEnabled:!1});var L_=bc;function hI(e){var r=pI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function pI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xH=function(e){Object(Lt.a)(t,e);var r=hI(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this,n),Object(V.a)(Object(Be.a)(i),"isFullscreen",!1),Object(V.a)(Object(Be.a)(i),"toggleFullscreen",Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!L_.isEnabled){l.next=3;break}return l.next=3,L_.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),Object(V.a)(Object(Be.a)(i),"onClick",function(){i.toggleFullscreen()}),Object(V.a)(Object(Be.a)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,o=a.btnText,l=a.btnIcon,c=a.title,p=a.exitBtnText,_=a.exitBtnIcon,x=a.exitTitle;i.isFullscreen?(i.setBtnTitle(x),i.setBtnText(p),i.setBtnIcon(_)):(i.setBtnTitle(c),i.setBtnText(o),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),L_.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return Object(De.a)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,o=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(o),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=D.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){Object(_a.a)(Object(Te.a)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Jh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Jh("l7-icon-exit-fullscreen")})}}]),t}(Ry);function dI(e){var r=vI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function vI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EH=function(e){Object(Lt.a)(t,e);var r=dI(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this,n),Object(V.a)(Object(Be.a)(i),"getGeoLocation",function(){return new Promise(function(a,o){window.navigator.geolocation.getCurrentPosition(function(l){var c=l.coords,p=c!=null?c:{},_=p.longitude,x=p.latitude;!isNaN(_)&&!isNaN(x)?a([_,x]):o()},function(l){o(l)})})}),Object(V.a)(Object(Be.a)(i),"onClick",Object(Zt.a)(be.a.mark(function a(){var o,l,c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return o=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,c=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=c>15?c:15,!o){_.next=15;break}return _.next=12,o(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return Object(De.a)(t,[{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Jh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(Ry);function mI(e){var r=gI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function gI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function M2(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var SH=function(e){Object(Lt.a)(t,e);var r=mI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),Object(V.a)(Object(Be.a)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),Object(V.a)(Object(Be.a)(n),"onSelectChange",function(){n.layers.forEach(function(l){var c=n.selectValue.includes(l.name),p=l.isVisible();c&&!p&&l.show(),!c&&p&&l.hide()})}),n}return Object(De.a)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var o=[];return a.forEach(function(l){if(l instanceof Object&&(M2(l)?o.push(l.layer):o.push(l)),typeof l=="string"){var c=i.getLayer(l)||i.getLayerByName(l);c&&o.push(c)}}),o}return i.getLayers()||[]}},{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Jh("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,o=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(M2(l))return{text:l.name||l.layer.name,value:l.layer.name,img:o?l.img:void 0};if(typeof l=="string"){var c=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:c==null?void 0:c.name,value:c==null?void 0:c.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers"]);Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i),a&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(C2);function yI(e){var r=_I();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function _I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P2=function(e){Object(Lt.a)(t,e);var r=yI(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getDefault",value:function(){return{position:Nd.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=D.create("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(D.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,o=a.href,l=a.img,c=D.create("img");if(c.setAttribute("src",l),c.setAttribute("aria-label","AntV logo"),D.setUnDraggable(c),o){var p=D.create("a","l7-control-logo-link");p.target="_blank",p.href=o,p.rel="noopener nofollow",p.setAttribute("rel","noopener nofollow"),p.appendChild(c),i.appendChild(p)}else i.appendChild(c)}}]),t}(Hd),bI={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},xI={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function EI(e){var r=SI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function SI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AH=function(e){Object(Lt.a)(t,e);var r=EI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return Object(De.a)(t,[{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Jh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?xI:bI;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var o=Object(hn.a)(a,2),l=o[0],c=o[1];return typeof c=="string"&&l!=="blank"}).map(function(a){var o,l=Object(hn.a)(a,2),c=l[0],p=l[1],_=(o=i[c])!==null&&o!==void 0?o:{},x=_.text,A=_.img;return{text:x!=null?x:c,value:p,img:A,key:c}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var o,l,c=this.controlOption.defaultValue;this.controlOption.defaultValue=(o=(l=this.controlOption.options.find(function(_){return _.key===c}))===null||l===void 0?void 0:l.value)!==null&&o!==void 0?o:c}else{var p=this.getMapStyle();p?this.controlOption.defaultValue=p:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),Object(_a.a)(Object(Te.a)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(C2);function AI(e){var r=TI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function TI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TH=function(e){Object(Lt.a)(t,e);var r=AI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"location",[0,0]),Object(V.a)(Object(Be.a)(n),"onMouseMove",function(l){var c=n.location,p=l.lngLat||l.lnglat,_=n.controlOption.transform;p&&(c=[p.lng,p.lat]),n.location=c,_&&(c=_(c)),n.insertLocation2HTML(c),n.emit("locationChange",c)}),n}return Object(De.a)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{position:Nd.BOTTOMLEFT,transform:function(o){var l=Object(hn.a)(o,2),c=l[0],p=l[1];return[+(+c).toFixed(6),+(+p).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=D.create("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(Hd);function CI(e){var r=wI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function wI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OI=function(e){Object(Lt.a)(t,e);var r=CI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"update",function(){var l=n.mapsService,c=n.controlOption.maxWidth,p=l.getSize()[1]/2,_=l.containerToLngLat([0,p]),x=l.containerToLngLat([c,p]),A=Xu([_.lng,_.lat],[x.lng,x.lat]);n.updateScales(A)}),n}return Object(De.a)(t,[{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:Nd.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=D.create("div",i);this.resetScaleLines(a);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,o=a.metric,l=a.imperial;o&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){D.clearChildren(i);var a=this.controlOption,o=a.metric,l=a.imperial,c=a.maxWidth,p=a.lockWidth;p&&D.addStyle(i,"width: ".concat(c,"px")),o&&(this.mScale=D.create("div","l7-control-scale-line",i)),l&&(this.iScale=D.create("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,o){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*o)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),o=i/a;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,a*o}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),o=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,o,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,o,l,c;a>5280?(o=a/5280,l=this.getRoundNum(o),this.updateScale(this.iScale,l+" mi",l/o)):(c=this.getRoundNum(a),this.updateScale(this.iScale,c+" ft",c/a))}}]),t}(Hd);function RI(e){var r=MI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function MI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PI=function(e){Object(Lt.a)(t,e);var r=RI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),Object(V.a)(Object(Be.a)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),Object(V.a)(Object(Be.a)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return Object(De.a)(t,[{key:"getDefault",value:function(i){return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{position:Nd.BOTTOMRIGHT,name:"zoom",zoomInText:Jh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Jh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=D.create("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){D.clearChildren(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,o,l,c){var p=D.create("button",o,l);return typeof i=="string"?p.innerHTML=i:p.append(i),p.title=a,c&&p.addEventListener("click",c),p}}]),t}(Hd);function II(e){var r=DI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function DI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N_=function(e){Object(Lt.a)(t,e);var r=II(t);function t(n){var i;Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"isShow",!0),Object(V.a)(Object(Be.a)(i),"onMouseMove",function(o){var l,c=i.mapsService.getMapContainer(),p=(l=c==null?void 0:c.getBoundingClientRect())!==null&&l!==void 0?l:{},_=p.left,x=_===void 0?0:_,A=p.top,w=A===void 0?0:A;i.setPopupPosition(o.clientX-x,o.clientY-w)}),Object(V.a)(Object(Be.a)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var o=i.lngLat,l=o.lng,c=o.lat,p=i.mapsService.lngLatToContainer([l,c]),_=p.x,x=p.y;i.setPopupPosition(_,x)}}),Object(V.a)(Object(Be.a)(i),"onKeyDown",function(o){o.keyCode===27&&i.remove()}),Object(V.a)(Object(Be.a)(i),"onCloseButtonClick",function(o){o.stopPropagation&&o.stopPropagation(),i.hide()}),Object(V.a)(Object(Be.a)(i),"update",function(){var o=!!i.lngLat,l=i.popupOption,c=l.className,p=l.style,_=l.maxWidth,x=l.anchor,A=l.stopPropagation;if(!(!i.mapsService||!o||!i.content)){var w=i.mapsService.getMarkerContainer();if(!i.container&&w&&(i.container=D.create("div","l7-popup ".concat(c!=null?c:""," ").concat(i.isShow?"":"l7-popup-hide"),w),p&&i.container.setAttribute("style",p),i.tip=D.create("div","l7-popup-tip",i.container),i.container.appendChild(i.content),A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(H){i.container.addEventListener(H,function(W){W.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),D.setTransform(i.container,"".concat(Oa[x])),Ko(i.container,x,"popup"),_){var I=i.container.getBoundingClientRect(),P=I.width;P>parseFloat(_)&&(i.container.style.width=_)}else i.container.style.removeProperty("width")}}),i.popupOption=Object(ae.a)(Object(ae.a)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return Object(De.a)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Yt.IMapService),this.sceneService=i.get(Yt.ISceneService),this.layerService=i.get(Yt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,o=a.html,l=a.text,c=a.title;return o?this.setHTML(o):l&&this.setText(l),c&&this.setTitle(c),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&D.remove(this.content),this.container&&(D.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=Object(ae.a)(Object(ae.a)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(D.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&D.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&D.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=D.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),D.clearChildren(this.contentTitle),D.appendElementType(this.contentTitle,i)):this.contentTitle&&(D.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,o=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,o]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Ro.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),D.appendElementType(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,o=this.mapsService;o&&(o==null||o.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){o==null||o.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,o=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();o&&(o==null||o.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(o==null||o.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&D.remove(this.content),this.contentTitle=void 0,this.content=D.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Jh("l7-icon-guanbi");D.addClass(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(o){o.stopPropagation()}),a.addEventListener("pointerdown",function(o){o.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=D.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var o=this.popupOption.offsets;this.container.style.left=i+o[0]+"px",this.container.style.top=a-o[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(o){return o in i})}}]),t}(Po.EventEmitter);function kI(e){var r=FI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function FI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BI=fi.get,CH=function(e){Object(Lt.a)(t,e);var r=kI(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"layerClickCountByFrame",0),Object(V.a)(Object(Be.a)(n),"layerConfigMap",new WeakMap),Object(V.a)(Object(Be.a)(n),"onLayerClick",function(l,c){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,c.featureId))n.hide();else{var p=n.getLayerInfoFrag(l,c),_=p.title,x=p.content;n.setDOMContent(x),n.setLnglat(c.lngLat),n.setTitle(_),n.displayFeatureInfo={layer:l,featureId:c.featureId},n.show()}})}),Object(V.a)(Object(Be.a)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),Object(V.a)(Object(Be.a)(n),"updateCloseOnClick",function(){}),n}return Object(De.a)(t,[{key:"layerConfigItems",get:function(){var i,a=this.popupOption,o=a.config,l=a.items;return(i=o!=null?o:l)!==null&&i!==void 0?i:[]}},{key:"addTo",value:function(i){return Object(_a.a)(Object(Te.a)(t.prototype),"addTo",this).call(this,i),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Object(_a.a)(Object(Te.a)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(i){this.unbindLayerEvent();var a=Object(ae.a)({},i),o=a.trigger||this.popupOption.trigger,l=a.items||this.popupOption.items,c=(l==null?void 0:l.length)===0;return a.followCursor=o==="hover"&&!c,Object(_a.a)(Object(Te.a)(t.prototype),"setOptions",this).call(this,a),this.bindLayerEvent(),c&&this.hide(),this}},{key:"getDefault",value:function(i){var a=i.trigger==="hover";return Object(ae.a)(Object(ae.a)({},Object(_a.a)(Object(Te.a)(t.prototype),"getDefault",this).call(this,i)),{},{trigger:"hover",followCursor:a,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var i=this,a=this.popupOption,o=a.trigger,l=a.closeOnClick;this.layerConfigItems.forEach(function(c){var p,_=i.getLayerByConfig(c);if(!!_){var x=Object(ae.a)({},c);if(o==="hover"){var A=i.onLayerMouseMove.bind(i,_),w=i.onLayerMouseOut.bind(i,_);x.onMouseMove=A,x.onMouseOut=w,_==null||_.on("mousemove",A),_==null||_.on("mouseout",w)}else{var I,P=i.onLayerClick.bind(i,_);x.onClick=P,_==null||_.on("click",P);var H=(I=i.mapsService)===null||I===void 0?void 0:I.getMapContainer();H&&l&&H.addEventListener("click",i.onSceneClick)}var W=_==null||(p=_.getSource)===null||p===void 0?void 0:p.call(_),oe=i.onSourceUpdate.bind(i);W==null||W.on("update",oe),x.onSourceUpdate=oe,i.layerConfigMap.set(_,x)}})}},{key:"unbindLayerEvent",value:function(){var i=this;this.layerConfigItems.forEach(function(a){var o,l=i.getLayerByConfig(a),c=l&&i.layerConfigMap.get(l);if(!!c){var p=c.onMouseMove,_=c.onMouseOut,x=c.onClick,A=c.onSourceUpdate;if(p&&l.off("mousemove",p),_&&l.off("mouseout",_),x&&l.off("click",x),A){var w;l==null||(w=l.getSource())===null||w===void 0||w.off("update",A)}var I=(o=i.mapsService)===null||o===void 0?void 0:o.getMapContainer();I&&I.removeEventListener("click",i.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(i,a){if(!this.isSameFeature(i,a.featureId)){var o=this.getLayerInfoFrag(i,a),l=o.title,c=o.content;this.setDOMContent(c),this.setTitle(l),this.displayFeatureInfo={layer:i,featureId:a.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(i,a){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(i,a){var o=this.layerConfigMap.get(i),l,c=document.createDocumentFragment();if(o){var p=a.feature;p.type==="Feature"&&"properties"in p&&"geometry"in p&&(p=p.properties);var _=o.title,x=o.fields,A=o.customContent;if(_){l=document.createDocumentFragment();var w=_ instanceof Function?_(p):_;D.appendElementType(l,w)}if(A){var I=A instanceof Function?A(p):A;D.appendElementType(c,I)}else x!=null&&x.length&&(x==null||x.forEach(function(P){var H,W,oe=typeof P=="string"?{field:P}:P,ce=oe.field,Oe=oe.formatField,Fe=oe.formatValue,je=oe.getValue,tt=D.create("div","l7-layer-popup__row"),vt=je?je(a.feature):BI(p,ce),kt=(H=Oe instanceof Function?Oe(ce,p):Oe)!==null&&H!==void 0?H:ce,ir=(W=Fe instanceof Function?Fe(vt,p):Fe)!==null&&W!==void 0?W:vt,ur=D.create("span","l7-layer-popup__key",tt);D.appendElementType(ur,kt),D.appendElementType(ur,document.createTextNode("\uFF1A"));var Zr=D.create("span","l7-layer-popup__value",tt);Array.isArray(ir)&&ir.every(function(ln){return!(ln instanceof Object)})&&(ir=ir.map(function(ln){return String(ln)}).join(",")),D.appendElementType(Zr,ir),c.appendChild(tt)}))}return{title:l,content:c}}},{key:"getLayerByConfig",value:function(i){var a=i.layer;if(a instanceof Object)return a;if(typeof a=="string")return this.layerService.getLayer(a)||this.layerService.getLayerByName(a)}},{key:"isSameFeature",value:function(i,a){var o=this.displayFeatureInfo;return o&&i===o.layer&&a===o.featureId}}]),t}(N_);function LI(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}LI(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Gp,I2=(Gp={},Object(V.a)(Gp,Hp.additive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:1,dstAlpha:1}}),Object(V.a)(Gp,Hp.none,{enable:!1}),Object(V.a)(Gp,Hp.normal,{enable:!0,func:{srcRGB:Y.SRC_ALPHA,dstRGB:Y.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),Object(V.a)(Gp,Hp.subtractive,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE,srcAlpha:Y.ZERO,dstAlpha:Y.ONE_MINUS_SRC_COLOR},equation:{rgb:Y.FUNC_SUBTRACT,alpha:Y.FUNC_SUBTRACT}}),Object(V.a)(Gp,Hp.max,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MAX_EXT}}),Object(V.a)(Gp,Hp.min,{enable:!0,func:{srcRGB:Y.ONE,dstRGB:Y.ONE},equation:{rgb:Y.MIN_EXT}}),Gp);function D2(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function k2(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),o=a.enableTAA;return o?i.add(n("taa")):i.add(n("render")),D2(r).forEach(function(l){var c=Object(hn.a)(l,2),p=c[0],_=c[1];i.add(t(p),_)}),i.add(t("copy")),i}var NI=function(){function e(r){Object(et.a)(this,e),this.layer=r}return Object(De.a)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(Yt.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var i=this.layer.getContainer(),a=i.get(Yt.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),a.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),o=a.get(Yt.IPickingService),l=a.get(Yt.IMapService),c=this.layer.getSource().extent,p=vf(n.lngLat,c),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},x=i||t;if(p){var A=this.readRasterValue(t,c,l,n.x,n.y);return _.rasterValue=A,o.triggerHoverOnLayer(x,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,o.triggerHoverOnLayer(x,Object(ae.a)(Object(ae.a)({},_),{},{type:"unpick"})),o.triggerHoverOnLayer(x,_),!1}},{key:"readRasterValue",value:function(t,n,i,a,o){var l=t.getSource().data.dataArray[0],c=Object(hn.a)(n,4),p=c[0],_=p===void 0?0:p,x=c[1],A=x===void 0?0:x,w=c[2],I=w===void 0?10:w,P=c[3],H=P===void 0?-10:P,W=i.lngLatToContainer([_,A]),oe=i.lngLatToContainer([I,H]),ce=oe.x-W.x,Oe=W.y-oe.y,Fe=[(a-W.x)/ce,(o-oe.y)/Oe],je=l.width||1,tt=l.height||1,vt=Math.floor(Fe[0]*je),kt=Math.floor(Fe[1]*tt),ir=Math.max(0,kt-1)*je+vt,ur=l.data[ir];return ur}},{key:"selectFeature",value:function(t){var n=this.layer,i=Object(hn.a)(t,3),a=i[0],o=i[1],l=i[2];n.hooks.beforeSelect.call([a,o,l])}},{key:"highlightPickedFeature",value:function(t){var n=Object(hn.a)(t,3),i=n[0],a=n[1],o=n[2];this.layer.hooks.beforeHighlight.call([i,a,o])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),jI=function(){function e(r){Object(et.a)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(Yt.IRendererService)}return Object(De.a)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),o=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=o,o}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return Th(t);case"quantize":return Ch(t);case"custom":return cp(t,n);case"linear":return Ah(t,n);default:return Rc(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),zI=["passes"],UI=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],F2,j_,B2;function VI(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=HI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function HI(e,r){if(!!e){if(typeof e=="string")return L2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L2(e,r)}}function L2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function WI(e){var r=GI();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function GI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z_=fi.isEqual,N2=fi.isFunction,j2=fi.isNumber,Mu=fi.isObject,XI=fi.isPlainObject,ZI=fi.isUndefined,z2=0,Xp=(F2=k_(Yt.IGlobalConfigService),j_=function(e){Object(Lt.a)(t,e);var r=WI(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object(et.a)(this,t),n=r.call(this),Object(V.a)(Object(Be.a)(n),"id","".concat(z2++)),Object(V.a)(Object(Be.a)(n),"name","".concat(z2)),Object(V.a)(Object(Be.a)(n),"visible",!0),Object(V.a)(Object(Be.a)(n),"zIndex",0),Object(V.a)(Object(Be.a)(n),"inited",!1),Object(V.a)(Object(Be.a)(n),"layerModelNeedUpdate",!1),Object(V.a)(Object(Be.a)(n),"pickedFeatureID",null),Object(V.a)(Object(Be.a)(n),"selectedFeatureID",null),Object(V.a)(Object(Be.a)(n),"styleNeedUpdate",!1),Object(V.a)(Object(Be.a)(n),"forceRender",!1),Object(V.a)(Object(Be.a)(n),"clusterZoom",0),Object(V.a)(Object(Be.a)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),Object(V.a)(Object(Be.a)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),Object(V.a)(Object(Be.a)(n),"hooks",{init:new Cl.a,afterInit:new Cl.d,beforeRender:new Cl.d,beforeRenderData:new Cl.c,afterRender:new Cl.e,beforePickingEncode:new Cl.e,afterPickingEncode:new Cl.e,beforeHighlight:new Cl.e(["pickedColor"]),afterHighlight:new Cl.e,beforeSelect:new Cl.e(["pickedColor"]),afterSelect:new Cl.e,beforeDestroy:new Cl.e,afterDestroy:new Cl.e}),Object(V.a)(Object(Be.a)(n),"models",[]),Object(V.a)(Object(Be.a)(n),"startInit",!1),Object(V.a)(Object(Be.a)(n),"layerChildren",[]),Object(V.a)(Object(Be.a)(n),"masks",[]),ma(Object(Be.a)(n),"configService",B2,Object(Be.a)(n)),Object(V.a)(Object(Be.a)(n),"animateOptions",{enable:!1}),Object(V.a)(Object(Be.a)(n),"currentPickId",null),Object(V.a)(Object(Be.a)(n),"encodeStyleAttribute",{}),Object(V.a)(Object(Be.a)(n),"enableShaderEncodeStyles",[]),Object(V.a)(Object(Be.a)(n),"enableDataEncodeStyles",[]),Object(V.a)(Object(Be.a)(n),"enablg",[]),Object(V.a)(Object(Be.a)(n),"pendingStyleAttributes",[]),Object(V.a)(Object(Be.a)(n),"scaleOptions",{}),Object(V.a)(Object(Be.a)(n),"animateStatus",!1),Object(V.a)(Object(Be.a)(n),"isDestroyed",!1),Object(V.a)(Object(Be.a)(n),"encodeDataLength",0),Object(V.a)(Object(Be.a)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var o=n.layerSource.getSourceCfg().autoRender;o&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return Object(De.a)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=Object(ae.a)(Object(ae.a)({},this.needUpdateConfig),i);else{var o=this.container.get(Yt.SceneID);this.configService.setLayerConfig(o,this.id,Object(ae.a)(Object(ae.a)(Object(ae.a)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o=this,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:l=this.container.get(Yt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.debugService=this.container.get(Yt.IDebugService),this.interactionService=this.container.get(Yt.IInteractionService),this.pickingService=this.container.get(Yt.IPickingService),this.mapService=this.container.get(Yt.IMapService),c=this.getLayerConfig(),p=c.enableMultiPassRenderer,_=c.passes,p&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){o.renderLayers()}),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),p&&(this.multiPassRenderer=this.container.get(Yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(H){var W=H.attributeName,oe=H.attributeField,ce=H.attributeValues,Oe=H.updateOptions;o.styleAttributeService.updateStyleAttribute(W,{scale:Object(ae.a)({field:oe},o.splitValuesAndCallbackInAttribute(ce,oe?void 0:o.getLayerConfig()[W]))},Oe)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin),x=VI(this.plugins);try{for(x.s();!(A=x.n()).done;)w=A.value,w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(H){x.e(H)}finally{x.f()}return this.layerPickService=new NI(this),this.textureService=new jI(this),this.log(Vs.LayerInitStart),P.next=31,this.hooks.init.promise();case 31:this.log(Vs.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(o,".").concat(i),c={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,c)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,o){return this.updateStyleAttribute("color",i,a,o),this}},{key:"texture",value:function(i,a,o){return this.updateStyleAttribute("texture",i,a,o),this}},{key:"rotate",value:function(i,a,o){return this.updateStyleAttribute("rotate",i,a,o),this}},{key:"size",value:function(i,a,o){return this.updateStyleAttribute("size",i,a,o),this}},{key:"filter",value:function(i,a,o){var l=this.updateStyleAttribute("filter",i,a,o);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,o){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,o);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:o}),this}},{key:"animate",value:function(i){var a={};return Mu(i)?(a.enable=!0,a=Object(ae.a)(Object(ae.a)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var o=this;return this.inited?(this.log(Vs.SourceInitStart,su.UPDATE),this.layerSource.setData(i,a),this.log(Vs.SourceInitEnd,su.UPDATE)):this.on("inited",function(){o.log(Vs.SourceInitStart,su.UPDATE);var l=o.getSource();l?o.layerSource.setData(i,a):o.source(new S2(i,a)),o.layerSource.once("update",function(){o.log(Vs.SourceInitEnd,su.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,o=i.passes,l=Object(vh.a)(i,zI);o&&D2(o).forEach(function(p){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(p[0]);_&&_.updateOptions(p[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var c=l;return Object.keys(l).forEach(function(p){var _=l[p];Array.isArray(_)&&_.length===2&&!j2(_[0])&&!j2(_[1])&&(c[p]={field:_[0],value:_[1]})}),this.encodeStyle(c),this.updateLayerConfig(c),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(o){[].concat(Object(cr.a)(a.enableShaderEncodeStyles),Object(cr.a)(a.enableDataEncodeStyles)).includes(o)&&XI(i[o])&&(i[o].field||i[o].value)&&!z_(a.encodeStyleAttribute[o],i[o])?(a.encodeStyleAttribute[o]=i[o],a.updateStyleAttribute(o,i[o].field,i[o].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[o]&&(delete a.encodeStyleAttribute[o],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var o=Object(ae.a)({},this.scaleOptions);if(Mu(i)?this.scaleOptions=Object(ae.a)(Object(ae.a)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!z_(o,this.scaleOptions)){var l=Mu(i)?i:Object(V.a)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Mu(i)?!0:i,Mu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var o=this;if(Mu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,_=p===void 0?0:p;this.updateLayerConfig({highlightColor:Mu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Mu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Mu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Mu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Uu(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Mu(i)?!0:i,Mu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var o=this;if(Mu(i)){var l=i.x,c=l===void 0?0:l,p=i.y,_=p===void 0?0:p;this.updateLayerConfig({selectColor:Mu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Mu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Mu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Mu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Uu(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),o=a.visible,l=a.minZoom,c=l===void 0?-Infinity:l,p=a.maxZoom,_=p===void 0?Infinity:p;return!!o&&i>=c&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var o=this.getLayerConfig(),l=o.passes,c=l===void 0?[]:l;this.multiPassRenderer=k2(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var p=this.rendererService.getViewportSize(),_=p.width,x=p.height;this.multiPassRenderer.resize(_,x)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),o=a.extent,l=o.some(function(c){return Math.abs(c)===Infinity});return l?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],i),this)}},{key:"destroy",value:function(){var i,a,o,l,c,p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(A){A.destroy()}),this.layerChildren.map(function(A){return A.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),x=_.maskfence;x&&(this.masks.map(function(A){return A.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(p),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(c=this.debugService)===null||c===void 0||c.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var c=l.type;if(a.coordCenter===void 0){var p,_=a.layerSource.center;a.coordCenter=_,(p=a.mapService)!==null&&p!==void 0&&p.setCoordCenter&&a.mapService.setCoordCenter(_)}if(c==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,o,l,c=this.styleAttributeService.getLayerStyleAttribute(i),p=(c==null||(a=c.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(o=p[0].option)===null||o===void 0?void 0:o.type,field:c==null||(l=c.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var o=a.range().map(function(p){return Object(V.a)({value:a.invertExtent(p)},i,p)});return o}else if(a.ticks){var l=a.ticks().map(function(p){return Object(V.a)({value:p},i,a(p))});return l}else if(a!=null&&a.domain){var c=a.domain().filter(function(p){return!ZI(p)}).map(function(p){return Object(V.a)({value:p},i,a(p))});return c}return[]}},{key:"pick",value:function(i){var a=i.x,o=i.y;this.interactionService.triggerHover({x:a,y:o})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l=this,c,p,_,x,A,w,I,P,H,W,oe,ce;return be.a.wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:return c=o.moduleName,p=o.vertexShader,_=o.fragmentShader,x=o.inject,A=o.triangulation,w=o.styleOption,I=Object(vh.a)(o,UI),this.shaderModuleService.registerModule(c,{vs:p,fs:_,inject:x}),P=this.shaderModuleService.getModule(c),H=P.vs,W=P.fs,oe=P.uniforms,ce=this.rendererService.createModel,Fe.abrupt("return",new Promise(function(je){var tt=l.styleAttributeService.createAttributesAndIndices(l.encodedData,A,w),vt=tt.attributes,kt=tt.elements,ir=tt.count,ur=Object(ae.a)({attributes:vt,uniforms:oe,fs:W,vs:H,elements:kt,blend:I2[Hp.normal],uniformBuffers:[].concat(Object(cr.a)(l.layerModel.uniformBuffers),Object(cr.a)(l.rendererService.uniformBuffers)),textures:l.layerModel.textures},I);ir&&(ur.count=ir);var Zr=ce(ur);je(Zr)}));case 5:case"end":return Fe.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,a),l=o.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),o=a.enableHighlight,l=o===void 0?!0:o,c=a.enableSelect,p=c===void 0?!0:c,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&p&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.render();case 2:case"end":return c.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(o){o.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,o,l){var c=this.configService.getAttributeConfig(this.id)||{};return z_(c[i],{field:a,values:o})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,Object(V.a)({},i,{field:a,values:o})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:Object(ae.a)({field:a},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:o,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(c){return c.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:N2(i)?void 0:i,callback:N2(i)?i:void 0}}}]),t}(Po.EventEmitter),B2=da(j_.prototype,"configService",[F2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j_);function $I(e,r){return{enable:e,mask:255,func:{cmp:Y.EQUAL,ref:r?1:0,mask:1}}}function U2(e){return e.maskOperation===Ty.OR?{enable:!0,mask:255,func:{cmp:Y.ALWAYS,ref:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===jd.SINGLE||e.stencilIndex===0?Y.ALWAYS:Y.LESS,ref:e.stencilType===jd.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:Y.KEEP,zfail:Y.REPLACE,zpass:Y.REPLACE}}}var YI={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},My={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function wH(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function V2(e){return Math.ceil(e/4)*4}var Hs=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e}({});function KI(e){switch(e){case"rotation":return{name:"Rotation",type:wn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Hs.ROTATION,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:wn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Hs.STROKE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:wn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Hs.OPACITY,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:wn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Hs.EXTRUSION_BASE,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:wn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Hs.OFFSETS,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:wn.Attribute,descriptor:{name:"a_ThetaOffset",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var H2,U_,W2,G2={opacity:Hs.OPACITY,stroke:Hs.STROKE,offsets:Hs.OFFSETS,rotation:Hs.ROTATION,extrusionBase:Hs.EXTRUSION_BASE},Ua=(H2=k_(Yt.IGlobalConfigService),U_=function(){function e(r){Object(et.a)(this,e),Object(V.a)(this,"uniformBuffers",[]),Object(V.a)(this,"textures",[]),Object(V.a)(this,"preStyleAttribute",{}),Object(V.a)(this,"encodeStyleAttribute",{}),ma(this,"configService",W2,this),this.layer=r,this.rendererService=r.getContainer().get(Yt.IRendererService),this.pickingService=r.getContainer().get(Yt.IPickingService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Yt.IStyleAttributeService),this.mapService=r.getContainer().get(Yt.IMapService),this.iconService=r.getContainer().get(Yt.IIconService),this.fontService=r.getContainer().get(Yt.IFontService),this.cameraService=r.getContainer().get(Yt.ICameraService),this.layerService=r.getContainer().get(Yt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return Object(De.a)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return I2[Hp[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,o=n.maskInside,l=o===void 0?!0:o,c=n.enableMask,p=n.maskOperation,_=p===void 0?Ty.AND:p;if(this.layer.type==="MaskLayer")return U2({isStencil:!0,stencilType:jd.SINGLE});if(t.isStencil)return U2(Object(ae.a)(Object(ae.a)({},t),{},{maskOperation:_}));var x=a||c&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return $I(x,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(My[l]," u_").concat(l,";")),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(G2[l],") in ").concat(My[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var o="";return this.layer.enableShaderEncodeStyles.forEach(function(l){o+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(My[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(My[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],o=typeof a=="undefined"?YI[i]:a;i==="stroke"&&(o=Ui(o)),n["u_"+i]=o}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=KI(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=G2[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(V2(t.uniformsLength)),isUBO:!0}),this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(V2(n.uniformsLength)),isUBO:!0}),this.uniformBuffers=[this.attributeUnifoms,this.commonUnifoms]}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,Object(cr.a)(a)),n+=a.length):(i.push(a),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=t.uniformsArray,i=this.getCommonUniformsInfo(),a=i.uniformsArray;this.attributeUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),this.commonUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)})}}]),e}(),W2=da(U_.prototype,"configService",[H2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_),ug=100,X2=36,qI=40;function Z2(e){return e/180*Math.acos(-1)}function $2(e){var r=Z2(e[0])+Math.PI/2,t=Z2(e[1]),n=ug+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),o=n*Math.sin(t);return[a,o,i]}function Y2(e,r){var t=k.create(),n=k.create(),i=L.fromValues(0,1,0),a=L.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var o=typeof r.segments!="undefined"?r.segments:32,l=2+o,c=2*l,p=[],_=[],x=[],A=[],w=[],I=[],P=0;P<=l;P++){for(var H=P/l,W=H*Math.PI,oe=0;oe<=c;oe++){var ce=oe/c,Oe=ce*Math.PI*2;k.identity(n),k.rotateZ(n,n,-W),k.identity(t),k.rotateY(t,t,Oe),L.transformMat4(a,i,n),L.transformMat4(a,a,t),L.scale(a,a,-e),x.push(a.slice()),A.push.apply(A,Object(cr.a)(a.slice())),L.normalize(a,a),w.push.apply(w,Object(cr.a)(a.slice())),I.push([ce,1-H]),A.push(ce,1-H)}if(P>0)for(var Fe=x.length,je=Fe-2*(c+1);je+c+2<Fe;je++)p.push([je,je+1,je+c+1]),_.push(je,je+1,je+c+1),p.push([je+c+1,je+1,je+c+2]),_.push(je+c+1,je+1,je+c+2)}return{cells:p,positions:x,uvs:I,positionsArr:A,indicesArr:_,normalArr:w}}var Py=v.create(),OH=v.create(),Qs=v.create(),Zp=v.create(),Xv=v.create();function V_(e,r,t,n,i){v.add(e,t,n),v.normalize(e,e),r=v.fromValues(-e[1],e[0]);var a=v.fromValues(-t[1],t[0]);return[i/v.dot(r,a),r]}function $p(e,r){return v.set(e,-r[1],r[0])}function Zv(e,r,t){return v.sub(e,r,t),v.normalize(e,e),e}function H_(e,r){return e[0]===r[0]&&e[1]===r[1]}function RH(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var QI=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object(et.a)(this,e),Object(V.a)(this,"lastFlip",-1),Object(V.a)(this,"miter",v.fromValues(0,0)),Object(V.a)(this,"started",!1),Object(V.a)(this,"dash",!1),Object(V.a)(this,"totalDistance",0),Object(V.a)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Object(De.a)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,_=this.simpleSegment(n,a,l,c,p);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,H=l<n.length-1?n[l+1]:null,W=this.simpleSegment(i,o,x,w,P,A,I,H);o+=W}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,p,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var A=n[l-1],w=t[l];w.push((p=n[l][2])!==null&&p!==void 0?p:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,H=l<n.length-1?n[l+1]:null,W=this.segment_gaode2(i,o,x,w,P,A,I,H);o+=W}if(this.dash)for(var oe=0;oe<i.positions.length/6;oe++)i.positions[oe*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],p=o<t.length-1?t[o+1]:null,_=this.segment(n,a,l,c,p);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,_=t.normals,x=Sa([a[0],a[1]]),A=Sa([i[0],i[1]]);Zv(Qs,x,A);var w=0;if(this.dash&&(w=this.lineSegmentDistance(x,A),this.totalDistance+=w),this.normal||(this.normal=v.create(),$p(this.normal,Qs)),this.started||(this.started=!0,this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-w)),c.push(n+0,n+1,n+2),!o)$p(this.normal,Qs),this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=Sa([o[0],o[1]]);H_(x,I)&&v.add(I,x,v.normalize(I,v.subtract(I,x,A))),Zv(Zp,I,x);var P=V_(Xv,v.create(),Qs,Zp,this.thickness),H=Object(hn.a)(P,2),W=H[0],oe=H[1],ce=v.dot(Xv,this.normal)<0?-1:1;this.extrusions(p,_,a,oe,W,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ce=-1,v.copy(this.normal,oe),l+=2,this.lastFlip=ce}return l}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,p){var _=0,x=t.indices,A=t.positions,w=t.normals,I=this.cap==="square",P=this.join==="bevel",H=Sa([c[0],c[1]]),W=Sa([l[0],l[1]]);Zv(Qs,a,i);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(H,W),this.totalDistance+=oe),this.normal||(this.normal=v.create(),$p(this.normal,Qs)),!this.started)if(this.started=!0,I){var ce=v.create(),Oe=v.create();v.add(ce,this.normal,Qs),v.add(Oe,this.normal,Qs),w.push(Oe[0],Oe[1],0),w.push(ce[0],ce[1],0),A.push(i[0],i[1],i[2]|0,this.totalDistance-oe,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),A.push(i[0],i[1],i[2]|0,this.totalDistance-oe,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,i,this.normal,this.thickness,this.totalDistance-oe);if(x.push(n+0,n+1,n+2),o){H_(a,o)&&v.add(o,a,v.normalize(o,v.subtract(o,a,i))),Zv(Zp,o,a);var tt=V_(Xv,v.create(),Qs,Zp,this.thickness),vt=Object(hn.a)(tt,2),kt=vt[0],ir=vt[1],ur=v.dot(Xv,this.normal)<0?-1:1,Zr=P;if(!Zr&&this.join==="miter"){var ln=kt;ln>this.miterLimit&&(Zr=!0)}Zr?(w.push(this.normal[0],this.normal[1],0),w.push(ir[0],ir[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,Object(cr.a)(this.lastFlip!==-ur?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),$p(Py,Zp),v.copy(this.normal,Py),w.push(this.normal[0],this.normal[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ur,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(A,w,a,ir,kt,this.totalDistance),x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ur=-1,v.copy(this.normal,ir),_+=2),this.lastFlip=ur}else{if($p(this.normal,Qs),I){var Fe=v.create(),je=v.create();v.sub(je,Qs,this.normal),v.add(Fe,Qs,this.normal),w.push(je[0],je[1],0),w.push(Fe[0],Fe[1],0),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),A.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(A,w,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,p=t.positions,_=t.normals,x=this.cap==="square",A=this.join==="bevel",w=Sa([a[0],a[1]]),I=Sa([i[0],i[1]]);Zv(Qs,w,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(w,I),this.totalDistance+=P),this.normal||(this.normal=v.create(),$p(this.normal,Qs)),!this.started)if(this.started=!0,x){var H=v.create(),W=v.create();v.add(H,this.normal,Qs),v.add(W,this.normal,Qs),_.push(W[0],W[1],0),_.push(H[0],H[1],0),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),p.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),o){var Oe=Sa([o[0],o[1]]);H_(w,Oe)&&v.add(Oe,w,v.normalize(Oe,v.subtract(Oe,w,I))),Zv(Zp,Oe,w);var Fe=V_(Xv,v.create(),Qs,Zp,this.thickness),je=Object(hn.a)(Fe,2),tt=je[0],vt=je[1],kt=v.dot(Xv,this.normal)<0?-1:1,ir=A;if(!ir&&this.join==="miter"){var ur=tt;ur>this.miterLimit&&(ir=!0)}ir?(_.push(this.normal[0],this.normal[1],0),_.push(vt[0],vt[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,Object(cr.a)(this.lastFlip!==-kt?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),$p(Py,Zp),v.copy(this.normal,Py),_.push(this.normal[0],this.normal[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*kt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(p,_,a,vt,tt,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),kt=-1,v.copy(this.normal,vt),l+=2),this.lastFlip=kt}else{if($p(this.normal,Qs),x){var oe=v.create(),ce=v.create();v.sub(ce,Qs,this.normal),v.add(oe,Qs,this.normal),_.push(ce[0],ce[1],0),_.push(oe[0],oe[1],0),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),p.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(p,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function JI(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Es.a.flatten(e),a=i.vertices,o=i.dimensions,l=[],c=[],p=0;p<a.length/o;p++)o===2?l.push(a[p*2],a[p*2+1],1):l.push(a[p*3],a[p*3+1],1);var _=Es()(i.vertices,i.holes,i.dimensions);c.push.apply(c,Object(cr.a)(_));for(var x=function(){var I=i.vertices.slice(A*o,(A+1)*o),P=i.vertices.slice((A+1)*o,(A+2)*o);P.length===0&&(P=i.vertices.slice(0,o));var H=l.length/3;l.push(I[0],I[1],1,P[0],P[1],1,I[0],I[1],0,P[0],P[1],0),c.push.apply(c,Object(cr.a)([0,2,1,2,3,1].map(function(W){return W+H})))},A=0;A<n;A++)x();return{positions:l,index:c}}function e4(e){var r=Es.a.flatten(e),t=Es()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function K2(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Es.a.flatten(e),o=a.vertices,l=a.dimensions,c=[],p=[],_=[],x=0;x<o.length/l;x++)c.push(o[x*l],o[x*l+1],1,-1,-1),_.push(0,0,1);var A=Es()(a.vertices,a.holes,a.dimensions);p.push.apply(p,Object(cr.a)(A));for(var w=function(){var H=a.vertices.slice(I*l,(I+1)*l),W=a.vertices.slice((I+1)*l,(I+2)*l);W.length===0&&(W=a.vertices.slice(0,l));var oe=c.length/5;c.push(H[0],H[1],1,0,0,W[0],W[1],1,.1,0,H[0],H[1],0,0,.8,W[0],W[1],0,.1,.8);var ce=t4([W[0],W[1],1],[H[0],H[1],0],[H[0],H[1],1],r);_.push.apply(_,Object(cr.a)(ce).concat(Object(cr.a)(ce),Object(cr.a)(ce),Object(cr.a)(ce))),p.push.apply(p,Object(cr.a)([1,2,0,3,2,1].map(function(Oe){return Oe+oe})))},I=0;I<i;I++)w();return{positions:c,index:p,normals:_}}function t4(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=L.create(),a=L.create(),o=L.create();n&&(e=cn(e),r=cn(r),t=cn(t));var l=L.fromValues.apply(L,Object(cr.a)(e)),c=L.fromValues.apply(L,Object(cr.a)(r)),p=L.fromValues.apply(L,Object(cr.a)(t));L.sub(i,p,c),L.sub(a,l,c),L.cross(o,i,a);var _=L.create();return L.normalize(_,o),_}var Jc,lg=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),cg=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function fg(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(o){var l=Math.sin(o+Math.PI/4),c=Math.cos(o+Math.PI/4);return[l,c,0]});return a}function W_(){return fg(30)}function q2(){return fg(4)}function Q2(){return fg(3)}function J2(){return fg(6,1)}function eS(){return fg(5)}var $v=(Jc={},Object(V.a)(Jc,cg.CIRCLE,W_),Object(V.a)(Jc,cg.HEXAGON,J2),Object(V.a)(Jc,cg.TRIANGLE,Q2),Object(V.a)(Jc,cg.SQUARE,q2),Object(V.a)(Jc,cg.PENTAGON,eS),Object(V.a)(Jc,lg.CYLINDER,W_),Object(V.a)(Jc,lg.HEXAGONCOLUMN,J2),Object(V.a)(Jc,lg.TRIANGLECOLUMN,Q2),Object(V.a)(Jc,lg.SQUARECOLUMN,q2),Object(V.a)(Jc,lg.PENTAGONCOLUMN,eS),Jc),Iy={};function Dy(e){var r=gs(e.coordinates);return{vertices:[].concat(Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r)),indices:[0,1,2,2,3,0],size:r.length}}function tS(e){var r=gs(e.coordinates),t=$2(r);return{vertices:[].concat(Object(cr.a)(t),Object(cr.a)(t),Object(cr.a)(t),Object(cr.a)(t)),indices:[0,1,2,2,3,0],size:t.length}}function G_(e){var r=e.shape,t=u4(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function r4(e){var r=gs(e.coordinates);return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}function X_(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new QI({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],p=o[l];i.extrude_gaode2(c,p)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(A){i.extrude(A)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function MH(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r),[1,0,0],Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function n4(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=i4(r),i=n.results,a=n.totalDistance;return i.map(function(o){t.push(o[0],o[1],o[2],o[3],0,a)}),{vertices:t,indices:[],normals:[],size:6,count:i.length}}function PH(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=a4(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function rS(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function Yv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function i4(e){var r=e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=e.flat());var t=0;if(r.length<2)return{results:r,totalDistance:0};var n=[],i=Yv(r[0],t);n.push(i);for(var a=1;a<r.length-1;a++){var o=rS(r[a-1],r[a]);t+=o;var l=Yv(r[a],t);n.push(l),n.push(l)}var c=rS(r[r.length-2],r[r.length-1]);return t+=c,n.push(Yv(r[r.length-1],t)),{results:n,totalDistance:t}}function a4(e){if(e.length<2)return{results:e};var r=[],t=Yv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=Yv(e[n]);r.push(i),r.push(i)}return r.push(Yv(e[e.length-1])),{results:r}}function Z_(e){var r=e.coordinates,t=Es.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Es()(n,a,i),vertices:n,size:i}}function o4(e){var r=e.coordinates,t=Es.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Es()(n,a,i),vertices:s4(n),size:i+4}}function s4(e){for(var r=[],t=pu(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var o=e[a],l=e[a+1];r.push.apply(r,[o,l,0].concat(Object(cr.a)(n),[i]))}return r}function $_(e){var r=e.coordinates,t=K2(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function nS(e){var r=e.shape,t=c4(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function ky(e){var r=e.coordinates,t=[].concat(Object(cr.a)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],Object(cr.a)(r[1]),[0,1,0],Object(cr.a)(r[0]),[0,0,1],Object(cr.a)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Fy(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],o=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&o.push.apply(o,Object(cr.a)([0,1,2,1,3,2].map(function(x){return _*2+x})))},c=0;c<n;c++)l(c);return{vertices:a,indices:o,size:7}}function iS(e){var r=e.coordinates;r.length===2&&r.push(0);var t=By(-1,1),n=By(1,1),i=By(-1,-1),a=By(1,-1),o=[].concat(Object(cr.a)(r),Object(cr.a)(t),Object(cr.a)(r),Object(cr.a)(i),Object(cr.a)(r),Object(cr.a)(a),Object(cr.a)(r),Object(cr.a)(n)),l=[0,1,2,3,0,2];return{vertices:o,indices:l,size:5}}function u4(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Iy&&Iy[e])return Iy[e];var t=$v[e]?$v[e]():$v.cylinder(),n=K2([t],r);return Iy[e]=n,n}function IH(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,o,l,c=L.create(),p=L.create(),_=L.create(),x=0,A=r.length;x<A;x+=3){a=r[x+0]*3,o=r[x+1]*3,l=r[x+2]*3;var w=[e[a],e[a+1]],I=[e[o],e[o+1]],P=[e[l],e[l+1]];n&&(w=cn(w),I=cn(I),P=cn(P));var H=w,W=Object(hn.a)(H,2),oe=W[0],ce=W[1],Oe=L.fromValues(oe,ce,e[a+2]),Fe=I,je=Object(hn.a)(Fe,2),tt=je[0],vt=je[1],kt=L.fromValues(tt,vt,e[o+2]),ir=P,ur=Object(hn.a)(ir,2),Zr=ur[0],ln=ur[1],_n=L.fromValues(Zr,ln,e[l+2]);L.sub(c,_n,kt),L.sub(p,Oe,kt),L.cross(_,c,p),i[a]+=c[0],i[a+1]+=c[1],i[a+2]+=c[2],i[o]+=c[0],i[o+1]+=c[1],i[o+2]+=c[2],i[l]+=c[0],i[l+1]+=c[1],i[l+2]+=c[2]}return l4(i),i}function l4(e){for(var r=0,t=e.length;r<t;r+=3){var n=L.fromValues(e[r],e[r+1],e[r+2]),i=L.create();L.normalize(i,n),e.set(i,r)}}function DH(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function c4(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=$v[e]?$v[e]():$v.circle(),n=r.indexOf(e)===-1?e4([t]):JI([t]);return n}function By(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function kH(){var e=Y2(ug,{segments:X2}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function FH(){var e=Y2(ug+qI,{segments:X2}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function f4(e){var r=h4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p4=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,d4=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,v4=function(e){Object(Lt.a)(t,e);var r=f4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.baseColor,c=l===void 0?"rgb(16,16,16)":l,p=i.brightColor,_=p===void 0?"rgb(255,176,38)":p,x=i.windowColor,A=x===void 0?"rgb(30,60,89)":x,w=i.time,I=w===void 0?0:w,P=i.sweep,H=P===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:P;return{u_cityCenter:H.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*H.sweepRadius,u_circleSweep:H.enable?1:0,u_circleSweepColor:Ui(H.sweepColor).slice(0,3),u_circleSweepSpeed:H.sweepSpeed,u_opacity:o,u_baseColor:Ui(c),u_brightColor:Ui(_),u_windowColor:Ui(A),u_time:this.layer.getLayerAnimateTime()||I}}},{key:"calCityGeo",value:function(){var i=Object(hn.a)(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(c+o)/2]);var p=this.mapService.lngLatToCoord([l,c]),_=this.mapService.lngLatToCoord([a,o]);this.cityMinSize=Math.sqrt(Math.pow(p[0]-_[0],2)+Math.pow(p[1]-_[1],2))/4}else{var x=l-a,A=c-o;this.cityCenter=[(l+a)/2,(c+o)/2],this.cityMinSize=Math.sqrt(Math.pow(x,2)+Math.pow(A,2))/4}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:d4,fragmentShader:p4,triangulation:$_,depth:{enable:!0},cull:{enable:!0,face:Y.BACK}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?10:o;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ua);function m4(e){var r=g4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function g4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y4=function(e){Object(Lt.a)(t,e);var r=m4(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","CityBuildingLayer"),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new v4(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Xp);function _4(e){var r=b4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function b4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x4=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,E4=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,S4=function(e){Object(Lt.a)(t,e);var r=_4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:x4,fragmentShader:E4,triangulation:nS,primitive:Y.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ua);function A4(e){var r=T4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function T4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var C4=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,w4=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,O4=function(e){Object(Lt.a)(t,e);var r=A4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:C4,fragmentShader:w4,triangulation:G_,primitive:Y.TRIANGLES,depth:{enable:!0}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ua);function R4(e,r){for(var t=[],n=[],i=[],a=e+1,o=r+1,l=e/2,c=r/2,p=0;p<o;p++)for(var _=p-c,x=0;x<a;x++){var A=x-l;n.push(A/l,-_/c,0),i.push(x/e),i.push(1-p/r)}for(var w=0;w<r;w++)for(var I=0;I<e;I++){var P=I+a*w,H=I+a*(w+1),W=I+1+a*(w+1),oe=I+1+a*w;t.push(P,H,oe),t.push(H,W,oe)}return{vertices:n,indices:t,uvs:i}}var aS,oS;function M4(e){var r=P4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function P4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I4=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,D4=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,k4=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,F4=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,B4=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,L4=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,N4=fi.isEqual,sS=(aS=Object(Qr.injectable)(),aS(oS=function(e){Object(Lt.a)(t,e);var r=M4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"render",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.useFramebuffer,p=this.layer.getLayerConfig(),_=p.rampColors;c(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),N4(this.preRampColors,_)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w,I,P;return be.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return l=this.rendererService,c=l.createFramebuffer,p=l.getViewportSize,_=l.createTexture2D,x=this.styleAttributeService.getLayerStyleAttribute("shape"),A=(x==null||(o=x.scale)===null||o===void 0?void 0:o.field)||"heatmap",this.shapeType=A,W.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=W.sent,this.colorModel=A==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),w=p(),I=w.width,P=w.height,this.heatmapFramerBuffer=c({color:_({width:Math.floor(I/4),height:Math.floor(P/4),wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),depth:!1}),this.updateColorTexture(),W.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return W.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:wn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=iS,c.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:L4,fragmentShader:B4,triangulation:iS,depth:{enable:!1},cull:{enable:!0,face:eu(this.mapService.version)}});case 3:return o=c.sent,c.abrupt("return",o);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:F4,fs:k4});var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService,p=c.createAttribute,_=c.createElements,x=c.createBuffer,A=c.createModel;return A({vs:a,fs:o,attributes:{a_Position:p({buffer:x({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Y.FLOAT}),size:3}),a_Uv:p({buffer:x({data:[0,1,1,1,0,0,1,0],type:Y.FLOAT}),size:2})},uniforms:Object(ae.a)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:Y.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),o=a.opacity,l=a.intensity,c=l===void 0?10:l,p=a.radius,_=p===void 0?5:p;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:{u_opacity:o||1,u_radius:_,u_intensity:c},blend:{enable:!0,func:{srcRGB:Y.ONE,srcAlpha:1,dstRGB:Y.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(i){var a,o=this.layer.getLayerConfig(),l=o.opacity;(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,o=this.layer.getLayerConfig(),l=o.opacity,c=k.create();k.invert(c,this.cameraService.getViewProjectionMatrixUncentered()),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:Object(cr.a)(c)},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),o=a.width,l=a.height,c=R4(o/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:D4,fs:I4});var p=this.shaderModuleService.getModule("heatmap3dColor"),_=p.vs,x=p.fs,A=p.uniforms,w=this.rendererService,I=w.createAttribute,P=w.createElements,H=w.createBuffer,W=w.createModel;return W({vs:_,fs:x,attributes:{a_Position:I({buffer:H({data:c.vertices,type:Y.FLOAT}),size:3}),a_Uv:I({buffer:H({data:c.uvs,type:Y.FLOAT}),size:2})},primitive:Y.TRIANGLES,uniforms:Object(ae.a)({},A),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Y.SRC_ALPHA,srcAlpha:1,dstRGB:Y.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:P({data:c.indices,type:Y.UNSIGNED_INT,count:c.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),o=a.rampColors,l=Rc(o);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1}),this.preRampColors=o}}]),t}(Ua))||oS);function j4(e){var r=z4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function z4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U4=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,V4=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,H4=function(e){Object(Lt.a)(t,e);var r=j4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:V4,fragmentShader:U4,triangulation:nS,depth:{enable:!1},primitive:Y.TRIANGLES});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ua),W4={heatmap:sS,heatmap3d:sS,grid:S4,grid3d:O4,hexagon:H4},G4=W4;function X4(e){var r=Z4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Z4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $4=function(e){Object(Lt.a)(t,e);var r=X4(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","HeatMapLayer"),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new G4[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=this.getLayerConfig(),l=o.shape3d,c=this.getSource(),p=c.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":p==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":p==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}}]),t}(Xp);function Y4(e){var r=K4();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function K4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q4=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,Q4=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,J4=function(e){Object(Lt.a)(t,e);var r=Y4(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),x.next=5,o.data.images;case 5:return c=x.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,mag:Y.LINEAR,min:Y.LINEAR}),x.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:Q4,fragmentShader:q4,triangulation:ky,primitive:Y.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return p=x.sent,x.abrupt("return",[p]);case 11:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ua),e5={image:J4},t5=e5;function r5(e){var r=n5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function n5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uS=function(e){Object(Lt.a)(t,e);var r=r5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","ImageLayer"),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new t5[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Xp);function i5(e){var r=a5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function a5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o5=`varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;

  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,s5=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;
#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,u5=`
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,l5=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,c5=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,f5=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,h5={solid:0,dash:1},BH=fi.isNumber,p5=function(e){Object(Lt.a)(t,e);var r=i5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,_=p===void 0?"normal":p,x=i.lineType,A=x===void 0?"solid":x,w=i.dashArray,I=w===void 0?[10,5]:w,P=i.forward,H=P===void 0?!0:P,W=i.lineTexture,oe=W===void 0?!1:W,ce=i.iconStep,Oe=ce===void 0?100:ce,Fe=i.segmentNumber,je=Fe===void 0?30:Fe;I.length===2&&I.push(0,0);var tt=0,vt=[0,0,0,0],kt=[0,0,0,0];return l&&c&&(vt=Ui(l),kt=Ui(c),tt=1),this.rendererService.getDirty()&&this.texture.bind(),Object(ae.a)({u_textureBlend:_==="normal"?0:1,segmentNumber:je,u_line_type:h5[A||"solid"],u_dash_array:I,u_blur:.9,u_lineDir:H?1:-1,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:tt,u_sourceColor:vt,u_targetColor:kt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:o5,vert:s5,type:"Dash"}:a&&o?{frag:c5,vert:f5,type:"Linear"}:{frag:u5,vert:l5,type:""}}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),_=p.frag,x=p.vert,A=p.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:Fy,depth:{enable:!1},styleOption:{segmentNumber:c}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua);function d5(e){var r=v5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function v5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var m5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,g5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,y5=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,_5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,b5={solid:0,dash:1},x5=function(e){Object(Lt.a)(t,e);var r=d5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,x=i.dashArray,A=x===void 0?[10,5]:x,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,H=P===void 0?100:P,W=i.segmentNumber,oe=W===void 0?30:W,ce=i.globalArcHeight,Oe=ce===void 0?10:ce;A.length===2&&A.push(0,0);var Fe=0,je=[0,0,0,0],tt=[0,0,0,0];return a&&o&&(je=Ui(a),tt=Ui(o),Fe=1),this.rendererService.getDirty()&&this.texture.bind(),Object(ae.a)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:ug,u_global_height:Oe,u_textureBlend:c==="normal"?0:1,segmentNumber:oe,u_line_type:b5[_]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:H,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Fe,u_sourceColor:je,u_targetColor:tt},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:y5,vert:_5,type:"Linear"}:{frag:m5,vert:g5,type:""}}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),_=p.frag,x=p.vert,A=p.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:Fy,styleOption:{segmentNumber:c}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua);function E5(e){var r=S5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function S5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,T5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,C5=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,w5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,O5={solid:0,dash:1},R5=function(e){Object(Lt.a)(t,e);var r=E5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.textureBlend,_=p===void 0?"normal":p,x=i.lineType,A=x===void 0?"solid":x,w=i.dashArray,I=w===void 0?[10,5]:w,P=i.lineTexture,H=P===void 0?!1:P,W=i.iconStep,oe=W===void 0?100:W,ce=i.segmentNumber,Oe=ce===void 0?30:ce,Fe=i.globalArcHeight,je=Fe===void 0?10:Fe;I.length===2&&I.push(0,0);var tt=0,vt=[0,0,0,0],kt=[0,0,0,0];return l&&c&&(vt=Ui(l),kt=Ui(c),tt=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:ug,u_global_height:je,u_opacity:o,u_textureBlend:_==="normal"?0:1,segmentNumber:Oe,u_line_type:O5[A]||0,u_dash_array:I,u_texture:this.texture,u_line_texture:H?1:0,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:tt,u_sourceColor:vt,u_targetColor:kt}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:C5,vert:w5,type:"Linear"}:{frag:A5,vert:T5,type:""}}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,p=this.getShaders(),_=p.frag,x=p.vert,A=p.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+A,vertexShader:x,fragmentShader:_,triangulation:Fy,depth:{enable:!0},styleOption:{segmentNumber:c}});case 4:return w=P.sent,P.abrupt("return",[w]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua),lS={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},ql=1/2;function M5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,ql*e,1*e*n,-(a+ql)*e,1*e*n,(a-ql)*e,0,ql*e,1*e*n,-(a+ql)*e,1*e*n,(a-ql)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function P5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function I5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function D5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function k5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function F5(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,o=W_(),l=Es.a.flatten([o]),c=Es()(l.vertices,l.holes,l.dimensions),p=o.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat(Object(cr.a)(p),Object(cr.a)(p)),dimensions:2,indices:c.map(function(_){return _+o.length}),outLineIndices:c,normals:[].concat(Object(cr.a)(o.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),Object(cr.a)(new Array(o.length*3).fill(0)))}}function B5(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=Object(Ju.a)(t.source)==="object"?t.source.type:t.source,i=Object(Ju.a)(t.target)==="object"?t.target.type:t.target,a=Object(Ju.a)(t.source)==="object"?t.source:{},o=a.width,l=o===void 0?n?lS[n]:0:o,c=a.height,p=c===void 0?2:c,_=Object(Ju.a)(t.target)==="object"?t.target:{},x=_.width,A=x===void 0?i?lS[i]:0:x,w=_.height,I=w===void 0?2:w;return{vertices:[0,ql,1*l].concat(Object(cr.a)(e),[1,ql,-1*A],Object(cr.a)(e),[1,-ql,-1*A],Object(cr.a)(e),[0,-ql,1*l],Object(cr.a)(e),[0,ql,1*l],Object(cr.a)(e),[1,ql,-1*A],Object(cr.a)(e),[1,-ql,-1*A],Object(cr.a)(e),[0,-ql,1*l],Object(cr.a)(e)),outLineIndices:[0,1,2,0,2,3].map(function(P){return P+r}),indices:[4,5,6,4,6,7].map(function(P){return P+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function cS(e,r){var t=Object(Ju.a)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=Object(Ju.a)(e)==="object"?e:{};switch(t){case"circle":return F5(n,i);case"triangle":return P5(n,i);case"diamond":return D5(n,i);case"rect":return I5(n,i);case"classic":return k5(n,i);case"halfTriangle":return M5(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function L5(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r),[1,0,0],Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function N5(e,r){return r?j5(e,r):L5(e)}function j5(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,o=n.source,l=o===void 0?"circle":o,c=fS(cS(l,"source"),t,0,0),p=B5(t,c.vertices.length/7,r),_=fS(cS(a,"target"),t,1,c.vertices.length/7+p.vertices.length/7),x={vertices:[].concat(Object(cr.a)(c.vertices),Object(cr.a)(p.vertices),Object(cr.a)(_.vertices)),indices:[].concat(Object(cr.a)(c.outLineIndices),Object(cr.a)(p.outLineIndices),Object(cr.a)(_.outLineIndices),Object(cr.a)(c.indices),Object(cr.a)(p.indices),Object(cr.a)(_.indices)),normals:[].concat(Object(cr.a)(c.normals),Object(cr.a)(p.normals),Object(cr.a)(_.normals)),size:7};return x}function fS(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,o=e.indices,l=e.dimensions,c=e.outLineIndices,p=0;p<a.length;p+=l)i.push.apply(i,[t,a[p+1],a[p]].concat(Object(cr.a)(r)));return Object(ae.a)(Object(ae.a)({},e),{},{vertices:i,indices:o.map(function(_){return _+n}),outLineIndices:c.map(function(_){return _+n})})}function z5(e){var r=U5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V5=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,H5=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,W5=function(e){Object(Lt.a)(t,e);var r=z5(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,o=a===void 0?2:a,l=i.strokeWidth,c=l===void 0?1:l,p=i.stroke,_=p===void 0?"#000":p,x=i.strokeOpacity,A=x===void 0?1:x;return Object(ae.a)({u_gap_width:o,u_stroke_width:c,u_stroke:Ui(_),u_stroke_opacity:A},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:H5,fragmentShader:V5,inject:this.getInject(),triangulation:N5,styleOption:this.layer.getLayerConfig().symbol,primitive:Y.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(a,o,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}})}}]),t}(Ua);function G5(e){var r=X5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function X5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
     gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,$5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,Y5={solid:0,dash:1},K5=function(e){Object(Lt.a)(t,e);var r=G5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,x=i.dashArray,A=x===void 0?[10,5]:x,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,H=P===void 0?100:P,W=i.segmentNumber,oe=W===void 0?30:W;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ce=0,Oe=[0,0,0,0],Fe=[0,0,0,0];return a&&o&&(Oe=Ui(a),Fe=Ui(o),ce=1),Object(ae.a)({u_textureBlend:c==="normal"?0:1,segmentNumber:oe,u_line_type:Y5[_]||0,u_dash_array:A,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:H,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ce,u_sourceColor:Oe,u_targetColor:Fe},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,x.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:$5,fragmentShader:Z5,triangulation:Fy,styleOption:{segmentNumber:c},inject:this.getInject(),depth:{enable:!1}});case 3:return p=x.sent,x.abrupt("return",[p]);case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:wn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua),LH=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),Ly=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),q5=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),Y_=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),NH=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function Q5(e){var r=J5();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function J5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eD=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,tD=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));
  
 float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,rD=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_strokeWidth: 0.0;

uniform vec3 u_blur;
varying vec4 v_color;
varying vec4 v_stroke;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        gl_FragColor.rgb = mix(v_stroke.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,hS=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_stroke;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,nD=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,iD={solid:0,dash:1},pS=function(e){Object(Lt.a)(t,e);var r=Q5(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"textureEventFlag",!1),Object(V.a)(Object(Be.a)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1,height:1})),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.lineType,_=p===void 0?"solid":p,x=i.dashArray,A=x===void 0?[10,5,0,0]:x,w=i.lineTexture,I=w===void 0?!1:w,P=i.iconStep,H=P===void 0?100:P,W=i.vertexHeightScale,oe=W===void 0?20:W,ce=i.strokeWidth,Oe=ce===void 0?0:ce,Fe=i.raisingHeight,je=Fe===void 0?0:Fe,tt=i.heightfixed,vt=tt===void 0?!1:tt,kt=i.linearDir,ir=kt===void 0?Ly.VERTICAL:kt,ur=i.blur,Zr=ur===void 0?[1,1,1]:ur;A.length===2&&A.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var ln=0,_n=[0,0,0,0],Hi=[0,0,0,0];return a&&o&&(_n=Ui(a),Hi=Ui(o),ln=1),Object(ae.a)({u_textureBlend:c===q5.NORMAL?0:1,u_line_type:iD[_],u_dash_array:A,u_blur:Zr,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:H,u_textSize:[1024,this.iconService.canvasHeight||128],u_strokeWidth:Oe,u_linearDir:ir===Ly.VERTICAL?1:0,u_linearColor:ln,u_sourceColor:_n,u_targetColor:Hi,u_heightfixed:Number(vt),u_vertexScale:oe,u_raisingHeight:Number(je)},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!1:l,p=this.getShaders(),_=p.frag,x=p.vert,A=p.type,this.layer.triangulation=to,P.next=5,this.layer.buildLayerModel({moduleName:"line"+A,vertexShader:x,fragmentShader:_,triangulation:to,inject:this.getInject(),depth:{enable:c}});case 5:return w=P.sent,P.abrupt("return",[w]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:eD,vert:tD,type:"Dash"}:a&&o?{frag:nD,vert:hS,type:"Linear"}:{frag:rD,vert:hS,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:wn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o,l,c,p,_,x){return x===void 0?[c[3],10]:[c[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,l,c,p,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua);function aD(e){var r=oD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function oD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sD=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,uD=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,jH=fi.isNumber,lD=function(e){Object(Lt.a)(t,e);var r=aD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var c=n.layer.getLayerConfig(),p=c.rampColors,_=Rc(p);n.colorTexture=l({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.NEAREST,mag:Y.NEAREST,flipY:!1})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.vertexHeightScale,c=l===void 0?20:l,p=i.raisingHeight,_=p===void 0?0:p,x=i.heightfixed,A=x===void 0?!1:x,w=i.linearDir,I=w===void 0?Ly.VERTICAL:w;return this.rendererService.getDirty()&&this.colorTexture.bind(),Object(ae.a)({u_linearDir:I===Ly.VERTICAL?1:0,u_texture:this.colorTexture,u_heightfixed:Number(A),u_vertexScale:c,u_raisingHeight:Number(_)},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!1:l,this.layer.triangulation=X_,x.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:uD,fragmentShader:sD,triangulation:X_,inject:this.getInject(),depth:{enable:c}});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:wn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l,c,p,_){return _===void 0?[l[3],10]:[l[3],_]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a,o,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a,o,l){return[l[4]]}}})}}]),t}(Ua);function cD(e){var r=fD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function fD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hD=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,pD=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
varying vec4 v_color;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,dS=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,zH=fi.isNumber,dD=function(e){Object(Lt.a)(t,e);var r=cD(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,p=i.vertexHeightScale,_=p===void 0?20:p,x=0,A=[0,0,0,0],w=[0,0,0,0];return l&&c&&(A=Ui(l),w=Ui(c),x=1),Object(ae.a)({u_linearColor:x,u_sourceColor:A,u_targetColor:w,u_vertexScale:_},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:pD,vert:dS,type:"lineSimpleLinear"}:{frag:hD,vert:dS,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,p=o.type,A.next=3,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,triangulation:n4,inject:this.getInject(),primitive:Y.LINES,depth:{enable:!1},pick:!1});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:wn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a,o,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a,o,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),t}(Ua);function vD(e){var r=mD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function mD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gD=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,yD=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,_D=function(e){Object(Lt.a)(t,e);var r=vD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.NEAREST,min:Y.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,p=i.heightfixed,_=p===void 0?!1:p,x=i.lineTexture,A=x===void 0?!1:x,w=i.iconStep,I=w===void 0?100:w,P=i.iconStepCount,H=P===void 0?1:P;this.rendererService.getDirty()&&this.texture.bind();var W=0,oe=[0,0,0,0],ce=[0,0,0,0];return a&&o&&(oe=Ui(a),ce=Ui(o),W=1),Object(ae.a)({u_heightfixed:Number(_),u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:A?1:0,u_iconStepCount:H,u_icon_step:I,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:W,u_sourceColor:oe,u_targetColor:ce},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:yD,fragmentShader:gD,triangulation:X_,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:wn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,l,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:wn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,l,c,p,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:wn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,p=l[c]||{x:0,y:0},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua),bD={arc:p5,arc3d:x5,greatcircle:K5,wall:_D,line:pS,simple:dD,linearline:lD,earthArc3d:R5,flowline:W5},xD=bD;function ED(e){var r=SD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function SD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K_=function(e){Object(Lt.a)(t,e);var r=ED(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","LineLayer"),Object(V.a)(Object(Be.a)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","thetaOffset"]),Object(V.a)(Object(Be.a)(n),"arrowInsertCount",0),Object(V.a)(Object(Be.a)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new xD[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(o){if(Array.isArray(o.coordinates)&&Array.isArray(o.coordinates[0])&&Array.isArray(o.coordinates[0][0])){var l=Object(ae.a)({},o);o.coordinates.map(function(c){a.push(Object(ae.a)(Object(ae.a)({},l),{},{coordinates:c}))})}else a.push(o)}),a}}]),t}(Xp);function AD(e){var r=TD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function TD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CD=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,wD=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function vS(e){var r=e.coordinates;return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}var OD=function(e){Object(Lt.a)(t,e);var r=AD(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,p=i.blend,_=i.strokeOpacity,x=_===void 0?1:_,A=i.strokeWidth,w=A===void 0?0:A,I=i.stroke,P=I===void 0?"#fff":I;return{u_additive:p==="additive"?1:0,u_opacity:o,u_offsets:c,u_stroke_opacity:x,u_stroke_width:w,u_stroke_color:Ui(P)}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=vS,c.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:wD,fragmentShader:CD,triangulation:vS,depth:{enable:!1},primitive:Y.POINTS});case 3:return o=c.sent,c.abrupt("return",[o]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ua);function RD(e){var r=MD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function MD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PD=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ID=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,DD=fi.isNumber,kD=function(e){Object(Lt.a)(t,e);var r=RD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"raiseCount",0),Object(V.a)(Object(Be.a)(n),"raiseRepeat",0),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,p=i.sourceColor,_=i.targetColor,x=i.pickLight,A=x===void 0?!1:x,w=i.heightfixed,I=w===void 0?!1:w,P=i.opacityLinear,H=P===void 0?{enable:!1,dir:"up"}:P,W=i.lightEnable,oe=W===void 0?!0:W,ce=0,Oe=[0,0,0,0],Fe=[0,0,0,0];if(p&&_&&(Oe=Ui(p),Fe=Ui(_),ce=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var je=o.speed,tt=je===void 0?.01:je;this.raiseCount+=tt,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(A),u_heightfixed:Number(I),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:DD(c)?c:1,u_linearColor:ce,u_sourceColor:Oe,u_targetColor:Fe,u_opacitylinear:Number(H.enable),u_opacitylinear_dir:H.dir==="up"?1:0,u_lightEnable:Number(oe)}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.animateOption.repeat,c=l===void 0?1:l,this.raiseRepeat=c,x.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:ID,fragmentShader:PD,triangulation:G_,depth:{enable:!0},cull:{enable:!0,face:eu(this.mapService.version)},blend:this.getBlend()});case 4:return p=x.sent,x.abrupt("return",[p]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=a.size;if(o){var l=[];return Array.isArray(o)&&(l=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(l=[o,o,o]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:wn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=gs(a.coordinates);return $2([o[0],o[1]])}}})}}]),t}(Ua);function FD(e){var r=BD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function BD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LD=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,ND=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,jD=function(e){Object(Lt.a)(t,e);var r=FD(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.strokeOpacity,c=l===void 0?1:l,p=i.strokeWidth,_=p===void 0?0:p,x=i.stroke,A=x===void 0?"rgba(0,0,0,0)":x,w=i.blend,I=i.blur,P=I===void 0?0:I;return{u_blur:P,u_additive:w==="additive"?1:0,u_opacity:o,u_stroke_opacity:c,u_stroke_width:_,u_stroke_color:Ui(A)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=tS,c.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:ND,fragmentShader:LD,triangulation:tS,depth:{enable:!0},blend:this.getBlend()});case 3:return o=c.sent,c.abrupt("return",[o]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,l,c,p){var _=Object(hn.a)(c,3),x=_[0],A=_[1],w=_[2],I=L.fromValues(0,0,1),P=L.fromValues(x,0,w),H=x>=0?L.angle(I,P):Math.PI*2-L.angle(I,P),W=Math.PI*2-Math.asin(A/100),oe=k.create();k.rotateY(oe,oe,H),k.rotateX(oe,oe,W);var ce=L.fromValues(1,1,0);L.transformMat4(ce,ce,oe),L.normalize(ce,ce);var Oe=L.fromValues(-1,1,0);L.transformMat4(Oe,Oe,oe),L.normalize(Oe,Oe);var Fe=L.fromValues(-1,-1,0);L.transformMat4(Fe,Fe,oe),L.normalize(Fe,Fe);var je=L.fromValues(1,-1,0);L.transformMat4(je,je,oe),L.normalize(je,je);var tt=[].concat(Object(cr.a)(ce),Object(cr.a)(Oe),Object(cr.a)(Fe),Object(cr.a)(je)),vt=p%4*3;return[tt[vt],tt[vt+1],tt[vt+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.shape,c=l===void 0?2:l,p=i.layer.getLayerConfig().shape2d,_=p.indexOf(c);return[_]}}})}}]),t}(Ua);function zD(e){var r=UD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function UD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VD=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,HD=`#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,mS=function(e){Object(Lt.a)(t,e);var r=zD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"raiseCount",0),Object(V.a)(Object(Be.a)(n),"raiseRepeat",0),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Object(ae.a)(Object(ae.a)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,c=i.targetColor,p=i.pickLight,_=p===void 0?!1:p,x=i.heightfixed,A=x===void 0?!1:x,w=i.opacityLinear,I=w===void 0?{enable:!1,dir:"up"}:w,P=i.lightEnable,H=P===void 0?!0:P,W=0,oe=[0,0,0,0],ce=[0,0,0,0];if(l&&c&&(oe=Ui(l),ce=Ui(c),W=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var Oe=o.speed,Fe=Oe===void 0?.01:Oe;this.raiseCount+=Fe,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var je={u_pickLight:Number(_),u_heightfixed:Number(A),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:W,u_sourceColor:oe,u_targetColor:ce,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(H)},tt=this.getUniformsBufferInfo(je);return tt}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!0:l,p=o.animateOption.repeat,_=p===void 0?1:p,this.raiseRepeat=_,this.initUniformsBuffer(),w.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:HD,fragmentShader:VD,triangulation:G_,inject:this.getInject(),cull:{enable:!0,face:eu(this.mapService.version)},depth:{enable:c}});case 5:return x=w.sent,w.abrupt("return",[x]);case 7:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",shaderLocation:Hs.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=a.size;if(o){var l=[];return Array.isArray(o)&&(l=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(l=[o,o,o]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",shaderLocation:Hs.NORMAL,buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Hs.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a){var o=gs(a.coordinates);return[o[0],o[1],0]}}})}}]),t}(Ua);function WD(e){var r=GD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function GD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gS=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,XD=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,q_=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 10) in float a_Shape;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,yS=function(e){Object(Lt.a)(t,e);var r=WD(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,o=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,p=i.blend,_=i.blur,x=_===void 0?0:_,A=i.raisingHeight,w=A===void 0?0:A,I=i.heightfixed,P=I===void 0?!1:I,H=i.unit,W=H===void 0?"pixel":H,oe=Object(ae.a)({u_blur_height_fixed:[x,Number(w),Number(P)],u_additive:p==="additive"?1:0,u_stroke_opacity:o,u_stroke_width:c,u_size_unit:Y_[W]},this.getStyleAttribute()),ce=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(ce.u_stroke),Object(cr.a)(ce.u_offsets),[ce.u_opacity,ce.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(oe.u_blur_height_fixed),[oe.u_stroke_width,oe.u_stroke_opacity,oe.u_additive,oe.u_size_unit])).buffer)}),oe}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ds)}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w,I,P;return be.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return o=this.layer.getLayerConfig(),l=o.animateOption,c=l===void 0?{enable:!1}:l,p=this.getShaders(c),_=p.frag,x=p.vert,A=p.type,this.layer.triangulation=ds,w=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),I=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),this.uniformBuffers.push(w,I),W.next=8,this.layer.buildLayerModel({moduleName:A,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:ds,depth:{enable:!1}});case 8:return P=W.sent,W.abrupt("return",[P]);case 10:case"end":return W.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:gS,vert:q_,type:"pointWave"};default:return{frag:gS,vert:q_,type:"pointWave"}}else return{frag:XD,vert:q_,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Hs.EXTRUDE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,l,c,p){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",shaderLocation:Hs.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:wn.Attribute,descriptor:{name:"a_Shape",shaderLocation:Hs.SHAPE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.shape,c=l===void 0?2:l,p=i.indexOf(c);return[p]}}})}}]),t}(Ua);function ZD(e){var r=$D();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function $D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YD=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,KD=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,qD=function(e){Object(Lt.a)(t,e);var r=ZD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"meter2coord",1),Object(V.a)(Object(Be.a)(n),"isMeter",!1),Object(V.a)(Object(Be.a)(n),"radian",0),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,p=i.unit,_=p===void 0?"pixel":p;return this.rendererService.getDirty()&&this.texture.bind(),Object(ae.a)({u_raisingHeight:Number(o),u_heightfixed:Number(c),u_size_unit:Y_[_],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Dy)}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:KD,fragmentShader:YD,triangulation:Dy,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:eu(this.mapService.version)}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.shape,p=l[c]||{x:-64,y:-64},_=p.x,x=p.y;return[_,x]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(o,l,c,p){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=p%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}})}}]),t}(Ua);function QD(e){var r=JD();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function JD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ek=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,tk=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,_S=function(e){Object(Lt.a)(t,e);var r=QD(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:Y.LINEAR,min:Y.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l;return this.rendererService.getDirty()&&this.texture.bind(),Object(ae.a)({u_raisingHeight:Number(o),u_heightfixed:Number(c),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:tk,fragmentShader:ek,triangulation:r4,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.shape,p=l[c]||{x:-64,y:-64},_=p.x,x=p.y;return[_,x]}}})}}]),t}(Ua);function rk(e){var r=nk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function nk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ik=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,ak=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function bS(e){var r=e.coordinates;return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}var xS=function(e){Object(Lt.a)(t,e);var r=rk(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(i.u_stroke),Object(cr.a)(i.u_offsets),[i.u_opacity,i.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([.5]).buffer)}),Object(ae.a)({u_size_scale:.5},i)}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.layer.triangulation=bS,o=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),l=this.rendererService.createBuffer({data:new Float32Array(4),isUBO:!0}),this.uniformBuffers.push(o,l),_.next=6,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:ak,fragmentShader:ik,triangulation:bS,inject:this.getInject(),depth:{enable:!1},primitive:Y.POINTS,pick:!1});case 6:return c=_.sent,_.abrupt("return",[c]);case 8:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",shaderLocation:Hs.SIZE,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ua);function ok(e){var r=sk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function sk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uk=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,lk=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,ck=function(e){Object(Lt.a)(t,e);var r=ok(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.blend,c=i.speed,p=c===void 0?1:c,_=i.unit,x=_===void 0?"pixel":_;return{u_size_unit:Y_[x],u_speed:p,u_additive:l==="additive"?1:0,u_opacity:o}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Dy)}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:lk,fragmentShader:uk,triangulation:Dy,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:wn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c){var p=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=c%4*3;return[p[_],p[_+1],p[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?5:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ua);function fk(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hk(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function hk(e,r){if(!!e){if(typeof e=="string")return ES(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ES(e,r)}}function ES(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var pk=function(){function e(r,t,n){Object(et.a)(this,e),Object(V.a)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return Object(De.a)(e,[{key:"insert",value:function(t,n,i,a,o){this.forEachCell(n,i,a,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o)}},{key:"query",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!1,o)}},{key:"hitTest",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!0,o)}},{key:"insertBoxCell",value:function(t,n,i,a,o,l){this.boxCells[o].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,o,l){if(i<0||t>this.width||a<0||n>this.height)return o?!1:[];var c=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var p=0;p<this.boxKeys.length;p++)c.push({key:this.boxKeys[p],x1:this.bboxes[p*4],y1:this.bboxes[p*4+1],x2:this.bboxes[p*4+2],y2:this.bboxes[p*4+3]});return l?c.filter(l):c}var _={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,c,_,l),o?c.length>0:c}},{key:"queryCell",value:function(t,n,i,a,o,l,c,p){var _=c.seenUids,x=this.boxCells[o];if(x!==null){var A=this.bboxes,w=fk(x),I;try{for(w.s();!(I=w.n()).done;){var P=I.value;if(!_.box[P]){_.box[P]=!0;var H=P*4;if(t<=A[H+2]&&n<=A[H+3]&&i>=A[H+0]&&a>=A[H+1]&&(!p||p(this.boxKeys[P]))){if(c.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[P],x1:A[H],y1:A[H+1],x2:A[H+2],y2:A[H+3]})}}}}catch(W){w.e(W)}finally{w.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,o,l,c,p){for(var _=this.convertToXCellCoord(t),x=this.convertToYCellCoord(n),A=this.convertToXCellCoord(i),w=this.convertToYCellCoord(a),I=_;I<=A;I++)for(var P=x;P<=w;P++){var H=this.xCellCount*P+I;if(o.call(this,t,n,i,a,H,l,c,p))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),dk=pk,vk=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new dk(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return Object(De.a)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,o)||this.grid.hitTest(n,i,a,o)?{box:[]}:{box:[n,i,a,o]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=U.fromValues(n,i,0,1),o=U.create(),l=k.fromValues.apply(k,Object(cr.a)(t));return U.transformMat4(o,a,l),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function SS(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=mk(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function mk(e,r){if(!!e){if(typeof e=="string")return AS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return AS(e,r)}}function AS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function TS(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function CS(e,r,t,n,i){if(!!i){var a=e[n],o=a.glyph;if(o)for(var l=r[o].advance*a.scale,c=(e[n].x+l)*i,p=t;p<=n;p++)e[p].x-=c}}function wS(e,r,t,n,i,a,o){var l=(r-t)*i,c=(-n*o+.5)*a,p=SS(e),_;try{for(p.s();!(_=p.n()).done;){var x=_.value;x.x+=l,x.y+=c}}catch(A){p.e(A)}finally{p.f()}}function gk(e,r,t,n,i,a,o){var l=-8,c=0,p=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=x.length;t.forEach(function(oe){if(oe.split("").forEach(function(Oe){var Fe=r[Oe],je=0;Fe&&(x.push({glyph:Oe,x:c,y:p+je,vertical:!1,scale:1,metrics:Fe}),c+=Fe.advance+o)}),x.length!==w){var ce=c-o;_=Math.max(ce,_),CS(x,r,w,x.length-1,A)}c=0,p-=n+5});var I=TS(i),P=I.horizontalAlign,H=I.verticalAlign;wS(x,A,P,H,_,n,t.length);var W=p-l;e.top+=-H*W,e.bottom=e.top-W,e.left+=-P*_,e.right=e.left+_}function yk(e,r,t,n,i,a,o){var l=-8,c=0,p=l,_=0,x=e.positionedGlyphs,A=a==="right"?1:a==="left"?0:.5,w=x.length;t.forEach(function(oe){var ce=r[oe],Oe=0;if(ce&&(x.push({glyph:oe,x:ce.advance/2,y:p+Oe,vertical:!1,scale:1,metrics:ce}),c+=ce.advance+o),x.length!==w){var Fe=c-o;_=Math.max(Fe,_),CS(x,r,w,x.length-1,A)}c=0,p-=n+5});var I=TS(i),P=I.horizontalAlign,H=I.verticalAlign;wS(x,A,P,H,_,n,t.length);var W=p-l;e.top+=-H*W,e.bottom=e.top-W,e.left+=-P*_,e.right=e.left+_}function _k(e,r,t,n,i,a){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),p=[],_={positionedGlyphs:p,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:c.length,text:e};return l?yk(_,r,c,t,n,i,a):gk(_,r,c,t,n,i,a),p.length?_:!1}function bk(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],o=SS(i),l;try{for(o.s();!(l=o.n()).done;){var c=l.value,p=c.metrics,_=4,x=p.advance*c.scale/2,A=t?[c.x+x,c.y]:[0,0],w=t?[0,0]:[c.x+x+r[0],c.y+r[1]],I=(0-_)*c.scale-x+w[0],P=(0-_)*c.scale+w[1],H=I+p.width*c.scale,W=P+p.height*c.scale,oe={x:I,y:P},ce={x:H,y:P},Oe={x:I,y:W},Fe={x:H,y:W};a.push({tl:oe,tr:ce,bl:Oe,br:Fe,tex:p,glyphOffset:A})}}catch(je){o.e(je)}finally{o.f()}return a}function xk(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ek(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Ek(e,r){if(!!e){if(typeof e=="string")return OS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OS(e,r)}}function OS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Sk(e){var r=Ak();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Ak(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RS=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,MS=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,hg=fi.isEqual;function PS(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,c){n.push.apply(n,Object(cr.a)(o).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],Object(cr.a)(o),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],Object(cr.a)(o),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],Object(cr.a)(o),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var IS=function(e){Object(Lt.a)(t,e);var r=Sk(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"glyphInfoMap",{}),Object(V.a)(Object(Be.a)(n),"currentZoom",-1),Object(V.a)(Object(Be.a)(n),"textureHeight",0),Object(V.a)(Object(Be.a)(n),"textCount",0),Object(V.a)(Object(Be.a)(n),"preTextStyle",{}),Object(V.a)(Object(Be.a)(n),"mapping",Object(Zt.a)(be.a.mark(function l(){return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return n.initGlyph(),n.updateTexture(),p.next=4,n.reBuildModel();case 4:case"end":return p.stop()}},l)}))),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,o=a===void 0?"#fff":a,l=i.strokeWidth,c=l===void 0?0:l,p=i.halo,_=p===void 0?.5:p,x=i.gamma,A=x===void 0?2:x,w=i.raisingHeight,I=w===void 0?0:w,P=this.getFontServiceMapping(),H=this.getFontServiceCanvas();return P&&Object.keys(P).length!==this.textCount&&H&&(this.updateTexture(),this.textCount=Object.keys(P).length),this.preTextStyle=this.getTextStyle(),Object(ae.a)({u_raisingHeight:Number(I),u_stroke_width:c,u_stroke_color:Ui(o),u_sdf_map:this.texture,u_halo_blur:_,u_gamma_scale:A,u_sdf_map_size:[(H==null?void 0:H.width)||1,(H==null?void 0:H.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.textAllowOverlap,c=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),c||this.filterGlyphs(),x.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:MS,fragmentShader:RS,inject:this.getInject(),triangulation:PS.bind(this),depth:{enable:!1}});case 6:return p=x.sent,x.abrupt("return",[p]);case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w,I,P,H,W;return be.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:if(o=this.getTextStyle(),l=o.textAllowOverlap,c=l===void 0?!1:l,p=o.textAnchor,_=p===void 0?"center":p,x=o.textOffset,A=o.padding,w=o.fontFamily,I=o.fontWeight,!(!hg(A,this.preTextStyle.padding)||!hg(x,this.preTextStyle.textOffset)||!hg(_,this.preTextStyle.textAnchor)||!hg(w,this.preTextStyle.fontFamily)||!hg(I,this.preTextStyle.fontWeight))){ce.next=5;break}return ce.next=4,this.mapping();case 4:return ce.abrupt("return",!0);case 5:if(!c){ce.next=7;break}return ce.abrupt("return",!1);case 7:if(P=this.mapService.getZoom(),H=this.mapService.getBounds(),W=Bc(this.extent,H),!(Math.abs(this.currentZoom-P)>.5||!W||c!==this.preTextStyle.textAllowOverlap)){ce.next=14;break}return ce.next=13,this.reBuildModel();case 13:return ce.abrupt("return",!0);case 14:return ce.abrupt("return",!1);case 15:case"end":return ce.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:wn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?12:o;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:wn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Zu(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,o=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var _=p.shape,x=_===void 0?"":_;x=x.toString();var A=xk(x),w;try{for(A.s();!(w=A.n()).done;){var I=w.value;c.indexOf(I)===-1&&c.push(I)}}catch(P){A.e(P)}finally{A.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:o,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,o=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(p){var _=p.shape,x=_===void 0?"":_;x="".concat(x),c.indexOf(x)===-1&&c.push(x)}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:o,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,p=i.textAllowOverlap,_=p===void 0?!1:p,x=i.padding,A=x===void 0?[0,0]:x,w=i.textAnchor,I=w===void 0?"center":w,P=i.textOffset,H=P===void 0?[0,0]:P,W=i.opacity,oe=W===void 0?1:W,ce=i.strokeOpacity,Oe=ce===void 0?1:ce,Fe=i.strokeWidth,je=Fe===void 0?0:Fe,tt=i.stroke,vt=tt===void 0?"#000":tt;return{fontWeight:o,fontFamily:c,textAllowOverlap:_,padding:A,textAnchor:I,textOffset:H,opacity:oe,strokeOpacity:Oe,strokeWidth:je,stroke:vt}}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),c=l.spacing,p=c===void 0?2:c,_=l.textAnchor,x=_===void 0?"center":_,A=l.textOffset,w=this.rawEncodeData;this.glyphInfo=w.map(function(I){var P=I.shape,H=P===void 0?"":P,W=I.id,oe=I.size,ce=oe===void 0?1:oe,Oe=I.textOffset?I.textOffset:A||[0,0],Fe=I.textAnchor?I.textAnchor:x||"center",je=_k(H.toString(),o,ce,Fe,"left",p,Oe,i),tt=bk(je,Oe,!1);return I.shaping=je,I.glyphQuads=tt,I.centroid=gs(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?gs(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[W]={shaping:je,glyphQuads:tt,centroid:gs(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(c,"_").concat(o))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(c,"_").concat(o))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,l=o===void 0?[0,0]:o,c=a.textAllowOverlap,p=c===void 0?!1:c;if(!p){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),x=_.width,A=_.height,w=new vk(x,A),I=this.glyphInfo.filter(function(P){var H=P.shaping,W=P.id,oe=W===void 0?0:W,ce=P.version==="GAODE2.x"?P.originCentroid:P.centroid,Oe=P.size,Fe=Oe/16,je=i.mapService.lngLatToContainer(ce),tt=w.placeCollisionBox({x1:H.left*Fe-l[0],x2:H.right*Fe+l[0],y1:H.top*Fe-l[1],y2:H.bottom*Fe+l[1],anchorPointX:je.x,anchorPointY:je.y}),vt=tt.box;return vt&&vt.length?(w.insertCollisionBox(vt,oe),!0):!1});I.forEach(function(P){i.glyphInfoMap[P.id]=P})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Y.LINEAR,min:Y.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.filterGlyphs(),c.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:MS,fragmentShader:RS,triangulation:PS.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:o=c.sent,this.layer.models=[o];case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ua),Tk={fillImage:qD,fill:yS,radar:ck,image:_S,normal:xS,simplePoint:OD,extrude:mS,text:IS,earthFill:jD,earthExtrude:kD},Ck=Tk;function wk(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ok(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Ok(e,r){if(!!e){if(typeof e=="string")return DS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return DS(e,r)}}function DS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Rk(e){var r=Mk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Mk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ny=function(e){Object(Lt.a)(t,e);var r=Rk(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","PointLayer"),Object(V.a)(Object(Be.a)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),Object(V.a)(Object(Be.a)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),Object(V.a)(Object(Be.a)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new Ck[o](this),c.next=5,this.initLayerModels();case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,o=i.values,l=this.getLayerConfig(),c=l.shape2d,p=this.iconService.getIconMap();if(a&&(c==null?void 0:c.indexOf(a))!==-1)return"fill";if(o==="text")return"text";if(o&&o instanceof Array){var _=wk(o),x;try{for(_.s();!(x=_.n()).done;){var A=x.value;if(typeof A=="string"&&p.hasOwnProperty(A))return"image"}}catch(w){_.e(w)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=a.shape3d,c=a.billboard,p=c===void 0?!0:c,_=this.iconService.getIconMap(),x=i.find(function(w){return w.hasOwnProperty("shape")});if(x){var A=x.shape;return A==="dot"?"normal":A==="simple"?"simplePoint":A==="radar"?"radar":this.layerType==="fillImage"||p===!1?"fillImage":(o==null?void 0:o.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(A))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(A)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Xp);function Pk(e){var r=Ik();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Ik(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dk=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,kk=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,Fk=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Bk=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,Lk=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,Nk=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,jk=function(e){Object(Lt.a)(t,e);var r=Pk(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,o=a===void 0?!1:a,l=i.raisingHeight,c=l===void 0?0:l,p=i.topsurface,_=p===void 0?!0:p,x=i.sidesurface,A=x===void 0?!0:x,w=i.sourceColor,I=i.targetColor,P=0,H=[1,1,1,1],W=[1,1,1,1];return w&&I&&(H=Ui(w),W=Ui(I),P=1),Object(ae.a)({u_topsurface:Number(_),u_sidesurface:Number(A),u_heightfixed:Number(o),u_raisingHeight:Number(c),u_linearColor:P,u_sourceColor:H,u_targetColor:W,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,p=o.type,A.next=3,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:$_});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,o=i.mapTexture;return o?{frag:Fk,vert:Bk,type:"polygonExtrudeTexture"}:a?{frag:Lk,vert:Nk,type:"polygonExtrudePickLight"}:{frag:Dk,vert:kk,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,o=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],c=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var p=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],o),_=Object(hn.a)(p,2),x=_[0],A=_[1],w=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],o),I=Object(hn.a)(w,2),P=I[0],H=I[1];l=P-x,c=H-A,a=[x,A,P,H]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:wn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(oe,ce,Oe){var Fe=Oe[0],je=Oe[1];return[(Fe-a[0])/l,(je-a[1])/c,Oe[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(oe,ce,Oe,Fe,je){return je}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(oe){var ce=oe.size,Oe=ce===void 0?10:ce;return Array.isArray(Oe)?[Oe[0]]:[Oe]}}})}},{key:"loadTexture",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o=this,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l=this.layer.getLayerConfig(),c=l.mapTexture,p=this.rendererService.createTexture2D,this.texture=p({height:0,width:0}),!c){x.next=5;break}return x.abrupt("return",new Promise(function(A,w){var I=new Image;I.crossOrigin="anonymous",I.src=c,I.onload=function(){return o.texture=p({data:I,width:I.width,height:I.height,wrapS:Y.CLAMP_TO_EDGE,wrapT:Y.CLAMP_TO_EDGE,min:Y.LINEAR,mag:Y.LINEAR}),A(null)},I.onerror=function(){w(new Error("image load error"))}}));case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ua);function zk(e){var r=Uk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Uk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vk=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Hk=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,Wk=function(e){Object(Lt.a)(t,e);var r=zk(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){return Object(ae.a)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,p=o.type,A.next=3,this.layer.buildLayerModel({moduleName:p,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:$_});case 3:return _=A.sent,A.abrupt("return",[_]);case 5:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:Vk,vert:Hk,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:wn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(a,o,l,c,p){return p}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:wn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?10:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ua);function Gk(e){var r=Xk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Xk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zk=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$k=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,Yk=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,Kk=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,qk=function(e){Object(Lt.a)(t,e);var r=Gk(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l;return Object(ae.a)({u_raisingHeight:Number(o),u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return o=this.getModelParams(),l=o.frag,c=o.vert,p=o.triangulation,_=o.type,this.layer.triangulation=p,w.next=4,this.layer.buildLayerModel({moduleName:_,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:p,primitive:Y.TRIANGLES,depth:{enable:!1}});case 4:return x=w.sent,w.abrupt("return",[x]);case 6:case"end":return w.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1,dir:"in"}:a;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:wn.Attribute,descriptor:{name:"a_linear",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:3,update:function(c,p,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1}:a;return o.enable?{frag:$k,vert:Yk,type:"polygonLinear",triangulation:o4}:{frag:Zk,vert:Kk,type:"polygonFill",triangulation:ia}}}]),t}(Ua);function Qk(e){var r=Jk();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function Jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eF=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,tF=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,rF=fi.isNumber,nF=function(e){Object(Lt.a)(t,e);var r=Qk(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.watercolor,c=l===void 0?"#6D99A8":l,p=i.watercolor2,_=p===void 0?"#0F121C":p;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:Ui(c),u_watercolor2:Ui(_),u_opacity:rF(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:tF,fragmentShader:eF,triangulation:Z_,primitive:Y.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,o;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(o=this.texture3)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Object(hn.a)(i,4),o=a[0],l=a[1],c=a[2],p=a[3],_=c-o,x=p-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:wn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,H){var W=w.version==="GAODE2.x"?w.originCoordinates[0][H]:P,oe=Object(hn.a)(W,2),ce=oe[0],Oe=oe[1];return[(ce-o)/_,(Oe-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=a(o),this.texture2=a(o),this.texture3=a(o),l(function(p){i.texture1=c(p[0]),i.texture2=c(p[1]),i.texture3=c(p[2]),i.layerService.reRender()});function l(p){var _=0,x=[],A=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];A.map(function(w){var I=new Image;I.crossOrigin="",I.src=w,x.push(I),I.onload=function(){_++,_===3&&p(x)}})}function c(p){return a({data:p,width:p.width,height:p.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR})}}}]),t}(Ua);function iF(e){var r=aF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function aF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oF=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,sF=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,uF=fi.isNumber,lF=function(e){Object(Lt.a)(t,e);var r=iF(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.speed,c=l===void 0?.5:l;return{u_texture:this.texture,u_speed:c,u_opacity:uF(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:sF,fragmentShader:oF,triangulation:Z_,primitive:Y.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Object(hn.a)(i,4),o=a[0],l=a[1],c=a[2],p=a[3],_=c-o,x=p-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:wn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Y.STATIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(w,I,P,H){var W=w.version==="GAODE2.x"?w.originCoordinates[0][H]:P,oe=Object(hn.a)(W,2),ce=oe[0],Oe=oe[1];return[(ce-o)/_,(Oe-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var c=new Image;c.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),c.src=o):c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Y.MIRRORED_REPEAT,wrapT:Y.MIRRORED_REPEAT,min:Y.LINEAR,mag:Y.LINEAR}),i.layerService.reRender()}}}]),t}(Ua),cF={fill:qk,line:pS,extrude:jk,text:IS,point_fill:yS,point_image:_S,point_normal:xS,point_extrude:mS,water:lF,ocean:nF,extrusion:Wk},fF=cF;function hF(e){var r=pF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function pF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jy=function(e){Object(Lt.a)(t,e);var r=hF(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","PolygonLayer"),Object(V.a)(Object(Be.a)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new fF[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o==="fill"||!o?"fill":o==="extrude"?"extrude":o==="extrusion"?"extrusion":o==="water"?"water":o==="ocean"?"ocean":o==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=a.shape3d,c=this.iconService.getIconMap(),p=i.find(function(x){return x.hasOwnProperty("shape")});if(p){var _=p.shape;return _==="dot"?"point_normal":(o==null?void 0:o.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":c.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),t}(Xp);function dF(e){var r=vF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function vF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mF=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,gF=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,kS=function(e){Object(Lt.a)(t,e);var r=dF(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.clampLow,c=l===void 0?!0:l,p=i.clampHigh,_=p===void 0?!0:p,x=i.noDataValue,A=x===void 0?-9999999:x,w=i.domain,I=i.rampColors,P=w||wh(I);return this.colorTexture=this.layer.textureService.getColorTexture(I,P),{u_opacity:o||1,u_texture:this.texture,u_domain:P,u_clampLow:c,u_clampHigh:typeof _!="undefined"?_:c,u_noDataValue:A,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!Array.isArray(o.data)){A.next=4;break}return A.abrupt("return",{data:o.data,width:o.width,height:o.height});case 4:return A.next=6,o.data;case 6:return l=A.sent,c=l.rasterData,p=l.width,_=l.height,A.abrupt("return",{data:Array.from(c),width:p,height:_});case 11:case"end":return A.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,c=o.data.dataArray[0],P.next=5,this.getRasterData(c);case 5:return p=P.sent,_=p.data,x=p.width,A=p.height,this.texture=l({data:_,width:x,height:A,format:Y.LUMINANCE,type:Y.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:gF,fragmentShader:mF,triangulation:ky,primitive:Y.TRIANGLES,depth:{enable:!1}});case 12:return w=P.sent,P.abrupt("return",[w]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ua),yF=["data"],_F=["rasterData"];function bF(e){var r=xF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function xF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EF=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,SF=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,AF=function(e){Object(Lt.a)(t,e);var r=bF(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"dataOption",{}),n}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.noDataValue,c=l===void 0?0:l,p=this.dataOption,_=p.rMinMax,x=p.gMinMax,A=p.bMinMax;return{u_opacity:o||1,u_texture:this.texture,u_noDataValue:c,u_rminmax:_,u_gminmax:x,u_bminmax:A}}},{key:"getRasterData",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(!Array.isArray(o.data)){w.next=4;break}return l=o.data,c=Object(vh.a)(o,yF),this.dataOption=c,w.abrupt("return",Object(ae.a)({data:l},c));case 4:return w.next=6,o.data;case 6:if(p=w.sent,_=p.rasterData,x=Object(vh.a)(p,_F),this.dataOption=x,!Array.isArray(_)){w.next=14;break}return w.abrupt("return",Object(ae.a)({data:_},x));case 14:return w.abrupt("return",Object(ae.a)({data:Array.from(_)},x));case 15:case"end":return w.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,c=o.data.dataArray[0],P.next=5,this.getRasterData(c);case 5:return p=P.sent,_=p.data,x=p.width,A=p.height,this.texture=l({data:_,width:x,height:A,format:Y.RGB,type:Y.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:EF,fragmentShader:SF,triangulation:ky,primitive:Y.TRIANGLES,depth:{enable:!1}});case 12:return w=P.sent,P.abrupt("return",[w]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ua);function TF(e){var r=CF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function CF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wF=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,OF=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,RF=function(e){Object(Lt.a)(t,e);var r=TF(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.clampLow,l=o===void 0?!0:o,c=i.clampHigh,p=c===void 0?!0:c,_=i.noDataValue,x=_===void 0?-9999999:_,A=i.domain,w=i.rampColors,I=i.colorTexture,P=i.rScaler,H=P===void 0?6553.6:P,W=i.gScaler,oe=W===void 0?25.6:W,ce=i.bScaler,Oe=ce===void 0?.1:ce,Fe=i.offset,je=Fe===void 0?1e4:Fe,tt=A||wh(w),vt=I;return I?this.layer.textureService.setColorTexture(I,w,tt):vt=this.layer.textureService.getColorTexture(w,tt),{u_opacity:a||1,u_texture:this.texture,u_domain:tt,u_clampLow:l,u_clampHigh:typeof p!="undefined"?p:l,u_noDataValue:x,u_unpack:[H,oe,Oe,je],u_colorTexture:vt}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,x.next=4,o.data.images;case 4:return c=x.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,min:Y.LINEAR,mag:Y.LINEAR}),x.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:OF,fragmentShader:wF,triangulation:ky,primitive:Y.TRIANGLES,depth:{enable:!1}});case 8:return p=x.sent,x.abrupt("return",[p]);case 10:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:wn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ua),MF={raster:kS,rasterRgb:AF,raster3d:kS,rasterTerrainRgb:RF},PF=MF;function IF(e){var r=DF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function DF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zy=function(e){Object(Lt.a)(t,e);var r=IF(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","RasterLayer"),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new PF[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Xp);function kF(e){var r=FF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function FF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BF=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,LF=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,NF=fi.isNumber,jF=function(e){Object(Lt.a)(t,e);var r=kF(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.color,c=l===void 0?"#000":l;return{u_opacity:NF(o)?o:0,u_color:Ui(c)}}},{key:"initModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:LF,fragmentShader:BF,triangulation:Z_,depth:{enable:!1},pick:!1});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Ua),zF={fill:jF},UF=zF;function VF(e){var r=HF();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function HF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FS=function(e){Object(Lt.a)(t,e);var r=VF(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","MaskLayer"),n}return Object(De.a)(t,[{key:"buildModels",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new UF[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Xp),BS,LS,NS,jS,Uy,zS,US,WF=fi.cloneDeep,GF=(BS=Object(Qr.injectable)(),LS=Object(Qr.inject)(Yt.IMapService),NS=Object(Qr.inject)(Yt.IFontService),BS(jS=(Uy=function(){function e(){Object(et.a)(this,e),ma(this,"mapService",zS,this),ma(this,"fontService",US,this)}return Object(De.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",Object(Zt.a)(be.a.mark(function o(){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t.log(Vs.MappingStart,su.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(Vs.MappingEnd,su.INIT);case 3:case"end":return c.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=Object(Zt.a)(be.a.mark(function l(c){var p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c){x.next=2;break}return x.abrupt("return",c);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Vs.MappingStart,su.UPDATE),p=i.generateMaping(t,{styleAttributeService:a}),t.log(Vs.MappingEnd,su.UPDATE),x.abrupt("return",p);case 7:case"end":return x.stop()}},l)}));return function(l){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=t.getSource();if(!(t.layerModelNeedUpdate||!o||!o.inited)){var l=a.getLayerStyleAttributes()||[],c=a.getLayerStyleAttribute("filter"),p=o.data.dataArray;if(!(Array.isArray(p)&&p.length===0)){var _=l.filter(function(w){return w.needRemapping}),x=p;if(c!=null&&c.needRemapping&&c!==null&&c!==void 0&&c.scale&&(x=p.filter(function(w){return i.applyAttributeMapping(c,w)[0]})),_.length){var A=i.mapping(t,_,x,t.getEncodedData());t.setEncodedData(A)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,o=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),c=t.getSource().data.dataArray,p=c;l!=null&&l.scale&&(p=c.filter(function(x){return i.applyAttributeMapping(l,x)[0]})),p=t.processData(p);var _=this.mapping(t,o,p,void 0);return t.setEncodedData(_),c.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,i,a){var o=this,l=n.filter(function(p){return p.scale!==void 0}).filter(function(p){return p.name!=="filter"}),c=i.map(function(p,_){var x=a?a[_]:{},A=Object(ae.a)({id:p._id,coordinates:p.coordinates},x);return l.forEach(function(w){var I=o.applyAttributeMapping(w,p);(w.name==="color"||w.name==="stroke")&&(I=I.map(function(P){return Ui(P)})),A[w.name]=Array.isArray(I)&&I.length===1?I[0]:I,w.name==="shape"&&(A.shape=o.fontService.getIconFontKey(A[w.name]))}),A});return n.forEach(function(p){p.needRemapping=!1}),this.adjustData2Amap2Coordinates(c,t),this.adjustData2SimpleCoordinates(c),c}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version="GAODE2.x",o.originCoordinates=WF(o.coordinates),o.coordinates=i.mapService.coordToAMap2RelativeCoordinates(o.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(o){var l=[];o.map(function(c){l.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(l)}),i}else{var a=[];return t.map(function(o){a.push(n.mapService.simpleMapCoord.unproject(o))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];a.forEach(function(c){var p,_=c.field;(n.hasOwnProperty(_)||((p=t.scale)===null||p===void 0?void 0:p.type)==="variable")&&o.push(n[_])});var l=t.mapping?t.mapping(o):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=Gs(i),o=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return o}}]),e}(),zS=da(Uy.prototype,"mapService",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),US=da(Uy.prototype,"fontService",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy))||jS),VS,HS,XF=(VS=Object(Qr.injectable)(),VS(HS=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Yt.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",Object(Zt.a)(be.a.mark(function i(){var a,o,l,c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.log(Vs.SourceInitStart,su.INIT),a=t.getSource(),a||(o=t.sourceOption||t.defaultSourceConfig,l=o.data,c=o.options,a=new S2(l,c),t.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(t),t.log(Vs.SourceInitEnd,su.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(x){a.on("update",function(A){A.type==="inited"&&(n.updateClusterData(t),t.log(Vs.SourceInitEnd,su.INIT)),x(null)})});case 10:case"end":return _.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Object(Zt.a)(be.a.mark(function i(){var a,o,l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return a=n.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||o,p.abrupt("return",l);case 5:case"end":return p.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,o=a===void 0?0:a,l=this.mapService.getZoom()-1,c=t.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(o!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||HS),pg=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},ZF=function(e){return e.length===1&&(e=$F(e)),{left:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)<0?i=o+1:a=o}return i},right:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)>0?a=o:i=o+1}return i}}};function $F(e){return function(r,t){return pg(e(r),t)}}var WS=ZF(pg),YF=WS.right,UH=WS.left,KF=YF,VH=function(e,r){r==null&&(r=GS);for(var t=0,n=e.length-1,i=e[0],a=new Array(n<0?0:n);t<n;)a[t]=r(i,i=e[++t]);return a};function GS(e,r){return[e,r]}var HH=function(e,r,t){var n=e.length,i=r.length,a=new Array(n*i),o,l,c,p;for(t==null&&(t=GS),o=c=0;o<n;++o)for(p=e[o],l=0;l<i;++l,++c)a[c]=t(p,r[l]);return a},WH=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},Yp=function(e){return e===null?NaN:+e},qF=function(e,r){var t=e.length,n=0,i=-1,a=0,o,l,c=0;if(r==null)for(;++i<t;)isNaN(o=Yp(e[i]))||(l=o-a,a+=l/++n,c+=l*(o-a));else for(;++i<t;)isNaN(o=Yp(r(e[i],i,e)))||(l=o-a,a+=l/++n,c+=l*(o-a));if(n>1)return c/(n-1)},QF=function(e,r){var t=qF(e,r);return t&&Math.sqrt(t)},Q_=function(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]},XS=Array.prototype,JF=XS.slice,eB=XS.map,Vy=function(e){return function(){return e}},tB=function(e){return e},rB=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,a=new Array(i);++n<i;)a[n]=e+n*t;return a},J_=Math.sqrt(50),e1=Math.sqrt(10),t1=Math.sqrt(2),GH=function(e,r,t){var n,i=-1,a,o,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=nB(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/l;return n&&o.reverse(),o};function nB(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=J_?10:a>=e1?5:a>=t1?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=J_?10:a>=e1?5:a>=t1?2:1)}function iB(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=J_?i*=10:a>=e1?i*=5:a>=t1&&(i*=2),r<e?-i:i}var aB=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},XH=function(){var e=tB,r=Q_,t=aB;function n(i){var a,o=i.length,l,c=new Array(o);for(a=0;a<o;++a)c[a]=e(i[a],a,i);var p=r(c),_=p[0],x=p[1],A=t(c,_,x);Array.isArray(A)||(A=iB(_,x,A),A=rB(Math.ceil(_/A)*A,x,A));for(var w=A.length;A[0]<=_;)A.shift(),--w;for(;A[w-1]>x;)A.pop(),--w;var I=new Array(w+1),P;for(a=0;a<=w;++a)P=I[a]=[],P.x0=a>0?A[a-1]:_,P.x1=a<w?A[a]:x;for(a=0;a<o;++a)l=c[a],_<=l&&l<=x&&I[KF(A,l,0,w)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:Vy(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:Vy([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?Vy(JF.call(i)):Vy(i),n):t},n},r1=function(e,r,t){if(t==null&&(t=Yp),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return o+(l-o)*(i-a)}},ZH=function(e,r,t){return e=eB.call(e,Yp).sort(pg),Math.ceil((t-r)/(2*(r1(e,.75)-r1(e,.25))*Math.pow(e.length,-1/3)))},$H=function(e,r,t){return Math.ceil((t-r)/(3.5*QF(e)*Math.pow(e.length,-1/3)))},YH=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&i>a&&(a=i);return a},KH=function(e,r){var t=e.length,n=t,i=-1,a,o=0;if(r==null)for(;++i<t;)isNaN(a=Yp(e[i]))?--n:o+=a;else for(;++i<t;)isNaN(a=Yp(r(e[i],i,e)))?--n:o+=a;if(n)return o/n},qH=function(e,r){var t=e.length,n=-1,i,a=[];if(r==null)for(;++n<t;)isNaN(i=Yp(e[n]))||a.push(i);else for(;++n<t;)isNaN(i=Yp(r(e[n],n,e)))||a.push(i);return r1(a.sort(pg),.5)},QH=function(e){for(var r=e.length,t,n=-1,i=0,a,o;++n<r;)i+=e[n].length;for(a=new Array(i);--r>=0;)for(o=e[r],t=o.length;--t>=0;)a[--i]=o[t];return a},oB=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&a>i&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&a>i&&(a=i);return a},JH=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},eW=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,a,o=e[i];for(r==null&&(r=pg);++n<t;)(r(a=e[n],o)<0||r(o,o)!==0)&&(o=a,i=n);if(r(o,o)===0)return i}},tW=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,a;n;)a=Math.random()*n--|0,i=e[n+r],e[n+r]=e[a+r],e[a+r]=i;return e},rW=function(e,r){var t=e.length,n=-1,i,a=0;if(r==null)for(;++n<t;)(i=+e[n])&&(a+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(a+=i);return a},sB=function(e){if(!(a=e.length))return[];for(var r=-1,t=oB(e,uB),n=new Array(t);++r<t;)for(var i=-1,a,o=n[r]=new Array(a);++i<a;)o[i]=e[i][r];return n};function uB(e){return e.length}var nW=function(){return sB(arguments)};function ZS(e,r,t,n,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*r+(4-6*a+3*o)*t+(1+3*e+3*a-3*o)*n+o*i)/6}var lB=function(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],o=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return ZS((t-n/r)*r,o,i,a,l)}},cB=function(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],o=e[(n+1)%r],l=e[(n+2)%r];return ZS((t-n/r)*r,i,a,o,l)}},Hy=function(e){return function(){return e}};function $S(e,r){return function(t){return e+t*r}}function fB(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function iW(e,r){var t=r-e;return t?$S(e,t>180||t<-180?t-360*Math.round(t/360):t):Hy(isNaN(e)?r:e)}function hB(e){return(e=+e)==1?YS:function(r,t){return t-r?fB(r,t,e):Hy(isNaN(r)?t:r)}}function YS(e,r){var t=r-e;return t?$S(e,t):Hy(isNaN(e)?r:e)}var KS=function e(r){var t=hB(r);function n(i,a){var o=t((i=rc(i)).r,(a=rc(a)).r),l=t(i.g,a.g),c=t(i.b,a.b),p=YS(i.opacity,a.opacity);return function(_){return i.r=o(_),i.g=l(_),i.b=c(_),i.opacity=p(_),i+""}}return n.gamma=e,n}(1);function qS(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),o,l;for(o=0;o<t;++o)l=rc(r[o]),n[o]=l.r||0,i[o]=l.g||0,a[o]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(c){return l.r=n(c),l.g=i(c),l.b=a(c),l+""}}}var pB=qS(lB),aW=qS(cB),Wd=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},QS=function(e){return e.length===1&&(e=dB(e)),{left:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)<0?i=o+1:a=o}return i},right:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)>0?a=o:i=o+1}return i}}};function dB(e){return function(r,t){return Wd(e(r),t)}}var JS=QS(Wd),vB=JS.right,oW=JS.left,Kv=vB,sW=function(e,r){r==null&&(r=eA);for(var t=0,n=e.length-1,i=e[0],a=new Array(n<0?0:n);t<n;)a[t]=r(i,i=e[++t]);return a};function eA(e,r){return[e,r]}var uW=function(e,r,t){var n=e.length,i=r.length,a=new Array(n*i),o,l,c,p;for(t==null&&(t=eA),o=c=0;o<n;++o)for(p=e[o],l=0;l<i;++l,++c)a[c]=t(p,r[l]);return a},lW=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},Kp=function(e){return e===null?NaN:+e},mB=function(e,r){var t=e.length,n=0,i=-1,a=0,o,l,c=0;if(r==null)for(;++i<t;)isNaN(o=Kp(e[i]))||(l=o-a,a+=l/++n,c+=l*(o-a));else for(;++i<t;)isNaN(o=Kp(r(e[i],i,e)))||(l=o-a,a+=l/++n,c+=l*(o-a));if(n>1)return c/(n-1)},gB=function(e,r){var t=mB(e,r);return t&&Math.sqrt(t)},yB=function(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]},tA=Array.prototype,_B=tA.slice,bB=tA.map,Wy=function(e){return function(){return e}},xB=function(e){return e},rA=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,a=new Array(i);++n<i;)a[n]=e+n*t;return a},n1=Math.sqrt(50),i1=Math.sqrt(10),a1=Math.sqrt(2),nA=function(e,r,t){var n,i=-1,a,o,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=Gy(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/l;return n&&o.reverse(),o};function Gy(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=n1?10:a>=i1?5:a>=a1?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=n1?10:a>=i1?5:a>=a1?2:1)}function Xy(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=n1?i*=10:a>=i1?i*=5:a>=a1&&(i*=2),r<e?-i:i}var EB=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},cW=function(){var e=xB,r=yB,t=EB;function n(i){var a,o=i.length,l,c=new Array(o);for(a=0;a<o;++a)c[a]=e(i[a],a,i);var p=r(c),_=p[0],x=p[1],A=t(c,_,x);Array.isArray(A)||(A=Xy(_,x,A),A=rA(Math.ceil(_/A)*A,x,A));for(var w=A.length;A[0]<=_;)A.shift(),--w;for(;A[w-1]>x;)A.pop(),--w;var I=new Array(w+1),P;for(a=0;a<=w;++a)P=I[a]=[],P.x0=a>0?A[a-1]:_,P.x1=a<w?A[a]:x;for(a=0;a<o;++a)l=c[a],_<=l&&l<=x&&I[Kv(A,l,0,w)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:Wy(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:Wy([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?Wy(_B.call(i)):Wy(i),n):t},n},Zy=function(e,r,t){if(t==null&&(t=Kp),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return o+(l-o)*(i-a)}},fW=function(e,r,t){return e=bB.call(e,Kp).sort(Wd),Math.ceil((t-r)/(2*(Zy(e,.75)-Zy(e,.25))*Math.pow(e.length,-1/3)))},hW=function(e,r,t){return Math.ceil((t-r)/(3.5*gB(e)*Math.pow(e.length,-1/3)))},pW=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&i>a&&(a=i);return a},dW=function(e,r){var t=e.length,n=t,i=-1,a,o=0;if(r==null)for(;++i<t;)isNaN(a=Kp(e[i]))?--n:o+=a;else for(;++i<t;)isNaN(a=Kp(r(e[i],i,e)))?--n:o+=a;if(n)return o/n},vW=function(e,r){var t=e.length,n=-1,i,a=[];if(r==null)for(;++n<t;)isNaN(i=Kp(e[n]))||a.push(i);else for(;++n<t;)isNaN(i=Kp(r(e[n],n,e)))||a.push(i);return Zy(a.sort(Wd),.5)},mW=function(e){for(var r=e.length,t,n=-1,i=0,a,o;++n<r;)i+=e[n].length;for(a=new Array(i);--r>=0;)for(o=e[r],t=o.length;--t>=0;)a[--i]=o[t];return a},SB=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&a>i&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&a>i&&(a=i);return a},gW=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},yW=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,a,o=e[i];for(r==null&&(r=Wd);++n<t;)(r(a=e[n],o)<0||r(o,o)!==0)&&(o=a,i=n);if(r(o,o)===0)return i}},_W=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,a;n;)a=Math.random()*n--|0,i=e[n+r],e[n+r]=e[a+r],e[a+r]=i;return e},bW=function(e,r){var t=e.length,n=-1,i,a=0;if(r==null)for(;++n<t;)(i=+e[n])&&(a+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(a+=i);return a},AB=function(e){if(!(a=e.length))return[];for(var r=-1,t=SB(e,TB),n=new Array(t);++r<t;)for(var i=-1,a,o=n[r]=new Array(a);++i<a;)o[i]=e[i][r];return n};function TB(e){return e.length}var xW=function(){return AB(arguments)};function If(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function tp(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var ef="$";function $y(){}$y.prototype=iA.prototype={constructor:$y,has:function(r){return ef+r in this},get:function(r){return this[ef+r]},set:function(r,t){return this[ef+r]=t,this},remove:function(r){var t=ef+r;return t in this&&delete this[t]},clear:function(){for(var r in this)r[0]===ef&&delete this[r]},keys:function(){var r=[];for(var t in this)t[0]===ef&&r.push(t.slice(1));return r},values:function(){var r=[];for(var t in this)t[0]===ef&&r.push(this[t]);return r},entries:function(){var r=[];for(var t in this)t[0]===ef&&r.push({key:t.slice(1),value:this[t]});return r},size:function(){var r=0;for(var t in this)t[0]===ef&&++r;return r},empty:function(){for(var r in this)if(r[0]===ef)return!1;return!0},each:function(r){for(var t in this)t[0]===ef&&r(this[t],t.slice(1),this)}};function iA(e,r){var t=new $y;if(e instanceof $y)e.each(function(l,c){t.set(c,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var o in e)t.set(o,e[o]);return t}var dg=iA,EW=function(){var e=[],r=[],t,n,i;function a(l,c,p,_){if(c>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var x=-1,A=l.length,w=e[c++],I,P,H=dg(),W,oe=p();++x<A;)(W=H.get(I=w(P=l[x])+""))?W.push(P):H.set(I,[P]);return H.each(function(ce,Oe){_(oe,Oe,a(ce,c,p,_))}),oe}function o(l,c){if(++c>e.length)return l;var p,_=r[c-1];return n!=null&&c>=e.length?p=l.entries():(p=[],l.each(function(x,A){p.push({key:A,values:o(x,c)})})),_!=null?p.sort(function(x,A){return _(x.key,A.key)}):p}return i={object:function(c){return a(c,0,CB,wB)},map:function(c){return a(c,0,aA,oA)},entries:function(c){return o(a(c,0,aA,oA),0)},key:function(c){return e.push(c),i},sortKeys:function(c){return r[e.length-1]=c,i},sortValues:function(c){return t=c,i},rollup:function(c){return n=c,i}}};function CB(){return{}}function wB(e,r,t){e[r]=t}function aA(){return dg()}function oA(e,r,t){e.set(r,t)}function Yy(){}var Gd=dg.prototype;Yy.prototype=sA.prototype={constructor:Yy,has:Gd.has,add:function(r){return r+="",this[ef+r]=r,this},remove:Gd.remove,clear:Gd.clear,values:Gd.keys,size:Gd.size,empty:Gd.empty,each:Gd.each};function sA(e,r){var t=new Yy;if(e instanceof Yy)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var SW=sA,AW=function(e){var r=[];for(var t in e)r.push(t);return r},TW=function(e){var r=[];for(var t in e)r.push(e[t]);return r},CW=function(e){var r=[];for(var t in e)r.push({key:t,value:e[t]});return r},uA=Array.prototype,Ky=uA.map,Xd=uA.slice,lA={name:"implicit"};function vg(){var e=dg(),r=[],t=[],n=lA;function i(a){var o=a+"",l=e.get(o);if(!l){if(n!==lA)return n;e.set(o,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=dg();for(var o=-1,l=a.length,c,p;++o<l;)e.has(p=(c=a[o])+"")||e.set(p,r.push(c));return i},i.range=function(a){return arguments.length?(t=Xd.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return vg(r,t).unknown(n)},If.apply(i,arguments),i}function cA(){var e=vg().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,o=!1,l=0,c=0,p=.5;delete e.unknown;function _(){var x=r().length,A=n[1]<n[0],w=n[A-0],I=n[1-A];i=(I-w)/Math.max(1,x-l+c*2),o&&(i=Math.floor(i)),w+=(I-w-i*(x-l))*p,a=i*(1-l),o&&(w=Math.round(w),a=Math.round(a));var P=rA(x).map(function(H){return w+i*H});return t(A?P.reverse():P)}return e.domain=function(x){return arguments.length?(r(x),_()):r()},e.range=function(x){return arguments.length?(n=[+x[0],+x[1]],_()):n.slice()},e.rangeRound=function(x){return n=[+x[0],+x[1]],o=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(x){return arguments.length?(o=!!x,_()):o},e.padding=function(x){return arguments.length?(l=Math.min(1,c=+x),_()):l},e.paddingInner=function(x){return arguments.length?(l=Math.min(1,x),_()):l},e.paddingOuter=function(x){return arguments.length?(c=+x,_()):c},e.align=function(x){return arguments.length?(p=Math.max(0,Math.min(1,x)),_()):p},e.copy=function(){return cA(r(),n).round(o).paddingInner(l).paddingOuter(c).align(p)},If.apply(_(),arguments)}function fA(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return fA(r())},e}function wW(){return fA(cA.apply(null,arguments).paddingInner(1))}var hA=function(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}};function pA(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var OW=function(e,r){return(pA(r)?hA:dA)(e,r)};function dA(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),o;for(o=0;o<n;++o)i[o]=u1(e[o],r[o]);for(;o<t;++o)a[o]=r[o];return function(l){for(o=0;o<n;++o)a[o]=i[o](l);return a}}var OB=function(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}},qy=function(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}},RB=function(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=u1(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}},o1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s1=new RegExp(o1.source,"g");function MB(e){return function(){return e}}function PB(e){return function(r){return e(r)+""}}var IB=function(e,r){var t=o1.lastIndex=s1.lastIndex=0,n,i,a,o=-1,l=[],c=[];for(e=e+"",r=r+"";(n=o1.exec(e))&&(i=s1.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,c.push({i:o,x:qy(n,i)})),t=s1.lastIndex;return t<r.length&&(a=r.slice(t),l[o]?l[o]+=a:l[++o]=a),l.length<2?c[0]?PB(c[0].x):MB(r):(r=c.length,function(p){for(var _=0,x;_<r;++_)l[(x=c[_]).i]=x.x(p);return l.join("")})},u1=function(e,r){var t=typeof r,n;return r==null||t==="boolean"?Hy(r):(t==="number"?qy:t==="string"?(n=uu(r))?(r=n,KS):IB:r instanceof uu?KS:r instanceof Date?OB:pA(r)?hA:Array.isArray(r)?dA:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?RB:qy)(e,r)},DB=function(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}},kB=function(e){return function(){return e}},l1=function(e){return+e},vA=[0,1];function Pu(e){return e}function c1(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:kB(isNaN(r)?NaN:.5)}function mA(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function FB(e,r,t){var n=e[0],i=e[1],a=r[0],o=r[1];return i<n?(n=c1(i,n),a=t(o,a)):(n=c1(n,i),a=t(a,o)),function(l){return a(n(l))}}function BB(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++o<n;)i[o]=c1(e[o],e[o+1]),a[o]=t(r[o],r[o+1]);return function(l){var c=Kv(e,l,1,n)-1;return a[c](i[c](l))}}function mg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Qy(){var e=vA,r=vA,t=u1,n,i,a,o=Pu,l,c,p;function _(){return l=Math.min(e.length,r.length)>2?BB:FB,c=p=null,x}function x(A){return isNaN(A=+A)?a:(c||(c=l(e.map(n),r,t)))(n(o(A)))}return x.invert=function(A){return o(i((p||(p=l(r,e.map(n),qy)))(A)))},x.domain=function(A){return arguments.length?(e=Ky.call(A,l1),o===Pu||(o=mA(e)),_()):e.slice()},x.range=function(A){return arguments.length?(r=Xd.call(A),_()):r.slice()},x.rangeRound=function(A){return r=Xd.call(A),t=DB,_()},x.clamp=function(A){return arguments.length?(o=A?mA(e):Pu,x):o!==Pu},x.interpolate=function(A){return arguments.length?(t=A,_()):t},x.unknown=function(A){return arguments.length?(a=A,x):a},function(A,w){return n=A,i=w,_()}}function gA(e,r){return Qy()(e,r)}var LB=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Jy(e){if(!(r=LB.exec(e)))throw new Error("invalid format: "+e);var r;return new f1({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}Jy.prototype=f1.prototype;function f1(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}f1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};var NB=function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)};function e0(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}var qv=function(e){return e=e0(Math.abs(e)),e?e[1]:NaN},jB=function(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(qv(r)/3)))*3-qv(Math.abs(e)))},zB=function(e,r){return function(t,n){for(var i=t.length,a=[],o=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),a.push(t.substring(i-=l,i+l)),!((c+=l+1)>n));)l=e[o=(o+1)%e.length];return a.reverse().join(r)}},UB=function(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}},VB=function(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e},yA,HB=function(e,r){var t=e0(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(yA=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+e0(e,Math.max(0,r+a-1))[0]},_A=function(e,r){var t=e0(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")},bA={"%":function(r,t){return(r*100).toFixed(t)},b:function(r){return Math.round(r).toString(2)},c:function(r){return r+""},d:NB,e:function(r,t){return r.toExponential(t)},f:function(r,t){return r.toFixed(t)},g:function(r,t){return r.toPrecision(t)},o:function(r){return Math.round(r).toString(8)},p:function(r,t){return _A(r*100,t)},r:_A,s:HB,X:function(r){return Math.round(r).toString(16).toUpperCase()},x:function(r){return Math.round(r).toString(16)}},xA=function(e){return e},EA=Array.prototype.map,SA=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"],WB=function(e){var r=e.grouping===void 0||e.thousands===void 0?xA:zB(EA.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?xA:UB(EA.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function p(x){x=Jy(x);var A=x.fill,w=x.align,I=x.sign,P=x.symbol,H=x.zero,W=x.width,oe=x.comma,ce=x.precision,Oe=x.trim,Fe=x.type;Fe==="n"?(oe=!0,Fe="g"):bA[Fe]||(ce===void 0&&(ce=12),Oe=!0,Fe="g"),(H||A==="0"&&w==="=")&&(H=!0,A="0",w="=");var je=P==="$"?t:P==="#"&&/[boxX]/.test(Fe)?"0"+Fe.toLowerCase():"",tt=P==="$"?n:/[%p]/.test(Fe)?o:"",vt=bA[Fe],kt=/[defgprs%]/.test(Fe);ce=ce===void 0?6:/[gprs]/.test(Fe)?Math.max(1,Math.min(21,ce)):Math.max(0,Math.min(20,ce));function ir(ur){var Zr=je,ln=tt,_n,Hi,io;if(Fe==="c")ln=vt(ur)+ln,ur="";else{ur=+ur;var Ga=ur<0||1/ur<0;if(ur=isNaN(ur)?c:vt(Math.abs(ur),ce),Oe&&(ur=VB(ur)),Ga&&+ur==0&&I!=="+"&&(Ga=!1),Zr=(Ga?I==="("?I:l:I==="-"||I==="("?"":I)+Zr,ln=(Fe==="s"?SA[8+yA/3]:"")+ln+(Ga&&I==="("?")":""),kt){for(_n=-1,Hi=ur.length;++_n<Hi;)if(io=ur.charCodeAt(_n),48>io||io>57){ln=(io===46?i+ur.slice(_n+1):ur.slice(_n))+ln,ur=ur.slice(0,_n);break}}}oe&&!H&&(ur=r(ur,Infinity));var To=Zr.length+ur.length+ln.length,Co=To<W?new Array(W-To+1).join(A):"";switch(oe&&H&&(ur=r(Co+ur,Co.length?W-ln.length:Infinity),Co=""),w){case"<":ur=Zr+ur+ln+Co;break;case"=":ur=Zr+Co+ur+ln;break;case"^":ur=Co.slice(0,To=Co.length>>1)+Zr+ur+ln+Co.slice(To);break;default:ur=Co+Zr+ur+ln;break}return a(ur)}return ir.toString=function(){return x+""},ir}function _(x,A){var w=p((x=Jy(x),x.type="f",x)),I=Math.max(-8,Math.min(8,Math.floor(qv(A)/3)))*3,P=Math.pow(10,-I),H=SA[8+I/3];return function(W){return w(P*W)+H}}return{format:p,formatPrefix:_}},t0,h1,AA;GB({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function GB(e){return t0=WB(e),h1=t0.format,AA=t0.formatPrefix,t0}var XB=function(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,qv(r)-qv(e))+1},ZB=function(e){return Math.max(0,-qv(Math.abs(e)))},$B=function(e,r,t,n){var i=Xy(e,r,t),a;switch(n=Jy(n==null?",f":n),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=jB(i,o))&&(n.precision=a),AA(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=XB(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=ZB(i))&&(n.precision=a-(n.type==="%")*2);break}}return h1(n)};function Zd(e){var r=e.domain;return e.ticks=function(t){var n=r();return nA(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return $B(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,o=n[i],l=n[a],c;return l<o&&(c=o,o=l,l=c,c=i,i=a,a=c),c=Gy(o,l,t),c>0?(o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c,c=Gy(o,l,t)):c<0&&(o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c,c=Gy(o,l,t)),c>0?(n[i]=Math.floor(o/c)*c,n[a]=Math.ceil(l/c)*c,r(n)):c<0&&(n[i]=Math.ceil(o*c)/c,n[a]=Math.floor(l*c)/c,r(n)),e},e}function TA(){var e=gA(Pu,Pu);return e.copy=function(){return mg(e,TA())},If.apply(e,arguments),Zd(e)}function YB(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=Ky.call(n,l1),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return YB(e).unknown(r)},e=arguments.length?Ky.call(e,l1):[0,1],Zd(t)}var CA=function(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],o;return a<i&&(o=t,t=n,n=o,o=i,i=a,a=o),e[t]=r.floor(i),e[n]=r.ceil(a),e};function wA(e){return Math.log(e)}function OA(e){return Math.exp(e)}function KB(e){return-Math.log(-e)}function qB(e){return-Math.exp(-e)}function QB(e){return isFinite(e)?+("1e"+e):e<0?0:e}function JB(e){return e===10?QB:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function eL(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function RA(e){return function(r){return-e(-r)}}function p1(e){var r=e(wA,OA),t=r.domain,n=10,i,a;function o(){return i=eL(n),a=JB(n),t()[0]<0?(i=RA(i),a=RA(a),e(KB,qB)):e(wA,OA),r}return r.base=function(l){return arguments.length?(n=+l,o()):n},r.domain=function(l){return arguments.length?(t(l),o()):t()},r.ticks=function(l){var c=t(),p=c[0],_=c[c.length-1],x;(x=_<p)&&(A=p,p=_,_=A);var A=i(p),w=i(_),I,P,H,W=l==null?10:+l,oe=[];if(!(n%1)&&w-A<W){if(A=Math.round(A)-1,w=Math.round(w)+1,p>0){for(;A<w;++A)for(P=1,I=a(A);P<n;++P)if(H=I*P,!(H<p)){if(H>_)break;oe.push(H)}}else for(;A<w;++A)for(P=n-1,I=a(A);P>=1;--P)if(H=I*P,!(H<p)){if(H>_)break;oe.push(H)}}else oe=nA(A,w,Math.min(w-A,W)).map(a);return x?oe.reverse():oe},r.tickFormat=function(l,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=h1(c)),l===Infinity)return c;l==null&&(l=10);var p=Math.max(1,n*l/r.ticks().length);return function(_){var x=_/a(Math.round(i(_)));return x*n<n-.5&&(x*=n),x<=p?c(_):""}},r.nice=function(){return t(CA(t(),{floor:function(c){return a(Math.floor(i(c)))},ceil:function(c){return a(Math.ceil(i(c)))}}))},r}function MA(){var e=p1(Qy()).domain([1,10]);return e.copy=function(){return mg(e,MA()).base(e.base())},If.apply(e,arguments),e}function PA(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function IA(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function d1(e){var r=1,t=e(PA(r),IA(r));return t.constant=function(n){return arguments.length?e(PA(r=+n),IA(r)):r},Zd(t)}function tL(){var e=d1(Qy());return e.copy=function(){return mg(e,tL()).constant(e.constant())},If.apply(e,arguments)}function DA(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function rL(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function nL(e){return e<0?-e*e:e*e}function v1(e){var r=e(Pu,Pu),t=1;function n(){return t===1?e(Pu,Pu):t===.5?e(rL,nL):e(DA(t),DA(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},Zd(r)}function m1(){var e=v1(Qy());return e.copy=function(){return mg(e,m1()).exponent(e.exponent())},If.apply(e,arguments),e}function RW(){return m1.apply(null,arguments).exponent(.5)}function kA(){var e=[],r=[],t=[],n;function i(){var o=0,l=Math.max(1,r.length);for(t=new Array(l-1);++o<l;)t[o-1]=Zy(e,o/l);return a}function a(o){return isNaN(o=+o)?n:r[Kv(t,o)]}return a.invertExtent=function(o){var l=r.indexOf(o);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(var l=0,c=o.length,p;l<c;++l)p=o[l],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(Wd),i()},a.range=function(o){return arguments.length?(r=Xd.call(o),i()):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return kA().domain(e).range(r).unknown(n)},If.apply(a,arguments)}function FA(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function o(c){return c<=c?i[Kv(n,c,0,t)]:a}function l(){var c=-1;for(n=new Array(t);++c<t;)n[c]=((c+1)*r-(c-t)*e)/(t+1);return o}return o.domain=function(c){return arguments.length?(e=+c[0],r=+c[1],l()):[e,r]},o.range=function(c){return arguments.length?(t=(i=Xd.call(c)).length-1,l()):i.slice()},o.invertExtent=function(c){var p=i.indexOf(c);return p<0?[NaN,NaN]:p<1?[e,n[0]]:p>=t?[n[t-1],r]:[n[p-1],n[p]]},o.unknown=function(c){return arguments.length&&(a=c),o},o.thresholds=function(){return n.slice()},o.copy=function(){return FA().domain([e,r]).range(i).unknown(a)},If.apply(Zd(o),arguments)}function BA(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[Kv(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=Xd.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=Xd.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var o=r.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return BA().domain(e).range(r).unknown(t)},If.apply(i,arguments)}var g1=new Date,y1=new Date;function _u(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var o=i(a),l=i.ceil(a);return a-o<l-a?o:l},i.offset=function(a,o){return r(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,l){var c=[],p;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<o)||!(l>0))return c;do c.push(p=new Date(+a)),r(a,l),e(a);while(p<a&&a<o);return c},i.filter=function(a){return _u(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,l){if(o>=o)if(l<0)for(;++l<=0;)for(;r(o,-1),!a(o););else for(;--l>=0;)for(;r(o,1),!a(o););})},t&&(i.count=function(a,o){return g1.setTime(+a),y1.setTime(+o),e(g1),e(y1),Math.floor(t(g1,y1))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(o){return n(o)%a==0}:function(o){return i.count(0,o)%a==0}):i}),i}var _1=_u(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});_1.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_u(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var Qv=_1,MW=_1.range,LA=_u(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),iL=LA,PW=LA.range,r0=1e3,$d=6e4,n0=36e5,NA=864e5,jA=6048e5;function Yd(e){return _u(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*$d)/jA})}var b1=Yd(0),i0=Yd(1),aL=Yd(2),oL=Yd(3),Jv=Yd(4),sL=Yd(5),uL=Yd(6),IW=b1.range,DW=i0.range,kW=aL.range,FW=oL.range,BW=Jv.range,LW=sL.range,NW=uL.range,zA=_u(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*$d)/NA},function(e){return e.getDate()-1}),x1=zA,jW=zA.range,UA=_u(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*r0-e.getMinutes()*$d)},function(e,r){e.setTime(+e+r*n0)},function(e,r){return(r-e)/n0},function(e){return e.getHours()}),lL=UA,zW=UA.range,VA=_u(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*r0)},function(e,r){e.setTime(+e+r*$d)},function(e,r){return(r-e)/$d},function(e){return e.getMinutes()}),cL=VA,UW=VA.range,HA=_u(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*r0)},function(e,r){return(r-e)/r0},function(e){return e.getUTCSeconds()}),WA=HA,VW=HA.range,a0=_u(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});a0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?_u(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):a0};var GA=a0,HW=a0.range;function Kd(e){return _u(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/jA})}var E1=Kd(0),o0=Kd(1),fL=Kd(2),hL=Kd(3),em=Kd(4),pL=Kd(5),dL=Kd(6),WW=E1.range,GW=o0.range,XW=fL.range,ZW=hL.range,$W=em.range,YW=pL.range,KW=dL.range,XA=_u(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/NA},function(e){return e.getUTCDate()-1}),S1=XA,qW=XA.range,A1=_u(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});A1.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_u(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var tm=A1,QW=A1.range;function T1(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function C1(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function gg(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function vL(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,o=e.shortDays,l=e.months,c=e.shortMonths,p=yg(i),_=_g(i),x=yg(a),A=_g(a),w=yg(o),I=_g(o),P=yg(l),H=_g(l),W=yg(c),oe=_g(c),ce={a:Ga,A:To,b:Co,B:nl,c:null,d:QA,e:QA,f:NL,g:$L,G:KL,H:FL,I:BL,j:LL,L:JA,m:jL,M:zL,p:d_,q:Om,Q:aT,s:oT,S:UL,u:VL,U:HL,V:WL,w:GL,W:XL,x:null,X:null,y:ZL,Y:YL,Z:qL,"%":iT},Oe={a:vb,A:mb,b:vs,B:ec,c:null,d:tT,e:tT,f:tN,g:fN,G:pN,H:QL,I:JL,j:eN,L:rT,m:rN,M:nN,p:v_,q:m_,Q:aT,s:oT,S:iN,u:aN,U:oN,V:sN,w:uN,W:lN,x:null,X:null,y:cN,Y:hN,Z:dN,"%":iT},Fe={a:ir,A:ur,b:Zr,B:ln,c:_n,d:KA,e:KA,f:PL,g:YA,G:$A,H:qA,I:qA,j:wL,L:ML,m:CL,M:OL,p:kt,q:TL,Q:DL,s:kL,S:RL,u:bL,U:xL,V:EL,w:_L,W:SL,x:Hi,X:io,y:YA,Y:$A,Z:AL,"%":IL};ce.x=je(t,ce),ce.X=je(n,ce),ce.c=je(r,ce),Oe.x=je(t,Oe),Oe.X=je(n,Oe),Oe.c=je(r,Oe);function je(Fi,Da){return function(sa){var Mn=[],tc=-1,Zo=0,wc=Fi.length,Oc,sv,i3;for(sa instanceof Date||(sa=new Date(+sa));++tc<wc;)Fi.charCodeAt(tc)===37&&(Mn.push(Fi.slice(Zo,tc)),(sv=ZA[Oc=Fi.charAt(++tc)])!=null?Oc=Fi.charAt(++tc):sv=Oc==="e"?" ":"0",(i3=Da[Oc])&&(Oc=i3(sa,sv)),Mn.push(Oc),Zo=tc+1);return Mn.push(Fi.slice(Zo,tc)),Mn.join("")}}function tt(Fi,Da){return function(sa){var Mn=gg(1900,void 0,1),tc=vt(Mn,Fi,sa+="",0),Zo,wc;if(tc!=sa.length)return null;if("Q"in Mn)return new Date(Mn.Q);if("s"in Mn)return new Date(Mn.s*1e3+("L"in Mn?Mn.L:0));if(Da&&!("Z"in Mn)&&(Mn.Z=0),"p"in Mn&&(Mn.H=Mn.H%12+Mn.p*12),Mn.m===void 0&&(Mn.m="q"in Mn?Mn.q:0),"V"in Mn){if(Mn.V<1||Mn.V>53)return null;"w"in Mn||(Mn.w=1),"Z"in Mn?(Zo=C1(gg(Mn.y,0,1)),wc=Zo.getUTCDay(),Zo=wc>4||wc===0?o0.ceil(Zo):o0(Zo),Zo=S1.offset(Zo,(Mn.V-1)*7),Mn.y=Zo.getUTCFullYear(),Mn.m=Zo.getUTCMonth(),Mn.d=Zo.getUTCDate()+(Mn.w+6)%7):(Zo=T1(gg(Mn.y,0,1)),wc=Zo.getDay(),Zo=wc>4||wc===0?i0.ceil(Zo):i0(Zo),Zo=x1.offset(Zo,(Mn.V-1)*7),Mn.y=Zo.getFullYear(),Mn.m=Zo.getMonth(),Mn.d=Zo.getDate()+(Mn.w+6)%7)}else("W"in Mn||"U"in Mn)&&("w"in Mn||(Mn.w="u"in Mn?Mn.u%7:"W"in Mn?1:0),wc="Z"in Mn?C1(gg(Mn.y,0,1)).getUTCDay():T1(gg(Mn.y,0,1)).getDay(),Mn.m=0,Mn.d="W"in Mn?(Mn.w+6)%7+Mn.W*7-(wc+5)%7:Mn.w+Mn.U*7-(wc+6)%7);return"Z"in Mn?(Mn.H+=Mn.Z/100|0,Mn.M+=Mn.Z%100,C1(Mn)):T1(Mn)}}function vt(Fi,Da,sa,Mn){for(var tc=0,Zo=Da.length,wc=sa.length,Oc,sv;tc<Zo;){if(Mn>=wc)return-1;if(Oc=Da.charCodeAt(tc++),Oc===37){if(Oc=Da.charAt(tc++),sv=Fe[Oc in ZA?Da.charAt(tc++):Oc],!sv||(Mn=sv(Fi,sa,Mn))<0)return-1}else if(Oc!=sa.charCodeAt(Mn++))return-1}return Mn}function kt(Fi,Da,sa){var Mn=p.exec(Da.slice(sa));return Mn?(Fi.p=_[Mn[0].toLowerCase()],sa+Mn[0].length):-1}function ir(Fi,Da,sa){var Mn=w.exec(Da.slice(sa));return Mn?(Fi.w=I[Mn[0].toLowerCase()],sa+Mn[0].length):-1}function ur(Fi,Da,sa){var Mn=x.exec(Da.slice(sa));return Mn?(Fi.w=A[Mn[0].toLowerCase()],sa+Mn[0].length):-1}function Zr(Fi,Da,sa){var Mn=W.exec(Da.slice(sa));return Mn?(Fi.m=oe[Mn[0].toLowerCase()],sa+Mn[0].length):-1}function ln(Fi,Da,sa){var Mn=P.exec(Da.slice(sa));return Mn?(Fi.m=H[Mn[0].toLowerCase()],sa+Mn[0].length):-1}function _n(Fi,Da,sa){return vt(Fi,r,Da,sa)}function Hi(Fi,Da,sa){return vt(Fi,t,Da,sa)}function io(Fi,Da,sa){return vt(Fi,n,Da,sa)}function Ga(Fi){return o[Fi.getDay()]}function To(Fi){return a[Fi.getDay()]}function Co(Fi){return c[Fi.getMonth()]}function nl(Fi){return l[Fi.getMonth()]}function d_(Fi){return i[+(Fi.getHours()>=12)]}function Om(Fi){return 1+~~(Fi.getMonth()/3)}function vb(Fi){return o[Fi.getUTCDay()]}function mb(Fi){return a[Fi.getUTCDay()]}function vs(Fi){return c[Fi.getUTCMonth()]}function ec(Fi){return l[Fi.getUTCMonth()]}function v_(Fi){return i[+(Fi.getUTCHours()>=12)]}function m_(Fi){return 1+~~(Fi.getUTCMonth()/3)}return{format:function(Da){var sa=je(Da+="",ce);return sa.toString=function(){return Da},sa},parse:function(Da){var sa=tt(Da+="",!1);return sa.toString=function(){return Da},sa},utcFormat:function(Da){var sa=je(Da+="",Oe);return sa.toString=function(){return Da},sa},utcParse:function(Da){var sa=tt(Da+="",!0);return sa.toString=function(){return Da},sa}}}var ZA={"-":"",_:" ","0":"0"},bu=/^\s*\d+/,mL=/^%/,gL=/[\\^$*+?|[\]().{}]/g;function ro(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function yL(e){return e.replace(gL,"\\$&")}function yg(e){return new RegExp("^(?:"+e.map(yL).join("|")+")","i")}function _g(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function _L(e,r,t){var n=bu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function bL(e,r,t){var n=bu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function xL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function EL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function SL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function $A(e,r,t){var n=bu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function YA(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function AL(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function TL(e,r,t){var n=bu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function CL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function KA(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function wL(e,r,t){var n=bu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function qA(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function OL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function RL(e,r,t){var n=bu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function ML(e,r,t){var n=bu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function PL(e,r,t){var n=bu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function IL(e,r,t){var n=mL.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function DL(e,r,t){var n=bu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function kL(e,r,t){var n=bu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function QA(e,r){return ro(e.getDate(),r,2)}function FL(e,r){return ro(e.getHours(),r,2)}function BL(e,r){return ro(e.getHours()%12||12,r,2)}function LL(e,r){return ro(1+x1.count(Qv(e),e),r,3)}function JA(e,r){return ro(e.getMilliseconds(),r,3)}function NL(e,r){return JA(e,r)+"000"}function jL(e,r){return ro(e.getMonth()+1,r,2)}function zL(e,r){return ro(e.getMinutes(),r,2)}function UL(e,r){return ro(e.getSeconds(),r,2)}function VL(e){var r=e.getDay();return r===0?7:r}function HL(e,r){return ro(b1.count(Qv(e)-1,e),r,2)}function eT(e){var r=e.getDay();return r>=4||r===0?Jv(e):Jv.ceil(e)}function WL(e,r){return e=eT(e),ro(Jv.count(Qv(e),e)+(Qv(e).getDay()===4),r,2)}function GL(e){return e.getDay()}function XL(e,r){return ro(i0.count(Qv(e)-1,e),r,2)}function ZL(e,r){return ro(e.getFullYear()%100,r,2)}function $L(e,r){return e=eT(e),ro(e.getFullYear()%100,r,2)}function YL(e,r){return ro(e.getFullYear()%1e4,r,4)}function KL(e,r){var t=e.getDay();return e=t>=4||t===0?Jv(e):Jv.ceil(e),ro(e.getFullYear()%1e4,r,4)}function qL(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+ro(r/60|0,"0",2)+ro(r%60,"0",2)}function tT(e,r){return ro(e.getUTCDate(),r,2)}function QL(e,r){return ro(e.getUTCHours(),r,2)}function JL(e,r){return ro(e.getUTCHours()%12||12,r,2)}function eN(e,r){return ro(1+S1.count(tm(e),e),r,3)}function rT(e,r){return ro(e.getUTCMilliseconds(),r,3)}function tN(e,r){return rT(e,r)+"000"}function rN(e,r){return ro(e.getUTCMonth()+1,r,2)}function nN(e,r){return ro(e.getUTCMinutes(),r,2)}function iN(e,r){return ro(e.getUTCSeconds(),r,2)}function aN(e){var r=e.getUTCDay();return r===0?7:r}function oN(e,r){return ro(E1.count(tm(e)-1,e),r,2)}function nT(e){var r=e.getUTCDay();return r>=4||r===0?em(e):em.ceil(e)}function sN(e,r){return e=nT(e),ro(em.count(tm(e),e)+(tm(e).getUTCDay()===4),r,2)}function uN(e){return e.getUTCDay()}function lN(e,r){return ro(o0.count(tm(e)-1,e),r,2)}function cN(e,r){return ro(e.getUTCFullYear()%100,r,2)}function fN(e,r){return e=nT(e),ro(e.getUTCFullYear()%100,r,2)}function hN(e,r){return ro(e.getUTCFullYear()%1e4,r,4)}function pN(e,r){var t=e.getUTCDay();return e=t>=4||t===0?em(e):em.ceil(e),ro(e.getUTCFullYear()%1e4,r,4)}function dN(){return"+0000"}function iT(){return"%"}function aT(e){return+e}function oT(e){return Math.floor(+e/1e3)}var rm,sT,vN,uT,mN;gN({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function gN(e){return rm=vL(e),sT=rm.format,vN=rm.parse,uT=rm.utcFormat,mN=rm.utcParse,rm}var bg=1e3,xg=bg*60,Eg=xg*60,Sg=Eg*24,yN=Sg*7,lT=Sg*30,w1=Sg*365;function _N(e){return new Date(e)}function bN(e){return e instanceof Date?+e:+new Date(+e)}function O1(e,r,t,n,i,a,o,l,c){var p=gA(Pu,Pu),_=p.invert,x=p.domain,A=c(".%L"),w=c(":%S"),I=c("%I:%M"),P=c("%I %p"),H=c("%a %d"),W=c("%b %d"),oe=c("%B"),ce=c("%Y"),Oe=[[o,1,bg],[o,5,5*bg],[o,15,15*bg],[o,30,30*bg],[a,1,xg],[a,5,5*xg],[a,15,15*xg],[a,30,30*xg],[i,1,Eg],[i,3,3*Eg],[i,6,6*Eg],[i,12,12*Eg],[n,1,Sg],[n,2,2*Sg],[t,1,yN],[r,1,lT],[r,3,3*lT],[e,1,w1]];function Fe(tt){return(o(tt)<tt?A:a(tt)<tt?w:i(tt)<tt?I:n(tt)<tt?P:r(tt)<tt?t(tt)<tt?H:W:e(tt)<tt?oe:ce)(tt)}function je(tt,vt,kt,ir){if(tt==null&&(tt=10),typeof tt=="number"){var ur=Math.abs(kt-vt)/tt,Zr=QS(function(ln){return ln[2]}).right(Oe,ur);Zr===Oe.length?(ir=Xy(vt/w1,kt/w1,tt),tt=e):Zr?(Zr=Oe[ur/Oe[Zr-1][2]<Oe[Zr][2]/ur?Zr-1:Zr],ir=Zr[1],tt=Zr[0]):(ir=Math.max(Xy(vt,kt,tt),1),tt=l)}return ir==null?tt:tt.every(ir)}return p.invert=function(tt){return new Date(_(tt))},p.domain=function(tt){return arguments.length?x(Ky.call(tt,bN)):x().map(_N)},p.ticks=function(tt,vt){var kt=x(),ir=kt[0],ur=kt[kt.length-1],Zr=ur<ir,ln;return Zr&&(ln=ir,ir=ur,ur=ln),ln=je(tt,ir,ur,vt),ln=ln?ln.range(ir,ur+1):[],Zr?ln.reverse():ln},p.tickFormat=function(tt,vt){return vt==null?Fe:c(vt)},p.nice=function(tt,vt){var kt=x();return(tt=je(tt,kt[0],kt[kt.length-1],vt))?x(CA(kt,tt)):p},p.copy=function(){return mg(p,O1(e,r,t,n,i,a,o,l,c))},p}var xN=function(){return If.apply(O1(Qv,iL,b1,x1,lL,cL,WA,GA,sT).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},cT=_u(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCMonth(e.getUTCMonth()+r)},function(e,r){return r.getUTCMonth()-e.getUTCMonth()+(r.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),EN=cT,JW=cT.range,fT=_u(function(e){e.setUTCMinutes(0,0,0)},function(e,r){e.setTime(+e+r*n0)},function(e,r){return(r-e)/n0},function(e){return e.getUTCHours()}),SN=fT,eG=fT.range,hT=_u(function(e){e.setUTCSeconds(0,0)},function(e,r){e.setTime(+e+r*$d)},function(e,r){return(r-e)/$d},function(e){return e.getUTCMinutes()}),AN=hT,tG=hT.range,rG=function(){return If.apply(O1(tm,EN,E1,S1,SN,AN,WA,GA,uT).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)};function s0(){var e=0,r=1,t,n,i,a,o=Pu,l=!1,c;function p(_){return isNaN(_=+_)?c:o(i===0?.5:(_=(a(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}return p.domain=function(_){return arguments.length?(t=a(e=+_[0]),n=a(r=+_[1]),i=t===n?0:1/(n-t),p):[e,r]},p.clamp=function(_){return arguments.length?(l=!!_,p):l},p.interpolator=function(_){return arguments.length?(o=_,p):o},p.unknown=function(_){return arguments.length?(c=_,p):c},function(_){return a=_,t=_(e),n=_(r),i=t===n?0:1/(n-t),p}}function qp(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function pT(){var e=Zd(s0()(Pu));return e.copy=function(){return qp(e,pT())},tp.apply(e,arguments)}function TN(){var e=p1(s0()).domain([1,10]);return e.copy=function(){return qp(e,TN()).base(e.base())},tp.apply(e,arguments)}function CN(){var e=d1(s0());return e.copy=function(){return qp(e,CN()).constant(e.constant())},tp.apply(e,arguments)}function dT(){var e=v1(s0());return e.copy=function(){return qp(e,dT()).exponent(e.exponent())},tp.apply(e,arguments)}function nG(){return dT.apply(null,arguments).exponent(.5)}function wN(){var e=[],r=Pu;function t(n){if(!isNaN(n=+n))return r((Kv(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,o;i<a;++i)o=n[i],o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Wd),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return wN(r).domain(e)},tp.apply(t,arguments)}function u0(){var e=0,r=.5,t=1,n,i,a,o,l,c=Pu,p,_=!1,x;function A(w){return isNaN(w=+w)?x:(w=.5+((w=+p(w))-i)*(w<i?o:l),c(_?Math.max(0,Math.min(1,w)):w))}return A.domain=function(w){return arguments.length?(n=p(e=+w[0]),i=p(r=+w[1]),a=p(t=+w[2]),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A):[e,r,t]},A.clamp=function(w){return arguments.length?(_=!!w,A):_},A.interpolator=function(w){return arguments.length?(c=w,A):c},A.unknown=function(w){return arguments.length?(x=w,A):x},function(w){return p=w,n=w(e),i=w(r),a=w(t),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),A}}function vT(){var e=Zd(u0()(Pu));return e.copy=function(){return qp(e,vT())},tp.apply(e,arguments)}function ON(){var e=p1(u0()).domain([.1,1,10]);return e.copy=function(){return qp(e,ON()).base(e.base())},tp.apply(e,arguments)}function RN(){var e=d1(u0());return e.copy=function(){return qp(e,RN()).constant(e.constant())},tp.apply(e,arguments)}function mT(){var e=v1(u0());return e.copy=function(){return qp(e,mT()).exponent(e.exponent())},tp.apply(e,arguments)}function iG(){return mT.apply(null,arguments).exponent(.5)}function gT(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return gT(e).unknown(r)},n}var xc,yT,_T,R1=fi.isNil,MN=fi.isString,PN=fi.uniq,IN=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,DN=(xc={},Object(V.a)(xc,vo.LINEAR,TA),Object(V.a)(xc,vo.POWER,m1),Object(V.a)(xc,vo.LOG,MA),Object(V.a)(xc,vo.IDENTITY,gT),Object(V.a)(xc,vo.SEQUENTIAL,pT),Object(V.a)(xc,vo.TIME,xN),Object(V.a)(xc,vo.QUANTILE,kA),Object(V.a)(xc,vo.QUANTIZE,FA),Object(V.a)(xc,vo.THRESHOLD,BA),Object(V.a)(xc,vo.CAT,vg),Object(V.a)(xc,vo.DIVERGING,vT),xc),kN=(yT=Object(Qr.injectable)(),yT(_T=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"scaleOptions",{})}return Object(De.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",Object(Zt.a)(be.a.mark(function o(){var l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(t.log(Vs.ScaleInitStart,su.INIT),i.scaleOptions=t.getScaleOptions(),c=a.getLayerStyleAttributes(),p=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(p)&&p.length===0)){x.next=8;break}return x.abrupt("return");case 8:i.caculateScalesForAttributes(c||[],p);case 9:t.log(Vs.ScaleInitEnd,su.INIT);case 10:case"end":return x.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var o=Object(Zt.a)(be.a.mark(function l(c){var p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(c){A.next=2;break}return A.abrupt("return",c);case 2:if(t.log(Vs.ScaleInitStart,su.UPDATE),i.scaleOptions=t.getScaleOptions(),p=a.getLayerStyleAttributes(),_=t.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){A.next=8;break}return A.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(p||[],_),t.log(Vs.ScaleInitEnd,su.UPDATE),t.layerModelNeedUpdate=!0,A.abrupt("return",!0);case 12:case"end":return A.stop()}},l)}));return function(l){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&o){var c=o.filter(function(p){return p.needRescale});c.length&&i.caculateScalesForAttributes(c,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var o=a.scale,l=a.scale.field;o.names=i.parseFields(R1(l)?[]:l);var c=[];o.names.forEach(function(p){var _;c.push(i.createScale(p,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),c.some(function(p){return p.type===Hv.VARIABLE})?(o.type=Hv.VARIABLE,c.forEach(function(p){if(!o.callback&&o.values!=="text"){var _;switch((_=p.option)===null||_===void 0?void 0:_.type){case vo.LOG:case vo.LINEAR:case vo.POWER:if(o.values&&o.values.length>2){var x=p.scale.ticks(o.values.length);p.scale.domain(x)}o.values?p.scale.range(o.values):p.scale.range(p.option.domain);break;case vo.QUANTILE:case vo.QUANTIZE:case vo.THRESHOLD:p.scale.range(o.values);break;case vo.IDENTITY:break;case vo.CAT:o.values?p.scale.range(o.values):p.scale.range(p.option.domain);break;case vo.DIVERGING:case vo.SEQUENTIAL:p.scale.interpolator(pB(o.values));break}}if(o.values==="text"){var A;p.scale.range((A=p.option)===null||A===void 0?void 0:A.domain)}})):(o.type=Hv.CONSTANT,o.defaultValues=c.map(function(p,_){return p.scale(o.names[_])})),o.scalers=c.map(function(p){return{field:p.field,func:p.scale,option:p.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:MN(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var o,l,c=this.scaleOptions[n]&&((o=this.scaleOptions[n])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],p={field:t,scale:void 0,type:Hv.VARIABLE,option:c};if(!a||!a.length)return c&&c.type?p.scale=this.createDefaultScale(c):(p.scale=vg([t]),p.type=Hv.CONSTANT),p;var _=(l=a.find(function(w){return!R1(w[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||R1(_)&&!c)p.scale=vg([t]),p.type=Hv.CONSTANT;else{var x=c&&c.type||this.getDefaultType(_);i==="text"&&(x=vo.CAT),i===void 0&&(x=vo.IDENTITY);var A=this.createScaleConfig(x,t,c,a);p.scale=this.createDefaultScale(A),p.option=A}return p}},{key:"getDefaultType",value:function(t){var n=vo.LINEAR;return typeof t=="string"&&(n=IN.test(t)?vo.TIME:vo.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var o={type:t},l=(a==null?void 0:a.map(function(_){return _[n]}))||[];if(i!=null&&i.domain)o.domain=i==null?void 0:i.domain;else if(t===vo.CAT||t===vo.IDENTITY)o.domain=PN(l);else if(t===vo.QUANTILE)o.domain=l;else if(t===vo.DIVERGING){var c=Q_(l),p=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(c[0]+c[1])/2;o.domain=[c[0],p,c[1]]}else o.domain=Q_(l);return Object(ae.a)(Object(ae.a)({},o),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,o=t.clamp,l=t.nice,c=DN[n]();return i&&c.domain&&c.domain(i),a&&c.unknown(a),o!==void 0&&c.clamp&&c.clamp(o),l!==void 0&&c.nice&&c.nice(l),c}}]),e}())||_T),bT,xT,FN=(bT=Object(Qr.injectable)(),bT(xT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms(Object(ae.a)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||xT),ET,ST,BN=(ET=Object(Qr.injectable)(),ET(ST=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var o;(o=t.masks).push.apply(o,Object(cr.a)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||ST),LN=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;Object(et.a)(this,e),Object(V.a)(this,"tileResource",new Map),Object(V.a)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return Object(De.a)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var o=n.getTile(a==null?void 0:a.key);return o?(o==null?void 0:o.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){var i=this,a,o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getRenderLayers(),o=a.map(function(){var p=Object(Zt.a)(be.a.mark(function _(x){return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,i.layerService.renderTileLayer(x);case 2:case"end":return w.stop()}},_)}));return function(_){return p.apply(this,arguments)}}()),c.next=4,Promise.all(o);case 4:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,Object(cr.a)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,Object(cr.a)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),NN=C("3L5V"),jN=C.n(NN);function zN(e,r,t){t===void 0&&(t={});var n=Si(e),i=Si(r),a=jN.a.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?Nn(a[0],t.properties):Ir(a,t.properties)}var UN=zN,VN=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var o=Nn(a.coordinates);n===null?n=o:n=UN(n,o)}),i&&(n.properties=Object(ae.a)({},i)),n}}]),e}(),Ag="select",Tg="active",HN=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;Object(et.a)(this,e),Object(V.a)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new VN}return Object(De.a)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var i=this.parent.getContainer(),a=i.get(Yt.IPickingService);if(t.type==="RasterLayer"){var o=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(o&&o.getMainLayer()!==void 0){var l=o.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=Object(hn.a)(t,3),i=n[0],a=n[1],o=n[2],l=this.color2PickId(i,a,o);this.tilePickID.set(Ag,l),this.updateHighLight(i,a,o,Ag)}},{key:"highlightPickedFeature",value:function(t){var n=Object(hn.a)(t,3),i=n[0],a=n[1],o=n[2],l=this.color2PickId(i,a,o);this.tilePickID.set(Tg,l),this.updateHighLight(i,a,o,Tg)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(o){var l=o.getMainLayer();switch(a){case Ag:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case Tg:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(Ag),n=this.tilePickID.get(Tg);if(t){var i=this.pickId2Color(t),a=Object(hn.a)(i,3),o=a[0],l=a[1],c=a[2];this.updateHighLight(o,l,c,Ag);return}if(n){var p=this.pickId2Color(n),_=Object(hn.a)(p,3),x=_[0],A=_[1],w=_[2];this.updateHighLight(x,A,w,Tg);return}}},{key:"color2PickId",value:function(t,n,i){return zu(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return Uu(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,Object(cr.a)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function WN(e){return e==="PolygonLayer"?jy:e==="LineLayer"?K_:Ny}function GN(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function XN(e){var r=ZN();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function ZN(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qd=function(e){Object(Lt.a)(t,e);var r=XN(t);function t(n,i){var a;return Object(et.a)(this,t),a=r.call(this),Object(V.a)(Object(Be.a)(a),"visible",!0),Object(V.a)(Object(Be.a)(a),"layers",[]),Object(V.a)(Object(Be.a)(a),"isLoaded",!1),Object(V.a)(Object(Be.a)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return Object(De.a)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=Object(hn.a)(this.sourceTile.bounds,4),o=a[0],l=a[1],c=a[2],p=a[3],_=i.lng,x=i.lat;return _>=o&&_<=c&&x>=l&&x<=p}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return Object(ae.a)(Object(ae.a)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:GN(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),o=a.maskLayers,l=[];return o==null||o.forEach(function(c){if(!c.tileLayer)return l.push(c),c;var p=c.tileLayer,_=p.getTile(i.sourceTile.key),x=_==null?void 0:_.getLayers()[0];x&&l.push(x)}),l}},{key:"addTileMask",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return o=new jy({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=sg(this.parent.sceneContainer),o.setContainer(l,this.parent.sceneContainer),_.next=5,o.init();case 5:return this.tileMask=o,c=this.getMainLayer(),c!==void 0&&(c.tileMask=o),_.abrupt("return",o);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o,l){var c;return be.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return c=sg(this.parent.sceneContainer),l.setContainer(c,this.parent.sceneContainer),_.next=4,l.init();case 4:o.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(o){var l;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return o.isTileLayer=!0,l=sg(this.parent.sceneContainer),o.setContainer(l,this.parent.sceneContainer),this.layers.push(o),p.next=6,o.init();case 6:case"end":return p.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(o){o.updateLayerConfig(Object(V.a)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(Po.EventEmitter);function $N(e){var r=YN();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function YN(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KN=function(e){Object(Lt.a)(t,e);var r=$N(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.getSourceOption(),l=o.data.features[0].properties,c=new K_().source(o.data,o.options).size(1).shape("line").color("red"),p=new Ny({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),x.next=6,this.addLayer(c);case 6:return x.next=8,this.addLayer(p);case 8:this.isLoaded=!0;case 9:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(qd);function qN(e){var r=QN();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function QN(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JN=function(e){Object(Lt.a)(t,e);var r=qN(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new uS(Object(ae.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(A){var w,I,P=A;p[P]((w=o[P])===null||w===void 0?void 0:w.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(qd);function e6(e){var r=t6();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function t6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r6=function(e){Object(Lt.a)(t,e);var r=e6(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new FS(Object(ae.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(A){var w,I,P=A;p[P]((w=o[P])===null||w===void 0?void 0:w.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),o=a.sourceLayer,l=a.featureId,c=this.getFeatures(o);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(qd),n6=["rasterData"];function i6(e){var r=a6();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function a6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o6=function(e){Object(Lt.a)(t,e);var r=i6(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new zy(Object(ae.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(A){var w,I,P=A;p[P]((w=o[P])===null||w===void 0?void 0:w.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,o=a.rasterData,l=Object(vh.a)(a,n6);return{data:o,options:{parser:Object(ae.a)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(qd);function s6(e){var r=u6();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function u6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l6=function(e){Object(Lt.a)(t,e);var r=s6(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p;return be.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=new zy(Object(ae.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(A){var w,I,P=A;p[P]((w=o[P])===null||w===void 0?void 0:w.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(p);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(qd),c6=["rasterData"];function f6(e){var r=h6();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function h6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p6={positions:[0,1],colors:["#000","#fff"]},d6=function(e){Object(Lt.a)(t,e);var r=f6(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_,x,A;return be.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),p=this.getLayerOptions(),_=p.rampColors,x=p.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,x),A=new zy(Object(ae.a)(Object(ae.a)({},l),{},{colorTexture:this.colorTexture})).source(c.data,c.options),o&&Object.keys(o).forEach(function(P){var H,W,oe=P;A[oe]((H=o[oe])===null||H===void 0?void 0:H.field,(W=o[oe])===null||W===void 0?void 0:W.values)}),I.next=9,this.addLayer(A);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,o=a.rasterData,l=Object(vh.a)(a,c6);return{data:o,options:{parser:Object(ae.a)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];var c=o,p=c.rampColors,_=p===void 0?p6:p,x=c.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,x||wh(_)),this.layers.forEach(function(A){return A.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(qd);function v6(e){var r=m6();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function m6(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l0=function(e){Object(Lt.a)(t,e);var r=v6(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Zt.a)(be.a.mark(function a(){var o,l,c,p,_;return be.a.wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=WN(this.parent.type),p=this.getSourceOption(),p){A.next=8;break}return this.isLoaded=!0,this.emit("loaded"),A.abrupt("return");case 8:return _=new c(Object(ae.a)({},l)).source(p.data,p.options),Object.keys(o).forEach(function(w){var I,P,H=w;_[H]((I=o[H])===null||I===void 0?void 0:I.field,(P=o[H])===null||P===void 0?void 0:P.values)}),A.next=12,this.addLayer(_);case 12:if(!l.tileMask){A.next=15;break}return A.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return A.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),o=a.sourceLayer,l=o===void 0?"defaultLayer":o,c=a.featureId,p=c===void 0?"id":c,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:p},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var o=a.getSource().data.dataArray.filter(function(l){return l._id===i});return o}}]),t}(qd);function g6(e){var r=e.type;switch(r){case"PolygonLayer":return l0;case"LineLayer":return l0;case"PointLayer":return l0;case"TileDebugLayer":return KN;case"MaskLayer":return r6;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Ru.RGB:case Ru.CUSTOMRGB:return o6;case Ru.ARRAYBUFFER:case Ru.CUSTOMARRAYBUFFER:return d6;case Ru.TERRAINRGB:case Ru.CUSTOMTERRAINRGB:return l6;default:return JN}default:return l0}}var y6=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],_6=fi.debounce,AT=function(){function e(r){var t=this;Object(et.a)(this,e),Object(V.a)(this,"initedTileset",!1),Object(V.a)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),o=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var c=t.parent.getLayerConfig(),p=c.visible;l<2&&p?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!p&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===o.toString()||(t.lastViewStates={zoom:l,latLonBounds:o},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,o))}}),Object(V.a)(this,"viewchange",_6(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(Yt.IRendererService),this.layerService=n.get(Yt.ILayerService),this.mapService=n.get(Yt.IMapService),this.pickingService=n.get(Yt.IPickingService),this.tileLayerService=new LN({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new HN({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return Object(De.a)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,o=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){var i=this,a,o;return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.tilesetManager){c.next=2;break}return c.abrupt("return");case 2:return a=this.parent.getMinZoom(),o=this.parent.getMaxZoom(),c.next=6,Promise.all(this.tilesetManager.tiles.filter(function(p){return p.isLoaded}).filter(function(p){return p.isVisibleChange}).filter(function(p){return p.data}).filter(function(p){return p.z>=a&&p.z<o}).map(function(){var p=Object(Zt.a)(be.a.mark(function _(x){var A,w;return be.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i.tileLayerService.hasTile(x.key)){P.next=9;break}return A=g6(i.parent),w=new A(x,i.parent),P.next=5,w.initTileLayer();case 5:i.tilePickService.setPickState(),w.getLayers().length!==0&&(i.tileLayerService.addTile(w),i.tileLayerService.updateTileVisible(x),i.layerService.reRender()),P.next=12;break;case 9:i.tileLayerService.updateTileVisible(x),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return P.stop()}},_)}));return function(_){return p.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;y6.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return a.apply(void 0,l),n.getLayers().map(function(p){p[i].apply(p,l)}),i==="style"&&n.getTiles().forEach(function(p){return p.styleUpdate.apply(p,l)}),t}})}}]),e}(),TT,CT,b6=(TT=Object(Qr.injectable)(),TT(CT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"build",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i.prepareBuildModel(),o.next=3,i.buildModels();case 3:case"end":return o.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",Object(Zt.a)(be.a.mark(function i(){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!t.getSource().isTile){o.next=4;break}return t.prepareBuildModel(),t.tileLayer=new AT(t),o.abrupt("return");case 4:return t.log(Vs.BuildModelStart,su.INIT),o.next=7,n.initLayerModel(t);case 7:t.log(Vs.BuildModelEnd,su.INIT);case 8:case"end":return o.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=Object(Zt.a)(be.a.mark(function a(o){return be.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o){c.next=2;break}return c.abrupt("return",!1);case 2:if(!t.getSource().isTile){c.next=5;break}return t.tileLayer=new AT(t),c.abrupt("return",!1);case 5:return t.log(Vs.BuildModelStart,su.UPDATE),c.next=8,n.prepareLayerModel(t);case 8:return t.log(Vs.BuildModelEnd,su.UPDATE),c.abrupt("return",!0);case 10:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||CT),wT,OT,x6=(wT=Object(Qr.injectable)(),wT(OT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||OT),RT,MT,E6=["type"],PT={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},S6={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},A6={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},T6={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function C6(e){var r={u_DirectionalLights:new Array(3).fill(Object(ae.a)({},A6)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Object(ae.a)({},T6)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[S6]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=Object(vh.a)(t,E6),o=PT[i].lights,l=PT[i].num,c=r[l];r[o][c]=Object(ae.a)(Object(ae.a)({},r[o][c]),a),r[l]++}),r}var w6=(RT=Object(Qr.injectable)(),RT(MT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms(Object(ae.a)({},C6()))})})}}]),e}())||MT),IT,DT,O6=(IT=Object(Qr.injectable)(),IT(DT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var c=t.getLayerConfig(),p=c.enableMultiPassRenderer,_=c.passes,x=_===void 0?[]:_;i.enabled=!!p&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=k2(t,x,o,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=a.getViewportSize(),p=c.width,_=c.height;t.multiPassRenderer.resize(p,_)}})}}]),e}())||DT),kT,FT,nm={NONE:0,ENCODE:1,HIGHLIGHT:2},R6=(kT=Object(Qr.injectable)(),kT(FT=function(){function e(){Object(et.a)(this,e),Object(V.a)(this,"PickOption",{u_HighlightColor:[1,0,0,1],u_SelectColor:[1,0,0,1],u_PickingColor:[0,0,0],u_PickingStage:0,u_CurrentSelectedId:[0,0,0],u_PickingThreshold:10,u_PickingBuffer:0,u_shaderPick:0,u_EnableSelect:0,u_activeMix:0})}return Object(De.a)(e,[{key:"pickOption2Array",value:function(){return Object.values(this.PickOption).flat()}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(a){i.PickOption[a]=t[a]}),n.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array(this.pickOption2Array()))})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.styleAttributeService;if(!a.uniformBuffers[1]){var l=a.createBuffer({data:new Float32Array(this.pickOption2Array().length),isUBO:!0});a.uniformBuffers[1]=l,this.updatePickOption({},a)}t.hooks.init.tapPromise("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;o.registerStyleAttribute({name:"pickingColor",type:wn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Hs.PICKING_COLOR,buffer:{data:[],type:Y.FLOAT},size:3,update:function(x){var A=x.id;return p?Uu(A):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;p&&t.isVisible()&&(i.updatePickOption({u_PickingStage:nm.ENCODE},a),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:nm.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),p=c.enablePicking;p&&t.isVisible()&&(i.updatePickOption({u_PickingStage:nm.HIGHLIGHT},a),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:nm.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(c){var p=t.getLayerConfig(),_=p.highlightColor,x=p.activeMix,A=x===void 0?0:x,w=typeof _=="string"?Ui(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:zu(new Uint8Array(c))});var I={u_PickingStage:nm.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A};i.updatePickOption(I,a),t.models.forEach(function(P){return P.addUniforms(I)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(c){var p=t.getLayerConfig(),_=p.selectColor,x=p.selectMix,A=x===void 0?0:x,w=typeof _=="string"?Ui(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:zu(new Uint8Array(c))});var I={u_PickingStage:nm.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:w.map(function(P){return P*255}),u_activeMix:A,u_CurrentSelectedId:c,u_SelectColor:w.map(function(P){return P*255}),u_EnableSelect:1};console.log(I),i.updatePickOption(I,a),t.models.forEach(function(P){return P.addUniforms(I)})})}}]),e}())||FT),M6=["mvt","geojsonvt","testTile"];function P6(e){var r=e.getSource();return M6.includes(r.parser.type)}function aG(e){return e.getContext?{width:e.width/D.DPR,height:e.height/D.DPR}:e.getBoundingClientRect()}var BT,LT,I6=(BT=Object(Qr.injectable)(),BT(LT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){P6(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:wn.Attribute,descriptor:{name:"a_Position",shaderLocation:Hs.POSITION,buffer:{data:[],type:Y.FLOAT},size:3,update:function(i,a,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:wn.Attribute,descriptor:{name:"a_Color",shaderLocation:Hs.COLOR,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:wn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Hs.VERTEX_ID,buffer:{usage:Y.DYNAMIC_DRAW,data:[],type:Y.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||LT),NT,jT,zT,UT,VT,HT,WT,Qd,GT,XT,ZT,$T,YT,D6=(NT=Object(Qr.injectable)(),jT=Object(Qr.inject)(Yt.ICameraService),zT=Object(Qr.inject)(Yt.ICoordinateSystemService),UT=Object(Qr.inject)(Yt.IRendererService),VT=Object(Qr.inject)(Yt.IMapService),HT=Object(Qr.inject)(Yt.ILayerService),NT(WT=(Qd=function(){function e(){Object(et.a)(this,e),ma(this,"cameraService",GT,this),ma(this,"coordinateSystemService",XT,this),ma(this,"rendererService",ZT,this),ma(this,"mapService",$T,this),ma(this,"layerService",YT,this)}return Object(De.a)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*5+4*6+4),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(c),i==="GAODE2.x"&&(n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter());var p=n.rendererService.getViewportSize(),_=p.width,x=p.height,A=n.generateUBO(a,o,_,x),w=A.data,I=A.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:w}),t.models.forEach(function(P){P.addUniforms(Object(ae.a)(Object(ae.a)({},I),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var o,l=this.cameraService.getProjectionMatrix(),c=this.cameraService.getViewMatrix(),p=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),x=this.coordinateSystemService.getViewportCenterProjection(),A=this.coordinateSystemService.getPixelsPerDegree(),w=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),P=this.cameraService.getZoomScale(),H=this.coordinateSystemService.getPixelsPerMeter(),W=this.coordinateSystemService.getCoordinateSystem(),oe=this.cameraService.getCameraPosition(),ce=window.devicePixelRatio,Oe=this.coordinateSystemService.getViewportCenter(),Fe=[i,a],je=this.cameraService.getFocalDistance(),tt=[].concat(Object(cr.a)(c),Object(cr.a)(l),Object(cr.a)(p),Object(cr.a)(_),Object(cr.a)(t),Object(cr.a)(x),Object(cr.a)(A),[w],Object(cr.a)(I),[P],Object(cr.a)(H),[W],Object(cr.a)(oe),[ce],Object(cr.a)(Oe),Fe,Object(cr.a)(n),[je,0]);return{data:tt,uniforms:(o={},Object(V.a)(o,Vd.ProjectionMatrix,l),Object(V.a)(o,Vd.ViewMatrix,c),Object(V.a)(o,Vd.ViewProjectionMatrix,p),Object(V.a)(o,Vd.Zoom,w),Object(V.a)(o,Vd.ZoomScale,P),Object(V.a)(o,Vd.FocalDistance,je),Object(V.a)(o,Vd.CameraPosition,oe),Object(V.a)(o,zd.CoordinateSystem,W),Object(V.a)(o,zd.ViewportCenter,Oe),Object(V.a)(o,zd.ViewportCenterProjection,x),Object(V.a)(o,zd.PixelsPerDegree,A),Object(V.a)(o,zd.PixelsPerDegree2,I),Object(V.a)(o,zd.PixelsPerMeter,H),Object(V.a)(o,zd.Mvp,t),Object(V.a)(o,"u_sceneCenterMercator",n),Object(V.a)(o,"u_ViewportSize",Fe),Object(V.a)(o,"u_ModelMatrix",_),Object(V.a)(o,"u_DevicePixelRatio",ce),o)}}}]),e}(),GT=da(Qd.prototype,"cameraService",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XT=da(Qd.prototype,"coordinateSystemService",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=da(Qd.prototype,"rendererService",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$T=da(Qd.prototype,"mapService",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YT=da(Qd.prototype,"layerService",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd))||WT),KT,qT,k6=(KT=Object(Qr.injectable)(),KT(qT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||qT),QT,JT,F6=(QT=Object(Qr.injectable)(),QT(JT=function(){function e(){Object(et.a)(this,e)}return Object(De.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter");if(o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){i.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),e}())||JT);Kl.bind(Yt.ILayerPlugin).to(XF).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(I6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(kN).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(GF).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(x6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(BN).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(F6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(k6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(O6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(D6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(FN).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(w6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(R6).inRequestScope(),Kl.bind(Yt.ILayerPlugin).to(b6).inRequestScope();var B6=C("fbvF"),L6=C.n(B6),N6=function(){function e(r,t){Object(et.a)(this,e);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,l=t.size,c=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:c||0},l&&(this.attribute.size=l)}return Object(De.a)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),rp,Cg,Qp,tf,wg,Jp,Og,c0,mh,Jd,Iu,gh,yh,f0,j6=(rp={},Object(V.a)(rp,Y.POINTS,"points"),Object(V.a)(rp,Y.LINES,"lines"),Object(V.a)(rp,Y.LINE_LOOP,"line loop"),Object(V.a)(rp,Y.LINE_STRIP,"line strip"),Object(V.a)(rp,Y.TRIANGLES,"triangles"),Object(V.a)(rp,Y.TRIANGLE_FAN,"triangle fan"),Object(V.a)(rp,Y.TRIANGLE_STRIP,"triangle strip"),rp),eC=(Cg={},Object(V.a)(Cg,Y.STATIC_DRAW,"static"),Object(V.a)(Cg,Y.DYNAMIC_DRAW,"dynamic"),Object(V.a)(Cg,Y.STREAM_DRAW,"stream"),Cg),M1=(Qp={},Object(V.a)(Qp,Y.BYTE,"int8"),Object(V.a)(Qp,Y.INT,"int32"),Object(V.a)(Qp,Y.UNSIGNED_BYTE,"uint8"),Object(V.a)(Qp,Y.UNSIGNED_SHORT,"uint16"),Object(V.a)(Qp,Y.UNSIGNED_INT,"uint32"),Object(V.a)(Qp,Y.FLOAT,"float"),Qp),z6=(tf={},Object(V.a)(tf,Y.ALPHA,"alpha"),Object(V.a)(tf,Y.LUMINANCE,"luminance"),Object(V.a)(tf,Y.LUMINANCE_ALPHA,"luminance alpha"),Object(V.a)(tf,Y.RGB,"rgb"),Object(V.a)(tf,Y.RGBA,"rgba"),Object(V.a)(tf,Y.RGBA4,"rgba4"),Object(V.a)(tf,Y.RGB5_A1,"rgb5 a1"),Object(V.a)(tf,Y.RGB565,"rgb565"),Object(V.a)(tf,Y.DEPTH_COMPONENT,"depth"),Object(V.a)(tf,Y.DEPTH_STENCIL,"depth stencil"),tf),U6=(wg={},Object(V.a)(wg,Y.DONT_CARE,"dont care"),Object(V.a)(wg,Y.NICEST,"nice"),Object(V.a)(wg,Y.FASTEST,"fast"),wg),tC=(Jp={},Object(V.a)(Jp,Y.NEAREST,"nearest"),Object(V.a)(Jp,Y.LINEAR,"linear"),Object(V.a)(Jp,Y.LINEAR_MIPMAP_LINEAR,"mipmap"),Object(V.a)(Jp,Y.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Object(V.a)(Jp,Y.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Object(V.a)(Jp,Y.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Jp),rC=(Og={},Object(V.a)(Og,Y.REPEAT,"repeat"),Object(V.a)(Og,Y.CLAMP_TO_EDGE,"clamp"),Object(V.a)(Og,Y.MIRRORED_REPEAT,"mirror"),Og),V6=(c0={},Object(V.a)(c0,Y.NONE,"none"),Object(V.a)(c0,Y.BROWSER_DEFAULT_WEBGL,"browser"),c0),H6=(mh={},Object(V.a)(mh,Y.NEVER,"never"),Object(V.a)(mh,Y.ALWAYS,"always"),Object(V.a)(mh,Y.LESS,"less"),Object(V.a)(mh,Y.LEQUAL,"lequal"),Object(V.a)(mh,Y.GREATER,"greater"),Object(V.a)(mh,Y.GEQUAL,"gequal"),Object(V.a)(mh,Y.EQUAL,"equal"),Object(V.a)(mh,Y.NOTEQUAL,"notequal"),mh),nC=(Jd={},Object(V.a)(Jd,Y.FUNC_ADD,"add"),Object(V.a)(Jd,Y.MIN_EXT,"min"),Object(V.a)(Jd,Y.MAX_EXT,"max"),Object(V.a)(Jd,Y.FUNC_SUBTRACT,"subtract"),Object(V.a)(Jd,Y.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Jd),h0=(Iu={},Object(V.a)(Iu,Y.ZERO,"zero"),Object(V.a)(Iu,Y.ONE,"one"),Object(V.a)(Iu,Y.SRC_COLOR,"src color"),Object(V.a)(Iu,Y.ONE_MINUS_SRC_COLOR,"one minus src color"),Object(V.a)(Iu,Y.SRC_ALPHA,"src alpha"),Object(V.a)(Iu,Y.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Object(V.a)(Iu,Y.DST_COLOR,"dst color"),Object(V.a)(Iu,Y.ONE_MINUS_DST_COLOR,"one minus dst color"),Object(V.a)(Iu,Y.DST_ALPHA,"dst alpha"),Object(V.a)(Iu,Y.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Object(V.a)(Iu,Y.CONSTANT_COLOR,"constant color"),Object(V.a)(Iu,Y.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Object(V.a)(Iu,Y.CONSTANT_ALPHA,"constant alpha"),Object(V.a)(Iu,Y.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Object(V.a)(Iu,Y.SRC_ALPHA_SATURATE,"src alpha saturate"),Iu),W6=(gh={},Object(V.a)(gh,Y.NEVER,"never"),Object(V.a)(gh,Y.ALWAYS,"always"),Object(V.a)(gh,Y.LESS,"less"),Object(V.a)(gh,Y.LEQUAL,"lequal"),Object(V.a)(gh,Y.GREATER,"greater"),Object(V.a)(gh,Y.GEQUAL,"gequal"),Object(V.a)(gh,Y.EQUAL,"equal"),Object(V.a)(gh,Y.NOTEQUAL,"notequal"),gh),im=(yh={},Object(V.a)(yh,Y.ZERO,"zero"),Object(V.a)(yh,Y.KEEP,"keep"),Object(V.a)(yh,Y.REPLACE,"replace"),Object(V.a)(yh,Y.INVERT,"invert"),Object(V.a)(yh,Y.INCR,"increment"),Object(V.a)(yh,Y.DECR,"decrement"),Object(V.a)(yh,Y.INCR_WRAP,"increment wrap"),Object(V.a)(yh,Y.DECR_WRAP,"decrement wrap"),yh),G6=(f0={},Object(V.a)(f0,Y.FRONT,"front"),Object(V.a)(f0,Y.BACK,"back"),f0),X6=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:eC[i||Y.STATIC_DRAW],type:M1[a||Y.UNSIGNED_BYTE]})}return Object(De.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),Z6=function(){function e(r,t){Object(et.a)(this,e);var n=t.data,i=t.usage,a=t.type,o=t.count;this.elements=r.elements({data:n,usage:eC[i||Y.STATIC_DRAW],type:M1[a||Y.UNSIGNED_BYTE],count:o})}return Object(De.a)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),$6=function(){function e(r,t){Object(et.a)(this,e);var n=t.width,i=t.height,a=t.color,o=t.colors,l={width:n,height:i};Array.isArray(o)&&(l.colors=o.map(function(c){return c.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return Object(De.a)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),iC=C("9og8"),Y6=C("fWQN"),K6=C("mtLc"),q6=C("WmNS"),p0=C.n(q6),Q6=function(r){return r==null},rf=Q6,J6={}.toString,e7=function(r,t){return J6.call(r)==="[object "+t+"]"},t7=e7,r7=function(r){return t7(r,"Number")},am=r7,n7=function(r,t,n){return r<t?t:r>n?n:r},i7=n7,Un=C("mrSG"),a7=C("veWP"),aC=C.n(a7),lt;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(lt||(lt={}));var Ia;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(Ia||(Ia={}));var Ta;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Ta||(Ta={}));var Rg;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Rg||(Rg={}));var Ql;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(Ql||(Ql={}));var ga;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(ga||(ga={}));var Du;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Du||(Du={}));var wl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(wl||(wl={}));var Ds;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Ds||(Ds={}));var Js;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Js||(Js={}));var ks;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ks||(ks={}));var mo;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(mo||(mo={}));var Df;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(Df||(Df={}));var ev;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(ev||(ev={}));var oC;(function(e){e.LOADED="loaded"})(oC||(oC={}));var aa;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(aa||(aa={}));var Ec;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET"})(Ec||(Ec={}));var ku;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(ku||(ku={}));var tl;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(tl||(tl={}));function oG(e,r,t,n){var i=aa.TEXTURE_2D,a=1,o=Ec.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:o}}var ns;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(ns||(ns={}));var om;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(om||(om={}));var sm;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(sm||(sm={}));var d0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(d0||(d0={}));var zr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(zr||(zr={}));var ri;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(ri||(ri={}));function sC(e){return e}var Ln;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"})(Ln||(Ln={}));function xi(e,r,t){return e<<16|r<<8|t}var Vt;(function(e){e[e.ALPHA=xi(zr.U8,ri.A,Ln.None)]="ALPHA",e[e.U8_LUMINANCE=xi(zr.U8,ri.A,Ln.None)]="U8_LUMINANCE",e[e.F16_LUMINANCE=xi(zr.F16,ri.A,Ln.None)]="F16_LUMINANCE",e[e.F32_LUMINANCE=xi(zr.F32,ri.A,Ln.None)]="F32_LUMINANCE",e[e.F16_R=xi(zr.F16,ri.R,Ln.None)]="F16_R",e[e.F16_RG=xi(zr.F16,ri.RG,Ln.None)]="F16_RG",e[e.F16_RGB=xi(zr.F16,ri.RGB,Ln.None)]="F16_RGB",e[e.F16_RGBA=xi(zr.F16,ri.RGBA,Ln.None)]="F16_RGBA",e[e.F32_R=xi(zr.F32,ri.R,Ln.None)]="F32_R",e[e.F32_RG=xi(zr.F32,ri.RG,Ln.None)]="F32_RG",e[e.F32_RGB=xi(zr.F32,ri.RGB,Ln.None)]="F32_RGB",e[e.F32_RGBA=xi(zr.F32,ri.RGBA,Ln.None)]="F32_RGBA",e[e.U8_R=xi(zr.U8,ri.R,Ln.None)]="U8_R",e[e.U8_R_NORM=xi(zr.U8,ri.R,Ln.Normalized)]="U8_R_NORM",e[e.U8_RG=xi(zr.U8,ri.RG,Ln.None)]="U8_RG",e[e.U8_RG_NORM=xi(zr.U8,ri.RG,Ln.Normalized)]="U8_RG_NORM",e[e.U8_RGB=xi(zr.U8,ri.RGB,Ln.None)]="U8_RGB",e[e.U8_RGB_NORM=xi(zr.U8,ri.RGB,Ln.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=xi(zr.U8,ri.RGB,Ln.sRGB|Ln.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=xi(zr.U8,ri.RGBA,Ln.None)]="U8_RGBA",e[e.U8_RGBA_NORM=xi(zr.U8,ri.RGBA,Ln.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=xi(zr.U8,ri.RGBA,Ln.sRGB|Ln.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=xi(zr.U16,ri.R,Ln.None)]="U16_R",e[e.U16_R_NORM=xi(zr.U16,ri.R,Ln.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=xi(zr.U16,ri.RG,Ln.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=xi(zr.U16,ri.RGBA,Ln.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=xi(zr.U16,ri.RGB,Ln.None)]="U16_RGB",e[e.U32_R=xi(zr.U32,ri.R,Ln.None)]="U32_R",e[e.U32_RG=xi(zr.U32,ri.RG,Ln.None)]="U32_RG",e[e.S8_R=xi(zr.S8,ri.R,Ln.None)]="S8_R",e[e.S8_R_NORM=xi(zr.S8,ri.R,Ln.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=xi(zr.S8,ri.RG,Ln.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=xi(zr.S8,ri.RGB,Ln.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=xi(zr.S8,ri.RGBA,Ln.Normalized)]="S8_RGBA_NORM",e[e.S16_R=xi(zr.S16,ri.R,Ln.None)]="S16_R",e[e.S16_RG=xi(zr.S16,ri.RG,Ln.None)]="S16_RG",e[e.S16_RG_NORM=xi(zr.S16,ri.RG,Ln.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=xi(zr.S16,ri.RGB,Ln.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=xi(zr.S16,ri.RGBA,Ln.None)]="S16_RGBA",e[e.S16_RGBA_NORM=xi(zr.S16,ri.RGBA,Ln.Normalized)]="S16_RGBA_NORM",e[e.S32_R=xi(zr.S32,ri.R,Ln.None)]="S32_R",e[e.U16_RGBA_5551=xi(zr.U16_PACKED_5551,ri.RGBA,Ln.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=xi(zr.U16_PACKED_565,ri.RGB,Ln.Normalized)]="U16_RGB_565",e[e.BC1=xi(zr.BC1,ri.RGBA,Ln.Normalized)]="BC1",e[e.BC1_SRGB=xi(zr.BC1,ri.RGBA,Ln.Normalized|Ln.sRGB)]="BC1_SRGB",e[e.BC2=xi(zr.BC2,ri.RGBA,Ln.Normalized)]="BC2",e[e.BC2_SRGB=xi(zr.BC2,ri.RGBA,Ln.Normalized|Ln.sRGB)]="BC2_SRGB",e[e.BC3=xi(zr.BC3,ri.RGBA,Ln.Normalized)]="BC3",e[e.BC3_SRGB=xi(zr.BC3,ri.RGBA,Ln.Normalized|Ln.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=xi(zr.BC4_UNORM,ri.R,Ln.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=xi(zr.BC4_SNORM,ri.R,Ln.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=xi(zr.BC5_UNORM,ri.RG,Ln.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=xi(zr.BC5_SNORM,ri.RG,Ln.Normalized)]="BC5_SNORM",e[e.D24=xi(zr.D24,ri.R,Ln.Depth)]="D24",e[e.D24_S8=xi(zr.D24S8,ri.RG,Ln.Depth|Ln.Stencil)]="D24_S8",e[e.D32F=xi(zr.D32F,ri.R,Ln.Depth)]="D32F",e[e.D32F_S8=xi(zr.D32FS8,ri.RG,Ln.Depth|Ln.Stencil)]="D32F_S8",e[e.U8_RGB_RT=xi(zr.U8,ri.RGB,Ln.RenderTarget|Ln.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=xi(zr.U8,ri.RGBA,Ln.RenderTarget|Ln.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=xi(zr.U8,ri.RGBA,Ln.RenderTarget|Ln.Normalized|Ln.sRGB)]="U8_RGBA_RT_SRGB"})(Vt||(Vt={}));function v0(e){return e>>>8&255}function _h(e){return e>>>16&255}function um(e){return e&255}function uC(e){switch(e){case zr.F32:case zr.U32:case zr.S32:return 4;case zr.U16:case zr.S16:case zr.F16:return 2;case zr.U8:case zr.S8:return 1;default:throw new Error("whoops")}}function lC(e){return uC(_h(e))}function sG(e){return sC(v0(e))}function o7(e){var r=uC(_h(e)),t=sC(v0(e));return r*t}function uG(e,r){return e&4294967040|r}function lG(e,r){return e&4294902015|r<<8}function cC(e){var r=um(e);if(r&Ln.Depth)return ns.Depth;if(r&Ln.Normalized)return ns.Float;var t=_h(e);if(t===zr.F16||t===zr.F32)return ns.Float;if(t===zr.U8||t===zr.U16||t===zr.U32)return ns.Uint;if(t===zr.S8||t===zr.S16||t===zr.S32)return ns.Sint;throw new Error("whoops")}function Xi(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function tv(e){if(e!=null)return e;throw new Error("Missing object")}function fC(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function hC(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function pC(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function m0(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var P1=m0(0,0,0,0),cG=m0(0,0,0,1),s7=m0(1,1,1,0),fG=m0(1,1,1,1),lm=!0;function hG(e,r){r===void 0&&(r=lm),r&&(e[10]=-e[10],e[14]=-e[14])}function pG(e,r){r===void 0&&(r=lm),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function u7(e,r){if(r===void 0&&(r=lm),r)switch(e){case Ta.LESS:return Ta.GREATER;case Ta.LEQUAL:return Ta.GEQUAL;case Ta.GEQUAL:return Ta.LEQUAL;case Ta.GREATER:return Ta.LESS;default:return e}else return e}function dG(e,r){return r===void 0&&(r=lm),r?1-e:e}function vG(e,r){return r===void 0&&(r=lm),r?-e:e}function mG(e,r,t,n){if(n===void 0&&(n=lm),t=u7(t,n),t===Ta.LESS)return e<r;if(t===Ta.LEQUAL)return e<=r;if(t===Ta.GREATER)return e>r;if(t===Ta.GEQUAL)return e>=r;throw new Error("whoops")}function g0(e){return!!(e&&(e&e-1)==0)}function cm(e,r){return e!=null?e:r}function l7(e){return e===void 0?null:e}function gG(e,r,t){e.length=r,e.fill(t)}function y0(e,r){var t=r-1;return e+t&~t}function yG(e,r){return((e+r-1)/r|0)*r}function c7(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),o=t(r,e[a]);o<0?i=a:n=a+1}return n}function _G(e,r,t){var n=c7(e,r,t);e.splice(n,0,r)}function bG(e,r,t){return t?e|=r:e&=~r,e}function f7(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function h7(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(p7(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function p7(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function xG(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function dC(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function _0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e}function vC(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),dC(e.rgbBlendState,r.rgbBlendState),dC(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function I1(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=vC(e[t],r[t])}function d7(e,r){r.attachmentsState!==void 0&&I1(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&hC(e.blendConstant,r.blendConstant),e.depthCompare=cm(r.depthCompare,e.depthCompare),e.depthWrite=cm(r.depthWrite,e.depthWrite),e.stencilWrite=cm(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&_0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&_0(e.stencilBack,r.stencilBack),e.cullMode=cm(r.cullMode,e.cullMode),e.frontFace=cm(r.frontFace,e.frontFace),e.polygonOffset=cm(r.polygonOffset,e.polygonOffset)}function fm(e){var r=Object.assign({},e);return r.attachmentsState=[],I1(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&pC(r.blendConstant),r.stencilFront=_0(void 0,e.stencilFront),r.stencilBack=_0(void 0,e.stencilBack),r}function v7(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var mC={blendMode:Du.ADD,blendSrcFactor:ga.ONE,blendDstFactor:ga.ZERO},rv={attachmentsState:[{channelWriteMask:ku.ALL,rgbBlendState:mC,alphaBlendState:mC}],blendConstant:pC(P1),depthWrite:!0,depthCompare:Ta.LEQUAL,stencilWrite:!1,stencilFront:{compare:Ta.ALWAYS,passOp:tl.KEEP,depthFailOp:tl.KEEP,failOp:tl.KEEP},stencilBack:{compare:Ta.ALWAYS,passOp:tl.KEEP,depthFailOp:tl.KEEP,failOp:tl.KEEP},cullMode:Ql.NONE,frontFace:Rg.CCW,polygonOffset:!1};function m7(e,r){e===void 0&&(e=null),r===void 0&&(r=rv);var t=fm(r);return e!==null&&d7(t,e),t}var EG=m7({depthCompare:Ta.ALWAYS,depthWrite:!1},rv);function SG(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],I1(e.attachmentsState,rv.attachmentsState)),v7(e.attachmentsState[0],r),e}var gC={texture:null,sampler:null,formatKind:ns.Float,dimension:aa.TEXTURE_2D};function hm(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Mg(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function g7(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function y7(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function AG(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!hm(e.samplerBindings,r.samplerBindings,y7)||!hm(e.uniformBufferBindings,r.uniformBufferBindings,g7))}function yC(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function _7(e,r){return!(!yC(e.rgbBlendState,r.rgbBlendState)||!yC(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function b0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp}function b7(e,r){return!hm(e.attachmentsState,r.attachmentsState,_7)||e.blendConstant&&r.blendConstant&&!fC(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!b0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!b0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function _C(e,r){return e.id===r.id}function x7(e,r){return e===r}function TG(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!b7(e.megaStateDescriptor,r.megaStateDescriptor)||!_C(e.program,r.program)||!hm(e.colorAttachmentFormats,r.colorAttachmentFormats,x7)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function E7(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function S7(e,r){return rf(e)?rf(r):rf(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&hm(e.attributes,r.attributes,E7)}function CG(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!hm(e.vertexBufferDescriptors,r.vertexBufferDescriptors,S7)||!_C(e.program,r.program))}function wG(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function A7(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function bC(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function OG(e){var r=e.samplerBindings&&Mg(e.samplerBindings,A7),t=e.uniformBufferBindings&&Mg(e.uniformBufferBindings,bC),n=e.storageBufferBindings&&Mg(e.storageBufferBindings,bC);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,pipeline:e.pipeline}}function RG(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&fm(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),o=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:o,sampleCount:l}}function T7(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function C7(e){if(rf(e))return e;var r=e.arrayStride,t=e.stepMode,n=Mg(e.attributes,T7);return{arrayStride:r,stepMode:t,attributes:n}}function MG(e){var r=Mg(e.vertexBufferDescriptors,C7),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var la,w7=/([^[]*)(\[[0-9]+\])?/;function O7(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(w7);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:Boolean(r[2])}}function Ol(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function is(e,r,t,n){var i=null,a=null;return function(o,l,c){var p=r(c,t),_=p.length,x=!1;if(i===null)i=new Float32Array(_),a=_,x=!0;else{Xi(a===_,"Uniform length cannot change.");for(var A=0;A<_;++A)if(p[A]!==i[A]){x=!0;break}}return x&&(n(o,e,l,p),i.set(p)),x}}function rl(e,r,t,n){e[r](t,n)}function np(e,r,t,n){e[r](t,!1,n)}var R7={},M7={},P7={},xC=[0];function D1(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(xC[0]=e,e=xC);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function Sc(e,r){return D1(e,r,Float32Array,R7)}function ed(e,r){return D1(e,r,Int32Array,M7)}function x0(e,r){return D1(e,r,Uint32Array,P7)}var I7=(la={},la[lt.FLOAT]=is.bind(null,"uniform1fv",Sc,1,rl),la[lt.FLOAT_VEC2]=is.bind(null,"uniform2fv",Sc,2,rl),la[lt.FLOAT_VEC3]=is.bind(null,"uniform3fv",Sc,3,rl),la[lt.FLOAT_VEC4]=is.bind(null,"uniform4fv",Sc,4,rl),la[lt.INT]=is.bind(null,"uniform1iv",ed,1,rl),la[lt.INT_VEC2]=is.bind(null,"uniform2iv",ed,2,rl),la[lt.INT_VEC3]=is.bind(null,"uniform3iv",ed,3,rl),la[lt.INT_VEC4]=is.bind(null,"uniform4iv",ed,4,rl),la[lt.BOOL]=is.bind(null,"uniform1iv",ed,1,rl),la[lt.BOOL_VEC2]=is.bind(null,"uniform2iv",ed,2,rl),la[lt.BOOL_VEC3]=is.bind(null,"uniform3iv",ed,3,rl),la[lt.BOOL_VEC4]=is.bind(null,"uniform4iv",ed,4,rl),la[lt.FLOAT_MAT2]=is.bind(null,"uniformMatrix2fv",Sc,4,np),la[lt.FLOAT_MAT3]=is.bind(null,"uniformMatrix3fv",Sc,9,np),la[lt.FLOAT_MAT4]=is.bind(null,"uniformMatrix4fv",Sc,16,np),la[lt.UNSIGNED_INT]=is.bind(null,"uniform1uiv",x0,1,rl),la[lt.UNSIGNED_INT_VEC2]=is.bind(null,"uniform2uiv",x0,2,rl),la[lt.UNSIGNED_INT_VEC3]=is.bind(null,"uniform3uiv",x0,3,rl),la[lt.UNSIGNED_INT_VEC4]=is.bind(null,"uniform4uiv",x0,4,rl),la[lt.FLOAT_MAT2x3]=is.bind(null,"uniformMatrix2x3fv",Sc,6,np),la[lt.FLOAT_MAT2x4]=is.bind(null,"uniformMatrix2x4fv",Sc,8,np),la[lt.FLOAT_MAT3x2]=is.bind(null,"uniformMatrix3x2fv",Sc,6,np),la[lt.FLOAT_MAT3x4]=is.bind(null,"uniformMatrix3x4fv",Sc,12,np),la[lt.FLOAT_MAT4x2]=is.bind(null,"uniformMatrix4x2fv",Sc,8,np),la[lt.FLOAT_MAT4x3]=is.bind(null,"uniformMatrix4x3fv",Sc,12,np),la[lt.SAMPLER_2D]=Ol,la[lt.SAMPLER_CUBE]=Ol,la[lt.SAMPLER_3D]=Ol,la[lt.SAMPLER_2D_SHADOW]=Ol,la[lt.SAMPLER_2D_ARRAY]=Ol,la[lt.SAMPLER_2D_ARRAY_SHADOW]=Ol,la[lt.SAMPLER_CUBE_SHADOW]=Ol,la[lt.INT_SAMPLER_2D]=Ol,la[lt.INT_SAMPLER_3D]=Ol,la[lt.INT_SAMPLER_CUBE]=Ol,la[lt.INT_SAMPLER_2D_ARRAY]=Ol,la[lt.UNSIGNED_INT_SAMPLER_2D]=Ol,la[lt.UNSIGNED_INT_SAMPLER_3D]=Ol,la[lt.UNSIGNED_INT_SAMPLER_CUBE]=Ol,la[lt.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Ol,la);function EC(e,r,t){var n=I7[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var D7={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function k7(e){return Object.prototype.toString.call(e)in D7}function Pg(e,r){return"#define ".concat(e," ").concat(r)}function F7(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function B7(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var o=Number(i);return t.push({location:isNaN(o)?r[i]:o,name:a}),""}),t}function PG(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var o=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var c=Object(Un.e)(l.trim().split(/\s+/),2),p=c[0],_=c[1];o.push({type:p.trim(),name:_.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:o}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var o=a.trim().split(" "),l=o[0]||"",c=o[1]||"",p=c.indexOf("[")>-1;if(c=c.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=t.find(function(w){return l===w.type});if(_)if(p)for(var x=function(I){_.uniforms.forEach(function(P){r.push("".concat(c,"[").concat(I,"].").concat(P.name))})},A=0;A<5;A++)x(A);else _.uniforms.forEach(function(w){r.push("".concat(c,".").concat(w.name))})}c&&r.push(c)}}),""}),r}function SC(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function L7(e){var r="",t=e;return[t,r]}function td(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var o=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,c=t.replace(`\r
`,`
`).split(`
`).map(function(je){return je.replace(/[/][/].*$/,"")}).filter(function(je){var tt=!je||/^\s+$/.test(je);return!tt}),p="";n!==null&&(p=Object.keys(n).map(function(je){return Pg(je,n[je])}).join(`
`));var _=c.find(function(je){return je.startsWith("precision")})||"precision mediump float;",x=i?c.filter(function(je){return!je.startsWith("precision")}).join(`
`):c.join(`
`),A="";if(e.viewportOrigin===om.UPPER_LEFT&&(A+="".concat(Pg("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===sm.ZERO&&(A+="".concat(Pg("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var w=0,I=0,P=0;x=x.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(je,tt,vt,kt){var ir=vt?"".concat(vt,", "):"";return"layout(".concat(ir,"set = ").concat(w,", binding = ").concat(I++,") uniform ").concat(kt)}),w++,I=0,Xi(e.separateSamplerTextures),x=x.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(je,tt,vt,kt,ir){var ur=SC(vt);ur===null&&(ur=I++);var Zr=Object(Un.e)(L7(kt),2),ln=Zr[0],_n=Zr[1];return r==="frag"?`
layout(set = `.concat(w,", binding = ").concat(ur*2+0,") uniform texture").concat(ln," T_").concat(ir,`;
layout(set = `).concat(w,", binding = ").concat(ur*2+1,") uniform sampler").concat(_n," S_").concat(ir,";").trim():""}),x=x.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(je,tt){return"layout(location = ".concat(P++,") ").concat(tt)}),A+="".concat(Pg("gl_VertexID","gl_VertexIndex"),`
`),A+="".concat(Pg("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var H=0;x=x.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(je,tt,vt,kt,ir){var ur=SC(vt);return ur===null&&(ur=H++),"uniform sampler".concat(kt," ").concat(ir,"; // BINDING=").concat(ur)})}if(e.separateSamplerTextures)x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(je,tt,vt){return"sampler".concat(tt,"(T_").concat(vt,", S_").concat(vt,")")}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(je,tt){return"T_".concat(tt)});else{var W=[];x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(je,tt,vt){return W.push([vt,tt]),vt}),o&&W.forEach(function(je){var tt=Object(Un.e)(je,2),vt=tt[0],kt=tt[1];x=x.replace(new RegExp("texture\\(".concat(vt),"g"),function(){return"texture".concat(kt,"(").concat(vt)})}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(je,tt){return tt})}var oe="".concat(o?"":e.glslVersion,`
`).concat(o&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(o&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(A||"").concat(p?p+`
`:"",`
`).concat(x,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(oe=oe.replace(/^\b(out)\b/g,function(je,tt){return"layout(location = 0) ".concat(tt)})),o){if(r==="frag"&&(oe=oe.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(je,tt,vt){return"varying ".concat(tt," ").concat(vt,`;
`)})),r==="vert"&&(oe=oe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(je,tt,vt){return"varying ".concat(tt," ").concat(vt,`;
`)}),oe=oe.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(je,tt,vt){return"attribute ".concat(tt," ").concat(vt,`;
`)})),oe=oe.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(je,tt){return tt.trim().replace(/^.*$/gm,function(vt){var kt=vt.trim();return kt.startsWith("#")?kt:vt?"uniform ".concat(kt):""})}),r==="frag")if(l){var ce=[];oe=oe.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(je,tt){return ce.push(tt),"vec4 ".concat(tt,`;
`)});var Oe=oe.lastIndexOf("}");oe=oe.substring(0,Oe)+`
    `.concat(ce.map(function(je,tt){return"gl_FragData[".concat(tt,"] = ").concat(je,`;
    `)}).join(`
`))+oe.substring(Oe)}else{var Fe;if(oe=oe.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(je,tt,vt){return Fe=vt,"".concat(tt," ").concat(vt,`;
`)}),Fe){var Oe=oe.lastIndexOf("}");oe=oe.substring(0,Oe)+`
  gl_FragColor = vec4(`.concat(Fe,`);
`)+oe.substring(Oe)}}oe=oe.replace(/^\s*layout\((.*)\)/gm,"")}return oe}function IG(e,r,t,n){n===void 0&&(n=null);var i=td(e,"vert",r,n),a=td(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var kf=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(aC.a),N7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.Bindings;var l=a.uniformBufferBindings,c=a.samplerBindings;return o.uniformBufferBindings=l||[],o.samplerBindings=c||[],o.bindingLayouts=o.createBindingLayouts(),o}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,o=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:o}),t+=a,n+=o,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(kf);function ei(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function AC(e){var r=_h(e);switch(r){case zr.BC1:case zr.BC2:case zr.BC3:case zr.BC4_UNORM:case zr.BC4_SNORM:case zr.BC5_UNORM:case zr.BC5_SNORM:return!0;default:return!1}}function TC(e){var r=um(e);if(r&Ln.Normalized)return!1;var t=_h(e);return t===zr.S8||t===zr.S16||t===zr.S32||t===zr.U8||t===zr.U16||t===zr.U32}function j7(e){switch(e){case Df.STATIC:return lt.STATIC_DRAW;case Df.DYNAMIC:return lt.DYNAMIC_DRAW}}function CC(e){if(e&mo.INDEX)return lt.ELEMENT_ARRAY_BUFFER;if(e&mo.VERTEX)return lt.ARRAY_BUFFER;if(e&mo.UNIFORM)return lt.UNIFORM_BUFFER}function z7(e){switch(e){case ks.TRIANGLES:return lt.TRIANGLES;case ks.POINTS:return lt.POINTS;case ks.TRIANGLE_STRIP:return lt.TRIANGLE_STRIP;case ks.LINES:return lt.LINES;case ks.LINE_STRIP:return lt.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function U7(e){switch(e){case zr.U8:return lt.UNSIGNED_BYTE;case zr.U16:return lt.UNSIGNED_SHORT;case zr.U32:return lt.UNSIGNED_INT;case zr.S8:return lt.BYTE;case zr.S16:return lt.SHORT;case zr.S32:return lt.INT;case zr.F16:return lt.HALF_FLOAT;case zr.F32:return lt.FLOAT;default:throw new Error("whoops")}}function V7(e){switch(e){case ri.R:return 1;case ri.RG:return 2;case ri.RGB:return 3;case ri.RGBA:return 4;default:return 1}}function H7(e){var r=_h(e),t=v0(e),n=um(e),i=U7(r),a=V7(t),o=!!(n&Ln.Normalized);return{size:a,type:i,normalized:o}}function W7(e){switch(e){case Vt.U8_R:return lt.UNSIGNED_BYTE;case Vt.U16_R:return lt.UNSIGNED_SHORT;case Vt.U32_R:return lt.UNSIGNED_INT;default:throw new Error("whoops")}}function Ig(e){switch(e){case wl.CLAMP_TO_EDGE:return lt.CLAMP_TO_EDGE;case wl.REPEAT:return lt.REPEAT;case wl.MIRRORED_REPEAT:return lt.MIRRORED_REPEAT;default:throw new Error("whoops")}}function E0(e,r){if(r===Js.LINEAR&&e===Ds.BILINEAR)return lt.LINEAR_MIPMAP_LINEAR;if(r===Js.LINEAR&&e===Ds.POINT)return lt.NEAREST_MIPMAP_LINEAR;if(r===Js.NEAREST&&e===Ds.BILINEAR)return lt.LINEAR_MIPMAP_NEAREST;if(r===Js.NEAREST&&e===Ds.POINT)return lt.NEAREST_MIPMAP_NEAREST;if(r===Js.NO_MIP&&e===Ds.BILINEAR)return lt.LINEAR;if(r===Js.NO_MIP&&e===Ds.POINT)return lt.NEAREST;throw new Error("Unknown texture filter mode")}function pm(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function dm(e){var r=e;return r.gl_texture}function k1(e){var r=e;return r.gl_sampler}function Dg(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function wC(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function rd(e){return e.blendMode==Du.ADD&&e.blendSrcFactor==ga.ONE&&e.blendDstFactor===ga.ZERO}function G7(e){switch(e){case d0.OcclusionConservative:return lt.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function X7(e){if(e===aa.TEXTURE_2D)return lt.TEXTURE_2D;if(e===aa.TEXTURE_2D_ARRAY)return lt.TEXTURE_2D_ARRAY;if(e===aa.TEXTURE_CUBE_MAP)return lt.TEXTURE_CUBE_MAP;if(e===aa.TEXTURE_3D)return lt.TEXTURE_3D;throw new Error("whoops")}function F1(e,r,t,n){return!(e%t!=0||r%n!=0)}var Z7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.Buffer;var l=a.viewOrSize,c=a.usage,p=a.hint,_=p===void 0?Df.STATIC:p,x=i.uniformBufferMaxPageByteSize,A=i.gl,w=c&mo.UNIFORM;w||(ei(A)?A.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=am(l)?y0(l,4):y0(l.byteLength,4);o.gl_buffer_pages=[];var P;if(w){for(var H=I;H>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(H,x),c,_)),H-=x;P=x}else o.gl_buffer_pages.push(o.createBufferPage(I,c,_)),P=I;return o.pageByteSize=P,o.byteSize=I,o.usage=c,o.gl_target=CC(c),am(l)||o.setSubData(0,new Uint8Array(l.buffer)),w||(ei(A)?A.bindVertexArray(o.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var o=this.device.gl,l=this.pageByteSize,c=t+a,p=t,_=t%l;p<c;){var x=ei(o)?o.COPY_WRITE_BUFFER:this.gl_target,A=pm(this,p);if(A.ubo)return;o.bindBuffer(x,A),ei(o)?o.bufferSubData(x,_,n,i,Math.min(c-p,l)):o.bufferSubData(x,_,n),p+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,o=n&mo.UNIFORM;if(!ei(a)&&o)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),c=CC(n),p=j7(i);return a.bindBuffer(c,l),a.bufferData(c,t,p),l},r}(kf),$7=function(e){Object(Un.c)(r,e);function r(t){var n,i,a,o,l=t.id,c=t.device,p=t.descriptor,_,x=e.call(this,{id:l,device:c})||this;x.type=Ia.InputLayout;var A=p.vertexBufferDescriptors,w=p.indexBufferFormat,I=p.program;Xi(w===Vt.U16_R||w===Vt.U32_R||w===null);var P=w!==null?W7(w):null,H=w!==null?lC(w):null,W=x.device.gl,oe=x.device.ensureResourceExists(ei(W)?W.createVertexArray():c.OES_vertex_array_object.createVertexArrayOES());ei(W)?W.bindVertexArray(oe):c.OES_vertex_array_object.bindVertexArrayOES(oe),W.bindBuffer(W.ARRAY_BUFFER,pm(x.device.fallbackVertexBuffer));try{for(var ce=Object(Un.i)(p.vertexBufferDescriptors),Oe=ce.next();!Oe.done;Oe=ce.next()){var Fe=Oe.value,je=Fe.stepMode,tt=Fe.attributes;try{for(var vt=(a=void 0,Object(Un.i)(tt)),kt=vt.next();!kt.done;kt=vt.next()){var ir=kt.value,ur=ir.shaderLocation,Zr=ir.format,ln=ir.divisor,_n=ln===void 0?1:ln,Hi=ei(W)?ur:(_=I.attributes[ur])===null||_===void 0?void 0:_.location,io=H7(Zr);if(ir.vertexFormat=io,!rf(Hi)){TC(Zr);var Ga=io.size,To=io.type,Co=io.normalized;W.vertexAttribPointer(Hi,Ga,To,Co,0,0),je===ev.INSTANCE&&(ei(W)?W.vertexAttribDivisor(Hi,_n):c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Hi,_n)),W.enableVertexAttribArray(Hi)}}}catch(nl){a={error:nl}}finally{try{kt&&!kt.done&&(o=vt.return)&&o.call(vt)}finally{if(a)throw a.error}}}}catch(nl){n={error:nl}}finally{try{Oe&&!Oe.done&&(i=ce.return)&&i.call(ce)}finally{if(n)throw n.error}}return ei(W)?W.bindVertexArray(null):c.OES_vertex_array_object.bindVertexArrayOES(null),x.vertexBufferDescriptors=A,x.vao=oe,x.indexBufferFormat=w,x.indexBufferType=P,x.indexBufferCompByteSize=H,x.program=I,x}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(ei(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(kf),B1=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=Ia.Texture,a=Object(Un.a)({dimension:aa.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var c=l.device.gl,p,_,x=l.clampmipLevelCount(a);if(l.immutable=a.usage===Ec.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=cC(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=x>=1,!o){_=l.device.ensureResourceExists(c.createTexture());var A=l.device.translateTextureType(a.format),w=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(c.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===aa.TEXTURE_2D){if(p=lt.TEXTURE_2D,c.bindTexture(p,_),l.immutable)if(ei(c))c.texStorage2D(p,x,w,a.width,a.height);else{var I=(w===lt.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Vt.D32F||l.format===Vt.D24_S8)&&!ei(c)&&!i.WEBGL_depth_texture||(c.texImage2D(p,I,w,a.width,a.height,0,w,A,null),l.mipmaps&&(l.mipmaps=!1,c.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_MIN_FILTER,lt.LINEAR),c.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_S,lt.CLAMP_TO_EDGE),c.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_T,lt.CLAMP_TO_EDGE)))}Xi(a.depthOrArrayLayers===1)}else if(a.dimension===aa.TEXTURE_2D_ARRAY)p=lt.TEXTURE_2D_ARRAY,c.bindTexture(p,_),l.immutable&&ei(c)&&c.texStorage3D(p,x,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===aa.TEXTURE_3D)p=lt.TEXTURE_3D,c.bindTexture(p,_),l.immutable&&ei(c)&&c.texStorage3D(p,x,w,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===aa.TEXTURE_CUBE_MAP)p=lt.TEXTURE_CUBE_MAP,c.bindTexture(p,_),l.immutable&&ei(c)&&c.texStorage2D(p,x,w,a.width,a.height),Xi(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=p,l.mipLevelCount=x,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;AC(this.format);var a=this.gl_target===lt.TEXTURE_3D||this.gl_target===lt.TEXTURE_2D_ARRAY,o=this.gl_target===lt.TEXTURE_CUBE_MAP,l=k7(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var c=t[0],p,_;l?(p=this.width,_=this.height):(p=c.width,_=c.height,this.width=p,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var x=this.device.translateTextureFormat(this.format),A=this.device.translateTextureType(this.format);this.preprocessImage();for(var w=0;w<this.depthOrArrayLayers;w++){var I=t[w],P=this.gl_target;o&&(P=lt.TEXTURE_CUBE_MAP_POSITIVE_X+w%6),this.immutable?i.texSubImage2D(P,n,0,0,p,_,x,A,I):ei(i)?a?i.texImage3D(P,n,x,p,_,this.depthOrArrayLayers,0,x,A,I):i.texImage2D(P,n,x,p,_,0,x,A,I):l?i.texImage2D(P,n,x,p,_,0,x,A,I):i.texImage2D(P,n,x,x,A,I)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(dm(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===aa.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=_h(t.format);if(n===zr.BC1)for(var i=t.width,a=t.height,o=0;o<t.mipLevelCount;o++){if(i<=2||a<=2)return o-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(lt.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(lt.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(lt.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!ei(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,lt.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,lt.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,lt.TEXTURE_MIN_FILTER,lt.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,lt.TEXTURE_MAG_FILTER,lt.LINEAR)):n.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_MIN_FILTER,lt.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return ei(t)?!1:!g0(this.width)||!g0(this.height)},r}(kf),Y7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var l=o.device.gl,c=a.format,p=a.width,_=a.height,x=a.sampleCount,A=x===void 0?1:x,w=a.texture,I=!1;if((c===Vt.D32F||c===Vt.D24_S8)&&w&&!ei(l)&&!i.WEBGL_depth_texture&&(w.destroy(),o.texture=null,I=!0),!I&&w)o.texture=w;else{o.gl_renderbuffer=o.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,o.gl_renderbuffer);var P=o.device.translateTextureInternalFormat(c,!0);ei(l)&&A>1?l.renderbufferStorageMultisample(lt.RENDERBUFFER,A,P,p,_):l.renderbufferStorage(lt.RENDERBUFFER,P,p,_)}return o.format=c,o.width=p,o.height=_,o.sampleCount=A,o}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(kf),Jl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Jl||(Jl={}));var K7=function(e){Object(Un.c)(r,e);function r(t,n){var i=t.id,a=t.device,o=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=Ia.Program,l.uniformSetters={},l.attributes=[];var c=l.device.gl;return l.descriptor=o,l.gl_program=l.device.ensureResourceExists(c.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Jl.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){var t,n;Xi(this.compileState===Jl.NeedsCompile);var i=this.descriptor,a=this.device.gl;((t=i.vertex)===null||t===void 0?void 0:t.glsl)&&((n=i.fragment)===null||n===void 0?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Jl.Compiling,ei(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=F7(this.descriptor.vertex.glsl),o=B7(this.rawVertexGLSL,a),l=function(x){var A=n.getActiveAttrib(c.gl_program,x),w=A.name,I=A.type,P=A.size,H=n.getAttribLocation(c.gl_program,w),W=(t=o.find(function(oe){return oe.name===w}))===null||t===void 0?void 0:t.location;H>=0&&!rf(W)&&(c.attributes[W]={name:w,location:H,type:I,size:P})},c=this,p=0;p<i;p++)l(p)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),o=O7(a.name).name,l=t.getUniformLocation(this.gl_program,o);if(this.uniformSetters[o]=EC(t,l,a),a&&a.size>1)for(var c=0;c<a.size;c++)l=t.getUniformLocation(this.gl_program,"".concat(o,"[").concat(c,"]")),this.uniformSetters["".concat(o,"[").concat(c,"]")]=EC(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!ei(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var o=t[a],l=this.uniformSetters[a];if(l){var c=o;c instanceof B1&&(c=c.textureIndex),l(c)}}}return this},r}(kf),q7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.QueryPool;var l=o.device.gl;if(ei(l)){var c=a.elemCount,p=a.type;o.gl_query=f7(c,function(){return o.device.ensureResourceExists(l.createQuery())}),o.gl_query_type=G7(p)}return o}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(ei(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(ei(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(kf),Q7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=Ia.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(o,l){function c(){var p=a.clientWaitSync(t,n,0);if(p==a.WAIT_FAILED){l();return}if(p==a.TIMEOUT_EXPIRED){setTimeout(c,i7(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}o()}c()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,o,l){return Object(Un.b)(this,void 0,void 0,function(){var c;return Object(Un.d)(this,function(p){switch(p.label){case 0:return c=this.device.gl,ei(c)?(this.gl_sync=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0),c.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return p.sent(),c.bindBuffer(t,n),c.getBufferSubData(t,i,a,o,l),c.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,o,l,c,p){return c===void 0&&(c=0),p===void 0&&(p=l.byteLength||0),Object(Un.b)(this,void 0,void 0,function(){var _,x,A,w,I;return Object(Un.d)(this,function(P){return _=this.device.gl,x=t,A=this.device.translateTextureFormat(x.format),w=this.device.translateTextureType(x.format),I=o7(x.format),ei(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,p,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer(lt.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(lt.READ_FRAMEBUFFER,lt.COLOR_ATTACHMENT0,lt.TEXTURE_2D,x.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,o,A,w,c*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,c,0)]):[2,this.readTextureSync(t,n,i,a,o,l,c,p)]})})},r.prototype.readTextureSync=function(t,n,i,a,o,l,c,p){p===void 0&&(p=l.byteLength||0);var _=this.device.gl,x=t,A=this.device.translateTextureType(x.format);return _.bindFramebuffer(lt.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(lt.FRAMEBUFFER,lt.COLOR_ATTACHMENT0,lt.TEXTURE_2D,x.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,o,_.RGBA,A,l),l},r.prototype.readBuffer=function(t,n,i,a,o){return Object(Un.b)(this,void 0,void 0,function(){var l;return Object(Un.d)(this,function(c){return l=this.device.gl,ei(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,pm(t,n),n,i,a,o)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),ei(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(kf),J7=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;return c.type=Ia.RenderPipeline,c.drawMode=z7((o=a.topology)!==null&&o!==void 0?o:ks.TRIANGLES),c.program=a.program,c.inputLayout=a.inputLayout,c.megaState=Object(Un.a)(Object(Un.a)({},fm(rv)),a.megaStateDescriptor),c.colorAttachmentFormats=a.colorAttachmentFormats.slice(),c.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,c.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,c}return r}(kf),e8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Ia.ComputePipeline,o.descriptor=a,o}return r}(kf),t8=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=Object(Un.i)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(o){r={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),r8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;c.type=Ia.Sampler;var p=c.device.gl;if(ei(p)){var _=c.device.ensureResourceExists(p.createSampler());p.samplerParameteri(_,lt.TEXTURE_WRAP_S,Ig(a.addressModeU)),p.samplerParameteri(_,lt.TEXTURE_WRAP_T,Ig(a.addressModeV)),p.samplerParameteri(_,lt.TEXTURE_WRAP_R,Ig((o=a.addressModeW)!==null&&o!==void 0?o:a.addressModeU)),p.samplerParameteri(_,lt.TEXTURE_MIN_FILTER,E0(a.minFilter,a.mipmapFilter)),p.samplerParameteri(_,lt.TEXTURE_MAG_FILTER,E0(a.magFilter,Js.NO_MIP)),a.lodMinClamp!==void 0&&p.samplerParameterf(_,lt.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&p.samplerParameterf(_,lt.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(p.samplerParameteri(_,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.samplerParameteri(_,p.TEXTURE_COMPARE_FUNC,a.compareFunction));var x=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;x>1&&c.device.EXT_texture_filter_anisotropic!==null&&(Xi(a.minFilter===Ds.BILINEAR&&a.magFilter===Ds.BILINEAR&&a.mipmapFilter===Js.LINEAR),p.samplerParameterf(_,c.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x)),c.gl_sampler=_}else c.descriptor=a;return c}return r.prototype.setTextureParameters=function(t,n,i){var a,o=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?o.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_MIN_FILTER,lt.LINEAR):o.texParameteri(t,lt.TEXTURE_MIN_FILTER,E0(l.minFilter,l.mipmapFilter)),o.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_S,Ig(l.addressModeU)),o.texParameteri(lt.TEXTURE_2D,lt.TEXTURE_WRAP_T,Ig(l.addressModeV)),o.texParameteri(t,lt.TEXTURE_MAG_FILTER,E0(l.magFilter,Js.NO_MIP));var c=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;c>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Xi(l.minFilter===Ds.BILINEAR&&l.magFilter===Ds.BILINEAR&&l.mipmapFilter===Js.LINEAR),o.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c))},r.prototype.destroy=function(){e.prototype.destroy.call(this),ei(this.device.gl)&&this.device.gl.deleteSampler(k1(this))},r.prototype.isNPOT=function(t,n){return!g0(t)||!g0(n)},r}(kf),n8=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),OC=65536,i8=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,a8=function(){function e(r,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=fm(rv),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=om.LOWER_LEFT,this.clipSpaceNearZ=sm.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=tv(r.getContextAttributes()),ei(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),ei(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new B1({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:aa.TEXTURE_2D,mipLevelCount:1,usage:Ec.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Vt.U8_RGB_RT:Vt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=ns.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(aa.TEXTURE_2D,ns.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(aa.TEXTURE_2D,ns.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:mo.VERTEX,hint:Df.STATIC}),ei(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(aa.TEXTURE_2D_ARRAY,ns.Float),this.fallbackTexture3D=this.createFallbackTexture(aa.TEXTURE_3D,ns.Float),this.fallbackTextureCube=this.createFallbackTexture(aa.TEXTURE_CUBE_MAP,ns.Float)),this.currentMegaState.depthCompare=Ta.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=ku.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new t8)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===aa.TEXTURE_CUBE_MAP?6:1,i=t===ns.Depth?Vt.D32F:Vt.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:Ec.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===ns.Float&&a.setImageData([new Uint8Array(4*n)]),dm(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(lt.MAX_VERTEX_ATTRIBS),ei(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(lt.MAX_UNIFORM_BLOCK_SIZE),OC),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?Object(Un.h)([],Object(Un.e)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=OC;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=l7(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case Vt.ALPHA:return lt.ALPHA;case Vt.U8_LUMINANCE:case Vt.F16_LUMINANCE:case Vt.F32_LUMINANCE:return lt.LUMINANCE;case Vt.F16_R:return lt.R16F;case Vt.F16_RG:return lt.RG16F;case Vt.F16_RGB:return lt.RGB16F;case Vt.F16_RGBA:return lt.RGBA16F;case Vt.F32_R:return lt.R32F;case Vt.F32_RG:return lt.RG32F;case Vt.F32_RGB:return lt.RGB32F;case Vt.F32_RGBA:return ei(this.gl)?lt.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:lt.RGBA;case Vt.U8_R_NORM:return lt.R8;case Vt.U8_RG_NORM:return lt.RG8;case Vt.U8_RGB_NORM:case Vt.U8_RGB_RT:return lt.RGB8;case Vt.U8_RGB_SRGB:return lt.SRGB8;case Vt.U8_RGBA_NORM:case Vt.U8_RGBA_RT:return ei(this.gl)?lt.RGBA8:t?lt.RGBA4:lt.RGBA;case Vt.U8_RGBA:return lt.RGBA;case Vt.U8_RGBA_SRGB:case Vt.U8_RGBA_RT_SRGB:return lt.SRGB8_ALPHA8;case Vt.U16_R:return lt.R16UI;case Vt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Vt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Vt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Vt.U16_RGBA_5551:return lt.RGB5_A1;case Vt.U16_RGB_565:return lt.RGB565;case Vt.U32_R:return lt.R32UI;case Vt.S8_RGBA_NORM:return lt.RGBA8_SNORM;case Vt.S8_RG_NORM:return lt.RG8_SNORM;case Vt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Vt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Vt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Vt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Vt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Vt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Vt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Vt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Vt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Vt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Vt.D32F_S8:return ei(this.gl)?lt.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?lt.DEPTH_STENCIL:lt.DEPTH_COMPONENT16;case Vt.D24_S8:return ei(this.gl)?lt.DEPTH24_STENCIL8:this.WEBGL_depth_texture?lt.DEPTH_STENCIL:lt.DEPTH_COMPONENT16;case Vt.D32F:return ei(this.gl)?lt.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?lt.DEPTH_COMPONENT:lt.DEPTH_COMPONENT16;case Vt.D24:return ei(this.gl)?lt.DEPTH_COMPONENT24:this.WEBGL_depth_texture?lt.DEPTH_COMPONENT:lt.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=_h(r);switch(t){case zr.U8:return lt.UNSIGNED_BYTE;case zr.U16:return lt.UNSIGNED_SHORT;case zr.U32:return lt.UNSIGNED_INT;case zr.S8:return lt.BYTE;case zr.F16:return lt.HALF_FLOAT;case zr.F32:return lt.FLOAT;case zr.U16_PACKED_5551:return lt.UNSIGNED_SHORT_5_5_5_1;case zr.D32F:return ei(this.gl)?lt.FLOAT:this.WEBGL_depth_texture?lt.UNSIGNED_INT:lt.UNSIGNED_BYTE;case zr.D24:return ei(this.gl)?lt.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?lt.UNSIGNED_SHORT:lt.UNSIGNED_BYTE;case zr.D24S8:return ei(this.gl)?lt.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?lt.UNSIGNED_INT_24_8_WEBGL:lt.UNSIGNED_BYTE;case zr.D32FS8:return lt.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateTextureFormat=function(r){if(AC(r)||r===Vt.F32_LUMINANCE||r===Vt.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=ei(this.gl)||!ei(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case Vt.D24_S8:case Vt.D32F_S8:return t?lt.DEPTH_STENCIL:lt.RGBA;case Vt.D24:case Vt.D32F:return t?lt.DEPTH_COMPONENT:lt.RGBA}var n=TC(r),i=v0(r);switch(i){case ri.A:return lt.ALPHA;case ri.R:return n?lt.RED_INTEGER:lt.RED;case ri.RG:return n?lt.RG_INTEGER:lt.RG;case ri.RGB:return n?lt.RGB_INTEGER:lt.RGB;case ri.RGBA:return lt.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(ei(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Xi(r.compileState!==Jl.NeedsCompile),r.compileState===Jl.Compiling&&(r.compileState=Jl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new Z7({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new B1({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new r8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new Y7({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,o=t.mipLevelCount;return Xi(o===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return((n=r.vertex)===null||n===void 0?void 0:n.glsl)&&(r.vertex.glsl=td(this.queryVendorInfo(),"vert",r.vertex.glsl)),((i=r.fragment)===null||i===void 0?void 0:i.glsl)&&(r.fragment.glsl=td(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new K7({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new N7({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new $7({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new J7({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new n8},e.prototype.createComputePipeline=function(r){return new e8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new Q7({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new q7({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,o,l,c=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var p=0;p<c.length;p++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[p]=(i=r.colorAttachmentLevel[p])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[p]=(a=r.colorResolveToLevel[p])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[p]=(o=r.colorClearColor[p])!==null&&o!==void 0?o:"load",r.colorStore||(r.colorStore=[]),r.colorStore[p]=(l=r.colorStore[p])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,o=r.colorResolveToLevel,l=r.depthStencilAttachment,c=r.depthClearValue,p=r.stencilClearValue,_=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var x=0;x<t.length;x++)this.setRenderPassParametersColor(x,t[x],n[x],a[x],o[x]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var x=0;x<t.length;x++){var A=i[x];A!=="load"&&this.setRenderPassParametersClearColor(x,A.r,A.g,A.b,A.a)}return this.setRenderPassParametersClearDepthStencil(c,p),this},e.prototype.submitPass=function(r){Xi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,o){var l=this.gl,c=r,p=i;if(Xi(p.mipLevelCount===1),Xi(c.mipLevelCount===1),ei(l))c===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,c,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,p,0),l.blitFramebuffer(a,o,a+p.width,o+p.height,t,n,t+p.width,n+p.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(c===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,c)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case Vt.BC1_SRGB:case Vt.BC2_SRGB:case Vt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?F1(t,n,4,4):!1;case Vt.BC1:case Vt.BC2:case Vt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?F1(t,n,4,4):!1;case Vt.BC4_UNORM:case Vt.BC4_SNORM:case Vt.BC5_UNORM:case Vt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?F1(t,n,4,4):!1;case Vt.U16_R_NORM:case Vt.U16_RG_NORM:case Vt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Vt.F32_R:case Vt.F32_RG:case Vt.F32_RGB:case Vt.F32_RGBA:return this.OES_texture_float_linear!==null;case Vt.F16_R:case Vt.F16_RG:case Vt.F16_RGB:case Vt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Jl.NeedsCompile)throw new Error("whoops");if(r.compileState===Jl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Jl.NeedsBind||r.compileState===Jl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===Ia.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)Dg(n[i],"".concat(t," Page ").concat(i));else if(r.type===Ia.Texture)Dg(dm(r),t);else if(r.type===Ia.Sampler)Dg(k1(r),t);else if(r.type===Ia.RenderTarget){var a=r.gl_renderbuffer;a!==null&&Dg(a,t)}else r.type===Ia.InputLayout&&Dg(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Xi(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;ei(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,pm(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(h7(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if(rf(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===Ia.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,lt.TEXTURE_2D,dm(n.texture),i);else if(n.type===Ia.Texture){var o=dm(n);n.dimension===aa.TEXTURE_2D?a.framebufferTexture2D(r,t,lt.TEXTURE_2D,o,i):ei(a)&&n.dimension===aa.TEXTURE_2D_ARRAY}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=rf(t)?Ln.Depth|Ln.Stencil:um(t.format),a=!!(i&Ln.Depth),o=!!(i&Ln.Stencil);if(a&&o){var l=ei(this.gl)||!ei(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(Xi(r===a.sampleCount),Xi(t===a.width),Xi(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Xi(r===this.currentDepthStencilAttachment.sampleCount),Xi(t===this.currentDepthStencilAttachment.width),Xi(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(ei(t)?t.bindFramebuffer(lt.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(lt.FRAMEBUFFER,this.renderPassDrawFramebuffer),ei(t)?t.drawBuffers([lt.COLOR_ATTACHMENT0,lt.COLOR_ATTACHMENT1,lt.COLOR_ATTACHMENT2,lt.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([lt.COLOR_ATTACHMENT0_WEBGL,lt.COLOR_ATTACHMENT1_WEBGL,lt.COLOR_ATTACHMENT2_WEBGL,lt.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=ei(t)?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,a=ei(t)?lt.COLOR_ATTACHMENT0:lt.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,lt.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,lt.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var o=this.gl,l=ei(o);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,(l?lt.COLOR_ATTACHMENT0:lt.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(ei(n)?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var o=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==ku.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=ku.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==ku.ALL&&(o.colorMask(!0,!0,!0,!0),l.channelWriteMask=ku.ALL)}this.setScissorRectEnabled(!1),ei(o)?o.clearBufferfv(o.COLOR,r,[t,n,i,a]):(o.clearColor(t,n,i,a),o.clear(o.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Xi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),ei(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Xi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),ei(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t,n=this.gl,i=r,a=i.uniformBufferBindings,o=i.samplerBindings,l=i.bindingLayouts;Xi(0<l.bindingLayoutTables.length);var c=l.bindingLayoutTables[0];Xi(a.length>=c.numUniformBuffers),Xi(o.length>=c.numSamplers);for(var p=0;p<a.length;p++){var _=a[p];if(_.size!==0){var x=c.firstUniformBuffer+p,A=_.buffer,w=_.offset||0,I=_.size||A.byteSize;if(A!==this.currentUniformBuffers[x]||w!==this.currentUniformBufferByteOffsets[x]||I!==this.currentUniformBufferByteSizes[x]){var P=w%A.pageByteSize,H=A.gl_buffer_pages[w/A.pageByteSize|0];Xi(P+I<=A.pageByteSize),ei(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,x,H,P,I),this.currentUniformBuffers[x]=A,this.currentUniformBufferByteOffsets[x]=w,this.currentUniformBufferByteSizes[x]=I}}}for(var p=0;p<c.numSamplers;p++){var _=o[p],W=c.firstSampler+p,oe=_!==null&&_.sampler!==null?k1(_.sampler):null,ce=_!==null&&_.texture!==null?dm(_.texture):null;if(this.currentSamplers[W]!==oe&&(ei(n)&&n.bindSampler(W,oe),this.currentSamplers[W]=oe),this.currentTextures[W]!==ce){if(this.setActiveTexture(n.TEXTURE0+W),ce!==null){var Oe=tv(_).texture,Fe=Oe.gl_target,je=Oe.width,tt=Oe.height;_.texture.textureIndex=W,n.bindTexture(Fe,ce),ei(n)||(t=_.sampler)===null||t===void 0||t.setTextureParameters(Fe,je,tt),this.debugGroupStatisticsTextureBind()}else{var vt=Object(Un.a)(Object(Un.a)({},_),gC),kt=vt.dimension,ir=vt.formatKind,Fe=X7(kt);n.bindTexture(Fe,this.getFallbackTexture(Object(Un.a)({gl_target:Fe,formatKind:ir},vt)))}this.currentTextures[W]=ce}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&ku.RED),!!(n.channelWriteMask&ku.GREEN),!!(n.channelWriteMask&ku.BLUE),!!(n.channelWriteMask&ku.ALPHA)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||o)&&(rd(t.rgbBlendState)&&rd(t.alphaBlendState)?a.enableiOES(r,i.BLEND):rd(n.rgbBlendState)&&rd(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),o&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&ku.RED),!!(t.channelWriteMask&ku.GREEN),!!(t.channelWriteMask&ku.BLUE),!!(t.channelWriteMask&ku.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(rd(r.rgbBlendState)&&rd(r.alphaBlendState)?n.enable(n.BLEND):rd(t.rgbBlendState)&&rd(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Xi(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(fC(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),hC(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!b0(n.stencilFront,r.stencilFront)){var a=r.stencilFront,o=a.passOp,l=a.failOp,c=a.depthFailOp,p=a.compare;(n.stencilFront.passOp!==o||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==c)&&(t.stencilOpSeparate(t.FRONT,l,c,o),n.stencilFront.passOp=o,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=c),n.stencilFront.compare!==p&&(this.setStencilReference(0),n.stencilFront.compare=p)}if(!b0(n.stencilBack,r.stencilBack)){var _=r.stencilBack,o=_.passOp,l=_.failOp,c=_.depthFailOp,p=_.compare;(n.stencilBack.passOp!==o||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==c)&&(t.stencilOpSeparate(t.BACK,l,c,o),n.stencilBack.passOp=o,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=c),n.stencilBack.compare!==p&&(this.setStencilReference(0),n.stencilBack.compare=p)}n.cullMode!==r.cullMode&&(n.cullMode===Ql.NONE?t.enable(t.CULL_FACE):r.cullMode===Ql.NONE&&t.disable(t.CULL_FACE),r.cullMode===Ql.BACK?t.cullFace(t.BACK):r.cullMode===Ql.FRONT?t.cullFace(t.FRONT):r.cullMode===Ql.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Xi(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Xi(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===Jl.NeedsBind){var n=this.gl,i=t.gl_program,a=t.descriptor,o=wC(a.vertex.glsl,i8);if(ei(n))for(var l=0;l<o.length;l++){var c=Object(Un.e)(o[l],2),p=c[1],_=n.getUniformBlockIndex(i,p);_!==-1&&_!==4294967295&&n.uniformBlockBinding(i,_,l)}for(var x=wC(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<x.length;l++){var A=Object(Un.e)(x[l],3),w=A[1],I=A[2],P=n.getUniformLocation(i,w);n.uniform1i(P,parseInt(I))}t.compileState=Jl.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,o;if(r!==null){Xi(this.currentPipeline.inputLayout===r);var l=r;this.bindVAO(l.vao);for(var c=this.gl,p=0;p<l.vertexBufferDescriptors.length;p++){var _=l.vertexBufferDescriptors[p],x=_.arrayStride,A=_.attributes;try{for(var w=(i=void 0,Object(Un.i)(A)),I=w.next();!I.done;I=w.next()){var P=I.value,H=P.shaderLocation,W=P.offset,oe=ei(c)?H:(o=l.program.attributes[H])===null||o===void 0?void 0:o.location;if(!rf(oe)){var ce=t[p];if(ce===null)continue;var Oe=P.vertexFormat;c.bindBuffer(c.ARRAY_BUFFER,pm(ce.buffer));var Fe=(ce.offset||0)+W;c.vertexAttribPointer(oe,Oe.size,Oe.type,Oe.normalized,x,Fe)}}}catch(tt){i={error:tt}}finally{try{I&&!I.done&&(a=w.return)&&a.call(w)}finally{if(i)throw i.error}}}if(Xi(n!==null==(l.indexBufferFormat!==null)),n!==null){var je=n.buffer;Xi(je.usage===mo.INDEX),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,pm(je)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Xi(this.currentPipeline.inputLayout===null),Xi(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,o=this.gl,l=this.currentPipeline;if(t){var c=[l.drawMode,n||0,r,t];ei(o)?o.drawArraysInstanced.apply(o,Object(Un.h)([],Object(Un.e)(c),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,Object(Un.h)([],Object(Un.e)(c),!1))}else o.drawArrays(l.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var o,l=this.gl,c=this.currentPipeline,p=tv(c.inputLayout),_=tv(this.currentIndexBufferByteOffset)+n*p.indexBufferCompByteSize;if(t){var x=[c.drawMode,r,p.indexBufferType,_,t];ei(l)?l.drawElementsInstanced.apply(l,Object(Un.h)([],Object(Un.e)(x),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,Object(Un.h)([],Object(Un.e)(x),!1))}else l.drawElements(c.drawMode,r,p.indexBufferType,_);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(ei(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(ei(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=ei(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var o=this.currentColorResolveTos[i],l=!1;o!==null&&(Xi(a.width===o.width&&a.height===o.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,o===this.scTexture?r.bindFramebuffer(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,o.width,o.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,o),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var c=this.currentDepthStencilAttachment;if(c){var p=this.currentDepthStencilResolveTo,l=!1;p&&(Xi(c.width===p.width&&c.height===p.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,c),this.bindFramebufferDepthStencilAttachment(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,p)),l=!0,t&&r.blitFramebuffer(0,0,c.width,c.height,0,0,p.width,p.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,c),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?lt.READ_FRAMEBUFFER:lt.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?lt.DRAW_FRAMEBUFFER:lt.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){rf(this.currentStencilRef)||(this.gl.stencilFuncSeparate(lt.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(lt.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===lt.TEXTURE_2D)return n===ns.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===lt.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===lt.TEXTURE_3D)return this.fallbackTexture3D;if(t===lt.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:mo.VERTEX|mo.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:ev.VERTEX,attributes:[{format:Vt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ks.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Vt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:fm(rv)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[s7]}),a=this.getCanvas(),o=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,o,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),o8=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return Object(Un.b)(this,void 0,void 0,function(){var t,n,i,a,o,l,c,p,_,x,A;return Object(Un.d)(this,function(w){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,o=a===void 0?!1:a,l=t.preserveDrawingBuffer,c=l===void 0?!1:l,p=t.premultipliedAlpha,_=p===void 0?!0:p,x={antialias:o,preserveDrawingBuffer:c,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(A=r.getContext("webgl2",x)||r.getContext("experimental-webgl2",x)),!A&&n.includes("webgl1")&&(A=r.getContext("webgl",x)||r.getContext("experimental-webgl",x)),[2,new a8(A,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}(),Fs,RC=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&RC.decode();var kg=null;function S0(){return(kg===null||kg.byteLength===0)&&(kg=new Uint8Array(Fs.memory.buffer)),kg}function A0(e,r){return e=e>>>0,RC.decode(S0().subarray(e,e+r))}var ip=new Array(128).fill(void 0);ip.push(void 0,null,!0,!1);var Fg=ip.length;function s8(e){Fg===ip.length&&ip.push(ip.length+1);var r=Fg;return Fg=ip[r],ip[r]=e,r}function T0(e){return ip[e]}function u8(e){e<132||(ip[e]=Fg,Fg=e)}function l8(e){var r=T0(e);return u8(e),r}var Bg=0,C0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},c8=typeof C0.encodeInto=="function"?function(e,r){return C0.encodeInto(e,r)}:function(e,r){var t=C0.encode(e);return r.set(t),{read:e.length,written:t.length}};function L1(e,r,t){if(t===void 0){var n=C0.encode(e),i=r(n.length,1)>>>0;return S0().subarray(i,i+n.length).set(n),Bg=n.length,i}for(var a=e.length,o=r(a,1)>>>0,l=S0(),c=0;c<a;c++){var p=e.charCodeAt(c);if(p>127)break;l[o+c]=p}if(c!==a){c!==0&&(e=e.slice(c)),o=t(o,a,a=c+e.length*3,1)>>>0;var _=S0().subarray(o+c,o+a),x=c8(e,_);c+=x.written}return Bg=c,o}var Lg=null;function w0(){return(Lg===null||Lg.byteLength===0)&&(Lg=new Int32Array(Fs.memory.buffer)),Lg}function f8(e,r,t){var n,i;try{var a=Fs.__wbindgen_add_to_stack_pointer(-16),o=L1(e,Fs.__wbindgen_malloc,Fs.__wbindgen_realloc),l=Bg,c=L1(r,Fs.__wbindgen_malloc,Fs.__wbindgen_realloc),p=Bg;Fs.glsl_compile(a,o,l,c,p,t);var _=w0()[a/4+0],x=w0()[a/4+1];return n=_,i=x,A0(_,x)}finally{Fs.__wbindgen_add_to_stack_pointer(16),Fs.__wbindgen_free(n,i,1)}}var MC=function(){function e(){Object(Y6.a)(this,e);var r=Fs.wgslcomposer_new();return e.__wrap(r)}return Object(K6.a)(e,[{key:"__destroy_into_raw",value:function(){var t=this.__wbg_ptr;return this.__wbg_ptr=0,t}},{key:"free",value:function(){var t=this.__destroy_into_raw();Fs.__wbg_wgslcomposer_free(t)}},{key:"wgsl_compile",value:function(t){var n,i;try{var a=Fs.__wbindgen_add_to_stack_pointer(-16),o=L1(t,Fs.__wbindgen_malloc,Fs.__wbindgen_realloc),l=Bg;Fs.wgslcomposer_wgsl_compile(a,this.__wbg_ptr,o,l);var c=w0()[a/4+0],p=w0()[a/4+1];return n=c,i=p,A0(c,p)}finally{Fs.__wbindgen_add_to_stack_pointer(16),Fs.__wbindgen_free(n,i,1)}}}],[{key:"__wrap",value:function(t){t=t>>>0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function h8(e,r){return N1.apply(this,arguments)}function N1(){return N1=Object(iC.a)(p0.a.mark(function e(r,t){var n,i;return p0.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(typeof Response=="function"&&r instanceof Response)){o.next=23;break}if(typeof WebAssembly.instantiateStreaming!="function"){o.next=15;break}return o.prev=2,o.next=5,WebAssembly.instantiateStreaming(r,t);case 5:return o.abrupt("return",o.sent);case 8:if(o.prev=8,o.t0=o.catch(2),r.headers.get("Content-Type")=="application/wasm"){o.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o.t0),o.next=15;break;case 14:throw o.t0;case 15:return o.next=17,r.arrayBuffer();case 17:return n=o.sent,o.next=20,WebAssembly.instantiate(n,t);case 20:return o.abrupt("return",o.sent);case 23:return o.next=25,WebAssembly.instantiate(r,t);case 25:if(i=o.sent,!(i instanceof WebAssembly.Instance)){o.next=30;break}return o.abrupt("return",{instance:i,module:r});case 30:return o.abrupt("return",i);case 31:case"end":return o.stop()}},e,null,[[2,8]])})),N1.apply(this,arguments)}function p8(){var e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){var n=A0(r,t);return s8(n)},e.wbg.__wbindgen_object_drop_ref=function(r){l8(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(T0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(T0(r),T0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(A0(r,t))},e}function d8(e,r){return Fs=e.exports,PC.__wbindgen_wasm_module=r,Lg=null,kg=null,Fs}function PC(e){return j1.apply(this,arguments)}function j1(){return j1=Object(iC.a)(p0.a.mark(function e(r){var t,n,i,a;return p0.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(Fs===void 0){l.next=2;break}return l.abrupt("return",Fs);case 2:return t=p8(),(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r)),l.t0=h8,l.next=7,r;case 7:return l.t1=l.sent,l.t2=t,l.next=11,(0,l.t0)(l.t1,l.t2);case 11:return n=l.sent,i=n.instance,a=n.module,l.abrupt("return",d8(i,a));case 15:case"end":return l.stop()}},e)})),j1.apply(this,arguments)}var Rl;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(Rl||(Rl={}));var z1;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(z1||(z1={}));function v8(e){var r=0;return e&Ec.SAMPLED&&(r|=Rl.TEXTURE_BINDING|Rl.COPY_DST),e&Ec.RENDER_TARGET&&(r|=Rl.RENDER_ATTACHMENT|Rl.TEXTURE_BINDING|Rl.COPY_SRC|Rl.COPY_DST),r}function U1(e){if(e===Vt.U8_R_NORM)return"r8unorm";if(e===Vt.U8_RG_NORM)return"rg8unorm";if(e===Vt.U8_RGBA_RT)return"bgra8unorm";if(e===Vt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Vt.U8_RGBA_NORM)return"rgba8unorm";if(e===Vt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Vt.S8_R_NORM)return"r8snorm";if(e===Vt.S8_RG_NORM)return"rg8snorm";if(e===Vt.S8_RGBA_NORM)return"rgba8snorm";if(e===Vt.U32_R)return"r32uint";if(e===Vt.F16_RGBA)return"rgba16float";if(e===Vt.F32_RGBA)return"rgba32float";if(e===Vt.D24)return"depth24plus";if(e===Vt.D24_S8)return"depth24plus-stencil8";if(e===Vt.D32F)return"depth32float";if(e===Vt.D32F_S8)return"depth32float-stencil8";if(e===Vt.BC1)return"bc1-rgba-unorm";if(e===Vt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Vt.BC2)return"bc2-rgba-unorm";if(e===Vt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Vt.BC3)return"bc3-rgba-unorm";if(e===Vt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Vt.BC4_SNORM)return"bc4-r-snorm";if(e===Vt.BC4_UNORM)return"bc4-r-unorm";if(e===Vt.BC5_SNORM)return"bc5-rg-snorm";if(e===Vt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function m8(e){if(e===aa.TEXTURE_2D)return"2d";if(e===aa.TEXTURE_CUBE_MAP)return"2d";if(e===aa.TEXTURE_2D_ARRAY)return"2d";if(e===aa.TEXTURE_3D)return"3d";throw new Error("whoops")}function g8(e){if(e===aa.TEXTURE_2D)return"2d";if(e===aa.TEXTURE_CUBE_MAP)return"cube";if(e===aa.TEXTURE_2D_ARRAY)return"2d-array";if(e===aa.TEXTURE_3D)return"3d";throw new Error("whoops")}function y8(e){var r=0;return e&mo.INDEX&&(r|=GPUBufferUsage.INDEX),e&mo.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&mo.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&mo.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&mo.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),r|=GPUBufferUsage.COPY_DST,r}function V1(e){if(e===wl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===wl.REPEAT)return"repeat";if(e===wl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function IC(e){if(e===Ds.BILINEAR)return"linear";if(e===Ds.POINT)return"nearest";throw new Error("whoops")}function _8(e){if(e===Js.LINEAR)return"linear";if(e===Js.NEAREST)return"nearest";if(e===Js.NO_MIP)return"nearest";throw new Error("whoops")}function vm(e){var r=e;return r.gpuBuffer}function b8(e){var r=e;return r.gpuSampler}function x8(e){var r=e;return r.querySet}function E8(e){if(e===d0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function S8(e){switch(e){case ks.TRIANGLES:return"triangle-list";case ks.POINTS:return"point-list";case ks.TRIANGLE_STRIP:return"triangle-strip";case ks.LINES:return"line-list";case ks.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function A8(e){if(e===Ql.NONE)return"none";if(e===Ql.FRONT)return"front";if(e===Ql.BACK)return"back";throw new Error("whoops")}function T8(e){if(e===Rg.CCW)return"ccw";if(e===Rg.CW)return"cw";throw new Error("whoops")}function C8(e,r){return{topology:S8(e),cullMode:A8(r.cullMode),frontFace:T8(r.frontFace)}}function DC(e){if(e===ga.ZERO)return"zero";if(e===ga.ONE)return"one";if(e===ga.SRC)return"src";if(e===ga.ONE_MINUS_SRC)return"one-minus-src";if(e===ga.DST)return"dst";if(e===ga.ONE_MINUS_DST)return"one-minus-dst";if(e===ga.SRC_ALPHA)return"src-alpha";if(e===ga.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===ga.DST_ALPHA)return"dst-alpha";if(e===ga.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===ga.CONST)return"constant";if(e===ga.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===ga.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function w8(e){if(e===Du.ADD)return"add";if(e===Du.SUBSTRACT)return"subtract";if(e===Du.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Du.MIN)return"min";if(e===Du.MAX)return"max";throw new Error("whoops")}function kC(e){return{operation:w8(e.blendMode),srcFactor:DC(e.blendSrcFactor),dstFactor:DC(e.blendDstFactor)}}function FC(e){return e.blendMode===Du.ADD&&e.blendSrcFactor===ga.ONE&&e.blendDstFactor===ga.ZERO}function O8(e){if(!(FC(e.rgbBlendState)&&FC(e.alphaBlendState)))return{color:kC(e.rgbBlendState),alpha:kC(e.alphaBlendState)}}function R8(e,r){return{format:U1(r),blend:O8(e),writeMask:e.channelWriteMask}}function M8(e,r){return r.attachmentsState.map(function(t,n){return R8(t,e[n])})}function O0(e){if(e===Ta.NEVER)return"never";if(e===Ta.LESS)return"less";if(e===Ta.EQUAL)return"equal";if(e===Ta.LEQUAL)return"less-equal";if(e===Ta.GREATER)return"greater";if(e===Ta.NOTEQUAL)return"not-equal";if(e===Ta.GEQUAL)return"greater-equal";if(e===Ta.ALWAYS)return"always";throw new Error("whoops")}function mm(e){if(e===tl.KEEP)return"keep";if(e===tl.REPLACE)return"replace";if(e===tl.ZERO)return"zero";if(e===tl.DECREMENT_CLAMP)return"decrement-clamp";if(e===tl.DECREMENT_WRAP)return"decrement-wrap";if(e===tl.INCREMENT_CLAMP)return"increment-clamp";if(e===tl.INCREMENT_WRAP)return"increment-wrap";if(e===tl.INVERT)return"invert";throw new Error("whoops")}function P8(e,r){if(!rf(e))return{format:U1(e),depthWriteEnabled:!!r.depthWrite,depthCompare:O0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:O0(r.stencilFront.compare),passOp:mm(r.stencilFront.passOp),failOp:mm(r.stencilFront.failOp),depthFailOp:mm(r.stencilFront.depthFailOp)},stencilBack:{compare:O0(r.stencilBack.compare),passOp:mm(r.stencilBack.passOp),failOp:mm(r.stencilBack.failOp),depthFailOp:mm(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function I8(e){if(e!==null){if(e===Vt.U16_R)return"uint16";if(e===Vt.U32_R)return"uint32";throw new Error("whoops")}}function D8(e){if(e===ev.VERTEX)return"vertex";if(e===ev.INSTANCE)return"instance";throw new Error("whoops")}function k8(e){if(e===Vt.U8_R)return"uint8x2";if(e===Vt.U8_RG)return"uint8x2";if(e===Vt.U8_RGB)return"uint8x4";if(e===Vt.U8_RGBA)return"uint8x4";if(e===Vt.U8_RG_NORM)return"unorm8x2";if(e===Vt.U8_RGBA_NORM)return"unorm8x4";if(e===Vt.S8_RGB_NORM)return"snorm8x4";if(e===Vt.S8_RGBA_NORM)return"snorm8x4";if(e===Vt.U16_RG_NORM)return"unorm16x2";if(e===Vt.U16_RGBA_NORM)return"unorm16x4";if(e===Vt.S16_RG_NORM)return"snorm16x2";if(e===Vt.S16_RGBA_NORM)return"snorm16x4";if(e===Vt.S16_RG)return"uint16x2";if(e===Vt.F16_RG)return"float16x2";if(e===Vt.F16_RGBA)return"float16x4";if(e===Vt.F32_R)return"float32";if(e===Vt.F32_RG)return"float32x2";if(e===Vt.F32_RGB)return"float32x3";if(e===Vt.F32_RGBA)return"float32x4";throw"whoops"}function F8(e){var r=_h(e);switch(r){case zr.BC1:case zr.BC2:case zr.BC3:case zr.BC4_SNORM:case zr.BC4_UNORM:case zr.BC5_SNORM:case zr.BC5_UNORM:return!0;default:return!1}}function B8(e){var r=_h(e);switch(r){case zr.BC1:case zr.BC2:case zr.BC3:case zr.BC4_SNORM:case zr.BC4_UNORM:case zr.BC5_SNORM:case zr.BC5_UNORM:return 4;default:return 1}}function BC(e,r,t,n){switch(t===void 0&&(t=!1),e){case Vt.S8_R:case Vt.S8_R_NORM:case Vt.S8_RG_NORM:case Vt.S8_RGB_NORM:case Vt.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case Vt.U8_R:case Vt.U8_R_NORM:case Vt.U8_RG:case Vt.U8_RG_NORM:case Vt.U8_RGB:case Vt.U8_RGB_NORM:case Vt.U8_RGB_SRGB:case Vt.U8_RGBA:case Vt.U8_RGBA_NORM:case Vt.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case Vt.S16_R:case Vt.S16_RG:case Vt.S16_RG_NORM:case Vt.S16_RGB_NORM:case Vt.S16_RGBA:case Vt.S16_RGBA_NORM:{var o=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&o.set(new Int16Array(n)),o}case Vt.U16_R:case Vt.U16_RGB:case Vt.U16_RGBA_5551:case Vt.U16_RGBA_NORM:case Vt.U16_RG_NORM:case Vt.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case Vt.S32_R:{var c=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&c.set(new Int32Array(n)),c}case Vt.U32_R:case Vt.U32_RG:{var p=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&p.set(new Uint32Array(n)),p}case Vt.F32_R:case Vt.F32_RG:case Vt.F32_RGB:case Vt.F32_RGBA:{var _=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&_.set(new Float32Array(n)),_}}var x=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&x.set(new Uint8Array(n)),x}function L8(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*Infinity:(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}var bh=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(aC.a),N8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.Bindings;var l=a.pipeline;Xi(!!l);var c=a.uniformBufferBindings,p=a.storageBufferBindings,_=a.samplerBindings;o.numUniformBuffers=(c==null?void 0:c.length)||0;var x=[[],[]],A=0;if(p&&p.length)for(var w=0;w<p.length;w++){var I=a.storageBufferBindings[w],P=I.binding,H=I.size,W=I.offset,oe=I.buffer,ce={buffer:vm(oe),offset:W!=null?W:0,size:H};x[0].push({binding:P!=null?P:A++,resource:ce})}if(c&&c.length)for(var w=0;w<c.length;w++){var Oe=a.uniformBufferBindings[w],P=Oe.binding,H=Oe.size,W=Oe.offset,oe=Oe.buffer,ce={buffer:vm(oe),offset:W!=null?W:0,size:H};x[0].push({binding:P!=null?P:A++,resource:ce})}if(_&&_.length){A=0;for(var w=0;w<_.length;w++){var Fe=Object(Un.a)(Object(Un.a)({},_[w]),gC),P=a.samplerBindings[w],je=P.texture!==null?P.texture:o.device.getFallbackTexture(Fe);Fe.dimension=je.dimension,Fe.formatKind=cC(je.format);var tt=je.gpuTextureView;x[1].push({binding:A++,resource:tt});var vt=P.sampler!==null?P.sampler:o.device.getFallbackSampler(Fe),kt=b8(vt);x[1].push({binding:A++,resource:kt})}}return o.gpuBindGroup=x.filter(function(ir){return ir.length>0}).map(function(ir,ur){return o.device.device.createBindGroup({layout:l.getBindGroupLayout(ur),entries:ir})}),o}return r}(bh),j8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.Buffer;var l=a.usage,c=a.viewOrSize,p=!!(l&mo.MAP_READ);o.usage=y8(l),p&&(o.usage=mo.MAP_READ|mo.COPY_DST);var _=!am(c);if(o.view=am(c)?null:c,o.size=am(c)?y0(c,4):y0(c.byteLength,4),am(c))o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:p?_:!1});else{o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0});var x=c&&c.constructor||Float32Array;new x(o.gpuBuffer.getMappedRange()).set(c),o.gpuBuffer.unmap()}return o}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var o=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,c=l+a,p=a+3&~3;if(p!==a){var _=new Uint8Array(n.buffer.slice(l,c));n=new Uint8Array(p),n.set(_),i=0,l=0,c=p,a=p}for(var x=1024*1024*15,A=0;c-(l+A)>x;)this.device.device.queue.writeBuffer(o,t+A,n.buffer,l+A,x),A+=x;this.device.device.queue.writeBuffer(o,t+A,n.buffer,l+A,a-A)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(bh),z8=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){Xi(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=tv(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=r;this.gpuComputePassEncoder.setBindGroup(0,t.gpuBindGroup[0])},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),U8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=a;var l=a.program,c=l.computeStage;if(c===null)return o;var p={layout:"auto",compute:Object(Un.a)({},c)};return o.gpuComputePipeline=o.device.device.createComputePipeline(p),o.name!==void 0&&(o.gpuComputePipeline.label=o.name),o}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(bh),V8=function(e){Object(Un.c)(r,e);function r(t){var n,i,a,o,l=t.id,c=t.device,p=t.descriptor,_=e.call(this,{id:l,device:c})||this;_.type=Ia.InputLayout;var x=[];try{for(var A=Object(Un.i)(p.vertexBufferDescriptors),w=A.next();!w.done;w=A.next()){var I=w.value,P=I.arrayStride,H=I.stepMode,W=I.attributes;x.push({arrayStride:P,stepMode:D8(H),attributes:[]});try{for(var oe=(a=void 0,Object(Un.i)(W)),ce=oe.next();!ce.done;ce=oe.next()){var Oe=ce.value,Fe=Oe.shaderLocation,je=Oe.format,tt=Oe.offset;x[x.length-1].attributes.push({shaderLocation:Fe,format:k8(je),offset:tt})}}catch(vt){a={error:vt}}finally{try{ce&&!ce.done&&(o=oe.return)&&o.call(oe)}finally{if(a)throw a.error}}}}catch(vt){n={error:vt}}finally{try{w&&!w.done&&(i=A.return)&&i.call(A)}finally{if(n)throw n.error}}return _.indexFormat=I8(p.indexBufferFormat),_.buffers=x,_}return r}(bh),LC=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Ia.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=a,a.vertex&&(o.vertexStage=o.createShaderStage(a.vertex,"vertex")),a.fragment&&(o.fragmentStage=o.createShaderStage(a.fragment,"fragment")),a.compute&&(o.computeStage=o.createShaderStage(a.compute,"compute")),o}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,o=t.glsl,l=t.wgsl,c=t.entryPoint,p=!1,_=l;if(!_)try{_=this.device.glsl_compile(o,n,p)}catch(H){throw console.error(H,o),new Error("whoops")}var x=function(W){if(!_.includes(W))return"continue";_=_.replace("var T_".concat(W,": texture_2d<f32>;"),"var T_".concat(W,": texture_depth_2d;")),_=_.replace(new RegExp("textureSample\\(T_".concat(W,"(.*)\\);$"),"gm"),function(oe,ce){return"vec4<f32>(textureSample(T_".concat(W).concat(ce,"), 0.0, 0.0, 0.0);")})};try{for(var A=Object(Un.i)(["u_TextureFramebufferDepth"]),w=A.next();!w.done;w=A.next()){var I=w.value;x(I)}}catch(H){i={error:H}}finally{try{w&&!w.done&&(a=A.return)&&a.call(A)}finally{if(i)throw i.error}}var P=this.device.device.createShaderModule({code:_});return{module:P,entryPoint:c||"main"}},r}(bh),H8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Ia.QueryPool;var l=a.elemCount,c=a.type;return o.querySet=o.device.device.createQuerySet({type:E8(c),count:l}),o.resolveBuffer=o.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(bh),W8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=Ia.Readback,a}return r.prototype.readTexture=function(t,n,i,a,o,l,c,p){return c===void 0&&(c=0),Object(Un.b)(this,void 0,void 0,function(){var _,x,A,w,I,P,H,W;return Object(Un.d)(this,function(oe){return _=t,x=0,A=this.getBlockInformationFromFormat(_.gpuTextureformat),w=Math.ceil(a/A.width)*A.length,I=Math.ceil(w/256)*256,P=I*o,H=this.device.createBuffer({usage:mo.STORAGE|mo.MAP_READ|mo.COPY_DST,hint:Df.STATIC,viewOrSize:P}),W=this.device.device.createCommandEncoder(),W.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(x,0)}},{buffer:H.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:o,depthOrArrayLayers:1}),this.device.device.queue.submit([W.finish()]),[2,this.readBuffer(H,0,l.byteLength===P?l:null,c,P,_.format)]})})},r.prototype.readTextureSync=function(t,n,i,a,o,l,c,p){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,o,l,c,p){var _=this;n===void 0&&(n=0),i===void 0&&(i=null),o===void 0&&(o=0),l===void 0&&(l=Vt.U8_RGB),c===void 0&&(c=!1);var x=t,A=o||x.size,w=i||x.view,I=w&&w.constructor&&w.constructor.BYTES_PER_ELEMENT||lC(l),P=x;if(!(x.usage&mo.MAP_READ&&x.usage&mo.COPY_DST)){var H=this.device.device.createCommandEncoder();P=this.device.createBuffer({usage:mo.STORAGE|mo.MAP_READ|mo.COPY_DST,hint:Df.STATIC,viewOrSize:A}),H.copyBufferToBuffer(x.gpuBuffer,n,P.gpuBuffer,0,A),this.device.device.queue.submit([H.finish()])}return new Promise(function(W,oe){P.gpuBuffer.mapAsync(z1.READ,n,A).then(function(){var ce=P.gpuBuffer.getMappedRange(n,A),Oe=w;if(c)Oe===null?Oe=BC(l,A,!0,ce):Oe=BC(l,Oe.buffer,void 0,ce);else if(Oe===null)switch(I){case 1:Oe=new Uint8Array(A),Oe.set(new Uint8Array(ce));break;case 2:Oe=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,ce);break;case 4:Oe=new Float32Array(A/4),Oe.set(new Float32Array(ce));break}else switch(I){case 1:Oe=new Uint8Array(Oe.buffer),Oe.set(new Uint8Array(ce));break;case 2:Oe=_.getHalfFloatAsFloatRGBAArrayBuffer(A/2,ce,w);break;case 4:var Fe=w&&w.constructor||Float32Array;Oe=new Fe(Oe.buffer),Oe.set(new Fe(ce));break}P.gpuBuffer.unmap(),W(Oe)},function(ce){return oe(ce)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=L8(a[t]);return i},r.prototype.getBlockInformationFromFormat=function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},r}(bh),G8=function(){function e(r){this.device=r,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(r,t){return Xi(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,o,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var c=r.colorAttachment.length;this.gfxColorAttachment.length=c,this.gfxColorResolveTo.length=c;for(var p=0;p<r.colorAttachment.length;p++){var _=r.colorAttachment[p],x=r.colorResolveTo[p];if(_===null&&x!==null&&(_=x,x=null),this.gfxColorAttachment[p]=_,this.gfxColorResolveTo[p]=x,this.gfxColorAttachmentLevel[p]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[p])||0,this.gfxColorResolveToLevel[p]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[p])||0,_!==null){this.gpuColorAttachments[p]===void 0&&(this.gpuColorAttachments[p]={});var A=this.gpuColorAttachments[p];A.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[p])||0);var w=(o=(a=r.colorClearColor)===null||a===void 0?void 0:a[p])!==null&&o!==void 0?o:"load";w==="load"?A.loadOp="load":(A.loadOp="clear",A.clearValue=w),A.storeOp=((l=r.colorStore)===null||l===void 0?void 0:l[p])?"store":"discard",A.resolveTarget=void 0,x!==null&&(_.sampleCount>1?A.resolveTarget=this.getTextureView(x,this.gfxColorResolveToLevel[p]):A.storeOp="store")}else{this.gpuColorAttachments.length=p,this.gfxColorAttachment.length=p,this.gfxColorResolveTo.length=p;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var I=r.depthStencilAttachment,A=this.gpuDepthStencilAttachment;A.view=I.gpuTextureView;var P=!!(um(I.format)&Ln.Depth);P?(r.depthClearValue==="load"?A.depthLoadOp="load":(A.depthLoadOp="clear",A.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.depthStoreOp="store":A.depthStoreOp="discard"):(A.depthLoadOp=void 0,A.depthStoreOp=void 0);var H=!!(um(I.format)&Ln.Stencil);H?(r.stencilClearValue==="load"?A.stencilLoadOp="load":(A.stencilLoadOp="clear",A.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?A.stencilStoreOp="store":A.stencilStoreOp="discard"):(A.stencilLoadOp=void 0,A.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=rf(r.occlusionQueryPool)?void 0:x8(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r){Xi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,o){a===void 0&&(a=0),o===void 0&&(o=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,o)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=tv(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=r;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(vm(n.buffer),tv(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var o=t[a];o!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,vm(o.buffer),o.offset)}}},e.prototype.setBindings=function(r){var t=r;this.gpuRenderPassEncoder.setBindGroup(0,t.gpuBindGroup[0]),t.gpuBindGroup[1]&&this.gpuRenderPassEncoder.setBindGroup(1,t.gpuBindGroup[1])},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.gpuRenderPassEncoder.draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.gpuRenderPassEncoder.drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndirect(vm(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndexedIndirect(vm(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var t=this.gfxColorAttachment[r],n=this.gfxColorResolveTo[r];t!==null&&n!==null&&t.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[r],t,this.gfxColorResolveToLevel[r])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(r,t,n,i){Xi(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},o={texture:r.gpuTexture,mipLevel:t};Xi(n.width>>>i==r.width>>>t),Xi(n.height>>>i==r.height>>>t),Xi(!!(n.usage&Rl.COPY_SRC)),Xi(!!(r.usage&Rl.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,o,[r.width,r.height,1])},e}(),X8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Ia.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=a,o.device.createRenderPipelineInternal(o,!1),o}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(bh),Z8=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;c.type=Ia.Sampler;var p=a.lodMinClamp,_=a.mipmapFilter===Js.NO_MIP?a.lodMinClamp:a.lodMaxClamp,x=(o=a.maxAnisotropy)!==null&&o!==void 0?o:1;return x>1&&Xi(a.minFilter===Ds.BILINEAR&&a.magFilter===Ds.BILINEAR&&a.mipmapFilter===Js.LINEAR),c.gpuSampler=c.device.device.createSampler({addressModeU:V1(a.addressModeU),addressModeV:V1(a.addressModeV),addressModeW:V1((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:p,lodMaxClamp:_,minFilter:IC(a.minFilter),magFilter:IC(a.magFilter),mipmapFilter:_8(a.mipmapFilter),compare:a.compareFunction!==void 0?O0(a.compareFunction):void 0,maxAnisotropy:x}),c}return r}(bh),R0=function(e){Object(Un.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=t.skipCreate,l=t.sampleCount,c=e.call(this,{id:n,device:i})||this;c.type=Ia.Texture;var p=a.format,_=a.dimension,x=a.width,A=a.height,w=a.depthOrArrayLayers,I=a.mipLevelCount,P=a.usage;return c.device.createTextureShared({format:p,dimension:_!=null?_:aa.TEXTURE_2D,width:x,height:A,depthOrArrayLayers:w!=null?w:1,mipLevelCount:I!=null?I:1,usage:P,sampleCount:l!=null?l:1},c,o),c}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,o=n[0].height,l={size:{width:a,height:o,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},c=t.createTexture(l),p=0;p<n.length;p++)t.queue.copyExternalImageToTexture({source:n[p]},{texture:c,origin:[0,0,p]},[a,o]);return[c,a,o]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this.device.device,o,l,c;this.isImageBitmapOrCanvases(t)?(i=Object(Un.e)(this.textureFromImageBitmapOrCanvas(a,t,this.depthOrArrayLayers),3),o=i[0],l=i[1],c=i[2]):this.isVideo(t)&&(o=a.importExternalTexture({source:t[0]})),this.width=l,this.height=c,this.gpuTexture=o,this.gpuTextureView=o.createView({dimension:g8(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(bh),$8=function(){function e(r,t,n,i,a,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Rl.RENDER_ATTACHMENT|Rl.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=om.UPPER_LEFT,this.clipSpaceNearZ=sm.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(aa.TEXTURE_2D,ns.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(aa.TEXTURE_2D,ns.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(aa.TEXTURE_2D_ARRAY,ns.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(aa.TEXTURE_3D,ns.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(aa.TEXTURE_CUBE_MAP,ns.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:wl.REPEAT,addressModeV:wl.REPEAT,minFilter:Ds.POINT,magFilter:Ds.POINT,mipmapFilter:Js.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:wl.REPEAT,addressModeV:wl.REPEAT,minFilter:Ds.POINT,magFilter:Ds.POINT,mipmapFilter:Js.NEAREST,compareFunction:Ta.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new R0({id:0,device:this,descriptor:{format:Vt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:aa.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new j8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new R0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new Z8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new R0({id:this.getNextUniqueId(),device:this,descriptor:Object(Un.a)(Object(Un.a)({},r),{dimension:aa.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Ec.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=Ia.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,o=t.depthOrArrayLayers,l=t.sampleCount,c=t.mipLevelCount,p=t.gpuTexture,_=t.gpuTextureView,x=t.usage;Xi(!!(x&Rl.RENDER_ATTACHMENT));var A=new R0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:o,dimension:aa.TEXTURE_2D,mipLevelCount:c,usage:x},skipCreate:!0});return A.depthOrArrayLayers=o,A.sampleCount=l,A.gpuTexture=p,A.gpuTextureView=_,A},e.prototype.createProgram=function(r){var t,n;return((t=r.vertex)===null||t===void 0?void 0:t.glsl)&&(r.vertex.glsl=td(this.queryVendorInfo(),"vert",r.vertex.glsl)),((n=r.fragment)===null||n===void 0?void 0:n.glsl)&&(r.fragment.glsl=td(this.queryVendorInfo(),"frag",r.fragment.glsl)),new LC({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new LC({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,o=U1(r.format),l=m8(r.dimension),c=v8(r.usage);if(t.gpuTextureformat=o,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=c,t.sampleCount=r.sampleCount,!n){var p=this.device.createTexture({size:i,mipLevelCount:a,format:o,dimension:l,sampleCount:r.sampleCount,usage:c}),_=p.createView();t.gpuTexture=p,t.gpuTextureView=_}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===ns.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===aa.TEXTURE_2D)return n===ns.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===aa.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===aa.TEXTURE_3D)return this.fallbackTexture3D;if(t===aa.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===aa.TEXTURE_CUBE_MAP?6:1,i=t===ns.Float?Vt.U8_RGBA_NORM:Vt.D24;return this.createTexture({dimension:r,format:i,usage:Ec.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new N8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new V8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new U8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new X8({id:this.getNextUniqueId(),device:this,descriptor:Object(Un.a)({},r)})},e.prototype.createQueryPool=function(r,t){return new H8({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,o=a.vertexStage,l=a.fragmentStage;if(!(o===null||l===null)){var c=i.megaStateDescriptor||{},p=c.stencilBack,_=c.stencilFront,x=Object(Un.f)(c,["stencilBack","stencilFront"]),A=fm(rv);i.megaStateDescriptor=Object(Un.a)(Object(Un.a)(Object(Un.a)({},A),{stencilBack:Object(Un.a)(Object(Un.a)({},A.stencilBack),p),stencilFront:Object(Un.a)(Object(Un.a)({},A.stencilFront),_)}),x);var w=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(Oe,Fe){i.megaStateDescriptor.attachmentsState[Fe]||(i.megaStateDescriptor.attachmentsState[Fe]=vC(void 0,w))});var I=C8((n=i.topology)!==null&&n!==void 0?n:ks.TRIANGLES,i.megaStateDescriptor),P=M8(i.colorAttachmentFormats,i.megaStateDescriptor),H=P8(i.depthStencilAttachmentFormat,i.megaStateDescriptor),W=void 0;i.inputLayout!==null&&(W=i.inputLayout.buffers);var oe=i.sampleCount,ce={layout:"auto",vertex:Object(Un.a)(Object(Un.a)({},o),{buffers:W}),primitive:I,depthStencil:H,multisample:{count:oe},fragment:Object(Un.a)(Object(Un.a)({},l),{targets:P})};r.gpuRenderPipeline=this.device.createRenderPipeline(ce)}}},e.prototype.createReadback=function(){return new W8({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();return t===void 0&&(t=new G8(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();return r===void 0&&(r=new z8),r.commandEncoder=this.device.createCommandEncoder(),r.beginComputePass(),r},e.prototype.submitPass=function(r){var t=this.device.queue,n=r,i=n.finish();t.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,o){var l=this.device.createCommandEncoder(),c=r,p=i,_={texture:p.gpuTexture,origin:[a,o,0]},x={texture:c.gpuTexture,origin:[t,n,0]};Xi(!!(p.usage&Rl.COPY_SRC)),Xi(!!(c.usage&Rl.COPY_DST)),l.copyTextureToTexture(_,x,[p.width,p.height,1]),this.device.queue.submit([l.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(F8(r)){if(!this.featureTextureCompressionBC)return!1;var i=B8(r);return t%i!=0||n%i!=0?!1:this.featureTextureCompressionBC}switch(r){case Vt.U16_RGBA_NORM:return!1;case Vt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===Ia.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===Ia.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===Ia.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===Ia.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===Ia.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),Y8=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return Object(Un.b)(this,void 0,void 0,function(){var t,n,i,a,o,l,c,p;return Object(Un.d)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],o=a.filter(function(x){return t.features.has(x)}),[4,t.requestDevice({requiredFeatures:o})]);case 5:if(l=_.sent(),l&&(c=this.pluginOptions.onContextLost,l.lost.then(function(){c&&c()})),l===null)return[2,null];if(p=r.getContext("webgpu"),!p)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,PC(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new $8(t,l,r,p,f8,MC&&new MC)]}})})},e}(),K8=fi.isPlainObject,q8=fi.isTypedArray,Q8=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"destroyed",!1),Object(V.a)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,o=t.uniforms,l=t.primitive,c=t.count,p=t.elements,_=t.depth,x=t.cull,A=t.instances,w={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:om.LOWER_LEFT,clipSpaceNearZ:sm.NEGATIVE_ONE,supportMRT:!1},I={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(function(W){I[W]=r.prop(W)}));var P={};Object.keys(a).forEach(function(W){P[W]=a[W].get()});var H={attributes:P,frag:cE(td(w,"frag",i,null,!1)),uniforms:I,vert:cE(td(w,"vert",n,null,!1)),colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:j6[l===void 0?Y.TRIANGLES:l]};A&&(H.instances=A),c?H.count=c:p&&(H.elements=p.get()),this.initDepthDrawParams({depth:_},H),this.initCullDrawParams({cull:x},H),this.drawCommand=r(H),this.drawParams=H}return Object(De.a)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=Object(ae.a)(Object(ae.a)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=Object(ae.a)(Object(ae.a)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(o){var l=Object(Ju.a)(i[o]);l==="boolean"||l==="number"||Array.isArray(i[o])||i[o].BYTES_PER_ELEMENT?a[o]=i[o]:a[o]=i[o].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:H6[i.func||Y.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,o=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:h0[o&&o.srcRGB||Y.SRC_ALPHA],srcAlpha:h0[o&&o.srcAlpha||Y.SRC_ALPHA],dstRGB:h0[o&&o.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:h0[o&&o.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:nC[l&&l.rgb||Y.FUNC_ADD],alpha:nC[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,o=i.mask,l=o===void 0?-1:o,c=i.func,p=c===void 0?{cmp:Y.ALWAYS,ref:0,mask:-1}:c,_=i.opFront,x=_===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:_,A=i.opBack,w=A===void 0?{fail:Y.KEEP,zfail:Y.KEEP,zpass:Y.KEEP}:A;return{enable:!!a,mask:l,func:Object(ae.a)(Object(ae.a)({},p),{},{cmp:W6[p.cmp]}),opFront:{fail:im[x.fail],zfail:im[x.zfail],zpass:im[x.zpass]},opBack:{fail:im[w.fail],zfail:im[w.zfail],zpass:im[w.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,o=i.face,l=o===void 0?Y.BACK:o;n.cull={enable:!!a,face:G6[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||q8(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}K8(n)&&Object.keys(n).forEach(function(l){o.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){o.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}(),J8=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Y.UNSIGNED_BYTE:i,o=t.width,l=t.height,c=t.flipY,p=c===void 0?!1:c,_=t.format,x=_===void 0?Y.RGBA:_,A=t.mipmap,w=A===void 0?!1:A,I=t.wrapS,P=I===void 0?Y.CLAMP_TO_EDGE:I,H=t.wrapT,W=H===void 0?Y.CLAMP_TO_EDGE:H,oe=t.aniso,ce=oe===void 0?0:oe,Oe=t.alignment,Fe=Oe===void 0?1:Oe,je=t.premultiplyAlpha,tt=je===void 0?!1:je,vt=t.mag,kt=vt===void 0?Y.NEAREST:vt,ir=t.min,ur=ir===void 0?Y.NEAREST:ir,Zr=t.colorSpace,ln=Zr===void 0?Y.BROWSER_DEFAULT_WEBGL:Zr,_n=t.x,Hi=_n===void 0?0:_n,io=t.y,Ga=io===void 0?0:io,To=t.copy,Co=To===void 0?!1:To;this.width=o,this.height=l;var nl={width:o,height:l,type:M1[a],format:z6[x],wrapS:rC[P],wrapT:rC[W],mag:tC[kt],min:tC[ur],alignment:Fe,flipY:p,colorSpace:V6[ln],premultiplyAlpha:tt,aniso:ce,x:Hi,y:Ga,copy:Co};n&&(nl.data=n),typeof w=="number"?nl.mipmap=U6[w]:typeof w=="boolean"&&(nl.mipmap=w),this.texture=r.texture(nl)}return Object(De.a)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),NC,jC,ej=(NC=Object(Qr.injectable)(),NC(jC=function(){function e(){var r=this;Object(et.a)(this,e),Object(V.a)(this,"uniformBuffers",[]),Object(V.a)(this,"createModel",function(t){return new Q8(r.gl,t)}),Object(V.a)(this,"createAttribute",function(t){return new N6(r.gl,t)}),Object(V.a)(this,"createBuffer",function(t){return new X6(r.gl,t)}),Object(V.a)(this,"createElements",function(t){return new Z6(r.gl,t)}),Object(V.a)(this,"createTexture2D",function(t){return new J8(r.gl,t)}),Object(V.a)(this,"createFramebuffer",function(t){return new $6(r.gl,t)}),Object(V.a)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),Object(V.a)(this,"clear",function(t){var n,i=t.color,a=t.depth,o=t.stencil,l=t.framebuffer,c=l===void 0?null:l,p={color:i,depth:a,stencil:o};p.framebuffer=c===null?c:c.get(),(n=r.gl)===null||n===void 0||n.clear(p)}),Object(V.a)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,o=t.height;r.gl._gl.viewport(n,i,a,o),r.width=a,r.height=o,r.gl._refresh()}),Object(V.a)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,o=t.width,l=t.height,c={x:i,y:a,width:o,height:l};return n&&(c.framebuffer=n.get()),r.gl.read(c)}),Object(V.a)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),Object(V.a)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),Object(V.a)(this,"getCanvas",function(){return r.canvas}),Object(V.a)(this,"getGLContext",function(){return r.gl._gl}),Object(V.a)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return Object(De.a)(e,[{key:"init",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a,o){var l=this;return be.a.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(this.canvas=i,!o){p.next=5;break}this.gl=o,p.next=8;break;case 5:return p.next=7,new Promise(function(_,x){L6()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(w,I){(w||!I)&&x(w),_(I)}})});case 7:this.gl=p.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return p.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||jC),tj=function(){function e(r,t){Object(et.a)(this,e);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,l=t.size,c=t.divisor,p=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:p,buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:c||0},l&&(this.attribute.size=l)}return Object(De.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),nd,ap,gm,Ng,jg,xh,M0,nv,Fu,P0=(nd={},Object(V.a)(nd,Y.FLOAT,Float32Array),Object(V.a)(nd,Y.UNSIGNED_BYTE,Uint8Array),Object(V.a)(nd,Y.SHORT,Int16Array),Object(V.a)(nd,Y.UNSIGNED_SHORT,Uint16Array),Object(V.a)(nd,Y.INT,Int32Array),Object(V.a)(nd,Y.UNSIGNED_INT,Uint32Array),nd),rj=(ap={},Object(V.a)(ap,Y.POINTS,ks.POINTS),Object(V.a)(ap,Y.LINES,ks.LINES),Object(V.a)(ap,Y.LINE_LOOP,ks.LINES),Object(V.a)(ap,Y.LINE_STRIP,ks.LINE_STRIP),Object(V.a)(ap,Y.TRIANGLES,ks.TRIANGLES),Object(V.a)(ap,Y.TRIANGLE_FAN,ks.TRIANGLES),Object(V.a)(ap,Y.TRIANGLE_STRIP,ks.TRIANGLE_STRIP),ap),nj=(gm={},Object(V.a)(gm,1,Vt.F32_R),Object(V.a)(gm,2,Vt.F32_RG),Object(V.a)(gm,3,Vt.F32_RGB),Object(V.a)(gm,4,Vt.F32_RGBA),gm),ij=(Ng={},Object(V.a)(Ng,Y.STATIC_DRAW,Df.STATIC),Object(V.a)(Ng,Y.DYNAMIC_DRAW,Df.DYNAMIC),Object(V.a)(Ng,Y.STREAM_DRAW,Df.DYNAMIC),Ng),zC=(jg={},Object(V.a)(jg,Y.REPEAT,wl.REPEAT),Object(V.a)(jg,Y.CLAMP_TO_EDGE,wl.CLAMP_TO_EDGE),Object(V.a)(jg,Y.MIRRORED_REPEAT,wl.MIRRORED_REPEAT),jg),aj=(xh={},Object(V.a)(xh,Y.NEVER,Ta.NEVER),Object(V.a)(xh,Y.ALWAYS,Ta.ALWAYS),Object(V.a)(xh,Y.LESS,Ta.LESS),Object(V.a)(xh,Y.LEQUAL,Ta.LEQUAL),Object(V.a)(xh,Y.GREATER,Ta.GREATER),Object(V.a)(xh,Y.GEQUAL,Ta.GEQUAL),Object(V.a)(xh,Y.EQUAL,Ta.EQUAL),Object(V.a)(xh,Y.NOTEQUAL,Ta.NOTEQUAL),xh),oj=(M0={},Object(V.a)(M0,Y.FRONT,Ql.FRONT),Object(V.a)(M0,Y.BACK,Ql.BACK),M0),UC=(nv={},Object(V.a)(nv,Y.FUNC_ADD,Du.ADD),Object(V.a)(nv,Y.MIN_EXT,Du.MIN),Object(V.a)(nv,Y.MAX_EXT,Du.MAX),Object(V.a)(nv,Y.FUNC_SUBTRACT,Du.SUBSTRACT),Object(V.a)(nv,Y.FUNC_REVERSE_SUBTRACT,Du.REVERSE_SUBSTRACT),nv),I0=(Fu={},Object(V.a)(Fu,Y.ZERO,ga.ZERO),Object(V.a)(Fu,Y.ONE,ga.ONE),Object(V.a)(Fu,Y.SRC_COLOR,ga.SRC),Object(V.a)(Fu,Y.ONE_MINUS_SRC_COLOR,ga.ONE_MINUS_SRC),Object(V.a)(Fu,Y.SRC_ALPHA,ga.SRC_ALPHA),Object(V.a)(Fu,Y.ONE_MINUS_SRC_ALPHA,ga.ONE_MINUS_SRC_ALPHA),Object(V.a)(Fu,Y.DST_COLOR,ga.DST),Object(V.a)(Fu,Y.ONE_MINUS_DST_COLOR,ga.ONE_MINUS_DST),Object(V.a)(Fu,Y.DST_ALPHA,ga.DST_ALPHA),Object(V.a)(Fu,Y.ONE_MINUS_DST_ALPHA,ga.ONE_MINUS_DST_ALPHA),Object(V.a)(Fu,Y.CONSTANT_COLOR,ga.CONST),Object(V.a)(Fu,Y.ONE_MINUS_CONSTANT_COLOR,ga.ONE_MINUS_CONSTANT),Object(V.a)(Fu,Y.CONSTANT_ALPHA,ga.CONST),Object(V.a)(Fu,Y.ONE_MINUS_CONSTANT_ALPHA,ga.ONE_MINUS_CONSTANT),Object(V.a)(Fu,Y.SRC_ALPHA_SATURATE,ga.SRC_ALPHA_SATURATE),Fu),sj={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function D0(e){return Object.prototype.toString.call(e)in sj}var uj=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,o=t.isUBO,l;D0(n)?l=n:l=new P0[this.type||Y.FLOAT](n),this.type=a,this.size=l.byteLength,this.buffer=r.createBuffer({viewOrSize:l,usage:o?mo.UNIFORM:mo.VERTEX,hint:ij[i||Y.STATIC_DRAW]})}return Object(De.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;D0(n)?a=n:a=new P0[this.type||Y.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),lj=function(){function e(r,t){Object(et.a)(this,e);var n=t.data,i=t.type,a=t.count,o=a===void 0?0:a,l;D0(n)?l=n:l=new P0[this.type||Y.UNSIGNED_INT](n),this.type=i,this.count=o,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:mo.INDEX})}return Object(De.a)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;D0(n)?i=n:i=new P0[this.type||Y.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function cj(e){return!1}var fj=function(){function e(r,t){Object(et.a)(this,e),Object(V.a)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Y.UNSIGNED_BYTE:i,o=t.width,l=t.height,c=t.flipY,p=c===void 0?!1:c,_=t.format,x=_===void 0?Y.RGBA:_,A=t.wrapS,w=A===void 0?Y.CLAMP_TO_EDGE:A,I=t.wrapT,P=I===void 0?Y.CLAMP_TO_EDGE:I,H=t.alignment,W=H===void 0?1:H;this.width=o,this.height=l;var oe=Vt.U8_RGBA_RT;if(a===Y.UNSIGNED_BYTE&&x===Y.RGBA)oe=Vt.U8_RGBA_RT;else if(x===Y.LUMINANCE&&a===Y.FLOAT)oe=Vt.F32_LUMINANCE;else if(x===Y.LUMINANCE&&a===Y.UNSIGNED_BYTE)oe=Vt.U8_LUMINANCE;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(x));this.texture=r.createTexture({format:oe,width:o,height:l,usage:Ec.SAMPLED,pixelStore:{unpackFlipY:p,packAlignment:W}}),n&&this.texture.setImageData([n]),this.sampler=r.createSampler({addressModeU:zC[w],addressModeV:zC[P],minFilter:Ds.POINT,magFilter:Ds.BILINEAR,mipmapFilter:Js.NO_MIP,lodMinClamp:0,lodMaxClamp:0})}return Object(De.a)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),hj=function(){function e(r,t){Object(et.a)(this,e),this.device=r;var n=t.width,i=t.height,a=t.color;cj(a)?(this.renderTarget=r.createRenderTargetFromTexture(a.get()),this.width=a.width,this.height=a.height):n&&i&&(this.renderTarget=r.createRenderTarget({format:Vt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}return Object(De.a)(e,[{key:"get",value:function(){return this.renderTarget}},{key:"destroy",value:function(){this.renderTarget.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.renderTarget&&this.renderTarget.destroy(),this.renderTarget=this.device.createRenderTarget({format:Vt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}}]),e}(),pj=fi.isPlainObject,dj=fi.isTypedArray,vj=function(){function e(r,t){var n=this;Object(et.a)(this,e),Object(V.a)(this,"destroyed",!1),Object(V.a)(this,"uniforms",{}),Object(V.a)(this,"vertexBuffers",[]),this.device=r,this.options=t;var i=t.vs,a=t.fs,o=t.attributes,l=t.uniforms,c=t.count,p=t.elements;this.options=t;var _=r.createProgram({vertex:{glsl:i},fragment:{glsl:a}});this.program=_,l&&(this.uniforms=this.extractUniforms(l));var x=[],A=0;Object.keys(o).forEach(function(I){var P=o[I],H=P.get();n.vertexBuffers.push(H.get());var W=P.attribute,oe=W.offset,ce=oe===void 0?0:oe,Oe=W.stride,Fe=Oe===void 0?0:Oe,je=W.size,tt=je===void 0?1:je,vt=W.divisor,kt=vt===void 0?0:vt,ir=W.shaderLocation,ur=ir===void 0?0:ir;x.push({arrayStride:Fe||tt*4,stepMode:ev.VERTEX,attributes:[{format:nj[tt],shaderLocation:ur,offset:ce,divisor:kt}]}),A=H.size/tt}),c||(this.options.count=A),p&&(this.indexBuffer=p.get());var w=r.createInputLayout({vertexBufferDescriptors:x,indexBufferFormat:p?Vt.U32_R:null,program:_});this.inputLayout=w,this.pipeline=this.createPipeline(t)}return Object(De.a)(e,[{key:"createPipeline",value:function(t){var n=t.primitive,i=n===void 0?Y.TRIANGLES:n,a=t.depth,o=t.cull,l=t.blend,c=this.initDepthDrawParams({depth:a}),p=!!(c&&c.enable),_=this.initCullDrawParams({cull:o}),x=!!(_&&_.enable),A=this.getBlendDrawParams({blend:l}),w=!!(A&&A.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:rj[i],colorAttachmentFormats:[Vt.U8_RGBA_RT],depthStencilAttachmentFormat:Vt.D24_S8,megaStateDescriptor:{attachmentsState:[{channelWriteMask:ku.ALL,rgbBlendState:{blendMode:w&&A.equation.rgb||Du.ADD,blendSrcFactor:w&&A.func.srcRGB||ga.SRC_ALPHA,blendDstFactor:w&&A.func.dstRGB||ga.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:w&&A.equation.alpha||Du.ADD,blendSrcFactor:w&&A.func.srcAlpha||ga.ONE,blendDstFactor:w&&A.func.dstAlpha||ga.ONE_MINUS_SRC_ALPHA}}],blendConstant:P1,depthWrite:p,depthCompare:p&&c.func||Ta.LESS,cullMode:x&&_.face||Ql.NONE,stencilWrite:!1}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=Object(ae.a)(Object(ae.a)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t){var n=Object(ae.a)(Object(ae.a)({},this.options),t),i=n.count,a=i===void 0?0:i,o=n.instances,l=n.elements,c=n.uniforms,p=c===void 0?{}:c,_=n.uniformBuffers,x=n.textures;this.uniforms=Object(ae.a)(Object(ae.a)({},this.uniforms),this.extractUniforms(p));var A=this.device,w=A.width,I=A.height,P=this.device.renderPass;if(this.pipeline=this.createPipeline(n),P.setPipeline(this.pipeline),P.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(W){return{buffer:W}}),l?{buffer:this.indexBuffer,offset:0}:null),P.setViewport(0,0,w,I),_&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:_.map(function(W,oe){var ce=W;return{binding:oe,buffer:ce.get(),size:ce.size}}),samplerBindings:x==null?void 0:x.map(function(W){return{texture:W.texture,sampler:W.sampler}})})),this.bindings&&(P.setBindings(this.bindings),this.program.setUniformsLegacy(this.uniforms)),l){var H=l.count;H===0?P.draw(a,o):P.drawIndexed(H,o)}else P.draw(a,o)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:aj[n.func||Y.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,o=i.func,l=i.equation,c=i.color,p=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:I0[o&&o.srcRGB||Y.SRC_ALPHA],srcAlpha:I0[o&&o.srcAlpha||Y.SRC_ALPHA],dstRGB:I0[o&&o.dstRGB||Y.ONE_MINUS_SRC_ALPHA],dstAlpha:I0[o&&o.dstAlpha||Y.ONE_MINUS_SRC_ALPHA]},equation:{rgb:UC[l&&l.rgb||Y.FUNC_ADD],alpha:UC[l&&l.alpha||Y.FUNC_ADD]},color:p}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,o=a===void 0?Y.BACK:a;return{enable:!!i,face:oj[o]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||dj(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}pj(n)&&Object.keys(n).forEach(function(l){o.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(p){o.extractUniformsRecursively(p,l[p],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}();function mj(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var VC,HC,gj=(VC=Object(Qr.injectable)(),VC(HC=function(){function e(){var r=this;Object(et.a)(this,e),Object(V.a)(this,"uniformBuffers",[]),Object(V.a)(this,"createModel",function(t){return new vj(r.device,t)}),Object(V.a)(this,"createAttribute",function(t){return new tj(r.device,t)}),Object(V.a)(this,"createBuffer",function(t){return new uj(r.device,t)}),Object(V.a)(this,"createElements",function(t){return new lj(r.device,t)}),Object(V.a)(this,"createTexture2D",function(t){return new fj(r.device,t)}),Object(V.a)(this,"createFramebuffer",function(t){return new hj(r.device,t)}),Object(V.a)(this,"useFramebuffer",function(){}),Object(V.a)(this,"clear",function(){}),Object(V.a)(this,"viewport",function(t){var n=t.width,i=t.height;r.width=n,r.height=i,r.device.width=n,r.device.height=i}),Object(V.a)(this,"readPixels",function(){return new Uint8Array}),Object(V.a)(this,"getViewportSize",function(){return{width:r.device.width,height:r.device.height}}),Object(V.a)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),Object(V.a)(this,"getCanvas",function(){return r.canvas}),Object(V.a)(this,"getGLContext",function(){return r.device.gl}),Object(V.a)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy()})}return Object(De.a)(e,[{key:"init",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a){var o,l,c,p,_,x;return be.a.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return o=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,c=o?new Y8({shaderCompilerPath:l}):new o8({targets:["webgl2","webgl1"],onContextLost:function(P){console.warn("context lost",P)},onContextCreationError:function(P){console.warn("context creation error",P)},onContextRestored:function(P){console.warn("context restored",P)}}),w.next=5,c.createSwapChain(i);case 5:p=w.sent,p.configureSwapChain(i.width,i.height),this.device=p.getDevice(),this.swapChain=p,_=this.device.gl,this.extensionObject={OES_texture_float:!mj(_)&&this.device.OES_texture_float},x=this.device.createTexture({format:Vt.U8_RGBA_RT,width:i.width,height:i.height,usage:Ec.RENDER_TARGET}),this.renderTarget=this.device.createRenderTargetFromTexture(x),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Vt.D24_S8,width:i.width,height:i.height,usage:Ec.RENDER_TARGET}));case 14:case"end":return w.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"beginFrame",value:function(){var t=this.swapChain.getOnscreenTexture();this.renderPass=this.device.createRenderPass({colorAttachment:[this.renderTarget],colorResolveTo:[t],colorClearColor:[P1],depthStencilAttachment:this.mainDepthRT,depthClearValue:1}),this.device.renderPass=this.renderPass}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||HC);function yj(e){var r=_j();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function _j(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H1=["selectstart","selecting","selectend"],bj=function(e){Object(Lt.a)(t,e);var r=yj(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"isEnable",!1),Object(V.a)(Object(Be.a)(i),"onDragStart",function(o){i.box.style.display="block",i.startEvent=i.endEvent=o,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),Object(V.a)(Object(Be.a)(i),"onDragging",function(o){i.endEvent=o,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),Object(V.a)(Object(Be.a)(i),"onDragEnd",function(o){i.endEvent=o,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return Object(De.a)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=D.create("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,o=i.y,l=this.endEvent,c=l.x,p=l.y,_=Math.min(a,c),x=Math.min(o,p),A=Math.abs(a-c),w=Math.abs(o-p);this.box.style.top="".concat(x,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(A,"px"),this.box.style.height="".concat(w,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,o=i.lat,l=this.endEvent.lngLat,c=l.lng,p=l.lat;return ys([[a,o],[c,p]])}}]),t}(Po.EventEmitter),zg=function(){function e(r){Object(et.a)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.hasBaseMap,o=r.renderer,l=o===void 0?"regl":o,c=VM();this.container=c,n.setContainer(c,t,i,a),c.bind(Yt.IRendererService).to(l==="regl"?ej:gj).inSingletonScope(),this.sceneService=c.get(Yt.ISceneService),this.mapService=c.get(Yt.IMapService),this.iconService=c.get(Yt.IIconService),this.fontService=c.get(Yt.IFontService),this.controlService=c.get(Yt.IControlService),this.layerService=c.get(Yt.ILayerService),this.debugService=c.get(Yt.IDebugService),this.debugService.setEnable(r.debug),this.markerService=c.get(Yt.IMarkerService),this.interactionService=c.get(Yt.IInteractionService),this.popupService=c.get(Yt.IPopupService),this.boxSelect=new bj(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return Object(De.a)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i){return be.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=sg(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var o=n.initMask(t);n.addMask(o,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,o=n.maskColor,l=o===void 0?"#000":o,c=n.maskOpacity,p=c===void 0?0:c;if(!(!i||!a)){var _=new FS().source(a).shape("fill").style({color:l,opacity:p});return _}}},{key:"addMask",value:function(t,n){if(!!t){var i=this.getLayer(n);if(i){var a=sg(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=Object(Zt.a)(be.a.mark(function n(){return be.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=Object(hn.a)(i,2),o=a[0],l=a[1];n.fontService.addIconFont(o,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=Object(Zt.a)(be.a.mark(function n(i,a){return be.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(H1.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else Oy.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(H1.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else Oy.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){Oy.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(H1.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else Oy.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,o=i.animate;this.mapService.fitBounds(t,n||Object(ae.a)(Object(ae.a)({},a),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Yt.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Zi.REGISTERED_PROTOCOLS[t]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:D.getContainer(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new P2({position:i}))}}],[{key:"addProtocol",value:function(t,n){Zi.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Zi.REGISTERED_PROTOCOLS[t]}}]),e}(),DG="2.7.18",xj=C("lwsE"),Ac=C.n(xj),Ej=C("W8MJ"),Tc=C.n(Ej),Sj=C("7W2i"),k0=C.n(Sj),Aj=C("a1gu"),F0=C.n(Aj),Tj=C("Nsbk"),id=C.n(Tj),Cj=C("yG8O"),Bu=C.n(Cj),wj=C("lSNA"),mi=C.n(wj),Oj=C("U+yc"),Lu=C.n(Oj),kG=C("1ABj"),WC,W1,GC;function XC(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ZC(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?XC(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):XC(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var B0=(WC=k_(Yt.IGlobalConfigService),W1=function(){function e(r){Ac()(this,e),Bu()(this,"configService",GC,this),mi()(this,"config",void 0),this.config=r}return Tc()(e,[{key:"setContainer",value:function(t,n,i,a){t.bind(Yt.MapConfig).toConstantValue(ZC(ZC({},this.config),{},{id:n,canvas:i,hasBaseMap:a})),t.bind(Yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),GC=Lu()(W1.prototype,"configService",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1),Rj=C("sXyB"),L0=C.n(Rj),Mj=C("RIqP"),ad=C.n(Mj),Pj=C("QILm"),Ug=C.n(Pj),Ij=C("yXPU"),Vg=C.n(Ij),Dj=C("J4zp"),od=C.n(Dj),kj=C("623A"),$C=C.n(kj);function YC(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function KC(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?YC(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):YC(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function N0(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return KC(KC({},r),e)}var ym;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(ym||(ym={}));var qC={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},QC=Math.PI/180,Fj=function(){function e(){Ac()(this,e),mi()(this,"projectionMatrix",k.create()),mi()(this,"viewMatrix",k.create()),mi()(this,"viewProjectionMatrix",k.create()),mi()(this,"ViewProjectionMatrixUncentered",k.create()),mi()(this,"viewUncenteredMatrix",k.create()),mi()(this,"zoom",void 0),mi()(this,"center",void 0)}return Tc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.pitch,o=a===void 0?0:a,l=t.bearing,c=l===void 0?0:l,p=t.center,_=p===void 0?[0,0]:p,x=t.offsetOrigin,A=x===void 0?[0,0]:x,w=t.cameraHeight,I=w===void 0?1:w,P=t.aspect,H=P===void 0?1:P,W=t.near,oe=W===void 0?.1:W,ce=t.far,Oe=ce===void 0?1e3:ce,Fe=t.fov,je=Fe===void 0?0:Fe;this.zoom=i,this.center=_;var tt=o*QC,vt=(360-c)*QC;k.perspective(this.projectionMatrix,je,H,oe,Oe);var kt=L.fromValues(I*Math.sin(tt)*Math.sin(vt),-I*Math.sin(tt)*Math.cos(vt),I*Math.cos(tt)),ir=L.fromValues(-Math.cos(tt)*Math.sin(vt),Math.cos(tt)*Math.cos(vt),Math.sin(tt));k.lookAt(this.viewMatrix,kt,L.fromValues(0,0,0),ir),this.viewUncenteredMatrix=k.clone(this.viewMatrix),k.translate(this.viewMatrix,this.viewMatrix,L.fromValues(-A[0],A[1],0)),k.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),k.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=od()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,l=Math.PI/180,c=t[0]*l,p=a*l;p=Math.log(Math.tan(Math.PI/4+p/2));var _=.5/Math.PI,x=.5,A=-.5/Math.PI;return l=.5,c=o*(_*c+x)-215440491,p=-(o*(A*p+l)-106744817),[c,p]}}]),e}(),Bj=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],JC,ew,tw,rw,nw,iw,_m,aw,ow,sw,uw;function lw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Lj(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?lw(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Nj(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}Nj(`.amap-logo{
 display: none !important;
}
`);var jj=0;window.forceWebGL=!0;var cw="15cd8a57710d40c9b7c0e3cc120f1200",zj="1.4.15",Uj="amap-script",G1=!1,j0=[],Vj=12,Hj=(JC=Object(Qr.injectable)(),ew=Object(Qr.inject)(Yt.IGlobalConfigService),tw=Object(Qr.inject)(Yt.MapConfig),rw=Object(Qr.inject)(Yt.ICoordinateSystemService),nw=Object(Qr.inject)(Yt.IEventEmitter),JC(iw=(_m=function(){function e(){var r=this;Ac()(this,e),mi()(this,"version",ym["GAODE1.x"]),mi()(this,"map",void 0),mi()(this,"dragging",!1),mi()(this,"bgColor","rgba(0, 0, 0, 0)"),Bu()(this,"configService",aw,this),Bu()(this,"config",ow,this),Bu()(this,"coordinateSystemService",sw,this),Bu()(this,"eventEmitter",uw,this),mi()(this,"markerContainer",void 0),mi()(this,"$mapContainer",void 0),mi()(this,"viewport",void 0),mi()(this,"cameraChangedCallback",void 0),mi()(this,"handleCameraChanged",function(t){var n=t.camera,i=n.fov,a=n.near,o=n.far,l=n.height,c=n.pitch,p=n.rotation,_=n.aspect,x=n.position,A=r.getCenter(),w=A.lng,I=A.lat;if(r.emit("mapchange"),r.cameraChangedCallback){r.viewport.syncWithMapCamera({aspect:_,bearing:360-p,far:o,fov:i,cameraHeight:l,near:a,pitch:c,zoom:r.map.getZoom()-1,center:[w,I],offsetOrigin:[x.x,x.y]});var P=r.config.offsetZoom,H=P===void 0?Vj:P;r.viewport.getZoom()>H?r.coordinateSystemService.setCoordinateSystem(Yl.P20_OFFSET):r.coordinateSystemService.setCoordinateSystem(Yl.P20),r.cameraChangedCallback(r.viewport)}})}return Tc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=D.create("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=od()(i,2),o=a[0],l=a[1],c=N0(t.padding),p=this.lngLatToPixel([n.lng,n.lat]),_=[(c.right-c.left)/2,(c.bottom-c.top)/2],x=this.pixelToLngLat([p.x-_[0],p.y-_[1]]);return x}var A=this.map.getCenter();return{lng:A.getLng(),lat:A.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=N0(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],l=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([l.lng,l.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),l=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[l,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),i=n.x,a=n.y;return[i,-a]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=this.viewport.projectFlat(t),c=k.create();return k.translate(c,c,L.fromValues(l[0],l[1],n)),k.scale(c,c,L.fromValues(a[0],a[1],a[2])),k.rotateX(c,c,i[0]),k.rotateY(c,c,i[1]),k.rotateZ(c,c,i[2]),c}},{key:"init",value:function(){var r=Vg()(be.a.mark(function n(){var i=this,a,o,l,c,p,_,x,A,w,I,P,H,W,oe;return be.a.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return a=this.config,o=a.id,l=a.style,c=l===void 0?"light":l,p=a.minZoom,_=p===void 0?0:p,x=a.maxZoom,A=x===void 0?18:x,w=a.token,I=w===void 0?cw:w,P=a.mapInstance,H=a.plugin,W=H===void 0?[]:H,oe=Ug()(a,Bj),Oe.next=3,new Promise(function(Fe){var je=function(){if(P)i.map=P,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),Fe()},30);else{i.$mapContainer=i.creatAmapContainer(o);var vt=Lj({mapStyle:i.getMapStyle(c),zooms:[_,A],viewMode:"3D"},oe);vt.zoom&&(vt.zoom+=1);var kt=new AMap.Map(i.$mapContainer,vt);kt.on("camerachange",i.handleCameraChanged),i.map=kt,setTimeout(function(){Fe()},10)}};!G1&&!P?(I===cw&&console.warn(i.configService.getSceneWarninfo("MapToken")),G1=!0,W.push("Map3D"),$C.a.load({key:I,version:zj,plugins:W}).then(function(tt){je(),j0.length&&(j0.forEach(function(vt){return vt()}),j0=[])}).catch(function(tt){throw new Error(tt)})):G1&&window.AMap||P?je():j0.push(je)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.viewport=new Fj;case 6:case"end":return Oe.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(L0()(AMap.LngLat,ad()(t)),L0()(AMap.LngLat,ad()(n))),a=this.lngLatToCoord(t),o=od()(a,2),l=o[0],c=o[1],p=this.lngLatToCoord(n),_=od()(p,2),x=_[0],A=_[1],w=Math.sqrt(Math.pow(l-x,2)+Math.pow(c-A,2));return w/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(Uj);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"getMapStyle",value:function(t){return qC[t]?qC[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+jj++,n.appendChild(i),i}}]),e}(),aw=Lu()(_m.prototype,"configService",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ow=Lu()(_m.prototype,"config",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sw=Lu()(_m.prototype,"coordinateSystemService",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uw=Lu()(_m.prototype,"eventEmitter",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_m))||iw);function Wj(e){var r=Gj();return function(){var n=id()(e),i;if(r){var a=id()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return F0()(this,i)}}function Gj(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xj=function(e){k0()(t,e);var r=Wj(t);function t(){return Ac()(this,t),r.apply(this,arguments)}return Tc()(t,[{key:"getServiceConstructor",value:function(){return Hj}}]),t}(B0);function fw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function hw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?fw(Object(t),!0).forEach(function(n){Zj(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Zj(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function $j(e,r){return Qj(e)||qj(e,r)||Kj(e,r)||Yj()}function Yj(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kj(e,r){if(!!e){if(typeof e=="string")return pw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pw(e,r)}}function pw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function qj(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function Qj(e){if(Array.isArray(e))return e}var Jj=q.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(K.useRef)(null),c=Object(K.useState)(),p=$j(c,2),_=p[0],x=p[1];return Object(K.useEffect)(function(){var A=new zg(hw(hw({id:l.current},i),{},{map:new Xj(n)}));return A.on("loaded",function(){x(A),a&&a(A)}),function(){A.destroy()}},[]),Object(K.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(K.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(K.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(K.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(K.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),q.a.createElement(fe.Provider,{value:_},q.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),FG=Jj,ez=C("4ZJM"),Hg=C.n(ez);function Wg(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function z0(e,r){var t=Xn([],r,e);return Rt(t,t,1/t[3]),t}function BG(e,r){var t=e%r;return t<0?r+t:t}function LG(e,r,t){return t*r+(1-t)*e}function sd(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var Ff=Math.PI,dw=Ff/4,op=Ff/180,vw=180/Ff,X1=512,Z1=4003e4,tz=1.5;function mw(e){return Math.pow(2,e)}function rz(e){return Math.log2(e)}function U0(e,r){var t=Object(hn.a)(e,2),n=t[0],i=t[1];sd(Number.isFinite(n)&&Number.isFinite(r)),sd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=X1;var a=n*op,o=i*op,l=r*(a+Ff)/(2*Ff),c=r*(Ff-Math.log(Math.tan(dw+o*.5)))/(2*Ff);return[l,c]}function $1(e,r){var t=Object(hn.a)(e,2),n=t[0],i=t[1];r*=X1;var a=n/r*(2*Ff)-Ff,o=2*(Math.atan(Math.exp(Ff-i/r*(2*Ff)))-dw);return[a*vw,o*vw]}function NG(e){var r=e.latitude;sd(Number.isFinite(r));var t=Math.cos(r*op);return rz(Z1*t)-9}function gw(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,o=a===void 0?!1:a;i=i!==void 0?i:mw(n),sd(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},c=X1*i,p=Math.cos(r*op),_=c/360,x=_/p,A=c/Z1/p;if(l.pixelsPerMeter=[A,-A,A],l.metersPerPixel=[1/A,-1/A,1/A],l.pixelsPerDegree=[_,-x,A],l.degreesPerPixel=[1/_,-1/x,1/A],o){var w=op*Math.tan(r*op)/p,I=_*w/2,P=c/Z1*w,H=P/x*A;l.pixelsPerDegree2=[0,-I,P],l.pixelsPerMeter2=[H,0,H]}return l}function jG(e,r){var t=Object(hn.a)(e,3),n=t[0],i=t[1],a=t[2],o=Object(hn.a)(r,3),l=o[0],c=o[1],p=o[2],_=1,x=gw({longitude:n,latitude:i,scale:_,highPrecision:!0}),A=x.pixelsPerMeter,w=x.pixelsPerMeter2,I=U0(e,_);I[0]+=l*(A[0]+w[0]*c),I[1]+=c*(A[1]+w[1]*c);var P=$1(I,_),H=(a||0)+(p||0);return Number.isFinite(a)||Number.isFinite(p)?[P[0],P[1],H]:P}function nz(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,o=a===void 0?null:a,l=e.flipY,c=l===void 0?!1:l,p=Wg();return Sp(p,p,[0,0,-i]),Ap(p,p,[1,1,1/r]),bd(p,p,-t*op),de(p,p,n*op),c&&Ap(p,p,[1,-1,1]),o&&Sp(p,p,qa([],o)),p}function iz(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?tz:n,a=e.pitch,o=a===void 0?0:a,l=e.nearZMultiplier,c=l===void 0?1:l,p=e.farZMultiplier,_=p===void 0?1:p,x=o*op,A=Math.atan(.5/i),w=Math.sin(A)*i/Math.sin(Math.PI/2-x-A),I=Math.cos(Math.PI/2-x)*w+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:c,far:I*_}}function az(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,o=e.farZMultiplier,l=iz({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:o}),c=l.fov,p=l.aspect,_=l.near,x=l.far,A=bn([],c,p,_,x);return A}function oz(e,r){var t=Object(hn.a)(e,3),n=t[0],i=t[1],a=t[2],o=a===void 0?0:a;return sd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),z0(r,[n,i,o,1])}function yw(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Object(hn.a)(e,3),i=n[0],a=n[1],o=n[2];if(sd(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var l=z0(r,[i,a,o,1]);return l}var c=z0(r,[i,a,0,1]),p=z0(r,[i,a,1,1]),_=c[2],x=p[2],A=_===x?0:((t||0)-_)/(x-_);return xa([],c,p,A)}var _w=Wg(),sz=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?_w:i,o=r.projectionMatrix,l=o===void 0?_w:o;Object(et.a)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var c=Wg();Cf(c,c,this.projectionMatrix),Cf(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var p=Wg();Ap(p,p,[this.width/2,-this.height/2,1]),Sp(p,p,[1,-1,0]),Cf(p,p,this.viewProjectionMatrix);var _=yd(Wg(),p);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=p,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(De.a)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&wi(t.projectionMatrix,this.projectionMatrix)&&wi(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(t),l=oz(o,this.pixelProjectionMatrix),c=Object(hn.a)(l,2),p=c[0],_=c[1],x=a?_:this.height-_;return t.length===2?[p,x]:[p,x,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,l=Object(hn.a)(t,3),c=l[0],p=l[1],_=l[2],x=a?p:this.height-p,A=o&&o*this.pixelsPerMeter,w=yw([c,x,_],this.pixelUnprojectionMatrix,A),I=this.unprojectPosition(w),P=Object(hn.a)(I,3),H=P[0],W=P[1],oe=P[2];return Number.isFinite(_)?[H,W,oe]:Number.isFinite(o)?[H,W,o]:[H,W]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=Object(hn.a)(n,2),a=i[0],o=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,o,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=Object(hn.a)(n,2),a=i[0],o=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,o,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function uz(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,o=e.maxZoom,l=o===void 0?24:o,c=e.padding,p=c===void 0?0:c,_=e.offset,x=_===void 0?[0,0]:_,A=Object(hn.a)(n,2),w=Object(hn.a)(A[0],2),I=w[0],P=w[1],H=Object(hn.a)(A[1],2),W=H[0],oe=H[1];if(Number.isFinite(p)){var ce=p;p={top:ce,bottom:ce,left:ce,right:ce}}else sd(Number.isFinite(p.top)&&Number.isFinite(p.bottom)&&Number.isFinite(p.left)&&Number.isFinite(p.right));var Oe=new Y1({width:r,height:t,longitude:0,latitude:0,zoom:0}),Fe=Oe.project([I,oe]),je=Oe.project([W,P]),tt=[Math.max(Math.abs(je[0]-Fe[0]),a),Math.max(Math.abs(je[1]-Fe[1]),a)],vt=[r-p.left-p.right-Math.abs(x[0])*2,t-p.top-p.bottom-Math.abs(x[1])*2];sd(vt[0]>0&&vt[1]>0);var kt=vt[0]/tt[0],ir=vt[1]/tt[1],ur=(p.right-p.left)/2/kt,Zr=(p.bottom-p.top)/2/ir,ln=[(je[0]+Fe[0])/2+ur,(je[1]+Fe[1])/2+Zr],_n=Oe.unproject(ln),Hi=Oe.zoom+Math.log2(Math.abs(Math.min(kt,ir)));return{longitude:_n[0],latitude:_n[1],zoom:Math.min(Hi,l)}}var Y1=function(e){Object(Lt.a)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,o=n.latitude,l=o===void 0?0:o,c=n.longitude,p=c===void 0?0:c,_=n.zoom,x=_===void 0?0:_,A=n.pitch,w=A===void 0?0:A,I=n.bearing,P=I===void 0?0:I,H=n.altitude,W=H===void 0?1.5:H,oe=n.nearZMultiplier,ce=n.farZMultiplier;Object(et.a)(this,r),i=i||1,a=a||1;var Oe=mw(x);W=Math.max(.75,W);var Fe=U0([p,l],Oe);Fe[2]=0;var je=az({width:i,height:a,pitch:w,bearing:P,altitude:W,nearZMultiplier:oe||1/a,farZMultiplier:ce||1.01}),tt=nz({height:a,center:Fe,pitch:w,bearing:P,altitude:W,flipY:!0});return t=Object(ut.a)(this,Object(Te.a)(r).call(this,{width:i,height:a,viewMatrix:tt,projectionMatrix:je})),t.latitude=l,t.longitude=p,t.zoom=x,t.pitch=w,t.bearing=P,t.altitude=W,t.scale=Oe,t.center=Fe,t.pixelsPerMeter=gw(Object(Be.a)(Object(Be.a)(t))).pixelsPerMeter[2],Object.freeze(Object(Be.a)(Object(Be.a)(t))),t}return Object(De.a)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return U0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return $1(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,o=yw(a,this.pixelUnprojectionMatrix),l=U0(i,this.scale),c=Pa([],l,Ze([],o)),p=Pa([],this.center,c);return $1(p,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,o=this.height,l=uz(Object.assign({width:a,height:o,bounds:n},i)),c=l.longitude,p=l.latitude,_=l.zoom;return new r({width:a,height:o,longitude:c,latitude:p,zoom:_})}}]),r}(sz),lz=function(){function e(){Ac()(this,e),mi()(this,"viewport",void 0)}return Tc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,o=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new Y1({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),bw={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},cz=["id","attributionControl","style","token","rotation","mapInstance"],xw,Ew,Sw,Aw,Tw,Cw,bm,ww,Ow,Rw,Mw;function Pw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function fz(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Pw(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hz(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}hz(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Hg.a;var Iw={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},pz=0,dz=12,Dw="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",vz=(xw=Object(Qr.injectable)(),Ew=Object(Qr.inject)(Yt.MapConfig),Sw=Object(Qr.inject)(Yt.IGlobalConfigService),Aw=Object(Qr.inject)(Yt.ICoordinateSystemService),Tw=Object(Qr.inject)(Yt.IEventEmitter),xw(Cw=(bm=function(){function e(){var r=this;Ac()(this,e),mi()(this,"version",ym.MAPBOX),mi()(this,"map",void 0),mi()(this,"dragging",!1),mi()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Bu()(this,"config",ww,this),Bu()(this,"configService",Ow,this),Bu()(this,"coordinateSystemService",Rw,this),Bu()(this,"eventEmitter",Mw,this),mi()(this,"viewport",void 0),mi()(this,"markerContainer",void 0),mi()(this,"cameraChangedCallback",void 0),mi()(this,"$mapContainer",void 0),mi()(this,"handleCameraChanged",function(){var t=r.map.getCenter().wrap(),n=t.lat,i=t.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0});var a=r.config.offsetZoom,o=a===void 0?dz:a;r.viewport.getZoom()>o?r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT),r.cameraChangedCallback(r.viewport)})}return Tc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=D.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(Iw[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(Iw[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},i=this.lngLatToMercator(t,0),a=i.x,o=i.y;return[a-n.x,o-n.y]}},{key:"lngLatToMercator",value:function(t,n){var i=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),a=i.x,o=a===void 0?0:a,l=i.y,c=l===void 0?0:l,p=i.z,_=p===void 0?0:p;return{x:o,y:c,z:_}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),c=l.meterInMercatorCoordinateUnits(),p=k.create();return k.translate(p,p,L.fromValues(l.x-o.x,l.y-o.y,l.z||0-o.z)),k.scale(p,p,L.fromValues(c*a[0],-c*a[1],c*a[2])),k.rotateX(p,p,i[0]),k.rotateY(p,p,i[1]),k.rotateZ(p,p,i[2]),p}},{key:"init",value:function(){var r=Vg()(be.a.mark(function n(){var i=this,a,o,l,c,p,_,x,A,w,I,P,H,W;return be.a.wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,p=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,A=a.token,w=A===void 0?Dw:A,I=a.rotation,P=I===void 0?0:I,H=a.mapInstance,W=Ug()(a,cz),this.viewport=new lz,!H&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),w===Dw&&x!=="blank"&&!window.mapboxgl.accessToken&&!H&&console.warn(this.configService.getSceneWarninfo("MapToken")),!H&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=w),H?(this.map=H,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(l),this.map=new window.mapboxgl.Map(fz({container:this.$mapContainer,style:this.getMapStyle(x),attributionControl:p,bearing:P},W))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return ce.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var i=new Hg.a.LngLat(t[0],t[1]),a=new Hg.a.LngLat(n[0],n[1]),o=i.distanceTo(a),l=Hg.a.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),c=Hg.a.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),p=l.x,_=l.y,x=c.x,A=c.y,w=Math.sqrt(Math.pow(p-x,2)+Math.pow(_-A,2))*4194304*2;return w/o}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+pz++,n.appendChild(i),i}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:bw[t]?bw[t]:t}}]),e}(),ww=Lu()(bm.prototype,"config",[Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ow=Lu()(bm.prototype,"configService",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rw=Lu()(bm.prototype,"coordinateSystemService",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=Lu()(bm.prototype,"eventEmitter",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bm))||Cw);function mz(e){var r=gz();return function(){var n=id()(e),i;if(r){var a=id()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return F0()(this,i)}}function gz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function yz(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}yz(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var _z=function(e){k0()(t,e);var r=mz(t);function t(){return Ac()(this,t),r.apply(this,arguments)}return Tc()(t,[{key:"getServiceConstructor",value:function(){return vz}}]),t}(B0);function kw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Fw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?kw(Object(t),!0).forEach(function(n){bz(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function bz(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function xz(e,r){return Tz(e)||Az(e,r)||Sz(e,r)||Ez()}function Ez(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Sz(e,r){if(!!e){if(typeof e=="string")return Bw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Bw(e,r)}}function Bw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Az(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function Tz(e){if(Array.isArray(e))return e}var Cz=q.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=Object(K.createRef)(),l=Object(K.useState)(),c=xz(l,2),p=c[0],_=c[1];return Object(K.useEffect)(function(){var x=new zg(Fw(Fw({id:o.current},i),{},{map:new _z(n)}));return x.on("loaded",function(){_(x),a&&a(x)}),function(){x.destroy()}},[]),Object(K.useEffect)(function(){p&&n.style&&p.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(K.useEffect)(function(){p&&n.zoom&&p.setZoom(n.zoom)},[n.zoom]),Object(K.useEffect)(function(){p&&n.center&&p.setCenter(n.center)},[JSON.stringify(n.center)]),Object(K.useEffect)(function(){p&&n.pitch!==void 0&&p.setPitch(n.pitch||0)},[n.pitch]),Object(K.useEffect)(function(){p&&n.rotation&&p.setRotation(n.rotation)},[n.rotation]),q.a.createElement(fe.Provider,{value:p},Object(K.createElement)("div",{ref:o,style:r,className:t},p&&e.children))}),wz=Cz,Lw={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},Oz=function(){function e(){Ac()(this,e),mi()(this,"projectionMatrix",k.create()),mi()(this,"viewMatrix",k.create()),mi()(this,"viewProjectionMatrix",k.create()),mi()(this,"ViewProjectionMatrixUncentered",k.create()),mi()(this,"viewUncenteredMatrix",k.create()),mi()(this,"zoom",void 0),mi()(this,"center",void 0)}return Tc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.center,o=a===void 0?[0,0]:a,l=t.offsetOrigin,c=l===void 0?[0,0]:l,p=t.cameraPosition,_=p===void 0?[0,0,0]:p,x=t.up,A=x===void 0?[0,1,0]:x,w=t.lookAt,I=w===void 0?[0,0,0]:w,P=t.aspect,H=P===void 0?1:P,W=t.near,oe=W===void 0?.1:W,ce=t.far,Oe=ce===void 0?1e3:ce,Fe=t.fov,je=Fe===void 0?45:Fe;this.zoom=i,this.center=o,k.perspective(this.projectionMatrix,je/180*Math.PI,H,oe,Oe);var tt=L.fromValues.apply(L,ad()(_)),vt=L.fromValues.apply(L,ad()(I)),kt=L.fromValues.apply(L,ad()(A));k.lookAt(this.viewMatrix,tt,vt,kt),this.viewUncenteredMatrix=k.clone(this.viewMatrix),k.translate(this.viewMatrix,this.viewMatrix,L.fromValues(-c[0],c[1],0)),k.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),k.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=od()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,l=Math.PI/180,c=t[0]*l,p=a*l;p=Math.log(Math.tan(Math.PI/4+p/2));var _=.5/Math.PI,x=.5,A=-.5/Math.PI;return l=.5,c=o*(_*c+x)-215440491,p=-(o*(A*p+l)-106744817),[c,p]}}]),e}(),Rz=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],Nw,jw,zw,Uw,Vw,Hw,xm,Ww,Gw,Xw,Zw;function $w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Mz(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$w(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$w(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Pz(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}Pz(`.amap-logo{
 display: none !important;
}
`);var Iz=0;window.forceWebGL=!0;var Yw="ff533602d57df6f8ab3b0fea226ae52f",Dz="2.0",kz="amap-script",K1=!1,V0=[],Fz=(Nw=Object(Qr.injectable)(),jw=Object(Qr.inject)(Yt.IGlobalConfigService),zw=Object(Qr.inject)(Yt.MapConfig),Uw=Object(Qr.inject)(Yt.ICoordinateSystemService),Vw=Object(Qr.inject)(Yt.IEventEmitter),Nw(Hw=(xm=function(){function e(){var r=this;Ac()(this,e),mi()(this,"version",ym["GAODE2.x"]),mi()(this,"map",void 0),mi()(this,"dragging",!1),mi()(this,"sceneCenter",void 0),mi()(this,"sceneCenterMKT",void 0),mi()(this,"bgColor","rgba(0, 0, 0, 0)"),Bu()(this,"configService",Ww,this),Bu()(this,"config",Gw,this),Bu()(this,"coordinateSystemService",Xw,this),Bu()(this,"eventEmitter",Zw,this),mi()(this,"markerContainer",void 0),mi()(this,"$mapContainer",void 0),mi()(this,"viewport",void 0),mi()(this,"cameraChangedCallback",void 0),mi()(this,"handleViewChanged",function(t){var n=r.map.customCoords.getCameraParams(),i=n.fov,a=n.near,o=n.far,l=n.aspect,c=n.position,p=n.lookAt,_=n.up;r.emit("mapchange");var x=t.zoom,A=r.map.customCoords.getCenter();r.cameraChangedCallback&&(r.viewport.syncWithMapCamera({aspect:l,far:o,fov:i,cameraPosition:c,lookAt:p,up:_,near:a,zoom:x-1,center:A,offsetOrigin:[c[0],c[1]]}),r.coordinateSystemService.setCoordinateSystem(Yl.P20_2),r.cameraChangedCallback(r.viewport))})}return Tc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setCustomCoordCenter",value:function(t){var n;this.sceneCenter=t,this.sceneCenterMKT=(n=this.map.getProjection()).project.apply(n,ad()(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(t){var n=this.map.getProjection(),i=n.project;return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(i(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var n=this;return t.map(function(i){return typeof i[0]=="number"?n.lngLatToCoord(i):i.map(function(a){return n.lngLatToCoord(a)})})}},{key:"addMarkerContainer",value:function(){if(!!this.map){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];n.style.zIndex="auto",this.markerContainer=D.create("div","l7-marker-container2",n)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=od()(i,2),o=a[0],l=a[1],c=N0(t.padding),p=this.lngLatToPixel([n.lng,n.lat]),_=[(c.right-c.left)/2,(c.bottom-c.top)/2],x=this.pixelToLngLat([p.x-_[0],p.y-_[1]]);return x}var A=this.map.getCenter();return{lng:A.getLng(),lat:A.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=N0(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],l=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([l.lng,l.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),l=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[l,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.getZooms();return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.getZooms();return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=this.map.customCoords.lngLatToCoord(t),c=k.create();return k.translate(c,c,L.fromValues(l[0],l[1],n)),k.scale(c,c,L.fromValues(a[0],a[1],a[2])),k.rotateX(c,c,i[0]),k.rotateY(c,c,i[1]),k.rotateZ(c,c,i[2]),c}},{key:"init",value:function(){var r=Vg()(be.a.mark(function n(){var i=this,a,o,l,c,p,_,x,A,w,I,P,H,W,oe,ce,Oe;return be.a.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:return a=this.config,o=a.id,l=a.style,c=l===void 0?"light":l,p=a.minZoom,_=p===void 0?0:p,x=a.maxZoom,A=x===void 0?18:x,w=a.token,I=w===void 0?Yw:w,P=a.mapInstance,H=a.plugin,W=H===void 0?[]:H,oe=a.version,ce=oe===void 0?Dz:oe,Oe=Ug()(a,Rz),je.next=3,new Promise(function(tt){var vt=function(){if(P){var ir;i.map=P,i.$mapContainer=i.map.getContainer();var ur=i.map.getCenter();(ir=i.map.customCoords)===null||ir===void 0||ir.setCenter([ur.lng,ur.lat]),i.setCustomCoordCenter([ur.lng,ur.lat]),setTimeout(function(){i.map.on("viewchange",i.handleViewChanged),tt()},30)}else{i.$mapContainer=i.creatAmapContainer(o);var Zr=Mz({mapStyle:i.getMapStyle(c),zooms:[_,A],viewMode:"3D"},Oe);Zr.zoom&&(Zr.zoom+=1);var ln=new AMap.Map(i.$mapContainer,Zr);i.map=ln;var _n=ln.getCenter();ln.customCoords.setCenter([_n.lng,_n.lat]),i.setCustomCoordCenter([_n.lng,_n.lat]),ln.on("viewchange",i.handleViewChanged),setTimeout(function(){tt()},10)}};i.viewport=new Oz,!K1&&!P?(I===Yw&&console.warn(i.configService.getSceneWarninfo("MapToken")),K1=!0,W.push("Map3D"),$C.a.load({key:I,version:ce,plugins:W}).then(function(kt){vt(),V0.length&&(V0.forEach(function(ir){return ir()}),V0=[])}).catch(function(kt){throw new Error(kt)})):K1&&window.AMap||P?vt():V0.push(vt)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""});case 5:case"end":return je.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(L0()(AMap.LngLat,ad()(t)),L0()(AMap.LngLat,ad()(n))),a=this.lngLatToCoord(t),o=od()(a,2),l=o[0],c=o[1],p=this.lngLatToCoord(n),_=od()(p,2),x=_[0],A=_[1],w=Math.sqrt(Math.pow(l-x,2)+Math.pow(c-A,2));return w/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(kz);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,n=(t=this.map.customCoords)===null||t===void 0?void 0:t.getCameraParams(),i=n.fov,a=n.near,o=n.far,l=n.aspect,c=n.position,p=n.lookAt,_=n.up;this.emit("mapchange");var x=this.map.customCoords.getCenter(),A=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:l,far:o,fov:i,cameraPosition:c,lookAt:p,near:a,up:_,zoom:A-1,center:x,offsetOrigin:[c[0],c[1]]}),this.coordinateSystemService.setCoordinateSystem(Yl.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,n){var i=[0,0];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i}},{key:"getMapStyle",value:function(t){return Lw[t]?Lw[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+Iz++,n.appendChild(i),i}}]),e}(),Ww=Lu()(xm.prototype,"configService",[jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=Lu()(xm.prototype,"config",[zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=Lu()(xm.prototype,"coordinateSystemService",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zw=Lu()(xm.prototype,"eventEmitter",[Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm))||Hw);function Bz(e){var r=Lz();return function(){var n=id()(e),i;if(r){var a=id()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return F0()(this,i)}}function Lz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nz=function(e){k0()(t,e);var r=Bz(t);function t(){return Ac()(this,t),r.apply(this,arguments)}return Tc()(t,[{key:"getServiceConstructor",value:function(){return Fz}}]),t}(B0);function Kw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function qw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Kw(Object(t),!0).forEach(function(n){jz(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Kw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jz(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function zz(e,r){return Wz(e)||Hz(e,r)||Vz(e,r)||Uz()}function Uz(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vz(e,r){if(!!e){if(typeof e=="string")return Qw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qw(e,r)}}function Qw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Hz(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function Wz(e){if(Array.isArray(e))return e}var Gz=q.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(K.useRef)(null),c=Object(K.useState)(),p=zz(c,2),_=p[0],x=p[1];return Object(K.useEffect)(function(){var A=new zg(qw(qw({id:l.current},i),{},{map:new Nz(n)}));return A.on("loaded",function(){x(A),a&&a(A)}),function(){A.destroy()}},[]),Object(K.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(K.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(K.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(K.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(K.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),q.a.createElement(fe.Provider,{value:_},q.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),zG=Gz,Xz=C("zvhG"),Zz=C.n(Xz);function $z(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yz(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Yz(e,r){if(!!e){if(typeof e=="string")return Jw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jw(e,r)}}function Jw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var q1;function Q1(e,r,t){var n=t-r,i=((e-r)%n+n)%n+r;return i===r?t:i}function sp(e,r,t){return Math.min(t,Math.max(r,e))}function nf(e,r,t){return e*(1-t)+r*t}function J1(e,r,t,n){var i=new Zz.a(e,r,t,n);return function(a){return i.solve(a)}}var eb=J1(.25,.1,.25,1);function eO(){return q1==null&&(q1=window.matchMedia("(prefers-reduced-motion: reduce)")),q1.matches}function Kz(e,r){var t={},n=$z(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a in e&&(t[a]=e[a])}}catch(o){n.e(o)}finally{n.f()}return t}var ud=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),qz=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,Qz=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function H0(e){var r=qz(e);return{cancel:function(){return Qz(r)}}}function Jz(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];for(var i=0,a=t;i<a.length;i++){var o=a[i];for(var l in o)o[l]!==void 0&&(e[l]=o[l])}return e}var tO=63710088e-1,Bo=function(){function e(r,t){if(Object(et.a)(this,e),isNaN(r)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(r,", ").concat(t,")"));if(this.lng=+r,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return Object(De.a)(e,[{key:"wrap",value:function(){return new e(Q1(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var n=Math.PI/180,i=this.lat*n,a=t.lat*n,o=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((t.lng-this.lng)*n),l=tO*Math.acos(Math.min(o,1));return l}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&Object(Ju.a)(t)==="object"&&t!==null){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),Gg=function(){function e(r,t){Object(et.a)(this,e),r&&(t?this.setSouthWest(r).setNorthEast(t):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}return Object(De.a)(e,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof Bo?new Bo(t.lng,t.lat):Bo.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof Bo?new Bo(t.lng,t.lat):Bo.convert(t),this}},{key:"extend",value:function(t){var n=this.sw,i=this.ne,a,o;if(t instanceof Bo)a=t,o=t;else if(t instanceof e){if(a=t.sw,o=t.ne,!a||!o)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){var l=t;return this.extend(e.convert(l))}else{var c=t;return this.extend(Bo.convert(c))}return this}return!n&&!i?(this.sw=new Bo(a.lng,a.lat),this.ne=new Bo(o.lng,o.lat)):(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)),this}},{key:"getCenter",value:function(){return new Bo((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new Bo(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Bo(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var n=Bo.convert(t),i=n.lng,a=n.lat,o=this.sw.lat<=a&&a<=this.ne.lat,l=this.sw.lng<=i&&i<=this.ne.lng;return this.sw.lng>this.ne.lng&&(l=this.sw.lng>=i&&i>=this.ne.lng),o&&l}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Ca=function(){function e(r,t){Object(et.a)(this,e),this.x=r,this.y=t}return Object(De.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var n=Math.cos(t),i=Math.sin(t),a=n*this.x-i*this.y,o=i*this.x+n*this.y;return this.x=a,this.y=o,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,n){var i=Math.cos(t),a=Math.sin(t),o=n.x+i*(this.x-n.x)-a*(this.y-n.y),l=n.y+a*(this.x-n.x)+i*(this.y-n.y);return this.x=o,this.y=l,this}},{key:"roateAround",value:function(t,n){return this.clone()._rotateAround(t,n)}},{key:"_matMult",value:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),eU=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(Object(et.a)(this,e),isNaN(r)||r<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=t,this.left=n,this.right=i}return Object(De.a)(e,[{key:"interpolate",value:function(t,n,i){return n.top!=null&&t.top!=null&&(this.top=nf(t.top,n.top,i)),n.bottom!=null&&t.bottom!=null&&(this.bottom=nf(t.bottom,n.bottom,i)),n.left!=null&&t.left!=null&&(this.left=nf(t.left,n.left,i)),n.right!=null&&t.right!=null&&(this.right=nf(t.right,n.right,i)),this}},{key:"getCenter",value:function(t,n){var i=sp((this.left+t-this.right)/2,0,t),a=sp((this.top+n-this.bottom)/2,0,n);return new Ca(i,a)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),rO=2*Math.PI*tO;function nO(e){return rO*Math.cos(e*Math.PI/180)}function W0(e){return(180+e)/360}function G0(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function iO(e,r){return e/nO(r)}function tU(e){return e*360-180}function tb(e){var r=180-e*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}function rU(e,r){return e*nO(tb(r))}function nU(e){return 1/Math.cos(e*Math.PI/180)}var X0=function(){function e(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;Object(et.a)(this,e),this.x=+r,this.y=+t,this.z=+n}return Object(De.a)(e,[{key:"toLngLat",value:function(){return new Bo(tU(this.x),tb(this.y))}},{key:"toAltitude",value:function(){return rU(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/rO*nU(tb(this.y))}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=Bo.convert(t);return new e(W0(i.lng),G0(i.lat),iO(n,i.lat))}}]),e}();function iU(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=aU(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function aU(e,r){if(!!e){if(typeof e=="string")return aO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return aO(e,r)}}function aO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var UG=8192,oU=function(){function e(r,t,n,i,a){Object(et.a)(this,e),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=a===void 0?!0:a,this._minZoom=r||0,this._maxZoom=t||22,this._minPitch=n==null?0:n,this._maxPitch=i==null?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Bo(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new eU,this.posMatrixCache={},this.alignedPosMatrixCache={}}return Object(De.a)(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Ca(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var n=-Q1(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=z.create(),z.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var n=sp(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==n&&(this.unmodified=!1,this._pitch=n,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var n=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==n&&(this.unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,n,i){this.unmodified=!1,this.edgeInsets.interpolate(t,n,i),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}},{key:"resize",value:function(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var n=sp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Ca(W0(t.lng)*this.worldSize,G0(n)*this.worldSize)}},{key:"unproject",value:function(t){return new X0(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,n){var i=this.pointCoordinate(n),a=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),l=new X0(o.x-(i.x-a.x),o.y-(i.y-a.y));this.center=this.coordinateLocation(l),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var n=0,i=new Float64Array([t.x,t.y,0,1]),a=new Float64Array([t.x,t.y,1,1]);U.transformMat4(i,i,this.pixelMatrixInverse),U.transformMat4(a,a,this.pixelMatrixInverse);var o=i[3],l=a[3],c=i[0]/o,p=a[0]/l,_=i[1]/o,x=a[1]/l,A=i[2]/o,w=a[2]/l,I=A===w?0:(n-A)/(w-A);return new X0(nf(c,p,I)/this.worldSize,nf(_,x,I)/this.worldSize)}},{key:"getBounds",value:function(){return new Gg().extend(this.pointLocation(new Ca(0,0))).extend(this.pointLocation(new Ca(this.width,0))).extend(this.pointLocation(new Ca(this.width,this.height))).extend(this.pointLocation(new Ca(0,this.height)))}},{key:"getMaxBounds",value:function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new Gg([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new Ca(0,0)),n=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]),i=U.transformMat4(n,n,this.pixelMatrix);return i[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,n=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Ca(0,n))}},{key:"getCameraQueryGeometry",value:function(t){var n=this.getCameraPoint();if(t.length===1)return[t[0],n];var i=n.x,a=n.y,o=n.x,l=n.y,c=iU(t),p;try{for(c.s();!(p=c.n()).done;){var _=p.value;i=Math.min(i,_.x),a=Math.min(a,_.y),o=Math.max(o,_.x),l=Math.max(l,_.y)}}catch(x){c.e(x)}finally{c.f()}return[new Ca(i,a),new Ca(o,a),new Ca(o,l),new Ca(i,l),new Ca(i,a)]}},{key:"coordinatePoint",value:function(t){var n=U.fromValues(t.x*this.worldSize,t.y*this.worldSize,0,1);return U.transformMat4(n,n,this.pixelMatrix),new Ca(n[0]/n[3],n[1]/n[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return X0.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(!(!this.center||!this.width||!this.height||this.constraining)){this.constraining=!0;var t=-90,n=90,i=-180,a=180,o,l,c,p,_=this.size,x=this.unmodified;if(this.latRange){var A=this.latRange;t=G0(A[1])*this.worldSize,n=G0(A[0])*this.worldSize,o=n-t<_.y?_.y/(n-t):0}if(this.lngRange){var w=this.lngRange;i=W0(w[0])*this.worldSize,a=W0(w[1])*this.worldSize,l=a-i<_.x?_.x/(a-i):0}var I=this.point,P=Math.max(l||0,o||0);if(P){this.center=this.unproject(new Ca(l?(a+i)/2:I.x,o?(n+t)/2:I.y)),this.zoom+=this.scaleZoom(P),this.unmodified=x,this.constraining=!1;return}if(this.latRange){var H=I.y,W=_.y/2;H-W<t&&(p=t+W),H+W>n&&(p=n-W)}if(this.lngRange){var oe=I.x,ce=_.x/2;oe-ce<i&&(c=i+ce),oe+ce>a&&(c=a-ce)}(c!==void 0||p!==void 0)&&(this.center=this.unproject(new Ca(c!==void 0?c:I.x,p!==void 0?p:I.y))),this.unmodified=x,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(!!this.height){var t=this._fov/2,n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var i=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),o=Math.sin(a)*this.cameraToCenterDistance/Math.sin(sp(Math.PI-i-a,.01,Math.PI-.01)),l=this.point,c=l.x,p=l.y,_=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,x=_*1.01,A=this.height/50,w=new Float64Array(16);k.perspective(w,this._fov,this.width/this.height,A,x),w[8]=-n.x*2/this.width,w[9]=n.y*2/this.height,k.scale(w,w,[1,-1,1]),k.translate(w,w,[0,0,-this.cameraToCenterDistance]),k.rotateX(w,w,this._pitch),k.rotateZ(w,w,this.angle),k.translate(w,w,[-c,-p,0]),this.mercatorMatrix=k.scale([],w,[this.worldSize,this.worldSize,this.worldSize]),k.scale(w,w,[1,1,iO(1,this.center.lat)*this.worldSize,1]),this.projMatrix=w,this.invProjMatrix=k.invert([],this.projMatrix);var I=this.width%2/2,P=this.height%2/2,H=Math.cos(this.angle),W=Math.sin(this.angle),oe=c-Math.round(c)+H*I+W*P,ce=p-Math.round(p)+H*P+W*I,Oe=new Float64Array(w);if(k.translate(Oe,Oe,[oe>.5?oe-1:oe,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=Oe,w=k.create(),k.scale(w,w,[this.width/2,-this.height/2,1]),k.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=k.create(),k.scale(w,w,[1,-1,1]),k.translate(w,w,[-1,-1,0]),k.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=k.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),w=k.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),sU=fi.merge,no=Object(De.a)(function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Object(et.a)(this,e),sU(this,t),this.type=r});function uU(e){var r=lU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function lU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Eh=fi.merge,oO=function(e){Object(Lt.a)(t,e);var r=uU(t);function t(n){var i;Object(et.a)(this,t),i=r.call(this),Object(V.a)(Object(Be.a)(i),"renderFrameCallback",function(){var _=Math.min((ud()-i.easeStart)/i.easeOptions.duration,1);i.onEaseFrame(i.easeOptions.easing(_)),_<1?i.easeFrameId=i.requestRenderFrame(i.renderFrameCallback):i.stop()}),i.options=n;var a=n.minZoom,o=n.maxZoom,l=n.minPitch,c=n.maxPitch,p=n.renderWorldCopies;return i.moving=!1,i.zooming=!1,i.bearingSnap=n.bearingSnap,i.pitchEnabled=n.pitchEnabled,i.rotateEnabled=n.rotateEnabled,i.transform=new oU(a,o,l,c,p),i}return Object(De.a)(t,[{key:"requestRenderFrame",value:function(i){return 0}},{key:"cancelRenderFrame",value:function(i){}},{key:"getCenter",value:function(){var i=this.transform.center,a=i.lng,o=i.lat;return new Bo(a,o)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(i,a){return this.jumpTo({center:i},a)}},{key:"setPitch",value:function(i,a){return this.jumpTo({pitch:i},a),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(i,a,o){return this.easeTo(Eh({center:i},a),o)}},{key:"panBy",value:function(i,a,o){return i=Ca.convert(i).mult(-1),this.panTo(this.transform.center,Jz({offset:i},a||{}),o)}},{key:"zoomOut",value:function(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}},{key:"setBearing",value:function(i,a){return this.jumpTo({bearing:i},a),this}},{key:"setZoom",value:function(i,a){return this.jumpTo({zoom:i},a),this}},{key:"zoomIn",value:function(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}},{key:"zoomTo",value:function(i,a,o){return this.easeTo(Eh({zoom:i},a),o)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(i,a){return this.jumpTo({padding:i},a),this}},{key:"rotateTo",value:function(i,a,o){return this.easeTo(Eh({bearing:i},a),o)}},{key:"resetNorth",value:function(i,a){return this.rotateTo(0,Eh({duration:1e3},i),a),this}},{key:"resetNorthPitch",value:function(i,a){return this.easeTo(Eh({bearing:0,pitch:0,duration:1e3},i),a),this}},{key:"fitBounds",value:function(i,a,o){return this.fitInternal(this.cameraForBounds(i,a),a,o)}},{key:"cameraForBounds",value:function(i,a){return i=Gg.convert(i),this.cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),0,a)}},{key:"snapToNorth",value:function(i,a){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(i,a):this}},{key:"jumpTo",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;this.stop();var o=this.transform,l=!1,c=!1,p=!1;return i.zoom!==void 0&&o.zoom!==+i.zoom&&(l=!0,o.zoom=+i.zoom),i.center!==void 0&&(o.center=Bo.convert(i.center)),i.bearing!==void 0&&o.bearing!==+i.bearing&&(c=!0,o.bearing=+i.bearing),i.pitch!==void 0&&o.pitch!==+i.pitch&&(p=!0,o.pitch=+i.pitch),i.padding!==void 0&&!o.isPaddingEqual(i.padding)&&(o.padding=i.padding),this.emit("movestart",new no("movestart",a)),this.emit("move",new no("move",a)),l&&(this.emit("zoomstart",new no("zoomstart",a)),this.emit("zoom",new no("zoom",a)),this.emit("zoomend",new no("zoomend",a))),c&&(this.emit("rotatestart",new no("rotatestart",a)),this.emit("rotate",new no("rotate",a)),this.emit("rotateend",new no("rotateend",a))),p&&(this.emit("pitchstart",new no("pitchstart",a)),this.emit("pitch",new no("pitch",a)),this.emit("pitchend",new no("pitchend",a))),this.emit("moveend",new no("moveend",a))}},{key:"easeTo",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;a=Eh({offset:[0,0],duration:500,easing:eb},a),(a.animate===!1||!a.essential&&eO())&&(a.duration=0);var l=this.transform,c=this.getZoom(),p=this.getBearing(),_=this.getPitch(),x=this.getPadding(),A=a.zoom?+a.zoom:c,w=a.bearing?this.normalizeBearing(a.bearing,p):p,I=a.pitch?+a.pitch:_,P=a.padding?a.padding:l.padding,H=Ca.convert(a.offset),W=l.centerPoint.add(H),oe=l.pointLocation(W),ce=Bo.convert(a.center||oe);this.normalizeCenter(ce);var Oe=l.project(oe),Fe=l.project(ce).sub(Oe),je=l.zoomScale(A-c),tt,vt;a.around&&(tt=Bo.convert(a.around),vt=l.locationPoint(tt));var kt={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||A!==c,this.rotating=this.rotating||p!==w,this.pitching=this.pitching||I!==_,this.padding=!l.isPaddingEqual(P),this.easeId=a.easeId,this.prepareEase(o,a.noMoveStart,kt),clearTimeout(this.easeEndTimeoutID),this.ease(function(ir){if(i.zooming&&(l.zoom=nf(c,A,ir)),i.rotating&&i.rotateEnabled&&(l.bearing=nf(p,w,ir)),i.pitching&&i.pitchEnabled&&(l.pitch=nf(_,I,ir)),i.padding&&(l.interpolatePadding(x,P,ir),W=l.centerPoint.add(H)),tt)l.setLocationAtPoint(tt,vt);else{var ur=l.zoomScale(l.zoom-c),Zr=A>c?Math.min(2,je):Math.max(.5,je),ln=Math.pow(Zr,1-ir),_n=l.unproject(Oe.add(Fe.mult(ir*ln)).mult(ur));l.setLocationAtPoint(l.renderWorldCopies?_n.wrap():_n,W)}i.fireMoveEvents(o)},function(ir){i.afterEase(o,ir)},a),this}},{key:"flyTo",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;if(!a.essential&&eO()){var l=Kz(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(l,o)}this.stop(),a=Eh({offset:[0,0],speed:1.2,curve:1.42,easing:eb},a);var c=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),A=this.getPadding(),w=a.zoom?sp(+a.zoom,c.minZoom,c.maxZoom):p,I=a.bearing?this.normalizeBearing(a.bearing,_):_,P=a.pitch?+a.pitch:x,H="padding"in a?a.padding:c.padding,W=c.zoomScale(w-p),oe=Ca.convert(a.offset),ce=c.centerPoint.add(oe),Oe=c.pointLocation(ce),Fe=Bo.convert(a.center||Oe);this.normalizeCenter(Fe);var je=c.project(Oe),tt=c.project(Fe).sub(je),vt=a.curve,kt=Math.max(c.width,c.height),ir=kt/W,ur=tt.mag();if("minZoom"in a){var Zr=sp(Math.min(a.minZoom,p,w),c.minZoom,c.maxZoom),ln=kt/c.zoomScale(Zr-p);vt=Math.sqrt(ln/ur*2)}var _n=vt*vt;function Hi(vs){var ec=(ir*ir-kt*kt+(vs?-1:1)*_n*_n*ur*ur)/(2*(vs?ir:kt)*_n*ur);return Math.log(Math.sqrt(ec*ec+1)-ec)}function io(vs){return(Math.exp(vs)-Math.exp(-vs))/2}function Ga(vs){return(Math.exp(vs)+Math.exp(-vs))/2}function To(vs){return io(vs)/Ga(vs)}var Co=Hi(0),nl=function(ec){return Ga(Co)/Ga(Co+vt*ec)},d_=function(ec){return kt*((Ga(Co)*To(Co+vt*ec)-io(Co))/_n)/ur},Om=(Hi(1)-Co)/vt;if(Math.abs(ur)<1e-6||!isFinite(Om)){if(Math.abs(kt-ir)<1e-6)return this.easeTo(a,o);var vb=ir<kt?-1:1;Om=Math.abs(Math.log(ir/kt))/vt,d_=function(){return 0},nl=function(ec){return Math.exp(vb*vt*ec)}}if("duration"in a)a.duration=+a.duration;else{var mb="screenSpeed"in a?+a.screenSpeed/vt:+a.speed;a.duration=1e3*Om/mb}return a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this.zooming=!0,this.rotating=_!==I,this.pitching=P!==x,this.padding=!c.isPaddingEqual(H),this.prepareEase(o,!1),this.ease(function(vs){var ec=vs*Om,v_=1/nl(ec);c.zoom=vs===1?w:p+c.scaleZoom(v_),i.rotating&&(c.bearing=nf(_,I,vs)),i.pitching&&(c.pitch=nf(x,P,vs)),i.padding&&(c.interpolatePadding(A,H,vs),ce=c.centerPoint.add(oe));var m_=vs===1?Fe:c.unproject(je.add(tt.mult(d_(ec))).mult(v_));c.setLocationAtPoint(c.renderWorldCopies?m_.wrap():m_,ce),i.fireMoveEvents(o)},function(){return i.afterEase(o)},a),this}},{key:"fitScreenCoordinates",value:function(i,a,o,l,c){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Ca.convert(i)),this.transform.pointLocation(Ca.convert(a)),o,l),l,c)}},{key:"stop",value:function(i,a){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var o=this.onEaseEnd;delete this.onEaseEnd,o.call(this,a)}return this}},{key:"normalizeBearing",value:function(i,a){i=Q1(i,-180,180);var o=Math.abs(i-a);return Math.abs(i-360-a)<o&&(i-=360),Math.abs(i+360-a)<o&&(i+=360),i}},{key:"normalizeCenter",value:function(i){var a=this.transform;if(!(!a.renderWorldCopies||a.lngRange)){var o=i.lng-a.center.lng;i.lng+=o>180?-360:o<-180?360:0}}},{key:"fireMoveEvents",value:function(i){this.emit("move",new no("move",i)),this.zooming&&this.emit("zoom",new no("zoom",i)),this.rotating&&this.emit("rotate",new no("rotate",i)),this.pitching&&this.emit("rotate",new no("pitch",i))}},{key:"prepareEase",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.moving=!0,!a&&!o.moving&&this.emit("movestart",new no("movestart",i)),this.zooming&&!o.zooming&&this.emit("zoomstart",new no("zoomstart",i)),this.rotating&&!o.rotating&&this.emit("rotatestart",new no("rotatestart",i)),this.pitching&&!o.pitching&&this.emit("pitchstart",new no("pitchstart",i))}},{key:"afterEase",value:function(i,a){if(!(this.easeId&&a&&this.easeId===a)){delete this.easeId;var o=this.zooming,l=this.rotating,c=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,o&&this.emit("zoomend",new no("zoomend",i)),l&&this.emit("rotateend",new no("rotateend",i)),c&&this.emit("pitchend",new no("pitchend",i)),this.emit("moveend",new no("moveend",i))}}},{key:"ease",value:function(i,a,o){o.animate===!1||o.duration===0?(i(1),a()):(this.easeStart=ud(),this.easeOptions=o,this.onEaseFrame=i,this.onEaseEnd=a,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(i,a,o,l){var c={top:0,bottom:0,right:0,left:0};if(l=Eh({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},l),typeof l.padding=="number"){var p=l.padding;l.padding={top:p,bottom:p,right:p,left:p}}l.padding=Eh(c,l.padding);var _=this.transform,x=_.padding,A=_.project(Bo.convert(i)),w=_.project(Bo.convert(a)),I=A.rotate(-o*Math.PI/180),P=w.rotate(-o*Math.PI/180),H=new Ca(Math.max(I.x,P.x),Math.max(I.y,P.y)),W=new Ca(Math.min(I.x,P.x),Math.min(I.y,P.y)),oe=H.sub(W),ce=(_.width-(x.left+x.right+l.padding.left+l.padding.right))/oe.x,Oe=(_.height-(x.top+x.bottom+l.padding.top+l.padding.bottom))/oe.y;if(!(Oe<0||ce<0)){var Fe=Math.min(_.scaleZoom(_.scale*Math.min(ce,Oe)),l.maxZoom),je=Ca.convert(l.offset),tt=(l.padding.left-l.padding.right)/2,vt=(l.padding.top-l.padding.bottom)/2,kt=new Ca(je.x+tt,je.y+vt),ir=kt.mult(_.scale/_.zoomScale(Fe)),ur=_.unproject(A.add(w).div(2).sub(ir));return{center:ur,zoom:Fe,bearing:o}}}},{key:"fitInternal",value:function(i,a,o){return i?(a=Eh(i,a),delete a.padding,a.linear?this.easeTo(a,o):this.flyTo(a,o)):this}}]),t}(Po.EventEmitter);function sO(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=cU(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function cU(e,r){if(!!e){if(typeof e=="string")return uO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return uO(e,r)}}function uO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Cc={},Nu=Cc;Cc.create=function(e,r,t){var n=window.document.createElement(e);return r!==void 0&&(n.className=r),t&&t.appendChild(n),n},Cc.createNS=function(e,r){var t=window.document.createElementNS(e,r);return t};var iv=window.document&&window.document.documentElement.style;function lO(e){if(!iv)return e[0];var r=sO(e),t;try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n in iv)return n}}catch(i){r.e(i)}finally{r.f()}return e[0]}var Xg=lO(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),cO;Cc.disableDrag=function(){iv&&Xg&&(cO=iv[Xg],iv[Xg]="none")},Cc.enableDrag=function(){iv&&Xg&&(iv[Xg]=cO)};var fU=lO(["transform","WebkitTransform"]);Cc.setTransform=function(e,r){e.style[fU]=r};var Z0=!1;try{var $0=Object.defineProperty({},"passive",{get:function(){Z0=!0}});window.addEventListener("test",$0,$0),window.removeEventListener("test",$0,$0)}catch(e){Z0=!1}Cc.addEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&Z0?e.addEventListener(r,t,n):e.addEventListener(r,t,n.capture)},Cc.removeEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&Z0?e.removeEventListener(r,t,n):e.removeEventListener(r,t,n.capture)};var fO=function e(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",e,!0)};Cc.suppressClick=function(){window.addEventListener("click",fO,!0),setTimeout(function(){window.removeEventListener("click",fO,!0)},0)},Cc.mousePos=function(e,r){var t=e.getBoundingClientRect();return new Ca(r.clientX-t.left-e.clientLeft,r.clientY-t.top-e.clientTop)},Cc.touchPos=function(e,r){var t=e.getBoundingClientRect(),n=[],i=sO(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.push(new Ca(o.clientX-t.left-e.clientLeft,o.clientY-t.top-e.clientTop))}}catch(l){i.e(l)}finally{i.f()}return n},Cc.mouseButton=function(e){return e.button},Cc.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};function hU(e){var r=pU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function pU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dU=fi.merge,up=function(e){Object(Lt.a)(t,e);var r=hU(t);function t(n,i,a){var o,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Object(et.a)(this,t);var c=Nu.mousePos(i.getCanvasContainer(),a),p=i.unproject(c);return o=r.call(this,n,dU({point:c,lngLat:p,originalEvent:a},l)),o.defaultPrevented=!1,o.target=i,o}return Object(De.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(no);function vU(e){var r=mU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function mU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y0=function(e){Object(Lt.a)(t,e);var r=vU(t);function t(n,i,a){var o;Object(et.a)(this,t);var l=n==="touchend"?a.changedTouches:a.touches,c=Nu.touchPos(i.getCanvasContainer(),l),p=c.map(function(A){return i.unproject(A)}),_=c.reduce(function(A,w,I,P){return A.add(w.div(P.length))},new Ca(0,0)),x=i.unproject(_);return o=r.call(this,n,{points:c,point:_,lngLats:p,lngLat:x,originalEvent:a}),o.defaultPrevented=!1,o}return Object(De.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(no);function gU(e){var r=yU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function yU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _U=function(e){Object(Lt.a)(t,e);var r=gU(t);function t(n,i,a){var o;return Object(et.a)(this,t),o=r.call(this,n,{originalEvent:a}),o.defaultPrevented=!1,o}return Object(De.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(no),bU=function(){function e(r){Object(et.a)(this,e),this.map=r}return Object(De.a)(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new up(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new up("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new up(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),xU=function(){function e(r,t){Object(et.a)(this,e),this.map=r,this.el=r.getCanvasContainer(),this.container=r.getContainer(),this.clickTolerance=t.clickTolerance||1}return Object(De.a)(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"mousedown",value:function(t,n){!this.isEnabled()||!(t.shiftKey&&t.button===0)||(Nu.disableDrag(),this.startPos=this.lastPos=n,this.active=!0)}},{key:"mousemoveWindow",value:function(t,n){if(!!this.active){var i=n;if(!(this.lastPos.equals(i)||!this.box&&i.dist(this.startPos)<this.clickTolerance)){var a=this.startPos;this.lastPos=i,this.box||(this.box=Nu.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var o=Math.min(a.x,i.x),l=Math.max(a.x,i.x),c=Math.min(a.y,i.y),p=Math.max(a.y,i.y);Nu.setTransform(this.box,"translate(".concat(o,"px,").concat(c,"px)")),this.box&&(this.box.style.width="".concat(l-o,"px"),this.box.style.height="".concat(p-c,"px"))}}}},{key:"mouseupWindow",value:function(t,n){var i=this;if(!!this.active&&t.button===0){var a=this.startPos,o=n;if(this.reset(),Nu.suppressClick(),a.x===o.x&&a.y===o.y)this.fireEvent("boxzoomcancel",t);else return this.map.emit("boxzoomend",new no("boxzoomend",{originalEvent:t})),{cameraAnimation:function(c){return c.fitScreenCoordinates(a,o,i.map.getBearing(),{linear:!0})}}}}},{key:"keydown",value:function(t){!this.active||t.keyCode===27&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(Nu.remove(this.box),this.box=null),Nu.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,n){return this.map.emit(t,new no(t,{originalEvent:n}))}}]),e}(),EU=xU,SU=function(){function e(){Object(et.a)(this,e),this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,n){return t.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(t.shiftKey?-1:1),around:a.unproject(n)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function AU(e){var r=TU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function TU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CU=function(e){Object(Lt.a)(t,e);var r=AU(t);function t(){var n;Object(et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(V.a)(Object(Be.a)(n),"type","renderFrame"),n}return Object(De.a)(t)}(no);function wU(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=OU(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function OU(e,r){if(!!e){if(typeof e=="string")return hO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hO(e,r)}}function hO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Em=fi.merge,K0={linearity:.3,easing:J1(0,0,.3,1)},RU=Em({deceleration:2500,maxSpeed:1400},K0),MU=Em({deceleration:20,maxSpeed:1400},K0),PU=Em({deceleration:1e3,maxSpeed:360},K0),IU=Em({deceleration:1e3,maxSpeed:90},K0),DU=function(){function e(r){Object(et.a)(this,e),this.map=r,this.clear()}return Object(De.a)(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:ud(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,n=ud(),i=160;t.length>0&&n-t[0].time>i;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var n={zoom:0,bearing:0,pitch:0,pan:new Ca(0,0),pinchAround:void 0,around:void 0},i=wU(this.inertiaBuffer),a;try{for(i.s();!(a=i.n()).done;){var o=a.value.settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}}catch(P){i.e(P)}finally{i.f()}var l=this.inertiaBuffer[this.inertiaBuffer.length-1],c=l.time-this.inertiaBuffer[0].time,p={};if(n.pan.mag()){var _=Q0(n.pan.mag(),c,Em({},RU,t||{}));p.offset=n.pan.mult(_.amount/n.pan.mag()),p.center=this.map.transform.center,q0(p,_)}if(n.zoom){var x=Q0(n.zoom,c,MU);p.zoom=this.map.transform.zoom+x.amount,q0(p,x)}if(n.bearing){var A=Q0(n.bearing,c,PU);p.bearing=this.map.transform.bearing+sp(A.amount,-179,179),q0(p,A)}if(n.pitch){var w=Q0(n.pitch,c,IU);p.pitch=this.map.transform.pitch+w.amount,q0(p,w)}if(p.zoom||p.bearing){var I=n.pinchAround===void 0?n.around:n.pinchAround;p.around=I?this.map.unproject(I):this.map.getCenter()}return this.clear(),Em(p,{noMoveStart:!0})}}}]),e}();function q0(e,r){(!e.duration||e.duration<r.duration)&&(e.duration=r.duration,e.easing=r.easing)}function Q0(e,r,t){var n=t.maxSpeed,i=t.linearity,a=t.deceleration,o=sp(e*i/(r/1e3),-n,n),l=Math.abs(o)/(a*i);return{easing:t.easing,duration:l*1e3,amount:o*(l/2)}}var kU={panStep:100,bearingStep:15,pitchStep:10},FU=function(){function e(){Object(et.a)(this,e);var r=kU;this.panStep=r.panStep,this.bearingStep=r.bearingStep,this.pitchStep=r.pitchStep}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var n=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=0,a=0,o=0,l=0,c=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),l=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),l=1);break;case 38:t.shiftKey?o=1:(t.preventDefault(),c=-1);break;case 40:t.shiftKey?o=-1:(t.preventDefault(),c=1);break;default:return}return{cameraAnimation:function(_){var x=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:BU,zoom:i?Math.round(x)+i*(t.shiftKey?2:1):x,bearing:_.getBearing()+a*n.bearingStep,pitch:_.getPitch()+o*n.pitchStep,offset:[-l*n.panStep,-c*n.panStep],center:_.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function BU(e){return e*(2-e)}var LU=FU,NU=function(){function e(r,t){Object(et.a)(this,e),this.map=r,this.clickTolerance=t.clickTolerance}return Object(De.a)(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new _U(t.type,this.map,t))}},{key:"mousedown",value:function(t,n){return this.mousedownPos=n,this.firePreventable(new up(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new up(t.type,this.map,t))}},{key:"click",value:function(t,n){this.mousedownPos&&this.mousedownPos.dist(n)>=this.clickTolerance||this.map.emit(t.type,new up(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new up(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new up(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new up(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new Y0(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new Y0(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new Y0(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new Y0(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),J0,e_=0,rb=2,jU=(J0={},Object(V.a)(J0,e_,1),Object(V.a)(J0,rb,2),J0);function zU(e,r){var t=jU[r];return e.buttons===void 0||(e.buttons&t)!==t}var nb=function(){function e(r){Object(et.a)(this,e),this.reset(),this.clickTolerance=r.clickTolerance||1}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,n){if(!this.lastPoint){var i=Nu.mouseButton(t);!this.correctButton(t,i)||(this.lastPoint=n,this.eventButton=i)}}},{key:"mousemoveWindow",value:function(t,n){var i=this.lastPoint;if(!!i){if(t.preventDefault(),zU(t,this.eventButton)){this.reset();return}if(!(!this.moved&&n.dist(i)<this.clickTolerance))return this.moved=!0,this.lastPoint=n,this.move(i,n)}}},{key:"mouseupWindow",value:function(t){if(!!this.lastPoint){var n=Nu.mouseButton(t);n===this.eventButton&&(this.moved&&Nu.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,n){return!1}},{key:"move",value:function(t,n){}}]),e}();function UU(e){var r=VU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function VU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HU=function(e){Object(Lt.a)(t,e);var r=UU(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"mousedown",value:function(i,a){Object(_a.a)(Object(Te.a)(t.prototype),"mousedown",this).call(this,i,a),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(i,a){return{around:a,panDelta:a.sub(i)}}},{key:"correctButton",value:function(i,a){return a===e_&&!i.ctrlKey}}]),t}(nb);function WU(e){var r=GU();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function GU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XU=function(e){Object(Lt.a)(t,e);var r=WU(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"correctButton",value:function(i,a){return a===e_&&i.ctrlKey||a===rb}},{key:"move",value:function(i,a){var o=-.5,l=(a.y-i.y)*o;if(l)return this.active=!0,{pitchDelta:l}}},{key:"contextmenu",value:function(i){i.preventDefault()}}]),t}(nb);function ZU(e){var r=$U();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function $U(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YU=function(e){Object(Lt.a)(t,e);var r=ZU(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"contextmenu",value:function(i){i.preventDefault()}},{key:"correctButton",value:function(i,a){return a===e_&&i.ctrlKey||a===rb}},{key:"move",value:function(i,a){var o=.8,l=(a.x-i.x)*o;if(l)return this.active=!0,{bearingDelta:l}}}]),t}(nb),pO=4.000244140625,KU=1/100,qU=1/450,QU=2,JU=function(){function e(r,t){var n=this;Object(et.a)(this,e),Object(V.a)(this,"onScrollFrame",function(){if(!!n.frameId&&(n.frameId=null,!!n.isActive())){var i=n.map.transform;if(n.delta!==0){var a=n.type==="wheel"&&Math.abs(n.delta)>pO?n.wheelZoomRate:n.defaultZoomRate,o=QU/(1+Math.exp(-Math.abs(n.delta*a)));n.delta<0&&o!==0&&(o=1/o);var l=typeof n.targetZoom=="number"?i.zoomScale(n.targetZoom):i.scale;n.targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(l*o))),n.type==="wheel"&&(n.startZoom=i.zoom,n.easing=n.smoothOutEasing(200)),n.delta=0}var c=typeof n.targetZoom=="number"?n.targetZoom:i.zoom,p=n.startZoom,_=n.easing,x=!1,A;if(n.type==="wheel"&&p&&_){var w=Math.min((ud()-n.lastWheelEventTime)/200,1),I=_(w);A=nf(p,c,I),w<1?n.frameId||(n.frameId=!0):x=!0}else A=c,x=!0;return n.active=!0,x&&(n.active=!1,n.finishTimeout=setTimeout(function(){n.zooming=!1,n.handler.triggerRenderFrame(),delete n.targetZoom,delete n.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:A-i.zoom,around:n.aroundPoint,originalEvent:n.lastWheelEvent}}}),this.map=r,this.el=r.getCanvasContainer(),this.handler=t,this.delta=0,this.defaultZoomRate=KU,this.wheelZoomRate=qU}return Object(De.a)(e,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||this.finishTimeout!==void 0}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&t.around==="center")}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"wheel",value:function(t){if(!!this.isEnabled()){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY,i=ud(),a=i-(this.lastWheelEventTime||0);this.lastWheelEventTime=i,n!==0&&n%pO==0?this.type="wheel":n!==0&&Math.abs(n)<4?this.type="trackpad":a>400?(this.type=null,this.lastValue=n,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(a*n)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,n+=this.lastValue)),t.shiftKey&&n&&(n=n/4),this.type&&(this.lastWheelEvent=t,this.delta-=n,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(!!this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var n=Nu.mousePos(this.el,t);this.around=Bo.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(n)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var n=eb;if(this.prevEase){var i=this.prevEase,a=(ud()-i.start)/i.duration,o=i.easing(a+.01)-i.easing(a),l=.27/Math.sqrt(o*o+1e-4)*.01,c=Math.sqrt(.27*.27-l*l);n=J1(l,c,.25,1)}return this.prevEase={start:ud(),duration:t,easing:n},n}}]),e}(),e9=JU,t9=function(){function e(r,t){Object(et.a)(this,e),this.clickZoom=r,this.tapZoom=t}return Object(De.a)(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),r9=function(){function e(r,t,n){Object(et.a)(this,e),this.el=r,this.mousePan=t,this.touchPan=n}return Object(De.a)(e,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),n9=function(){function e(r,t,n){Object(et.a)(this,e),this.pitchWithRotate=r.pitchWithRotate,this.mouseRotate=t,this.mousePitch=n}return Object(De.a)(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),i9=function(){function e(r,t,n,i){Object(et.a)(this,e),this.el=r,this.touchZoom=t,this.touchRotate=n,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return Object(De.a)(e,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function ib(e,r){for(var t={},n=0;n<e.length;n++)t[e[n].identifier]=r[n];return t}function a9(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=o9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function o9(e,r){if(!!e){if(typeof e=="string")return dO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return dO(e,r)}}function dO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function s9(e){var r=new Ca(0,0),t=a9(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;r._add(i)}}catch(a){t.e(a)}finally{t.f()}return r.div(e.length)}var vO=500,u9=500,mO=30,l9=function(){function e(r){Object(et.a)(this,e),this.reset(),this.numTouches=r.numTouches}return Object(De.a)(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=s9(n),this.touches=ib(i,n)))}},{key:"touchmove",value:function(t,n,i){if(!(this.aborted||!this.centroid)){var a=ib(i,n);for(var o in this.touches)if(this.touches[o]){var l=this.touches[o],c=a[o];(!c||c.dist(l)>mO)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,n,i){if((!this.centroid||t.timeStamp-this.startTime>u9)&&(this.aborted=!0),i.length===0){var a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}]),e}(),ab=function(){function e(r){Object(et.a)(this,e),this.singleTap=new l9(r),this.numTaps=r.numTaps,this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.lastTime=Infinity,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,n,i){this.singleTap.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.singleTap.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var a=this.singleTap.touchend(t,n,i);if(a){var o=t.timeStamp-this.lastTime<vO,l=!this.lastTap||this.lastTap.dist(a)<mO;if((!o||!l)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}]),e}(),c9=function(){function e(){Object(et.a)(this,e),this.tap=new ab({numTouches:1,numTaps:1}),this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,n,i){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>vO&&this.reset(),this.tapTime?i.length>0&&(this.swipePoint=n[0],this.swipeTouch=i[0].identifier):this.tap.touchstart(t,n,i))}},{key:"touchmove",value:function(t,n,i){if(!this.tapTime)this.tap.touchmove(t,n,i);else if(this.swipePoint){if(i[0].identifier!==this.swipeTouch)return;var a=n[0],o=a.y-this.swipePoint.y;return this.swipePoint=a,t.preventDefault(),this.active=!0,{zoomDelta:o/128}}}},{key:"touchend",value:function(t,n,i){if(this.tapTime)this.swipePoint&&i.length===0&&this.reset();else{var a=this.tap.touchend(t,n,i);a&&(this.tapTime=t.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),f9=function(){function e(){Object(et.a)(this,e),this.zoomIn=new ab({numTouches:1,numTaps:2}),this.zoomOut=new ab({numTouches:2,numTaps:1}),this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,n,i){this.zoomIn.touchstart(t,n,i),this.zoomOut.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.zoomIn.touchmove(t,n,i),this.zoomOut.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var a=this,o=this.zoomIn.touchend(t,n,i),l=this.zoomOut.touchend(t,n,i);if(o)return this.active=!0,t.preventDefault(),setTimeout(function(){return a.reset()},0),{cameraAnimation:function(p){return p.easeTo({duration:300,zoom:p.getZoom()+1,around:p.unproject(o)},{originalEvent:t})}};if(l)return this.active=!0,t.preventDefault(),setTimeout(function(){return a.reset()},0),{cameraAnimation:function(p){return p.easeTo({duration:300,zoom:p.getZoom()-1,around:p.unproject(l)},{originalEvent:t})}}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),h9=function(){function e(r){Object(et.a)(this,e),this.minTouches=1,this.clickTolerance=r.clickTolerance||1,this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Ca(0,0)}},{key:"touchstart",value:function(t,n,i){return this.calculateTransform(t,n,i)}},{key:"touchmove",value:function(t,n,i){if(!!this.active)return t.preventDefault(),this.calculateTransform(t,n,i)}},{key:"touchend",value:function(t,n,i){this.calculateTransform(t,n,i),this.active&&i.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,n,i){i.length>0&&(this.active=!0);var a=ib(i,n),o=new Ca(0,0),l=new Ca(0,0),c=0;for(var p in a)if(a[p]){var _=a[p],x=this.touches[p];x&&(o._add(_),l._add(_.sub(x)),c++,a[p]=_)}if(this.touches=a,!(c<this.minTouches||!l.mag())){var A=l.div(c);if(this.sum._add(A),!(this.sum.mag()<this.clickTolerance)){var w=o.div(c);return{around:w,panDelta:A}}}}}]),e}(),ob=function(){function e(){Object(et.a)(this,e),this.reset()}return Object(De.a)(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,n,i){}},{key:"touchstart",value:function(t,n,i){this.firstTwoTouches||i.length<2||(this.firstTwoTouches=[i[0].identifier,i[1].identifier],this.start([n[0],n[1]]))}},{key:"touchmove",value:function(t,n,i){if(!!this.firstTwoTouches){t.preventDefault();var a=Object(hn.a)(this.firstTwoTouches,2),o=a[0],l=a[1],c=t_(i,n,o),p=t_(i,n,l);if(!(!c||!p)){var _=this.aroundCenter?null:c.add(p).div(2);return this.move([c,p],_,t)}}}},{key:"touchend",value:function(t,n,i){if(!!this.firstTwoTouches){var a=Object(hn.a)(this.firstTwoTouches,2),o=a[0],l=a[1],c=t_(i,n,o),p=t_(i,n,l);c&&p||(this.active&&Nu.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&t.around==="center"}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function t_(e,r,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return r[n]}function p9(e){var r=d9();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function d9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function sb(e){return Math.abs(e.y)>Math.abs(e.x)}var v9=100,m9=function(e){Object(Lt.a)(t,e);var r=p9(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"reset",value:function(){Object(_a.a)(Object(Te.a)(t.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(i){this.lastPoints=i,sb(i[0].sub(i[1]))&&(this.valid=!1)}},{key:"move",value:function(i,a,o){var l=i[0].sub(this.lastPoints[0]),c=i[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(l,c,o.timeStamp),!!this.valid){this.lastPoints=i,this.active=!0;var p=(l.y+c.y)/2,_=-.5;return{pitchDelta:p*_}}}},{key:"gestureBeginsVertically",value:function(i,a,o){if(this.valid!==void 0)return this.valid;var l=2,c=i.mag()>=l,p=a.mag()>=l;if(!(!c&&!p)){if(!c||!p)return this.firstMove===void 0&&(this.firstMove=o),o-this.firstMove<v9?void 0:!1;var _=i.y>0==a.y>0;return sb(i)&&sb(a)&&_}}}]),t}(ob);function g9(e){var r=y9();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function y9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _9=25;function gO(e,r){return e.angleWith(r)*180/Math.PI}var b9=function(e){Object(Lt.a)(t,e);var r=g9(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"reset",value:function(){Object(_a.a)(Object(Te.a)(t.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(i){this.startVector=this.vector=i[0].sub(i[1]),this.minDiameter=i[0].dist(i[1])}},{key:"move",value:function(i,a){var o=this.vector;if(this.vector=i[0].sub(i[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:gO(this.vector,o),pinchAround:a}}},{key:"isBelowThreshold",value:function(i){this.minDiameter=Math.min(this.minDiameter,i.mag());var a=Math.PI*this.minDiameter,o=_9/a*360,l=gO(i,this.startVector);return Math.abs(l)<o}}]),t}(ob);function x9(e){var r=E9();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function E9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S9=.1;function yO(e,r){return Math.log(e/r)/Math.LN2}var A9=function(e){Object(Lt.a)(t,e);var r=x9(t);function t(){return Object(et.a)(this,t),r.apply(this,arguments)}return Object(De.a)(t,[{key:"reset",value:function(){Object(_a.a)(Object(Te.a)(t.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(i){this.startDistance=this.distance=i[0].dist(i[1])}},{key:"move",value:function(i,a){var o=this.distance;if(this.distance=i[0].dist(i[1]),!(!this.active&&Math.abs(yO(this.distance,this.startDistance))<S9))return this.active=!0,{zoomDelta:yO(this.distance,o),pinchAround:a}}}]),t}(ob);function av(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=T9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function T9(e,r){if(!!e){if(typeof e=="string")return _O(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _O(e,r)}}function _O(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var ub=fi.merge,r_=function(r){return r.zoom||r.drag||r.pitch||r.rotate};function lb(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var C9=function(){function e(r,t){var n=this;Object(et.a)(this,e),Object(V.a)(this,"handleWindowEvent",function(x){n.handleEvent(x,"".concat(x.type,"Window"))}),Object(V.a)(this,"handleEvent",function(x,A){if(x.type==="blur"){n.stop();return}n.updatingCamera=!0;var w=x.type==="renderFrame"?void 0:x,I={needsRenderFrame:!1},P={},H={},W=x.touches?n.getMapTouches(x.touches):void 0,oe=W?Nu.touchPos(n.el,W):Nu.mousePos(n.el,x),ce=av(n.handlers),Oe;try{for(ce.s();!(Oe=ce.n()).done;){var Fe=Oe.value,je=Fe.handlerName,tt=Fe.handler,vt=Fe.allowed;if(!!tt.isEnabled()){var kt=void 0;if(n.blockedByActive(H,vt,je))tt.reset();else{var ir=A||x.type;tt&&tt[ir]&&(kt=tt[ir](x,oe,W),n.mergeIHandlerResult(I,P,kt,je,w),kt&&kt.needsRenderFrame&&n.triggerRenderFrame())}(kt||tt.isActive())&&(H[je]=tt)}}}catch(_n){ce.e(_n)}finally{ce.f()}var ur={};for(var Zr in n.previousActiveHandlers)H[Zr]||(ur[Zr]=w);n.previousActiveHandlers=H,(Object.keys(ur).length||lb(I))&&(n.changes.push([I,P,ur]),n.triggerRenderFrame()),(Object.keys(H).length||lb(I))&&n.map.stop(!0),n.updatingCamera=!1;var ln=I.cameraAnimation;ln&&(n.inertia.clear(),n.fireEvents({},{}),n.changes=[],ln(n.map))}),this.map=r,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new DU(r),this.bearingSnap=t.bearingSnap,this.rotateEnabled=t.rotateEnabled,this.pitchEnabled=t.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(t);var i=this.el;this.listeners=[],this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var a=av(this.listeners),o;try{for(a.s();!(o=a.n()).done;){var l=Object(hn.a)(o.value,3),c=l[0],p=l[1],_=l[2];Nu.addEventListener(c,p,c===window.document?this.handleWindowEvent:this.handleEvent,_)}}catch(x){a.e(x)}finally{a.f()}}return Object(De.a)(e,[{key:"destroy",value:function(){var t=av(this.listeners),n;try{for(t.s();!(n=t.n()).done;){var i=Object(hn.a)(n.value,3),a=i[0],o=i[1],l=i[2];Nu.removeEventListener(a,o,a===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(c){t.e(c)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t=av(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;i.reset()}}catch(a){t.e(a)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t=av(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;if(i.isActive())return!0}}catch(a){t.e(a)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(r_(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,n,i,a,o){if(!!i){ub(t,i);var l={handlerName:a,originalEvent:i.originalEvent||o};i.zoomDelta!==void 0&&(n.zoom=l),i.panDelta!==void 0&&(n.drag=l),i.pitchDelta!==void 0&&(n.pitch=l),i.bearingDelta!==void 0&&(n.rotate=l)}}},{key:"triggerRenderFrame",value:function(){var t=this;this.frameId===void 0&&(this.frameId=this.map.requestRenderFrame(function(n){delete t.frameId,t.handleEvent(new CU("renderFrame",{timeStamp:n})),t.applyChanges()}))}},{key:"addDefaultHandlers",value:function(t){var n=this.map,i=n.getCanvasContainer();this.add("mapEvent",new NU(n,t));var a=n.boxZoom=new EU(n,t);this.add("boxZoom",a);var o=new f9,l=new SU;n.doubleClickZoom=new t9(l,o),this.add("tapZoom",o),this.add("clickZoom",l);var c=new c9;this.add("tapDragZoom",c);var p=n.touchPitch=new m9;this.add("touchPitch",p);var _=new XU(t),x=new YU(t);n.dragRotate=new n9(t,_,x),this.add("mouseRotate",_,["mousePitch"]),this.add("mousePitch",x,["mouseRotate"]);var A=new HU(t),w=new h9(t);n.dragPan=new r9(i,A,w),this.add("mousePan",A),this.add("touchPan",w,["touchZoom","touchRotate"]);var I=new b9,P=new A9;n.touchZoomRotate=new i9(i,P,I,c),this.add("touchRotate",I,["touchPan","touchZoom"]),this.add("touchZoom",P,["touchPan","touchRotate"]);var H=n.scrollZoom=new e9(n,this);this.add("scrollZoom",H,["mousePan"]);var W=n.keyboard=new LU;this.add("keyboard",W),this.add("blockableMapEvent",new bU(n));for(var oe=0,ce=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];oe<ce.length;oe++){var Oe=ce[oe];t.interactive&&t[Oe]&&n[Oe].enable(t[Oe])}}},{key:"add",value:function(t,n,i){this.handlers.push({handlerName:t,handler:n,allowed:i}),this.handlersById[t]=n}},{key:"blockedByActive",value:function(t,n,i){for(var a in t)if(a!==i&&(!n||n.indexOf(a)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var n=[],i=av(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,l=o.target;this.el.contains(l)&&n.push(o)}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"applyChanges",value:function(){var t={},n={},i={},a=av(this.changes),o;try{for(a.s();!(o=a.n()).done;){var l=Object(hn.a)(o.value,3),c=l[0],p=l[1],_=l[2];c.panDelta&&(t.panDelta=(t.panDelta||new Ca(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),ub(n,p),ub(i,_)}}catch(x){a.e(x)}finally{a.f()}this.updateMapTransform(t,n,i),this.changes=[]}},{key:"updateMapTransform",value:function(t,n,i){var a=this.map,o=a.transform;if(!lb(t))return this.fireEvents(n,i);var l=t.panDelta,c=t.zoomDelta,p=t.bearingDelta,_=t.pitchDelta,x=t.pinchAround,A=t.around;x!==void 0&&(A=x),a.stop(!0),A=A||a.transform.centerPoint;var w=o.pointLocation(l?A.sub(l):A);p&&this.rotateEnabled&&(o.bearing+=p),_&&this.pitchEnabled&&(o.pitch+=_),c&&(o.zoom+=c),o.setLocationAtPoint(w,A),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(n,i)}},{key:"fireEvents",value:function(t,n){var i=this,a=r_(this.eventsInProgress),o=r_(t),l={};for(var c in t)if(t[c]){var p=t[c].originalEvent;this.eventsInProgress[c]||(l["".concat(c,"start")]=p),this.eventsInProgress[c]=t[c]}!a&&o&&this.fireEvent("movestart",o.originalEvent);for(var _ in l)l[_]&&this.fireEvent(_,l[_]);t.rotate&&(this.bearingChanged=!0),o&&this.fireEvent("move",o.originalEvent);for(var x in t)if(t[x]){var A=t[x].originalEvent;this.fireEvent(x,A)}var w={},I;for(var P in this.eventsInProgress)if(this.eventsInProgress[P]){var H=this.eventsInProgress[P],W=H.handlerName,oe=H.originalEvent;this.handlersById[W].isActive()||(delete this.eventsInProgress[P],I=n[W]||oe,w["".concat(P,"end")]=I)}for(var ce in w)w[ce]&&this.fireEvent(ce,w[ce]);var Oe=r_(this.eventsInProgress);if((a||o)&&!Oe){this.updatingCamera=!0;var Fe=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),je=function(vt){return vt!==0&&-i.bearingSnap<vt&&vt<i.bearingSnap};Fe?(je(Fe.bearing||this.map.getBearing())&&(Fe.bearing=0),this.map.easeTo(Fe,{originalEvent:I})):(this.map.emit("moveend",new no("moveend",{originalEvent:I})),je(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,n){this.map.emit(t,new no(t,n?{originalEvent:n}:{}))}}]),e}(),bO=C9,n_=null,Zg=[],w9=30,cb=1e3/w9,Sm=window.performance,Am={create:"create",load:"load",fullLoad:"fullLoad"},i_={mark:function(r){Sm.mark(r)},frame:function(r){var t=r;if(n_!=null){var n=t-n_;Zg.push(n)}n_=t},clearMetrics:function(){n_=null,Zg=[],Sm.clearMeasures("loadTime"),Sm.clearMeasures("fullLoadTime");for(var r in Am)Sm.clearMarks(Am[r])},getPerformanceMetrics:function(){var r=Sm.measure("loadTime",Am.create,Am.load).duration,t=Sm.measure("fullLoadTime",Am.create,Am.fullLoad).duration,n=Zg.length,i=Zg.reduce(function(c,p){return c+p},0)/n/1e3,a=1/i,o=Zg.filter(function(c){return c>cb}).reduce(function(c,p){return c+(p-cb)/cb},0),l=o/(n+o)*100;return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:l}}};function xO(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=O9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(p){throw p},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var p=t.next();return a=p.done,p},e:function(p){o=!0,l=p},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function O9(e,r){if(!!e){if(typeof e=="string")return EO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return EO(e,r)}}function EO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var R9=function(){function e(){Object(et.a)(this,e),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return Object(De.a)(e,[{key:"add",value:function(t){var n=++this.id,i=this.queue;return i.push({callback:t,id:n,cancelled:!1}),n}},{key:"remove",value:function(t){var n=this.currentlyRunning,i=n?this.queue.concat(n):this.queue,a=xO(i),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;if(l.id===t){l.cancelled=!0;return}}}catch(c){a.e(c)}finally{a.f()}}},{key:"run",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=this.currentlyRunning=this.queue;this.queue=[];var i=xO(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!o.cancelled&&(o.callback(t),this.cleared))break}}catch(l){i.e(l)}finally{i.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),SO=R9;function M9(e){var r=P9();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function P9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function I9(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}I9(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var a_=-2,AO=22,D9=fi.merge,Tm=0,o_=60,k9={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:a_,maxZoom:AO,minPitch:Tm,maxPitch:o_,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},VG=function(e){Object(Lt.a)(t,e);var r=M9(t);function t(n){var i;return Object(et.a)(this,t),i=r.call(this,D9({},k9,n)),Object(V.a)(Object(Be.a)(i),"renderTaskQueue",new SO),Object(V.a)(Object(Be.a)(i),"trackResize",!0),Object(V.a)(Object(Be.a)(i),"onWindowOnline",function(){i.update()}),Object(V.a)(Object(Be.a)(i),"onWindowResize",function(a){i.trackResize&&i.resize({originalEvent:a}).update()}),i.initContainer(),i.resize(),i.handlers=new bO(Object(Be.a)(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1)),i}return Object(De.a)(t,[{key:"resize",value:function(i){var a=this.containerDimensions(),o=a[0],l=a[1];this.transform.resize(o,l);var c=!this.moving;return c&&(this.stop(),this.emit("movestart",new Event("movestart",i)),this.emit("move",new Event("move",i))),this.emit("resize",new Event("resize",i)),c&&this.emit("moveend",new Event("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(Bo.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Ca.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(Gg.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?a_:i,i>=a_&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(a_," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?AO:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?Tm:i,i<Tm)throw new Error("minPitch must be greater than or equal to ".concat(Tm));if(i>=Tm&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(Tm," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?o_:i,i>o_)throw new Error("maxPitch must be less than or equal to ".concat(o_));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=H0(function(a){i_.frame(a),i.frame=null,i.update(a)}))}},{key:"update",value:function(i){var a=this;this.frame||(this.frame=H0(function(o){i_.frame(o),a.frame=null,a.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var a=this.canvasContainer=D.create("div","l7-canvas-container",i);this.options.interactive&&a.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var i=0,a=0;return this.container&&(i=this.container.clientWidth||400,a=this.container.clientHeight||300),[i,a]}},{key:"resizeCanvas",value:function(i,a){var o=D.DPR||1;this.canvas.width=o*i,this.canvas.height=o*a,this.canvas.style.width="".concat(i,"px"),this.canvas.style.height="".concat(a,"px")}}]),t}(oO),F9=fi.throttle,B9=function(){function e(r){var t=this;Object(et.a)(this,e),Object(V.a)(this,"onHashChange",function(){var n=t.getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(+a)})){var i=t.map.dragRotate.isEnabled()&&t.map.touchZoomRotate.isEnabled()?+(n[3]||0):t.map.getBearing();return t.map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}),Object(V.a)(this,"getCurrentHash",function(){var n=window.location.hash.replace("#","");if(t.hashName){var i;return n.split("&").map(function(a){return a.split("=")}).forEach(function(a){a[0]===t.hashName&&(i=a)}),(i&&i[1]||"").split("/")}return n.split("/")}),Object(V.a)(this,"updateHashUnthrottled",function(){var n=t.getHashString();try{window.history.replaceState(window.history.state,"",n)}catch(i){}}),this.hashName=r&&encodeURIComponent(r),this.updateHash=F9(this.updateHashUnthrottled,30*1e3/100)}return Object(De.a)(e,[{key:"addTo",value:function(t){return this.map=t,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var n=this.map.getCenter(),i=Math.round(this.map.getZoom()*100)/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,a),l=Math.round(n.lng*o)/o,c=Math.round(n.lat*o)/o,p=this.map.getBearing(),_=this.map.getPitch(),x="";if(t?x+="/".concat(l,"/").concat(c,"/").concat(i):x+="".concat(i,"/").concat(c,"/").concat(l),(p||_)&&(x+="/".concat(Math.round(p*10)/10)),_&&(x+="/".concat(Math.round(_))),this.hashName){var A=this.hashName,w=!1,I=window.location.hash.slice(1).split("&").map(function(P){var H=P.split("=")[0];return H===A?(w=!0,"".concat(H,"=").concat(x)):P}).filter(function(P){return P});return w||I.push("".concat(A,"=").concat(x)),"#".concat(I.join("&"))}return"#".concat(x)}}]),e}(),L9=B9;function N9(e){var r=j9();return function(){var n=Object(Te.a)(e),i;if(r){var a=Object(Te.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(ut.a)(this,i)}}function j9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function z9(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}z9(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`),function(){if(typeof window.CustomEvent=="function")return!1;function e(r,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(r,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var s_=-2,TO=22,CO=fi.merge,Cm=0,u_=60,U9={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:s_,maxZoom:TO,minPitch:Cm,maxPitch:u_,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},wO=function(e){Object(Lt.a)(t,e);var r=N9(t);function t(n){var i;Object(et.a)(this,t),i=r.call(this,CO({},U9,n)),Object(V.a)(Object(Be.a)(i),"renderTaskQueue",new SO),Object(V.a)(Object(Be.a)(i),"trackResize",!0),Object(V.a)(Object(Be.a)(i),"onWindowOnline",function(){i.update()}),Object(V.a)(Object(Be.a)(i),"onWindowResize",function(o){i.trackResize&&i.resize({originalEvent:o}).update()}),i.initContainer(),i.resize(),i.handlers=new bO(Object(Be.a)(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1));var a=typeof n.hash=="string"&&n.hash||void 0;return n.hash&&(i.hash=new L9(a).addTo(Object(Be.a)(i))),(!i.hash||!i.hash.onHashChange())&&(i.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),n.bounds&&(i.resize(),i.fitBounds(n.bounds,CO({},n.fitBoundsOptions,{duration:0})))),i}return Object(De.a)(t,[{key:"resize",value:function(i){var a=this.containerDimensions(),o=Object(hn.a)(a,2),l=o[0],c=o[1];this.transform.resize(l,c);var p=!this.moving;return p&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",i)),this.emit("move",new window.CustomEvent("move",i))),this.emit("resize",new window.CustomEvent("resize",i)),p&&this.emit("moveend",new window.CustomEvent("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(Bo.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Ca.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(Gg.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?s_:i,i>=s_&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(s_," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?TO:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?Cm:i,i<Cm)throw new Error("minPitch must be greater than or equal to ".concat(Cm));if(i>=Cm&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(Cm," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?u_:i,i>u_)throw new Error("maxPitch must be less than or equal to ".concat(u_));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=H0(function(a){i_.frame(a),i.frame=null,i.update(a)}))}},{key:"update",value:function(i){var a=this;this.frame||(this.frame=H0(function(o){i_.frame(o),a.frame=null,a.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var a=this.canvasContainer=D.create("div","l7-canvas-container",i);this.options.interactive&&a.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var i=0,a=0;return this.container&&(i=this.container.clientWidth,a=this.container.clientHeight,i=i===0?400:i,a=a===0?300:a),[i,a]}}]),t}(oO),OO=function(){function e(){Ac()(this,e),mi()(this,"viewport",void 0)}return Tc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,o=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new Y1({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),RO={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},V9=["id","attributionControl","style","rotation","mapInstance"],H9=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"],MO,PO,IO,DO,kO,FO,wm,BO,LO,NO,jO;function zO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function UO(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?zO(Object(t),!0).forEach(function(n){mi()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var VO={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},HO=12,W9=(MO=Object(Qr.injectable)(),PO=Object(Qr.inject)(Yt.MapConfig),IO=Object(Qr.inject)(Yt.IGlobalConfigService),DO=Object(Qr.inject)(Yt.ICoordinateSystemService),kO=Object(Qr.inject)(Yt.IEventEmitter),MO(FO=(wm=function(){function e(){var r=this;Ac()(this,e),mi()(this,"version",ym.L7MAP),mi()(this,"map",void 0),mi()(this,"dragging",!1),mi()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Bu()(this,"config",BO,this),Bu()(this,"configService",LO,this),Bu()(this,"coordinateSystemService",NO,this),Bu()(this,"eventEmitter",jO,this),mi()(this,"viewport",void 0),mi()(this,"markerContainer",void 0),mi()(this,"cameraChangedCallback",void 0),mi()(this,"$mapContainer",void 0),mi()(this,"handleMiniCameraChanged",function(t,n,i,a,o){var l=r.config.offsetCoordinate,c=l===void 0?!0:l;r.viewport.syncWithMapCamera({bearing:a,center:[t,n],viewportHeight:r.map.transform.height,pitch:o,viewportWidth:r.map.transform.width,zoom:i,cameraHeight:0}),r.viewport.getZoom()>HO&&c?r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT),r.cameraChangedCallback(r.viewport)}),mi()(this,"handleCameraChanged",function(){var t=r.map.getCenter(),n=t.lat,i=t.lng,a=r.config.offsetCoordinate,o=a===void 0?!0:a;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.viewport.getZoom()>HO&&o?r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT),r.cameraChangedCallback(r.viewport)})}return Tc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=D.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Wv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(VO[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(VO[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,n){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0};throw new Error("not implement")}},{key:"init",value:function(){var r=Vg()(be.a.mark(function n(){var i=this,a,o,l,c,p,_,x,A,w,I,P;return be.a.wrap(function(W){for(;;)switch(W.prev=W.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,p=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,A=a.rotation,w=A===void 0?0:A,I=a.mapInstance,P=Ug()(a,V9),this.viewport=new OO,I?(this.map=I,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(l),this.map=new wO(UO({container:this.$mapContainer,style:this.getMapStyle(x),bearing:w},P))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 8:case"end":return W.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initMiniMap",value:function(){var r=Vg()(be.a.mark(function n(){var i=this,a,o,l,c,p,_,x,A,w,I,P,H,W,oe,ce,Oe;return be.a.wrap(function(je){for(;;)switch(je.prev=je.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,p=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,A=a.rotation,w=A===void 0?0:A,I=a.mapInstance,P=a.canvas,H=P===void 0?null:P,W=a.hasBaseMap,oe=W===void 0?!1:W,ce=Ug()(a,H9),this.viewport=new OO,this.$mapContainer=H,this.map=new wO(UO({container:this.$mapContainer,style:this.getMapStyle(x),bearing:w,canvas:H},ce)),oe?(Oe=this.map.getCenter(),this.handleMiniCameraChanged(Oe.lng,Oe.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),(void 0).document.addEventListener("mapCameaParams",function(tt){var vt=tt.e,kt=vt.longitude,ir=vt.latitude,ur=vt.scale,Zr=vt.bearing,ln=vt.pitch;i.handleMiniCameraChanged(kt,ir,ur-1.25,Zr,ln)})):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return je.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:RO[t]?RO[t]:t}}]),e}(),BO=Lu()(wm.prototype,"config",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LO=Lu()(wm.prototype,"configService",[IO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=Lu()(wm.prototype,"coordinateSystemService",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jO=Lu()(wm.prototype,"eventEmitter",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm))||FO);function G9(e){var r=X9();return function(){var n=id()(e),i;if(r){var a=id()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return F0()(this,i)}}function X9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z9=function(e){k0()(t,e);var r=G9(t);function t(){return Ac()(this,t),r.apply(this,arguments)}return Tc()(t,[{key:"getServiceConstructor",value:function(){return W9}}]),t}(B0);function WO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function GO(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?WO(Object(t),!0).forEach(function(n){$9(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):WO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $9(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Y9(e,r){return J9(e)||Q9(e,r)||q9(e,r)||K9()}function K9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q9(e,r){if(!!e){if(typeof e=="string")return XO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return XO(e,r)}}function XO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Q9(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function J9(e){if(Array.isArray(e))return e}var eV=q.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(K.useRef)(null),c=Object(K.useState)(),p=Y9(c,2),_=p[0],x=p[1];return Object(K.useEffect)(function(){var A=new zg(GO(GO({id:l.current},i),{},{map:new Z9(n)}));return A.on("loaded",function(){x(A),a&&a(A)}),function(){A.destroy()}},[]),Object(K.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(K.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(K.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(K.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(K.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),q.a.createElement(fe.Provider,{value:_},q.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),HG=eV;function tV(e,r){return aV(e)||iV(e,r)||nV(e,r)||rV()}function rV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nV(e,r){if(!!e){if(typeof e=="string")return ZO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ZO(e,r)}}function ZO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function iV(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function aV(e){if(Array.isArray(e))return e}var WG=q.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.children,a=Object(K.useRef)(null),o=Object(K.useState)(),l=tV(o,2),c=l[0],p=l[1];return Object(K.useEffect)(function(){var _=new zg({id:a.current,map:n});return _.on("loaded",function(){p(_)}),function(){_.destroy()}},[]),q.a.createElement(fe.Provider,{value:c},q.a.createElement("div",{ref:a,className:t,style:r},c&&i))}),oV=["type","position"];function $O(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function fb(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$O(Object(t),!0).forEach(function(n){sV(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$O(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function sV(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function uV(e,r){if(e==null)return{};var t=lV(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function lV(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var GG=q.a.memo(function(r){var t=ue(),n=Object(K.useRef)(),i=r.type,a=r.position,o=uV(r,oV);return Object(K.useEffect)(function(){var l;switch(i){case"scale":l=new OI({position:a||"bottomright"});break;case"zoom":l=new PI(fb({position:a||"topright"},o));break;case"logo":l=new P2(fb({position:a||"bottomleft"},o));case"layer":l=new(void 0)(fb({position:a||"bottomleft"},o))}return n.current=l,t.addControl(l),function(){n.current=void 0,t.removeControl(l)}},[i]),Object(K.useEffect)(function(){n.current&&n.current.setPosition(a||"bottomleft")},[a]),null}),hb=C("i8i4");function YO(e,r){return pV(e)||hV(e,r)||fV(e,r)||cV()}function cV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fV(e,r){if(!!e){if(typeof e=="string")return KO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return KO(e,r)}}function KO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function hV(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function pV(e){if(Array.isArray(e))return e}var qO=K.useEffect,QO=K.useState,dV=/\B([A-Z])/g,vV=function(r){return r.replace(dV,"-$1").toLowerCase()};function XG(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=QO(),o=YO(a,2),l=o[0],c=o[1],p=ue(),_=QO(function(){return document.createElement("div")}),x=YO(_,1),A=x[0];return qO(function(){var w=new Hd({position:i});return w.onAdd=function(){if(r&&(A.className=r),t){var I=Object.keys(t).map(function(P){return"".concat(vV(P),":").concat(t[P])}).join(";");A.style.cssText=I}return A},w.onRemove=function(){},c(w),p.addControl(w),function(){p.removeControl(w)}},[]),qO(function(){l&&l.setPosition(i||"bottomleft")},[i]),Object(hb.createPortal)(n,A)}var JO=Object(K.createContext)({});function mV(){return Object(K.useContext)(JO)}var Sh=C("LvDl"),ZG=K.useEffect,gV=K.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},Sh.isEqual),$G=K.useEffect,yV=K.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},Sh.isEqual),YG=K.useEffect,_V=K.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},Sh.isEqual),bV=K.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},Sh.isEqual),xV=K.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},Sh.isEqual),KG=K.useEffect,EV=K.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},Sh.isEqual),SV=K.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},Sh.isEqual),AV=K.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},Sh.isEqual),TV=["data"];function CV(e,r){if(e==null)return{};var t=wV(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function wV(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var OV=K.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=CV(n,TV);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},Sh.isEqual),qG=K.useEffect,RV=K.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},Sh.isEqual);function MV(e,r){return kV(e)||DV(e,r)||IV(e,r)||PV()}function PV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IV(e,r){if(!!e){if(typeof e=="string")return e3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return e3(e,r)}}function e3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function DV(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function kV(e){if(Array.isArray(e))return e}var $g=K.useEffect,FV=K.useState;function ov(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,o=r.size,l=r.scale,c=r.active,p=r.select,_=r.filter,x=r.animate,A=r.options,w=r.onLayerLoaded,I=ue(),P=FV(function(){var oe;switch(e){case"polygonLayer":oe=new jy(A);break;case"lineLayer":oe=new K_(A);break;case"pointLayer":oe=new Ny(A);break;case"heatmapLayer":oe=new $4(A);break;case"rasterLayer":oe=new zy(A);break;case"imageLayer":oe=new uS(A);break;case"citybuildingLayer":oe=new y4(A);break;default:oe=new jy(A)}return oe.on("inited",function(){w&&w(oe,I)}),oe}),H=MV(P,1),W=H[0];return $g(function(){return I.addLayer(W),function(){I.removeLayer(W)}},[]),$g(function(){W.inited&&A&&W.updateLayerConfig(A)},[A==null?void 0:A.minZoom,A==null?void 0:A.maxZoom,A==null?void 0:A.visible]),$g(function(){W.inited&&(A==null?void 0:A.zIndex)&&W.setIndex(A.zIndex)},[A==null?void 0:A.zIndex]),$g(function(){W.inited&&(A==null?void 0:A.blend)&&W.setBlend(A.blend)},[A==null?void 0:A.blend]),$g(function(){I.render()}),K.createElement(JO.Provider,{value:W},K.createElement(OV,{layer:W,source:t}),l&&K.createElement(xV,{layer:W,scale:l}),n&&K.createElement(_V,{layer:W,color:n}),o&&K.createElement(AV,{layer:W,size:o}),i&&K.createElement(SV,{layer:W,shape:i}),a&&K.createElement(RV,{layer:W,style:a}),c&&K.createElement(gV,{layer:W,active:c}),p&&K.createElement(EV,{layer:W,select:p}),_&&K.createElement(bV,{layer:W,filter:_}),x&&K.createElement(yV,{layer:W,animate:x}),r.children)}var QG=K.memo(function(r){return ov("polygonLayer",r)}),JG=K.memo(function(r){return ov("lineLayer",r)}),BV=K.memo(function(r){return ov("pointLayer",r)}),LV=K.memo(function(r){return ov("heatmapLayer",r)}),eX=K.memo(function(r){return ov("rasterLayer",r)}),tX=K.memo(function(r){return ov("imageLayer",r)}),rX=K.memo(function(r){return ov("citybuildingLayer",r)}),NV=K.useEffect,nX=K.memo(function(e){var r=e.type,t=e.handler,n=mV();return NV(function(){return n.off(r,t),n.on(r,t),function(){n.off(r,t)}},[r,t]),null}),iX=K.memo(function(e){var r=[{title:"1",color:"rgb(239,243,255)"},{title:"10",color:"rgb(198,219,239)"},{title:"30",color:"rgb(158,202,225)"},{title:"50",color:"rgb(107,174,214)"},{title:"60",color:"rgb(49,130,189)"},{title:"100",color:"rgb(8,81,156)"}],t=e.items,n=t===void 0?r:t;return K.createElement("div",null,K.createElement("div",null,n.map(function(i,a){return K.createElement("div",{key:a,style:{background:i.color,height:"100%",display:"inline-block",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%",padding:5}})})),K.createElement("div",null,n.map(function(i,a){return K.createElement("div",{key:a,style:{background:"#fff",height:"100%",display:"inline-block",textAlign:"left",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%"}},i.title)})))});function l_(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?l_=function(t){return typeof t}:l_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l_(e)}function t3(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function c_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?t3(Object(t),!0).forEach(function(n){jV(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):t3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jV(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function zV(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function r3(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function UV(e,r,t){return r&&r3(e.prototype,r),t&&r3(e,t),e}function VV(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&pb(e,r)}function pb(e,r){return pb=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},pb(e,r)}function HV(e){var r=XV();return function(){var n=f_(e),i;if(r){var a=f_(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return WV(this,i)}}function WV(e,r){if(r&&(l_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GV(e)}function GV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f_(e){return f_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},f_(e)}var aX=function(e){VV(t,e);var r=HV(t);function t(n){var i;return zV(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return UV(t,[{key:"componentDidMount",value:function(){var i,a=this.props,o=a.lnglat,l=a.children,c=a.option,p=a.lngLat,_=new N_(c_(c_({},c),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));o&&_.setLnglat(o),p&&_.setLnglat(p),l&&_.setDOMContent(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,o,l,c,p,_,x=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(o=i.lnglat)===null||o===void 0?void 0:o.lat],A=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(c=l.lnglat)===null||c===void 0?void 0:c.lng,(p=this.props)===null||p===void 0||(_=p.lnglat)===null||_===void 0?void 0:_.lat],w=x.toString()!==A.toString();if(w){var I;this.popup.remove(),this.popup=new N_(c_(c_({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return K.createElement(fe.Consumer,{},function(a){return a&&(i.scene=a),Object(hb.createPortal)(i.props.children,i.el)})}}]),t}(K.PureComponent);function h_(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?h_=function(t){return typeof t}:h_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h_(e)}function ZV(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function n3(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $V(e,r,t){return r&&n3(e.prototype,r),t&&n3(e,t),e}function YV(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&db(e,r)}function db(e,r){return db=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},db(e,r)}function KV(e){var r=JV();return function(){var n=p_(e),i;if(r){var a=p_(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return qV(this,i)}}function qV(e,r){if(r&&(h_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QV(e)}function QV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function p_(e){return p_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},p_(e)}var oX=function(e){YV(t,e);var r=KV(t);function t(n){var i;return ZV(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return $V(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,o=i.children,l=i.option,c=i.onMarkerLoaded,p=new A2(l);a&&p.setLnglat(a),o&&p.setElement(this.el),this.marker=p,c&&c(p),this.scene.addMarker(p)}},{key:"componentDidUpdate",value:function(i){var a,o=(i==null?void 0:i.lnglat.toString())!==((a=this.props)===null||a===void 0?void 0:a.lnglat.toString());o&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return K.createElement(fe.Consumer,{},function(a){return a&&(i.scene=a),Object(hb.createPortal)(i.props.children,i.el)})}}]),t}(K.PureComponent),eH=K.useEffect,tH=K.memo(function(e){var r=e.type,t=e.handler,n=ue();return eH(function(){return n.on(r,t),function(){n.off(r,t)}},[r]),null}),sX=tH,rH=K.useEffect,uX=K.memo(function(r){var t=r.name,n=r.url,i=ue();return rH(function(){i.addImage(t,n)},[t,n]),null})},"6AGu":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingInSyntax=void 0;var D=C("FV85"),N=C("LKzl"),z=function(){function k(v){this._binding=v}return k.prototype.inRequestScope=function(){return this._binding.scope=D.BindingScopeEnum.Request,new N.BindingWhenOnSyntax(this._binding)},k.prototype.inSingletonScope=function(){return this._binding.scope=D.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},k.prototype.inTransientScope=function(){return this._binding.scope=D.BindingScopeEnum.Transient,new N.BindingWhenOnSyntax(this._binding)},k}();Z.BindingInSyntax=z},"6D9b":function(se,Z,C){},"6acW":function(se,Z,C){var D=C("dt0z"),N=C("gQMU");function z(k){return N(D(k).toLowerCase())}se.exports=z},"6nK8":function(se,Z,C){var D=C("dVn5"),N=C("fo6e"),z=C("dt0z"),k=C("9NmV");function v(L,U,K){return L=z(L),U=K?void 0:U,U===void 0?N(L)?k(L):D(L):L.match(U)||[]}se.exports=v},"711d":function(se,Z){function C(D){return function(N){return N==null?void 0:N[D]}}se.exports=C},"78VC":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.multiBindToService=void 0;var D=function(z){return function(k){return function(){for(var v=[],L=0;L<arguments.length;L++)v[L]=arguments[L];return v.forEach(function(U){return z.bind(U).toService(k)})}}};Z.multiBindToService=D},"7Ix3":function(se,Z){function C(D){var N=[];if(D!=null)for(var z in Object(D))N.push(z);return N}se.exports=C},"7W2i":function(se,Z,C){var D=C("SksO");function N(z,k){if(typeof k!="function"&&k!==null)throw new TypeError("Super expression must either be null or a function");z.prototype=Object.create(k&&k.prototype,{constructor:{value:z,writable:!0,configurable:!0}}),Object.defineProperty(z,"prototype",{writable:!1}),k&&D(z,k)}se.exports=N,se.exports.__esModule=!0,se.exports.default=se.exports},"7tbW":function(se,Z,C){var D=C("LGYb");function N(z){return z&&z.length?D(z):[]}se.exports=N},"88Gu":function(se,Z){var C=800,D=16,N=Date.now;function z(k){var v=0,L=0;return function(){var U=N(),K=D-(U-L);if(L=U,K>0){if(++v>=C)return arguments[0]}else v=0;return k.apply(void 0,arguments)}}se.exports=z},"9Fde":function(se,Z,C){"use strict";var D=this&&this.__awaiter||function(We,St,Je,Ft){function tr(yr){return yr instanceof Je?yr:new Je(function(Dr){Dr(yr)})}return new(Je||(Je=Promise))(function(yr,Dr){function Mr(Dt){try{He(Ft.next(Dt))}catch(Ut){Dr(Ut)}}function jt(Dt){try{He(Ft.throw(Dt))}catch(Ut){Dr(Ut)}}function He(Dt){Dt.done?yr(Dt.value):tr(Dt.value).then(Mr,jt)}He((Ft=Ft.apply(We,St||[])).next())})},N=this&&this.__generator||function(We,St){var Je={label:0,sent:function(){if(yr[0]&1)throw yr[1];return yr[1]},trys:[],ops:[]},Ft,tr,yr,Dr;return Dr={next:Mr(0),throw:Mr(1),return:Mr(2)},typeof Symbol=="function"&&(Dr[Symbol.iterator]=function(){return this}),Dr;function Mr(He){return function(Dt){return jt([He,Dt])}}function jt(He){if(Ft)throw new TypeError("Generator is already executing.");for(;Je;)try{if(Ft=1,tr&&(yr=He[0]&2?tr.return:He[0]?tr.throw||((yr=tr.return)&&yr.call(tr),0):tr.next)&&!(yr=yr.call(tr,He[1])).done)return yr;switch(tr=0,yr&&(He=[He[0]&2,yr.value]),He[0]){case 0:case 1:yr=He;break;case 4:return Je.label++,{value:He[1],done:!1};case 5:Je.label++,tr=He[1],He=[0];continue;case 7:He=Je.ops.pop(),Je.trys.pop();continue;default:if(yr=Je.trys,!(yr=yr.length>0&&yr[yr.length-1])&&(He[0]===6||He[0]===2)){Je=0;continue}if(He[0]===3&&(!yr||He[1]>yr[0]&&He[1]<yr[3])){Je.label=He[1];break}if(He[0]===6&&Je.label<yr[1]){Je.label=yr[1],yr=He;break}if(yr&&Je.label<yr[2]){Je.label=yr[2],Je.ops.push(He);break}yr[2]&&Je.ops.pop(),Je.trys.pop();continue}He=St.call(We,Je)}catch(Dt){He=[6,Dt],tr=0}finally{Ft=yr=0}if(He[0]&5)throw He[1];return{value:He[0]?He[1]:void 0,done:!0}}},z=this&&this.__spreadArray||function(We,St){for(var Je=0,Ft=St.length,tr=We.length;Je<Ft;Je++,tr++)We[tr]=St[Je];return We};Object.defineProperty(Z,"__esModule",{value:!0}),Z.Container=void 0;var k=C("LgvC"),v=C("MON2"),L=C("FV85"),U=C("xfSm"),K=C("wnjb"),q=C("h7MG"),fe=C("aPG5"),ue=C("gzZq"),rt=C("d9O0"),Ne=C("ujMp"),nt=C("HpQ9"),wt=C("AwBQ"),ht=function(){function We(St){this._appliedMiddleware=[];var Je=St||{};if(typeof Je!="object")throw new Error(""+v.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Je.defaultScope===void 0)Je.defaultScope=L.BindingScopeEnum.Transient;else if(Je.defaultScope!==L.BindingScopeEnum.Singleton&&Je.defaultScope!==L.BindingScopeEnum.Transient&&Je.defaultScope!==L.BindingScopeEnum.Request)throw new Error(""+v.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Je.autoBindInjectable===void 0)Je.autoBindInjectable=!1;else if(typeof Je.autoBindInjectable!="boolean")throw new Error(""+v.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Je.skipBaseClassChecks===void 0)Je.skipBaseClassChecks=!1;else if(typeof Je.skipBaseClassChecks!="boolean")throw new Error(""+v.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Je.autoBindInjectable,defaultScope:Je.defaultScope,skipBaseClassChecks:Je.skipBaseClassChecks},this.id=rt.id(),this._bindingDictionary=new wt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new K.MetadataReader}return We.merge=function(St,Je){for(var Ft=[],tr=2;tr<arguments.length;tr++)Ft[tr-2]=arguments[tr];var yr=new We,Dr=z([St,Je],Ft).map(function(He){return q.getBindingDictionary(He)}),Mr=q.getBindingDictionary(yr);function jt(He,Dt){He.traverse(function(Ut,Ce){Ce.forEach(function(ve){Dt.add(ve.serviceIdentifier,ve.clone())})})}return Dr.forEach(function(He){jt(He,Mr)}),yr},We.prototype.load=function(){for(var St=[],Je=0;Je<arguments.length;Je++)St[Je]=arguments[Je];for(var Ft=this._getContainerModuleHelpersFactory(),tr=0,yr=St;tr<yr.length;tr++){var Dr=yr[tr],Mr=Ft(Dr.id);Dr.registry(Mr.bindFunction,Mr.unbindFunction,Mr.isboundFunction,Mr.rebindFunction)}},We.prototype.loadAsync=function(){for(var St=[],Je=0;Je<arguments.length;Je++)St[Je]=arguments[Je];return D(this,void 0,void 0,function(){var Ft,tr,yr,Dr,Mr;return N(this,function(jt){switch(jt.label){case 0:Ft=this._getContainerModuleHelpersFactory(),tr=0,yr=St,jt.label=1;case 1:return tr<yr.length?(Dr=yr[tr],Mr=Ft(Dr.id),[4,Dr.registry(Mr.bindFunction,Mr.unbindFunction,Mr.isboundFunction,Mr.rebindFunction)]):[3,4];case 2:jt.sent(),jt.label=3;case 3:return tr++,[3,1];case 4:return[2]}})})},We.prototype.unload=function(){for(var St=this,Je=[],Ft=0;Ft<arguments.length;Ft++)Je[Ft]=arguments[Ft];var tr=function(Dr){return function(Mr){return Mr.moduleId===Dr}};Je.forEach(function(yr){var Dr=tr(yr.id);St._bindingDictionary.removeByCondition(Dr)})},We.prototype.bind=function(St){var Je=this.options.defaultScope||L.BindingScopeEnum.Transient,Ft=new k.Binding(St,Je);return this._bindingDictionary.add(St,Ft),new ue.BindingToSyntax(Ft)},We.prototype.rebind=function(St){return this.unbind(St),this.bind(St)},We.prototype.unbind=function(St){try{this._bindingDictionary.remove(St)}catch(Je){throw new Error(v.CANNOT_UNBIND+" "+Ne.getServiceIdentifierAsString(St))}},We.prototype.unbindAll=function(){this._bindingDictionary=new wt.Lookup},We.prototype.isBound=function(St){var Je=this._bindingDictionary.hasKey(St);return!Je&&this.parent&&(Je=this.parent.isBound(St)),Je},We.prototype.isBoundNamed=function(St,Je){return this.isBoundTagged(St,U.NAMED_TAG,Je)},We.prototype.isBoundTagged=function(St,Je,Ft){var tr=!1;if(this._bindingDictionary.hasKey(St)){var yr=this._bindingDictionary.get(St),Dr=q.createMockRequest(this,St,Je,Ft);tr=yr.some(function(Mr){return Mr.constraint(Dr)})}return!tr&&this.parent&&(tr=this.parent.isBoundTagged(St,Je,Ft)),tr},We.prototype.snapshot=function(){this._snapshots.push(nt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},We.prototype.restore=function(){var St=this._snapshots.pop();if(St===void 0)throw new Error(v.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=St.bindings,this._middleware=St.middleware},We.prototype.createChild=function(St){var Je=new We(St||this.options);return Je.parent=this,Je},We.prototype.applyMiddleware=function(){for(var St=[],Je=0;Je<arguments.length;Je++)St[Je]=arguments[Je];this._appliedMiddleware=this._appliedMiddleware.concat(St);var Ft=this._middleware?this._middleware:this._planAndResolve();this._middleware=St.reduce(function(tr,yr){return yr(tr)},Ft)},We.prototype.applyCustomMetadataReader=function(St){this._metadataReader=St},We.prototype.get=function(St){return this._get(!1,!1,L.TargetTypeEnum.Variable,St)},We.prototype.getTagged=function(St,Je,Ft){return this._get(!1,!1,L.TargetTypeEnum.Variable,St,Je,Ft)},We.prototype.getNamed=function(St,Je){return this.getTagged(St,U.NAMED_TAG,Je)},We.prototype.getAll=function(St){return this._get(!0,!0,L.TargetTypeEnum.Variable,St)},We.prototype.getAllTagged=function(St,Je,Ft){return this._get(!1,!0,L.TargetTypeEnum.Variable,St,Je,Ft)},We.prototype.getAllNamed=function(St,Je){return this.getAllTagged(St,U.NAMED_TAG,Je)},We.prototype.resolve=function(St){var Je=this.createChild();return Je.bind(St).toSelf(),this._appliedMiddleware.forEach(function(Ft){Je.applyMiddleware(Ft)}),Je.get(St)},We.prototype._getContainerModuleHelpersFactory=function(){var St=this,Je=function(jt,He){jt._binding.moduleId=He},Ft=function(jt){return function(He){var Dt=St.bind.bind(St),Ut=Dt(He);return Je(Ut,jt),Ut}},tr=function(jt){return function(He){var Dt=St.unbind.bind(St);Dt(He)}},yr=function(jt){return function(He){var Dt=St.isBound.bind(St);return Dt(He)}},Dr=function(jt){return function(He){var Dt=St.rebind.bind(St),Ut=Dt(He);return Je(Ut,jt),Ut}};return function(Mr){return{bindFunction:Ft(Mr),isboundFunction:yr(Mr),rebindFunction:Dr(Mr),unbindFunction:tr(Mr)}}},We.prototype._get=function(St,Je,Ft,tr,yr,Dr){var Mr=null,jt={avoidConstraints:St,contextInterceptor:function(Dt){return Dt},isMultiInject:Je,key:yr,serviceIdentifier:tr,targetType:Ft,value:Dr};if(this._middleware){if(Mr=this._middleware(jt),Mr==null)throw new Error(v.INVALID_MIDDLEWARE_RETURN)}else Mr=this._planAndResolve()(jt);return Mr},We.prototype._planAndResolve=function(){var St=this;return function(Je){var Ft=q.plan(St._metadataReader,St,Je.isMultiInject,Je.targetType,Je.serviceIdentifier,Je.key,Je.value,Je.avoidConstraints);Ft=Je.contextInterceptor(Ft);var tr=fe.resolve(Ft);return tr}},We}();Z.Container=ht},"9Nap":function(se,Z,C){var D=C("/9aa"),N=1/0;function z(k){if(typeof k=="string"||D(k))return k;var v=k+"";return v=="0"&&1/k==-N?"-0":v}se.exports=z},"9NmV":function(se,Z){var C="\\ud800-\\udfff",D="\\u0300-\\u036f",N="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",k=D+N+z,v="\\u2700-\\u27bf",L="a-z\\xdf-\\xf6\\xf8-\\xff",U="\\xac\\xb1\\xd7\\xf7",K="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",q="\\u2000-\\u206f",fe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ue="A-Z\\xc0-\\xd6\\xd8-\\xde",rt="\\ufe0e\\ufe0f",Ne=U+K+q+fe,nt="['\u2019]",wt="["+Ne+"]",ht="["+k+"]",We="\\d+",St="["+v+"]",Je="["+L+"]",Ft="[^"+C+Ne+We+v+L+ue+"]",tr="\\ud83c[\\udffb-\\udfff]",yr="(?:"+ht+"|"+tr+")",Dr="[^"+C+"]",Mr="(?:\\ud83c[\\udde6-\\uddff]){2}",jt="[\\ud800-\\udbff][\\udc00-\\udfff]",He="["+ue+"]",Dt="\\u200d",Ut="(?:"+Je+"|"+Ft+")",Ce="(?:"+He+"|"+Ft+")",ve="(?:"+nt+"(?:d|ll|m|re|s|t|ve))?",Ie="(?:"+nt+"(?:D|LL|M|RE|S|T|VE))?",zt=yr+"?",le="["+rt+"]?",Me="(?:"+Dt+"(?:"+[Dr,Mr,jt].join("|")+")"+le+zt+")*",Re="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",yt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",At=le+zt+Me,ae="(?:"+[St,Mr,jt].join("|")+")"+At,It=RegExp([He+"?"+Je+"+"+ve+"(?="+[wt,He,"$"].join("|")+")",Ce+"+"+Ie+"(?="+[wt,He+Ut,"$"].join("|")+")",He+"?"+Ut+"+"+ve,He+"+"+Ie,yt,Re,We,ae].join("|"),"g");function lr(Cr){return Cr.match(It)||[]}se.exports=lr},"9ggG":function(se,Z,C){var D=C("Z0cm"),N=C("/9aa"),z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,k=/^\w*$/;function v(L,U){if(D(L))return!1;var K=typeof L;return K=="number"||K=="symbol"||K=="boolean"||L==null||N(L)?!0:k.test(L)||!z.test(L)||U!=null&&L in Object(U)}se.exports=v},"9nhX":function(se,Z,C){var D=C("g4R6"),N=C("tLB3");function z(k,v,L){return L===void 0&&(L=v,v=void 0),L!==void 0&&(L=N(L),L=L===L?L:0),v!==void 0&&(v=N(v),v=v===v?v:0),D(N(k),v,L)}se.exports=z},APxj:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0});var D=C("Ucsi");function N(z,k){k===void 0&&(k=!0);var v=D.makePropertyInjectDecorator(z,k),L=D.makePropertyInjectNamedDecorator(z,k),U=D.makePropertyInjectTaggedDecorator(z,k),K=D.makePropertyMultiInjectDecorator(z,k);return{lazyInject:v,lazyInjectNamed:L,lazyInjectTagged:U,lazyMultiInject:K}}Z.default=N},Aib3:function(se,Z){se.exports=C;function C(z,k){var v=z&&z.type,L;if(v==="FeatureCollection")for(L=0;L<z.features.length;L++)C(z.features[L],k);else if(v==="GeometryCollection")for(L=0;L<z.geometries.length;L++)C(z.geometries[L],k);else if(v==="Feature")C(z.geometry,k);else if(v==="Polygon")D(z.coordinates,k);else if(v==="MultiPolygon")for(L=0;L<z.coordinates.length;L++)D(z.coordinates[L],k);return z}function D(z,k){if(z.length!==0){N(z[0],k);for(var v=1;v<z.length;v++)N(z[v],!k)}}function N(z,k){for(var v=0,L=0,U=0,K=z.length,q=K-1;U<K;q=U++){var fe=(z[U][0]-z[q][0])*(z[q][1]+z[U][1]),ue=v+fe;L+=Math.abs(v)>=Math.abs(fe)?v-ue+fe:fe-ue+v,v=ue}v+L>=0!=!!k&&z.reverse()}},AwBQ:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Lookup=void 0;var D=C("MON2"),N=function(){function z(){this._map=new Map}return z.prototype.getMap=function(){return this._map},z.prototype.add=function(k,v){if(k==null)throw new Error(D.NULL_ARGUMENT);if(v==null)throw new Error(D.NULL_ARGUMENT);var L=this._map.get(k);L!==void 0?(L.push(v),this._map.set(k,L)):this._map.set(k,[v])},z.prototype.get=function(k){if(k==null)throw new Error(D.NULL_ARGUMENT);var v=this._map.get(k);if(v!==void 0)return v;throw new Error(D.KEY_NOT_FOUND)},z.prototype.remove=function(k){if(k==null)throw new Error(D.NULL_ARGUMENT);if(!this._map.delete(k))throw new Error(D.KEY_NOT_FOUND)},z.prototype.removeByCondition=function(k){var v=this;this._map.forEach(function(L,U){var K=L.filter(function(q){return!k(q)});K.length>0?v._map.set(U,K):v._map.delete(U)})},z.prototype.hasKey=function(k){if(k==null)throw new Error(D.NULL_ARGUMENT);return this._map.has(k)},z.prototype.clone=function(){var k=new z;return this._map.forEach(function(v,L){v.forEach(function(U){return k.add(L,U.clone())})}),k},z.prototype.traverse=function(k){this._map.forEach(function(v,L){k(L,v)})},z}();Z.Lookup=N},"B6l+":function(se,Z,C){var D=C("Sq3C"),N=C("Z1HP"),z=C("Sxd8"),k=C("dt0z");function v(L,U,K){L=k(L),U=z(U);var q=U?N(L):0;return U&&q<U?L+D(U-q,K):L}se.exports=v},B93f:function(se,Z,C){"use strict";var D=C("DiGy");se.exports=N;function N(k,v){this.layers=k.readFields(z,{},v)}function z(k,v,L){if(k===3){var U=new D(L,L.readVarint()+L.pos);U.length&&(v[U.name]=U)}}},BkRI:function(se,Z,C){var D=C("OBhP"),N=1,z=4;function k(v){return D(v,N|z)}se.exports=k},Bnag:function(se,Z){function C(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},CZoQ:function(se,Z){function C(D,N,z){for(var k=z-1,v=D.length;++k<v;)if(D[k]===N)return k;return-1}se.exports=C},D9lx:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingInWhenOnSyntax=void 0;var D=C("6AGu"),N=C("406g"),z=C("z4Hk"),k=function(){function v(L){this._binding=L,this._bindingWhenSyntax=new z.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new N.BindingOnSyntax(this._binding),this._bindingInSyntax=new D.BindingInSyntax(L)}return v.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},v.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},v.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},v.prototype.when=function(L){return this._bindingWhenSyntax.when(L)},v.prototype.whenTargetNamed=function(L){return this._bindingWhenSyntax.whenTargetNamed(L)},v.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},v.prototype.whenTargetTagged=function(L,U){return this._bindingWhenSyntax.whenTargetTagged(L,U)},v.prototype.whenInjectedInto=function(L){return this._bindingWhenSyntax.whenInjectedInto(L)},v.prototype.whenParentNamed=function(L){return this._bindingWhenSyntax.whenParentNamed(L)},v.prototype.whenParentTagged=function(L,U){return this._bindingWhenSyntax.whenParentTagged(L,U)},v.prototype.whenAnyAncestorIs=function(L){return this._bindingWhenSyntax.whenAnyAncestorIs(L)},v.prototype.whenNoAncestorIs=function(L){return this._bindingWhenSyntax.whenNoAncestorIs(L)},v.prototype.whenAnyAncestorNamed=function(L){return this._bindingWhenSyntax.whenAnyAncestorNamed(L)},v.prototype.whenAnyAncestorTagged=function(L,U){return this._bindingWhenSyntax.whenAnyAncestorTagged(L,U)},v.prototype.whenNoAncestorNamed=function(L){return this._bindingWhenSyntax.whenNoAncestorNamed(L)},v.prototype.whenNoAncestorTagged=function(L,U){return this._bindingWhenSyntax.whenNoAncestorTagged(L,U)},v.prototype.whenAnyAncestorMatches=function(L){return this._bindingWhenSyntax.whenAnyAncestorMatches(L)},v.prototype.whenNoAncestorMatches=function(L){return this._bindingWhenSyntax.whenNoAncestorMatches(L)},v.prototype.onActivation=function(L){return this._bindingOnSyntax.onActivation(L)},v}();Z.BindingInWhenOnSyntax=k},DiGy:function(se,Z,C){"use strict";var D=C("HfwV");se.exports=N;function N(v,L){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=v,this._keys=[],this._values=[],this._features=[],v.readFields(z,this,L),this.length=this._features.length}function z(v,L,U){v===15?L.version=U.readVarint():v===1?L.name=U.readString():v===5?L.extent=U.readVarint():v===2?L._features.push(U.pos):v===3?L._keys.push(U.readString()):v===4&&L._values.push(k(U))}function k(v){for(var L=null,U=v.readVarint()+v.pos;v.pos<U;){var K=v.readVarint()>>3;L=K===1?v.readString():K===2?v.readFloat():K===3?v.readDouble():K===4?v.readVarint64():K===5?v.readVarint():K===6?v.readSVarint():K===7?v.readBoolean():null}return L}N.prototype.feature=function(v){if(v<0||v>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[v];var L=this._pbf.readVarint()+this._pbf.pos;return new D(this._pbf,L,this.extent,this._keys,this._values)}},DnfT:function(se,Z,C){},"Dw+G":function(se,Z,C){var D=C("juv8"),N=C("mTTR");function z(k,v){return k&&D(v,N(v),k)}se.exports=z},DzJC:function(se,Z,C){var D=C("sEfC"),N=C("GoyQ"),z="Expected a function";function k(v,L,U){var K=!0,q=!0;if(typeof v!="function")throw new TypeError(z);return N(U)&&(K="leading"in U?!!U.leading:K,q="trailing"in U?!!U.trailing:q),D(v,L,{leading:K,maxWait:L,trailing:q})}se.exports=k},EA7m:function(se,Z,C){var D=C("zZ0H"),N=C("Ioao"),z=C("wclG");function k(v,L){return z(N(v,L,D),v+"")}se.exports=k},EEGq:function(se,Z,C){var D=C("juv8"),N=C("oCl/");function z(k,v){return D(k,N(k),v)}se.exports=z},EbDI:function(se,Z){function C(D){if(typeof Symbol!="undefined"&&D[Symbol.iterator]!=null||D["@@iterator"]!=null)return Array.from(D)}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},Em2t:function(se,Z,C){var D=C("bahg"),N=C("quyA"),z=C("0JQy");function k(v){return N(v)?z(v):D(v)}se.exports=k},FRQA:function(se,Z,C){"use strict";var D=C("GNNt"),N=C("wEI+"),z=C("DnfT"),k=C.n(z),v=C("q1tI"),L=C.n(v),U=C("TSYQ"),K=C.n(U),q=C("jYQm"),fe=function(rt){var Ne=Object(v.useContext)(q.a),nt=rt.children,wt=rt.contentWidth,ht=rt.className,We=rt.style,St=Object(v.useContext)(N.a.ConfigContext),Je=St.getPrefixCls,Ft=rt.prefixCls||Je("pro"),tr=wt||Ne.contentWidth,yr="".concat(Ft,"-grid-content");return L.a.createElement("div",{className:K()(yr,ht,{wide:tr==="Fixed"}),style:We},L.a.createElement("div",{className:"".concat(Ft,"-grid-content-children")},nt))};Z.a=fe},FV85:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.TargetTypeEnum=Z.BindingTypeEnum=Z.BindingScopeEnum=void 0;var D={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Z.BindingScopeEnum=D;var N={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Z.BindingTypeEnum=N;var z={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Z.TargetTypeEnum=z},G6z8:function(se,Z,C){var D=C("fR/l"),N=C("oCl/"),z=C("mTTR");function k(v){return D(v,z,N)}se.exports=k},GNiM:function(se,Z,C){var D=C("I01J"),N=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,z=/\\(\\)?/g,k=D(function(v){var L=[];return v.charCodeAt(0)===46&&L.push(""),v.replace(N,function(U,K,q,fe){L.push(q?fe.replace(z,"$1"):K||U)}),L});se.exports=k},GXnB:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Metadata=void 0;var D=C("xfSm"),N=function(){function z(k,v){this.key=k,this.value=v}return z.prototype.toString=function(){return this.key===D.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},z}();Z.Metadata=N},Gi0A:function(se,Z,C){var D=C("QqLw"),N=C("ExA7"),z="[object Map]";function k(v){return N(v)&&D(v)==z}se.exports=k},HfwV:function(se,Z,C){"use strict";var D=C("xnQO");se.exports=N;function N(U,K,q,fe,ue){this.properties={},this.extent=q,this.type=0,this._pbf=U,this._geometry=-1,this._keys=fe,this._values=ue,U.readFields(z,this,K)}function z(U,K,q){U==1?K.id=q.readVarint():U==2?k(q,K):U==3?K.type=q.readVarint():U==4&&(K._geometry=q.pos)}function k(U,K){for(var q=U.readVarint()+U.pos;U.pos<q;){var fe=K._keys[U.readVarint()],ue=K._values[U.readVarint()];K.properties[fe]=ue}}N.types=["Unknown","Point","LineString","Polygon"],N.prototype.loadGeometry=function(){var U=this._pbf;U.pos=this._geometry;for(var K=U.readVarint()+U.pos,q=1,fe=0,ue=0,rt=0,Ne=[],nt;U.pos<K;){if(fe<=0){var wt=U.readVarint();q=wt&7,fe=wt>>3}if(fe--,q===1||q===2)ue+=U.readSVarint(),rt+=U.readSVarint(),q===1&&(nt&&Ne.push(nt),nt=[]),nt.push(new D(ue,rt));else if(q===7)nt&&nt.push(nt[0].clone());else throw new Error("unknown command "+q)}return nt&&Ne.push(nt),Ne},N.prototype.bbox=function(){var U=this._pbf;U.pos=this._geometry;for(var K=U.readVarint()+U.pos,q=1,fe=0,ue=0,rt=0,Ne=Infinity,nt=-Infinity,wt=Infinity,ht=-Infinity;U.pos<K;){if(fe<=0){var We=U.readVarint();q=We&7,fe=We>>3}if(fe--,q===1||q===2)ue+=U.readSVarint(),rt+=U.readSVarint(),ue<Ne&&(Ne=ue),ue>nt&&(nt=ue),rt<wt&&(wt=rt),rt>ht&&(ht=rt);else if(q!==7)throw new Error("unknown command "+q)}return[Ne,wt,nt,ht]},N.prototype.toGeoJSON=function(U,K,q){var fe=this.extent*Math.pow(2,q),ue=this.extent*U,rt=this.extent*K,Ne=this.loadGeometry(),nt=N.types[this.type],wt,ht;function We(Ft){for(var tr=0;tr<Ft.length;tr++){var yr=Ft[tr],Dr=180-(yr.y+rt)*360/fe;Ft[tr]=[(yr.x+ue)*360/fe-180,360/Math.PI*Math.atan(Math.exp(Dr*Math.PI/180))-90]}}switch(this.type){case 1:var St=[];for(wt=0;wt<Ne.length;wt++)St[wt]=Ne[wt][0];Ne=St,We(Ne);break;case 2:for(wt=0;wt<Ne.length;wt++)We(Ne[wt]);break;case 3:for(Ne=v(Ne),wt=0;wt<Ne.length;wt++)for(ht=0;ht<Ne[wt].length;ht++)We(Ne[wt][ht]);break}Ne.length===1?Ne=Ne[0]:nt="Multi"+nt;var Je={type:"Feature",geometry:{type:nt,coordinates:Ne},properties:this.properties};return"id"in this&&(Je.id=this.id),Je};function v(U){var K=U.length;if(K<=1)return[U];for(var q=[],fe,ue,rt=0;rt<K;rt++){var Ne=L(U[rt]);Ne!==0&&(ue===void 0&&(ue=Ne<0),ue===Ne<0?(fe&&q.push(fe),fe=[U[rt]]):fe.push(U[rt]))}return fe&&q.push(fe),q}function L(U){for(var K=0,q=0,fe=U.length,ue=fe-1,rt,Ne;q<fe;ue=q++)rt=U[q],Ne=U[ue],K+=(Ne.x-rt.x)*(rt.y+Ne.y);return K}},HpQ9:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.ContainerSnapshot=void 0;var D=function(){function N(){}return N.of=function(z,k){var v=new N;return v.bindings=z,v.middleware=k,v},N}();Z.ContainerSnapshot=D},I01J:function(se,Z,C){var D=C("44Ds"),N=500;function z(k){var v=D(k,function(U){return L.size===N&&L.clear(),U}),L=v.cache;return v}se.exports=z},Ijbi:function(se,Z,C){var D=C("WkPL");function N(z){if(Array.isArray(z))return D(z)}se.exports=N,se.exports.__esModule=!0,se.exports.default=se.exports},Ioao:function(se,Z,C){var D=C("heNW"),N=Math.max;function z(k,v,L){return v=N(v===void 0?k.length-1:v,0),function(){for(var U=arguments,K=-1,q=N(U.length-v,0),fe=Array(q);++K<q;)fe[K]=U[v+K];K=-1;for(var ue=Array(v+1);++K<v;)ue[K]=U[K];return ue[v]=L(fe),D(k,this,ue)}}se.exports=z},J2iB:function(se,Z){function C(D){return D==null}se.exports=C},JBE3:function(se,Z,C){var D=C("+Qka"),N=C("LsHQ"),z=N(function(k,v,L,U){D(k,v,L,U)});se.exports=z},KwMD:function(se,Z){function C(D,N,z,k){for(var v=D.length,L=z+(k?1:-1);k?L--:++L<v;)if(N(D[L],L,D))return L;return-1}se.exports=C},KxBF:function(se,Z){function C(D,N,z){var k=-1,v=D.length;N<0&&(N=-N>v?0:v+N),z=z>v?v:z,z<0&&(z+=v),v=N>z?0:z-N>>>0,N>>>=0;for(var L=Array(v);++k<v;)L[k]=D[k+N];return L}se.exports=C},LGYb:function(se,Z,C){var D=C("1hJj"),N=C("jbM+"),z=C("Xt/L"),k=C("xYSL"),v=C("dQpi"),L=C("rEGp"),U=200;function K(q,fe,ue){var rt=-1,Ne=N,nt=q.length,wt=!0,ht=[],We=ht;if(ue)wt=!1,Ne=z;else if(nt>=U){var St=fe?null:v(q);if(St)return L(St);wt=!1,Ne=k,We=new D}else We=fe?[]:ht;e:for(;++rt<nt;){var Je=q[rt],Ft=fe?fe(Je):Je;if(Je=ue||Je!==0?Je:0,wt&&Ft===Ft){for(var tr=We.length;tr--;)if(We[tr]===Ft)continue e;fe&&We.push(Ft),ht.push(Je)}else Ne(We,Ft,ue)||(We!==ht&&We.push(Ft),ht.push(Je))}return ht}se.exports=K},LKzl:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingWhenOnSyntax=void 0;var D=C("406g"),N=C("z4Hk"),z=function(){function k(v){this._binding=v,this._bindingWhenSyntax=new N.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new D.BindingOnSyntax(this._binding)}return k.prototype.when=function(v){return this._bindingWhenSyntax.when(v)},k.prototype.whenTargetNamed=function(v){return this._bindingWhenSyntax.whenTargetNamed(v)},k.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},k.prototype.whenTargetTagged=function(v,L){return this._bindingWhenSyntax.whenTargetTagged(v,L)},k.prototype.whenInjectedInto=function(v){return this._bindingWhenSyntax.whenInjectedInto(v)},k.prototype.whenParentNamed=function(v){return this._bindingWhenSyntax.whenParentNamed(v)},k.prototype.whenParentTagged=function(v,L){return this._bindingWhenSyntax.whenParentTagged(v,L)},k.prototype.whenAnyAncestorIs=function(v){return this._bindingWhenSyntax.whenAnyAncestorIs(v)},k.prototype.whenNoAncestorIs=function(v){return this._bindingWhenSyntax.whenNoAncestorIs(v)},k.prototype.whenAnyAncestorNamed=function(v){return this._bindingWhenSyntax.whenAnyAncestorNamed(v)},k.prototype.whenAnyAncestorTagged=function(v,L){return this._bindingWhenSyntax.whenAnyAncestorTagged(v,L)},k.prototype.whenNoAncestorNamed=function(v){return this._bindingWhenSyntax.whenNoAncestorNamed(v)},k.prototype.whenNoAncestorTagged=function(v,L){return this._bindingWhenSyntax.whenNoAncestorTagged(v,L)},k.prototype.whenAnyAncestorMatches=function(v){return this._bindingWhenSyntax.whenAnyAncestorMatches(v)},k.prototype.whenNoAncestorMatches=function(v){return this._bindingWhenSyntax.whenNoAncestorMatches(v)},k.prototype.onActivation=function(v){return this._bindingOnSyntax.onActivation(v)},k}();Z.BindingWhenOnSyntax=z},LcsW:function(se,Z,C){var D=C("kekF"),N=D(Object.getPrototypeOf,Object);se.exports=N},LgvC:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Binding=void 0;var D=C("FV85"),N=C("d9O0"),z=function(){function k(v,L){this.id=N.id(),this.activated=!1,this.serviceIdentifier=v,this.scope=L,this.type=D.BindingTypeEnum.Invalid,this.constraint=function(U){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return k.prototype.clone=function(){var v=new k(this.serviceIdentifier,this.scope);return v.activated=v.scope===D.BindingScopeEnum.Singleton?this.activated:!1,v.implementationType=this.implementationType,v.dynamicValue=this.dynamicValue,v.scope=this.scope,v.type=this.type,v.factory=this.factory,v.provider=this.provider,v.constraint=this.constraint,v.onActivation=this.onActivation,v.cache=this.cache,v},k}();Z.Binding=z},LsHQ:function(se,Z,C){var D=C("EA7m"),N=C("mv/X");function z(k){return D(function(v,L){var U=-1,K=L.length,q=K>1?L[K-1]:void 0,fe=K>2?L[2]:void 0;for(q=k.length>3&&typeof q=="function"?(K--,q):void 0,fe&&N(L[0],L[1],fe)&&(q=K<3?void 0:q,K=1),v=Object(v);++U<K;){var ue=L[U];ue&&k(v,ue,U,q)}return v})}se.exports=z},MON2:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.STACK_OVERFLOW=Z.CIRCULAR_DEPENDENCY_IN_FACTORY=Z.POST_CONSTRUCT_ERROR=Z.MULTIPLE_POST_CONSTRUCT_METHODS=Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Z.ARGUMENTS_LENGTH_MISMATCH=Z.INVALID_DECORATOR_OPERATION=Z.INVALID_TO_SELF_VALUE=Z.INVALID_FUNCTION_BINDING=Z.INVALID_MIDDLEWARE_RETURN=Z.NO_MORE_SNAPSHOTS_AVAILABLE=Z.INVALID_BINDING_TYPE=Z.NOT_IMPLEMENTED=Z.CIRCULAR_DEPENDENCY=Z.UNDEFINED_INJECT_ANNOTATION=Z.MISSING_INJECT_ANNOTATION=Z.MISSING_INJECTABLE_ANNOTATION=Z.NOT_REGISTERED=Z.CANNOT_UNBIND=Z.AMBIGUOUS_MATCH=Z.KEY_NOT_FOUND=Z.NULL_ARGUMENT=Z.DUPLICATED_METADATA=Z.DUPLICATED_INJECTABLE_DECORATOR=void 0,Z.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Z.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Z.NULL_ARGUMENT="NULL argument",Z.KEY_NOT_FOUND="Key Not Found",Z.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Z.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Z.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Z.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Z.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var D=function(L){return"@inject called with undefined this could mean that the class "+L+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Z.UNDEFINED_INJECT_ANNOTATION=D,Z.CIRCULAR_DEPENDENCY="Circular dependency found:",Z.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Z.INVALID_BINDING_TYPE="Invalid binding type:",Z.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Z.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Z.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Z.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Z.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var N=function(){for(var L=[],U=0;U<arguments.length;U++)L[U]=arguments[U];return"The number of constructor arguments in the derived class "+(L[0]+" must be >= than the number of constructor arguments of its base class.")};Z.ARGUMENTS_LENGTH_MISMATCH=N,Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Z.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var z=function(){for(var L=[],U=0;U<arguments.length;U++)L[U]=arguments[U];return"@postConstruct error in class "+L[0]+": "+L[1]};Z.POST_CONSTRUCT_ERROR=z;var k=function(){for(var L=[],U=0;U<arguments.length;U++)L[U]=arguments[U];return"It looks like there is a circular dependency "+("in one of the '"+L[0]+"' bindings. Please investigate bindings with")+("service identifier '"+L[1]+"'.")};Z.CIRCULAR_DEPENDENCY_IN_FACTORY=k,Z.STACK_OVERFLOW="Maximum call stack size exceeded"},MrPd:function(se,Z,C){var D=C("hypo"),N=C("ljhN"),z=Object.prototype,k=z.hasOwnProperty;function v(L,U,K){var q=L[U];(!(k.call(L,U)&&N(q,K))||K===void 0&&!(U in L))&&D(L,U,K)}se.exports=v},Nsbk:function(se,Z){function C(D){return se.exports=C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(z){return z.__proto__||Object.getPrototypeOf(z)},se.exports.__esModule=!0,se.exports.default=se.exports,C(D)}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},O0oS:function(se,Z,C){var D=C("Cwc5"),N=function(){try{var z=D(Object,"defineProperty");return z({},"",{}),z}catch(k){}}();se.exports=N},OBhP:function(se,Z,C){var D=C("fmRc"),N=C("gFfm"),z=C("MrPd"),k=C("WwFo"),v=C("Dw+G"),L=C("5Tg0"),U=C("Q1l4"),K=C("VOtZ"),q=C("EEGq"),fe=C("qZTm"),ue=C("G6z8"),rt=C("QqLw"),Ne=C("yHx3"),nt=C("wrZu"),wt=C("+iFO"),ht=C("Z0cm"),We=C("DSRE"),St=C("zEVN"),Je=C("GoyQ"),Ft=C("1+5i"),tr=C("7GkX"),yr=C("mTTR"),Dr=1,Mr=2,jt=4,He="[object Arguments]",Dt="[object Array]",Ut="[object Boolean]",Ce="[object Date]",ve="[object Error]",Ie="[object Function]",zt="[object GeneratorFunction]",le="[object Map]",Me="[object Number]",Re="[object Object]",yt="[object RegExp]",At="[object Set]",ae="[object String]",It="[object Symbol]",lr="[object WeakMap]",Cr="[object ArrayBuffer]",Br="[object DataView]",pn="[object Float32Array]",Fr="[object Float64Array]",Pn="[object Int8Array]",ni="[object Int16Array]",Nn="[object Int32Array]",Kn="[object Uint8Array]",Yn="[object Uint8ClampedArray]",Ar="[object Uint16Array]",mr="[object Uint32Array]",Xt={};Xt[He]=Xt[Dt]=Xt[Cr]=Xt[Br]=Xt[Ut]=Xt[Ce]=Xt[pn]=Xt[Fr]=Xt[Pn]=Xt[ni]=Xt[Nn]=Xt[le]=Xt[Me]=Xt[Re]=Xt[yt]=Xt[At]=Xt[ae]=Xt[It]=Xt[Kn]=Xt[Yn]=Xt[Ar]=Xt[mr]=!0,Xt[ve]=Xt[Ie]=Xt[lr]=!1;function Wt(Ir,Ue,he,ie,B,Ae){var Xe,bt=Ue&Dr,Gt=Ue&Mr,sr=Ue&jt;if(he&&(Xe=B?he(Ir,ie,B,Ae):he(Ir)),Xe!==void 0)return Xe;if(!Je(Ir))return Ir;var at=ht(Ir);if(at){if(Xe=Ne(Ir),!bt)return U(Ir,Xe)}else{var Ot=rt(Ir),or=Ot==Ie||Ot==zt;if(We(Ir))return L(Ir,bt);if(Ot==Re||Ot==He||or&&!B){if(Xe=Gt||or?{}:wt(Ir),!bt)return Gt?q(Ir,v(Xe,Ir)):K(Ir,k(Xe,Ir))}else{if(!Xt[Ot])return B?Ir:{};Xe=nt(Ir,Ot,bt)}}Ae||(Ae=new D);var Tr=Ae.get(Ir);if(Tr)return Tr;Ae.set(Ir,Xe),Ft(Ir)?Ir.forEach(function(Jr){Xe.add(Wt(Jr,Ue,he,Jr,Ir,Ae))}):St(Ir)&&Ir.forEach(function(Jr,xn){Xe.set(xn,Wt(Jr,Ue,he,xn,Ir,Ae))});var Or=sr?Gt?ue:fe:Gt?yr:tr,jn=at?void 0:Or(Ir);return N(jn||Ir,function(Jr,xn){jn&&(xn=Jr,Jr=Ir[xn]),z(Xe,xn,Wt(Jr,Ue,he,xn,Ir,Ae))}),Xe}se.exports=Wt},PJYZ:function(se,Z){function C(D){if(D===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return D}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},Q1l4:function(se,Z){function C(D,N){var z=-1,k=D.length;for(N||(N=Array(k));++z<k;)N[z]=D[z];return N}se.exports=C},"QQZ/":function(se,Z,C){var D=C("Sq3C"),N=C("Z1HP"),z=C("Sxd8"),k=C("dt0z");function v(L,U,K){L=k(L),U=z(U);var q=U?N(L):0;return U&&q<U?D(U-q,K)+L:L}se.exports=v},QcOe:function(se,Z,C){var D=C("GoyQ"),N=C("6sVZ"),z=C("7Ix3"),k=Object.prototype,v=k.hasOwnProperty;function L(U){if(!D(U))return z(U);var K=N(U),q=[];for(var fe in U)fe=="constructor"&&(K||!v.call(U,fe))||q.push(fe);return q}se.exports=L},QkVN:function(se,Z,C){var D=C("+Qka"),N=C("LsHQ"),z=N(function(k,v,L){D(k,v,L)});se.exports=z},"R/W3":function(se,Z,C){var D=C("KwMD"),N=C("2ajD"),z=C("CZoQ");function k(v,L,U){return L===L?z(v,L,U):D(v,N,U)}se.exports=k},RIqP:function(se,Z,C){var D=C("Ijbi"),N=C("EbDI"),z=C("ZhPi"),k=C("Bnag");function v(L){return D(L)||N(L)||z(L)||k()}se.exports=v,se.exports.__esModule=!0,se.exports.default=se.exports},"RR/i":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.typeConstraint=Z.namedConstraint=Z.taggedConstraint=Z.traverseAncerstors=void 0;var D=C("xfSm"),N=C("GXnB"),z=function U(K,q){var fe=K.parentRequest;return fe!==null?q(fe)?!0:U(fe,q):!1};Z.traverseAncerstors=z;var k=function(K){return function(q){var fe=function(rt){return rt!==null&&rt.target!==null&&rt.target.matchesTag(K)(q)};return fe.metaData=new N.Metadata(K,q),fe}};Z.taggedConstraint=k;var v=k(D.NAMED_TAG);Z.namedConstraint=v;var L=function(K){return function(q){var fe=null;if(q!==null)if(fe=q.bindings[0],typeof K=="string"){var ue=fe.serviceIdentifier;return ue===K}else{var rt=q.bindings[0].implementationType;return K===rt}return!1}};Z.typeConstraint=L},Sk89:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.postConstruct=void 0;var D=C("MON2"),N=C("xfSm"),z=C("GXnB");function k(){return function(v,L,U){var K=new z.Metadata(N.POST_CONSTRUCT,L);if(Reflect.hasOwnMetadata(N.POST_CONSTRUCT,v.constructor))throw new Error(D.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(N.POST_CONSTRUCT,K,v.constructor)}}Z.postConstruct=k},SksO:function(se,Z){function C(D,N){return se.exports=C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(k,v){return k.__proto__=v,k},se.exports.__esModule=!0,se.exports.default=se.exports,C(D,N)}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},Sq3C:function(se,Z,C){var D=C("sKgW"),N=C("zoYe"),z=C("wy8a"),k=C("quyA"),v=C("Z1HP"),L=C("Em2t"),U=Math.ceil;function K(q,fe){fe=fe===void 0?" ":N(fe);var ue=fe.length;if(ue<2)return ue?D(fe,q):fe;var rt=D(fe,U(q/v(fe)));return k(fe)?z(L(rt),0,q).join(""):rt.slice(0,q)}se.exports=K},Sxd8:function(se,Z,C){var D=C("ZCgT");function N(z){var k=D(z),v=k%1;return k===k?v?k-v:k:0}se.exports=N},T1AV:function(se,Z,C){var D=C("t2Dn"),N=C("5Tg0"),z=C("yP5f"),k=C("Q1l4"),v=C("+iFO"),L=C("03A+"),U=C("Z0cm"),K=C("3L66"),q=C("DSRE"),fe=C("lSCD"),ue=C("GoyQ"),rt=C("YO3V"),Ne=C("c6wG"),nt=C("itsj"),wt=C("jeLo");function ht(We,St,Je,Ft,tr,yr,Dr){var Mr=nt(We,Je),jt=nt(St,Je),He=Dr.get(jt);if(He){D(We,Je,He);return}var Dt=yr?yr(Mr,jt,Je+"",We,St,Dr):void 0,Ut=Dt===void 0;if(Ut){var Ce=U(jt),ve=!Ce&&q(jt),Ie=!Ce&&!ve&&Ne(jt);Dt=jt,Ce||ve||Ie?U(Mr)?Dt=Mr:K(Mr)?Dt=k(Mr):ve?(Ut=!1,Dt=N(jt,!0)):Ie?(Ut=!1,Dt=z(jt,!0)):Dt=[]:rt(jt)||L(jt)?(Dt=Mr,L(Mr)?Dt=wt(Mr):(!ue(Mr)||fe(Mr))&&(Dt=v(jt))):Ut=!1}Ut&&(Dr.set(jt,Dt),tr(Dt,jt,Ft,yr,Dr),Dr.delete(jt)),D(We,Je,Dt)}se.exports=ht},TKrE:function(se,Z,C){var D=C("qRkn"),N=C("dt0z"),z=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,k="\\u0300-\\u036f",v="\\ufe20-\\ufe2f",L="\\u20d0-\\u20ff",U=k+v+L,K="["+U+"]",q=RegExp(K,"g");function fe(ue){return ue=N(ue),ue&&ue.replace(z,D).replace(q,"")}se.exports=fe},TP7S:function(se,Z){function C(D){return D===void 0}se.exports=C},"U+yc":function(se,Z){function C(D,N,z,k,v){var L={};return Object.keys(k).forEach(function(U){L[U]=k[U]}),L.enumerable=!!L.enumerable,L.configurable=!!L.configurable,("value"in L||L.initializer)&&(L.writable=!0),L=z.slice().reverse().reduce(function(U,K){return K(D,N,U)||U},L),v&&L.initializer!==void 0&&(L.value=L.initializer?L.initializer.call(v):void 0,L.initializer=void 0),L.initializer===void 0&&(Object.defineProperty(D,N,L),L=null),L}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},UB5X:function(se,Z,C){var D=C("NykK"),N=C("ExA7"),z="[object Number]";function k(v){return typeof v=="number"||N(v)&&D(v)==z}se.exports=k},Ucsi:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0});var D=Symbol.for("INJECTION");function N(U,K,q,fe){function ue(){return fe&&!Reflect.hasMetadata(D,this,K)&&Reflect.defineMetadata(D,q(),this,K),Reflect.hasMetadata(D,this,K)?Reflect.getMetadata(D,this,K):q()}function rt(Ne){Reflect.defineMetadata(D,Ne,this,K)}Object.defineProperty(U,K,{configurable:!0,enumerable:!0,get:ue,set:rt})}function z(U,K){return function(q){return function(fe,ue){var rt=function(){return U.get(q)};N(fe,ue,rt,K)}}}Z.makePropertyInjectDecorator=z;function k(U,K){return function(q,fe){return function(ue,rt){var Ne=function(){return U.getNamed(q,fe)};N(ue,rt,Ne,K)}}}Z.makePropertyInjectNamedDecorator=k;function v(U,K){return function(q,fe,ue){return function(rt,Ne){var nt=function(){return U.getTagged(q,fe,ue)};N(rt,Ne,nt,K)}}}Z.makePropertyInjectTaggedDecorator=v;function L(U,K){return function(q){return function(fe,ue){var rt=function(){return U.getAll(q)};N(fe,ue,rt,K)}}}Z.makePropertyMultiInjectDecorator=L},VOtZ:function(se,Z,C){var D=C("juv8"),N=C("MvSz");function z(k,v){return D(k,N(k),v)}se.exports=z},VmRL:function(se,Z,C){"use strict";se.exports=D,se.exports.default=D;function D(le,Me,Re){Re=Re||2;var yt=Me&&Me.length,At=yt?Me[0]*Re:le.length,ae=N(le,0,At,Re,!0),It=[];if(!ae||ae.next===ae.prev)return It;var lr,Cr,Br,pn,Fr,Pn,ni;if(yt&&(ae=q(le,Me,ae,Re)),le.length>80*Re){lr=Br=le[0],Cr=pn=le[1];for(var Nn=Re;Nn<At;Nn+=Re)Fr=le[Nn],Pn=le[Nn+1],Fr<lr&&(lr=Fr),Pn<Cr&&(Cr=Pn),Fr>Br&&(Br=Fr),Pn>pn&&(pn=Pn);ni=Math.max(Br-lr,pn-Cr),ni=ni!==0?32767/ni:0}return k(ae,It,Re,lr,Cr,ni,0),It}function N(le,Me,Re,yt,At){var ae,It;if(At===zt(le,Me,Re,yt)>0)for(ae=Me;ae<Re;ae+=yt)It=Ce(ae,le[ae],le[ae+1],It);else for(ae=Re-yt;ae>=Me;ae-=yt)It=Ce(ae,le[ae],le[ae+1],It);return It&&tr(It,It.next)&&(ve(It),It=It.next),It}function z(le,Me){if(!le)return le;Me||(Me=le);var Re=le,yt;do if(yt=!1,!Re.steiner&&(tr(Re,Re.next)||Ft(Re.prev,Re,Re.next)===0)){if(ve(Re),Re=Me=Re.prev,Re===Re.next)break;yt=!0}else Re=Re.next;while(yt||Re!==Me);return Me}function k(le,Me,Re,yt,At,ae,It){if(!!le){!It&&ae&&nt(le,yt,At,ae);for(var lr=le,Cr,Br;le.prev!==le.next;){if(Cr=le.prev,Br=le.next,ae?L(le,yt,At,ae):v(le)){Me.push(Cr.i/Re|0),Me.push(le.i/Re|0),Me.push(Br.i/Re|0),ve(le),le=Br.next,lr=Br.next;continue}if(le=Br,le===lr){It?It===1?(le=U(z(le),Me,Re),k(le,Me,Re,yt,At,ae,2)):It===2&&K(le,Me,Re,yt,At,ae):k(z(le),Me,Re,yt,At,ae,1);break}}}}function v(le){var Me=le.prev,Re=le,yt=le.next;if(Ft(Me,Re,yt)>=0)return!1;for(var At=Me.x,ae=Re.x,It=yt.x,lr=Me.y,Cr=Re.y,Br=yt.y,pn=At<ae?At<It?At:It:ae<It?ae:It,Fr=lr<Cr?lr<Br?lr:Br:Cr<Br?Cr:Br,Pn=At>ae?At>It?At:It:ae>It?ae:It,ni=lr>Cr?lr>Br?lr:Br:Cr>Br?Cr:Br,Nn=yt.next;Nn!==Me;){if(Nn.x>=pn&&Nn.x<=Pn&&Nn.y>=Fr&&Nn.y<=ni&&St(At,lr,ae,Cr,It,Br,Nn.x,Nn.y)&&Ft(Nn.prev,Nn,Nn.next)>=0)return!1;Nn=Nn.next}return!0}function L(le,Me,Re,yt){var At=le.prev,ae=le,It=le.next;if(Ft(At,ae,It)>=0)return!1;for(var lr=At.x,Cr=ae.x,Br=It.x,pn=At.y,Fr=ae.y,Pn=It.y,ni=lr<Cr?lr<Br?lr:Br:Cr<Br?Cr:Br,Nn=pn<Fr?pn<Pn?pn:Pn:Fr<Pn?Fr:Pn,Kn=lr>Cr?lr>Br?lr:Br:Cr>Br?Cr:Br,Yn=pn>Fr?pn>Pn?pn:Pn:Fr>Pn?Fr:Pn,Ar=ht(ni,Nn,Me,Re,yt),mr=ht(Kn,Yn,Me,Re,yt),Xt=le.prevZ,Wt=le.nextZ;Xt&&Xt.z>=Ar&&Wt&&Wt.z<=mr;){if(Xt.x>=ni&&Xt.x<=Kn&&Xt.y>=Nn&&Xt.y<=Yn&&Xt!==At&&Xt!==It&&St(lr,pn,Cr,Fr,Br,Pn,Xt.x,Xt.y)&&Ft(Xt.prev,Xt,Xt.next)>=0||(Xt=Xt.prevZ,Wt.x>=ni&&Wt.x<=Kn&&Wt.y>=Nn&&Wt.y<=Yn&&Wt!==At&&Wt!==It&&St(lr,pn,Cr,Fr,Br,Pn,Wt.x,Wt.y)&&Ft(Wt.prev,Wt,Wt.next)>=0))return!1;Wt=Wt.nextZ}for(;Xt&&Xt.z>=Ar;){if(Xt.x>=ni&&Xt.x<=Kn&&Xt.y>=Nn&&Xt.y<=Yn&&Xt!==At&&Xt!==It&&St(lr,pn,Cr,Fr,Br,Pn,Xt.x,Xt.y)&&Ft(Xt.prev,Xt,Xt.next)>=0)return!1;Xt=Xt.prevZ}for(;Wt&&Wt.z<=mr;){if(Wt.x>=ni&&Wt.x<=Kn&&Wt.y>=Nn&&Wt.y<=Yn&&Wt!==At&&Wt!==It&&St(lr,pn,Cr,Fr,Br,Pn,Wt.x,Wt.y)&&Ft(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.nextZ}return!0}function U(le,Me,Re){var yt=le;do{var At=yt.prev,ae=yt.next.next;!tr(At,ae)&&yr(At,yt,yt.next,ae)&&He(At,ae)&&He(ae,At)&&(Me.push(At.i/Re|0),Me.push(yt.i/Re|0),Me.push(ae.i/Re|0),ve(yt),ve(yt.next),yt=le=ae),yt=yt.next}while(yt!==le);return z(yt)}function K(le,Me,Re,yt,At,ae){var It=le;do{for(var lr=It.next.next;lr!==It.prev;){if(It.i!==lr.i&&Je(It,lr)){var Cr=Ut(It,lr);It=z(It,It.next),Cr=z(Cr,Cr.next),k(It,Me,Re,yt,At,ae,0),k(Cr,Me,Re,yt,At,ae,0);return}lr=lr.next}It=It.next}while(It!==le)}function q(le,Me,Re,yt){var At=[],ae,It,lr,Cr,Br;for(ae=0,It=Me.length;ae<It;ae++)lr=Me[ae]*yt,Cr=ae<It-1?Me[ae+1]*yt:le.length,Br=N(le,lr,Cr,yt,!1),Br===Br.next&&(Br.steiner=!0),At.push(We(Br));for(At.sort(fe),ae=0;ae<At.length;ae++)Re=ue(At[ae],Re);return Re}function fe(le,Me){return le.x-Me.x}function ue(le,Me){var Re=rt(le,Me);if(!Re)return Me;var yt=Ut(Re,le);return z(yt,yt.next),z(Re,Re.next)}function rt(le,Me){var Re=Me,yt=le.x,At=le.y,ae=-Infinity,It;do{if(At<=Re.y&&At>=Re.next.y&&Re.next.y!==Re.y){var lr=Re.x+(At-Re.y)*(Re.next.x-Re.x)/(Re.next.y-Re.y);if(lr<=yt&&lr>ae&&(ae=lr,It=Re.x<Re.next.x?Re:Re.next,lr===yt))return It}Re=Re.next}while(Re!==Me);if(!It)return null;var Cr=It,Br=It.x,pn=It.y,Fr=Infinity,Pn;Re=It;do yt>=Re.x&&Re.x>=Br&&yt!==Re.x&&St(At<pn?yt:ae,At,Br,pn,At<pn?ae:yt,At,Re.x,Re.y)&&(Pn=Math.abs(At-Re.y)/(yt-Re.x),He(Re,le)&&(Pn<Fr||Pn===Fr&&(Re.x>It.x||Re.x===It.x&&Ne(It,Re)))&&(It=Re,Fr=Pn)),Re=Re.next;while(Re!==Cr);return It}function Ne(le,Me){return Ft(le.prev,le,Me.prev)<0&&Ft(Me.next,le,le.next)<0}function nt(le,Me,Re,yt){var At=le;do At.z===0&&(At.z=ht(At.x,At.y,Me,Re,yt)),At.prevZ=At.prev,At.nextZ=At.next,At=At.next;while(At!==le);At.prevZ.nextZ=null,At.prevZ=null,wt(At)}function wt(le){var Me,Re,yt,At,ae,It,lr,Cr,Br=1;do{for(Re=le,le=null,ae=null,It=0;Re;){for(It++,yt=Re,lr=0,Me=0;Me<Br&&(lr++,yt=yt.nextZ,!!yt);Me++);for(Cr=Br;lr>0||Cr>0&&yt;)lr!==0&&(Cr===0||!yt||Re.z<=yt.z)?(At=Re,Re=Re.nextZ,lr--):(At=yt,yt=yt.nextZ,Cr--),ae?ae.nextZ=At:le=At,At.prevZ=ae,ae=At;Re=yt}ae.nextZ=null,Br*=2}while(It>1);return le}function ht(le,Me,Re,yt,At){return le=(le-Re)*At|0,Me=(Me-yt)*At|0,le=(le|le<<8)&16711935,le=(le|le<<4)&252645135,le=(le|le<<2)&858993459,le=(le|le<<1)&1431655765,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,le|Me<<1}function We(le){var Me=le,Re=le;do(Me.x<Re.x||Me.x===Re.x&&Me.y<Re.y)&&(Re=Me),Me=Me.next;while(Me!==le);return Re}function St(le,Me,Re,yt,At,ae,It,lr){return(At-It)*(Me-lr)>=(le-It)*(ae-lr)&&(le-It)*(yt-lr)>=(Re-It)*(Me-lr)&&(Re-It)*(ae-lr)>=(At-It)*(yt-lr)}function Je(le,Me){return le.next.i!==Me.i&&le.prev.i!==Me.i&&!jt(le,Me)&&(He(le,Me)&&He(Me,le)&&Dt(le,Me)&&(Ft(le.prev,le,Me.prev)||Ft(le,Me.prev,Me))||tr(le,Me)&&Ft(le.prev,le,le.next)>0&&Ft(Me.prev,Me,Me.next)>0)}function Ft(le,Me,Re){return(Me.y-le.y)*(Re.x-Me.x)-(Me.x-le.x)*(Re.y-Me.y)}function tr(le,Me){return le.x===Me.x&&le.y===Me.y}function yr(le,Me,Re,yt){var At=Mr(Ft(le,Me,Re)),ae=Mr(Ft(le,Me,yt)),It=Mr(Ft(Re,yt,le)),lr=Mr(Ft(Re,yt,Me));return!!(At!==ae&&It!==lr||At===0&&Dr(le,Re,Me)||ae===0&&Dr(le,yt,Me)||It===0&&Dr(Re,le,yt)||lr===0&&Dr(Re,Me,yt))}function Dr(le,Me,Re){return Me.x<=Math.max(le.x,Re.x)&&Me.x>=Math.min(le.x,Re.x)&&Me.y<=Math.max(le.y,Re.y)&&Me.y>=Math.min(le.y,Re.y)}function Mr(le){return le>0?1:le<0?-1:0}function jt(le,Me){var Re=le;do{if(Re.i!==le.i&&Re.next.i!==le.i&&Re.i!==Me.i&&Re.next.i!==Me.i&&yr(Re,Re.next,le,Me))return!0;Re=Re.next}while(Re!==le);return!1}function He(le,Me){return Ft(le.prev,le,le.next)<0?Ft(le,Me,le.next)>=0&&Ft(le,le.prev,Me)>=0:Ft(le,Me,le.prev)<0||Ft(le,le.next,Me)<0}function Dt(le,Me){var Re=le,yt=!1,At=(le.x+Me.x)/2,ae=(le.y+Me.y)/2;do Re.y>ae!=Re.next.y>ae&&Re.next.y!==Re.y&&At<(Re.next.x-Re.x)*(ae-Re.y)/(Re.next.y-Re.y)+Re.x&&(yt=!yt),Re=Re.next;while(Re!==le);return yt}function Ut(le,Me){var Re=new Ie(le.i,le.x,le.y),yt=new Ie(Me.i,Me.x,Me.y),At=le.next,ae=Me.prev;return le.next=Me,Me.prev=le,Re.next=At,At.prev=Re,yt.next=Re,Re.prev=yt,ae.next=yt,yt.prev=ae,yt}function Ce(le,Me,Re,yt){var At=new Ie(le,Me,Re);return yt?(At.next=yt.next,At.prev=yt,yt.next.prev=At,yt.next=At):(At.prev=At,At.next=At),At}function ve(le){le.next.prev=le.prev,le.prev.next=le.next,le.prevZ&&(le.prevZ.nextZ=le.nextZ),le.nextZ&&(le.nextZ.prevZ=le.prevZ)}function Ie(le,Me,Re){this.i=le,this.x=Me,this.y=Re,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}D.deviation=function(le,Me,Re,yt){var At=Me&&Me.length,ae=At?Me[0]*Re:le.length,It=Math.abs(zt(le,0,ae,Re));if(At)for(var lr=0,Cr=Me.length;lr<Cr;lr++){var Br=Me[lr]*Re,pn=lr<Cr-1?Me[lr+1]*Re:le.length;It-=Math.abs(zt(le,Br,pn,Re))}var Fr=0;for(lr=0;lr<yt.length;lr+=3){var Pn=yt[lr]*Re,ni=yt[lr+1]*Re,Nn=yt[lr+2]*Re;Fr+=Math.abs((le[Pn]-le[Nn])*(le[ni+1]-le[Pn+1])-(le[Pn]-le[ni])*(le[Nn+1]-le[Pn+1]))}return It===0&&Fr===0?0:Math.abs((Fr-It)/It)};function zt(le,Me,Re,yt){for(var At=0,ae=Me,It=Re-yt;ae<Re;ae+=yt)At+=(le[It]-le[ae])*(le[ae+1]+le[It+1]),It=ae;return At}D.flatten=function(le){for(var Me=le[0][0].length,Re={vertices:[],holes:[],dimensions:Me},yt=0,At=0;At<le.length;At++){for(var ae=0;ae<le[At].length;ae++)for(var It=0;It<Me;It++)Re.vertices.push(le[At][ae][It]);At>0&&(yt+=le[At-1].length,Re.holes.push(yt))}return Re}},"W6/K":function(se,Z,C){var D=C("eUgh"),N=C("R/W3"),z=C("2GsC"),k=C("sEf8"),v=C("Q1l4"),L=Array.prototype,U=L.splice;function K(q,fe,ue,rt){var Ne=rt?z:N,nt=-1,wt=fe.length,ht=q;for(q===fe&&(fe=v(fe)),ue&&(ht=D(q,k(ue)));++nt<wt;)for(var We=0,St=fe[nt],Je=ue?ue(St):St;(We=Ne(ht,Je,We,rt))>-1;)ht!==q&&U.call(ht,We,1),U.call(q,We,1);return q}se.exports=K},W8MJ:function(se,Z,C){var D=C("o5UB");function N(k,v){for(var L=0;L<v.length;L++){var U=v[L];U.enumerable=U.enumerable||!1,U.configurable=!0,"value"in U&&(U.writable=!0),Object.defineProperty(k,D(U.key),U)}}function z(k,v,L){return v&&N(k.prototype,v),L&&N(k,L),Object.defineProperty(k,"prototype",{writable:!1}),k}se.exports=z,se.exports.__esModule=!0,se.exports.default=se.exports},WwFo:function(se,Z,C){var D=C("juv8"),N=C("7GkX");function z(k,v){return k&&D(v,N(v),k)}se.exports=z},XYm9:function(se,Z,C){var D=C("+K+b");function N(z,k){var v=k?D(z.buffer):z.buffer;return new z.constructor(v,z.byteOffset,z.byteLength)}se.exports=N},"Xt/L":function(se,Z){function C(D,N,z){for(var k=-1,v=D==null?0:D.length;++k<v;)if(z(N,D[k]))return!0;return!1}se.exports=C},YO3V:function(se,Z,C){var D=C("NykK"),N=C("LcsW"),z=C("ExA7"),k="[object Object]",v=Function.prototype,L=Object.prototype,U=v.toString,K=L.hasOwnProperty,q=U.call(Object);function fe(ue){if(!z(ue)||D(ue)!=k)return!1;var rt=N(ue);if(rt===null)return!0;var Ne=K.call(rt,"constructor")&&rt.constructor;return typeof Ne=="function"&&Ne instanceof Ne&&U.call(Ne)==q}se.exports=fe},Yk9n:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.inject=Z.LazyServiceIdentifer=void 0;var D=C("MON2"),N=C("xfSm"),z=C("GXnB"),k=C("Ztfv"),v=function(){function U(K){this._cb=K}return U.prototype.unwrap=function(){return this._cb()},U}();Z.LazyServiceIdentifer=v;function L(U){return function(K,q,fe){if(U===void 0)throw new Error(D.UNDEFINED_INJECT_ANNOTATION(K.name));var ue=new z.Metadata(N.INJECT_TAG,U);typeof fe=="number"?k.tagParameter(K,q,fe,ue):k.tagProperty(K,q,ue)}}Z.inject=L},Z1HP:function(se,Z,C){var D=C("ycre"),N=C("quyA"),z=C("q4HE");function k(v){return N(v)?z(v):D(v)}se.exports=k},ZCgT:function(se,Z,C){var D=C("tLB3"),N=1/0,z=17976931348623157e292;function k(v){if(!v)return v===0?v:0;if(v=D(v),v===N||v===-N){var L=v<0?-1:1;return L*z}return v===v?v:0}se.exports=k},ZWtO:function(se,Z,C){var D=C("4uTw"),N=C("9Nap");function z(k,v){v=D(v,k);for(var L=0,U=v.length;k!=null&&L<U;)k=k[N(v[L++])];return L&&L==U?k:void 0}se.exports=z},"Znm+":function(se,Z,C){var D=C("NykK"),N=C("ExA7"),z="[object Boolean]";function k(v){return v===!0||v===!1||N(v)&&D(v)==z}se.exports=k},Ztfv:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.tagProperty=Z.tagParameter=Z.decorate=void 0;var D=C("MON2"),N=C("xfSm");function z(q,fe,ue,rt){var Ne=N.TAGGED;v(Ne,q,fe,rt,ue)}Z.tagParameter=z;function k(q,fe,ue){var rt=N.TAGGED_PROP;v(rt,q.constructor,fe,ue)}Z.tagProperty=k;function v(q,fe,ue,rt,Ne){var nt={},wt=typeof Ne=="number",ht=Ne!==void 0&&wt?Ne.toString():ue;if(wt&&ue!==void 0)throw new Error(D.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(q,fe)&&(nt=Reflect.getMetadata(q,fe));var We=nt[ht];if(!Array.isArray(We))We=[];else for(var St=0,Je=We;St<Je.length;St++){var Ft=Je[St];if(Ft.key===rt.key)throw new Error(D.DUPLICATED_METADATA+" "+Ft.key.toString())}We.push(rt),nt[ht]=We,Reflect.defineMetadata(q,nt,fe)}function L(q,fe){Reflect.decorate(q,fe)}function U(q,fe){return function(ue,rt){fe(ue,rt,q)}}function K(q,fe,ue){typeof ue=="number"?L([U(ue,q)],fe):typeof ue=="string"?Reflect.decorate([q],fe,ue):L([q],fe)}Z.decorate=K},ZzCi:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.named=void 0;var D=C("xfSm"),N=C("GXnB"),z=C("Ztfv");function k(v){return function(L,U,K){var q=new N.Metadata(D.NAMED_TAG,v);typeof K=="number"?z.tagParameter(L,U,K,q):z.tagProperty(L,U,q)}}Z.named=k},a1gu:function(se,Z,C){var D=C("cDf5").default,N=C("PJYZ");function z(k,v){if(v&&(D(v)==="object"||typeof v=="function"))return v;if(v!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return N(k)}se.exports=z,se.exports.__esModule=!0,se.exports.default=se.exports},aHsQ:function(se,Z,C){"use strict";var D=C("EFp3"),N=C.n(D),z=C("6D9b"),k=C.n(z),v=C("cWXX")},aPG5:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.resolve=void 0;var D=C("MON2"),N=C("FV85"),z=C("qK8v"),k=C("ujMp"),v=C("cSJO"),L=function(fe,ue,rt){try{return rt()}catch(Ne){throw z.isStackOverflowExeption(Ne)?new Error(D.CIRCULAR_DEPENDENCY_IN_FACTORY(fe,ue.toString())):Ne}},U=function q(fe){return function(ue){ue.parentContext.setCurrentRequest(ue);var rt=ue.bindings,Ne=ue.childRequests,nt=ue.target&&ue.target.isArray(),wt=!ue.parentRequest||!ue.parentRequest.target||!ue.target||!ue.parentRequest.target.matchesArray(ue.target.serviceIdentifier);if(nt&&wt)return Ne.map(function(tr){var yr=q(fe);return yr(tr)});var ht=null;if(ue.target.isOptional()&&rt.length===0)return;var We=rt[0],St=We.scope===N.BindingScopeEnum.Singleton,Je=We.scope===N.BindingScopeEnum.Request;if(St&&We.activated)return We.cache;if(Je&&fe!==null&&fe.has(We.id))return fe.get(We.id);if(We.type===N.BindingTypeEnum.ConstantValue)ht=We.cache,We.activated=!0;else if(We.type===N.BindingTypeEnum.Function)ht=We.cache,We.activated=!0;else if(We.type===N.BindingTypeEnum.Constructor)ht=We.implementationType;else if(We.type===N.BindingTypeEnum.DynamicValue&&We.dynamicValue!==null)ht=L("toDynamicValue",We.serviceIdentifier,function(){return We.dynamicValue(ue.parentContext)});else if(We.type===N.BindingTypeEnum.Factory&&We.factory!==null)ht=L("toFactory",We.serviceIdentifier,function(){return We.factory(ue.parentContext)});else if(We.type===N.BindingTypeEnum.Provider&&We.provider!==null)ht=L("toProvider",We.serviceIdentifier,function(){return We.provider(ue.parentContext)});else if(We.type===N.BindingTypeEnum.Instance&&We.implementationType!==null)ht=v.resolveInstance(We.implementationType,Ne,q(fe));else{var Ft=k.getServiceIdentifierAsString(ue.serviceIdentifier);throw new Error(D.INVALID_BINDING_TYPE+" "+Ft)}return typeof We.onActivation=="function"&&(ht=We.onActivation(ue.parentContext,ht)),St&&(We.cache=ht,We.activated=!0),Je&&fe!==null&&!fe.has(We.id)&&fe.set(We.id,ht),ht}};function K(q){var fe=U(q.plan.rootRequest.requestScope);return fe(q.plan.rootRequest)}Z.resolve=K},asDA:function(se,Z){function C(D,N,z,k){var v=-1,L=D==null?0:D.length;for(k&&L&&(z=D[++v]);++v<L;)z=N(z,D[v],v,D);return z}se.exports=C},b2z7:function(se,Z){var C=/\w*$/;function D(N){var z=new N.constructor(N.source,C.exec(N));return z.lastIndex=N.lastIndex,z}se.exports=D},b48C:function(se,Z){function C(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(D){return!1}}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},bahg:function(se,Z){function C(D){return D.split("")}se.exports=C},bpoo:function(se,Z){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(C){try{var D=function(){q||(q=!0,U())},N=function ue(){try{K.documentElement.doScroll("left")}catch(rt){return void setTimeout(ue,50)}D()},z=(z=document.getElementsByTagName("script"))[z.length-1],k=z.getAttribute("data-injectcss"),z=z.getAttribute("data-disable-injectsvg");if(!z){var v,L,U,K,q,fe=function(rt,Ne){Ne.parentNode.insertBefore(rt,Ne)};if(k&&!C.__iconfont__svg__cssinject__){C.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(ue){console&&console.log(ue)}}v=function(){var rt,Ne=document.createElement("div");Ne.innerHTML=C._iconfont_svg_string_3580659,(Ne=Ne.getElementsByTagName("svg")[0])&&(Ne.setAttribute("aria-hidden","true"),Ne.style.position="absolute",Ne.style.width=0,Ne.style.height=0,Ne.style.overflow="hidden",Ne=Ne,(rt=document.body).firstChild?fe(Ne,rt.firstChild):rt.appendChild(Ne))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(v,0):(L=function(){document.removeEventListener("DOMContentLoaded",L,!1),v()},document.addEventListener("DOMContentLoaded",L,!1)):document.attachEvent&&(U=v,K=C.document,q=!1,N(),K.onreadystatechange=function(){K.readyState=="complete"&&(K.onreadystatechange=null,D())})}}catch(ue){}}(window)},cSJO:function(se,Z,C){"use strict";var D=this&&this.__spreadArray||function(q,fe){for(var ue=0,rt=fe.length,Ne=q.length;ue<rt;ue++,Ne++)q[Ne]=fe[ue];return q};Object.defineProperty(Z,"__esModule",{value:!0}),Z.resolveInstance=void 0;var N=C("MON2"),z=C("FV85"),k=C("xfSm");function v(q,fe,ue){var rt=fe.filter(function(nt){return nt.target!==null&&nt.target.type===z.TargetTypeEnum.ClassProperty}),Ne=rt.map(ue);return rt.forEach(function(nt,wt){var ht="";ht=nt.target.name.value();var We=Ne[wt];q[ht]=We}),q}function L(q,fe){return new(q.bind.apply(q,D([void 0],fe)))}function U(q,fe){if(Reflect.hasMetadata(k.POST_CONSTRUCT,q)){var ue=Reflect.getMetadata(k.POST_CONSTRUCT,q);try{fe[ue.value]()}catch(rt){throw new Error(N.POST_CONSTRUCT_ERROR(q.name,rt.message))}}}function K(q,fe,ue){var rt=null;if(fe.length>0){var Ne=fe.filter(function(wt){return wt.target!==null&&wt.target.type===z.TargetTypeEnum.ConstructorArgument}),nt=Ne.map(ue);rt=L(q,nt),rt=v(rt,fe,ue)}else rt=new q;return U(q,rt),rt}Z.resolveInstance=K},cWXX:function(se,Z,C){"use strict";var D=C("EFp3"),N=C.n(D),z=C("oIFs"),k=C.n(z)},cZ5Q:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.injectable=void 0;var D=C("MON2"),N=C("xfSm");function z(){return function(k){if(Reflect.hasOwnMetadata(N.PARAM_TYPES,k))throw new Error(D.DUPLICATED_INJECTABLE_DECORATOR);var v=Reflect.getMetadata(N.DESIGN_PARAM_TYPES,k)||[];return Reflect.defineMetadata(N.PARAM_TYPES,v,k),k}}Z.injectable=z},"cq/+":function(se,Z,C){var D=C("mc0g"),N=D();se.exports=N},cvCv:function(se,Z){function C(D){return function(){return D}}se.exports=C},d9O0:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.id=void 0;var D=0;function N(){return D++}Z.id=N},dA7e:function(se,Z,C){se.exports.VectorTile=C("B93f"),se.exports.VectorTileFeature=C("HfwV"),se.exports.VectorTileLayer=C("DiGy")},dQpi:function(se,Z,C){var D=C("yGk4"),N=C("vN+2"),z=C("rEGp"),k=1/0,v=D&&1/z(new D([,-0]))[1]==k?function(L){return new D(L)}:N;se.exports=v},dTAl:function(se,Z,C){var D=C("GoyQ"),N=Object.create,z=function(){function k(){}return function(v){if(!D(v))return{};if(N)return N(v);k.prototype=v;var L=new k;return k.prototype=void 0,L}}();se.exports=z},dVn5:function(se,Z){var C=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function D(N){return N.match(C)||[]}se.exports=D},dX1H:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Target=void 0;var D=C("xfSm"),N=C("d9O0"),z=C("GXnB"),k=C("zxMA"),v=function(){function L(U,K,q,fe){this.id=N.id(),this.type=U,this.serviceIdentifier=q,this.name=new k.QueryableString(K||""),this.metadata=new Array;var ue=null;typeof fe=="string"?ue=new z.Metadata(D.NAMED_TAG,fe):fe instanceof z.Metadata&&(ue=fe),ue!==null&&this.metadata.push(ue)}return L.prototype.hasTag=function(U){for(var K=0,q=this.metadata;K<q.length;K++){var fe=q[K];if(fe.key===U)return!0}return!1},L.prototype.isArray=function(){return this.hasTag(D.MULTI_INJECT_TAG)},L.prototype.matchesArray=function(U){return this.matchesTag(D.MULTI_INJECT_TAG)(U)},L.prototype.isNamed=function(){return this.hasTag(D.NAMED_TAG)},L.prototype.isTagged=function(){return this.metadata.some(function(U){return D.NON_CUSTOM_TAG_KEYS.every(function(K){return U.key!==K})})},L.prototype.isOptional=function(){return this.matchesTag(D.OPTIONAL_TAG)(!0)},L.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(U){return U.key===D.NAMED_TAG})[0]:null},L.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(U){return D.NON_CUSTOM_TAG_KEYS.every(function(K){return U.key!==K})}):null},L.prototype.matchesNamedTag=function(U){return this.matchesTag(D.NAMED_TAG)(U)},L.prototype.matchesTag=function(U){var K=this;return function(q){for(var fe=0,ue=K.metadata;fe<ue.length;fe++){var rt=ue[fe];if(rt.key===U&&rt.value===q)return!0}return!1}},L}();Z.Target=v},doU7:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingCount=void 0;var D={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Z.BindingCount=D},dt0z:function(se,Z,C){var D=C("zoYe");function N(z){return z==null?"":D(z)}se.exports=N},dxzI:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.AsyncContainerModule=Z.ContainerModule=void 0;var D=C("d9O0"),N=function(){function k(v){this.id=D.id(),this.registry=v}return k}();Z.ContainerModule=N;var z=function(){function k(v){this.id=D.id(),this.registry=v}return k}();Z.AsyncContainerModule=z},eRUA:function(se,Z,C){"use strict";se.exports=N;var D=C("kVK+");function N(Ce){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Ce)?Ce:new Uint8Array(Ce||0),this.pos=0,this.type=0,this.length=this.buf.length}N.Varint=0,N.Fixed64=1,N.Bytes=2,N.Fixed32=5;var z=(1<<16)*(1<<16),k=1/z,v=12,L=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");N.prototype={destroy:function(){this.buf=null},readFields:function(ve,Ie,zt){for(zt=zt||this.length;this.pos<zt;){var le=this.readVarint(),Me=le>>3,Re=this.pos;this.type=le&7,ve(Me,Ie,this),this.pos===Re&&this.skip(le)}return Ie},readMessage:function(ve,Ie){return this.readFields(ve,Ie,this.readVarint()+this.pos)},readFixed32:function(){var ve=Dr(this.buf,this.pos);return this.pos+=4,ve},readSFixed32:function(){var ve=jt(this.buf,this.pos);return this.pos+=4,ve},readFixed64:function(){var ve=Dr(this.buf,this.pos)+Dr(this.buf,this.pos+4)*z;return this.pos+=8,ve},readSFixed64:function(){var ve=Dr(this.buf,this.pos)+jt(this.buf,this.pos+4)*z;return this.pos+=8,ve},readFloat:function(){var ve=D.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ve},readDouble:function(){var ve=D.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ve},readVarint:function(ve){var Ie=this.buf,zt,le;return le=Ie[this.pos++],zt=le&127,le<128||(le=Ie[this.pos++],zt|=(le&127)<<7,le<128)||(le=Ie[this.pos++],zt|=(le&127)<<14,le<128)||(le=Ie[this.pos++],zt|=(le&127)<<21,le<128)?zt:(le=Ie[this.pos],zt|=(le&15)<<28,U(zt,ve,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ve=this.readVarint();return ve%2==1?(ve+1)/-2:ve/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var ve=this.readVarint()+this.pos,Ie=this.pos;return this.pos=ve,ve-Ie>=v&&L?Dt(this.buf,Ie,ve):He(this.buf,Ie,ve)},readBytes:function(){var ve=this.readVarint()+this.pos,Ie=this.buf.subarray(this.pos,ve);return this.pos=ve,Ie},readPackedVarint:function(ve,Ie){if(this.type!==N.Bytes)return ve.push(this.readVarint(Ie));var zt=K(this);for(ve=ve||[];this.pos<zt;)ve.push(this.readVarint(Ie));return ve},readPackedSVarint:function(ve){if(this.type!==N.Bytes)return ve.push(this.readSVarint());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readSVarint());return ve},readPackedBoolean:function(ve){if(this.type!==N.Bytes)return ve.push(this.readBoolean());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readBoolean());return ve},readPackedFloat:function(ve){if(this.type!==N.Bytes)return ve.push(this.readFloat());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readFloat());return ve},readPackedDouble:function(ve){if(this.type!==N.Bytes)return ve.push(this.readDouble());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readDouble());return ve},readPackedFixed32:function(ve){if(this.type!==N.Bytes)return ve.push(this.readFixed32());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readFixed32());return ve},readPackedSFixed32:function(ve){if(this.type!==N.Bytes)return ve.push(this.readSFixed32());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readSFixed32());return ve},readPackedFixed64:function(ve){if(this.type!==N.Bytes)return ve.push(this.readFixed64());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readFixed64());return ve},readPackedSFixed64:function(ve){if(this.type!==N.Bytes)return ve.push(this.readSFixed64());var Ie=K(this);for(ve=ve||[];this.pos<Ie;)ve.push(this.readSFixed64());return ve},skip:function(ve){var Ie=ve&7;if(Ie===N.Varint)for(;this.buf[this.pos++]>127;);else if(Ie===N.Bytes)this.pos=this.readVarint()+this.pos;else if(Ie===N.Fixed32)this.pos+=4;else if(Ie===N.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Ie)},writeTag:function(ve,Ie){this.writeVarint(ve<<3|Ie)},realloc:function(ve){for(var Ie=this.length||16;Ie<this.pos+ve;)Ie*=2;if(Ie!==this.length){var zt=new Uint8Array(Ie);zt.set(this.buf),this.buf=zt,this.length=Ie}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ve){this.realloc(4),Mr(this.buf,ve,this.pos),this.pos+=4},writeSFixed32:function(ve){this.realloc(4),Mr(this.buf,ve,this.pos),this.pos+=4},writeFixed64:function(ve){this.realloc(8),Mr(this.buf,ve&-1,this.pos),Mr(this.buf,Math.floor(ve*k),this.pos+4),this.pos+=8},writeSFixed64:function(ve){this.realloc(8),Mr(this.buf,ve&-1,this.pos),Mr(this.buf,Math.floor(ve*k),this.pos+4),this.pos+=8},writeVarint:function(ve){if(ve=+ve||0,ve>268435455||ve<0){fe(ve,this);return}this.realloc(4),this.buf[this.pos++]=ve&127|(ve>127?128:0),!(ve<=127)&&(this.buf[this.pos++]=(ve>>>=7)&127|(ve>127?128:0),!(ve<=127)&&(this.buf[this.pos++]=(ve>>>=7)&127|(ve>127?128:0),!(ve<=127)&&(this.buf[this.pos++]=ve>>>7&127)))},writeSVarint:function(ve){this.writeVarint(ve<0?-ve*2-1:ve*2)},writeBoolean:function(ve){this.writeVarint(Boolean(ve))},writeString:function(ve){ve=String(ve),this.realloc(ve.length*4),this.pos++;var Ie=this.pos;this.pos=Ut(this.buf,ve,this.pos);var zt=this.pos-Ie;zt>=128&&Ne(Ie,zt,this),this.pos=Ie-1,this.writeVarint(zt),this.pos+=zt},writeFloat:function(ve){this.realloc(4),D.write(this.buf,ve,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ve){this.realloc(8),D.write(this.buf,ve,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ve){var Ie=ve.length;this.writeVarint(Ie),this.realloc(Ie);for(var zt=0;zt<Ie;zt++)this.buf[this.pos++]=ve[zt]},writeRawMessage:function(ve,Ie){this.pos++;var zt=this.pos;ve(Ie,this);var le=this.pos-zt;le>=128&&Ne(zt,le,this),this.pos=zt-1,this.writeVarint(le),this.pos+=le},writeMessage:function(ve,Ie,zt){this.writeTag(ve,N.Bytes),this.writeRawMessage(Ie,zt)},writePackedVarint:function(ve,Ie){Ie.length&&this.writeMessage(ve,nt,Ie)},writePackedSVarint:function(ve,Ie){Ie.length&&this.writeMessage(ve,wt,Ie)},writePackedBoolean:function(ve,Ie){Ie.length&&this.writeMessage(ve,St,Ie)},writePackedFloat:function(ve,Ie){Ie.length&&this.writeMessage(ve,ht,Ie)},writePackedDouble:function(ve,Ie){Ie.length&&this.writeMessage(ve,We,Ie)},writePackedFixed32:function(ve,Ie){Ie.length&&this.writeMessage(ve,Je,Ie)},writePackedSFixed32:function(ve,Ie){Ie.length&&this.writeMessage(ve,Ft,Ie)},writePackedFixed64:function(ve,Ie){Ie.length&&this.writeMessage(ve,tr,Ie)},writePackedSFixed64:function(ve,Ie){Ie.length&&this.writeMessage(ve,yr,Ie)},writeBytesField:function(ve,Ie){this.writeTag(ve,N.Bytes),this.writeBytes(Ie)},writeFixed32Field:function(ve,Ie){this.writeTag(ve,N.Fixed32),this.writeFixed32(Ie)},writeSFixed32Field:function(ve,Ie){this.writeTag(ve,N.Fixed32),this.writeSFixed32(Ie)},writeFixed64Field:function(ve,Ie){this.writeTag(ve,N.Fixed64),this.writeFixed64(Ie)},writeSFixed64Field:function(ve,Ie){this.writeTag(ve,N.Fixed64),this.writeSFixed64(Ie)},writeVarintField:function(ve,Ie){this.writeTag(ve,N.Varint),this.writeVarint(Ie)},writeSVarintField:function(ve,Ie){this.writeTag(ve,N.Varint),this.writeSVarint(Ie)},writeStringField:function(ve,Ie){this.writeTag(ve,N.Bytes),this.writeString(Ie)},writeFloatField:function(ve,Ie){this.writeTag(ve,N.Fixed32),this.writeFloat(Ie)},writeDoubleField:function(ve,Ie){this.writeTag(ve,N.Fixed64),this.writeDouble(Ie)},writeBooleanField:function(ve,Ie){this.writeVarintField(ve,Boolean(Ie))}};function U(Ce,ve,Ie){var zt=Ie.buf,le,Me;if(Me=zt[Ie.pos++],le=(Me&112)>>4,Me<128||(Me=zt[Ie.pos++],le|=(Me&127)<<3,Me<128)||(Me=zt[Ie.pos++],le|=(Me&127)<<10,Me<128)||(Me=zt[Ie.pos++],le|=(Me&127)<<17,Me<128)||(Me=zt[Ie.pos++],le|=(Me&127)<<24,Me<128)||(Me=zt[Ie.pos++],le|=(Me&1)<<31,Me<128))return q(Ce,le,ve);throw new Error("Expected varint not more than 10 bytes")}function K(Ce){return Ce.type===N.Bytes?Ce.readVarint()+Ce.pos:Ce.pos+1}function q(Ce,ve,Ie){return Ie?ve*4294967296+(Ce>>>0):(ve>>>0)*4294967296+(Ce>>>0)}function fe(Ce,ve){var Ie,zt;if(Ce>=0?(Ie=Ce%4294967296|0,zt=Ce/4294967296|0):(Ie=~(-Ce%4294967296),zt=~(-Ce/4294967296),Ie^4294967295?Ie=Ie+1|0:(Ie=0,zt=zt+1|0)),Ce>=18446744073709552e3||Ce<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ve.realloc(10),ue(Ie,zt,ve),rt(zt,ve)}function ue(Ce,ve,Ie){Ie.buf[Ie.pos++]=Ce&127|128,Ce>>>=7,Ie.buf[Ie.pos++]=Ce&127|128,Ce>>>=7,Ie.buf[Ie.pos++]=Ce&127|128,Ce>>>=7,Ie.buf[Ie.pos++]=Ce&127|128,Ce>>>=7,Ie.buf[Ie.pos]=Ce&127}function rt(Ce,ve){var Ie=(Ce&7)<<4;ve.buf[ve.pos++]|=Ie|((Ce>>>=3)?128:0),!!Ce&&(ve.buf[ve.pos++]=Ce&127|((Ce>>>=7)?128:0),!!Ce&&(ve.buf[ve.pos++]=Ce&127|((Ce>>>=7)?128:0),!!Ce&&(ve.buf[ve.pos++]=Ce&127|((Ce>>>=7)?128:0),!!Ce&&(ve.buf[ve.pos++]=Ce&127|((Ce>>>=7)?128:0),!!Ce&&(ve.buf[ve.pos++]=Ce&127)))))}function Ne(Ce,ve,Ie){var zt=ve<=16383?1:ve<=2097151?2:ve<=268435455?3:Math.floor(Math.log(ve)/(Math.LN2*7));Ie.realloc(zt);for(var le=Ie.pos-1;le>=Ce;le--)Ie.buf[le+zt]=Ie.buf[le]}function nt(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeVarint(Ce[Ie])}function wt(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeSVarint(Ce[Ie])}function ht(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeFloat(Ce[Ie])}function We(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeDouble(Ce[Ie])}function St(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeBoolean(Ce[Ie])}function Je(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeFixed32(Ce[Ie])}function Ft(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeSFixed32(Ce[Ie])}function tr(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeFixed64(Ce[Ie])}function yr(Ce,ve){for(var Ie=0;Ie<Ce.length;Ie++)ve.writeSFixed64(Ce[Ie])}function Dr(Ce,ve){return(Ce[ve]|Ce[ve+1]<<8|Ce[ve+2]<<16)+Ce[ve+3]*16777216}function Mr(Ce,ve,Ie){Ce[Ie]=ve,Ce[Ie+1]=ve>>>8,Ce[Ie+2]=ve>>>16,Ce[Ie+3]=ve>>>24}function jt(Ce,ve){return(Ce[ve]|Ce[ve+1]<<8|Ce[ve+2]<<16)+(Ce[ve+3]<<24)}function He(Ce,ve,Ie){for(var zt="",le=ve;le<Ie;){var Me=Ce[le],Re=null,yt=Me>239?4:Me>223?3:Me>191?2:1;if(le+yt>Ie)break;var At,ae,It;yt===1?Me<128&&(Re=Me):yt===2?(At=Ce[le+1],(At&192)==128&&(Re=(Me&31)<<6|At&63,Re<=127&&(Re=null))):yt===3?(At=Ce[le+1],ae=Ce[le+2],(At&192)==128&&(ae&192)==128&&(Re=(Me&15)<<12|(At&63)<<6|ae&63,(Re<=2047||Re>=55296&&Re<=57343)&&(Re=null))):yt===4&&(At=Ce[le+1],ae=Ce[le+2],It=Ce[le+3],(At&192)==128&&(ae&192)==128&&(It&192)==128&&(Re=(Me&15)<<18|(At&63)<<12|(ae&63)<<6|It&63,(Re<=65535||Re>=1114112)&&(Re=null))),Re===null?(Re=65533,yt=1):Re>65535&&(Re-=65536,zt+=String.fromCharCode(Re>>>10&1023|55296),Re=56320|Re&1023),zt+=String.fromCharCode(Re),le+=yt}return zt}function Dt(Ce,ve,Ie){return L.decode(Ce.subarray(ve,Ie))}function Ut(Ce,ve,Ie){for(var zt=0,le,Me;zt<ve.length;zt++){if(le=ve.charCodeAt(zt),le>55295&&le<57344)if(Me)if(le<56320){Ce[Ie++]=239,Ce[Ie++]=191,Ce[Ie++]=189,Me=le;continue}else le=Me-55296<<10|le-56320|65536,Me=null;else{le>56319||zt+1===ve.length?(Ce[Ie++]=239,Ce[Ie++]=191,Ce[Ie++]=189):Me=le;continue}else Me&&(Ce[Ie++]=239,Ce[Ie++]=191,Ce[Ie++]=189,Me=null);le<128?Ce[Ie++]=le:(le<2048?Ce[Ie++]=le>>6|192:(le<65536?Ce[Ie++]=le>>12|224:(Ce[Ie++]=le>>18|240,Ce[Ie++]=le>>12&63|128),Ce[Ie++]=le>>6&63|128),Ce[Ie++]=le&63|128)}return Ie}},eUgh:function(se,Z){function C(D,N){for(var z=-1,k=D==null?0:D.length,v=Array(k);++z<k;)v[z]=N(D[z],z,D);return v}se.exports=C},fbrv:function(se,Z,C){"use strict";var D=this&&this.__spreadArray||function(wt,ht){for(var We=0,St=ht.length,Je=wt.length;We<St;We++,Je++)wt[Je]=ht[We];return wt};Object.defineProperty(Z,"__esModule",{value:!0}),Z.getFunctionName=Z.getBaseClassDependencyCount=Z.getDependencies=void 0;var N=C("Yk9n"),z=C("MON2"),k=C("FV85"),v=C("xfSm"),L=C("ujMp");Object.defineProperty(Z,"getFunctionName",{enumerable:!0,get:function(){return L.getFunctionName}});var U=C("dX1H");function K(wt,ht){var We=L.getFunctionName(ht),St=q(wt,We,ht,!1);return St}Z.getDependencies=K;function q(wt,ht,We,St){var Je=wt.getConstructorMetadata(We),Ft=Je.compilerGeneratedMetadata;if(Ft===void 0){var tr=z.MISSING_INJECTABLE_ANNOTATION+" "+ht+".";throw new Error(tr)}var yr=Je.userGeneratedMetadata,Dr=Object.keys(yr),Mr=We.length===0&&Dr.length>0,jt=Dr.length>We.length,He=Mr||jt?Dr.length:We.length,Dt=ue(St,ht,Ft,yr,He),Ut=rt(wt,We),Ce=D(D([],Dt),Ut);return Ce}function fe(wt,ht,We,St,Je){var Ft=Je[wt.toString()]||[],tr=nt(Ft),yr=tr.unmanaged!==!0,Dr=St[wt],Mr=tr.inject||tr.multiInject;if(Dr=Mr||Dr,Dr instanceof N.LazyServiceIdentifer&&(Dr=Dr.unwrap()),yr){var jt=Dr===Object,He=Dr===Function,Dt=Dr===void 0,Ut=jt||He||Dt;if(!ht&&Ut){var Ce=z.MISSING_INJECT_ANNOTATION+" argument "+wt+" in class "+We+".";throw new Error(Ce)}var ve=new U.Target(k.TargetTypeEnum.ConstructorArgument,tr.targetName,Dr);return ve.metadata=Ft,ve}return null}function ue(wt,ht,We,St,Je){for(var Ft=[],tr=0;tr<Je;tr++){var yr=tr,Dr=fe(yr,wt,ht,We,St);Dr!==null&&Ft.push(Dr)}return Ft}function rt(wt,ht){for(var We=wt.getPropertiesMetadata(ht),St=[],Je=Object.keys(We),Ft=0,tr=Je;Ft<tr.length;Ft++){var yr=tr[Ft],Dr=We[yr],Mr=nt(We[yr]),jt=Mr.targetName||yr,He=Mr.inject||Mr.multiInject,Dt=new U.Target(k.TargetTypeEnum.ClassProperty,jt,He);Dt.metadata=Dr,St.push(Dt)}var Ut=Object.getPrototypeOf(ht.prototype).constructor;if(Ut!==Object){var Ce=rt(wt,Ut);St=D(D([],St),Ce)}return St}function Ne(wt,ht){var We=Object.getPrototypeOf(ht.prototype).constructor;if(We!==Object){var St=L.getFunctionName(We),Je=q(wt,St,We,!0),Ft=Je.map(function(Dr){return Dr.metadata.filter(function(Mr){return Mr.key===v.UNMANAGED_TAG})}),tr=[].concat.apply([],Ft).length,yr=Je.length-tr;return yr>0?yr:Ne(wt,We)}else return 0}Z.getBaseClassDependencyCount=Ne;function nt(wt){var ht={};return wt.forEach(function(We){ht[We.key.toString()]=We.value}),{inject:ht[v.INJECT_TAG],multiInject:ht[v.MULTI_INJECT_TAG],targetName:ht[v.NAME_TAG],unmanaged:ht[v.UNMANAGED_TAG]}}},fbvF:function(se,Z,C){(function(D,N){se.exports=N()})(this,function(){"use strict";var D=function(de){return de instanceof Uint8Array||de instanceof Uint16Array||de instanceof Uint32Array||de instanceof Int8Array||de instanceof Int16Array||de instanceof Int32Array||de instanceof Float32Array||de instanceof Float64Array||de instanceof Uint8ClampedArray},N=function(de,st){for(var qt=Object.keys(st),Sr=0;Sr<qt.length;++Sr)de[qt[Sr]]=st[qt[Sr]];return de},z=`
`;function k(Q){return typeof atob!="undefined"?atob(Q):"base64:"+Q}function v(Q){var de=new Error("(regl) "+Q);throw console.error(de),de}function L(Q,de){Q||v(de)}function U(Q){return Q?": "+Q:""}function K(Q,de,st){Q in de||v("unknown parameter ("+Q+")"+U(st)+". possible values: "+Object.keys(de).join())}function q(Q,de){D(Q)||v("invalid parameter type"+U(de)+". must be a typed array")}function fe(Q,de){switch(de){case"number":return typeof Q=="number";case"object":return typeof Q=="object";case"string":return typeof Q=="string";case"boolean":return typeof Q=="boolean";case"function":return typeof Q=="function";case"undefined":return typeof Q=="undefined";case"symbol":return typeof Q=="symbol"}}function ue(Q,de,st){fe(Q,de)||v("invalid parameter type"+U(st)+". expected "+de+", got "+typeof Q)}function rt(Q,de){Q>=0&&(Q|0)===Q||v("invalid parameter type, ("+Q+")"+U(de)+". must be a nonnegative integer")}function Ne(Q,de,st){de.indexOf(Q)<0&&v("invalid value"+U(st)+". must be one of: "+de)}var nt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function wt(Q){Object.keys(Q).forEach(function(de){nt.indexOf(de)<0&&v('invalid regl constructor argument "'+de+'". must be one of '+nt)})}function ht(Q,de){for(Q=Q+"";Q.length<de;)Q=" "+Q;return Q}function We(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function St(Q,de){this.number=Q,this.line=de,this.errors=[]}function Je(Q,de,st){this.file=Q,this.line=de,this.message=st}function Ft(){var Q=new Error,de=(Q.stack||Q).toString(),st=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(de);if(st)return st[1];var qt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(de);return qt?qt[1]:"unknown"}function tr(){var Q=new Error,de=(Q.stack||Q).toString(),st=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(de);if(st)return st[1];var qt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(de);return qt?qt[1]:"unknown"}function yr(Q,de){var st=Q.split(`
`),qt=1,Sr=0,_r={unknown:new We,0:new We};_r.unknown.name=_r[0].name=de||Ft(),_r.unknown.lines.push(new St(0,""));for(var Bt=0;Bt<st.length;++Bt){var Ur=st[Bt],$r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Ur);if($r)switch($r[1]){case"line":var tn=/(\d+)(\s+\d+)?/.exec($r[2]);tn&&(qt=tn[1]|0,tn[2]&&(Sr=tn[2]|0,Sr in _r||(_r[Sr]=new We)));break;case"define":var Kr=/SHADER_NAME(_B64)?\s+(.*)$/.exec($r[2]);Kr&&(_r[Sr].name=Kr[1]?k(Kr[2]):Kr[2]);break}_r[Sr].lines.push(new St(qt++,Ur))}return Object.keys(_r).forEach(function(nn){var mn=_r[nn];mn.lines.forEach(function(sn){mn.index[sn.number]=sn})}),_r}function Dr(Q){var de=[];return Q.split(`
`).forEach(function(st){if(!(st.length<5)){var qt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(st);qt?de.push(new Je(qt[1]|0,qt[2]|0,qt[3].trim())):st.length>0&&de.push(new Je("unknown",0,st))}}),de}function Mr(Q,de){de.forEach(function(st){var qt=Q[st.file];if(qt){var Sr=qt.index[st.line];if(Sr){Sr.errors.push(st),qt.hasErrors=!0;return}}Q.unknown.hasErrors=!0,Q.unknown.lines[0].errors.push(st)})}function jt(Q,de,st,qt,Sr){if(!Q.getShaderParameter(de,Q.COMPILE_STATUS)){var _r=Q.getShaderInfoLog(de),Bt=qt===Q.FRAGMENT_SHADER?"fragment":"vertex";zt(st,"string",Bt+" shader source must be a string",Sr);var Ur=yr(st,Sr),$r=Dr(_r);Mr(Ur,$r),Object.keys(Ur).forEach(function(tn){var Kr=Ur[tn];if(!Kr.hasErrors)return;var nn=[""],mn=[""];function sn(Yr,rr){nn.push(Yr),mn.push(rr||"")}sn("file number "+tn+": "+Kr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Kr.lines.forEach(function(Yr){if(Yr.errors.length>0){sn(ht(Yr.number,4)+"|  ","background-color:yellow; font-weight:bold"),sn(Yr.line+z,"color:red; background-color:yellow; font-weight:bold");var rr=0;Yr.errors.forEach(function(Qt){var Wr=Qt.message,bn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Wr);if(bn){var xr=bn[1];switch(Wr=bn[2],xr){case"assign":xr="=";break}rr=Math.max(Yr.line.indexOf(xr,rr),0)}else rr=0;sn(ht("| ",6)),sn(ht("^^^",rr+3)+z,"font-weight:bold"),sn(ht("| ",6)),sn(Wr+z,"font-weight:bold")}),sn(ht("| ",6)+z)}else sn(ht(Yr.number,4)+"|  "),sn(Yr.line+z,"color:red")}),typeof document!="undefined"&&!window.chrome?(mn[0]=nn.join("%c"),console.log.apply(console,mn)):console.log(nn.join(""))}),L.raise("Error compiling "+Bt+" shader, "+Ur[0].name)}}function He(Q,de,st,qt,Sr){if(!Q.getProgramParameter(de,Q.LINK_STATUS)){var _r=Q.getProgramInfoLog(de),Bt=yr(st,Sr),Ur=yr(qt,Sr),$r='Error linking program with vertex shader, "'+Ur[0].name+'", and fragment shader "'+Bt[0].name+'"';typeof document!="undefined"?console.log("%c"+$r+z+"%c"+_r,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log($r+z+_r),L.raise($r)}}function Dt(Q){Q._commandRef=Ft()}function Ut(Q,de,st,qt){Dt(Q);function Sr($r){return $r?qt.id($r):0}Q._fragId=Sr(Q.static.frag),Q._vertId=Sr(Q.static.vert);function _r($r,tn){Object.keys(tn).forEach(function(Kr){$r[qt.id(Kr)]=!0})}var Bt=Q._uniformSet={};_r(Bt,de.static),_r(Bt,de.dynamic);var Ur=Q._attributeSet={};_r(Ur,st.static),_r(Ur,st.dynamic),Q._hasCount="count"in Q.static||"count"in Q.dynamic||"elements"in Q.static||"elements"in Q.dynamic}function Ce(Q,de){var st=tr();v(Q+" in command "+(de||Ft())+(st==="unknown"?"":" called from "+st))}function ve(Q,de,st){Q||Ce(de,st||Ft())}function Ie(Q,de,st,qt){Q in de||Ce("unknown parameter ("+Q+")"+U(st)+". possible values: "+Object.keys(de).join(),qt||Ft())}function zt(Q,de,st,qt){fe(Q,de)||Ce("invalid parameter type"+U(st)+". expected "+de+", got "+typeof Q,qt||Ft())}function le(Q){Q()}function Me(Q,de,st){Q.texture?Ne(Q.texture._texture.internalformat,de,"unsupported texture format for attachment"):Ne(Q.renderbuffer._renderbuffer.format,st,"unsupported renderbuffer format for attachment")}var Re=33071,yt=9728,At=9984,ae=9985,It=9986,lr=9987,Cr=5120,Br=5121,pn=5122,Fr=5123,Pn=5124,ni=5125,Nn=5126,Kn=32819,Yn=32820,Ar=33635,mr=34042,Xt=36193,Wt={};Wt[Cr]=Wt[Br]=1,Wt[pn]=Wt[Fr]=Wt[Xt]=Wt[Ar]=Wt[Kn]=Wt[Yn]=2,Wt[Pn]=Wt[ni]=Wt[Nn]=Wt[mr]=4;function Ir(Q,de){return Q===Yn||Q===Kn||Q===Ar?2:Q===mr?4:Wt[Q]*de}function Ue(Q){return!(Q&Q-1)&&!!Q}function he(Q,de,st){var qt,Sr=de.width,_r=de.height,Bt=de.channels;L(Sr>0&&Sr<=st.maxTextureSize&&_r>0&&_r<=st.maxTextureSize,"invalid texture shape"),(Q.wrapS!==Re||Q.wrapT!==Re)&&L(Ue(Sr)&&Ue(_r),"incompatible wrap mode for texture, both width and height must be power of 2"),de.mipmask===1?Sr!==1&&_r!==1&&L(Q.minFilter!==At&&Q.minFilter!==It&&Q.minFilter!==ae&&Q.minFilter!==lr,"min filter requires mipmap"):(L(Ue(Sr)&&Ue(_r),"texture must be a square power of 2 to support mipmapping"),L(de.mipmask===(Sr<<1)-1,"missing or incomplete mipmap data")),de.type===Nn&&(st.extensions.indexOf("oes_texture_float_linear")<0&&L(Q.minFilter===yt&&Q.magFilter===yt,"filter not supported, must enable oes_texture_float_linear"),L(!Q.genMipmaps,"mipmap generation not supported with float textures"));var Ur=de.images;for(qt=0;qt<16;++qt)if(Ur[qt]){var $r=Sr>>qt,tn=_r>>qt;L(de.mipmask&1<<qt,"missing mipmap data");var Kr=Ur[qt];if(L(Kr.width===$r&&Kr.height===tn,"invalid shape for mip images"),L(Kr.format===de.format&&Kr.internalformat===de.internalformat&&Kr.type===de.type,"incompatible type for mip image"),!Kr.compressed)if(Kr.data){var nn=Math.ceil(Ir(Kr.type,Bt)*$r/Kr.unpackAlignment)*Kr.unpackAlignment;L(Kr.data.byteLength===nn*tn,"invalid data for image, buffer size is inconsistent with image format")}else Kr.element||Kr.copy}else Q.genMipmaps||L((de.mipmask&1<<qt)==0,"extra mipmap data");de.compressed&&L(!Q.genMipmaps,"mipmap generation for compressed images not supported")}function ie(Q,de,st,qt){var Sr=Q.width,_r=Q.height,Bt=Q.channels;L(Sr>0&&Sr<=qt.maxTextureSize&&_r>0&&_r<=qt.maxTextureSize,"invalid texture shape"),L(Sr===_r,"cube map must be square"),L(de.wrapS===Re&&de.wrapT===Re,"wrap mode not supported by cube map");for(var Ur=0;Ur<st.length;++Ur){var $r=st[Ur];L($r.width===Sr&&$r.height===_r,"inconsistent cube map face shape"),de.genMipmaps&&(L(!$r.compressed,"can not generate mipmap for compressed textures"),L($r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var tn=$r.images,Kr=0;Kr<16;++Kr){var nn=tn[Kr];if(nn){var mn=Sr>>Kr,sn=_r>>Kr;L($r.mipmask&1<<Kr,"missing mipmap data"),L(nn.width===mn&&nn.height===sn,"invalid shape for mip images"),L(nn.format===Q.format&&nn.internalformat===Q.internalformat&&nn.type===Q.type,"incompatible type for mip image"),nn.compressed||(nn.data?L(nn.data.byteLength===mn*sn*Math.max(Ir(nn.type,Bt),nn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):nn.element||nn.copy)}}}}var B=N(L,{optional:le,raise:v,commandRaise:Ce,command:ve,parameter:K,commandParameter:Ie,constructor:wt,type:ue,commandType:zt,isTypedArray:q,nni:rt,oneOf:Ne,shaderError:jt,linkError:He,callSite:tr,saveCommandRef:Dt,saveDrawInfo:Ut,framebufferFormat:Me,guessCommand:Ft,texture2D:he,textureCube:ie}),Ae=0,Xe=0;function bt(Q,de){this.id=Ae++,this.type=Q,this.data=de}function Gt(Q){return Q.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function sr(Q){if(Q.length===0)return[];var de=Q.charAt(0),st=Q.charAt(Q.length-1);if(Q.length>1&&de===st&&(de==='"'||de==="'"))return['"'+Gt(Q.substr(1,Q.length-2))+'"'];var qt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Q);if(qt)return sr(Q.substr(0,qt.index)).concat(sr(qt[1])).concat(sr(Q.substr(qt.index+qt[0].length)));var Sr=Q.split(".");if(Sr.length===1)return['"'+Gt(Q)+'"'];for(var _r=[],Bt=0;Bt<Sr.length;++Bt)_r=_r.concat(sr(Sr[Bt]));return _r}function at(Q){return"["+sr(Q).join("][")+"]"}function Ot(Q,de){return new bt(Q,at(de+""))}function or(Q){return typeof Q=="function"&&!Q._reglType||Q instanceof bt}function Tr(Q,de){return typeof Q=="function"?new bt(Xe,Q):Q}var Or={DynamicVariable:bt,define:Ot,isDynamic:or,unbox:Tr,accessor:at},jn={next:typeof requestAnimationFrame=="function"?function(Q){return requestAnimationFrame(Q)}:function(Q){return setTimeout(Q,16)},cancel:typeof cancelAnimationFrame=="function"?function(Q){return cancelAnimationFrame(Q)}:clearTimeout},Jr=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function xn(){var Q={"":0},de=[""];return{id:function(qt){var Sr=Q[qt];return Sr||(Sr=Q[qt]=de.length,de.push(qt),Sr)},str:function(qt){return de[qt]}}}function An(Q,de,st){var qt=document.createElement("canvas");N(qt.style,{border:0,margin:0,padding:0,top:0,left:0}),Q.appendChild(qt),Q===document.body&&(qt.style.position="absolute",N(Q.style,{margin:0,padding:0}));function Sr(){var Ur=window.innerWidth,$r=window.innerHeight;if(Q!==document.body){var tn=Q.getBoundingClientRect();Ur=tn.right-tn.left,$r=tn.bottom-tn.top}qt.width=st*Ur,qt.height=st*$r,N(qt.style,{width:Ur+"px",height:$r+"px"})}var _r;Q!==document.body&&typeof ResizeObserver=="function"?(_r=new ResizeObserver(function(){setTimeout(Sr)}),_r.observe(Q)):window.addEventListener("resize",Sr,!1);function Bt(){_r?_r.disconnect():window.removeEventListener("resize",Sr),Q.removeChild(qt)}return Sr(),{canvas:qt,onDestroy:Bt}}function ii(Q,de){function st(qt){try{return Q.getContext(qt,de)}catch(Sr){return null}}return st("webgl")||st("experimental-webgl")||st("webgl-experimental")}function pi(Q){return typeof Q.nodeName=="string"&&typeof Q.appendChild=="function"&&typeof Q.getBoundingClientRect=="function"}function Si(Q){return typeof Q.drawArrays=="function"||typeof Q.drawElements=="function"}function wa(Q){return typeof Q=="string"?Q.split():(B(Array.isArray(Q),"invalid extension array"),Q)}function lo(Q){return typeof Q=="string"?(B(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Q)):Q}function Lo(Q){var de=Q||{},st,qt,Sr,_r,Bt={},Ur=[],$r=[],tn=typeof window=="undefined"?1:window.devicePixelRatio,Kr=!1,nn=function(rr){rr&&B.raise(rr)},mn=function(){};if(typeof de=="string"?(B(typeof document!="undefined","selector queries only supported in DOM enviroments"),st=document.querySelector(de),B(st,"invalid query string for element")):typeof de=="object"?pi(de)?st=de:Si(de)?(_r=de,Sr=_r.canvas):(B.constructor(de),"gl"in de?_r=de.gl:"canvas"in de?Sr=lo(de.canvas):"container"in de&&(qt=lo(de.container)),"attributes"in de&&(Bt=de.attributes,B.type(Bt,"object","invalid context attributes")),"extensions"in de&&(Ur=wa(de.extensions)),"optionalExtensions"in de&&($r=wa(de.optionalExtensions)),"onDone"in de&&(B.type(de.onDone,"function","invalid or missing onDone callback"),nn=de.onDone),"profile"in de&&(Kr=!!de.profile),"pixelRatio"in de&&(tn=+de.pixelRatio,B(tn>0,"invalid pixel ratio"))):B.raise("invalid arguments to regl"),st&&(st.nodeName.toLowerCase()==="canvas"?Sr=st:qt=st),!_r){if(!Sr){B(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var sn=An(qt||document.body,nn,tn);if(!sn)return null;Sr=sn.canvas,mn=sn.onDestroy}Bt.premultipliedAlpha===void 0&&(Bt.premultipliedAlpha=!0),_r=ii(Sr,Bt)}return _r?{gl:_r,canvas:Sr,container:qt,extensions:Ur,optionalExtensions:$r,pixelRatio:tn,profile:Kr,onDone:nn,onDestroy:mn}:(mn(),nn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function as(Q,de){var st={};function qt(Bt){B.type(Bt,"string","extension name must be string");var Ur=Bt.toLowerCase(),$r;try{$r=st[Ur]=Q.getExtension(Ur)}catch(tn){}return!!$r}for(var Sr=0;Sr<de.extensions.length;++Sr){var _r=de.extensions[Sr];if(!qt(_r))return de.onDestroy(),de.onDone('"'+_r+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return de.optionalExtensions.forEach(qt),{extensions:st,restore:function(){Object.keys(st).forEach(function(Ur){if(st[Ur]&&!qt(Ur))throw new Error("(regl): error restoring extension "+Ur)})}}}function Pi(Q,de){for(var st=Array(Q),qt=0;qt<Q;++qt)st[qt]=de(qt);return st}var re=5120,J=5121,me=5122,we=5123,ze=5124,mt=5125,Tt=5126;function xe(Q){for(var de=16;de<=1<<28;de*=16)if(Q<=de)return de;return 0}function Qe(Q){var de,st;return de=(Q>65535)<<4,Q>>>=de,st=(Q>255)<<3,Q>>>=st,de|=st,st=(Q>15)<<2,Q>>>=st,de|=st,st=(Q>3)<<1,Q>>>=st,de|=st,de|Q>>1}function Nt(){var Q=Pi(8,function(){return[]});function de(_r){var Bt=xe(_r),Ur=Q[Qe(Bt)>>2];return Ur.length>0?Ur.pop():new ArrayBuffer(Bt)}function st(_r){Q[Qe(_r.byteLength)>>2].push(_r)}function qt(_r,Bt){var Ur=null;switch(_r){case re:Ur=new Int8Array(de(Bt),0,Bt);break;case J:Ur=new Uint8Array(de(Bt),0,Bt);break;case me:Ur=new Int16Array(de(2*Bt),0,Bt);break;case we:Ur=new Uint16Array(de(2*Bt),0,Bt);break;case ze:Ur=new Int32Array(de(4*Bt),0,Bt);break;case mt:Ur=new Uint32Array(de(4*Bt),0,Bt);break;case Tt:Ur=new Float32Array(de(4*Bt),0,Bt);break;default:return null}return Ur.length!==Bt?Ur.subarray(0,Bt):Ur}function Sr(_r){st(_r.buffer)}return{alloc:de,free:st,allocType:qt,freeType:Sr}}var wr=Nt();wr.zero=Nt();var Vr=3408,pr=3410,De=3411,et=3412,Lt=3413,ut=3414,Te=3415,dn=33901,yn=33902,ci=3379,vn=3386,Ai=34921,Zi=36347,Bi=36348,$i=35661,zi=35660,$o=34930,Ii=36349,ja=34076,Wi=34024,Ni=7936,di=7937,ao=7938,Bs=35724,wo=34047,Yo=36063,il=34852,Oo=3553,Ea=34067,al=34069,Ro=33984,Oa=6408,Ko=5126,ca=5121,Eo=36160,qo=36053,ol=36064,Qo=16384,sl=function(de,st){var qt=1;st.ext_texture_filter_anisotropic&&(qt=de.getParameter(wo));var Sr=1,_r=1;st.webgl_draw_buffers&&(Sr=de.getParameter(il),_r=de.getParameter(Yo));var Bt=!!st.oes_texture_float;if(Bt){var Ur=de.createTexture();de.bindTexture(Oo,Ur),de.texImage2D(Oo,0,Oa,1,1,0,Oa,Ko,null);var $r=de.createFramebuffer();if(de.bindFramebuffer(Eo,$r),de.framebufferTexture2D(Eo,ol,Oo,Ur,0),de.bindTexture(Oo,null),de.checkFramebufferStatus(Eo)!==qo)Bt=!1;else{de.viewport(0,0,1,1),de.clearColor(1,0,0,1),de.clear(Qo);var tn=wr.allocType(Ko,4);de.readPixels(0,0,1,1,Oa,Ko,tn),de.getError()?Bt=!1:(de.deleteFramebuffer($r),de.deleteTexture(Ur),Bt=tn[0]===1),wr.freeType(tn)}}var Kr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),nn=!0;if(!Kr){var mn=de.createTexture(),sn=wr.allocType(ca,36);de.activeTexture(Ro),de.bindTexture(Ea,mn),de.texImage2D(al,0,Oa,3,3,0,Oa,ca,sn),wr.freeType(sn),de.bindTexture(Ea,null),de.deleteTexture(mn),nn=!de.getError()}return{colorBits:[de.getParameter(pr),de.getParameter(De),de.getParameter(et),de.getParameter(Lt)],depthBits:de.getParameter(ut),stencilBits:de.getParameter(Te),subpixelBits:de.getParameter(Vr),extensions:Object.keys(st).filter(function(Yr){return!!st[Yr]}),maxAnisotropic:qt,maxDrawbuffers:Sr,maxColorAttachments:_r,pointSizeDims:de.getParameter(dn),lineWidthDims:de.getParameter(yn),maxViewportDims:de.getParameter(vn),maxCombinedTextureUnits:de.getParameter($i),maxCubeMapSize:de.getParameter(ja),maxRenderbufferSize:de.getParameter(Wi),maxTextureUnits:de.getParameter($o),maxTextureSize:de.getParameter(ci),maxAttributes:de.getParameter(Ai),maxVertexUniforms:de.getParameter(Zi),maxVertexTextureUnits:de.getParameter(zi),maxVaryingVectors:de.getParameter(Bi),maxFragmentUniforms:de.getParameter(Ii),glsl:de.getParameter(Bs),renderer:de.getParameter(di),vendor:de.getParameter(Ni),version:de.getParameter(ao),readFloat:Bt,npotTextureCube:nn}};function oo(Q){return!!Q&&typeof Q=="object"&&Array.isArray(Q.shape)&&Array.isArray(Q.stride)&&typeof Q.offset=="number"&&Q.shape.length===Q.stride.length&&(Array.isArray(Q.data)||D(Q.data))}var qi=function(de){return Object.keys(de).map(function(st){return de[st]})},pt={shape:ji,flatten:Cn};function pe(Q,de,st){for(var qt=0;qt<de;++qt)st[qt]=Q[qt]}function Ke(Q,de,st,qt){for(var Sr=0,_r=0;_r<de;++_r)for(var Bt=Q[_r],Ur=0;Ur<st;++Ur)qt[Sr++]=Bt[Ur]}function ar(Q,de,st,qt,Sr,_r){for(var Bt=_r,Ur=0;Ur<de;++Ur)for(var $r=Q[Ur],tn=0;tn<st;++tn)for(var Kr=$r[tn],nn=0;nn<qt;++nn)Sr[Bt++]=Kr[nn]}function qr(Q,de,st,qt,Sr){for(var _r=1,Bt=st+1;Bt<de.length;++Bt)_r*=de[Bt];var Ur=de[st];if(de.length-st==4){var $r=de[st+1],tn=de[st+2],Kr=de[st+3];for(Bt=0;Bt<Ur;++Bt)ar(Q[Bt],$r,tn,Kr,qt,Sr),Sr+=_r}else for(Bt=0;Bt<Ur;++Bt)qr(Q[Bt],de,st+1,qt,Sr),Sr+=_r}function Cn(Q,de,st,qt){var Sr=1;if(de.length)for(var _r=0;_r<de.length;++_r)Sr*=de[_r];else Sr=0;var Bt=qt||wr.allocType(st,Sr);switch(de.length){case 0:break;case 1:pe(Q,de[0],Bt);break;case 2:Ke(Q,de[0],de[1],Bt);break;case 3:ar(Q,de[0],de[1],de[2],Bt,0);break;default:qr(Q,de,0,Bt,0)}return Bt}function ji(Q){for(var de=[],st=Q;st.length;st=st[0])de.push(st.length);return de}var ka={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},So=5120,os=5122,Cs=5124,uu=5121,Bf=5123,Ml=5125,lp=5126,rc=5126,Ra={int8:So,int16:os,int32:Cs,uint8:uu,uint16:Bf,uint32:Ml,float:lp,float32:rc},ul=35048,ll=35040,lu={dynamic:ul,stream:ll,static:35044},xu=pt.flatten,ju=pt.shape,af=35044,go=35040,Xa=5121,nc=5126,Ui=[];Ui[5120]=1,Ui[5122]=2,Ui[5124]=4,Ui[5121]=1,Ui[5123]=2,Ui[5125]=4,Ui[5126]=4;function zu(Q){return ka[Object.prototype.toString.call(Q)]|0}function Uu(Q,de){for(var st=0;st<de.length;++st)Q[st]=de[st]}function Rc(Q,de,st,qt,Sr,_r,Bt){for(var Ur=0,$r=0;$r<st;++$r)for(var tn=0;tn<qt;++tn)Q[Ur++]=de[Sr*$r+_r*tn+Bt]}function Ah(Q,de,st,qt){var Sr=0,_r={};function Bt(rr){this.id=Sr++,this.buffer=Q.createBuffer(),this.type=rr,this.usage=af,this.byteLength=0,this.dimension=1,this.dtype=Xa,this.persistentData=null,st.profile&&(this.stats={size:0})}Bt.prototype.bind=function(){Q.bindBuffer(this.type,this.buffer)},Bt.prototype.destroy=function(){mn(this)};var Ur=[];function $r(rr,Qt){var Wr=Ur.pop();return Wr||(Wr=new Bt(rr)),Wr.bind(),nn(Wr,Qt,go,0,1,!1),Wr}function tn(rr){Ur.push(rr)}function Kr(rr,Qt,Wr){rr.byteLength=Qt.byteLength,Q.bufferData(rr.type,Qt,Wr)}function nn(rr,Qt,Wr,bn,xr,Zn){var jr;if(rr.usage=Wr,Array.isArray(Qt)){if(rr.dtype=bn||nc,Qt.length>0){var an;if(Array.isArray(Qt[0])){jr=ju(Qt);for(var Lr=1,un=1;un<jr.length;++un)Lr*=jr[un];rr.dimension=Lr,an=xu(Qt,jr,rr.dtype),Kr(rr,an,Wr),Zn?rr.persistentData=an:wr.freeType(an)}else if(typeof Qt[0]=="number"){rr.dimension=xr;var $n=wr.allocType(rr.dtype,Qt.length);Uu($n,Qt),Kr(rr,$n,Wr),Zn?rr.persistentData=$n:wr.freeType($n)}else D(Qt[0])?(rr.dimension=Qt[0].length,rr.dtype=bn||zu(Qt[0])||nc,an=xu(Qt,[Qt.length,Qt[0].length],rr.dtype),Kr(rr,an,Wr),Zn?rr.persistentData=an:wr.freeType(an)):B.raise("invalid buffer data")}}else if(D(Qt))rr.dtype=bn||zu(Qt),rr.dimension=xr,Kr(rr,Qt,Wr),Zn&&(rr.persistentData=new Uint8Array(new Uint8Array(Qt.buffer)));else if(oo(Qt)){jr=Qt.shape;var bi=Qt.stride,fn=Qt.offset,Gr=0,Pr=0,Qn=0,Vi=0;jr.length===1?(Gr=jr[0],Pr=1,Qn=bi[0],Vi=0):jr.length===2?(Gr=jr[0],Pr=jr[1],Qn=bi[0],Vi=bi[1]):B.raise("invalid shape"),rr.dtype=bn||zu(Qt.data)||nc,rr.dimension=Pr;var En=wr.allocType(rr.dtype,Gr*Pr);Rc(En,Qt.data,Gr,Pr,Qn,Vi,fn),Kr(rr,En,Wr),Zn?rr.persistentData=En:wr.freeType(En)}else Qt instanceof ArrayBuffer?(rr.dtype=Xa,rr.dimension=xr,Kr(rr,Qt,Wr),Zn&&(rr.persistentData=new Uint8Array(new Uint8Array(Qt)))):B.raise("invalid buffer data")}function mn(rr){de.bufferCount--,qt(rr);var Qt=rr.buffer;B(Qt,"buffer must not be deleted already"),Q.deleteBuffer(Qt),rr.buffer=null,delete _r[rr.id]}function sn(rr,Qt,Wr,bn){de.bufferCount++;var xr=new Bt(Qt);_r[xr.id]=xr;function Zn(Lr){var un=af,$n=null,bi=0,fn=0,Gr=1;return Array.isArray(Lr)||D(Lr)||oo(Lr)||Lr instanceof ArrayBuffer?$n=Lr:typeof Lr=="number"?bi=Lr|0:Lr&&(B.type(Lr,"object","buffer arguments must be an object, a number or an array"),"data"in Lr&&(B($n===null||Array.isArray($n)||D($n)||oo($n),"invalid data for buffer"),$n=Lr.data),"usage"in Lr&&(B.parameter(Lr.usage,lu,"invalid buffer usage"),un=lu[Lr.usage]),"type"in Lr&&(B.parameter(Lr.type,Ra,"invalid buffer type"),fn=Ra[Lr.type]),"dimension"in Lr&&(B.type(Lr.dimension,"number","invalid dimension"),Gr=Lr.dimension|0),"length"in Lr&&(B.nni(bi,"buffer length must be a nonnegative integer"),bi=Lr.length|0)),xr.bind(),$n?nn(xr,$n,un,fn,Gr,bn):(bi&&Q.bufferData(xr.type,bi,un),xr.dtype=fn||Xa,xr.usage=un,xr.dimension=Gr,xr.byteLength=bi),st.profile&&(xr.stats.size=xr.byteLength*Ui[xr.dtype]),Zn}function jr(Lr,un){B(un+Lr.byteLength<=xr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Lr.byteLength+" starting from offset "+un+" to a buffer of size "+xr.byteLength),Q.bufferSubData(xr.type,un,Lr)}function an(Lr,un){var $n=(un||0)|0,bi;if(xr.bind(),D(Lr)||Lr instanceof ArrayBuffer)jr(Lr,$n);else if(Array.isArray(Lr)){if(Lr.length>0)if(typeof Lr[0]=="number"){var fn=wr.allocType(xr.dtype,Lr.length);Uu(fn,Lr),jr(fn,$n),wr.freeType(fn)}else if(Array.isArray(Lr[0])||D(Lr[0])){bi=ju(Lr);var Gr=xu(Lr,bi,xr.dtype);jr(Gr,$n),wr.freeType(Gr)}else B.raise("invalid buffer data")}else if(oo(Lr)){bi=Lr.shape;var Pr=Lr.stride,Qn=0,Vi=0,En=0,wi=0;bi.length===1?(Qn=bi[0],Vi=1,En=Pr[0],wi=0):bi.length===2?(Qn=bi[0],Vi=bi[1],En=Pr[0],wi=Pr[1]):B.raise("invalid shape");var gi=Array.isArray(Lr.data)?xr.dtype:zu(Lr.data),si=wr.allocType(gi,Qn*Vi);Rc(si,Lr.data,Qn,Vi,En,wi,Lr.offset),jr(si,$n),wr.freeType(si)}else B.raise("invalid data for buffer subdata");return Zn}return Wr||Zn(rr),Zn._reglType="buffer",Zn._buffer=xr,Zn.subdata=an,st.profile&&(Zn.stats=xr.stats),Zn.destroy=function(){mn(xr)},Zn}function Yr(){qi(_r).forEach(function(rr){rr.buffer=Q.createBuffer(),Q.bindBuffer(rr.type,rr.buffer),Q.bufferData(rr.type,rr.persistentData||rr.byteLength,rr.usage)})}return st.profile&&(de.getTotalBufferSize=function(){var rr=0;return Object.keys(_r).forEach(function(Qt){rr+=_r[Qt].stats.size}),rr}),{create:sn,createStream:$r,destroyStream:tn,clear:function(){qi(_r).forEach(mn),Ur.forEach(mn)},getBuffer:function(Qt){return Qt&&Qt._buffer instanceof Bt?Qt._buffer:null},restore:Yr,_initBuffer:nn}}var Th=0,Ch=0,cp=1,Lf=1,wh=4,Eu=4,eu={points:Th,point:Ch,lines:cp,line:Lf,triangles:wh,triangle:Eu,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},cr=0,hn=1,ic=4,Pl=5120,tu=5121,Il=5122,cu=5123,cl=5124,ru=5125,fl=34963,Dl=35040,fp=35044;function hp(Q,de,st,qt){var Sr={},_r=0,Bt={uint8:tu,uint16:cu};de.oes_element_index_uint&&(Bt.uint32=ru);function Ur(Yr){this.id=_r++,Sr[this.id]=this,this.buffer=Yr,this.primType=ic,this.vertCount=0,this.type=0}Ur.prototype.bind=function(){this.buffer.bind()};var $r=[];function tn(Yr){var rr=$r.pop();return rr||(rr=new Ur(st.create(null,fl,!0,!1)._buffer)),nn(rr,Yr,Dl,-1,-1,0,0),rr}function Kr(Yr){$r.push(Yr)}function nn(Yr,rr,Qt,Wr,bn,xr,Zn){Yr.buffer.bind();var jr;if(rr){var an=Zn;!Zn&&(!D(rr)||oo(rr)&&!D(rr.data))&&(an=de.oes_element_index_uint?ru:cu),st._initBuffer(Yr.buffer,rr,Qt,an,3)}else Q.bufferData(fl,xr,Qt),Yr.buffer.dtype=jr||tu,Yr.buffer.usage=Qt,Yr.buffer.dimension=3,Yr.buffer.byteLength=xr;if(jr=Zn,!Zn){switch(Yr.buffer.dtype){case tu:case Pl:jr=tu;break;case cu:case Il:jr=cu;break;case ru:case cl:jr=ru;break;default:B.raise("unsupported type for element array")}Yr.buffer.dtype=jr}Yr.type=jr,B(jr!==ru||!!de.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Lr=bn;Lr<0&&(Lr=Yr.buffer.byteLength,jr===cu?Lr>>=1:jr===ru&&(Lr>>=2)),Yr.vertCount=Lr;var un=Wr;if(Wr<0){un=ic;var $n=Yr.buffer.dimension;$n===1&&(un=cr),$n===2&&(un=hn),$n===3&&(un=ic)}Yr.primType=un}function mn(Yr){qt.elementsCount--,B(Yr.buffer!==null,"must not double destroy elements"),delete Sr[Yr.id],Yr.buffer.destroy(),Yr.buffer=null}function sn(Yr,rr){var Qt=st.create(null,fl,!0),Wr=new Ur(Qt._buffer);qt.elementsCount++;function bn(xr){if(!xr)Qt(),Wr.primType=ic,Wr.vertCount=0,Wr.type=tu;else if(typeof xr=="number")Qt(xr),Wr.primType=ic,Wr.vertCount=xr|0,Wr.type=tu;else{var Zn=null,jr=fp,an=-1,Lr=-1,un=0,$n=0;Array.isArray(xr)||D(xr)||oo(xr)?Zn=xr:(B.type(xr,"object","invalid arguments for elements"),"data"in xr&&(Zn=xr.data,B(Array.isArray(Zn)||D(Zn)||oo(Zn),"invalid data for element buffer")),"usage"in xr&&(B.parameter(xr.usage,lu,"invalid element buffer usage"),jr=lu[xr.usage]),"primitive"in xr&&(B.parameter(xr.primitive,eu,"invalid element buffer primitive"),an=eu[xr.primitive]),"count"in xr&&(B(typeof xr.count=="number"&&xr.count>=0,"invalid vertex count for elements"),Lr=xr.count|0),"type"in xr&&(B.parameter(xr.type,Bt,"invalid buffer type"),$n=Bt[xr.type]),"length"in xr?un=xr.length|0:(un=Lr,$n===cu||$n===Il?un*=2:($n===ru||$n===cl)&&(un*=4))),nn(Wr,Zn,jr,an,Lr,un,$n)}return bn}return bn(Yr),bn._reglType="elements",bn._elements=Wr,bn.subdata=function(xr,Zn){return Qt.subdata(xr,Zn),bn},bn.destroy=function(){mn(Wr)},bn}return{create:sn,createStream:tn,destroyStream:Kr,getElements:function(rr){return typeof rr=="function"&&rr._elements instanceof Ur?rr._elements:null},clear:function(){qi(Sr).forEach(mn)}}}var ba=new Float32Array(1),ld=new Uint32Array(ba.buffer),Nf=5123;function Oh(Q){for(var de=wr.allocType(Nf,Q.length),st=0;st<Q.length;++st)if(isNaN(Q[st]))de[st]=65535;else if(Q[st]===Infinity)de[st]=31744;else if(Q[st]===-Infinity)de[st]=64512;else{ba[0]=Q[st];var qt=ld[0],Sr=qt>>>31<<15,_r=(qt<<1>>>24)-127,Bt=qt>>13&(1<<10)-1;if(_r<-24)de[st]=Sr;else if(_r<-14){var Ur=-14-_r;de[st]=Sr+(Bt+(1<<10)>>Ur)}else _r>15?de[st]=Sr+31744:de[st]=Sr+(_r+15<<10)+Bt}return de}function co(Q){return Array.isArray(Q)||D(Q)}var Rh=function(de){return!(de&de-1)&&!!de},pp=34467,Ls=3553,hl=34067,Vu=34069,kl=6408,jf=6406,Mc=6407,Su=6409,of=6410,Fl=32854,pl=32855,Mh=36194,sf=32819,Fa=32820,zf=33635,cd=34042,Bl=6402,uf=34041,Ph=35904,Uf=35906,dl=36193,Ll=33776,ac=33777,Pc=33778,oc=33779,fi=35986,Ih=35987,sc=34798,Ws=35840,lf=35841,Dh=35842,kh=35843,Nl=36196,Hu=5121,Ic=5123,Dc=5125,Wu=5126,Vf=10242,Hf=10243,Fh=10497,Wf=33071,dp=33648,Gf=10240,Xf=10241,cf=9728,Bh=9729,vl=9984,Lh=9985,jl=9986,Ba=9987,Zf=33170,Gu=4352,zl=4353,Qi=4354,La=34046,Ns=3317,ff=37440,kc=37441,$f=37443,hf=37444,Nh=33984,Yf=[vl,jl,Lh,Ba],Ul=[0,Su,of,Mc,kl],V={};V[Su]=V[jf]=V[Bl]=1,V[uf]=V[of]=2,V[Mc]=V[Ph]=3,V[kl]=V[Uf]=4;function Va(Q){return"[object "+Q+"]"}var pf=Va("HTMLCanvasElement"),df=Va("OffscreenCanvas"),yo=Va("CanvasRenderingContext2D"),On=Va("ImageBitmap"),ss=Va("HTMLImageElement"),vf=Va("HTMLVideoElement"),Fc=Object.keys(ka).concat([pf,df,yo,On,ss,vf]),ms=[];ms[Hu]=1,ms[Wu]=4,ms[dl]=2,ms[Ic]=2,ms[Dc]=4;var Ma=[];Ma[Fl]=2,Ma[pl]=2,Ma[Mh]=2,Ma[uf]=4,Ma[Ll]=.5,Ma[ac]=.5,Ma[Pc]=1,Ma[oc]=1,Ma[fi]=.5,Ma[Ih]=1,Ma[sc]=1,Ma[Ws]=.5,Ma[lf]=.25,Ma[Dh]=.5,Ma[kh]=.25,Ma[Nl]=.5;function mf(Q){return Array.isArray(Q)&&(Q.length===0||typeof Q[0]=="number")}function cn(Q){if(!Array.isArray(Q))return!1;var de=Q.length;return!(de===0||!co(Q[0]))}function Vl(Q){return Object.prototype.toString.call(Q)}function gf(Q){return Vl(Q)===pf}function Kf(Q){return Vl(Q)===df}function fu(Q){return Vl(Q)===yo}function Sa(Q){return Vl(Q)===On}function jh(Q){return Vl(Q)===ss}function yf(Q){return Vl(Q)===vf}function ws(Q){if(!Q)return!1;var de=Vl(Q);return Fc.indexOf(de)>=0?!0:mf(Q)||cn(Q)||oo(Q)}function Xu(Q){return ka[Object.prototype.toString.call(Q)]|0}function fd(Q,de){var st=de.length;switch(Q.type){case Hu:case Ic:case Dc:case Wu:var qt=wr.allocType(Q.type,st);qt.set(de),Q.data=qt;break;case dl:Q.data=Oh(de);break;default:B.raise("unsupported texture type, must specify a typed array")}}function Zu(Q,de){return wr.allocType(Q.type===dl?Wu:Q.type,de)}function Bc(Q,de){Q.type===dl?(Q.data=Oh(de),wr.freeType(de)):Q.data=de}function Lc(Q,de,st,qt,Sr,_r){for(var Bt=Q.width,Ur=Q.height,$r=Q.channels,tn=Bt*Ur*$r,Kr=Zu(Q,tn),nn=0,mn=0;mn<Ur;++mn)for(var sn=0;sn<Bt;++sn)for(var Yr=0;Yr<$r;++Yr)Kr[nn++]=de[st*sn+qt*mn+Sr*Yr+_r];Bc(Q,Kr)}function Gs(Q,de,st,qt,Sr,_r){var Bt;if(typeof Ma[Q]!="undefined"?Bt=Ma[Q]:Bt=V[Q]*ms[de],_r&&(Bt*=6),Sr){for(var Ur=0,$r=st;$r>=1;)Ur+=Bt*$r*$r,$r/=2;return Ur}else return Bt*st*qt}function js(Q,de,st,qt,Sr,_r,Bt){var Ur={"don't care":Gu,"dont care":Gu,nice:Qi,fast:zl},$r={repeat:Fh,clamp:Wf,mirror:dp},tn={nearest:cf,linear:Bh},Kr=N({mipmap:Ba,"nearest mipmap nearest":vl,"linear mipmap nearest":Lh,"nearest mipmap linear":jl,"linear mipmap linear":Ba},tn),nn={none:0,browser:hf},mn={uint8:Hu,rgba4:sf,rgb565:zf,"rgb5 a1":Fa},sn={alpha:jf,luminance:Su,"luminance alpha":of,rgb:Mc,rgba:kl,rgba4:Fl,"rgb5 a1":pl,rgb565:Mh},Yr={};de.ext_srgb&&(sn.srgb=Ph,sn.srgba=Uf),de.oes_texture_float&&(mn.float32=mn.float=Wu),de.oes_texture_half_float&&(mn.float16=mn["half float"]=dl),de.webgl_depth_texture&&(N(sn,{depth:Bl,"depth stencil":uf}),N(mn,{uint16:Ic,uint32:Dc,"depth stencil":cd})),de.webgl_compressed_texture_s3tc&&N(Yr,{"rgb s3tc dxt1":Ll,"rgba s3tc dxt1":ac,"rgba s3tc dxt3":Pc,"rgba s3tc dxt5":oc}),de.webgl_compressed_texture_atc&&N(Yr,{"rgb atc":fi,"rgba atc explicit alpha":Ih,"rgba atc interpolated alpha":sc}),de.webgl_compressed_texture_pvrtc&&N(Yr,{"rgb pvrtc 4bppv1":Ws,"rgb pvrtc 2bppv1":lf,"rgba pvrtc 4bppv1":Dh,"rgba pvrtc 2bppv1":kh}),de.webgl_compressed_texture_etc1&&(Yr["rgb etc1"]=Nl);var rr=Array.prototype.slice.call(Q.getParameter(pp));Object.keys(Yr).forEach(function(Ze){var fr=Yr[Ze];rr.indexOf(fr)>=0&&(sn[Ze]=fr)});var Qt=Object.keys(sn);st.textureFormats=Qt;var Wr=[];Object.keys(sn).forEach(function(Ze){var fr=sn[Ze];Wr[fr]=Ze});var bn=[];Object.keys(mn).forEach(function(Ze){var fr=mn[Ze];bn[fr]=Ze});var xr=[];Object.keys(tn).forEach(function(Ze){var fr=tn[Ze];xr[fr]=Ze});var Zn=[];Object.keys(Kr).forEach(function(Ze){var fr=Kr[Ze];Zn[fr]=Ze});var jr=[];Object.keys($r).forEach(function(Ze){var fr=$r[Ze];jr[fr]=Ze});var an=Qt.reduce(function(Ze,fr){var Kt=sn[fr];return Kt===Su||Kt===jf||Kt===Su||Kt===of||Kt===Bl||Kt===uf||de.ext_srgb&&(Kt===Ph||Kt===Uf)?Ze[Kt]=Kt:Kt===pl||fr.indexOf("rgba")>=0?Ze[Kt]=kl:Ze[Kt]=Mc,Ze},{});function Lr(){this.internalformat=kl,this.format=kl,this.type=Hu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=hf,this.width=0,this.height=0,this.channels=0}function un(Ze,fr){Ze.internalformat=fr.internalformat,Ze.format=fr.format,Ze.type=fr.type,Ze.compressed=fr.compressed,Ze.premultiplyAlpha=fr.premultiplyAlpha,Ze.flipY=fr.flipY,Ze.unpackAlignment=fr.unpackAlignment,Ze.colorSpace=fr.colorSpace,Ze.width=fr.width,Ze.height=fr.height,Ze.channels=fr.channels}function $n(Ze,fr){if(!(typeof fr!="object"||!fr)){if("premultiplyAlpha"in fr&&(B.type(fr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ze.premultiplyAlpha=fr.premultiplyAlpha),"flipY"in fr&&(B.type(fr.flipY,"boolean","invalid texture flip"),Ze.flipY=fr.flipY),"alignment"in fr&&(B.oneOf(fr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ze.unpackAlignment=fr.alignment),"colorSpace"in fr&&(B.parameter(fr.colorSpace,nn,"invalid colorSpace"),Ze.colorSpace=nn[fr.colorSpace]),"type"in fr){var Kt=fr.type;B(de.oes_texture_float||!(Kt==="float"||Kt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),B(de.oes_texture_half_float||!(Kt==="half float"||Kt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),B(de.webgl_depth_texture||!(Kt==="uint16"||Kt==="uint32"||Kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),B.parameter(Kt,mn,"invalid texture type"),Ze.type=mn[Kt]}var Sn=Ze.width,Ri=Ze.height,xa=Ze.channels,ye=!1;"shape"in fr?(B(Array.isArray(fr.shape)&&fr.shape.length>=2,"shape must be an array"),Sn=fr.shape[0],Ri=fr.shape[1],fr.shape.length===3&&(xa=fr.shape[2],B(xa>0&&xa<=4,"invalid number of channels"),ye=!0),B(Sn>=0&&Sn<=st.maxTextureSize,"invalid width"),B(Ri>=0&&Ri<=st.maxTextureSize,"invalid height")):("radius"in fr&&(Sn=Ri=fr.radius,B(Sn>=0&&Sn<=st.maxTextureSize,"invalid radius")),"width"in fr&&(Sn=fr.width,B(Sn>=0&&Sn<=st.maxTextureSize,"invalid width")),"height"in fr&&(Ri=fr.height,B(Ri>=0&&Ri<=st.maxTextureSize,"invalid height")),"channels"in fr&&(xa=fr.channels,B(xa>0&&xa<=4,"invalid number of channels"),ye=!0)),Ze.width=Sn|0,Ze.height=Ri|0,Ze.channels=xa|0;var ke=!1;if("format"in fr){var it=fr.format;B(de.webgl_depth_texture||!(it==="depth"||it==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),B.parameter(it,sn,"invalid texture format");var er=Ze.internalformat=sn[it];Ze.format=an[er],it in mn&&("type"in fr||(Ze.type=mn[it])),it in Yr&&(Ze.compressed=!0),ke=!0}!ye&&ke?Ze.channels=V[Ze.format]:ye&&!ke?Ze.channels!==Ul[Ze.format]&&(Ze.format=Ze.internalformat=Ul[Ze.channels]):ke&&ye&&B(Ze.channels===V[Ze.format],"number of channels inconsistent with specified format")}}function bi(Ze){Q.pixelStorei(ff,Ze.flipY),Q.pixelStorei(kc,Ze.premultiplyAlpha),Q.pixelStorei($f,Ze.colorSpace),Q.pixelStorei(Ns,Ze.unpackAlignment)}function fn(){Lr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Gr(Ze,fr){var Kt=null;if(ws(fr)?Kt=fr:fr&&(B.type(fr,"object","invalid pixel data type"),$n(Ze,fr),"x"in fr&&(Ze.xOffset=fr.x|0),"y"in fr&&(Ze.yOffset=fr.y|0),ws(fr.data)&&(Kt=fr.data)),B(!Ze.compressed||Kt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),fr.copy){B(!Kt,"can not specify copy and data field for the same texture");var Sn=Sr.viewportWidth,Ri=Sr.viewportHeight;Ze.width=Ze.width||Sn-Ze.xOffset,Ze.height=Ze.height||Ri-Ze.yOffset,Ze.needsCopy=!0,B(Ze.xOffset>=0&&Ze.xOffset<Sn&&Ze.yOffset>=0&&Ze.yOffset<Ri&&Ze.width>0&&Ze.width<=Sn&&Ze.height>0&&Ze.height<=Ri,"copy texture read out of bounds")}else if(!Kt)Ze.width=Ze.width||1,Ze.height=Ze.height||1,Ze.channels=Ze.channels||4;else if(D(Kt))Ze.channels=Ze.channels||4,Ze.data=Kt,!("type"in fr)&&Ze.type===Hu&&(Ze.type=Xu(Kt));else if(mf(Kt))Ze.channels=Ze.channels||4,fd(Ze,Kt),Ze.alignment=1,Ze.needsFree=!0;else if(oo(Kt)){var xa=Kt.data;!Array.isArray(xa)&&Ze.type===Hu&&(Ze.type=Xu(xa));var ye=Kt.shape,ke=Kt.stride,it,er,$t,gt,Et,Ct;ye.length===3?($t=ye[2],Ct=ke[2]):(B(ye.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$t=1,Ct=1),it=ye[0],er=ye[1],gt=ke[0],Et=ke[1],Ze.alignment=1,Ze.width=it,Ze.height=er,Ze.channels=$t,Ze.format=Ze.internalformat=Ul[$t],Ze.needsFree=!0,Lc(Ze,xa,gt,Et,Ct,Kt.offset)}else if(gf(Kt)||Kf(Kt)||fu(Kt))gf(Kt)||Kf(Kt)?Ze.element=Kt:Ze.element=Kt.canvas,Ze.width=Ze.element.width,Ze.height=Ze.element.height,Ze.channels=4;else if(Sa(Kt))Ze.element=Kt,Ze.width=Kt.width,Ze.height=Kt.height,Ze.channels=4;else if(jh(Kt))Ze.element=Kt,Ze.width=Kt.naturalWidth,Ze.height=Kt.naturalHeight,Ze.channels=4;else if(yf(Kt))Ze.element=Kt,Ze.width=Kt.videoWidth,Ze.height=Kt.videoHeight,Ze.channels=4;else if(cn(Kt)){var Ge=Ze.width||Kt[0].length,_t=Ze.height||Kt.length,Pe=Ze.channels;co(Kt[0][0])?Pe=Pe||Kt[0][0].length:Pe=Pe||1;for(var xt=pt.shape(Kt),hr=1,vr=0;vr<xt.length;++vr)hr*=xt[vr];var Nr=Zu(Ze,hr);pt.flatten(Kt,xt,"",Nr),Bc(Ze,Nr),Ze.alignment=1,Ze.width=Ge,Ze.height=_t,Ze.channels=Pe,Ze.format=Ze.internalformat=Ul[Pe],Ze.needsFree=!0}Ze.type===Wu?B(st.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ze.type===dl&&B(st.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Pr(Ze,fr,Kt){var Sn=Ze.element,Ri=Ze.data,xa=Ze.internalformat,ye=Ze.format,ke=Ze.type,it=Ze.width,er=Ze.height;bi(Ze),Sn?Q.texImage2D(fr,Kt,ye,ye,ke,Sn):Ze.compressed?Q.compressedTexImage2D(fr,Kt,xa,it,er,0,Ri):Ze.needsCopy?(qt(),Q.copyTexImage2D(fr,Kt,ye,Ze.xOffset,Ze.yOffset,it,er,0)):Q.texImage2D(fr,Kt,ye,it,er,0,ye,ke,Ri||null)}function Qn(Ze,fr,Kt,Sn,Ri){var xa=Ze.element,ye=Ze.data,ke=Ze.internalformat,it=Ze.format,er=Ze.type,$t=Ze.width,gt=Ze.height;bi(Ze),xa?Q.texSubImage2D(fr,Ri,Kt,Sn,it,er,xa):Ze.compressed?Q.compressedTexSubImage2D(fr,Ri,Kt,Sn,ke,$t,gt,ye):Ze.needsCopy?(qt(),Q.copyTexSubImage2D(fr,Ri,Kt,Sn,Ze.xOffset,Ze.yOffset,$t,gt)):Q.texSubImage2D(fr,Ri,Kt,Sn,$t,gt,it,er,ye)}var Vi=[];function En(){return Vi.pop()||new fn}function wi(Ze){Ze.needsFree&&wr.freeType(Ze.data),fn.call(Ze),Vi.push(Ze)}function gi(){Lr.call(this),this.genMipmaps=!1,this.mipmapHint=Gu,this.mipmask=0,this.images=Array(16)}function si(Ze,fr,Kt){var Sn=Ze.images[0]=En();Ze.mipmask=1,Sn.width=Ze.width=fr,Sn.height=Ze.height=Kt,Sn.channels=Ze.channels=4}function oa(Ze,fr){var Kt=null;if(ws(fr))Kt=Ze.images[0]=En(),un(Kt,Ze),Gr(Kt,fr),Ze.mipmask=1;else if($n(Ze,fr),Array.isArray(fr.mipmap))for(var Sn=fr.mipmap,Ri=0;Ri<Sn.length;++Ri)Kt=Ze.images[Ri]=En(),un(Kt,Ze),Kt.width>>=Ri,Kt.height>>=Ri,Gr(Kt,Sn[Ri]),Ze.mipmask|=1<<Ri;else Kt=Ze.images[0]=En(),un(Kt,Ze),Gr(Kt,fr),Ze.mipmask=1;un(Ze,Ze.images[0]),Ze.compressed&&(Ze.internalformat===Ll||Ze.internalformat===ac||Ze.internalformat===Pc||Ze.internalformat===oc)&&B(Ze.width%4==0&&Ze.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Io(Ze,fr){for(var Kt=Ze.images,Sn=0;Sn<Kt.length;++Sn){if(!Kt[Sn])return;Pr(Kt[Sn],fr,Sn)}}var hs=[];function Gi(){var Ze=hs.pop()||new gi;Lr.call(Ze),Ze.mipmask=0;for(var fr=0;fr<16;++fr)Ze.images[fr]=null;return Ze}function Do(Ze){for(var fr=Ze.images,Kt=0;Kt<fr.length;++Kt)fr[Kt]&&wi(fr[Kt]),fr[Kt]=null;hs.push(Ze)}function Pa(){this.minFilter=cf,this.magFilter=cf,this.wrapS=Wf,this.wrapT=Wf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Gu}function ko(Ze,fr){if("min"in fr){var Kt=fr.min;B.parameter(Kt,Kr),Ze.minFilter=Kr[Kt],Yf.indexOf(Ze.minFilter)>=0&&!("faces"in fr)&&(Ze.genMipmaps=!0)}if("mag"in fr){var Sn=fr.mag;B.parameter(Sn,tn),Ze.magFilter=tn[Sn]}var Ri=Ze.wrapS,xa=Ze.wrapT;if("wrap"in fr){var ye=fr.wrap;typeof ye=="string"?(B.parameter(ye,$r),Ri=xa=$r[ye]):Array.isArray(ye)&&(B.parameter(ye[0],$r),B.parameter(ye[1],$r),Ri=$r[ye[0]],xa=$r[ye[1]])}else{if("wrapS"in fr){var ke=fr.wrapS;B.parameter(ke,$r),Ri=$r[ke]}if("wrapT"in fr){var it=fr.wrapT;B.parameter(it,$r),xa=$r[it]}}if(Ze.wrapS=Ri,Ze.wrapT=xa,"anisotropic"in fr){var er=fr.anisotropic;B(typeof er=="number"&&er>=1&&er<=st.maxAnisotropic,"aniso samples must be between 1 and "),Ze.anisotropic=fr.anisotropic}if("mipmap"in fr){var $t=!1;switch(typeof fr.mipmap){case"string":B.parameter(fr.mipmap,Ur,"invalid mipmap hint"),Ze.mipmapHint=Ur[fr.mipmap],Ze.genMipmaps=!0,$t=!0;break;case"boolean":$t=Ze.genMipmaps=fr.mipmap;break;case"object":B(Array.isArray(fr.mipmap),"invalid mipmap type"),Ze.genMipmaps=!1,$t=!0;break;default:B.raise("invalid mipmap type")}$t&&!("min"in fr)&&(Ze.minFilter=vl)}}function Fo(Ze,fr){Q.texParameteri(fr,Xf,Ze.minFilter),Q.texParameteri(fr,Gf,Ze.magFilter),Q.texParameteri(fr,Vf,Ze.wrapS),Q.texParameteri(fr,Hf,Ze.wrapT),de.ext_texture_filter_anisotropic&&Q.texParameteri(fr,La,Ze.anisotropic),Ze.genMipmaps&&(Q.hint(Zf,Ze.mipmapHint),Q.generateMipmap(fr))}var uo=0,ts={},Ps=st.maxTextureUnits,Vo=Array(Ps).map(function(){return null});function ki(Ze){Lr.call(this),this.mipmask=0,this.internalformat=kl,this.id=uo++,this.refCount=1,this.target=Ze,this.texture=Q.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Pa,Bt.profile&&(this.stats={size:0})}function Ss(Ze){Q.activeTexture(Nh),Q.bindTexture(Ze.target,Ze.texture)}function ha(){var Ze=Vo[0];Ze?Q.bindTexture(Ze.target,Ze.texture):Q.bindTexture(Ls,null)}function ui(Ze){var fr=Ze.texture;B(fr,"must not double destroy texture");var Kt=Ze.unit,Sn=Ze.target;Kt>=0&&(Q.activeTexture(Nh+Kt),Q.bindTexture(Sn,null),Vo[Kt]=null),Q.deleteTexture(fr),Ze.texture=null,Ze.params=null,Ze.pixels=null,Ze.refCount=0,delete ts[Ze.id],_r.textureCount--}N(ki.prototype,{bind:function(){var fr=this;fr.bindCount+=1;var Kt=fr.unit;if(Kt<0){for(var Sn=0;Sn<Ps;++Sn){var Ri=Vo[Sn];if(Ri){if(Ri.bindCount>0)continue;Ri.unit=-1}Vo[Sn]=fr,Kt=Sn;break}Kt>=Ps&&B.raise("insufficient number of texture units"),Bt.profile&&_r.maxTextureUnits<Kt+1&&(_r.maxTextureUnits=Kt+1),fr.unit=Kt,Q.activeTexture(Nh+Kt),Q.bindTexture(fr.target,fr.texture)}return Kt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ui(this)}});function Oi(Ze,fr){var Kt=new ki(Ls);ts[Kt.id]=Kt,_r.textureCount++;function Sn(ye,ke){var it=Kt.texInfo;Pa.call(it);var er=Gi();return typeof ye=="number"?typeof ke=="number"?si(er,ye|0,ke|0):si(er,ye|0,ye|0):ye?(B.type(ye,"object","invalid arguments to regl.texture"),ko(it,ye),oa(er,ye)):si(er,1,1),it.genMipmaps&&(er.mipmask=(er.width<<1)-1),Kt.mipmask=er.mipmask,un(Kt,er),B.texture2D(it,er,st),Kt.internalformat=er.internalformat,Sn.width=er.width,Sn.height=er.height,Ss(Kt),Io(er,Ls),Fo(it,Ls),ha(),Do(er),Bt.profile&&(Kt.stats.size=Gs(Kt.internalformat,Kt.type,er.width,er.height,it.genMipmaps,!1)),Sn.format=Wr[Kt.internalformat],Sn.type=bn[Kt.type],Sn.mag=xr[it.magFilter],Sn.min=Zn[it.minFilter],Sn.wrapS=jr[it.wrapS],Sn.wrapT=jr[it.wrapT],Sn}function Ri(ye,ke,it,er){B(!!ye,"must specify image data");var $t=ke|0,gt=it|0,Et=er|0,Ct=En();return un(Ct,Kt),Ct.width=0,Ct.height=0,Gr(Ct,ye),Ct.width=Ct.width||(Kt.width>>Et)-$t,Ct.height=Ct.height||(Kt.height>>Et)-gt,B(Kt.type===Ct.type&&Kt.format===Ct.format&&Kt.internalformat===Ct.internalformat,"incompatible format for texture.subimage"),B($t>=0&&gt>=0&&$t+Ct.width<=Kt.width&&gt+Ct.height<=Kt.height,"texture.subimage write out of bounds"),B(Kt.mipmask&1<<Et,"missing mipmap data"),B(Ct.data||Ct.element||Ct.needsCopy,"missing image data"),Ss(Kt),Qn(Ct,Ls,$t,gt,Et),ha(),wi(Ct),Sn}function xa(ye,ke){var it=ye|0,er=ke|0||it;if(it===Kt.width&&er===Kt.height)return Sn;Sn.width=Kt.width=it,Sn.height=Kt.height=er,Ss(Kt);for(var $t=0;Kt.mipmask>>$t;++$t){var gt=it>>$t,Et=er>>$t;if(!gt||!Et)break;Q.texImage2D(Ls,$t,Kt.format,gt,Et,0,Kt.format,Kt.type,null)}return ha(),Bt.profile&&(Kt.stats.size=Gs(Kt.internalformat,Kt.type,it,er,!1,!1)),Sn}return Sn(Ze,fr),Sn.subimage=Ri,Sn.resize=xa,Sn._reglType="texture2d",Sn._texture=Kt,Bt.profile&&(Sn.stats=Kt.stats),Sn.destroy=function(){Kt.decRef()},Sn}function ra(Ze,fr,Kt,Sn,Ri,xa){var ye=new ki(hl);ts[ye.id]=ye,_r.cubeCount++;var ke=new Array(6);function it(gt,Et,Ct,Ge,_t,Pe){var xt,hr=ye.texInfo;for(Pa.call(hr),xt=0;xt<6;++xt)ke[xt]=Gi();if(typeof gt=="number"||!gt){var vr=gt|0||1;for(xt=0;xt<6;++xt)si(ke[xt],vr,vr)}else if(typeof gt=="object")if(Et)oa(ke[0],gt),oa(ke[1],Et),oa(ke[2],Ct),oa(ke[3],Ge),oa(ke[4],_t),oa(ke[5],Pe);else if(ko(hr,gt),$n(ye,gt),"faces"in gt){var Nr=gt.faces;for(B(Array.isArray(Nr)&&Nr.length===6,"cube faces must be a length 6 array"),xt=0;xt<6;++xt)B(typeof Nr[xt]=="object"&&!!Nr[xt],"invalid input for cube map face"),un(ke[xt],ye),oa(ke[xt],Nr[xt])}else for(xt=0;xt<6;++xt)oa(ke[xt],gt);else B.raise("invalid arguments to cube map");for(un(ye,ke[0]),st.npotTextureCube||B(Rh(ye.width)&&Rh(ye.height),"your browser does not support non power or two texture dimensions"),hr.genMipmaps?ye.mipmask=(ke[0].width<<1)-1:ye.mipmask=ke[0].mipmask,B.textureCube(ye,hr,ke,st),ye.internalformat=ke[0].internalformat,it.width=ke[0].width,it.height=ke[0].height,Ss(ye),xt=0;xt<6;++xt)Io(ke[xt],Vu+xt);for(Fo(hr,hl),ha(),Bt.profile&&(ye.stats.size=Gs(ye.internalformat,ye.type,it.width,it.height,hr.genMipmaps,!0)),it.format=Wr[ye.internalformat],it.type=bn[ye.type],it.mag=xr[hr.magFilter],it.min=Zn[hr.minFilter],it.wrapS=jr[hr.wrapS],it.wrapT=jr[hr.wrapT],xt=0;xt<6;++xt)Do(ke[xt]);return it}function er(gt,Et,Ct,Ge,_t){B(!!Et,"must specify image data"),B(typeof gt=="number"&&gt===(gt|0)&&gt>=0&&gt<6,"invalid face");var Pe=Ct|0,xt=Ge|0,hr=_t|0,vr=En();return un(vr,ye),vr.width=0,vr.height=0,Gr(vr,Et),vr.width=vr.width||(ye.width>>hr)-Pe,vr.height=vr.height||(ye.height>>hr)-xt,B(ye.type===vr.type&&ye.format===vr.format&&ye.internalformat===vr.internalformat,"incompatible format for texture.subimage"),B(Pe>=0&&xt>=0&&Pe+vr.width<=ye.width&&xt+vr.height<=ye.height,"texture.subimage write out of bounds"),B(ye.mipmask&1<<hr,"missing mipmap data"),B(vr.data||vr.element||vr.needsCopy,"missing image data"),Ss(ye),Qn(vr,Vu+gt,Pe,xt,hr),ha(),wi(vr),it}function $t(gt){var Et=gt|0;if(Et!==ye.width){it.width=ye.width=Et,it.height=ye.height=Et,Ss(ye);for(var Ct=0;Ct<6;++Ct)for(var Ge=0;ye.mipmask>>Ge;++Ge)Q.texImage2D(Vu+Ct,Ge,ye.format,Et>>Ge,Et>>Ge,0,ye.format,ye.type,null);return ha(),Bt.profile&&(ye.stats.size=Gs(ye.internalformat,ye.type,it.width,it.height,!1,!0)),it}}return it(Ze,fr,Kt,Sn,Ri,xa),it.subimage=er,it.resize=$t,it._reglType="textureCube",it._texture=ye,Bt.profile&&(it.stats=ye.stats),it.destroy=function(){ye.decRef()},it}function ps(){for(var Ze=0;Ze<Ps;++Ze)Q.activeTexture(Nh+Ze),Q.bindTexture(Ls,null),Vo[Ze]=null;qi(ts).forEach(ui),_r.cubeCount=0,_r.textureCount=0}Bt.profile&&(_r.getTotalTextureSize=function(){var Ze=0;return Object.keys(ts).forEach(function(fr){Ze+=ts[fr].stats.size}),Ze});function Us(){for(var Ze=0;Ze<Ps;++Ze){var fr=Vo[Ze];fr&&(fr.bindCount=0,fr.unit=-1,Vo[Ze]=null)}qi(ts).forEach(function(Kt){Kt.texture=Q.createTexture(),Q.bindTexture(Kt.target,Kt.texture);for(var Sn=0;Sn<32;++Sn)if((Kt.mipmask&1<<Sn)!=0)if(Kt.target===Ls)Q.texImage2D(Ls,Sn,Kt.internalformat,Kt.width>>Sn,Kt.height>>Sn,0,Kt.internalformat,Kt.type,null);else for(var Ri=0;Ri<6;++Ri)Q.texImage2D(Vu+Ri,Sn,Kt.internalformat,Kt.width>>Sn,Kt.height>>Sn,0,Kt.internalformat,Kt.type,null);Fo(Kt.texInfo,Kt.target)})}return{create2D:Oi,createCube:ra,clear:ps,getTexture:function(fr){return null},restore:Us}}var Ti=36161,Xs=32854,hu=32855,Jo=36194,uc=33189,gs=36168,pu=34041,ys=35907,_f=34836,qn=34842,Fn=34843,Zs=[];Zs[Xs]=2,Zs[hu]=2,Zs[Jo]=2,Zs[uc]=2,Zs[gs]=1,Zs[pu]=4,Zs[ys]=4,Zs[_f]=16,Zs[qn]=8,Zs[Fn]=6;function us(Q,de,st){return Zs[Q]*de*st}var $s=function(de,st,qt,Sr,_r){var Bt={rgba4:Xs,rgb565:Jo,"rgb5 a1":hu,depth:uc,stencil:gs,"depth stencil":pu};st.ext_srgb&&(Bt.srgba=ys),st.ext_color_buffer_half_float&&(Bt.rgba16f=qn,Bt.rgb16f=Fn),st.webgl_color_buffer_float&&(Bt.rgba32f=_f);var Ur=[];Object.keys(Bt).forEach(function(Yr){var rr=Bt[Yr];Ur[rr]=Yr});var $r=0,tn={};function Kr(Yr){this.id=$r++,this.refCount=1,this.renderbuffer=Yr,this.format=Xs,this.width=0,this.height=0,_r.profile&&(this.stats={size:0})}Kr.prototype.decRef=function(){--this.refCount<=0&&nn(this)};function nn(Yr){var rr=Yr.renderbuffer;B(rr,"must not double destroy renderbuffer"),de.bindRenderbuffer(Ti,null),de.deleteRenderbuffer(rr),Yr.renderbuffer=null,Yr.refCount=0,delete tn[Yr.id],Sr.renderbufferCount--}function mn(Yr,rr){var Qt=new Kr(de.createRenderbuffer());tn[Qt.id]=Qt,Sr.renderbufferCount++;function Wr(xr,Zn){var jr=0,an=0,Lr=Xs;if(typeof xr=="object"&&xr){var un=xr;if("shape"in un){var $n=un.shape;B(Array.isArray($n)&&$n.length>=2,"invalid renderbuffer shape"),jr=$n[0]|0,an=$n[1]|0}else"radius"in un&&(jr=an=un.radius|0),"width"in un&&(jr=un.width|0),"height"in un&&(an=un.height|0);"format"in un&&(B.parameter(un.format,Bt,"invalid renderbuffer format"),Lr=Bt[un.format])}else typeof xr=="number"?(jr=xr|0,typeof Zn=="number"?an=Zn|0:an=jr):xr?B.raise("invalid arguments to renderbuffer constructor"):jr=an=1;if(B(jr>0&&an>0&&jr<=qt.maxRenderbufferSize&&an<=qt.maxRenderbufferSize,"invalid renderbuffer size"),!(jr===Qt.width&&an===Qt.height&&Lr===Qt.format))return Wr.width=Qt.width=jr,Wr.height=Qt.height=an,Qt.format=Lr,de.bindRenderbuffer(Ti,Qt.renderbuffer),de.renderbufferStorage(Ti,Lr,jr,an),B(de.getError()===0,"invalid render buffer format"),_r.profile&&(Qt.stats.size=us(Qt.format,Qt.width,Qt.height)),Wr.format=Ur[Qt.format],Wr}function bn(xr,Zn){var jr=xr|0,an=Zn|0||jr;return jr===Qt.width&&an===Qt.height||(B(jr>0&&an>0&&jr<=qt.maxRenderbufferSize&&an<=qt.maxRenderbufferSize,"invalid renderbuffer size"),Wr.width=Qt.width=jr,Wr.height=Qt.height=an,de.bindRenderbuffer(Ti,Qt.renderbuffer),de.renderbufferStorage(Ti,Qt.format,jr,an),B(de.getError()===0,"invalid render buffer format"),_r.profile&&(Qt.stats.size=us(Qt.format,Qt.width,Qt.height))),Wr}return Wr(Yr,rr),Wr.resize=bn,Wr._reglType="renderbuffer",Wr._renderbuffer=Qt,_r.profile&&(Wr.stats=Qt.stats),Wr.destroy=function(){Qt.decRef()},Wr}_r.profile&&(Sr.getTotalRenderbufferSize=function(){var Yr=0;return Object.keys(tn).forEach(function(rr){Yr+=tn[rr].stats.size}),Yr});function sn(){qi(tn).forEach(function(Yr){Yr.renderbuffer=de.createRenderbuffer(),de.bindRenderbuffer(Ti,Yr.renderbuffer),de.renderbufferStorage(Ti,Yr.format,Yr.width,Yr.height)}),de.bindRenderbuffer(Ti,null)}return{create:mn,clear:function(){qi(tn).forEach(nn)},restore:sn}},Za=36160,nu=36161,$u=3553,lc=34069,fa=36064,Mo=36096,zh=36128,Hl=33306,qf=36053,ml=36054,Ys=36055,cc=36057,gl=36061,Qf=36193,Nc=5121,jc=5126,bf=6407,yl=6408,Wl=6402,Jf=[bf,yl],Au=[];Au[yl]=4,Au[bf]=3;var Tu=[];Tu[Nc]=1,Tu[jc]=4,Tu[Qf]=2;var eh=32854,Zt=32855,Be=36194,Uh=33189,be=36168,th=34041,Po=35907,m=34836,d=34842,h=34843,y=[eh,Zt,Be,Po,d,h,m],S={};S[qf]="complete",S[ml]="incomplete attachment",S[cc]="incomplete dimensions",S[Ys]="incomplete, missing attachment",S[gl]="unsupported";function O(Q,de,st,qt,Sr,_r){var Bt={cur:null,next:null,dirty:!1,setFBO:null},Ur=["rgba"],$r=["rgba4","rgb565","rgb5 a1"];de.ext_srgb&&$r.push("srgba"),de.ext_color_buffer_half_float&&$r.push("rgba16f","rgb16f"),de.webgl_color_buffer_float&&$r.push("rgba32f");var tn=["uint8"];de.oes_texture_half_float&&tn.push("half float","float16"),de.oes_texture_float&&tn.push("float","float32");function Kr(fn,Gr,Pr){this.target=fn,this.texture=Gr,this.renderbuffer=Pr;var Qn=0,Vi=0;Gr?(Qn=Gr.width,Vi=Gr.height):Pr&&(Qn=Pr.width,Vi=Pr.height),this.width=Qn,this.height=Vi}function nn(fn){fn&&(fn.texture&&fn.texture._texture.decRef(),fn.renderbuffer&&fn.renderbuffer._renderbuffer.decRef())}function mn(fn,Gr,Pr){if(!!fn)if(fn.texture){var Qn=fn.texture._texture,Vi=Math.max(1,Qn.width),En=Math.max(1,Qn.height);B(Vi===Gr&&En===Pr,"inconsistent width/height for supplied texture"),Qn.refCount+=1}else{var wi=fn.renderbuffer._renderbuffer;B(wi.width===Gr&&wi.height===Pr,"inconsistent width/height for renderbuffer"),wi.refCount+=1}}function sn(fn,Gr){Gr&&(Gr.texture?Q.framebufferTexture2D(Za,fn,Gr.target,Gr.texture._texture.texture,0):Q.framebufferRenderbuffer(Za,fn,nu,Gr.renderbuffer._renderbuffer.renderbuffer))}function Yr(fn){var Gr=$u,Pr=null,Qn=null,Vi=fn;typeof fn=="object"&&(Vi=fn.data,"target"in fn&&(Gr=fn.target|0)),B.type(Vi,"function","invalid attachment data");var En=Vi._reglType;return En==="texture2d"?(Pr=Vi,B(Gr===$u)):En==="textureCube"?(Pr=Vi,B(Gr>=lc&&Gr<lc+6,"invalid cube map target")):En==="renderbuffer"?(Qn=Vi,Gr=nu):B.raise("invalid regl object for attachment"),new Kr(Gr,Pr,Qn)}function rr(fn,Gr,Pr,Qn,Vi){if(Pr){var En=qt.create2D({width:fn,height:Gr,format:Qn,type:Vi});return En._texture.refCount=0,new Kr($u,En,null)}else{var wi=Sr.create({width:fn,height:Gr,format:Qn});return wi._renderbuffer.refCount=0,new Kr(nu,null,wi)}}function Qt(fn){return fn&&(fn.texture||fn.renderbuffer)}function Wr(fn,Gr,Pr){fn&&(fn.texture?fn.texture.resize(Gr,Pr):fn.renderbuffer&&fn.renderbuffer.resize(Gr,Pr),fn.width=Gr,fn.height=Pr)}var bn=0,xr={};function Zn(){this.id=bn++,xr[this.id]=this,this.framebuffer=Q.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function jr(fn){fn.colorAttachments.forEach(nn),nn(fn.depthAttachment),nn(fn.stencilAttachment),nn(fn.depthStencilAttachment)}function an(fn){var Gr=fn.framebuffer;B(Gr,"must not double destroy framebuffer"),Q.deleteFramebuffer(Gr),fn.framebuffer=null,_r.framebufferCount--,delete xr[fn.id]}function Lr(fn){var Gr;Q.bindFramebuffer(Za,fn.framebuffer);var Pr=fn.colorAttachments;for(Gr=0;Gr<Pr.length;++Gr)sn(fa+Gr,Pr[Gr]);for(Gr=Pr.length;Gr<st.maxColorAttachments;++Gr)Q.framebufferTexture2D(Za,fa+Gr,$u,null,0);Q.framebufferTexture2D(Za,Hl,$u,null,0),Q.framebufferTexture2D(Za,Mo,$u,null,0),Q.framebufferTexture2D(Za,zh,$u,null,0),sn(Mo,fn.depthAttachment),sn(zh,fn.stencilAttachment),sn(Hl,fn.depthStencilAttachment);var Qn=Q.checkFramebufferStatus(Za);!Q.isContextLost()&&Qn!==qf&&B.raise("framebuffer configuration not supported, status = "+S[Qn]),Q.bindFramebuffer(Za,Bt.next?Bt.next.framebuffer:null),Bt.cur=Bt.next,Q.getError()}function un(fn,Gr){var Pr=new Zn;_r.framebufferCount++;function Qn(En,wi){var gi;B(Bt.next!==Pr,"can not update framebuffer which is currently in use");var si=0,oa=0,Io=!0,hs=!0,Gi=null,Do=!0,Pa="rgba",ko="uint8",Fo=1,uo=null,ts=null,Ps=null,Vo=!1;if(typeof En=="number")si=En|0,oa=wi|0||si;else if(!En)si=oa=1;else{B.type(En,"object","invalid arguments for framebuffer");var ki=En;if("shape"in ki){var Ss=ki.shape;B(Array.isArray(Ss)&&Ss.length>=2,"invalid shape for framebuffer"),si=Ss[0],oa=Ss[1]}else"radius"in ki&&(si=oa=ki.radius),"width"in ki&&(si=ki.width),"height"in ki&&(oa=ki.height);("color"in ki||"colors"in ki)&&(Gi=ki.color||ki.colors,Array.isArray(Gi)&&B(Gi.length===1||de.webgl_draw_buffers,"multiple render targets not supported")),Gi||("colorCount"in ki&&(Fo=ki.colorCount|0,B(Fo>0,"invalid color buffer count")),"colorTexture"in ki&&(Do=!!ki.colorTexture,Pa="rgba4"),"colorType"in ki&&(ko=ki.colorType,Do?(B(de.oes_texture_float||!(ko==="float"||ko==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),B(de.oes_texture_half_float||!(ko==="half float"||ko==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ko==="half float"||ko==="float16"?(B(de.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Pa="rgba16f"):(ko==="float"||ko==="float32")&&(B(de.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Pa="rgba32f"),B.oneOf(ko,tn,"invalid color type")),"colorFormat"in ki&&(Pa=ki.colorFormat,Ur.indexOf(Pa)>=0?Do=!0:$r.indexOf(Pa)>=0?Do=!1:Do?B.oneOf(ki.colorFormat,Ur,"invalid color format for texture"):B.oneOf(ki.colorFormat,$r,"invalid color format for renderbuffer"))),("depthTexture"in ki||"depthStencilTexture"in ki)&&(Vo=!!(ki.depthTexture||ki.depthStencilTexture),B(!Vo||de.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ki&&(typeof ki.depth=="boolean"?Io=ki.depth:(uo=ki.depth,hs=!1)),"stencil"in ki&&(typeof ki.stencil=="boolean"?hs=ki.stencil:(ts=ki.stencil,Io=!1)),"depthStencil"in ki&&(typeof ki.depthStencil=="boolean"?Io=hs=ki.depthStencil:(Ps=ki.depthStencil,Io=!1,hs=!1))}var ha=null,ui=null,Oi=null,ra=null;if(Array.isArray(Gi))ha=Gi.map(Yr);else if(Gi)ha=[Yr(Gi)];else for(ha=new Array(Fo),gi=0;gi<Fo;++gi)ha[gi]=rr(si,oa,Do,Pa,ko);B(de.webgl_draw_buffers||ha.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),B(ha.length<=st.maxColorAttachments,"too many color attachments, not supported"),si=si||ha[0].width,oa=oa||ha[0].height,uo?ui=Yr(uo):Io&&!hs&&(ui=rr(si,oa,Vo,"depth","uint32")),ts?Oi=Yr(ts):hs&&!Io&&(Oi=rr(si,oa,!1,"stencil","uint8")),Ps?ra=Yr(Ps):!uo&&!ts&&hs&&Io&&(ra=rr(si,oa,Vo,"depth stencil","depth stencil")),B(!!uo+!!ts+!!Ps<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ps=null;for(gi=0;gi<ha.length;++gi)if(mn(ha[gi],si,oa),B(!ha[gi]||ha[gi].texture&&Jf.indexOf(ha[gi].texture._texture.format)>=0||ha[gi].renderbuffer&&y.indexOf(ha[gi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+gi+" is invalid"),ha[gi]&&ha[gi].texture){var Us=Au[ha[gi].texture._texture.format]*Tu[ha[gi].texture._texture.type];ps===null?ps=Us:B(ps===Us,"all color attachments much have the same number of bits per pixel.")}return mn(ui,si,oa),B(!ui||ui.texture&&ui.texture._texture.format===Wl||ui.renderbuffer&&ui.renderbuffer._renderbuffer.format===Uh,"invalid depth attachment for framebuffer object"),mn(Oi,si,oa),B(!Oi||Oi.renderbuffer&&Oi.renderbuffer._renderbuffer.format===be,"invalid stencil attachment for framebuffer object"),mn(ra,si,oa),B(!ra||ra.texture&&ra.texture._texture.format===th||ra.renderbuffer&&ra.renderbuffer._renderbuffer.format===th,"invalid depth-stencil attachment for framebuffer object"),jr(Pr),Pr.width=si,Pr.height=oa,Pr.colorAttachments=ha,Pr.depthAttachment=ui,Pr.stencilAttachment=Oi,Pr.depthStencilAttachment=ra,Qn.color=ha.map(Qt),Qn.depth=Qt(ui),Qn.stencil=Qt(Oi),Qn.depthStencil=Qt(ra),Qn.width=Pr.width,Qn.height=Pr.height,Lr(Pr),Qn}function Vi(En,wi){B(Bt.next!==Pr,"can not resize a framebuffer which is currently in use");var gi=Math.max(En|0,1),si=Math.max(wi|0||gi,1);if(gi===Pr.width&&si===Pr.height)return Qn;for(var oa=Pr.colorAttachments,Io=0;Io<oa.length;++Io)Wr(oa[Io],gi,si);return Wr(Pr.depthAttachment,gi,si),Wr(Pr.stencilAttachment,gi,si),Wr(Pr.depthStencilAttachment,gi,si),Pr.width=Qn.width=gi,Pr.height=Qn.height=si,Lr(Pr),Qn}return Qn(fn,Gr),N(Qn,{resize:Vi,_reglType:"framebuffer",_framebuffer:Pr,destroy:function(){an(Pr),jr(Pr)},use:function(wi){Bt.setFBO({framebuffer:Qn},wi)}})}function $n(fn){var Gr=Array(6);function Pr(Vi){var En;B(Gr.indexOf(Bt.next)<0,"can not update framebuffer which is currently in use");var wi={color:null},gi=0,si=null,oa="rgba",Io="uint8",hs=1;if(typeof Vi=="number")gi=Vi|0;else if(!Vi)gi=1;else{B.type(Vi,"object","invalid arguments for framebuffer");var Gi=Vi;if("shape"in Gi){var Do=Gi.shape;B(Array.isArray(Do)&&Do.length>=2,"invalid shape for framebuffer"),B(Do[0]===Do[1],"cube framebuffer must be square"),gi=Do[0]}else"radius"in Gi&&(gi=Gi.radius|0),"width"in Gi?(gi=Gi.width|0,"height"in Gi&&B(Gi.height===gi,"must be square")):"height"in Gi&&(gi=Gi.height|0);("color"in Gi||"colors"in Gi)&&(si=Gi.color||Gi.colors,Array.isArray(si)&&B(si.length===1||de.webgl_draw_buffers,"multiple render targets not supported")),si||("colorCount"in Gi&&(hs=Gi.colorCount|0,B(hs>0,"invalid color buffer count")),"colorType"in Gi&&(B.oneOf(Gi.colorType,tn,"invalid color type"),Io=Gi.colorType),"colorFormat"in Gi&&(oa=Gi.colorFormat,B.oneOf(Gi.colorFormat,Ur,"invalid color format for texture"))),"depth"in Gi&&(wi.depth=Gi.depth),"stencil"in Gi&&(wi.stencil=Gi.stencil),"depthStencil"in Gi&&(wi.depthStencil=Gi.depthStencil)}var Pa;if(si)if(Array.isArray(si))for(Pa=[],En=0;En<si.length;++En)Pa[En]=si[En];else Pa=[si];else{Pa=Array(hs);var ko={radius:gi,format:oa,type:Io};for(En=0;En<hs;++En)Pa[En]=qt.createCube(ko)}for(wi.color=Array(Pa.length),En=0;En<Pa.length;++En){var Fo=Pa[En];B(typeof Fo=="function"&&Fo._reglType==="textureCube","invalid cube map"),gi=gi||Fo.width,B(Fo.width===gi&&Fo.height===gi,"invalid cube map shape"),wi.color[En]={target:lc,data:Pa[En]}}for(En=0;En<6;++En){for(var uo=0;uo<Pa.length;++uo)wi.color[uo].target=lc+En;En>0&&(wi.depth=Gr[0].depth,wi.stencil=Gr[0].stencil,wi.depthStencil=Gr[0].depthStencil),Gr[En]?Gr[En](wi):Gr[En]=un(wi)}return N(Pr,{width:gi,height:gi,color:Pa})}function Qn(Vi){var En,wi=Vi|0;if(B(wi>0&&wi<=st.maxCubeMapSize,"invalid radius for cube fbo"),wi===Pr.width)return Pr;var gi=Pr.color;for(En=0;En<gi.length;++En)gi[En].resize(wi);for(En=0;En<6;++En)Gr[En].resize(wi);return Pr.width=Pr.height=wi,Pr}return Pr(fn),N(Pr,{faces:Gr,resize:Qn,_reglType:"framebufferCube",destroy:function(){Gr.forEach(function(En){En.destroy()})}})}function bi(){Bt.cur=null,Bt.next=null,Bt.dirty=!0,qi(xr).forEach(function(fn){fn.framebuffer=Q.createFramebuffer(),Lr(fn)})}return N(Bt,{getFramebuffer:function(Gr){if(typeof Gr=="function"&&Gr._reglType==="framebuffer"){var Pr=Gr._framebuffer;if(Pr instanceof Zn)return Pr}return null},create:un,createCube:$n,clear:function(){qi(xr).forEach(an)},restore:bi})}var M=5126,F=34962;function X(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=M,this.offset=0,this.stride=0,this.divisor=0}function ee(Q,de,st,qt,Sr){for(var _r=st.maxAttributes,Bt=new Array(_r),Ur=0;Ur<_r;++Ur)Bt[Ur]=new X;var $r=0,tn={},Kr={Record:X,scope:{},state:Bt,currentVAO:null,targetVAO:null,restore:mn()?xr:function(){},createVAO:Zn,getVAO:Yr,destroyBuffer:nn,setVAO:mn()?rr:Qt,clear:mn()?Wr:function(){}};function nn(jr){for(var an=0;an<Bt.length;++an){var Lr=Bt[an];Lr.buffer===jr&&(Q.disableVertexAttribArray(an),Lr.buffer=null)}}function mn(){return de.oes_vertex_array_object}function sn(){return de.angle_instanced_arrays}function Yr(jr){return typeof jr=="function"&&jr._vao?jr._vao:null}function rr(jr){if(jr!==Kr.currentVAO){var an=mn();jr?an.bindVertexArrayOES(jr.vao):an.bindVertexArrayOES(null),Kr.currentVAO=jr}}function Qt(jr){if(jr!==Kr.currentVAO){if(jr)jr.bindAttrs();else for(var an=sn(),Lr=0;Lr<Bt.length;++Lr){var un=Bt[Lr];un.buffer?(Q.enableVertexAttribArray(Lr),Q.vertexAttribPointer(Lr,un.size,un.type,un.normalized,un.stride,un.offfset),an&&an.vertexAttribDivisorANGLE(Lr,un.divisor)):(Q.disableVertexAttribArray(Lr),Q.vertexAttrib4f(Lr,un.x,un.y,un.z,un.w))}Kr.currentVAO=jr}}function Wr(){qi(tn).forEach(function(jr){jr.destroy()})}function bn(){this.id=++$r,this.attributes=[];var jr=mn();jr?this.vao=jr.createVertexArrayOES():this.vao=null,tn[this.id]=this,this.buffers=[]}bn.prototype.bindAttrs=function(){for(var jr=sn(),an=this.attributes,Lr=0;Lr<an.length;++Lr){var un=an[Lr];un.buffer?(Q.enableVertexAttribArray(Lr),Q.bindBuffer(F,un.buffer.buffer),Q.vertexAttribPointer(Lr,un.size,un.type,un.normalized,un.stride,un.offset),jr&&jr.vertexAttribDivisorANGLE(Lr,un.divisor)):(Q.disableVertexAttribArray(Lr),Q.vertexAttrib4f(Lr,un.x,un.y,un.z,un.w))}for(var $n=an.length;$n<_r;++$n)Q.disableVertexAttribArray($n)},bn.prototype.refresh=function(){var jr=mn();jr&&(jr.bindVertexArrayOES(this.vao),this.bindAttrs(),Kr.currentVAO=this)},bn.prototype.destroy=function(){if(this.vao){var jr=mn();this===Kr.currentVAO&&(Kr.currentVAO=null,jr.bindVertexArrayOES(null)),jr.deleteVertexArrayOES(this.vao),this.vao=null}tn[this.id]&&(delete tn[this.id],qt.vaoCount-=1)};function xr(){var jr=mn();jr&&qi(tn).forEach(function(an){an.refresh()})}function Zn(jr){var an=new bn;qt.vaoCount+=1;function Lr(un){B(Array.isArray(un),"arguments to vertex array constructor must be an array"),B(un.length<_r,"too many attributes"),B(un.length>0,"must specify at least one attribute");for(var $n=0;$n<an.buffers.length;++$n)an.buffers[$n].destroy();an.buffers.length=0;var bi=an.attributes;bi.length=un.length;for(var fn=0;fn<un.length;++fn){var Gr=un[fn],Pr=bi[fn]=new X;if(Array.isArray(Gr)||D(Gr)||oo(Gr)){var Qn=Sr.create(Gr,F,!1,!0);Pr.buffer=Sr.getBuffer(Qn),Pr.size=Pr.buffer.dimension|0,Pr.normalized=!1,Pr.type=Pr.buffer.dtype,Pr.offset=0,Pr.stride=0,Pr.divisor=0,Pr.state=1,an.buffers.push(Qn)}else Sr.getBuffer(Gr)?(Pr.buffer=Sr.getBuffer(Gr),Pr.size=Pr.buffer.dimension|0,Pr.normalized=!1,Pr.type=Pr.buffer.dtype,Pr.offset=0,Pr.stride=0,Pr.divisor=0,Pr.state=1):Sr.getBuffer(Gr.buffer)?(Pr.buffer=Sr.getBuffer(Gr.buffer),Pr.size=(+Gr.size||Pr.buffer.dimension)|0,Pr.normalized=!!Gr.normalized||!1,"type"in Gr?(B.parameter(Gr.type,Ra,"invalid buffer type"),Pr.type=Ra[Gr.type]):Pr.type=Pr.buffer.dtype,Pr.offset=(Gr.offset||0)|0,Pr.stride=(Gr.stride||0)|0,Pr.divisor=(Gr.divisor||0)|0,Pr.state=1,B(Pr.size>=1&&Pr.size<=4,"size must be between 1 and 4"),B(Pr.offset>=0,"invalid offset"),B(Pr.stride>=0&&Pr.stride<=255,"stride must be between 0 and 255"),B(Pr.divisor>=0,"divisor must be positive"),B(!Pr.divisor||!!de.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gr?(B(fn>0,"first attribute must not be a constant"),Pr.x=+Gr.x||0,Pr.y=+Gr.y||0,Pr.z=+Gr.z||0,Pr.w=+Gr.w||0,Pr.state=2):B(!1,"invalid attribute spec for location "+fn)}return an.refresh(),Lr}return Lr.destroy=function(){an.destroy()},Lr._vao=an,Lr._reglType="vao",Lr(jr)}return Kr}var ge=35632,_e=35633,Ee=35718,qe=35721;function $e(Q,de,st,qt){var Sr={},_r={};function Bt(rr,Qt,Wr,bn){this.name=rr,this.id=Qt,this.location=Wr,this.info=bn}function Ur(rr,Qt){for(var Wr=0;Wr<rr.length;++Wr)if(rr[Wr].id===Qt.id){rr[Wr].location=Qt.location;return}rr.push(Qt)}function $r(rr,Qt,Wr){var bn=rr===ge?Sr:_r,xr=bn[Qt];if(!xr){var Zn=de.str(Qt);xr=Q.createShader(rr),Q.shaderSource(xr,Zn),Q.compileShader(xr),B.shaderError(Q,xr,Zn,rr,Wr),bn[Qt]=xr}return xr}var tn={},Kr=[],nn=0;function mn(rr,Qt){this.id=nn++,this.fragId=rr,this.vertId=Qt,this.program=null,this.uniforms=[],this.attributes=[],qt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function sn(rr,Qt,Wr){var bn,xr,Zn=$r(ge,rr.fragId),jr=$r(_e,rr.vertId),an=rr.program=Q.createProgram();if(Q.attachShader(an,Zn),Q.attachShader(an,jr),Wr)for(bn=0;bn<Wr.length;++bn){var Lr=Wr[bn];Q.bindAttribLocation(an,Lr[0],Lr[1])}Q.linkProgram(an),B.linkError(Q,an,de.str(rr.fragId),de.str(rr.vertId),Qt);var un=Q.getProgramParameter(an,Ee);qt.profile&&(rr.stats.uniformsCount=un);var $n=rr.uniforms;for(bn=0;bn<un;++bn)if(xr=Q.getActiveUniform(an,bn),xr)if(xr.size>1)for(var bi=0;bi<xr.size;++bi){var fn=xr.name.replace("[0]","["+bi+"]");Ur($n,new Bt(fn,de.id(fn),Q.getUniformLocation(an,fn),xr))}else Ur($n,new Bt(xr.name,de.id(xr.name),Q.getUniformLocation(an,xr.name),xr));var Gr=Q.getProgramParameter(an,qe);qt.profile&&(rr.stats.attributesCount=Gr);var Pr=rr.attributes;for(bn=0;bn<Gr;++bn)xr=Q.getActiveAttrib(an,bn),xr&&Ur(Pr,new Bt(xr.name,de.id(xr.name),Q.getAttribLocation(an,xr.name),xr))}qt.profile&&(st.getMaxUniformsCount=function(){var rr=0;return Kr.forEach(function(Qt){Qt.stats.uniformsCount>rr&&(rr=Qt.stats.uniformsCount)}),rr},st.getMaxAttributesCount=function(){var rr=0;return Kr.forEach(function(Qt){Qt.stats.attributesCount>rr&&(rr=Qt.stats.attributesCount)}),rr});function Yr(){Sr={},_r={};for(var rr=0;rr<Kr.length;++rr)sn(Kr[rr],null,Kr[rr].attributes.map(function(Qt){return[Qt.location,Qt.name]}))}return{clear:function(){var Qt=Q.deleteShader.bind(Q);qi(Sr).forEach(Qt),Sr={},qi(_r).forEach(Qt),_r={},Kr.forEach(function(Wr){Q.deleteProgram(Wr.program)}),Kr.length=0,tn={},st.shaderCount=0},program:function(Qt,Wr,bn,xr){B.command(Qt>=0,"missing vertex shader",bn),B.command(Wr>=0,"missing fragment shader",bn);var Zn=tn[Wr];Zn||(Zn=tn[Wr]={});var jr=Zn[Qt];if(jr&&!xr)return jr;var an=new mn(Wr,Qt);return st.shaderCount++,sn(an,bn,xr),jr||(Zn[Qt]=an),Kr.push(an),an},restore:Yr,shader:$r,frag:-1,vert:-1}}var dt=6408,Ye=5121,ot=3333,Mt=5126;function Pt(Q,de,st,qt,Sr,_r,Bt){function Ur(Kr){var nn;de.next===null?(B(Sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),nn=Ye):(B(de.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),nn=de.next.colorAttachments[0].texture._texture.type,_r.oes_texture_float?(B(nn===Ye||nn===Mt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),nn===Mt&&B(Bt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):B(nn===Ye,"Reading from a framebuffer is only allowed for the type 'uint8'"));var mn=0,sn=0,Yr=qt.framebufferWidth,rr=qt.framebufferHeight,Qt=null;D(Kr)?Qt=Kr:Kr&&(B.type(Kr,"object","invalid arguments to regl.read()"),mn=Kr.x|0,sn=Kr.y|0,B(mn>=0&&mn<qt.framebufferWidth,"invalid x offset for regl.read"),B(sn>=0&&sn<qt.framebufferHeight,"invalid y offset for regl.read"),Yr=(Kr.width||qt.framebufferWidth-mn)|0,rr=(Kr.height||qt.framebufferHeight-sn)|0,Qt=Kr.data||null),Qt&&(nn===Ye?B(Qt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):nn===Mt&&B(Qt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),B(Yr>0&&Yr+mn<=qt.framebufferWidth,"invalid width for read pixels"),B(rr>0&&rr+sn<=qt.framebufferHeight,"invalid height for read pixels"),st();var Wr=Yr*rr*4;return Qt||(nn===Ye?Qt=new Uint8Array(Wr):nn===Mt&&(Qt=Qt||new Float32Array(Wr))),B.isTypedArray(Qt,"data buffer for regl.read() must be a typedarray"),B(Qt.byteLength>=Wr,"data buffer for regl.read() too small"),Q.pixelStorei(ot,4),Q.readPixels(mn,sn,Yr,rr,dt,nn,Qt),Qt}function $r(Kr){var nn;return de.setFBO({framebuffer:Kr.framebuffer},function(){nn=Ur(Kr)}),nn}function tn(Kr){return!Kr||!("framebuffer"in Kr)?Ur(Kr):$r(Kr)}return tn}function dr(Q){return Array.prototype.slice.call(Q)}function Jt(Q){return dr(Q).join("")}function br(){var Q=0,de=[],st=[];function qt(nn){for(var mn=0;mn<st.length;++mn)if(st[mn]===nn)return de[mn];var sn="g"+Q++;return de.push(sn),st.push(nn),sn}function Sr(){var nn=[];function mn(){nn.push.apply(nn,dr(arguments))}var sn=[];function Yr(){var rr="v"+Q++;return sn.push(rr),arguments.length>0&&(nn.push(rr,"="),nn.push.apply(nn,dr(arguments)),nn.push(";")),rr}return N(mn,{def:Yr,toString:function(){return Jt([sn.length>0?"var "+sn.join(",")+";":"",Jt(nn)])}})}function _r(){var nn=Sr(),mn=Sr(),sn=nn.toString,Yr=mn.toString;function rr(Qt,Wr){mn(Qt,Wr,"=",nn.def(Qt,Wr),";")}return N(function(){nn.apply(nn,dr(arguments))},{def:nn.def,entry:nn,exit:mn,save:rr,set:function(Wr,bn,xr){rr(Wr,bn),nn(Wr,bn,"=",xr,";")},toString:function(){return sn()+Yr()}})}function Bt(){var nn=Jt(arguments),mn=_r(),sn=_r(),Yr=mn.toString,rr=sn.toString;return N(mn,{then:function(){return mn.apply(mn,dr(arguments)),this},else:function(){return sn.apply(sn,dr(arguments)),this},toString:function(){var Wr=rr();return Wr&&(Wr="else{"+Wr+"}"),Jt(["if(",nn,"){",Yr(),"}",Wr])}})}var Ur=Sr(),$r={};function tn(nn,mn){var sn=[];function Yr(){var xr="a"+sn.length;return sn.push(xr),xr}mn=mn||0;for(var rr=0;rr<mn;++rr)Yr();var Qt=_r(),Wr=Qt.toString,bn=$r[nn]=N(Qt,{arg:Yr,toString:function(){return Jt(["function(",sn.join(),"){",Wr(),"}"])}});return bn}function Kr(){var nn=['"use strict";',Ur,"return {"];Object.keys($r).forEach(function(Yr){nn.push('"',Yr,'":',$r[Yr].toString(),",")}),nn.push("}");var mn=Jt(nn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),sn=Function.apply(null,de.concat(mn));return sn.apply(null,st)}return{global:Ur,link:qt,block:Sr,proc:tn,scope:_r,cond:Bt,compile:Kr}}var Er="xyzw".split(""),en=5121,Xr=1,gn=2,In=0,Vn=1,oi=2,Di=3,Ji=4,Tn="dither",Ei="blend.enable",vi="blend.color",Hn="blend.equation",Ci="blend.func",ti="depth.enable",_i="depth.func",Yi="depth.range",za="depth.mask",Aa="colorMask",No="cull.enable",$a="cull.face",Ya="frontFace",Ks="lineWidth",jo="polygonOffset.enable",Yu="polygonOffset.offset",Ku="sample.alpha",_s="sample.enable",bs="sample.coverage",fc="stencil.enable",xf="stencil.mask",du="stencil.func",Gl="stencil.opFront",vu="stencil.opBack",mu="scissor.enable",_l="scissor.box",ls="viewport",so="profile",cs="framebuffer",bl="vert",iu="frag",fo="elements",zo="primitive",Ka="count",fs="offset",xs="instances",Cu="vao",Ef="Width",zc="Height",hc=cs+Ef,es=cs+zc,Vh=ls+Ef,Uc=ls+zc,qu="drawingBuffer",zs=qu+Ef,uv=qu+zc,hd=[Ci,Hn,du,Gl,vu,bs,ls,_l,Yu],Sf=34962,Yg=34963,Kg=35632,Rm=35633,vp=3553,Mm=34067,mp=2884,lv=3042,Vc=3024,Hh=2960,gp=2929,cv=3089,qg=32823,Pm=32926,fv=32928,yp=5126,rh=35664,Wh=35665,_p=35666,Hc=5124,bp=35667,_o=35668,nh=35669,ih=35670,pc=35671,dc=35672,Xl=35673,ah=35674,Es=35675,ea=35676,Ha=35678,wu=35680,Im=4,vc=1028,oh=1029,pd=2304,dd=2305,vd=32775,md=32776,xl=519,Wc=7680,hv=0,pv=1,dv=32774,vv=513,Af=36160,mv=36064,Zl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},gd=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Tf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Gc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},gv={frag:Kg,vert:Rm},Xc={cw:pd,ccw:dd};function xp(Q){return Array.isArray(Q)||D(Q)||oo(Q)}function Ep(Q){return Q.sort(function(de,st){return de===ls?-1:st===ls?1:de<st?-1:1})}function Os(Q,de,st,qt){this.thisDep=Q,this.contextDep=de,this.propDep=st,this.append=qt}function Rs(Q){return Q&&!(Q.thisDep||Q.contextDep||Q.propDep)}function Uo(Q){return new Os(!1,!1,!1,Q)}function gu(Q,de){var st=Q.type;if(st===In){var qt=Q.data.length;return new Os(!0,qt>=1,qt>=2,de)}else if(st===Ji){var Sr=Q.data;return new Os(Sr.thisDep,Sr.contextDep,Sr.propDep,de)}else return new Os(st===Di,st===oi,st===Vn,de)}var yv=new Os(!1,!1,!1,function(){});function Gh(Q,de,st,qt,Sr,_r,Bt,Ur,$r,tn,Kr,nn,mn,sn,Yr){var rr=tn.Record,Qt={add:32774,subtract:32778,"reverse subtract":32779};st.ext_blend_minmax&&(Qt.min=vd,Qt.max=md);var Wr=st.angle_instanced_arrays,bn=st.webgl_draw_buffers,xr={dirty:!0,profile:Yr.profile},Zn={},jr=[],an={},Lr={};function un(ye){return ye.replace(".","_")}function $n(ye,ke,it){var er=un(ye);jr.push(ye),Zn[er]=xr[er]=!!it,an[er]=ke}function bi(ye,ke,it){var er=un(ye);jr.push(ye),Array.isArray(it)?(xr[er]=it.slice(),Zn[er]=it.slice()):xr[er]=Zn[er]=it,Lr[er]=ke}$n(Tn,Vc),$n(Ei,lv),bi(vi,"blendColor",[0,0,0,0]),bi(Hn,"blendEquationSeparate",[dv,dv]),bi(Ci,"blendFuncSeparate",[pv,hv,pv,hv]),$n(ti,gp,!0),bi(_i,"depthFunc",vv),bi(Yi,"depthRange",[0,1]),bi(za,"depthMask",!0),bi(Aa,Aa,[!0,!0,!0,!0]),$n(No,mp),bi($a,"cullFace",oh),bi(Ya,Ya,dd),bi(Ks,Ks,1),$n(jo,qg),bi(Yu,"polygonOffset",[0,0]),$n(Ku,Pm),$n(_s,fv),bi(bs,"sampleCoverage",[1,!1]),$n(fc,Hh),bi(xf,"stencilMask",-1),bi(du,"stencilFunc",[xl,0,-1]),bi(Gl,"stencilOpSeparate",[vc,Wc,Wc,Wc]),bi(vu,"stencilOpSeparate",[oh,Wc,Wc,Wc]),$n(mu,cv),bi(_l,"scissor",[0,0,Q.drawingBufferWidth,Q.drawingBufferHeight]),bi(ls,ls,[0,0,Q.drawingBufferWidth,Q.drawingBufferHeight]);var fn={gl:Q,context:mn,strings:de,next:Zn,current:xr,draw:nn,elements:_r,buffer:Sr,shader:Kr,attributes:tn.state,vao:tn,uniforms:$r,framebuffer:Ur,extensions:st,timer:sn,isBufferArgs:xp},Gr={primTypes:eu,compareFuncs:Tf,blendFuncs:Zl,blendEquations:Qt,stencilOps:Gc,glTypes:Ra,orientationType:Xc};B.optional(function(){fn.isArrayLike=co}),bn&&(Gr.backBuffer=[oh],Gr.drawBuffer=Pi(qt.maxDrawbuffers,function(ye){return ye===0?[0]:Pi(ye,function(ke){return mv+ke})}));var Pr=0;function Qn(){var ye=br(),ke=ye.link,it=ye.global;ye.id=Pr++,ye.batchId="0";var er=ke(fn),$t=ye.shared={props:"a0"};Object.keys(fn).forEach(function(_t){$t[_t]=it.def(er,".",_t)}),B.optional(function(){ye.CHECK=ke(B),ye.commandStr=B.guessCommand(),ye.command=ke(ye.commandStr),ye.assert=function(_t,Pe,xt){_t("if(!(",Pe,"))",this.CHECK,".commandRaise(",ke(xt),",",this.command,");")},Gr.invalidBlendCombinations=gd});var gt=ye.next={},Et=ye.current={};Object.keys(Lr).forEach(function(_t){Array.isArray(xr[_t])&&(gt[_t]=it.def($t.next,".",_t),Et[_t]=it.def($t.current,".",_t))});var Ct=ye.constants={};Object.keys(Gr).forEach(function(_t){Ct[_t]=it.def(JSON.stringify(Gr[_t]))}),ye.invoke=function(_t,Pe){switch(Pe.type){case In:var xt=["this",$t.context,$t.props,ye.batchId];return _t.def(ke(Pe.data),".call(",xt.slice(0,Math.max(Pe.data.length+1,4)),")");case Vn:return _t.def($t.props,Pe.data);case oi:return _t.def($t.context,Pe.data);case Di:return _t.def("this",Pe.data);case Ji:return Pe.data.append(ye,_t),Pe.data.ref}},ye.attribCache={};var Ge={};return ye.scopeAttrib=function(_t){var Pe=de.id(_t);if(Pe in Ge)return Ge[Pe];var xt=tn.scope[Pe];xt||(xt=tn.scope[Pe]=new rr);var hr=Ge[Pe]=ke(xt);return hr},ye}function Vi(ye){var ke=ye.static,it=ye.dynamic,er;if(so in ke){var $t=!!ke[so];er=Uo(function(Et,Ct){return $t}),er.enable=$t}else if(so in it){var gt=it[so];er=gu(gt,function(Et,Ct){return Et.invoke(Ct,gt)})}return er}function En(ye,ke){var it=ye.static,er=ye.dynamic;if(cs in it){var $t=it[cs];return $t?($t=Ur.getFramebuffer($t),B.command($t,"invalid framebuffer object"),Uo(function(Et,Ct){var Ge=Et.link($t),_t=Et.shared;Ct.set(_t.framebuffer,".next",Ge);var Pe=_t.context;return Ct.set(Pe,"."+hc,Ge+".width"),Ct.set(Pe,"."+es,Ge+".height"),Ge})):Uo(function(Et,Ct){var Ge=Et.shared;Ct.set(Ge.framebuffer,".next","null");var _t=Ge.context;return Ct.set(_t,"."+hc,_t+"."+zs),Ct.set(_t,"."+es,_t+"."+uv),"null"})}else if(cs in er){var gt=er[cs];return gu(gt,function(Et,Ct){var Ge=Et.invoke(Ct,gt),_t=Et.shared,Pe=_t.framebuffer,xt=Ct.def(Pe,".getFramebuffer(",Ge,")");B.optional(function(){Et.assert(Ct,"!"+Ge+"||"+xt,"invalid framebuffer object")}),Ct.set(Pe,".next",xt);var hr=_t.context;return Ct.set(hr,"."+hc,xt+"?"+xt+".width:"+hr+"."+zs),Ct.set(hr,"."+es,xt+"?"+xt+".height:"+hr+"."+uv),xt})}else return null}function wi(ye,ke,it){var er=ye.static,$t=ye.dynamic;function gt(Ge){if(Ge in er){var _t=er[Ge];B.commandType(_t,"object","invalid "+Ge,it.commandStr);var Pe=!0,xt=_t.x|0,hr=_t.y|0,vr,Nr;return"width"in _t?(vr=_t.width|0,B.command(vr>=0,"invalid "+Ge,it.commandStr)):Pe=!1,"height"in _t?(Nr=_t.height|0,B.command(Nr>=0,"invalid "+Ge,it.commandStr)):Pe=!1,new Os(!Pe&&ke&&ke.thisDep,!Pe&&ke&&ke.contextDep,!Pe&&ke&&ke.propDep,function(Wn,Dn){var Bn=Wn.shared.context,ai=vr;"width"in _t||(ai=Dn.def(Bn,".",hc,"-",xt));var hi=Nr;return"height"in _t||(hi=Dn.def(Bn,".",es,"-",hr)),[xt,hr,ai,hi]})}else if(Ge in $t){var kr=$t[Ge],Hr=gu(kr,function(Wn,Dn){var Bn=Wn.invoke(Dn,kr);B.optional(function(){Wn.assert(Dn,Bn+"&&typeof "+Bn+'==="object"',"invalid "+Ge)});var ai=Wn.shared.context,hi=Dn.def(Bn,".x|0"),pa=Dn.def(Bn,".y|0"),Ho=Dn.def('"width" in ',Bn,"?",Bn,".width|0:","(",ai,".",hc,"-",hi,")"),El=Dn.def('"height" in ',Bn,"?",Bn,".height|0:","(",ai,".",es,"-",pa,")");return B.optional(function(){Wn.assert(Dn,Ho+">=0&&"+El+">=0","invalid "+Ge)}),[hi,pa,Ho,El]});return ke&&(Hr.thisDep=Hr.thisDep||ke.thisDep,Hr.contextDep=Hr.contextDep||ke.contextDep,Hr.propDep=Hr.propDep||ke.propDep),Hr}else return ke?new Os(ke.thisDep,ke.contextDep,ke.propDep,function(Wn,Dn){var Bn=Wn.shared.context;return[0,0,Dn.def(Bn,".",hc),Dn.def(Bn,".",es)]}):null}var Et=gt(ls);if(Et){var Ct=Et;Et=new Os(Et.thisDep,Et.contextDep,Et.propDep,function(Ge,_t){var Pe=Ct.append(Ge,_t),xt=Ge.shared.context;return _t.set(xt,"."+Vh,Pe[2]),_t.set(xt,"."+Uc,Pe[3]),Pe})}return{viewport:Et,scissor_box:gt(_l)}}function gi(ye,ke){var it=ye.static,er=typeof it[iu]=="string"&&typeof it[bl]=="string";if(er){if(Object.keys(ke.dynamic).length>0)return null;var $t=ke.static,gt=Object.keys($t);if(gt.length>0&&typeof $t[gt[0]]=="number"){for(var Et=[],Ct=0;Ct<gt.length;++Ct)B(typeof $t[gt[Ct]]=="number","must specify all vertex attribute locations when using vaos"),Et.push([$t[gt[Ct]]|0,gt[Ct]]);return Et}}return null}function si(ye,ke,it){var er=ye.static,$t=ye.dynamic;function gt(Pe){if(Pe in er){var xt=de.id(er[Pe]);B.optional(function(){Kr.shader(gv[Pe],xt,B.guessCommand())});var hr=Uo(function(){return xt});return hr.id=xt,hr}else if(Pe in $t){var vr=$t[Pe];return gu(vr,function(Nr,kr){var Hr=Nr.invoke(kr,vr),Wn=kr.def(Nr.shared.strings,".id(",Hr,")");return B.optional(function(){kr(Nr.shared.shader,".shader(",gv[Pe],",",Wn,",",Nr.command,");")}),Wn})}return null}var Et=gt(iu),Ct=gt(bl),Ge=null,_t;return Rs(Et)&&Rs(Ct)?(Ge=Kr.program(Ct.id,Et.id,null,it),_t=Uo(function(Pe,xt){return Pe.link(Ge)})):_t=new Os(Et&&Et.thisDep||Ct&&Ct.thisDep,Et&&Et.contextDep||Ct&&Ct.contextDep,Et&&Et.propDep||Ct&&Ct.propDep,function(Pe,xt){var hr=Pe.shared.shader,vr;Et?vr=Et.append(Pe,xt):vr=xt.def(hr,".",iu);var Nr;Ct?Nr=Ct.append(Pe,xt):Nr=xt.def(hr,".",bl);var kr=hr+".program("+Nr+","+vr;return B.optional(function(){kr+=","+Pe.command}),xt.def(kr+")")}),{frag:Et,vert:Ct,progVar:_t,program:Ge}}function oa(ye,ke){var it=ye.static,er=ye.dynamic;function $t(){if(fo in it){var Pe=it[fo];xp(Pe)?Pe=_r.getElements(_r.create(Pe,!0)):Pe&&(Pe=_r.getElements(Pe),B.command(Pe,"invalid elements",ke.commandStr));var xt=Uo(function(vr,Nr){if(Pe){var kr=vr.link(Pe);return vr.ELEMENTS=kr,kr}return vr.ELEMENTS=null,null});return xt.value=Pe,xt}else if(fo in er){var hr=er[fo];return gu(hr,function(vr,Nr){var kr=vr.shared,Hr=kr.isBufferArgs,Wn=kr.elements,Dn=vr.invoke(Nr,hr),Bn=Nr.def("null"),ai=Nr.def(Hr,"(",Dn,")"),hi=vr.cond(ai).then(Bn,"=",Wn,".createStream(",Dn,");").else(Bn,"=",Wn,".getElements(",Dn,");");return B.optional(function(){vr.assert(hi.else,"!"+Dn+"||"+Bn,"invalid elements")}),Nr.entry(hi),Nr.exit(vr.cond(ai).then(Wn,".destroyStream(",Bn,");")),vr.ELEMENTS=Bn,Bn})}return null}var gt=$t();function Et(){if(zo in it){var Pe=it[zo];return B.commandParameter(Pe,eu,"invalid primitve",ke.commandStr),Uo(function(hr,vr){return eu[Pe]})}else if(zo in er){var xt=er[zo];return gu(xt,function(hr,vr){var Nr=hr.constants.primTypes,kr=hr.invoke(vr,xt);return B.optional(function(){hr.assert(vr,kr+" in "+Nr,"invalid primitive, must be one of "+Object.keys(eu))}),vr.def(Nr,"[",kr,"]")})}else if(gt)return Rs(gt)?gt.value?Uo(function(hr,vr){return vr.def(hr.ELEMENTS,".primType")}):Uo(function(){return Im}):new Os(gt.thisDep,gt.contextDep,gt.propDep,function(hr,vr){var Nr=hr.ELEMENTS;return vr.def(Nr,"?",Nr,".primType:",Im)});return null}function Ct(Pe,xt){if(Pe in it){var hr=it[Pe]|0;return B.command(!xt||hr>=0,"invalid "+Pe,ke.commandStr),Uo(function(Nr,kr){return xt&&(Nr.OFFSET=hr),hr})}else if(Pe in er){var vr=er[Pe];return gu(vr,function(Nr,kr){var Hr=Nr.invoke(kr,vr);return xt&&(Nr.OFFSET=Hr,B.optional(function(){Nr.assert(kr,Hr+">=0","invalid "+Pe)})),Hr})}else if(xt&&gt)return Uo(function(Nr,kr){return Nr.OFFSET="0",0});return null}var Ge=Ct(fs,!0);function _t(){if(Ka in it){var Pe=it[Ka]|0;return B.command(typeof Pe=="number"&&Pe>=0,"invalid vertex count",ke.commandStr),Uo(function(){return Pe})}else if(Ka in er){var xt=er[Ka];return gu(xt,function(Nr,kr){var Hr=Nr.invoke(kr,xt);return B.optional(function(){Nr.assert(kr,"typeof "+Hr+'==="number"&&'+Hr+">=0&&"+Hr+"===("+Hr+"|0)","invalid vertex count")}),Hr})}else if(gt)if(Rs(gt)){if(gt)return Ge?new Os(Ge.thisDep,Ge.contextDep,Ge.propDep,function(Nr,kr){var Hr=kr.def(Nr.ELEMENTS,".vertCount-",Nr.OFFSET);return B.optional(function(){Nr.assert(kr,Hr+">=0","invalid vertex offset/element buffer too small")}),Hr}):Uo(function(Nr,kr){return kr.def(Nr.ELEMENTS,".vertCount")});var hr=Uo(function(){return-1});return B.optional(function(){hr.MISSING=!0}),hr}else{var vr=new Os(gt.thisDep||Ge.thisDep,gt.contextDep||Ge.contextDep,gt.propDep||Ge.propDep,function(Nr,kr){var Hr=Nr.ELEMENTS;return Nr.OFFSET?kr.def(Hr,"?",Hr,".vertCount-",Nr.OFFSET,":-1"):kr.def(Hr,"?",Hr,".vertCount:-1")});return B.optional(function(){vr.DYNAMIC=!0}),vr}return null}return{elements:gt,primitive:Et(),count:_t(),instances:Ct(xs,!1),offset:Ge}}function Io(ye,ke){var it=ye.static,er=ye.dynamic,$t={};return jr.forEach(function(gt){var Et=un(gt);function Ct(Ge,_t){if(gt in it){var Pe=Ge(it[gt]);$t[Et]=Uo(function(){return Pe})}else if(gt in er){var xt=er[gt];$t[Et]=gu(xt,function(hr,vr){return _t(hr,vr,hr.invoke(vr,xt))})}}switch(gt){case No:case Ei:case Tn:case fc:case ti:case mu:case jo:case Ku:case _s:case za:return Ct(function(Ge){return B.commandType(Ge,"boolean",gt,ke.commandStr),Ge},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,"typeof "+Pe+'==="boolean"',"invalid flag "+gt,Ge.commandStr)}),Pe});case _i:return Ct(function(Ge){return B.commandParameter(Ge,Tf,"invalid "+gt,ke.commandStr),Tf[Ge]},function(Ge,_t,Pe){var xt=Ge.constants.compareFuncs;return B.optional(function(){Ge.assert(_t,Pe+" in "+xt,"invalid "+gt+", must be one of "+Object.keys(Tf))}),_t.def(xt,"[",Pe,"]")});case Yi:return Ct(function(Ge){return B.command(co(Ge)&&Ge.length===2&&typeof Ge[0]=="number"&&typeof Ge[1]=="number"&&Ge[0]<=Ge[1],"depth range is 2d array",ke.commandStr),Ge},function(Ge,_t,Pe){B.optional(function(){Ge.assert(_t,Ge.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===2&&typeof "+Pe+'[0]==="number"&&typeof '+Pe+'[1]==="number"&&'+Pe+"[0]<="+Pe+"[1]","depth range must be a 2d array")});var xt=_t.def("+",Pe,"[0]"),hr=_t.def("+",Pe,"[1]");return[xt,hr]});case Ci:return Ct(function(Ge){B.commandType(Ge,"object","blend.func",ke.commandStr);var _t="srcRGB"in Ge?Ge.srcRGB:Ge.src,Pe="srcAlpha"in Ge?Ge.srcAlpha:Ge.src,xt="dstRGB"in Ge?Ge.dstRGB:Ge.dst,hr="dstAlpha"in Ge?Ge.dstAlpha:Ge.dst;return B.commandParameter(_t,Zl,Et+".srcRGB",ke.commandStr),B.commandParameter(Pe,Zl,Et+".srcAlpha",ke.commandStr),B.commandParameter(xt,Zl,Et+".dstRGB",ke.commandStr),B.commandParameter(hr,Zl,Et+".dstAlpha",ke.commandStr),B.command(gd.indexOf(_t+", "+xt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+_t+", "+xt+")",ke.commandStr),[Zl[_t],Zl[xt],Zl[Pe],Zl[hr]]},function(Ge,_t,Pe){var xt=Ge.constants.blendFuncs;B.optional(function(){Ge.assert(_t,Pe+"&&typeof "+Pe+'==="object"',"invalid blend func, must be an object")});function hr(Bn,ai){var hi=_t.def('"',Bn,ai,'" in ',Pe,"?",Pe,".",Bn,ai,":",Pe,".",Bn);return B.optional(function(){Ge.assert(_t,hi+" in "+xt,"invalid "+gt+"."+Bn+ai+", must be one of "+Object.keys(Zl))}),hi}var vr=hr("src","RGB"),Nr=hr("dst","RGB");B.optional(function(){var Bn=Ge.constants.invalidBlendCombinations;Ge.assert(_t,Bn+".indexOf("+vr+'+", "+'+Nr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var kr=_t.def(xt,"[",vr,"]"),Hr=_t.def(xt,"[",hr("src","Alpha"),"]"),Wn=_t.def(xt,"[",Nr,"]"),Dn=_t.def(xt,"[",hr("dst","Alpha"),"]");return[kr,Wn,Hr,Dn]});case Hn:return Ct(function(Ge){if(typeof Ge=="string")return B.commandParameter(Ge,Qt,"invalid "+gt,ke.commandStr),[Qt[Ge],Qt[Ge]];if(typeof Ge=="object")return B.commandParameter(Ge.rgb,Qt,gt+".rgb",ke.commandStr),B.commandParameter(Ge.alpha,Qt,gt+".alpha",ke.commandStr),[Qt[Ge.rgb],Qt[Ge.alpha]];B.commandRaise("invalid blend.equation",ke.commandStr)},function(Ge,_t,Pe){var xt=Ge.constants.blendEquations,hr=_t.def(),vr=_t.def(),Nr=Ge.cond("typeof ",Pe,'==="string"');return B.optional(function(){function kr(Hr,Wn,Dn){Ge.assert(Hr,Dn+" in "+xt,"invalid "+Wn+", must be one of "+Object.keys(Qt))}kr(Nr.then,gt,Pe),Ge.assert(Nr.else,Pe+"&&typeof "+Pe+'==="object"',"invalid "+gt),kr(Nr.else,gt+".rgb",Pe+".rgb"),kr(Nr.else,gt+".alpha",Pe+".alpha")}),Nr.then(hr,"=",vr,"=",xt,"[",Pe,"];"),Nr.else(hr,"=",xt,"[",Pe,".rgb];",vr,"=",xt,"[",Pe,".alpha];"),_t(Nr),[hr,vr]});case vi:return Ct(function(Ge){return B.command(co(Ge)&&Ge.length===4,"blend.color must be a 4d array",ke.commandStr),Pi(4,function(_t){return+Ge[_t]})},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,Ge.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===4","blend.color must be a 4d array")}),Pi(4,function(xt){return _t.def("+",Pe,"[",xt,"]")})});case xf:return Ct(function(Ge){return B.commandType(Ge,"number",Et,ke.commandStr),Ge|0},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,"typeof "+Pe+'==="number"',"invalid stencil.mask")}),_t.def(Pe,"|0")});case du:return Ct(function(Ge){B.commandType(Ge,"object",Et,ke.commandStr);var _t=Ge.cmp||"keep",Pe=Ge.ref||0,xt="mask"in Ge?Ge.mask:-1;return B.commandParameter(_t,Tf,gt+".cmp",ke.commandStr),B.commandType(Pe,"number",gt+".ref",ke.commandStr),B.commandType(xt,"number",gt+".mask",ke.commandStr),[Tf[_t],Pe,xt]},function(Ge,_t,Pe){var xt=Ge.constants.compareFuncs;B.optional(function(){function kr(){Ge.assert(_t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}kr(Pe+"&&typeof ",Pe,'==="object"'),kr('!("cmp" in ',Pe,")||(",Pe,".cmp in ",xt,")")});var hr=_t.def('"cmp" in ',Pe,"?",xt,"[",Pe,".cmp]",":",Wc),vr=_t.def(Pe,".ref|0"),Nr=_t.def('"mask" in ',Pe,"?",Pe,".mask|0:-1");return[hr,vr,Nr]});case Gl:case vu:return Ct(function(Ge){B.commandType(Ge,"object",Et,ke.commandStr);var _t=Ge.fail||"keep",Pe=Ge.zfail||"keep",xt=Ge.zpass||"keep";return B.commandParameter(_t,Gc,gt+".fail",ke.commandStr),B.commandParameter(Pe,Gc,gt+".zfail",ke.commandStr),B.commandParameter(xt,Gc,gt+".zpass",ke.commandStr),[gt===vu?oh:vc,Gc[_t],Gc[Pe],Gc[xt]]},function(Ge,_t,Pe){var xt=Ge.constants.stencilOps;B.optional(function(){Ge.assert(_t,Pe+"&&typeof "+Pe+'==="object"',"invalid "+gt)});function hr(vr){return B.optional(function(){Ge.assert(_t,'!("'+vr+'" in '+Pe+")||("+Pe+"."+vr+" in "+xt+")","invalid "+gt+"."+vr+", must be one of "+Object.keys(Gc))}),_t.def('"',vr,'" in ',Pe,"?",xt,"[",Pe,".",vr,"]:",Wc)}return[gt===vu?oh:vc,hr("fail"),hr("zfail"),hr("zpass")]});case Yu:return Ct(function(Ge){B.commandType(Ge,"object",Et,ke.commandStr);var _t=Ge.factor|0,Pe=Ge.units|0;return B.commandType(_t,"number",Et+".factor",ke.commandStr),B.commandType(Pe,"number",Et+".units",ke.commandStr),[_t,Pe]},function(Ge,_t,Pe){B.optional(function(){Ge.assert(_t,Pe+"&&typeof "+Pe+'==="object"',"invalid "+gt)});var xt=_t.def(Pe,".factor|0"),hr=_t.def(Pe,".units|0");return[xt,hr]});case $a:return Ct(function(Ge){var _t=0;return Ge==="front"?_t=vc:Ge==="back"&&(_t=oh),B.command(!!_t,Et,ke.commandStr),_t},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,Pe+'==="front"||'+Pe+'==="back"',"invalid cull.face")}),_t.def(Pe,'==="front"?',vc,":",oh)});case Ks:return Ct(function(Ge){return B.command(typeof Ge=="number"&&Ge>=qt.lineWidthDims[0]&&Ge<=qt.lineWidthDims[1],"invalid line width, must be a positive number between "+qt.lineWidthDims[0]+" and "+qt.lineWidthDims[1],ke.commandStr),Ge},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,"typeof "+Pe+'==="number"&&'+Pe+">="+qt.lineWidthDims[0]+"&&"+Pe+"<="+qt.lineWidthDims[1],"invalid line width")}),Pe});case Ya:return Ct(function(Ge){return B.commandParameter(Ge,Xc,Et,ke.commandStr),Xc[Ge]},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,Pe+'==="cw"||'+Pe+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),_t.def(Pe+'==="cw"?'+pd+":"+dd)});case Aa:return Ct(function(Ge){return B.command(co(Ge)&&Ge.length===4,"color.mask must be length 4 array",ke.commandStr),Ge.map(function(_t){return!!_t})},function(Ge,_t,Pe){return B.optional(function(){Ge.assert(_t,Ge.shared.isArrayLike+"("+Pe+")&&"+Pe+".length===4","invalid color.mask")}),Pi(4,function(xt){return"!!"+Pe+"["+xt+"]"})});case bs:return Ct(function(Ge){B.command(typeof Ge=="object"&&Ge,Et,ke.commandStr);var _t="value"in Ge?Ge.value:1,Pe=!!Ge.invert;return B.command(typeof _t=="number"&&_t>=0&&_t<=1,"sample.coverage.value must be a number between 0 and 1",ke.commandStr),[_t,Pe]},function(Ge,_t,Pe){B.optional(function(){Ge.assert(_t,Pe+"&&typeof "+Pe+'==="object"',"invalid sample.coverage")});var xt=_t.def('"value" in ',Pe,"?+",Pe,".value:1"),hr=_t.def("!!",Pe,".invert");return[xt,hr]})}}),$t}function hs(ye,ke){var it=ye.static,er=ye.dynamic,$t={};return Object.keys(it).forEach(function(gt){var Et=it[gt],Ct;if(typeof Et=="number"||typeof Et=="boolean")Ct=Uo(function(){return Et});else if(typeof Et=="function"){var Ge=Et._reglType;Ge==="texture2d"||Ge==="textureCube"?Ct=Uo(function(_t){return _t.link(Et)}):Ge==="framebuffer"||Ge==="framebufferCube"?(B.command(Et.color.length>0,'missing color attachment for framebuffer sent to uniform "'+gt+'"',ke.commandStr),Ct=Uo(function(_t){return _t.link(Et.color[0])})):B.commandRaise('invalid data for uniform "'+gt+'"',ke.commandStr)}else co(Et)?Ct=Uo(function(_t){var Pe=_t.global.def("[",Pi(Et.length,function(xt){return B.command(typeof Et[xt]=="number"||typeof Et[xt]=="boolean","invalid uniform "+gt,_t.commandStr),Et[xt]}),"]");return Pe}):B.commandRaise('invalid or missing data for uniform "'+gt+'"',ke.commandStr);Ct.value=Et,$t[gt]=Ct}),Object.keys(er).forEach(function(gt){var Et=er[gt];$t[gt]=gu(Et,function(Ct,Ge){return Ct.invoke(Ge,Et)})}),$t}function Gi(ye,ke){var it=ye.static,er=ye.dynamic,$t={};return Object.keys(it).forEach(function(gt){var Et=it[gt],Ct=de.id(gt),Ge=new rr;if(xp(Et))Ge.state=Xr,Ge.buffer=Sr.getBuffer(Sr.create(Et,Sf,!1,!0)),Ge.type=0;else{var _t=Sr.getBuffer(Et);if(_t)Ge.state=Xr,Ge.buffer=_t,Ge.type=0;else if(B.command(typeof Et=="object"&&Et,"invalid data for attribute "+gt,ke.commandStr),"constant"in Et){var Pe=Et.constant;Ge.buffer="null",Ge.state=gn,typeof Pe=="number"?Ge.x=Pe:(B.command(co(Pe)&&Pe.length>0&&Pe.length<=4,"invalid constant for attribute "+gt,ke.commandStr),Er.forEach(function(Wn,Dn){Dn<Pe.length&&(Ge[Wn]=Pe[Dn])}))}else{xp(Et.buffer)?_t=Sr.getBuffer(Sr.create(Et.buffer,Sf,!1,!0)):_t=Sr.getBuffer(Et.buffer),B.command(!!_t,'missing buffer for attribute "'+gt+'"',ke.commandStr);var xt=Et.offset|0;B.command(xt>=0,'invalid offset for attribute "'+gt+'"',ke.commandStr);var hr=Et.stride|0;B.command(hr>=0&&hr<256,'invalid stride for attribute "'+gt+'", must be integer betweeen [0, 255]',ke.commandStr);var vr=Et.size|0;B.command(!("size"in Et)||vr>0&&vr<=4,'invalid size for attribute "'+gt+'", must be 1,2,3,4',ke.commandStr);var Nr=!!Et.normalized,kr=0;"type"in Et&&(B.commandParameter(Et.type,Ra,"invalid type for attribute "+gt,ke.commandStr),kr=Ra[Et.type]);var Hr=Et.divisor|0;"divisor"in Et&&(B.command(Hr===0||Wr,'cannot specify divisor for attribute "'+gt+'", instancing not supported',ke.commandStr),B.command(Hr>=0,'invalid divisor for attribute "'+gt+'"',ke.commandStr)),B.optional(function(){var Wn=ke.commandStr,Dn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Et).forEach(function(Bn){B.command(Dn.indexOf(Bn)>=0,'unknown parameter "'+Bn+'" for attribute pointer "'+gt+'" (valid parameters are '+Dn+")",Wn)})}),Ge.buffer=_t,Ge.state=Xr,Ge.size=vr,Ge.normalized=Nr,Ge.type=kr||_t.dtype,Ge.offset=xt,Ge.stride=hr,Ge.divisor=Hr}}$t[gt]=Uo(function(Wn,Dn){var Bn=Wn.attribCache;if(Ct in Bn)return Bn[Ct];var ai={isStream:!1};return Object.keys(Ge).forEach(function(hi){ai[hi]=Ge[hi]}),Ge.buffer&&(ai.buffer=Wn.link(Ge.buffer),ai.type=ai.type||ai.buffer+".dtype"),Bn[Ct]=ai,ai})}),Object.keys(er).forEach(function(gt){var Et=er[gt];function Ct(Ge,_t){var Pe=Ge.invoke(_t,Et),xt=Ge.shared,hr=Ge.constants,vr=xt.isBufferArgs,Nr=xt.buffer;B.optional(function(){Ge.assert(_t,Pe+"&&(typeof "+Pe+'==="object"||typeof '+Pe+'==="function")&&('+vr+"("+Pe+")||"+Nr+".getBuffer("+Pe+")||"+Nr+".getBuffer("+Pe+".buffer)||"+vr+"("+Pe+'.buffer)||("constant" in '+Pe+"&&(typeof "+Pe+'.constant==="number"||'+xt.isArrayLike+"("+Pe+".constant))))",'invalid dynamic attribute "'+gt+'"')});var kr={isStream:_t.def(!1)},Hr=new rr;Hr.state=Xr,Object.keys(Hr).forEach(function(ai){kr[ai]=_t.def(""+Hr[ai])});var Wn=kr.buffer,Dn=kr.type;_t("if(",vr,"(",Pe,")){",kr.isStream,"=true;",Wn,"=",Nr,".createStream(",Sf,",",Pe,");",Dn,"=",Wn,".dtype;","}else{",Wn,"=",Nr,".getBuffer(",Pe,");","if(",Wn,"){",Dn,"=",Wn,".dtype;",'}else if("constant" in ',Pe,"){",kr.state,"=",gn,";","if(typeof "+Pe+'.constant === "number"){',kr[Er[0]],"=",Pe,".constant;",Er.slice(1).map(function(ai){return kr[ai]}).join("="),"=0;","}else{",Er.map(function(ai,hi){return kr[ai]+"="+Pe+".constant.length>"+hi+"?"+Pe+".constant["+hi+"]:0;"}).join(""),"}}else{","if(",vr,"(",Pe,".buffer)){",Wn,"=",Nr,".createStream(",Sf,",",Pe,".buffer);","}else{",Wn,"=",Nr,".getBuffer(",Pe,".buffer);","}",Dn,'="type" in ',Pe,"?",hr.glTypes,"[",Pe,".type]:",Wn,".dtype;",kr.normalized,"=!!",Pe,".normalized;");function Bn(ai){_t(kr[ai],"=",Pe,".",ai,"|0;")}return Bn("size"),Bn("offset"),Bn("stride"),Bn("divisor"),_t("}}"),_t.exit("if(",kr.isStream,"){",Nr,".destroyStream(",Wn,");","}"),kr}$t[gt]=gu(Et,Ct)}),$t}function Do(ye,ke){var it=ye.static,er=ye.dynamic;if(Cu in it){var $t=it[Cu];return $t!==null&&tn.getVAO($t)===null&&($t=tn.createVAO($t)),Uo(function(Et){return Et.link(tn.getVAO($t))})}else if(Cu in er){var gt=er[Cu];return gu(gt,function(Et,Ct){var Ge=Et.invoke(Ct,gt);return Ct.def(Et.shared.vao+".getVAO("+Ge+")")})}return null}function Pa(ye){var ke=ye.static,it=ye.dynamic,er={};return Object.keys(ke).forEach(function($t){var gt=ke[$t];er[$t]=Uo(function(Et,Ct){return typeof gt=="number"||typeof gt=="boolean"?""+gt:Et.link(gt)})}),Object.keys(it).forEach(function($t){var gt=it[$t];er[$t]=gu(gt,function(Et,Ct){return Et.invoke(Ct,gt)})}),er}function ko(ye,ke,it,er,$t){var gt=ye.static,Et=ye.dynamic;B.optional(function(){var Bn=[cs,bl,iu,fo,zo,fs,Ka,xs,so,Cu].concat(jr);function ai(hi){Object.keys(hi).forEach(function(pa){B.command(Bn.indexOf(pa)>=0,'unknown parameter "'+pa+'"',$t.commandStr)})}ai(gt),ai(Et)});var Ct=gi(ye,ke),Ge=En(ye,$t),_t=wi(ye,Ge,$t),Pe=oa(ye,$t),xt=Io(ye,$t),hr=si(ye,$t,Ct);function vr(Bn){var ai=_t[Bn];ai&&(xt[Bn]=ai)}vr(ls),vr(un(_l));var Nr=Object.keys(xt).length>0,kr={framebuffer:Ge,draw:Pe,shader:hr,state:xt,dirty:Nr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(kr.profile=Vi(ye,$t),kr.uniforms=hs(it,$t),kr.drawVAO=kr.scopeVAO=Do(ye,$t),!kr.drawVAO&&hr.program&&!Ct&&st.angle_instanced_arrays){var Hr=!0,Wn=hr.program.attributes.map(function(Bn){var ai=ke.static[Bn];return Hr=Hr&&!!ai,ai});if(Hr&&Wn.length>0){var Dn=tn.getVAO(tn.createVAO(Wn));kr.drawVAO=new Os(null,null,null,function(Bn,ai){return Bn.link(Dn)}),kr.useVAO=!0}}return Ct?kr.useVAO=!0:kr.attributes=Gi(ke,$t),kr.context=Pa(er,$t),kr}function Fo(ye,ke,it){var er=ye.shared,$t=er.context,gt=ye.scope();Object.keys(it).forEach(function(Et){ke.save($t,"."+Et);var Ct=it[Et];gt($t,".",Et,"=",Ct.append(ye,ke),";")}),ke(gt)}function uo(ye,ke,it,er){var $t=ye.shared,gt=$t.gl,Et=$t.framebuffer,Ct;bn&&(Ct=ke.def($t.extensions,".webgl_draw_buffers"));var Ge=ye.constants,_t=Ge.drawBuffer,Pe=Ge.backBuffer,xt;it?xt=it.append(ye,ke):xt=ke.def(Et,".next"),er||ke("if(",xt,"!==",Et,".cur){"),ke("if(",xt,"){",gt,".bindFramebuffer(",Af,",",xt,".framebuffer);"),bn&&ke(Ct,".drawBuffersWEBGL(",_t,"[",xt,".colorAttachments.length]);"),ke("}else{",gt,".bindFramebuffer(",Af,",null);"),bn&&ke(Ct,".drawBuffersWEBGL(",Pe,");"),ke("}",Et,".cur=",xt,";"),er||ke("}")}function ts(ye,ke,it){var er=ye.shared,$t=er.gl,gt=ye.current,Et=ye.next,Ct=er.current,Ge=er.next,_t=ye.cond(Ct,".dirty");jr.forEach(function(Pe){var xt=un(Pe);if(!(xt in it.state)){var hr,vr;if(xt in Et){hr=Et[xt],vr=gt[xt];var Nr=Pi(xr[xt].length,function(Hr){return _t.def(hr,"[",Hr,"]")});_t(ye.cond(Nr.map(function(Hr,Wn){return Hr+"!=="+vr+"["+Wn+"]"}).join("||")).then($t,".",Lr[xt],"(",Nr,");",Nr.map(function(Hr,Wn){return vr+"["+Wn+"]="+Hr}).join(";"),";"))}else{hr=_t.def(Ge,".",xt);var kr=ye.cond(hr,"!==",Ct,".",xt);_t(kr),xt in an?kr(ye.cond(hr).then($t,".enable(",an[xt],");").else($t,".disable(",an[xt],");"),Ct,".",xt,"=",hr,";"):kr($t,".",Lr[xt],"(",hr,");",Ct,".",xt,"=",hr,";")}}}),Object.keys(it.state).length===0&&_t(Ct,".dirty=false;"),ke(_t)}function Ps(ye,ke,it,er){var $t=ye.shared,gt=ye.current,Et=$t.current,Ct=$t.gl;Ep(Object.keys(it)).forEach(function(Ge){var _t=it[Ge];if(!(er&&!er(_t))){var Pe=_t.append(ye,ke);if(an[Ge]){var xt=an[Ge];Rs(_t)?Pe?ke(Ct,".enable(",xt,");"):ke(Ct,".disable(",xt,");"):ke(ye.cond(Pe).then(Ct,".enable(",xt,");").else(Ct,".disable(",xt,");")),ke(Et,".",Ge,"=",Pe,";")}else if(co(Pe)){var hr=gt[Ge];ke(Ct,".",Lr[Ge],"(",Pe,");",Pe.map(function(vr,Nr){return hr+"["+Nr+"]="+vr}).join(";"),";")}else ke(Ct,".",Lr[Ge],"(",Pe,");",Et,".",Ge,"=",Pe,";")}})}function Vo(ye,ke){Wr&&(ye.instancing=ke.def(ye.shared.extensions,".angle_instanced_arrays"))}function ki(ye,ke,it,er,$t){var gt=ye.shared,Et=ye.stats,Ct=gt.current,Ge=gt.timer,_t=it.profile;function Pe(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var xt,hr;function vr(Bn){xt=ke.def(),Bn(xt,"=",Pe(),";"),typeof $t=="string"?Bn(Et,".count+=",$t,";"):Bn(Et,".count++;"),sn&&(er?(hr=ke.def(),Bn(hr,"=",Ge,".getNumPendingQueries();")):Bn(Ge,".beginQuery(",Et,");"))}function Nr(Bn){Bn(Et,".cpuTime+=",Pe(),"-",xt,";"),sn&&(er?Bn(Ge,".pushScopeStats(",hr,",",Ge,".getNumPendingQueries(),",Et,");"):Bn(Ge,".endQuery();"))}function kr(Bn){var ai=ke.def(Ct,".profile");ke(Ct,".profile=",Bn,";"),ke.exit(Ct,".profile=",ai,";")}var Hr;if(_t){if(Rs(_t)){_t.enable?(vr(ke),Nr(ke.exit),kr("true")):kr("false");return}Hr=_t.append(ye,ke),kr(Hr)}else Hr=ke.def(Ct,".profile");var Wn=ye.block();vr(Wn),ke("if(",Hr,"){",Wn,"}");var Dn=ye.block();Nr(Dn),ke.exit("if(",Hr,"){",Dn,"}")}function Ss(ye,ke,it,er,$t){var gt=ye.shared;function Et(Ge){switch(Ge){case rh:case bp:case pc:return 2;case Wh:case _o:case dc:return 3;case _p:case nh:case Xl:return 4;default:return 1}}function Ct(Ge,_t,Pe){var xt=gt.gl,hr=ke.def(Ge,".location"),vr=ke.def(gt.attributes,"[",hr,"]"),Nr=Pe.state,kr=Pe.buffer,Hr=[Pe.x,Pe.y,Pe.z,Pe.w],Wn=["buffer","normalized","offset","stride"];function Dn(){ke("if(!",vr,".buffer){",xt,".enableVertexAttribArray(",hr,");}");var ai=Pe.type,hi;if(Pe.size?hi=ke.def(Pe.size,"||",_t):hi=_t,ke("if(",vr,".type!==",ai,"||",vr,".size!==",hi,"||",Wn.map(function(Ho){return vr+"."+Ho+"!=="+Pe[Ho]}).join("||"),"){",xt,".bindBuffer(",Sf,",",kr,".buffer);",xt,".vertexAttribPointer(",[hr,hi,ai,Pe.normalized,Pe.stride,Pe.offset],");",vr,".type=",ai,";",vr,".size=",hi,";",Wn.map(function(Ho){return vr+"."+Ho+"="+Pe[Ho]+";"}).join(""),"}"),Wr){var pa=Pe.divisor;ke("if(",vr,".divisor!==",pa,"){",ye.instancing,".vertexAttribDivisorANGLE(",[hr,pa],");",vr,".divisor=",pa,";}")}}function Bn(){ke("if(",vr,".buffer){",xt,".disableVertexAttribArray(",hr,");",vr,".buffer=null;","}if(",Er.map(function(ai,hi){return vr+"."+ai+"!=="+Hr[hi]}).join("||"),"){",xt,".vertexAttrib4f(",hr,",",Hr,");",Er.map(function(ai,hi){return vr+"."+ai+"="+Hr[hi]+";"}).join(""),"}")}Nr===Xr?Dn():Nr===gn?Bn():(ke("if(",Nr,"===",Xr,"){"),Dn(),ke("}else{"),Bn(),ke("}"))}er.forEach(function(Ge){var _t=Ge.name,Pe=it.attributes[_t],xt;if(Pe){if(!$t(Pe))return;xt=Pe.append(ye,ke)}else{if(!$t(yv))return;var hr=ye.scopeAttrib(_t);B.optional(function(){ye.assert(ke,hr+".state","missing attribute "+_t)}),xt={},Object.keys(new rr).forEach(function(vr){xt[vr]=ke.def(hr,".",vr)})}Ct(ye.link(Ge),Et(Ge.info.type),xt)})}function ha(ye,ke,it,er,$t){for(var gt=ye.shared,Et=gt.gl,Ct,Ge=0;Ge<er.length;++Ge){var _t=er[Ge],Pe=_t.name,xt=_t.info.type,hr=it.uniforms[Pe],vr=ye.link(_t),Nr=vr+".location",kr;if(hr){if(!$t(hr))continue;if(Rs(hr)){var Hr=hr.value;if(B.command(Hr!==null&&typeof Hr!="undefined",'missing uniform "'+Pe+'"',ye.commandStr),xt===Ha||xt===wu){B.command(typeof Hr=="function"&&(xt===Ha&&(Hr._reglType==="texture2d"||Hr._reglType==="framebuffer")||xt===wu&&(Hr._reglType==="textureCube"||Hr._reglType==="framebufferCube")),"invalid texture for uniform "+Pe,ye.commandStr);var Wn=ye.link(Hr._texture||Hr.color[0]._texture);ke(Et,".uniform1i(",Nr,",",Wn+".bind());"),ke.exit(Wn,".unbind();")}else if(xt===ah||xt===Es||xt===ea){B.optional(function(){B.command(co(Hr),"invalid matrix for uniform "+Pe,ye.commandStr),B.command(xt===ah&&Hr.length===4||xt===Es&&Hr.length===9||xt===ea&&Hr.length===16,"invalid length for matrix uniform "+Pe,ye.commandStr)});var Dn=ye.global.def("new Float32Array(["+Array.prototype.slice.call(Hr)+"])"),Bn=2;xt===Es?Bn=3:xt===ea&&(Bn=4),ke(Et,".uniformMatrix",Bn,"fv(",Nr,",false,",Dn,");")}else{switch(xt){case yp:B.commandType(Hr,"number","uniform "+Pe,ye.commandStr),Ct="1f";break;case rh:B.command(co(Hr)&&Hr.length===2,"uniform "+Pe,ye.commandStr),Ct="2f";break;case Wh:B.command(co(Hr)&&Hr.length===3,"uniform "+Pe,ye.commandStr),Ct="3f";break;case _p:B.command(co(Hr)&&Hr.length===4,"uniform "+Pe,ye.commandStr),Ct="4f";break;case ih:B.commandType(Hr,"boolean","uniform "+Pe,ye.commandStr),Ct="1i";break;case Hc:B.commandType(Hr,"number","uniform "+Pe,ye.commandStr),Ct="1i";break;case pc:B.command(co(Hr)&&Hr.length===2,"uniform "+Pe,ye.commandStr),Ct="2i";break;case bp:B.command(co(Hr)&&Hr.length===2,"uniform "+Pe,ye.commandStr),Ct="2i";break;case dc:B.command(co(Hr)&&Hr.length===3,"uniform "+Pe,ye.commandStr),Ct="3i";break;case _o:B.command(co(Hr)&&Hr.length===3,"uniform "+Pe,ye.commandStr),Ct="3i";break;case Xl:B.command(co(Hr)&&Hr.length===4,"uniform "+Pe,ye.commandStr),Ct="4i";break;case nh:B.command(co(Hr)&&Hr.length===4,"uniform "+Pe,ye.commandStr),Ct="4i";break}ke(Et,".uniform",Ct,"(",Nr,",",co(Hr)?Array.prototype.slice.call(Hr):Hr,");")}continue}else kr=hr.append(ye,ke)}else{if(!$t(yv))continue;kr=ke.def(gt.uniforms,"[",de.id(Pe),"]")}xt===Ha?ke("if(",kr,"&&",kr,'._reglType==="framebuffer"){',kr,"=",kr,".color[0];","}"):xt===wu&&ke("if(",kr,"&&",kr,'._reglType==="framebufferCube"){',kr,"=",kr,".color[0];","}"),B.optional(function(){function El($l,Sd){ye.assert(ke,$l,'bad data or missing for uniform "'+Pe+'".  '+Sd)}function xd($l){El("typeof "+kr+'==="'+$l+'"',"invalid type, expected "+$l)}function Ou($l,Sd){El(gt.isArrayLike+"("+kr+")&&"+kr+".length==="+$l,"invalid vector, should have length "+$l,ye.commandStr)}function Ed($l){El("typeof "+kr+'==="function"&&'+kr+'._reglType==="texture'+($l===vp?"2d":"Cube")+'"',"invalid texture type",ye.commandStr)}switch(xt){case Hc:xd("number");break;case bp:Ou(2,"number");break;case _o:Ou(3,"number");break;case nh:Ou(4,"number");break;case yp:xd("number");break;case rh:Ou(2,"number");break;case Wh:Ou(3,"number");break;case _p:Ou(4,"number");break;case ih:xd("boolean");break;case pc:Ou(2,"boolean");break;case dc:Ou(3,"boolean");break;case Xl:Ou(4,"boolean");break;case ah:Ou(4,"number");break;case Es:Ou(9,"number");break;case ea:Ou(16,"number");break;case Ha:Ed(vp);break;case wu:Ed(Mm);break}});var ai=1;switch(xt){case Ha:case wu:var hi=ke.def(kr,"._texture");ke(Et,".uniform1i(",Nr,",",hi,".bind());"),ke.exit(hi,".unbind();");continue;case Hc:case ih:Ct="1i";break;case bp:case pc:Ct="2i",ai=2;break;case _o:case dc:Ct="3i",ai=3;break;case nh:case Xl:Ct="4i",ai=4;break;case yp:Ct="1f";break;case rh:Ct="2f",ai=2;break;case Wh:Ct="3f",ai=3;break;case _p:Ct="4f",ai=4;break;case ah:Ct="Matrix2fv";break;case Es:Ct="Matrix3fv";break;case ea:Ct="Matrix4fv";break}if(ke(Et,".uniform",Ct,"(",Nr,","),Ct.charAt(0)==="M"){var pa=Math.pow(xt-ah+2,2),Ho=ye.global.def("new Float32Array(",pa,")");ke("false,(Array.isArray(",kr,")||",kr," instanceof Float32Array)?",kr,":(",Pi(pa,function(El){return Ho+"["+El+"]="+kr+"["+El+"]"}),",",Ho,")")}else ai>1?ke(Pi(ai,function(El){return kr+"["+El+"]"})):ke(kr);ke(");")}}function ui(ye,ke,it,er){var $t=ye.shared,gt=$t.gl,Et=$t.draw,Ct=er.draw;function Ge(){var hi=Ct.elements,pa,Ho=ke;return hi?((hi.contextDep&&er.contextDynamic||hi.propDep)&&(Ho=it),pa=hi.append(ye,Ho)):pa=Ho.def(Et,".",fo),pa&&Ho("if("+pa+")"+gt+".bindBuffer("+Yg+","+pa+".buffer.buffer);"),pa}function _t(){var hi=Ct.count,pa,Ho=ke;return hi?((hi.contextDep&&er.contextDynamic||hi.propDep)&&(Ho=it),pa=hi.append(ye,Ho),B.optional(function(){hi.MISSING&&ye.assert(ke,"false","missing vertex count"),hi.DYNAMIC&&ye.assert(Ho,pa+">=0","missing vertex count")})):(pa=Ho.def(Et,".",Ka),B.optional(function(){ye.assert(Ho,pa+">=0","missing vertex count")})),pa}var Pe=Ge();function xt(hi){var pa=Ct[hi];return pa?pa.contextDep&&er.contextDynamic||pa.propDep?pa.append(ye,it):pa.append(ye,ke):ke.def(Et,".",hi)}var hr=xt(zo),vr=xt(fs),Nr=_t();if(typeof Nr=="number"){if(Nr===0)return}else it("if(",Nr,"){"),it.exit("}");var kr,Hr;Wr&&(kr=xt(xs),Hr=ye.instancing);var Wn=Pe+".type",Dn=Ct.elements&&Rs(Ct.elements);function Bn(){function hi(){it(Hr,".drawElementsInstancedANGLE(",[hr,Nr,Wn,vr+"<<(("+Wn+"-"+en+")>>1)",kr],");")}function pa(){it(Hr,".drawArraysInstancedANGLE(",[hr,vr,Nr,kr],");")}Pe?Dn?hi():(it("if(",Pe,"){"),hi(),it("}else{"),pa(),it("}")):pa()}function ai(){function hi(){it(gt+".drawElements("+[hr,Nr,Wn,vr+"<<(("+Wn+"-"+en+")>>1)"]+");")}function pa(){it(gt+".drawArrays("+[hr,vr,Nr]+");")}Pe?Dn?hi():(it("if(",Pe,"){"),hi(),it("}else{"),pa(),it("}")):pa()}Wr&&(typeof kr!="number"||kr>=0)?typeof kr=="string"?(it("if(",kr,">0){"),Bn(),it("}else if(",kr,"<0){"),ai(),it("}")):Bn():ai()}function Oi(ye,ke,it,er,$t){var gt=Qn(),Et=gt.proc("body",$t);return B.optional(function(){gt.commandStr=ke.commandStr,gt.command=gt.link(ke.commandStr)}),Wr&&(gt.instancing=Et.def(gt.shared.extensions,".angle_instanced_arrays")),ye(gt,Et,it,er),gt.compile().body}function ra(ye,ke,it,er){Vo(ye,ke),it.useVAO?it.drawVAO?ke(ye.shared.vao,".setVAO(",it.drawVAO.append(ye,ke),");"):ke(ye.shared.vao,".setVAO(",ye.shared.vao,".targetVAO);"):(ke(ye.shared.vao,".setVAO(null);"),Ss(ye,ke,it,er.attributes,function(){return!0})),ha(ye,ke,it,er.uniforms,function(){return!0}),ui(ye,ke,ke,it)}function ps(ye,ke){var it=ye.proc("draw",1);Vo(ye,it),Fo(ye,it,ke.context),uo(ye,it,ke.framebuffer),ts(ye,it,ke),Ps(ye,it,ke.state),ki(ye,it,ke,!1,!0);var er=ke.shader.progVar.append(ye,it);if(it(ye.shared.gl,".useProgram(",er,".program);"),ke.shader.program)ra(ye,it,ke,ke.shader.program);else{it(ye.shared.vao,".setVAO(null);");var $t=ye.global.def("{}"),gt=it.def(er,".id"),Et=it.def($t,"[",gt,"]");it(ye.cond(Et).then(Et,".call(this,a0);").else(Et,"=",$t,"[",gt,"]=",ye.link(function(Ct){return Oi(ra,ye,ke,Ct,1)}),"(",er,");",Et,".call(this,a0);"))}Object.keys(ke.state).length>0&&it(ye.shared.current,".dirty=true;")}function Us(ye,ke,it,er){ye.batchId="a1",Vo(ye,ke);function $t(){return!0}Ss(ye,ke,it,er.attributes,$t),ha(ye,ke,it,er.uniforms,$t),ui(ye,ke,ke,it)}function Ze(ye,ke,it,er){Vo(ye,ke);var $t=it.contextDep,gt=ke.def(),Et="a0",Ct="a1",Ge=ke.def();ye.shared.props=Ge,ye.batchId=gt;var _t=ye.scope(),Pe=ye.scope();ke(_t.entry,"for(",gt,"=0;",gt,"<",Ct,";++",gt,"){",Ge,"=",Et,"[",gt,"];",Pe,"}",_t.exit);function xt(Wn){return Wn.contextDep&&$t||Wn.propDep}function hr(Wn){return!xt(Wn)}if(it.needsContext&&Fo(ye,Pe,it.context),it.needsFramebuffer&&uo(ye,Pe,it.framebuffer),Ps(ye,Pe,it.state,xt),it.profile&&xt(it.profile)&&ki(ye,Pe,it,!1,!0),er)it.useVAO?it.drawVAO?xt(it.drawVAO)?Pe(ye.shared.vao,".setVAO(",it.drawVAO.append(ye,Pe),");"):_t(ye.shared.vao,".setVAO(",it.drawVAO.append(ye,_t),");"):_t(ye.shared.vao,".setVAO(",ye.shared.vao,".targetVAO);"):(_t(ye.shared.vao,".setVAO(null);"),Ss(ye,_t,it,er.attributes,hr),Ss(ye,Pe,it,er.attributes,xt)),ha(ye,_t,it,er.uniforms,hr),ha(ye,Pe,it,er.uniforms,xt),ui(ye,_t,Pe,it);else{var vr=ye.global.def("{}"),Nr=it.shader.progVar.append(ye,Pe),kr=Pe.def(Nr,".id"),Hr=Pe.def(vr,"[",kr,"]");Pe(ye.shared.gl,".useProgram(",Nr,".program);","if(!",Hr,"){",Hr,"=",vr,"[",kr,"]=",ye.link(function(Wn){return Oi(Us,ye,it,Wn,2)}),"(",Nr,");}",Hr,".call(this,a0[",gt,"],",gt,");")}}function fr(ye,ke){var it=ye.proc("batch",2);ye.batchId="0",Vo(ye,it);var er=!1,$t=!0;Object.keys(ke.context).forEach(function(vr){er=er||ke.context[vr].propDep}),er||(Fo(ye,it,ke.context),$t=!1);var gt=ke.framebuffer,Et=!1;gt?(gt.propDep?er=Et=!0:gt.contextDep&&er&&(Et=!0),Et||uo(ye,it,gt)):uo(ye,it,null),ke.state.viewport&&ke.state.viewport.propDep&&(er=!0);function Ct(vr){return vr.contextDep&&er||vr.propDep}ts(ye,it,ke),Ps(ye,it,ke.state,function(vr){return!Ct(vr)}),(!ke.profile||!Ct(ke.profile))&&ki(ye,it,ke,!1,"a1"),ke.contextDep=er,ke.needsContext=$t,ke.needsFramebuffer=Et;var Ge=ke.shader.progVar;if(Ge.contextDep&&er||Ge.propDep)Ze(ye,it,ke,null);else{var _t=Ge.append(ye,it);if(it(ye.shared.gl,".useProgram(",_t,".program);"),ke.shader.program)Ze(ye,it,ke,ke.shader.program);else{it(ye.shared.vao,".setVAO(null);");var Pe=ye.global.def("{}"),xt=it.def(_t,".id"),hr=it.def(Pe,"[",xt,"]");it(ye.cond(hr).then(hr,".call(this,a0,a1);").else(hr,"=",Pe,"[",xt,"]=",ye.link(function(vr){return Oi(Ze,ye,ke,vr,2)}),"(",_t,");",hr,".call(this,a0,a1);"))}}Object.keys(ke.state).length>0&&it(ye.shared.current,".dirty=true;")}function Kt(ye,ke){var it=ye.proc("scope",3);ye.batchId="a2";var er=ye.shared,$t=er.current;Fo(ye,it,ke.context),ke.framebuffer&&ke.framebuffer.append(ye,it),Ep(Object.keys(ke.state)).forEach(function(Et){var Ct=ke.state[Et],Ge=Ct.append(ye,it);co(Ge)?Ge.forEach(function(_t,Pe){it.set(ye.next[Et],"["+Pe+"]",_t)}):it.set(er.next,"."+Et,Ge)}),ki(ye,it,ke,!0,!0),[fo,fs,Ka,xs,zo].forEach(function(Et){var Ct=ke.draw[Et];!Ct||it.set(er.draw,"."+Et,""+Ct.append(ye,it))}),Object.keys(ke.uniforms).forEach(function(Et){it.set(er.uniforms,"["+de.id(Et)+"]",ke.uniforms[Et].append(ye,it))}),Object.keys(ke.attributes).forEach(function(Et){var Ct=ke.attributes[Et].append(ye,it),Ge=ye.scopeAttrib(Et);Object.keys(new rr).forEach(function(_t){it.set(Ge,"."+_t,Ct[_t])})}),ke.scopeVAO&&it.set(er.vao,".targetVAO",ke.scopeVAO.append(ye,it));function gt(Et){var Ct=ke.shader[Et];Ct&&it.set(er.shader,"."+Et,Ct.append(ye,it))}gt(bl),gt(iu),Object.keys(ke.state).length>0&&(it($t,".dirty=true;"),it.exit($t,".dirty=true;")),it("a1(",ye.shared.context,",a0,",ye.batchId,");")}function Sn(ye){if(!(typeof ye!="object"||co(ye))){for(var ke=Object.keys(ye),it=0;it<ke.length;++it)if(Or.isDynamic(ye[ke[it]]))return!0;return!1}}function Ri(ye,ke,it){var er=ke.static[it];if(!er||!Sn(er))return;var $t=ye.global,gt=Object.keys(er),Et=!1,Ct=!1,Ge=!1,_t=ye.global.def("{}");gt.forEach(function(xt){var hr=er[xt];if(Or.isDynamic(hr)){typeof hr=="function"&&(hr=er[xt]=Or.unbox(hr));var vr=gu(hr,null);Et=Et||vr.thisDep,Ge=Ge||vr.propDep,Ct=Ct||vr.contextDep}else{switch($t(_t,".",xt,"="),typeof hr){case"number":$t(hr);break;case"string":$t('"',hr,'"');break;case"object":Array.isArray(hr)&&$t("[",hr.join(),"]");break;default:$t(ye.link(hr));break}$t(";")}});function Pe(xt,hr){gt.forEach(function(vr){var Nr=er[vr];if(!!Or.isDynamic(Nr)){var kr=xt.invoke(hr,Nr);hr(_t,".",vr,"=",kr,";")}})}ke.dynamic[it]=new Or.DynamicVariable(Ji,{thisDep:Et,contextDep:Ct,propDep:Ge,ref:_t,append:Pe}),delete ke.static[it]}function xa(ye,ke,it,er,$t){var gt=Qn();gt.stats=gt.link($t),Object.keys(ke.static).forEach(function(Ct){Ri(gt,ke,Ct)}),hd.forEach(function(Ct){Ri(gt,ye,Ct)});var Et=ko(ye,ke,it,er,gt);return ps(gt,Et),Kt(gt,Et),fr(gt,Et),gt.compile()}return{next:Zn,current:xr,procs:function(){var ye=Qn(),ke=ye.proc("poll"),it=ye.proc("refresh"),er=ye.block();ke(er),it(er);var $t=ye.shared,gt=$t.gl,Et=$t.next,Ct=$t.current;er(Ct,".dirty=false;"),uo(ye,ke),uo(ye,it,null,!0);var Ge;Wr&&(Ge=ye.link(Wr)),st.oes_vertex_array_object&&it(ye.link(st.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var _t=0;_t<qt.maxAttributes;++_t){var Pe=it.def($t.attributes,"[",_t,"]"),xt=ye.cond(Pe,".buffer");xt.then(gt,".enableVertexAttribArray(",_t,");",gt,".bindBuffer(",Sf,",",Pe,".buffer.buffer);",gt,".vertexAttribPointer(",_t,",",Pe,".size,",Pe,".type,",Pe,".normalized,",Pe,".stride,",Pe,".offset);").else(gt,".disableVertexAttribArray(",_t,");",gt,".vertexAttrib4f(",_t,",",Pe,".x,",Pe,".y,",Pe,".z,",Pe,".w);",Pe,".buffer=null;"),it(xt),Wr&&it(Ge,".vertexAttribDivisorANGLE(",_t,",",Pe,".divisor);")}return it(ye.shared.vao,".currentVAO=null;",ye.shared.vao,".setVAO(",ye.shared.vao,".targetVAO);"),Object.keys(an).forEach(function(hr){var vr=an[hr],Nr=er.def(Et,".",hr),kr=ye.block();kr("if(",Nr,"){",gt,".enable(",vr,")}else{",gt,".disable(",vr,")}",Ct,".",hr,"=",Nr,";"),it(kr),ke("if(",Nr,"!==",Ct,".",hr,"){",kr,"}")}),Object.keys(Lr).forEach(function(hr){var vr=Lr[hr],Nr=xr[hr],kr,Hr,Wn=ye.block();if(Wn(gt,".",vr,"("),co(Nr)){var Dn=Nr.length;kr=ye.global.def(Et,".",hr),Hr=ye.global.def(Ct,".",hr),Wn(Pi(Dn,function(Bn){return kr+"["+Bn+"]"}),");",Pi(Dn,function(Bn){return Hr+"["+Bn+"]="+kr+"["+Bn+"];"}).join("")),ke("if(",Pi(Dn,function(Bn){return kr+"["+Bn+"]!=="+Hr+"["+Bn+"]"}).join("||"),"){",Wn,"}")}else kr=er.def(Et,".",hr),Hr=er.def(Ct,".",hr),Wn(kr,");",Ct,".",hr,"=",kr,";"),ke("if(",kr,"!==",Hr,"){",Wn,"}");it(Wn)}),ye.compile()}(),compile:xa}}function _v(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Dm=34918,km=34919,bv=35007,Fm=function(de,st){if(!st.ext_disjoint_timer_query)return null;var qt=[];function Sr(){return qt.pop()||st.ext_disjoint_timer_query.createQueryEXT()}function _r(bn){qt.push(bn)}var Bt=[];function Ur(bn){var xr=Sr();st.ext_disjoint_timer_query.beginQueryEXT(bv,xr),Bt.push(xr),Yr(Bt.length-1,Bt.length,bn)}function $r(){st.ext_disjoint_timer_query.endQueryEXT(bv)}function tn(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Kr=[];function nn(){return Kr.pop()||new tn}function mn(bn){Kr.push(bn)}var sn=[];function Yr(bn,xr,Zn){var jr=nn();jr.startQueryIndex=bn,jr.endQueryIndex=xr,jr.sum=0,jr.stats=Zn,sn.push(jr)}var rr=[],Qt=[];function Wr(){var bn,xr,Zn=Bt.length;if(Zn!==0){Qt.length=Math.max(Qt.length,Zn+1),rr.length=Math.max(rr.length,Zn+1),rr[0]=0,Qt[0]=0;var jr=0;for(bn=0,xr=0;xr<Bt.length;++xr){var an=Bt[xr];st.ext_disjoint_timer_query.getQueryObjectEXT(an,km)?(jr+=st.ext_disjoint_timer_query.getQueryObjectEXT(an,Dm),_r(an)):Bt[bn++]=an,rr[xr+1]=jr,Qt[xr+1]=bn}for(Bt.length=bn,bn=0,xr=0;xr<sn.length;++xr){var Lr=sn[xr],un=Lr.startQueryIndex,$n=Lr.endQueryIndex;Lr.sum+=rr[$n]-rr[un];var bi=Qt[un],fn=Qt[$n];fn===bi?(Lr.stats.gpuTime+=Lr.sum/1e6,mn(Lr)):(Lr.startQueryIndex=bi,Lr.endQueryIndex=fn,sn[bn++]=Lr)}sn.length=bn}}return{beginQuery:Ur,endQuery:$r,pushScopeStats:Yr,update:Wr,getNumPendingQueries:function(){return Bt.length},clear:function(){qt.push.apply(qt,Bt);for(var xr=0;xr<qt.length;xr++)st.ext_disjoint_timer_query.deleteQueryEXT(qt[xr]);Bt.length=0,qt.length=0},restore:function(){Bt.length=0,qt.length=0}}},xv=16384,Ms=256,Bm=1024,yd=34962,_d="webglcontextlost",Ev="webglcontextrestored",Cf=1,Sp=2,Ap=3;function Sv(Q,de){for(var st=0;st<Q.length;++st)if(Q[st]===de)return st;return-1}function bd(Q){var de=Lo(Q);if(!de)return null;var st=de.gl,qt=st.getContextAttributes(),Sr=st.isContextLost(),_r=as(st,de);if(!_r)return null;var Bt=xn(),Ur=_v(),$r=_r.extensions,tn=Fm(st,$r),Kr=Jr(),nn=st.drawingBufferWidth,mn=st.drawingBufferHeight,sn={tick:0,time:0,viewportWidth:nn,viewportHeight:mn,framebufferWidth:nn,framebufferHeight:mn,drawingBufferWidth:nn,drawingBufferHeight:mn,pixelRatio:de.pixelRatio},Yr={},rr={elements:null,primitive:4,count:-1,offset:0,instances:-1},Qt=sl(st,$r),Wr=Ah(st,Ur,de,xr),bn=ee(st,$r,Qt,Ur,Wr);function xr(ui){return bn.destroyBuffer(ui)}var Zn=hp(st,$r,Wr,Ur),jr=$e(st,Bt,Ur,de),an=js(st,$r,Qt,function(){$n.procs.poll()},sn,Ur,de),Lr=$s(st,$r,Qt,Ur,de),un=O(st,$r,Qt,an,Lr,Ur),$n=Gh(st,Bt,$r,Qt,Wr,Zn,an,un,Yr,bn,jr,rr,sn,tn,de),bi=Pt(st,un,$n.procs.poll,sn,qt,$r,Qt),fn=$n.next,Gr=st.canvas,Pr=[],Qn=[],Vi=[],En=[de.onDestroy],wi=null;function gi(){if(Pr.length===0){tn&&tn.update(),wi=null;return}wi=jn.next(gi),Ps();for(var ui=Pr.length-1;ui>=0;--ui){var Oi=Pr[ui];Oi&&Oi(sn,null,0)}st.flush(),tn&&tn.update()}function si(){!wi&&Pr.length>0&&(wi=jn.next(gi))}function oa(){wi&&(jn.cancel(gi),wi=null)}function Io(ui){ui.preventDefault(),Sr=!0,oa(),Qn.forEach(function(Oi){Oi()})}function hs(ui){st.getError(),Sr=!1,_r.restore(),jr.restore(),Wr.restore(),an.restore(),Lr.restore(),un.restore(),bn.restore(),tn&&tn.restore(),$n.procs.refresh(),si(),Vi.forEach(function(Oi){Oi()})}Gr&&(Gr.addEventListener(_d,Io,!1),Gr.addEventListener(Ev,hs,!1));function Gi(){Pr.length=0,oa(),Gr&&(Gr.removeEventListener(_d,Io),Gr.removeEventListener(Ev,hs)),jr.clear(),un.clear(),Lr.clear(),an.clear(),Zn.clear(),Wr.clear(),bn.clear(),tn&&tn.clear(),En.forEach(function(ui){ui()})}function Do(ui){B(!!ui,"invalid args to regl({...})"),B.type(ui,"object","invalid args to regl({...})");function Oi($t){var gt=N({},$t);delete gt.uniforms,delete gt.attributes,delete gt.context,delete gt.vao,"stencil"in gt&&gt.stencil.op&&(gt.stencil.opBack=gt.stencil.opFront=gt.stencil.op,delete gt.stencil.op);function Et(Ct){if(Ct in gt){var Ge=gt[Ct];delete gt[Ct],Object.keys(Ge).forEach(function(_t){gt[Ct+"."+_t]=Ge[_t]})}}return Et("blend"),Et("depth"),Et("cull"),Et("stencil"),Et("polygonOffset"),Et("scissor"),Et("sample"),"vao"in $t&&(gt.vao=$t.vao),gt}function ra($t){var gt={},Et={};return Object.keys($t).forEach(function(Ct){var Ge=$t[Ct];Or.isDynamic(Ge)?Et[Ct]=Or.unbox(Ge,Ct):gt[Ct]=Ge}),{dynamic:Et,static:gt}}var ps=ra(ui.context||{}),Us=ra(ui.uniforms||{}),Ze=ra(ui.attributes||{}),fr=ra(Oi(ui)),Kt={gpuTime:0,cpuTime:0,count:0},Sn=$n.compile(fr,Ze,Us,ps,Kt),Ri=Sn.draw,xa=Sn.batch,ye=Sn.scope,ke=[];function it($t){for(;ke.length<$t;)ke.push(null);return ke}function er($t,gt){var Et;if(Sr&&B.raise("context lost"),typeof $t=="function")return ye.call(this,null,$t,0);if(typeof gt=="function")if(typeof $t=="number")for(Et=0;Et<$t;++Et)ye.call(this,null,gt,Et);else if(Array.isArray($t))for(Et=0;Et<$t.length;++Et)ye.call(this,$t[Et],gt,Et);else return ye.call(this,$t,gt,0);else if(typeof $t=="number"){if($t>0)return xa.call(this,it($t|0),$t|0)}else if(Array.isArray($t)){if($t.length)return xa.call(this,$t,$t.length)}else return Ri.call(this,$t)}return N(er,{stats:Kt})}var Pa=un.setFBO=Do({framebuffer:Or.define.call(null,Cf,"framebuffer")});function ko(ui,Oi){var ra=0;$n.procs.poll();var ps=Oi.color;ps&&(st.clearColor(+ps[0]||0,+ps[1]||0,+ps[2]||0,+ps[3]||0),ra|=xv),"depth"in Oi&&(st.clearDepth(+Oi.depth),ra|=Ms),"stencil"in Oi&&(st.clearStencil(Oi.stencil|0),ra|=Bm),B(!!ra,"called regl.clear with no buffer specified"),st.clear(ra)}function Fo(ui){if(B(typeof ui=="object"&&ui,"regl.clear() takes an object as input"),"framebuffer"in ui)if(ui.framebuffer&&ui.framebuffer_reglType==="framebufferCube")for(var Oi=0;Oi<6;++Oi)Pa(N({framebuffer:ui.framebuffer.faces[Oi]},ui),ko);else Pa(ui,ko);else ko(null,ui)}function uo(ui){B.type(ui,"function","regl.frame() callback must be a function"),Pr.push(ui);function Oi(){var ra=Sv(Pr,ui);B(ra>=0,"cannot cancel a frame twice");function ps(){var Us=Sv(Pr,ps);Pr[Us]=Pr[Pr.length-1],Pr.length-=1,Pr.length<=0&&oa()}Pr[ra]=ps}return si(),{cancel:Oi}}function ts(){var ui=fn.viewport,Oi=fn.scissor_box;ui[0]=ui[1]=Oi[0]=Oi[1]=0,sn.viewportWidth=sn.framebufferWidth=sn.drawingBufferWidth=ui[2]=Oi[2]=st.drawingBufferWidth,sn.viewportHeight=sn.framebufferHeight=sn.drawingBufferHeight=ui[3]=Oi[3]=st.drawingBufferHeight}function Ps(){sn.tick+=1,sn.time=ki(),ts(),$n.procs.poll()}function Vo(){ts(),$n.procs.refresh(),tn&&tn.update()}function ki(){return(Jr()-Kr)/1e3}Vo();function Ss(ui,Oi){B.type(Oi,"function","listener callback must be a function");var ra;switch(ui){case"frame":return uo(Oi);case"lost":ra=Qn;break;case"restore":ra=Vi;break;case"destroy":ra=En;break;default:B.raise("invalid event, must be one of frame,lost,restore,destroy")}return ra.push(Oi),{cancel:function(){for(var Us=0;Us<ra.length;++Us)if(ra[Us]===Oi){ra[Us]=ra[ra.length-1],ra.pop();return}}}}var ha=N(Do,{clear:Fo,prop:Or.define.bind(null,Cf),context:Or.define.bind(null,Sp),this:Or.define.bind(null,Ap),draw:Do({}),buffer:function(Oi){return Wr.create(Oi,yd,!1,!1)},elements:function(Oi){return Zn.create(Oi,!1)},texture:an.create2D,cube:an.createCube,renderbuffer:Lr.create,framebuffer:un.create,framebufferCube:un.createCube,vao:bn.createVAO,attributes:qt,frame:uo,on:Ss,limits:Qt,hasExtension:function(Oi){return Qt.extensions.indexOf(Oi.toLowerCase())>=0},read:bi,destroy:Gi,_gl:st,_refresh:Vo,poll:function(){Ps(),tn&&tn.update()},now:ki,stats:Ur});return de.onDone(null,ha),ha}return bd})},fo6e:function(se,Z){var C=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function D(N){return C.test(N)}se.exports=D},g4R6:function(se,Z){function C(D,N,z){return D===D&&(z!==void 0&&(D=D<=z?D:z),N!==void 0&&(D=D>=N?D:N)),D}se.exports=C},gFfm:function(se,Z){function C(D,N){for(var z=-1,k=D==null?0:D.length;++z<k&&N(D[z],z,D)!==!1;);return D}se.exports=C},gQMU:function(se,Z,C){var D=C("0ZTe"),N=D("toUpperCase");se.exports=N},gzZq:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingToSyntax=void 0;var D=C("MON2"),N=C("FV85"),z=C("D9lx"),k=C("LKzl"),v=function(){function L(U){this._binding=U}return L.prototype.to=function(U){return this._binding.type=N.BindingTypeEnum.Instance,this._binding.implementationType=U,new z.BindingInWhenOnSyntax(this._binding)},L.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+D.INVALID_TO_SELF_VALUE);var U=this._binding.serviceIdentifier;return this.to(U)},L.prototype.toConstantValue=function(U){return this._binding.type=N.BindingTypeEnum.ConstantValue,this._binding.cache=U,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=N.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},L.prototype.toDynamicValue=function(U){return this._binding.type=N.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=U,this._binding.implementationType=null,new z.BindingInWhenOnSyntax(this._binding)},L.prototype.toConstructor=function(U){return this._binding.type=N.BindingTypeEnum.Constructor,this._binding.implementationType=U,this._binding.scope=N.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},L.prototype.toFactory=function(U){return this._binding.type=N.BindingTypeEnum.Factory,this._binding.factory=U,this._binding.scope=N.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},L.prototype.toFunction=function(U){if(typeof U!="function")throw new Error(D.INVALID_FUNCTION_BINDING);var K=this.toConstantValue(U);return this._binding.type=N.BindingTypeEnum.Function,this._binding.scope=N.BindingScopeEnum.Singleton,K},L.prototype.toAutoFactory=function(U){return this._binding.type=N.BindingTypeEnum.Factory,this._binding.factory=function(K){var q=function(){return K.container.get(U)};return q},this._binding.scope=N.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},L.prototype.toProvider=function(U){return this._binding.type=N.BindingTypeEnum.Provider,this._binding.provider=U,this._binding.scope=N.BindingScopeEnum.Singleton,new k.BindingWhenOnSyntax(this._binding)},L.prototype.toService=function(U){this.toDynamicValue(function(K){return K.container.get(U)})},L}();Z.BindingToSyntax=v},h7MG:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.getBindingDictionary=Z.createMockRequest=Z.plan=void 0;var D=C("doU7"),N=C("MON2"),z=C("FV85"),k=C("xfSm"),v=C("qK8v"),L=C("ujMp"),U=C("oy+k"),K=C("GXnB"),q=C("yMAV"),fe=C("fbrv"),ue=C("xiII"),rt=C("dX1H");function Ne(tr){return tr._bindingDictionary}Z.getBindingDictionary=Ne;function nt(tr,yr,Dr,Mr,jt,He){var Dt=tr?k.MULTI_INJECT_TAG:k.INJECT_TAG,Ut=new K.Metadata(Dt,Dr),Ce=new rt.Target(yr,Mr,Dr,Ut);if(jt!==void 0){var ve=new K.Metadata(jt,He);Ce.metadata.push(ve)}return Ce}function wt(tr,yr,Dr,Mr,jt){var He=St(Dr.container,jt.serviceIdentifier),Dt=[];return He.length===D.BindingCount.NoBindingsAvailable&&Dr.container.options.autoBindInjectable&&typeof jt.serviceIdentifier=="function"&&tr.getConstructorMetadata(jt.serviceIdentifier).compilerGeneratedMetadata&&(Dr.container.bind(jt.serviceIdentifier).toSelf(),He=St(Dr.container,jt.serviceIdentifier)),yr?Dt=He:Dt=He.filter(function(Ut){var Ce=new ue.Request(Ut.serviceIdentifier,Dr,Mr,Ut,jt);return Ut.constraint(Ce)}),ht(jt.serviceIdentifier,Dt,jt,Dr.container),Dt}function ht(tr,yr,Dr,Mr){switch(yr.length){case D.BindingCount.NoBindingsAvailable:if(Dr.isOptional())return yr;var jt=L.getServiceIdentifierAsString(tr),He=N.NOT_REGISTERED;throw He+=L.listMetadataForTarget(jt,Dr),He+=L.listRegisteredBindingsForServiceIdentifier(Mr,jt,St),new Error(He);case D.BindingCount.OnlyOneBindingAvailable:if(!Dr.isArray())return yr;case D.BindingCount.MultipleBindingsAvailable:default:if(Dr.isArray())return yr;var jt=L.getServiceIdentifierAsString(tr),He=N.AMBIGUOUS_MATCH+" "+jt;throw He+=L.listRegisteredBindingsForServiceIdentifier(Mr,jt,St),new Error(He)}}function We(tr,yr,Dr,Mr,jt,He){var Dt,Ut;if(jt===null){Dt=wt(tr,yr,Mr,null,He),Ut=new ue.Request(Dr,Mr,null,Dt,He);var Ce=new q.Plan(Mr,Ut);Mr.addPlan(Ce)}else Dt=wt(tr,yr,Mr,jt,He),Ut=jt.addChildRequest(He.serviceIdentifier,Dt,He);Dt.forEach(function(ve){var Ie=null;if(He.isArray())Ie=Ut.addChildRequest(ve.serviceIdentifier,ve,He);else{if(ve.cache)return;Ie=Ut}if(ve.type===z.BindingTypeEnum.Instance&&ve.implementationType!==null){var zt=fe.getDependencies(tr,ve.implementationType);if(!Mr.container.options.skipBaseClassChecks){var le=fe.getBaseClassDependencyCount(tr,ve.implementationType);if(zt.length<le){var Me=N.ARGUMENTS_LENGTH_MISMATCH(fe.getFunctionName(ve.implementationType));throw new Error(Me)}}zt.forEach(function(Re){We(tr,!1,Re.serviceIdentifier,Mr,Ie,Re)})}})}function St(tr,yr){var Dr=[],Mr=Ne(tr);return Mr.hasKey(yr)?Dr=Mr.get(yr):tr.parent!==null&&(Dr=St(tr.parent,yr)),Dr}function Je(tr,yr,Dr,Mr,jt,He,Dt,Ut){Ut===void 0&&(Ut=!1);var Ce=new U.Context(yr),ve=nt(Dr,Mr,jt,"",He,Dt);try{return We(tr,Ut,jt,Ce,null,ve),Ce}catch(Ie){throw v.isStackOverflowExeption(Ie)&&Ce.plan&&L.circularDependencyToException(Ce.plan.rootRequest),Ie}}Z.plan=Je;function Ft(tr,yr,Dr,Mr){var jt=new rt.Target(z.TargetTypeEnum.Variable,"",yr,new K.Metadata(Dr,Mr)),He=new U.Context(tr),Dt=new ue.Request(yr,He,null,[],jt);return Dt}Z.createMockRequest=Ft},heNW:function(se,Z){function C(D,N,z){switch(z.length){case 0:return D.call(N);case 1:return D.call(N,z[0]);case 2:return D.call(N,z[0],z[1]);case 3:return D.call(N,z[0],z[1],z[2])}return D.apply(N,z)}se.exports=C},hypo:function(se,Z,C){var D=C("O0oS");function N(z,k,v){k=="__proto__"&&D?D(z,k,{configurable:!0,enumerable:!0,value:v,writable:!0}):z[k]=v}se.exports=N},hzCD:function(se,Z,C){var D=C("EA7m"),N=C("0Q2g"),z=D(N);se.exports=z},iegG:function(se,Z){function C(N){var z=N.target||N.srcElement;z.__resizeRAF__&&cancelAnimationFrame(z.__resizeRAF__),z.__resizeRAF__=requestAnimationFrame(function(){var k=z.__resizeTrigger__,v=k&&k.__resizeListeners__;v&&v.forEach(function(L){L.call(k,N)})})}var D=function(z,k){var v=this,L=v.document,U,K=L.attachEvent;typeof navigator!="undefined"&&(U=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function q(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",C)}if(!z.__resizeListeners__)if(z.__resizeListeners__=[],K)z.__resizeTrigger__=z,z.attachEvent("onresize",C);else{getComputedStyle(z).position==="static"&&(z.style.position="relative");var fe=z.__resizeTrigger__=L.createElement("object");fe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),fe.setAttribute("class","resize-sensor"),fe.setAttribute("tabindex","-1"),fe.setAttribute("title",""),fe.__resizeElement__=z,fe.onload=q,fe.type="text/html",U&&z.appendChild(fe),fe.data="about:blank",U||z.appendChild(fe)}z.__resizeListeners__.push(k)};se.exports=typeof window=="undefined"?D:D.bind(window),se.exports.unbind=function(N,z){var k=document.attachEvent,v=N.__resizeListeners__||[];if(z){var L=v.indexOf(z);L!==-1&&v.splice(L,1)}else v=N.__resizeListeners__=[];if(!v.length){if(k)N.detachEvent("onresize",C);else if(N.__resizeTrigger__){var U=N.__resizeTrigger__.contentDocument,K=U&&U.defaultView;K&&(K.removeEventListener("resize",C),delete K.__resizeTrigger__),N.__resizeTrigger__=!N.removeChild(N.__resizeTrigger__)}delete N.__resizeListeners__}}},itsj:function(se,Z){function C(D,N){if(!(N==="constructor"&&typeof D[N]=="function")&&N!="__proto__")return D[N]}se.exports=C},jCWc:function(se,Z,C){"use strict";var D=C("EFp3"),N=C.n(D),z=C("1GLa")},"jIg/":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.multiInject=void 0;var D=C("xfSm"),N=C("GXnB"),z=C("Ztfv");function k(v){return function(L,U,K){var q=new N.Metadata(D.MULTI_INJECT_TAG,v);typeof K=="number"?z.tagParameter(L,U,K,q):z.tagProperty(L,U,q)}}Z.multiInject=k},jYQm:function(se,Z,C){"use strict";var D=C("q1tI"),N=C.n(D),z=Object(D.createContext)({});Z.a=z},jYx5:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.optional=void 0;var D=C("xfSm"),N=C("GXnB"),z=C("Ztfv");function k(){return function(v,L,U){var K=new N.Metadata(D.OPTIONAL_TAG,!0);typeof U=="number"?z.tagParameter(v,L,U,K):z.tagProperty(v,L,K)}}Z.optional=k},"jbM+":function(se,Z,C){var D=C("R/W3");function N(z,k){var v=z==null?0:z.length;return!!v&&D(z,k,0)>-1}se.exports=N},jeLo:function(se,Z,C){var D=C("juv8"),N=C("mTTR");function z(k){return D(k,N(k))}se.exports=z},juv8:function(se,Z,C){var D=C("MrPd"),N=C("hypo");function z(k,v,L,U){var K=!L;L||(L={});for(var q=-1,fe=v.length;++q<fe;){var ue=v[q],rt=U?U(L[ue],k[ue],ue,L,k):void 0;rt===void 0&&(rt=k[ue]),K?N(L,ue,rt):D(L,ue,rt)}return L}se.exports=z},kPKH:function(se,Z,C){"use strict";var D=C("/kpp");Z.a=D.a},lwsE:function(se,Z){function C(D,N){if(!(D instanceof N))throw new TypeError("Cannot call a class as a function")}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},mNvP:function(se,Z,C){(function(D,N){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var z;(function(k){(function(v){var L=typeof N=="object"?N:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),U=K(k);typeof L.Reflect=="undefined"?L.Reflect=k:U=K(L.Reflect,U),v(U);function K(q,fe){return function(ue,rt){typeof q[ue]!="function"&&Object.defineProperty(q,ue,{configurable:!0,writable:!0,value:rt}),fe&&fe(ue,rt)}}})(function(v){var L=Object.prototype.hasOwnProperty,U=typeof Symbol=="function",K=U&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",q=U&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",fe=typeof Object.create=="function",ue={__proto__:[]}instanceof Array,rt=!fe&&!ue,Ne={create:fe?function(){return sr(Object.create(null))}:ue?function(){return sr({__proto__:null})}:function(){return sr({})},has:rt?function(at,Ot){return L.call(at,Ot)}:function(at,Ot){return Ot in at},get:rt?function(at,Ot){return L.call(at,Ot)?at[Ot]:void 0}:function(at,Ot){return at[Ot]}},nt=Object.getPrototypeOf(Function),wt=typeof D=="object"&&D["env"]&&D["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",ht=!wt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Xe(),We=!wt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:bt(),St=!wt&&typeof WeakMap=="function"?WeakMap:Gt(),Je=new St;function Ft(at,Ot,or,Tr){if(Cr(or)){if(!Ar(at))throw new TypeError;if(!Xt(Ot))throw new TypeError;return ve(at,Ot)}else{if(!Ar(at))throw new TypeError;if(!Fr(Ot))throw new TypeError;if(!Fr(Tr)&&!Cr(Tr)&&!Br(Tr))throw new TypeError;return Br(Tr)&&(Tr=void 0),or=Yn(or),Ie(at,Ot,or,Tr)}}v("decorate",Ft);function tr(at,Ot){function or(Tr,Or){if(!Fr(Tr))throw new TypeError;if(!Cr(Or)&&!Wt(Or))throw new TypeError;At(at,Ot,Tr,Or)}return or}v("metadata",tr);function yr(at,Ot,or,Tr){if(!Fr(or))throw new TypeError;return Cr(Tr)||(Tr=Yn(Tr)),At(at,Ot,or,Tr)}v("defineMetadata",yr);function Dr(at,Ot,or){if(!Fr(Ot))throw new TypeError;return Cr(or)||(or=Yn(or)),le(at,Ot,or)}v("hasMetadata",Dr);function Mr(at,Ot,or){if(!Fr(Ot))throw new TypeError;return Cr(or)||(or=Yn(or)),Me(at,Ot,or)}v("hasOwnMetadata",Mr);function jt(at,Ot,or){if(!Fr(Ot))throw new TypeError;return Cr(or)||(or=Yn(or)),Re(at,Ot,or)}v("getMetadata",jt);function He(at,Ot,or){if(!Fr(Ot))throw new TypeError;return Cr(or)||(or=Yn(or)),yt(at,Ot,or)}v("getOwnMetadata",He);function Dt(at,Ot){if(!Fr(at))throw new TypeError;return Cr(Ot)||(Ot=Yn(Ot)),ae(at,Ot)}v("getMetadataKeys",Dt);function Ut(at,Ot){if(!Fr(at))throw new TypeError;return Cr(Ot)||(Ot=Yn(Ot)),It(at,Ot)}v("getOwnMetadataKeys",Ut);function Ce(at,Ot,or){if(!Fr(Ot))throw new TypeError;Cr(or)||(or=Yn(or));var Tr=zt(Ot,or,!1);if(Cr(Tr)||!Tr.delete(at))return!1;if(Tr.size>0)return!0;var Or=Je.get(Ot);return Or.delete(or),Or.size>0||Je.delete(Ot),!0}v("deleteMetadata",Ce);function ve(at,Ot){for(var or=at.length-1;or>=0;--or){var Tr=at[or],Or=Tr(Ot);if(!Cr(Or)&&!Br(Or)){if(!Xt(Or))throw new TypeError;Ot=Or}}return Ot}function Ie(at,Ot,or,Tr){for(var Or=at.length-1;Or>=0;--Or){var jn=at[Or],Jr=jn(Ot,or,Tr);if(!Cr(Jr)&&!Br(Jr)){if(!Fr(Jr))throw new TypeError;Tr=Jr}}return Tr}function zt(at,Ot,or){var Tr=Je.get(at);if(Cr(Tr)){if(!or)return;Tr=new ht,Je.set(at,Tr)}var Or=Tr.get(Ot);if(Cr(Or)){if(!or)return;Or=new ht,Tr.set(Ot,Or)}return Or}function le(at,Ot,or){var Tr=Me(at,Ot,or);if(Tr)return!0;var Or=Ae(Ot);return Br(Or)?!1:le(at,Or,or)}function Me(at,Ot,or){var Tr=zt(Ot,or,!1);return Cr(Tr)?!1:Nn(Tr.has(at))}function Re(at,Ot,or){var Tr=Me(at,Ot,or);if(Tr)return yt(at,Ot,or);var Or=Ae(Ot);if(!Br(Or))return Re(at,Or,or)}function yt(at,Ot,or){var Tr=zt(Ot,or,!1);if(!Cr(Tr))return Tr.get(at)}function At(at,Ot,or,Tr){var Or=zt(or,Tr,!0);Or.set(at,Ot)}function ae(at,Ot){var or=It(at,Ot),Tr=Ae(at);if(Tr===null)return or;var Or=ae(Tr,Ot);if(Or.length<=0)return or;if(or.length<=0)return Or;for(var jn=new We,Jr=[],xn=0,An=or;xn<An.length;xn++){var ii=An[xn],pi=jn.has(ii);pi||(jn.add(ii),Jr.push(ii))}for(var Si=0,wa=Or;Si<wa.length;Si++){var ii=wa[Si],pi=jn.has(ii);pi||(jn.add(ii),Jr.push(ii))}return Jr}function It(at,Ot){var or=[],Tr=zt(at,Ot,!1);if(Cr(Tr))return or;for(var Or=Tr.keys(),jn=Ue(Or),Jr=0;;){var xn=ie(jn);if(!xn)return or.length=Jr,or;var An=he(xn);try{or[Jr]=An}catch(ii){try{B(jn)}finally{throw ii}}Jr++}}function lr(at){if(at===null)return 1;switch(typeof at){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return at===null?1:6;default:return 6}}function Cr(at){return at===void 0}function Br(at){return at===null}function pn(at){return typeof at=="symbol"}function Fr(at){return typeof at=="object"?at!==null:typeof at=="function"}function Pn(at,Ot){switch(lr(at)){case 0:return at;case 1:return at;case 2:return at;case 3:return at;case 4:return at;case 5:return at}var or=Ot===3?"string":Ot===5?"number":"default",Tr=Ir(at,K);if(Tr!==void 0){var Or=Tr.call(at,or);if(Fr(Or))throw new TypeError;return Or}return ni(at,or==="default"?"number":or)}function ni(at,Ot){if(Ot==="string"){var or=at.toString;if(mr(or)){var Tr=or.call(at);if(!Fr(Tr))return Tr}var Or=at.valueOf;if(mr(Or)){var Tr=Or.call(at);if(!Fr(Tr))return Tr}}else{var Or=at.valueOf;if(mr(Or)){var Tr=Or.call(at);if(!Fr(Tr))return Tr}var jn=at.toString;if(mr(jn)){var Tr=jn.call(at);if(!Fr(Tr))return Tr}}throw new TypeError}function Nn(at){return!!at}function Kn(at){return""+at}function Yn(at){var Ot=Pn(at,3);return pn(Ot)?Ot:Kn(Ot)}function Ar(at){return Array.isArray?Array.isArray(at):at instanceof Object?at instanceof Array:Object.prototype.toString.call(at)==="[object Array]"}function mr(at){return typeof at=="function"}function Xt(at){return typeof at=="function"}function Wt(at){switch(lr(at)){case 3:return!0;case 4:return!0;default:return!1}}function Ir(at,Ot){var or=at[Ot];if(or!=null){if(!mr(or))throw new TypeError;return or}}function Ue(at){var Ot=Ir(at,q);if(!mr(Ot))throw new TypeError;var or=Ot.call(at);if(!Fr(or))throw new TypeError;return or}function he(at){return at.value}function ie(at){var Ot=at.next();return Ot.done?!1:Ot}function B(at){var Ot=at.return;Ot&&Ot.call(at)}function Ae(at){var Ot=Object.getPrototypeOf(at);if(typeof at!="function"||at===nt||Ot!==nt)return Ot;var or=at.prototype,Tr=or&&Object.getPrototypeOf(or);if(Tr==null||Tr===Object.prototype)return Ot;var Or=Tr.constructor;return typeof Or!="function"||Or===at?Ot:Or}function Xe(){var at={},Ot=[],or=function(){function Jr(xn,An,ii){this._index=0,this._keys=xn,this._values=An,this._selector=ii}return Jr.prototype["@@iterator"]=function(){return this},Jr.prototype[q]=function(){return this},Jr.prototype.next=function(){var xn=this._index;if(xn>=0&&xn<this._keys.length){var An=this._selector(this._keys[xn],this._values[xn]);return xn+1>=this._keys.length?(this._index=-1,this._keys=Ot,this._values=Ot):this._index++,{value:An,done:!1}}return{value:void 0,done:!0}},Jr.prototype.throw=function(xn){throw this._index>=0&&(this._index=-1,this._keys=Ot,this._values=Ot),xn},Jr.prototype.return=function(xn){return this._index>=0&&(this._index=-1,this._keys=Ot,this._values=Ot),{value:xn,done:!0}},Jr}();return function(){function Jr(){this._keys=[],this._values=[],this._cacheKey=at,this._cacheIndex=-2}return Object.defineProperty(Jr.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Jr.prototype.has=function(xn){return this._find(xn,!1)>=0},Jr.prototype.get=function(xn){var An=this._find(xn,!1);return An>=0?this._values[An]:void 0},Jr.prototype.set=function(xn,An){var ii=this._find(xn,!0);return this._values[ii]=An,this},Jr.prototype.delete=function(xn){var An=this._find(xn,!1);if(An>=0){for(var ii=this._keys.length,pi=An+1;pi<ii;pi++)this._keys[pi-1]=this._keys[pi],this._values[pi-1]=this._values[pi];return this._keys.length--,this._values.length--,xn===this._cacheKey&&(this._cacheKey=at,this._cacheIndex=-2),!0}return!1},Jr.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=at,this._cacheIndex=-2},Jr.prototype.keys=function(){return new or(this._keys,this._values,Tr)},Jr.prototype.values=function(){return new or(this._keys,this._values,Or)},Jr.prototype.entries=function(){return new or(this._keys,this._values,jn)},Jr.prototype["@@iterator"]=function(){return this.entries()},Jr.prototype[q]=function(){return this.entries()},Jr.prototype._find=function(xn,An){return this._cacheKey!==xn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=xn)),this._cacheIndex<0&&An&&(this._cacheIndex=this._keys.length,this._keys.push(xn),this._values.push(void 0)),this._cacheIndex},Jr}();function Tr(Jr,xn){return Jr}function Or(Jr,xn){return xn}function jn(Jr,xn){return[Jr,xn]}}function bt(){return function(){function at(){this._map=new ht}return Object.defineProperty(at.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),at.prototype.has=function(Ot){return this._map.has(Ot)},at.prototype.add=function(Ot){return this._map.set(Ot,Ot),this},at.prototype.delete=function(Ot){return this._map.delete(Ot)},at.prototype.clear=function(){this._map.clear()},at.prototype.keys=function(){return this._map.keys()},at.prototype.values=function(){return this._map.values()},at.prototype.entries=function(){return this._map.entries()},at.prototype["@@iterator"]=function(){return this.keys()},at.prototype[q]=function(){return this.keys()},at}()}function Gt(){var at=16,Ot=Ne.create(),or=Tr();return function(){function An(){this._key=Tr()}return An.prototype.has=function(ii){var pi=Or(ii,!1);return pi!==void 0?Ne.has(pi,this._key):!1},An.prototype.get=function(ii){var pi=Or(ii,!1);return pi!==void 0?Ne.get(pi,this._key):void 0},An.prototype.set=function(ii,pi){var Si=Or(ii,!0);return Si[this._key]=pi,this},An.prototype.delete=function(ii){var pi=Or(ii,!1);return pi!==void 0?delete pi[this._key]:!1},An.prototype.clear=function(){this._key=Tr()},An}();function Tr(){var An;do An="@@WeakMap@@"+xn();while(Ne.has(Ot,An));return Ot[An]=!0,An}function Or(An,ii){if(!L.call(An,or)){if(!ii)return;Object.defineProperty(An,or,{value:Ne.create()})}return An[or]}function jn(An,ii){for(var pi=0;pi<ii;++pi)An[pi]=Math.random()*255|0;return An}function Jr(An){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(An)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(An)):jn(new Uint8Array(An),An):jn(new Array(An),An)}function xn(){var An=Jr(at);An[6]=An[6]&79|64,An[8]=An[8]&191|128;for(var ii="",pi=0;pi<at;++pi){var Si=An[pi];(pi===4||pi===6||pi===8)&&(ii+="-"),Si<16&&(ii+="0"),ii+=Si.toString(16).toLowerCase()}return ii}}function sr(at){return at.__=void 0,delete at.__,at}})})(z||(z={}))}).call(this,C("Q2Ig"),C("IyRk"))},mTTR:function(se,Z,C){var D=C("b80T"),N=C("QcOe"),z=C("MMmD");function k(v){return z(v)?D(v,!0):N(v)}se.exports=k},mc0g:function(se,Z){function C(D){return function(N,z,k){for(var v=-1,L=Object(N),U=k(N),K=U.length;K--;){var q=U[D?K:++v];if(z(L[q],q,L)===!1)break}return N}}se.exports=C},mpbz:function(se,Z,C){(function(D,N){se.exports=N()})(this,function(){"use strict";function D(jt,He,Dt,Ut,Ce,ve){if(!(Ce-Ut<=Dt)){var Ie=Ut+Ce>>1;N(jt,He,Ie,Ut,Ce,ve%2),D(jt,He,Dt,Ut,Ie-1,ve+1),D(jt,He,Dt,Ie+1,Ce,ve+1)}}function N(jt,He,Dt,Ut,Ce,ve){for(;Ce>Ut;){if(Ce-Ut>600){var Ie=Ce-Ut+1,zt=Dt-Ut+1,le=Math.log(Ie),Me=.5*Math.exp(2*le/3),Re=.5*Math.sqrt(le*Me*(Ie-Me)/Ie)*(zt-Ie/2<0?-1:1),yt=Math.max(Ut,Math.floor(Dt-zt*Me/Ie+Re)),At=Math.min(Ce,Math.floor(Dt+(Ie-zt)*Me/Ie+Re));N(jt,He,Dt,yt,At,ve)}var ae=He[2*Dt+ve],It=Ut,lr=Ce;for(z(jt,He,Ut,Dt),He[2*Ce+ve]>ae&&z(jt,He,Ut,Ce);It<lr;){for(z(jt,He,It,lr),It++,lr--;He[2*It+ve]<ae;)It++;for(;He[2*lr+ve]>ae;)lr--}He[2*Ut+ve]===ae?z(jt,He,Ut,lr):(lr++,z(jt,He,lr,Ce)),lr<=Dt&&(Ut=lr+1),Dt<=lr&&(Ce=lr-1)}}function z(jt,He,Dt,Ut){k(jt,Dt,Ut),k(He,2*Dt,2*Ut),k(He,2*Dt+1,2*Ut+1)}function k(jt,He,Dt){var Ut=jt[He];jt[He]=jt[Dt],jt[Dt]=Ut}function v(jt,He,Dt,Ut,Ce,ve,Ie){for(var zt=[0,jt.length-1,0],le=[],Me,Re;zt.length;){var yt=zt.pop(),At=zt.pop(),ae=zt.pop();if(At-ae<=Ie){for(var It=ae;It<=At;It++)Me=He[2*It],Re=He[2*It+1],Me>=Dt&&Me<=Ce&&Re>=Ut&&Re<=ve&&le.push(jt[It]);continue}var lr=Math.floor((ae+At)/2);Me=He[2*lr],Re=He[2*lr+1],Me>=Dt&&Me<=Ce&&Re>=Ut&&Re<=ve&&le.push(jt[lr]);var Cr=(yt+1)%2;(yt===0?Dt<=Me:Ut<=Re)&&(zt.push(ae),zt.push(lr-1),zt.push(Cr)),(yt===0?Ce>=Me:ve>=Re)&&(zt.push(lr+1),zt.push(At),zt.push(Cr))}return le}function L(jt,He,Dt,Ut,Ce,ve){for(var Ie=[0,jt.length-1,0],zt=[],le=Ce*Ce;Ie.length;){var Me=Ie.pop(),Re=Ie.pop(),yt=Ie.pop();if(Re-yt<=ve){for(var At=yt;At<=Re;At++)U(He[2*At],He[2*At+1],Dt,Ut)<=le&&zt.push(jt[At]);continue}var ae=Math.floor((yt+Re)/2),It=He[2*ae],lr=He[2*ae+1];U(It,lr,Dt,Ut)<=le&&zt.push(jt[ae]);var Cr=(Me+1)%2;(Me===0?Dt-Ce<=It:Ut-Ce<=lr)&&(Ie.push(yt),Ie.push(ae-1),Ie.push(Cr)),(Me===0?Dt+Ce>=It:Ut+Ce>=lr)&&(Ie.push(ae+1),Ie.push(Re),Ie.push(Cr))}return zt}function U(jt,He,Dt,Ut){var Ce=jt-Dt,ve=He-Ut;return Ce*Ce+ve*ve}var K=function(He){return He[0]},q=function(He){return He[1]},fe=function(He,Dt,Ut,Ce,ve){Dt===void 0&&(Dt=K),Ut===void 0&&(Ut=q),Ce===void 0&&(Ce=64),ve===void 0&&(ve=Float64Array),this.nodeSize=Ce,this.points=He;for(var Ie=He.length<65536?Uint16Array:Uint32Array,zt=this.ids=new Ie(He.length),le=this.coords=new ve(He.length*2),Me=0;Me<He.length;Me++)zt[Me]=Me,le[2*Me]=Dt(He[Me]),le[2*Me+1]=Ut(He[Me]);D(zt,le,Ce,0,zt.length-1,0)};fe.prototype.range=function(He,Dt,Ut,Ce){return v(this.ids,this.coords,He,Dt,Ut,Ce,this.nodeSize)},fe.prototype.within=function(He,Dt,Ut){return L(this.ids,this.coords,He,Dt,Ut,this.nodeSize)};var ue={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(He){return He}},rt=Math.fround||function(jt){return function(He){return jt[0]=+He,jt[0]}}(new Float32Array(1)),Ne=function(He){this.options=yr(Object.create(ue),He),this.trees=new Array(this.options.maxZoom+1)};Ne.prototype.load=function(He){var Dt=this.options,Ut=Dt.log,Ce=Dt.minZoom,ve=Dt.maxZoom,Ie=Dt.nodeSize;Ut&&console.time("total time");var zt="prepare "+He.length+" points";Ut&&console.time(zt),this.points=He;for(var le=[],Me=0;Me<He.length;Me++)!He[Me].geometry||le.push(wt(He[Me],Me));this.trees[ve+1]=new fe(le,Dr,Mr,Ie,Float32Array),Ut&&console.timeEnd(zt);for(var Re=ve;Re>=Ce;Re--){var yt=+Date.now();le=this._cluster(le,Re),this.trees[Re]=new fe(le,Dr,Mr,Ie,Float32Array),Ut&&console.log("z%d: %d clusters in %dms",Re,le.length,+Date.now()-yt)}return Ut&&console.timeEnd("total time"),this},Ne.prototype.getClusters=function(He,Dt){var Ut=((He[0]+180)%360+360)%360-180,Ce=Math.max(-90,Math.min(90,He[1])),ve=He[2]===180?180:((He[2]+180)%360+360)%360-180,Ie=Math.max(-90,Math.min(90,He[3]));if(He[2]-He[0]>=360)Ut=-180,ve=180;else if(Ut>ve){var zt=this.getClusters([Ut,Ce,180,Ie],Dt),le=this.getClusters([-180,Ce,ve,Ie],Dt);return zt.concat(le)}for(var Me=this.trees[this._limitZoom(Dt)],Re=Me.range(St(Ut),Je(Ie),St(ve),Je(Ce)),yt=[],At=0,ae=Re;At<ae.length;At+=1){var It=ae[At],lr=Me.points[It];yt.push(lr.numPoints?ht(lr):this.points[lr.index])}return yt},Ne.prototype.getChildren=function(He){var Dt=this._getOriginId(He),Ut=this._getOriginZoom(He),Ce="No cluster with the specified id.",ve=this.trees[Ut];if(!ve)throw new Error(Ce);var Ie=ve.points[Dt];if(!Ie)throw new Error(Ce);for(var zt=this.options.radius/(this.options.extent*Math.pow(2,Ut-1)),le=ve.within(Ie.x,Ie.y,zt),Me=[],Re=0,yt=le;Re<yt.length;Re+=1){var At=yt[Re],ae=ve.points[At];ae.parentId===He&&Me.push(ae.numPoints?ht(ae):this.points[ae.index])}if(Me.length===0)throw new Error(Ce);return Me},Ne.prototype.getLeaves=function(He,Dt,Ut){Dt=Dt||10,Ut=Ut||0;var Ce=[];return this._appendLeaves(Ce,He,Dt,Ut,0),Ce},Ne.prototype.getTile=function(He,Dt,Ut){var Ce=this.trees[this._limitZoom(He)],ve=Math.pow(2,He),Ie=this.options,zt=Ie.extent,le=Ie.radius,Me=le/zt,Re=(Ut-Me)/ve,yt=(Ut+1+Me)/ve,At={features:[]};return this._addTileFeatures(Ce.range((Dt-Me)/ve,Re,(Dt+1+Me)/ve,yt),Ce.points,Dt,Ut,ve,At),Dt===0&&this._addTileFeatures(Ce.range(1-Me/ve,Re,1,yt),Ce.points,ve,Ut,ve,At),Dt===ve-1&&this._addTileFeatures(Ce.range(0,Re,Me/ve,yt),Ce.points,-1,Ut,ve,At),At.features.length?At:null},Ne.prototype.getClusterExpansionZoom=function(He){for(var Dt=this._getOriginZoom(He)-1;Dt<=this.options.maxZoom;){var Ut=this.getChildren(He);if(Dt++,Ut.length!==1)break;He=Ut[0].properties.cluster_id}return Dt},Ne.prototype._appendLeaves=function(He,Dt,Ut,Ce,ve){for(var Ie=this.getChildren(Dt),zt=0,le=Ie;zt<le.length;zt+=1){var Me=le[zt],Re=Me.properties;if(Re&&Re.cluster?ve+Re.point_count<=Ce?ve+=Re.point_count:ve=this._appendLeaves(He,Re.cluster_id,Ut,Ce,ve):ve<Ce?ve++:He.push(Me),He.length===Ut)break}return ve},Ne.prototype._addTileFeatures=function(He,Dt,Ut,Ce,ve,Ie){for(var zt=0,le=He;zt<le.length;zt+=1){var Me=le[zt],Re=Dt[Me],yt=Re.numPoints,At=void 0,ae=void 0,It=void 0;if(yt)At=We(Re),ae=Re.x,It=Re.y;else{var lr=this.points[Re.index];At=lr.properties,ae=St(lr.geometry.coordinates[0]),It=Je(lr.geometry.coordinates[1])}var Cr={type:1,geometry:[[Math.round(this.options.extent*(ae*ve-Ut)),Math.round(this.options.extent*(It*ve-Ce))]],tags:At},Br=void 0;yt?Br=Re.id:this.options.generateId?Br=Re.index:this.points[Re.index].id&&(Br=this.points[Re.index].id),Br!==void 0&&(Cr.id=Br),Ie.features.push(Cr)}},Ne.prototype._limitZoom=function(He){return Math.max(this.options.minZoom,Math.min(Math.floor(+He),this.options.maxZoom+1))},Ne.prototype._cluster=function(He,Dt){for(var Ut=[],Ce=this.options,ve=Ce.radius,Ie=Ce.extent,zt=Ce.reduce,le=Ce.minPoints,Me=ve/(Ie*Math.pow(2,Dt)),Re=0;Re<He.length;Re++){var yt=He[Re];if(!(yt.zoom<=Dt)){yt.zoom=Dt;for(var At=this.trees[Dt+1],ae=At.within(yt.x,yt.y,Me),It=yt.numPoints||1,lr=It,Cr=0,Br=ae;Cr<Br.length;Cr+=1){var pn=Br[Cr],Fr=At.points[pn];Fr.zoom>Dt&&(lr+=Fr.numPoints||1)}if(lr>It&&lr>=le){for(var Pn=yt.x*It,ni=yt.y*It,Nn=zt&&It>1?this._map(yt,!0):null,Kn=(Re<<5)+(Dt+1)+this.points.length,Yn=0,Ar=ae;Yn<Ar.length;Yn+=1){var mr=Ar[Yn],Xt=At.points[mr];if(!(Xt.zoom<=Dt)){Xt.zoom=Dt;var Wt=Xt.numPoints||1;Pn+=Xt.x*Wt,ni+=Xt.y*Wt,Xt.parentId=Kn,zt&&(Nn||(Nn=this._map(yt,!0)),zt(Nn,this._map(Xt)))}}yt.parentId=Kn,Ut.push(nt(Pn/lr,ni/lr,Kn,lr,Nn))}else if(Ut.push(yt),lr>1)for(var Ir=0,Ue=ae;Ir<Ue.length;Ir+=1){var he=Ue[Ir],ie=At.points[he];ie.zoom<=Dt||(ie.zoom=Dt,Ut.push(ie))}}}return Ut},Ne.prototype._getOriginId=function(He){return He-this.points.length>>5},Ne.prototype._getOriginZoom=function(He){return(He-this.points.length)%32},Ne.prototype._map=function(He,Dt){if(He.numPoints)return Dt?yr({},He.properties):He.properties;var Ut=this.points[He.index].properties,Ce=this.options.map(Ut);return Dt&&Ce===Ut?yr({},Ce):Ce};function nt(jt,He,Dt,Ut,Ce){return{x:rt(jt),y:rt(He),zoom:Infinity,id:Dt,parentId:-1,numPoints:Ut,properties:Ce}}function wt(jt,He){var Dt=jt.geometry.coordinates,Ut=Dt[0],Ce=Dt[1];return{x:rt(St(Ut)),y:rt(Je(Ce)),zoom:Infinity,index:He,parentId:-1}}function ht(jt){return{type:"Feature",id:jt.id,properties:We(jt),geometry:{type:"Point",coordinates:[Ft(jt.x),tr(jt.y)]}}}function We(jt){var He=jt.numPoints,Dt=He>=1e4?Math.round(He/1e3)+"k":He>=1e3?Math.round(He/100)/10+"k":He;return yr(yr({},jt.properties),{cluster:!0,cluster_id:jt.id,point_count:He,point_count_abbreviated:Dt})}function St(jt){return jt/360+.5}function Je(jt){var He=Math.sin(jt*Math.PI/180),Dt=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return Dt<0?0:Dt>1?1:Dt}function Ft(jt){return(jt-.5)*360}function tr(jt){var He=(180-jt*360)*Math.PI/180;return 360*Math.atan(Math.exp(He))/Math.PI-90}function yr(jt,He){for(var Dt in He)jt[Dt]=He[Dt];return jt}function Dr(jt){return jt.x}function Mr(jt){return jt.y}return Ne})},"mv/X":function(se,Z,C){var D=C("ljhN"),N=C("MMmD"),z=C("wJg7"),k=C("GoyQ");function v(L,U,K){if(!k(K))return!1;var q=typeof U;return(q=="number"?N(K)&&z(U,K.length):q=="string"&&U in K)?D(K[U],L):!1}se.exports=v},mwIZ:function(se,Z,C){var D=C("ZWtO");function N(z,k,v){var L=z==null?void 0:D(z,k);return L===void 0?v:L}se.exports=N},n2J3:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.unmanaged=void 0;var D=C("xfSm"),N=C("GXnB"),z=C("Ztfv");function k(){return function(v,L,U){var K=new N.Metadata(D.UNMANAGED_TAG,!0);z.tagParameter(v,L,U,K)}}Z.unmanaged=k},"oCl/":function(se,Z,C){var D=C("CH3K"),N=C("LcsW"),z=C("MvSz"),k=C("0ycA"),v=Object.getOwnPropertySymbols,L=v?function(U){for(var K=[];U;)D(K,z(U)),U=N(U);return K}:k;se.exports=L},oIFs:function(se,Z,C){},oaX6:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.targetName=void 0;var D=C("xfSm"),N=C("GXnB"),z=C("Ztfv");function k(v){return function(L,U,K){var q=new N.Metadata(D.NAME_TAG,v);z.tagParameter(L,U,K,q)}}Z.targetName=k},"otv/":function(se,Z,C){var D=C("nmnc"),N=D?D.prototype:void 0,z=N?N.valueOf:void 0;function k(v){return z?Object(z.call(v)):{}}se.exports=k},"oy+k":function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Context=void 0;var D=C("d9O0"),N=function(){function z(k){this.id=D.id(),this.container=k}return z.prototype.addPlan=function(k){this.plan=k},z.prototype.setCurrentRequest=function(k){this.currentRequest=k},z}();Z.Context=N},pFRH:function(se,Z,C){var D=C("cvCv"),N=C("O0oS"),z=C("zZ0H"),k=N?function(v,L){return N(v,"toString",{configurable:!0,enumerable:!1,value:D(L),writable:!0})}:z;se.exports=k},q4HE:function(se,Z){var C="\\ud800-\\udfff",D="\\u0300-\\u036f",N="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",k=D+N+z,v="\\ufe0e\\ufe0f",L="["+C+"]",U="["+k+"]",K="\\ud83c[\\udffb-\\udfff]",q="(?:"+U+"|"+K+")",fe="[^"+C+"]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",rt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="\\u200d",nt=q+"?",wt="["+v+"]?",ht="(?:"+Ne+"(?:"+[fe,ue,rt].join("|")+")"+wt+nt+")*",We=wt+nt+ht,St="(?:"+[fe+U+"?",U,ue,rt,L].join("|")+")",Je=RegExp(K+"(?="+K+")|"+St+We,"g");function Ft(tr){for(var yr=Je.lastIndex=0;Je.test(tr);)++yr;return yr}se.exports=Ft},qK8v:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.isStackOverflowExeption=void 0;var D=C("MON2");function N(z){return z instanceof RangeError||z.message===D.STACK_OVERFLOW}Z.isStackOverflowExeption=N},qRkn:function(se,Z,C){var D=C("3cYt"),N={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},z=D(N);se.exports=z},quyA:function(se,Z){var C="\\ud800-\\udfff",D="\\u0300-\\u036f",N="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",k=D+N+z,v="\\ufe0e\\ufe0f",L="\\u200d",U=RegExp("["+L+C+k+v+"]");function K(q){return U.test(q)}se.exports=K},rxlC:function(se,Z,C){"use strict";se.exports=N,se.exports.default=N;var D=1e20;function N(U,K,q,fe,ue,rt){this.fontSize=U||24,this.buffer=K===void 0?3:K,this.cutoff=fe||.25,this.fontFamily=ue||"sans-serif",this.fontWeight=rt||"normal",this.radius=q||8;var Ne=this.size=this.fontSize+this.buffer*2,nt=Ne+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ne,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(nt*nt),this.gridInner=new Float64Array(nt*nt),this.f=new Float64Array(nt),this.z=new Float64Array(nt+1),this.v=new Uint16Array(nt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ne/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function z(U,K,q,fe,ue,rt,Ne){rt.fill(D,0,K*q),Ne.fill(0,0,K*q);for(var nt=(K-fe)/2,wt=0;wt<ue;wt++)for(var ht=0;ht<fe;ht++){var We=(wt+nt)*K+ht+nt,St=U.data[4*(wt*fe+ht)+3]/255;if(St===1)rt[We]=0,Ne[We]=D;else if(St===0)rt[We]=D,Ne[We]=0;else{var Je=Math.max(0,.5-St),Ft=Math.max(0,St-.5);rt[We]=Je*Je,Ne[We]=Ft*Ft}}}function k(U,K,q,fe,ue,rt,Ne){for(var nt=0;nt<K*q;nt++){var wt=Math.sqrt(fe[nt])-Math.sqrt(ue[nt]);U[nt]=Math.round(255-255*(wt/rt+Ne))}}N.prototype._draw=function(U,K){var q=this.ctx.measureText(U),fe=q.width,ue=2*this.buffer,rt,Ne,nt,wt,ht,We,St,Je;K&&this.useMetrics?(ht=Math.floor(q.actualBoundingBoxAscent),Je=this.buffer+Math.ceil(q.actualBoundingBoxAscent),We=this.buffer,St=this.buffer,Ne=Math.min(this.size,Math.ceil(q.actualBoundingBoxRight-q.actualBoundingBoxLeft)),wt=Math.min(this.size-We,Math.ceil(q.actualBoundingBoxAscent+q.actualBoundingBoxDescent)),rt=Ne+ue,nt=wt+ue,this.ctx.textBaseline="alphabetic"):(rt=Ne=this.size,nt=wt=this.size,ht=19*this.fontSize/24,We=St=0,Je=this.middle,this.ctx.textBaseline="middle");var Ft;Ne&&wt&&(this.ctx.clearRect(St,We,Ne,wt),this.ctx.fillText(U,this.buffer,Je),Ft=this.ctx.getImageData(St,We,Ne,wt));var tr=new Uint8ClampedArray(rt*nt);return z(Ft,rt,nt,Ne,wt,this.gridOuter,this.gridInner),v(this.gridOuter,rt,nt,this.f,this.v,this.z),v(this.gridInner,rt,nt,this.f,this.v,this.z),k(tr,rt,nt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:tr,metrics:{width:Ne,height:wt,sdfWidth:rt,sdfHeight:nt,top:ht,left:0,advance:fe}}},N.prototype.draw=function(U){return this._draw(U,!1).data},N.prototype.drawWithMetrics=function(U){return this._draw(U,!0)};function v(U,K,q,fe,ue,rt){for(var Ne=0;Ne<K;Ne++)L(U,Ne,K,q,fe,ue,rt);for(var nt=0;nt<q;nt++)L(U,nt*K,1,K,fe,ue,rt)}function L(U,K,q,fe,ue,rt,Ne){var nt,wt,ht,We;for(rt[0]=0,Ne[0]=-D,Ne[1]=D,nt=0;nt<fe;nt++)ue[nt]=U[K+nt*q];for(nt=1,wt=0,ht=0;nt<fe;nt++){do We=rt[wt],ht=(ue[nt]-ue[We]+nt*nt-We*We)/(nt-We)/2;while(ht<=Ne[wt]&&--wt>-1);wt++,rt[wt]=nt,Ne[wt]=ht,Ne[wt+1]=D}for(nt=0,wt=0;nt<fe;nt++){for(;Ne[wt+1]<nt;)wt++;We=rt[wt],U[K+nt*q]=ue[We]+(nt-We)*(nt-We)}}},sGsY:function(se,Z,C){"use strict";var D=C("rePB"),N=C("wx14"),z=C("q1tI"),k=C("TSYQ"),v=C.n(k),L=C("H84U"),U=C("/ezw"),K=C("B6l+"),q=C.n(K),fe=function(zt){var le=zt.value,Me=zt.formatter,Re=zt.precision,yt=zt.decimalSeparator,At=zt.groupSeparator,ae=At===void 0?"":At,It=zt.prefixCls,lr;if(typeof Me=="function")lr=Me(le);else{var Cr=String(le),Br=Cr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Br||Cr==="-")lr=Cr;else{var pn=Br[1],Fr=Br[2]||"0",Pn=Br[4]||"";Fr=Fr.replace(/\B(?=(\d{3})+(?!\d))/g,ae),typeof Re=="number"&&(Pn=q()(Pn,Re,"0").slice(0,Re)),Pn&&(Pn="".concat(yt).concat(Pn)),lr=[z.createElement("span",{key:"int",className:"".concat(It,"-content-value-int")},pn,Fr),Pn&&z.createElement("span",{key:"decimal",className:"".concat(It,"-content-value-decimal")},Pn)]}}return z.createElement("span",{className:"".concat(It,"-content-value")},lr)},ue=fe,rt=function(zt){var le=zt.prefixCls,Me=zt.className,Re=zt.style,yt=zt.valueStyle,At=zt.value,ae=At===void 0?0:At,It=zt.title,lr=zt.valueRender,Cr=zt.prefix,Br=zt.suffix,pn=zt.loading,Fr=zt.direction,Pn=zt.onMouseEnter,ni=zt.onMouseLeave,Nn=z.createElement(ue,Object(N.a)({},zt,{value:ae})),Kn=v()(le,Object(D.a)({},"".concat(le,"-rtl"),Fr==="rtl"),Me);return z.createElement("div",{className:Kn,style:Re,onMouseEnter:Pn,onMouseLeave:ni},It&&z.createElement("div",{className:"".concat(le,"-title")},It),z.createElement(U.a,{paragraph:!1,loading:pn},z.createElement("div",{style:yt,className:"".concat(le,"-content")},Cr&&z.createElement("span",{className:"".concat(le,"-content-prefix")},Cr),lr?lr(Nn):Nn,Br&&z.createElement("span",{className:"".concat(le,"-content-suffix")},Br))))};rt.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var Ne=Object(L.c)({prefixCls:"statistic"})(rt),nt=Ne,wt=C("1OyB"),ht=C("vuIU"),We=C("Ji7U"),St=C("LK+K"),Je=C("ODXe"),Ft=C("QQZ/"),tr=C.n(Ft),yr=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Dr(Ie,zt){var le=Ie,Me=/\[[^\]]*]/g,Re=(zt.match(Me)||[]).map(function(It){return It.slice(1,-1)}),yt=zt.replace(Me,"[]"),At=yr.reduce(function(It,lr){var Cr=Object(Je.a)(lr,2),Br=Cr[0],pn=Cr[1];if(It.indexOf(Br)!==-1){var Fr=Math.floor(le/pn);return le-=Fr*pn,It.replace(new RegExp("".concat(Br,"+"),"g"),function(Pn){var ni=Pn.length;return tr()(Fr.toString(),ni,"0")})}return It},yt),ae=0;return At.replace(Me,function(){var It=Re[ae];return ae+=1,It})}function Mr(Ie,zt){var le=zt.format,Me=le===void 0?"":le,Re=new Date(Ie).getTime(),yt=Date.now(),At=Math.max(Re-yt,0);return Dr(At,Me)}var jt=C("0n0R"),He=1e3/30;function Dt(Ie){return new Date(Ie).getTime()}var Ut=function(Ie){Object(We.a)(le,Ie);var zt=Object(St.a)(le);function le(){var Me;return Object(wt.a)(this,le),Me=zt.apply(this,arguments),Me.syncTimer=function(){var Re=Me.props.value,yt=Dt(Re);yt>=Date.now()?Me.startTimer():Me.stopTimer()},Me.startTimer=function(){if(!Me.countdownId){var Re=Me.props,yt=Re.onChange,At=Re.value,ae=Dt(At);Me.countdownId=window.setInterval(function(){Me.forceUpdate(),yt&&ae>Date.now()&&yt(ae-Date.now())},He)}},Me.stopTimer=function(){var Re=Me.props,yt=Re.onFinish,At=Re.value;if(Me.countdownId){clearInterval(Me.countdownId),Me.countdownId=void 0;var ae=Dt(At);yt&&ae<Date.now()&&yt()}},Me.formatCountdown=function(Re,yt){var At=Me.props.format;return Mr(Re,Object(N.a)(Object(N.a)({},yt),{format:At}))},Me.valueRender=function(Re){return Object(jt.a)(Re,{title:void 0})},Me}return Object(ht.a)(le,[{key:"componentDidMount",value:function(){this.syncTimer()}},{key:"componentDidUpdate",value:function(){this.syncTimer()}},{key:"componentWillUnmount",value:function(){this.stopTimer()}},{key:"render",value:function(){return z.createElement(nt,Object(N.a)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),le}(z.Component);Ut.defaultProps={format:"HH:mm:ss"};var Ce=Ut;nt.Countdown=Ce;var ve=Z.a=nt},sKgW:function(se,Z){var C=9007199254740991,D=Math.floor;function N(z,k){var v="";if(!z||k<1||k>C)return v;do k%2&&(v+=z),k=D(k/2),k&&(z+=z);while(k);return v}se.exports=N},sXyB:function(se,Z,C){var D=C("SksO"),N=C("b48C");function z(k,v,L){return N()?(se.exports=z=Reflect.construct.bind(),se.exports.__esModule=!0,se.exports.default=se.exports):(se.exports=z=function(K,q,fe){var ue=[null];ue.push.apply(ue,q);var rt=Function.bind.apply(K,ue),Ne=new rt;return fe&&D(Ne,fe.prototype),Ne},se.exports.__esModule=!0,se.exports.default=se.exports),z.apply(null,arguments)}se.exports=z,se.exports.__esModule=!0,se.exports.default=se.exports},sgoq:function(se,Z,C){var D=C("asDA"),N=C("TKrE"),z=C("6nK8"),k="['\u2019]",v=RegExp(k,"g");function L(U){return function(K){return D(z(N(K).replace(v,"")),U,"")}}se.exports=L},t2Dn:function(se,Z,C){var D=C("hypo"),N=C("ljhN");function z(k,v,L){(L!==void 0&&!N(k[v],L)||L===void 0&&!(v in k))&&D(k,v,L)}se.exports=z},u6S6:function(se,Z,C){var D=C("6acW"),N=C("sgoq"),z=N(function(k,v,L){return v=v.toLowerCase(),k+(L?D(v):v)});se.exports=z},uhBA:function(se,Z,C){"use strict";var D=Object.prototype.hasOwnProperty,N="~";function z(){}Object.create&&(z.prototype=Object.create(null),new z().__proto__||(N=!1));function k(K,q,fe){this.fn=K,this.context=q,this.once=fe||!1}function v(K,q,fe,ue,rt){if(typeof fe!="function")throw new TypeError("The listener must be a function");var Ne=new k(fe,ue||K,rt),nt=N?N+q:q;return K._events[nt]?K._events[nt].fn?K._events[nt]=[K._events[nt],Ne]:K._events[nt].push(Ne):(K._events[nt]=Ne,K._eventsCount++),K}function L(K,q){--K._eventsCount==0?K._events=new z:delete K._events[q]}function U(){this._events=new z,this._eventsCount=0}U.prototype.eventNames=function(){var q=[],fe,ue;if(this._eventsCount===0)return q;for(ue in fe=this._events)D.call(fe,ue)&&q.push(N?ue.slice(1):ue);return Object.getOwnPropertySymbols?q.concat(Object.getOwnPropertySymbols(fe)):q},U.prototype.listeners=function(q){var fe=N?N+q:q,ue=this._events[fe];if(!ue)return[];if(ue.fn)return[ue.fn];for(var rt=0,Ne=ue.length,nt=new Array(Ne);rt<Ne;rt++)nt[rt]=ue[rt].fn;return nt},U.prototype.listenerCount=function(q){var fe=N?N+q:q,ue=this._events[fe];return ue?ue.fn?1:ue.length:0},U.prototype.emit=function(q,fe,ue,rt,Ne,nt){var wt=N?N+q:q;if(!this._events[wt])return!1;var ht=this._events[wt],We=arguments.length,St,Je;if(ht.fn){switch(ht.once&&this.removeListener(q,ht.fn,void 0,!0),We){case 1:return ht.fn.call(ht.context),!0;case 2:return ht.fn.call(ht.context,fe),!0;case 3:return ht.fn.call(ht.context,fe,ue),!0;case 4:return ht.fn.call(ht.context,fe,ue,rt),!0;case 5:return ht.fn.call(ht.context,fe,ue,rt,Ne),!0;case 6:return ht.fn.call(ht.context,fe,ue,rt,Ne,nt),!0}for(Je=1,St=new Array(We-1);Je<We;Je++)St[Je-1]=arguments[Je];ht.fn.apply(ht.context,St)}else{var Ft=ht.length,tr;for(Je=0;Je<Ft;Je++)switch(ht[Je].once&&this.removeListener(q,ht[Je].fn,void 0,!0),We){case 1:ht[Je].fn.call(ht[Je].context);break;case 2:ht[Je].fn.call(ht[Je].context,fe);break;case 3:ht[Je].fn.call(ht[Je].context,fe,ue);break;case 4:ht[Je].fn.call(ht[Je].context,fe,ue,rt);break;default:if(!St)for(tr=1,St=new Array(We-1);tr<We;tr++)St[tr-1]=arguments[tr];ht[Je].fn.apply(ht[Je].context,St)}}return!0},U.prototype.on=function(q,fe,ue){return v(this,q,fe,ue,!1)},U.prototype.once=function(q,fe,ue){return v(this,q,fe,ue,!0)},U.prototype.removeListener=function(q,fe,ue,rt){var Ne=N?N+q:q;if(!this._events[Ne])return this;if(!fe)return L(this,Ne),this;var nt=this._events[Ne];if(nt.fn)nt.fn===fe&&(!rt||nt.once)&&(!ue||nt.context===ue)&&L(this,Ne);else{for(var wt=0,ht=[],We=nt.length;wt<We;wt++)(nt[wt].fn!==fe||rt&&!nt[wt].once||ue&&nt[wt].context!==ue)&&ht.push(nt[wt]);ht.length?this._events[Ne]=ht.length===1?ht[0]:ht:L(this,Ne)}return this},U.prototype.removeAllListeners=function(q){var fe;return q?(fe=N?N+q:q,this._events[fe]&&L(this,fe)):(this._events=new z,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=N,U.EventEmitter=U,se.exports=U},ujMp:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.circularDependencyToException=Z.listMetadataForTarget=Z.listRegisteredBindingsForServiceIdentifier=Z.getServiceIdentifierAsString=Z.getFunctionName=void 0;var D=C("MON2");function N(q){if(typeof q=="function"){var fe=q;return fe.name}else{if(typeof q=="symbol")return q.toString();var fe=q;return fe}}Z.getServiceIdentifierAsString=N;function z(q,fe,ue){var rt="",Ne=ue(q,fe);return Ne.length!==0&&(rt=`
Registered bindings:`,Ne.forEach(function(nt){var wt="Object";nt.implementationType!==null&&(wt=K(nt.implementationType)),rt=rt+`
 `+wt,nt.constraint.metaData&&(rt=rt+" - "+nt.constraint.metaData)})),rt}Z.listRegisteredBindingsForServiceIdentifier=z;function k(q,fe){return q.parentRequest===null?!1:q.parentRequest.serviceIdentifier===fe?!0:k(q.parentRequest,fe)}function v(q){function fe(rt,Ne){Ne===void 0&&(Ne=[]);var nt=N(rt.serviceIdentifier);return Ne.push(nt),rt.parentRequest!==null?fe(rt.parentRequest,Ne):Ne}var ue=fe(q);return ue.reverse().join(" --> ")}function L(q){q.childRequests.forEach(function(fe){if(k(fe,fe.serviceIdentifier)){var ue=v(fe);throw new Error(D.CIRCULAR_DEPENDENCY+" "+ue)}else L(fe)})}Z.circularDependencyToException=L;function U(q,fe){if(fe.isTagged()||fe.isNamed()){var ue="",rt=fe.getNamedTag(),Ne=fe.getCustomTags();return rt!==null&&(ue+=rt.toString()+`
`),Ne!==null&&Ne.forEach(function(nt){ue+=nt.toString()+`
`})," "+q+`
 `+q+" - "+ue}else return" "+q}Z.listMetadataForTarget=U;function K(q){if(q.name)return q.name;var fe=q.toString(),ue=fe.match(/^function\s*([^\s(]+)/);return ue?ue[1]:"Anonymous function: "+fe}Z.getFunctionName=K},"vN+2":function(se,Z){function C(){}se.exports=C},veWP:function(se,Z,C){"use strict";var D=Object.prototype.hasOwnProperty,N="~";function z(){}Object.create&&(z.prototype=Object.create(null),new z().__proto__||(N=!1));function k(K,q,fe){this.fn=K,this.context=q,this.once=fe||!1}function v(K,q,fe,ue,rt){if(typeof fe!="function")throw new TypeError("The listener must be a function");var Ne=new k(fe,ue||K,rt),nt=N?N+q:q;return K._events[nt]?K._events[nt].fn?K._events[nt]=[K._events[nt],Ne]:K._events[nt].push(Ne):(K._events[nt]=Ne,K._eventsCount++),K}function L(K,q){--K._eventsCount==0?K._events=new z:delete K._events[q]}function U(){this._events=new z,this._eventsCount=0}U.prototype.eventNames=function(){var q=[],fe,ue;if(this._eventsCount===0)return q;for(ue in fe=this._events)D.call(fe,ue)&&q.push(N?ue.slice(1):ue);return Object.getOwnPropertySymbols?q.concat(Object.getOwnPropertySymbols(fe)):q},U.prototype.listeners=function(q){var fe=N?N+q:q,ue=this._events[fe];if(!ue)return[];if(ue.fn)return[ue.fn];for(var rt=0,Ne=ue.length,nt=new Array(Ne);rt<Ne;rt++)nt[rt]=ue[rt].fn;return nt},U.prototype.listenerCount=function(q){var fe=N?N+q:q,ue=this._events[fe];return ue?ue.fn?1:ue.length:0},U.prototype.emit=function(q,fe,ue,rt,Ne,nt){var wt=N?N+q:q;if(!this._events[wt])return!1;var ht=this._events[wt],We=arguments.length,St,Je;if(ht.fn){switch(ht.once&&this.removeListener(q,ht.fn,void 0,!0),We){case 1:return ht.fn.call(ht.context),!0;case 2:return ht.fn.call(ht.context,fe),!0;case 3:return ht.fn.call(ht.context,fe,ue),!0;case 4:return ht.fn.call(ht.context,fe,ue,rt),!0;case 5:return ht.fn.call(ht.context,fe,ue,rt,Ne),!0;case 6:return ht.fn.call(ht.context,fe,ue,rt,Ne,nt),!0}for(Je=1,St=new Array(We-1);Je<We;Je++)St[Je-1]=arguments[Je];ht.fn.apply(ht.context,St)}else{var Ft=ht.length,tr;for(Je=0;Je<Ft;Je++)switch(ht[Je].once&&this.removeListener(q,ht[Je].fn,void 0,!0),We){case 1:ht[Je].fn.call(ht[Je].context);break;case 2:ht[Je].fn.call(ht[Je].context,fe);break;case 3:ht[Je].fn.call(ht[Je].context,fe,ue);break;case 4:ht[Je].fn.call(ht[Je].context,fe,ue,rt);break;default:if(!St)for(tr=1,St=new Array(We-1);tr<We;tr++)St[tr-1]=arguments[tr];ht[Je].fn.apply(ht[Je].context,St)}}return!0},U.prototype.on=function(q,fe,ue){return v(this,q,fe,ue,!1)},U.prototype.once=function(q,fe,ue){return v(this,q,fe,ue,!0)},U.prototype.removeListener=function(q,fe,ue,rt){var Ne=N?N+q:q;if(!this._events[Ne])return this;if(!fe)return L(this,Ne),this;var nt=this._events[Ne];if(nt.fn)nt.fn===fe&&(!rt||nt.once)&&(!ue||nt.context===ue)&&L(this,Ne);else{for(var wt=0,ht=[],We=nt.length;wt<We;wt++)(nt[wt].fn!==fe||rt&&!nt[wt].once||ue&&nt[wt].context!==ue)&&ht.push(nt[wt]);ht.length?this._events[Ne]=ht.length===1?ht[0]:ht:L(this,Ne)}return this},U.prototype.removeAllListeners=function(q){var fe;return q?(fe=N?N+q:q,this._events[fe]&&L(this,fe)):(this._events=new z,this._eventsCount=0),this},U.prototype.off=U.prototype.removeListener,U.prototype.addListener=U.prototype.on,U.prefixed=N,U.EventEmitter=U,se.exports=U},"w/wX":function(se,Z,C){var D=C("QqLw"),N=C("ExA7"),z="[object Set]";function k(v){return N(v)&&D(v)==z}se.exports=k},wclG:function(se,Z,C){var D=C("pFRH"),N=C("88Gu"),z=N(D);se.exports=z},wnjb:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.MetadataReader=void 0;var D=C("xfSm"),N=function(){function z(){}return z.prototype.getConstructorMetadata=function(k){var v=Reflect.getMetadata(D.PARAM_TYPES,k),L=Reflect.getMetadata(D.TAGGED,k);return{compilerGeneratedMetadata:v,userGeneratedMetadata:L||{}}},z.prototype.getPropertiesMetadata=function(k){var v=Reflect.getMetadata(D.TAGGED_PROP,k)||[];return v},z}();Z.MetadataReader=N},wrZu:function(se,Z,C){var D=C("+K+b"),N=C("XYm9"),z=C("b2z7"),k=C("otv/"),v=C("yP5f"),L="[object Boolean]",U="[object Date]",K="[object Map]",q="[object Number]",fe="[object RegExp]",ue="[object Set]",rt="[object String]",Ne="[object Symbol]",nt="[object ArrayBuffer]",wt="[object DataView]",ht="[object Float32Array]",We="[object Float64Array]",St="[object Int8Array]",Je="[object Int16Array]",Ft="[object Int32Array]",tr="[object Uint8Array]",yr="[object Uint8ClampedArray]",Dr="[object Uint16Array]",Mr="[object Uint32Array]";function jt(He,Dt,Ut){var Ce=He.constructor;switch(Dt){case nt:return D(He);case L:case U:return new Ce(+He);case wt:return N(He,Ut);case ht:case We:case St:case Je:case Ft:case tr:case yr:case Dr:case Mr:return v(He,Ut);case K:return new Ce;case q:case rt:return new Ce(He);case fe:return z(He);case ue:return new Ce;case Ne:return k(He)}}se.exports=jt},wy8a:function(se,Z,C){var D=C("KxBF");function N(z,k,v){var L=z.length;return v=v===void 0?L:v,!k&&v>=L?z:D(z,k,v)}se.exports=N},xfSm:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.NON_CUSTOM_TAG_KEYS=Z.POST_CONSTRUCT=Z.DESIGN_PARAM_TYPES=Z.PARAM_TYPES=Z.TAGGED_PROP=Z.TAGGED=Z.MULTI_INJECT_TAG=Z.INJECT_TAG=Z.OPTIONAL_TAG=Z.UNMANAGED_TAG=Z.NAME_TAG=Z.NAMED_TAG=void 0,Z.NAMED_TAG="named",Z.NAME_TAG="name",Z.UNMANAGED_TAG="unmanaged",Z.OPTIONAL_TAG="optional",Z.INJECT_TAG="inject",Z.MULTI_INJECT_TAG="multi_inject",Z.TAGGED="inversify:tagged",Z.TAGGED_PROP="inversify:tagged_props",Z.PARAM_TYPES="inversify:paramtypes",Z.DESIGN_PARAM_TYPES="design:paramtypes",Z.POST_CONSTRUCT="post_construct";function D(){return[Z.INJECT_TAG,Z.MULTI_INJECT_TAG,Z.NAME_TAG,Z.UNMANAGED_TAG,Z.NAMED_TAG,Z.OPTIONAL_TAG]}Z.NON_CUSTOM_TAG_KEYS=D()},xiII:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Request=void 0;var D=C("d9O0"),N=function(){function z(k,v,L,U,K){this.id=D.id(),this.serviceIdentifier=k,this.parentContext=v,this.parentRequest=L,this.target=K,this.childRequests=[],this.bindings=Array.isArray(U)?U:[U],this.requestScope=L===null?new Map:null}return z.prototype.addChildRequest=function(k,v,L){var U=new z(k,this.parentContext,this,v,L);return this.childRequests.push(U),U},z}();Z.Request=N},xnQO:function(se,Z,C){"use strict";se.exports=D;function D(N,z){this.x=N,this.y=z}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(z){return this.clone()._add(z)},sub:function(z){return this.clone()._sub(z)},multByPoint:function(z){return this.clone()._multByPoint(z)},divByPoint:function(z){return this.clone()._divByPoint(z)},mult:function(z){return this.clone()._mult(z)},div:function(z){return this.clone()._div(z)},rotate:function(z){return this.clone()._rotate(z)},rotateAround:function(z,k){return this.clone()._rotateAround(z,k)},matMult:function(z){return this.clone()._matMult(z)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(z){return this.x===z.x&&this.y===z.y},dist:function(z){return Math.sqrt(this.distSqr(z))},distSqr:function(z){var k=z.x-this.x,v=z.y-this.y;return k*k+v*v},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(z){return Math.atan2(this.y-z.y,this.x-z.x)},angleWith:function(z){return this.angleWithSep(z.x,z.y)},angleWithSep:function(z,k){return Math.atan2(this.x*k-this.y*z,this.x*z+this.y*k)},_matMult:function(z){var k=z[0]*this.x+z[1]*this.y,v=z[2]*this.x+z[3]*this.y;return this.x=k,this.y=v,this},_add:function(z){return this.x+=z.x,this.y+=z.y,this},_sub:function(z){return this.x-=z.x,this.y-=z.y,this},_mult:function(z){return this.x*=z,this.y*=z,this},_div:function(z){return this.x/=z,this.y/=z,this},_multByPoint:function(z){return this.x*=z.x,this.y*=z.y,this},_divByPoint:function(z){return this.x/=z.x,this.y/=z.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var z=this.y;return this.y=this.x,this.x=-z,this},_rotate:function(z){var k=Math.cos(z),v=Math.sin(z),L=k*this.x-v*this.y,U=v*this.x+k*this.y;return this.x=L,this.y=U,this},_rotateAround:function(z,k){var v=Math.cos(z),L=Math.sin(z),U=k.x+v*(this.x-k.x)-L*(this.y-k.y),K=k.y+L*(this.x-k.x)+v*(this.y-k.y);return this.x=U,this.y=K,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(N){return N instanceof D?N:Array.isArray(N)?new D(N[0],N[1]):N}},xp6e:function(se,Z,C){"use strict";(function(D){C.d(Z,"a",function(){return Kn}),C.d(Z,"b",function(){return Nn}),C.d(Z,"c",function(){return Yn}),C.d(Z,"d",function(){return ni}),C.d(Z,"e",function(){return ae});function N(Ar,mr,Xt,Wt){function Ir(Ue){return Ue instanceof Xt?Ue:new Xt(function(he){he(Ue)})}return new(Xt||(Xt=Promise))(function(Ue,he){function ie(Xe){try{Ae(Wt.next(Xe))}catch(bt){he(bt)}}function B(Xe){try{Ae(Wt.throw(Xe))}catch(bt){he(bt)}}function Ae(Xe){Xe.done?Ue(Xe.value):Ir(Xe.value).then(ie,B)}Ae((Wt=Wt.apply(Ar,mr||[])).next())})}function z(Ar,mr){var Xt={label:0,sent:function(){if(Ue[0]&1)throw Ue[1];return Ue[1]},trys:[],ops:[]},Wt,Ir,Ue,he;return he={next:ie(0),throw:ie(1),return:ie(2)},typeof Symbol=="function"&&(he[Symbol.iterator]=function(){return this}),he;function ie(Ae){return function(Xe){return B([Ae,Xe])}}function B(Ae){if(Wt)throw new TypeError("Generator is already executing.");for(;Xt;)try{if(Wt=1,Ir&&(Ue=Ae[0]&2?Ir.return:Ae[0]?Ir.throw||((Ue=Ir.return)&&Ue.call(Ir),0):Ir.next)&&!(Ue=Ue.call(Ir,Ae[1])).done)return Ue;switch(Ir=0,Ue&&(Ae=[Ae[0]&2,Ue.value]),Ae[0]){case 0:case 1:Ue=Ae;break;case 4:return Xt.label++,{value:Ae[1],done:!1};case 5:Xt.label++,Ir=Ae[1],Ae=[0];continue;case 7:Ae=Xt.ops.pop(),Xt.trys.pop();continue;default:if(Ue=Xt.trys,!(Ue=Ue.length>0&&Ue[Ue.length-1])&&(Ae[0]===6||Ae[0]===2)){Xt=0;continue}if(Ae[0]===3&&(!Ue||Ae[1]>Ue[0]&&Ae[1]<Ue[3])){Xt.label=Ae[1];break}if(Ae[0]===6&&Xt.label<Ue[1]){Xt.label=Ue[1],Ue=Ae;break}if(Ue&&Xt.label<Ue[2]){Xt.label=Ue[2],Xt.ops.push(Ae);break}Ue[2]&&Xt.ops.pop(),Xt.trys.pop();continue}Ae=mr.call(Ar,Xt)}catch(Xe){Ae=[6,Xe],Ir=0}finally{Wt=Ue=0}if(Ae[0]&5)throw Ae[1];return{value:Ae[0]?Ae[1]:void 0,done:!0}}}function k(Ar,mr){var Xt=typeof Symbol=="function"&&Ar[Symbol.iterator];if(!Xt)return Ar;var Wt=Xt.call(Ar),Ir,Ue=[],he;try{for(;(mr===void 0||mr-- >0)&&!(Ir=Wt.next()).done;)Ue.push(Ir.value)}catch(ie){he={error:ie}}finally{try{Ir&&!Ir.done&&(Xt=Wt.return)&&Xt.call(Wt)}finally{if(he)throw he.error}}return Ue}function v(Ar,mr,Xt){if(Xt||arguments.length===2)for(var Wt=0,Ir=mr.length,Ue;Wt<Ir;Wt++)(Ue||!(Wt in mr))&&(Ue||(Ue=Array.prototype.slice.call(mr,0,Wt)),Ue[Wt]=mr[Wt]);return Ar.concat(Ue||Array.prototype.slice.call(mr))}function L(Ar){return Ar&&Ar.__esModule&&Object.prototype.hasOwnProperty.call(Ar,"default")?Ar.default:Ar}var U={exports:{}},K={exports:{}},q={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Xt;function Xt(Wt){return Wt&&typeof Wt.length=="number"&&Wt.length>=0&&Wt.length%1==0}Ar.exports=mr.default})(q,q.exports);var fe={},ue={exports:{}},rt={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=function(Xt){return function(){for(var Wt=[],Ir=arguments.length;Ir--;)Wt[Ir]=arguments[Ir];var Ue=Wt.pop();return Xt.call(this,Wt,Ue)}},Ar.exports=mr.default})(rt,rt.exports);var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.fallback=We,Ne.wrap=St;var nt=Ne.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,wt=Ne.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,ht=Ne.hasNextTick=typeof D=="object"&&typeof D.nextTick=="function";function We(Ar){setTimeout(Ar,0)}function St(Ar){return function(mr){for(var Xt=[],Wt=arguments.length-1;Wt-- >0;)Xt[Wt]=arguments[Wt+1];return Ar(function(){return mr.apply(void 0,Xt)})}}var Je;nt?Je=queueMicrotask:wt?Je=setImmediate:ht?Je=D.nextTick:Je=We,Ne.default=St(Je),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=B;var Xt=rt.exports,Wt=ie(Xt),Ir=Ne,Ue=ie(Ir),he=fe;function ie(bt){return bt&&bt.__esModule?bt:{default:bt}}function B(bt){return(0,he.isAsync)(bt)?function(){for(var Gt=[],sr=arguments.length;sr--;)Gt[sr]=arguments[sr];var at=Gt.pop(),Ot=bt.apply(this,Gt);return Ae(Ot,at)}:(0,Wt.default)(function(Gt,sr){var at;try{at=bt.apply(this,Gt)}catch(Ot){return sr(Ot)}if(at&&typeof at.then=="function")return Ae(at,sr);sr(null,at)})}function Ae(bt,Gt){return bt.then(function(sr){Xe(Gt,null,sr)},function(sr){Xe(Gt,sr&&sr.message?sr:new Error(sr))})}function Xe(bt,Gt,sr){try{bt(Gt,sr)}catch(at){(0,Ue.default)(function(Ot){throw Ot},at)}}Ar.exports=mr.default}(ue,ue.exports),Object.defineProperty(fe,"__esModule",{value:!0}),fe.isAsyncIterable=fe.isAsyncGenerator=fe.isAsync=void 0;var Ft=ue.exports,tr=yr(Ft);function yr(Ar){return Ar&&Ar.__esModule?Ar:{default:Ar}}function Dr(Ar){return Ar[Symbol.toStringTag]==="AsyncFunction"}function Mr(Ar){return Ar[Symbol.toStringTag]==="AsyncGenerator"}function jt(Ar){return typeof Ar[Symbol.asyncIterator]=="function"}function He(Ar){if(typeof Ar!="function")throw new Error("expected a function");return Dr(Ar)?(0,tr.default)(Ar):Ar}fe.default=He,fe.isAsync=Dr,fe.isAsyncGenerator=Mr,fe.isAsyncIterable=jt;var Dt={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Xt;function Xt(Wt,Ir){if(Ir===void 0&&(Ir=Wt.length),!Ir)throw new Error("arity is undefined");function Ue(){for(var he=this,ie=[],B=arguments.length;B--;)ie[B]=arguments[B];return typeof ie[Ir-1]=="function"?Wt.apply(this,ie):new Promise(function(Ae,Xe){ie[Ir-1]=function(bt){for(var Gt=[],sr=arguments.length-1;sr-- >0;)Gt[sr]=arguments[sr+1];if(bt)return Xe(bt);Ae(Gt.length>1?Gt:Gt[0])},Wt.apply(he,ie)})}return Ue}Ar.exports=mr.default})(Dt,Dt.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=q.exports,Wt=B(Xt),Ir=fe,Ue=B(Ir),he=Dt.exports,ie=B(he);function B(Ae){return Ae&&Ae.__esModule?Ae:{default:Ae}}mr.default=(0,ie.default)(function(Ae,Xe,bt){var Gt=(0,Wt.default)(Xe)?[]:{};Ae(Xe,function(sr,at,Ot){(0,Ue.default)(sr)(function(or){for(var Tr,Or=[],jn=arguments.length-1;jn-- >0;)Or[jn]=arguments[jn+1];Or.length<2&&(Tr=Or,Or=Tr[0]),Gt[at]=Or,Ot(or)})},function(sr){return bt(sr,Gt)})},3),Ar.exports=mr.default}(K,K.exports);var Ut={exports:{}},Ce={exports:{}},ve={exports:{}},Ie={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Xt;function Xt(Wt){function Ir(){for(var Ue=[],he=arguments.length;he--;)Ue[he]=arguments[he];if(Wt!==null){var ie=Wt;Wt=null,ie.apply(this,Ue)}}return Object.assign(Ir,Wt),Ir}Ar.exports=mr.default})(Ie,Ie.exports);var zt={exports:{}},le={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=function(Xt){return Xt[Symbol.iterator]&&Xt[Symbol.iterator]()},Ar.exports=mr.default})(le,le.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Xe;var Xt=q.exports,Wt=he(Xt),Ir=le.exports,Ue=he(Ir);function he(bt){return bt&&bt.__esModule?bt:{default:bt}}function ie(bt){var Gt=-1,sr=bt.length;return function(){return++Gt<sr?{value:bt[Gt],key:Gt}:null}}function B(bt){var Gt=-1;return function(){var at=bt.next();return at.done?null:(Gt++,{value:at.value,key:Gt})}}function Ae(bt){var Gt=bt?Object.keys(bt):[],sr=-1,at=Gt.length;return function Ot(){var or=Gt[++sr];return or==="__proto__"?Ot():sr<at?{value:bt[or],key:or}:null}}function Xe(bt){if((0,Wt.default)(bt))return ie(bt);var Gt=(0,Ue.default)(bt);return Gt?B(Gt):Ae(bt)}Ar.exports=mr.default}(zt,zt.exports);var Me={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Xt;function Xt(Wt){return function(){for(var Ir=[],Ue=arguments.length;Ue--;)Ir[Ue]=arguments[Ue];if(Wt===null)throw new Error("Callback was already called.");var he=Wt;Wt=null,he.apply(this,Ir)}}Ar.exports=mr.default})(Me,Me.exports);var Re={exports:{}},yt={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt={};mr.default=Xt,Ar.exports=mr.default})(yt,yt.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=Ue;var Xt=yt.exports,Wt=Ir(Xt);function Ir(he){return he&&he.__esModule?he:{default:he}}function Ue(he,ie,B,Ae){var Xe=!1,bt=!1,Gt=!1,sr=0,at=0;function Ot(){sr>=ie||Gt||Xe||(Gt=!0,he.next().then(function(Or){var jn=Or.value,Jr=Or.done;if(!(bt||Xe)){if(Gt=!1,Jr){Xe=!0,sr<=0&&Ae(null);return}sr++,B(jn,at,or),at++,Ot()}}).catch(Tr))}function or(Or,jn){if(sr-=1,!bt){if(Or)return Tr(Or);if(Or===!1){Xe=!0,bt=!0;return}if(jn===Wt.default||Xe&&sr<=0)return Xe=!0,Ae(null);Ot()}}function Tr(Or){bt||(Gt=!1,Xe=!0,Ae(Or))}Ot()}Ar.exports=mr.default}(Re,Re.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=Ie.exports,Wt=sr(Xt),Ir=zt.exports,Ue=sr(Ir),he=Me.exports,ie=sr(he),B=fe,Ae=Re.exports,Xe=sr(Ae),bt=yt.exports,Gt=sr(bt);function sr(at){return at&&at.__esModule?at:{default:at}}mr.default=function(at){return function(Ot,or,Tr){if(Tr=(0,Wt.default)(Tr),at<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Ot)return Tr(null);if((0,B.isAsyncGenerator)(Ot))return(0,Xe.default)(Ot,at,or,Tr);if((0,B.isAsyncIterable)(Ot))return(0,Xe.default)(Ot[Symbol.asyncIterator](),at,or,Tr);var Or=(0,Ue.default)(Ot),jn=!1,Jr=!1,xn=0,An=!1;function ii(Si,wa){if(!Jr)if(xn-=1,Si)jn=!0,Tr(Si);else if(Si===!1)jn=!0,Jr=!0;else{if(wa===Gt.default||jn&&xn<=0)return jn=!0,Tr(null);An||pi()}}function pi(){for(An=!0;xn<at&&!jn;){var Si=Or();if(Si===null){jn=!0,xn<=0&&Tr(null);return}xn+=1,or(Si.value,Si.key,(0,ie.default)(ii))}An=!1}pi()}},Ar.exports=mr.default}(ve,ve.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=ve.exports,Wt=B(Xt),Ir=fe,Ue=B(Ir),he=Dt.exports,ie=B(he);function B(Xe){return Xe&&Xe.__esModule?Xe:{default:Xe}}function Ae(Xe,bt,Gt,sr){return(0,Wt.default)(bt)(Xe,(0,Ue.default)(Gt),sr)}mr.default=(0,ie.default)(Ae,4),Ar.exports=mr.default}(Ce,Ce.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=Ce.exports,Wt=he(Xt),Ir=Dt.exports,Ue=he(Ir);function he(B){return B&&B.__esModule?B:{default:B}}function ie(B,Ae,Xe){return(0,Wt.default)(B,1,Ae,Xe)}mr.default=(0,Ue.default)(ie,3),Ar.exports=mr.default}(Ut,Ut.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=ie;var Xt=K.exports,Wt=he(Xt),Ir=Ut.exports,Ue=he(Ir);function he(B){return B&&B.__esModule?B:{default:B}}function ie(B,Ae){return(0,Wt.default)(Ue.default,B,Ae)}Ar.exports=mr.default}(U,U.exports);var At=L(U.exports),ae=function(){function Ar(){this.args=[],this.tasks=[]}return Ar.prototype.call=function(){for(var mr=arguments,Xt=[],Wt=0;Wt<arguments.length;Wt++)Xt[Wt]=mr[Wt];return this.args=Xt,At(this.tasks)},Ar.prototype.tap=function(mr,Xt){var Wt=this;this.tasks.push(function(Ir){Xt.apply(void 0,v([],k(Wt.args),!1)),Ir(null,mr)})},Ar}(),It={exports:{}},lr={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=q.exports,Wt=or(Xt),Ir=yt.exports,Ue=or(Ir),he=Ce.exports,ie=or(he),B=Ie.exports,Ae=or(B),Xe=Me.exports,bt=or(Xe),Gt=fe,sr=or(Gt),at=Dt.exports,Ot=or(at);function or(Jr){return Jr&&Jr.__esModule?Jr:{default:Jr}}function Tr(Jr,xn,An){An=(0,Ae.default)(An);var ii=0,pi=0,Si=Jr.length,wa=!1;Si===0&&An(null);function lo(Lo,as){Lo===!1&&(wa=!0),wa!==!0&&(Lo?An(Lo):(++pi===Si||as===Ue.default)&&An(null))}for(;ii<Si;ii++)xn(Jr[ii],ii,(0,bt.default)(lo))}function Or(Jr,xn,An){return(0,ie.default)(Jr,Infinity,xn,An)}function jn(Jr,xn,An){var ii=(0,Wt.default)(Jr)?Tr:Or;return ii(Jr,(0,sr.default)(xn),An)}mr.default=(0,Ot.default)(jn,3),Ar.exports=mr.default})(lr,lr.exports),function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0}),mr.default=ie;var Xt=lr.exports,Wt=he(Xt),Ir=K.exports,Ue=he(Ir);function he(B){return B&&B.__esModule?B:{default:B}}function ie(B,Ae){return(0,Ue.default)(Wt.default,B,Ae)}Ar.exports=mr.default}(It,It.exports);var Cr=L(It.exports),Br=function(){function Ar(){this.tasks=[]}return Ar.prototype.promise=function(){return Cr(this.tasks)},Ar.prototype.tapPromise=function(mr,Xt){var Wt=this;this.tasks.push(function(Ir){return N(Wt,void 0,void 0,function(){return z(this,function(Ue){switch(Ue.label){case 0:return[4,Xt()];case 1:return Ue.sent(),Ir(null,mr),[2]}})})})},Ar}(),pn={exports:{}};(function(Ar,mr){Object.defineProperty(mr,"__esModule",{value:!0});var Xt=Ie.exports,Wt=Xe(Xt),Ir=Me.exports,Ue=Xe(Ir),he=fe,ie=Xe(he),B=Dt.exports,Ae=Xe(B);function Xe(Gt){return Gt&&Gt.__esModule?Gt:{default:Gt}}function bt(Gt,sr){if(sr=(0,Wt.default)(sr),!Array.isArray(Gt))return sr(new Error("First argument to waterfall must be an array of functions"));if(!Gt.length)return sr();var at=0;function Ot(Tr){var Or=(0,ie.default)(Gt[at++]);Or.apply(void 0,Tr.concat([(0,Ue.default)(or)]))}function or(Tr){for(var Or=[],jn=arguments.length-1;jn-- >0;)Or[jn]=arguments[jn+1];if(Tr!==!1){if(Tr||at===Gt.length)return sr.apply(void 0,[Tr].concat(Or));Ot(Or)}}Ot([])}mr.default=(0,Ae.default)(bt),Ar.exports=mr.default})(pn,pn.exports);var Fr=L(pn.exports),Pn=function(){function Ar(){this.tasks=[]}return Ar.prototype.call=function(){return Fr(this.tasks)},Ar.prototype.tap=function(mr,Xt){this.tasks.length===0?this.tasks.push(function(Wt){var Ir=Xt();Wt(Ir?null:!1,Ir)}):this.tasks.push(function(Wt,Ir){var Ue=Xt.apply(void 0,v([],k(Wt),!1));Ir(Ue?null:!1,mr)})},Ar}(),ni=function(){function Ar(){this.tasks=[]}return Ar.prototype.call=function(){return At(this.tasks)},Ar.prototype.tap=function(mr,Xt){this.tasks.push(function(Wt){var Ir=Xt();Wt(Ir,mr)})},Ar}(),Nn=function(){function Ar(){this.args=[],this.tasks=[]}return Ar.prototype.promise=function(){for(var mr=arguments,Xt=[],Wt=0;Wt<arguments.length;Wt++)Xt[Wt]=mr[Wt];return this.args=Xt,At(this.tasks)},Ar.prototype.tapPromise=function(mr,Xt){var Wt=this;this.tasks.push(function(Ir){return N(Wt,void 0,void 0,function(){return z(this,function(Ue){switch(Ue.label){case 0:return[4,Xt.apply(void 0,v([],k(this.args),!1))];case 1:return Ue.sent(),Ir(null,mr),[2]}})})})},Ar}(),Kn=function(){function Ar(){this.args=[],this.tasks=[]}return Ar.prototype.promise=function(){for(var mr=arguments,Xt=[],Wt=0;Wt<arguments.length;Wt++)Xt[Wt]=mr[Wt];return this.args=Xt,At(this.tasks)},Ar.prototype.tapPromise=function(mr,Xt){var Wt=this;this.tasks.push(function(Ir){return N(Wt,void 0,void 0,function(){var Ue;return z(this,function(he){switch(he.label){case 0:return[4,Xt.apply(void 0,v([],k(this.args),!1))];case 1:return Ue=he.sent(),Ir(Ue,mr),[2]}})})})},Ar}(),Yn=function(){function Ar(){this.tasks=[]}return Ar.prototype.promise=function(){return Fr(this.tasks)},Ar.prototype.tapPromise=function(mr,Xt){this.tasks.length===0?this.tasks.push(function(Wt){Xt().then(function(Ir){Wt(null,Ir)})}):this.tasks.push(function(Wt,Ir){Xt(Wt).then(function(Ue){Ir(null,Ue)})})},Ar}()}).call(this,C("Q2Ig"))},yG8O:function(se,Z){function C(D,N,z,k){!z||Object.defineProperty(D,N,{enumerable:z.enumerable,configurable:z.configurable,writable:z.writable,value:z.initializer?z.initializer.call(k):void 0})}se.exports=C,se.exports.__esModule=!0,se.exports.default=se.exports},yHx3:function(se,Z){var C=Object.prototype,D=C.hasOwnProperty;function N(z){var k=z.length,v=new z.constructor(k);return k&&typeof z[0]=="string"&&D.call(z,"index")&&(v.index=z.index,v.input=z.input),v}se.exports=N},yLV6:function(se,Z,C){var D;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(N,z,k,v){"use strict";var L=["","webkit","Moz","MS","ms","o"],U=z.createElement("div"),K="function",q=Math.round,fe=Math.abs,ue=Date.now;function rt(pt,pe,Ke){return setTimeout(Ft(pt,Ke),pe)}function Ne(pt,pe,Ke){return Array.isArray(pt)?(nt(pt,Ke[pe],Ke),!0):!1}function nt(pt,pe,Ke){var ar;if(!!pt)if(pt.forEach)pt.forEach(pe,Ke);else if(pt.length!==v)for(ar=0;ar<pt.length;)pe.call(Ke,pt[ar],ar,pt),ar++;else for(ar in pt)pt.hasOwnProperty(ar)&&pe.call(Ke,pt[ar],ar,pt)}function wt(pt,pe,Ke){var ar="DEPRECATED METHOD: "+pe+`
`+Ke+` AT 
`;return function(){var qr=new Error("get-stack-trace"),Cn=qr&&qr.stack?qr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ji=N.console&&(N.console.warn||N.console.log);return ji&&ji.call(N.console,ar,Cn),pt.apply(this,arguments)}}var ht;typeof Object.assign!="function"?ht=function(pe){if(pe===v||pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(pe),ar=1;ar<arguments.length;ar++){var qr=arguments[ar];if(qr!==v&&qr!==null)for(var Cn in qr)qr.hasOwnProperty(Cn)&&(Ke[Cn]=qr[Cn])}return Ke}:ht=Object.assign;var We=wt(function(pe,Ke,ar){for(var qr=Object.keys(Ke),Cn=0;Cn<qr.length;)(!ar||ar&&pe[qr[Cn]]===v)&&(pe[qr[Cn]]=Ke[qr[Cn]]),Cn++;return pe},"extend","Use `assign`."),St=wt(function(pe,Ke){return We(pe,Ke,!0)},"merge","Use `assign`.");function Je(pt,pe,Ke){var ar=pe.prototype,qr;qr=pt.prototype=Object.create(ar),qr.constructor=pt,qr._super=ar,Ke&&ht(qr,Ke)}function Ft(pt,pe){return function(){return pt.apply(pe,arguments)}}function tr(pt,pe){return typeof pt==K?pt.apply(pe&&pe[0]||v,pe):pt}function yr(pt,pe){return pt===v?pe:pt}function Dr(pt,pe,Ke){nt(Dt(pe),function(ar){pt.addEventListener(ar,Ke,!1)})}function Mr(pt,pe,Ke){nt(Dt(pe),function(ar){pt.removeEventListener(ar,Ke,!1)})}function jt(pt,pe){for(;pt;){if(pt==pe)return!0;pt=pt.parentNode}return!1}function He(pt,pe){return pt.indexOf(pe)>-1}function Dt(pt){return pt.trim().split(/\s+/g)}function Ut(pt,pe,Ke){if(pt.indexOf&&!Ke)return pt.indexOf(pe);for(var ar=0;ar<pt.length;){if(Ke&&pt[ar][Ke]==pe||!Ke&&pt[ar]===pe)return ar;ar++}return-1}function Ce(pt){return Array.prototype.slice.call(pt,0)}function ve(pt,pe,Ke){for(var ar=[],qr=[],Cn=0;Cn<pt.length;){var ji=pe?pt[Cn][pe]:pt[Cn];Ut(qr,ji)<0&&ar.push(pt[Cn]),qr[Cn]=ji,Cn++}return Ke&&(pe?ar=ar.sort(function(So,os){return So[pe]>os[pe]}):ar=ar.sort()),ar}function Ie(pt,pe){for(var Ke,ar,qr=pe[0].toUpperCase()+pe.slice(1),Cn=0;Cn<L.length;){if(Ke=L[Cn],ar=Ke?Ke+qr:pe,ar in pt)return ar;Cn++}return v}var zt=1;function le(){return zt++}function Me(pt){var pe=pt.ownerDocument||pt;return pe.defaultView||pe.parentWindow||N}var Re=/mobile|tablet|ip(ad|hone|od)|android/i,yt="ontouchstart"in N,At=Ie(N,"PointerEvent")!==v,ae=yt&&Re.test(navigator.userAgent),It="touch",lr="pen",Cr="mouse",Br="kinect",pn=25,Fr=1,Pn=2,ni=4,Nn=8,Kn=1,Yn=2,Ar=4,mr=8,Xt=16,Wt=Yn|Ar,Ir=mr|Xt,Ue=Wt|Ir,he=["x","y"],ie=["clientX","clientY"];function B(pt,pe){var Ke=this;this.manager=pt,this.callback=pe,this.element=pt.element,this.target=pt.options.inputTarget,this.domHandler=function(ar){tr(pt.options.enable,[pt])&&Ke.handler(ar)},this.init()}B.prototype={handler:function(){},init:function(){this.evEl&&Dr(this.element,this.evEl,this.domHandler),this.evTarget&&Dr(this.target,this.evTarget,this.domHandler),this.evWin&&Dr(Me(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Mr(this.element,this.evEl,this.domHandler),this.evTarget&&Mr(this.target,this.evTarget,this.domHandler),this.evWin&&Mr(Me(this.element),this.evWin,this.domHandler)}};function Ae(pt){var pe,Ke=pt.options.inputClass;return Ke?pe=Ke:At?pe=Pi:ae?pe=xe:yt?pe=Vr:pe=Si,new pe(pt,Xe)}function Xe(pt,pe,Ke){var ar=Ke.pointers.length,qr=Ke.changedPointers.length,Cn=pe&Fr&&ar-qr==0,ji=pe&(ni|Nn)&&ar-qr==0;Ke.isFirst=!!Cn,Ke.isFinal=!!ji,Cn&&(pt.session={}),Ke.eventType=pe,bt(pt,Ke),pt.emit("hammer.input",Ke),pt.recognize(Ke),pt.session.prevInput=Ke}function bt(pt,pe){var Ke=pt.session,ar=pe.pointers,qr=ar.length;Ke.firstInput||(Ke.firstInput=at(pe)),qr>1&&!Ke.firstMultiple?Ke.firstMultiple=at(pe):qr===1&&(Ke.firstMultiple=!1);var Cn=Ke.firstInput,ji=Ke.firstMultiple,ka=ji?ji.center:Cn.center,So=pe.center=Ot(ar);pe.timeStamp=ue(),pe.deltaTime=pe.timeStamp-Cn.timeStamp,pe.angle=jn(ka,So),pe.distance=Or(ka,So),Gt(Ke,pe),pe.offsetDirection=Tr(pe.deltaX,pe.deltaY);var os=or(pe.deltaTime,pe.deltaX,pe.deltaY);pe.overallVelocityX=os.x,pe.overallVelocityY=os.y,pe.overallVelocity=fe(os.x)>fe(os.y)?os.x:os.y,pe.scale=ji?xn(ji.pointers,ar):1,pe.rotation=ji?Jr(ji.pointers,ar):0,pe.maxPointers=Ke.prevInput?pe.pointers.length>Ke.prevInput.maxPointers?pe.pointers.length:Ke.prevInput.maxPointers:pe.pointers.length,sr(Ke,pe);var Cs=pt.element;jt(pe.srcEvent.target,Cs)&&(Cs=pe.srcEvent.target),pe.target=Cs}function Gt(pt,pe){var Ke=pe.center,ar=pt.offsetDelta||{},qr=pt.prevDelta||{},Cn=pt.prevInput||{};(pe.eventType===Fr||Cn.eventType===ni)&&(qr=pt.prevDelta={x:Cn.deltaX||0,y:Cn.deltaY||0},ar=pt.offsetDelta={x:Ke.x,y:Ke.y}),pe.deltaX=qr.x+(Ke.x-ar.x),pe.deltaY=qr.y+(Ke.y-ar.y)}function sr(pt,pe){var Ke=pt.lastInterval||pe,ar=pe.timeStamp-Ke.timeStamp,qr,Cn,ji,ka;if(pe.eventType!=Nn&&(ar>pn||Ke.velocity===v)){var So=pe.deltaX-Ke.deltaX,os=pe.deltaY-Ke.deltaY,Cs=or(ar,So,os);Cn=Cs.x,ji=Cs.y,qr=fe(Cs.x)>fe(Cs.y)?Cs.x:Cs.y,ka=Tr(So,os),pt.lastInterval=pe}else qr=Ke.velocity,Cn=Ke.velocityX,ji=Ke.velocityY,ka=Ke.direction;pe.velocity=qr,pe.velocityX=Cn,pe.velocityY=ji,pe.direction=ka}function at(pt){for(var pe=[],Ke=0;Ke<pt.pointers.length;)pe[Ke]={clientX:q(pt.pointers[Ke].clientX),clientY:q(pt.pointers[Ke].clientY)},Ke++;return{timeStamp:ue(),pointers:pe,center:Ot(pe),deltaX:pt.deltaX,deltaY:pt.deltaY}}function Ot(pt){var pe=pt.length;if(pe===1)return{x:q(pt[0].clientX),y:q(pt[0].clientY)};for(var Ke=0,ar=0,qr=0;qr<pe;)Ke+=pt[qr].clientX,ar+=pt[qr].clientY,qr++;return{x:q(Ke/pe),y:q(ar/pe)}}function or(pt,pe,Ke){return{x:pe/pt||0,y:Ke/pt||0}}function Tr(pt,pe){return pt===pe?Kn:fe(pt)>=fe(pe)?pt<0?Yn:Ar:pe<0?mr:Xt}function Or(pt,pe,Ke){Ke||(Ke=he);var ar=pe[Ke[0]]-pt[Ke[0]],qr=pe[Ke[1]]-pt[Ke[1]];return Math.sqrt(ar*ar+qr*qr)}function jn(pt,pe,Ke){Ke||(Ke=he);var ar=pe[Ke[0]]-pt[Ke[0]],qr=pe[Ke[1]]-pt[Ke[1]];return Math.atan2(qr,ar)*180/Math.PI}function Jr(pt,pe){return jn(pe[1],pe[0],ie)+jn(pt[1],pt[0],ie)}function xn(pt,pe){return Or(pe[0],pe[1],ie)/Or(pt[0],pt[1],ie)}var An={mousedown:Fr,mousemove:Pn,mouseup:ni},ii="mousedown",pi="mousemove mouseup";function Si(){this.evEl=ii,this.evWin=pi,this.pressed=!1,B.apply(this,arguments)}Je(Si,B,{handler:function(pe){var Ke=An[pe.type];Ke&Fr&&pe.button===0&&(this.pressed=!0),Ke&Pn&&pe.which!==1&&(Ke=ni),!!this.pressed&&(Ke&ni&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[pe],changedPointers:[pe],pointerType:Cr,srcEvent:pe}))}});var wa={pointerdown:Fr,pointermove:Pn,pointerup:ni,pointercancel:Nn,pointerout:Nn},lo={2:It,3:lr,4:Cr,5:Br},Lo="pointerdown",as="pointermove pointerup pointercancel";N.MSPointerEvent&&!N.PointerEvent&&(Lo="MSPointerDown",as="MSPointerMove MSPointerUp MSPointerCancel");function Pi(){this.evEl=Lo,this.evWin=as,B.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Je(Pi,B,{handler:function(pe){var Ke=this.store,ar=!1,qr=pe.type.toLowerCase().replace("ms",""),Cn=wa[qr],ji=lo[pe.pointerType]||pe.pointerType,ka=ji==It,So=Ut(Ke,pe.pointerId,"pointerId");Cn&Fr&&(pe.button===0||ka)?So<0&&(Ke.push(pe),So=Ke.length-1):Cn&(ni|Nn)&&(ar=!0),!(So<0)&&(Ke[So]=pe,this.callback(this.manager,Cn,{pointers:Ke,changedPointers:[pe],pointerType:ji,srcEvent:pe}),ar&&Ke.splice(So,1))}});var re={touchstart:Fr,touchmove:Pn,touchend:ni,touchcancel:Nn},J="touchstart",me="touchstart touchmove touchend touchcancel";function we(){this.evTarget=J,this.evWin=me,this.started=!1,B.apply(this,arguments)}Je(we,B,{handler:function(pe){var Ke=re[pe.type];if(Ke===Fr&&(this.started=!0),!!this.started){var ar=ze.call(this,pe,Ke);Ke&(ni|Nn)&&ar[0].length-ar[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:ar[0],changedPointers:ar[1],pointerType:It,srcEvent:pe})}}});function ze(pt,pe){var Ke=Ce(pt.touches),ar=Ce(pt.changedTouches);return pe&(ni|Nn)&&(Ke=ve(Ke.concat(ar),"identifier",!0)),[Ke,ar]}var mt={touchstart:Fr,touchmove:Pn,touchend:ni,touchcancel:Nn},Tt="touchstart touchmove touchend touchcancel";function xe(){this.evTarget=Tt,this.targetIds={},B.apply(this,arguments)}Je(xe,B,{handler:function(pe){var Ke=mt[pe.type],ar=Qe.call(this,pe,Ke);!ar||this.callback(this.manager,Ke,{pointers:ar[0],changedPointers:ar[1],pointerType:It,srcEvent:pe})}});function Qe(pt,pe){var Ke=Ce(pt.touches),ar=this.targetIds;if(pe&(Fr|Pn)&&Ke.length===1)return ar[Ke[0].identifier]=!0,[Ke,Ke];var qr,Cn,ji=Ce(pt.changedTouches),ka=[],So=this.target;if(Cn=Ke.filter(function(os){return jt(os.target,So)}),pe===Fr)for(qr=0;qr<Cn.length;)ar[Cn[qr].identifier]=!0,qr++;for(qr=0;qr<ji.length;)ar[ji[qr].identifier]&&ka.push(ji[qr]),pe&(ni|Nn)&&delete ar[ji[qr].identifier],qr++;if(!!ka.length)return[ve(Cn.concat(ka),"identifier",!0),ka]}var Nt=2500,wr=25;function Vr(){B.apply(this,arguments);var pt=Ft(this.handler,this);this.touch=new xe(this.manager,pt),this.mouse=new Si(this.manager,pt),this.primaryTouch=null,this.lastTouches=[]}Je(Vr,B,{handler:function(pe,Ke,ar){var qr=ar.pointerType==It,Cn=ar.pointerType==Cr;if(!(Cn&&ar.sourceCapabilities&&ar.sourceCapabilities.firesTouchEvents)){if(qr)pr.call(this,Ke,ar);else if(Cn&&et.call(this,ar))return;this.callback(pe,Ke,ar)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function pr(pt,pe){pt&Fr?(this.primaryTouch=pe.changedPointers[0].identifier,De.call(this,pe)):pt&(ni|Nn)&&De.call(this,pe)}function De(pt){var pe=pt.changedPointers[0];if(pe.identifier===this.primaryTouch){var Ke={x:pe.clientX,y:pe.clientY};this.lastTouches.push(Ke);var ar=this.lastTouches,qr=function(){var ji=ar.indexOf(Ke);ji>-1&&ar.splice(ji,1)};setTimeout(qr,Nt)}}function et(pt){for(var pe=pt.srcEvent.clientX,Ke=pt.srcEvent.clientY,ar=0;ar<this.lastTouches.length;ar++){var qr=this.lastTouches[ar],Cn=Math.abs(pe-qr.x),ji=Math.abs(Ke-qr.y);if(Cn<=wr&&ji<=wr)return!0}return!1}var Lt=Ie(U.style,"touchAction"),ut=Lt!==v,Te="compute",dn="auto",yn="manipulation",ci="none",vn="pan-x",Ai="pan-y",Zi=zi();function Bi(pt,pe){this.manager=pt,this.set(pe)}Bi.prototype={set:function(pe){pe==Te&&(pe=this.compute()),ut&&this.manager.element.style&&Zi[pe]&&(this.manager.element.style[Lt]=pe),this.actions=pe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var pe=[];return nt(this.manager.recognizers,function(Ke){tr(Ke.options.enable,[Ke])&&(pe=pe.concat(Ke.getTouchAction()))}),$i(pe.join(" "))},preventDefaults:function(pe){var Ke=pe.srcEvent,ar=pe.offsetDirection;if(this.manager.session.prevented){Ke.preventDefault();return}var qr=this.actions,Cn=He(qr,ci)&&!Zi[ci],ji=He(qr,Ai)&&!Zi[Ai],ka=He(qr,vn)&&!Zi[vn];if(Cn){var So=pe.pointers.length===1,os=pe.distance<2,Cs=pe.deltaTime<250;if(So&&os&&Cs)return}if(!(ka&&ji)&&(Cn||ji&&ar&Wt||ka&&ar&Ir))return this.preventSrc(Ke)},preventSrc:function(pe){this.manager.session.prevented=!0,pe.preventDefault()}};function $i(pt){if(He(pt,ci))return ci;var pe=He(pt,vn),Ke=He(pt,Ai);return pe&&Ke?ci:pe||Ke?pe?vn:Ai:He(pt,yn)?yn:dn}function zi(){if(!ut)return!1;var pt={},pe=N.CSS&&N.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){pt[Ke]=pe?N.CSS.supports("touch-action",Ke):!0}),pt}var $o=1,Ii=2,ja=4,Wi=8,Ni=Wi,di=16,ao=32;function Bs(pt){this.options=ht({},this.defaults,pt||{}),this.id=le(),this.manager=null,this.options.enable=yr(this.options.enable,!0),this.state=$o,this.simultaneous={},this.requireFail=[]}Bs.prototype={defaults:{},set:function(pe){return ht(this.options,pe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(pe){if(Ne(pe,"recognizeWith",this))return this;var Ke=this.simultaneous;return pe=il(pe,this),Ke[pe.id]||(Ke[pe.id]=pe,pe.recognizeWith(this)),this},dropRecognizeWith:function(pe){return Ne(pe,"dropRecognizeWith",this)?this:(pe=il(pe,this),delete this.simultaneous[pe.id],this)},requireFailure:function(pe){if(Ne(pe,"requireFailure",this))return this;var Ke=this.requireFail;return pe=il(pe,this),Ut(Ke,pe)===-1&&(Ke.push(pe),pe.requireFailure(this)),this},dropRequireFailure:function(pe){if(Ne(pe,"dropRequireFailure",this))return this;pe=il(pe,this);var Ke=Ut(this.requireFail,pe);return Ke>-1&&this.requireFail.splice(Ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(pe){return!!this.simultaneous[pe.id]},emit:function(pe){var Ke=this,ar=this.state;function qr(Cn){Ke.manager.emit(Cn,pe)}ar<Wi&&qr(Ke.options.event+wo(ar)),qr(Ke.options.event),pe.additionalEvent&&qr(pe.additionalEvent),ar>=Wi&&qr(Ke.options.event+wo(ar))},tryEmit:function(pe){if(this.canEmit())return this.emit(pe);this.state=ao},canEmit:function(){for(var pe=0;pe<this.requireFail.length;){if(!(this.requireFail[pe].state&(ao|$o)))return!1;pe++}return!0},recognize:function(pe){var Ke=ht({},pe);if(!tr(this.options.enable,[this,Ke])){this.reset(),this.state=ao;return}this.state&(Ni|di|ao)&&(this.state=$o),this.state=this.process(Ke),this.state&(Ii|ja|Wi|di)&&this.tryEmit(Ke)},process:function(pe){},getTouchAction:function(){},reset:function(){}};function wo(pt){return pt&di?"cancel":pt&Wi?"end":pt&ja?"move":pt&Ii?"start":""}function Yo(pt){return pt==Xt?"down":pt==mr?"up":pt==Yn?"left":pt==Ar?"right":""}function il(pt,pe){var Ke=pe.manager;return Ke?Ke.get(pt):pt}function Oo(){Bs.apply(this,arguments)}Je(Oo,Bs,{defaults:{pointers:1},attrTest:function(pe){var Ke=this.options.pointers;return Ke===0||pe.pointers.length===Ke},process:function(pe){var Ke=this.state,ar=pe.eventType,qr=Ke&(Ii|ja),Cn=this.attrTest(pe);return qr&&(ar&Nn||!Cn)?Ke|di:qr||Cn?ar&ni?Ke|Wi:Ke&Ii?Ke|ja:Ii:ao}});function Ea(){Oo.apply(this,arguments),this.pX=null,this.pY=null}Je(Ea,Oo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ue},getTouchAction:function(){var pe=this.options.direction,Ke=[];return pe&Wt&&Ke.push(Ai),pe&Ir&&Ke.push(vn),Ke},directionTest:function(pe){var Ke=this.options,ar=!0,qr=pe.distance,Cn=pe.direction,ji=pe.deltaX,ka=pe.deltaY;return Cn&Ke.direction||(Ke.direction&Wt?(Cn=ji===0?Kn:ji<0?Yn:Ar,ar=ji!=this.pX,qr=Math.abs(pe.deltaX)):(Cn=ka===0?Kn:ka<0?mr:Xt,ar=ka!=this.pY,qr=Math.abs(pe.deltaY))),pe.direction=Cn,ar&&qr>Ke.threshold&&Cn&Ke.direction},attrTest:function(pe){return Oo.prototype.attrTest.call(this,pe)&&(this.state&Ii||!(this.state&Ii)&&this.directionTest(pe))},emit:function(pe){this.pX=pe.deltaX,this.pY=pe.deltaY;var Ke=Yo(pe.direction);Ke&&(pe.additionalEvent=this.options.event+Ke),this._super.emit.call(this,pe)}});function al(){Oo.apply(this,arguments)}Je(al,Oo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.scale-1)>this.options.threshold||this.state&Ii)},emit:function(pe){if(pe.scale!==1){var Ke=pe.scale<1?"in":"out";pe.additionalEvent=this.options.event+Ke}this._super.emit.call(this,pe)}});function Ro(){Bs.apply(this,arguments),this._timer=null,this._input=null}Je(Ro,Bs,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[dn]},process:function(pe){var Ke=this.options,ar=pe.pointers.length===Ke.pointers,qr=pe.distance<Ke.threshold,Cn=pe.deltaTime>Ke.time;if(this._input=pe,!qr||!ar||pe.eventType&(ni|Nn)&&!Cn)this.reset();else if(pe.eventType&Fr)this.reset(),this._timer=rt(function(){this.state=Ni,this.tryEmit()},Ke.time,this);else if(pe.eventType&ni)return Ni;return ao},reset:function(){clearTimeout(this._timer)},emit:function(pe){this.state===Ni&&(pe&&pe.eventType&ni?this.manager.emit(this.options.event+"up",pe):(this._input.timeStamp=ue(),this.manager.emit(this.options.event,this._input)))}});function Oa(){Oo.apply(this,arguments)}Je(Oa,Oo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ci]},attrTest:function(pe){return this._super.attrTest.call(this,pe)&&(Math.abs(pe.rotation)>this.options.threshold||this.state&Ii)}});function Ko(){Oo.apply(this,arguments)}Je(Ko,Oo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Wt|Ir,pointers:1},getTouchAction:function(){return Ea.prototype.getTouchAction.call(this)},attrTest:function(pe){var Ke=this.options.direction,ar;return Ke&(Wt|Ir)?ar=pe.overallVelocity:Ke&Wt?ar=pe.overallVelocityX:Ke&Ir&&(ar=pe.overallVelocityY),this._super.attrTest.call(this,pe)&&Ke&pe.offsetDirection&&pe.distance>this.options.threshold&&pe.maxPointers==this.options.pointers&&fe(ar)>this.options.velocity&&pe.eventType&ni},emit:function(pe){var Ke=Yo(pe.offsetDirection);Ke&&this.manager.emit(this.options.event+Ke,pe),this.manager.emit(this.options.event,pe)}});function ca(){Bs.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Je(ca,Bs,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yn]},process:function(pe){var Ke=this.options,ar=pe.pointers.length===Ke.pointers,qr=pe.distance<Ke.threshold,Cn=pe.deltaTime<Ke.time;if(this.reset(),pe.eventType&Fr&&this.count===0)return this.failTimeout();if(qr&&Cn&&ar){if(pe.eventType!=ni)return this.failTimeout();var ji=this.pTime?pe.timeStamp-this.pTime<Ke.interval:!0,ka=!this.pCenter||Or(this.pCenter,pe.center)<Ke.posThreshold;this.pTime=pe.timeStamp,this.pCenter=pe.center,!ka||!ji?this.count=1:this.count+=1,this._input=pe;var So=this.count%Ke.taps;if(So===0)return this.hasRequireFailures()?(this._timer=rt(function(){this.state=Ni,this.tryEmit()},Ke.interval,this),Ii):Ni}return ao},failTimeout:function(){return this._timer=rt(function(){this.state=ao},this.options.interval,this),ao},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ni&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Eo(pt,pe){return pe=pe||{},pe.recognizers=yr(pe.recognizers,Eo.defaults.preset),new Qo(pt,pe)}Eo.VERSION="2.0.7",Eo.defaults={domEvents:!1,touchAction:Te,enable:!0,inputTarget:null,inputClass:null,preset:[[Oa,{enable:!1}],[al,{enable:!1},["rotate"]],[Ko,{direction:Wt}],[Ea,{direction:Wt},["swipe"]],[ca],[ca,{event:"doubletap",taps:2},["tap"]],[Ro]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var qo=1,ol=2;function Qo(pt,pe){this.options=ht({},Eo.defaults,pe||{}),this.options.inputTarget=this.options.inputTarget||pt,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=pt,this.input=Ae(this),this.touchAction=new Bi(this,this.options.touchAction),sl(this,!0),nt(this.options.recognizers,function(Ke){var ar=this.add(new Ke[0](Ke[1]));Ke[2]&&ar.recognizeWith(Ke[2]),Ke[3]&&ar.requireFailure(Ke[3])},this)}Qo.prototype={set:function(pe){return ht(this.options,pe),pe.touchAction&&this.touchAction.update(),pe.inputTarget&&(this.input.destroy(),this.input.target=pe.inputTarget,this.input.init()),this},stop:function(pe){this.session.stopped=pe?ol:qo},recognize:function(pe){var Ke=this.session;if(!Ke.stopped){this.touchAction.preventDefaults(pe);var ar,qr=this.recognizers,Cn=Ke.curRecognizer;(!Cn||Cn&&Cn.state&Ni)&&(Cn=Ke.curRecognizer=null);for(var ji=0;ji<qr.length;)ar=qr[ji],Ke.stopped!==ol&&(!Cn||ar==Cn||ar.canRecognizeWith(Cn))?ar.recognize(pe):ar.reset(),!Cn&&ar.state&(Ii|ja|Wi)&&(Cn=Ke.curRecognizer=ar),ji++}},get:function(pe){if(pe instanceof Bs)return pe;for(var Ke=this.recognizers,ar=0;ar<Ke.length;ar++)if(Ke[ar].options.event==pe)return Ke[ar];return null},add:function(pe){if(Ne(pe,"add",this))return this;var Ke=this.get(pe.options.event);return Ke&&this.remove(Ke),this.recognizers.push(pe),pe.manager=this,this.touchAction.update(),pe},remove:function(pe){if(Ne(pe,"remove",this))return this;if(pe=this.get(pe),pe){var Ke=this.recognizers,ar=Ut(Ke,pe);ar!==-1&&(Ke.splice(ar,1),this.touchAction.update())}return this},on:function(pe,Ke){if(pe!==v&&Ke!==v){var ar=this.handlers;return nt(Dt(pe),function(qr){ar[qr]=ar[qr]||[],ar[qr].push(Ke)}),this}},off:function(pe,Ke){if(pe!==v){var ar=this.handlers;return nt(Dt(pe),function(qr){Ke?ar[qr]&&ar[qr].splice(Ut(ar[qr],Ke),1):delete ar[qr]}),this}},emit:function(pe,Ke){this.options.domEvents&&oo(pe,Ke);var ar=this.handlers[pe]&&this.handlers[pe].slice();if(!(!ar||!ar.length)){Ke.type=pe,Ke.preventDefault=function(){Ke.srcEvent.preventDefault()};for(var qr=0;qr<ar.length;)ar[qr](Ke),qr++}},destroy:function(){this.element&&sl(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function sl(pt,pe){var Ke=pt.element;if(!!Ke.style){var ar;nt(pt.options.cssProps,function(qr,Cn){ar=Ie(Ke.style,Cn),pe?(pt.oldCssProps[ar]=Ke.style[ar],Ke.style[ar]=qr):Ke.style[ar]=pt.oldCssProps[ar]||""}),pe||(pt.oldCssProps={})}}function oo(pt,pe){var Ke=z.createEvent("Event");Ke.initEvent(pt,!0,!0),Ke.gesture=pe,pe.target.dispatchEvent(Ke)}ht(Eo,{INPUT_START:Fr,INPUT_MOVE:Pn,INPUT_END:ni,INPUT_CANCEL:Nn,STATE_POSSIBLE:$o,STATE_BEGAN:Ii,STATE_CHANGED:ja,STATE_ENDED:Wi,STATE_RECOGNIZED:Ni,STATE_CANCELLED:di,STATE_FAILED:ao,DIRECTION_NONE:Kn,DIRECTION_LEFT:Yn,DIRECTION_RIGHT:Ar,DIRECTION_UP:mr,DIRECTION_DOWN:Xt,DIRECTION_HORIZONTAL:Wt,DIRECTION_VERTICAL:Ir,DIRECTION_ALL:Ue,Manager:Qo,Input:B,TouchAction:Bi,TouchInput:xe,MouseInput:Si,PointerEventInput:Pi,TouchMouseInput:Vr,SingleTouchInput:we,Recognizer:Bs,AttrRecognizer:Oo,Tap:ca,Pan:Ea,Swipe:Ko,Pinch:al,Rotate:Oa,Press:Ro,on:Dr,off:Mr,each:nt,merge:St,extend:We,assign:ht,inherit:Je,bindFn:Ft,prefixed:Ie});var qi=typeof N!="undefined"?N:typeof self!="undefined"?self:{};qi.Hammer=Eo,D=function(){return Eo}.call(Z,C,Z,se),D!==v&&(se.exports=D)})(window,document,"Hammer")},yMAV:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.Plan=void 0;var D=function(){function N(z,k){this.parentContext=z,this.rootRequest=k}return N}();Z.Plan=D},yP5f:function(se,Z,C){var D=C("+K+b");function N(z,k){var v=k?D(z.buffer):z.buffer;return new z.constructor(v,z.byteOffset,z.length)}se.exports=N},yXPU:function(se,Z){function C(N,z,k,v,L,U,K){try{var q=N[U](K),fe=q.value}catch(ue){k(ue);return}q.done?z(fe):Promise.resolve(fe).then(v,L)}function D(N){return function(){var z=this,k=arguments;return new Promise(function(v,L){var U=N.apply(z,k);function K(fe){C(U,v,L,K,q,"next",fe)}function q(fe){C(U,v,L,K,q,"throw",fe)}K(void 0)})}}se.exports=D,se.exports.__esModule=!0,se.exports.default=se.exports},ycre:function(se,Z,C){var D=C("711d"),N=D("length");se.exports=N},z4Hk:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.BindingWhenSyntax=void 0;var D=C("406g"),N=C("RR/i"),z=function(){function k(v){this._binding=v}return k.prototype.when=function(v){return this._binding.constraint=v,new D.BindingOnSyntax(this._binding)},k.prototype.whenTargetNamed=function(v){return this._binding.constraint=N.namedConstraint(v),new D.BindingOnSyntax(this._binding)},k.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(v){var L=v.target!==null&&!v.target.isNamed()&&!v.target.isTagged();return L},new D.BindingOnSyntax(this._binding)},k.prototype.whenTargetTagged=function(v,L){return this._binding.constraint=N.taggedConstraint(v)(L),new D.BindingOnSyntax(this._binding)},k.prototype.whenInjectedInto=function(v){return this._binding.constraint=function(L){return N.typeConstraint(v)(L.parentRequest)},new D.BindingOnSyntax(this._binding)},k.prototype.whenParentNamed=function(v){return this._binding.constraint=function(L){return N.namedConstraint(v)(L.parentRequest)},new D.BindingOnSyntax(this._binding)},k.prototype.whenParentTagged=function(v,L){return this._binding.constraint=function(U){return N.taggedConstraint(v)(L)(U.parentRequest)},new D.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorIs=function(v){return this._binding.constraint=function(L){return N.traverseAncerstors(L,N.typeConstraint(v))},new D.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorIs=function(v){return this._binding.constraint=function(L){return!N.traverseAncerstors(L,N.typeConstraint(v))},new D.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorNamed=function(v){return this._binding.constraint=function(L){return N.traverseAncerstors(L,N.namedConstraint(v))},new D.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorNamed=function(v){return this._binding.constraint=function(L){return!N.traverseAncerstors(L,N.namedConstraint(v))},new D.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorTagged=function(v,L){return this._binding.constraint=function(U){return N.traverseAncerstors(U,N.taggedConstraint(v)(L))},new D.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorTagged=function(v,L){return this._binding.constraint=function(U){return!N.traverseAncerstors(U,N.taggedConstraint(v)(L))},new D.BindingOnSyntax(this._binding)},k.prototype.whenAnyAncestorMatches=function(v){return this._binding.constraint=function(L){return N.traverseAncerstors(L,v)},new D.BindingOnSyntax(this._binding)},k.prototype.whenNoAncestorMatches=function(v){return this._binding.constraint=function(L){return!N.traverseAncerstors(L,v)},new D.BindingOnSyntax(this._binding)},k}();Z.BindingWhenSyntax=z},zEVN:function(se,Z,C){var D=C("Gi0A"),N=C("sEf8"),z=C("mdPL"),k=z&&z.isMap,v=k?N(k):D;se.exports=v},zZ0H:function(se,Z){function C(D){return D}se.exports=C},zoYe:function(se,Z,C){var D=C("nmnc"),N=C("eUgh"),z=C("Z0cm"),k=C("/9aa"),v=1/0,L=D?D.prototype:void 0,U=L?L.toString:void 0;function K(q){if(typeof q=="string")return q;if(z(q))return N(q,K)+"";if(k(q))return U?U.call(q):"";var fe=q+"";return fe=="0"&&1/q==-v?"-0":fe}se.exports=K},zvhG:function(se,Z){se.exports=C;function C(D,N,z,k){this.cx=3*D,this.bx=3*(z-D)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*N,this.by=3*(k-N)-this.cy,this.ay=1-this.cy-this.by,this.p1x=D,this.p1y=k,this.p2x=z,this.p2y=k}C.prototype.sampleCurveX=function(D){return((this.ax*D+this.bx)*D+this.cx)*D},C.prototype.sampleCurveY=function(D){return((this.ay*D+this.by)*D+this.cy)*D},C.prototype.sampleCurveDerivativeX=function(D){return(3*this.ax*D+2*this.bx)*D+this.cx},C.prototype.solveCurveX=function(D,N){typeof N=="undefined"&&(N=1e-6);var z,k,v,L,U;for(v=D,U=0;U<8;U++){if(L=this.sampleCurveX(v)-D,Math.abs(L)<N)return v;var K=this.sampleCurveDerivativeX(v);if(Math.abs(K)<1e-6)break;v=v-L/K}if(z=0,k=1,v=D,v<z)return z;if(v>k)return k;for(;z<k;){if(L=this.sampleCurveX(v),Math.abs(L-D)<N)return v;D>L?z=v:k=v,v=(k-z)*.5+z}return v},C.prototype.solve=function(D,N){return this.sampleCurveY(this.solveCurveX(D,N))}},zxMA:function(se,Z,C){"use strict";Object.defineProperty(Z,"__esModule",{value:!0}),Z.QueryableString=void 0;var D=function(){function N(z){this.str=z}return N.prototype.startsWith=function(z){return this.str.indexOf(z)===0},N.prototype.endsWith=function(z){var k="",v=z.split("").reverse().join("");return k=this.str.split("").reverse().join(""),this.startsWith.call({str:k},v)},N.prototype.contains=function(z){return this.str.indexOf(z)!==-1},N.prototype.equals=function(z){return this.str===z},N.prototype.value=function(){return this.str},N}();Z.QueryableString=D}}]);
