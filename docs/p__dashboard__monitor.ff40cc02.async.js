(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{"/ezw":function(He,K,O){"use strict";var W=O("rePB"),re=O("wx14"),ne=O("U8pU"),j=O("q1tI"),m=O("TSYQ"),U=O.n(m),G=function(fe){var Pe=fe.prefixCls,Se=fe.className,lt=fe.width,ut=fe.style;return j.createElement("h3",{className:U()(Pe,Se),style:Object(re.a)({width:lt},ut)})},Te=G,xe=O("KQm4"),Me=function(fe){var Pe=function(Or){var Nt=fe.width,Tt=fe.rows,It=Tt===void 0?2:Tt;if(Array.isArray(Nt))return Nt[Or];if(It-1===Or)return Nt},Se=fe.prefixCls,lt=fe.className,ut=fe.style,Ot=fe.rows,wt=Object(xe.a)(Array(Ot)).map(function(sr,Or){return j.createElement("li",{key:Or,style:{width:Pe(Or)}})});return j.createElement("ul",{className:U()(Se,lt),style:ut},wt)},Ee=Me,Mt=O("H84U"),at=function(fe){var Pe,Se,lt=fe.prefixCls,ut=fe.className,Ot=fe.style,wt=fe.size,sr=fe.shape,Or=U()((Pe={},Object(W.a)(Pe,"".concat(lt,"-lg"),wt==="large"),Object(W.a)(Pe,"".concat(lt,"-sm"),wt==="small"),Pe)),Nt=U()((Se={},Object(W.a)(Se,"".concat(lt,"-circle"),sr==="circle"),Object(W.a)(Se,"".concat(lt,"-square"),sr==="square"),Object(W.a)(Se,"".concat(lt,"-round"),sr==="round"),Se)),Tt=typeof wt=="number"?{width:wt,height:wt,lineHeight:"".concat(wt,"px")}:{};return j.createElement("span",{className:U()(lt,Or,Nt,ut),style:Object(re.a)(Object(re.a)({},Tt),Ot)})},ht=at,vt=O("bT9E"),_t=function(fe){var Pe=function(lt){var ut=lt.getPrefixCls,Ot=fe.prefixCls,wt=fe.className,sr=fe.active,Or=ut("skeleton",Ot),Nt=Object(vt.a)(fe,["prefixCls","className"]),Tt=U()(Or,"".concat(Or,"-element"),Object(W.a)({},"".concat(Or,"-active"),sr),wt);return j.createElement("div",{className:Tt},j.createElement(ht,Object(re.a)({prefixCls:"".concat(Or,"-avatar")},Nt)))};return j.createElement(Mt.a,null,Pe)};_t.defaultProps={size:"default",shape:"circle"};var Ve=_t,xt=function(fe){var Pe=function(lt){var ut,Ot=lt.getPrefixCls,wt=fe.prefixCls,sr=fe.className,Or=fe.active,Nt=fe.block,Tt=Nt===void 0?!1:Nt,It=Ot("skeleton",wt),$t=Object(vt.a)(fe,["prefixCls"]),gr=U()(It,"".concat(It,"-element"),(ut={},Object(W.a)(ut,"".concat(It,"-active"),Or),Object(W.a)(ut,"".concat(It,"-block"),Tt),ut),sr);return j.createElement("div",{className:gr},j.createElement(ht,Object(re.a)({prefixCls:"".concat(It,"-button")},$t)))};return j.createElement(Mt.a,null,Pe)};xt.defaultProps={size:"default"};var st=xt,it=function(fe){var Pe=function(lt){var ut=lt.getPrefixCls,Ot=fe.prefixCls,wt=fe.className,sr=fe.active,Or=ut("skeleton",Ot),Nt=Object(vt.a)(fe,["prefixCls"]),Tt=U()(Or,"".concat(Or,"-element"),Object(W.a)({},"".concat(Or,"-active"),sr),wt);return j.createElement("div",{className:Tt},j.createElement(ht,Object(re.a)({prefixCls:"".concat(Or,"-input")},Nt)))};return j.createElement(Mt.a,null,Pe)};it.defaultProps={size:"default"};var N=it,Re="M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z",Nr=function(fe){var Pe=function(lt){var ut=lt.getPrefixCls,Ot=fe.prefixCls,wt=fe.className,sr=fe.style,Or=ut("skeleton",Ot),Nt=U()(Or,"".concat(Or,"-element"),wt);return j.createElement("div",{className:Nt},j.createElement("div",{className:U()("".concat(Or,"-image"),wt),style:sr},j.createElement("svg",{viewBox:"0 0 1098 1024",xmlns:"http://www.w3.org/2000/svg",className:"".concat(Or,"-image-svg")},j.createElement("path",{d:Re,className:"".concat(Or,"-image-path")}))))};return j.createElement(Mt.a,null,Pe)},Pr=Nr;function Wt(br){return br&&Object(ne.a)(br)==="object"?br:{}}function Oe(br,fe){return br&&!fe?{size:"large",shape:"square"}:{size:"large",shape:"circle"}}function Bt(br,fe){return!br&&fe?{width:"38%"}:br&&fe?{width:"50%"}:{}}function Zt(br,fe){var Pe={};return(!br||!fe)&&(Pe.width="61%"),!br&&fe?Pe.rows=3:Pe.rows=2,Pe}var ir=function(fe){var Pe=function(lt){var ut=lt.getPrefixCls,Ot=lt.direction,wt=fe.prefixCls,sr=fe.loading,Or=fe.className,Nt=fe.style,Tt=fe.children,It=fe.avatar,$t=fe.title,gr=fe.paragraph,qt=fe.active,dr=fe.round,Ur=ut("skeleton",wt);if(sr||!("loading"in fe)){var Ir,ur=!!It,Rr=!!$t,Yn=!!gr,un;if(ur){var _n=Object(re.a)(Object(re.a)({prefixCls:"".concat(Ur,"-avatar")},Oe(Rr,Yn)),Wt(It));un=j.createElement("div",{className:"".concat(Ur,"-header")},j.createElement(ht,_n))}var qn;if(Rr||Yn){var oi;if(Rr){var Gi=Object(re.a)(Object(re.a)({prefixCls:"".concat(Ur,"-title")},Bt(ur,Yn)),Wt($t));oi=j.createElement(Te,Gi)}var he;if(Yn){var Fn=Object(re.a)(Object(re.a)({prefixCls:"".concat(Ur,"-paragraph")},Zt(ur,Rr)),Wt(gr));he=j.createElement(Ee,Fn)}qn=j.createElement("div",{className:"".concat(Ur,"-content")},oi,he)}var Li=U()(Ur,(Ir={},Object(W.a)(Ir,"".concat(Ur,"-with-avatar"),ur),Object(W.a)(Ir,"".concat(Ur,"-active"),qt),Object(W.a)(Ir,"".concat(Ur,"-rtl"),Ot==="rtl"),Object(W.a)(Ir,"".concat(Ur,"-round"),dr),Ir),Or);return j.createElement("div",{className:Li,style:Nt},un,qn)}return Tt};return j.createElement(Mt.a,null,Pe)};ir.defaultProps={avatar:!1,title:!0,paragraph:!0},ir.Button=st,ir.Avatar=Ve,ir.Input=N,ir.Image=Pr;var Fr=ir,qr=K.a=Fr},"/kpp":function(He,K,O){"use strict";var W=O("rePB"),re=O("wx14"),ne=O("U8pU"),j=O("q1tI"),m=O.n(j),U=O("TSYQ"),G=O.n(U),Te=O("o/2+"),xe=O("H84U"),Me=function(ht,vt){var _t={};for(var Ve in ht)Object.prototype.hasOwnProperty.call(ht,Ve)&&vt.indexOf(Ve)<0&&(_t[Ve]=ht[Ve]);if(ht!=null&&typeof Object.getOwnPropertySymbols=="function")for(var xt=0,Ve=Object.getOwnPropertySymbols(ht);xt<Ve.length;xt++)vt.indexOf(Ve[xt])<0&&Object.prototype.propertyIsEnumerable.call(ht,Ve[xt])&&(_t[Ve[xt]]=ht[Ve[xt]]);return _t};function Ee(ht){return typeof ht=="number"?"".concat(ht," ").concat(ht," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(ht)?"0 0 ".concat(ht):ht}var Mt=["xs","sm","md","lg","xl","xxl"],at=j.forwardRef(function(ht,vt){var _t,Ve=j.useContext(xe.b),xt=Ve.getPrefixCls,st=Ve.direction,it=j.useContext(Te.a),N=it.gutter,Re=it.wrap,Nr=it.supportFlexGap,Pr=ht.prefixCls,Wt=ht.span,Oe=ht.order,Bt=ht.offset,Zt=ht.push,ir=ht.pull,Fr=ht.className,qr=ht.children,br=ht.flex,fe=ht.style,Pe=Me(ht,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),Se=xt("col",Pr),lt={};Mt.forEach(function(Or){var Nt,Tt={},It=ht[Or];typeof It=="number"?Tt.span=It:Object(ne.a)(It)==="object"&&(Tt=It||{}),delete Pe[Or],lt=Object(re.a)(Object(re.a)({},lt),(Nt={},Object(W.a)(Nt,"".concat(Se,"-").concat(Or,"-").concat(Tt.span),Tt.span!==void 0),Object(W.a)(Nt,"".concat(Se,"-").concat(Or,"-order-").concat(Tt.order),Tt.order||Tt.order===0),Object(W.a)(Nt,"".concat(Se,"-").concat(Or,"-offset-").concat(Tt.offset),Tt.offset||Tt.offset===0),Object(W.a)(Nt,"".concat(Se,"-").concat(Or,"-push-").concat(Tt.push),Tt.push||Tt.push===0),Object(W.a)(Nt,"".concat(Se,"-").concat(Or,"-pull-").concat(Tt.pull),Tt.pull||Tt.pull===0),Object(W.a)(Nt,"".concat(Se,"-rtl"),st==="rtl"),Nt))});var ut=G()(Se,(_t={},Object(W.a)(_t,"".concat(Se,"-").concat(Wt),Wt!==void 0),Object(W.a)(_t,"".concat(Se,"-order-").concat(Oe),Oe),Object(W.a)(_t,"".concat(Se,"-offset-").concat(Bt),Bt),Object(W.a)(_t,"".concat(Se,"-push-").concat(Zt),Zt),Object(W.a)(_t,"".concat(Se,"-pull-").concat(ir),ir),_t),Fr,lt),Ot={};if(N&&N[0]>0){var wt=N[0]/2;Ot.paddingLeft=wt,Ot.paddingRight=wt}if(N&&N[1]>0&&!Nr){var sr=N[1]/2;Ot.paddingTop=sr,Ot.paddingBottom=sr}return br&&(Ot.flex=Ee(br),Re===!1&&!Ot.minWidth&&(Ot.minWidth=0)),j.createElement("div",Object(re.a)({},Pe,{style:Object(re.a)(Object(re.a)({},Ot),fe),className:ut,ref:vt}),qr)});at.displayName="Col",K.a=at},"0gSV":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.tagged=void 0;var W=O("GXnB"),re=O("Ztfv");function ne(j,m){return function(U,G,Te){var xe=new W.Metadata(j,m);typeof Te=="number"?re.tagParameter(U,G,Te,xe):re.tagProperty(U,G,xe)}}K.tagged=ne},"1+5i":function(He,K,O){var W=O("w/wX"),re=O("sEf8"),ne=O("mdPL"),j=ne&&ne.isSet,m=j?re(j):W;He.exports=m},"1ABj":function(He,K){function O(W,re){throw new Error("Decorating class property failed. Please ensure that proposal-class-properties is enabled and runs after the decorators transform.")}He.exports=O,He.exports.__esModule=!0,He.exports.default=He.exports},"1XEM":function(He,K,O){He.exports={tagCloud:"tagCloud___Blez5"}},"2ajD":function(He,K){function O(W){return W!==W}He.exports=O},"3cYt":function(He,K){function O(W){return function(re){return W==null?void 0:W[re]}}He.exports=O},"406g":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingOnSyntax=void 0;var W=O("z4Hk"),re=function(){function ne(j){this._binding=j}return ne.prototype.onActivation=function(j){return this._binding.onActivation=j,new W.BindingWhenSyntax(this._binding)},ne}();K.BindingOnSyntax=re},"4ZJM":function(He,K,O){(function(W,re){He.exports=re()})(this,function(){"use strict";var W,re,ne;function j(m,U){if(!W)W=U;else if(!re)re=U;else{var G="var sharedChunk = {}; ("+W+")(sharedChunk); ("+re+")(sharedChunk);",Te={};W(Te),ne=U(Te),typeof window!="undefined"&&(ne.workerUrl=window.URL.createObjectURL(new Blob([G],{type:"text/javascript"})))}}return j(["exports"],function(m){"use strict";function U(a,o){return a(o={exports:{}},o.exports),o.exports}var G=Te;function Te(a,o,u,p){this.cx=3*a,this.bx=3*(u-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(p-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=p,this.p2x=u,this.p2y=p}Te.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},Te.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},Te.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},Te.prototype.solveCurveX=function(a,o){var u,p,y,b,S;for(o===void 0&&(o=1e-6),y=a,S=0;S<8;S++){if(b=this.sampleCurveX(y)-a,Math.abs(b)<o)return y;var M=this.sampleCurveDerivativeX(y);if(Math.abs(M)<1e-6)break;y-=b/M}if((y=a)<(u=0))return u;if(y>(p=1))return p;for(;u<p;){if(b=this.sampleCurveX(y),Math.abs(b-a)<o)return y;a>b?u=y:p=y,y=.5*(p-u)+u}return y},Te.prototype.solve=function(a,o){return this.sampleCurveY(this.solveCurveX(a,o))};var xe=Me;function Me(a,o){this.x=a,this.y=o}Me.prototype={clone:function(){return new Me(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,p=o.y-this.y;return u*u+p*p},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),p=Math.sin(o),y=p*this.x+u*this.y;return this.x=u*this.x-p*this.y,this.y=y,this},_rotateAround:function(o,u){var p=Math.cos(o),y=Math.sin(o),b=u.y+y*(this.x-u.x)+p*(this.y-u.y);return this.x=u.x+p*(this.x-u.x)-y*(this.y-u.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Me.convert=function(a){return a instanceof Me?a:Array.isArray(a)?new Me(a[0],a[1]):a};var Ee=typeof self!="undefined"?self:{},Mt=Math.pow(2,53)-1;function at(a,o,u,p){var y=new G(a,o,u,p);return function(b){return y.solve(b)}}var ht=at(.25,.1,.25,1);function vt(a,o,u){return Math.min(u,Math.max(o,a))}function _t(a,o,u){var p=u-o,y=((a-o)%p+p)%p+o;return y===o?u:y}function Ve(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)a[S]=b[S]}return a}var xt=1;function st(){return xt++}function it(){return function a(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function N(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function Re(a,o){a.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Nr(a,o){return a.indexOf(o,a.length-o.length)!==-1}function Pr(a,o,u){var p={};for(var y in a)p[y]=o.call(u||this,a[y],y,a);return p}function Wt(a,o,u){var p={};for(var y in a)o.call(u||this,a[y],y,a)&&(p[y]=a[y]);return p}function Oe(a){return Array.isArray(a)?a.map(Oe):typeof a=="object"&&a?Pr(a,Oe):a}var Bt={};function Zt(a){Bt[a]||(typeof console!="undefined"&&console.warn(a),Bt[a]=!0)}function ir(a,o,u){return(u.y-a.y)*(o.x-a.x)>(o.y-a.y)*(u.x-a.x)}function Fr(a){for(var o=0,u=0,p=a.length,y=p-1,b=void 0,S=void 0;u<p;y=u++)o+=((S=a[y]).x-(b=a[u]).x)*(b.y+S.y);return o}function qr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function br(a){var o={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,y,b,S){var M=b||S;return o[y]=!M||M.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var fe=null;function Pe(a){if(fe==null){var o=a.navigator?a.navigator.userAgent:null;fe=!!a.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return fe}function Se(a){try{var o=Ee[a];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var lt,ut,Ot,wt,sr=Ee.performance&&Ee.performance.now?Ee.performance.now.bind(Ee.performance):Date.now.bind(Date),Or=Ee.requestAnimationFrame||Ee.mozRequestAnimationFrame||Ee.webkitRequestAnimationFrame||Ee.msRequestAnimationFrame,Nt=Ee.cancelAnimationFrame||Ee.mozCancelAnimationFrame||Ee.webkitCancelAnimationFrame||Ee.msCancelAnimationFrame,Tt={now:sr,frame:function(o){var u=Or(o);return{cancel:function(){return Nt(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var p=Ee.document.createElement("canvas"),y=p.getContext("2d");if(!y)throw new Error("failed to create canvas 2d context");return p.width=o.width,p.height=o.height,y.drawImage(o,0,0,o.width,o.height),y.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return lt||(lt=Ee.document.createElement("a")),lt.href=o,lt.href},hardwareConcurrency:Ee.navigator&&Ee.navigator.hardwareConcurrency||4,get devicePixelRatio(){return Ee.devicePixelRatio},get prefersReducedMotion(){return!!Ee.matchMedia&&(ut==null&&(ut=Ee.matchMedia("(prefers-reduced-motion: reduce)")),ut.matches)}},It={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},$t={supported:!1,testSupport:function(o){!gr&&wt&&(qt?dr(o):Ot=o)}},gr=!1,qt=!1;function dr(a){var o=a.createTexture();a.bindTexture(a.TEXTURE_2D,o);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,wt),a.isContextLost())return;$t.supported=!0}catch(u){}a.deleteTexture(o),gr=!0}Ee.document&&((wt=Ee.document.createElement("img")).onload=function(){Ot&&dr(Ot),Ot=null,qt=!0},wt.onerror=function(){gr=!0,Ot=null},wt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ur="01",Ir=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function ur(a){return a.indexOf("mapbox:")===0}Ir.prototype._createSkuToken=function(){var a=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ur,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt},Ir.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ir.prototype.transformRequest=function(a,o){return this._transformRequestFn&&this._transformRequestFn(a,o)||{url:a}},Ir.prototype.normalizeStyleURL=function(a,o){if(!ur(a))return a;var u=_n(a);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ir.prototype.normalizeGlyphsURL=function(a,o){if(!ur(a))return a;var u=_n(a);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Ir.prototype.normalizeSourceURL=function(a,o){if(!ur(a))return a;var u=_n(a);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Ir.prototype.normalizeSpriteURL=function(a,o,u,p){var y=_n(a);return ur(a)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||p)):(y.path+=""+o+u,qn(y))},Ir.prototype.normalizeTileURL=function(a,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!ur(a))return a;var u=_n(a);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Tt.devicePixelRatio>=2||o===512?"@2x":"")+($t.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var p=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var M=S[b].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||It.ACCESS_TOKEN;return It.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,p)},Ir.prototype.canonicalizeTileURL=function(a,o){var u=_n(a);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return a;var p="mapbox://tiles/";p+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(p+="?"+y.join("&")),p},Ir.prototype.canonicalizeTileset=function(a,o){for(var u=!!o&&ur(o),p=[],y=0,b=a.tiles||[];y<b.length;y+=1){var S=b[y];Yn(S)?p.push(this.canonicalizeTileURL(S,u)):p.push(S)}return p},Ir.prototype._makeAPIURL=function(a,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=_n(It.API_URL);if(a.protocol=p.protocol,a.authority=p.authority,a.protocol==="http"){var y=a.params.indexOf("secure");y>=0&&a.params.splice(y,1)}if(p.path!=="/"&&(a.path=""+p.path+a.path),!It.REQUIRE_ACCESS_TOKEN)return qn(a);if(!(o=o||It.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return a.params=a.params.filter(function(b){return b.indexOf("access_token")===-1}),a.params.push("access_token="+o),qn(a)};var Rr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Yn(a){return Rr.test(a)}var un=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _n(a){var o=a.match(un);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function qn(a){var o=a.params.length?"?"+a.params.join("&"):"";return a.protocol+"://"+a.authority+a.path+o}function oi(a){if(!a)return null;var o=a.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(Ee.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Gi=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Gi.prototype.getStorageKey=function(a){var o,u=oi(It.ACCESS_TOKEN);return o=u&&u.u?Ee.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(p,y){return String.fromCharCode(Number("0x"+y))})):It.ACCESS_TOKEN||"",a?"mapbox.eventData."+a+":"+o:"mapbox.eventData:"+o},Gi.prototype.fetchEventData=function(){var a=Se("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(a)try{var p=Ee.localStorage.getItem(o);p&&(this.eventData=JSON.parse(p));var y=Ee.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){Zt("Unable to read from LocalStorage")}},Gi.prototype.saveEventData=function(){var a=Se("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(a)try{Ee.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&Ee.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(p){Zt("Unable to write to LocalStorage")}},Gi.prototype.processRequests=function(a){},Gi.prototype.postEvent=function(a,o,u,p){var y=this;if(It.EVENTS_URL){var b=_n(It.EVENTS_URL);b.params.push("access_token="+(p||It.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(a).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:Ur,userId:this.anonId},M=o?Ve(S,o):S,D={url:qn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ra(D,function(B){y.pendingRequest=null,u(B),y.saveEventData(),y.processRequests(p)})}},Gi.prototype.queueRequest=function(a,o){this.queue.push(a),this.processRequests(o)};var he,Fn,Li=function(a){function o(){a.call(this,"map.load"),this.success={},this.skuToken=""}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,p,y,b){this.skuToken=y,(It.EVENTS_URL&&b||It.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return ur(S)||Yn(S)}))&&this.queueRequest({id:p,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),N(this.anonId)||(this.anonId=it()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||b&&(p.success[b]=!0)},u))}},o}(Gi),Ko=new(function(a){function o(u){a.call(this,"appUserTurnstile"),this._customAccessToken=u}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,p){It.EVENTS_URL&&It.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return ur(y)||Yn(y)})&&this.queueRequest(Date.now(),p)},o.prototype.processRequests=function(u){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=oi(It.ACCESS_TOKEN),b=y?y.u:It.ACCESS_TOKEN,S=b!==this.eventData.tokenU;N(this.anonId)||(this.anonId=it(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),B=new Date(M),Z=(M-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||D.getDate()!==B.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(q){q||(p.eventData.lastSuccess=M,p.eventData.tokenU=b)},u)}},o}(Gi)),us=Ko.postTurnstileEvent.bind(Ko),Ut=new Li,Er=Ut.postMapLoadEvent.bind(Ut),Hr=500,dn=50;function Kr(){Ee.caches&&!he&&(he=Ee.caches.open("mapbox-tiles"))}function Ia(a){var o=a.indexOf("?");return o<0?a:a.slice(0,o)}var li,Hn=1/0;function ii(){return li==null&&(li=Ee.OffscreenCanvas&&new Ee.OffscreenCanvas(1,1).getContext("2d")&&typeof Ee.createImageBitmap=="function"),li}var Hi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Hi);var Wi=function(a){function o(u,p,y){p===401&&Yn(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),a.call(this,u),this.status=p,this.url=y,this.name=this.constructor.name,this.message=u}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),To=qr()?function(){return self.worker&&self.worker.referrer}:function(){return(Ee.location.protocol==="blob:"?Ee.parent:Ee).location.href},Wa,ma,As=function(o,u){if(!(/^file:/.test(p=o.url)||/^file:/.test(To())&&!/^\w+:/.test(p))){if(Ee.fetch&&Ee.Request&&Ee.AbortController&&Ee.Request.prototype.hasOwnProperty("signal"))return function(y,b){var S,M=new Ee.AbortController,D=new Ee.Request(y.url,{method:y.method||"GET",body:y.body,credentials:y.credentials,headers:y.headers,referrer:To(),signal:M.signal}),B=!1,Z=!1,q=(S=D.url).indexOf("sku=")>0&&Yn(S);y.type==="json"&&D.headers.set("Accept","application/json");var ee=function(Ie,Ye,Xe){if(!Z){if(Ie&&Ie.message!=="SecurityError"&&Zt(Ie),Ye&&Xe)return _e(Ye);var gt=Date.now();Ee.fetch(D).then(function(Dt){if(Dt.ok){var Xt=q?Dt.clone():null;return _e(Dt,Xt,gt)}return b(new Wi(Dt.statusText,Dt.status,y.url))}).catch(function(Dt){Dt.code!==20&&b(new Error(Dt.message))})}},_e=function(Ie,Ye,Xe){(y.type==="arrayBuffer"?Ie.arrayBuffer():y.type==="json"?Ie.json():Ie.text()).then(function(gt){Z||(Ye&&Xe&&function(Dt,Xt,yr){if(Kr(),he){var or={status:Xt.status,statusText:Xt.statusText,headers:new Ee.Headers};Xt.headers.forEach(function(tn,Gn){return or.headers.set(Gn,tn)});var Jr=br(Xt.headers.get("Cache-Control")||"");Jr["no-store"]||(Jr["max-age"]&&or.headers.set("Expires",new Date(yr+1e3*Jr["max-age"]).toUTCString()),new Date(or.headers.get("Expires")).getTime()-yr<42e4||function(tn,Gn){if(Fn===void 0)try{new Response(new ReadableStream),Fn=!0}catch(ti){Fn=!1}Fn?Gn(tn.body):tn.blob().then(Gn)}(Xt,function(tn){var Gn=new Ee.Response(tn,or);Kr(),he&&he.then(function(ti){return ti.put(Ia(Dt.url),Gn)}).catch(function(ti){return Zt(ti.message)})}))}}(D,Ye,Xe),B=!0,b(null,gt,Ie.headers.get("Cache-Control"),Ie.headers.get("Expires")))}).catch(function(gt){Z||b(new Error(gt.message))})};return q?function(Le,Ie){if(Kr(),!he)return Ie(null);var Ye=Ia(Le.url);he.then(function(Xe){Xe.match(Ye).then(function(gt){var Dt=function(Xt){if(!Xt)return!1;var yr=new Date(Xt.headers.get("Expires")||0),or=br(Xt.headers.get("Cache-Control")||"");return yr>Date.now()&&!or["no-cache"]}(gt);Xe.delete(Ye),Dt&&Xe.put(Ye,gt.clone()),Ie(null,gt,Dt)}).catch(Ie)}).catch(Ie)}(D,ee):ee(null,null),{cancel:function(){Z=!0,B||M.abort()}}}(o,u);if(qr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var p;return function(y,b){var S=new Ee.XMLHttpRequest;for(var M in S.open(y.method||"GET",y.url,!0),y.type==="arrayBuffer"&&(S.responseType="arraybuffer"),y.headers)S.setRequestHeader(M,y.headers[M]);return y.type==="json"&&(S.responseType="text",S.setRequestHeader("Accept","application/json")),S.withCredentials=y.credentials==="include",S.onerror=function(){b(new Error(S.statusText))},S.onload=function(){if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){var D=S.response;if(y.type==="json")try{D=JSON.parse(S.response)}catch(B){return b(B)}b(null,D,S.getResponseHeader("Cache-Control"),S.getResponseHeader("Expires"))}else b(new Wi(S.statusText,S.status,y.url))},S.send(y.body),{cancel:function(){return S.abort()}}}(o,u)},js=function(o,u){return As(Ve(o,{type:"arrayBuffer"}),u)},Ra=function(o,u){return As(Ve(o,{method:"POST"}),u)},J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Wa=[],ma=0;var $=function a(o,u){if($t.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ma>=It.MAX_PARALLEL_IMAGE_REQUESTS){var p={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return Wa.push(p),p}ma++;var y=!1,b=function(){if(!y)for(y=!0,ma--;Wa.length&&ma<It.MAX_PARALLEL_IMAGE_REQUESTS;){var D=Wa.shift();D.cancelled||(D.cancel=a(D.requestParameters,D.callback).cancel)}},S=js(o,function(M,D,B,Z){b(),M?u(M):D&&(ii()?function(q,ee){var _e=new Ee.Blob([new Uint8Array(q)],{type:"image/png"});Ee.createImageBitmap(_e).then(function(Le){ee(null,Le)}).catch(function(Le){ee(new Error("Could not load image because of "+Le.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(D,u):function(q,ee,_e,Le){var Ie=new Ee.Image,Ye=Ee.URL;Ie.onload=function(){ee(null,Ie),Ye.revokeObjectURL(Ie.src),Ie.onload=null,Ee.requestAnimationFrame(function(){Ie.src=J})},Ie.onerror=function(){return ee(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Xe=new Ee.Blob([new Uint8Array(q)],{type:"image/png"});Ie.cacheControl=_e,Ie.expires=Le,Ie.src=q.byteLength?Ye.createObjectURL(Xe):J}(D,u,B,Z))});return{cancel:function(){S.cancel(),b()}}};function le(a,o,u){u[a]&&u[a].indexOf(o)!==-1||(u[a]=u[a]||[],u[a].push(o))}function ge(a,o,u){if(u&&u[a]){var p=u[a].indexOf(o);p!==-1&&u[a].splice(p,1)}}var ke=function(o,u){u===void 0&&(u={}),Ve(this,u),this.type=o},nt=function(a){function o(u,p){p===void 0&&(p={}),a.call(this,"error",Ve({error:u},p))}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o}(ke),pt=function(){};pt.prototype.on=function(a,o){return this._listeners=this._listeners||{},le(a,o,this._listeners),this},pt.prototype.off=function(a,o){return ge(a,o,this._listeners),ge(a,o,this._oneTimeListeners),this},pt.prototype.once=function(a,o){return this._oneTimeListeners=this._oneTimeListeners||{},le(a,o,this._oneTimeListeners),this},pt.prototype.fire=function(a,o){typeof a=="string"&&(a=new ke(a,o||{}));var u=a.type;if(this.listens(u)){a.target=this;for(var p=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];p<y.length;p+=1)y[p].call(this,a);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var M=S[b];ge(u,M,this._oneTimeListeners),M.call(this,a)}var D=this._eventedParent;D&&(Ve(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(a))}else a instanceof nt&&console.error(a.error);return this},pt.prototype.listens=function(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)},pt.prototype.setEventedParent=function(a,o){return this._eventedParent=a,this._eventedParentData=o,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ue=function(o,u,p,y){this.message=(o?o+": ":"")+p,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)};function qe(a){var o=a.value;return o?[new Ue(a.key,o,"constants have been deprecated as of v8")]:[]}function Cr(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var p=0,y=o;p<y.length;p+=1){var b=y[p];for(var S in b)a[S]=b[S]}return a}function Tr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function tr(a){if(Array.isArray(a))return a.map(tr);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){var o={};for(var u in a)o[u]=tr(a[u]);return o}return Tr(a)}var Dr=function(a){function o(u,p){a.call(this,p),this.message=p,this.key=u}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o}(Error),nn=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var p=0,y=u;p<y.length;p+=1){var b=y[p];this.bindings[b[0]]=b[1]}};nn.prototype.concat=function(a){return new nn(this,a)},nn.prototype.get=function(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(a+" not found in scope.")},nn.prototype.has=function(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)};var Mn={kind:"null"},rr={kind:"number"},wn={kind:"string"},mn={kind:"boolean"},xn={kind:"color"},w={kind:"object"},An={kind:"value"},Lr={kind:"collator"},Zi={kind:"formatted"},Ti={kind:"resolvedImage"};function Un(a,o){return{kind:"array",itemType:a,N:o}}function Bi(a){if(a.kind==="array"){var o=Bi(a.itemType);return typeof a.N=="number"?"array<"+o+", "+a.N+">":a.itemType.kind==="value"?"array":"array<"+o+">"}return a.kind}var Mo=[Mn,rr,wn,mn,xn,Zi,w,Un(An),Ti];function ra(a,o){if(o.kind==="error")return null;if(a.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!ra(a.itemType,o.itemType))&&(typeof a.N!="number"||a.N===o.N))return null}else{if(a.kind===o.kind)return null;if(a.kind==="value"){for(var u=0,p=Mo;u<p.length;u+=1)if(!ra(p[u],o))return null}}return"Expected "+Bi(a)+" but found "+Bi(o)+" instead."}function to(a,o){return o.some(function(u){return u.kind===a.kind})}function ca(a,o){return o.some(function(u){return u==="null"?a===null:u==="array"?Array.isArray(a):u==="object"?a&&!Array.isArray(a)&&typeof a=="object":u===typeof a})}var ci=U(function(a,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(M){return(M=Math.round(M))<0?0:M>255?255:M}function y(M){return p(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function b(M){return(D=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:D>1?1:D;var D}function S(M,D,B){return B<0?B+=1:B>1&&(B-=1),6*B<1?M+(D-M)*B*6:2*B<1?D:3*B<2?M+(D-M)*(2/3-B)*6:M}try{o.parseCSSColor=function(M){var D,B=M.replace(/ /g,"").toLowerCase();if(B in u)return u[B].slice();if(B[0]==="#")return B.length===4?(D=parseInt(B.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:B.length===7&&(D=parseInt(B.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var Z=B.indexOf("("),q=B.indexOf(")");if(Z!==-1&&q+1===B.length){var ee=B.substr(0,Z),_e=B.substr(Z+1,q-(Z+1)).split(","),Le=1;switch(ee){case"rgba":if(_e.length!==4)return null;Le=b(_e.pop());case"rgb":return _e.length!==3?null:[y(_e[0]),y(_e[1]),y(_e[2]),Le];case"hsla":if(_e.length!==4)return null;Le=b(_e.pop());case"hsl":if(_e.length!==3)return null;var Ie=(parseFloat(_e[0])%360+360)%360/360,Ye=b(_e[1]),Xe=b(_e[2]),gt=Xe<=.5?Xe*(Ye+1):Xe+Ye-Xe*Ye,Dt=2*Xe-gt;return[p(255*S(Dt,gt,Ie+1/3)),p(255*S(Dt,gt,Ie)),p(255*S(Dt,gt,Ie-1/3)),Le];default:return null}}return null}}catch(M){}}).parseCSSColor,bi=function(o,u,p,y){y===void 0&&(y=1),this.r=o,this.g=u,this.b=p,this.a=y};bi.parse=function(a){if(a){if(a instanceof bi)return a;if(typeof a=="string"){var o=ci(a);if(o)return new bi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},bi.prototype.toString=function(){var a=this.toArray(),o=a[1],u=a[2],p=a[3];return"rgba("+Math.round(a[0])+","+Math.round(o)+","+Math.round(u)+","+p+")"},bi.prototype.toArray=function(){var a=this.a;return a===0?[0,0,0,0]:[255*this.r/a,255*this.g/a,255*this.b/a,a]},bi.black=new bi(0,0,0,1),bi.white=new bi(1,1,1,1),bi.transparent=new bi(0,0,0,0),bi.red=new bi(1,0,0,1);var vo=function(o,u,p){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};vo.prototype.compare=function(a,o){return this.collator.compare(a,o)},vo.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var mo=function(o,u,p,y,b){this.text=o,this.image=u,this.scale=p,this.fontStack=y,this.textColor=b},ia=function(o){this.sections=o};ia.fromString=function(a){return new ia([new mo(a,null,null,null,null)])},ia.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(a){return a.text.length!==0||a.image&&a.image.name.length!==0})},ia.factory=function(a){return a instanceof ia?a:ia.fromString(a)},ia.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(a){return a.text}).join("")},ia.prototype.serialize=function(){for(var a=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];if(p.image)a.push(["image",p.image.name]);else{a.push(p.text);var y={};p.fontStack&&(y["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(y["font-scale"]=p.scale),p.textColor&&(y["text-color"]=["rgba"].concat(p.textColor.toArray())),a.push(y)}}return a};var Za=function(o){this.name=o.name,this.available=o.available};function so(a,o,u,p){return typeof a=="number"&&a>=0&&a<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[a,o,u,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[a,o,u,p]:[a,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function bl(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof bi||a instanceof vo||a instanceof ia||a instanceof Za)return!0;if(Array.isArray(a)){for(var o=0,u=a;o<u.length;o+=1)if(!bl(u[o]))return!1;return!0}if(typeof a=="object"){for(var p in a)if(!bl(a[p]))return!1;return!0}return!1}function Ta(a){if(a===null)return Mn;if(typeof a=="string")return wn;if(typeof a=="boolean")return mn;if(typeof a=="number")return rr;if(a instanceof bi)return xn;if(a instanceof vo)return Lr;if(a instanceof ia)return Zi;if(a instanceof Za)return Ti;if(Array.isArray(a)){for(var o,u=a.length,p=0,y=a;p<y.length;p+=1){var b=Ta(y[p]);if(o){if(o===b)continue;o=An;break}o=b}return Un(o||An,u)}return w}function cu(a){var o=typeof a;return a===null?"":o==="string"||o==="number"||o==="boolean"?String(a):a instanceof bi||a instanceof ia||a instanceof Za?a.toString():JSON.stringify(a)}Za.prototype.toString=function(){return this.name},Za.fromString=function(a){return a?new Za({name:a,available:!1}):null},Za.prototype.serialize=function(){return["image",this.name]};var ga=function(o,u){this.type=o,this.value=u};ga.parse=function(a,o){if(a.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(!bl(a[1]))return o.error("invalid value");var u=a[1],p=Ta(u),y=o.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new ga(p,u)},ga.prototype.evaluate=function(){return this.value},ga.prototype.eachChild=function(){},ga.prototype.outputDefined=function(){return!0},ga.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bi?["rgba"].concat(this.value.toArray()):this.value instanceof ia?this.value.serialize():this.value};var Va=function(o){this.name="ExpressionEvaluationError",this.message=o};Va.prototype.toJSON=function(){return this.message};var Co={string:wn,number:rr,boolean:mn,object:w},wa=function(o,u){this.type=o,this.args=u};wa.parse=function(a,o){if(a.length<2)return o.error("Expected at least one argument.");var u,p=1,y=a[0];if(y==="array"){var b,S;if(a.length>2){var M=a[1];if(typeof M!="string"||!(M in Co)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Co[M],p++}else b=An;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=a[2],p++}u=Un(b,S)}else u=Co[y];for(var D=[];p<a.length;p++){var B=o.parse(a[p],p,An);if(!B)return null;D.push(B)}return new wa(u,D)},wa.prototype.evaluate=function(a){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(a);if(!ra(this.type,Ta(u)))return u;if(o===this.args.length-1)throw new Va("Expected value to be of type "+Bi(this.type)+", but found "+Bi(Ta(u))+" instead.")}return null},wa.prototype.eachChild=function(a){this.args.forEach(a)},wa.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},wa.prototype.serialize=function(){var a=this.type,o=[a.kind];if(a.kind==="array"){var u=a.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var p=a.N;(typeof p=="number"||this.args.length>1)&&o.push(p)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var qo=function(o){this.type=Zi,this.sections=o};qo.parse=function(a,o){if(a.length<2)return o.error("Expected at least one argument.");var u=a[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var p=[],y=!1,b=1;b<=a.length-1;++b){var S=a[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var M=null;if(S["font-scale"]&&!(M=o.parse(S["font-scale"],1,rr)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Un(wn))))return null;var B=null;if(S["text-color"]&&!(B=o.parse(S["text-color"],1,xn)))return null;var Z=p[p.length-1];Z.scale=M,Z.font=D,Z.textColor=B}else{var q=o.parse(a[b],1,An);if(!q)return null;var ee=q.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:q,scale:null,font:null,textColor:null})}}return new qo(p)},qo.prototype.evaluate=function(a){return new ia(this.sections.map(function(o){var u=o.content.evaluate(a);return Ta(u)===Ti?new mo("",u,null,null,null):new mo(cu(u),null,o.scale?o.scale.evaluate(a):null,o.font?o.font.evaluate(a).join(","):null,o.textColor?o.textColor.evaluate(a):null)}))},qo.prototype.eachChild=function(a){for(var o=0,u=this.sections;o<u.length;o+=1){var p=u[o];a(p.content),p.scale&&a(p.scale),p.font&&a(p.font),p.textColor&&a(p.textColor)}},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){for(var a=["format"],o=0,u=this.sections;o<u.length;o+=1){var p=u[o];a.push(p.content.serialize());var y={};p.scale&&(y["font-scale"]=p.scale.serialize()),p.font&&(y["text-font"]=p.font.serialize()),p.textColor&&(y["text-color"]=p.textColor.serialize()),a.push(y)}return a};var wo=function(o){this.type=Ti,this.input=o};wo.parse=function(a,o){if(a.length!==2)return o.error("Expected two arguments.");var u=o.parse(a[1],1,wn);return u?new wo(u):o.error("No image name provided.")},wo.prototype.evaluate=function(a){var o=this.input.evaluate(a),u=Za.fromString(o);return u&&a.availableImages&&(u.available=a.availableImages.indexOf(o)>-1),u},wo.prototype.eachChild=function(a){a(this.input)},wo.prototype.outputDefined=function(){return!1},wo.prototype.serialize=function(){return["image",this.input.serialize()]};var jo={"to-boolean":mn,"to-color":xn,"to-number":rr,"to-string":wn},ya=function(o,u){this.type=o,this.args=u};ya.parse=function(a,o){if(a.length<2)return o.error("Expected at least one argument.");var u=a[0];if((u==="to-boolean"||u==="to-string")&&a.length!==2)return o.error("Expected one argument.");for(var p=jo[u],y=[],b=1;b<a.length;b++){var S=o.parse(a[b],b,An);if(!S)return null;y.push(S)}return new ya(p,y)},ya.prototype.evaluate=function(a){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(a));if(this.type.kind==="color"){for(var o,u,p=0,y=this.args;p<y.length;p+=1){if(u=null,(o=y[p].evaluate(a))instanceof bi)return o;if(typeof o=="string"){var b=a.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":so(o[0],o[1],o[2],o[3])))return new bi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Va(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,D=this.args;M<D.length;M+=1){if((S=D[M].evaluate(a))===null)return 0;var B=Number(S);if(!isNaN(B))return B}throw new Va("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?ia.fromString(cu(this.args[0].evaluate(a))):this.type.kind==="resolvedImage"?Za.fromString(cu(this.args[0].evaluate(a))):cu(this.args[0].evaluate(a))},ya.prototype.eachChild=function(a){this.args.forEach(a)},ya.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},ya.prototype.serialize=function(){if(this.type.kind==="formatted")return new qo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new wo(this.args[0]).serialize();var a=["to-"+this.type.kind];return this.eachChild(function(o){a.push(o.serialize())}),a};var Nl=["Unknown","Point","LineString","Polygon"],ls=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ls.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ls.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Nl[this.feature.type]:this.feature.type:null},ls.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ls.prototype.canonicalID=function(){return this.canonical},ls.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ls.prototype.parseColor=function(a){var o=this._parseColorCache[a];return o||(o=this._parseColorCache[a]=bi.parse(a)),o};var uo=function(o,u,p,y){this.name=o,this.type=u,this._evaluate=p,this.args=y};uo.prototype.evaluate=function(a){return this._evaluate(a,this.args)},uo.prototype.eachChild=function(a){this.args.forEach(a)},uo.prototype.outputDefined=function(){return!1},uo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(a){return a.serialize()}))},uo.parse=function(a,o){var u,p=a[0],y=uo.definitions[p];if(!y)return o.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,M=S.filter(function(Qn){var Nn=Qn[0];return!Array.isArray(Nn)||Nn.length===a.length-1}),D=null,B=0,Z=M;B<Z.length;B+=1){var q=Z[B],ee=q[0],_e=q[1];D=new nl(o.registry,o.path,null,o.scope);for(var Le=[],Ie=!1,Ye=1;Ye<a.length;Ye++){var Xe=a[Ye],gt=Array.isArray(ee)?ee[Ye-1]:ee.type,Dt=D.parse(Xe,1+Le.length,gt);if(!Dt){Ie=!0;break}Le.push(Dt)}if(!Ie)if(Array.isArray(ee)&&ee.length!==Le.length)D.error("Expected "+ee.length+" arguments, but found "+Le.length+" instead.");else{for(var Xt=0;Xt<Le.length;Xt++){var yr=Array.isArray(ee)?ee[Xt]:ee.type,or=Le[Xt];D.concat(Xt+1).checkSubtype(yr,or.type)}if(D.errors.length===0)return new uo(p,b,_e,Le)}}if(M.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Jr=(M.length?M:S).map(function(Qn){var Nn;return Nn=Qn[0],Array.isArray(Nn)?"("+Nn.map(Bi).join(", ")+")":"("+Bi(Nn.type)+"...)"}).join(" | "),tn=[],Gn=1;Gn<a.length;Gn++){var ti=o.parse(a[Gn],1+tn.length);if(!ti)return null;tn.push(Bi(ti.type))}o.error("Expected arguments of type "+Jr+", but found ("+tn.join(", ")+") instead.")}return null},uo.register=function(a,o){for(var u in uo.definitions=o,o)a[u]=uo};var $s=function(o,u,p){this.type=Lr,this.locale=p,this.caseSensitive=o,this.diacriticSensitive=u};function Lo(a,o){a[0]=Math.min(a[0],o[0]),a[1]=Math.min(a[1],o[1]),a[2]=Math.max(a[2],o[0]),a[3]=Math.max(a[3],o[1])}function go(a,o){return!(a[0]<=o[0]||a[2]>=o[2]||a[1]<=o[1]||a[3]>=o[3])}function We(a,o){var u=(180+a[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(p*y*8192)]}function se(a,o,u){return o[1]>a[1]!=u[1]>a[1]&&a[0]<(u[0]-o[0])*(a[1]-o[1])/(u[1]-o[1])+o[0]}function Be(a,o){for(var u,p,y,b,S,M,D,B=!1,Z=0,q=o.length;Z<q;Z++)for(var ee=o[Z],_e=0,Le=ee.length;_e<Le-1;_e++){if((b=(u=a)[0]-(p=ee[_e])[0])*(D=u[1]-(y=ee[_e+1])[1])-(M=u[0]-y[0])*(S=u[1]-p[1])==0&&b*M<=0&&S*D<=0)return!1;se(a,ee[_e],ee[_e+1])&&(B=!B)}return B}function Rt(a,o){for(var u=0;u<o.length;u++)if(Be(a,o[u]))return!0;return!1}function Zr(a,o,u,p){var y=p[0]-u[0],b=p[1]-u[1],S=(a[0]-u[0])*b-y*(a[1]-u[1]),M=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&M<0||S<0&&M>0}function kn(a,o,u){for(var p=0,y=u;p<y.length;p+=1)for(var b=y[p],S=0;S<b.length-1;++S)if((q=[(Z=b[S+1])[0]-(B=b[S])[0],Z[1]-B[1]])[0]*(ee=[(D=o)[0]-(M=a)[0],D[1]-M[1]])[1]-q[1]*ee[0]!=0&&Zr(M,D,B,Z)&&Zr(B,Z,M,D))return!0;var M,D,B,Z,q,ee;return!1}function Ni(a,o){for(var u=0;u<a.length;++u)if(!Be(a[u],o))return!1;for(var p=0;p<a.length-1;++p)if(kn(a[p],a[p+1],o))return!1;return!0}function Na(a,o){for(var u=0;u<o.length;u++)if(Ni(a,o[u]))return!0;return!1}function Ma(a,o,u){for(var p=[],y=0;y<a.length;y++){for(var b=[],S=0;S<a[y].length;S++){var M=We(a[y][S],u);Lo(o,M),b.push(M)}p.push(b)}return p}function Xa(a,o,u){for(var p=[],y=0;y<a.length;y++){var b=Ma(a[y],o,u);p.push(b)}return p}function Do(a,o,u,p){if(a[0]<u[0]||a[0]>u[2]){var y=.5*p,b=a[0]-u[0]>y?-p:u[0]-a[0]>y?p:0;b===0&&(b=a[0]-u[2]>y?-p:u[2]-a[0]>y?p:0),a[0]+=b}Lo(o,a)}function $c(a,o,u,p){for(var y=8192*Math.pow(2,p.z),b=[8192*p.x,8192*p.y],S=[],M=0,D=a;M<D.length;M+=1)for(var B=0,Z=D[M];B<Z.length;B+=1){var q=Z[B],ee=[q.x+b[0],q.y+b[1]];Do(ee,o,u,y),S.push(ee)}return S}function Ks(a,o,u,p){for(var y,b=8192*Math.pow(2,p.z),S=[8192*p.x,8192*p.y],M=[],D=0,B=a;D<B.length;D+=1){for(var Z=[],q=0,ee=B[D];q<ee.length;q+=1){var _e=ee[q],Le=[_e.x+S[0],_e.y+S[1]];Lo(o,Le),Z.push(Le)}M.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Ie=0,Ye=M;Ie<Ye.length;Ie+=1)for(var Xe=0,gt=Ye[Ie];Xe<gt.length;Xe+=1)Do(gt[Xe],o,u,b)}return M}$s.parse=function(a,o){if(a.length!==2)return o.error("Expected one argument.");var u=a[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var p=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,mn);if(!p)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,mn);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,wn))?null:new $s(p,y,b)},$s.prototype.evaluate=function(a){return new vo(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)},$s.prototype.eachChild=function(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)},$s.prototype.outputDefined=function(){return!1},$s.prototype.serialize=function(){var a={};return a["case-sensitive"]=this.caseSensitive.serialize(),a["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(a.locale=this.locale.serialize()),["collator",a]};var Qo=function(o,u){this.type=mn,this.geojson=o,this.geometries=u};function Vo(a){if(a instanceof uo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Qo)return!1;var o=!0;return a.eachChild(function(u){o&&!Vo(u)&&(o=!1)}),o}function qs(a){if(a instanceof uo&&a.name==="feature-state")return!1;var o=!0;return a.eachChild(function(u){o&&!qs(u)&&(o=!1)}),o}function gu(a,o){if(a instanceof uo&&o.indexOf(a.name)>=0)return!1;var u=!0;return a.eachChild(function(p){u&&!gu(p,o)&&(u=!1)}),u}Qo.parse=function(a,o){if(a.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(a.length-1)+" instead.");if(bl(a[1])){var u=a[1];if(u.type==="FeatureCollection")for(var p=0;p<u.features.length;++p){var y=u.features[p].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Qo(u,u.features[p].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Qo(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Qo(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Qo.prototype.evaluate=function(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ma(u.coordinates,y,b),M=$c(o.geometry(),p,y,b);if(!go(p,y))return!1;for(var D=0,B=M;D<B.length;D+=1)if(!Be(B[D],S))return!1}if(u.type==="MultiPolygon"){var Z=Xa(u.coordinates,y,b),q=$c(o.geometry(),p,y,b);if(!go(p,y))return!1;for(var ee=0,_e=q;ee<_e.length;ee+=1)if(!Rt(_e[ee],Z))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(o,u){var p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Ma(u.coordinates,y,b),M=Ks(o.geometry(),p,y,b);if(!go(p,y))return!1;for(var D=0,B=M;D<B.length;D+=1)if(!Ni(B[D],S))return!1}if(u.type==="MultiPolygon"){var Z=Xa(u.coordinates,y,b),q=Ks(o.geometry(),p,y,b);if(!go(p,y))return!1;for(var ee=0,_e=q;ee<_e.length;ee+=1)if(!Na(_e[ee],Z))return!1}return!0}(a,this.geometries)}return!1},Qo.prototype.eachChild=function(){},Qo.prototype.outputDefined=function(){return!0},Qo.prototype.serialize=function(){return["within",this.geojson]};var Vs=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};Vs.parse=function(a,o){if(a.length!==2||typeof a[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=a[1];return o.scope.has(u)?new Vs(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Vs.prototype.evaluate=function(a){return this.boundExpression.evaluate(a)},Vs.prototype.eachChild=function(){},Vs.prototype.outputDefined=function(){return!1},Vs.prototype.serialize=function(){return["var",this.name]};var nl=function(o,u,p,y,b){u===void 0&&(u=[]),y===void 0&&(y=new nn),b===void 0&&(b=[]),this.registry=o,this.path=u,this.key=u.map(function(S){return"["+S+"]"}).join(""),this.scope=y,this.errors=b,this.expectedType=p};function Qs(a,o){for(var u,p=a.length-1,y=0,b=p,S=0;y<=b;)if((u=a[S=Math.floor((y+b)/2)])<=o){if(S===p||o<a[S+1])return S;y=S+1}else{if(!(u>o))throw new Va("Input is not a number.");b=S-1}return 0}nl.prototype.parse=function(a,o,u,p,y){return y===void 0&&(y={}),o?this.concat(o,u,p)._parse(a,y):this._parse(a,y)},nl.prototype._parse=function(a,o){function u(B,Z,q){return q==="assert"?new wa(Z,[B]):q==="coerce"?new ya(Z,[B]):B}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=a[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[p];if(y){var b=y.parse(a,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,M=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof ga)&&b.type.kind!=="resolvedImage"&&function B(Z){if(Z instanceof Vs)return B(Z.boundExpression);if(Z instanceof uo&&Z.name==="error"||Z instanceof $s||Z instanceof Qo)return!1;var q=Z instanceof ya||Z instanceof wa,ee=!0;return Z.eachChild(function(_e){ee=q?ee&&B(_e):ee&&_e instanceof ga}),!!ee&&Vo(Z)&&gu(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new ls;try{b=new ga(b.type,b.evaluate(D))}catch(B){return this.error(B.message),null}}return b}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof a+" instead.")},nl.prototype.concat=function(a,o,u){var p=typeof a=="number"?this.path.concat(a):this.path,y=u?this.scope.concat(u):this.scope;return new nl(this.registry,p,o||null,y,this.errors)},nl.prototype.error=function(a){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var p=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new Dr(p,a))},nl.prototype.checkSubtype=function(a,o){var u=ra(a,o);return u&&this.error(u),u};var Ga=function(o,u,p){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var y=0,b=p;y<b.length;y+=1){var S=b[y],M=S[1];this.labels.push(S[0]),this.outputs.push(M)}};function Ya(a,o,u){return a*(1-u)+o*u}Ga.parse=function(a,o){if(a.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(a[1],1,rr);if(!u)return null;var p=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<a.length;b+=2){var S=b===1?-1/0:a[b],M=a[b+1],D=b,B=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(p.length&&p[p.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var Z=o.parse(M,B,y);if(!Z)return null;y=y||Z.type,p.push([S,Z])}return new Ga(y,u,p)},Ga.prototype.evaluate=function(a){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(a);var p=this.input.evaluate(a);if(p<=o[0])return u[0].evaluate(a);var y=o.length;return p>=o[y-1]?u[y-1].evaluate(a):u[Qs(o,p)].evaluate(a)},Ga.prototype.eachChild=function(a){a(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)a(u[o])},Ga.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ga.prototype.serialize=function(){for(var a=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&a.push(this.labels[o]),a.push(this.outputs[o].serialize());return a};var El=Object.freeze({__proto__:null,number:Ya,color:function(o,u,p){return new bi(Ya(o.r,u.r,p),Ya(o.g,u.g,p),Ya(o.b,u.b,p),Ya(o.a,u.a,p))},array:function(o,u,p){return o.map(function(y,b){return Ya(y,u[b],p)})}}),yu=6/29*3*(6/29),kh=Math.PI/180,Kc=180/Math.PI;function ec(a){return a>.008856451679035631?Math.pow(a,1/3):a/yu+4/29}function _u(a){return a>6/29?a*a*a:yu*(a-4/29)}function bc(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function _(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function P(a){var o=_(a.r),u=_(a.g),p=_(a.b),y=ec((.4124564*o+.3575761*u+.1804375*p)/.95047),b=ec((.2126729*o+.7151522*u+.072175*p)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-ec((.0193339*o+.119192*u+.9503041*p)/1.08883)),alpha:a.a}}function z(a){var o=(a.l+16)/116,u=isNaN(a.a)?o:o+a.a/500,p=isNaN(a.b)?o:o-a.b/200;return o=1*_u(o),u=.95047*_u(u),p=1.08883*_u(p),new bi(bc(3.2404542*u-1.5371385*o-.4985314*p),bc(-.969266*u+1.8760108*o+.041556*p),bc(.0556434*u-.2040259*o+1.0572252*p),a.alpha)}function L(a,o,u){var p=o-a;return a+u*(p>180||p<-180?p-360*Math.round(p/360):p)}var te={forward:P,reverse:z,interpolate:function(o,u,p){return{l:Ya(o.l,u.l,p),a:Ya(o.a,u.a,p),b:Ya(o.b,u.b,p),alpha:Ya(o.alpha,u.alpha,p)}}},Ce={forward:function(o){var u=P(o),p=u.l,y=u.a,b=u.b,S=Math.atan2(b,y)*Kc;return{h:S<0?S+360:S,c:Math.sqrt(y*y+b*b),l:p,alpha:o.a}},reverse:function(o){var u=o.h*kh,p=o.c;return z({l:o.l,a:Math.cos(u)*p,b:Math.sin(u)*p,alpha:o.alpha})},interpolate:function(o,u,p){return{h:L(o.h,u.h,p),c:Ya(o.c,u.c,p),l:Ya(o.l,u.l,p),alpha:Ya(o.alpha,u.alpha,p)}}},rt=Object.freeze({__proto__:null,lab:te,hcl:Ce}),Ct=function(o,u,p,y,b){this.type=o,this.operator=u,this.interpolation=p,this.input=y,this.labels=[],this.outputs=[];for(var S=0,M=b;S<M.length;S+=1){var D=M[S],B=D[1];this.labels.push(D[0]),this.outputs.push(B)}};function ft(a,o,u,p){var y=p-u,b=a-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}Ct.interpolationFactor=function(a,o,u,p){var y=0;if(a.name==="exponential")y=ft(o,a.base,u,p);else if(a.name==="linear")y=ft(o,1,u,p);else if(a.name==="cubic-bezier"){var b=a.controlPoints;y=new G(b[0],b[1],b[2],b[3]).solve(ft(o,1,u,p))}return y},Ct.parse=function(a,o){var u=a[0],p=a[1],y=a[2],b=a.slice(3);if(!Array.isArray(p)||p.length===0)return o.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var S=p[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(p[0]),1,0);var M=p.slice(1);if(M.length!==4||M.some(function(Ye){return typeof Ye!="number"||Ye<0||Ye>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:M}}if(a.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if((a.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,rr)))return null;var D=[],B=null;u==="interpolate-hcl"||u==="interpolate-lab"?B=xn:o.expectedType&&o.expectedType.kind!=="value"&&(B=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var q=b[Z],ee=b[Z+1],_e=Z+3,Le=Z+4;if(typeof q!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(D.length&&D[D.length-1][0]>=q)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var Ie=o.parse(ee,Le,B);if(!Ie)return null;B=B||Ie.type,D.push([q,Ie])}return B.kind==="number"||B.kind==="color"||B.kind==="array"&&B.itemType.kind==="number"&&typeof B.N=="number"?new Ct(B,u,p,y,D):o.error("Type "+Bi(B)+" is not interpolatable.")},Ct.prototype.evaluate=function(a){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(a);var p=this.input.evaluate(a);if(p<=o[0])return u[0].evaluate(a);var y=o.length;if(p>=o[y-1])return u[y-1].evaluate(a);var b=Qs(o,p),S=Ct.interpolationFactor(this.interpolation,p,o[b],o[b+1]),M=u[b].evaluate(a),D=u[b+1].evaluate(a);return this.operator==="interpolate"?El[this.type.kind.toLowerCase()](M,D,S):this.operator==="interpolate-hcl"?Ce.reverse(Ce.interpolate(Ce.forward(M),Ce.forward(D),S)):te.reverse(te.interpolate(te.forward(M),te.forward(D),S))},Ct.prototype.eachChild=function(a){a(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)a(u[o])},Ct.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})},Ct.prototype.serialize=function(){var a;a=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,a,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var Sr=function(o,u){this.type=o,this.args=u};Sr.parse=function(a,o){if(a.length<2)return o.error("Expectected at least one argument.");var u=null,p=o.expectedType;p&&p.kind!=="value"&&(u=p);for(var y=[],b=0,S=a.slice(1);b<S.length;b+=1){var M=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,y.push(M)}var D=p&&y.some(function(B){return ra(p,B.type)});return new Sr(D?An:u,y)},Sr.prototype.evaluate=function(a){for(var o,u=null,p=0,y=0,b=this.args;y<b.length&&(p++,(u=b[y].evaluate(a))&&u instanceof Za&&!u.available&&(o||(o=u.name),u=null,p===this.args.length&&(u=o)),u===null);y+=1);return u},Sr.prototype.eachChild=function(a){this.args.forEach(a)},Sr.prototype.outputDefined=function(){return this.args.every(function(a){return a.outputDefined()})},Sr.prototype.serialize=function(){var a=["coalesce"];return this.eachChild(function(o){a.push(o.serialize())}),a};var kr=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};kr.prototype.evaluate=function(a){return this.result.evaluate(a)},kr.prototype.eachChild=function(a){for(var o=0,u=this.bindings;o<u.length;o+=1)a(u[o][1]);a(this.result)},kr.parse=function(a,o){if(a.length<4)return o.error("Expected at least 3 arguments, but found "+(a.length-1)+" instead.");for(var u=[],p=1;p<a.length-1;p+=2){var y=a[p];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",p);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);var b=o.parse(a[p+1],p+1);if(!b)return null;u.push([y,b])}var S=o.parse(a[a.length-1],a.length-1,o.expectedType,u);return S?new kr(u,S):null},kr.prototype.outputDefined=function(){return this.result.outputDefined()},kr.prototype.serialize=function(){for(var a=["let"],o=0,u=this.bindings;o<u.length;o+=1){var p=u[o];a.push(p[0],p[1].serialize())}return a.push(this.result.serialize()),a};var ni=function(o,u,p){this.type=o,this.index=u,this.input=p};ni.parse=function(a,o){if(a.length!==3)return o.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var u=o.parse(a[1],1,rr),p=o.parse(a[2],2,Un(o.expectedType||An));return u&&p?new ni(p.type.itemType,u,p):null},ni.prototype.evaluate=function(a){var o=this.index.evaluate(a),u=this.input.evaluate(a);if(o<0)throw new Va("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Va("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Va("Array index must be an integer, but found "+o+" instead.");return u[o]},ni.prototype.eachChild=function(a){a(this.index),a(this.input)},ni.prototype.outputDefined=function(){return!1},ni.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var xi=function(o,u){this.type=mn,this.needle=o,this.haystack=u};xi.parse=function(a,o){if(a.length!==3)return o.error("Expected 2 arguments, but found "+(a.length-1)+" instead.");var u=o.parse(a[1],1,An),p=o.parse(a[2],2,An);return u&&p?to(u.type,[mn,wn,rr,Mn,An])?new xi(u,p):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Bi(u.type)+" instead"):null},xi.prototype.evaluate=function(a){var o=this.needle.evaluate(a),u=this.haystack.evaluate(a);if(!u)return!1;if(!ca(o,["boolean","string","number","null"]))throw new Va("Expected first argument to be of type boolean, string, number or null, but found "+Bi(Ta(o))+" instead.");if(!ca(u,["string","array"]))throw new Va("Expected second argument to be of type array or string, but found "+Bi(Ta(u))+" instead.");return u.indexOf(o)>=0},xi.prototype.eachChild=function(a){a(this.needle),a(this.haystack)},xi.prototype.outputDefined=function(){return!0},xi.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var gi=function(o,u,p){this.type=rr,this.needle=o,this.haystack=u,this.fromIndex=p};gi.parse=function(a,o){if(a.length<=2||a.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var u=o.parse(a[1],1,An),p=o.parse(a[2],2,An);if(!u||!p)return null;if(!to(u.type,[mn,wn,rr,Mn,An]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Bi(u.type)+" instead");if(a.length===4){var y=o.parse(a[3],3,rr);return y?new gi(u,p,y):null}return new gi(u,p)},gi.prototype.evaluate=function(a){var o=this.needle.evaluate(a),u=this.haystack.evaluate(a);if(!ca(o,["boolean","string","number","null"]))throw new Va("Expected first argument to be of type boolean, string, number or null, but found "+Bi(Ta(o))+" instead.");if(!ca(u,["string","array"]))throw new Va("Expected second argument to be of type array or string, but found "+Bi(Ta(u))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(a);return u.indexOf(o,p)}return u.indexOf(o)},gi.prototype.eachChild=function(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)},gi.prototype.outputDefined=function(){return!1},gi.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var a=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),a]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var dt=function(o,u,p,y,b,S){this.inputType=o,this.type=u,this.input=p,this.cases=y,this.outputs=b,this.otherwise=S};dt.parse=function(a,o){if(a.length<5)return o.error("Expected at least 4 arguments, but found only "+(a.length-1)+".");if(a.length%2!=1)return o.error("Expected an even number of arguments.");var u,p;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(var y={},b=[],S=2;S<a.length-1;S+=2){var M=a[S],D=a[S+1];Array.isArray(M)||(M=[M]);var B=o.concat(S);if(M.length===0)return B.error("Expected at least one branch label.");for(var Z=0,q=M;Z<q.length;Z+=1){var ee=q[Z];if(typeof ee!="number"&&typeof ee!="string")return B.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return B.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return B.error("Numeric branch labels must be integer values.");if(u){if(B.checkSubtype(u,Ta(ee)))return null}else u=Ta(ee);if(y[String(ee)]!==void 0)return B.error("Branch labels must be unique.");y[String(ee)]=b.length}var _e=o.parse(D,S,p);if(!_e)return null;p=p||_e.type,b.push(_e)}var Le=o.parse(a[1],1,An);if(!Le)return null;var Ie=o.parse(a[a.length-1],a.length-1,p);return Ie?Le.type.kind!=="value"&&o.concat(1).checkSubtype(u,Le.type)?null:new dt(u,p,Le,y,b,Ie):null},dt.prototype.evaluate=function(a){var o=this.input.evaluate(a);return(Ta(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(a)},dt.prototype.eachChild=function(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)},dt.prototype.outputDefined=function(){return this.outputs.every(function(a){return a.outputDefined()})&&this.otherwise.outputDefined()},dt.prototype.serialize=function(){for(var a=this,o=["match",this.input.serialize()],u=[],p={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(q=p[this.cases[S]])===void 0?(p[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[q][1].push(S)}for(var M=function(Le){return a.inputType.kind==="number"?Number(Le):Le},D=0,B=u;D<B.length;D+=1){var Z=B[D],q=Z[0],ee=Z[1];o.push(ee.length===1?M(ee[0]):ee.map(M)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var ua=function(o,u,p){this.type=o,this.branches=u,this.otherwise=p};ua.parse=function(a,o){if(a.length<4)return o.error("Expected at least 3 arguments, but found only "+(a.length-1)+".");if(a.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var p=[],y=1;y<a.length-1;y+=2){var b=o.parse(a[y],y,mn);if(!b)return null;var S=o.parse(a[y+1],y+1,u);if(!S)return null;p.push([b,S]),u=u||S.type}var M=o.parse(a[a.length-1],a.length-1,u);return M?new ua(u,p,M):null},ua.prototype.evaluate=function(a){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];if(p[0].evaluate(a))return y.evaluate(a)}return this.otherwise.evaluate(a)},ua.prototype.eachChild=function(a){for(var o=0,u=this.branches;o<u.length;o+=1){var p=u[o],y=p[1];a(p[0]),a(y)}a(this.otherwise)},ua.prototype.outputDefined=function(){return this.branches.every(function(a){return a[1].outputDefined()})&&this.otherwise.outputDefined()},ua.prototype.serialize=function(){var a=["case"];return this.eachChild(function(o){a.push(o.serialize())}),a};var yt=function(o,u,p,y){this.type=o,this.input=u,this.beginIndex=p,this.endIndex=y};function fu(a,o){return a==="=="||a==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ha(a,o,u,p){return p.compare(o,u)===0}function fa(a,o,u){var p=a!=="=="&&a!=="!=";return function(){function y(b,S,M){this.type=mn,this.lhs=b,this.rhs=S,this.collator=M,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var M=b[0],D=S.parse(b[1],1,An);if(!D)return null;if(!fu(M,D.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+Bi(D.type)+"'.");var B=S.parse(b[2],2,An);if(!B)return null;if(!fu(M,B.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+Bi(B.type)+"'.");if(D.type.kind!==B.type.kind&&D.type.kind!=="value"&&B.type.kind!=="value")return S.error("Cannot compare types '"+Bi(D.type)+"' and '"+Bi(B.type)+"'.");p&&(D.type.kind==="value"&&B.type.kind!=="value"?D=new wa(B.type,[D]):D.type.kind!=="value"&&B.type.kind==="value"&&(B=new wa(D.type,[B])));var Z=null;if(b.length===4){if(D.type.kind!=="string"&&B.type.kind!=="string"&&D.type.kind!=="value"&&B.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,Lr)))return null}return new y(D,B,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),M=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){var D=Ta(S),B=Ta(M);if(D.kind!==B.kind||D.kind!=="string"&&D.kind!=="number")throw new Va('Expected arguments for "'+a+'" to be (string, string) or (number, number), but found ('+D.kind+", "+B.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var Z=Ta(S),q=Ta(M);if(Z.kind!=="string"||q.kind!=="string")return o(b,S,M)}return this.collator?u(b,S,M,this.collator.evaluate(b)):o(b,S,M)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[a];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}yt.parse=function(a,o){if(a.length<=2||a.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(a.length-1)+" instead.");var u=o.parse(a[1],1,An),p=o.parse(a[2],2,rr);if(!u||!p)return null;if(!to(u.type,[Un(An),wn,An]))return o.error("Expected first argument to be of type array or string, but found "+Bi(u.type)+" instead");if(a.length===4){var y=o.parse(a[3],3,rr);return y?new yt(u.type,u,p,y):null}return new yt(u.type,u,p)},yt.prototype.evaluate=function(a){var o=this.input.evaluate(a),u=this.beginIndex.evaluate(a);if(!ca(o,["string","array"]))throw new Va("Expected first argument to be of type array or string, but found "+Bi(Ta(o))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(a);return o.slice(u,p)}return o.slice(u)},yt.prototype.eachChild=function(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)},yt.prototype.outputDefined=function(){return!1},yt.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var a=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),a]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Sl=fa("==",function(a,o,u){return o===u},Ha),Ec=fa("!=",function(a,o,u){return o!==u},function(a,o,u,p){return!Ha(0,o,u,p)}),bn=fa("<",function(a,o,u){return o<u},function(a,o,u,p){return p.compare(o,u)<0}),qc=fa(">",function(a,o,u){return o>u},function(a,o,u,p){return p.compare(o,u)>0}),In=fa("<=",function(a,o,u){return o<=u},function(a,o,u,p){return p.compare(o,u)<=0}),Rf=fa(">=",function(a,o,u){return o>=u},function(a,o,u,p){return p.compare(o,u)>=0}),Lt=function(o,u,p,y,b){this.type=wn,this.number=o,this.locale=u,this.currency=p,this.minFractionDigits=y,this.maxFractionDigits=b};Lt.parse=function(a,o){if(a.length!==3)return o.error("Expected two arguments.");var u=o.parse(a[1],1,rr);if(!u)return null;var p=a[2];if(typeof p!="object"||Array.isArray(p))return o.error("NumberFormat options argument must be an object.");var y=null;if(p.locale&&!(y=o.parse(p.locale,1,wn)))return null;var b=null;if(p.currency&&!(b=o.parse(p.currency,1,wn)))return null;var S=null;if(p["min-fraction-digits"]&&!(S=o.parse(p["min-fraction-digits"],1,rr)))return null;var M=null;return p["max-fraction-digits"]&&!(M=o.parse(p["max-fraction-digits"],1,rr))?null:new Lt(u,y,b,S,M)},Lt.prototype.evaluate=function(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))},Lt.prototype.eachChild=function(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)},Lt.prototype.outputDefined=function(){return!1},Lt.prototype.serialize=function(){var a={};return this.locale&&(a.locale=this.locale.serialize()),this.currency&&(a.currency=this.currency.serialize()),this.minFractionDigits&&(a["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(a["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),a]};var Ca=function(o){this.type=rr,this.input=o};Ca.parse=function(a,o){if(a.length!==2)return o.error("Expected 1 argument, but found "+(a.length-1)+" instead.");var u=o.parse(a[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Bi(u.type)+" instead."):new Ca(u):null},Ca.prototype.evaluate=function(a){var o=this.input.evaluate(a);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Va("Expected value to be of type string or array, but found "+Bi(Ta(o))+" instead.")},Ca.prototype.eachChild=function(a){a(this.input)},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){var a=["length"];return this.eachChild(function(o){a.push(o.serialize())}),a};var zl={"==":Sl,"!=":Ec,">":qc,"<":bn,">=":Rf,"<=":In,array:wa,at:ni,boolean:wa,case:ua,coalesce:Sr,collator:$s,format:qo,image:wo,in:xi,"index-of":gi,interpolate:Ct,"interpolate-hcl":Ct,"interpolate-lab":Ct,length:Ca,let:kr,literal:ga,match:dt,number:wa,"number-format":Lt,object:wa,slice:yt,step:Ga,string:wa,"to-boolean":ya,"to-color":ya,"to-number":ya,"to-string":ya,var:Vs,within:Qo};function ue(a,o){var u=o[0],p=o[1],y=o[2],b=o[3];u=u.evaluate(a),p=p.evaluate(a),y=y.evaluate(a);var S=b?b.evaluate(a):1,M=so(u,p,y,S);if(M)throw new Va(M);return new bi(u/255*S,p/255*S,y/255*S,S)}function Du(a,o){return a in o}function Qc(a,o){var u=o[a];return u===void 0?null:u}function Fu(a){return{type:a}}function xu(a){return{result:"success",value:a}}function Bu(a){return{result:"error",value:a}}function il(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Sc(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Cl(a){return!!a.expression&&a.expression.interpolated}function ka(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Cc(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function sh(a){return a}function wc(a,o,u){return a!==void 0?a:o!==void 0?o:u!==void 0?u:void 0}function kf(a,o,u,p,y){return wc(typeof u===y?p[u]:void 0,a.default,o.default)}function uh(a,o,u){if(ka(u)!=="number")return wc(a.default,o.default);var p=a.stops.length;if(p===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[p-1][0])return a.stops[p-1][1];var y=Qs(a.stops.map(function(b){return b[0]}),u);return a.stops[y][1]}function Lf(a,o,u){var p=a.base!==void 0?a.base:1;if(ka(u)!=="number")return wc(a.default,o.default);var y=a.stops.length;if(y===1||u<=a.stops[0][0])return a.stops[0][1];if(u>=a.stops[y-1][0])return a.stops[y-1][1];var b=Qs(a.stops.map(function(q){return q[0]}),u),S=function(q,ee,_e,Le){var Ie=Le-_e,Ye=q-_e;return Ie===0?0:ee===1?Ye/Ie:(Math.pow(ee,Ye)-1)/(Math.pow(ee,Ie)-1)}(u,p,a.stops[b][0],a.stops[b+1][0]),M=a.stops[b][1],D=a.stops[b+1][1],B=El[o.type]||sh;if(a.colorSpace&&a.colorSpace!=="rgb"){var Z=rt[a.colorSpace];B=function(ee,_e){return Z.reverse(Z.interpolate(Z.forward(ee),Z.forward(_e),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var ee=[],_e=arguments.length;_e--;)ee[_e]=arguments[_e];var Le=M.evaluate.apply(void 0,ee),Ie=D.evaluate.apply(void 0,ee);if(Le!==void 0&&Ie!==void 0)return B(Le,Ie,S)}}:B(M,D,S)}function Ul(a,o,u){return o.type==="color"?u=bi.parse(u):o.type==="formatted"?u=ia.fromString(u.toString()):o.type==="resolvedImage"?u=Za.fromString(u.toString()):ka(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),wc(u,a.default,o.default)}uo.register(zl,{error:[{kind:"error"},[wn],function(a,o){throw new Va(o[0].evaluate(a))}],typeof:[wn,[An],function(a,o){return Bi(Ta(o[0].evaluate(a)))}],"to-rgba":[Un(rr,4),[xn],function(a,o){return o[0].evaluate(a).toArray()}],rgb:[xn,[rr,rr,rr],ue],rgba:[xn,[rr,rr,rr,rr],ue],has:{type:mn,overloads:[[[wn],function(a,o){return Du(o[0].evaluate(a),a.properties())}],[[wn,w],function(a,o){var u=o[1];return Du(o[0].evaluate(a),u.evaluate(a))}]]},get:{type:An,overloads:[[[wn],function(a,o){return Qc(o[0].evaluate(a),a.properties())}],[[wn,w],function(a,o){var u=o[1];return Qc(o[0].evaluate(a),u.evaluate(a))}]]},"feature-state":[An,[wn],function(a,o){return Qc(o[0].evaluate(a),a.featureState||{})}],properties:[w,[],function(a){return a.properties()}],"geometry-type":[wn,[],function(a){return a.geometryType()}],id:[An,[],function(a){return a.id()}],zoom:[rr,[],function(a){return a.globals.zoom}],"heatmap-density":[rr,[],function(a){return a.globals.heatmapDensity||0}],"line-progress":[rr,[],function(a){return a.globals.lineProgress||0}],accumulated:[An,[],function(a){return a.globals.accumulated===void 0?null:a.globals.accumulated}],"+":[rr,Fu(rr),function(a,o){for(var u=0,p=0,y=o;p<y.length;p+=1)u+=y[p].evaluate(a);return u}],"*":[rr,Fu(rr),function(a,o){for(var u=1,p=0,y=o;p<y.length;p+=1)u*=y[p].evaluate(a);return u}],"-":{type:rr,overloads:[[[rr,rr],function(a,o){var u=o[1];return o[0].evaluate(a)-u.evaluate(a)}],[[rr],function(a,o){return-o[0].evaluate(a)}]]},"/":[rr,[rr,rr],function(a,o){var u=o[1];return o[0].evaluate(a)/u.evaluate(a)}],"%":[rr,[rr,rr],function(a,o){var u=o[1];return o[0].evaluate(a)%u.evaluate(a)}],ln2:[rr,[],function(){return Math.LN2}],pi:[rr,[],function(){return Math.PI}],e:[rr,[],function(){return Math.E}],"^":[rr,[rr,rr],function(a,o){var u=o[1];return Math.pow(o[0].evaluate(a),u.evaluate(a))}],sqrt:[rr,[rr],function(a,o){return Math.sqrt(o[0].evaluate(a))}],log10:[rr,[rr],function(a,o){return Math.log(o[0].evaluate(a))/Math.LN10}],ln:[rr,[rr],function(a,o){return Math.log(o[0].evaluate(a))}],log2:[rr,[rr],function(a,o){return Math.log(o[0].evaluate(a))/Math.LN2}],sin:[rr,[rr],function(a,o){return Math.sin(o[0].evaluate(a))}],cos:[rr,[rr],function(a,o){return Math.cos(o[0].evaluate(a))}],tan:[rr,[rr],function(a,o){return Math.tan(o[0].evaluate(a))}],asin:[rr,[rr],function(a,o){return Math.asin(o[0].evaluate(a))}],acos:[rr,[rr],function(a,o){return Math.acos(o[0].evaluate(a))}],atan:[rr,[rr],function(a,o){return Math.atan(o[0].evaluate(a))}],min:[rr,Fu(rr),function(a,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(a)}))}],max:[rr,Fu(rr),function(a,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(a)}))}],abs:[rr,[rr],function(a,o){return Math.abs(o[0].evaluate(a))}],round:[rr,[rr],function(a,o){var u=o[0].evaluate(a);return u<0?-Math.round(-u):Math.round(u)}],floor:[rr,[rr],function(a,o){return Math.floor(o[0].evaluate(a))}],ceil:[rr,[rr],function(a,o){return Math.ceil(o[0].evaluate(a))}],"filter-==":[mn,[wn,An],function(a,o){var u=o[0],p=o[1];return a.properties()[u.value]===p.value}],"filter-id-==":[mn,[An],function(a,o){var u=o[0];return a.id()===u.value}],"filter-type-==":[mn,[wn],function(a,o){var u=o[0];return a.geometryType()===u.value}],"filter-<":[mn,[wn,An],function(a,o){var u=o[0],p=o[1],y=a.properties()[u.value],b=p.value;return typeof y==typeof b&&y<b}],"filter-id-<":[mn,[An],function(a,o){var u=o[0],p=a.id(),y=u.value;return typeof p==typeof y&&p<y}],"filter->":[mn,[wn,An],function(a,o){var u=o[0],p=o[1],y=a.properties()[u.value],b=p.value;return typeof y==typeof b&&y>b}],"filter-id->":[mn,[An],function(a,o){var u=o[0],p=a.id(),y=u.value;return typeof p==typeof y&&p>y}],"filter-<=":[mn,[wn,An],function(a,o){var u=o[0],p=o[1],y=a.properties()[u.value],b=p.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[mn,[An],function(a,o){var u=o[0],p=a.id(),y=u.value;return typeof p==typeof y&&p<=y}],"filter->=":[mn,[wn,An],function(a,o){var u=o[0],p=o[1],y=a.properties()[u.value],b=p.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[mn,[An],function(a,o){var u=o[0],p=a.id(),y=u.value;return typeof p==typeof y&&p>=y}],"filter-has":[mn,[An],function(a,o){return o[0].value in a.properties()}],"filter-has-id":[mn,[],function(a){return a.id()!==null&&a.id()!==void 0}],"filter-type-in":[mn,[Un(wn)],function(a,o){return o[0].value.indexOf(a.geometryType())>=0}],"filter-id-in":[mn,[Un(An)],function(a,o){return o[0].value.indexOf(a.id())>=0}],"filter-in-small":[mn,[wn,Un(An)],function(a,o){var u=o[0];return o[1].value.indexOf(a.properties()[u.value])>=0}],"filter-in-large":[mn,[wn,Un(An)],function(a,o){var u=o[0],p=o[1];return function(y,b,S,M){for(;S<=M;){var D=S+M>>1;if(b[D]===y)return!0;b[D]>y?M=D-1:S=D+1}return!1}(a.properties()[u.value],p.value,0,p.value.length-1)}],all:{type:mn,overloads:[[[mn,mn],function(a,o){var u=o[1];return o[0].evaluate(a)&&u.evaluate(a)}],[Fu(mn),function(a,o){for(var u=0,p=o;u<p.length;u+=1)if(!p[u].evaluate(a))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],function(a,o){var u=o[1];return o[0].evaluate(a)||u.evaluate(a)}],[Fu(mn),function(a,o){for(var u=0,p=o;u<p.length;u+=1)if(p[u].evaluate(a))return!0;return!1}]]},"!":[mn,[mn],function(a,o){return!o[0].evaluate(a)}],"is-supported-script":[mn,[wn],function(a,o){var u=a.globals&&a.globals.isSupportedScript;return!u||u(o[0].evaluate(a))}],upcase:[wn,[wn],function(a,o){return o[0].evaluate(a).toUpperCase()}],downcase:[wn,[wn],function(a,o){return o[0].evaluate(a).toLowerCase()}],concat:[wn,Fu(An),function(a,o){return o.map(function(u){return cu(u.evaluate(a))}).join("")}],"resolved-locale":[wn,[Lr],function(a,o){return o[0].evaluate(a).resolvedLocale()}]});var bu=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new ls,this._defaultValue=u?function(p){return p.type==="color"&&Cc(p.default)?new bi(0,0,0,0):p.type==="color"?bi.parse(p.default)||null:p.default===void 0?null:p.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function jl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in zl}function tc(a,o){var u=new nl(zl,[],o?function(y){var b={color:xn,string:wn,number:rr,enum:wn,boolean:mn,formatted:Zi,resolvedImage:Ti};return y.type==="array"?Un(b[y.value]||An,y.length):b[y.type]}(o):void 0),p=u.parse(a,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?xu(new bu(p,o)):Bu(u.errors)}bu.prototype.evaluateWithoutErrorHandling=function(a,o,u,p,y,b){return this._evaluator.globals=a,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},bu.prototype.evaluate=function(a,o,u,p,y,b){this._evaluator.globals=a,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Va("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Js=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!qs(u.expression)};Js.prototype.evaluateWithoutErrorHandling=function(a,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(a,o,u,p,y,b)},Js.prototype.evaluate=function(a,o,u,p,y,b){return this._styleExpression.evaluate(a,o,u,p,y,b)};var Nu=function(o,u,p,y){this.kind=o,this.zoomStops=p,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!qs(u.expression),this.interpolationType=y};function rc(a,o){if((a=tc(a,o)).result==="error")return a;var u=a.value.expression,p=Vo(u);if(!p&&!il(o))return Bu([new Dr("","data expressions not supported")]);var y=gu(u,["zoom"]);if(!y&&!Sc(o))return Bu([new Dr("","zoom expressions not supported")]);var b=function S(M){var D=null;if(M instanceof kr)D=S(M.result);else if(M instanceof Sr)for(var B=0,Z=M.args;B<Z.length&&!(D=S(Z[B]));B+=1);else(M instanceof Ga||M instanceof Ct)&&M.input instanceof uo&&M.input.name==="zoom"&&(D=M);return D instanceof Dr||M.eachChild(function(q){var ee=S(q);ee instanceof Dr?D=ee:!D&&ee?D=new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&ee&&D!==ee&&(D=new Dr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof Dr?Bu([b]):b instanceof Ct&&!Cl(o)?Bu([new Dr("",'"interpolate" expressions cannot be used with this property')]):xu(b?new Nu(p?"camera":"composite",a.value,b.labels,b instanceof Ct?b.interpolation:void 0):new Js(p?"constant":"source",a.value)):Bu([new Dr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Nu.prototype.evaluateWithoutErrorHandling=function(a,o,u,p,y,b){return this._styleExpression.evaluateWithoutErrorHandling(a,o,u,p,y,b)},Nu.prototype.evaluate=function(a,o,u,p,y,b){return this._styleExpression.evaluate(a,o,u,p,y,b)},Nu.prototype.interpolationFactor=function(a,o,u){return this.interpolationType?Ct.interpolationFactor(this.interpolationType,a,o,u):0};var wl=function(o,u){this._parameters=o,this._specification=u,Cr(this,function p(y,b){var S,M,D,B=b.type==="color",Z=y.stops&&typeof y.stops[0][0]=="object",q=Z||!(Z||y.property!==void 0),ee=y.type||(Cl(b)?"exponential":"interval");if(B&&((y=Cr({},y)).stops&&(y.stops=y.stops.map(function(Qn){return[Qn[0],bi.parse(Qn[1])]})),y.default=bi.parse(y.default?y.default:b.default)),y.colorSpace&&y.colorSpace!=="rgb"&&!rt[y.colorSpace])throw new Error("Unknown color space: "+y.colorSpace);if(ee==="exponential")S=Lf;else if(ee==="interval")S=uh;else if(ee==="categorical"){S=kf,M=Object.create(null);for(var _e=0,Le=y.stops;_e<Le.length;_e+=1){var Ie=Le[_e];M[Ie[0]]=Ie[1]}D=typeof y.stops[0][0]}else{if(ee!=="identity")throw new Error('Unknown function type "'+ee+'"');S=Ul}if(Z){for(var Ye={},Xe=[],gt=0;gt<y.stops.length;gt++){var Dt=y.stops[gt],Xt=Dt[0].zoom;Ye[Xt]===void 0&&(Ye[Xt]={zoom:Xt,type:y.type,property:y.property,default:y.default,stops:[]},Xe.push(Xt)),Ye[Xt].stops.push([Dt[0].value,Dt[1]])}for(var yr=[],or=0,Jr=Xe;or<Jr.length;or+=1){var tn=Jr[or];yr.push([Ye[tn].zoom,p(Ye[tn],b)])}var Gn={name:"linear"};return{kind:"composite",interpolationType:Gn,interpolationFactor:Ct.interpolationFactor.bind(void 0,Gn),zoomStops:yr.map(function(Qn){return Qn[0]}),evaluate:function(Nn,wi){var ui=Nn.zoom;return Lf({stops:yr,base:y.base},b,ui).evaluate(ui,wi)}}}if(q){var ti=ee==="exponential"?{name:"exponential",base:y.base!==void 0?y.base:1}:null;return{kind:"camera",interpolationType:ti,interpolationFactor:Ct.interpolationFactor.bind(void 0,ti),zoomStops:y.stops.map(function(Qn){return Qn[0]}),evaluate:function(Nn){return S(y,b,Nn.zoom,M,D)}}}return{kind:"source",evaluate:function(Nn,wi){var ui=wi&&wi.properties?wi.properties[y.property]:void 0;return ui===void 0?wc(y.default,b.default):S(y,b,ui,M,D)}}}(this._parameters,this._specification))};function Ts(a){var o=a.key,u=a.value,p=a.valueSpec||{},y=a.objectElementValidators||{},b=a.style,S=a.styleSpec,M=[],D=ka(u);if(D!=="object")return[new Ue(o,u,"object expected, "+D+" found")];for(var B in u){var Z=B.split(".")[0],q=p[Z]||p["*"],ee=void 0;if(y[Z])ee=y[Z];else if(p[Z])ee=Qi;else if(y["*"])ee=y["*"];else{if(!p["*"]){M.push(new Ue(o,u[B],'unknown property "'+B+'"'));continue}ee=Qi}M=M.concat(ee({key:(o&&o+".")+B,value:u[B],valueSpec:q,style:b,styleSpec:S,object:u,objectKey:B},u))}for(var _e in p)y[_e]||p[_e].required&&p[_e].default===void 0&&u[_e]===void 0&&M.push(new Ue(o,u,'missing required property "'+_e+'"'));return M}function Jc(a){var o=a.value,u=a.valueSpec,p=a.style,y=a.styleSpec,b=a.key,S=a.arrayElementValidator||Qi;if(ka(o)!=="array")return[new Ue(b,o,"array expected, "+ka(o)+" found")];if(u.length&&o.length!==u.length)return[new Ue(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new Ue(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var M={type:u.value,values:u.values};y.$version<7&&(M.function=u.function),ka(u.value)==="object"&&(M=u.value);for(var D=[],B=0;B<o.length;B++)D=D.concat(S({array:o,arrayIndex:B,value:o[B],valueSpec:M,style:p,styleSpec:y,key:b+"["+B+"]"}));return D}function ef(a){var o=a.key,u=a.value,p=a.valueSpec,y=ka(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new Ue(o,u,"number expected, "+y+" found")]:"minimum"in p&&u<p.minimum?[new Ue(o,u,u+" is less than the minimum value "+p.minimum)]:"maximum"in p&&u>p.maximum?[new Ue(o,u,u+" is greater than the maximum value "+p.maximum)]:[]}function tf(a){var o,u,p,y=a.valueSpec,b=Tr(a.value.type),S={},M=b!=="categorical"&&a.value.property===void 0,D=!M,B=ka(a.value.stops)==="array"&&ka(a.value.stops[0])==="array"&&ka(a.value.stops[0][0])==="object",Z=Ts({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(Le){if(b==="identity")return[new Ue(Le.key,Le.value,'identity function may not have a "stops" property')];var Ie=[],Ye=Le.value;return Ie=Ie.concat(Jc({key:Le.key,value:Ye,valueSpec:Le.valueSpec,style:Le.style,styleSpec:Le.styleSpec,arrayElementValidator:q})),ka(Ye)==="array"&&Ye.length===0&&Ie.push(new Ue(Le.key,Ye,"array must have at least one stop")),Ie},default:function(Le){return Qi({key:Le.key,value:Le.value,valueSpec:y,style:Le.style,styleSpec:Le.styleSpec})}}});return b==="identity"&&M&&Z.push(new Ue(a.key,a.value,'missing required property "property"')),b==="identity"||a.value.stops||Z.push(new Ue(a.key,a.value,'missing required property "stops"')),b==="exponential"&&a.valueSpec.expression&&!Cl(a.valueSpec)&&Z.push(new Ue(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(D&&!il(a.valueSpec)?Z.push(new Ue(a.key,a.value,"property functions not supported")):M&&!Sc(a.valueSpec)&&Z.push(new Ue(a.key,a.value,"zoom functions not supported"))),b!=="categorical"&&!B||a.value.property!==void 0||Z.push(new Ue(a.key,a.value,'"property" property is required')),Z;function q(_e){var Le=[],Ie=_e.value,Ye=_e.key;if(ka(Ie)!=="array")return[new Ue(Ye,Ie,"array expected, "+ka(Ie)+" found")];if(Ie.length!==2)return[new Ue(Ye,Ie,"array length 2 expected, length "+Ie.length+" found")];if(B){if(ka(Ie[0])!=="object")return[new Ue(Ye,Ie,"object expected, "+ka(Ie[0])+" found")];if(Ie[0].zoom===void 0)return[new Ue(Ye,Ie,"object stop key must have zoom")];if(Ie[0].value===void 0)return[new Ue(Ye,Ie,"object stop key must have value")];if(p&&p>Tr(Ie[0].zoom))return[new Ue(Ye,Ie[0].zoom,"stop zoom values must appear in ascending order")];Tr(Ie[0].zoom)!==p&&(p=Tr(Ie[0].zoom),u=void 0,S={}),Le=Le.concat(Ts({key:Ye+"[0]",value:Ie[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:ef,value:ee}}))}else Le=Le.concat(ee({key:Ye+"[0]",value:Ie[0],valueSpec:{},style:_e.style,styleSpec:_e.styleSpec},Ie));return jl(tr(Ie[1]))?Le.concat([new Ue(Ye+"[1]",Ie[1],"expressions are not allowed in function stops.")]):Le.concat(Qi({key:Ye+"[1]",value:Ie[1],valueSpec:y,style:_e.style,styleSpec:_e.styleSpec}))}function ee(_e,Le){var Ie=ka(_e.value),Ye=Tr(_e.value),Xe=_e.value!==null?_e.value:Le;if(o){if(Ie!==o)return[new Ue(_e.key,Xe,Ie+" stop domain type must match previous stop domain type "+o)]}else o=Ie;if(Ie!=="number"&&Ie!=="string"&&Ie!=="boolean")return[new Ue(_e.key,Xe,"stop domain value must be a number, string, or boolean")];if(Ie!=="number"&&b!=="categorical"){var gt="number expected, "+Ie+" found";return il(y)&&b===void 0&&(gt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(_e.key,Xe,gt)]}return b!=="categorical"||Ie!=="number"||isFinite(Ye)&&Math.floor(Ye)===Ye?b!=="categorical"&&Ie==="number"&&u!==void 0&&Ye<u?[new Ue(_e.key,Xe,"stop domain values must appear in ascending order")]:(u=Ye,b==="categorical"&&Ye in S?[new Ue(_e.key,Xe,"stop domain values must be unique")]:(S[Ye]=!0,[])):[new Ue(_e.key,Xe,"integer expected, found "+Ye)]}}function Vl(a){var o=(a.expressionContext==="property"?rc:tc)(tr(a.value),a.valueSpec);if(o.result==="error")return o.value.map(function(p){return new Ue(""+a.key+p.key,a.value,p.message)});var u=o.value.expression||o.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!u.outputDefined())return[new Ue(a.key,a.value,'Invalid data expression for "'+a.propertyKey+'". Output values must be contained as literals within the expression.')];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!qs(u))return[new Ue(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!qs(u))return[new Ue(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!gu(u,["zoom","feature-state"]))return[new Ue(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Vo(u))return[new Ue(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Al(a){var o=a.key,u=a.value,p=a.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(Tr(u))===-1&&y.push(new Ue(o,u,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(p.values).indexOf(Tr(u))===-1&&y.push(new Ue(o,u,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function rf(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(var o=0,u=a.slice(1);o<u.length;o+=1){var p=u[o];if(!rf(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}wl.deserialize=function(a){return new wl(a._parameters,a._specification)},wl.serialize=function(a){return{_parameters:a._parameters,_specification:a._specification}};var Df={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function al(a){if(a==null)return{filter:function(){return!0},needGeometry:!1};rf(a)||(a=Ac(a));var o=tc(a,Df);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(p,y,b){return o.value.evaluate(p,y,{},b)},needGeometry:function u(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var y=1;y<p.length;y++)if(u(p[y]))return!0;return!1}(a)}}function zu(a,o){return a<o?-1:a>o?1:0}function Ac(a){if(!a)return!0;var o,u=a[0];return a.length<=1?u!=="any":u==="=="?nf(a[1],a[2],"=="):u==="!="?Ff(nf(a[1],a[2],"==")):u==="<"||u===">"||u==="<="||u===">="?nf(a[1],a[2],u):u==="any"?(o=a.slice(1),["any"].concat(o.map(Ac))):u==="all"?["all"].concat(a.slice(1).map(Ac)):u==="none"?["all"].concat(a.slice(1).map(Ac).map(Ff)):u==="in"?nc(a[1],a.slice(2)):u==="!in"?Ff(nc(a[1],a.slice(2))):u==="has"?Lh(a[1]):u==="!has"?Ff(Lh(a[1])):u!=="within"||a}function nf(a,o,u){switch(a){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,a,o]}}function nc(a,o){if(o.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",a,["literal",o.sort(zu)]]:["filter-in-small",a,["literal",o]]}}function Lh(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ff(a){return["!",a]}function Bf(a){return rf(tr(a.value))?Vl(Cr({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var p=u.value,y=u.key;if(ka(p)!=="array")return[new Ue(y,p,"array expected, "+ka(p)+" found")];var b,S=u.styleSpec,M=[];if(p.length<1)return[new Ue(y,p,"filter array must have at least 1 element")];switch(M=M.concat(Al({key:y+"[0]",value:p[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Tr(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&Tr(p[1])==="$type"&&M.push(new Ue(y,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&M.push(new Ue(y,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(b=ka(p[1]))!=="string"&&M.push(new Ue(y+"[1]",p[1],"string expected, "+b+" found"));for(var D=2;D<p.length;D++)b=ka(p[D]),Tr(p[1])==="$type"?M=M.concat(Al({key:y+"["+D+"]",value:p[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&M.push(new Ue(y+"["+D+"]",p[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var B=1;B<p.length;B++)M=M.concat(o({key:y+"["+B+"]",value:p[B],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=ka(p[1]),p.length!==2?M.push(new Ue(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="string"&&M.push(new Ue(y+"[1]",p[1],"string expected, "+b+" found"));break;case"within":b=ka(p[1]),p.length!==2?M.push(new Ue(y,p,'filter array for "'+p[0]+'" operator must have 2 elements')):b!=="object"&&M.push(new Ue(y+"[1]",p[1],"object expected, "+b+" found"))}return M}(a)}function ys(a,o){var u=a.key,p=a.style,y=a.styleSpec,b=a.value,S=a.objectKey,M=y[o+"_"+a.layerType];if(!M)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&M[D[1]]&&M[D[1]].transition)return Qi({key:u,value:b,valueSpec:y.transition,style:p,styleSpec:y});var B,Z=a.valueSpec||M[S];if(!Z)return[new Ue(u,b,'unknown property "'+S+'"')];if(ka(b)==="string"&&il(Z)&&!Z.tokens&&(B=/^{([^}]+)}$/.exec(b)))return[new Ue(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(B[1])+" }`.")];var q=[];return a.layerType==="symbol"&&(S==="text-field"&&p&&!p.glyphs&&q.push(new Ue(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Cc(tr(b))&&Tr(b.type)==="identity"&&q.push(new Ue(u,b,'"text-font" does not support identity functions'))),q.concat(Qi({key:a.key,value:b,valueSpec:Z,style:p,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function eu(a){return ys(a,"paint")}function Nf(a){return ys(a,"layout")}function _p(a){var o=[],u=a.value,p=a.key,y=a.style,b=a.styleSpec;u.type||u.ref||o.push(new Ue(p,u,'either "type" or "ref" is required'));var S,M=Tr(u.type),D=Tr(u.ref);if(u.id)for(var B=Tr(u.id),Z=0;Z<a.arrayIndex;Z++){var q=y.layers[Z];Tr(q.id)===B&&o.push(new Ue(p,u.id,'duplicate layer id "'+u.id+'", previously used at line '+q.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Le){Le in u&&o.push(new Ue(p,u[Le],'"'+Le+'" is prohibited for ref layers'))}),y.layers.forEach(function(Le){Tr(Le.id)===D&&(S=Le)}),S?S.ref?o.push(new Ue(p,u.ref,"ref cannot reference another ref layer")):M=Tr(S.type):o.push(new Ue(p,u.ref,'ref layer "'+D+'" not found'));else if(M!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],_e=ee&&Tr(ee.type);ee?_e==="vector"&&M==="raster"?o.push(new Ue(p,u.source,'layer "'+u.id+'" requires a raster source')):_e==="raster"&&M!=="raster"?o.push(new Ue(p,u.source,'layer "'+u.id+'" requires a vector source')):_e!=="vector"||u["source-layer"]?_e==="raster-dem"&&M!=="hillshade"?o.push(new Ue(p,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]||_e==="geojson"&&ee.lineMetrics||o.push(new Ue(p,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new Ue(p,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new Ue(p,u.source,'source "'+u.source+'" not found'))}else o.push(new Ue(p,u,'missing required property "source"'));return o=o.concat(Ts({key:p,value:u,valueSpec:b.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Qi({key:p+".type",value:u.type,valueSpec:b.layer.type,style:a.style,styleSpec:a.styleSpec,object:u,objectKey:"type"})},filter:Bf,layout:function(Ie){return Ts({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(Xe){return Nf(Cr({layerType:M},Xe))}}})},paint:function(Ie){return Ts({layer:u,key:Ie.key,value:Ie.value,style:Ie.style,styleSpec:Ie.styleSpec,objectElementValidators:{"*":function(Xe){return eu(Cr({layerType:M},Xe))}}})}}}))}function _s(a){var o=a.value,u=a.key,p=ka(o);return p!=="string"?[new Ue(u,o,"string expected, "+p+" found")]:[]}var ro={promoteId:function(o){var u=o.key,p=o.value;if(ka(p)==="string")return _s({key:u,value:p});var y=[];for(var b in p)y.push.apply(y,_s({key:u+"."+b,value:p[b]}));return y}};function ic(a){var o=a.value,u=a.key,p=a.styleSpec,y=a.style;if(!o.type)return[new Ue(u,o,'"type" is required')];var b,S=Tr(o.type);switch(S){case"vector":case"raster":case"raster-dem":return Ts({key:u,value:o,valueSpec:p["source_"+S.replace("-","_")],style:a.style,styleSpec:p,objectElementValidators:ro});case"geojson":if(b=Ts({key:u,value:o,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:ro}),o.cluster)for(var M in o.clusterProperties){var D=o.clusterProperties[M],B=D[0],Z=typeof B=="string"?[B,["accumulated"],["get",M]]:B;b.push.apply(b,Vl({key:u+"."+M+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,Vl({key:u+"."+M+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return Ts({key:u,value:o,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return Ts({key:u,value:o,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new Ue(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Al({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:p})}}function Tl(a){var o=a.value,u=a.styleSpec,p=u.light,y=a.style,b=[],S=ka(o);if(o===void 0)return b;if(S!=="object")return b.concat([new Ue("light",o,"object expected, "+S+" found")]);for(var M in o){var D=M.match(/^(.*)-transition$/);b=b.concat(D&&p[D[1]]&&p[D[1]].transition?Qi({key:M,value:o[M],valueSpec:u.transition,style:y,styleSpec:u}):p[M]?Qi({key:M,value:o[M],valueSpec:p[M],style:y,styleSpec:u}):[new Ue(M,o[M],'unknown property "'+M+'"')])}return b}var ol={"*":function(){return[]},array:Jc,boolean:function(o){var u=o.value,p=o.key,y=ka(u);return y!=="boolean"?[new Ue(p,u,"boolean expected, "+y+" found")]:[]},number:ef,color:function(o){var u=o.key,p=o.value,y=ka(p);return y!=="string"?[new Ue(u,p,"color expected, "+y+" found")]:ci(p)===null?[new Ue(u,p,'color expected, "'+p+'" found')]:[]},constants:qe,enum:Al,filter:Bf,function:tf,layer:_p,object:Ts,source:ic,light:Tl,string:_s,formatted:function(o){return _s(o).length===0?[]:Vl(o)},resolvedImage:function(o){return _s(o).length===0?[]:Vl(o)}};function Qi(a){var o=a.value,u=a.valueSpec,p=a.styleSpec;return u.expression&&Cc(Tr(o))?tf(a):u.expression&&jl(tr(o))?Vl(a):u.type&&ol[u.type]?ol[u.type](a):Ts(Cr({},a,{valueSpec:u.type?p[u.type]:u}))}function za(a){var o=a.value,u=a.key,p=_s(a);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new Ue(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new Ue(u,o,'"glyphs" url must include a "{range}" token'))),p}function Ms(a,o){o===void 0&&(o=pe);var u=[];return u=u.concat(Qi({key:"",value:a,valueSpec:o.$root,styleSpec:o,style:a,objectElementValidators:{glyphs:za,"*":function(){return[]}}})),a.constants&&(u=u.concat(qe({key:"constants",value:a.constants,style:a,styleSpec:o}))),Ml(u)}function Ml(a){return[].concat(a).sort(function(o,u){return o.line-u.line})}function Ps(a){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Ml(a.apply(this,o))}}Ms.source=Ps(ic),Ms.light=Ps(Tl),Ms.layer=Ps(_p),Ms.filter=Ps(Bf),Ms.paintProperty=Ps(eu),Ms.layoutProperty=Ps(Nf);var af=Ms,xp=af.light,lh=af.paintProperty,of=af.layoutProperty;function sf(a,o){var u=!1;if(o&&o.length)for(var p=0,y=o;p<y.length;p+=1)a.fire(new nt(new Error(y[p].message))),u=!0;return u}var Eu=ha;function ha(a,o,u){var p=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],M=y[3+b+1];p.push(S===M?null:y.subarray(S,M))}var D=y[3+p.length+1];this.keys=y.subarray(y[3+p.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var B=0;B<this.d*this.d;B++)p.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=a,this.padding=u,this.scale=o/a,this.uid=0;var Z=u/o*a;this.min=-Z,this.max=a+Z}ha.prototype.insert=function(a,o,u,p,y){this._forEachCell(o,u,p,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(y)},ha.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ha.prototype._insertCell=function(a,o,u,p,y,b){this.cells[y].push(b)},ha.prototype.query=function(a,o,u,p,y){var b=this.min,S=this.max;if(a<=b&&o<=b&&S<=u&&S<=p&&!y)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(a,o,u,p,this._queryCell,M,{},y),M},ha.prototype._queryCell=function(a,o,u,p,y,b,S,M){var D=this.cells[y];if(D!==null)for(var B=this.keys,Z=this.bboxes,q=0;q<D.length;q++){var ee=D[q];if(S[ee]===void 0){var _e=4*ee;(M?M(Z[_e+0],Z[_e+1],Z[_e+2],Z[_e+3]):a<=Z[_e+2]&&o<=Z[_e+3]&&u>=Z[_e+0]&&p>=Z[_e+1])?(S[ee]=!0,b.push(B[ee])):S[ee]=!1}}},ha.prototype._forEachCell=function(a,o,u,p,y,b,S,M){for(var D=this._convertToCellCoord(a),B=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),q=this._convertToCellCoord(p),ee=D;ee<=Z;ee++)for(var _e=B;_e<=q;_e++){var Le=this.d*_e+ee;if((!M||M(this._convertFromCellCoord(ee),this._convertFromCellCoord(_e),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(_e+1)))&&y.call(this,a,o,u,p,Le,b,S,M))return}},ha.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},ha.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},ha.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,o=3+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<a.length;S++){var M=a[S];y[3+S]=b,y.set(M,b),b+=M.length}return y[3+a.length]=b,y.set(this.keys,b),y[3+a.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Gl=Ee.ImageData,ac=Ee.ImageBitmap,Xi={};function Ln(a,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:a,writeable:!1}),Xi[a]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var Os in Ln("Object",Object),Eu.serialize=function(a,o){var u=a.toArrayBuffer();return o&&o.push(u),{buffer:u}},Eu.deserialize=function(a){return new Eu(a.buffer)},Ln("Grid",Eu),Ln("Color",bi),Ln("Error",Error),Ln("ResolvedImage",Za),Ln("StylePropertyFunction",wl),Ln("StyleExpression",bu,{omit:["_evaluator"]}),Ln("ZoomDependentExpression",Nu),Ln("ZoomConstantExpression",Js),Ln("CompoundExpression",uo,{omit:["_evaluate"]}),zl)zl[Os]._classRegistryKey||Ln("Expression_"+Os,zl[Os]);function uf(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function oc(a){return ac&&a instanceof ac}function Su(a,o){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(uf(a)||oc(a))return o&&o.push(a),a;if(ArrayBuffer.isView(a)){var u=a;return o&&o.push(u.buffer),u}if(a instanceof Gl)return o&&o.push(a.data.buffer),a;if(Array.isArray(a)){for(var p=[],y=0,b=a;y<b.length;y+=1)p.push(Su(b[y],o));return p}if(typeof a=="object"){var S=a.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(a,o):{};if(!S.serialize){for(var B in a)if(a.hasOwnProperty(B)&&!(Xi[M].omit.indexOf(B)>=0)){var Z=a[B];D[B]=Xi[M].shallow.indexOf(B)>=0?Z:Su(Z,o)}a instanceof Error&&(D.message=a.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(D.$name=M),D}throw new Error("can't serialize object of type "+typeof a)}function Is(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||uf(a)||oc(a)||ArrayBuffer.isView(a)||a instanceof Gl)return a;if(Array.isArray(a))return a.map(Is);if(typeof a=="object"){var o=a.$name||"Object",u=Xi[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(a);for(var p=Object.create(u.prototype),y=0,b=Object.keys(a);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var M=a[S];p[S]=Xi[o].shallow.indexOf(S)>=0?M:Is(M)}}return p}throw new Error("can't deserialize object of type "+typeof a)}var lf=function(){this.first=!0};lf.prototype.update=function(a,o){var u=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=u,!0))};var gn={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function Hl(a){for(var o=0,u=a;o<u.length;o+=1)if(Fo(u[o].charCodeAt(0)))return!0;return!1}function Fo(a){return!(a!==746&&a!==747&&(a<4352||!(gn["Bopomofo Extended"](a)||gn.Bopomofo(a)||gn["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||gn["CJK Compatibility Ideographs"](a)||gn["CJK Compatibility"](a)||gn["CJK Radicals Supplement"](a)||gn["CJK Strokes"](a)||!(!gn["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||gn["CJK Unified Ideographs Extension A"](a)||gn["CJK Unified Ideographs"](a)||gn["Enclosed CJK Letters and Months"](a)||gn["Hangul Compatibility Jamo"](a)||gn["Hangul Jamo Extended-A"](a)||gn["Hangul Jamo Extended-B"](a)||gn["Hangul Jamo"](a)||gn["Hangul Syllables"](a)||gn.Hiragana(a)||gn["Ideographic Description Characters"](a)||gn.Kanbun(a)||gn["Kangxi Radicals"](a)||gn["Katakana Phonetic Extensions"](a)||gn.Katakana(a)&&a!==12540||!(!gn["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!gn["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||gn["Unified Canadian Aboriginal Syllabics"](a)||gn["Unified Canadian Aboriginal Syllabics Extended"](a)||gn["Vertical Forms"](a)||gn["Yijing Hexagram Symbols"](a)||gn["Yi Syllables"](a)||gn["Yi Radicals"](a))))}function zf(a){return!(Fo(a)||function(o){return!!(gn["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||gn["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||gn["Letterlike Symbols"](o)||gn["Number Forms"](o)||gn["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||gn["Control Pictures"](o)&&o!==9251||gn["Optical Character Recognition"](o)||gn["Enclosed Alphanumerics"](o)||gn["Geometric Shapes"](o)||gn["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||gn["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||gn["CJK Symbols and Punctuation"](o)||gn.Katakana(o)||gn["Private Use Area"](o)||gn["CJK Compatibility Forms"](o)||gn["Small Form Variants"](o)||gn["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(a))}function hu(a){return a>=1424&&a<=2303||gn["Arabic Presentation Forms-A"](a)||gn["Arabic Presentation Forms-B"](a)}function Go(a,o){return!(!o&&hu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||gn.Khmer(a))}function cf(a){for(var o=0,u=a;o<u.length;o+=1)if(hu(u[o].charCodeAt(0)))return!0;return!1}var ff=null,tu="unavailable",Uu=null,ch=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(tu="error"),ff&&ff(o)};function hf(){Uf.fire(new ke("pluginStateChange",{pluginStatus:tu,pluginURL:Uu}))}var Uf=new pt,jf=function(){return tu},Cu=function(){if(tu!=="deferred"||!Uu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");tu="loading",hf(),Uu&&js({url:Uu},function(o){o?ch(o):(tu="loaded",hf())})},lo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return tu==="loaded"||lo.applyArabicShaping!=null},isLoading:function(){return tu==="loading"},setState:function(o){tu=o.pluginStatus,Uu=o.pluginURL},isParsed:function(){return lo.applyArabicShaping!=null&&lo.processBidirectionalText!=null&&lo.processStyledBidirectionalText!=null},getPluginURL:function(){return Uu}},$i=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lf,this.transition={})};$i.prototype.isSupportedScript=function(a){return function(o,u){for(var p=0,y=o;p<y.length;p+=1)if(!Go(y[p].charCodeAt(0),u))return!1;return!0}(a,lo.isLoaded())},$i.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},$i.prototype.getCrossfadeParameters=function(){var a=this.zoom,o=a-Math.floor(a),u=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var ju=function(o,u){this.property=o,this.value=u,this.expression=function(p,y){if(Cc(p))return new wl(p,y);if(jl(p)){var b=rc(p,y);if(b.result==="error")throw new Error(b.value.map(function(M){return M.key+": "+M.message}).join(", "));return b.value}var S=p;return typeof p=="string"&&y.type==="color"&&(S=bi.parse(p)),{kind:"constant",evaluate:function(){return S}}}(u===void 0?o.specification.default:u,o.specification)};ju.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},ju.prototype.possiblyEvaluate=function(a,o,u){return this.property.possiblyEvaluate(this,a,o,u)};var pu=function(o){this.property=o,this.value=new ju(o,void 0)};pu.prototype.transitioned=function(a,o){return new wu(this.property,this.value,o,Ve({},a.transition,this.transition),a.now)},pu.prototype.untransitioned=function(){return new wu(this.property,this.value,null,{},0)};var Ho=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};Ho.prototype.getValue=function(a){return Oe(this._values[a].value.value)},Ho.prototype.setValue=function(a,o){this._values.hasOwnProperty(a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].value=new ju(this._values[a].property,o===null?void 0:Oe(o))},Ho.prototype.getTransition=function(a){return Oe(this._values[a].transition)},Ho.prototype.setTransition=function(a,o){this._values.hasOwnProperty(a)||(this._values[a]=new pu(this._values[a].property)),this._values[a].transition=Oe(o)||void 0},Ho.prototype.serialize=function(){for(var a={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(a[p]=y);var b=this.getTransition(p);b!==void 0&&(a[p+"-transition"]=b)}return a},Ho.prototype.transitioned=function(a,o){for(var u=new Wl(this._properties),p=0,y=Object.keys(this._values);p<y.length;p+=1){var b=y[p];u._values[b]=this._values[b].transitioned(a,o._values[b])}return u},Ho.prototype.untransitioned=function(){for(var a=new Wl(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o];a._values[p]=this._values[p].untransitioned()}return a};var wu=function(o,u,p,y,b){this.property=o,this.value=u,this.begin=b+y.delay||0,this.end=this.begin+y.duration||0,o.specification.transition&&(y.delay||y.duration)&&(this.prior=p)};wu.prototype.possiblyEvaluate=function(a,o,u){var p=a.now||0,y=this.value.possiblyEvaluate(a,o,u),b=this.prior;if(b){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return b.possiblyEvaluate(a,o,u);var S=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(a,o,u),y,function(M){if(M<=0)return 0;if(M>=1)return 1;var D=M*M,B=D*M;return 4*(M<.5?B:3*(M-D)+B-.75)}(S))}return y};var Wl=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};Wl.prototype.possiblyEvaluate=function(a,o,u){for(var p=new pf(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(a,o,u)}return p},Wl.prototype.hasTransition=function(){for(var a=0,o=Object.keys(this._values);a<o.length;a+=1)if(this._values[o[a]].prior)return!0;return!1};var xs=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};xs.prototype.getValue=function(a){return Oe(this._values[a].value)},xs.prototype.setValue=function(a,o){this._values[a]=new ju(this._values[a].property,o===null?void 0:Oe(o))},xs.prototype.serialize=function(){for(var a={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var p=u[o],y=this.getValue(p);y!==void 0&&(a[p]=y)}return a},xs.prototype.possiblyEvaluate=function(a,o,u){for(var p=new pf(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];p._values[S]=this._values[S].possiblyEvaluate(a,o,u)}return p};var cs=function(o,u,p){this.property=o,this.value=u,this.parameters=p};cs.prototype.isConstant=function(){return this.value.kind==="constant"},cs.prototype.constantOr=function(a){return this.value.kind==="constant"?this.value.value:a},cs.prototype.evaluate=function(a,o,u,p){return this.property.evaluate(this.value,this.parameters,a,o,u,p)};var pf=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};pf.prototype.get=function(a){return this._values[a]};var si=function(o){this.specification=o};si.prototype.possiblyEvaluate=function(a,o){return a.expression.evaluate(o)},si.prototype.interpolate=function(a,o,u){var p=El[this.specification.type];return p?p(a,o,u):a};var Kn=function(o,u){this.specification=o,this.overrides=u};Kn.prototype.possiblyEvaluate=function(a,o,u,p){return new cs(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(o,null,{},u,p)}:a.expression,o)},Kn.prototype.interpolate=function(a,o,u){if(a.value.kind!=="constant"||o.value.kind!=="constant")return a;if(a.value.value===void 0||o.value.value===void 0)return new cs(this,{kind:"constant",value:void 0},a.parameters);var p=El[this.specification.type];return p?new cs(this,{kind:"constant",value:p(a.value.value,o.value.value,u)},a.parameters):a},Kn.prototype.evaluate=function(a,o,u,p,y,b){return a.kind==="constant"?a.value:a.evaluate(o,u,p,y,b)};var df=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p,y,b){if(u.value===void 0)return new cs(this,{kind:"constant",value:void 0},p);if(u.expression.kind==="constant"){var S=u.expression.evaluate(p,null,{},y,b),M=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(M,M,M,p);return new cs(this,{kind:"constant",value:D},p)}if(u.expression.kind==="camera"){var B=this._calculate(u.expression.evaluate({zoom:p.zoom-1}),u.expression.evaluate({zoom:p.zoom}),u.expression.evaluate({zoom:p.zoom+1}),p);return new cs(this,{kind:"constant",value:B},p)}return new cs(this,u.expression,p)},o.prototype.evaluate=function(u,p,y,b,S,M){if(u.kind==="source"){var D=u.evaluate(p,y,b,S,M);return this._calculate(D,D,D,p)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(p.zoom)-1},y,b),u.evaluate({zoom:Math.floor(p.zoom)},y,b),u.evaluate({zoom:Math.floor(p.zoom)+1},y,b),p):u.value},o.prototype._calculate=function(u,p,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:p}:{from:y,to:p}},o.prototype.interpolate=function(u){return u},o}(Kn),bs=function(o){this.specification=o};bs.prototype.possiblyEvaluate=function(a,o,u,p){if(a.value!==void 0){if(a.expression.kind==="constant"){var y=a.expression.evaluate(o,null,{},u,p);return this._calculate(y,y,y,o)}return this._calculate(a.expression.evaluate(new $i(Math.floor(o.zoom-1),o)),a.expression.evaluate(new $i(Math.floor(o.zoom),o)),a.expression.evaluate(new $i(Math.floor(o.zoom+1),o)),o)}},bs.prototype._calculate=function(a,o,u,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:a,to:o}:{from:u,to:o}},bs.prototype.interpolate=function(a){return a};var du=function(o){this.specification=o};du.prototype.possiblyEvaluate=function(a,o,u,p){return!!a.expression.evaluate(o,null,{},u,p)},du.prototype.interpolate=function(){return!1};var Jo=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var p=o[u];p.specification.overridable&&this.overridableProperties.push(u);var y=this.defaultPropertyValues[u]=new ju(p,void 0),b=this.defaultTransitionablePropertyValues[u]=new pu(p);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}};Ln("DataDrivenProperty",Kn),Ln("DataConstantProperty",si),Ln("CrossFadedDataDrivenProperty",df),Ln("CrossFadedProperty",bs),Ln("ColorRampProperty",du);var Vu=function(a){function o(u,p){if(a.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),p.layout&&(this._unevaluatedLayout=new xs(p.layout)),p.paint)){for(var y in this._transitionablePaint=new Ho(p.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pf(p.paint)}}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,p,y){y===void 0&&(y={}),p!=null&&this._validate(of,"layers."+this.id+".layout."+u,u,p,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,p):this.visibility=p)},o.prototype.getPaintProperty=function(u){return Nr(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,p,y){if(y===void 0&&(y={}),p!=null&&this._validate(lh,"layers."+this.id+".paint."+u,u,p,y))return!1;if(Nr(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),p||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",M=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,p),this._handleSpecialPaintPropertyUpdate(u);var B=this._transitionablePaint._values[u].value;return B.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(u,D,B)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,p){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,p)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),Wt(u,function(p,y){return!(p===void 0||y==="layout"&&!Object.keys(p).length||y==="paint"&&!Object.keys(p).length)})},o.prototype._validate=function(u,p,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&sf(this,u.call(af,{key:p,layerType:this.type,objectKey:y,value:b,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var p=this.paint.get(u);if(p instanceof cs&&il(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},o}(pt),Vf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},ru=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},la=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function es(a,o){o===void 0&&(o=1);var u=0,p=0;return{members:a.map(function(y){var b=Vf[y.type].BYTES_PER_ELEMENT,S=u=sl(u,Math.max(o,b)),M=y.components||1;return p=Math.max(p,b),u+=b*M,{name:y.name,type:y.type,components:M,offset:S}}),size:sl(u,Math.max(p,o)),alignment:o}}function sl(a,o){return Math.ceil(a/o)*o}la.serialize=function(a,o){return a._trim(),o&&(a.isTransferred=!0,o.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}},la.deserialize=function(a){var o=Object.create(this.prototype);return o.arrayBuffer=a.arrayBuffer,o.length=a.length,o.capacity=a.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},la.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},la.prototype.clear=function(){this.length=0},la.prototype.resize=function(a){this.reserve(a),this.length=a},la.prototype.reserve=function(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},la.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Pl=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.int16[b+0]=p,this.int16[b+1]=y,u},o}(la);Pl.prototype.bytesPerElement=4,Ln("StructArrayLayout2i4",Pl);var Gu=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var M=4*u;return this.int16[M+0]=p,this.int16[M+1]=y,this.int16[M+2]=b,this.int16[M+3]=S,u},o}(la);Gu.prototype.bytesPerElement=8,Ln("StructArrayLayout4i8",Gu);var Hu=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,M)},o.prototype.emplace=function(u,p,y,b,S,M,D){var B=6*u;return this.int16[B+0]=p,this.int16[B+1]=y,this.int16[B+2]=b,this.int16[B+3]=S,this.int16[B+4]=M,this.int16[B+5]=D,u},o}(la);Hu.prototype.bytesPerElement=12,Ln("StructArrayLayout2i4i12",Hu);var nu=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,M)},o.prototype.emplace=function(u,p,y,b,S,M,D){var B=4*u,Z=8*u;return this.int16[B+0]=p,this.int16[B+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=M,this.uint8[Z+7]=D,u},o}(la);nu.prototype.bytesPerElement=8,Ln("StructArrayLayout2i4ub8",nu);var Tc=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.float32[b+0]=p,this.float32[b+1]=y,u},o}(la);Tc.prototype.bytesPerElement=8,Ln("StructArrayLayout2f8",Tc);var Wu=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M,D,B,Z,q){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,p,y,b,S,M,D,B,Z,q)},o.prototype.emplace=function(u,p,y,b,S,M,D,B,Z,q,ee){var _e=10*u;return this.uint16[_e+0]=p,this.uint16[_e+1]=y,this.uint16[_e+2]=b,this.uint16[_e+3]=S,this.uint16[_e+4]=M,this.uint16[_e+5]=D,this.uint16[_e+6]=B,this.uint16[_e+7]=Z,this.uint16[_e+8]=q,this.uint16[_e+9]=ee,u},o}(la);Wu.prototype.bytesPerElement=20,Ln("StructArrayLayout10ui20",Wu);var vf=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M,D,B,Z,q,ee,_e){var Le=this.length;return this.resize(Le+1),this.emplace(Le,u,p,y,b,S,M,D,B,Z,q,ee,_e)},o.prototype.emplace=function(u,p,y,b,S,M,D,B,Z,q,ee,_e,Le){var Ie=12*u;return this.int16[Ie+0]=p,this.int16[Ie+1]=y,this.int16[Ie+2]=b,this.int16[Ie+3]=S,this.uint16[Ie+4]=M,this.uint16[Ie+5]=D,this.uint16[Ie+6]=B,this.uint16[Ie+7]=Z,this.int16[Ie+8]=q,this.int16[Ie+9]=ee,this.int16[Ie+10]=_e,this.int16[Ie+11]=Le,u},o}(la);vf.prototype.bytesPerElement=24,Ln("StructArrayLayout4i4ui4i24",vf);var Mc=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.float32[S+0]=p,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(la);Mc.prototype.bytesPerElement=12,Ln("StructArrayLayout3f12",Mc);var sc=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint32[1*u+0]=p,u},o}(la);sc.prototype.bytesPerElement=4,Ln("StructArrayLayout1ul4",sc);var Dh=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M,D,B,Z){var q=this.length;return this.resize(q+1),this.emplace(q,u,p,y,b,S,M,D,B,Z)},o.prototype.emplace=function(u,p,y,b,S,M,D,B,Z,q){var ee=10*u,_e=5*u;return this.int16[ee+0]=p,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=M,this.int16[ee+5]=D,this.uint32[_e+3]=B,this.uint16[ee+8]=Z,this.uint16[ee+9]=q,u},o}(la);Dh.prototype.bytesPerElement=20,Ln("StructArrayLayout6i1ul2ui20",Dh);var mf=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M){var D=this.length;return this.resize(D+1),this.emplace(D,u,p,y,b,S,M)},o.prototype.emplace=function(u,p,y,b,S,M,D){var B=6*u;return this.int16[B+0]=p,this.int16[B+1]=y,this.int16[B+2]=b,this.int16[B+3]=S,this.int16[B+4]=M,this.int16[B+5]=D,u},o}(la);mf.prototype.bytesPerElement=12,Ln("StructArrayLayout2i2i2i12",mf);var Pc=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S){var M=this.length;return this.resize(M+1),this.emplace(M,u,p,y,b,S)},o.prototype.emplace=function(u,p,y,b,S,M){var D=4*u,B=8*u;return this.float32[D+0]=p,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[B+6]=S,this.int16[B+7]=M,u},o}(la);Pc.prototype.bytesPerElement=16,Ln("StructArrayLayout2f1f2i16",Pc);var fh=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var M=12*u,D=3*u;return this.uint8[M+0]=p,this.uint8[M+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(la);fh.prototype.bytesPerElement=12,Ln("StructArrayLayout2ub2f12",fh);var Zl=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.uint16[S+0]=p,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(la);Zl.prototype.bytesPerElement=6,Ln("StructArrayLayout3ui6",Zl);var _a=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt){var Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt)},o.prototype.emplace=function(u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt,Dt){var Xt=24*u,yr=12*u,or=48*u;return this.int16[Xt+0]=p,this.int16[Xt+1]=y,this.uint16[Xt+2]=b,this.uint16[Xt+3]=S,this.uint32[yr+2]=M,this.uint32[yr+3]=D,this.uint32[yr+4]=B,this.uint16[Xt+10]=Z,this.uint16[Xt+11]=q,this.uint16[Xt+12]=ee,this.float32[yr+7]=_e,this.float32[yr+8]=Le,this.uint8[or+36]=Ie,this.uint8[or+37]=Ye,this.uint8[or+38]=Xe,this.uint32[yr+10]=gt,this.int16[Xt+22]=Dt,u},o}(la);_a.prototype.bytesPerElement=48,Ln("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",_a);var gf=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt,Dt,Xt,yr,or,Jr,tn,Gn,ti,Qn,Nn,wi){var ui=this.length;return this.resize(ui+1),this.emplace(ui,u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt,Dt,Xt,yr,or,Jr,tn,Gn,ti,Qn,Nn,wi)},o.prototype.emplace=function(u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie,Ye,Xe,gt,Dt,Xt,yr,or,Jr,tn,Gn,ti,Qn,Nn,wi,ui){var ri=34*u,ea=17*u;return this.int16[ri+0]=p,this.int16[ri+1]=y,this.int16[ri+2]=b,this.int16[ri+3]=S,this.int16[ri+4]=M,this.int16[ri+5]=D,this.int16[ri+6]=B,this.int16[ri+7]=Z,this.uint16[ri+8]=q,this.uint16[ri+9]=ee,this.uint16[ri+10]=_e,this.uint16[ri+11]=Le,this.uint16[ri+12]=Ie,this.uint16[ri+13]=Ye,this.uint16[ri+14]=Xe,this.uint16[ri+15]=gt,this.uint16[ri+16]=Dt,this.uint16[ri+17]=Xt,this.uint16[ri+18]=yr,this.uint16[ri+19]=or,this.uint16[ri+20]=Jr,this.uint16[ri+21]=tn,this.uint16[ri+22]=Gn,this.uint32[ea+12]=ti,this.float32[ea+13]=Qn,this.float32[ea+14]=Nn,this.float32[ea+15]=wi,this.float32[ea+16]=ui,u},o}(la);gf.prototype.bytesPerElement=68,Ln("StructArrayLayout8i15ui1ul4f68",gf);var Wn=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.float32[1*u+0]=p,u},o}(la);Wn.prototype.bytesPerElement=4,Ln("StructArrayLayout1f4",Wn);var Au=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=3*u;return this.int16[S+0]=p,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(la);Au.prototype.bytesPerElement=6,Ln("StructArrayLayout3i6",Au);var Fh=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,p,y)},o.prototype.emplace=function(u,p,y,b){var S=4*u;return this.uint32[2*u+0]=p,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(la);Fh.prototype.bytesPerElement=8,Ln("StructArrayLayout1ul2ui8",Fh);var uc=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p){var y=this.length;return this.resize(y+1),this.emplace(y,u,p)},o.prototype.emplace=function(u,p,y){var b=2*u;return this.uint16[b+0]=p,this.uint16[b+1]=y,u},o}(la);uc.prototype.bytesPerElement=4,Ln("StructArrayLayout2ui4",uc);var Xl=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var p=this.length;return this.resize(p+1),this.emplace(p,u)},o.prototype.emplace=function(u,p){return this.uint16[1*u+0]=p,u},o}(la);Xl.prototype.bytesPerElement=2,Ln("StructArrayLayout1ui2",Xl);var yf=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,p,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,p,y,b)},o.prototype.emplace=function(u,p,y,b,S){var M=4*u;return this.float32[M+0]=p,this.float32[M+1]=y,this.float32[M+2]=b,this.float32[M+3]=S,u},o}(la);yf.prototype.bytesPerElement=16,Ln("StructArrayLayout4f16",yf);var h=function(a){function o(){a.apply(this,arguments)}a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new xe(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(ru);h.prototype.size=20;var f=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.get=function(u){return new h(this,u)},o}(Dh);Ln("CollisionBoxArray",f);var c=function(a){function o(){a.apply(this,arguments)}a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(ru);c.prototype.size=48;var d=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(_a);Ln("PlacedSymbolArray",d);var E=function(a){function o(){a.apply(this,arguments)}a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(ru);E.prototype.size=68;var A=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(gf);Ln("SymbolInstanceArray",A);var I=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(Wn);Ln("GlyphOffsetArray",I);var k=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(Au);Ln("SymbolLineVertexArray",k);var V=function(a){function o(){a.apply(this,arguments)}a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(ru);V.prototype.size=8;var Y=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.get=function(u){return new V(this,u)},o}(Fh);Ln("FeatureIndexArray",Y);var ce=es([{name:"a_pos",components:2,type:"Int16"}],4).members,ve=function(o){o===void 0&&(o=[]),this.segments=o};function ye(a,o){return 256*(a=vt(Math.floor(a),0,255))+vt(Math.floor(o),0,255)}ve.prototype.prepareSegment=function(a,o,u,p){var y=this.segments[this.segments.length-1];return a>ve.MAX_VERTEX_ARRAY_LENGTH&&Zt("Max vertices per segment is "+ve.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+a),(!y||y.vertexLength+a>ve.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},p!==void 0&&(y.sortKey=p),this.segments.push(y)),y},ve.prototype.get=function(){return this.segments},ve.prototype.destroy=function(){for(var a=0,o=this.segments;a<o.length;a+=1){var u=o[a];for(var p in u.vaos)u.vaos[p].destroy()}},ve.simpleSegment=function(a,o,u,p){return new ve([{vertexOffset:a,primitiveOffset:o,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])},ve.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ln("SegmentVector",ve);var ze=es([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Fe=U(function(a){a.exports=function(o,u){var p,y,b,S,M,D,B,Z;for(y=o.length-(p=3&o.length),b=u,M=3432918353,D=461845907,Z=0;Z<y;)B=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=B=(65535&(B=(B=(65535&B)*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(B=0,p){case 3:B^=(255&o.charCodeAt(Z+2))<<16;case 2:B^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=B=(65535&(B=(B=(65535&(B^=255&o.charCodeAt(Z)))*M+(((B>>>16)*M&65535)<<16)&4294967295)<<15|B>>>17))*D+(((B>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),$e=U(function(a){a.exports=function(o,u){for(var p,y=o.length,b=u^y,S=0;y>=4;)p=1540483477*(65535&(p=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ne=Fe,Ze=$e;Ne.murmur3=Fe,Ne.murmur2=Ze;var St=function(){this.ids=[],this.positions=[],this.indexed=!1};St.prototype.add=function(a,o,u,p){this.ids.push(lr(a)),this.positions.push(o,u,p)},St.prototype.getPositions=function(a){for(var o=lr(a),u=0,p=this.ids.length-1;u<p;){var y=u+p>>1;this.ids[y]>=o?p=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},St.serialize=function(a,o){var u=new Float64Array(a.ids),p=new Uint32Array(a.positions);return function y(b,S,M,D){for(;M<D;){for(var B=b[M+D>>1],Z=M-1,q=D+1;;){do Z++;while(b[Z]<B);do q--;while(b[q]>B);if(Z>=q)break;Qt(b,Z,q),Qt(S,3*Z,3*q),Qt(S,3*Z+1,3*q+1),Qt(S,3*Z+2,3*q+2)}q-M<D-q?(y(b,S,M,q),M=q+1):(y(b,S,q+1,D),D=q)}}(u,p,0,u.length-1),o&&o.push(u.buffer,p.buffer),{ids:u,positions:p}},St.deserialize=function(a){var o=new St;return o.ids=a.ids,o.positions=a.positions,o.indexed=!0,o};var mt=Math.pow(2,53)-1;function lr(a){var o=+a;return!isNaN(o)&&o<=mt?o:Ne(String(a))}function Qt(a,o,u){var p=a[o];a[o]=a[u],a[u]=p}Ln("FeaturePositionMap",St);var fr=function(o,u){this.gl=o.gl,this.location=u},_r=function(a){function o(u,p){a.call(this,u,p),this.current=0}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(fr),Yr=function(a){function o(u,p){a.call(this,u,p),this.current=0}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(fr),$r=function(a){function o(u,p){a.call(this,u,p),this.current=[0,0]}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(fr),cn=function(a){function o(u,p){a.call(this,u,p),this.current=[0,0,0]}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(fr),Zn=function(a){function o(u,p){a.call(this,u,p),this.current=[0,0,0,0]}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(fr),ai=function(a){function o(u,p){a.call(this,u,p),this.current=bi.transparent}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(fr),pi=new Float32Array(16),Ui=function(a){function o(u,p){a.call(this,u,p),this.current=pi}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var p=1;p<16;p++)if(u[p]!==this.current[p]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(fr);function zi(a){return[ye(255*a.r,255*a.g),ye(255*a.b,255*a.a)]}var Bn=function(o,u,p){this.value=o,this.uniformNames=u.map(function(y){return"u_"+y}),this.type=p};Bn.prototype.setUniform=function(a,o,u){a.set(u.constantOr(this.value))},Bn.prototype.getBinding=function(a,o,u){return this.type==="color"?new ai(a,o):new Yr(a,o)};var Ei=function(o,u){this.uniformNames=u.map(function(p){return"u_"+p}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ei.prototype.setConstantPatternPositions=function(a,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=a.tlbr},Ei.prototype.setUniform=function(a,o,u,p){var y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&a.set(y)},Ei.prototype.getBinding=function(a,o,u){return u.substr(0,9)==="u_pattern"?new Zn(a,o):new Yr(a,o)};var Oi=function(o,u,p,y){this.expression=o,this.type=p,this.maxValue=0,this.paintVertexAttributes=u.map(function(b){return{name:"a_"+b,type:"Float32",components:p==="color"?2:1,offset:0}}),this.paintVertexArray=new y};Oi.prototype.populatePaintArray=function(a,o,u,p,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new $i(0),o,{},p,[],y);this.paintVertexArray.resize(a),this._setPaintValue(b,a,S)},Oi.prototype.updatePaintArray=function(a,o,u,p){var y=this.expression.evaluate({zoom:0},u,p);this._setPaintValue(a,o,y)},Oi.prototype._setPaintValue=function(a,o,u){if(this.type==="color")for(var p=zi(u),y=a;y<o;y++)this.paintVertexArray.emplace(y,p[0],p[1]);else{for(var b=a;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Oi.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Oi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var ei=function(o,u,p,y,b,S){this.expression=o,this.uniformNames=u.map(function(M){return"u_"+M+"_t"}),this.type=p,this.useIntegerZoom=y,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(function(M){return{name:"a_"+M,type:"Float32",components:p==="color"?4:2,offset:0}}),this.paintVertexArray=new S};ei.prototype.populatePaintArray=function(a,o,u,p,y){var b=this.expression.evaluate(new $i(this.zoom),o,{},p,[],y),S=this.expression.evaluate(new $i(this.zoom+1),o,{},p,[],y),M=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(M,a,b,S)},ei.prototype.updatePaintArray=function(a,o,u,p){var y=this.expression.evaluate({zoom:this.zoom},u,p),b=this.expression.evaluate({zoom:this.zoom+1},u,p);this._setPaintValue(a,o,y,b)},ei.prototype._setPaintValue=function(a,o,u,p){if(this.type==="color")for(var y=zi(u),b=zi(p),S=a;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var M=a;M<o;M++)this.paintVertexArray.emplace(M,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}},ei.prototype.upload=function(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},ei.prototype.setUniform=function(a,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,p=vt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);a.set(p)},ei.prototype.getBinding=function(a,o,u){return new Yr(a,o)};var vi=function(o,u,p,y,b,S){this.expression=o,this.type=u,this.useIntegerZoom=p,this.zoom=y,this.layerId=S,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b};vi.prototype.populatePaintArray=function(a,o,u){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(p,a,o.patterns&&o.patterns[this.layerId],u)},vi.prototype.updatePaintArray=function(a,o,u,p,y){this._setPaintValues(a,o,u.patterns&&u.patterns[this.layerId],y)},vi.prototype._setPaintValues=function(a,o,u,p){if(p&&u){var y=p[u.min],b=p[u.mid],S=p[u.max];if(y&&b&&S)for(var M=a;M<o;M++)this.zoomInPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},vi.prototype.upload=function(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,ze.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,ze.members,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var fi=function(o,u,p){this.binders={},this._buffers=[];var y=[];for(var b in o.paint._values)if(p(b)){var S=o.paint.get(b);if(S instanceof cs&&il(S.property.specification)){var M=Ji(b,o.type),D=S.value,B=S.property.specification.type,Z=S.property.useIntegerZoom,q=S.property.specification["property-type"],ee=q==="cross-faded"||q==="cross-faded-data-driven";if(D.kind==="constant")this.binders[b]=ee?new Ei(D.value,M):new Bn(D.value,M,B),y.push("/u_"+b);else if(D.kind==="source"||ee){var _e=yo(b,B,"source");this.binders[b]=ee?new vi(D,B,Z,u,_e,o.id):new Oi(D,M,B,_e),y.push("/a_"+b)}else{var Le=yo(b,B,"composite");this.binders[b]=new ei(D,M,B,Z,u,Le),y.push("/z_"+b)}}}this.cacheKey=y.sort().join("")};fi.prototype.getMaxValue=function(a){var o=this.binders[a];return o instanceof Oi||o instanceof ei?o.maxValue:0},fi.prototype.populatePaintArrays=function(a,o,u,p,y){for(var b in this.binders){var S=this.binders[b];(S instanceof Oi||S instanceof ei||S instanceof vi)&&S.populatePaintArray(a,o,u,p,y)}},fi.prototype.setConstantPatternPositions=function(a,o){for(var u in this.binders){var p=this.binders[u];p instanceof Ei&&p.setConstantPatternPositions(a,o)}},fi.prototype.updatePaintArrays=function(a,o,u,p,y){var b=!1;for(var S in a)for(var M=0,D=o.getPositions(S);M<D.length;M+=1){var B=D[M],Z=u.feature(B.index);for(var q in this.binders){var ee=this.binders[q];if((ee instanceof Oi||ee instanceof ei||ee instanceof vi)&&ee.expression.isStateDependent===!0){var _e=p.paint.get(q);ee.expression=_e.value,ee.updatePaintArray(B.start,B.end,Z,a[S],y),b=!0}}}return b},fi.prototype.defines=function(){var a=[];for(var o in this.binders){var u=this.binders[o];(u instanceof Bn||u instanceof Ei)&&a.push.apply(a,u.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return a},fi.prototype.getBinderAttributes=function(){var a=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Oi||u instanceof ei)for(var p=0;p<u.paintVertexAttributes.length;p++)a.push(u.paintVertexAttributes[p].name);else if(u instanceof vi)for(var y=0;y<ze.members.length;y++)a.push(ze.members[y].name)}return a},fi.prototype.getBinderUniforms=function(){var a=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof Bn||u instanceof Ei||u instanceof ei)for(var p=0,y=u.uniformNames;p<y.length;p+=1)a.push(y[p])}return a},fi.prototype.getPaintVertexBuffers=function(){return this._buffers},fi.prototype.getUniforms=function(a,o){var u=[];for(var p in this.binders){var y=this.binders[p];if(y instanceof Bn||y instanceof Ei||y instanceof ei)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var M=S[b];if(o[M]){var D=y.getBinding(a,o[M],M);u.push({name:M,property:p,binding:D})}}}return u},fi.prototype.setUniforms=function(a,o,u,p){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],M=S.name,D=S.property;this.binders[D].setUniform(S.binding,p,u.get(D),M)}},fi.prototype.updatePaintBuffers=function(a){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(a&&u instanceof vi){var p=a.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(u instanceof Oi||u instanceof ei)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},fi.prototype.upload=function(a){for(var o in this.binders){var u=this.binders[o];(u instanceof Oi||u instanceof ei||u instanceof vi)&&u.upload(a)}this.updatePaintBuffers()},fi.prototype.destroy=function(){for(var a in this.binders){var o=this.binders[a];(o instanceof Oi||o instanceof ei||o instanceof vi)&&o.destroy()}};var Di=function(o,u,p){p===void 0&&(p=function(){return!0}),this.programConfigurations={};for(var y=0,b=o;y<b.length;y+=1){var S=b[y];this.programConfigurations[S.id]=new fi(S,u,p)}this.needsUpload=!1,this._featureMap=new St,this._bufferOffset=0};function Ji(a,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(o+"-","").replace(/-/g,"_")]}function yo(a,o,u){var p={color:{source:Tc,composite:yf},number:{source:Wn,composite:Tc}},y=function(b){return{"line-pattern":{source:Wu,composite:Wu},"fill-pattern":{source:Wu,composite:Wu},"fill-extrusion-pattern":{source:Wu,composite:Wu}}[b]}(a);return y&&y[u]||p[o][u]}Di.prototype.populatePaintArrays=function(a,o,u,p,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(a,o,p,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0},Di.prototype.updatePaintArrays=function(a,o,u,p){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,o,S,p)||this.needsUpload}},Di.prototype.get=function(a){return this.programConfigurations[a]},Di.prototype.upload=function(a){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(a);this.needsUpload=!1}},Di.prototype.destroy=function(){for(var a in this.programConfigurations)this.programConfigurations[a].destroy()},Ln("ConstantBinder",Bn),Ln("CrossFadedConstantBinder",Ei),Ln("SourceExpressionBinder",Oi),Ln("CrossFadedCompositeBinder",vi),Ln("CompositeExpressionBinder",ei),Ln("ProgramConfiguration",fi,{omit:["_buffers"]}),Ln("ProgramConfigurationSet",Di);var co=Math.pow(2,14)-1,Bo=-co-1;function $a(a){for(var o=8192/a.extent,u=a.loadGeometry(),p=0;p<u.length;p++)for(var y=u[p],b=0;b<y.length;b++){var S=y[b],M=Math.round(S.x*o),D=Math.round(S.y*o);S.x=vt(M,Bo,co),S.y=vt(D,Bo,co),(M<S.x||M>S.x+1||D<S.y||D>S.y+1)&&Zt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function fo(a,o){return{type:a.type,id:a.id,properties:a.properties,geometry:o?$a(a):[]}}function Rs(a,o,u,p,y){a.emplaceBack(2*o+(p+1)/2,2*u+(y+1)/2)}var fs=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Pl,this.indexArray=new Zl,this.segments=new ve,this.programConfigurations=new Di(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Ol(a,o){for(var u=0;u<a.length;u++)if(iu(o,a[u]))return!0;for(var p=0;p<o.length;p++)if(iu(a,o[p]))return!0;return!!lc(a,o)}function Il(a,o,u){return!!iu(a,o)||!!Zu(o,a,u)}function Es(a,o){if(a.length===1)return Mu(o,a[0]);for(var u=0;u<o.length;u++)for(var p=o[u],y=0;y<p.length;y++)if(iu(a,p[y]))return!0;for(var b=0;b<a.length;b++)if(Mu(o,a[b]))return!0;for(var S=0;S<o.length;S++)if(lc(a,o[S]))return!0;return!1}function ts(a,o,u){if(a.length>1){if(lc(a,o))return!0;for(var p=0;p<o.length;p++)if(Zu(o[p],a,u))return!0}for(var y=0;y<a.length;y++)if(Zu(a[y],o,u))return!0;return!1}function lc(a,o){if(a.length===0||o.length===0)return!1;for(var u=0;u<a.length-1;u++)for(var p=a[u],y=a[u+1],b=0;b<o.length-1;b++)if(cc(p,y,o[b],o[b+1]))return!0;return!1}function cc(a,o,u,p){return ir(a,u,p)!==ir(o,u,p)&&ir(a,o,u)!==ir(a,o,p)}function Zu(a,o,u){var p=u*u;if(o.length===1)return a.distSqr(o[0])<p;for(var y=1;y<o.length;y++)if(Tu(a,o[y-1],o[y])<p)return!0;return!1}function Tu(a,o,u){var p=o.distSqr(u);if(p===0)return a.distSqr(o);var y=((a.x-o.x)*(u.x-o.x)+(a.y-o.y)*(u.y-o.y))/p;return a.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Mu(a,o){for(var u,p,y,b=!1,S=0;S<a.length;S++)for(var M=0,D=(u=a[S]).length-1;M<u.length;D=M++)(p=u[M]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-p.x)*(o.y-p.y)/(y.y-p.y)+p.x&&(b=!b);return b}function iu(a,o){for(var u=!1,p=0,y=a.length-1;p<a.length;y=p++){var b=a[p],S=a[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function Xu(a,o,u){var p=u[0],y=u[2];if(a.x<p.x&&o.x<p.x||a.x>y.x&&o.x>y.x||a.y<p.y&&o.y<p.y||a.y>y.y&&o.y>y.y)return!1;var b=ir(a,o,u[0]);return b!==ir(a,o,u[1])||b!==ir(a,o,u[2])||b!==ir(a,o,u[3])}function Gs(a,o,u){var p=o.paint.get(a).value;return p.kind==="constant"?p.value:u.programConfigurations.get(o.id).getMaxValue(a)}function La(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Yu(a,o,u,p,y){if(!o[0]&&!o[1])return a;var b=xe.convert(o)._mult(y);u==="viewport"&&b._rotate(-p);for(var S=[],M=0;M<a.length;M++)S.push(a[M].sub(b));return S}fs.prototype.populate=function(a,o,u){var p=this.layers[0],y=[],b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(var S=0,M=a;S<M.length;S+=1){var D=M[S],B=D.feature,Z=D.id,q=D.index,ee=D.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Le=fo(B,_e);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),Le,u)){var Ie=b?b.evaluate(Le,{},u):void 0,Ye={id:Z,properties:B.properties,type:B.type,sourceLayerIndex:ee,index:q,geometry:_e?Le.geometry:$a(B),patterns:{},sortKey:Ie};y.push(Ye)}}b&&y.sort(function(tn,Gn){return tn.sortKey-Gn.sortKey});for(var Xe=0,gt=y;Xe<gt.length;Xe+=1){var Dt=gt[Xe],Xt=Dt.geometry,yr=Dt.index,or=Dt.sourceLayerIndex,Jr=a[yr].feature;this.addFeature(Dt,Xt,yr,u),o.featureIndex.insert(Jr,Xt,yr,or,this.index)}},fs.prototype.update=function(a,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,o,this.stateDependentLayers,u)},fs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fs.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ce),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fs.prototype.addFeature=function(a,o,u,p){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,M=b[y];S<M.length;S+=1){var D=M[S],B=D.x,Z=D.y;if(!(B<0||B>=8192||Z<0||Z>=8192)){var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),ee=q.vertexLength;Rs(this.layoutVertexArray,B,Z,-1,-1),Rs(this.layoutVertexArray,B,Z,1,-1),Rs(this.layoutVertexArray,B,Z,1,1),Rs(this.layoutVertexArray,B,Z,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),q.vertexLength+=4,q.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,u,{},p)},Ln("CircleBucket",fs,{omit:["layers"]});var _f=new Jo({"circle-sort-key":new Kn(pe.layout_circle["circle-sort-key"])}),Rl={paint:new Jo({"circle-radius":new Kn(pe.paint_circle["circle-radius"]),"circle-color":new Kn(pe.paint_circle["circle-color"]),"circle-blur":new Kn(pe.paint_circle["circle-blur"]),"circle-opacity":new Kn(pe.paint_circle["circle-opacity"]),"circle-translate":new si(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new si(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new si(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new si(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kn(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kn(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kn(pe.paint_circle["circle-stroke-opacity"])}),layout:_f},Wo=typeof Float32Array!="undefined"?Float32Array:Array;function ks(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Zo(a,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],M=o[4],D=o[5],B=o[6],Z=o[7],q=o[8],ee=o[9],_e=o[10],Le=o[11],Ie=o[12],Ye=o[13],Xe=o[14],gt=o[15],Dt=u[0],Xt=u[1],yr=u[2],or=u[3];return a[0]=Dt*p+Xt*M+yr*q+or*Ie,a[1]=Dt*y+Xt*D+yr*ee+or*Ye,a[2]=Dt*b+Xt*B+yr*_e+or*Xe,a[3]=Dt*S+Xt*Z+yr*Le+or*gt,a[4]=(Dt=u[4])*p+(Xt=u[5])*M+(yr=u[6])*q+(or=u[7])*Ie,a[5]=Dt*y+Xt*D+yr*ee+or*Ye,a[6]=Dt*b+Xt*B+yr*_e+or*Xe,a[7]=Dt*S+Xt*Z+yr*Le+or*gt,a[8]=(Dt=u[8])*p+(Xt=u[9])*M+(yr=u[10])*q+(or=u[11])*Ie,a[9]=Dt*y+Xt*D+yr*ee+or*Ye,a[10]=Dt*b+Xt*B+yr*_e+or*Xe,a[11]=Dt*S+Xt*Z+yr*Le+or*gt,a[12]=(Dt=u[12])*p+(Xt=u[13])*M+(yr=u[14])*q+(or=u[15])*Ie,a[13]=Dt*y+Xt*D+yr*ee+or*Ye,a[14]=Dt*b+Xt*B+yr*_e+or*Xe,a[15]=Dt*S+Xt*Z+yr*Le+or*gt,a}Math.hypot||(Math.hypot=function(){for(var a=arguments,o=0,u=arguments.length;u--;)o+=a[u]*a[u];return Math.sqrt(o)});var Hs,hs=Zo;function Ls(a,o,u){var p=o[0],y=o[1],b=o[2],S=o[3];return a[0]=u[0]*p+u[4]*y+u[8]*b+u[12]*S,a[1]=u[1]*p+u[5]*y+u[9]*b+u[13]*S,a[2]=u[2]*p+u[6]*y+u[10]*b+u[14]*S,a[3]=u[3]*p+u[7]*y+u[11]*b+u[15]*S,a}Hs=new Wo(3),Wo!=Float32Array&&(Hs[0]=0,Hs[1]=0,Hs[2]=0),function(){var a=new Wo(4);Wo!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var xf=(function(){var a=new Wo(2);Wo!=Float32Array&&(a[0]=0,a[1]=0)}(),function(a){function o(u){a.call(this,u,Rl)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.createBucket=function(u){return new fs(u)},o.prototype.queryRadius=function(u){var p=u;return Gs("circle-radius",this,p)+Gs("circle-stroke-width",this,p)+La(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,M,D,B){for(var Z=Yu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,D),q=this.paint.get("circle-radius").evaluate(p,y)+this.paint.get("circle-stroke-width").evaluate(p,y),ee=this.paint.get("circle-pitch-alignment")==="map",_e=ee?Z:function(Jr,tn){return Jr.map(function(Gn){return kl(Gn,tn)})}(Z,B),Le=ee?q*D:q,Ie=0,Ye=b;Ie<Ye.length;Ie+=1)for(var Xe=0,gt=Ye[Ie];Xe<gt.length;Xe+=1){var Dt=gt[Xe],Xt=ee?Dt:kl(Dt,B),yr=Le,or=Ls([],[Dt.x,Dt.y,0,1],B);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?yr*=or[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(yr*=M.cameraToCenterDistance/or[3]),Il(_e,Xt,yr))return!0}return!1},o}(Vu));function kl(a,o){var u=Ls([],[a.x,a.y,0,1],o);return new xe(u[0]/u[3],u[1]/u[3])}var vu=function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o}(fs);function $u(a,o,u,p){var y=o.width,b=o.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==y*b*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(y*b*u);return a.width=y,a.height=b,a.data=p,a}function Ku(a,o,u){var p=o.width,y=o.height;if(p!==a.width||y!==a.height){var b=$u({},{width:p,height:y},u);Pu(a,b,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,p),height:Math.min(a.height,y)},u),a.width=p,a.height=y,a.data=b.data}}function Pu(a,o,u,p,y,b){if(y.width===0||y.height===0)return o;if(y.width>a.width||y.height>a.height||u.x>a.width-y.width||u.y>a.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||p.x>o.width-y.width||p.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=a.data,M=o.data,D=0;D<y.height;D++)for(var B=((u.y+D)*a.width+u.x)*b,Z=((p.y+D)*o.width+p.x)*b,q=0;q<y.width*b;q++)M[Z+q]=S[B+q];return o}Ln("HeatmapBucket",vu,{omit:["layers"]});var ps=function(o,u){$u(this,o,1,u)};ps.prototype.resize=function(a){Ku(this,a,1)},ps.prototype.clone=function(){return new ps({width:this.width,height:this.height},new Uint8Array(this.data))},ps.copy=function(a,o,u,p,y){Pu(a,o,u,p,y,1)};var Ua=function(o,u){$u(this,o,4,u)};Ua.prototype.resize=function(a){Ku(this,a,4)},Ua.prototype.replace=function(a,o){o?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a},Ua.prototype.clone=function(){return new Ua({width:this.width,height:this.height},new Uint8Array(this.data))},Ua.copy=function(a,o,u,p,y){Pu(a,o,u,p,y,4)},Ln("AlphaImage",ps),Ln("RGBAImage",Ua);var hh={paint:new Jo({"heatmap-radius":new Kn(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kn(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new si(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new si(pe.paint_heatmap["heatmap-opacity"])})};function bf(a){var o={},u=a.resolution||256,p=a.clips?a.clips.length:1,y=a.image||new Ua({width:u,height:p}),b=function(Ie,Ye,Xe){o[a.evaluationKey]=Xe;var gt=a.expression.evaluate(o);y.data[Ie+Ye+0]=Math.floor(255*gt.r/gt.a),y.data[Ie+Ye+1]=Math.floor(255*gt.g/gt.a),y.data[Ie+Ye+2]=Math.floor(255*gt.b/gt.a),y.data[Ie+Ye+3]=Math.floor(255*gt.a)};if(a.clips)for(var S=0,M=0;S<p;++S,M+=4*u)for(var D=0,B=0;D<u;D++,B+=4){var Z=D/(u-1),q=a.clips[S];b(M,B,q.start*(1-Z)+q.end*Z)}else for(var ee=0,_e=0;ee<u;ee++,_e+=4)b(0,_e,ee/(u-1));return y}var ph=function(a){function o(u){a.call(this,u,hh),this._updateColorRamp()}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.createBucket=function(u){return new vu(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=bf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(Vu),Bh={paint:new Jo({"hillshade-illumination-direction":new si(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new si(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new si(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new si(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new si(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new si(pe.paint_hillshade["hillshade-accent-color"])})},Ef=function(a){function o(u){a.call(this,u,Bh)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(Vu),Gf=es([{name:"a_pos",components:2,type:"Int16"}],4).members,ul=dh,bp=dh;function dh(a,o,u){u=u||2;var p,y,b,S,M,D,B,Z=o&&o.length,q=Z?o[0]*u:a.length,ee=Ka(a,0,q,u,!0),_e=[];if(!ee||ee.next===ee.prev)return _e;if(Z&&(ee=function(Ie,Ye,Xe,gt){var Dt,Xt,yr,or=[];for(Dt=0,Xt=Ye.length;Dt<Xt;Dt++)(yr=Ka(Ie,Ye[Dt]*gt,Dt<Xt-1?Ye[Dt+1]*gt:Ie.length,gt,!1))===yr.next&&(yr.steiner=!0),or.push(Sd(yr));for(or.sort(rs),Dt=0;Dt<or.length;Dt++)bd(or[Dt],Xe),Xe=Ou(Xe,Xe.next);return Xe}(a,o,ee,u)),a.length>80*u){p=b=a[0],y=S=a[1];for(var Le=u;Le<q;Le+=u)(M=a[Le])<p&&(p=M),(D=a[Le+1])<y&&(y=D),M>b&&(b=M),D>S&&(S=D);B=(B=Math.max(b-p,S-y))!==0?1/B:0}return fc(ee,_e,u,p,y,B),_e}function Ka(a,o,u,p,y){var b,S;if(y===ll(a,o,u,p)>0)for(b=o;b<u;b+=p)S=gh(b,a[b],a[b+1],S);else for(b=u-p;b>=o;b-=p)S=gh(b,a[b],a[b+1],S);return S&&zh(S,S.next)&&(Ws(S),S=S.next),S}function Ou(a,o){if(!a)return a;o||(o=a);var u,p=a;do if(u=!1,p.steiner||!zh(p,p.next)&&No(p.prev,p,p.next)!==0)p=p.next;else{if(Ws(p),(p=o=p.prev)===p.next)break;u=!0}while(u||p!==o);return o}function fc(a,o,u,p,y,b,S){if(a){!S&&b&&function(Z,q,ee,_e){var Le=Z;do Le.z===null&&(Le.z=vh(Le.x,Le.y,q,ee,_e)),Le.prevZ=Le.prev,Le.nextZ=Le.next,Le=Le.next;while(Le!==Z);Le.prevZ.nextZ=null,Le.prevZ=null,function(Ie){var Ye,Xe,gt,Dt,Xt,yr,or,Jr,tn=1;do{for(Xe=Ie,Ie=null,Xt=null,yr=0;Xe;){for(yr++,gt=Xe,or=0,Ye=0;Ye<tn&&(or++,gt=gt.nextZ);Ye++);for(Jr=tn;or>0||Jr>0&&gt;)or!==0&&(Jr===0||!gt||Xe.z<=gt.z)?(Dt=Xe,Xe=Xe.nextZ,or--):(Dt=gt,gt=gt.nextZ,Jr--),Xt?Xt.nextZ=Dt:Ie=Dt,Dt.prevZ=Xt,Xt=Dt;Xe=gt}Xt.nextZ=null,tn*=2}while(yr>1)}(Le)}(a,p,y,b);for(var M,D,B=a;a.prev!==a.next;)if(M=a.prev,D=a.next,b?Hf(a,p,y,b):Oc(a))o.push(M.i/u),o.push(a.i/u),o.push(D.i/u),Ws(a),a=D.next,B=D.next;else if((a=D)===B){S?S===1?fc(a=Nh(Ou(a),o,u),o,u,p,y,b,2):S===2&&xd(a,o,u,p,y,b):fc(Ou(a),o,u,p,y,b,1);break}}}function Oc(a){var o=a.prev,u=a,p=a.next;if(No(o,u,p)>=0)return!1;for(var y=a.next.next;y!==a.prev;){if(Sf(o.x,o.y,u.x,u.y,p.x,p.y,y.x,y.y)&&No(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Hf(a,o,u,p){var y=a.prev,b=a,S=a.next;if(No(y,b,S)>=0)return!1;for(var M=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,B=vh(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,p),Z=vh(M,D,o,u,p),q=a.prevZ,ee=a.nextZ;q&&q.z>=B&&ee&&ee.z<=Z;){if(q!==a.prev&&q!==a.next&&Sf(y.x,y.y,b.x,b.y,S.x,S.y,q.x,q.y)&&No(q.prev,q,q.next)>=0||(q=q.prevZ,ee!==a.prev&&ee!==a.next&&Sf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&No(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;q&&q.z>=B;){if(q!==a.prev&&q!==a.next&&Sf(y.x,y.y,b.x,b.y,S.x,S.y,q.x,q.y)&&No(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;ee&&ee.z<=Z;){if(ee!==a.prev&&ee!==a.next&&Sf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&No(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Nh(a,o,u){var p=a;do{var y=p.prev,b=p.next.next;!zh(y,b)&&Ep(y,p,p.next,b)&&Ic(y,b)&&Ic(b,y)&&(o.push(y.i/u),o.push(p.i/u),o.push(b.i/u),Ws(p),Ws(p.next),p=a=b),p=p.next}while(p!==a);return Ou(p)}function xd(a,o,u,p,y,b){var S=a;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Cd(S,M)){var D=mh(S,M);return S=Ou(S,S.next),D=Ou(D,D.next),fc(S,o,u,p,y,b),void fc(D,o,u,p,y,b)}M=M.next}S=S.next}while(S!==a)}function rs(a,o){return a.x-o.x}function bd(a,o){if(o=function(p,y){var b,S=y,M=p.x,D=p.y,B=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var Z=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=M&&Z>B){if(B=Z,Z===M){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(M===B)return b;var q,ee=b,_e=b.x,Le=b.y,Ie=1/0;S=b;do M>=S.x&&S.x>=_e&&M!==S.x&&Sf(D<Le?M:B,D,_e,Le,D<Le?B:M,D,S.x,S.y)&&(q=Math.abs(D-S.y)/(M-S.x),Ic(S,p)&&(q<Ie||q===Ie&&(S.x>b.x||S.x===b.x&&Ed(b,S)))&&(b=S,Ie=q)),S=S.next;while(S!==ee);return b}(a,o)){var u=mh(o,a);Ou(o,o.next),Ou(u,u.next)}}function Ed(a,o){return No(a.prev,a,o.prev)<0&&No(o.next,a,a.next)<0}function vh(a,o,u,p,y){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-u)*y)|a<<8))|a<<4))|a<<2))|a<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-p)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Sd(a){var o=a,u=a;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==a);return u}function Sf(a,o,u,p,y,b,S,M){return(y-S)*(o-M)-(a-S)*(b-M)>=0&&(a-S)*(p-M)-(u-S)*(o-M)>=0&&(u-S)*(b-M)-(y-S)*(p-M)>=0}function Cd(a,o){return a.next.i!==o.i&&a.prev.i!==o.i&&!function(u,p){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==p.i&&y.next.i!==p.i&&Ep(y,y.next,u,p))return!0;y=y.next}while(y!==u);return!1}(a,o)&&(Ic(a,o)&&Ic(o,a)&&function(u,p){var y=u,b=!1,S=(u.x+p.x)/2,M=(u.y+p.y)/2;do y.y>M!=y.next.y>M&&y.next.y!==y.y&&S<(y.next.x-y.x)*(M-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(a,o)&&(No(a.prev,a,o.prev)||No(a,o.prev,o))||zh(a,o)&&No(a.prev,a,a.next)>0&&No(o.prev,o,o.next)>0)}function No(a,o,u){return(o.y-a.y)*(u.x-o.x)-(o.x-a.x)*(u.y-o.y)}function zh(a,o){return a.x===o.x&&a.y===o.y}function Ep(a,o,u,p){var y=Wf(No(a,o,u)),b=Wf(No(a,o,p)),S=Wf(No(u,p,a)),M=Wf(No(u,p,o));return y!==b&&S!==M||!(y!==0||!Uh(a,u,o))||!(b!==0||!Uh(a,p,o))||!(S!==0||!Uh(u,a,p))||!(M!==0||!Uh(u,o,p))}function Uh(a,o,u){return o.x<=Math.max(a.x,u.x)&&o.x>=Math.min(a.x,u.x)&&o.y<=Math.max(a.y,u.y)&&o.y>=Math.min(a.y,u.y)}function Wf(a){return a>0?1:a<0?-1:0}function Ic(a,o){return No(a.prev,a,a.next)<0?No(a,o,a.next)>=0&&No(a,a.prev,o)>=0:No(a,o,a.prev)<0||No(a,a.next,o)<0}function mh(a,o){var u=new Zf(a.i,a.x,a.y),p=new Zf(o.i,o.x,o.y),y=a.next,b=o.prev;return a.next=o,o.prev=a,u.next=y,y.prev=u,p.next=u,u.prev=p,b.next=p,p.prev=b,p}function gh(a,o,u,p){var y=new Zf(a,o,u);return p?(y.next=p.next,y.prev=p,p.next.prev=y,p.next=y):(y.prev=y,y.next=y),y}function Ws(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Zf(a,o,u){this.i=a,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ll(a,o,u,p){for(var y=0,b=o,S=u-p;b<u;b+=p)y+=(a[S]-a[b])*(a[b+1]+a[S+1]),S=b;return y}function jh(a,o,u,p,y){(function b(S,M,D,B,Z){for(;B>D;){if(B-D>600){var q=B-D+1,ee=M-D+1,_e=Math.log(q),Le=.5*Math.exp(2*_e/3),Ie=.5*Math.sqrt(_e*Le*(q-Le)/q)*(ee-q/2<0?-1:1);b(S,M,Math.max(D,Math.floor(M-ee*Le/q+Ie)),Math.min(B,Math.floor(M+(q-ee)*Le/q+Ie)),Z)}var Ye=S[M],Xe=D,gt=B;for(Yl(S,D,M),Z(S[B],Ye)>0&&Yl(S,D,B);Xe<gt;){for(Yl(S,Xe,gt),Xe++,gt--;Z(S[Xe],Ye)<0;)Xe++;for(;Z(S[gt],Ye)>0;)gt--}Z(S[D],Ye)===0?Yl(S,D,gt):Yl(S,++gt,B),gt<=M&&(D=gt+1),M<=gt&&(B=gt-1)}})(a,o,u||0,p||a.length-1,y||Ds)}function Yl(a,o,u){var p=a[o];a[o]=a[u],a[u]=p}function Ds(a,o){return a<o?-1:a>o?1:0}function Zs(a,o){var u=a.length;if(u<=1)return[a];for(var p,y,b=[],S=0;S<u;S++){var M=Fr(a[S]);M!==0&&(a[S].area=Math.abs(M),y===void 0&&(y=M<0),y===M<0?(p&&b.push(p),p=[a[S]]):p.push(a[S]))}if(p&&b.push(p),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(jh(b[D],o,1,b[D].length-1,Vh),b[D]=b[D].slice(0,o));return b}function Vh(a,o){return o.area-a.area}function Cf(a,o,u){for(var p=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var M=S[b].paint.get(a+"-pattern");M.isConstant()||(y=!0);var D=M.constantOr(null);D&&(y=!0,p[D.to]=!0,p[D.from]=!0)}return y}function Rc(a,o,u,p,y){for(var b=y.patternDependencies,S=0,M=o;S<M.length;S+=1){var D=M[S],B=D.paint.get(a+"-pattern").value;if(B.kind!=="constant"){var Z=B.evaluate({zoom:p-1},u,{},y.availableImages),q=B.evaluate({zoom:p},u,{},y.availableImages),ee=B.evaluate({zoom:p+1},u,{},y.availableImages);q=q&&q.name?q.name:q,ee=ee&&ee.name?ee.name:ee,b[Z=Z&&Z.name?Z.name:Z]=!0,b[q]=!0,b[ee]=!0,u.patterns[D.id]={min:Z,mid:q,max:ee}}}return u}dh.deviation=function(a,o,u,p){var y=o&&o.length,b=Math.abs(ll(a,0,y?o[0]*u:a.length,u));if(y)for(var S=0,M=o.length;S<M;S++)b-=Math.abs(ll(a,o[S]*u,S<M-1?o[S+1]*u:a.length,u));var D=0;for(S=0;S<p.length;S+=3){var B=p[S]*u,Z=p[S+1]*u,q=p[S+2]*u;D+=Math.abs((a[B]-a[q])*(a[Z+1]-a[B+1])-(a[B]-a[Z])*(a[q+1]-a[B+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},dh.flatten=function(a){for(var o=a[0][0].length,u={vertices:[],holes:[],dimensions:o},p=0,y=0;y<a.length;y++){for(var b=0;b<a[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(a[y][b][S]);y>0&&u.holes.push(p+=a[y-1].length)}return u},ul.default=bp;var au=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Pl,this.indexArray=new Zl,this.indexArray2=new uc,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new ve,this.segments2=new ve,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};au.prototype.populate=function(a,o,u){this.hasPattern=Cf("fill",this.layers,o);for(var p=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=a;b<S.length;b+=1){var M=S[b],D=M.feature,B=M.id,Z=M.index,q=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,_e=fo(D,ee);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),_e,u)){var Le=p?p.evaluate(_e,{},u,o.availableImages):void 0,Ie={id:B,properties:D.properties,type:D.type,sourceLayerIndex:q,index:Z,geometry:ee?_e.geometry:$a(D),patterns:{},sortKey:Le};y.push(Ie)}}p&&y.sort(function(Jr,tn){return Jr.sortKey-tn.sortKey});for(var Ye=0,Xe=y;Ye<Xe.length;Ye+=1){var gt=Xe[Ye],Dt=gt.geometry,Xt=gt.index,yr=gt.sourceLayerIndex;if(this.hasPattern){var or=Rc("fill",this.layers,gt,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(gt,Dt,Xt,u,{});o.featureIndex.insert(a[Xt].feature,Dt,Xt,yr,this.index)}},au.prototype.update=function(a,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,o,this.stateDependentLayers,u)},au.prototype.addFeatures=function(a,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},au.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},au.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},au.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Gf),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0},au.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},au.prototype.addFeature=function(a,o,u,p,y){for(var b=0,S=Zs(o,500);b<S.length;b+=1){for(var M=S[b],D=0,B=0,Z=M;B<Z.length;B+=1)D+=Z[B].length;for(var q=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),ee=q.vertexLength,_e=[],Le=[],Ie=0,Ye=M;Ie<Ye.length;Ie+=1){var Xe=Ye[Ie];if(Xe.length!==0){Xe!==M[0]&&Le.push(_e.length/2);var gt=this.segments2.prepareSegment(Xe.length,this.layoutVertexArray,this.indexArray2),Dt=gt.vertexLength;this.layoutVertexArray.emplaceBack(Xe[0].x,Xe[0].y),this.indexArray2.emplaceBack(Dt+Xe.length-1,Dt),_e.push(Xe[0].x),_e.push(Xe[0].y);for(var Xt=1;Xt<Xe.length;Xt++)this.layoutVertexArray.emplaceBack(Xe[Xt].x,Xe[Xt].y),this.indexArray2.emplaceBack(Dt+Xt-1,Dt+Xt),_e.push(Xe[Xt].x),_e.push(Xe[Xt].y);gt.vertexLength+=Xe.length,gt.primitiveLength+=Xe.length}}for(var yr=ul(_e,Le),or=0;or<yr.length;or+=3)this.indexArray.emplaceBack(ee+yr[or],ee+yr[or+1],ee+yr[or+2]);q.vertexLength+=D,q.primitiveLength+=yr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,u,y,p)},Ln("FillBucket",au,{omit:["layers","patternFeatures"]});var Xf=new Jo({"fill-sort-key":new Kn(pe.layout_fill["fill-sort-key"])}),Yf={paint:new Jo({"fill-antialias":new si(pe.paint_fill["fill-antialias"]),"fill-opacity":new Kn(pe.paint_fill["fill-opacity"]),"fill-color":new Kn(pe.paint_fill["fill-color"]),"fill-outline-color":new Kn(pe.paint_fill["fill-outline-color"]),"fill-translate":new si(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new si(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new df(pe.paint_fill["fill-pattern"])}),layout:Xf},Sp=function(a){function o(u){a.call(this,u,Yf)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.recalculate=function(u,p){a.prototype.recalculate.call(this,u,p);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new au(u)},o.prototype.queryRadius=function(){return La(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,M,D){return Es(Yu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(Vu),yh=es([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,kc=Lc;function Lc(a,o,u,p,y){this.properties={},this.extent=u,this.type=0,this._pbf=a,this._geometry=-1,this._keys=p,this._values=y,a.readFields(Cp,this,o)}function Cp(a,o,u){a==1?o.id=u.readVarint():a==2?function(p,y){for(var b=p.readVarint()+p.pos;p.pos<b;){var S=y._keys[p.readVarint()],M=y._values[p.readVarint()];y.properties[S]=M}}(u,o):a==3?o.type=u.readVarint():a==4&&(o._geometry=u.pos)}function bv(a){for(var o,u,p=0,y=0,b=a.length,S=b-1;y<b;S=y++)p+=((u=a[S]).x-(o=a[y]).x)*(o.y+u.y);return p}Lc.types=["Unknown","Point","LineString","Polygon"],Lc.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var o,u=a.readVarint()+a.pos,p=1,y=0,b=0,S=0,M=[];a.pos<u;){if(y<=0){var D=a.readVarint();p=7&D,y=D>>3}if(y--,p===1||p===2)b+=a.readSVarint(),S+=a.readSVarint(),p===1&&(o&&M.push(o),o=[]),o.push(new xe(b,S));else{if(p!==7)throw new Error("unknown command "+p);o&&o.push(o[0].clone())}}return o&&M.push(o),M},Lc.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var o=a.readVarint()+a.pos,u=1,p=0,y=0,b=0,S=1/0,M=-1/0,D=1/0,B=-1/0;a.pos<o;){if(p<=0){var Z=a.readVarint();u=7&Z,p=Z>>3}if(p--,u===1||u===2)(y+=a.readSVarint())<S&&(S=y),y>M&&(M=y),(b+=a.readSVarint())<D&&(D=b),b>B&&(B=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,M,B]},Lc.prototype.toGeoJSON=function(a,o,u){var p,y,b=this.extent*Math.pow(2,u),S=this.extent*a,M=this.extent*o,D=this.loadGeometry(),B=Lc.types[this.type];function Z(_e){for(var Le=0;Le<_e.length;Le++){var Ie=_e[Le];_e[Le]=[360*(Ie.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ie.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(p=0;p<D.length;p++)q[p]=D[p][0];Z(D=q);break;case 2:for(p=0;p<D.length;p++)Z(D[p]);break;case 3:for(D=function(_e){var Le=_e.length;if(Le<=1)return[_e];for(var Ie,Ye,Xe=[],gt=0;gt<Le;gt++){var Dt=bv(_e[gt]);Dt!==0&&(Ye===void 0&&(Ye=Dt<0),Ye===Dt<0?(Ie&&Xe.push(Ie),Ie=[_e[gt]]):Ie.push(_e[gt]))}return Ie&&Xe.push(Ie),Xe}(D),p=0;p<D.length;p++)for(y=0;y<D[p].length;y++)Z(D[p][y])}D.length===1?D=D[0]:B="Multi"+B;var ee={type:"Feature",geometry:{type:B,coordinates:D},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var wd=wp;function wp(a,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(Ll,this,o),this.length=this._features.length}function Ll(a,o,u){a===15?o.version=u.readVarint():a===1?o.name=u.readString():a===5?o.extent=u.readVarint():a===2?o._features.push(u.pos):a===3?o._keys.push(u.readString()):a===4&&o._values.push(function(p){for(var y=null,b=p.readVarint()+p.pos;p.pos<b;){var S=p.readVarint()>>3;y=S===1?p.readString():S===2?p.readFloat():S===3?p.readDouble():S===4?p.readVarint64():S===5?p.readVarint():S===6?p.readSVarint():S===7?p.readBoolean():null}return y}(u))}function Ad(a,o,u){if(a===3){var p=new wd(u,u.readVarint()+u.pos);p.length&&(o[p.name]=p)}}wp.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var o=this._pbf.readVarint()+this._pbf.pos;return new kc(this._pbf,o,this.extent,this._keys,this._values)};var wf={VectorTile:function(o,u){this.layers=o.readFields(Ad,{},u)},VectorTileFeature:kc,VectorTileLayer:wd},Td=wf.VectorTileFeature.types,Ap=Math.pow(2,13);function $f(a,o,u,p,y,b,S,M){a.emplaceBack(o,u,2*Math.floor(p*Ap)+S,y*Ap*2,b*Ap*2,Math.round(M))}var cl=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Hu,this.indexArray=new Zl,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new ve,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function $l(a,o){return a.x===o.x&&(a.x<0||a.x>8192)||a.y===o.y&&(a.y<0||a.y>8192)}cl.prototype.populate=function(a,o,u){this.features=[],this.hasPattern=Cf("fill-extrusion",this.layers,o);for(var p=0,y=a;p<y.length;p+=1){var b=y[p],S=b.feature,M=b.id,D=b.index,B=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,q=fo(S,Z);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),q,u)){var ee={id:M,sourceLayerIndex:B,index:D,geometry:Z?q.geometry:$a(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Rc("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,D,u,{}),o.featureIndex.insert(S,ee.geometry,D,B,this.index,!0)}}},cl.prototype.addFeatures=function(a,o,u){for(var p=0,y=this.features;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},cl.prototype.update=function(a,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,o,this.stateDependentLayers,u)},cl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},cl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},cl.prototype.upload=function(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,yh),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},cl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},cl.prototype.addFeature=function(a,o,u,p,y){for(var b=0,S=Zs(o,500);b<S.length;b+=1){for(var M=S[b],D=0,B=0,Z=M;B<Z.length;B+=1)D+=Z[B].length;for(var q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,_e=M;ee<_e.length;ee+=1){var Le=_e[ee];if(Le.length!==0&&!((ea=Le).every(function(Ri){return Ri.x<0})||ea.every(function(Ri){return Ri.x>8192})||ea.every(function(Ri){return Ri.y<0})||ea.every(function(Ri){return Ri.y>8192})))for(var Ie=0,Ye=0;Ye<Le.length;Ye++){var Xe=Le[Ye];if(Ye>=1){var gt=Le[Ye-1];if(!$l(Xe,gt)){q.vertexLength+4>ve.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Dt=Xe.sub(gt)._perp()._unit(),Xt=gt.dist(Xe);Ie+Xt>32768&&(Ie=0),$f(this.layoutVertexArray,Xe.x,Xe.y,Dt.x,Dt.y,0,0,Ie),$f(this.layoutVertexArray,Xe.x,Xe.y,Dt.x,Dt.y,0,1,Ie),$f(this.layoutVertexArray,gt.x,gt.y,Dt.x,Dt.y,0,0,Ie+=Xt),$f(this.layoutVertexArray,gt.x,gt.y,Dt.x,Dt.y,0,1,Ie);var yr=q.vertexLength;this.indexArray.emplaceBack(yr,yr+2,yr+1),this.indexArray.emplaceBack(yr+1,yr+2,yr+3),q.vertexLength+=4,q.primitiveLength+=2}}}}if(q.vertexLength+D>ve.MAX_VERTEX_ARRAY_LENGTH&&(q=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Td[a.type]==="Polygon"){for(var or=[],Jr=[],tn=q.vertexLength,Gn=0,ti=M;Gn<ti.length;Gn+=1){var Qn=ti[Gn];if(Qn.length!==0){Qn!==M[0]&&Jr.push(or.length/2);for(var Nn=0;Nn<Qn.length;Nn++){var wi=Qn[Nn];$f(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),or.push(wi.x),or.push(wi.y)}}}for(var ui=ul(or,Jr),ri=0;ri<ui.length;ri+=3)this.indexArray.emplaceBack(tn+ui[ri],tn+ui[ri+2],tn+ui[ri+1]);q.primitiveLength+=ui.length/3,q.vertexLength+=D}}var ea;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,u,y,p)},Ln("FillExtrusionBucket",cl,{omit:["layers","features"]});var Tp={paint:new Jo({"fill-extrusion-opacity":new si(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kn(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new si(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new si(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new df(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kn(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kn(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new si(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Dc=function(a){function o(u){a.call(this,u,Tp)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.createBucket=function(u){return new cl(u)},o.prototype.queryRadius=function(){return La(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,M,D,B){var Z=Yu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,D),q=this.paint.get("fill-extrusion-height").evaluate(p,y),ee=this.paint.get("fill-extrusion-base").evaluate(p,y),_e=function(Ie,Ye,Xe,gt){for(var Dt=[],Xt=0,yr=Ie;Xt<yr.length;Xt+=1){var or=yr[Xt],Jr=[or.x,or.y,0,1];Ls(Jr,Jr,Ye),Dt.push(new xe(Jr[0]/Jr[3],Jr[1]/Jr[3]))}return Dt}(Z,B),Le=function(Ie,Ye,Xe,gt){for(var Dt=[],Xt=[],yr=gt[8]*Ye,or=gt[9]*Ye,Jr=gt[10]*Ye,tn=gt[11]*Ye,Gn=gt[8]*Xe,ti=gt[9]*Xe,Qn=gt[10]*Xe,Nn=gt[11]*Xe,wi=0,ui=Ie;wi<ui.length;wi+=1){for(var ri=[],ea=[],Ri=0,Aa=ui[wi];Ri<Aa.length;Ri+=1){var _i=Aa[Ri],oa=_i.x,qa=_i.y,Qa=gt[0]*oa+gt[4]*qa+gt[12],bo=gt[1]*oa+gt[5]*qa+gt[13],Eo=gt[2]*oa+gt[6]*qa+gt[14],Oo=gt[3]*oa+gt[7]*qa+gt[15],Ns=Eo+Jr,Yo=Oo+tn,ou=Qa+Gn,Cs=bo+ti,su=Eo+Qn,ms=Oo+Nn,os=new xe((Qa+yr)/Yo,(bo+or)/Yo);os.z=Ns/Yo,ri.push(os);var gs=new xe(ou/ms,Cs/ms);gs.z=su/ms,ea.push(gs)}Dt.push(ri),Xt.push(ea)}return[Dt,Xt]}(b,ee,q,B);return function(Ie,Ye,Xe){var gt=1/0;Es(Xe,Ye)&&(gt=Mp(Xe,Ye[0]));for(var Dt=0;Dt<Ye.length;Dt++)for(var Xt=Ye[Dt],yr=Ie[Dt],or=0;or<Xt.length-1;or++){var Jr=Xt[or],tn=[Jr,Xt[or+1],yr[or+1],yr[or],Jr];Ol(Xe,tn)&&(gt=Math.min(gt,Mp(Xe,tn)))}return gt!==1/0&&gt}(Le[0],Le[1],_e)},o}(Vu);function fl(a,o){return a.x*o.x+a.y*o.y}function Mp(a,o){if(a.length===1){for(var u,p=0,y=o[p++];!u||y.equals(u);)if(!(u=o[p++]))return 1/0;for(;p<o.length;p++){var b=o[p],S=a[0],M=u.sub(y),D=b.sub(y),B=S.sub(y),Z=fl(M,M),q=fl(M,D),ee=fl(D,D),_e=fl(B,M),Le=fl(B,D),Ie=Z*ee-q*q,Ye=(ee*_e-q*Le)/Ie,Xe=(Z*Le-q*_e)/Ie,gt=y.z*(1-Ye-Xe)+u.z*Ye+b.z*Xe;if(isFinite(gt))return gt}return 1/0}for(var Dt=1/0,Xt=0,yr=o;Xt<yr.length;Xt+=1)Dt=Math.min(Dt,yr[Xt].z);return Dt}var Pp=es([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Gh=es([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Md=wf.VectorTileFeature.types,ds=Math.cos(Math.PI/180*37.5),Iu=Math.pow(2,14)/.5,ba=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(p){return p.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(p){u.gradients[p.id]={}}),this.layoutVertexArray=new nu,this.layoutVertexArray2=new Tc,this.indexArray=new Zl,this.programConfigurations=new Di(o.layers,o.zoom),this.segments=new ve,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(p){return p.isStateDependent()}).map(function(p){return p.id})};ba.prototype.populate=function(a,o,u){this.hasPattern=Cf("line",this.layers,o);for(var p=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=a;b<S.length;b+=1){var M=S[b],D=M.feature,B=M.id,Z=M.index,q=M.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,_e=fo(D,ee);if(this.layers[0]._featureFilter.filter(new $i(this.zoom),_e,u)){var Le=p?p.evaluate(_e,{},u):void 0,Ie={id:B,properties:D.properties,type:D.type,sourceLayerIndex:q,index:Z,geometry:ee?_e.geometry:$a(D),patterns:{},sortKey:Le};y.push(Ie)}}p&&y.sort(function(Jr,tn){return Jr.sortKey-tn.sortKey});for(var Ye=0,Xe=y;Ye<Xe.length;Ye+=1){var gt=Xe[Ye],Dt=gt.geometry,Xt=gt.index,yr=gt.sourceLayerIndex;if(this.hasPattern){var or=Rc("line",this.layers,gt,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(gt,Dt,Xt,u,{});o.featureIndex.insert(a[Xt].feature,Dt,Xt,yr,this.index)}},ba.prototype.update=function(a,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,o,this.stateDependentLayers,u)},ba.prototype.addFeatures=function(a,o,u){for(var p=0,y=this.patternFeatures;p<y.length;p+=1){var b=y[p];this.addFeature(b,b.geometry,b.index,o,u)}},ba.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ba.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ba.prototype.upload=function(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Gh)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Pp),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0},ba.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ba.prototype.lineFeatureClips=function(a){if(a.properties&&a.properties.hasOwnProperty("mapbox_clip_start")&&a.properties.hasOwnProperty("mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}},ba.prototype.addFeature=function(a,o,u,p,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(a,{}),M=b.get("line-cap"),D=b.get("line-miter-limit"),B=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(var Z=0,q=o;Z<q.length;Z+=1)this.addLine(q[Z],a,S,M,D,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,u,y,p)},ba.prototype.addLine=function(a,o,u,p,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<a.length-1;S++)this.totalDistance+=a[S].dist(a[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Md[o.type]==="Polygon",D=a.length;D>=2&&a[D-1].equals(a[D-2]);)D--;for(var B=0;B<D-1&&a[B].equals(a[B+1]);)B++;if(!(D<(M?3:2))){u==="bevel"&&(y=1.05);var Z,q=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),_e=void 0,Le=void 0,Ie=void 0,Ye=void 0;this.e1=this.e2=-1,M&&(Ye=a[B].sub(Z=a[D-2])._unit()._perp());for(var Xe=B;Xe<D;Xe++)if(!(Le=Xe===D-1?M?a[B+1]:void 0:a[Xe+1])||!a[Xe].equals(Le)){Ye&&(Ie=Ye),Z&&(_e=Z),Z=a[Xe],Ye=Le?Le.sub(Z)._unit()._perp():Ie;var gt=(Ie=Ie||Ye).add(Ye);gt.x===0&&gt.y===0||gt._unit();var Dt=Ie.x*Ye.x+Ie.y*Ye.y,Xt=gt.x*Ye.x+gt.y*Ye.y,yr=Xt!==0?1/Xt:1/0,or=2*Math.sqrt(2-2*Xt),Jr=Xt<ds&&_e&&Le,tn=Ie.x*Ye.y-Ie.y*Ye.x>0;if(Jr&&Xe>B){var Gn=Z.dist(_e);if(Gn>2*q){var ti=Z.sub(Z.sub(_e)._mult(q/Gn)._round());this.updateDistance(_e,ti),this.addCurrentVertex(ti,Ie,0,0,ee),_e=ti}}var Qn=_e&&Le,Nn=Qn?u:M?"butt":p;if(Qn&&Nn==="round"&&(yr<b?Nn="miter":yr<=2&&(Nn="fakeround")),Nn==="miter"&&yr>y&&(Nn="bevel"),Nn==="bevel"&&(yr>2&&(Nn="flipbevel"),yr<y&&(Nn="miter")),_e&&this.updateDistance(_e,Z),Nn==="miter")gt._mult(yr),this.addCurrentVertex(Z,gt,0,0,ee);else if(Nn==="flipbevel"){if(yr>100)gt=Ye.mult(-1);else{var wi=yr*Ie.add(Ye).mag()/Ie.sub(Ye).mag();gt._perp()._mult(wi*(tn?-1:1))}this.addCurrentVertex(Z,gt,0,0,ee),this.addCurrentVertex(Z,gt.mult(-1),0,0,ee)}else if(Nn==="bevel"||Nn==="fakeround"){var ui=-Math.sqrt(yr*yr-1),ri=tn?ui:0,ea=tn?0:ui;if(_e&&this.addCurrentVertex(Z,Ie,ri,ea,ee),Nn==="fakeround")for(var Ri=Math.round(180*or/Math.PI/20),Aa=1;Aa<Ri;Aa++){var _i=Aa/Ri;if(_i!==.5){var oa=_i-.5;_i+=_i*oa*(_i-1)*((1.0904+Dt*(Dt*(3.55645-1.43519*Dt)-3.2452))*oa*oa+(.848013+Dt*(.215638*Dt-1.06021)))}var qa=Ye.sub(Ie)._mult(_i)._add(Ie)._unit()._mult(tn?-1:1);this.addHalfVertex(Z,qa.x,qa.y,!1,tn,0,ee)}Le&&this.addCurrentVertex(Z,Ye,-ri,-ea,ee)}else if(Nn==="butt")this.addCurrentVertex(Z,gt,0,0,ee);else if(Nn==="square"){var Qa=_e?1:-1;this.addCurrentVertex(Z,gt,Qa,Qa,ee)}else Nn==="round"&&(_e&&(this.addCurrentVertex(Z,Ie,0,0,ee),this.addCurrentVertex(Z,Ie,1,1,ee,!0)),Le&&(this.addCurrentVertex(Z,Ye,-1,-1,ee,!0),this.addCurrentVertex(Z,Ye,0,0,ee)));if(Jr&&Xe<D-1){var bo=Z.dist(Le);if(bo>2*q){var Eo=Z.add(Le.sub(Z)._mult(q/bo)._round());this.updateDistance(Z,Eo),this.addCurrentVertex(Eo,Ye,0,0,ee),Z=Eo}}}}},ba.prototype.addCurrentVertex=function(a,o,u,p,y,b){b===void 0&&(b=!1);var S=o.y*p-o.x,M=-o.y-o.x*p;this.addHalfVertex(a,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(a,S,M,b,!0,-p,y),this.distance>Iu/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(a,o,u,p,y,b))},ba.prototype.addHalfVertex=function(a,o,u,p,y,b,S){var M=.5*(this.lineClips?this.scaledDistance*(Iu-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a.x<<1)+(p?1:0),(a.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},ba.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},ba.prototype.updateDistance=function(a,o){this.distance+=a.dist(o),this.updateScaledDistance()},Ln("LineBucket",ba,{omit:["layers","patternFeatures"]});var Ru=new Jo({"line-cap":new si(pe.layout_line["line-cap"]),"line-join":new Kn(pe.layout_line["line-join"]),"line-miter-limit":new si(pe.layout_line["line-miter-limit"]),"line-round-limit":new si(pe.layout_line["line-round-limit"]),"line-sort-key":new Kn(pe.layout_line["line-sort-key"])}),Op={paint:new Jo({"line-opacity":new Kn(pe.paint_line["line-opacity"]),"line-color":new Kn(pe.paint_line["line-color"]),"line-translate":new si(pe.paint_line["line-translate"]),"line-translate-anchor":new si(pe.paint_line["line-translate-anchor"]),"line-width":new Kn(pe.paint_line["line-width"]),"line-gap-width":new Kn(pe.paint_line["line-gap-width"]),"line-offset":new Kn(pe.paint_line["line-offset"]),"line-blur":new Kn(pe.paint_line["line-blur"]),"line-dasharray":new bs(pe.paint_line["line-dasharray"]),"line-pattern":new df(pe.paint_line["line-pattern"]),"line-gradient":new du(pe.paint_line["line-gradient"])}),layout:Ru},Pd=new(function(a){function o(){a.apply(this,arguments)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,p){return p=new $i(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),a.prototype.possiblyEvaluate.call(this,u,p)},o.prototype.evaluate=function(u,p,y,b){return p=Ve({},p,{zoom:Math.floor(p.zoom)}),a.prototype.evaluate.call(this,u,p,y,b)},o}(Kn))(Op.paint.properties["line-width"].specification);Pd.useIntegerZoom=!0;var Od=function(a){function o(u){a.call(this,u,Op),this.gradientVersion=0}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ga,this.gradientVersion=(this.gradientVersion+1)%Mt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,p){a.prototype.recalculate.call(this,u,p),this.paint._values["line-floorwidth"]=Pd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new ba(u)},o.prototype.queryRadius=function(u){var p=u,y=Ip(Gs("line-width",this,p),Gs("line-gap-width",this,p)),b=Gs("line-offset",this,p);return y/2+Math.abs(b)+La(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,p,y,b,S,M,D){var B=Yu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,D),Z=D/2*Ip(this.paint.get("line-width").evaluate(p,y),this.paint.get("line-gap-width").evaluate(p,y)),q=this.paint.get("line-offset").evaluate(p,y);return q&&(b=function(ee,_e){for(var Le=[],Ie=new xe(0,0),Ye=0;Ye<ee.length;Ye++){for(var Xe=ee[Ye],gt=[],Dt=0;Dt<Xe.length;Dt++){var Xt=Xe[Dt],yr=Xe[Dt+1],or=Dt===0?Ie:Xt.sub(Xe[Dt-1])._unit()._perp(),Jr=Dt===Xe.length-1?Ie:yr.sub(Xt)._unit()._perp(),tn=or._add(Jr)._unit();tn._mult(1/(tn.x*Jr.x+tn.y*Jr.y)),gt.push(tn._mult(_e)._add(Xt))}Le.push(gt)}return Le}(b,q*D)),function(ee,_e,Le){for(var Ie=0;Ie<_e.length;Ie++){var Ye=_e[Ie];if(ee.length>=3){for(var Xe=0;Xe<Ye.length;Xe++)if(iu(ee,Ye[Xe]))return!0}if(ts(ee,Ye,Le))return!0}return!1}(B,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(Vu);function Ip(a,o){return o>0?o+2*a:a}var Ev=es([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Id=es([{name:"a_projected_pos",components:3,type:"Float32"}],4),Rd=(es([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),es([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Rp=(es([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),es([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Sv=es([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cv(a,o,u){return a.sections.forEach(function(p){p.text=function(y,b,S){var M=b.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?y=y.toLocaleUpperCase():M==="lowercase"&&(y=y.toLocaleLowerCase()),lo.applyArabicShaping&&(y=lo.applyArabicShaping(y)),y}(p.text,o,u)}),a}es([{name:"triangle",components:3,type:"Uint16"}]),es([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),es([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),es([{type:"Float32",name:"offsetX"}]),es([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var _h={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},kp=function(o,u,p,y,b){var S,M,D=8*b-y-1,B=(1<<D)-1,Z=B>>1,q=-7,ee=p?b-1:0,_e=p?-1:1,Le=o[u+ee];for(ee+=_e,S=Le&(1<<-q)-1,Le>>=-q,q+=D;q>0;S=256*S+o[u+ee],ee+=_e,q-=8);for(M=S&(1<<-q)-1,S>>=-q,q+=y;q>0;M=256*M+o[u+ee],ee+=_e,q-=8);if(S===0)S=1-Z;else{if(S===B)return M?NaN:1/0*(Le?-1:1);M+=Math.pow(2,y),S-=Z}return(Le?-1:1)*M*Math.pow(2,S-y)},Lp=function(o,u,p,y,b,S){var M,D,B,Z=8*S-b-1,q=(1<<Z)-1,ee=q>>1,_e=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,Le=y?0:S-1,Ie=y?1:-1,Ye=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(D=isNaN(u)?1:0,M=q):(M=Math.floor(Math.log(u)/Math.LN2),u*(B=Math.pow(2,-M))<1&&(M--,B*=2),(u+=M+ee>=1?_e/B:_e*Math.pow(2,1-ee))*B>=2&&(M++,B/=2),M+ee>=q?(D=0,M=q):M+ee>=1?(D=(u*B-1)*Math.pow(2,b),M+=ee):(D=u*Math.pow(2,ee-1)*Math.pow(2,b),M=0));b>=8;o[p+Le]=255&D,Le+=Ie,D/=256,b-=8);for(M=M<<b|D,Z+=b;Z>0;o[p+Le]=255&M,Le+=Ie,M/=256,Z-=8);o[p+Le-Ie]|=128*Ye},Hh=vr;function vr(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}vr.Varint=0,vr.Fixed64=1,vr.Bytes=2,vr.Fixed32=5;var kd=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Kl(a){return a.type===vr.Bytes?a.readVarint()+a.pos:a.pos+1}function Yt(a,o,u){return u?4294967296*o+(a>>>0):4294967296*(o>>>0)+(a>>>0)}function X(a,o,u){var p=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(p);for(var y=u.pos-1;y>=a;y--)u.buf[y+p]=u.buf[y]}function ae(a,o){for(var u=0;u<a.length;u++)o.writeVarint(a[u])}function Ge(a,o){for(var u=0;u<a.length;u++)o.writeSVarint(a[u])}function Vt(a,o){for(var u=0;u<a.length;u++)o.writeFloat(a[u])}function hr(a,o){for(var u=0;u<a.length;u++)o.writeDouble(a[u])}function nr(a,o){for(var u=0;u<a.length;u++)o.writeBoolean(a[u])}function Jt(a,o){for(var u=0;u<a.length;u++)o.writeFixed32(a[u])}function wr(a,o){for(var u=0;u<a.length;u++)o.writeSFixed32(a[u])}function jr(a,o){for(var u=0;u<a.length;u++)o.writeFixed64(a[u])}function Vr(a,o){for(var u=0;u<a.length;u++)o.writeSFixed64(a[u])}function Xr(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+16777216*a[o+3]}function Gr(a,o,u){a[u]=o,a[u+1]=o>>>8,a[u+2]=o>>>16,a[u+3]=o>>>24}function fn(a,o){return(a[o]|a[o+1]<<8|a[o+2]<<16)+(a[o+3]<<24)}function rn(a,o,u){a===1&&u.readMessage(zr,o)}function zr(a,o,u){if(a===3){var p=u.readMessage(Gt,{}),y=p.width,b=p.height,S=p.left,M=p.top,D=p.advance;o.push({id:p.id,bitmap:new ps({width:y+6,height:b+6},p.bitmap),metrics:{width:y,height:b,left:S,top:M,advance:D}})}}function Gt(a,o,u){a===1?o.id=u.readVarint():a===2?o.bitmap=u.readBytes():a===3?o.width=u.readVarint():a===4?o.height=u.readVarint():a===5?o.left=u.readSVarint():a===6?o.top=u.readSVarint():a===7&&(o.advance=u.readVarint())}function Ht(a){for(var o=0,u=0,p=0,y=a;p<y.length;p+=1){var b=y[p];o+=b.w*b.h,u=Math.max(u,b.w)}a.sort(function(Ie,Ye){return Ye.h-Ie.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],M=0,D=0,B=0,Z=a;B<Z.length;B+=1)for(var q=Z[B],ee=S.length-1;ee>=0;ee--){var _e=S[ee];if(!(q.w>_e.w||q.h>_e.h)){if(q.x=_e.x,q.y=_e.y,D=Math.max(D,q.y+q.h),M=Math.max(M,q.x+q.w),q.w===_e.w&&q.h===_e.h){var Le=S.pop();ee<S.length&&(S[ee]=Le)}else q.h===_e.h?(_e.x+=q.w,_e.w-=q.w):q.w===_e.w?(_e.y+=q.h,_e.h-=q.h):(S.push({x:_e.x+q.w,y:_e.y,w:_e.w-q.w,h:q.h}),_e.y+=q.h,_e.h-=q.h);break}}return{w:M,h:D,fill:o/(M*D)||0}}vr.prototype={destroy:function(){this.buf=null},readFields:function(o,u,p){for(p=p||this.length;this.pos<p;){var y=this.readVarint(),b=y>>3,S=this.pos;this.type=7&y,o(b,u,this),this.pos===S&&this.skip(y)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=Xr(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=fn(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Xr(this.buf,this.pos)+4294967296*Xr(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=Xr(this.buf,this.pos)+4294967296*fn(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=kp(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=kp(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,p,y=this.buf;return u=127&(p=y[this.pos++]),p<128?u:(u|=(127&(p=y[this.pos++]))<<7,p<128?u:(u|=(127&(p=y[this.pos++]))<<14,p<128?u:(u|=(127&(p=y[this.pos++]))<<21,p<128?u:function(b,S,M){var D,B,Z=M.buf;if(D=(112&(B=Z[M.pos++]))>>4,B<128||(D|=(127&(B=Z[M.pos++]))<<3,B<128)||(D|=(127&(B=Z[M.pos++]))<<10,B<128)||(D|=(127&(B=Z[M.pos++]))<<17,B<128)||(D|=(127&(B=Z[M.pos++]))<<24,B<128)||(D|=(1&(B=Z[M.pos++]))<<31,B<128))return Yt(b,D,S);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(p=y[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&kd?function(p,y,b){return kd.decode(p.subarray(y,b))}(this.buf,u,o):function(p,y,b){for(var S="",M=y;M<b;){var D,B,Z,q=p[M],ee=null,_e=q>239?4:q>223?3:q>191?2:1;if(M+_e>b)break;_e===1?q<128&&(ee=q):_e===2?(192&(D=p[M+1]))==128&&(ee=(31&q)<<6|63&D)<=127&&(ee=null):_e===3?(B=p[M+2],(192&(D=p[M+1]))==128&&(192&B)==128&&((ee=(15&q)<<12|(63&D)<<6|63&B)<=2047||ee>=55296&&ee<=57343)&&(ee=null)):_e===4&&(B=p[M+2],Z=p[M+3],(192&(D=p[M+1]))==128&&(192&B)==128&&(192&Z)==128&&((ee=(15&q)<<18|(63&D)<<12|(63&B)<<6|63&Z)<=65535||ee>=1114112)&&(ee=null)),ee===null?(ee=65533,_e=1):ee>65535&&(ee-=65536,S+=String.fromCharCode(ee>>>10&1023|55296),ee=56320|1023&ee),S+=String.fromCharCode(ee),M+=_e}return S}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==vr.Bytes)return o.push(this.readVarint(u));var p=Kl(this);for(o=o||[];this.pos<p;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==vr.Bytes)return o.push(this.readSVarint());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==vr.Bytes)return o.push(this.readBoolean());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==vr.Bytes)return o.push(this.readFloat());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==vr.Bytes)return o.push(this.readDouble());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==vr.Bytes)return o.push(this.readFixed32());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==vr.Bytes)return o.push(this.readSFixed32());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==vr.Bytes)return o.push(this.readFixed64());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==vr.Bytes)return o.push(this.readSFixed64());var u=Kl(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===vr.Varint)for(;this.buf[this.pos++]>127;);else if(u===vr.Bytes)this.pos=this.readVarint()+this.pos;else if(u===vr.Fixed32)this.pos+=4;else{if(u!==vr.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var p=new Uint8Array(u);p.set(this.buf),this.buf=p,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Gr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Gr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Gr(this.buf,-1&o,this.pos),Gr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Gr(this.buf,-1&o,this.pos),Gr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,p){var y,b;if(u>=0?(y=u%4294967296|0,b=u/4294967296|0):(b=~(-u/4294967296),4294967295^(y=~(-u%4294967296))?y=y+1|0:(y=0,b=b+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");p.realloc(10),function(S,M,D){D.buf[D.pos++]=127&S|128,S>>>=7,D.buf[D.pos++]=127&S|128,S>>>=7,D.buf[D.pos++]=127&S|128,S>>>=7,D.buf[D.pos++]=127&S|128,D.buf[D.pos]=127&(S>>>=7)}(y,0,p),function(S,M){var D=(7&S)<<4;M.buf[M.pos++]|=D|((S>>>=3)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S|((S>>>=7)?128:0),S&&(M.buf[M.pos++]=127&S)))))}(b,p)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(y,b,S){for(var M,D,B=0;B<b.length;B++){if((M=b.charCodeAt(B))>55295&&M<57344){if(!D){M>56319||B+1===b.length?(y[S++]=239,y[S++]=191,y[S++]=189):D=M;continue}if(M<56320){y[S++]=239,y[S++]=191,y[S++]=189,D=M;continue}M=D-55296<<10|M-56320|65536,D=null}else D&&(y[S++]=239,y[S++]=191,y[S++]=189,D=null);M<128?y[S++]=M:(M<2048?y[S++]=M>>6|192:(M<65536?y[S++]=M>>12|224:(y[S++]=M>>18|240,y[S++]=M>>12&63|128),y[S++]=M>>6&63|128),y[S++]=63&M|128)}return S}(this.buf,o,this.pos);var p=this.pos-u;p>=128&&X(u,p,this),this.pos=u-1,this.writeVarint(p),this.pos+=p},writeFloat:function(o){this.realloc(4),Lp(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Lp(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var p=0;p<u;p++)this.buf[this.pos++]=o[p]},writeRawMessage:function(o,u){this.pos++;var p=this.pos;o(u,this);var y=this.pos-p;y>=128&&X(p,y,this),this.pos=p-1,this.writeVarint(y),this.pos+=y},writeMessage:function(o,u,p){this.writeTag(o,vr.Bytes),this.writeRawMessage(u,p)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,ae,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,Ge,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,nr,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,Vt,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,hr,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,Jt,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,wr,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,jr,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Vr,u)},writeBytesField:function(o,u){this.writeTag(o,vr.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,vr.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,vr.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,vr.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,vr.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,vr.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,vr.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,vr.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,vr.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,vr.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,Boolean(u))}};var Br=function(o,u){var p=u.pixelRatio,y=u.version,b=u.stretchX,S=u.stretchY,M=u.content;this.paddedRect=o,this.pixelRatio=p,this.stretchX=b,this.stretchY=S,this.content=M,this.version=y},Sn={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Sn.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Sn.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Sn.tlbr.get=function(){return this.tl.concat(this.br)},Sn.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Br.prototype,Sn);var cr=function(o,u){var p={},y={};this.haveRenderCallbacks=[];var b=[];this.addImages(o,p,b),this.addImages(u,y,b);var S=Ht(b),M=new Ua({width:S.w||1,height:S.h||1});for(var D in o){var B=o[D],Z=p[D].paddedRect;Ua.copy(B.data,M,{x:0,y:0},{x:Z.x+1,y:Z.y+1},B.data)}for(var q in u){var ee=u[q],_e=y[q].paddedRect,Le=_e.x+1,Ie=_e.y+1,Ye=ee.data.width,Xe=ee.data.height;Ua.copy(ee.data,M,{x:0,y:0},{x:Le,y:Ie},ee.data),Ua.copy(ee.data,M,{x:0,y:Xe-1},{x:Le,y:Ie-1},{width:Ye,height:1}),Ua.copy(ee.data,M,{x:0,y:0},{x:Le,y:Ie+Xe},{width:Ye,height:1}),Ua.copy(ee.data,M,{x:Ye-1,y:0},{x:Le-1,y:Ie},{width:1,height:Xe}),Ua.copy(ee.data,M,{x:0,y:0},{x:Le+Ye,y:Ie},{width:1,height:Xe})}this.image=M,this.iconPositions=p,this.patternPositions=y};cr.prototype.addImages=function(a,o,u){for(var p in a){var y=a[p],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[p]=new Br(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},cr.prototype.patchUpdatedImages=function(a,o){for(var u in a.dispatchRenderCallbacks(this.haveRenderCallbacks),a.updatedImages)this.patchUpdatedImage(this.iconPositions[u],a.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],a.getImage(u),o)},cr.prototype.patchUpdatedImage=function(a,o,u){if(a&&o&&a.version!==o.version){a.version=o.version;var p=a.tl;u.update(o.data,void 0,{x:p[0],y:p[1]})}},Ln("ImagePosition",Br),Ln("ImageAtlas",cr);var Dn={horizontal:1,vertical:2,horizontalOnly:3},Rn=function(){this.scale=1,this.fontStack="",this.imageName=null};Rn.forText=function(a,o){var u=new Rn;return u.scale=a||1,u.fontStack=o,u},Rn.forImage=function(a){var o=new Rn;return o.imageName=a,o};var Qr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function xr(a,o,u,p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie){var Ye,Xe=Qr.fromFeature(a,y);q===Dn.vertical&&Xe.verticalizePunctuation();var gt=lo.processBidirectionalText,Dt=lo.processStyledBidirectionalText;if(gt&&Xe.sections.length===1){Ye=[];for(var Xt=0,yr=gt(Xe.toString(),Ii(Xe,B,b,o,p,_e,Le));Xt<yr.length;Xt+=1){var or=yr[Xt],Jr=new Qr;Jr.text=or,Jr.sections=Xe.sections;for(var tn=0;tn<or.length;tn++)Jr.sectionIndex.push(0);Ye.push(Jr)}}else if(Dt){Ye=[];for(var Gn=0,ti=Dt(Xe.text,Xe.sectionIndex,Ii(Xe,B,b,o,p,_e,Le));Gn<ti.length;Gn+=1){var Qn=ti[Gn],Nn=new Qr;Nn.text=Qn[0],Nn.sectionIndex=Qn[1],Nn.sections=Xe.sections,Ye.push(Nn)}}else Ye=function(ri,ea){for(var Ri=[],Aa=ri.text,_i=0,oa=0,qa=ea;oa<qa.length;oa+=1){var Qa=qa[oa];Ri.push(ri.substring(_i,Qa)),_i=Qa}return _i<Aa.length&&Ri.push(ri.substring(_i,Aa.length)),Ri}(Xe,Ii(Xe,B,b,o,p,_e,Le));var wi=[],ui={positionedLines:wi,text:Xe.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:q,iconsInText:!1,verticalizable:!1};return function(ri,ea,Ri,Aa,_i,oa,qa,Qa,bo,Eo,Oo,Ns){for(var Yo=0,ou=-17,Cs=0,su=0,ms=Qa==="right"?1:Qa==="left"?0:.5,os=0,gs=0,xa=_i;gs<xa.length;gs+=1){var sa=xa[gs];sa.trim();var ja=sa.getMaxScale(),Ja=24*(ja-1),uu={positionedGlyphs:[],lineOffset:0};ri.positionedLines[os]=uu;var no=uu.positionedGlyphs,So=0;if(sa.length()){for(var zs=0;zs<sa.length();zs++){var da=sa.getSection(zs),Bc=sa.getSectionIndex(zs),Dl=sa.getCharCode(zs),hc=0,dl=null,Us=null,Nc=null,zc=24,Uc=!(bo===Dn.horizontal||!Oo&&!Fo(Dl)||Oo&&(ar[Dl]||(Tf=Dl,gn.Arabic(Tf)||gn["Arabic Supplement"](Tf)||gn["Arabic Extended-A"](Tf)||gn["Arabic Presentation Forms-A"](Tf)||gn["Arabic Presentation Forms-B"](Tf))));if(da.imageName){var Bp=Aa[da.imageName];if(!Bp)continue;Nc=da.imageName,ri.iconsInText=ri.iconsInText||!0,Us=Bp.paddedRect;var jc=Bp.displaySize;da.scale=24*da.scale/Ns,hc=Ja+(24-jc[1]*da.scale),zc=(dl={width:jc[0],height:jc[1],left:1,top:-3,advance:Uc?jc[1]:jc[0]}).advance;var Np=Uc?jc[0]*da.scale-24*ja:jc[1]*da.scale-24*ja;Np>0&&Np>So&&(So=Np)}else{var zp=Ri[da.fontStack],Xh=zp&&zp[Dl];if(Xh&&Xh.rect)Us=Xh.rect,dl=Xh.metrics;else{var Fd=ea[da.fontStack],Up=Fd&&Fd[Dl];if(!Up)continue;dl=Up.metrics}hc=24*(ja-da.scale)}Uc?(ri.verticalizable=!0,no.push({glyph:Dl,imageName:Nc,x:Yo,y:ou+hc,vertical:Uc,scale:da.scale,fontStack:da.fontStack,sectionIndex:Bc,metrics:dl,rect:Us}),Yo+=zc*da.scale+Eo):(no.push({glyph:Dl,imageName:Nc,x:Yo,y:ou+hc,vertical:Uc,scale:da.scale,fontStack:da.fontStack,sectionIndex:Bc,metrics:dl,rect:Us}),Yo+=dl.advance*da.scale+Eo)}no.length!==0&&(Cs=Math.max(Yo-Eo,Cs),yn(no,0,no.length-1,ms,So)),Yo=0;var jp=oa*ja+So;uu.lineOffset=Math.max(So,Ja),ou+=jp,su=Math.max(jp,su),++os}else ou+=oa,++os}var Tf,bh=ou- -17,Vp=Si(qa),Yh=Vp.horizontalAlign,Qf=Vp.verticalAlign;(function($h,Bd,Nd,Kh,zd,Ud,qh,jd,Gp){var Hp,Wp=(Bd-Nd)*zd;Hp=Ud!==qh?-jd*Kh- -17:(-Kh*Gp+.5)*qh;for(var Qh=0,Zp=$h;Qh<Zp.length;Qh+=1)for(var Jh=0,ep=Zp[Qh].positionedGlyphs;Jh<ep.length;Jh+=1){var Xp=ep[Jh];Xp.x+=Wp,Xp.y+=Hp}})(ri.positionedLines,ms,Yh,Qf,Cs,su,oa,bh,_i.length),ri.top+=-Qf*bh,ri.bottom=ri.top+bh,ri.left+=-Yh*Cs,ri.right=ri.left+Cs}(ui,o,u,p,Ye,S,M,D,q,B,ee,Ie),!function(ri){for(var ea=0,Ri=ri;ea<Ri.length;ea+=1)if(Ri[ea].positionedGlyphs.length!==0)return!1;return!0}(wi)&&ui}Qr.fromFeature=function(a,o){for(var u=new Qr,p=0;p<a.sections.length;p++){var y=a.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Qr.prototype.length=function(){return this.text.length},Qr.prototype.getSection=function(a){return this.sections[this.sectionIndex[a]]},Qr.prototype.getSectionIndex=function(a){return this.sectionIndex[a]},Qr.prototype.getCharCode=function(a){return this.text.charCodeAt(a)},Qr.prototype.verticalizePunctuation=function(){this.text=function(a){for(var o="",u=0;u<a.length;u++){var p=a.charCodeAt(u+1)||null,y=a.charCodeAt(u-1)||null;o+=p&&zf(p)&&!_h[a[u+1]]||y&&zf(y)&&!_h[a[u-1]]||!_h[a[u]]?a[u]:_h[a[u]]}return o}(this.text)},Qr.prototype.trim=function(){for(var a=0,o=0;o<this.text.length&&ar[this.text.charCodeAt(o)];o++)a++;for(var u=this.text.length,p=this.text.length-1;p>=0&&p>=a&&ar[this.text.charCodeAt(p)];p--)u--;this.text=this.text.substring(a,u),this.sectionIndex=this.sectionIndex.slice(a,u)},Qr.prototype.substring=function(a,o){var u=new Qr;return u.text=this.text.substring(a,o),u.sectionIndex=this.sectionIndex.slice(a,o),u.sections=this.sections,u},Qr.prototype.toString=function(){return this.text},Qr.prototype.getMaxScale=function(){var a=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,a.sections[u].scale)},0)},Qr.prototype.addTextSection=function(a,o){this.text+=a.text,this.sections.push(Rn.forText(a.scale,a.fontStack||o));for(var u=this.sections.length-1,p=0;p<a.text.length;++p)this.sectionIndex.push(u)},Qr.prototype.addImageSection=function(a){var o=a.image?a.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(Rn.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Zt("Reached maximum number of images 6401")}else Zt("Can't add FormattedSection with an empty image.")},Qr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var ar={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},an={};function ln(a,o,u,p,y,b){if(o.imageName){var S=p[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var M=u[o.fontStack],D=M&&M[a];return D?D.metrics.advance*o.scale+y:0}function Wr(a,o,u,p){var y=Math.pow(a-o,2);return p?a<o?y/2:2*y:y+Math.abs(u)*u}function vn(a,o,u){var p=0;return a===10&&(p-=1e4),u&&(p+=150),a!==40&&a!==65288||(p+=50),o!==41&&o!==65289||(p+=50),p}function hn(a,o,u,p,y,b){for(var S=null,M=Wr(o,u,y,b),D=0,B=p;D<B.length;D+=1){var Z=B[D],q=Wr(o-Z.x,u,y,b)+Z.badness;q<=M&&(S=Z,M=q)}return{index:a,x:o,priorBreak:S,badness:M}}function Ii(a,o,u,p,y,b,S){if(b!=="point")return[];if(!a)return[];for(var M,D=[],B=function(Ye,Xe,gt,Dt,Xt,yr){for(var or=0,Jr=0;Jr<Ye.length();Jr++){var tn=Ye.getSection(Jr);or+=ln(Ye.getCharCode(Jr),tn,Dt,Xt,Xe,yr)}return or/Math.max(1,Math.ceil(or/gt))}(a,o,u,p,y,S),Z=a.text.indexOf("\u200B")>=0,q=0,ee=0;ee<a.length();ee++){var _e=a.getSection(ee),Le=a.getCharCode(ee);if(ar[Le]||(q+=ln(Le,_e,p,y,o,S)),ee<a.length()-1){var Ie=!((M=Le)<11904||!(gn["Bopomofo Extended"](M)||gn.Bopomofo(M)||gn["CJK Compatibility Forms"](M)||gn["CJK Compatibility Ideographs"](M)||gn["CJK Compatibility"](M)||gn["CJK Radicals Supplement"](M)||gn["CJK Strokes"](M)||gn["CJK Symbols and Punctuation"](M)||gn["CJK Unified Ideographs Extension A"](M)||gn["CJK Unified Ideographs"](M)||gn["Enclosed CJK Letters and Months"](M)||gn["Halfwidth and Fullwidth Forms"](M)||gn.Hiragana(M)||gn["Ideographic Description Characters"](M)||gn["Kangxi Radicals"](M)||gn["Katakana Phonetic Extensions"](M)||gn.Katakana(M)||gn["Vertical Forms"](M)||gn["Yi Radicals"](M)||gn["Yi Syllables"](M)));(an[Le]||Ie||_e.imageName)&&D.push(hn(ee+1,q,B,D,vn(Le,a.getCharCode(ee+1),Ie&&Z),!1))}}return function Ye(Xe){return Xe?Ye(Xe.priorBreak).concat(Xe.index):[]}(hn(a.length(),q,B,D,0,!0))}function Si(a){var o=.5,u=.5;switch(a){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yn(a,o,u,p,y){if(p||y)for(var b=a[u],S=(a[u].x+b.metrics.advance*b.scale)*p,M=o;M<=u;M++)a[M].x-=S,a[M].y+=y}function En(a,o,u,p,y,b){var S,M=a.image;if(M.content){var D=M.content,B=M.pixelRatio||1;S=[D[0]/B,D[1]/B,M.displaySize[0]-D[2]/B,M.displaySize[1]-D[3]/B]}var Z,q,ee,_e,Le=o.left*b,Ie=o.right*b;u==="width"||u==="both"?(_e=y[0]+Le-p[3],q=y[0]+Ie+p[1]):q=(_e=y[0]+(Le+Ie-M.displaySize[0])/2)+M.displaySize[0];var Ye=o.top*b,Xe=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+Ye-p[0],ee=y[1]+Xe+p[2]):ee=(Z=y[1]+(Ye+Xe-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:Z,right:q,bottom:ee,left:_e,collisionPadding:S}}an[10]=!0,an[32]=!0,an[38]=!0,an[40]=!0,an[41]=!0,an[43]=!0,an[45]=!0,an[47]=!0,an[173]=!0,an[183]=!0,an[8203]=!0,an[8208]=!0,an[8211]=!0,an[8231]=!0;var hi=function(a){function o(u,p,y,b){a.call(this,u,p),this.angle=y,b!==void 0&&(this.segment=b)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(xe);function Ci(a,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new $i(a+1))};if(u.kind==="source")return{kind:"source"};for(var p=u.zoomStops,y=u.interpolationType,b=0;b<p.length&&p[b]<=a;)b++;for(var S=b=Math.max(0,b-1);S<p.length&&p[S]<a+1;)S++;S=Math.min(p.length-1,S);var M=p[b],D=p[S];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:M,maxZoom:D,minSize:u.evaluate(new $i(M)),maxSize:u.evaluate(new $i(D)),interpolationType:y}}function Yi(a,o,u){var p=o.uSize,y=u.lowerSize;return a.kind==="source"?y/128:a.kind==="composite"?Ya(y/128,u.upperSize/128,o.uSizeT):p}function ho(a,o){var u=0,p=0;if(a.kind==="constant")p=a.layoutSize;else if(a.kind!=="source"){var y=a.interpolationType,b=y?vt(Ct.interpolationFactor(y,o,a.minZoom,a.maxZoom),0,1):0;a.kind==="camera"?p=Ya(a.minSize,a.maxSize,b):u=b}return{uSizeT:u,uSize:p}}Ln("Anchor",hi);var Ao=Object.freeze({__proto__:null,getSizeData:Ci,evaluateSizeForFeature:Yi,evaluateSizeForZoom:ho,SIZE_PACK_FACTOR:128});function Ki(a,o,u,p,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,M=0;M>-u/2;){if(--S<0)return!1;M-=a[S].dist(b),b=a[S]}M+=a[S].dist(a[S+1]),S++;for(var D=[],B=0;M<u/2;){var Z=a[S],q=a[S+1];if(!q)return!1;var ee=a[S-1].angleTo(Z)-Z.angleTo(q);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:M,angleDelta:ee}),B+=ee;M-D[0].distance>p;)B-=D.shift().angleDelta;if(B>y)return!1;S++,M+=Z.dist(q)}return!0}function ns(a){for(var o=0,u=0;u<a.length-1;u++)o+=a[u].dist(a[u+1]);return o}function Pa(a,o,u){return a?.6*o*u:0}function Xo(a,o){return Math.max(a?a.right-a.left:0,o?o.right-o.left:0)}function Ai(a,o,u,p,y,b){for(var S=Pa(u,y,b),M=Xo(u,p)*b,D=0,B=ns(a)/2,Z=0;Z<a.length-1;Z++){var q=a[Z],ee=a[Z+1],_e=q.dist(ee);if(D+_e>B){var Le=(B-D)/_e,Ie=Ya(q.x,ee.x,Le),Ye=Ya(q.y,ee.y,Le),Xe=new hi(Ie,Ye,ee.angleTo(q),Z);return Xe._round(),!S||Ki(a,Xe,M,S,o)?Xe:void 0}D+=_e}}function aa(a,o,u,p,y,b,S,M,D){var B=Pa(p,b,S),Z=Xo(p,y),q=Z*S,ee=a[0].x===0||a[0].x===D||a[0].y===0||a[0].y===D;return o-q<o/4&&(o=q+o/4),function _e(Le,Ie,Ye,Xe,gt,Dt,Xt,yr,or){for(var Jr=Dt/2,tn=ns(Le),Gn=0,ti=Ie-Ye,Qn=[],Nn=0;Nn<Le.length-1;Nn++){for(var wi=Le[Nn],ui=Le[Nn+1],ri=wi.dist(ui),ea=ui.angleTo(wi);ti+Ye<Gn+ri;){var Ri=((ti+=Ye)-Gn)/ri,Aa=Ya(wi.x,ui.x,Ri),_i=Ya(wi.y,ui.y,Ri);if(Aa>=0&&Aa<or&&_i>=0&&_i<or&&ti-Jr>=0&&ti+Jr<=tn){var oa=new hi(Aa,_i,ea,Nn);oa._round(),Xe&&!Ki(Le,oa,Dt,Xe,gt)||Qn.push(oa)}}Gn+=ri}return yr||Qn.length||Xt||(Qn=_e(Le,Gn/2,Ye,Xe,gt,Dt,Xt,!0,or)),Qn}(a,ee?o/2*M%o:(Z/2+2*b)*S*M%o,o,B,u,q,ee,!1,D)}function _o(a,o,u,p,y){for(var b=[],S=0;S<a.length;S++)for(var M=a[S],D=void 0,B=0;B<M.length-1;B++){var Z=M[B],q=M[B+1];Z.x<o&&q.x<o||(Z.x<o?Z=new xe(o,Z.y+(o-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round():q.x<o&&(q=new xe(o,Z.y+(o-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round()),Z.y<u&&q.y<u||(Z.y<u?Z=new xe(Z.x+(u-Z.y)/(q.y-Z.y)*(q.x-Z.x),u)._round():q.y<u&&(q=new xe(Z.x+(u-Z.y)/(q.y-Z.y)*(q.x-Z.x),u)._round()),Z.x>=p&&q.x>=p||(Z.x>=p?Z=new xe(p,Z.y+(p-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round():q.x>=p&&(q=new xe(p,Z.y+(p-Z.x)/(q.x-Z.x)*(q.y-Z.y))._round()),Z.y>=y&&q.y>=y||(Z.y>=y?Z=new xe(Z.x+(y-Z.y)/(q.y-Z.y)*(q.x-Z.x),y)._round():q.y>=y&&(q=new xe(Z.x+(y-Z.y)/(q.y-Z.y)*(q.x-Z.x),y)._round()),D&&Z.equals(D[D.length-1])||b.push(D=[Z]),D.push(q)))))}return b}function Fs(a,o,u,p){var y=[],b=a.image,S=b.pixelRatio,M=b.paddedRect.w-2,D=b.paddedRect.h-2,B=a.right-a.left,Z=a.bottom-a.top,q=b.stretchX||[[0,M]],ee=b.stretchY||[[0,D]],_e=function(_i,oa){return _i+oa[1]-oa[0]},Le=q.reduce(_e,0),Ie=ee.reduce(_e,0),Ye=M-Le,Xe=D-Ie,gt=0,Dt=Le,Xt=0,yr=Ie,or=0,Jr=Ye,tn=0,Gn=Xe;if(b.content&&p){var ti=b.content;gt=xo(q,0,ti[0]),Xt=xo(ee,0,ti[1]),Dt=xo(q,ti[0],ti[2]),yr=xo(ee,ti[1],ti[3]),or=ti[0]-gt,tn=ti[1]-Xt,Jr=ti[2]-ti[0]-Dt,Gn=ti[3]-ti[1]-yr}var Qn=function(_i,oa,qa,Qa){var bo=is(_i.stretch-gt,Dt,B,a.left),Eo=Ea(_i.fixed-or,Jr,_i.stretch,Le),Oo=is(oa.stretch-Xt,yr,Z,a.top),Ns=Ea(oa.fixed-tn,Gn,oa.stretch,Ie),Yo=is(qa.stretch-gt,Dt,B,a.left),ou=Ea(qa.fixed-or,Jr,qa.stretch,Le),Cs=is(Qa.stretch-Xt,yr,Z,a.top),su=Ea(Qa.fixed-tn,Gn,Qa.stretch,Ie),ms=new xe(bo,Oo),os=new xe(Yo,Oo),gs=new xe(Yo,Cs),xa=new xe(bo,Cs),sa=new xe(Eo/S,Ns/S),ja=new xe(ou/S,su/S),Ja=o*Math.PI/180;if(Ja){var uu=Math.sin(Ja),no=Math.cos(Ja),So=[no,-uu,uu,no];ms._matMult(So),os._matMult(So),xa._matMult(So),gs._matMult(So)}var zs=_i.stretch+_i.fixed,da=oa.stretch+oa.fixed;return{tl:ms,tr:os,bl:xa,br:gs,tex:{x:b.paddedRect.x+1+zs,y:b.paddedRect.y+1+da,w:qa.stretch+qa.fixed-zs,h:Qa.stretch+Qa.fixed-da},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sa,pixelOffsetBR:ja,minFontScaleX:Jr/S/B,minFontScaleY:Gn/S/Z,isSDF:u}};if(p&&(b.stretchX||b.stretchY))for(var Nn=ji(q,Ye,Le),wi=ji(ee,Xe,Ie),ui=0;ui<Nn.length-1;ui++)for(var ri=Nn[ui],ea=Nn[ui+1],Ri=0;Ri<wi.length-1;Ri++)y.push(Qn(ri,wi[Ri],ea,wi[Ri+1]));else y.push(Qn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:D+1}));return y}function xo(a,o,u){for(var p=0,y=0,b=a;y<b.length;y+=1){var S=b[y];p+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return p}function ji(a,o,u){for(var p=[{fixed:-1,stretch:0}],y=0,b=a;y<b.length;y+=1){var S=b[y],M=S[0],D=S[1],B=p[p.length-1];p.push({fixed:M-B.stretch,stretch:B.stretch}),p.push({fixed:M-B.stretch,stretch:B.stretch+(D-M)})}return p.push({fixed:o+1,stretch:u}),p}function is(a,o,u,p){return a/o*u+p}function Ea(a,o,u,p){return a-o*u/p}var zo=function(o,u,p,y,b,S,M,D,B,Z){if(this.boxStartIndex=o.length,B){var q=S.top,ee=S.bottom,_e=S.collisionPadding;_e&&(q-=_e[1],ee+=_e[3]);var Le=ee-q;Le>0&&(Le=Math.max(10,Le),this.circleDiameter=Le)}else{var Ie=S.top*M-D,Ye=S.bottom*M+D,Xe=S.left*M-D,gt=S.right*M+D,Dt=S.collisionPadding;if(Dt&&(Xe-=Dt[0]*M,Ie-=Dt[1]*M,gt+=Dt[2]*M,Ye+=Dt[3]*M),Z){var Xt=new xe(Xe,Ie),yr=new xe(gt,Ie),or=new xe(Xe,Ye),Jr=new xe(gt,Ye),tn=Z*Math.PI/180;Xt._rotate(tn),yr._rotate(tn),or._rotate(tn),Jr._rotate(tn),Xe=Math.min(Xt.x,yr.x,or.x,Jr.x),gt=Math.max(Xt.x,yr.x,or.x,Jr.x),Ie=Math.min(Xt.y,yr.y,or.y,Jr.y),Ye=Math.max(Xt.y,yr.y,or.y,Jr.y)}o.emplaceBack(u.x,u.y,Xe,Ie,gt,Ye,p,y,b)}this.boxEndIndex=o.length},mi=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Fi),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var p=(this.length>>1)-1;p>=0;p--)this._down(p)};function Fi(a,o){return a<o?-1:a>o?1:0}function Da(a,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var p=1/0,y=1/0,b=-1/0,S=-1/0,M=a[0],D=0;D<M.length;D++){var B=M[D];(!D||B.x<p)&&(p=B.x),(!D||B.y<y)&&(y=B.y),(!D||B.x>b)&&(b=B.x),(!D||B.y>S)&&(S=B.y)}var Z=Math.min(b-p,S-y),q=Z/2,ee=new mi([],Bs);if(Z===0)return new xe(p,y);for(var _e=p;_e<b;_e+=Z)for(var Le=y;Le<S;Le+=Z)ee.push(new Ss(_e+q,Le+q,q,a));for(var Ie=function(gt){for(var Dt=0,Xt=0,yr=0,or=gt[0],Jr=0,tn=or.length,Gn=tn-1;Jr<tn;Gn=Jr++){var ti=or[Jr],Qn=or[Gn],Nn=ti.x*Qn.y-Qn.x*ti.y;Xt+=(ti.x+Qn.x)*Nn,yr+=(ti.y+Qn.y)*Nn,Dt+=3*Nn}return new Ss(Xt/Dt,yr/Dt,0,gt)}(a),Ye=ee.length;ee.length;){var Xe=ee.pop();(Xe.d>Ie.d||!Ie.d)&&(Ie=Xe,u&&console.log("found best %d after %d probes",Math.round(1e4*Xe.d)/1e4,Ye)),Xe.max-Ie.d<=o||(ee.push(new Ss(Xe.p.x-(q=Xe.h/2),Xe.p.y-q,q,a)),ee.push(new Ss(Xe.p.x+q,Xe.p.y-q,q,a)),ee.push(new Ss(Xe.p.x-q,Xe.p.y+q,q,a)),ee.push(new Ss(Xe.p.x+q,Xe.p.y+q,q,a)),Ye+=4)}return u&&(console.log("num probes: "+Ye),console.log("best distance: "+Ie.d)),Ie.p}function Bs(a,o){return o.max-a.max}function Ss(a,o,u,p){this.p=new xe(a,o),this.h=u,this.d=function(y,b){for(var S=!1,M=1/0,D=0;D<b.length;D++)for(var B=b[D],Z=0,q=B.length,ee=q-1;Z<q;ee=Z++){var _e=B[Z],Le=B[ee];_e.y>y.y!=Le.y>y.y&&y.x<(Le.x-_e.x)*(y.y-_e.y)/(Le.y-_e.y)+_e.x&&(S=!S),M=Math.min(M,Tu(y,_e,Le))}return(S?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}mi.prototype.push=function(a){this.data.push(a),this.length++,this._up(this.length-1)},mi.prototype.pop=function(){if(this.length!==0){var a=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),a}},mi.prototype.peek=function(){return this.data[0]},mi.prototype._up=function(a){for(var o=this.data,u=this.compare,p=o[a];a>0;){var y=a-1>>1,b=o[y];if(u(p,b)>=0)break;o[a]=b,a=y}o[a]=p},mi.prototype._down=function(a){for(var o=this.data,u=this.compare,p=this.length>>1,y=o[a];a<p;){var b=1+(a<<1),S=o[b],M=b+1;if(M<this.length&&u(o[M],S)<0&&(b=M,S=o[M]),u(S,y)>=0)break;o[a]=S,a=b}o[a]=y};var De=Number.POSITIVE_INFINITY;function er(a,o){return o[1]!==De?function(u,p,y){var b=0,S=0;switch(p=Math.abs(p),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-p;break;case"top-left":case"bottom-left":case"left":b=p}return[b,S]}(a,o[0],o[1]):function(u,p){var y=0,b=0;p<0&&(p=0);var S=p/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-p;break;case"top":b=p-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=p;break;case"right":y=-p}return[y,b]}(a,o[0])}function Ft(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pn(a,o,u,p,y,b,S,M,D,B,Z,q,ee,_e,Le){var Ie=function(Xt,yr,or,Jr,tn,Gn,ti,Qn){for(var Nn=Jr.layout.get("text-rotate").evaluate(Gn,{})*Math.PI/180,wi=[],ui=0,ri=yr.positionedLines;ui<ri.length;ui+=1)for(var ea=ri[ui],Ri=0,Aa=ea.positionedGlyphs;Ri<Aa.length;Ri+=1){var _i=Aa[Ri];if(_i.rect){var oa=_i.rect||{},qa=4,Qa=!0,bo=1,Eo=0,Oo=(tn||Qn)&&_i.vertical,Ns=_i.metrics.advance*_i.scale/2;if(Qn&&yr.verticalizable&&(Eo=ea.lineOffset/2-(_i.imageName?-(24-_i.metrics.width*_i.scale)/2:24*(_i.scale-1))),_i.imageName){var Yo=ti[_i.imageName];Qa=Yo.sdf,qa=1/(bo=Yo.pixelRatio)}var ou=tn?[_i.x+Ns,_i.y]:[0,0],Cs=tn?[0,0]:[_i.x+Ns+or[0],_i.y+or[1]-Eo],su=[0,0];Oo&&(su=Cs,Cs=[0,0]);var ms=(_i.metrics.left-qa)*_i.scale-Ns+Cs[0],os=(-_i.metrics.top-qa)*_i.scale+Cs[1],gs=ms+oa.w*_i.scale/bo,xa=os+oa.h*_i.scale/bo,sa=new xe(ms,os),ja=new xe(gs,os),Ja=new xe(ms,xa),uu=new xe(gs,xa);if(Oo){var no=new xe(-Ns,Ns- -17),So=-Math.PI/2,zs=12-Ns,da=new xe(22-zs,-(_i.imageName?zs:0)),Bc=new(Function.prototype.bind.apply(xe,[null].concat(su)));sa._rotateAround(So,no)._add(da)._add(Bc),ja._rotateAround(So,no)._add(da)._add(Bc),Ja._rotateAround(So,no)._add(da)._add(Bc),uu._rotateAround(So,no)._add(da)._add(Bc)}if(Nn){var Dl=Math.sin(Nn),hc=Math.cos(Nn),dl=[hc,-Dl,Dl,hc];sa._matMult(dl),ja._matMult(dl),Ja._matMult(dl),uu._matMult(dl)}var Us=new xe(0,0),Nc=new xe(0,0);wi.push({tl:sa,tr:ja,bl:Ja,br:uu,tex:oa,writingMode:yr.writingMode,glyphOffset:ou,sectionIndex:_i.sectionIndex,isSDF:Qa,pixelOffsetTL:Us,pixelOffsetBR:Nc,minFontScaleX:0,minFontScaleY:0})}}return wi}(0,u,M,y,b,S,p,a.allowVerticalPlacement),Ye=a.textSizeData,Xe=null;Ye.kind==="source"?(Xe=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&Zt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ye.kind==="composite"&&((Xe=[128*_e.compositeTextSizes[0].evaluate(S,{},Le),128*_e.compositeTextSizes[1].evaluate(S,{},Le)])[0]>32640||Xe[1]>32640)&&Zt(a.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),a.addSymbols(a.text,Ie,Xe,M,b,S,B,o,D.lineStartIndex,D.lineLength,ee,Le);for(var gt=0,Dt=Z;gt<Dt.length;gt+=1)q[Dt[gt]]=a.text.placedSymbolArray.length-1;return 4*Ie.length}function Vi(a){for(var o in a)return a[o];return null}function we(a,o,u,p){var y=a.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(p.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(p),!1}var de=wf.VectorTileFeature.types,Qe=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Pt(a,o,u,p,y,b,S,M,D,B,Z,q,ee){var _e=M?Math.min(32640,Math.round(M[0])):0,Le=M?Math.min(32640,Math.round(M[1])):0;a.emplaceBack(o,u,Math.round(32*p),Math.round(32*y),b,S,(_e<<1)+(D?1:0),Le,16*B,16*Z,256*q,256*ee)}function Kt(a,o,u){a.emplaceBack(o.x,o.y,u),a.emplaceBack(o.x,o.y,u),a.emplaceBack(o.x,o.y,u),a.emplaceBack(o.x,o.y,u)}function ot(a){for(var o=0,u=a.sections;o<u.length;o+=1)if(cf(u[o].text))return!0;return!1}var tt=function(o){this.layoutVertexArray=new vf,this.indexArray=new Zl,this.programConfigurations=o,this.segments=new ve,this.dynamicLayoutVertexArray=new Mc,this.opacityVertexArray=new sc,this.placedSymbolArray=new d};tt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},tt.prototype.upload=function(a,o,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ev.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Id.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,Qe,!0),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(a))},tt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Ln("SymbolBuffers",tt);var ct=function(o,u,p){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new p,this.segments=new ve,this.collisionVertexArray=new fh};ct.prototype.upload=function(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Rd.members,!0)},ct.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Ln("CollisionBuffers",ct);var me=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(S){return S.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ks([]),this.placementViewportMatrix=ks([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ci(this.zoom,u["text-size"]),this.iconSizeData=Ci(this.zoom,u["icon-size"]);var p=this.layers[0].layout,y=p.get("symbol-sort-key"),b=p.get("symbol-z-order");this.canOverlap=p.get("text-allow-overlap")||p.get("icon-allow-overlap")||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&y.constantOr(1)!==void 0,this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(function(S){return Dn[S]})),this.stateDependentLayerIds=this.layers.filter(function(S){return S.isStateDependent()}).map(function(S){return S.id}),this.sourceID=o.sourceID};me.prototype.createArrays=function(){this.text=new tt(new Di(this.layers,this.zoom,function(a){return/^text/.test(a)})),this.icon=new tt(new Di(this.layers,this.zoom,function(a){return/^icon/.test(a)})),this.glyphOffsetArray=new I,this.lineVertexArray=new k,this.symbolInstances=new A},me.prototype.calculateGlyphDependencies=function(a,o,u,p,y){for(var b=0;b<a.length;b++)if(o[a.charCodeAt(b)]=!0,(u||p)&&y){var S=_h[a.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},me.prototype.populate=function(a,o,u){var p=this.layers[0],y=p.layout,b=y.get("text-font"),S=y.get("text-field"),M=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof ia&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),B=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],D||B){for(var q=o.iconDependencies,ee=o.glyphDependencies,_e=o.availableImages,Le=new $i(this.zoom),Ie=0,Ye=a;Ie<Ye.length;Ie+=1){var Xe=Ye[Ie],gt=Xe.feature,Dt=Xe.id,Xt=Xe.index,yr=Xe.sourceLayerIndex,or=p._featureFilter.needGeometry,Jr=fo(gt,or);if(p._featureFilter.filter(Le,Jr,u)){or||(Jr.geometry=$a(gt));var tn=void 0;if(D){var Gn=p.getValueAndResolveTokens("text-field",Jr,u,_e),ti=ia.factory(Gn);ot(ti)&&(this.hasRTLText=!0),(!this.hasRTLText||jf()==="unavailable"||this.hasRTLText&&lo.isParsed())&&(tn=Cv(ti,p,Jr))}var Qn=void 0;if(B){var Nn=p.getValueAndResolveTokens("icon-image",Jr,u,_e);Qn=Nn instanceof Za?Nn:Za.fromString(Nn)}if(tn||Qn){var wi=this.sortFeaturesByKey?Z.evaluate(Jr,{},u):void 0;if(this.features.push({id:Dt,text:tn,icon:Qn,index:Xt,sourceLayerIndex:yr,geometry:Jr.geometry,properties:gt.properties,type:de[gt.type],sortKey:wi}),Qn&&(q[Qn.name]=!0),tn){var ui=b.evaluate(Jr,{},u).join(","),ri=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Dn.vertical)>=0;for(var ea=0,Ri=tn.sections;ea<Ri.length;ea+=1){var Aa=Ri[ea];if(Aa.image)q[Aa.image.name]=!0;else{var _i=Hl(tn.toString()),oa=Aa.fontStack||ui,qa=ee[oa]=ee[oa]||{};this.calculateGlyphDependencies(Aa.text,qa,ri,this.allowVerticalPlacement,_i)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(Qa){var bo={},Eo={},Oo=[],Ns=0;function Yo(no){Oo.push(Qa[no]),Ns++}function ou(no,So,zs){var da=Eo[no];return delete Eo[no],Eo[So]=da,Oo[da].geometry[0].pop(),Oo[da].geometry[0]=Oo[da].geometry[0].concat(zs[0]),da}function Cs(no,So,zs){var da=bo[So];return delete bo[So],bo[no]=da,Oo[da].geometry[0].shift(),Oo[da].geometry[0]=zs[0].concat(Oo[da].geometry[0]),da}function su(no,So,zs){var da=zs?So[0][So[0].length-1]:So[0][0];return no+":"+da.x+":"+da.y}for(var ms=0;ms<Qa.length;ms++){var os=Qa[ms],gs=os.geometry,xa=os.text?os.text.toString():null;if(xa){var sa=su(xa,gs),ja=su(xa,gs,!0);if(sa in Eo&&ja in bo&&Eo[sa]!==bo[ja]){var Ja=Cs(sa,ja,gs),uu=ou(sa,ja,Oo[Ja].geometry);delete bo[sa],delete Eo[ja],Eo[su(xa,Oo[uu].geometry,!0)]=uu,Oo[Ja].geometry=null}else sa in Eo?ou(sa,ja,gs):ja in bo?Cs(sa,ja,gs):(Yo(ms),bo[sa]=Ns-1,Eo[ja]=Ns-1)}else Yo(ms)}return Oo.filter(function(no){return no.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Qa,bo){return Qa.sortKey-bo.sortKey})}},me.prototype.update=function(a,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(a,o,this.layers,u))},me.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},me.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},me.prototype.upload=function(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},me.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},me.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},me.prototype.addToLineVertexArray=function(a,o){var u=this.lineVertexArray.length;if(a.segment!==void 0){for(var p=a.dist(o[a.segment+1]),y=a.dist(o[a.segment]),b={},S=a.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:p},S<o.length-1&&(p+=o[S+1].dist(o[S]));for(var M=a.segment||0;M>=0;M--)b[M]={x:o[M].x,y:o[M].y,tileUnitDistanceFromAnchor:y},M>0&&(y+=o[M-1].dist(o[M]));for(var D=0;D<o.length;D++){var B=b[D];this.lineVertexArray.emplaceBack(B.x,B.y,B.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},me.prototype.addSymbols=function(a,o,u,p,y,b,S,M,D,B,Z,q){for(var ee=a.indexArray,_e=a.layoutVertexArray,Le=a.segments.prepareSegment(4*o.length,_e,ee,this.canOverlap?b.sortKey:void 0),Ie=this.glyphOffsetArray.length,Ye=Le.vertexLength,Xe=this.allowVerticalPlacement&&S===Dn.vertical?Math.PI/2:0,gt=b.text&&b.text.sections,Dt=0;Dt<o.length;Dt++){var Xt=o[Dt],yr=Xt.tl,or=Xt.tr,Jr=Xt.bl,tn=Xt.br,Gn=Xt.tex,ti=Xt.pixelOffsetTL,Qn=Xt.pixelOffsetBR,Nn=Xt.minFontScaleX,wi=Xt.minFontScaleY,ui=Xt.glyphOffset,ri=Xt.isSDF,ea=Xt.sectionIndex,Ri=Le.vertexLength,Aa=ui[1];Pt(_e,M.x,M.y,yr.x,Aa+yr.y,Gn.x,Gn.y,u,ri,ti.x,ti.y,Nn,wi),Pt(_e,M.x,M.y,or.x,Aa+or.y,Gn.x+Gn.w,Gn.y,u,ri,Qn.x,ti.y,Nn,wi),Pt(_e,M.x,M.y,Jr.x,Aa+Jr.y,Gn.x,Gn.y+Gn.h,u,ri,ti.x,Qn.y,Nn,wi),Pt(_e,M.x,M.y,tn.x,Aa+tn.y,Gn.x+Gn.w,Gn.y+Gn.h,u,ri,Qn.x,Qn.y,Nn,wi),Kt(a.dynamicLayoutVertexArray,M,Xe),ee.emplaceBack(Ri,Ri+1,Ri+2),ee.emplaceBack(Ri+1,Ri+2,Ri+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ui[0]),Dt!==o.length-1&&ea===o[Dt+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,b,b.index,{},q,gt&&gt[ea])}a.placedSymbolArray.emplaceBack(M.x,M.y,Ie,this.glyphOffsetArray.length-Ie,Ye,D,B,M.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],S,0,!1,0,Z)},me.prototype._addCollisionDebugVertex=function(a,o,u,p,y,b){return o.emplaceBack(0,0),a.emplaceBack(u.x,u.y,p,y,Math.round(b.x),Math.round(b.y))},me.prototype.addCollisionDebugVertices=function(a,o,u,p,y,b,S){var M=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=M.vertexLength,B=y.layoutVertexArray,Z=y.collisionVertexArray,q=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(B,Z,b,q,ee,new xe(a,o)),this._addCollisionDebugVertex(B,Z,b,q,ee,new xe(u,o)),this._addCollisionDebugVertex(B,Z,b,q,ee,new xe(u,p)),this._addCollisionDebugVertex(B,Z,b,q,ee,new xe(a,p)),M.vertexLength+=4;var _e=y.indexArray;_e.emplaceBack(D,D+1),_e.emplaceBack(D+1,D+2),_e.emplaceBack(D+2,D+3),_e.emplaceBack(D+3,D),M.primitiveLength+=4},me.prototype.addDebugCollisionBoxes=function(a,o,u,p){for(var y=a;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},me.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ct(mf,Rp.members,uc),this.iconCollisionBox=new ct(mf,Rp.members,uc);for(var a=0;a<this.symbolInstances.length;a++){var o=this.symbolInstances.get(a);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},me.prototype._deserializeCollisionBoxesForSymbol=function(a,o,u,p,y,b,S,M,D){for(var B={},Z=o;Z<u;Z++){var q=a.get(Z);B.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},B.textFeatureIndex=q.featureIndex;break}for(var ee=p;ee<y;ee++){var _e=a.get(ee);B.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},B.verticalTextFeatureIndex=_e.featureIndex;break}for(var Le=b;Le<S;Le++){var Ie=a.get(Le);B.iconBox={x1:Ie.x1,y1:Ie.y1,x2:Ie.x2,y2:Ie.y2,anchorPointX:Ie.anchorPointX,anchorPointY:Ie.anchorPointY},B.iconFeatureIndex=Ie.featureIndex;break}for(var Ye=M;Ye<D;Ye++){var Xe=a.get(Ye);B.verticalIconBox={x1:Xe.x1,y1:Xe.y1,x2:Xe.x2,y2:Xe.y2,anchorPointX:Xe.anchorPointX,anchorPointY:Xe.anchorPointY},B.verticalIconFeatureIndex=Xe.featureIndex;break}return B},me.prototype.deserializeCollisionBoxes=function(a){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},me.prototype.hasTextData=function(){return this.text.segments.get().length>0},me.prototype.hasIconData=function(){return this.icon.segments.get().length>0},me.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},me.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},me.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},me.prototype.addIndicesForPlacedSymbol=function(a,o){for(var u=a.placedSymbolArray.get(o),p=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<p;y+=4)a.indexArray.emplaceBack(y,y+1,y+2),a.indexArray.emplaceBack(y+1,y+2,y+3)},me.prototype.getSortedSymbolIndexes=function(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(a),u=Math.cos(a),p=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var M=this.symbolInstances.get(S);p.push(0|Math.round(o*M.anchorX+u*M.anchorY)),y.push(M.featureIndex)}return b.sort(function(D,B){return p[D]-p[B]||y[B]-y[D]}),b},me.prototype.addToSortKeyRanges=function(a,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:a,symbolInstanceEnd:a+1})},me.prototype.sortFeatures=function(a){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,p=this.symbolInstanceIndexes;u<p.length;u+=1){var y=this.symbolInstances.get(p[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,M){b>=0&&M.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Ln("SymbolBucket",me,{omit:["layers","collisionBoxArray","features","compareText"]}),me.MAX_GLYPHS=65535,me.addDynamicAttributes=Kt;var Ke=new Jo({"symbol-placement":new si(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new si(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new si(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kn(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new si(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new si(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new si(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new si(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new si(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kn(pe.layout_symbol["icon-size"]),"icon-text-fit":new si(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new si(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kn(pe.layout_symbol["icon-image"]),"icon-rotate":new Kn(pe.layout_symbol["icon-rotate"]),"icon-padding":new si(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new si(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new Kn(pe.layout_symbol["icon-offset"]),"icon-anchor":new Kn(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new si(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new si(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new si(pe.layout_symbol["text-rotation-alignment"]),"text-field":new Kn(pe.layout_symbol["text-field"]),"text-font":new Kn(pe.layout_symbol["text-font"]),"text-size":new Kn(pe.layout_symbol["text-size"]),"text-max-width":new Kn(pe.layout_symbol["text-max-width"]),"text-line-height":new si(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new Kn(pe.layout_symbol["text-letter-spacing"]),"text-justify":new Kn(pe.layout_symbol["text-justify"]),"text-radial-offset":new Kn(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new si(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new Kn(pe.layout_symbol["text-anchor"]),"text-max-angle":new si(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new si(pe.layout_symbol["text-writing-mode"]),"text-rotate":new Kn(pe.layout_symbol["text-rotate"]),"text-padding":new si(pe.layout_symbol["text-padding"]),"text-keep-upright":new si(pe.layout_symbol["text-keep-upright"]),"text-transform":new Kn(pe.layout_symbol["text-transform"]),"text-offset":new Kn(pe.layout_symbol["text-offset"]),"text-allow-overlap":new si(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new si(pe.layout_symbol["text-ignore-placement"]),"text-optional":new si(pe.layout_symbol["text-optional"])}),Ae={paint:new Jo({"icon-opacity":new Kn(pe.paint_symbol["icon-opacity"]),"icon-color":new Kn(pe.paint_symbol["icon-color"]),"icon-halo-color":new Kn(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kn(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kn(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new si(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new si(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kn(pe.paint_symbol["text-opacity"]),"text-color":new Kn(pe.paint_symbol["text-color"],{runtimeType:xn,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new Kn(pe.paint_symbol["text-halo-color"]),"text-halo-width":new Kn(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new Kn(pe.paint_symbol["text-halo-blur"]),"text-translate":new si(pe.paint_symbol["text-translate"]),"text-translate-anchor":new si(pe.paint_symbol["text-translate-anchor"])}),layout:Ke},At=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Mn,this.defaultValue=o};At.prototype.evaluate=function(a){if(a.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(a.formattedSection))return o.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default},At.prototype.eachChild=function(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)},At.prototype.outputDefined=function(){return!1},At.prototype.serialize=function(){return null},Ln("FormatSectionOverride",At,{omit:["defaultValue"]});var zt=function(a){function o(u){a.call(this,u,Ae)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.recalculate=function(u,p){if(a.prototype.recalculate.call(this,u,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,M=y;S<M.length;S+=1){var D=M[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,p,y,b){var S=this.layout.get(u).evaluate(p,{},y,b),M=this._unevaluatedLayout._values[u];return M.isDataDriven()||jl(M.value)||!S?S:function(D,B){return B.replace(/{([^{}]+)}/g,function(Z,q){return q in D?String(D[q]):""})}(p.properties,S)},o.prototype.createBucket=function(u){return new me(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,p=Ae.paint.overridableProperties;u<p.length;u+=1){var y=p[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),M=new At(S),D=new bu(M,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Js("source",D):new Nu("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new cs(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,p,y){return!(!this.layout||p.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,p){var y=u.get("text-field"),b=Ae.paint.properties[p],S=!1,M=function(q){for(var ee=0,_e=q;ee<_e.length;ee+=1)if(b.overrides&&b.overrides.hasOverride(_e[ee]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof ia)M(y.value.value.sections);else if(y.value.kind==="source"){var D=function Z(q){S||(q instanceof ga&&Ta(q.value)===Zi?M(q.value.sections):q instanceof qo?M(q.sections):q.eachChild(Z))},B=y.value;B._styleExpression&&D(B._styleExpression.expression)}return S},o}(Vu),Mr={paint:new Jo({"background-color":new si(pe.paint_background["background-color"]),"background-pattern":new bs(pe.paint_background["background-pattern"]),"background-opacity":new si(pe.paint_background["background-opacity"])})},on=function(a){function o(u){a.call(this,u,Mr)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o}(Vu),sn={paint:new Jo({"raster-opacity":new si(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new si(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new si(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new si(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new si(pe.paint_raster["raster-saturation"]),"raster-contrast":new si(pe.paint_raster["raster-contrast"]),"raster-resampling":new si(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new si(pe.paint_raster["raster-fade-duration"])})},Cn=function(a){function o(u){a.call(this,u,sn)}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o}(Vu),en=function(a){function o(u){a.call(this,u,{}),this.implementation=u}return a&&(o.__proto__=a),(o.prototype=Object.create(a&&a.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(Vu),$n={circle:xf,heatmap:ph,hillshade:Ef,fill:Sp,"fill-extrusion":Dc,line:Od,symbol:zt,background:on,raster:Cn},On=Ee.HTMLImageElement,jn=Ee.HTMLCanvasElement,Vn=Ee.HTMLVideoElement,Xn=Ee.ImageData,di=Ee.ImageBitmap,pa=function(o,u,p,y){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(u,y)};pa.prototype.update=function(a,o,u){var p=a.width,y=a.height,b=!(this.size&&this.size[0]===p&&this.size[1]===y||u),S=this.context,M=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[p,y],a instanceof On||a instanceof jn||a instanceof Vn||a instanceof Xn||di&&a instanceof di?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,a):M.texImage2D(M.TEXTURE_2D,0,this.format,p,y,0,this.format,M.UNSIGNED_BYTE,a.data);else{var D=u||{x:0,y:0},B=D.x,Z=D.y;a instanceof On||a instanceof jn||a instanceof Vn||a instanceof Xn||di&&a instanceof di?M.texSubImage2D(M.TEXTURE_2D,0,B,Z,M.RGBA,M.UNSIGNED_BYTE,a):M.texSubImage2D(M.TEXTURE_2D,0,B,Z,p,y,M.RGBA,M.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},pa.prototype.bind=function(a,o,u){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),u!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=p.LINEAR),a!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,u||a),this.filter=a),o!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,o),this.wrap=o)},pa.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pa.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Po=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Po.prototype.trigger=function(){var a=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){a._triggered=!1,a._callback()},0))},Po.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Xs=function(o,u,p){this.target=o,this.parent=u,this.mapId=p,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Re(["receive","process"],this),this.invoker=new Po(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=qr()?o:Ee};function ql(a,o,u){var p=2*Math.PI*6378137/256/Math.pow(2,u);return[a*p-2*Math.PI*6378137/2,o*p-2*Math.PI*6378137/2]}Xs.prototype.send=function(a,o,u,p,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var M=Pe(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:a,hasCallback:!!u,targetMapId:p,mustQueue:y,sourceMapId:this.mapId,data:Su(o,M)},M),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:p,sourceMapId:b.mapId})}}},Xs.prototype.receive=function(a){var o=a.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var p=this.cancelCallbacks[u];delete this.cancelCallbacks[u],p&&p()}else qr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Xs.prototype.process=function(){if(this.taskQueue.length){var a=this.taskQueue.shift(),o=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(a,o)}},Xs.prototype.processTask=function(a,o){var u=this;if(o.type==="<response>"){var p=this.callbacks[a];delete this.callbacks[a],p&&(o.error?p(Is(o.error)):p(null,Is(o.data)))}else{var y=!1,b=Pe(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,q){y=!0,delete u.cancelCallbacks[a],u.target.postMessage({id:a,type:"<response>",sourceMapId:u.mapId,error:Z?Su(Z):null,data:Su(q,b)},b)}:function(Z){y=!0},M=null,D=Is(o.data);if(this.parent[o.type])M=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var B=o.type.split(".");M=this.parent.getWorkerSource(o.sourceMapId,B[0],D.source)[B[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&M&&M.cancel&&(this.cancelCallbacks[a]=M.cancel)}},Xs.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fa=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Fa.prototype.setNorthEast=function(a){return this._ne=a instanceof na?new na(a.lng,a.lat):na.convert(a),this},Fa.prototype.setSouthWest=function(a){return this._sw=a instanceof na?new na(a.lng,a.lat):na.convert(a),this},Fa.prototype.extend=function(a){var o,u,p=this._sw,y=this._ne;if(a instanceof na)o=a,u=a;else{if(!(a instanceof Fa))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(Fa.convert(a)):this.extend(na.convert(a)):this;if(u=a._ne,!(o=a._sw)||!u)return this}return p||y?(p.lng=Math.min(o.lng,p.lng),p.lat=Math.min(o.lat,p.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new na(o.lng,o.lat),this._ne=new na(u.lng,u.lat)),this},Fa.prototype.getCenter=function(){return new na((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fa.prototype.getSouthWest=function(){return this._sw},Fa.prototype.getNorthEast=function(){return this._ne},Fa.prototype.getNorthWest=function(){return new na(this.getWest(),this.getNorth())},Fa.prototype.getSouthEast=function(){return new na(this.getEast(),this.getSouth())},Fa.prototype.getWest=function(){return this._sw.lng},Fa.prototype.getSouth=function(){return this._sw.lat},Fa.prototype.getEast=function(){return this._ne.lng},Fa.prototype.getNorth=function(){return this._ne.lat},Fa.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fa.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fa.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fa.prototype.contains=function(a){var o=na.convert(a),u=o.lng,p=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&y},Fa.convert=function(a){return!a||a instanceof Fa?a:new Fa(a)};var na=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};na.prototype.wrap=function(){return new na(_t(this.lng,-180,180),this.lat)},na.prototype.toArray=function(){return[this.lng,this.lat]},na.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},na.prototype.distanceTo=function(a){var o=Math.PI/180,u=this.lat*o,p=a.lat*o,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((a.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},na.prototype.toBounds=function(a){a===void 0&&(a=0);var o=360*a/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Fa(new na(this.lng-u,this.lat-o),new na(this.lng+u,this.lat+o))},na.convert=function(a){if(a instanceof na)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new na(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new na(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var hl=2*Math.PI*63710088e-1;function qu(a){return hl*Math.cos(a*Math.PI/180)}function Dp(a){return(180+a)/360}function pl(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Fp(a,o){return a/qu(o)}function wv(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var xh=function(o,u,p){p===void 0&&(p=0),this.x=+o,this.y=+u,this.z=+p};xh.fromLngLat=function(a,o){o===void 0&&(o=0);var u=na.convert(a);return new xh(Dp(u.lng),pl(u.lat),Fp(o,u.lat))},xh.prototype.toLngLat=function(){return new na(360*this.x-180,wv(this.y))},xh.prototype.toAltitude=function(){return this.z*qu(wv(this.y))},xh.prototype.meterInMercatorCoordinateUnits=function(){return 1/hl*(a=wv(this.y),1/Math.cos(a*Math.PI/180));var a};var Kf=function(o,u,p){this.z=o,this.x=u,this.y=p,this.key=Wh(0,o,o,u,p)};Kf.prototype.equals=function(a){return this.z===a.z&&this.x===a.x&&this.y===a.y},Kf.prototype.url=function(a,o){var u,p,y,b,S,M=(p=this.y,y=this.z,b=ql(256*(u=this.x),256*(p=Math.pow(2,y)-p-1),y),S=ql(256*(u+1),256*(p+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(B,Z,q){for(var ee,_e="",Le=B;Le>0;Le--)_e+=(Z&(ee=1<<Le-1)?1:0)+(q&ee?2:0);return _e}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",M)},Kf.prototype.getTilePoint=function(a){var o=Math.pow(2,this.z);return new xe(8192*(a.x*o-this.x),8192*(a.y*o-this.y))},Kf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var wm=function(o,u){this.wrap=o,this.canonical=u,this.key=Wh(o,u.z,u.z,u.x,u.y)},as=function(o,u,p,y,b){this.overscaledZ=o,this.wrap=u,this.canonical=new Kf(p,+y,+b),this.key=Wh(u,o,p,y,b)};function Wh(a,o,u,p,y){(a*=2)<0&&(a=-1*a-1);var b=1<<u;return(b*b*a+b*y+p).toString(36)+u.toString(36)+o.toString(36)}as.prototype.equals=function(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)},as.prototype.scaledTo=function(a){var o=this.canonical.z-a;return a>this.canonical.z?new as(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new as(a,this.wrap,a,this.canonical.x>>o,this.canonical.y>>o)},as.prototype.calculateScaledKey=function(a,o){var u=this.canonical.z-a;return a>this.canonical.z?Wh(this.wrap*+o,a,this.canonical.z,this.canonical.x,this.canonical.y):Wh(this.wrap*+o,a,a,this.canonical.x>>u,this.canonical.y>>u)},as.prototype.isChildOf=function(a){if(a.wrap!==this.wrap)return!1;var o=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>o&&a.canonical.y===this.canonical.y>>o},as.prototype.children=function(a){if(this.overscaledZ>=a)return[new as(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new as(o,this.wrap,o,u,p),new as(o,this.wrap,o,u+1,p),new as(o,this.wrap,o,u,p+1),new as(o,this.wrap,o,u+1,p+1)]},as.prototype.isLessThan=function(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))},as.prototype.wrapped=function(){return new as(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},as.prototype.unwrapTo=function(a){return new as(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)},as.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},as.prototype.toUnwrapped=function(){return new wm(this.wrap,this.canonical)},as.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},as.prototype.getTilePoint=function(a){return this.canonical.getTilePoint(new xh(a.x-this.wrap,a.y))},Ln("CanonicalTileID",Kf),Ln("OverscaledTileID",as,{omit:["posMatrix"]});var Af=function(o,u,p){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return Zt('"'+p+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var y=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=p||"mapbox";for(var b=0;b<y;b++)this.data[this._idx(-1,b)]=this.data[this._idx(0,b)],this.data[this._idx(y,b)]=this.data[this._idx(y-1,b)],this.data[this._idx(b,-1)]=this.data[this._idx(b,0)],this.data[this._idx(b,y)]=this.data[this._idx(b,y-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(y,-1)]=this.data[this._idx(y-1,0)],this.data[this._idx(-1,y)]=this.data[this._idx(0,y-1)],this.data[this._idx(y,y)]=this.data[this._idx(y-1,y-1)]};Af.prototype.get=function(a,o){var u=new Uint8Array(this.data.buffer),p=4*this._idx(a,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[p],u[p+1],u[p+2])},Af.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Af.prototype._idx=function(a,o){if(a<-1||a>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(a+1)},Af.prototype._unpackMapbox=function(a,o,u){return(256*a*256+256*o+u)/10-1e4},Af.prototype._unpackTerrarium=function(a,o,u){return 256*a+o+u/256-32768},Af.prototype.getPixels=function(){return new Ua({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Af.prototype.backfillBorder=function(a,o,u){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");var p=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var M=-o*this.dim,D=-u*this.dim,B=b;B<S;B++)for(var Z=p;Z<y;Z++)this.data[this._idx(Z,B)]=a.data[this._idx(Z+M,B+D)]},Ln("DEMData",Af);var Ld=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var p=o[u];this._stringToNumber[p]=u,this._numberToString[u]=p}};Ld.prototype.encode=function(a){return this._stringToNumber[a]},Ld.prototype.decode=function(a){return this._numberToString[a]};var Dd=function(o,u,p,y,b){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=p,o._y=y,this.properties=o.properties,this.id=b},Av={geometry:{configurable:!0}};Av.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Av.geometry.set=function(a){this._geometry=a},Dd.prototype.toJSON=function(){var a={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(a[o]=this[o]);return a},Object.defineProperties(Dd.prototype,Av);var Zh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Zh.prototype.updateState=function(a,o,u){var p=String(o);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][p]=this.stateChanges[a][p]||{},Ve(this.stateChanges[a][p],u),this.deletedStates[a]===null)for(var y in this.deletedStates[a]={},this.state[a])y!==p&&(this.deletedStates[a][y]=null);else if(this.deletedStates[a]&&this.deletedStates[a][p]===null)for(var b in this.deletedStates[a][p]={},this.state[a][p])u[b]||(this.deletedStates[a][p][b]=null);else for(var S in u)this.deletedStates[a]&&this.deletedStates[a][p]&&this.deletedStates[a][p][S]===null&&delete this.deletedStates[a][p][S]},Zh.prototype.removeFeatureState=function(a,o,u){if(this.deletedStates[a]!==null){var p=String(o);if(this.deletedStates[a]=this.deletedStates[a]||{},u&&o!==void 0)this.deletedStates[a][p]!==null&&(this.deletedStates[a][p]=this.deletedStates[a][p]||{},this.deletedStates[a][p][u]=null);else if(o!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][p])for(u in this.deletedStates[a][p]={},this.stateChanges[a][p])this.deletedStates[a][p][u]=null;else this.deletedStates[a][p]=null;else this.deletedStates[a]=null}},Zh.prototype.getState=function(a,o){var u=String(o),p=Ve({},(this.state[a]||{})[u],(this.stateChanges[a]||{})[u]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){var y=this.deletedStates[a][o];if(y===null)return{};for(var b in y)delete p[b]}return p},Zh.prototype.initializeTileState=function(a,o){a.setFeatureState(this.state,o)},Zh.prototype.coalesceChanges=function(a,o){var u={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var y={};for(var b in this.stateChanges[p])this.state[p][b]||(this.state[p][b]={}),Ve(this.state[p][b],this.stateChanges[p][b]),y[b]=this.state[p][b];u[p]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var D in this.state[S])M[D]={},this.state[S][D]={};else for(var B in this.deletedStates[S]){if(this.deletedStates[S][B]===null)this.state[S][B]={};else for(var Z=0,q=Object.keys(this.deletedStates[S][B]);Z<q.length;Z+=1)delete this.state[S][B][q[Z]];M[B]=this.state[S][B]}u[S]=u[S]||{},Ve(u[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in a)a[ee].setFeatureState(u,o)};var Fc=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Eu(8192,16,0),this.grid3D=new Eu(8192,16,0),this.featureIndexArray=new Y,this.promoteId=u};function Tv(a,o,u,p,y){return Pr(a,function(b,S){var M=o instanceof pf?o.get(S):null;return M&&M.evaluate?M.evaluate(u,p,y):M})}function Am(a){for(var o=1/0,u=1/0,p=-1/0,y=-1/0,b=0,S=a;b<S.length;b+=1){var M=S[b];o=Math.min(o,M.x),u=Math.min(u,M.y),p=Math.max(p,M.x),y=Math.max(y,M.y)}return{minX:o,minY:u,maxX:p,maxY:y}}function og(a,o){return o-a}Fc.prototype.insert=function(a,o,u,p,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y);for(var M=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var B=o[D],Z=[1/0,1/0,-1/0,-1/0],q=0;q<B.length;q++){var ee=B[q];Z[0]=Math.min(Z[0],ee.x),Z[1]=Math.min(Z[1],ee.y),Z[2]=Math.max(Z[2],ee.x),Z[3]=Math.max(Z[3],ee.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&M.insert(S,Z[0],Z[1],Z[2],Z[3])}},Fc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new wf.VectorTile(new Hh(this.rawTileData)).layers,this.sourceLayerCoder=new Ld(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Fc.prototype.query=function(a,o,u,p){var y=this;this.loadVTLayers();for(var b=a.params||{},S=8192/a.tileSize/a.scale,M=al(b.filter),D=a.queryGeometry,B=a.queryPadding*S,Z=Am(D),q=this.grid.query(Z.minX-B,Z.minY-B,Z.maxX+B,Z.maxY+B),ee=Am(a.cameraQueryGeometry),_e=this.grid3D.query(ee.minX-B,ee.minY-B,ee.maxX+B,ee.maxY+B,function(Xt,yr,or,Jr){return function(tn,Gn,ti,Qn,Nn){for(var wi=0,ui=tn;wi<ui.length;wi+=1){var ri=ui[wi];if(Gn<=ri.x&&ti<=ri.y&&Qn>=ri.x&&Nn>=ri.y)return!0}var ea=[new xe(Gn,ti),new xe(Gn,Nn),new xe(Qn,Nn),new xe(Qn,ti)];if(tn.length>2){for(var Ri=0,Aa=ea;Ri<Aa.length;Ri+=1)if(iu(tn,Aa[Ri]))return!0}for(var _i=0;_i<tn.length-1;_i++)if(Xu(tn[_i],tn[_i+1],ea))return!0;return!1}(a.cameraQueryGeometry,Xt-B,yr-B,or+B,Jr+B)}),Le=0,Ie=_e;Le<Ie.length;Le+=1)q.push(Ie[Le]);q.sort(og);for(var Ye,Xe={},gt=function(yr){var or=q[yr];if(or!==Ye){Ye=or;var Jr=y.featureIndexArray.get(or),tn=null;y.loadMatchingFeature(Xe,Jr.bucketIndex,Jr.sourceLayerIndex,Jr.featureIndex,M,b.layers,b.availableImages,o,u,p,function(Gn,ti,Qn){return tn||(tn=$a(Gn)),ti.queryIntersectsFeature(D,Gn,Qn,tn,y.z,a.transform,S,a.pixelPosMatrix)})}},Dt=0;Dt<q.length;Dt++)gt(Dt);return Xe},Fc.prototype.loadMatchingFeature=function(a,o,u,p,y,b,S,M,D,B,Z){var q=this.bucketLayerIDs[o];if(!b||function(tn,Gn){for(var ti=0;ti<tn.length;ti++)if(Gn.indexOf(tn[ti])>=0)return!0;return!1}(b,q)){var ee=this.sourceLayerCoder.decode(u),_e=this.vtLayers[ee].feature(p);if(y.needGeometry){var Le=fo(_e,!0);if(!y.filter(new $i(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!y.filter(new $i(this.tileID.overscaledZ),_e))return;for(var Ie=this.getId(_e,ee),Ye=0;Ye<q.length;Ye++){var Xe=q[Ye];if(!(b&&b.indexOf(Xe)<0)){var gt=M[Xe];if(gt){var Dt={};Ie!==void 0&&B&&(Dt=B.getState(gt.sourceLayer||"_geojsonTileLayer",Ie));var Xt=Ve({},D[Xe]);Xt.paint=Tv(Xt.paint,gt.paint,_e,Dt,S),Xt.layout=Tv(Xt.layout,gt.layout,_e,Dt,S);var yr=!Z||Z(_e,gt,Dt);if(yr){var or=new Dd(_e,this.z,this.x,this.y,Ie);or.layer=Xt;var Jr=a[Xe];Jr===void 0&&(Jr=a[Xe]=[]),Jr.push({featureIndex:p,feature:or,intersectionZ:yr})}}}}}},Fc.prototype.lookupSymbolFeatures=function(a,o,u,p,y,b,S,M){var D={};this.loadVTLayers();for(var B=al(y),Z=0,q=a;Z<q.length;Z+=1)this.loadMatchingFeature(D,u,p,q[Z],B,b,S,M,o);return D},Fc.prototype.hasLayer=function(a){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var p=0,y=u[o];p<y.length;p+=1)if(a===y[p])return!0;return!1},Fc.prototype.getId=function(a,o){var u=a.id;return this.promoteId&&typeof(u=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},Ln("FeatureIndex",Fc,{omit:["rawTileData","sourceLayerCoder"]});var vs=function(o,u){this.tileID=o,this.uid=st(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};vs.prototype.registerFadeDuration=function(a){var o=a+this.timeAdded;o<Tt.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},vs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},vs.prototype.loadVectorData=function(a,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){for(var p in a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(B,Z){var q={};if(!Z)return q;for(var ee=function(){var Ye=Le[_e],Xe=Ye.layerIds.map(function(Xt){return Z.getLayer(Xt)}).filter(Boolean);if(Xe.length!==0){Ye.layers=Xe,Ye.stateDependentLayerIds&&(Ye.stateDependentLayers=Ye.stateDependentLayerIds.map(function(Xt){return Xe.filter(function(yr){return yr.id===Xt})[0]}));for(var gt=0,Dt=Xe;gt<Dt.length;gt+=1)q[Dt[gt].id]=Ye}},_e=0,Le=B;_e<Le.length;_e+=1)ee();return q}(a.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[p];if(y instanceof me){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof me&&S.hasRTLText){this.hasRTLText=!0,lo.isLoading()||lo.isLoaded()||jf()!=="deferred"||Cu();break}}for(var M in this.queryPadding=0,this.buckets){var D=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(M).queryRadius(D))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new f},vs.prototype.unloadVectorData=function(){for(var a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},vs.prototype.getBucket=function(a){return this.buckets[a.id]},vs.prototype.upload=function(a){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(a)}var p=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pa(a,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pa(a,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},vs.prototype.prepare=function(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)},vs.prototype.queryRenderedFeatures=function(a,o,u,p,y,b,S,M,D,B){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:B,transform:M,params:S,queryPadding:this.queryPadding*D},a,o,u):{}},vs.prototype.querySourceFeatures=function(a,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var p=u.loadVTLayers(),y=o?o.sourceLayer:"",b=p._geojsonTileLayer||p[y];if(b)for(var S=al(o&&o.filter),M=this.tileID.canonical,D=M.z,B=M.x,Z=M.y,q={z:D,x:B,y:Z},ee=0;ee<b.length;ee++){var _e=b.feature(ee);if(S.needGeometry){var Le=fo(_e,!0);if(!S.filter(new $i(this.tileID.overscaledZ),Le,this.tileID.canonical))continue}else if(!S.filter(new $i(this.tileID.overscaledZ),_e))continue;var Ie=u.getId(_e,y),Ye=new Dd(_e,D,B,Z,Ie);Ye.tile=q,a.push(Ye)}}},vs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},vs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},vs.prototype.setExpiryData=function(a){var o=this.expirationTime;if(a.cacheControl){var u=br(a.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){var p=Date.now(),y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},vs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},vs.prototype.setFeatureState=function(a,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(a).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(o.style.hasLayer(p)){var y=this.buckets[p],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],M=a[b];if(S&&M&&Object.keys(M).length!==0){y.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},vs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},vs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Tt.now()},vs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},vs.prototype.setHoldDuration=function(a){this.symbolFadeHoldUntil=Tt.now()+a},vs.prototype.setDependencies=function(a,o){for(var u={},p=0,y=o;p<y.length;p+=1)u[y[p]]=!0;this.dependencies[a]=u},vs.prototype.hasDependency=function(a,o){for(var u=0,p=a;u<p.length;u+=1){var y=this.dependencies[p[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var qf=Ee.performance,Tm=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},qf.mark(this._marks.start)};Tm.prototype.finish=function(){qf.mark(this._marks.end);var a=qf.getEntriesByName(this._marks.measure);return a.length===0&&(qf.measure(this._marks.measure,this._marks.start,this._marks.end),a=qf.getEntriesByName(this._marks.measure),qf.clearMarks(this._marks.start),qf.clearMarks(this._marks.end),qf.clearMeasures(this._marks.measure)),a},m.Actor=Xs,m.AlphaImage=ps,m.CanonicalTileID=Kf,m.CollisionBoxArray=f,m.Color=bi,m.DEMData=Af,m.DataConstantProperty=si,m.DictionaryCoder=Ld,m.EXTENT=8192,m.ErrorEvent=nt,m.EvaluationParameters=$i,m.Event=ke,m.Evented=pt,m.FeatureIndex=Fc,m.FillBucket=au,m.FillExtrusionBucket=cl,m.ImageAtlas=cr,m.ImagePosition=Br,m.LineBucket=ba,m.LngLat=na,m.LngLatBounds=Fa,m.MercatorCoordinate=xh,m.ONE_EM=24,m.OverscaledTileID=as,m.Point=xe,m.Point$1=xe,m.Properties=Jo,m.Protobuf=Hh,m.RGBAImage=Ua,m.RequestManager=Ir,m.RequestPerformance=Tm,m.ResourceType=Hi,m.SegmentVector=ve,m.SourceFeatureState=Zh,m.StructArrayLayout1ui2=Xl,m.StructArrayLayout2f1f2i16=Pc,m.StructArrayLayout2i4=Pl,m.StructArrayLayout3ui6=Zl,m.StructArrayLayout4i8=Gu,m.SymbolBucket=me,m.Texture=pa,m.Tile=vs,m.Transitionable=Ho,m.Uniform1f=Yr,m.Uniform1i=_r,m.Uniform2f=$r,m.Uniform3f=cn,m.Uniform4f=Zn,m.UniformColor=ai,m.UniformMatrix4f=Ui,m.UnwrappedTileID=wm,m.ValidationError=Ue,m.WritingMode=Dn,m.ZoomHistory=lf,m.add=function(a,o,u){return a[0]=o[0]+u[0],a[1]=o[1]+u[1],a[2]=o[2]+u[2],a},m.addDynamicAttributes=Kt,m.asyncAll=function(a,o,u){if(!a.length)return u(null,[]);var p=a.length,y=new Array(a.length),b=null;a.forEach(function(S,M){o(S,function(D,B){D&&(b=D),y[M]=B,--p==0&&u(b,y)})})},m.bezier=at,m.bindAll=Re,m.browser=Tt,m.cacheEntryPossiblyAdded=function(a){++Hn>dn&&(a.getActor().send("enforceCacheSizeLimit",Hr),Hn=0)},m.clamp=vt,m.clearTileCache=function(a){var o=Ee.caches.delete("mapbox-tiles");a&&o.catch(a).then(function(){return a()})},m.clipLine=_o,m.clone=function(a){var o=new Wo(16);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o[3]=a[3],o[4]=a[4],o[5]=a[5],o[6]=a[6],o[7]=a[7],o[8]=a[8],o[9]=a[9],o[10]=a[10],o[11]=a[11],o[12]=a[12],o[13]=a[13],o[14]=a[14],o[15]=a[15],o},m.clone$1=Oe,m.clone$2=function(a){var o=new Wo(3);return o[0]=a[0],o[1]=a[1],o[2]=a[2],o},m.collisionCircleLayout=Sv,m.config=It,m.create=function(){var a=new Wo(16);return Wo!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},m.create$1=function(){var a=new Wo(9);return Wo!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a},m.create$2=function(){var a=new Wo(4);return Wo!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},m.createCommonjsModule=U,m.createExpression=tc,m.createLayout=es,m.createStyleLayer=function(a){return a.type==="custom"?new en(a):new $n[a.type](a)},m.cross=function(a,o,u){var p=o[0],y=o[1],b=o[2],S=u[0],M=u[1],D=u[2];return a[0]=y*D-b*M,a[1]=b*S-p*D,a[2]=p*M-y*S,a},m.deepEqual=function a(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var p=0;p<o.length;p++)if(!a(o[p],u[p]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!a(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]},m.dot$1=function(a,o){return a[0]*o[0]+a[1]*o[1]+a[2]*o[2]+a[3]*o[3]},m.ease=ht,m.emitValidationErrors=sf,m.endsWith=Nr,m.enforceCacheSizeLimit=function(a){Kr(),he&&he.then(function(o){o.keys().then(function(u){for(var p=0;p<u.length-a;p++)o.delete(u[p])})})},m.evaluateSizeForFeature=Yi,m.evaluateSizeForZoom=ho,m.evaluateVariableOffset=er,m.evented=Uf,m.extend=Ve,m.featureFilter=al,m.filterObject=Wt,m.fromRotation=function(a,o){var u=Math.sin(o),p=Math.cos(o);return a[0]=p,a[1]=u,a[2]=0,a[3]=-u,a[4]=p,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},m.getAnchorAlignment=Si,m.getAnchorJustification=Ft,m.getArrayBuffer=js,m.getImage=$,m.getJSON=function(a,o){return As(Ve(a,{type:"json"}),o)},m.getRTLTextPluginStatus=jf,m.getReferrer=To,m.getVideo=function(a,o){var u,p,y=Ee.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<a.length;b++){var S=Ee.document.createElement("source");u=a[b],p=void 0,(p=Ee.document.createElement("a")).href=u,(p.protocol!==Ee.document.location.protocol||p.host!==Ee.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=a[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=ks,m.invert=function(a,o){var u=o[0],p=o[1],y=o[2],b=o[3],S=o[4],M=o[5],D=o[6],B=o[7],Z=o[8],q=o[9],ee=o[10],_e=o[11],Le=o[12],Ie=o[13],Ye=o[14],Xe=o[15],gt=u*M-p*S,Dt=u*D-y*S,Xt=u*B-b*S,yr=p*D-y*M,or=p*B-b*M,Jr=y*B-b*D,tn=Z*Ie-q*Le,Gn=Z*Ye-ee*Le,ti=Z*Xe-_e*Le,Qn=q*Ye-ee*Ie,Nn=q*Xe-_e*Ie,wi=ee*Xe-_e*Ye,ui=gt*wi-Dt*Nn+Xt*Qn+yr*ti-or*Gn+Jr*tn;return ui?(a[0]=(M*wi-D*Nn+B*Qn)*(ui=1/ui),a[1]=(y*Nn-p*wi-b*Qn)*ui,a[2]=(Ie*Jr-Ye*or+Xe*yr)*ui,a[3]=(ee*or-q*Jr-_e*yr)*ui,a[4]=(D*ti-S*wi-B*Gn)*ui,a[5]=(u*wi-y*ti+b*Gn)*ui,a[6]=(Ye*Xt-Le*Jr-Xe*Dt)*ui,a[7]=(Z*Jr-ee*Xt+_e*Dt)*ui,a[8]=(S*Nn-M*ti+B*tn)*ui,a[9]=(p*ti-u*Nn-b*tn)*ui,a[10]=(Le*or-Ie*Xt+Xe*gt)*ui,a[11]=(q*Xt-Z*or-_e*gt)*ui,a[12]=(M*Gn-S*Qn-D*tn)*ui,a[13]=(u*Qn-p*Gn+y*tn)*ui,a[14]=(Ie*Dt-Le*yr-Ye*gt)*ui,a[15]=(Z*yr-q*Dt+ee*gt)*ui,a):null},m.isChar=gn,m.isMapboxURL=ur,m.keysDifference=function(a,o){var u=[];for(var p in a)p in o||u.push(p);return u},m.makeRequest=As,m.mapObject=Pr,m.mercatorXfromLng=Dp,m.mercatorYfromLat=pl,m.mercatorZfromAltitude=Fp,m.mul=hs,m.multiply=Zo,m.mvt=wf,m.nextPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},m.normalize=function(a,o){var u=o[0],p=o[1],y=o[2],b=u*u+p*p+y*y;return b>0&&(b=1/Math.sqrt(b)),a[0]=o[0]*b,a[1]=o[1]*b,a[2]=o[2]*b,a},m.number=Ya,m.offscreenCanvasSupported=ii,m.ortho=function(a,o,u,p,y,b,S){var M=1/(o-u),D=1/(p-y),B=1/(b-S);return a[0]=-2*M,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*D,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*B,a[11]=0,a[12]=(o+u)*M,a[13]=(y+p)*D,a[14]=(S+b)*B,a[15]=1,a},m.parseGlyphPBF=function(a){return new Hh(a).readFields(rn,[])},m.pbf=Hh,m.performSymbolLayout=function(a,o,u,p,y,b,S){a.createArrays(),a.tilePixelRatio=8192/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;var M=a.layers[0].layout,D=a.layers[0]._unevaluatedLayout._values,B={};if(a.textSizeData.kind==="composite"){var Z=a.textSizeData,q=Z.maxZoom;B.compositeTextSizes=[D["text-size"].possiblyEvaluate(new $i(Z.minZoom),S),D["text-size"].possiblyEvaluate(new $i(q),S)]}if(a.iconSizeData.kind==="composite"){var ee=a.iconSizeData,_e=ee.maxZoom;B.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new $i(ee.minZoom),S),D["icon-size"].possiblyEvaluate(new $i(_e),S)]}B.layoutTextSize=D["text-size"].possiblyEvaluate(new $i(a.zoom+1),S),B.layoutIconSize=D["icon-size"].possiblyEvaluate(new $i(a.zoom+1),S),B.textMaxSize=D["text-size"].possiblyEvaluate(new $i(18));for(var Le=24*M.get("text-line-height"),Ie=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ye=M.get("text-keep-upright"),Xe=M.get("text-size"),gt=function(){var or=Xt[Dt],Jr=M.get("text-font").evaluate(or,{},S).join(","),tn=Xe.evaluate(or,{},S),Gn=B.layoutTextSize.evaluate(or,{},S),ti=B.layoutIconSize.evaluate(or,{},S),Qn={horizontal:{},vertical:void 0},Nn=or.text,wi=[0,0];if(Nn){var ui=Nn.toString(),ri=24*M.get("text-letter-spacing").evaluate(or,{},S),ea=function(xa){for(var sa=0,ja=xa;sa<ja.length;sa+=1)if(Ja=ja[sa].charCodeAt(0),gn.Arabic(Ja)||gn["Arabic Supplement"](Ja)||gn["Arabic Extended-A"](Ja)||gn["Arabic Presentation Forms-A"](Ja)||gn["Arabic Presentation Forms-B"](Ja))return!1;var Ja;return!0}(ui)?ri:0,Ri=M.get("text-anchor").evaluate(or,{},S),Aa=M.get("text-variable-anchor");if(!Aa){var _i=M.get("text-radial-offset").evaluate(or,{},S);wi=_i?er(Ri,[24*_i,De]):M.get("text-offset").evaluate(or,{},S).map(function(xa){return 24*xa})}var oa=Ie?"center":M.get("text-justify").evaluate(or,{},S),qa=M.get("symbol-placement"),Qa=qa==="point"?24*M.get("text-max-width").evaluate(or,{},S):0,bo=function(){a.allowVerticalPlacement&&Hl(ui)&&(Qn.vertical=xr(Nn,o,u,y,Jr,Qa,Le,Ri,"left",ea,wi,Dn.vertical,!0,qa,Gn,tn))};if(!Ie&&Aa){for(var Eo=oa==="auto"?Aa.map(function(xa){return Ft(xa)}):[oa],Oo=!1,Ns=0;Ns<Eo.length;Ns++){var Yo=Eo[Ns];if(!Qn.horizontal[Yo])if(Oo)Qn.horizontal[Yo]=Qn.horizontal[0];else{var ou=xr(Nn,o,u,y,Jr,Qa,Le,"center",Yo,ea,wi,Dn.horizontal,!1,qa,Gn,tn);ou&&(Qn.horizontal[Yo]=ou,Oo=ou.positionedLines.length===1)}}bo()}else{oa==="auto"&&(oa=Ft(Ri));var Cs=xr(Nn,o,u,y,Jr,Qa,Le,Ri,oa,ea,wi,Dn.horizontal,!1,qa,Gn,tn);Cs&&(Qn.horizontal[oa]=Cs),bo(),Hl(ui)&&Ie&&Ye&&(Qn.vertical=xr(Nn,o,u,y,Jr,Qa,Le,Ri,oa,ea,wi,Dn.vertical,!1,qa,Gn,tn))}}var su=void 0,ms=!1;if(or.icon&&or.icon.name){var os=p[or.icon.name];os&&(su=function(xa,sa,ja){var Ja=Si(ja),uu=sa[0]-xa.displaySize[0]*Ja.horizontalAlign,no=sa[1]-xa.displaySize[1]*Ja.verticalAlign;return{image:xa,top:no,bottom:no+xa.displaySize[1],left:uu,right:uu+xa.displaySize[0]}}(y[or.icon.name],M.get("icon-offset").evaluate(or,{},S),M.get("icon-anchor").evaluate(or,{},S)),ms=os.sdf,a.sdfIcons===void 0?a.sdfIcons=os.sdf:a.sdfIcons!==os.sdf&&Zt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(os.pixelRatio!==a.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}var gs=Vi(Qn.horizontal)||Qn.vertical;a.iconsInText=!!gs&&gs.iconsInText,(gs||su)&&function(xa,sa,ja,Ja,uu,no,So,zs,da,Bc,Dl){var hc=no.textMaxSize.evaluate(sa,{});hc===void 0&&(hc=So);var dl,Us=xa.layers[0].layout,Nc=Us.get("icon-offset").evaluate(sa,{},Dl),zc=Vi(ja.horizontal),Uc=So/24,Bp=xa.tilePixelRatio*Uc,jc=xa.tilePixelRatio*hc/24,Np=xa.tilePixelRatio*zs,zp=xa.tilePixelRatio*Us.get("symbol-spacing"),Xh=Us.get("text-padding")*xa.tilePixelRatio,Fd=Us.get("icon-padding")*xa.tilePixelRatio,Up=Us.get("text-max-angle")/180*Math.PI,jp=Us.get("text-rotation-alignment")==="map"&&Us.get("symbol-placement")!=="point",Tf=Us.get("icon-rotation-alignment")==="map"&&Us.get("symbol-placement")!=="point",bh=Us.get("symbol-placement"),Vp=zp/2,Yh=Us.get("icon-text-fit");Ja&&Yh!=="none"&&(xa.allowVerticalPlacement&&ja.vertical&&(dl=En(Ja,ja.vertical,Yh,Us.get("icon-text-fit-padding"),Nc,Uc)),zc&&(Ja=En(Ja,zc,Yh,Us.get("icon-text-fit-padding"),Nc,Uc)));var Qf=function(sg,Yp){Yp.x<0||Yp.x>=8192||Yp.y<0||Yp.y>=8192||function(Io,pc,ug,Jf,Rv,Om,$p,dc,Kp,qp,Vd,Gd,kv,Im,tp,Rm,Lv,Dv,Fv,Bv,vl,Hd,km,Vc,lg){var Lm,Eh,Sh,rp,np,ip=Io.addToLineVertexArray(pc,ug),Dm=0,Fm=0,Bm=0,Nm=0,Nv=-1,zv=-1,Mf={},zm=Ne(""),Uv=0,jv=0;if(dc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Uv=(Lm=dc.layout.get("text-offset").evaluate(vl,{},Vc).map(function(Yd){return 24*Yd}))[0],jv=Lm[1]):(Uv=24*dc.layout.get("text-radial-offset").evaluate(vl,{},Vc),jv=De),Io.allowVerticalPlacement&&Jf.vertical){var Vv=dc.layout.get("text-rotate").evaluate(vl,{},Vc)+90;rp=new zo(Kp,pc,qp,Vd,Gd,Jf.vertical,kv,Im,tp,Vv),$p&&(np=new zo(Kp,pc,qp,Vd,Gd,$p,Lv,Dv,tp,Vv))}if(Rv){var Wd=dc.layout.get("icon-rotate").evaluate(vl,{}),Um=dc.layout.get("icon-text-fit")!=="none",Gv=Fs(Rv,Wd,km,Um),Zd=$p?Fs($p,Wd,km,Um):void 0;Sh=new zo(Kp,pc,qp,Vd,Gd,Rv,Lv,Dv,!1,Wd),Dm=4*Gv.length;var jm=Io.iconSizeData,Qp=null;jm.kind==="source"?(Qp=[128*dc.layout.get("icon-size").evaluate(vl,{})])[0]>32640&&Zt(Io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):jm.kind==="composite"&&((Qp=[128*Hd.compositeIconSizes[0].evaluate(vl,{},Vc),128*Hd.compositeIconSizes[1].evaluate(vl,{},Vc)])[0]>32640||Qp[1]>32640)&&Zt(Io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Io.addSymbols(Io.icon,Gv,Qp,Bv,Fv,vl,!1,pc,ip.lineStartIndex,ip.lineLength,-1,Vc),Nv=Io.icon.placedSymbolArray.length-1,Zd&&(Fm=4*Zd.length,Io.addSymbols(Io.icon,Zd,Qp,Bv,Fv,vl,Dn.vertical,pc,ip.lineStartIndex,ip.lineLength,-1,Vc),zv=Io.icon.placedSymbolArray.length-1)}for(var Hv in Jf.horizontal){var Xd=Jf.horizontal[Hv];if(!Eh){zm=Ne(Xd.text);var Vm=dc.layout.get("text-rotate").evaluate(vl,{},Vc);Eh=new zo(Kp,pc,qp,Vd,Gd,Xd,kv,Im,tp,Vm)}var Wv=Xd.positionedLines.length===1;if(Bm+=Pn(Io,pc,Xd,Om,dc,tp,vl,Rm,ip,Jf.vertical?Dn.horizontal:Dn.horizontalOnly,Wv?Object.keys(Jf.horizontal):[Hv],Mf,Nv,Hd,Vc),Wv)break}Jf.vertical&&(Nm+=Pn(Io,pc,Jf.vertical,Om,dc,tp,vl,Rm,ip,Dn.vertical,["vertical"],Mf,zv,Hd,Vc));var cg=Eh?Eh.boxStartIndex:Io.collisionBoxArray.length,Gm=Eh?Eh.boxEndIndex:Io.collisionBoxArray.length,Hm=rp?rp.boxStartIndex:Io.collisionBoxArray.length,fg=rp?rp.boxEndIndex:Io.collisionBoxArray.length,hg=Sh?Sh.boxStartIndex:Io.collisionBoxArray.length,Ro=Sh?Sh.boxEndIndex:Io.collisionBoxArray.length,pg=np?np.boxStartIndex:Io.collisionBoxArray.length,dg=np?np.boxEndIndex:Io.collisionBoxArray.length,vc=-1,Jp=function(Xv,Wm){return Xv&&Xv.circleDiameter?Math.max(Xv.circleDiameter,Wm):Wm};vc=Jp(Eh,vc),vc=Jp(rp,vc),vc=Jp(Sh,vc);var Zv=(vc=Jp(np,vc))>-1?1:0;Zv&&(vc*=lg/24),Io.glyphOffsetArray.length>=me.MAX_GLYPHS&&Zt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),vl.sortKey!==void 0&&Io.addToSortKeyRanges(Io.symbolInstances.length,vl.sortKey),Io.symbolInstances.emplaceBack(pc.x,pc.y,Mf.right>=0?Mf.right:-1,Mf.center>=0?Mf.center:-1,Mf.left>=0?Mf.left:-1,Mf.vertical||-1,Nv,zv,zm,cg,Gm,Hm,fg,hg,Ro,pg,dg,qp,Bm,Nm,Dm,Fm,Zv,0,kv,Uv,jv,vc)}(xa,Yp,sg,ja,Ja,uu,dl,xa.layers[0],xa.collisionBoxArray,sa.index,sa.sourceLayerIndex,xa.index,Bp,Xh,jp,da,Np,Fd,Tf,Nc,sa,no,Bc,Dl,So)};if(bh==="line")for(var $h=0,Bd=_o(sa.geometry,0,0,8192,8192);$h<Bd.length;$h+=1)for(var Nd=Bd[$h],Kh=0,zd=aa(Nd,zp,Up,ja.vertical||zc,Ja,24,jc,xa.overscaling,8192);Kh<zd.length;Kh+=1){var Ud=zd[Kh];zc&&we(xa,zc.text,Vp,Ud)||Qf(Nd,Ud)}else if(bh==="line-center")for(var qh=0,jd=sa.geometry;qh<jd.length;qh+=1){var Gp=jd[qh];if(Gp.length>1){var Hp=Ai(Gp,Up,ja.vertical||zc,Ja,24,jc);Hp&&Qf(Gp,Hp)}}else if(sa.type==="Polygon")for(var Wp=0,Qh=Zs(sa.geometry,0);Wp<Qh.length;Wp+=1){var Zp=Qh[Wp],Jh=Da(Zp,16);Qf(Zp[0],new hi(Jh.x,Jh.y,0))}else if(sa.type==="LineString")for(var ep=0,Xp=sa.geometry;ep<Xp.length;ep+=1){var Mv=Xp[ep];Qf(Mv,new hi(Mv[0].x,Mv[0].y,0))}else if(sa.type==="Point")for(var Pv=0,Mm=sa.geometry;Pv<Mm.length;Pv+=1)for(var Ov=0,Pm=Mm[Pv];Ov<Pm.length;Ov+=1){var Iv=Pm[Ov];Qf([Iv],new hi(Iv.x,Iv.y,0))}}(a,or,Qn,su,p,B,Gn,ti,wi,ms,S)},Dt=0,Xt=a.features;Dt<Xt.length;Dt+=1)gt();b&&a.generateCollisionDebugBuffers()},m.perspective=function(a,o,u,p,y){var b,S=1/Math.tan(o/2);return a[0]=S/u,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=S,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,y!=null&&y!==1/0?(a[10]=(y+p)*(b=1/(p-y)),a[14]=2*y*p*b):(a[10]=-1,a[14]=-2*p),a},m.pick=function(a,o){for(var u={},p=0;p<o.length;p++){var y=o[p];y in a&&(u[y]=a[y])}return u},m.plugin=lo,m.polygonIntersectsPolygon=Ol,m.postMapLoadEvent=Er,m.postTurnstileEvent=us,m.potpack=Ht,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=Ln,m.registerForPluginStateChange=function(a){return a({pluginStatus:tu,pluginURL:Uu}),Uf.on("pluginStateChange",a),a},m.renderColorRamp=bf,m.rotate=function(a,o,u){var p=o[0],y=o[1],b=o[2],S=o[3],M=Math.sin(u),D=Math.cos(u);return a[0]=p*D+b*M,a[1]=y*D+S*M,a[2]=p*-M+b*D,a[3]=y*-M+S*D,a},m.rotateX=function(a,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],M=o[6],D=o[7],B=o[8],Z=o[9],q=o[10],ee=o[11];return o!==a&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[4]=b*y+B*p,a[5]=S*y+Z*p,a[6]=M*y+q*p,a[7]=D*y+ee*p,a[8]=B*y-b*p,a[9]=Z*y-S*p,a[10]=q*y-M*p,a[11]=ee*y-D*p,a},m.rotateZ=function(a,o,u){var p=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],M=o[2],D=o[3],B=o[4],Z=o[5],q=o[6],ee=o[7];return o!==a&&(a[8]=o[8],a[9]=o[9],a[10]=o[10],a[11]=o[11],a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15]),a[0]=b*y+B*p,a[1]=S*y+Z*p,a[2]=M*y+q*p,a[3]=D*y+ee*p,a[4]=B*y-b*p,a[5]=Z*y-S*p,a[6]=q*y-M*p,a[7]=ee*y-D*p,a},m.scale=function(a,o,u){var p=u[0],y=u[1],b=u[2];return a[0]=o[0]*p,a[1]=o[1]*p,a[2]=o[2]*p,a[3]=o[3]*p,a[4]=o[4]*y,a[5]=o[5]*y,a[6]=o[6]*y,a[7]=o[7]*y,a[8]=o[8]*b,a[9]=o[9]*b,a[10]=o[10]*b,a[11]=o[11]*b,a[12]=o[12],a[13]=o[13],a[14]=o[14],a[15]=o[15],a},m.scale$1=function(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a[3]=o[3]*u,a},m.scale$2=function(a,o,u){return a[0]=o[0]*u,a[1]=o[1]*u,a[2]=o[2]*u,a},m.setCacheLimits=function(a,o){Hr=a,dn=o},m.setRTLTextPlugin=function(a,o,u){if(u===void 0&&(u=!1),tu==="deferred"||tu==="loading"||tu==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Uu=Tt.resolveURL(a),tu="deferred",ff=o,hf(),u||Cu()},m.sphericalToCartesian=function(a){var o=a[0],u=a[1],p=a[2];return u+=90,u*=Math.PI/180,p*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(p),y:o*Math.sin(u)*Math.sin(p),z:o*Math.cos(p)}},m.sqrLen=function(a){var o=a[0],u=a[1];return o*o+u*u},m.styleSpec=pe,m.sub=function(a,o,u){return a[0]=o[0]-u[0],a[1]=o[1]-u[1],a[2]=o[2]-u[2],a},m.symbolSize=Ao,m.transformMat3=function(a,o,u){var p=o[0],y=o[1],b=o[2];return a[0]=p*u[0]+y*u[3]+b*u[6],a[1]=p*u[1]+y*u[4]+b*u[7],a[2]=p*u[2]+y*u[5]+b*u[8],a},m.transformMat4=Ls,m.translate=function(a,o,u){var p,y,b,S,M,D,B,Z,q,ee,_e,Le,Ie=u[0],Ye=u[1],Xe=u[2];return o===a?(a[12]=o[0]*Ie+o[4]*Ye+o[8]*Xe+o[12],a[13]=o[1]*Ie+o[5]*Ye+o[9]*Xe+o[13],a[14]=o[2]*Ie+o[6]*Ye+o[10]*Xe+o[14],a[15]=o[3]*Ie+o[7]*Ye+o[11]*Xe+o[15]):(y=o[1],b=o[2],S=o[3],M=o[4],D=o[5],B=o[6],Z=o[7],q=o[8],ee=o[9],_e=o[10],Le=o[11],a[0]=p=o[0],a[1]=y,a[2]=b,a[3]=S,a[4]=M,a[5]=D,a[6]=B,a[7]=Z,a[8]=q,a[9]=ee,a[10]=_e,a[11]=Le,a[12]=p*Ie+M*Ye+q*Xe+o[12],a[13]=y*Ie+D*Ye+ee*Xe+o[13],a[14]=b*Ie+B*Ye+_e*Xe+o[14],a[15]=S*Ie+Z*Ye+Le*Xe+o[15]),a},m.triggerPluginCompletionEvent=ch,m.uniqueId=st,m.validateCustomStyleLayer=function(a){var o=[],u=a.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),a.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=xp,m.validateStyle=af,m.values=function(a){var o=[];for(var u in a)o.push(a[u]);return o},m.vectorTile=wf,m.version="1.13.2",m.warnOnce=Zt,m.webpSupported=$t,m.window=Ee,m.wrap=_t}),j(["./shared"],function(m){"use strict";function U(J){var $=typeof J;if($==="number"||$==="boolean"||$==="string"||J==null)return JSON.stringify(J);if(Array.isArray(J)){for(var le="[",ge=0,ke=J;ge<ke.length;ge+=1)le+=U(ke[ge])+",";return le+"]"}for(var nt=Object.keys(J).sort(),pt="{",pe=0;pe<nt.length;pe++)pt+=JSON.stringify(nt[pe])+":"+U(J[nt[pe]])+",";return pt+"}"}function G(J){for(var $="",le=0,ge=m.refProperties;le<ge.length;le+=1)$+="/"+U(J[ge[le]]);return $}var Te=function($){this.keyCache={},$&&this.replace($)};Te.prototype.replace=function(J){this._layerConfigs={},this._layers={},this.update(J,[])},Te.prototype.update=function(J,$){for(var le=this,ge=0,ke=J;ge<ke.length;ge+=1){var nt=ke[ge];this._layerConfigs[nt.id]=nt;var pt=this._layers[nt.id]=m.createStyleLayer(nt);pt._featureFilter=m.featureFilter(pt.filter),this.keyCache[nt.id]&&delete this.keyCache[nt.id]}for(var pe=0,Ue=$;pe<Ue.length;pe+=1){var qe=Ue[pe];delete this.keyCache[qe],delete this._layerConfigs[qe],delete this._layers[qe]}this.familiesBySource={};for(var Cr=0,Tr=function(mn,xn){for(var w={},An=0;An<mn.length;An++){var Lr=xn&&xn[mn[An].id]||G(mn[An]);xn&&(xn[mn[An].id]=Lr);var Zi=w[Lr];Zi||(Zi=w[Lr]=[]),Zi.push(mn[An])}var Ti=[];for(var Un in w)Ti.push(w[Un]);return Ti}(m.values(this._layerConfigs),this.keyCache);Cr<Tr.length;Cr+=1){var tr=Tr[Cr].map(function(mn){return le._layers[mn.id]}),Dr=tr[0];if(Dr.visibility!=="none"){var nn=Dr.source||"",Mn=this.familiesBySource[nn];Mn||(Mn=this.familiesBySource[nn]={});var rr=Dr.sourceLayer||"_geojsonTileLayer",wn=Mn[rr];wn||(wn=Mn[rr]=[]),wn.push(tr)}}};var xe=function($){var le={},ge=[];for(var ke in $){var nt=$[ke],pt=le[ke]={};for(var pe in nt){var Ue=nt[+pe];if(Ue&&Ue.bitmap.width!==0&&Ue.bitmap.height!==0){var qe={x:0,y:0,w:Ue.bitmap.width+2,h:Ue.bitmap.height+2};ge.push(qe),pt[pe]={rect:qe,metrics:Ue.metrics}}}}var Cr=m.potpack(ge),Tr=new m.AlphaImage({width:Cr.w||1,height:Cr.h||1});for(var tr in $){var Dr=$[tr];for(var nn in Dr){var Mn=Dr[+nn];if(Mn&&Mn.bitmap.width!==0&&Mn.bitmap.height!==0){var rr=le[tr][nn].rect;m.AlphaImage.copy(Mn.bitmap,Tr,{x:0,y:0},{x:rr.x+1,y:rr.y+1},Mn.bitmap)}}}this.image=Tr,this.positions=le};m.register("GlyphAtlas",xe);var Me=function($){this.tileID=new m.OverscaledTileID($.tileID.overscaledZ,$.tileID.wrap,$.tileID.canonical.z,$.tileID.canonical.x,$.tileID.canonical.y),this.uid=$.uid,this.zoom=$.zoom,this.pixelRatio=$.pixelRatio,this.tileSize=$.tileSize,this.source=$.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=$.showCollisionBoxes,this.collectResourceTiming=!!$.collectResourceTiming,this.returnDependencies=!!$.returnDependencies,this.promoteId=$.promoteId};function Ee(J,$,le){for(var ge=new m.EvaluationParameters($),ke=0,nt=J;ke<nt.length;ke+=1)nt[ke].recalculate(ge,le)}function Mt(J,$){var le=m.getArrayBuffer(J.request,function(ge,ke,nt,pt){ge?$(ge):ke&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(ke)),rawData:ke,cacheControl:nt,expires:pt})});return function(){le.cancel(),$()}}Me.prototype.parse=function(J,$,le,ge,ke){var nt=this;this.status="parsing",this.data=J,this.collisionBoxArray=new m.CollisionBoxArray;var pt=new m.DictionaryCoder(Object.keys(J.layers).sort()),pe=new m.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var Ue,qe,Cr,Tr,tr={},Dr={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:le},nn=$.familiesBySource[this.source];for(var Mn in nn){var rr=J.layers[Mn];if(rr){rr.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+Mn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var wn=pt.encode(Mn),mn=[],xn=0;xn<rr.length;xn++){var w=rr.feature(xn),An=pe.getId(w,Mn);mn.push({feature:w,id:An,index:xn,sourceLayerIndex:wn})}for(var Lr=0,Zi=nn[Mn];Lr<Zi.length;Lr+=1){var Ti=Zi[Lr],Un=Ti[0];Un.minzoom&&this.zoom<Math.floor(Un.minzoom)||Un.maxzoom&&this.zoom>=Un.maxzoom||Un.visibility!=="none"&&(Ee(Ti,this.zoom,le),(tr[Un.id]=Un.createBucket({index:pe.bucketLayerIDs.length,layers:Ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:wn,sourceID:this.source})).populate(mn,Dr,this.tileID.canonical),pe.bucketLayerIDs.push(Ti.map(function(ca){return ca.id})))}}}var Bi=m.mapObject(Dr.glyphDependencies,function(ca){return Object.keys(ca).map(Number)});Object.keys(Bi).length?ge.send("getGlyphs",{uid:this.uid,stacks:Bi},function(ca,ci){Ue||(Ue=ca,qe=ci,to.call(nt))}):qe={};var Mo=Object.keys(Dr.iconDependencies);Mo.length?ge.send("getImages",{icons:Mo,source:this.source,tileID:this.tileID,type:"icons"},function(ca,ci){Ue||(Ue=ca,Cr=ci,to.call(nt))}):Cr={};var ra=Object.keys(Dr.patternDependencies);function to(){if(Ue)return ke(Ue);if(qe&&Cr&&Tr){var ca=new xe(qe),ci=new m.ImageAtlas(Cr,Tr);for(var bi in tr){var vo=tr[bi];vo instanceof m.SymbolBucket?(Ee(vo.layers,this.zoom,le),m.performSymbolLayout(vo,qe,ca.positions,Cr,ci.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):vo.hasPattern&&(vo instanceof m.LineBucket||vo instanceof m.FillBucket||vo instanceof m.FillExtrusionBucket)&&(Ee(vo.layers,this.zoom,le),vo.addFeatures(Dr,this.tileID.canonical,ci.patternPositions))}this.status="done",ke(null,{buckets:m.values(tr).filter(function(mo){return!mo.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ca.image,imageAtlas:ci,glyphMap:this.returnDependencies?qe:null,iconMap:this.returnDependencies?Cr:null,glyphPositions:this.returnDependencies?ca.positions:null})}}ra.length?ge.send("getImages",{icons:ra,source:this.source,tileID:this.tileID,type:"patterns"},function(ca,ci){Ue||(Ue=ca,Tr=ci,to.call(nt))}):Tr={},to.call(this)};var at=function($,le,ge,ke){this.actor=$,this.layerIndex=le,this.availableImages=ge,this.loadVectorData=ke||Mt,this.loading={},this.loaded={}};at.prototype.loadTile=function(J,$){var le=this,ge=J.uid;this.loading||(this.loading={});var ke=!!(J&&J.request&&J.request.collectResourceTiming)&&new m.RequestPerformance(J.request),nt=this.loading[ge]=new Me(J);nt.abort=this.loadVectorData(J,function(pt,pe){if(delete le.loading[ge],pt||!pe)return nt.status="done",le.loaded[ge]=nt,$(pt);var Ue=pe.rawData,qe={};pe.expires&&(qe.expires=pe.expires),pe.cacheControl&&(qe.cacheControl=pe.cacheControl);var Cr={};if(ke){var Tr=ke.finish();Tr&&(Cr.resourceTiming=JSON.parse(JSON.stringify(Tr)))}nt.vectorTile=pe.vectorTile,nt.parse(pe.vectorTile,le.layerIndex,le.availableImages,le.actor,function(tr,Dr){if(tr||!Dr)return $(tr);$(null,m.extend({rawTileData:Ue.slice(0)},Dr,qe,Cr))}),le.loaded=le.loaded||{},le.loaded[ge]=nt})},at.prototype.reloadTile=function(J,$){var le=this,ge=this.loaded,ke=J.uid,nt=this;if(ge&&ge[ke]){var pt=ge[ke];pt.showCollisionBoxes=J.showCollisionBoxes;var pe=function(qe,Cr){var Tr=pt.reloadCallback;Tr&&(delete pt.reloadCallback,pt.parse(pt.vectorTile,nt.layerIndex,le.availableImages,nt.actor,Tr)),$(qe,Cr)};pt.status==="parsing"?pt.reloadCallback=pe:pt.status==="done"&&(pt.vectorTile?pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},at.prototype.abortTile=function(J,$){var le=this.loading,ge=J.uid;le&&le[ge]&&le[ge].abort&&(le[ge].abort(),delete le[ge]),$()},at.prototype.removeTile=function(J,$){var le=this.loaded,ge=J.uid;le&&le[ge]&&delete le[ge],$()};var ht=m.window.ImageBitmap,vt=function(){this.loaded={}};function _t(J,$){if(J.length!==0){Ve(J[0],$);for(var le=1;le<J.length;le++)Ve(J[le],!$)}}function Ve(J,$){for(var le=0,ge=0,ke=J.length,nt=ke-1;ge<ke;nt=ge++)le+=(J[ge][0]-J[nt][0])*(J[nt][1]+J[ge][1]);le>=0!=!!$&&J.reverse()}vt.prototype.loadTile=function(J,$){var le=J.uid,ge=J.encoding,ke=J.rawImageData,nt=ht&&ke instanceof ht?this.getImageData(ke):ke,pt=new m.DEMData(le,nt,ge);this.loaded=this.loaded||{},this.loaded[le]=pt,$(null,pt)},vt.prototype.getImageData=function(J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,J.width+2,J.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},vt.prototype.removeTile=function(J){var $=this.loaded,le=J.uid;$&&$[le]&&delete $[le]};var xt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,st=function($){this._feature=$,this.extent=m.EXTENT,this.type=$.type,this.properties=$.tags,"id"in $&&!isNaN($.id)&&(this.id=parseInt($.id,10))};st.prototype.loadGeometry=function(){if(this._feature.type===1){for(var J=[],$=0,le=this._feature.geometry;$<le.length;$+=1){var ge=le[$];J.push([new m.Point$1(ge[0],ge[1])])}return J}for(var ke=[],nt=0,pt=this._feature.geometry;nt<pt.length;nt+=1){for(var pe=[],Ue=0,qe=pt[nt];Ue<qe.length;Ue+=1){var Cr=qe[Ue];pe.push(new m.Point$1(Cr[0],Cr[1]))}ke.push(pe)}return ke},st.prototype.toGeoJSON=function(J,$,le){return xt.call(this,J,$,le)};var it=function($){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=$.length,this._features=$};it.prototype.feature=function(J){return new st(this._features[J])};var N=m.vectorTile.VectorTileFeature,Re=Nr;function Nr(J,$){this.options=$||{},this.features=J,this.length=J.length}function Pr(J,$){this.id=typeof J.id=="number"?J.id:void 0,this.type=J.type,this.rawGeometry=J.type===1?[J.geometry]:J.geometry,this.properties=J.tags,this.extent=$||4096}Nr.prototype.feature=function(J){return new Pr(this.features[J],this.options.extent)},Pr.prototype.loadGeometry=function(){var J=this.rawGeometry;this.geometry=[];for(var $=0;$<J.length;$++){for(var le=J[$],ge=[],ke=0;ke<le.length;ke++)ge.push(new m.Point$1(le[ke][0],le[ke][1]));this.geometry.push(ge)}return this.geometry},Pr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var J=this.geometry,$=1/0,le=-1/0,ge=1/0,ke=-1/0,nt=0;nt<J.length;nt++)for(var pt=J[nt],pe=0;pe<pt.length;pe++){var Ue=pt[pe];$=Math.min($,Ue.x),le=Math.max(le,Ue.x),ge=Math.min(ge,Ue.y),ke=Math.max(ke,Ue.y)}return[$,ge,le,ke]},Pr.prototype.toGeoJSON=N.prototype.toGeoJSON;var Wt=Bt,Oe=Re;function Bt(J){var $=new m.pbf;return function(le,ge){for(var ke in le.layers)ge.writeMessage(3,Zt,le.layers[ke])}(J,$),$.finish()}function Zt(J,$){var le;$.writeVarintField(15,J.version||1),$.writeStringField(1,J.name||""),$.writeVarintField(5,J.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<J.length;le++)ge.feature=J.feature(le),$.writeMessage(2,ir,ge);var ke=ge.keys;for(le=0;le<ke.length;le++)$.writeStringField(3,ke[le]);var nt=ge.values;for(le=0;le<nt.length;le++)$.writeMessage(4,Pe,nt[le])}function ir(J,$){var le=J.feature;le.id!==void 0&&$.writeVarintField(1,le.id),$.writeMessage(2,Fr,J),$.writeVarintField(3,le.type),$.writeMessage(4,fe,le)}function Fr(J,$){var le=J.feature,ge=J.keys,ke=J.values,nt=J.keycache,pt=J.valuecache;for(var pe in le.properties){var Ue=nt[pe];Ue===void 0&&(ge.push(pe),nt[pe]=Ue=ge.length-1),$.writeVarint(Ue);var qe=le.properties[pe],Cr=typeof qe;Cr!=="string"&&Cr!=="boolean"&&Cr!=="number"&&(qe=JSON.stringify(qe));var Tr=Cr+":"+qe,tr=pt[Tr];tr===void 0&&(ke.push(qe),pt[Tr]=tr=ke.length-1),$.writeVarint(tr)}}function qr(J,$){return($<<3)+(7&J)}function br(J){return J<<1^J>>31}function fe(J,$){for(var le=J.loadGeometry(),ge=J.type,ke=0,nt=0,pt=le.length,pe=0;pe<pt;pe++){var Ue=le[pe],qe=1;ge===1&&(qe=Ue.length),$.writeVarint(qr(1,qe));for(var Cr=ge===3?Ue.length-1:Ue.length,Tr=0;Tr<Cr;Tr++){Tr===1&&ge!==1&&$.writeVarint(qr(2,Cr-1));var tr=Ue[Tr].x-ke,Dr=Ue[Tr].y-nt;$.writeVarint(br(tr)),$.writeVarint(br(Dr)),ke+=tr,nt+=Dr}ge===3&&$.writeVarint(qr(7,1))}}function Pe(J,$){var le=typeof J;le==="string"?$.writeStringField(1,J):le==="boolean"?$.writeBooleanField(7,J):le==="number"&&(J%1!=0?$.writeDoubleField(3,J):J<0?$.writeSVarintField(6,J):$.writeVarintField(5,J))}function Se(J,$,le,ge){lt(J,le,ge),lt($,2*le,2*ge),lt($,2*le+1,2*ge+1)}function lt(J,$,le){var ge=J[$];J[$]=J[le],J[le]=ge}function ut(J,$,le,ge){var ke=J-le,nt=$-ge;return ke*ke+nt*nt}Wt.fromVectorTileJs=Bt,Wt.fromGeojsonVt=function(J,$){$=$||{};var le={};for(var ge in J)le[ge]=new Re(J[ge].features,$),le[ge].name=ge,le[ge].version=$.version,le[ge].extent=$.extent;return Bt({layers:le})},Wt.GeoJSONWrapper=Oe;var Ot=function($){return $[0]},wt=function($){return $[1]},sr=function($,le,ge,ke,nt){le===void 0&&(le=Ot),ge===void 0&&(ge=wt),ke===void 0&&(ke=64),nt===void 0&&(nt=Float64Array),this.nodeSize=ke,this.points=$;for(var pt=$.length<65536?Uint16Array:Uint32Array,pe=this.ids=new pt($.length),Ue=this.coords=new nt(2*$.length),qe=0;qe<$.length;qe++)pe[qe]=qe,Ue[2*qe]=le($[qe]),Ue[2*qe+1]=ge($[qe]);(function Cr(Tr,tr,Dr,nn,Mn,rr){if(!(Mn-nn<=Dr)){var wn=nn+Mn>>1;(function mn(xn,w,An,Lr,Zi,Ti){for(;Zi>Lr;){if(Zi-Lr>600){var Un=Zi-Lr+1,Bi=An-Lr+1,Mo=Math.log(Un),ra=.5*Math.exp(2*Mo/3),to=.5*Math.sqrt(Mo*ra*(Un-ra)/Un)*(Bi-Un/2<0?-1:1);mn(xn,w,An,Math.max(Lr,Math.floor(An-Bi*ra/Un+to)),Math.min(Zi,Math.floor(An+(Un-Bi)*ra/Un+to)),Ti)}var ca=w[2*An+Ti],ci=Lr,bi=Zi;for(Se(xn,w,Lr,An),w[2*Zi+Ti]>ca&&Se(xn,w,Lr,Zi);ci<bi;){for(Se(xn,w,ci,bi),ci++,bi--;w[2*ci+Ti]<ca;)ci++;for(;w[2*bi+Ti]>ca;)bi--}w[2*Lr+Ti]===ca?Se(xn,w,Lr,bi):Se(xn,w,++bi,Zi),bi<=An&&(Lr=bi+1),An<=bi&&(Zi=bi-1)}})(Tr,tr,wn,nn,Mn,rr%2),Cr(Tr,tr,Dr,nn,wn-1,rr+1),Cr(Tr,tr,Dr,wn+1,Mn,rr+1)}})(pe,Ue,ke,0,pe.length-1,0)};sr.prototype.range=function(J,$,le,ge){return function(ke,nt,pt,pe,Ue,qe,Cr){for(var Tr,tr,Dr=[0,ke.length-1,0],nn=[];Dr.length;){var Mn=Dr.pop(),rr=Dr.pop(),wn=Dr.pop();if(rr-wn<=Cr)for(var mn=wn;mn<=rr;mn++)tr=nt[2*mn+1],(Tr=nt[2*mn])>=pt&&Tr<=Ue&&tr>=pe&&tr<=qe&&nn.push(ke[mn]);else{var xn=Math.floor((wn+rr)/2);tr=nt[2*xn+1],(Tr=nt[2*xn])>=pt&&Tr<=Ue&&tr>=pe&&tr<=qe&&nn.push(ke[xn]);var w=(Mn+1)%2;(Mn===0?pt<=Tr:pe<=tr)&&(Dr.push(wn),Dr.push(xn-1),Dr.push(w)),(Mn===0?Ue>=Tr:qe>=tr)&&(Dr.push(xn+1),Dr.push(rr),Dr.push(w))}}return nn}(this.ids,this.coords,J,$,le,ge,this.nodeSize)},sr.prototype.within=function(J,$,le){return function(ge,ke,nt,pt,pe,Ue){for(var qe=[0,ge.length-1,0],Cr=[],Tr=pe*pe;qe.length;){var tr=qe.pop(),Dr=qe.pop(),nn=qe.pop();if(Dr-nn<=Ue)for(var Mn=nn;Mn<=Dr;Mn++)ut(ke[2*Mn],ke[2*Mn+1],nt,pt)<=Tr&&Cr.push(ge[Mn]);else{var rr=Math.floor((nn+Dr)/2),wn=ke[2*rr],mn=ke[2*rr+1];ut(wn,mn,nt,pt)<=Tr&&Cr.push(ge[rr]);var xn=(tr+1)%2;(tr===0?nt-pe<=wn:pt-pe<=mn)&&(qe.push(nn),qe.push(rr-1),qe.push(xn)),(tr===0?nt+pe>=wn:pt+pe>=mn)&&(qe.push(rr+1),qe.push(Dr),qe.push(xn))}}return Cr}(this.ids,this.coords,J,$,le,this.nodeSize)};var Or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function($){return $}},Nt=function($){this.options=Ur(Object.create(Or),$),this.trees=new Array(this.options.maxZoom+1)};function Tt(J,$,le,ge,ke){return{x:J,y:$,zoom:1/0,id:le,parentId:-1,numPoints:ge,properties:ke}}function It(J,$){var le=J.geometry.coordinates,ge=le[1];return{x:qt(le[0]),y:dr(ge),zoom:1/0,index:$,parentId:-1}}function $t(J){return{type:"Feature",id:J.id,properties:gr(J),geometry:{type:"Point",coordinates:[(ge=J.x,360*(ge-.5)),($=J.y,le=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(le))/Math.PI-90)]}};var $,le,ge}function gr(J){var $=J.numPoints,le=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return Ur(Ur({},J.properties),{cluster:!0,cluster_id:J.id,point_count:$,point_count_abbreviated:le})}function qt(J){return J/360+.5}function dr(J){var $=Math.sin(J*Math.PI/180),le=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return le<0?0:le>1?1:le}function Ur(J,$){for(var le in $)J[le]=$[le];return J}function Ir(J){return J.x}function ur(J){return J.y}function Rr(J,$,le,ge,ke,nt){var pt=ke-le,pe=nt-ge;if(pt!==0||pe!==0){var Ue=((J-le)*pt+($-ge)*pe)/(pt*pt+pe*pe);Ue>1?(le=ke,ge=nt):Ue>0&&(le+=pt*Ue,ge+=pe*Ue)}return(pt=J-le)*pt+(pe=$-ge)*pe}function Yn(J,$,le,ge){var ke={id:J===void 0?null:J,type:$,geometry:le,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var pt=nt.geometry,pe=nt.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")un(nt,pt);else if(pe==="Polygon"||pe==="MultiLineString")for(var Ue=0;Ue<pt.length;Ue++)un(nt,pt[Ue]);else if(pe==="MultiPolygon")for(Ue=0;Ue<pt.length;Ue++)for(var qe=0;qe<pt[Ue].length;qe++)un(nt,pt[Ue][qe])}(ke),ke}function un(J,$){for(var le=0;le<$.length;le+=3)J.minX=Math.min(J.minX,$[le]),J.minY=Math.min(J.minY,$[le+1]),J.maxX=Math.max(J.maxX,$[le]),J.maxY=Math.max(J.maxY,$[le+1])}function _n(J,$,le,ge){if($.geometry){var ke=$.geometry.coordinates,nt=$.geometry.type,pt=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2),pe=[],Ue=$.id;if(le.promoteId?Ue=$.properties[le.promoteId]:le.generateId&&(Ue=ge||0),nt==="Point")qn(ke,pe);else if(nt==="MultiPoint")for(var qe=0;qe<ke.length;qe++)qn(ke[qe],pe);else if(nt==="LineString")oi(ke,pe,pt,!1);else if(nt==="MultiLineString"){if(le.lineMetrics){for(qe=0;qe<ke.length;qe++)oi(ke[qe],pe=[],pt,!1),J.push(Yn(Ue,"LineString",pe,$.properties));return}Gi(ke,pe,pt,!1)}else if(nt==="Polygon")Gi(ke,pe,pt,!0);else{if(nt!=="MultiPolygon"){if(nt==="GeometryCollection"){for(qe=0;qe<$.geometry.geometries.length;qe++)_n(J,{id:Ue,geometry:$.geometry.geometries[qe],properties:$.properties},le,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<ke.length;qe++){var Cr=[];Gi(ke[qe],Cr,pt,!0),pe.push(Cr)}}J.push(Yn(Ue,nt,pe,$.properties))}}function qn(J,$){$.push(he(J[0])),$.push(Fn(J[1])),$.push(0)}function oi(J,$,le,ge){for(var ke,nt,pt=0,pe=0;pe<J.length;pe++){var Ue=he(J[pe][0]),qe=Fn(J[pe][1]);$.push(Ue),$.push(qe),$.push(0),pe>0&&(pt+=ge?(ke*qe-Ue*nt)/2:Math.sqrt(Math.pow(Ue-ke,2)+Math.pow(qe-nt,2))),ke=Ue,nt=qe}var Cr=$.length-3;$[2]=1,function Tr(tr,Dr,nn,Mn){for(var rr,wn=Mn,mn=nn-Dr>>1,xn=nn-Dr,w=tr[Dr],An=tr[Dr+1],Lr=tr[nn],Zi=tr[nn+1],Ti=Dr+3;Ti<nn;Ti+=3){var Un=Rr(tr[Ti],tr[Ti+1],w,An,Lr,Zi);if(Un>wn)rr=Ti,wn=Un;else if(Un===wn){var Bi=Math.abs(Ti-mn);Bi<xn&&(rr=Ti,xn=Bi)}}wn>Mn&&(rr-Dr>3&&Tr(tr,Dr,rr,Mn),tr[rr+2]=wn,nn-rr>3&&Tr(tr,rr,nn,Mn))}($,0,Cr,le),$[Cr+2]=1,$.size=Math.abs(pt),$.start=0,$.end=$.size}function Gi(J,$,le,ge){for(var ke=0;ke<J.length;ke++){var nt=[];oi(J[ke],nt,le,ge),$.push(nt)}}function he(J){return J/360+.5}function Fn(J){var $=Math.sin(J*Math.PI/180),le=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return le<0?0:le>1?1:le}function Li(J,$,le,ge,ke,nt,pt,pe){if(ge/=$,nt>=(le/=$)&&pt<ge)return J;if(pt<le||nt>=ge)return null;for(var Ue=[],qe=0;qe<J.length;qe++){var Cr=J[qe],Tr=Cr.geometry,tr=Cr.type,Dr=ke===0?Cr.minX:Cr.minY,nn=ke===0?Cr.maxX:Cr.maxY;if(Dr>=le&&nn<ge)Ue.push(Cr);else if(!(nn<le||Dr>=ge)){var Mn=[];if(tr==="Point"||tr==="MultiPoint")Ko(Tr,Mn,le,ge,ke);else if(tr==="LineString")us(Tr,Mn,le,ge,ke,!1,pe.lineMetrics);else if(tr==="MultiLineString")Er(Tr,Mn,le,ge,ke,!1);else if(tr==="Polygon")Er(Tr,Mn,le,ge,ke,!0);else if(tr==="MultiPolygon")for(var rr=0;rr<Tr.length;rr++){var wn=[];Er(Tr[rr],wn,le,ge,ke,!0),wn.length&&Mn.push(wn)}if(Mn.length){if(pe.lineMetrics&&tr==="LineString"){for(rr=0;rr<Mn.length;rr++)Ue.push(Yn(Cr.id,tr,Mn[rr],Cr.tags));continue}tr!=="LineString"&&tr!=="MultiLineString"||(Mn.length===1?(tr="LineString",Mn=Mn[0]):tr="MultiLineString"),tr!=="Point"&&tr!=="MultiPoint"||(tr=Mn.length===3?"Point":"MultiPoint"),Ue.push(Yn(Cr.id,tr,Mn,Cr.tags))}}}return Ue.length?Ue:null}function Ko(J,$,le,ge,ke){for(var nt=0;nt<J.length;nt+=3){var pt=J[nt+ke];pt>=le&&pt<=ge&&($.push(J[nt]),$.push(J[nt+1]),$.push(J[nt+2]))}}function us(J,$,le,ge,ke,nt,pt){for(var pe,Ue,qe=Ut(J),Cr=ke===0?dn:Kr,Tr=J.start,tr=0;tr<J.length-3;tr+=3){var Dr=J[tr],nn=J[tr+1],Mn=J[tr+2],rr=J[tr+3],wn=J[tr+4],mn=ke===0?Dr:nn,xn=ke===0?rr:wn,w=!1;pt&&(pe=Math.sqrt(Math.pow(Dr-rr,2)+Math.pow(nn-wn,2))),mn<le?xn>le&&(Ue=Cr(qe,Dr,nn,rr,wn,le),pt&&(qe.start=Tr+pe*Ue)):mn>ge?xn<ge&&(Ue=Cr(qe,Dr,nn,rr,wn,ge),pt&&(qe.start=Tr+pe*Ue)):Hr(qe,Dr,nn,Mn),xn<le&&mn>=le&&(Ue=Cr(qe,Dr,nn,rr,wn,le),w=!0),xn>ge&&mn<=ge&&(Ue=Cr(qe,Dr,nn,rr,wn,ge),w=!0),!nt&&w&&(pt&&(qe.end=Tr+pe*Ue),$.push(qe),qe=Ut(J)),pt&&(Tr+=pe)}var An=J.length-3;Dr=J[An],nn=J[An+1],Mn=J[An+2],(mn=ke===0?Dr:nn)>=le&&mn<=ge&&Hr(qe,Dr,nn,Mn),An=qe.length-3,nt&&An>=3&&(qe[An]!==qe[0]||qe[An+1]!==qe[1])&&Hr(qe,qe[0],qe[1],qe[2]),qe.length&&$.push(qe)}function Ut(J){var $=[];return $.size=J.size,$.start=J.start,$.end=J.end,$}function Er(J,$,le,ge,ke,nt){for(var pt=0;pt<J.length;pt++)us(J[pt],$,le,ge,ke,nt,!1)}function Hr(J,$,le,ge){J.push($),J.push(le),J.push(ge)}function dn(J,$,le,ge,ke,nt){var pt=(nt-$)/(ge-$);return J.push(nt),J.push(le+(ke-le)*pt),J.push(1),pt}function Kr(J,$,le,ge,ke,nt){var pt=(nt-le)/(ke-le);return J.push($+(ge-$)*pt),J.push(nt),J.push(1),pt}function Ia(J,$){for(var le=[],ge=0;ge<J.length;ge++){var ke,nt=J[ge],pt=nt.type;if(pt==="Point"||pt==="MultiPoint"||pt==="LineString")ke=li(nt.geometry,$);else if(pt==="MultiLineString"||pt==="Polygon"){ke=[];for(var pe=0;pe<nt.geometry.length;pe++)ke.push(li(nt.geometry[pe],$))}else if(pt==="MultiPolygon")for(ke=[],pe=0;pe<nt.geometry.length;pe++){for(var Ue=[],qe=0;qe<nt.geometry[pe].length;qe++)Ue.push(li(nt.geometry[pe][qe],$));ke.push(Ue)}le.push(Yn(nt.id,pt,ke,nt.tags))}return le}function li(J,$){var le=[];le.size=J.size,J.start!==void 0&&(le.start=J.start,le.end=J.end);for(var ge=0;ge<J.length;ge+=3)le.push(J[ge]+$,J[ge+1],J[ge+2]);return le}function Hn(J,$){if(J.transformed)return J;var le,ge,ke,nt=1<<J.z,pt=J.x,pe=J.y;for(le=0;le<J.features.length;le++){var Ue=J.features[le],qe=Ue.geometry,Cr=Ue.type;if(Ue.geometry=[],Cr===1)for(ge=0;ge<qe.length;ge+=2)Ue.geometry.push(ii(qe[ge],qe[ge+1],$,nt,pt,pe));else for(ge=0;ge<qe.length;ge++){var Tr=[];for(ke=0;ke<qe[ge].length;ke+=2)Tr.push(ii(qe[ge][ke],qe[ge][ke+1],$,nt,pt,pe));Ue.geometry.push(Tr)}}return J.transformed=!0,J}function ii(J,$,le,ge,ke,nt){return[Math.round(le*(J*ge-ke)),Math.round(le*($*ge-nt))]}function Hi(J,$,le,ge,ke){for(var nt=$===ke.maxZoom?0:ke.tolerance/((1<<$)*ke.extent),pt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:le,y:ge,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<J.length;pe++){pt.numFeatures++,Wi(pt,J[pe],nt,ke);var Ue=J[pe].minX,qe=J[pe].minY,Cr=J[pe].maxX,Tr=J[pe].maxY;Ue<pt.minX&&(pt.minX=Ue),qe<pt.minY&&(pt.minY=qe),Cr>pt.maxX&&(pt.maxX=Cr),Tr>pt.maxY&&(pt.maxY=Tr)}return pt}function Wi(J,$,le,ge){var ke=$.geometry,nt=$.type,pt=[];if(nt==="Point"||nt==="MultiPoint")for(var pe=0;pe<ke.length;pe+=3)pt.push(ke[pe]),pt.push(ke[pe+1]),J.numPoints++,J.numSimplified++;else if(nt==="LineString")To(pt,ke,J,le,!1,!1);else if(nt==="MultiLineString"||nt==="Polygon")for(pe=0;pe<ke.length;pe++)To(pt,ke[pe],J,le,nt==="Polygon",pe===0);else if(nt==="MultiPolygon")for(var Ue=0;Ue<ke.length;Ue++){var qe=ke[Ue];for(pe=0;pe<qe.length;pe++)To(pt,qe[pe],J,le,!0,pe===0)}if(pt.length){var Cr=$.tags||null;if(nt==="LineString"&&ge.lineMetrics){for(var Tr in Cr={},$.tags)Cr[Tr]=$.tags[Tr];Cr.mapbox_clip_start=ke.start/ke.size,Cr.mapbox_clip_end=ke.end/ke.size}var tr={geometry:pt,type:nt==="Polygon"||nt==="MultiPolygon"?3:nt==="LineString"||nt==="MultiLineString"?2:1,tags:Cr};$.id!==null&&(tr.id=$.id),J.features.push(tr)}}function To(J,$,le,ge,ke,nt){var pt=ge*ge;if(ge>0&&$.size<(ke?pt:ge))le.numPoints+=$.length/3;else{for(var pe=[],Ue=0;Ue<$.length;Ue+=3)(ge===0||$[Ue+2]>pt)&&(le.numSimplified++,pe.push($[Ue]),pe.push($[Ue+1])),le.numPoints++;ke&&function(qe,Cr){for(var Tr=0,tr=0,Dr=qe.length,nn=Dr-2;tr<Dr;nn=tr,tr+=2)Tr+=(qe[tr]-qe[nn])*(qe[tr+1]+qe[nn+1]);if(Tr>0===Cr)for(tr=0,Dr=qe.length;tr<Dr/2;tr+=2){var Mn=qe[tr],rr=qe[tr+1];qe[tr]=qe[Dr-2-tr],qe[tr+1]=qe[Dr-1-tr],qe[Dr-2-tr]=Mn,qe[Dr-1-tr]=rr}}(pe,nt),J.push(pe)}}function Wa(J,$){var le=($=this.options=function(ke,nt){for(var pt in nt)ke[pt]=nt[pt];return ke}(Object.create(this.options),$)).debug;if(le&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(ke,nt){var pt=[];if(ke.type==="FeatureCollection")for(var pe=0;pe<ke.features.length;pe++)_n(pt,ke.features[pe],nt,pe);else _n(pt,ke.type==="Feature"?ke:{geometry:ke},nt);return pt}(J,$);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(ke,nt){var pt=nt.buffer/nt.extent,pe=ke,Ue=Li(ke,1,-1-pt,pt,0,-1,2,nt),qe=Li(ke,1,1-pt,2+pt,0,-1,2,nt);return(Ue||qe)&&(pe=Li(ke,1,-pt,1+pt,0,-1,2,nt)||[],Ue&&(pe=Ia(Ue,1).concat(pe)),qe&&(pe=pe.concat(Ia(qe,-1)))),pe}(ge,$)).length&&this.splitTile(ge,0,0,0),le&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ma(J,$,le){return 32*((1<<J)*le+$)+J}function As(J,$){var le=J.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var ge=this._geoJSONIndex.getTile(le.z,le.x,le.y);if(!ge)return $(null,null);var ke=new it(ge.features),nt=Wt(ke);nt.byteOffset===0&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),$(null,{vectorTile:ke,rawData:nt.buffer})}Nt.prototype.load=function(J){var $=this.options,le=$.log,ge=$.minZoom,ke=$.maxZoom,nt=$.nodeSize;le&&console.time("total time");var pt="prepare "+J.length+" points";le&&console.time(pt),this.points=J;for(var pe=[],Ue=0;Ue<J.length;Ue++)J[Ue].geometry&&pe.push(It(J[Ue],Ue));this.trees[ke+1]=new sr(pe,Ir,ur,nt,Float32Array),le&&console.timeEnd(pt);for(var qe=ke;qe>=ge;qe--){var Cr=+Date.now();pe=this._cluster(pe,qe),this.trees[qe]=new sr(pe,Ir,ur,nt,Float32Array),le&&console.log("z%d: %d clusters in %dms",qe,pe.length,+Date.now()-Cr)}return le&&console.timeEnd("total time"),this},Nt.prototype.getClusters=function(J,$){var le=((J[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,J[1])),ke=J[2]===180?180:((J[2]+180)%360+360)%360-180,nt=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)le=-180,ke=180;else if(le>ke){var pt=this.getClusters([le,ge,180,nt],$),pe=this.getClusters([-180,ge,ke,nt],$);return pt.concat(pe)}for(var Ue=this.trees[this._limitZoom($)],qe=[],Cr=0,Tr=Ue.range(qt(le),dr(nt),qt(ke),dr(ge));Cr<Tr.length;Cr+=1){var tr=Ue.points[Tr[Cr]];qe.push(tr.numPoints?$t(tr):this.points[tr.index])}return qe},Nt.prototype.getChildren=function(J){var $=this._getOriginId(J),le=this._getOriginZoom(J),ge="No cluster with the specified id.",ke=this.trees[le];if(!ke)throw new Error(ge);var nt=ke.points[$];if(!nt)throw new Error(ge);for(var pt=this.options.radius/(this.options.extent*Math.pow(2,le-1)),pe=[],Ue=0,qe=ke.within(nt.x,nt.y,pt);Ue<qe.length;Ue+=1){var Cr=ke.points[qe[Ue]];Cr.parentId===J&&pe.push(Cr.numPoints?$t(Cr):this.points[Cr.index])}if(pe.length===0)throw new Error(ge);return pe},Nt.prototype.getLeaves=function(J,$,le){var ge=[];return this._appendLeaves(ge,J,$=$||10,le=le||0,0),ge},Nt.prototype.getTile=function(J,$,le){var ge=this.trees[this._limitZoom(J)],ke=Math.pow(2,J),nt=this.options,pt=nt.radius/nt.extent,pe=(le-pt)/ke,Ue=(le+1+pt)/ke,qe={features:[]};return this._addTileFeatures(ge.range(($-pt)/ke,pe,($+1+pt)/ke,Ue),ge.points,$,le,ke,qe),$===0&&this._addTileFeatures(ge.range(1-pt/ke,pe,1,Ue),ge.points,ke,le,ke,qe),$===ke-1&&this._addTileFeatures(ge.range(0,pe,pt/ke,Ue),ge.points,-1,le,ke,qe),qe.features.length?qe:null},Nt.prototype.getClusterExpansionZoom=function(J){for(var $=this._getOriginZoom(J)-1;$<=this.options.maxZoom;){var le=this.getChildren(J);if($++,le.length!==1)break;J=le[0].properties.cluster_id}return $},Nt.prototype._appendLeaves=function(J,$,le,ge,ke){for(var nt=0,pt=this.getChildren($);nt<pt.length;nt+=1){var pe=pt[nt],Ue=pe.properties;if(Ue&&Ue.cluster?ke+Ue.point_count<=ge?ke+=Ue.point_count:ke=this._appendLeaves(J,Ue.cluster_id,le,ge,ke):ke<ge?ke++:J.push(pe),J.length===le)break}return ke},Nt.prototype._addTileFeatures=function(J,$,le,ge,ke,nt){for(var pt=0,pe=J;pt<pe.length;pt+=1){var Ue=$[pe[pt]],qe=Ue.numPoints,Cr={type:1,geometry:[[Math.round(this.options.extent*(Ue.x*ke-le)),Math.round(this.options.extent*(Ue.y*ke-ge))]],tags:qe?gr(Ue):this.points[Ue.index].properties},Tr=void 0;qe?Tr=Ue.id:this.options.generateId?Tr=Ue.index:this.points[Ue.index].id&&(Tr=this.points[Ue.index].id),Tr!==void 0&&(Cr.id=Tr),nt.features.push(Cr)}},Nt.prototype._limitZoom=function(J){return Math.max(this.options.minZoom,Math.min(+J,this.options.maxZoom+1))},Nt.prototype._cluster=function(J,$){for(var le=[],ge=this.options,ke=ge.reduce,nt=ge.minPoints,pt=ge.radius/(ge.extent*Math.pow(2,$)),pe=0;pe<J.length;pe++){var Ue=J[pe];if(!(Ue.zoom<=$)){Ue.zoom=$;for(var qe=this.trees[$+1],Cr=qe.within(Ue.x,Ue.y,pt),Tr=Ue.numPoints||1,tr=Tr,Dr=0,nn=Cr;Dr<nn.length;Dr+=1){var Mn=qe.points[nn[Dr]];Mn.zoom>$&&(tr+=Mn.numPoints||1)}if(tr>=nt){for(var rr=Ue.x*Tr,wn=Ue.y*Tr,mn=ke&&Tr>1?this._map(Ue,!0):null,xn=(pe<<5)+($+1)+this.points.length,w=0,An=Cr;w<An.length;w+=1){var Lr=qe.points[An[w]];if(!(Lr.zoom<=$)){Lr.zoom=$;var Zi=Lr.numPoints||1;rr+=Lr.x*Zi,wn+=Lr.y*Zi,Lr.parentId=xn,ke&&(mn||(mn=this._map(Ue,!0)),ke(mn,this._map(Lr)))}}Ue.parentId=xn,le.push(Tt(rr/tr,wn/tr,xn,tr,mn))}else if(le.push(Ue),tr>1)for(var Ti=0,Un=Cr;Ti<Un.length;Ti+=1){var Bi=qe.points[Un[Ti]];Bi.zoom<=$||(Bi.zoom=$,le.push(Bi))}}}return le},Nt.prototype._getOriginId=function(J){return J-this.points.length>>5},Nt.prototype._getOriginZoom=function(J){return(J-this.points.length)%32},Nt.prototype._map=function(J,$){if(J.numPoints)return $?Ur({},J.properties):J.properties;var le=this.points[J.index].properties,ge=this.options.map(le);return $&&ge===le?Ur({},ge):ge},Wa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wa.prototype.splitTile=function(J,$,le,ge,ke,nt,pt){for(var pe=[J,$,le,ge],Ue=this.options,qe=Ue.debug;pe.length;){ge=pe.pop(),le=pe.pop(),$=pe.pop(),J=pe.pop();var Cr=1<<$,Tr=ma($,le,ge),tr=this.tiles[Tr];if(!tr&&(qe>1&&console.time("creation"),tr=this.tiles[Tr]=Hi(J,$,le,ge,Ue),this.tileCoords.push({z:$,x:le,y:ge}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,le,ge,tr.numFeatures,tr.numPoints,tr.numSimplified),console.timeEnd("creation"));var Dr="z"+$;this.stats[Dr]=(this.stats[Dr]||0)+1,this.total++}if(tr.source=J,ke){if($===Ue.maxZoom||$===ke)continue;var nn=1<<ke-$;if(le!==Math.floor(nt/nn)||ge!==Math.floor(pt/nn))continue}else if($===Ue.indexMaxZoom||tr.numPoints<=Ue.indexMaxPoints)continue;if(tr.source=null,J.length!==0){qe>1&&console.time("clipping");var Mn,rr,wn,mn,xn,w,An=.5*Ue.buffer/Ue.extent,Lr=.5-An,Zi=.5+An,Ti=1+An;Mn=rr=wn=mn=null,xn=Li(J,Cr,le-An,le+Zi,0,tr.minX,tr.maxX,Ue),w=Li(J,Cr,le+Lr,le+Ti,0,tr.minX,tr.maxX,Ue),J=null,xn&&(Mn=Li(xn,Cr,ge-An,ge+Zi,1,tr.minY,tr.maxY,Ue),rr=Li(xn,Cr,ge+Lr,ge+Ti,1,tr.minY,tr.maxY,Ue),xn=null),w&&(wn=Li(w,Cr,ge-An,ge+Zi,1,tr.minY,tr.maxY,Ue),mn=Li(w,Cr,ge+Lr,ge+Ti,1,tr.minY,tr.maxY,Ue),w=null),qe>1&&console.timeEnd("clipping"),pe.push(Mn||[],$+1,2*le,2*ge),pe.push(rr||[],$+1,2*le,2*ge+1),pe.push(wn||[],$+1,2*le+1,2*ge),pe.push(mn||[],$+1,2*le+1,2*ge+1)}}},Wa.prototype.getTile=function(J,$,le){var ge=this.options,ke=ge.extent,nt=ge.debug;if(J<0||J>24)return null;var pt=1<<J,pe=ma(J,$=($%pt+pt)%pt,le);if(this.tiles[pe])return Hn(this.tiles[pe],ke);nt>1&&console.log("drilling down to z%d-%d-%d",J,$,le);for(var Ue,qe=J,Cr=$,Tr=le;!Ue&&qe>0;)qe--,Cr=Math.floor(Cr/2),Tr=Math.floor(Tr/2),Ue=this.tiles[ma(qe,Cr,Tr)];return Ue&&Ue.source?(nt>1&&console.log("found parent tile z%d-%d-%d",qe,Cr,Tr),nt>1&&console.time("drilling down"),this.splitTile(Ue.source,qe,Cr,Tr,J,$,le),nt>1&&console.timeEnd("drilling down"),this.tiles[pe]?Hn(this.tiles[pe],ke):null):null};var js=function(J){function $(le,ge,ke,nt){J.call(this,le,ge,ke,As),nt&&(this.loadGeoJSON=nt)}return J&&($.__proto__=J),($.prototype=Object.create(J&&J.prototype)).constructor=$,$.prototype.loadData=function(le,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=le,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var le=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,ke=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var nt=!!(ke&&ke.request&&ke.request.collectResourceTiming)&&new m.RequestPerformance(ke.request);this.loadGeoJSON(ke,function(pt,pe){if(pt||!pe)return ge(pt);if(typeof pe!="object")return ge(new Error("Input data given to '"+ke.source+"' is not a valid GeoJSON object."));(function tr(Dr,nn){var Mn,rr=Dr&&Dr.type;if(rr==="FeatureCollection")for(Mn=0;Mn<Dr.features.length;Mn++)tr(Dr.features[Mn],nn);else if(rr==="GeometryCollection")for(Mn=0;Mn<Dr.geometries.length;Mn++)tr(Dr.geometries[Mn],nn);else if(rr==="Feature")tr(Dr.geometry,nn);else if(rr==="Polygon")_t(Dr.coordinates,nn);else if(rr==="MultiPolygon")for(Mn=0;Mn<Dr.coordinates.length;Mn++)_t(Dr.coordinates[Mn],nn);return Dr})(pe,!0);try{if(ke.filter){var Ue=m.createExpression(ke.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map(function(tr){return tr.key+": "+tr.message}).join(", "));var qe=pe.features.filter(function(tr){return Ue.value.evaluate({zoom:0},tr)});pe={type:"FeatureCollection",features:qe}}le._geoJSONIndex=ke.cluster?new Nt(function(tr){var Dr=tr.superclusterOptions,nn=tr.clusterProperties;if(!nn||!Dr)return Dr;for(var Mn={},rr={},wn={accumulated:null,zoom:0},mn={properties:null},xn=Object.keys(nn),w=0,An=xn;w<An.length;w+=1){var Lr=An[w],Zi=nn[Lr],Ti=Zi[0],Un=m.createExpression(Zi[1]),Bi=m.createExpression(typeof Ti=="string"?[Ti,["accumulated"],["get",Lr]]:Ti);Mn[Lr]=Un.value,rr[Lr]=Bi.value}return Dr.map=function(Mo){mn.properties=Mo;for(var ra={},to=0,ca=xn;to<ca.length;to+=1){var ci=ca[to];ra[ci]=Mn[ci].evaluate(wn,mn)}return ra},Dr.reduce=function(Mo,ra){mn.properties=ra;for(var to=0,ca=xn;to<ca.length;to+=1){var ci=ca[to];wn.accumulated=Mo[ci],Mo[ci]=rr[ci].evaluate(wn,mn)}},Dr}(ke)).load(pe.features):function(tr,Dr){return new Wa(tr,Dr)}(pe,ke.geojsonVtOptions)}catch(tr){return ge(tr)}le.loaded={};var Cr={};if(nt){var Tr=nt.finish();Tr&&(Cr.resourceTiming={},Cr.resourceTiming[ke.source]=JSON.parse(JSON.stringify(Tr)))}ge(null,Cr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(le,ge){var ke=this.loaded;return ke&&ke[le.uid]?J.prototype.reloadTile.call(this,le,ge):this.loadTile(le,ge)},$.prototype.loadGeoJSON=function(le,ge){if(le.request)m.getJSON(le.request,ge);else{if(typeof le.data!="string")return ge(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(le.data))}catch(ke){return ge(new Error("Input data given to '"+le.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(le,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},$.prototype.getClusterExpansionZoom=function(le,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(ke){ge(ke)}},$.prototype.getClusterChildren=function(le,ge){try{ge(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(ke){ge(ke)}},$.prototype.getClusterLeaves=function(le,ge){try{ge(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(ke){ge(ke)}},$}(at),Ra=function($){var le=this;this.self=$,this.actor=new m.Actor($,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:at,geojson:js},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ge,ke){if(le.workerSourceTypes[ge])throw new Error('Worker source with name "'+ge+'" already registered.');le.workerSourceTypes[ge]=ke},this.self.registerRTLTextPlugin=function(ge){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=ge.applyArabicShaping,m.plugin.processBidirectionalText=ge.processBidirectionalText,m.plugin.processStyledBidirectionalText=ge.processStyledBidirectionalText}};return Ra.prototype.setReferrer=function(J,$){this.referrer=$},Ra.prototype.setImages=function(J,$,le){for(var ge in this.availableImages[J]=$,this.workerSources[J]){var ke=this.workerSources[J][ge];for(var nt in ke)ke[nt].availableImages=$}le()},Ra.prototype.setLayers=function(J,$,le){this.getLayerIndex(J).replace($),le()},Ra.prototype.updateLayers=function(J,$,le){this.getLayerIndex(J).update($.layers,$.removedIds),le()},Ra.prototype.loadTile=function(J,$,le){this.getWorkerSource(J,$.type,$.source).loadTile($,le)},Ra.prototype.loadDEMTile=function(J,$,le){this.getDEMWorkerSource(J,$.source).loadTile($,le)},Ra.prototype.reloadTile=function(J,$,le){this.getWorkerSource(J,$.type,$.source).reloadTile($,le)},Ra.prototype.abortTile=function(J,$,le){this.getWorkerSource(J,$.type,$.source).abortTile($,le)},Ra.prototype.removeTile=function(J,$,le){this.getWorkerSource(J,$.type,$.source).removeTile($,le)},Ra.prototype.removeDEMTile=function(J,$){this.getDEMWorkerSource(J,$.source).removeTile($)},Ra.prototype.removeSource=function(J,$,le){if(this.workerSources[J]&&this.workerSources[J][$.type]&&this.workerSources[J][$.type][$.source]){var ge=this.workerSources[J][$.type][$.source];delete this.workerSources[J][$.type][$.source],ge.removeSource!==void 0?ge.removeSource($,le):le()}},Ra.prototype.loadWorkerSource=function(J,$,le){try{this.self.importScripts($.url),le()}catch(ge){le(ge.toString())}},Ra.prototype.syncRTLPluginState=function(J,$,le){try{m.plugin.setState($);var ge=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var ke=m.plugin.isParsed();le(ke?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),ke)}}catch(nt){le(nt.toString())}},Ra.prototype.getAvailableImages=function(J){var $=this.availableImages[J];return $||($=[]),$},Ra.prototype.getLayerIndex=function(J){var $=this.layerIndexes[J];return $||($=this.layerIndexes[J]=new Te),$},Ra.prototype.getWorkerSource=function(J,$,le){var ge=this;return this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][$]||(this.workerSources[J][$]={}),this.workerSources[J][$][le]||(this.workerSources[J][$][le]=new this.workerSourceTypes[$]({send:function(nt,pt,pe){ge.actor.send(nt,pt,pe,J)}},this.getLayerIndex(J),this.getAvailableImages(J))),this.workerSources[J][$][le]},Ra.prototype.getDEMWorkerSource=function(J,$){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][$]||(this.demWorkerSources[J][$]=new vt),this.demWorkerSources[J][$]},Ra.prototype.enforceCacheSizeLimit=function(J,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ra(self)),Ra}),j(["./shared"],function(m){"use strict";var U=m.createCommonjsModule(function(h){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var I,k,V=new Blob([""],{type:"text/javascript"}),Y=URL.createObjectURL(V);try{k=new Worker(Y),I=!0}catch(ce){I=!1}return k&&k.terminate(),URL.revokeObjectURL(Y),I}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var I=document.createElement("canvas");I.width=I.height=1;var k=I.getContext("2d");if(!k)return!1;var V=k.getImageData(0,0,1,1);return V&&V.width===I.width}()?(d[A=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[A]=function(I){var k=function(Y){var ce=document.createElement("canvas"),ve=Object.create(f.webGLContextAttributes);return ve.failIfMajorPerformanceCaveat=Y,ce.probablySupportsContext?ce.probablySupportsContext("webgl",ve)||ce.probablySupportsContext("experimental-webgl",ve):ce.supportsContext?ce.supportsContext("webgl",ve)||ce.supportsContext("experimental-webgl",ve):ce.getContext("webgl",ve)||ce.getContext("experimental-webgl",ve)}(I);if(!k)return!1;var V=k.createShader(k.VERTEX_SHADER);return!(!V||k.isContextLost())&&(k.shaderSource(V,"void main() {}"),k.compileShader(V),k.getShaderParameter(V,k.COMPILE_STATUS)===!0)}(A)),d[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}h.exports?h.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),G={create:function(f,c,d){var E=m.window.document.createElement(f);return c!==void 0&&(E.className=c),d&&d.appendChild(E),E},createNS:function(f,c){return m.window.document.createElementNS(f,c)}},Te=m.window.document&&m.window.document.documentElement.style;function xe(h){if(!Te)return h[0];for(var f=0;f<h.length;f++)if(h[f]in Te)return h[f];return h[0]}var Me,Ee=xe(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);G.disableDrag=function(){Te&&Ee&&(Me=Te[Ee],Te[Ee]="none")},G.enableDrag=function(){Te&&Ee&&(Te[Ee]=Me)};var Mt=xe(["transform","WebkitTransform"]);G.setTransform=function(h,f){h.style[Mt]=f};var at=!1;try{var ht=Object.defineProperty({},"passive",{get:function(){at=!0}});m.window.addEventListener("test",ht,ht),m.window.removeEventListener("test",ht,ht)}catch(h){at=!1}G.addEventListener=function(h,f,c,d){d===void 0&&(d={}),h.addEventListener(f,c,"passive"in d&&at?d:d.capture)},G.removeEventListener=function(h,f,c,d){d===void 0&&(d={}),h.removeEventListener(f,c,"passive"in d&&at?d:d.capture)};var vt=function h(f){f.preventDefault(),f.stopPropagation(),m.window.removeEventListener("click",h,!0)};function _t(h){var f=h.userImage;return!!(f&&f.render&&f.render())&&(h.data.replace(new Uint8Array(f.data.buffer)),!0)}G.suppressClick=function(){m.window.addEventListener("click",vt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",vt,!0)},0)},G.mousePos=function(h,f){var c=h.getBoundingClientRect();return new m.Point(f.clientX-c.left-h.clientLeft,f.clientY-c.top-h.clientTop)},G.touchPos=function(h,f){for(var c=h.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-h.clientLeft,f[E].clientY-c.top-h.clientTop));return d},G.mouseButton=function(h){return m.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},G.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Ve=function(h){function f(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var A=E[d];this._notify(A.ids,A.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,A=0,I=c;A<I.length;A+=1){var k=I[A];if(k[0]<E||k[1]<k[0]||d<k[1])return!1;E=k[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var A=0,I=c;A<I.length;A+=1)this.images[I[A]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},A=0,I=c;A<I.length;A+=1){var k=I[A];this.images[k]||this.fire(new m.Event("styleimagemissing",{id:k}));var V=this.images[k];V?E[k]={data:V.data.clone(),pixelRatio:V.pixelRatio,sdf:V.sdf,version:V.version,stretchX:V.stretchX,stretchY:V.stretchY,content:V.content,hasRenderCallback:Boolean(V.userImage&&V.userImage.render)}:m.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var A={w:E.data.width+2,h:E.data.height+2,x:0,y:0},I=new m.ImagePosition(A,E);this.patterns[c]={bin:A,position:I}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),A=E.w,I=E.h,k=this.atlasImage;for(var V in k.resize({width:A||1,height:I||1}),this.patterns){var Y=this.patterns[V].bin,ce=Y.x+1,ve=Y.y+1,ye=this.images[V].data,ze=ye.width,Fe=ye.height;m.RGBAImage.copy(ye,k,{x:0,y:0},{x:ce,y:ve},{width:ze,height:Fe}),m.RGBAImage.copy(ye,k,{x:0,y:Fe-1},{x:ce,y:ve-1},{width:ze,height:1}),m.RGBAImage.copy(ye,k,{x:0,y:0},{x:ce,y:ve+Fe},{width:ze,height:1}),m.RGBAImage.copy(ye,k,{x:ze-1,y:0},{x:ce-1,y:ve},{width:1,height:Fe}),m.RGBAImage.copy(ye,k,{x:0,y:0},{x:ce+ze,y:ve},{width:1,height:Fe})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var A=E[d];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var I=this.images[A];_t(I)&&this.updateImage(A,I)}}},f}(m.Evented),xt=N,st=N,it=1e20;function N(h,f,c,d,E,A){this.fontSize=h||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=A||"normal",this.radius=c||8;var I=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=I,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.d=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Int16Array(I),this.middle=Math.round(I/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Re(h,f,c,d,E,A,I){for(var k=0;k<f;k++){for(var V=0;V<c;V++)d[V]=h[V*f+k];for(Nr(d,E,A,I,c),V=0;V<c;V++)h[V*f+k]=E[V]}for(V=0;V<c;V++){for(k=0;k<f;k++)d[k]=h[V*f+k];for(Nr(d,E,A,I,f),k=0;k<f;k++)h[V*f+k]=Math.sqrt(E[k])}}function Nr(h,f,c,d,E){c[0]=0,d[0]=-it,d[1]=+it;for(var A=1,I=0;A<E;A++){for(var k=(h[A]+A*A-(h[c[I]]+c[I]*c[I]))/(2*A-2*c[I]);k<=d[I];)I--,k=(h[A]+A*A-(h[c[I]]+c[I]*c[I]))/(2*A-2*c[I]);c[++I]=A,d[I]=k,d[I+1]=+it}for(A=0,I=0;A<E;A++){for(;d[I+1]<A;)I++;f[A]=(A-c[I])*(A-c[I])+h[c[I]]}}N.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?it:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?it:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Re(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Re(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},xt.default=st;var Pr=function(f,c){this.requestManager=f,this.localIdeographFontFamily=c,this.entries={}};Pr.prototype.setURL=function(h){this.url=h},Pr.prototype.getGlyphs=function(h,f){var c=this,d=[];for(var E in h)for(var A=0,I=h[E];A<I.length;A+=1)d.push({stack:E,id:I[A]});m.asyncAll(d,function(k,V){var Y=k.stack,ce=k.id,ve=c.entries[Y];ve||(ve=c.entries[Y]={glyphs:{},requests:{},ranges:{}});var ye=ve.glyphs[ce];if(ye===void 0){if(ye=c._tinySDF(ve,Y,ce))return ve.glyphs[ce]=ye,void V(null,{stack:Y,id:ce,glyph:ye});var ze=Math.floor(ce/256);if(256*ze>65535)V(new Error("glyphs > 65535 not supported"));else if(ve.ranges[ze])V(null,{stack:Y,id:ce,glyph:ye});else{var Fe=ve.requests[ze];Fe||(Fe=ve.requests[ze]=[],Pr.loadGlyphRange(Y,ze,c.url,c.requestManager,function($e,Ne){if(Ne){for(var Ze in Ne)c._doesCharSupportLocalGlyph(+Ze)||(ve.glyphs[+Ze]=Ne[+Ze]);ve.ranges[ze]=!0}for(var St=0,mt=Fe;St<mt.length;St+=1)(0,mt[St])($e,Ne);delete ve.requests[ze]})),Fe.push(function($e,Ne){$e?V($e):Ne&&V(null,{stack:Y,id:ce,glyph:Ne[ce]||null})})}}else V(null,{stack:Y,id:ce,glyph:ye})},function(k,V){if(k)f(k);else if(V){for(var Y={},ce=0,ve=V;ce<ve.length;ce+=1){var ye=ve[ce],ze=ye.stack,Fe=ye.id,$e=ye.glyph;(Y[ze]||(Y[ze]={}))[Fe]=$e&&{id:$e.id,bitmap:$e.bitmap.clone(),metrics:$e.metrics}}f(null,Y)}})},Pr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](h)||m.isChar["Hangul Syllables"](h)||m.isChar.Hiragana(h)||m.isChar.Katakana(h))},Pr.prototype._tinySDF=function(h,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=h.tinySDF;if(!E){var A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),E=h.tinySDF=new Pr.TinySDF(24,3,8,.25,d,A)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Pr.loadGlyphRange=function(h,f,c,d,E){var A=256*f,I=A+255,k=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",h).replace("{range}",A+"-"+I),m.ResourceType.Glyphs);m.getArrayBuffer(k,function(V,Y){if(V)E(V);else if(Y){for(var ce={},ve=0,ye=m.parseGlyphPBF(Y);ve<ye.length;ve+=1){var ze=ye[ve];ce[ze.id]=ze}E(null,ce)}})},Pr.TinySDF=xt;var Wt=function(){this.specification=m.styleSpec.light.position};Wt.prototype.possiblyEvaluate=function(h,f){return m.sphericalToCartesian(h.expression.evaluate(f))},Wt.prototype.interpolate=function(h,f,c){return{x:m.number(h.x,f.x,c),y:m.number(h.y,f.y,c),z:m.number(h.z,f.z,c)}};var Oe=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new Wt,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),Bt=function(h){function f(c){h.call(this),this._transitionable=new m.Transitionable(Oe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var A=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),A):this._transitionable.setValue(E,A)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Zt=function(f,c){this.width=f,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Zt.prototype.getDash=function(h,f){var c=h.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(h,f)),this.dashEntry[c]},Zt.prototype.getDashRanges=function(h,f,c){var d=[],E=h.length%2==1?-h[h.length-1]*c:0,A=h[0]*c,I=!0;d.push({left:E,right:A,isDash:I,zeroLength:h[0]===0});for(var k=h[0],V=1;V<h.length;V++){var Y=h[V];d.push({left:E=k*c,right:A=(k+=Y)*c,isDash:I=!I,zeroLength:Y===0})}return d},Zt.prototype.addRoundDash=function(h,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var A=this.width*(this.nextRow+c+E),I=0,k=h[I],V=0;V<this.width;V++){V/k.right>1&&(k=h[++I]);var Y=Math.abs(V-k.left),ce=Math.abs(V-k.right),ve=Math.min(Y,ce),ye=void 0,ze=E/c*(d+1);if(k.isDash){var Fe=d-Math.abs(ze);ye=Math.sqrt(ve*ve+Fe*Fe)}else ye=d-Math.sqrt(ve*ve+ze*ze);this.data[A+V]=Math.max(0,Math.min(255,ye+128))}},Zt.prototype.addRegularDash=function(h){for(var f=h.length-1;f>=0;--f){var c=h[f],d=h[f+1];c.zeroLength?h.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,h.splice(f,1))}var E=h[0],A=h[h.length-1];E.isDash===A.isDash&&(E.left=A.left-this.width,A.right=E.right+this.width);for(var I=this.width*this.nextRow,k=0,V=h[k],Y=0;Y<this.width;Y++){Y/V.right>1&&(V=h[++k]);var ce=Math.abs(Y-V.left),ve=Math.abs(Y-V.right),ye=Math.min(ce,ve);this.data[I+Y]=Math.max(0,Math.min(255,(V.isDash?ye:-ye)+128))}},Zt.prototype.addDash=function(h,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,A=0;A<h.length;A++)E+=h[A];if(E!==0){var I=this.width/E,k=this.getDashRanges(h,this.width,I);f?this.addRoundDash(k,I,c):this.addRegularDash(k)}var V={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,V},Zt.prototype.bind=function(h){var f=h.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var ir=function h(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var A=new h.Actor(d[E],c,this.id);A.name="Worker "+E,this.actors.push(A)}};function Fr(h,f,c){var d=function(A,I){if(A)return c(A);if(I){var k=m.pick(m.extend(I,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(k.vectorLayers=I.vector_layers,k.vectorLayerIds=k.vectorLayers.map(function(V){return V.id})),k.tiles=f.canonicalizeTileset(k,h.url),c(null,k)}};return h.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(h.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,h)})}ir.prototype.broadcast=function(h,f,c){m.asyncAll(this.actors,function(d,E){d.send(h,f,E)},c=c||function(){})},ir.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},ir.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},ir.Actor=m.Actor;var qr=function(f,c,d){this.bounds=m.LngLatBounds.convert(this.validateBounds(f)),this.minzoom=c||0,this.maxzoom=d||24};qr.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},qr.prototype.contains=function(h){var f=Math.pow(2,h.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),A=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return h.x>=c&&h.x<E&&h.y>=d&&h.y<A};var br=function(h){function f(c,d,E,A){if(h.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new qr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function I(k,V){return delete c.request,c.aborted?d(null):k&&k.status!==404?d(k):(V&&V.resourceTiming&&(c.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&c.setExpiryData(V),c.loadVectorData(V,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",A,I.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",A,I.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),fe=function(h){function f(c,d,E,A){h.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new qr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,A=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(A,m.ResourceType.Tile),function(I,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(I)c.state="errored",d(I);else if(k){E.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var V=E.map.painter.context,Y=V.gl;c.texture=E.map.painter.getTileTexture(k.width),c.texture?c.texture.update(k,{useMipmap:!0}):(c.texture=new m.Texture(V,k,Y.RGBA,{useMipmap:!0}),c.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),V.extTextureFilterAnisotropic&&Y.texParameterf(Y.TEXTURE_2D,V.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,V.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Pe=function(h){function f(c,d,E,A){h.call(this,c,d,E,A),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(I,k){I&&(c.state="errored",d(I)),k&&(c.dem=k,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(I,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(I)c.state="errored",d(I);else if(k){this.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var V=m.window.ImageBitmap&&k instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?k:m.browser.getImageData(k,1),Y={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:V,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",Y,A.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),A=(d.x-1+E)%E,I=d.x===0?c.wrap-1:c.wrap,k=(d.x+1+E)%E,V=d.x+1===E?c.wrap+1:c.wrap,Y={};return Y[new m.OverscaledTileID(c.overscaledZ,I,d.z,A,d.y).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,V,d.z,k,d.y).key]={backfilled:!1},d.y>0&&(Y[new m.OverscaledTileID(c.overscaledZ,I,d.z,A,d.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,V,d.z,k,d.y-1).key]={backfilled:!1}),d.y+1<E&&(Y[new m.OverscaledTileID(c.overscaledZ,I,d.z,A,d.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},Y[new m.OverscaledTileID(c.overscaledZ,V,d.z,k,d.y+1).key]={backfilled:!1}),Y},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(fe),Se=function(h){function f(c,d,E,A){h.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(A),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var I=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*I,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*I,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*I,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var A={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(A.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",A))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},A),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),A=this._data;typeof A=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(A),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(A),this.actor.send(this.type+".loadData",E,function(I,k){d._removed||k&&k.abandoned||(d._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[d.id]&&(d._resourceTiming=k.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(I))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,A=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(A,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(I,k){return delete c.request,c.unloadVectorData(),c.aborted?d(null):I?d(I):(c.loadVectorData(k,E.map.painter,A==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),lt=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),ut=function(h){function f(c,d,E,A){h.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=d}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(A,I){E._loaded=!0,A?E.fire(new m.ErrorEvent(A)):I&&(E.image=I,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(I){for(var k=1/0,V=1/0,Y=-1/0,ce=-1/0,ve=0,ye=I;ve<ye.length;ve+=1){var ze=ye[ve];k=Math.min(k,ze.x),V=Math.min(V,ze.y),Y=Math.max(Y,ze.x),ce=Math.max(ce,ze.y)}var Fe=Math.max(Y-k,ce-V),$e=Math.max(0,Math.floor(-Math.log(Fe)/Math.LN2)),Ne=Math.pow(2,$e);return new m.CanonicalTileID($e,Math.floor((k+Y)/2*Ne),Math.floor((V+ce)/2*Ne))}(E),this.minzoom=this.maxzoom=this.tileID.z;var A=E.map(function(I){return d.tileID.getTilePoint(I)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ot=function(h){function f(c,d,E,A){h.call(this,c,d,E,A),this.roundZoom=!0,this.type="video",this.options=d}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,A=d.urls;E<A.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(A[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(I,k){c._loaded=!0,I?c.fire(new m.ErrorEvent(I)):k&&(c.video=k,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(ut),wt=function(h){function f(c,d,E,A){h.call(this,c,d,E,A),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(I){return!Array.isArray(I)||I.length!==2||I.some(function(k){return typeof k!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var I=this.tiles[A];I.state!=="loaded"&&(I.state="loaded",I.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(ut),sr={vector:br,raster:fe,"raster-dem":Pe,geojson:Se,video:Ot,image:ut,canvas:wt};function Or(h,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*h.width,.5*h.height,1]),m.multiply(c,c,h.calculatePosMatrix(f.toUnwrapped()))}function Nt(h,f,c,d,E,A){var I=function($e,Ne,Ze){if($e)for(var St=0,mt=$e;St<mt.length;St+=1){var lr=Ne[mt[St]];if(lr&&lr.source===Ze&&lr.type==="fill-extrusion")return!0}else for(var Qt in Ne){var fr=Ne[Qt];if(fr.source===Ze&&fr.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,h.id),k=A.maxPitchScaleFactor(),V=h.tilesIn(d,k,I);V.sort(Tt);for(var Y=[],ce=0,ve=V;ce<ve.length;ce+=1){var ye=ve[ce];Y.push({wrappedTileID:ye.tileID.wrapped().key,queryResults:ye.tile.queryRenderedFeatures(f,c,h._state,ye.queryGeometry,ye.cameraQueryGeometry,ye.scale,E,A,k,Or(h.transform,ye.tileID))})}var ze=function($e){for(var Ne={},Ze={},St=0,mt=$e;St<mt.length;St+=1){var lr=mt[St],Qt=lr.queryResults,fr=lr.wrappedTileID,_r=Ze[fr]=Ze[fr]||{};for(var Yr in Qt)for(var $r=Qt[Yr],cn=_r[Yr]=_r[Yr]||{},Zn=Ne[Yr]=Ne[Yr]||[],ai=0,pi=$r;ai<pi.length;ai+=1){var Ui=pi[ai];cn[Ui.featureIndex]||(cn[Ui.featureIndex]=!0,Zn.push(Ui))}}return Ne}(Y);for(var Fe in ze)ze[Fe].forEach(function($e){var Ne=$e.feature,Ze=h.getFeatureState(Ne.layer["source-layer"],Ne.id);Ne.source=Ne.layer.source,Ne.layer["source-layer"]&&(Ne.sourceLayer=Ne.layer["source-layer"]),Ne.state=Ze});return ze}function Tt(h,f){var c=h.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var It=function(f,c){this.max=f,this.onRemove=c,this.reset()};It.prototype.reset=function(){for(var h in this.data)for(var f=0,c=this.data[h];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},It.prototype.add=function(h,f,c){var d=this,E=h.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var A={value:f,timeout:void 0};if(c!==void 0&&(A.timeout=setTimeout(function(){d.remove(h,A)},c)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){var I=this._getAndRemoveByKey(this.order[0]);I&&this.onRemove(I)}return this},It.prototype.has=function(h){return h.wrapped().key in this.data},It.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},It.prototype._getAndRemoveByKey=function(h){var f=this.data[h].shift();return f.timeout&&clearTimeout(f.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),f.value},It.prototype.getByKey=function(h){var f=this.data[h];return f?f[0].value:null},It.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},It.prototype.remove=function(h,f){if(!this.has(h))return this;var c=h.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},It.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},It.prototype.filter=function(h){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var A=E[d];h(A.value)||f.push(A)}for(var I=0,k=f;I<k.length;I+=1){var V=k[I];this.remove(V.value.tileID,V)}};var $t=function(f,c,d){this.context=f;var E=f.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(d),this.context.unbindVAO(),f.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};$t.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},$t.prototype.updateData=function(h){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},$t.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qt=function(f,c,d,E){this.length=c.length,this.attributes=d,this.itemSize=c.bytesPerElement,this.dynamicDraw=E,this.context=f;var A=f.gl;this.buffer=A.createBuffer(),f.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer};qt.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qt.prototype.updateData=function(h){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,h.arrayBuffer)},qt.prototype.enableAttributes=function(h,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&h.enableVertexAttribArray(d)}},qt.prototype.setVertexAttribPointers=function(h,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],A=f.attributes[E.name];A!==void 0&&h.vertexAttribPointer(A,E.components,h[gr[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},qt.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var dr=function(f){this.gl=f.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};dr.prototype.get=function(){return this.current},dr.prototype.set=function(h){},dr.prototype.getDefault=function(){return this.default},dr.prototype.setDefault=function(){this.set(this.default)};var Ur=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(dr),Ir=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(dr),ur=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(dr),Rr=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(dr),Yn=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(dr),un=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(dr),_n=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(dr),qn=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(dr),oi=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(dr),Gi=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(dr),he=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(dr),Fn=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(dr),Li=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(dr),Ko=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(dr),us=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(dr),Ut=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(dr),Er=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(dr),Hr=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(dr),dn=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(dr),Kr=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(dr),Ia=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(dr),li=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(dr),Hn=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(dr),ii=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(dr),Hi=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(dr),Wi=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(dr),To=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(dr),Wa=function(h){function f(c){h.call(this,c),this.vao=c.extVertexArrayObject}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(dr),ma=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(dr),As=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(dr),js=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(dr),Ra=function(h){function f(c,d){h.call(this,c),this.context=c,this.parent=d}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(dr),J=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Ra),$=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Ra),le=function(f,c,d,E){this.context=f,this.width=c,this.height=d;var A=this.framebuffer=f.gl.createFramebuffer();this.colorAttachment=new J(f,A),E&&(this.depthAttachment=new $(f,A))};le.prototype.destroy=function(){var h=this.context.gl,f=this.colorAttachment.get();if(f&&h.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&h.deleteRenderbuffer(c)}h.deleteFramebuffer(this.framebuffer)};var ge=function(f,c,d){this.func=f,this.mask=c,this.range=d};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var ke=function(f,c,d,E,A,I){this.test=f,this.ref=c,this.mask=d,this.fail=E,this.depthFail=A,this.pass=I};ke.disabled=new ke({func:519,mask:0},0,0,7680,7680,7680);var nt=function(f,c,d){this.blendFunction=f,this.blendColor=c,this.mask=d};nt.disabled=new nt(nt.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),nt.unblended=new nt(nt.Replace,m.Color.transparent,[!0,!0,!0,!0]),nt.alphaBlended=new nt([1,771],m.Color.transparent,[!0,!0,!0,!0]);var pt=function(f,c,d){this.enable=f,this.mode=c,this.frontFace=d};pt.disabled=new pt(!1,1029,2305),pt.backCCW=new pt(!0,1029,2305);var pe=function(f){this.gl=f,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ur(this),this.clearDepth=new Ir(this),this.clearStencil=new ur(this),this.colorMask=new Rr(this),this.depthMask=new Yn(this),this.stencilMask=new un(this),this.stencilFunc=new _n(this),this.stencilOp=new qn(this),this.stencilTest=new oi(this),this.depthRange=new Gi(this),this.depthTest=new he(this),this.depthFunc=new Fn(this),this.blend=new Li(this),this.blendFunc=new Ko(this),this.blendColor=new us(this),this.blendEquation=new Ut(this),this.cullFace=new Er(this),this.cullFaceSide=new Hr(this),this.frontFace=new dn(this),this.program=new Kr(this),this.activeTexture=new Ia(this),this.viewport=new li(this),this.bindFramebuffer=new Hn(this),this.bindRenderbuffer=new ii(this),this.bindTexture=new Hi(this),this.bindVertexBuffer=new Wi(this),this.bindElementBuffer=new To(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Wa(this),this.pixelStoreUnpack=new ma(this),this.pixelStoreUnpackPremultiplyAlpha=new As(this),this.pixelStoreUnpackFlipY=new js(this),this.extTextureFilterAnisotropic=f.getExtension("EXT_texture_filter_anisotropic")||f.getExtension("MOZ_EXT_texture_filter_anisotropic")||f.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=f.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=f.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(f.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=f.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=f.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=f.getParameter(f.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(h,f){return new $t(this,h,f)},pe.prototype.createVertexBuffer=function(h,f,c){return new qt(this,h,f,c)},pe.prototype.createRenderbuffer=function(h,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,h,f,c),this.bindRenderbuffer.set(null),E},pe.prototype.createFramebuffer=function(h,f,c){return new le(this,h,f,c)},pe.prototype.clear=function(h){var f=h.color,c=h.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},pe.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},pe.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(h){m.deepEqual(h.blendFunction,nt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ue=function(h){function f(c,d,E){var A=this;h.call(this),this.id=c,this.dispatcher=E,this.on("data",function(I){I.dataType==="source"&&I.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&I.dataType==="source"&&I.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(I,k,V,Y){var ce=new sr[k.type](I,k,V,Y);if(ce.id!==I)throw new Error("Expected Source id to be "+I+" instead of "+ce.id);return m.bindAll(["load","abort","unload","serialize","prepare"],ce),ce}(c,d,E,this),this._tiles={},this._cache=new It(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(qe).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var A in this._tiles)this._isIdRenderable(A,c)&&E.push(this._tiles[A]);return c?E.sort(function(I,k){var V=I.tileID,Y=k.tileID,ce=new m.Point(V.canonical.x,V.canonical.y)._rotate(d.transform.angle),ve=new m.Point(Y.canonical.x,Y.canonical.y)._rotate(d.transform.angle);return V.overscaledZ-Y.overscaledZ||ve.y-ce.y||ve.x-ce.x}).map(function(I){return I.tileID.key}):E.map(function(I){return I.tileID}).sort(qe).map(function(I){return I.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,A){if(A)return c.state="errored",void(A.status!==404?this._source.fire(new m.ErrorEvent(A,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var A=d[E];if(c.neighboringTiles&&c.neighboringTiles[A]){var I=this.getTileByID(A);k(c,I),k(I,c)}}function k(V,Y){V.needsHillshadePrepare=!0;var ce=Y.tileID.canonical.x-V.tileID.canonical.x,ve=Y.tileID.canonical.y-V.tileID.canonical.y,ye=Math.pow(2,V.tileID.canonical.z),ze=Y.tileID.key;ce===0&&ve===0||Math.abs(ve)>1||(Math.abs(ce)>1&&(Math.abs(ce+ye)===1?ce+=ye:Math.abs(ce-ye)===1&&(ce-=ye)),Y.dem&&V.dem&&(V.dem.backfillBorder(Y.dem,ce,ve),V.neighboringTiles&&V.neighboringTiles[ze]&&(V.neighboringTiles[ze].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,A){for(var I in this._tiles){var k=this._tiles[I];if(!(A[I]||!k.hasData()||k.tileID.overscaledZ<=d||k.tileID.overscaledZ>E)){for(var V=k.tileID;k&&k.tileID.overscaledZ>d+1;){var Y=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[Y.key])&&k.hasData()&&(V=Y)}for(var ce=V;ce.overscaledZ>d;)if(c[(ce=ce.scaledTo(ce.overscaledZ-1)).key]){A[V.key]=V;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var A=c.overscaledZ-1;A>=d;A--){var I=c.scaledTo(A),k=this._getLoadedTile(I);if(k)return k}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,A=Math.floor(d*E*5),I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(I)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var A in this._tiles){var I=this._tiles[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),E[I.tileID.key]=I}for(var k in this._tiles=E,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var V in this._tiles)this._setTileReloadTimer(V,this._tiles[V])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(_r){return new m.OverscaledTileID(_r.canonical.z,_r.wrap,_r.canonical.z,_r.canonical.x,_r.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(_r){return d._source.hasTile(_r)}))):E=[];var A=c.coveringZoomLevel(this._source),I=Math.max(A-f.maxOverzooming,this._source.minzoom),k=Math.max(A+f.maxUnderzooming,this._source.minzoom),V=this._updateRetainedTiles(E,A);if(Cr(this._source.type)){for(var Y={},ce={},ve=0,ye=Object.keys(V);ve<ye.length;ve+=1){var ze=ye[ve],Fe=V[ze],$e=this._tiles[ze];if($e&&!($e.fadeEndTime&&$e.fadeEndTime<=m.browser.now())){var Ne=this.findLoadedParent(Fe,I);Ne&&(this._addTile(Ne.tileID),Y[Ne.tileID.key]=Ne.tileID),ce[ze]=Fe}}for(var Ze in this._retainLoadedChildren(ce,A,k,V),Y)V[Ze]||(this._coveredTiles[Ze]=!0,V[Ze]=Y[Ze])}for(var St in V)this._tiles[St].clearFadeHold();for(var mt=0,lr=m.keysDifference(this._tiles,V);mt<lr.length;mt+=1){var Qt=lr[mt],fr=this._tiles[Qt];fr.hasSymbolBuckets&&!fr.holdingForFade()?fr.setHoldDuration(this.map._fadeDuration):fr.hasSymbolBuckets&&!fr.symbolFadeFinished()||this._removeTile(Qt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},A={},I=Math.max(d-f.maxOverzooming,this._source.minzoom),k=Math.max(d+f.maxUnderzooming,this._source.minzoom),V={},Y=0,ce=c;Y<ce.length;Y+=1){var ve=ce[Y],ye=this._addTile(ve);E[ve.key]=ve,ye.hasData()||d<this._source.maxzoom&&(V[ve.key]=ve)}this._retainLoadedChildren(V,d,k,E);for(var ze=0,Fe=c;ze<Fe.length;ze+=1){var $e=Fe[ze],Ne=this._tiles[$e.key];if(!Ne.hasData()){if(d+1>this._source.maxzoom){var Ze=$e.children(this._source.maxzoom)[0],St=this.getTile(Ze);if(St&&St.hasData()){E[Ze.key]=Ze;continue}}else{var mt=$e.children(this._source.maxzoom);if(E[mt[0].key]&&E[mt[1].key]&&E[mt[2].key]&&E[mt[3].key])continue}for(var lr=Ne.wasRequested(),Qt=$e.overscaledZ-1;Qt>=I;--Qt){var fr=$e.scaledTo(Qt);if(A[fr.key]||(A[fr.key]=!0,!(Ne=this.getTile(fr))&&lr&&(Ne=this._addTile(fr)),Ne&&(E[fr.key]=fr,lr=Ne.wasRequested(),Ne.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,A=this._tiles[c].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){E=this._loadedParentTiles[A.key];break}d.push(A.key);var I=A.scaledTo(A.overscaledZ-1);if(E=this._getLoadedTile(I))break;A=I}for(var k=0,V=d;k<V.length;k+=1)this._loadedParentTiles[V[k]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var A=d.getExpiryTimeout();A&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},A))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var A=this,I=[],k=this.transform;if(!k)return I;for(var V=E?k.getCameraQueryGeometry(c):c,Y=c.map(function(Qt){return k.pointCoordinate(Qt)}),ce=V.map(function(Qt){return k.pointCoordinate(Qt)}),ve=this.getIds(),ye=1/0,ze=1/0,Fe=-1/0,$e=-1/0,Ne=0,Ze=ce;Ne<Ze.length;Ne+=1){var St=Ze[Ne];ye=Math.min(ye,St.x),ze=Math.min(ze,St.y),Fe=Math.max(Fe,St.x),$e=Math.max($e,St.y)}for(var mt=function(fr){var _r=A._tiles[ve[fr]];if(!_r.holdingForFade()){var Yr=_r.tileID,$r=Math.pow(2,k.zoom-_r.tileID.overscaledZ),cn=d*_r.queryPadding*m.EXTENT/_r.tileSize/$r,Zn=[Yr.getTilePoint(new m.MercatorCoordinate(ye,ze)),Yr.getTilePoint(new m.MercatorCoordinate(Fe,$e))];if(Zn[0].x-cn<m.EXTENT&&Zn[0].y-cn<m.EXTENT&&Zn[1].x+cn>=0&&Zn[1].y+cn>=0){var ai=Y.map(function(Ui){return Yr.getTilePoint(Ui)}),pi=ce.map(function(Ui){return Yr.getTilePoint(Ui)});I.push({tile:_r,tileID:Yr,queryGeometry:ai,cameraQueryGeometry:pi,scale:$r})}}},lr=0;lr<ve.length;lr++)mt(lr);return I},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(V){return d._tiles[V].tileID}),A=0,I=E;A<I.length;A+=1){var k=I[A];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Cr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var A=this._tiles[c];A&&A.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(A){return!A.hasDependency(c,d)})},f}(m.Evented);function qe(h,f){var c=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return h.overscaledZ-f.overscaledZ||d-c||f.canonical.y-h.canonical.y||f.canonical.x-h.canonical.x}function Cr(h){return h==="raster"||h==="image"||h==="video"}function Tr(){return new m.window.Worker(yf.workerUrl)}Ue.maxOverzooming=10,Ue.maxUnderzooming=3;var tr="mapboxgl_preloaded_worker_pool",Dr=function(){this.active={}};Dr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<Dr.workerCount;)this.workers.push(new Tr);return this.active[h]=!0,this.workers.slice()},Dr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},Dr.prototype.isPreloaded=function(){return!!this.active[tr]},Dr.prototype.numActive=function(){return Object.keys(this.active).length};var nn,Mn=Math.floor(m.browser.hardwareConcurrency/2);function rr(){return nn||(nn=new Dr),nn}function wn(h,f){var c={};for(var d in h)d!=="ref"&&(c[d]=h[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function mn(h){h=h.slice();for(var f=Object.create(null),c=0;c<h.length;c++)f[h[c].id]=h[c];for(var d=0;d<h.length;d++)"ref"in h[d]&&(h[d]=wn(h[d],f[h[d].ref]));return h}Dr.workerCount=Math.max(Math.min(Mn,6),1);var xn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function w(h,f,c){c.push({command:xn.addSource,args:[h,f[h]]})}function An(h,f,c){f.push({command:xn.removeSource,args:[h]}),c[h]=!0}function Lr(h,f,c,d){An(h,c,d),w(h,f,c)}function Zi(h,f,c){var d;for(d in h[c])if(h[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(h[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(h[c][d],f[c][d]))return!1;return!0}function Ti(h,f,c,d,E,A){var I;for(I in f=f||{},h=h||{})h.hasOwnProperty(I)&&(m.deepEqual(h[I],f[I])||c.push({command:A,args:[d,I,f[I],E]}));for(I in f)f.hasOwnProperty(I)&&!h.hasOwnProperty(I)&&(m.deepEqual(h[I],f[I])||c.push({command:A,args:[d,I,f[I],E]}))}function Un(h){return h.id}function Bi(h,f){return h[f.id]=f,h}var Mo=function(f,c){this.reset(f,c)};Mo.prototype.reset=function(h,f){this.points=h||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Mo.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=m.clamp(h,0,1);for(var f=1,c=this._distances[f],d=h*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,A=this._distances[E],I=c-A,k=I>0?(d-A)/I:0;return this.points[E].mult(1-k).add(this.points[f].mult(k))};var ra=function(f,c,d){var E=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(f/d),this.yCellCount=Math.ceil(c/d);for(var I=0;I<this.xCellCount*this.yCellCount;I++)E.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=f,this.height=c,this.xScale=this.xCellCount/f,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0};function to(h,f,c,d,E){var A=m.create();return f?(m.scale(A,A,[1/E,1/E,1]),c||m.rotateZ(A,A,d.angle)):m.multiply(A,d.labelPlaneMatrix,h),A}function ca(h,f,c,d,E){if(f){var A=m.clone(h);return m.scale(A,A,[E,E,1]),c||m.rotateZ(A,A,-d.angle),A}return d.glCoordMatrix}function ci(h,f){var c=[h.x,h.y,0,1];Va(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function bi(h,f){return .5+h/f*.5}function vo(h,f){var c=h[0]/h[3],d=h[1]/h[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function mo(h,f,c,d,E,A,I,k){var V=d?h.textSizeData:h.iconSizeData,Y=m.evaluateSizeForZoom(V,c.transform.zoom),ce=[256/c.width*2+1,256/c.height*2+1],ve=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ve.clear();for(var ye=h.lineVertexArray,ze=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Fe=c.transform.width/c.transform.height,$e=!1,Ne=0;Ne<ze.length;Ne++){var Ze=ze.get(Ne);if(Ze.hidden||Ze.writingMode===m.WritingMode.vertical&&!$e)ga(Ze.numGlyphs,ve);else{$e=!1;var St=[Ze.anchorX,Ze.anchorY,0,1];if(m.transformMat4(St,St,f),vo(St,ce)){var mt=bi(c.transform.cameraToCenterDistance,St[3]),lr=m.evaluateSizeForFeature(V,Y,Ze),Qt=I?lr/mt:lr*mt,fr=new m.Point(Ze.anchorX,Ze.anchorY),_r=ci(fr,E).point,Yr={},$r=so(Ze,Qt,!1,k,f,E,A,h.glyphOffsetArray,ye,ve,_r,fr,Yr,Fe);$e=$r.useVertical,($r.notEnoughRoom||$e||$r.needsFlipping&&so(Ze,Qt,!0,k,f,E,A,h.glyphOffsetArray,ye,ve,_r,fr,Yr,Fe).notEnoughRoom)&&ga(Ze.numGlyphs,ve)}else ga(Ze.numGlyphs,ve)}}d?h.text.dynamicLayoutVertexBuffer.updateData(ve):h.icon.dynamicLayoutVertexBuffer.updateData(ve)}function ia(h,f,c,d,E,A,I,k,V,Y,ce){var ve=k.glyphStartIndex+k.numGlyphs,ye=k.lineStartIndex,ze=k.lineStartIndex+k.lineLength,Fe=f.getoffsetX(k.glyphStartIndex),$e=f.getoffsetX(ve-1),Ne=Ta(h*Fe,c,d,E,A,I,k.segment,ye,ze,V,Y,ce);if(!Ne)return null;var Ze=Ta(h*$e,c,d,E,A,I,k.segment,ye,ze,V,Y,ce);return Ze?{first:Ne,last:Ze}:null}function Za(h,f,c,d){return h===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(h===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function so(h,f,c,d,E,A,I,k,V,Y,ce,ve,ye,ze){var Fe,$e=f/24,Ne=h.lineOffsetX*$e,Ze=h.lineOffsetY*$e;if(h.numGlyphs>1){var St=h.glyphStartIndex+h.numGlyphs,mt=h.lineStartIndex,lr=h.lineStartIndex+h.lineLength,Qt=ia($e,k,Ne,Ze,c,ce,ve,h,V,A,ye);if(!Qt)return{notEnoughRoom:!0};var fr=ci(Qt.first.point,I).point,_r=ci(Qt.last.point,I).point;if(d&&!c){var Yr=Za(h.writingMode,fr,_r,ze);if(Yr)return Yr}Fe=[Qt.first];for(var $r=h.glyphStartIndex+1;$r<St-1;$r++)Fe.push(Ta($e*k.getoffsetX($r),Ne,Ze,c,ce,ve,h.segment,mt,lr,V,A,ye));Fe.push(Qt.last)}else{if(d&&!c){var cn=ci(ve,E).point,Zn=h.lineStartIndex+h.segment+1,ai=new m.Point(V.getx(Zn),V.gety(Zn)),pi=ci(ai,E),Ui=pi.signedDistanceFromCamera>0?pi.point:bl(ve,ai,cn,1,E),zi=Za(h.writingMode,cn,Ui,ze);if(zi)return zi}var Bn=Ta($e*k.getoffsetX(h.glyphStartIndex),Ne,Ze,c,ce,ve,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,V,A,ye);if(!Bn)return{notEnoughRoom:!0};Fe=[Bn]}for(var Ei=0,Oi=Fe;Ei<Oi.length;Ei+=1){var ei=Oi[Ei];m.addDynamicAttributes(Y,ei.point,ei.angle)}return{}}function bl(h,f,c,d,E){var A=ci(h.add(h.sub(f)._unit()),E).point,I=c.sub(A);return c.add(I._mult(d/I.mag()))}function Ta(h,f,c,d,E,A,I,k,V,Y,ce,ve){var ye=d?h-f:h+f,ze=ye>0?1:-1,Fe=0;d&&(ze*=-1,Fe=Math.PI),ze<0&&(Fe+=Math.PI);for(var $e=ze>0?k+I:k+I+1,Ne=E,Ze=E,St=0,mt=0,lr=Math.abs(ye),Qt=[];St+mt<=lr;){if(($e+=ze)<k||$e>=V)return null;if(Ze=Ne,Qt.push(Ne),(Ne=ve[$e])===void 0){var fr=new m.Point(Y.getx($e),Y.gety($e)),_r=ci(fr,ce);if(_r.signedDistanceFromCamera>0)Ne=ve[$e]=_r.point;else{var Yr=$e-ze;Ne=bl(St===0?A:new m.Point(Y.getx(Yr),Y.gety(Yr)),fr,Ze,lr-St+1,ce)}}St+=mt,mt=Ze.dist(Ne)}var $r=(lr-St)/mt,cn=Ne.sub(Ze),Zn=cn.mult($r)._add(Ze);Zn._add(cn._unit()._perp()._mult(c*ze));var ai=Fe+Math.atan2(Ne.y-Ze.y,Ne.x-Ze.x);return Qt.push(Zn),{point:Zn,angle:ai,path:Qt}}ra.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ra.prototype.insert=function(h,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},ra.prototype.insertCircle=function(h,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(f),this.circles.push(c),this.circles.push(d)},ra.prototype._insertBoxCell=function(h,f,c,d,E,A){this.boxCells[E].push(A)},ra.prototype._insertCircleCell=function(h,f,c,d,E,A){this.circleCells[E].push(A)},ra.prototype._query=function(h,f,c,d,E,A){if(c<0||h>this.width||d<0||f>this.height)return!E&&[];var I=[];if(h<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var V=0;V<this.circleKeys.length;V++){var Y=this.circles[3*V],ce=this.circles[3*V+1],ve=this.circles[3*V+2];I.push({key:this.circleKeys[V],x1:Y-ve,y1:ce-ve,x2:Y+ve,y2:ce+ve})}return A?I.filter(A):I}return this._forEachCell(h,f,c,d,this._queryCell,I,{hitTest:E,seenUids:{box:{},circle:{}}},A),E?I.length>0:I},ra.prototype._queryCircle=function(h,f,c,d,E){var A=h-c,I=h+c,k=f-c,V=f+c;if(I<0||A>this.width||V<0||k>this.height)return!d&&[];var Y=[];return this._forEachCell(A,k,I,V,this._queryCellCircle,Y,{hitTest:d,circle:{x:h,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?Y.length>0:Y},ra.prototype.query=function(h,f,c,d,E){return this._query(h,f,c,d,!1,E)},ra.prototype.hitTest=function(h,f,c,d,E){return this._query(h,f,c,d,!0,E)},ra.prototype.hitTestCircle=function(h,f,c,d){return this._queryCircle(h,f,c,!0,d)},ra.prototype._queryCell=function(h,f,c,d,E,A,I,k){var V=I.seenUids,Y=this.boxCells[E];if(Y!==null)for(var ce=this.bboxes,ve=0,ye=Y;ve<ye.length;ve+=1){var ze=ye[ve];if(!V.box[ze]){V.box[ze]=!0;var Fe=4*ze;if(h<=ce[Fe+2]&&f<=ce[Fe+3]&&c>=ce[Fe+0]&&d>=ce[Fe+1]&&(!k||k(this.boxKeys[ze]))){if(I.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[ze],x1:ce[Fe],y1:ce[Fe+1],x2:ce[Fe+2],y2:ce[Fe+3]})}}}var $e=this.circleCells[E];if($e!==null)for(var Ne=this.circles,Ze=0,St=$e;Ze<St.length;Ze+=1){var mt=St[Ze];if(!V.circle[mt]){V.circle[mt]=!0;var lr=3*mt;if(this._circleAndRectCollide(Ne[lr],Ne[lr+1],Ne[lr+2],h,f,c,d)&&(!k||k(this.circleKeys[mt]))){if(I.hitTest)return A.push(!0),!0;var Qt=Ne[lr],fr=Ne[lr+1],_r=Ne[lr+2];A.push({key:this.circleKeys[mt],x1:Qt-_r,y1:fr-_r,x2:Qt+_r,y2:fr+_r})}}}},ra.prototype._queryCellCircle=function(h,f,c,d,E,A,I,k){var V=I.circle,Y=I.seenUids,ce=this.boxCells[E];if(ce!==null)for(var ve=this.bboxes,ye=0,ze=ce;ye<ze.length;ye+=1){var Fe=ze[ye];if(!Y.box[Fe]){Y.box[Fe]=!0;var $e=4*Fe;if(this._circleAndRectCollide(V.x,V.y,V.radius,ve[$e+0],ve[$e+1],ve[$e+2],ve[$e+3])&&(!k||k(this.boxKeys[Fe])))return A.push(!0),!0}}var Ne=this.circleCells[E];if(Ne!==null)for(var Ze=this.circles,St=0,mt=Ne;St<mt.length;St+=1){var lr=mt[St];if(!Y.circle[lr]){Y.circle[lr]=!0;var Qt=3*lr;if(this._circlesCollide(Ze[Qt],Ze[Qt+1],Ze[Qt+2],V.x,V.y,V.radius)&&(!k||k(this.circleKeys[lr])))return A.push(!0),!0}}},ra.prototype._forEachCell=function(h,f,c,d,E,A,I,k){for(var V=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(f),ce=this._convertToXCellCoord(c),ve=this._convertToYCellCoord(d),ye=V;ye<=ce;ye++)for(var ze=Y;ze<=ve;ze++)if(E.call(this,h,f,c,d,this.xCellCount*ze+ye,A,I,k))return},ra.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},ra.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},ra.prototype._circlesCollide=function(h,f,c,d,E,A){var I=d-h,k=E-f,V=c+A;return V*V>I*I+k*k},ra.prototype._circleAndRectCollide=function(h,f,c,d,E,A,I){var k=(A-d)/2,V=Math.abs(h-(d+k));if(V>k+c)return!1;var Y=(I-E)/2,ce=Math.abs(f-(E+Y));if(ce>Y+c)return!1;if(V<=k||ce<=Y)return!0;var ve=V-k,ye=ce-Y;return ve*ve+ye*ye<=c*c};var cu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ga(h,f){for(var c=0;c<h;c++){var d=f.length;f.resize(d+4),f.float32.set(cu,3*d)}}function Va(h,f,c){var d=f[0],E=f[1];return h[0]=c[0]*d+c[4]*E+c[12],h[1]=c[1]*d+c[5]*E+c[13],h[3]=c[3]*d+c[7]*E+c[15],h}var Co=function(f,c,d){c===void 0&&(c=new ra(f.width+200,f.height+200,25)),d===void 0&&(d=new ra(f.width+200,f.height+200,25)),this.transform=f,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(f._pitch)*f.cameraToCenterDistance,this.screenRightBoundary=f.width+100,this.screenBottomBoundary=f.height+100,this.gridRightBoundary=f.width+200,this.gridBottomBoundary=f.height+200};function wa(h,f,c){return f*(m.EXTENT/(h.tileSize*Math.pow(2,c-h.tileID.overscaledZ)))}Co.prototype.placeCollisionBox=function(h,f,c,d,E){var A=this.projectAndGetPerspectiveRatio(d,h.anchorPointX,h.anchorPointY),I=c*A.perspectiveRatio,k=h.x1*I+A.point.x,V=h.y1*I+A.point.y,Y=h.x2*I+A.point.x,ce=h.y2*I+A.point.y;return!this.isInsideGrid(k,V,Y,ce)||!f&&this.grid.hitTest(k,V,Y,ce,E)?{box:[],offscreen:!1}:{box:[k,V,Y,ce],offscreen:this.isOffscreen(k,V,Y,ce)}},Co.prototype.placeCollisionCircles=function(h,f,c,d,E,A,I,k,V,Y,ce,ve,ye){var ze=[],Fe=new m.Point(f.anchorX,f.anchorY),$e=ci(Fe,A),Ne=bi(this.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),Ze=(Y?E/Ne:E*Ne)/m.ONE_EM,St=ci(Fe,I).point,mt=ia(Ze,d,f.lineOffsetX*Ze,f.lineOffsetY*Ze,!1,St,Fe,f,c,I,{}),lr=!1,Qt=!1,fr=!0;if(mt){for(var _r=.5*ve*Ne+ye,Yr=new m.Point(-100,-100),$r=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),cn=new Mo,Zn=mt.first,ai=mt.last,pi=[],Ui=Zn.path.length-1;Ui>=1;Ui--)pi.push(Zn.path[Ui]);for(var zi=1;zi<ai.path.length;zi++)pi.push(ai.path[zi]);var Bn=2.5*_r;if(k){var Ei=pi.map(function(ts){return ci(ts,k)});pi=Ei.some(function(ts){return ts.signedDistanceFromCamera<=0})?[]:Ei.map(function(ts){return ts.point})}var Oi=[];if(pi.length>0){for(var ei=pi[0].clone(),vi=pi[0].clone(),fi=1;fi<pi.length;fi++)ei.x=Math.min(ei.x,pi[fi].x),ei.y=Math.min(ei.y,pi[fi].y),vi.x=Math.max(vi.x,pi[fi].x),vi.y=Math.max(vi.y,pi[fi].y);Oi=ei.x>=Yr.x&&vi.x<=$r.x&&ei.y>=Yr.y&&vi.y<=$r.y?[pi]:vi.x<Yr.x||ei.x>$r.x||vi.y<Yr.y||ei.y>$r.y?[]:m.clipLine([pi],Yr.x,Yr.y,$r.x,$r.y)}for(var Di=0,Ji=Oi;Di<Ji.length;Di+=1){var yo;cn.reset(Ji[Di],.25*_r),yo=cn.length<=.5*_r?1:Math.ceil(cn.paddedLength/Bn)+1;for(var co=0;co<yo;co++){var Bo=co/Math.max(yo-1,1),$a=cn.lerp(Bo),fo=$a.x+100,Rs=$a.y+100;ze.push(fo,Rs,_r,0);var fs=fo-_r,Ol=Rs-_r,Il=fo+_r,Es=Rs+_r;if(fr=fr&&this.isOffscreen(fs,Ol,Il,Es),Qt=Qt||this.isInsideGrid(fs,Ol,Il,Es),!h&&this.grid.hitTestCircle(fo,Rs,_r,ce)&&(lr=!0,!V))return{circles:[],offscreen:!1,collisionDetected:lr}}}}return{circles:!V&&lr||!Qt?[]:ze,offscreen:fr,collisionDetected:lr}},Co.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,A=-1/0,I=0,k=h;I<k.length;I+=1){var V=k[I],Y=new m.Point(V.x+100,V.y+100);c=Math.min(c,Y.x),d=Math.min(d,Y.y),E=Math.max(E,Y.x),A=Math.max(A,Y.y),f.push(Y)}for(var ce={},ve={},ye=0,ze=this.grid.query(c,d,E,A).concat(this.ignoredGrid.query(c,d,E,A));ye<ze.length;ye+=1){var Fe=ze[ye],$e=Fe.key;if(ce[$e.bucketInstanceId]===void 0&&(ce[$e.bucketInstanceId]={}),!ce[$e.bucketInstanceId][$e.featureIndex]){var Ne=[new m.Point(Fe.x1,Fe.y1),new m.Point(Fe.x2,Fe.y1),new m.Point(Fe.x2,Fe.y2),new m.Point(Fe.x1,Fe.y2)];m.polygonIntersectsPolygon(f,Ne)&&(ce[$e.bucketInstanceId][$e.featureIndex]=!0,ve[$e.bucketInstanceId]===void 0&&(ve[$e.bucketInstanceId]=[]),ve[$e.bucketInstanceId].push($e.featureIndex))}}return ve},Co.prototype.insertCollisionBox=function(h,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},h[0],h[1],h[2],h[3])},Co.prototype.insertCollisionCircles=function(h,f,c,d,E){for(var A=f?this.ignoredGrid:this.grid,I={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},k=0;k<h.length;k+=4)A.insertCircle(I,h[k],h[k+1],h[k+2])},Co.prototype.projectAndGetPerspectiveRatio=function(h,f,c){var d=[f,c,0,1];return Va(d,d,h),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Co.prototype.isOffscreen=function(h,f,c,d){return c<100||h>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Co.prototype.isInsideGrid=function(h,f,c,d){return c>=0&&h<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Co.prototype.getViewportMatrix=function(){var h=m.identity([]);return m.translate(h,h,[-100,-100,0]),h};var qo=function(f,c,d,E){this.opacity=f?Math.max(0,Math.min(1,f.opacity+(f.placed?c:-c))):E&&d?1:0,this.placed=d};qo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var wo=function(f,c,d,E,A){this.text=new qo(f?f.text:null,c,d,A),this.icon=new qo(f?f.icon:null,c,E,A)};wo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var jo=function(f,c,d){this.text=f,this.icon=c,this.skipFade=d},ya=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Nl=function(f,c,d,E,A){this.bucketInstanceId=f,this.featureIndex=c,this.sourceLayerIndex=d,this.bucketIndex=E,this.tileID=A},ls=function(f){this.crossSourceCollisions=f,this.maxGroupID=0,this.collisionGroups={}};function uo(h,f,c,d,E){var A=m.getAnchorAlignment(h),I=-(A.horizontalAlign-.5)*f,k=-(A.verticalAlign-.5)*c,V=m.evaluateVariableOffset(h,d);return new m.Point(I+V[0]*E,k+V[1]*E)}function $s(h,f,c,d,E,A){var I=h.x1,k=h.x2,V=h.y1,Y=h.y2,ce=h.anchorPointX,ve=h.anchorPointY,ye=new m.Point(f,c);return d&&ye._rotate(E?A:-A),{x1:I+ye.x,y1:V+ye.y,x2:k+ye.x,y2:Y+ye.y,anchorPointX:ce,anchorPointY:ve}}ls.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var f=++this.maxGroupID;this.collisionGroups[h]={ID:f,predicate:function(d){return d.collisionGroupID===f}}}return this.collisionGroups[h]};var Lo=function(f,c,d,E){this.transform=f.clone(),this.collisionIndex=new Co(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ls(d),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}};function go(h,f,c,d,E){h.emplaceBack(f?1:0,c?1:0,d||0,E||0),h.emplaceBack(f?1:0,c?1:0,d||0,E||0),h.emplaceBack(f?1:0,c?1:0,d||0,E||0),h.emplaceBack(f?1:0,c?1:0,d||0,E||0)}Lo.prototype.getBucketParts=function(h,f,c,d){var E=c.getBucket(f),A=c.latestFeatureIndex;if(E&&A&&f.id===E.layerIds[0]){var I=c.collisionBoxArray,k=E.layers[0].layout,V=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Y=c.tileSize/m.EXTENT,ce=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),ve=k.get("text-pitch-alignment")==="map",ye=k.get("text-rotation-alignment")==="map",ze=wa(c,1,this.transform.zoom),Fe=to(ce,ve,ye,this.transform,ze),$e=null;if(ve){var Ne=ca(ce,ve,ye,this.transform,ze);$e=m.multiply([],this.transform.labelPlaneMatrix,Ne)}this.retainedQueryData[E.bucketInstanceId]=new Nl(E.bucketInstanceId,A,E.sourceLayerIndex,E.index,c.tileID);var Ze={bucket:E,layout:k,posMatrix:ce,textLabelPlaneMatrix:Fe,labelToScreenMatrix:$e,scale:V,textPixelRatio:Y,holdingForFade:c.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var St=0,mt=E.sortKeyRanges;St<mt.length;St+=1){var lr=mt[St];h.push({sortKey:lr.sortKey,symbolInstanceStart:lr.symbolInstanceStart,symbolInstanceEnd:lr.symbolInstanceEnd,parameters:Ze})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ze})}},Lo.prototype.attemptAnchorPlacement=function(h,f,c,d,E,A,I,k,V,Y,ce,ve,ye,ze,Fe){var $e,Ne=[ve.textOffset0,ve.textOffset1],Ze=uo(h,c,d,Ne,E),St=this.collisionIndex.placeCollisionBox($s(f,Ze.x,Ze.y,A,I,this.transform.angle),ce,k,V,Y.predicate);if(!Fe||this.collisionIndex.placeCollisionBox($s(Fe,Ze.x,Ze.y,A,I,this.transform.angle),ce,k,V,Y.predicate).box.length!==0)return St.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID]&&this.prevPlacement.placements[ve.crossTileID].text&&($e=this.prevPlacement.variableOffsets[ve.crossTileID].anchor),this.variableOffsets[ve.crossTileID]={textOffset:Ne,width:c,height:d,anchor:h,textBoxScale:E,prevAnchor:$e},this.markUsedJustification(ye,h,ve,ze),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,ze,ve),this.placedOrientations[ve.crossTileID]=ze),{shift:Ze,placedGlyphBoxes:St}):void 0},Lo.prototype.placeLayerBucketPart=function(h,f,c){var d=this,E=h.parameters,A=E.bucket,I=E.layout,k=E.posMatrix,V=E.textLabelPlaneMatrix,Y=E.labelToScreenMatrix,ce=E.textPixelRatio,ve=E.holdingForFade,ye=E.collisionBoxArray,ze=E.partiallyEvaluatedTextSize,Fe=E.collisionGroup,$e=I.get("text-optional"),Ne=I.get("icon-optional"),Ze=I.get("text-allow-overlap"),St=I.get("icon-allow-overlap"),mt=I.get("text-rotation-alignment")==="map",lr=I.get("text-pitch-alignment")==="map",Qt=I.get("icon-text-fit")!=="none",fr=I.get("symbol-z-order")==="viewport-y",_r=Ze&&(St||!A.hasIconData()||Ne),Yr=St&&(Ze||!A.hasTextData()||$e);!A.collisionArrays&&ye&&A.deserializeCollisionBoxes(ye);var $r=function(Bn,Ei){if(!f[Bn.crossTileID])if(ve)d.placements[Bn.crossTileID]=new jo(!1,!1,!1);else{var Oi,ei=!1,vi=!1,fi=!0,Di=null,Ji={box:null,offscreen:null},yo={box:null,offscreen:null},co=null,Bo=null,$a=0,fo=0,Rs=0;Ei.textFeatureIndex?$a=Ei.textFeatureIndex:Bn.useRuntimeCollisionCircles&&($a=Bn.featureIndex),Ei.verticalTextFeatureIndex&&(fo=Ei.verticalTextFeatureIndex);var fs=Ei.textBox;if(fs){var Ol=function(Zo){var Hs=m.WritingMode.horizontal;if(A.allowVerticalPlacement&&!Zo&&d.prevPlacement){var hs=d.prevPlacement.placedOrientations[Bn.crossTileID];hs&&(d.placedOrientations[Bn.crossTileID]=hs,d.markUsedOrientation(A,Hs=hs,Bn))}return Hs},Il=function(Zo,Hs){if(A.allowVerticalPlacement&&Bn.numVerticalGlyphVertices>0&&Ei.verticalTextBox)for(var hs=0,Ls=A.writingModes;hs<Ls.length&&(Ls[hs]===m.WritingMode.vertical?(Ji=Hs(),yo=Ji):Ji=Zo(),!(Ji&&Ji.box&&Ji.box.length));hs+=1);else Ji=Zo()};if(I.get("text-variable-anchor")){var Es=I.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[Bn.crossTileID]){var ts=d.prevPlacement.variableOffsets[Bn.crossTileID];Es.indexOf(ts.anchor)>0&&(Es=Es.filter(function(ks){return ks!==ts.anchor})).unshift(ts.anchor)}var lc=function(Zo,Hs,hs){for(var Ls=Zo.x2-Zo.x1,xf=Zo.y2-Zo.y1,kl=Bn.textBoxScale,vu=Qt&&!St?Hs:null,$u={box:[],offscreen:!1},Ku=Ze?2*Es.length:Es.length,Pu=0;Pu<Ku;++Pu){var ps=d.attemptAnchorPlacement(Es[Pu%Es.length],Zo,Ls,xf,kl,mt,lr,ce,k,Fe,Pu>=Es.length,Bn,A,hs,vu);if(ps&&($u=ps.placedGlyphBoxes)&&$u.box&&$u.box.length){ei=!0,Di=ps.shift;break}}return $u};Il(function(){return lc(fs,Ei.iconBox,m.WritingMode.horizontal)},function(){var ks=Ei.verticalTextBox;return A.allowVerticalPlacement&&!(Ji&&Ji.box&&Ji.box.length)&&Bn.numVerticalGlyphVertices>0&&ks?lc(ks,Ei.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Ji&&(ei=Ji.box,fi=Ji.offscreen);var cc=Ol(Ji&&Ji.box);if(!ei&&d.prevPlacement){var Zu=d.prevPlacement.variableOffsets[Bn.crossTileID];Zu&&(d.variableOffsets[Bn.crossTileID]=Zu,d.markUsedJustification(A,Zu.anchor,Bn,cc))}}else{var Tu=function(Zo,Hs){var hs=d.collisionIndex.placeCollisionBox(Zo,Ze,ce,k,Fe.predicate);return hs&&hs.box&&hs.box.length&&(d.markUsedOrientation(A,Hs,Bn),d.placedOrientations[Bn.crossTileID]=Hs),hs};Il(function(){return Tu(fs,m.WritingMode.horizontal)},function(){var ks=Ei.verticalTextBox;return A.allowVerticalPlacement&&Bn.numVerticalGlyphVertices>0&&ks?Tu(ks,m.WritingMode.vertical):{box:null,offscreen:null}}),Ol(Ji&&Ji.box&&Ji.box.length)}}if(ei=(Oi=Ji)&&Oi.box&&Oi.box.length>0,fi=Oi&&Oi.offscreen,Bn.useRuntimeCollisionCircles){var Mu=A.text.placedSymbolArray.get(Bn.centerJustifiedTextSymbolIndex),iu=m.evaluateSizeForFeature(A.textSizeData,ze,Mu),Xu=I.get("text-padding");co=d.collisionIndex.placeCollisionCircles(Ze,Mu,A.lineVertexArray,A.glyphOffsetArray,iu,k,V,Y,c,lr,Fe.predicate,Bn.collisionCircleDiameter,Xu),ei=Ze||co.circles.length>0&&!co.collisionDetected,fi=fi&&co.offscreen}if(Ei.iconFeatureIndex&&(Rs=Ei.iconFeatureIndex),Ei.iconBox){var Gs=function(Zo){var Hs=Qt&&Di?$s(Zo,Di.x,Di.y,mt,lr,d.transform.angle):Zo;return d.collisionIndex.placeCollisionBox(Hs,St,ce,k,Fe.predicate)};vi=yo&&yo.box&&yo.box.length&&Ei.verticalIconBox?(Bo=Gs(Ei.verticalIconBox)).box.length>0:(Bo=Gs(Ei.iconBox)).box.length>0,fi=fi&&Bo.offscreen}var La=$e||Bn.numHorizontalGlyphVertices===0&&Bn.numVerticalGlyphVertices===0,Yu=Ne||Bn.numIconVertices===0;if(La||Yu?Yu?La||(vi=vi&&ei):ei=vi&&ei:vi=ei=vi&&ei,ei&&Oi&&Oi.box&&d.collisionIndex.insertCollisionBox(Oi.box,I.get("text-ignore-placement"),A.bucketInstanceId,yo&&yo.box&&fo?fo:$a,Fe.ID),vi&&Bo&&d.collisionIndex.insertCollisionBox(Bo.box,I.get("icon-ignore-placement"),A.bucketInstanceId,Rs,Fe.ID),co&&(ei&&d.collisionIndex.insertCollisionCircles(co.circles,I.get("text-ignore-placement"),A.bucketInstanceId,$a,Fe.ID),c)){var _f=A.bucketInstanceId,Rl=d.collisionCircleArrays[_f];Rl===void 0&&(Rl=d.collisionCircleArrays[_f]=new ya);for(var Wo=0;Wo<co.circles.length;Wo+=4)Rl.circles.push(co.circles[Wo+0]),Rl.circles.push(co.circles[Wo+1]),Rl.circles.push(co.circles[Wo+2]),Rl.circles.push(co.collisionDetected?1:0)}d.placements[Bn.crossTileID]=new jo(ei||_r,vi||Yr,fi||A.justReloaded),f[Bn.crossTileID]=!0}};if(fr)for(var cn=A.getSortedSymbolIndexes(this.transform.angle),Zn=cn.length-1;Zn>=0;--Zn){var ai=cn[Zn];$r(A.symbolInstances.get(ai),A.collisionArrays[ai])}else for(var pi=h.symbolInstanceStart;pi<h.symbolInstanceEnd;pi++)$r(A.symbolInstances.get(pi),A.collisionArrays[pi]);if(c&&A.bucketInstanceId in this.collisionCircleArrays){var Ui=this.collisionCircleArrays[A.bucketInstanceId];m.invert(Ui.invProjMatrix,k),Ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},Lo.prototype.markUsedJustification=function(h,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var A=0,I=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];A<I.length;A+=1){var k=I[A];k>=0&&(h.text.placedSymbolArray.get(k).crossTileID=E>=0&&k!==E?0:c.crossTileID)}},Lo.prototype.markUsedOrientation=function(h,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,A=0,I=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];A<I.length;A+=1)h.text.placedSymbolArray.get(I[A]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Lo.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(h):1,E=f?f.opacities:{},A=f?f.variableOffsets:{},I=f?f.placedOrientations:{};for(var k in this.placements){var V=this.placements[k],Y=E[k];Y?(this.opacities[k]=new wo(Y,d,V.text,V.icon),c=c||V.text!==Y.text.placed||V.icon!==Y.icon.placed):(this.opacities[k]=new wo(null,d,V.text,V.icon,V.skipFade),c=c||V.text||V.icon)}for(var ce in E){var ve=E[ce];if(!this.opacities[ce]){var ye=new wo(ve,d,!1,!1);ye.isHidden()||(this.opacities[ce]=ye,c=c||ve.text.placed||ve.icon.placed)}}for(var ze in A)this.variableOffsets[ze]||!this.opacities[ze]||this.opacities[ze].isHidden()||(this.variableOffsets[ze]=A[ze]);for(var Fe in I)this.placedOrientations[Fe]||!this.opacities[Fe]||this.opacities[Fe].isHidden()||(this.placedOrientations[Fe]=I[Fe]);c?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:h)},Lo.prototype.updateLayerOpacities=function(h,f){for(var c={},d=0,E=f;d<E.length;d+=1){var A=E[d],I=A.getBucket(h);I&&A.latestFeatureIndex&&h.id===I.layerIds[0]&&this.updateBucketOpacities(I,c,A.collisionBoxArray)}},Lo.prototype.updateBucketOpacities=function(h,f,c){var d=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var E=h.layers[0].layout,A=new wo(null,0,!1,!1,!0),I=E.get("text-allow-overlap"),k=E.get("icon-allow-overlap"),V=E.get("text-variable-anchor"),Y=E.get("text-rotation-alignment")==="map",ce=E.get("text-pitch-alignment")==="map",ve=E.get("icon-text-fit")!=="none",ye=new wo(null,0,I&&(k||!h.hasIconData()||E.get("icon-optional")),k&&(I||!h.hasTextData()||E.get("text-optional")),!0);!h.collisionArrays&&c&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(c);for(var ze=function(St,mt,lr){for(var Qt=0;Qt<mt/4;Qt++)St.opacityVertexArray.emplaceBack(lr)},Fe=function(St){var mt=h.symbolInstances.get(St),lr=mt.numHorizontalGlyphVertices,Qt=mt.numVerticalGlyphVertices,fr=mt.crossTileID,_r=d.opacities[fr];f[fr]?_r=A:_r||(d.opacities[fr]=_r=ye),f[fr]=!0;var Yr=mt.numIconVertices>0,$r=d.placedOrientations[mt.crossTileID],cn=$r===m.WritingMode.vertical,Zn=$r===m.WritingMode.horizontal||$r===m.WritingMode.horizontalOnly;if(lr>0||Qt>0){var ai=Na(_r.text);ze(h.text,lr,cn?Ma:ai),ze(h.text,Qt,Zn?Ma:ai);var pi=_r.text.isHidden();[mt.rightJustifiedTextSymbolIndex,mt.centerJustifiedTextSymbolIndex,mt.leftJustifiedTextSymbolIndex].forEach(function(Ji){Ji>=0&&(h.text.placedSymbolArray.get(Ji).hidden=pi||cn?1:0)}),mt.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(mt.verticalPlacedTextSymbolIndex).hidden=pi||Zn?1:0);var Ui=d.variableOffsets[mt.crossTileID];Ui&&d.markUsedJustification(h,Ui.anchor,mt,$r);var zi=d.placedOrientations[mt.crossTileID];zi&&(d.markUsedJustification(h,"left",mt,zi),d.markUsedOrientation(h,zi,mt))}if(Yr){var Bn=Na(_r.icon),Ei=!(ve&&mt.verticalPlacedIconSymbolIndex&&cn);mt.placedIconSymbolIndex>=0&&(ze(h.icon,mt.numIconVertices,Ei?Bn:Ma),h.icon.placedSymbolArray.get(mt.placedIconSymbolIndex).hidden=_r.icon.isHidden()),mt.verticalPlacedIconSymbolIndex>=0&&(ze(h.icon,mt.numVerticalIconVertices,Ei?Ma:Bn),h.icon.placedSymbolArray.get(mt.verticalPlacedIconSymbolIndex).hidden=_r.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var Oi=h.collisionArrays[St];if(Oi){var ei=new m.Point(0,0);if(Oi.textBox||Oi.verticalTextBox){var vi=!0;if(V){var fi=d.variableOffsets[fr];fi?(ei=uo(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textBoxScale),Y&&ei._rotate(ce?d.transform.angle:-d.transform.angle)):vi=!1}Oi.textBox&&go(h.textCollisionBox.collisionVertexArray,_r.text.placed,!vi||cn,ei.x,ei.y),Oi.verticalTextBox&&go(h.textCollisionBox.collisionVertexArray,_r.text.placed,!vi||Zn,ei.x,ei.y)}var Di=Boolean(!Zn&&Oi.verticalIconBox);Oi.iconBox&&go(h.iconCollisionBox.collisionVertexArray,_r.icon.placed,Di,ve?ei.x:0,ve?ei.y:0),Oi.verticalIconBox&&go(h.iconCollisionBox.collisionVertexArray,_r.icon.placed,!Di,ve?ei.x:0,ve?ei.y:0)}}},$e=0;$e<h.symbolInstances.length;$e++)Fe($e);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Ne=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Ne.invProjMatrix,h.placementViewportMatrix=Ne.viewportMatrix,h.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},Lo.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Lo.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},Lo.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},Lo.prototype.stillRecent=function(h,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>h},Lo.prototype.setStale=function(){this.stale=!0};var We=Math.pow(2,25),se=Math.pow(2,24),Be=Math.pow(2,17),Rt=Math.pow(2,16),Zr=Math.pow(2,9),kn=Math.pow(2,8),Ni=Math.pow(2,1);function Na(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var f=h.placed?1:0,c=Math.floor(127*h.opacity);return c*We+f*se+c*Be+f*Rt+c*Zr+f*kn+c*Ni+f}var Ma=0,Xa=function(f){this._sortAcrossTiles=f.layout.get("symbol-z-order")!=="viewport-y"&&f.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Xa.prototype.continuePlacement=function(h,f,c,d,E){for(var A=this._bucketParts;this._currentTileIndex<h.length;)if(f.getBucketParts(A,d,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(I,k){return I.sortKey-k.sortKey}));this._currentPartIndex<A.length;)if(f.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Do=function(f,c,d,E,A,I,k){this.placement=new Lo(f,A,I,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=E,this._done=!1};Do.prototype.isDone=function(){return this._done},Do.prototype.continuePlacement=function(h,f,c){for(var d=this,E=m.browser.now(),A=function(){var Y=m.browser.now()-E;return!d._forceFullPlacement&&Y>2};this._currentPlacementIndex>=0;){var I=f[h[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=k)&&(!I.maxzoom||I.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new Xa(I)),this._inProgressLayer.continuePlacement(c[I.source],this.placement,this._showCollisionBoxes,I,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Do.prototype.commit=function(h){return this.placement.commit(h),this.placement};var $c=512/m.EXTENT/2,Ks=function(f,c,d){this.tileID=f,this.indexedSymbolInstances={},this.bucketInstanceId=d;for(var E=0;E<c.length;E++){var A=c.get(E),I=A.key;this.indexedSymbolInstances[I]||(this.indexedSymbolInstances[I]=[]),this.indexedSymbolInstances[I].push({crossTileID:A.crossTileID,coord:this.getScaledCoordinates(A,f)})}};Ks.prototype.getScaledCoordinates=function(h,f){var c=$c/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+h.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+h.anchorY)*c)}},Ks.prototype.findMatches=function(h,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<h.length;E++){var A=h.get(E);if(!A.crossTileID){var I=this.indexedSymbolInstances[A.key];if(I)for(var k=this.getScaledCoordinates(A,f),V=0,Y=I;V<Y.length;V+=1){var ce=Y[V];if(Math.abs(ce.coord.x-k.x)<=d&&Math.abs(ce.coord.y-k.y)<=d&&!c[ce.crossTileID]){c[ce.crossTileID]=!0,A.crossTileID=ce.crossTileID;break}}}}};var Qo=function(){this.maxCrossTileID=0};Qo.prototype.generate=function(){return++this.maxCrossTileID};var Vo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Vo.prototype.handleWrapJump=function(h){var f=Math.round((h-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var A in d){var I=d[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+f),E[I.tileID.key]=I}this.indexes[c]=E}this.lng=h},Vo.prototype.addBucket=function(h,f,c){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var E=this.usedCrossTileIDs[h.overscaledZ];for(var A in this.indexes){var I=this.indexes[A];if(Number(A)>h.overscaledZ)for(var k in I){var V=I[k];V.tileID.isChildOf(h)&&V.findMatches(f.symbolInstances,h,E)}else{var Y=I[h.scaledTo(Number(A)).key];Y&&Y.findMatches(f.symbolInstances,h,E)}}for(var ce=0;ce<f.symbolInstances.length;ce++){var ve=f.symbolInstances.get(ce);ve.crossTileID||(ve.crossTileID=c.generate(),E[ve.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Ks(h,f.symbolInstances,f.bucketInstanceId),!0},Vo.prototype.removeBucketCrossTileIDs=function(h,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[h][E[d].crossTileID]},Vo.prototype.removeStaleBuckets=function(h){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)h[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var qs=function(){this.layerIndexes={},this.crossTileIDs=new Qo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};qs.prototype.addLayer=function(h,f,c){var d=this.layerIndexes[h.id];d===void 0&&(d=this.layerIndexes[h.id]=new Vo);var E=!1,A={};d.handleWrapJump(c);for(var I=0,k=f;I<k.length;I+=1){var V=k[I],Y=V.getBucket(h);Y&&h.id===Y.layerIds[0]&&(Y.bucketInstanceId||(Y.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(V.tileID,Y,this.crossTileIDs)&&(E=!0),A[Y.bucketInstanceId]=!0)}return d.removeStaleBuckets(A)&&(E=!0),E},qs.prototype.pruneUnusedLayers=function(h){var f={};for(var c in h.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var gu=function(f,c){return m.emitValidationErrors(f,c&&c.filter(function(d){return d.identifier!=="source.canvas"}))},Vs=m.pick(xn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),nl=m.pick(xn,["setCenter","setZoom","setBearing","setPitch"]),Qs=function(){var h={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(h[c]=d)}return h}(),Ga=function(h){function f(c,d){var E=this;d===void 0&&(d={}),h.call(this),this.map=c,this.dispatcher=new ir(rr(),this),this.imageManager=new Ve,this.imageManager.setEventedParent(this),this.glyphManager=new Pr(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Zt(256,512),this.crossTileSymbolIndex=new qs,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var A=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(I){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},function(k,V){if(m.triggerPluginCompletionEvent(k),V&&V.every(function(ce){return ce}))for(var Y in A.sourceCaches)A.sourceCaches[Y].reload()})}),this.on("data",function(I){if(I.dataType==="source"&&I.sourceDataType==="metadata"){var k=E.sourceCaches[I.sourceId];if(k){var V=k.getSource();if(V&&V.vectorLayerIds)for(var Y in E._layers){var ce=E._layers[Y];ce.source===V.id&&E._validateLayer(ce)}}}})}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var A=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var I=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(I,function(k,V){E._request=null,k?E.fire(new m.ErrorEvent(k)):V&&E._load(V,A)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(Qs,!1)},f.prototype._load=function(c,d){if(!d||!gu(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var A=mn(this.stylesheet.layers);this._order=A.map(function(Y){return Y.id}),this._layers={},this._serializedLayers={};for(var I=0,k=A;I<k.length;I+=1){var V=k[I];(V=m.createStyleLayer(V)).setEventedParent(this,{layer:{id:V.id}}),this._layers[V.id]=V,this._serializedLayers[V.id]=V.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Bt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,A,I){var k,V,Y,ce=m.browser.devicePixelRatio>1?"@2x":"",ve=m.getJSON(A.transformRequest(A.normalizeSpriteURL(E,ce,".json"),m.ResourceType.SpriteJSON),function(Fe,$e){ve=null,Y||(Y=Fe,k=$e,ze())}),ye=m.getImage(A.transformRequest(A.normalizeSpriteURL(E,ce,".png"),m.ResourceType.SpriteImage),function(Fe,$e){ye=null,Y||(Y=Fe,V=$e,ze())});function ze(){if(Y)I(Y);else if(k&&V){var Fe=m.browser.getImageData(V),$e={};for(var Ne in k){var Ze=k[Ne],St=Ze.width,mt=Ze.height,lr=Ze.x,Qt=Ze.y,fr=Ze.sdf,_r=Ze.pixelRatio,Yr=Ze.stretchX,$r=Ze.stretchY,cn=Ze.content,Zn=new m.RGBAImage({width:St,height:mt});m.RGBAImage.copy(Fe,Zn,{x:lr,y:Qt},{x:0,y:0},{width:St,height:mt}),$e[Ne]={data:Zn,pixelRatio:_r,sdf:fr,stretchX:Yr,stretchY:$r,content:cn}}I(null,$e)}}return{cancel:function(){ve&&(ve.cancel(),ve=null),ye&&(ye.cancel(),ye=null)}}}(c,this.map._requestManager,function(E,A){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(A)for(var I in A)d.imageManager.addImage(I,A[I]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var A=d.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+A.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,A=c;E<A.length;E+=1){var I=this._layers[A[E]];I.type!=="custom"&&d.push(I.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var I in(E.length||A.length)&&this._updateWorkerLayers(E,A),this._updatedSources){var k=this._updatedSources[I];k==="reload"?this._reloadSource(I):k==="clear"&&this._clearSource(I)}for(var V in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[V].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var Y={};for(var ce in this.sourceCaches){var ve=this.sourceCaches[ce];Y[ce]=ve.used,ve.used=!1}for(var ye=0,ze=this._order;ye<ze.length;ye+=1){var Fe=this._layers[ze[ye]];Fe.recalculate(c,this._availableImages),!Fe.isHidden(c.zoom)&&Fe.source&&(this.sourceCaches[Fe.source].used=!0)}for(var $e in Y){var Ne=this.sourceCaches[$e];Y[$e]!==Ne.used&&Ne.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:$e}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),gu(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=mn(c.layers);var E=function(I,k){if(!I)return[{command:xn.setStyle,args:[k]}];var V=[];try{if(!m.deepEqual(I.version,k.version))return[{command:xn.setStyle,args:[k]}];m.deepEqual(I.center,k.center)||V.push({command:xn.setCenter,args:[k.center]}),m.deepEqual(I.zoom,k.zoom)||V.push({command:xn.setZoom,args:[k.zoom]}),m.deepEqual(I.bearing,k.bearing)||V.push({command:xn.setBearing,args:[k.bearing]}),m.deepEqual(I.pitch,k.pitch)||V.push({command:xn.setPitch,args:[k.pitch]}),m.deepEqual(I.sprite,k.sprite)||V.push({command:xn.setSprite,args:[k.sprite]}),m.deepEqual(I.glyphs,k.glyphs)||V.push({command:xn.setGlyphs,args:[k.glyphs]}),m.deepEqual(I.transition,k.transition)||V.push({command:xn.setTransition,args:[k.transition]}),m.deepEqual(I.light,k.light)||V.push({command:xn.setLight,args:[k.light]});var Y={},ce=[];(function(ye,ze,Fe,$e){var Ne;for(Ne in ze=ze||{},ye=ye||{})ye.hasOwnProperty(Ne)&&(ze.hasOwnProperty(Ne)||An(Ne,Fe,$e));for(Ne in ze)ze.hasOwnProperty(Ne)&&(ye.hasOwnProperty(Ne)?m.deepEqual(ye[Ne],ze[Ne])||(ye[Ne].type==="geojson"&&ze[Ne].type==="geojson"&&Zi(ye,ze,Ne)?Fe.push({command:xn.setGeoJSONSourceData,args:[Ne,ze[Ne].data]}):Lr(Ne,ze,Fe,$e)):w(Ne,ze,Fe))})(I.sources,k.sources,ce,Y);var ve=[];I.layers&&I.layers.forEach(function(ye){Y[ye.source]?V.push({command:xn.removeLayer,args:[ye.id]}):ve.push(ye)}),V=V.concat(ce),function(ye,ze,Fe){ze=ze||[];var $e,Ne,Ze,St,mt,lr,Qt,fr=(ye=ye||[]).map(Un),_r=ze.map(Un),Yr=ye.reduce(Bi,{}),$r=ze.reduce(Bi,{}),cn=fr.slice(),Zn=Object.create(null);for($e=0,Ne=0;$e<fr.length;$e++)$r.hasOwnProperty(Ze=fr[$e])?Ne++:(Fe.push({command:xn.removeLayer,args:[Ze]}),cn.splice(cn.indexOf(Ze,Ne),1));for($e=0,Ne=0;$e<_r.length;$e++)cn[cn.length-1-$e]!==(Ze=_r[_r.length-1-$e])&&(Yr.hasOwnProperty(Ze)?(Fe.push({command:xn.removeLayer,args:[Ze]}),cn.splice(cn.lastIndexOf(Ze,cn.length-Ne),1)):Ne++,Fe.push({command:xn.addLayer,args:[$r[Ze],lr=cn[cn.length-$e]]}),cn.splice(cn.length-$e,0,Ze),Zn[Ze]=!0);for($e=0;$e<_r.length;$e++)if(St=Yr[Ze=_r[$e]],mt=$r[Ze],!Zn[Ze]&&!m.deepEqual(St,mt))if(m.deepEqual(St.source,mt.source)&&m.deepEqual(St["source-layer"],mt["source-layer"])&&m.deepEqual(St.type,mt.type)){for(Qt in Ti(St.layout,mt.layout,Fe,Ze,null,xn.setLayoutProperty),Ti(St.paint,mt.paint,Fe,Ze,null,xn.setPaintProperty),m.deepEqual(St.filter,mt.filter)||Fe.push({command:xn.setFilter,args:[Ze,mt.filter]}),m.deepEqual(St.minzoom,mt.minzoom)&&m.deepEqual(St.maxzoom,mt.maxzoom)||Fe.push({command:xn.setLayerZoomRange,args:[Ze,mt.minzoom,mt.maxzoom]}),St)St.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Ti(St[Qt],mt[Qt],Fe,Ze,Qt.slice(6),xn.setPaintProperty):m.deepEqual(St[Qt],mt[Qt])||Fe.push({command:xn.setLayerProperty,args:[Ze,Qt,mt[Qt]]}));for(Qt in mt)mt.hasOwnProperty(Qt)&&!St.hasOwnProperty(Qt)&&Qt!=="layout"&&Qt!=="paint"&&Qt!=="filter"&&Qt!=="metadata"&&Qt!=="minzoom"&&Qt!=="maxzoom"&&(Qt.indexOf("paint.")===0?Ti(St[Qt],mt[Qt],Fe,Ze,Qt.slice(6),xn.setPaintProperty):m.deepEqual(St[Qt],mt[Qt])||Fe.push({command:xn.setLayerProperty,args:[Ze,Qt,mt[Qt]]}))}else Fe.push({command:xn.removeLayer,args:[Ze]}),lr=cn[cn.lastIndexOf(Ze)+1],Fe.push({command:xn.addLayer,args:[mt,lr]})}(ve,k.layers,V)}catch(ye){console.warn("Unable to compute style diff:",ye),V=[{command:xn.setStyle,args:[k]}]}return V}(this.serialize(),c).filter(function(I){return!(I.command in nl)});if(E.length===0)return!1;var A=E.filter(function(I){return!(I.command in Vs)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(I){return I.command}).join(", ")+".");return E.forEach(function(I){I.command!=="setTransition"&&d[I.command].apply(d,I.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var A=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var I=this.sourceCaches[c]=new Ue(c,d,this.dispatcher);I.style=this,I.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:I.serialize(),sourceId:c}}),I.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=c.id;if(this.getLayer(A))this.fire(new m.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var I;if(c.type==="custom"){if(gu(this,m.validateCustomStyleLayer(c)))return;I=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(A,c.source),c=m.clone$1(c),c=m.extend(c,{source:A})),this._validate(m.validateStyle.layer,"layers."+A,c,{arrayIndex:-1},E))return;I=m.createStyleLayer(c),this._validateLayer(I),I.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[I.id]=I.serialize()}var k=d?this._order.indexOf(d):this._order.length;if(d&&k===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(k,0,A),this._layerOrderChanged=!0,this._layers[A]=I,this._removedLayers[A]&&I.source&&I.type!=="custom"){var V=this._removedLayers[A];delete this._removedLayers[A],V.type!==I.type?this._updatedSources[I.source]="clear":(this._updatedSources[I.source]="reload",this.sourceCaches[I.source].pause())}this._updateLayer(I),I.onAdd&&I.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var A=d?this._order.indexOf(d):this._order.length;d&&A===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(A,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var A=this.getLayer(c);A?A.minzoom===d&&A.maxzoom===E||(d!=null&&(A.minzoom=d),E!=null&&(A.maxzoom=E),this._updateLayer(A)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=this.getLayer(c);if(A){if(!m.deepEqual(A.filter,d))return d==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(m.validateStyle.filter,"layers."+A.id+".filter",d,null,E)||(A.filter=m.clone$1(d),this._updateLayer(A)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var I=this.getLayer(c);I?m.deepEqual(I.getLayoutProperty(d),E)||(I.setLayoutProperty(d,E,A),this._updateLayer(I)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var I=this.getLayer(c);I?m.deepEqual(I.getPaintProperty(d),E)||(I.setPaintProperty(d,E,A)&&this._updateLayer(I),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=c.sourceLayer,I=this.sourceCaches[E];if(I!==void 0){var k=I.getSource().type;k==="geojson"&&A?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||A?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),I.setFeatureState(A,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=this.sourceCaches[E];if(A!==void 0){var I=A.getSource().type,k=I==="vector"?c.sourceLayer:void 0;I!=="vector"||k?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(k,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,A=this.sourceCaches[d];if(A!==void 0){if(A.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function($r){return d._layers[$r].type==="fill-extrusion"},A={},I=[],k=this._order.length-1;k>=0;k--){var V=this._order[k];if(E(V)){A[V]=k;for(var Y=0,ce=c;Y<ce.length;Y+=1){var ve=ce[Y][V];if(ve)for(var ye=0,ze=ve;ye<ze.length;ye+=1)I.push(ze[ye])}}}I.sort(function(Yr,$r){return $r.intersectionZ-Yr.intersectionZ});for(var Fe=[],$e=this._order.length-1;$e>=0;$e--){var Ne=this._order[$e];if(E(Ne))for(var Ze=I.length-1;Ze>=0;Ze--){var St=I[Ze].feature;if(A[St.layer.id]<$e)break;Fe.push(St),I.pop()}else for(var mt=0,lr=c;mt<lr.length;mt+=1){var Qt=lr[mt][Ne];if(Qt)for(var fr=0,_r=Qt;fr<_r.length;fr+=1)Fe.push(_r[fr].feature)}}return Fe},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var A={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var I=0,k=d.layers;I<k.length;I+=1){var V=k[I],Y=this._layers[V];if(!Y)return this.fire(new m.ErrorEvent(new Error("The layer '"+V+"' does not exist in the map's style and cannot be queried for features."))),[];A[Y.source]=!0}}var ce=[];for(var ve in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!A[ve]||ce.push(Nt(this.sourceCaches[ve],this._layers,this._serializedLayers,c,d,E));return this.placement&&ce.push(function(ye,ze,Fe,$e,Ne,Ze,St){for(var mt={},lr=Ze.queryRenderedSymbols($e),Qt=[],fr=0,_r=Object.keys(lr).map(Number);fr<_r.length;fr+=1)Qt.push(St[_r[fr]]);Qt.sort(Tt);for(var Yr=function(){var Ui=cn[$r],zi=Ui.featureIndex.lookupSymbolFeatures(lr[Ui.bucketInstanceId],ze,Ui.bucketIndex,Ui.sourceLayerIndex,Ne.filter,Ne.layers,Ne.availableImages,ye);for(var Bn in zi){var Ei=mt[Bn]=mt[Bn]||[],Oi=zi[Bn];Oi.sort(function(fi,Di){var Ji=Ui.featureSortOrder;if(Ji){var yo=Ji.indexOf(fi.featureIndex);return Ji.indexOf(Di.featureIndex)-yo}return Di.featureIndex-fi.featureIndex});for(var ei=0,vi=Oi;ei<vi.length;ei+=1)Ei.push(vi[ei])}},$r=0,cn=Qt;$r<cn.length;$r+=1)Yr();var Zn=function(Ui){mt[Ui].forEach(function(zi){var Bn=zi.feature,Ei=Fe[ye[Ui].source].getFeatureState(Bn.layer["source-layer"],Bn.id);Bn.source=Bn.layer.source,Bn.layer["source-layer"]&&(Bn.sourceLayer=Bn.layer["source-layer"]),Bn.state=Ei})};for(var ai in mt)Zn(ai);return mt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(ce)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(A,I){for(var k=A.getRenderableIds().map(function(ze){return A.getTileByID(ze)}),V=[],Y={},ce=0;ce<k.length;ce++){var ve=k[ce],ye=ve.tileID.canonical.key;Y[ye]||(Y[ye]=!0,ve.querySourceFeatures(V,I))}return V}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),A=!1;for(var I in c)if(!m.deepEqual(c[I],E[I])){A=!0;break}if(A){var k={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(k)}},f.prototype._validate=function(c,d,E,A,I){return I===void 0&&(I={}),(!I||I.validate!==!1)&&gu(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},A)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,A,I){I===void 0&&(I=!1);for(var k=!1,V=!1,Y={},ce=0,ve=this._order;ce<ve.length;ce+=1){var ye=this._layers[ve[ce]];if(ye.type==="symbol"){if(!Y[ye.source]){var ze=this.sourceCaches[ye.source];Y[ye.source]=ze.getRenderableIds(!0).map(function(St){return ze.getTileByID(St)}).sort(function(St,mt){return mt.tileID.overscaledZ-St.tileID.overscaledZ||(St.tileID.isLessThan(mt.tileID)?-1:1)})}var Fe=this.crossTileSymbolIndex.addLayer(ye,Y[ye.source],c.center.lng);k=k||Fe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((I=I||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Do(c,this._order,I,d,E,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,Y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),V=!0),k&&this.pauseablePlacement.placement.setStale()),V||k)for(var $e=0,Ne=this._order;$e<Ne.length;$e+=1){var Ze=this._layers[Ne[$e]];Ze.type==="symbol"&&this.placement.updateLayerOpacities(Ze,Y[Ze.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var A=this.sourceCaches[d.source];A&&A.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);Ga.getSourceType=function(h){return sr[h]},Ga.setSourceType=function(h,f){sr[h]=f},Ga.registerForPluginStateChange=m.registerForPluginStateChange;var Ya=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),El=fa(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),yu=fa(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),kh=fa(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Kc=fa(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),ec=fa("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),_u=fa(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),bc=fa(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),_=fa("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),P=fa("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),z=fa("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),L=fa(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),te=fa(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Ce=fa(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),rt=fa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Ct=fa(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ft=fa(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Sr=fa(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),kr=fa(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ni=fa(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),xi=fa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),gi=fa(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),dt=fa(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ua=fa(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),yt=fa(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fu=fa(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ha=fa(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function fa(h,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),I=A?A.concat(E):E,k={};return{fragmentSource:h=h.replace(c,function(V,Y,ce,ve,ye){return k[ye]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
varying `+ce+" "+ve+" "+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),vertexSource:f=f.replace(c,function(V,Y,ce,ve,ye){var ze=ve==="float"?"vec2":"vec4",Fe=ye.match(/color/)?"color":ze;return k[ye]?Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+ce+" "+ze+" a_"+ye+`;
varying `+ce+" "+ve+" "+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = a_"+ye+`;
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ye+" = unpack_mix_"+Fe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_`+ye+`
uniform lowp float u_`+ye+`_t;
attribute `+ce+" "+ze+" a_"+ye+`;
#else
uniform `+ce+" "+ve+" u_"+ye+`;
#endif
`:Fe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = a_"+ye+`;
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ye+`
    `+ce+" "+ve+" "+ye+" = unpack_mix_"+Fe+"(a_"+ye+", u_"+ye+`_t);
#else
    `+ce+" "+ve+" "+ye+" = u_"+ye+`;
#endif
`}),staticAttributes:d,staticUniforms:I}}var Sl=Object.freeze({__proto__:null,prelude:El,background:yu,backgroundPattern:kh,circle:Kc,clippingMask:ec,heatmap:_u,heatmapTexture:bc,collisionBox:_,collisionCircle:P,debug:z,fill:L,fillOutline:te,fillOutlinePattern:Ce,fillPattern:rt,fillExtrusion:Ct,fillExtrusionPattern:ft,hillshadePrepare:Sr,hillshade:kr,line:ni,lineGradient:xi,linePattern:gi,lineSDF:dt,raster:ua,symbolIcon:yt,symbolSDF:fu,symbolTextAndIcon:Ha}),Ec=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function bn(h){for(var f=[],c=0;c<h.length;c++)if(h[c]!==null){var d=h[c].split(" ");f.push(d.pop())}return f}Ec.prototype.bind=function(h,f,c,d,E,A,I,k){this.context=h;for(var V=this.boundPaintVertexBuffers.length!==d.length,Y=0;!V&&Y<d.length;Y++)this.boundPaintVertexBuffers[Y]!==d[Y]&&(V=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!V&&this.boundIndexBuffer===E&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===k?(h.bindVertexArrayOES.set(this.vao),I&&I.bind(),E&&E.dynamicDraw&&E.bind(),k&&k.bind()):this.freshBind(f,c,d,E,A,I,k)},Ec.prototype.freshBind=function(h,f,c,d,E,A,I){var k,V=h.numAttributes,Y=this.context,ce=Y.gl;if(Y.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Y.extVertexArrayObject.createVertexArrayOES(),Y.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=h,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=I;else{k=Y.currentNumAttributes||0;for(var ve=V;ve<k;ve++)ce.disableVertexAttribArray(ve)}f.enableAttributes(ce,h);for(var ye=0,ze=c;ye<ze.length;ye+=1)ze[ye].enableAttributes(ce,h);A&&A.enableAttributes(ce,h),I&&I.enableAttributes(ce,h),f.bind(),f.setVertexAttribPointers(ce,h,E);for(var Fe=0,$e=c;Fe<$e.length;Fe+=1){var Ne=$e[Fe];Ne.bind(),Ne.setVertexAttribPointers(ce,h,E)}A&&(A.bind(),A.setVertexAttribPointers(ce,h,E)),d&&d.bind(),I&&(I.bind(),I.setVertexAttribPointers(ce,h,E)),Y.currentNumAttributes=V},Ec.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var qc=function(f,c,d,E,A,I){var k=f.gl;this.program=k.createProgram();for(var V=bn(d.staticAttributes),Y=E?E.getBinderAttributes():[],ce=V.concat(Y),ve=d.staticUniforms?bn(d.staticUniforms):[],ye=E?E.getBinderUniforms():[],ze=[],Fe=0,$e=ve.concat(ye);Fe<$e.length;Fe+=1){var Ne=$e[Fe];ze.indexOf(Ne)<0&&ze.push(Ne)}var Ze=E?E.defines():[];I&&Ze.push("#define OVERDRAW_INSPECTOR;");var St=Ze.concat(El.fragmentSource,d.fragmentSource).join(`
`),mt=Ze.concat(El.vertexSource,d.vertexSource).join(`
`),lr=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(lr,St),k.compileShader(lr),k.attachShader(this.program,lr);var Qt=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(Qt,mt),k.compileShader(Qt),k.attachShader(this.program,Qt),this.attributes={};var fr={};this.numAttributes=ce.length;for(var _r=0;_r<this.numAttributes;_r++)ce[_r]&&(k.bindAttribLocation(this.program,_r,ce[_r]),this.attributes[ce[_r]]=_r);k.linkProgram(this.program),k.deleteShader(Qt),k.deleteShader(lr);for(var Yr=0;Yr<ze.length;Yr++){var $r=ze[Yr];if($r&&!fr[$r]){var cn=k.getUniformLocation(this.program,$r);cn&&(fr[$r]=cn)}}this.fixedUniforms=A(f,fr),this.binderUniforms=E?E.getUniforms(f,fr):[]}}};function In(h,f,c){var d=1/wa(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),A=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,I=A*(c.tileID.canonical.x+c.tileID.wrap*E),k=A*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[I>>16,k>>16],u_pixel_coord_lower:[65535&I,65535&k]}}qc.prototype.draw=function(h,f,c,d,E,A,I,k,V,Y,ce,ve,ye,ze,Fe,$e){var Ne,Ze=h.gl;if(!this.failedToCreate){for(var St in h.program.set(this.program),h.setDepthMode(c),h.setStencilMode(d),h.setColorMode(E),h.setCullFace(A),this.fixedUniforms)this.fixedUniforms[St].set(I[St]);ze&&ze.setUniforms(h,this.binderUniforms,ve,{zoom:ye});for(var mt=(Ne={},Ne[Ze.LINES]=2,Ne[Ze.TRIANGLES]=3,Ne[Ze.LINE_STRIP]=1,Ne)[f],lr=0,Qt=ce.get();lr<Qt.length;lr+=1){var fr=Qt[lr],_r=fr.vaos||(fr.vaos={});(_r[k]||(_r[k]=new Ec)).bind(h,this,V,ze?ze.getPaintVertexBuffers():[],Y,fr.vertexOffset,Fe,$e),Ze.drawElements(f,fr.primitiveLength*mt,Ze.UNSIGNED_SHORT,fr.primitiveOffset*mt*2)}}};var Rf=function(f,c,d,E){var A=c.style.light,I=A.properties.get("position"),k=[I.x,I.y,I.z],V=m.create$1();A.properties.get("anchor")==="viewport"&&m.fromRotation(V,-c.transform.angle),m.transformMat3(k,k,V);var Y=A.properties.get("color");return{u_matrix:f,u_lightpos:k,u_lightintensity:A.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_vertical_gradient:+d,u_opacity:E}},Lt=function(f,c,d,E,A,I,k){return m.extend(Rf(f,c,d,E),In(I,c,k),{u_height_factor:-Math.pow(2,A.overscaledZ)/k.tileSize/8})},Ca=function(f){return{u_matrix:f}},zl=function(f,c,d,E){return m.extend(Ca(f),In(d,c,E))},ue=function(f,c){return{u_matrix:f,u_world:c}},Du=function(f,c,d,E,A){return m.extend(zl(f,c,d,E),{u_world:A})},Qc=function(f,c,d,E){var A,I,k=f.transform;if(E.paint.get("circle-pitch-alignment")==="map"){var V=wa(d,1,k.zoom);A=!0,I=[V,V]}else A=!1,I=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(E.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(c.posMatrix,d,E.paint.get("circle-translate"),E.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:I}},Fu=function(f,c,d){var E=wa(d,1,c.zoom),A=Math.pow(2,c.zoom-d.tileID.overscaledZ),I=d.tileID.overscaleFactor();return{u_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_pixels_to_tile_units:E,u_extrude_scale:[c.pixelsToGLUnits[0]/(E*A),c.pixelsToGLUnits[1]/(E*A)],u_overscale_factor:I}},xu=function(f,c,d){return{u_matrix:f,u_inv_matrix:c,u_camera_to_center_distance:d.cameraToCenterDistance,u_viewport_size:[d.width,d.height]}},Bu=function(f,c,d){return d===void 0&&(d=1),{u_matrix:f,u_color:c,u_overlay:0,u_overlay_scale:d}},il=function(f){return{u_matrix:f}},Sc=function(f,c,d,E){return{u_matrix:f,u_extrude_scale:wa(c,1,d),u_intensity:E}},Cl=function(f,c,d){var E=f.transform;return{u_matrix:kf(f,c,d),u_ratio:1/wa(c,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},ka=function(f,c,d,E){return m.extend(Cl(f,c,d),{u_image:0,u_image_height:E})},Cc=function(f,c,d,E){var A=f.transform,I=wc(c,A);return{u_matrix:kf(f,c,d),u_texsize:c.imageAtlasTexture.size,u_ratio:1/wa(c,1,A.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[I,E.fromScale,E.toScale],u_fade:E.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},sh=function(f,c,d,E,A){var I=f.lineAtlas,k=wc(c,f.transform),V=d.layout.get("line-cap")==="round",Y=I.getDash(E.from,V),ce=I.getDash(E.to,V),ve=Y.width*A.fromScale,ye=ce.width*A.toScale;return m.extend(Cl(f,c,d),{u_patternscale_a:[k/ve,-Y.height/2],u_patternscale_b:[k/ye,-ce.height/2],u_sdfgamma:I.width/(256*Math.min(ve,ye)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:ce.y,u_mix:A.t})};function wc(h,f){return 1/wa(h,1,f.tileZoom)}function kf(h,f,c){return h.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var uh=function(f,c,d,E,A){return{u_matrix:f,u_tl_parent:c,u_scale_parent:d,u_buffer_scale:1,u_fade_t:E.mix,u_opacity:E.opacity*A.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:A.paint.get("raster-brightness-min"),u_brightness_high:A.paint.get("raster-brightness-max"),u_saturation_factor:(k=A.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(I=A.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:Lf(A.paint.get("raster-hue-rotate"))};var I,k};function Lf(h){h*=Math.PI/180;var f=Math.sin(h),c=Math.cos(h);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Ul,bu=function(f,c,d,E,A,I,k,V,Y,ce){var ve=A.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:ve.cameraToCenterDistance,u_pitch:ve.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:ve.width/ve.height,u_fade_change:A.options.fadeDuration?A.symbolFadeChange:1,u_matrix:I,u_label_plane_matrix:k,u_coord_matrix:V,u_is_text:+Y,u_pitch_with_map:+E,u_texsize:ce,u_texture:0}},jl=function(f,c,d,E,A,I,k,V,Y,ce,ve){var ye=A.transform;return m.extend(bu(f,c,d,E,A,I,k,V,Y,ce),{u_gamma_scale:E?Math.cos(ye._pitch)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+ve})},tc=function(f,c,d,E,A,I,k,V,Y,ce){return m.extend(jl(f,c,d,E,A,I,k,V,!0,Y,!0),{u_texsize_icon:ce,u_texture_icon:1})},Js=function(f,c,d){return{u_matrix:f,u_opacity:c,u_color:d}},Nu=function(f,c,d,E,A,I){return m.extend(function(k,V,Y,ce){var ve=Y.imageManager.getPattern(k.from.toString()),ye=Y.imageManager.getPattern(k.to.toString()),ze=Y.imageManager.getPixelSize(),Fe=ze.width,$e=ze.height,Ne=Math.pow(2,ce.tileID.overscaledZ),Ze=ce.tileSize*Math.pow(2,Y.transform.tileZoom)/Ne,St=Ze*(ce.tileID.canonical.x+ce.tileID.wrap*Ne),mt=Ze*ce.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ve.tl,u_pattern_br_a:ve.br,u_pattern_tl_b:ye.tl,u_pattern_br_b:ye.br,u_texsize:[Fe,$e],u_mix:V.t,u_pattern_size_a:ve.displaySize,u_pattern_size_b:ye.displaySize,u_scale_a:V.fromScale,u_scale_b:V.toScale,u_tile_units_to_pixels:1/wa(ce,1,Y.transform.tileZoom),u_pixel_coord_upper:[St>>16,mt>>16],u_pixel_coord_lower:[65535&St,65535&mt]}}(E,I,d,A),{u_matrix:f,u_opacity:c})},rc={fillExtrusion:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_lightpos:new m.Uniform3f(f,c.u_lightpos),u_lightintensity:new m.Uniform1f(f,c.u_lightintensity),u_lightcolor:new m.Uniform3f(f,c.u_lightcolor),u_vertical_gradient:new m.Uniform1f(f,c.u_vertical_gradient),u_opacity:new m.Uniform1f(f,c.u_opacity)}},fillExtrusionPattern:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_lightpos:new m.Uniform3f(f,c.u_lightpos),u_lightintensity:new m.Uniform1f(f,c.u_lightintensity),u_lightcolor:new m.Uniform3f(f,c.u_lightcolor),u_vertical_gradient:new m.Uniform1f(f,c.u_vertical_gradient),u_height_factor:new m.Uniform1f(f,c.u_height_factor),u_image:new m.Uniform1i(f,c.u_image),u_texsize:new m.Uniform2f(f,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(f,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(f,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(f,c.u_scale),u_fade:new m.Uniform1f(f,c.u_fade),u_opacity:new m.Uniform1f(f,c.u_opacity)}},fill:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix)}},fillPattern:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_image:new m.Uniform1i(f,c.u_image),u_texsize:new m.Uniform2f(f,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(f,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(f,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(f,c.u_scale),u_fade:new m.Uniform1f(f,c.u_fade)}},fillOutline:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_world:new m.Uniform2f(f,c.u_world)}},fillOutlinePattern:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_world:new m.Uniform2f(f,c.u_world),u_image:new m.Uniform1i(f,c.u_image),u_texsize:new m.Uniform2f(f,c.u_texsize),u_pixel_coord_upper:new m.Uniform2f(f,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(f,c.u_pixel_coord_lower),u_scale:new m.Uniform3f(f,c.u_scale),u_fade:new m.Uniform1f(f,c.u_fade)}},circle:function(f,c){return{u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(f,c.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(f,c.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(f,c.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(f,c.u_matrix)}},collisionBox:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(f,c.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(f,c.u_extrude_scale),u_overscale_factor:new m.Uniform1f(f,c.u_overscale_factor)}},collisionCircle:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_inv_matrix:new m.UniformMatrix4f(f,c.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(f,c.u_viewport_size)}},debug:function(f,c){return{u_color:new m.UniformColor(f,c.u_color),u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_overlay:new m.Uniform1i(f,c.u_overlay),u_overlay_scale:new m.Uniform1f(f,c.u_overlay_scale)}},clippingMask:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix)}},heatmap:function(f,c){return{u_extrude_scale:new m.Uniform1f(f,c.u_extrude_scale),u_intensity:new m.Uniform1f(f,c.u_intensity),u_matrix:new m.UniformMatrix4f(f,c.u_matrix)}},heatmapTexture:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_world:new m.Uniform2f(f,c.u_world),u_image:new m.Uniform1i(f,c.u_image),u_color_ramp:new m.Uniform1i(f,c.u_color_ramp),u_opacity:new m.Uniform1f(f,c.u_opacity)}},hillshade:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_image:new m.Uniform1i(f,c.u_image),u_latrange:new m.Uniform2f(f,c.u_latrange),u_light:new m.Uniform2f(f,c.u_light),u_shadow:new m.UniformColor(f,c.u_shadow),u_highlight:new m.UniformColor(f,c.u_highlight),u_accent:new m.UniformColor(f,c.u_accent)}},hillshadePrepare:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_image:new m.Uniform1i(f,c.u_image),u_dimension:new m.Uniform2f(f,c.u_dimension),u_zoom:new m.Uniform1f(f,c.u_zoom),u_unpack:new m.Uniform4f(f,c.u_unpack)}},line:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_ratio:new m.Uniform1f(f,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(f,c.u_units_to_pixels)}},lineGradient:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_ratio:new m.Uniform1f(f,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(f,c.u_units_to_pixels),u_image:new m.Uniform1i(f,c.u_image),u_image_height:new m.Uniform1f(f,c.u_image_height)}},linePattern:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_texsize:new m.Uniform2f(f,c.u_texsize),u_ratio:new m.Uniform1f(f,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_image:new m.Uniform1i(f,c.u_image),u_units_to_pixels:new m.Uniform2f(f,c.u_units_to_pixels),u_scale:new m.Uniform3f(f,c.u_scale),u_fade:new m.Uniform1f(f,c.u_fade)}},lineSDF:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_ratio:new m.Uniform1f(f,c.u_ratio),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(f,c.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(f,c.u_patternscale_a),u_patternscale_b:new m.Uniform2f(f,c.u_patternscale_b),u_sdfgamma:new m.Uniform1f(f,c.u_sdfgamma),u_image:new m.Uniform1i(f,c.u_image),u_tex_y_a:new m.Uniform1f(f,c.u_tex_y_a),u_tex_y_b:new m.Uniform1f(f,c.u_tex_y_b),u_mix:new m.Uniform1f(f,c.u_mix)}},raster:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_tl_parent:new m.Uniform2f(f,c.u_tl_parent),u_scale_parent:new m.Uniform1f(f,c.u_scale_parent),u_buffer_scale:new m.Uniform1f(f,c.u_buffer_scale),u_fade_t:new m.Uniform1f(f,c.u_fade_t),u_opacity:new m.Uniform1f(f,c.u_opacity),u_image0:new m.Uniform1i(f,c.u_image0),u_image1:new m.Uniform1i(f,c.u_image1),u_brightness_low:new m.Uniform1f(f,c.u_brightness_low),u_brightness_high:new m.Uniform1f(f,c.u_brightness_high),u_saturation_factor:new m.Uniform1f(f,c.u_saturation_factor),u_contrast_factor:new m.Uniform1f(f,c.u_contrast_factor),u_spin_weights:new m.Uniform3f(f,c.u_spin_weights)}},symbolIcon:function(f,c){return{u_is_size_zoom_constant:new m.Uniform1i(f,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(f,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(f,c.u_size_t),u_size:new m.Uniform1f(f,c.u_size),u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(f,c.u_pitch),u_rotate_symbol:new m.Uniform1i(f,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(f,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(f,c.u_fade_change),u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(f,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(f,c.u_coord_matrix),u_is_text:new m.Uniform1i(f,c.u_is_text),u_pitch_with_map:new m.Uniform1i(f,c.u_pitch_with_map),u_texsize:new m.Uniform2f(f,c.u_texsize),u_texture:new m.Uniform1i(f,c.u_texture)}},symbolSDF:function(f,c){return{u_is_size_zoom_constant:new m.Uniform1i(f,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(f,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(f,c.u_size_t),u_size:new m.Uniform1f(f,c.u_size),u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(f,c.u_pitch),u_rotate_symbol:new m.Uniform1i(f,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(f,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(f,c.u_fade_change),u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(f,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(f,c.u_coord_matrix),u_is_text:new m.Uniform1i(f,c.u_is_text),u_pitch_with_map:new m.Uniform1i(f,c.u_pitch_with_map),u_texsize:new m.Uniform2f(f,c.u_texsize),u_texture:new m.Uniform1i(f,c.u_texture),u_gamma_scale:new m.Uniform1f(f,c.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(f,c.u_is_halo)}},symbolTextAndIcon:function(f,c){return{u_is_size_zoom_constant:new m.Uniform1i(f,c.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(f,c.u_is_size_feature_constant),u_size_t:new m.Uniform1f(f,c.u_size_t),u_size:new m.Uniform1f(f,c.u_size),u_camera_to_center_distance:new m.Uniform1f(f,c.u_camera_to_center_distance),u_pitch:new m.Uniform1f(f,c.u_pitch),u_rotate_symbol:new m.Uniform1i(f,c.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(f,c.u_aspect_ratio),u_fade_change:new m.Uniform1f(f,c.u_fade_change),u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(f,c.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(f,c.u_coord_matrix),u_is_text:new m.Uniform1i(f,c.u_is_text),u_pitch_with_map:new m.Uniform1i(f,c.u_pitch_with_map),u_texsize:new m.Uniform2f(f,c.u_texsize),u_texsize_icon:new m.Uniform2f(f,c.u_texsize_icon),u_texture:new m.Uniform1i(f,c.u_texture),u_texture_icon:new m.Uniform1i(f,c.u_texture_icon),u_gamma_scale:new m.Uniform1f(f,c.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(f,c.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(f,c.u_is_halo)}},background:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_opacity:new m.Uniform1f(f,c.u_opacity),u_color:new m.UniformColor(f,c.u_color)}},backgroundPattern:function(f,c){return{u_matrix:new m.UniformMatrix4f(f,c.u_matrix),u_opacity:new m.Uniform1f(f,c.u_opacity),u_image:new m.Uniform1i(f,c.u_image),u_pattern_tl_a:new m.Uniform2f(f,c.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(f,c.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(f,c.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(f,c.u_pattern_br_b),u_texsize:new m.Uniform2f(f,c.u_texsize),u_mix:new m.Uniform1f(f,c.u_mix),u_pattern_size_a:new m.Uniform2f(f,c.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(f,c.u_pattern_size_b),u_scale_a:new m.Uniform1f(f,c.u_scale_a),u_scale_b:new m.Uniform1f(f,c.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(f,c.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(f,c.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(f,c.u_tile_units_to_pixels)}}};function wl(h,f,c,d,E,A,I){for(var k=h.context,V=k.gl,Y=h.useProgram("collisionBox"),ce=[],ve=0,ye=0,ze=0;ze<d.length;ze++){var Fe=d[ze],$e=f.getTile(Fe),Ne=$e.getBucket(c);if(Ne){var Ze=Fe.posMatrix;E[0]===0&&E[1]===0||(Ze=h.translatePosMatrix(Fe.posMatrix,$e,E,A));var St=I?Ne.textCollisionBox:Ne.iconCollisionBox,mt=Ne.collisionCircleArray;if(mt.length>0){var lr=m.create(),Qt=Ze;m.mul(lr,Ne.placementInvProjMatrix,h.transform.glCoordMatrix),m.mul(lr,lr,Ne.placementViewportMatrix),ce.push({circleArray:mt,circleOffset:ye,transform:Qt,invTransform:lr}),ye=ve+=mt.length/4}St&&Y.draw(k,V.LINES,ge.disabled,ke.disabled,h.colorModeForRenderPass(),pt.disabled,Fu(Ze,h.transform,$e),c.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,h.transform.zoom,null,null,St.collisionVertexBuffer)}}if(I&&ce.length){var fr=h.useProgram("collisionCircle"),_r=new m.StructArrayLayout2f1f2i16;_r.resize(4*ve),_r._trim();for(var Yr=0,$r=0,cn=ce;$r<cn.length;$r+=1)for(var Zn=cn[$r],ai=0;ai<Zn.circleArray.length/4;ai++){var pi=4*ai,Ui=Zn.circleArray[pi+0],zi=Zn.circleArray[pi+1],Bn=Zn.circleArray[pi+2],Ei=Zn.circleArray[pi+3];_r.emplace(Yr++,Ui,zi,Bn,Ei,0),_r.emplace(Yr++,Ui,zi,Bn,Ei,1),_r.emplace(Yr++,Ui,zi,Bn,Ei,2),_r.emplace(Yr++,Ui,zi,Bn,Ei,3)}(!Ul||Ul.length<2*ve)&&(Ul=function(yo){var co=2*yo,Bo=new m.StructArrayLayout3ui6;Bo.resize(co),Bo._trim();for(var $a=0;$a<co;$a++){var fo=6*$a;Bo.uint16[fo+0]=4*$a+0,Bo.uint16[fo+1]=4*$a+1,Bo.uint16[fo+2]=4*$a+2,Bo.uint16[fo+3]=4*$a+2,Bo.uint16[fo+4]=4*$a+3,Bo.uint16[fo+5]=4*$a+0}return Bo}(ve));for(var Oi=k.createIndexBuffer(Ul,!0),ei=k.createVertexBuffer(_r,m.collisionCircleLayout.members,!0),vi=0,fi=ce;vi<fi.length;vi+=1){var Di=fi[vi],Ji=xu(Di.transform,Di.invTransform,h.transform);fr.draw(k,V.TRIANGLES,ge.disabled,ke.disabled,h.colorModeForRenderPass(),pt.disabled,Ji,c.id,ei,Oi,m.SegmentVector.simpleSegment(0,2*Di.circleOffset,Di.circleArray.length,Di.circleArray.length/2),null,h.transform.zoom,null,null,null)}ei.destroy(),Oi.destroy()}}var Ts=m.identity(new Float32Array(16));function Jc(h,f,c,d,E,A){var I=m.getAnchorAlignment(h),k=-(I.horizontalAlign-.5)*f,V=-(I.verticalAlign-.5)*c,Y=m.evaluateVariableOffset(h,d);return new m.Point((k/E+Y[0])*A,(V/E+Y[1])*A)}function ef(h,f,c,d,E,A,I,k,V,Y,ce){var ve=h.text.placedSymbolArray,ye=h.text.dynamicLayoutVertexArray,ze=h.icon.dynamicLayoutVertexArray,Fe={};ye.clear();for(var $e=0;$e<ve.length;$e++){var Ne=ve.get($e),Ze=Ne.hidden||!Ne.crossTileID||h.allowVerticalPlacement&&!Ne.placedOrientation?null:d[Ne.crossTileID];if(Ze){var St=new m.Point(Ne.anchorX,Ne.anchorY),mt=ci(St,c?k:I),lr=bi(A.cameraToCenterDistance,mt.signedDistanceFromCamera),Qt=E.evaluateSizeForFeature(h.textSizeData,Y,Ne)*lr/m.ONE_EM;c&&(Qt*=h.tilePixelRatio/V);for(var fr=Jc(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textBoxScale,Qt),_r=c?ci(St.add(fr),I).point:mt.point.add(f?fr.rotate(-A.angle):fr),Yr=h.allowVerticalPlacement&&Ne.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,$r=0;$r<Ne.numGlyphs;$r++)m.addDynamicAttributes(ye,_r,Yr);ce&&Ne.associatedIconIndex>=0&&(Fe[Ne.associatedIconIndex]={shiftedAnchor:_r,angle:Yr})}else ga(Ne.numGlyphs,ye)}if(ce){ze.clear();for(var cn=h.icon.placedSymbolArray,Zn=0;Zn<cn.length;Zn++){var ai=cn.get(Zn);if(ai.hidden)ga(ai.numGlyphs,ze);else{var pi=Fe[Zn];if(pi)for(var Ui=0;Ui<ai.numGlyphs;Ui++)m.addDynamicAttributes(ze,pi.shiftedAnchor,pi.angle);else ga(ai.numGlyphs,ze)}}h.icon.dynamicLayoutVertexBuffer.updateData(ze)}h.text.dynamicLayoutVertexBuffer.updateData(ye)}function tf(h,f,c){return c.iconsInText&&f?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Vl(h,f,c,d,E,A,I,k,V,Y,ce,ve){for(var ye=h.context,ze=ye.gl,Fe=h.transform,$e=k==="map",Ne=V==="map",Ze=$e&&c.layout.get("symbol-placement")!=="point",St=$e&&!Ne&&!Ze,mt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,lr=!1,Qt=h.depthModeForSublayer(0,ge.ReadOnly),fr=c.layout.get("text-variable-anchor"),_r=[],Yr=0,$r=d;Yr<$r.length;Yr+=1){var cn=$r[Yr],Zn=f.getTile(cn),ai=Zn.getBucket(c);if(ai){var pi=E?ai.text:ai.icon;if(pi&&pi.segments.get().length){var Ui=pi.programConfigurations.get(c.id),zi=E||ai.sdfIcons,Bn=E?ai.textSizeData:ai.iconSizeData,Ei=Ne||Fe.pitch!==0,Oi=h.useProgram(tf(zi,E,ai),Ui),ei=m.evaluateSizeForZoom(Bn,Fe.zoom),vi=void 0,fi=[0,0],Di=void 0,Ji=void 0,yo=null,co=void 0;if(E)Di=Zn.glyphAtlasTexture,Ji=ze.LINEAR,vi=Zn.glyphAtlasTexture.size,ai.iconsInText&&(fi=Zn.imageAtlasTexture.size,yo=Zn.imageAtlasTexture,co=Ei||h.options.rotating||h.options.zooming||Bn.kind==="composite"||Bn.kind==="camera"?ze.LINEAR:ze.NEAREST);else{var Bo=c.layout.get("icon-size").constantOr(0)!==1||ai.iconsNeedLinear;Di=Zn.imageAtlasTexture,Ji=zi||h.options.rotating||h.options.zooming||Bo||Ei?ze.LINEAR:ze.NEAREST,vi=Zn.imageAtlasTexture.size}var $a=wa(Zn,1,h.transform.zoom),fo=to(cn.posMatrix,Ne,$e,h.transform,$a),Rs=ca(cn.posMatrix,Ne,$e,h.transform,$a),fs=fr&&ai.hasTextData(),Ol=c.layout.get("icon-text-fit")!=="none"&&fs&&ai.hasIconData();Ze&&mo(ai,cn.posMatrix,h,E,fo,Rs,Ne,Y);var Il=h.translatePosMatrix(cn.posMatrix,Zn,A,I),Es=Ze||E&&fr||Ol?Ts:fo,ts=h.translatePosMatrix(Rs,Zn,A,I,!0),lc=zi&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,cc={program:Oi,buffers:pi,uniformValues:zi?ai.iconsInText?tc(Bn.kind,ei,St,Ne,h,Il,Es,ts,vi,fi):jl(Bn.kind,ei,St,Ne,h,Il,Es,ts,E,vi,!0):bu(Bn.kind,ei,St,Ne,h,Il,Es,ts,E,vi),atlasTexture:Di,atlasTextureIcon:yo,atlasInterpolation:Ji,atlasInterpolationIcon:co,isSDF:zi,hasHalo:lc};if(mt&&ai.canOverlap){lr=!0;for(var Zu=0,Tu=pi.segments.get();Zu<Tu.length;Zu+=1){var Mu=Tu[Zu];_r.push({segments:new m.SegmentVector([Mu]),sortKey:Mu.sortKey,state:cc})}}else _r.push({segments:pi.segments,sortKey:0,state:cc})}}}lr&&_r.sort(function(_f,Rl){return _f.sortKey-Rl.sortKey});for(var iu=0,Xu=_r;iu<Xu.length;iu+=1){var Gs=Xu[iu],La=Gs.state;if(ye.activeTexture.set(ze.TEXTURE0),La.atlasTexture.bind(La.atlasInterpolation,ze.CLAMP_TO_EDGE),La.atlasTextureIcon&&(ye.activeTexture.set(ze.TEXTURE1),La.atlasTextureIcon&&La.atlasTextureIcon.bind(La.atlasInterpolationIcon,ze.CLAMP_TO_EDGE)),La.isSDF){var Yu=La.uniformValues;La.hasHalo&&(Yu.u_is_halo=1,Al(La.buffers,Gs.segments,c,h,La.program,Qt,ce,ve,Yu)),Yu.u_is_halo=0}Al(La.buffers,Gs.segments,c,h,La.program,Qt,ce,ve,La.uniformValues)}}function Al(h,f,c,d,E,A,I,k,V){var Y=d.context;E.draw(Y,Y.gl.TRIANGLES,A,I,k,pt.disabled,V,c.id,h.layoutVertexBuffer,h.indexBuffer,f,c.paint,d.transform.zoom,h.programConfigurations.get(c.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function rf(h,f,c,d,E,A,I){var k,V,Y,ce,ve,ye=h.context.gl,ze=c.paint.get("fill-pattern"),Fe=ze&&ze.constantOr(1),$e=c.getCrossfadeParameters();I?(V=Fe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=ye.LINES):(V=Fe?"fillPattern":"fill",k=ye.TRIANGLES);for(var Ne=0,Ze=d;Ne<Ze.length;Ne+=1){var St=Ze[Ne],mt=f.getTile(St);if(!Fe||mt.patternsLoaded()){var lr=mt.getBucket(c);if(lr){var Qt=lr.programConfigurations.get(c.id),fr=h.useProgram(V,Qt);Fe&&(h.context.activeTexture.set(ye.TEXTURE0),mt.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Qt.updatePaintBuffers($e));var _r=ze.constantOr(null);if(_r&&mt.imageAtlas){var Yr=mt.imageAtlas,$r=Yr.patternPositions[_r.to.toString()],cn=Yr.patternPositions[_r.from.toString()];$r&&cn&&Qt.setConstantPatternPositions($r,cn)}var Zn=h.translatePosMatrix(St.posMatrix,mt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(I){ce=lr.indexBuffer2,ve=lr.segments2;var ai=[ye.drawingBufferWidth,ye.drawingBufferHeight];Y=V==="fillOutlinePattern"&&Fe?Du(Zn,h,$e,mt,ai):ue(Zn,ai)}else ce=lr.indexBuffer,ve=lr.segments,Y=Fe?zl(Zn,h,$e,mt):Ca(Zn);fr.draw(h.context,k,E,h.stencilModeForClipping(St),A,pt.disabled,Y,c.id,lr.layoutVertexBuffer,ce,ve,c.paint,h.transform.zoom,Qt)}}}}function Df(h,f,c,d,E,A,I){for(var k=h.context,V=k.gl,Y=c.paint.get("fill-extrusion-pattern"),ce=Y.constantOr(1),ve=c.getCrossfadeParameters(),ye=c.paint.get("fill-extrusion-opacity"),ze=0,Fe=d;ze<Fe.length;ze+=1){var $e=Fe[ze],Ne=f.getTile($e),Ze=Ne.getBucket(c);if(Ze){var St=Ze.programConfigurations.get(c.id),mt=h.useProgram(ce?"fillExtrusionPattern":"fillExtrusion",St);ce&&(h.context.activeTexture.set(V.TEXTURE0),Ne.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),St.updatePaintBuffers(ve));var lr=Y.constantOr(null);if(lr&&Ne.imageAtlas){var Qt=Ne.imageAtlas,fr=Qt.patternPositions[lr.to.toString()],_r=Qt.patternPositions[lr.from.toString()];fr&&_r&&St.setConstantPatternPositions(fr,_r)}var Yr=h.translatePosMatrix($e.posMatrix,Ne,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),$r=c.paint.get("fill-extrusion-vertical-gradient"),cn=ce?Lt(Yr,h,$r,ye,$e,ve,Ne):Rf(Yr,h,$r,ye);mt.draw(k,k.gl.TRIANGLES,E,A,I,pt.backCCW,cn,c.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,c.paint,h.transform.zoom,St)}}}function al(h,f,c,d,E,A){var I=h.context,k=I.gl,V=f.fbo;if(V){var Y=h.useProgram("hillshade");I.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,V.colorAttachment.get());var ce=function(ve,ye,ze){var Fe=ze.paint.get("hillshade-shadow-color"),$e=ze.paint.get("hillshade-highlight-color"),Ne=ze.paint.get("hillshade-accent-color"),Ze=ze.paint.get("hillshade-illumination-direction")*(Math.PI/180);ze.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ze-=ve.transform.angle);var St,mt,lr,Qt=!ve.options.moving;return{u_matrix:ve.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),Qt),u_image:0,u_latrange:(St=ye.tileID,mt=Math.pow(2,St.canonical.z),lr=St.canonical.y,[new m.MercatorCoordinate(0,lr/mt).toLngLat().lat,new m.MercatorCoordinate(0,(lr+1)/mt).toLngLat().lat]),u_light:[ze.paint.get("hillshade-exaggeration"),Ze],u_shadow:Fe,u_highlight:$e,u_accent:Ne}}(h,f,c);Y.draw(I,k.TRIANGLES,d,E,A,pt.disabled,ce,c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function zu(h,f,c,d,E,A){var I=h.context,k=I.gl,V=f.dem;if(V&&V.data){var Y=V.dim,ce=V.stride,ve=V.getPixels();if(I.activeTexture.set(k.TEXTURE1),I.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||h.getTileTexture(ce),f.demTexture){var ye=f.demTexture;ye.update(ve,{premultiply:!1}),ye.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(I,ve,k.RGBA,{premultiply:!1}),f.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);I.activeTexture.set(k.TEXTURE0);var ze=f.fbo;if(!ze){var Fe=new m.Texture(I,{width:Y,height:Y,data:null},k.RGBA);Fe.bind(k.LINEAR,k.CLAMP_TO_EDGE),(ze=f.fbo=I.createFramebuffer(Y,Y,!0)).colorAttachment.set(Fe.texture)}I.bindFramebuffer.set(ze.framebuffer),I.viewport.set([0,0,Y,Y]),h.useProgram("hillshadePrepare").draw(I,k.TRIANGLES,d,E,A,pt.disabled,function($e,Ne){var Ze=Ne.stride,St=m.create();return m.ortho(St,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(St,St,[0,-m.EXTENT,0]),{u_matrix:St,u_image:1,u_dimension:[Ze,Ze],u_zoom:$e.overscaledZ,u_unpack:Ne.getUnpackVector()}}(f.tileID,V),c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Ac(h,f,c,d,E){var A=d.paint.get("raster-fade-duration");if(A>0){var I=m.browser.now(),k=(I-h.timeAdded)/A,V=f?(I-f.timeAdded)/A:-1,Y=c.getSource(),ce=E.coveringZoomLevel({tileSize:Y.tileSize,roundZoom:Y.roundZoom}),ve=!f||Math.abs(f.tileID.overscaledZ-ce)>Math.abs(h.tileID.overscaledZ-ce),ye=ve&&h.refreshedUponExpiration?1:m.clamp(ve?k:1-V,0,1);return h.refreshedUponExpiration&&k>=1&&(h.refreshedUponExpiration=!1),f?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}var nf=new m.Color(1,0,0,1),nc=new m.Color(0,1,0,1),Lh=new m.Color(0,0,1,1),Ff=new m.Color(1,0,1,1),Bf=new m.Color(0,1,1,1);function ys(h,f,c,d){Nf(h,0,f+c/2,h.transform.width,c,d)}function eu(h,f,c,d){Nf(h,f-c/2,0,c,h.transform.height,d)}function Nf(h,f,c,d,E,A){var I=h.context,k=I.gl;k.enable(k.SCISSOR_TEST),k.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),I.clear({color:A}),k.disable(k.SCISSOR_TEST)}function _p(h,f,c){var d=h.context,E=d.gl,A=c.posMatrix,I=h.useProgram("debug"),k=ge.disabled,V=ke.disabled,Y=h.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),h.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I.draw(d,E.LINE_STRIP,k,V,Y,pt.disabled,Bu(A,m.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var ce=f.getTileByID(c.key).latestRawTileData,ve=Math.floor((ce&&ce.byteLength||0)/1024),ye=f.getTile(c).tileSize,ze=512/Math.min(ye,512)*(c.overscaledZ/h.transform.zoom)*.5,Fe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Fe+=" => "+c.overscaledZ),function($e,Ne){$e.initDebugOverlayCanvas();var Ze=$e.debugOverlayCanvas,St=$e.context.gl,mt=$e.debugOverlayCanvas.getContext("2d");mt.clearRect(0,0,Ze.width,Ze.height),mt.shadowColor="white",mt.shadowBlur=2,mt.lineWidth=1.5,mt.strokeStyle="white",mt.textBaseline="top",mt.font="bold 36px Open Sans, sans-serif",mt.fillText(Ne,5,5),mt.strokeText(Ne,5,5),$e.debugOverlayTexture.update(Ze),$e.debugOverlayTexture.bind(St.LINEAR,St.CLAMP_TO_EDGE)}(h,Fe+" "+ve+"kb"),I.draw(d,E.TRIANGLES,k,V,nt.alphaBlended,pt.disabled,Bu(A,m.Color.transparent,ze),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var _s={symbol:function(f,c,d,E,A){if(f.renderPass==="translucent"){var I=ke.disabled,k=f.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(V,Y,ce,ve,ye,ze,Fe){for(var $e=Y.transform,Ne=ye==="map",Ze=ze==="map",St=0,mt=V;St<mt.length;St+=1){var lr=mt[St],Qt=ve.getTile(lr),fr=Qt.getBucket(ce);if(fr&&fr.text&&fr.text.segments.get().length){var _r=m.evaluateSizeForZoom(fr.textSizeData,$e.zoom),Yr=wa(Qt,1,Y.transform.zoom),$r=to(lr.posMatrix,Ze,Ne,Y.transform,Yr),cn=ce.layout.get("icon-text-fit")!=="none"&&fr.hasIconData();if(_r){var Zn=Math.pow(2,$e.zoom-Qt.tileID.overscaledZ);ef(fr,Ne,Ze,Fe,m.symbolSize,$e,$r,lr.posMatrix,Zn,_r,cn)}}}}(E,f,d,c,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),A),d.paint.get("icon-opacity").constantOr(1)!==0&&Vl(f,c,d,E,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),I,k),d.paint.get("text-opacity").constantOr(1)!==0&&Vl(f,c,d,E,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),I,k),c.map.showCollisionBoxes&&(wl(f,c,d,E,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),wl(f,c,d,E,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))}},circle:function(f,c,d,E){if(f.renderPass==="translucent"){var A=d.paint.get("circle-opacity"),I=d.paint.get("circle-stroke-width"),k=d.paint.get("circle-stroke-opacity"),V=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(A.constantOr(1)!==0||I.constantOr(1)!==0&&k.constantOr(1)!==0){for(var Y=f.context,ce=Y.gl,ve=f.depthModeForSublayer(0,ge.ReadOnly),ye=ke.disabled,ze=f.colorModeForRenderPass(),Fe=[],$e=0;$e<E.length;$e++){var Ne=E[$e],Ze=c.getTile(Ne),St=Ze.getBucket(d);if(St){var mt=St.programConfigurations.get(d.id),lr={programConfiguration:mt,program:f.useProgram("circle",mt),layoutVertexBuffer:St.layoutVertexBuffer,indexBuffer:St.indexBuffer,uniformValues:Qc(f,Ne,Ze,d)};if(V)for(var Qt=0,fr=St.segments.get();Qt<fr.length;Qt+=1){var _r=fr[Qt];Fe.push({segments:new m.SegmentVector([_r]),sortKey:_r.sortKey,state:lr})}else Fe.push({segments:St.segments,sortKey:0,state:lr})}}V&&Fe.sort(function(ai,pi){return ai.sortKey-pi.sortKey});for(var Yr=0,$r=Fe;Yr<$r.length;Yr+=1){var cn=$r[Yr],Zn=cn.state;Zn.program.draw(Y,ce.TRIANGLES,ve,ye,ze,pt.disabled,Zn.uniformValues,d.id,Zn.layoutVertexBuffer,Zn.indexBuffer,cn.segments,d.paint,f.transform.zoom,Zn.programConfiguration)}}}},heatmap:function(f,c,d,E){if(d.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){var A=f.context,I=A.gl,k=ke.disabled,V=new nt([I.ONE,I.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Fe,$e,Ne){var Ze=Fe.gl;Fe.activeTexture.set(Ze.TEXTURE1),Fe.viewport.set([0,0,$e.width/4,$e.height/4]);var St=Ne.heatmapFbo;if(St)Ze.bindTexture(Ze.TEXTURE_2D,St.colorAttachment.get()),Fe.bindFramebuffer.set(St.framebuffer);else{var mt=Ze.createTexture();Ze.bindTexture(Ze.TEXTURE_2D,mt),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_S,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_WRAP_T,Ze.CLAMP_TO_EDGE),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MIN_FILTER,Ze.LINEAR),Ze.texParameteri(Ze.TEXTURE_2D,Ze.TEXTURE_MAG_FILTER,Ze.LINEAR),St=Ne.heatmapFbo=Fe.createFramebuffer($e.width/4,$e.height/4,!1),function(lr,Qt,fr,_r){var Yr=lr.gl;Yr.texImage2D(Yr.TEXTURE_2D,0,Yr.RGBA,Qt.width/4,Qt.height/4,0,Yr.RGBA,lr.extRenderToTextureHalfFloat?lr.extTextureHalfFloat.HALF_FLOAT_OES:Yr.UNSIGNED_BYTE,null),_r.colorAttachment.set(fr)}(Fe,$e,mt,St)}})(A,f,d),A.clear({color:m.Color.transparent});for(var Y=0;Y<E.length;Y++){var ce=E[Y];if(!c.hasRenderableParent(ce)){var ve=c.getTile(ce),ye=ve.getBucket(d);if(ye){var ze=ye.programConfigurations.get(d.id);f.useProgram("heatmap",ze).draw(A,I.TRIANGLES,ge.disabled,k,V,pt.disabled,Sc(ce.posMatrix,ve,f.transform.zoom,d.paint.get("heatmap-intensity")),d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,d.paint,f.transform.zoom,ze)}}}A.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(Fe,$e){var Ne=Fe.context,Ze=Ne.gl,St=$e.heatmapFbo;if(St){Ne.activeTexture.set(Ze.TEXTURE0),Ze.bindTexture(Ze.TEXTURE_2D,St.colorAttachment.get()),Ne.activeTexture.set(Ze.TEXTURE1);var mt=$e.colorRampTexture;mt||(mt=$e.colorRampTexture=new m.Texture(Ne,$e.colorRamp,Ze.RGBA)),mt.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE),Fe.useProgram("heatmapTexture").draw(Ne,Ze.TRIANGLES,ge.disabled,ke.disabled,Fe.colorModeForRenderPass(),pt.disabled,function(lr,Qt,fr,_r){var Yr=m.create();m.ortho(Yr,0,lr.width,lr.height,0,0,1);var $r=lr.context.gl;return{u_matrix:Yr,u_world:[$r.drawingBufferWidth,$r.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Qt.paint.get("heatmap-opacity")}}(Fe,$e),$e.id,Fe.viewportBuffer,Fe.quadTriangleIndexBuffer,Fe.viewportSegments,$e.paint,Fe.transform.zoom)}}(f,d))},line:function(f,c,d,E){if(f.renderPass==="translucent"){var A=d.paint.get("line-opacity"),I=d.paint.get("line-width");if(A.constantOr(1)!==0&&I.constantOr(1)!==0)for(var k=f.depthModeForSublayer(0,ge.ReadOnly),V=f.colorModeForRenderPass(),Y=d.paint.get("line-dasharray"),ce=d.paint.get("line-pattern"),ve=ce.constantOr(1),ye=d.paint.get("line-gradient"),ze=d.getCrossfadeParameters(),Fe=ve?"linePattern":Y?"lineSDF":ye?"lineGradient":"line",$e=f.context,Ne=$e.gl,Ze=!0,St=0,mt=E;St<mt.length;St+=1){var lr=mt[St],Qt=c.getTile(lr);if(!ve||Qt.patternsLoaded()){var fr=Qt.getBucket(d);if(fr){var _r=fr.programConfigurations.get(d.id),Yr=f.context.program.get(),$r=f.useProgram(Fe,_r),cn=Ze||$r.program!==Yr,Zn=ce.constantOr(null);if(Zn&&Qt.imageAtlas){var ai=Qt.imageAtlas,pi=ai.patternPositions[Zn.to.toString()],Ui=ai.patternPositions[Zn.from.toString()];pi&&Ui&&_r.setConstantPatternPositions(pi,Ui)}var zi=ve?Cc(f,Qt,d,ze):Y?sh(f,Qt,d,Y,ze):ye?ka(f,Qt,d,fr.lineClipsArray.length):Cl(f,Qt,d);if(ve)$e.activeTexture.set(Ne.TEXTURE0),Qt.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),_r.updatePaintBuffers(ze);else if(Y&&(cn||f.lineAtlas.dirty))$e.activeTexture.set(Ne.TEXTURE0),f.lineAtlas.bind($e);else if(ye){var Bn=fr.gradients[d.id],Ei=Bn.texture;if(d.gradientVersion!==Bn.version){var Oi=256;if(d.stepInterpolant){var ei=c.getSource().maxzoom,vi=lr.canonical.z===ei?Math.ceil(1<<f.transform.maxZoom-lr.canonical.z):1;Oi=m.clamp(m.nextPowerOfTwo(fr.maxLineLength/m.EXTENT*1024*vi),256,$e.maxTextureSize)}Bn.gradient=m.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:Oi,image:Bn.gradient||void 0,clips:fr.lineClipsArray}),Bn.texture?Bn.texture.update(Bn.gradient):Bn.texture=new m.Texture($e,Bn.gradient,Ne.RGBA),Bn.version=d.gradientVersion,Ei=Bn.texture}$e.activeTexture.set(Ne.TEXTURE0),Ei.bind(d.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}$r.draw($e,Ne.TRIANGLES,k,f.stencilModeForClipping(lr),V,pt.disabled,zi,d.id,fr.layoutVertexBuffer,fr.indexBuffer,fr.segments,d.paint,f.transform.zoom,_r,fr.layoutVertexBuffer2),Ze=!1}}}}},fill:function(f,c,d,E){var A=d.paint.get("fill-color"),I=d.paint.get("fill-opacity");if(I.constantOr(1)!==0){var k=f.colorModeForRenderPass(),V=d.paint.get("fill-pattern"),Y=f.opaquePassEnabledForLayer()&&!V.constantOr(1)&&A.constantOr(m.Color.transparent).a===1&&I.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===Y){var ce=f.depthModeForSublayer(1,f.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);rf(f,c,d,E,ce,k,!1)}if(f.renderPass==="translucent"&&d.paint.get("fill-antialias")){var ve=f.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);rf(f,c,d,E,ve,k,!0)}}},"fill-extrusion":function(f,c,d,E){var A=d.paint.get("fill-extrusion-opacity");if(A!==0&&f.renderPass==="translucent"){var I=new ge(f.context.gl.LEQUAL,ge.ReadWrite,f.depthRangeFor3D);if(A!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Df(f,c,d,E,I,ke.disabled,nt.disabled),Df(f,c,d,E,I,f.stencilModeFor3D(),f.colorModeForRenderPass());else{var k=f.colorModeForRenderPass();Df(f,c,d,E,I,ke.disabled,k)}}},hillshade:function(f,c,d,E){if(f.renderPass==="offscreen"||f.renderPass==="translucent"){for(var A=f.context,I=f.depthModeForSublayer(0,ge.ReadOnly),k=f.colorModeForRenderPass(),V=f.renderPass==="translucent"?f.stencilConfigForOverlap(E):[{},E],Y=V[0],ce=0,ve=V[1];ce<ve.length;ce+=1){var ye=ve[ce],ze=c.getTile(ye);ze.needsHillshadePrepare&&f.renderPass==="offscreen"?zu(f,ze,d,I,ke.disabled,k):f.renderPass==="translucent"&&al(f,ze,d,I,Y[ye.overscaledZ],k)}A.viewport.set([0,0,f.width,f.height])}},raster:function(f,c,d,E){if(f.renderPass==="translucent"&&d.paint.get("raster-opacity")!==0&&E.length)for(var A=f.context,I=A.gl,k=c.getSource(),V=f.useProgram("raster"),Y=f.colorModeForRenderPass(),ce=k instanceof ut?[{},E]:f.stencilConfigForOverlap(E),ve=ce[0],ye=ce[1],ze=ye[ye.length-1].overscaledZ,Fe=!f.options.moving,$e=0,Ne=ye;$e<Ne.length;$e+=1){var Ze=Ne[$e],St=f.depthModeForSublayer(Ze.overscaledZ-ze,d.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,I.LESS),mt=c.getTile(Ze),lr=f.transform.calculatePosMatrix(Ze.toUnwrapped(),Fe);mt.registerFadeDuration(d.paint.get("raster-fade-duration"));var Qt=c.findLoadedParent(Ze,0),fr=Ac(mt,Qt,c,d,f.transform),_r=void 0,Yr=void 0,$r=d.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;A.activeTexture.set(I.TEXTURE0),mt.texture.bind($r,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),A.activeTexture.set(I.TEXTURE1),Qt?(Qt.texture.bind($r,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST),_r=Math.pow(2,Qt.tileID.overscaledZ-mt.tileID.overscaledZ),Yr=[mt.tileID.canonical.x*_r%1,mt.tileID.canonical.y*_r%1]):mt.texture.bind($r,I.CLAMP_TO_EDGE,I.LINEAR_MIPMAP_NEAREST);var cn=uh(lr,Yr||[0,0],_r||1,fr,d);k instanceof ut?V.draw(A,I.TRIANGLES,St,ke.disabled,Y,pt.disabled,cn,d.id,k.boundsBuffer,f.quadTriangleIndexBuffer,k.boundsSegments):V.draw(A,I.TRIANGLES,St,ve[Ze.overscaledZ],Y,pt.disabled,cn,d.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,c,d){var E=d.paint.get("background-color"),A=d.paint.get("background-opacity");if(A!==0){var I=f.context,k=I.gl,V=f.transform,Y=V.tileSize,ce=d.paint.get("background-pattern");if(!f.isPatternMissing(ce)){var ve=!ce&&E.a===1&&A===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass===ve){var ye=ke.disabled,ze=f.depthModeForSublayer(0,ve==="opaque"?ge.ReadWrite:ge.ReadOnly),Fe=f.colorModeForRenderPass(),$e=f.useProgram(ce?"backgroundPattern":"background"),Ne=V.coveringTiles({tileSize:Y});ce&&(I.activeTexture.set(k.TEXTURE0),f.imageManager.bind(f.context));for(var Ze=d.getCrossfadeParameters(),St=0,mt=Ne;St<mt.length;St+=1){var lr=mt[St],Qt=f.transform.calculatePosMatrix(lr.toUnwrapped()),fr=ce?Nu(Qt,A,f,ce,{tileID:lr,tileSize:Y},Ze):Js(Qt,A,E);$e.draw(I,k.TRIANGLES,ze,ye,Fe,pt.disabled,fr,d.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}}}},debug:function(f,c,d){for(var E=0;E<d.length;E++)_p(f,c,d[E])},custom:function(f,c,d){var E=f.context,A=d.implementation;if(f.renderPass==="offscreen"){var I=A.prerender;I&&(f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),I.call(A,E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),E.setStencilMode(ke.disabled);var k=A.renderingMode==="3d"?new ge(f.context.gl.LEQUAL,ge.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,ge.ReadOnly);E.setDepthMode(k),A.render(E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState(),E.bindFramebuffer.set(null)}}},ro=function(f,c){this.context=new pe(f),this.transform=c,this._tileTextures={},this.setup(),this.numSublayers=Ue.maxUnderzooming+Ue.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new qs,this.gpuTimers={}};ro.prototype.resize=function(h,f){if(this.width=h*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},ro.prototype.setup=function(){var h=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(f,Ya.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=h.createVertexBuffer(c,Ya.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(d,lt.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(E,Ya.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var A=new m.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(A);var I=new m.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(I),this.emptyTexture=new m.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new ke({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},ro.prototype.clearStencil=function(){var h=this.context,f=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,f.TRIANGLES,ge.disabled,this.stencilClearMode,nt.disabled,pt.disabled,il(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ro.prototype._renderTileClippingMasks=function(h,f){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&f&&f.length){this.currentStencilSource=h.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(nt.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,I=f;A<I.length;A+=1){var k=I[A],V=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new ke({func:d.ALWAYS,mask:0},V,255,d.KEEP,d.KEEP,d.REPLACE),nt.disabled,pt.disabled,il(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ro.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,f=this.context.gl;return new ke({func:f.NOTEQUAL,mask:255},h,255,f.KEEP,f.KEEP,f.REPLACE)},ro.prototype.stencilModeForClipping=function(h){var f=this.context.gl;return new ke({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,f.KEEP,f.KEEP,f.REPLACE)},ro.prototype.stencilConfigForOverlap=function(h){var f,c=this.context.gl,d=h.sort(function(V,Y){return Y.overscaledZ-V.overscaledZ}),E=d[d.length-1].overscaledZ,A=d[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var I={},k=0;k<A;k++)I[k+E]=new ke({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=A,[I,d]}return[(f={},f[E]=ke.disabled,f),d]},ro.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new nt([h.CONSTANT_COLOR,h.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?nt.unblended:nt.alphaBlended},ro.prototype.depthModeForSublayer=function(h,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[d,d])},ro.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ro.prototype.render=function(h,f){var c=this;this.style=h,this.options=f,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var A in E){var I=E[A];I.used&&I.prepare(this.context)}var k,V,Y={},ce={},ve={};for(var ye in E){var ze=E[ye];Y[ye]=ze.getVisibleCoordinates(),ce[ye]=Y[ye].slice().reverse(),ve[ye]=ze.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Fe=0;Fe<d.length;Fe++)if(this.style._layers[d[Fe]].is3D()){this.opaquePassCutoff=Fe;break}this.renderPass="offscreen";for(var $e=0,Ne=d;$e<Ne.length;$e+=1){var Ze=this.style._layers[Ne[$e]];if(Ze.hasOffscreenPass()&&!Ze.isHidden(this.transform.zoom)){var St=ce[Ze.source];(Ze.type==="custom"||St.length)&&this.renderLayer(this,E[Ze.source],Ze,St)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var mt=this.style._layers[d[this.currentLayer]],lr=E[mt.source],Qt=Y[mt.source];this._renderTileClippingMasks(mt,Qt),this.renderLayer(this,lr,mt,Qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var fr=this.style._layers[d[this.currentLayer]],_r=E[fr.source],Yr=(fr.type==="symbol"?ve:ce)[fr.source];this._renderTileClippingMasks(fr,Y[fr.source]),this.renderLayer(this,_r,fr,Yr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function($r){$r.source&&!$r.isHidden(c.transform.zoom)&&($r.source!==(V&&V.id)&&(V=c.style.sourceCaches[$r.source]),(!k||k.getSource().maxzoom<V.getSource().maxzoom)&&(k=V))}),k&&_s.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function($r){var cn=$r.transform.padding;ys($r,$r.transform.height-(cn.top||0),3,nf),ys($r,cn.bottom||0,3,nc),eu($r,cn.left||0,3,Lh),eu($r,$r.transform.width-(cn.right||0),3,Ff);var Zn=$r.transform.centerPoint;(function(ai,pi,Ui,zi){Nf(ai,pi-1,Ui-10,2,20,zi),Nf(ai,pi-10,Ui-1,20,2,zi)})($r,Zn.x,$r.transform.height-Zn.y,Bf)}(this),this.context.setDefault()},ro.prototype.renderLayer=function(h,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),_s[c.type](h,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},ro.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[h.id];c||(c=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},ro.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},ro.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},ro.prototype.queryGpuTimers=function(h){var f={};for(var c in h){var d=h[c],E=this.context.extTimerQuery,A=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=A}return f},ro.prototype.translatePosMatrix=function(h,f,c,d,E){if(!c[0]&&!c[1])return h;var A=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(A){var I=Math.sin(A),k=Math.cos(A);c=[c[0]*k-c[1]*I,c[0]*I+c[1]*k]}var V=[E?c[0]:wa(f,c[0],this.transform.zoom),E?c[1]:wa(f,c[1],this.transform.zoom),0],Y=new Float32Array(16);return m.translate(Y,h,V),Y},ro.prototype.saveTileTexture=function(h){var f=this._tileTextures[h.size[0]];f?f.push(h):this._tileTextures[h.size[0]]=[h]},ro.prototype.getTileTexture=function(h){var f=this._tileTextures[h];return f&&f.length>0?f.pop():null},ro.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var f=this.imageManager.getPattern(h.from.toString()),c=this.imageManager.getPattern(h.to.toString());return!f||!c},ro.prototype.useProgram=function(h,f){this.cache=this.cache||{};var c=""+h+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new qc(this.context,h,Sl[h],f,rc[h],this._showOverdrawInspector)),this.cache[c]},ro.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ro.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},ro.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ro.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ic=function(f,c){this.points=f,this.planes=c};ic.fromInvProjectionMatrix=function(h,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(I){return m.transformMat4([],I,h)}).map(function(I){return m.scale$1([],I,1/I[3]/f*d)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(I){var k=m.sub([],E[I[0]],E[I[1]]),V=m.sub([],E[I[2]],E[I[1]]),Y=m.normalize([],m.cross([],k,V)),ce=-m.dot(Y,E[I[1]]);return Y.concat(ce)});return new ic(E,A)};var Tl=function(f,c){this.min=f,this.max=c,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};Tl.prototype.quadrant=function(h){for(var f=[h%2==0,h<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Tl(c,d)},Tl.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},Tl.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},Tl.prototype.intersects=function(h){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<h.planes.length;d++){for(var E=h.planes[d],A=0,I=0;I<f.length;I++)A+=m.dot$1(E,f[I])>=0;if(A===0)return 0;A!==f.length&&(c=!1)}if(c)return 2;for(var k=0;k<3;k++){for(var V=Number.MAX_VALUE,Y=-Number.MAX_VALUE,ce=0;ce<h.points.length;ce++){var ve=h.points[ce][k]-this.min[k];V=Math.min(V,ve),Y=Math.max(Y,ve)}if(Y<0||V>this.max[k]-this.min[k])return 0}return 1};var ol=function(f,c,d,E){if(f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),E===void 0&&(E=0),isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=f,this.bottom=c,this.left=d,this.right=E};ol.prototype.interpolate=function(h,f,c){return f.top!=null&&h.top!=null&&(this.top=m.number(h.top,f.top,c)),f.bottom!=null&&h.bottom!=null&&(this.bottom=m.number(h.bottom,f.bottom,c)),f.left!=null&&h.left!=null&&(this.left=m.number(h.left,f.left,c)),f.right!=null&&h.right!=null&&(this.right=m.number(h.right,f.right,c)),this},ol.prototype.getCenter=function(h,f){var c=m.clamp((this.left+h-this.right)/2,0,h),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},ol.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},ol.prototype.clone=function(){return new ol(this.top,this.bottom,this.left,this.right)},ol.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Qi=function(f,c,d,E,A){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=A===void 0||A,this._minZoom=f||0,this._maxZoom=c||22,this._minPitch=d==null?0:d,this._maxPitch=E==null?60:E,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ol,this._posMatrixCache={},this._alignedPosMatrixCache={}},za={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Qi.prototype.clone=function(){var h=new Qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},za.minZoom.get=function(){return this._minZoom},za.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},za.maxZoom.get=function(){return this._maxZoom},za.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},za.minPitch.get=function(){return this._minPitch},za.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},za.maxPitch.get=function(){return this._maxPitch},za.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},za.renderWorldCopies.get=function(){return this._renderWorldCopies},za.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},za.worldSize.get=function(){return this.tileSize*this.scale},za.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},za.size.get=function(){return new m.Point(this.width,this.height)},za.bearing.get=function(){return-this.angle/Math.PI*180},za.bearing.set=function(h){var f=-m.wrap(h,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},za.pitch.get=function(){return this._pitch/Math.PI*180},za.pitch.set=function(h){var f=m.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},za.fov.get=function(){return this._fov/Math.PI*180},za.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},za.zoom.get=function(){return this._zoom},za.zoom.set=function(h){var f=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},za.center.get=function(){return this._center},za.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},za.padding.get=function(){return this._edgeInsets.toJSON()},za.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},za.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Qi.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Qi.prototype.interpolatePadding=function(h,f,c){this._unmodified=!1,this._edgeInsets.interpolate(h,f,c),this._constrain(),this._calcMatrices()},Qi.prototype.coveringZoomLevel=function(h){var f=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,f)},Qi.prototype.getVisibleUnwrappedCoordinates=function(h){var f=[new m.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),A=this.pointCoordinate(new m.Point(0,this.height)),I=Math.floor(Math.min(c.x,d.x,E.x,A.x)),k=Math.floor(Math.max(c.x,d.x,E.x,A.x)),V=I-1;V<=k+1;V++)V!==0&&f.push(new m.UnwrappedTileID(V,h));return f},Qi.prototype.coveringTiles=function(h){var f=this.coveringZoomLevel(h),c=f;if(h.minzoom!==void 0&&f<h.minzoom)return[];h.maxzoom!==void 0&&f>h.maxzoom&&(f=h.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),A=[E*d.x,E*d.y,0],I=ic.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),k=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=f);var V=function(cn){return{aabb:new Tl([cn*E,0,0],[(cn+1)*E,E,0]),zoom:0,x:0,y:0,wrap:cn,fullyVisible:!1}},Y=[],ce=[],ve=f,ye=h.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var ze=1;ze<=3;ze++)Y.push(V(-ze)),Y.push(V(ze));for(Y.push(V(0));Y.length>0;){var Fe=Y.pop(),$e=Fe.x,Ne=Fe.y,Ze=Fe.fullyVisible;if(!Ze){var St=Fe.aabb.intersects(I);if(St===0)continue;Ze=St===2}var mt=Fe.aabb.distanceX(A),lr=Fe.aabb.distanceY(A),Qt=Math.max(Math.abs(mt),Math.abs(lr));if(Fe.zoom===ve||Qt>3+(1<<ve-Fe.zoom)-2&&Fe.zoom>=k)ce.push({tileID:new m.OverscaledTileID(Fe.zoom===ve?ye:Fe.zoom,Fe.wrap,Fe.zoom,$e,Ne),distanceSq:m.sqrLen([A[0]-.5-$e,A[1]-.5-Ne])});else for(var fr=0;fr<4;fr++){var _r=($e<<1)+fr%2,Yr=(Ne<<1)+(fr>>1);Y.push({aabb:Fe.aabb.quadrant(fr),zoom:Fe.zoom+1,x:_r,y:Yr,wrap:Fe.wrap,fullyVisible:Ze})}}return ce.sort(function($r,cn){return $r.distanceSq-cn.distanceSq}).map(function($r){return $r.tileID})},Qi.prototype.resize=function(h,f){this.width=h,this.height=f,this.pixelsToGLUnits=[2/h,-2/f],this._constrain(),this._calcMatrices()},za.unmodified.get=function(){return this._unmodified},Qi.prototype.zoomScale=function(h){return Math.pow(2,h)},Qi.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Qi.prototype.project=function(h){var f=m.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(h.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Qi.prototype.unproject=function(h){return new m.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},za.point.get=function(){return this.project(this.center)},Qi.prototype.setLocationAtPoint=function(h,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(h),A=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},Qi.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Qi.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Qi.prototype.locationCoordinate=function(h){return m.MercatorCoordinate.fromLngLat(h)},Qi.prototype.coordinateLocation=function(h){return h.toLngLat()},Qi.prototype.pointCoordinate=function(h){var f=[h.x,h.y,0,1],c=[h.x,h.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],A=f[1]/d,I=c[1]/E,k=f[2]/d,V=c[2]/E,Y=k===V?0:(0-k)/(V-k);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,Y)/this.worldSize,m.number(A,I,Y)/this.worldSize)},Qi.prototype.coordinatePoint=function(h){var f=[h.x*this.worldSize,h.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Qi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Qi.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Qi.prototype.calculatePosMatrix=function(h,f){f===void 0&&(f=!1);var c=h.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=h.canonical,A=this.worldSize/this.zoomScale(E.z),I=E.x+Math.pow(2,E.z)*h.wrap,k=m.identity(new Float64Array(16));return m.translate(k,k,[I*A,E.y*A,0]),m.scale(k,k,[A/m.EXTENT,A/m.EXTENT,1]),m.multiply(k,f?this.alignedProjMatrix:this.projMatrix,k),d[c]=new Float32Array(k),d[c]},Qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,f,c,d,E=-90,A=90,I=-180,k=180,V=this.size,Y=this._unmodified;if(this.latRange){var ce=this.latRange;E=m.mercatorYfromLat(ce[1])*this.worldSize,h=(A=m.mercatorYfromLat(ce[0])*this.worldSize)-E<V.y?V.y/(A-E):0}if(this.lngRange){var ve=this.lngRange;I=m.mercatorXfromLng(ve[0])*this.worldSize,f=(k=m.mercatorXfromLng(ve[1])*this.worldSize)-I<V.x?V.x/(k-I):0}var ye=this.point,ze=Math.max(f||0,h||0);if(ze)return this.center=this.unproject(new m.Point(f?(k+I)/2:ye.x,h?(A+E)/2:ye.y)),this.zoom+=this.scaleZoom(ze),this._unmodified=Y,void(this._constraining=!1);if(this.latRange){var Fe=ye.y,$e=V.y/2;Fe-$e<E&&(d=E+$e),Fe+$e>A&&(d=A-$e)}if(this.lngRange){var Ne=ye.x,Ze=V.x/2;Ne-Ze<I&&(c=I+Ze),Ne+Ze>k&&(c=k-Ze)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:ye.x,d!==void 0?d:ye.y))),this._unmodified=Y,this._constraining=!1}},Qi.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+h.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,A=E.x,I=E.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),V=this.height/50,Y=new Float64Array(16);m.perspective(Y,this._fov,this.width/this.height,V,k),Y[8]=2*-h.x/this.width,Y[9]=2*h.y/this.height,m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[0,0,-this.cameraToCenterDistance]),m.rotateX(Y,Y,this._pitch),m.rotateZ(Y,Y,this.angle),m.translate(Y,Y,[-A,-I,0]),this.mercatorMatrix=m.scale([],Y,[this.worldSize,this.worldSize,this.worldSize]),m.scale(Y,Y,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=Y,this.invProjMatrix=m.invert([],this.projMatrix);var ce=this.width%2/2,ve=this.height%2/2,ye=Math.cos(this.angle),ze=Math.sin(this.angle),Fe=A-Math.round(A)+ye*ce+ze*ve,$e=I-Math.round(I)+ye*ve+ze*ce,Ne=new Float64Array(Y);if(m.translate(Ne,Ne,[Fe>.5?Fe-1:Fe,$e>.5?$e-1:$e,0]),this.alignedProjMatrix=Ne,Y=m.create(),m.scale(Y,Y,[this.width/2,-this.height/2,1]),m.translate(Y,Y,[1,-1,0]),this.labelPlaneMatrix=Y,Y=m.create(),m.scale(Y,Y,[1,-1,1]),m.translate(Y,Y,[-1,-1,0]),m.scale(Y,Y,[2/this.width,2/this.height,1]),this.glCoordMatrix=Y,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(Y=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=Y,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new m.Point(0,0)),f=[h.x*this.worldSize,h.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Qi.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,h))},Qi.prototype.getCameraQueryGeometry=function(h){var f=this.getCameraPoint();if(h.length===1)return[h[0],f];for(var c=f.x,d=f.y,E=f.x,A=f.y,I=0,k=h;I<k.length;I+=1){var V=k[I];c=Math.min(c,V.x),d=Math.min(d,V.y),E=Math.max(E,V.x),A=Math.max(A,V.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,A),new m.Point(c,A),new m.Point(c,d)]},Object.defineProperties(Qi.prototype,za);var Ms=function(f){var c,d,E,A;this._hashName=f&&encodeURIComponent(f),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(c=this._updateHashUnthrottled.bind(this),d=!1,E=null,A=function(){E=null,d&&(c(),E=setTimeout(A,300),d=!1)},function(){return d=!0,E||A(),E})};Ms.prototype.addTo=function(h){return this._map=h,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ms.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ms.prototype.getHashString=function(h){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),A=Math.round(f.lng*E)/E,I=Math.round(f.lat*E)/E,k=this._map.getBearing(),V=this._map.getPitch(),Y="";if(Y+=h?"/"+A+"/"+I+"/"+c:c+"/"+I+"/"+A,(k||V)&&(Y+="/"+Math.round(10*k)/10),V&&(Y+="/"+Math.round(V)),this._hashName){var ce=this._hashName,ve=!1,ye=m.window.location.hash.slice(1).split("&").map(function(ze){var Fe=ze.split("=")[0];return Fe===ce?(ve=!0,Fe+"="+Y):ze}).filter(function(ze){return ze});return ve||ye.push(ce+"="+Y),"#"+ye.join("&")}return"#"+Y},Ms.prototype._getCurrentHash=function(){var h,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(h=d)}),(h&&h[1]||"").split("/")):c.split("/")},Ms.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:f,pitch:+(h[4]||0)}),!0}return!1},Ms.prototype._updateHashUnthrottled=function(){var h=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,h)}catch(f){}};var Ml={linearity:.3,easing:m.bezier(0,0,.3,1)},Ps=m.extend({deceleration:2500,maxSpeed:1400},Ml),af=m.extend({deceleration:20,maxSpeed:1400},Ml),xp=m.extend({deceleration:1e3,maxSpeed:360},Ml),lh=m.extend({deceleration:1e3,maxSpeed:90},Ml),of=function(f){this._map=f,this.clear()};function sf(h,f){(!h.duration||h.duration<f.duration)&&(h.duration=f.duration,h.easing=f.easing)}function Eu(h,f,c){var d=c.maxSpeed,E=c.linearity,A=c.deceleration,I=m.clamp(h*E/(f/1e3),-d,d),k=Math.abs(I)/(A*E);return{easing:c.easing,duration:1e3*k,amount:I*(k/2)}}of.prototype.clear=function(){this._inertiaBuffer=[]},of.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:h})},of.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,f=m.browser.now();h.length>0&&f-h[0].time>160;)h.shift()},of.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(f.pan.mag()){var k=Eu(f.pan.mag(),A,m.extend({},Ps,h||{}));I.offset=f.pan.mult(k.amount/f.pan.mag()),I.center=this._map.transform.center,sf(I,k)}if(f.zoom){var V=Eu(f.zoom,A,af);I.zoom=this._map.transform.zoom+V.amount,sf(I,V)}if(f.bearing){var Y=Eu(f.bearing,A,xp);I.bearing=this._map.transform.bearing+m.clamp(Y.amount,-179,179),sf(I,Y)}if(f.pitch){var ce=Eu(f.pitch,A,lh);I.pitch=this._map.transform.pitch+ce.amount,sf(I,ce)}if(I.zoom||I.bearing){var ve=f.pinchAround===void 0?f.around:f.pinchAround;I.around=ve?this._map.unproject(ve):this._map.getCenter()}return this.clear(),m.extend(I,{noMoveStart:!0})}};var ha=function(h){function f(d,E,A,I){I===void 0&&(I={});var k=G.mousePos(E.getCanvasContainer(),A),V=E.unproject(k);h.call(this,d,m.extend({point:k,lngLat:V,originalEvent:A},I)),this._defaultPrevented=!1,this.target=E}h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Gl=function(h){function f(d,E,A){var I=d==="touchend"?A.changedTouches:A.touches,k=G.touchPos(E.getCanvasContainer(),I),V=k.map(function(ve){return E.unproject(ve)}),Y=k.reduce(function(ve,ye,ze,Fe){return ve.add(ye.div(Fe.length))},new m.Point(0,0)),ce=E.unproject(Y);h.call(this,d,{points:k,point:Y,lngLats:V,lngLat:ce,originalEvent:A}),this._defaultPrevented=!1}h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),ac=function(h){function f(d,E,A){h.call(this,d,{originalEvent:A}),this._defaultPrevented=!1}h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Xi=function(f,c){this._map=f,this._clickTolerance=c.clickTolerance};Xi.prototype.reset=function(){delete this._mousedownPos},Xi.prototype.wheel=function(h){return this._firePreventable(new ac(h.type,this._map,h))},Xi.prototype.mousedown=function(h,f){return this._mousedownPos=f,this._firePreventable(new ha(h.type,this._map,h))},Xi.prototype.mouseup=function(h){this._map.fire(new ha(h.type,this._map,h))},Xi.prototype.click=function(h,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ha(h.type,this._map,h))},Xi.prototype.dblclick=function(h){return this._firePreventable(new ha(h.type,this._map,h))},Xi.prototype.mouseover=function(h){this._map.fire(new ha(h.type,this._map,h))},Xi.prototype.mouseout=function(h){this._map.fire(new ha(h.type,this._map,h))},Xi.prototype.touchstart=function(h){return this._firePreventable(new Gl(h.type,this._map,h))},Xi.prototype.touchmove=function(h){this._map.fire(new Gl(h.type,this._map,h))},Xi.prototype.touchend=function(h){this._map.fire(new Gl(h.type,this._map,h))},Xi.prototype.touchcancel=function(h){this._map.fire(new Gl(h.type,this._map,h))},Xi.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},Xi.prototype.isEnabled=function(){return!0},Xi.prototype.isActive=function(){return!1},Xi.prototype.enable=function(){},Xi.prototype.disable=function(){};var Ln=function(f){this._map=f};Ln.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Ln.prototype.mousemove=function(h){this._map.fire(new ha(h.type,this._map,h))},Ln.prototype.mousedown=function(){this._delayContextMenu=!0},Ln.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ha("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Ln.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new ha(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},Ln.prototype.isEnabled=function(){return!0},Ln.prototype.isActive=function(){return!1},Ln.prototype.enable=function(){},Ln.prototype.disable=function(){};var Os=function(f,c){this._map=f,this._el=f.getCanvasContainer(),this._container=f.getContainer(),this._clickTolerance=c.clickTolerance||1};function uf(h,f){for(var c={},d=0;d<h.length;d++)c[h[d].identifier]=f[d];return c}Os.prototype.isEnabled=function(){return!!this._enabled},Os.prototype.isActive=function(){return!!this._active},Os.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Os.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Os.prototype.mousedown=function(h,f){this.isEnabled()&&h.shiftKey&&h.button===0&&(G.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},Os.prototype.mousemoveWindow=function(h,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=G.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var E=Math.min(d.x,c.x),A=Math.max(d.x,c.x),I=Math.min(d.y,c.y),k=Math.max(d.y,c.y);G.setTransform(this._box,"translate("+E+"px,"+I+"px)"),this._box.style.width=A-E+"px",this._box.style.height=k-I+"px"}}},Os.prototype.mouseupWindow=function(h,f){var c=this;if(this._active&&h.button===0){var d=this._startPos,E=f;if(this.reset(),G.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(I){return I.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},Os.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},Os.prototype.blur=function(){this.reset()},Os.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos},Os.prototype._fireEvent=function(h,f){return this._map.fire(new m.Event(h,{originalEvent:f}))};var oc=function(f){this.reset(),this.numTouches=f.numTouches};oc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},oc.prototype.touchstart=function(h,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),A=0,I=d;A<I.length;A+=1)E._add(I[A]);return E.div(d.length)}(f),this.touches=uf(c,f)))},oc.prototype.touchmove=function(h,f,c){if(!this.aborted&&this.centroid){var d=uf(c,f);for(var E in this.touches){var A=d[E];(!A||A.dist(this.touches[E])>30)&&(this.aborted=!0)}}},oc.prototype.touchend=function(h,f,c){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Su=function(f){this.singleTap=new oc(f),this.numTaps=f.numTaps,this.reset()};Su.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Su.prototype.touchstart=function(h,f,c){this.singleTap.touchstart(h,f,c)},Su.prototype.touchmove=function(h,f,c){this.singleTap.touchmove(h,f,c)},Su.prototype.touchend=function(h,f,c){var d=this.singleTap.touchend(h,f,c);if(d){var E=h.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(d)<30;if(E&&A||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Is=function(){this._zoomIn=new Su({numTouches:1,numTaps:2}),this._zoomOut=new Su({numTouches:2,numTaps:1}),this.reset()};Is.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Is.prototype.touchstart=function(h,f,c){this._zoomIn.touchstart(h,f,c),this._zoomOut.touchstart(h,f,c)},Is.prototype.touchmove=function(h,f,c){this._zoomIn.touchmove(h,f,c),this._zoomOut.touchmove(h,f,c)},Is.prototype.touchend=function(h,f,c){var d=this,E=this._zoomIn.touchend(h,f,c),A=this._zoomOut.touchend(h,f,c);return E?(this._active=!0,h.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(E)},{originalEvent:h})}}):A?(this._active=!0,h.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(A)},{originalEvent:h})}}):void 0},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(){this._enabled=!0},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var lf={0:1,2:2},gn=function(f){this.reset(),this._clickTolerance=f.clickTolerance||1};gn.prototype.blur=function(){this.reset()},gn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},gn.prototype._correctButton=function(h,f){return!1},gn.prototype._move=function(h,f){return{}},gn.prototype.mousedown=function(h,f){if(!this._lastPoint){var c=G.mouseButton(h);this._correctButton(h,c)&&(this._lastPoint=f,this._eventButton=c)}},gn.prototype.mousemoveWindow=function(h,f){var c=this._lastPoint;if(c){if(h.preventDefault(),function(d,E){var A=lf[E];return d.buttons===void 0||(d.buttons&A)!==A}(h,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},gn.prototype.mouseupWindow=function(h){this._lastPoint&&G.mouseButton(h)===this._eventButton&&(this._moved&&G.suppressClick(),this.reset())},gn.prototype.enable=function(){this._enabled=!0},gn.prototype.disable=function(){this._enabled=!1,this.reset()},gn.prototype.isEnabled=function(){return this._enabled},gn.prototype.isActive=function(){return this._active};var Hl=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.mousedown=function(c,d){h.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(gn),Fo=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(gn),zf=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(gn),hu=function(f){this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset()};hu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},hu.prototype.touchstart=function(h,f,c){return this._calculateTransform(h,f,c)},hu.prototype.touchmove=function(h,f,c){if(this._active&&!(c.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,f,c)},hu.prototype.touchend=function(h,f,c){this._calculateTransform(h,f,c),this._active&&c.length<this._minTouches&&this.reset()},hu.prototype.touchcancel=function(){this.reset()},hu.prototype._calculateTransform=function(h,f,c){c.length>0&&(this._active=!0);var d=uf(c,f),E=new m.Point(0,0),A=new m.Point(0,0),I=0;for(var k in d){var V=d[k],Y=this._touches[k];Y&&(E._add(V),A._add(V.sub(Y)),I++,d[k]=V)}if(this._touches=d,!(I<this._minTouches)&&A.mag()){var ce=A.div(I);if(this._sum._add(ce),!(this._sum.mag()<this._clickTolerance))return{around:E.div(I),panDelta:ce}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Go=function(){this.reset()};function cf(h,f,c){for(var d=0;d<h.length;d++)if(h[d].identifier===c)return f[d]}function ff(h,f){return Math.log(h/f)/Math.LN2}Go.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Go.prototype._start=function(h){},Go.prototype._move=function(h,f,c){return{}},Go.prototype.touchstart=function(h,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Go.prototype.touchmove=function(h,f,c){if(this._firstTwoTouches){h.preventDefault();var d=this._firstTwoTouches,E=d[1],A=cf(c,f,d[0]),I=cf(c,f,E);if(A&&I){var k=this._aroundCenter?null:A.add(I).div(2);return this._move([A,I],k,h)}}},Go.prototype.touchend=function(h,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],A=cf(c,f,d[0]),I=cf(c,f,E);A&&I||(this._active&&G.suppressClick(),this.reset())}},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var tu=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(ff(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ff(this._distance,E),pinchAround:d}},f}(Go);function Uu(h,f){return 180*h.angleWith(f)/Math.PI}var ch=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Uu(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Uu(c,this._startVector);return Math.abs(E)<d},f}(Go);function hf(h){return Math.abs(h.y)>Math.abs(h.x)}var Uf=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,hf(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var A=c[0].sub(this._lastPoints[0]),I=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,I,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(A.y+I.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var A=c.mag()>=2,I=d.mag()>=2;if(A||I){if(!A||!I)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var k=c.y>0==d.y>0;return hf(c)&&hf(d)&&k}},f}(Go),jf={panStep:100,bearingStep:15,pitchStep:10},Cu=function(){var f=jf;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1};function lo(h){return h*(2-h)}Cu.prototype.blur=function(){this.reset()},Cu.prototype.reset=function(){this._active=!1},Cu.prototype.keydown=function(h){var f=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var c=0,d=0,E=0,A=0,I=0;switch(h.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:h.shiftKey?d=-1:(h.preventDefault(),A=-1);break;case 39:h.shiftKey?d=1:(h.preventDefault(),A=1);break;case 38:h.shiftKey?E=1:(h.preventDefault(),I=-1);break;case 40:h.shiftKey?E=-1:(h.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(V){var Y=V.getZoom();V.easeTo({duration:300,easeId:"keyboardHandler",easing:lo,zoom:c?Math.round(Y)+c*(h.shiftKey?2:1):Y,bearing:V.getBearing()+d*f._bearingStep,pitch:V.getPitch()+E*f._pitchStep,offset:[-A*f._panStep,-I*f._panStep],center:V.getCenter()},{originalEvent:h})}}}},Cu.prototype.enable=function(){this._enabled=!0},Cu.prototype.disable=function(){this._enabled=!1,this.reset()},Cu.prototype.isEnabled=function(){return this._enabled},Cu.prototype.isActive=function(){return this._active},Cu.prototype.disableRotation=function(){this._rotationDisabled=!0},Cu.prototype.enableRotation=function(){this._rotationDisabled=!1};var $i=function(f,c){this._map=f,this._el=f.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};$i.prototype.setZoomRate=function(h){this._defaultZoomRate=h},$i.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},$i.prototype.isEnabled=function(){return!!this._enabled},$i.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},$i.prototype.isZooming=function(){return!!this._zooming},$i.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},$i.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},$i.prototype.wheel=function(h){if(this.isEnabled()){var f=h.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),h.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=h,this._delta-=f,this._active||this._start(h)),h.preventDefault()}},$i.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},$i.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=G.mousePos(this._el,h);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},$i.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,I=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,k=this._startZoom,V=this._easing,Y=!1;if(this._type==="wheel"&&k&&V){var ce=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),ve=V(ce);A=m.number(k,I,ve),ce<1?this._frameId||(this._frameId=!0):Y=!0}else A=I,Y=!0;return this._active=!0,Y&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!Y,zoomDelta:A-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},$i.prototype._smoothOutEasing=function(h){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),A=.27/Math.sqrt(E*E+1e-4)*.01,I=Math.sqrt(.0729-A*A);f=m.bezier(A,I,.25,1)}return this._prevEase={start:m.browser.now(),duration:h,easing:f},f},$i.prototype.blur=function(){this.reset()},$i.prototype.reset=function(){this._active=!1};var ju=function(f,c){this._clickZoom=f,this._tapZoom=c};ju.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ju.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ju.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ju.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pu=function(){this.reset()};pu.prototype.reset=function(){this._active=!1},pu.prototype.blur=function(){this.reset()},pu.prototype.dblclick=function(h,f){return h.preventDefault(),{cameraAnimation:function(d){d.easeTo({duration:300,zoom:d.getZoom()+(h.shiftKey?-1:1),around:d.unproject(f)},{originalEvent:h})}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active};var Ho=function(){this._tap=new Su({numTouches:1,numTaps:1}),this.reset()};Ho.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ho.prototype.touchstart=function(h,f,c){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(h,f,c))},Ho.prototype.touchmove=function(h,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,h.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(h,f,c)},Ho.prototype.touchend=function(h,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(h,f,c)&&(this._tapTime=h.timeStamp)},Ho.prototype.touchcancel=function(){this.reset()},Ho.prototype.enable=function(){this._enabled=!0},Ho.prototype.disable=function(){this._enabled=!1,this.reset()},Ho.prototype.isEnabled=function(){return this._enabled},Ho.prototype.isActive=function(){return this._active};var wu=function(f,c,d){this._el=f,this._mousePan=c,this._touchPan=d};wu.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},wu.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},wu.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},wu.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Wl=function(f,c,d){this._pitchWithRotate=f.pitchWithRotate,this._mouseRotate=c,this._mousePitch=d};Wl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Wl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Wl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Wl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var xs=function(f,c,d,E){this._el=f,this._touchZoom=c,this._touchRotate=d,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0};xs.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},xs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},xs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},xs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},xs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},xs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var cs=function(f){return f.zoom||f.drag||f.pitch||f.rotate},pf=function(h){function f(){h.apply(this,arguments)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f}(m.Event);function si(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var Kn=function(f,c){this._map=f,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new of(f),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),m.bindAll(["handleEvent","handleWindowEvent"],this);var d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[m.window,"blur",void 0]];for(var E=0,A=this._listeners;E<A.length;E+=1){var I=A[E],k=I[0];G.addEventListener(k,I[1],k===m.window.document?this.handleWindowEvent:this.handleEvent,I[2])}};Kn.prototype.destroy=function(){for(var h=0,f=this._listeners;h<f.length;h+=1){var c=f[h],d=c[0];G.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Kn.prototype._addDefaultHandlers=function(h){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new Xi(f,h));var d=f.boxZoom=new Os(f,h);this._add("boxZoom",d);var E=new Is,A=new pu;f.doubleClickZoom=new ju(A,E),this._add("tapZoom",E),this._add("clickZoom",A);var I=new Ho;this._add("tapDragZoom",I);var k=f.touchPitch=new Uf;this._add("touchPitch",k);var V=new Fo(h),Y=new zf(h);f.dragRotate=new Wl(h,V,Y),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]);var ce=new Hl(h),ve=new hu(h);f.dragPan=new wu(c,ce,ve),this._add("mousePan",ce),this._add("touchPan",ve,["touchZoom","touchRotate"]);var ye=new ch,ze=new tu;f.touchZoomRotate=new xs(c,ze,ye,I),this._add("touchRotate",ye,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]);var Fe=f.scrollZoom=new $i(f,this);this._add("scrollZoom",Fe,["mousePan"]);var $e=f.keyboard=new Cu;this._add("keyboard",$e),this._add("blockableMapEvent",new Ln(f));for(var Ne=0,Ze=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ne<Ze.length;Ne+=1){var St=Ze[Ne];h.interactive&&h[St]&&f[St].enable(h[St])}},Kn.prototype._add=function(h,f,c){this._handlers.push({handlerName:h,handler:f,allowed:c}),this._handlersById[h]=f},Kn.prototype.stop=function(h){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},Kn.prototype.isActive=function(){for(var h=0,f=this._handlers;h<f.length;h+=1)if(f[h].handler.isActive())return!0;return!1},Kn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Kn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Kn.prototype.isMoving=function(){return Boolean(cs(this._eventsInProgress))||this.isZooming()},Kn.prototype._blockedByActive=function(h,f,c){for(var d in h)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Kn.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},Kn.prototype._getMapTouches=function(h){for(var f=[],c=0,d=h;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Kn.prototype.handleEvent=function(h,f){this._updatingCamera=!0;for(var c=h.type==="renderFrame"?void 0:h,d={needsRenderFrame:!1},E={},A={},I=h.touches?this._getMapTouches(h.touches):void 0,k=I?G.touchPos(this._el,I):G.mousePos(this._el,h),V=0,Y=this._handlers;V<Y.length;V+=1){var ce=Y[V],ve=ce.handlerName,ye=ce.handler,ze=ce.allowed;if(ye.isEnabled()){var Fe=void 0;this._blockedByActive(A,ze,ve)?ye.reset():ye[f||h.type]&&(Fe=ye[f||h.type](h,k,I),this.mergeHandlerResult(d,E,Fe,ve,c),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||ye.isActive())&&(A[ve]=ye)}}var $e={};for(var Ne in this._previousActiveHandlers)A[Ne]||($e[Ne]=c);this._previousActiveHandlers=A,(Object.keys($e).length||si(d))&&(this._changes.push([d,E,$e]),this._triggerRenderFrame()),(Object.keys(A).length||si(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ze=d.cameraAnimation;Ze&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ze(this._map))},Kn.prototype.mergeHandlerResult=function(h,f,c,d,E){if(c){m.extend(h,c);var A={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=A),c.panDelta!==void 0&&(f.drag=A),c.pitchDelta!==void 0&&(f.pitch=A),c.bearingDelta!==void 0&&(f.rotate=A)}},Kn.prototype._applyChanges=function(){for(var h={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var A=E[d],I=A[0],k=A[1],V=A[2];I.panDelta&&(h.panDelta=(h.panDelta||new m.Point(0,0))._add(I.panDelta)),I.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(h.around=I.around),I.pinchAround!==void 0&&(h.pinchAround=I.pinchAround),I.noInertia&&(h.noInertia=I.noInertia),m.extend(f,k),m.extend(c,V)}this._updateMapTransform(h,f,c),this._changes=[]},Kn.prototype._updateMapTransform=function(h,f,c){var d=this._map,E=d.transform;if(!si(h))return this._fireEvents(f,c,!0);var A=h.panDelta,I=h.zoomDelta,k=h.bearingDelta,V=h.pitchDelta,Y=h.around,ce=h.pinchAround;ce!==void 0&&(Y=ce),d._stop(!0),Y=Y||d.transform.centerPoint;var ve=E.pointLocation(A?Y.sub(A):Y);k&&(E.bearing+=k),V&&(E.pitch+=V),I&&(E.zoom+=I),E.setLocationAtPoint(ve,Y),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(f,c,!0)},Kn.prototype._fireEvents=function(h,f,c){var d=this,E=cs(this._eventsInProgress),A=cs(h),I={};for(var k in h)this._eventsInProgress[k]||(I[k+"start"]=h[k].originalEvent),this._eventsInProgress[k]=h[k];for(var V in!E&&A&&this._fireEvent("movestart",A.originalEvent),I)this._fireEvent(V,I[V]);for(var Y in A&&this._fireEvent("move",A.originalEvent),h)this._fireEvent(Y,h[Y].originalEvent);var ce,ve={};for(var ye in this._eventsInProgress){var ze=this._eventsInProgress[ye],Fe=ze.handlerName,$e=ze.originalEvent;this._handlersById[Fe].isActive()||(delete this._eventsInProgress[ye],ve[ye+"end"]=ce=f[Fe]||$e)}for(var Ne in ve)this._fireEvent(Ne,ve[Ne]);var Ze=cs(this._eventsInProgress);if(c&&(E||A)&&!Ze){this._updatingCamera=!0;var St=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),mt=function(Qt){return Qt!==0&&-d._bearingSnap<Qt&&Qt<d._bearingSnap};St?(mt(St.bearing||this._map.getBearing())&&(St.bearing=0),this._map.easeTo(St,{originalEvent:ce})):(this._map.fire(new m.Event("moveend",{originalEvent:ce})),mt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Kn.prototype._fireEvent=function(h,f){this._map.fire(new m.Event(h,f?{originalEvent:f}:{}))},Kn.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete h._frameId,h.handleEvent(new pf("renderFrame",{timeStamp:f})),h._applyChanges()})},Kn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var df=function(h){function f(c,d){h.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,A){var I={top:0,bottom:0,right:0,left:0};if(typeof(A=m.extend({padding:I,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var k=A.padding;A.padding={top:k,bottom:k,right:k,left:k}}A.padding=m.extend(I,A.padding);var V=this.transform,Y=V.padding,ce=V.project(m.LngLat.convert(c)),ve=V.project(m.LngLat.convert(d)),ye=ce.rotate(-E*Math.PI/180),ze=ve.rotate(-E*Math.PI/180),Fe=new m.Point(Math.max(ye.x,ze.x),Math.max(ye.y,ze.y)),$e=new m.Point(Math.min(ye.x,ze.x),Math.min(ye.y,ze.y)),Ne=Fe.sub($e),Ze=(V.width-(Y.left+Y.right+A.padding.left+A.padding.right))/Ne.x,St=(V.height-(Y.top+Y.bottom+A.padding.top+A.padding.bottom))/Ne.y;if(!(St<0||Ze<0)){var mt=Math.min(V.scaleZoom(V.scale*Math.min(Ze,St)),A.maxZoom),lr=typeof A.offset.x=="number"?new m.Point(A.offset.x,A.offset.y):m.Point.convert(A.offset),Qt=new m.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(E*Math.PI/180),fr=lr.add(Qt).mult(V.scale/V.zoomScale(mt));return{center:V.unproject(ce.add(ve).div(2).sub(fr)),zoom:mt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,A,I){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,A),A,I)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,A=!1,I=!1,k=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(A=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(I=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(k=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),A&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),I&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),k&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var A=this.transform,I=this.getZoom(),k=this.getBearing(),V=this.getPitch(),Y=this.getPadding(),ce="zoom"in c?+c.zoom:I,ve="bearing"in c?this._normalizeBearing(c.bearing,k):k,ye="pitch"in c?+c.pitch:V,ze="padding"in c?c.padding:A.padding,Fe=m.Point.convert(c.offset),$e=A.centerPoint.add(Fe),Ne=A.pointLocation($e),Ze=m.LngLat.convert(c.center||Ne);this._normalizeCenter(Ze);var St,mt,lr=A.project(Ne),Qt=A.project(Ze).sub(lr),fr=A.zoomScale(ce-I);c.around&&(St=m.LngLat.convert(c.around),mt=A.locationPoint(St));var _r={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ce!==I,this._rotating=this._rotating||k!==ve,this._pitching=this._pitching||ye!==V,this._padding=!A.isPaddingEqual(ze),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,_r),this._ease(function(Yr){if(E._zooming&&(A.zoom=m.number(I,ce,Yr)),E._rotating&&(A.bearing=m.number(k,ve,Yr)),E._pitching&&(A.pitch=m.number(V,ye,Yr)),E._padding&&(A.interpolatePadding(Y,ze,Yr),$e=A.centerPoint.add(Fe)),St)A.setLocationAtPoint(St,mt);else{var $r=A.zoomScale(A.zoom-I),cn=ce>I?Math.min(2,fr):Math.max(.5,fr),Zn=Math.pow(cn,1-Yr),ai=A.unproject(lr.add(Qt.mult(Yr*Zn)).mult($r));A.setLocationAtPoint(A.renderWorldCopies?ai.wrap():ai,$e)}E._fireMoveEvents(d)},function(Yr){E._afterEase(d,Yr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,A=this._rotating,I=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),A&&this.fire(new m.Event("rotateend",c)),I&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var A=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var I=this.transform,k=this.getZoom(),V=this.getBearing(),Y=this.getPitch(),ce=this.getPadding(),ve="zoom"in c?m.clamp(+c.zoom,I.minZoom,I.maxZoom):k,ye="bearing"in c?this._normalizeBearing(c.bearing,V):V,ze="pitch"in c?+c.pitch:Y,Fe="padding"in c?c.padding:I.padding,$e=I.zoomScale(ve-k),Ne=m.Point.convert(c.offset),Ze=I.centerPoint.add(Ne),St=I.pointLocation(Ze),mt=m.LngLat.convert(c.center||St);this._normalizeCenter(mt);var lr=I.project(St),Qt=I.project(mt).sub(lr),fr=c.curve,_r=Math.max(I.width,I.height),Yr=_r/$e,$r=Qt.mag();if("minZoom"in c){var cn=m.clamp(Math.min(c.minZoom,k,ve),I.minZoom,I.maxZoom),Zn=_r/I.zoomScale(cn-k);fr=Math.sqrt(Zn/$r*2)}var ai=fr*fr;function pi(fi){var Di=(Yr*Yr-_r*_r+(fi?-1:1)*ai*ai*$r*$r)/(2*(fi?Yr:_r)*ai*$r);return Math.log(Math.sqrt(Di*Di+1)-Di)}function Ui(fi){return(Math.exp(fi)-Math.exp(-fi))/2}function zi(fi){return(Math.exp(fi)+Math.exp(-fi))/2}var Bn=pi(0),Ei=function(Di){return zi(Bn)/zi(Bn+fr*Di)},Oi=function(Di){return _r*((zi(Bn)*(Ui(Ji=Bn+fr*Di)/zi(Ji))-Ui(Bn))/ai)/$r;var Ji},ei=(pi(1)-Bn)/fr;if(Math.abs($r)<1e-6||!isFinite(ei)){if(Math.abs(_r-Yr)<1e-6)return this.easeTo(c,d);var vi=Yr<_r?-1:1;ei=Math.abs(Math.log(Yr/_r))/fr,Oi=function(){return 0},Ei=function(Di){return Math.exp(vi*fr*Di)}}return c.duration="duration"in c?+c.duration:1e3*ei/("screenSpeed"in c?+c.screenSpeed/fr:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=V!==ye,this._pitching=ze!==Y,this._padding=!I.isPaddingEqual(Fe),this._prepareEase(d,!1),this._ease(function(fi){var Di=fi*ei,Ji=1/Ei(Di);I.zoom=fi===1?ve:k+I.scaleZoom(Ji),E._rotating&&(I.bearing=m.number(V,ye,fi)),E._pitching&&(I.pitch=m.number(Y,ze,fi)),E._padding&&(I.interpolatePadding(ce,Fe,fi),Ze=I.centerPoint.add(Ne));var yo=fi===1?mt:I.unproject(lr.add(Qt.mult(Oi(Di))).mult(Ji));I.setLocationAtPoint(I.renderWorldCopies?yo.wrap():yo,Ze),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var A=this.handlers;A&&A.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),bs=function(f){f===void 0&&(f={}),this.options=f,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};bs.prototype.getDefaultPosition=function(){return"bottom-right"},bs.prototype.onAdd=function(h){var f=this.options&&this.options.compact;return this._map=h,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=G.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},bs.prototype.onRemove=function(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},bs.prototype._setElementTitle=function(h,f){var c=this._map._getUIString("AttributionControl."+f);h.title=c,h.setAttribute("aria-label",c)},bs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},bs.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(h){var c=f.reduce(function(d,E,A){return E.value&&(d+=E.key+"="+E.value+(A<f.length-1?"&":"")),d},"?");h.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},bs.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},bs.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var A=E.getSource();A.attribution&&h.indexOf(A.attribution)<0&&h.push(A.attribution)}}h.sort(function(k,V){return k.length-V.length});var I=(h=h.filter(function(k,V){for(var Y=V+1;Y<h.length;Y++)if(h[Y].indexOf(k)>=0)return!1;return!0})).join(" | ");I!==this._attribHTML&&(this._attribHTML=I,h.length?(this._innerContainer.innerHTML=I,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},bs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var du=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};du.prototype.onAdd=function(h){this._map=h,this._container=G.create("div","mapboxgl-ctrl");var f=G.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},du.prototype.onRemove=function(){G.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},du.prototype.getDefaultPosition=function(){return"bottom-left"},du.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},du.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var f in h)if(h[f].getSource().mapbox_logo)return!0;return!1}},du.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var f=h[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Jo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Jo.prototype.add=function(h){var f=++this._id;return this._queue.push({callback:h,id:f,cancelled:!1}),f},Jo.prototype.remove=function(h){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===h)return void(E.cancelled=!0)}},Jo.prototype.run=function(h){h===void 0&&(h=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Jo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Vu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Vf=m.window.HTMLImageElement,ru=m.window.HTMLElement,la=m.window.ImageBitmap,es={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},sl=function(h){function f(d){var E=this;if((d=m.extend({},es,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new Qi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(h.call(this,A,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Jo,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},Vu,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof ru))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Kn(this,d),this._hash=d.hash&&new Ms(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new bs({customAttribution:d.customAttribution})),this.addControl(new du,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(I){E._update(I.dataType==="style"),E.fire(new m.Event(I.dataType+"data",I))}),this.on("dataloading",function(I){E.fire(new m.Event(I.dataType+"dataloading",I))})}h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=d.onAdd(this);this._controls.push(d);var I=this._controlPositions[E];return E.indexOf("bottom")!==-1?I.insertBefore(A,I.firstChild):I.appendChild(A),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),A=E[0],I=E[1];if(A===this.transform.width&&I===this.transform.height)return this;this._resizeCanvas(A,I),this.transform.resize(A,I),this.painter.resize(A,I);var k=!this._moving;return k&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),k&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,A){var I,k=this;if(d==="mouseenter"||d==="mouseover"){var V=!1;return{layer:E,listener:A,delegates:{mousemove:function(ve){var ye=k.getLayer(E)?k.queryRenderedFeatures(ve.point,{layers:[E]}):[];ye.length?V||(V=!0,A.call(k,new ha(d,k,ve.originalEvent,{features:ye}))):V=!1},mouseout:function(){V=!1}}}}if(d==="mouseleave"||d==="mouseout"){var Y=!1;return{layer:E,listener:A,delegates:{mousemove:function(ve){(k.getLayer(E)?k.queryRenderedFeatures(ve.point,{layers:[E]}):[]).length?Y=!0:Y&&(Y=!1,A.call(k,new ha(d,k,ve.originalEvent)))},mouseout:function(ve){Y&&(Y=!1,A.call(k,new ha(d,k,ve.originalEvent)))}}}}return{layer:E,listener:A,delegates:(I={},I[d]=function(ce){var ve=k.getLayer(E)?k.queryRenderedFeatures(ce.point,{layers:[E]}):[];ve.length&&(ce.features=ve,A.call(k,ce),delete ce.features)},I)}},f.prototype.on=function(d,E,A){if(A===void 0)return h.prototype.on.call(this,d,E);var I=this._createDelegatedListener(d,E,A);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(I),I.delegates)this.on(k,I.delegates[k]);return this},f.prototype.once=function(d,E,A){if(A===void 0)return h.prototype.once.call(this,d,E);var I=this._createDelegatedListener(d,E,A);for(var k in I.delegates)this.once(k,I.delegates[k]);return this},f.prototype.off=function(d,E,A){var I=this;return A===void 0?h.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(k){for(var V=k[d],Y=0;Y<V.length;Y++){var ce=V[Y];if(ce.layer===E&&ce.listener===A){for(var ve in ce.delegates)I.off(ve,ce.delegates[ve]);return V.splice(Y,1),I}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var A;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")A=[m.Point.convert(d)];else{var I=m.Point.convert(d[0]),k=m.Point.convert(d[1]);A=[I,new m.Point(k.x,I.y),k,new m.Point(I.x,k.y),I]}return this.style.queryRenderedFeatures(A,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new Ga(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ga(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var A=this;if(typeof d=="string"){var I=this._requestManager.normalizeStyleURL(d),k=this._requestManager.transformRequest(I,m.ResourceType.Style);m.getJSON(k,function(V,Y){V?A.fire(new m.ErrorEvent(V)):Y&&A._updateDiff(Y,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(A){m.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var A=d[E]._tiles;for(var I in A){var k=A[I];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,A)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,A){A===void 0&&(A={});var I=A.pixelRatio;I===void 0&&(I=1);var k=A.sdf;k===void 0&&(k=!1);var V=A.stretchX,Y=A.stretchY,ce=A.content;if(this._lazyInitEmptyStyle(),E instanceof Vf||la&&E instanceof la){var ve=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:ve.width,height:ve.height},ve.data),pixelRatio:I,stretchX:V,stretchY:Y,content:ce,sdf:k,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ye=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:I,stretchX:V,stretchY:Y,content:ce,sdf:k,version:0,userImage:ye}),ye.onAdd&&ye.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var A=this.style.getImage(d);if(!A)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var I=E instanceof Vf||la&&E instanceof la?m.browser.getImageData(E):E,k=I.width,V=I.height,Y=I.data;return k===void 0||V===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==A.data.width||V!==A.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(Y,!(E instanceof Vf||la&&E instanceof la)),void this.style.updateImage(d,A))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,A){return this.style.setLayerZoomRange(d,E,A),this._update(!0)},f.prototype.setFilter=function(d,E,A){return A===void 0&&(A={}),this.style.setFilter(d,E,A),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,A,I){return I===void 0&&(I={}),this.style.setPaintProperty(d,E,A,I),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,A,I){return I===void 0&&(I={}),this.style.setLayoutProperty(d,E,A,I),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=G.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=G.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=G.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var I=this._controlContainer=G.create("div","mapboxgl-control-container",d),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(V){k[V]=G.create("div","mapboxgl-ctrl-"+V,I)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var A=m.browser.devicePixelRatio||1;this._canvas.width=A*d,this._canvas.height=A*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},U.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new ro(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,A=this,I=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,E),I=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var V=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var Y=this.transform.zoom,ce=m.browser.now();this.style.zoomHistory.update(Y,ce);var ve=new m.EvaluationParameters(Y,{now:ce,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ye=ve.crossFadingFactor();ye===1&&ye===this._crossFadingFactor||(V=!0,this._crossFadingFactor=ye),this.style.update(ve)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||V)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ze=m.browser.now()-I;k.endQueryEXT(k.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ne=k.getQueryObjectEXT(E,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(E),A.fire(new m.Event("gpu-timing-frame",{cpuTime:ze,gpuTime:Ne}))},50)}if(this.listens("gpu-timing-layer")){var Fe=this.painter.collectGpuTimers();setTimeout(function(){var Ne=A.painter.queryGpuTimers(Fe);A.fire(new m.Event("gpu-timing-layer",{layerTimes:Ne}))},50)}var $e=this._sourcesDirty||this._styleDirty||this._placementDirty;return $e||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||$e||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),Pl(this._canvasContainer),Pl(this._controlContainer),Pl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(df);function Pl(h){h.parentNode&&h.parentNode.removeChild(h)}var Gu={showCompass:!0,showZoom:!0,visualizePitch:!1},Hu=function(f){var c=this;this.options=m.extend({},Gu,f),this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(d){return d.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(d){return c._map.zoomIn({},{originalEvent:d})}),G.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(d){return c._map.zoomOut({},{originalEvent:d})}),G.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(d){c.options.visualizePitch?c._map.resetNorthPitch({},{originalEvent:d}):c._map.resetNorth({},{originalEvent:d})}),this._compassIcon=G.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Hu.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),f=h===this._map.getMaxZoom(),c=h===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Hu.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},Hu.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new nu(this._map,this._compass,this.options.visualizePitch)),this._container},Hu.prototype.onRemove=function(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Hu.prototype._createButton=function(h,f){var c=G.create("button",h,this._container);return c.type="button",c.addEventListener("click",f),c},Hu.prototype._setButtonTitle=function(h,f){var c=this._map._getUIString("NavigationControl."+f);h.title=c,h.setAttribute("aria-label",c)};var nu=function(f,c,d){d===void 0&&(d=!1),this._clickTolerance=10,this.element=c,this.mouseRotate=new Fo({clickTolerance:f.dragRotate._mouseRotate._clickTolerance}),this.map=f,d&&(this.mousePitch=new zf({clickTolerance:f.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),G.addEventListener(c,"mousedown",this.mousedown),G.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(c,"touchmove",this.touchmove),G.addEventListener(c,"touchend",this.touchend),G.addEventListener(c,"touchcancel",this.reset)};function Tc(h,f,c){if(h=new m.LngLat(h.lng,h.lat),f){var d=new m.LngLat(h.lng-360,h.lat),E=new m.LngLat(h.lng+360,h.lat),A=c.locationPoint(h).distSqr(f);c.locationPoint(d).distSqr(f)<A?h=d:c.locationPoint(E).distSqr(f)<A&&(h=E)}for(;Math.abs(h.lng-c.center.lng)>180;){var I=c.locationPoint(h);if(I.x>=0&&I.y>=0&&I.x<=c.width&&I.y<=c.height)break;h.lng>c.center.lng?h.lng-=360:h.lng+=360}return h}nu.prototype.down=function(h,f){this.mouseRotate.mousedown(h,f),this.mousePitch&&this.mousePitch.mousedown(h,f),G.disableDrag()},nu.prototype.move=function(h,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(h,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(h,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},nu.prototype.off=function(){var h=this.element;G.removeEventListener(h,"mousedown",this.mousedown),G.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(h,"touchmove",this.touchmove),G.removeEventListener(h,"touchend",this.touchend),G.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},nu.prototype.offTemp=function(){G.enableDrag(),G.removeEventListener(m.window,"mousemove",this.mousemove),G.removeEventListener(m.window,"mouseup",this.mouseup)},nu.prototype.mousedown=function(h){this.down(m.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),G.mousePos(this.element,h)),G.addEventListener(m.window,"mousemove",this.mousemove),G.addEventListener(m.window,"mouseup",this.mouseup)},nu.prototype.mousemove=function(h){this.move(h,G.mousePos(this.element,h))},nu.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},nu.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},nu.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},nu.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},nu.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vf(h,f,c){var d=h.classList;for(var E in Wu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var Mc,sc=function(h){function f(c,d){if(h.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div"),this._element.setAttribute("aria-label","Map marker");var E=G.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var A=G.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var I=G.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"fill-rule","nonzero");var k=G.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var V=0,Y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];V<Y.length;V+=1){var ce=Y[V],ve=G.createNS("http://www.w3.org/2000/svg","ellipse");ve.setAttributeNS(null,"opacity","0.04"),ve.setAttributeNS(null,"cx","10.5"),ve.setAttributeNS(null,"cy","5.80029008"),ve.setAttributeNS(null,"rx",ce.rx),ve.setAttributeNS(null,"ry",ce.ry),k.appendChild(ve)}var ye=G.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"fill",this._color);var ze=G.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ye.appendChild(ze);var Fe=G.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"opacity","0.25"),Fe.setAttributeNS(null,"fill","#000000");var $e=G.createNS("http://www.w3.org/2000/svg","path");$e.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Fe.appendChild($e);var Ne=G.createNS("http://www.w3.org/2000/svg","g");Ne.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ne.setAttributeNS(null,"fill","#FFFFFF");var Ze=G.createNS("http://www.w3.org/2000/svg","g");Ze.setAttributeNS(null,"transform","translate(8.0, 8.0)");var St=G.createNS("http://www.w3.org/2000/svg","circle");St.setAttributeNS(null,"fill","#000000"),St.setAttributeNS(null,"opacity","0.25"),St.setAttributeNS(null,"cx","5.5"),St.setAttributeNS(null,"cy","5.5"),St.setAttributeNS(null,"r","5.4999962");var mt=G.createNS("http://www.w3.org/2000/svg","circle");mt.setAttributeNS(null,"fill","#FFFFFF"),mt.setAttributeNS(null,"cx","5.5"),mt.setAttributeNS(null,"cy","5.5"),mt.setAttributeNS(null,"r","5.4999962"),Ze.appendChild(St),Ze.appendChild(mt),I.appendChild(k),I.appendChild(ye),I.appendChild(Fe),I.appendChild(Ne),I.appendChild(Ze),E.appendChild(I),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(lr){lr.preventDefault()}),this._element.addEventListener("mousedown",function(lr){lr.preventDefault()}),vf(this._element,this._anchor,"marker"),this._popup=null}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Tc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,Wu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Dh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},mf=0,Pc=!1,fh=function(h){function f(c){h.call(this),this.options=m.extend({},Dh,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Mc!==void 0?d(Mc):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(Mc=E.state!=="denied")}):d(Mc=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,mf=0,Pc=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,A=this._map.getBearing(),I=m.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),I,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),A=d.distanceTo(E),I=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=I+"px",this._circleElement.style.height=I+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&Pc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(I){return I.preventDefault()}),this._geolocateButton=G.create("button","mapboxgl-ctrl-geolocate",this._container),G.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new sc(this._dotElement),this._circleElement=G.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(I){I.geolocateSource||d._watchState!=="ACTIVE_LOCK"||I.originalEvent&&I.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":mf--,Pc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++mf>1?(c={maximumAge:6e5,timeout:0},Pc=!0):(c=this.options.positionOptions,Pc=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),Zl={maxWidth:100,unit:"metric"},_a=function(f){this.options=m.extend({},Zl,f),m.bindAll(["_onMove","setUnit"],this)};function gf(h,f,c){var d=c&&c.maxWidth||100,E=h._container.clientHeight/2,A=h.unproject([0,E]),I=h.unproject([d,E]),k=A.distanceTo(I);if(c&&c.unit==="imperial"){var V=3.2808*k;V>5280?Wn(f,d,V/5280,h._getUIString("ScaleControl.Miles")):Wn(f,d,V,h._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?Wn(f,d,k/1852,h._getUIString("ScaleControl.NauticalMiles")):k>=1e3?Wn(f,d,k/1e3,h._getUIString("ScaleControl.Kilometers")):Wn(f,d,k,h._getUIString("ScaleControl.Meters"))}function Wn(h,f,c,d){var E,A,I,k=(E=c,(A=Math.pow(10,(""+Math.floor(E)).length-1))*(I=(I=E/A)>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(V){var Y=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*Y)/Y}(I)));h.style.width=f*(k/c)+"px",h.innerHTML=k+"&nbsp;"+d}_a.prototype.getDefaultPosition=function(){return"bottom-left"},_a.prototype._onMove=function(){gf(this._map,this._container,this.options)},_a.prototype.onAdd=function(h){return this._map=h,this._container=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},_a.prototype.onRemove=function(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},_a.prototype.setUnit=function(h){this.options.unit=h,gf(this._map,this._container,this.options)};var Au=function(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof m.window.HTMLElement?this._container=f.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};Au.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Au.prototype.onRemove=function(){G.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Au.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},Au.prototype._setupUI=function(){var h=this._fullscreenButton=G.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);G.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Au.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},Au.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Au.prototype._isFullscreen=function(){return this._fullscreen},Au.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Au.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Fh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},uc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Xl=function(h){function f(c){h.call(this),this.options=m.extend(Object.create(Fh),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(f.__proto__=h),(f.prototype=Object.create(h&&h.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),A=m.window.document.createElement("body");for(A.innerHTML=c;d=A.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=G.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=G.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=G.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ve){return d._container.classList.add(ve)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),A=this.options.anchor,I=function ve(ye){if(ye){if(typeof ye=="number"){var ze=Math.round(Math.sqrt(.5*Math.pow(ye,2)));return{center:new m.Point(0,0),top:new m.Point(0,ye),"top-left":new m.Point(ze,ze),"top-right":new m.Point(-ze,ze),bottom:new m.Point(0,-ye),"bottom-left":new m.Point(ze,-ze),"bottom-right":new m.Point(-ze,-ze),left:new m.Point(ye,0),right:new m.Point(-ye,0)}}if(ye instanceof m.Point||Array.isArray(ye)){var Fe=m.Point.convert(ye);return{center:Fe,top:Fe,"top-left":Fe,"top-right":Fe,bottom:Fe,"bottom-left":Fe,"bottom-right":Fe,left:Fe,right:Fe}}return{center:m.Point.convert(ye.center||[0,0]),top:m.Point.convert(ye.top||[0,0]),"top-left":m.Point.convert(ye["top-left"]||[0,0]),"top-right":m.Point.convert(ye["top-right"]||[0,0]),bottom:m.Point.convert(ye.bottom||[0,0]),"bottom-left":m.Point.convert(ye["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(ye["bottom-right"]||[0,0]),left:m.Point.convert(ye.left||[0,0]),right:m.Point.convert(ye.right||[0,0])}}return ve(new m.Point(0,0))}(this.options.offset);if(!A){var k,V=this._container.offsetWidth,Y=this._container.offsetHeight;k=E.y+I.bottom.y<Y?["top"]:E.y>this._map.transform.height-Y?["bottom"]:[],E.x<V/2?k.push("left"):E.x>this._map.transform.width-V/2&&k.push("right"),A=k.length===0?"bottom":k.join("-")}var ce=E.add(I[A]).round();G.setTransform(this._container,Wu[A]+" translate("+ce.x+"px,"+ce.y+"px)"),vf(this._container,A,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(uc);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),yf={version:m.version,supported:U,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:sl,NavigationControl:Hu,GeolocateControl:fh,AttributionControl:bs,ScaleControl:_a,FullscreenControl:Au,Popup:Xl,Marker:sc,Style:Ga,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){rr().acquire(tr)},clearPrewarmedResources:function(){var f=nn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(tr),nn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(h){m.config.ACCESS_TOKEN=h},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(h){m.config.API_URL=h},get workerCount(){return Dr.workerCount},set workerCount(h){Dr.workerCount=h},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){m.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(f){m.clearTileCache(f)},workerUrl:""};return yf}),ne})},"4cb6":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.multiBindToService=K.getServiceIdentifierAsString=K.typeConstraint=K.namedConstraint=K.taggedConstraint=K.traverseAncerstors=K.decorate=K.id=K.MetadataReader=K.postConstruct=K.targetName=K.multiInject=K.unmanaged=K.optional=K.LazyServiceIdentifer=K.inject=K.named=K.tagged=K.injectable=K.ContainerModule=K.AsyncContainerModule=K.TargetTypeEnum=K.BindingTypeEnum=K.BindingScopeEnum=K.Container=K.METADATA_KEY=void 0;var W=O("xfSm");K.METADATA_KEY=W;var re=O("9Fde");Object.defineProperty(K,"Container",{enumerable:!0,get:function(){return re.Container}});var ne=O("FV85");Object.defineProperty(K,"BindingScopeEnum",{enumerable:!0,get:function(){return ne.BindingScopeEnum}}),Object.defineProperty(K,"BindingTypeEnum",{enumerable:!0,get:function(){return ne.BindingTypeEnum}}),Object.defineProperty(K,"TargetTypeEnum",{enumerable:!0,get:function(){return ne.TargetTypeEnum}});var j=O("dxzI");Object.defineProperty(K,"AsyncContainerModule",{enumerable:!0,get:function(){return j.AsyncContainerModule}}),Object.defineProperty(K,"ContainerModule",{enumerable:!0,get:function(){return j.ContainerModule}});var m=O("cZ5Q");Object.defineProperty(K,"injectable",{enumerable:!0,get:function(){return m.injectable}});var U=O("0gSV");Object.defineProperty(K,"tagged",{enumerable:!0,get:function(){return U.tagged}});var G=O("ZzCi");Object.defineProperty(K,"named",{enumerable:!0,get:function(){return G.named}});var Te=O("Yk9n");Object.defineProperty(K,"inject",{enumerable:!0,get:function(){return Te.inject}}),Object.defineProperty(K,"LazyServiceIdentifer",{enumerable:!0,get:function(){return Te.LazyServiceIdentifer}});var xe=O("jYx5");Object.defineProperty(K,"optional",{enumerable:!0,get:function(){return xe.optional}});var Me=O("n2J3");Object.defineProperty(K,"unmanaged",{enumerable:!0,get:function(){return Me.unmanaged}});var Ee=O("jIg/");Object.defineProperty(K,"multiInject",{enumerable:!0,get:function(){return Ee.multiInject}});var Mt=O("oaX6");Object.defineProperty(K,"targetName",{enumerable:!0,get:function(){return Mt.targetName}});var at=O("Sk89");Object.defineProperty(K,"postConstruct",{enumerable:!0,get:function(){return at.postConstruct}});var ht=O("wnjb");Object.defineProperty(K,"MetadataReader",{enumerable:!0,get:function(){return ht.MetadataReader}});var vt=O("d9O0");Object.defineProperty(K,"id",{enumerable:!0,get:function(){return vt.id}});var _t=O("Ztfv");Object.defineProperty(K,"decorate",{enumerable:!0,get:function(){return _t.decorate}});var Ve=O("RR/i");Object.defineProperty(K,"traverseAncerstors",{enumerable:!0,get:function(){return Ve.traverseAncerstors}}),Object.defineProperty(K,"taggedConstraint",{enumerable:!0,get:function(){return Ve.taggedConstraint}}),Object.defineProperty(K,"namedConstraint",{enumerable:!0,get:function(){return Ve.namedConstraint}}),Object.defineProperty(K,"typeConstraint",{enumerable:!0,get:function(){return Ve.typeConstraint}});var xt=O("ujMp");Object.defineProperty(K,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return xt.getServiceIdentifierAsString}});var st=O("78VC");Object.defineProperty(K,"multiBindToService",{enumerable:!0,get:function(){return st.multiBindToService}})},"4qC0":function(He,K,O){var W=O("NykK"),re=O("Z0cm"),ne=O("ExA7"),j="[object String]";function m(U){return typeof U=="string"||!re(U)&&ne(U)&&W(U)==j}He.exports=m},"6AGu":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingInSyntax=void 0;var W=O("FV85"),re=O("LKzl"),ne=function(){function j(m){this._binding=m}return j.prototype.inRequestScope=function(){return this._binding.scope=W.BindingScopeEnum.Request,new re.BindingWhenOnSyntax(this._binding)},j.prototype.inSingletonScope=function(){return this._binding.scope=W.BindingScopeEnum.Singleton,new re.BindingWhenOnSyntax(this._binding)},j.prototype.inTransientScope=function(){return this._binding.scope=W.BindingScopeEnum.Transient,new re.BindingWhenOnSyntax(this._binding)},j}();K.BindingInSyntax=ne},"6D9b":function(He,K,O){},"6acW":function(He,K,O){var W=O("dt0z"),re=O("gQMU");function ne(j){return re(W(j).toLowerCase())}He.exports=ne},"6nK8":function(He,K,O){var W=O("dVn5"),re=O("fo6e"),ne=O("dt0z"),j=O("9NmV");function m(U,G,Te){return U=ne(U),G=Te?void 0:G,G===void 0?re(U)?j(U):W(U):U.match(G)||[]}He.exports=m},"711d":function(He,K){function O(W){return function(re){return re==null?void 0:re[W]}}He.exports=O},"78VC":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.multiBindToService=void 0;var W=function(ne){return function(j){return function(){for(var m=[],U=0;U<arguments.length;U++)m[U]=arguments[U];return m.forEach(function(G){return ne.bind(G).toService(j)})}}};K.multiBindToService=W},"7tbW":function(He,K,O){var W=O("LGYb");function re(ne){return ne&&ne.length?W(ne):[]}He.exports=re},"9Fde":function(He,K,O){"use strict";var W=this&&this.__awaiter||function(Ve,xt,st,it){function N(Re){return Re instanceof st?Re:new st(function(Nr){Nr(Re)})}return new(st||(st=Promise))(function(Re,Nr){function Pr(Bt){try{Oe(it.next(Bt))}catch(Zt){Nr(Zt)}}function Wt(Bt){try{Oe(it.throw(Bt))}catch(Zt){Nr(Zt)}}function Oe(Bt){Bt.done?Re(Bt.value):N(Bt.value).then(Pr,Wt)}Oe((it=it.apply(Ve,xt||[])).next())})},re=this&&this.__generator||function(Ve,xt){var st={label:0,sent:function(){if(Re[0]&1)throw Re[1];return Re[1]},trys:[],ops:[]},it,N,Re,Nr;return Nr={next:Pr(0),throw:Pr(1),return:Pr(2)},typeof Symbol=="function"&&(Nr[Symbol.iterator]=function(){return this}),Nr;function Pr(Oe){return function(Bt){return Wt([Oe,Bt])}}function Wt(Oe){if(it)throw new TypeError("Generator is already executing.");for(;st;)try{if(it=1,N&&(Re=Oe[0]&2?N.return:Oe[0]?N.throw||((Re=N.return)&&Re.call(N),0):N.next)&&!(Re=Re.call(N,Oe[1])).done)return Re;switch(N=0,Re&&(Oe=[Oe[0]&2,Re.value]),Oe[0]){case 0:case 1:Re=Oe;break;case 4:return st.label++,{value:Oe[1],done:!1};case 5:st.label++,N=Oe[1],Oe=[0];continue;case 7:Oe=st.ops.pop(),st.trys.pop();continue;default:if(Re=st.trys,!(Re=Re.length>0&&Re[Re.length-1])&&(Oe[0]===6||Oe[0]===2)){st=0;continue}if(Oe[0]===3&&(!Re||Oe[1]>Re[0]&&Oe[1]<Re[3])){st.label=Oe[1];break}if(Oe[0]===6&&st.label<Re[1]){st.label=Re[1],Re=Oe;break}if(Re&&st.label<Re[2]){st.label=Re[2],st.ops.push(Oe);break}Re[2]&&st.ops.pop(),st.trys.pop();continue}Oe=xt.call(Ve,st)}catch(Bt){Oe=[6,Bt],N=0}finally{it=Re=0}if(Oe[0]&5)throw Oe[1];return{value:Oe[0]?Oe[1]:void 0,done:!0}}},ne=this&&this.__spreadArray||function(Ve,xt){for(var st=0,it=xt.length,N=Ve.length;st<it;st++,N++)Ve[N]=xt[st];return Ve};Object.defineProperty(K,"__esModule",{value:!0}),K.Container=void 0;var j=O("LgvC"),m=O("MON2"),U=O("FV85"),G=O("xfSm"),Te=O("wnjb"),xe=O("h7MG"),Me=O("aPG5"),Ee=O("gzZq"),Mt=O("d9O0"),at=O("ujMp"),ht=O("HpQ9"),vt=O("AwBQ"),_t=function(){function Ve(xt){this._appliedMiddleware=[];var st=xt||{};if(typeof st!="object")throw new Error(""+m.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(st.defaultScope===void 0)st.defaultScope=U.BindingScopeEnum.Transient;else if(st.defaultScope!==U.BindingScopeEnum.Singleton&&st.defaultScope!==U.BindingScopeEnum.Transient&&st.defaultScope!==U.BindingScopeEnum.Request)throw new Error(""+m.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(st.autoBindInjectable===void 0)st.autoBindInjectable=!1;else if(typeof st.autoBindInjectable!="boolean")throw new Error(""+m.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(st.skipBaseClassChecks===void 0)st.skipBaseClassChecks=!1;else if(typeof st.skipBaseClassChecks!="boolean")throw new Error(""+m.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:st.autoBindInjectable,defaultScope:st.defaultScope,skipBaseClassChecks:st.skipBaseClassChecks},this.id=Mt.id(),this._bindingDictionary=new vt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Te.MetadataReader}return Ve.merge=function(xt,st){for(var it=[],N=2;N<arguments.length;N++)it[N-2]=arguments[N];var Re=new Ve,Nr=ne([xt,st],it).map(function(Oe){return xe.getBindingDictionary(Oe)}),Pr=xe.getBindingDictionary(Re);function Wt(Oe,Bt){Oe.traverse(function(Zt,ir){ir.forEach(function(Fr){Bt.add(Fr.serviceIdentifier,Fr.clone())})})}return Nr.forEach(function(Oe){Wt(Oe,Pr)}),Re},Ve.prototype.load=function(){for(var xt=[],st=0;st<arguments.length;st++)xt[st]=arguments[st];for(var it=this._getContainerModuleHelpersFactory(),N=0,Re=xt;N<Re.length;N++){var Nr=Re[N],Pr=it(Nr.id);Nr.registry(Pr.bindFunction,Pr.unbindFunction,Pr.isboundFunction,Pr.rebindFunction)}},Ve.prototype.loadAsync=function(){for(var xt=[],st=0;st<arguments.length;st++)xt[st]=arguments[st];return W(this,void 0,void 0,function(){var it,N,Re,Nr,Pr;return re(this,function(Wt){switch(Wt.label){case 0:it=this._getContainerModuleHelpersFactory(),N=0,Re=xt,Wt.label=1;case 1:return N<Re.length?(Nr=Re[N],Pr=it(Nr.id),[4,Nr.registry(Pr.bindFunction,Pr.unbindFunction,Pr.isboundFunction,Pr.rebindFunction)]):[3,4];case 2:Wt.sent(),Wt.label=3;case 3:return N++,[3,1];case 4:return[2]}})})},Ve.prototype.unload=function(){for(var xt=this,st=[],it=0;it<arguments.length;it++)st[it]=arguments[it];var N=function(Nr){return function(Pr){return Pr.moduleId===Nr}};st.forEach(function(Re){var Nr=N(Re.id);xt._bindingDictionary.removeByCondition(Nr)})},Ve.prototype.bind=function(xt){var st=this.options.defaultScope||U.BindingScopeEnum.Transient,it=new j.Binding(xt,st);return this._bindingDictionary.add(xt,it),new Ee.BindingToSyntax(it)},Ve.prototype.rebind=function(xt){return this.unbind(xt),this.bind(xt)},Ve.prototype.unbind=function(xt){try{this._bindingDictionary.remove(xt)}catch(st){throw new Error(m.CANNOT_UNBIND+" "+at.getServiceIdentifierAsString(xt))}},Ve.prototype.unbindAll=function(){this._bindingDictionary=new vt.Lookup},Ve.prototype.isBound=function(xt){var st=this._bindingDictionary.hasKey(xt);return!st&&this.parent&&(st=this.parent.isBound(xt)),st},Ve.prototype.isBoundNamed=function(xt,st){return this.isBoundTagged(xt,G.NAMED_TAG,st)},Ve.prototype.isBoundTagged=function(xt,st,it){var N=!1;if(this._bindingDictionary.hasKey(xt)){var Re=this._bindingDictionary.get(xt),Nr=xe.createMockRequest(this,xt,st,it);N=Re.some(function(Pr){return Pr.constraint(Nr)})}return!N&&this.parent&&(N=this.parent.isBoundTagged(xt,st,it)),N},Ve.prototype.snapshot=function(){this._snapshots.push(ht.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},Ve.prototype.restore=function(){var xt=this._snapshots.pop();if(xt===void 0)throw new Error(m.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=xt.bindings,this._middleware=xt.middleware},Ve.prototype.createChild=function(xt){var st=new Ve(xt||this.options);return st.parent=this,st},Ve.prototype.applyMiddleware=function(){for(var xt=[],st=0;st<arguments.length;st++)xt[st]=arguments[st];this._appliedMiddleware=this._appliedMiddleware.concat(xt);var it=this._middleware?this._middleware:this._planAndResolve();this._middleware=xt.reduce(function(N,Re){return Re(N)},it)},Ve.prototype.applyCustomMetadataReader=function(xt){this._metadataReader=xt},Ve.prototype.get=function(xt){return this._get(!1,!1,U.TargetTypeEnum.Variable,xt)},Ve.prototype.getTagged=function(xt,st,it){return this._get(!1,!1,U.TargetTypeEnum.Variable,xt,st,it)},Ve.prototype.getNamed=function(xt,st){return this.getTagged(xt,G.NAMED_TAG,st)},Ve.prototype.getAll=function(xt){return this._get(!0,!0,U.TargetTypeEnum.Variable,xt)},Ve.prototype.getAllTagged=function(xt,st,it){return this._get(!1,!0,U.TargetTypeEnum.Variable,xt,st,it)},Ve.prototype.getAllNamed=function(xt,st){return this.getAllTagged(xt,G.NAMED_TAG,st)},Ve.prototype.resolve=function(xt){var st=this.createChild();return st.bind(xt).toSelf(),this._appliedMiddleware.forEach(function(it){st.applyMiddleware(it)}),st.get(xt)},Ve.prototype._getContainerModuleHelpersFactory=function(){var xt=this,st=function(Wt,Oe){Wt._binding.moduleId=Oe},it=function(Wt){return function(Oe){var Bt=xt.bind.bind(xt),Zt=Bt(Oe);return st(Zt,Wt),Zt}},N=function(Wt){return function(Oe){var Bt=xt.unbind.bind(xt);Bt(Oe)}},Re=function(Wt){return function(Oe){var Bt=xt.isBound.bind(xt);return Bt(Oe)}},Nr=function(Wt){return function(Oe){var Bt=xt.rebind.bind(xt),Zt=Bt(Oe);return st(Zt,Wt),Zt}};return function(Pr){return{bindFunction:it(Pr),isboundFunction:Re(Pr),rebindFunction:Nr(Pr),unbindFunction:N(Pr)}}},Ve.prototype._get=function(xt,st,it,N,Re,Nr){var Pr=null,Wt={avoidConstraints:xt,contextInterceptor:function(Bt){return Bt},isMultiInject:st,key:Re,serviceIdentifier:N,targetType:it,value:Nr};if(this._middleware){if(Pr=this._middleware(Wt),Pr==null)throw new Error(m.INVALID_MIDDLEWARE_RETURN)}else Pr=this._planAndResolve()(Wt);return Pr},Ve.prototype._planAndResolve=function(){var xt=this;return function(st){var it=xe.plan(xt._metadataReader,xt,st.isMultiInject,st.targetType,st.serviceIdentifier,st.key,st.value,st.avoidConstraints);it=st.contextInterceptor(it);var N=Me.resolve(it);return N}},Ve}();K.Container=_t},"9NmV":function(He,K){var O="\\ud800-\\udfff",W="\\u0300-\\u036f",re="\\ufe20-\\ufe2f",ne="\\u20d0-\\u20ff",j=W+re+ne,m="\\u2700-\\u27bf",U="a-z\\xdf-\\xf6\\xf8-\\xff",G="\\xac\\xb1\\xd7\\xf7",Te="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",xe="\\u2000-\\u206f",Me=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ee="A-Z\\xc0-\\xd6\\xd8-\\xde",Mt="\\ufe0e\\ufe0f",at=G+Te+xe+Me,ht="['\u2019]",vt="["+at+"]",_t="["+j+"]",Ve="\\d+",xt="["+m+"]",st="["+U+"]",it="[^"+O+at+Ve+m+U+Ee+"]",N="\\ud83c[\\udffb-\\udfff]",Re="(?:"+_t+"|"+N+")",Nr="[^"+O+"]",Pr="(?:\\ud83c[\\udde6-\\uddff]){2}",Wt="[\\ud800-\\udbff][\\udc00-\\udfff]",Oe="["+Ee+"]",Bt="\\u200d",Zt="(?:"+st+"|"+it+")",ir="(?:"+Oe+"|"+it+")",Fr="(?:"+ht+"(?:d|ll|m|re|s|t|ve))?",qr="(?:"+ht+"(?:D|LL|M|RE|S|T|VE))?",br=Re+"?",fe="["+Mt+"]?",Pe="(?:"+Bt+"(?:"+[Nr,Pr,Wt].join("|")+")"+fe+br+")*",Se="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",lt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ut=fe+br+Pe,Ot="(?:"+[xt,Pr,Wt].join("|")+")"+ut,wt=RegExp([Oe+"?"+st+"+"+Fr+"(?="+[vt,Oe,"$"].join("|")+")",ir+"+"+qr+"(?="+[vt,Oe+Zt,"$"].join("|")+")",Oe+"?"+Zt+"+"+Fr,Oe+"+"+qr,lt,Se,Ve,Ot].join("|"),"g");function sr(Or){return Or.match(wt)||[]}He.exports=sr},"9nhX":function(He,K,O){var W=O("g4R6"),re=O("tLB3");function ne(j,m,U){return U===void 0&&(U=m,m=void 0),U!==void 0&&(U=re(U),U=U===U?U:0),m!==void 0&&(m=re(m),m=m===m?m:0),W(re(j),m,U)}He.exports=ne},APxj:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0});var W=O("Ucsi");function re(ne,j){j===void 0&&(j=!0);var m=W.makePropertyInjectDecorator(ne,j),U=W.makePropertyInjectNamedDecorator(ne,j),G=W.makePropertyInjectTaggedDecorator(ne,j),Te=W.makePropertyMultiInjectDecorator(ne,j);return{lazyInject:m,lazyInjectNamed:U,lazyInjectTagged:G,lazyMultiInject:Te}}K.default=re},AfwI:function(He,K,O){var W;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(re,ne,j,m){"use strict";var U=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,G=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Te=U||G,xe=["","webkit","Moz","MS","ms","o"],Me=Te?"":ne.createElement("div"),Ee="function",Mt=Math.round,at=Math.abs,ht=Date.now;function vt(We,se,Be){return setTimeout(Nr(We,Be),se)}function _t(We,se,Be){return Array.isArray(We)?(Ve(We,Be[se],Be),!0):!1}function Ve(We,se,Be){var Rt;if(!!We)if(We.forEach)We.forEach(se,Be);else if(We.length!==m)for(Rt=0;Rt<We.length;)se.call(Be,We[Rt],Rt,We),Rt++;else for(Rt in We)We.hasOwnProperty(Rt)&&se.call(Be,We[Rt],Rt,We)}function xt(We,se,Be){var Rt="DEPRECATED METHOD: "+se+`
`+Be+` AT 
`;return function(){var Zr=new Error("get-stack-trace"),kn=Zr&&Zr.stack?Zr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ni=re.console&&(re.console.warn||re.console.log);return Ni&&Ni.call(re.console,Rt,kn),We.apply(this,arguments)}}var st;typeof Object.assign!="function"?st=function(se){if(se===m||se===null)throw new TypeError("Cannot convert undefined or null to object");for(var Be=Object(se),Rt=1;Rt<arguments.length;Rt++){var Zr=arguments[Rt];if(Zr!==m&&Zr!==null)for(var kn in Zr)Zr.hasOwnProperty(kn)&&(Be[kn]=Zr[kn])}return Be}:st=Object.assign;var it=xt(function(se,Be,Rt){for(var Zr=Object.keys(Be),kn=0;kn<Zr.length;)(!Rt||Rt&&se[Zr[kn]]===m)&&(se[Zr[kn]]=Be[Zr[kn]]),kn++;return se},"extend","Use `assign`."),N=xt(function(se,Be){return it(se,Be,!0)},"merge","Use `assign`.");function Re(We,se,Be){var Rt=se.prototype,Zr;Zr=We.prototype=Object.create(Rt),Zr.constructor=We,Zr._super=Rt,Be&&st(Zr,Be)}function Nr(We,se){return function(){return We.apply(se,arguments)}}function Pr(We,se){return typeof We==Ee?We.apply(se&&se[0]||m,se):We}function Wt(We,se){return We===m?se:We}function Oe(We,se,Be){Ve(Fr(se),function(Rt){We.addEventListener(Rt,Be,!1)})}function Bt(We,se,Be){Ve(Fr(se),function(Rt){We.removeEventListener(Rt,Be,!1)})}function Zt(We,se){for(;We;){if(We==se)return!0;We=We.parentNode}return!1}function ir(We,se){return We.indexOf(se)>-1}function Fr(We){return We.trim().split(/\s+/g)}function qr(We,se,Be){if(We.indexOf&&!Be)return We.indexOf(se);for(var Rt=0;Rt<We.length;){if(Be&&We[Rt][Be]==se||!Be&&We[Rt]===se)return Rt;Rt++}return-1}function br(We){return Array.prototype.slice.call(We,0)}function fe(We,se,Be){for(var Rt=[],Zr=[],kn=0;kn<We.length;){var Ni=se?We[kn][se]:We[kn];qr(Zr,Ni)<0&&Rt.push(We[kn]),Zr[kn]=Ni,kn++}return Be&&(se?Rt=Rt.sort(function(Ma,Xa){return Ma[se]>Xa[se]}):Rt=Rt.sort()),Rt}function Pe(We,se){for(var Be,Rt,Zr=se[0].toUpperCase()+se.slice(1),kn=0;kn<xe.length;){if(Be=xe[kn],Rt=Be?Be+Zr:se,Rt in We)return Rt;kn++}return m}var Se=1;function lt(){return Se++}function ut(We){var se=We.ownerDocument||We;return se.defaultView||se.parentWindow||re}var Ot=/mobile|tablet|ip(ad|hone|od)|android/i,wt="ontouchstart"in re,sr=Pe(re,"PointerEvent")!==m,Or=wt&&Ot.test(navigator.userAgent),Nt="touch",Tt="pen",It="mouse",$t="kinect",gr=25,qt=1,dr=2,Ur=4,Ir=8,ur=1,Rr=2,Yn=4,un=8,_n=16,qn=Rr|Yn,oi=un|_n,Gi=qn|oi,he=["x","y"],Fn=["clientX","clientY"];function Li(We,se){var Be=this;this.manager=We,this.callback=se,this.element=We.element,this.target=We.options.inputTarget,this.domHandler=function(Rt){Pr(We.options.enable,[We])&&Be.handler(Rt)},this.init()}Li.prototype={handler:function(){},init:function(){this.evEl&&Oe(this.element,this.evEl,this.domHandler),this.evTarget&&Oe(this.target,this.evTarget,this.domHandler),this.evWin&&Oe(ut(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Bt(this.element,this.evEl,this.domHandler),this.evTarget&&Bt(this.target,this.evTarget,this.domHandler),this.evWin&&Bt(ut(this.element),this.evWin,this.domHandler)}};function Ko(We){var se,Be=We.options.inputClass;return Be?se=Be:sr?se=le:Or?se=Cr:wt?se=nn:se=As,new se(We,us)}function us(We,se,Be){var Rt=Be.pointers.length,Zr=Be.changedPointers.length,kn=se&qt&&Rt-Zr==0,Ni=se&(Ur|Ir)&&Rt-Zr==0;Be.isFirst=!!kn,Be.isFinal=!!Ni,kn&&(We.session={}),Be.eventType=se,Ut(We,Be),We.emit("hammer.input",Be),We.recognize(Be),We.session.prevInput=Be}function Ut(We,se){var Be=We.session,Rt=se.pointers,Zr=Rt.length;Be.firstInput||(Be.firstInput=dn(se)),Zr>1&&!Be.firstMultiple?Be.firstMultiple=dn(se):Zr===1&&(Be.firstMultiple=!1);var kn=Be.firstInput,Ni=Be.firstMultiple,Na=Ni?Ni.center:kn.center,Ma=se.center=Kr(Rt);se.timeStamp=ht(),se.deltaTime=se.timeStamp-kn.timeStamp,se.angle=ii(Na,Ma),se.distance=Hn(Na,Ma),Er(Be,se),se.offsetDirection=li(se.deltaX,se.deltaY);var Xa=Ia(se.deltaTime,se.deltaX,se.deltaY);se.overallVelocityX=Xa.x,se.overallVelocityY=Xa.y,se.overallVelocity=at(Xa.x)>at(Xa.y)?Xa.x:Xa.y,se.scale=Ni?Wi(Ni.pointers,Rt):1,se.rotation=Ni?Hi(Ni.pointers,Rt):0,se.maxPointers=Be.prevInput?se.pointers.length>Be.prevInput.maxPointers?se.pointers.length:Be.prevInput.maxPointers:se.pointers.length,Hr(Be,se);var Do=We.element;Zt(se.srcEvent.target,Do)&&(Do=se.srcEvent.target),se.target=Do}function Er(We,se){var Be=se.center,Rt=We.offsetDelta||{},Zr=We.prevDelta||{},kn=We.prevInput||{};(se.eventType===qt||kn.eventType===Ur)&&(Zr=We.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},Rt=We.offsetDelta={x:Be.x,y:Be.y}),se.deltaX=Zr.x+(Be.x-Rt.x),se.deltaY=Zr.y+(Be.y-Rt.y)}function Hr(We,se){var Be=We.lastInterval||se,Rt=se.timeStamp-Be.timeStamp,Zr,kn,Ni,Na;if(se.eventType!=Ir&&(Rt>gr||Be.velocity===m)){var Ma=se.deltaX-Be.deltaX,Xa=se.deltaY-Be.deltaY,Do=Ia(Rt,Ma,Xa);kn=Do.x,Ni=Do.y,Zr=at(Do.x)>at(Do.y)?Do.x:Do.y,Na=li(Ma,Xa),We.lastInterval=se}else Zr=Be.velocity,kn=Be.velocityX,Ni=Be.velocityY,Na=Be.direction;se.velocity=Zr,se.velocityX=kn,se.velocityY=Ni,se.direction=Na}function dn(We){for(var se=[],Be=0;Be<We.pointers.length;)se[Be]={clientX:Mt(We.pointers[Be].clientX),clientY:Mt(We.pointers[Be].clientY)},Be++;return{timeStamp:ht(),pointers:se,center:Kr(se),deltaX:We.deltaX,deltaY:We.deltaY}}function Kr(We){var se=We.length;if(se===1)return{x:Mt(We[0].clientX),y:Mt(We[0].clientY)};for(var Be=0,Rt=0,Zr=0;Zr<se;)Be+=We[Zr].clientX,Rt+=We[Zr].clientY,Zr++;return{x:Mt(Be/se),y:Mt(Rt/se)}}function Ia(We,se,Be){return{x:se/We||0,y:Be/We||0}}function li(We,se){return We===se?ur:at(We)>=at(se)?We<0?Rr:Yn:se<0?un:_n}function Hn(We,se,Be){Be||(Be=he);var Rt=se[Be[0]]-We[Be[0]],Zr=se[Be[1]]-We[Be[1]];return Math.sqrt(Rt*Rt+Zr*Zr)}function ii(We,se,Be){Be||(Be=he);var Rt=se[Be[0]]-We[Be[0]],Zr=se[Be[1]]-We[Be[1]];return Math.atan2(Zr,Rt)*180/Math.PI}function Hi(We,se){return ii(se[1],se[0],Fn)+ii(We[1],We[0],Fn)}function Wi(We,se){return Hn(se[0],se[1],Fn)/Hn(We[0],We[1],Fn)}var To={mousedown:qt,mousemove:dr,mouseup:Ur},Wa="mousedown",ma="mousemove mouseup";function As(){this.evEl=Wa,this.evWin=ma,this.pressed=!1,Li.apply(this,arguments)}Re(As,Li,{handler:function(se){var Be=To[se.type];Be&qt&&se.button===0&&(this.pressed=!0),Be&dr&&se.which!==1&&(Be=Ur),!!this.pressed&&(Be&Ur&&(this.pressed=!1),this.callback(this.manager,Be,{pointers:[se],changedPointers:[se],pointerType:It,srcEvent:se}))}});var js={pointerdown:qt,pointermove:dr,pointerup:Ur,pointercancel:Ir,pointerout:Ir},Ra={2:Nt,3:Tt,4:It,5:$t},J="pointerdown",$="pointermove pointerup pointercancel";!Te&&re.MSPointerEvent&&!re.PointerEvent&&(J="MSPointerDown",$="MSPointerMove MSPointerUp MSPointerCancel");function le(){this.evEl=J,this.evWin=$,Li.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Re(le,Li,{handler:function(se){var Be=this.store,Rt=!1,Zr=se.type.toLowerCase().replace("ms",""),kn=js[Zr],Ni=Ra[se.pointerType]||se.pointerType,Na=Ni==Nt,Ma=qr(Be,se.pointerId,"pointerId");kn&qt&&(se.button===0||Na)?Ma<0&&(Be.push(se),Ma=Be.length-1):kn&(Ur|Ir)&&(Rt=!0),!(Ma<0)&&(Be[Ma]=se,this.callback(this.manager,kn,{pointers:Be,changedPointers:[se],pointerType:Ni,srcEvent:se}),Rt&&Be.splice(Ma,1))}});var ge={touchstart:qt,touchmove:dr,touchend:Ur,touchcancel:Ir},ke="touchstart",nt="touchstart touchmove touchend touchcancel";function pt(){this.evTarget=ke,this.evWin=nt,this.started=!1,Li.apply(this,arguments)}Re(pt,Li,{handler:function(se){var Be=ge[se.type];if(Be===qt&&(this.started=!0),!!this.started){var Rt=pe.call(this,se,Be);Be&(Ur|Ir)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,Be,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Nt,srcEvent:se})}}});function pe(We,se){var Be=br(We.touches),Rt=br(We.changedTouches);return se&(Ur|Ir)&&(Be=fe(Be.concat(Rt),"identifier",!0)),[Be,Rt]}var Ue={touchstart:qt,touchmove:dr,touchend:Ur,touchcancel:Ir},qe="touchstart touchmove touchend touchcancel";function Cr(){this.evTarget=qe,this.targetIds={},Li.apply(this,arguments)}Re(Cr,Li,{handler:function(se){var Be=Ue[se.type],Rt=Tr.call(this,se,Be);!Rt||this.callback(this.manager,Be,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Nt,srcEvent:se})}});function Tr(We,se){var Be=br(We.touches),Rt=this.targetIds;if(se&(qt|dr)&&Be.length===1)return Rt[Be[0].identifier]=!0,[Be,Be];var Zr,kn,Ni=br(We.changedTouches),Na=[],Ma=this.target;if(kn=Be.filter(function(Xa){return Zt(Xa.target,Ma)}),se===qt)for(Zr=0;Zr<kn.length;)Rt[kn[Zr].identifier]=!0,Zr++;for(Zr=0;Zr<Ni.length;)Rt[Ni[Zr].identifier]&&Na.push(Ni[Zr]),se&(Ur|Ir)&&delete Rt[Ni[Zr].identifier],Zr++;if(!!Na.length)return[fe(kn.concat(Na),"identifier",!0),Na]}var tr=2500,Dr=25;function nn(){Li.apply(this,arguments);var We=Nr(this.handler,this);this.touch=new Cr(this.manager,We),this.mouse=new As(this.manager,We),this.primaryTouch=null,this.lastTouches=[]}Re(nn,Li,{handler:function(se,Be,Rt){var Zr=Rt.pointerType==Nt,kn=Rt.pointerType==It;if(!(kn&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(Zr)Mn.call(this,Be,Rt);else if(kn&&wn.call(this,Rt))return;this.callback(se,Be,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Mn(We,se){We&qt?(this.primaryTouch=se.changedPointers[0].identifier,rr.call(this,se)):We&(Ur|Ir)&&rr.call(this,se)}function rr(We){var se=We.changedPointers[0];if(se.identifier===this.primaryTouch){var Be={x:se.clientX,y:se.clientY};this.lastTouches.push(Be);var Rt=this.lastTouches,Zr=function(){var Ni=Rt.indexOf(Be);Ni>-1&&Rt.splice(Ni,1)};setTimeout(Zr,tr)}}function wn(We){for(var se=We.srcEvent.clientX,Be=We.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var Zr=this.lastTouches[Rt],kn=Math.abs(se-Zr.x),Ni=Math.abs(Be-Zr.y);if(kn<=Dr&&Ni<=Dr)return!0}return!1}var mn=Te?m:Pe(Me.style,"touchAction"),xn=mn!==m,w="compute",An="auto",Lr="manipulation",Zi="none",Ti="pan-x",Un="pan-y",Bi=to();function Mo(We,se){this.manager=We,this.set(se)}Mo.prototype={set:function(se){se==w&&(se=this.compute()),xn&&this.manager.element.style&&Bi[se]&&(this.manager.element.style[mn]=se),this.actions=se.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var se=[];return Ve(this.manager.recognizers,function(Be){Pr(Be.options.enable,[Be])&&(se=se.concat(Be.getTouchAction()))}),ra(se.join(" "))},preventDefaults:function(se){var Be=se.srcEvent,Rt=se.offsetDirection;if(this.manager.session.prevented){Be.preventDefault();return}var Zr=this.actions,kn=ir(Zr,Zi)&&!Bi[Zi],Ni=ir(Zr,Un)&&!Bi[Un],Na=ir(Zr,Ti)&&!Bi[Ti];if(kn){var Ma=se.pointers.length===1,Xa=se.distance<2,Do=se.deltaTime<250;if(Ma&&Xa&&Do)return}if(!(Na&&Ni)&&(kn||Ni&&Rt&qn||Na&&Rt&oi))return this.preventSrc(Be)},preventSrc:function(se){this.manager.session.prevented=!0,se.preventDefault()}};function ra(We){if(ir(We,Zi))return Zi;var se=ir(We,Ti),Be=ir(We,Un);return se&&Be?Zi:se||Be?se?Ti:Un:ir(We,Lr)?Lr:An}function to(){if(!xn)return!1;var We={};if(Te)return We;var se=re.CSS&&re.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Be){We[Be]=se?re.CSS.supports("touch-action",Be):!0}),We}var ca=1,ci=2,bi=4,vo=8,mo=vo,ia=16,Za=32;function so(We){this.options=st({},this.defaults,We||{}),this.id=lt(),this.manager=null,this.options.enable=Wt(this.options.enable,!0),this.state=ca,this.simultaneous={},this.requireFail=[]}so.prototype={defaults:{},set:function(se){return st(this.options,se),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(se){if(_t(se,"recognizeWith",this))return this;var Be=this.simultaneous;return se=cu(se,this),Be[se.id]||(Be[se.id]=se,se.recognizeWith(this)),this},dropRecognizeWith:function(se){return _t(se,"dropRecognizeWith",this)?this:(se=cu(se,this),delete this.simultaneous[se.id],this)},requireFailure:function(se){if(_t(se,"requireFailure",this))return this;var Be=this.requireFail;return se=cu(se,this),qr(Be,se)===-1&&(Be.push(se),se.requireFailure(this)),this},dropRequireFailure:function(se){if(_t(se,"dropRequireFailure",this))return this;se=cu(se,this);var Be=qr(this.requireFail,se);return Be>-1&&this.requireFail.splice(Be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(se){return!!this.simultaneous[se.id]},emit:function(se){var Be=this,Rt=this.state;function Zr(kn){Be.manager.emit(kn,se)}Rt<vo&&Zr(Be.options.event+bl(Rt)),Zr(Be.options.event),se.additionalEvent&&Zr(se.additionalEvent),Rt>=vo&&Zr(Be.options.event+bl(Rt))},tryEmit:function(se){if(this.canEmit())return this.emit(se);this.state=Za},canEmit:function(){for(var se=0;se<this.requireFail.length;){if(!(this.requireFail[se].state&(Za|ca)))return!1;se++}return!0},recognize:function(se){var Be=st({},se);if(!Pr(this.options.enable,[this,Be])){this.reset(),this.state=Za;return}this.state&(mo|ia|Za)&&(this.state=ca),this.state=this.process(Be),this.state&(ci|bi|vo|ia)&&this.tryEmit(Be)},process:function(se){},getTouchAction:function(){},reset:function(){}};function bl(We){return We&ia?"cancel":We&vo?"end":We&bi?"move":We&ci?"start":""}function Ta(We){return We==_n?"down":We==un?"up":We==Rr?"left":We==Yn?"right":""}function cu(We,se){var Be=se.manager;return Be?Be.get(We):We}function ga(){so.apply(this,arguments)}Re(ga,so,{defaults:{pointers:1},attrTest:function(se){var Be=this.options.pointers;return Be===0||se.pointers.length===Be},process:function(se){var Be=this.state,Rt=se.eventType,Zr=Be&(ci|bi),kn=this.attrTest(se);return Zr&&(Rt&Ir||!kn)?Be|ia:Zr||kn?Rt&Ur?Be|vo:Be&ci?Be|bi:ci:Za}});function Va(){ga.apply(this,arguments),this.pX=null,this.pY=null}Re(Va,ga,{defaults:{event:"pan",threshold:10,pointers:1,direction:Gi},getTouchAction:function(){var se=this.options.direction,Be=[];return se&qn&&Be.push(Un),se&oi&&Be.push(Ti),Be},directionTest:function(se){var Be=this.options,Rt=!0,Zr=se.distance,kn=se.direction,Ni=se.deltaX,Na=se.deltaY;return kn&Be.direction||(Be.direction&qn?(kn=Ni===0?ur:Ni<0?Rr:Yn,Rt=Ni!=this.pX,Zr=Math.abs(se.deltaX)):(kn=Na===0?ur:Na<0?un:_n,Rt=Na!=this.pY,Zr=Math.abs(se.deltaY))),se.direction=kn,Rt&&Zr>Be.threshold&&kn&Be.direction},attrTest:function(se){return ga.prototype.attrTest.call(this,se)&&(this.state&ci||!(this.state&ci)&&this.directionTest(se))},emit:function(se){this.pX=se.deltaX,this.pY=se.deltaY;var Be=Ta(se.direction);Be&&(se.additionalEvent=this.options.event+Be),this._super.emit.call(this,se)}});function Co(){ga.apply(this,arguments)}Re(Co,ga,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Zi]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.scale-1)>this.options.threshold||this.state&ci)},emit:function(se){if(se.scale!==1){var Be=se.scale<1?"in":"out";se.additionalEvent=this.options.event+Be}this._super.emit.call(this,se)}});function wa(){so.apply(this,arguments),this._timer=null,this._input=null}Re(wa,so,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[An]},process:function(se){var Be=this.options,Rt=se.pointers.length===Be.pointers,Zr=se.distance<Be.threshold,kn=se.deltaTime>Be.time;if(this._input=se,!Zr||!Rt||se.eventType&(Ur|Ir)&&!kn)this.reset();else if(se.eventType&qt)this.reset(),this._timer=vt(function(){this.state=mo,this.tryEmit()},Be.time,this);else if(se.eventType&Ur)return mo;return Za},reset:function(){clearTimeout(this._timer)},emit:function(se){this.state===mo&&(se&&se.eventType&Ur?this.manager.emit(this.options.event+"up",se):(this._input.timeStamp=ht(),this.manager.emit(this.options.event,this._input)))}});function qo(){ga.apply(this,arguments)}Re(qo,ga,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Zi]},attrTest:function(se){return this._super.attrTest.call(this,se)&&(Math.abs(se.rotation)>this.options.threshold||this.state&ci)}});function wo(){ga.apply(this,arguments)}Re(wo,ga,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:qn|oi,pointers:1},getTouchAction:function(){return Va.prototype.getTouchAction.call(this)},attrTest:function(se){var Be=this.options.direction,Rt;return Be&(qn|oi)?Rt=se.overallVelocity:Be&qn?Rt=se.overallVelocityX:Be&oi&&(Rt=se.overallVelocityY),this._super.attrTest.call(this,se)&&Be&se.offsetDirection&&se.distance>this.options.threshold&&se.maxPointers==this.options.pointers&&at(Rt)>this.options.velocity&&se.eventType&Ur},emit:function(se){var Be=Ta(se.offsetDirection);Be&&this.manager.emit(this.options.event+Be,se),this.manager.emit(this.options.event,se)}});function jo(){so.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Re(jo,so,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Lr]},process:function(se){var Be=this.options,Rt=se.pointers.length===Be.pointers,Zr=se.distance<Be.threshold,kn=se.deltaTime<Be.time;if(this.reset(),se.eventType&qt&&this.count===0)return this.failTimeout();if(Zr&&kn&&Rt){if(se.eventType!=Ur)return this.failTimeout();var Ni=this.pTime?se.timeStamp-this.pTime<Be.interval:!0,Na=!this.pCenter||Hn(this.pCenter,se.center)<Be.posThreshold;this.pTime=se.timeStamp,this.pCenter=se.center,!Na||!Ni?this.count=1:this.count+=1,this._input=se;var Ma=this.count%Be.taps;if(Ma===0)return this.hasRequireFailures()?(this._timer=vt(function(){this.state=mo,this.tryEmit()},Be.interval,this),ci):mo}return Za},failTimeout:function(){return this._timer=vt(function(){this.state=Za},this.options.interval,this),Za},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==mo&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ya(We,se){return se=se||{},se.recognizers=Wt(se.recognizers,ya.defaults.preset),new uo(We,se)}ya.VERSION="2.0.7",ya.defaults={domEvents:!1,touchAction:w,enable:!0,inputTarget:null,inputClass:null,preset:[[qo,{enable:!1}],[Co,{enable:!1},["rotate"]],[wo,{direction:qn}],[Va,{direction:qn},["swipe"]],[jo],[jo,{event:"doubletap",taps:2},["tap"]],[wa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Nl=1,ls=2;function uo(We,se){this.options=st({},ya.defaults,se||{}),this.options.inputTarget=this.options.inputTarget||We,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=We,this.input=Ko(this),this.touchAction=new Mo(this,this.options.touchAction),$s(this,!0),Ve(this.options.recognizers,function(Be){var Rt=this.add(new Be[0](Be[1]));Be[2]&&Rt.recognizeWith(Be[2]),Be[3]&&Rt.requireFailure(Be[3])},this)}uo.prototype={set:function(se){return st(this.options,se),se.touchAction&&this.touchAction.update(),se.inputTarget&&(this.input.destroy(),this.input.target=se.inputTarget,this.input.init()),this},stop:function(se){this.session.stopped=se?ls:Nl},recognize:function(se){var Be=this.session;if(!Be.stopped){this.touchAction.preventDefaults(se);var Rt,Zr=this.recognizers,kn=Be.curRecognizer;(!kn||kn&&kn.state&mo)&&(kn=Be.curRecognizer=null);for(var Ni=0;Ni<Zr.length;)Rt=Zr[Ni],Be.stopped!==ls&&(!kn||Rt==kn||Rt.canRecognizeWith(kn))?Rt.recognize(se):Rt.reset(),!kn&&Rt.state&(ci|bi|vo)&&(kn=Be.curRecognizer=Rt),Ni++}},get:function(se){if(se instanceof so)return se;for(var Be=this.recognizers,Rt=0;Rt<Be.length;Rt++)if(Be[Rt].options.event==se)return Be[Rt];return null},add:function(se){if(_t(se,"add",this))return this;var Be=this.get(se.options.event);return Be&&this.remove(Be),this.recognizers.push(se),se.manager=this,this.touchAction.update(),se},remove:function(se){if(_t(se,"remove",this))return this;if(se=this.get(se),se){var Be=this.recognizers,Rt=qr(Be,se);Rt!==-1&&(Be.splice(Rt,1),this.touchAction.update())}return this},on:function(se,Be){if(se!==m&&Be!==m){var Rt=this.handlers;return Ve(Fr(se),function(Zr){Rt[Zr]=Rt[Zr]||[],Rt[Zr].push(Be)}),this}},off:function(se,Be){if(se!==m){var Rt=this.handlers;return Ve(Fr(se),function(Zr){Be?Rt[Zr]&&Rt[Zr].splice(qr(Rt[Zr],Be),1):delete Rt[Zr]}),this}},emit:function(se,Be){this.options.domEvents&&Lo(se,Be);var Rt=this.handlers[se]&&this.handlers[se].slice();if(!(!Rt||!Rt.length)){Be.type=se,Be.preventDefault=function(){Be.srcEvent.preventDefault()};for(var Zr=0;Zr<Rt.length;)Rt[Zr](Be),Zr++}},destroy:function(){this.element&&$s(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function $s(We,se){var Be=We.element;if(!!Be.style){var Rt;Ve(We.options.cssProps,function(Zr,kn){Rt=Pe(Be.style,kn),se?(We.oldCssProps[Rt]=Be.style[Rt],Be.style[Rt]=Zr):Be.style[Rt]=We.oldCssProps[Rt]||""}),se||(We.oldCssProps={})}}function Lo(We,se){if(!Te){var Be=ne.createEvent("Event");Be.initEvent(We,!0,!0),Be.gesture=se,se.target.dispatchEvent(Be)}}if(!Te){st(ya,{INPUT_START:qt,INPUT_MOVE:dr,INPUT_END:Ur,INPUT_CANCEL:Ir,STATE_POSSIBLE:ca,STATE_BEGAN:ci,STATE_CHANGED:bi,STATE_ENDED:vo,STATE_RECOGNIZED:mo,STATE_CANCELLED:ia,STATE_FAILED:Za,DIRECTION_NONE:ur,DIRECTION_LEFT:Rr,DIRECTION_RIGHT:Yn,DIRECTION_UP:un,DIRECTION_DOWN:_n,DIRECTION_HORIZONTAL:qn,DIRECTION_VERTICAL:oi,DIRECTION_ALL:Gi,Manager:uo,Input:Li,TouchAction:Mo,TouchInput:Cr,MouseInput:As,PointerEventInput:le,TouchMouseInput:nn,SingleTouchInput:pt,Recognizer:so,AttrRecognizer:ga,Tap:jo,Pan:Va,Swipe:wo,Pinch:Co,Rotate:qo,Press:wa,on:Oe,off:Bt,each:Ve,merge:N,extend:it,assign:st,inherit:Re,bindFn:Nr,prefixed:Pe});var go=typeof window!="undefined"?window:typeof self!="undefined"?self:{};go.Hammer=ya,W=function(){return ya}.call(K,O,K,He),W!==m&&(He.exports=W)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},Aib3:function(He,K,O){var W=O("mhV4");He.exports=re;function re(Te,xe){switch(Te&&Te.type||null){case"FeatureCollection":return Te.features=Te.features.map(ne(re,xe)),Te;case"GeometryCollection":return Te.geometries=Te.geometries.map(ne(re,xe)),Te;case"Feature":return Te.geometry=re(Te.geometry,xe),Te;case"Polygon":case"MultiPolygon":return j(Te,xe);default:return Te}}function ne(Te,xe){return function(Me){return Te(Me,xe)}}function j(Te,xe){return Te.type==="Polygon"?Te.coordinates=m(Te.coordinates,xe):Te.type==="MultiPolygon"&&(Te.coordinates=Te.coordinates.map(ne(m,xe))),Te}function m(Te,xe){xe=!!xe,Te[0]=U(Te[0],xe);for(var Me=1;Me<Te.length;Me++)Te[Me]=U(Te[Me],!xe);return Te}function U(Te,xe){return G(Te)===xe?Te:Te.reverse()}function G(Te){return W.ring(Te)>=0}},AwBQ:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Lookup=void 0;var W=O("MON2"),re=function(){function ne(){this._map=new Map}return ne.prototype.getMap=function(){return this._map},ne.prototype.add=function(j,m){if(j==null)throw new Error(W.NULL_ARGUMENT);if(m==null)throw new Error(W.NULL_ARGUMENT);var U=this._map.get(j);U!==void 0?(U.push(m),this._map.set(j,U)):this._map.set(j,[m])},ne.prototype.get=function(j){if(j==null)throw new Error(W.NULL_ARGUMENT);var m=this._map.get(j);if(m!==void 0)return m;throw new Error(W.KEY_NOT_FOUND)},ne.prototype.remove=function(j){if(j==null)throw new Error(W.NULL_ARGUMENT);if(!this._map.delete(j))throw new Error(W.KEY_NOT_FOUND)},ne.prototype.removeByCondition=function(j){var m=this;this._map.forEach(function(U,G){var Te=U.filter(function(xe){return!j(xe)});Te.length>0?m._map.set(G,Te):m._map.delete(G)})},ne.prototype.hasKey=function(j){if(j==null)throw new Error(W.NULL_ARGUMENT);return this._map.has(j)},ne.prototype.clone=function(){var j=new ne;return this._map.forEach(function(m,U){m.forEach(function(G){return j.add(U,G.clone())})}),j},ne.prototype.traverse=function(j){this._map.forEach(function(m,U){j(U,m)})},ne}();K.Lookup=re},"B6l+":function(He,K,O){var W=O("Sq3C"),re=O("Z1HP"),ne=O("Sxd8"),j=O("dt0z");function m(U,G,Te){U=j(U),G=ne(G);var xe=G?re(U):0;return G&&xe<G?U+W(G-xe,Te):U}He.exports=m},BkRI:function(He,K,O){var W=O("OBhP"),re=1,ne=4;function j(m){return W(m,re|ne)}He.exports=j},CIdX:function(He,K,O){He.exports={waterWave:"waterWave___hvLJA",text:"text___3asSo",waterWaveCanvasWrapper:"waterWaveCanvasWrapper___2ndFj"}},CZoQ:function(He,K){function O(W,re,ne){for(var j=ne-1,m=W.length;++j<m;)if(W[j]===re)return j;return-1}He.exports=O},D9lx:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingInWhenOnSyntax=void 0;var W=O("6AGu"),re=O("406g"),ne=O("z4Hk"),j=function(){function m(U){this._binding=U,this._bindingWhenSyntax=new ne.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding),this._bindingInSyntax=new W.BindingInSyntax(U)}return m.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},m.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},m.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},m.prototype.when=function(U){return this._bindingWhenSyntax.when(U)},m.prototype.whenTargetNamed=function(U){return this._bindingWhenSyntax.whenTargetNamed(U)},m.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},m.prototype.whenTargetTagged=function(U,G){return this._bindingWhenSyntax.whenTargetTagged(U,G)},m.prototype.whenInjectedInto=function(U){return this._bindingWhenSyntax.whenInjectedInto(U)},m.prototype.whenParentNamed=function(U){return this._bindingWhenSyntax.whenParentNamed(U)},m.prototype.whenParentTagged=function(U,G){return this._bindingWhenSyntax.whenParentTagged(U,G)},m.prototype.whenAnyAncestorIs=function(U){return this._bindingWhenSyntax.whenAnyAncestorIs(U)},m.prototype.whenNoAncestorIs=function(U){return this._bindingWhenSyntax.whenNoAncestorIs(U)},m.prototype.whenAnyAncestorNamed=function(U){return this._bindingWhenSyntax.whenAnyAncestorNamed(U)},m.prototype.whenAnyAncestorTagged=function(U,G){return this._bindingWhenSyntax.whenAnyAncestorTagged(U,G)},m.prototype.whenNoAncestorNamed=function(U){return this._bindingWhenSyntax.whenNoAncestorNamed(U)},m.prototype.whenNoAncestorTagged=function(U,G){return this._bindingWhenSyntax.whenNoAncestorTagged(U,G)},m.prototype.whenAnyAncestorMatches=function(U){return this._bindingWhenSyntax.whenAnyAncestorMatches(U)},m.prototype.whenNoAncestorMatches=function(U){return this._bindingWhenSyntax.whenNoAncestorMatches(U)},m.prototype.onActivation=function(U){return this._bindingOnSyntax.onActivation(U)},m}();K.BindingInWhenOnSyntax=j},DnfT:function(He,K,O){},"Dw+G":function(He,K,O){var W=O("juv8"),re=O("mTTR");function ne(j,m){return j&&W(m,re(m),j)}He.exports=ne},DzJC:function(He,K,O){var W=O("sEfC"),re=O("GoyQ"),ne="Expected a function";function j(m,U,G){var Te=!0,xe=!0;if(typeof m!="function")throw new TypeError(ne);return re(G)&&(Te="leading"in G?!!G.leading:Te,xe="trailing"in G?!!G.trailing:xe),W(m,U,{leading:Te,maxWait:U,trailing:xe})}He.exports=j},EEGq:function(He,K,O){var W=O("juv8"),re=O("oCl/");function ne(j,m){return W(j,re(j),m)}He.exports=ne},FRQA:function(He,K,O){"use strict";var W=O("GNNt"),re=O("wEI+"),ne=O("DnfT"),j=O.n(ne),m=O("q1tI"),U=O.n(m),G=O("TSYQ"),Te=O.n(G),xe=O("jYQm"),Me=function(Mt){var at=Object(m.useContext)(xe.a),ht=Mt.children,vt=Mt.contentWidth,_t=Mt.className,Ve=Mt.style,xt=Object(m.useContext)(re.a.ConfigContext),st=xt.getPrefixCls,it=Mt.prefixCls||st("pro"),N=vt||at.contentWidth,Re="".concat(it,"-grid-content");return U.a.createElement("div",{className:Te()(Re,_t,{wide:N==="Fixed"}),style:Ve},U.a.createElement("div",{className:"".concat(it,"-grid-content-children")},ht))};K.a=Me},FV85:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.TargetTypeEnum=K.BindingTypeEnum=K.BindingScopeEnum=void 0;var W={Request:"Request",Singleton:"Singleton",Transient:"Transient"};K.BindingScopeEnum=W;var re={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};K.BindingTypeEnum=re;var ne={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};K.TargetTypeEnum=ne},G6z8:function(He,K,O){var W=O("fR/l"),re=O("oCl/"),ne=O("mTTR");function j(m){return W(m,ne,re)}He.exports=j},GXnB:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Metadata=void 0;var W=O("xfSm"),re=function(){function ne(j,m){this.key=j,this.value=m}return ne.prototype.toString=function(){return this.key===W.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},ne}();K.Metadata=re},Gi0A:function(He,K,O){var W=O("QqLw"),re=O("ExA7"),ne="[object Map]";function j(m){return re(m)&&W(m)==ne}He.exports=j},"H+7v":function(He,K,O){He.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},HpQ9:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.ContainerSnapshot=void 0;var W=function(){function re(){}return re.of=function(ne,j){var m=new re;return m.bindings=ne,m.middleware=j,m},re}();K.ContainerSnapshot=W},J2iB:function(He,K){function O(W){return W==null}He.exports=O},JBE3:function(He,K,O){var W=O("+Qka"),re=O("LsHQ"),ne=re(function(j,m,U,G){W(j,m,U,G)});He.exports=ne},KwMD:function(He,K){function O(W,re,ne,j){for(var m=W.length,U=ne+(j?1:-1);j?U--:++U<m;)if(re(W[U],U,W))return U;return-1}He.exports=O},LGYb:function(He,K,O){var W=O("1hJj"),re=O("jbM+"),ne=O("Xt/L"),j=O("xYSL"),m=O("dQpi"),U=O("rEGp"),G=200;function Te(xe,Me,Ee){var Mt=-1,at=re,ht=xe.length,vt=!0,_t=[],Ve=_t;if(Ee)vt=!1,at=ne;else if(ht>=G){var xt=Me?null:m(xe);if(xt)return U(xt);vt=!1,at=j,Ve=new W}else Ve=Me?[]:_t;e:for(;++Mt<ht;){var st=xe[Mt],it=Me?Me(st):st;if(st=Ee||st!==0?st:0,vt&&it===it){for(var N=Ve.length;N--;)if(Ve[N]===it)continue e;Me&&Ve.push(it),_t.push(st)}else at(Ve,it,Ee)||(Ve!==_t&&Ve.push(it),_t.push(st))}return _t}He.exports=Te},LKzl:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingWhenOnSyntax=void 0;var W=O("406g"),re=O("z4Hk"),ne=function(){function j(m){this._binding=m,this._bindingWhenSyntax=new re.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new W.BindingOnSyntax(this._binding)}return j.prototype.when=function(m){return this._bindingWhenSyntax.when(m)},j.prototype.whenTargetNamed=function(m){return this._bindingWhenSyntax.whenTargetNamed(m)},j.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},j.prototype.whenTargetTagged=function(m,U){return this._bindingWhenSyntax.whenTargetTagged(m,U)},j.prototype.whenInjectedInto=function(m){return this._bindingWhenSyntax.whenInjectedInto(m)},j.prototype.whenParentNamed=function(m){return this._bindingWhenSyntax.whenParentNamed(m)},j.prototype.whenParentTagged=function(m,U){return this._bindingWhenSyntax.whenParentTagged(m,U)},j.prototype.whenAnyAncestorIs=function(m){return this._bindingWhenSyntax.whenAnyAncestorIs(m)},j.prototype.whenNoAncestorIs=function(m){return this._bindingWhenSyntax.whenNoAncestorIs(m)},j.prototype.whenAnyAncestorNamed=function(m){return this._bindingWhenSyntax.whenAnyAncestorNamed(m)},j.prototype.whenAnyAncestorTagged=function(m,U){return this._bindingWhenSyntax.whenAnyAncestorTagged(m,U)},j.prototype.whenNoAncestorNamed=function(m){return this._bindingWhenSyntax.whenNoAncestorNamed(m)},j.prototype.whenNoAncestorTagged=function(m,U){return this._bindingWhenSyntax.whenNoAncestorTagged(m,U)},j.prototype.whenAnyAncestorMatches=function(m){return this._bindingWhenSyntax.whenAnyAncestorMatches(m)},j.prototype.whenNoAncestorMatches=function(m){return this._bindingWhenSyntax.whenNoAncestorMatches(m)},j.prototype.onActivation=function(m){return this._bindingOnSyntax.onActivation(m)},j}();K.BindingWhenOnSyntax=ne},LgvC:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Binding=void 0;var W=O("FV85"),re=O("d9O0"),ne=function(){function j(m,U){this.id=re.id(),this.activated=!1,this.serviceIdentifier=m,this.scope=U,this.type=W.BindingTypeEnum.Invalid,this.constraint=function(G){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return j.prototype.clone=function(){var m=new j(this.serviceIdentifier,this.scope);return m.activated=m.scope===W.BindingScopeEnum.Singleton?this.activated:!1,m.implementationType=this.implementationType,m.dynamicValue=this.dynamicValue,m.scope=this.scope,m.type=this.type,m.factory=this.factory,m.provider=this.provider,m.constraint=this.constraint,m.onActivation=this.onActivation,m.cache=this.cache,m},j}();K.Binding=ne},MON2:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.STACK_OVERFLOW=K.CIRCULAR_DEPENDENCY_IN_FACTORY=K.POST_CONSTRUCT_ERROR=K.MULTIPLE_POST_CONSTRUCT_METHODS=K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=K.ARGUMENTS_LENGTH_MISMATCH=K.INVALID_DECORATOR_OPERATION=K.INVALID_TO_SELF_VALUE=K.INVALID_FUNCTION_BINDING=K.INVALID_MIDDLEWARE_RETURN=K.NO_MORE_SNAPSHOTS_AVAILABLE=K.INVALID_BINDING_TYPE=K.NOT_IMPLEMENTED=K.CIRCULAR_DEPENDENCY=K.UNDEFINED_INJECT_ANNOTATION=K.MISSING_INJECT_ANNOTATION=K.MISSING_INJECTABLE_ANNOTATION=K.NOT_REGISTERED=K.CANNOT_UNBIND=K.AMBIGUOUS_MATCH=K.KEY_NOT_FOUND=K.NULL_ARGUMENT=K.DUPLICATED_METADATA=K.DUPLICATED_INJECTABLE_DECORATOR=void 0,K.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",K.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",K.NULL_ARGUMENT="NULL argument",K.KEY_NOT_FOUND="Key Not Found",K.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",K.CANNOT_UNBIND="Could not unbind serviceIdentifier:",K.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",K.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",K.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var W=function(U){return"@inject called with undefined this could mean that the class "+U+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};K.UNDEFINED_INJECT_ANNOTATION=W,K.CIRCULAR_DEPENDENCY="Circular dependency found:",K.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",K.INVALID_BINDING_TYPE="Invalid binding type:",K.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",K.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",K.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",K.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",K.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var re=function(){for(var U=[],G=0;G<arguments.length;G++)U[G]=arguments[G];return"The number of constructor arguments in the derived class "+(U[0]+" must be >= than the number of constructor arguments of its base class.")};K.ARGUMENTS_LENGTH_MISMATCH=re,K.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",K.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",K.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",K.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",K.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ne=function(){for(var U=[],G=0;G<arguments.length;G++)U[G]=arguments[G];return"@postConstruct error in class "+U[0]+": "+U[1]};K.POST_CONSTRUCT_ERROR=ne;var j=function(){for(var U=[],G=0;G<arguments.length;G++)U[G]=arguments[G];return"It looks like there is a circular dependency "+("in one of the '"+U[0]+"' bindings. Please investigate bindings with")+("service identifier '"+U[1]+"'.")};K.CIRCULAR_DEPENDENCY_IN_FACTORY=j,K.STACK_OVERFLOW="Maximum call stack size exceeded"},OBhP:function(He,K,O){var W=O("fmRc"),re=O("gFfm"),ne=O("MrPd"),j=O("WwFo"),m=O("Dw+G"),U=O("5Tg0"),G=O("Q1l4"),Te=O("VOtZ"),xe=O("EEGq"),Me=O("qZTm"),Ee=O("G6z8"),Mt=O("QqLw"),at=O("yHx3"),ht=O("wrZu"),vt=O("+iFO"),_t=O("Z0cm"),Ve=O("DSRE"),xt=O("zEVN"),st=O("GoyQ"),it=O("1+5i"),N=O("7GkX"),Re=O("mTTR"),Nr=1,Pr=2,Wt=4,Oe="[object Arguments]",Bt="[object Array]",Zt="[object Boolean]",ir="[object Date]",Fr="[object Error]",qr="[object Function]",br="[object GeneratorFunction]",fe="[object Map]",Pe="[object Number]",Se="[object Object]",lt="[object RegExp]",ut="[object Set]",Ot="[object String]",wt="[object Symbol]",sr="[object WeakMap]",Or="[object ArrayBuffer]",Nt="[object DataView]",Tt="[object Float32Array]",It="[object Float64Array]",$t="[object Int8Array]",gr="[object Int16Array]",qt="[object Int32Array]",dr="[object Uint8Array]",Ur="[object Uint8ClampedArray]",Ir="[object Uint16Array]",ur="[object Uint32Array]",Rr={};Rr[Oe]=Rr[Bt]=Rr[Or]=Rr[Nt]=Rr[Zt]=Rr[ir]=Rr[Tt]=Rr[It]=Rr[$t]=Rr[gr]=Rr[qt]=Rr[fe]=Rr[Pe]=Rr[Se]=Rr[lt]=Rr[ut]=Rr[Ot]=Rr[wt]=Rr[dr]=Rr[Ur]=Rr[Ir]=Rr[ur]=!0,Rr[Fr]=Rr[qr]=Rr[sr]=!1;function Yn(un,_n,qn,oi,Gi,he){var Fn,Li=_n&Nr,Ko=_n&Pr,us=_n&Wt;if(qn&&(Fn=Gi?qn(un,oi,Gi,he):qn(un)),Fn!==void 0)return Fn;if(!st(un))return un;var Ut=_t(un);if(Ut){if(Fn=at(un),!Li)return G(un,Fn)}else{var Er=Mt(un),Hr=Er==qr||Er==br;if(Ve(un))return U(un,Li);if(Er==Se||Er==Oe||Hr&&!Gi){if(Fn=Ko||Hr?{}:vt(un),!Li)return Ko?xe(un,m(Fn,un)):Te(un,j(Fn,un))}else{if(!Rr[Er])return Gi?un:{};Fn=ht(un,Er,Li)}}he||(he=new W);var dn=he.get(un);if(dn)return dn;he.set(un,Fn),it(un)?un.forEach(function(li){Fn.add(Yn(li,_n,qn,li,un,he))}):xt(un)&&un.forEach(function(li,Hn){Fn.set(Hn,Yn(li,_n,qn,Hn,un,he))});var Kr=us?Ko?Ee:Me:Ko?Re:N,Ia=Ut?void 0:Kr(un);return re(Ia||un,function(li,Hn){Ia&&(Hn=li,li=un[Hn]),ne(Fn,Hn,Yn(li,_n,qn,Hn,un,he))}),Fn}He.exports=Yn},"QQZ/":function(He,K,O){var W=O("Sq3C"),re=O("Z1HP"),ne=O("Sxd8"),j=O("dt0z");function m(U,G,Te){U=j(U),G=ne(G);var xe=G?re(U):0;return G&&xe<G?W(G-xe,Te)+U:U}He.exports=m},"R/W3":function(He,K,O){var W=O("KwMD"),re=O("2ajD"),ne=O("CZoQ");function j(m,U,G){return U===U?ne(m,U,G):W(m,re,G)}He.exports=j},"RR/i":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.typeConstraint=K.namedConstraint=K.taggedConstraint=K.traverseAncerstors=void 0;var W=O("xfSm"),re=O("GXnB"),ne=function G(Te,xe){var Me=Te.parentRequest;return Me!==null?xe(Me)?!0:G(Me,xe):!1};K.traverseAncerstors=ne;var j=function(Te){return function(xe){var Me=function(Mt){return Mt!==null&&Mt.target!==null&&Mt.target.matchesTag(Te)(xe)};return Me.metaData=new re.Metadata(Te,xe),Me}};K.taggedConstraint=j;var m=j(W.NAMED_TAG);K.namedConstraint=m;var U=function(Te){return function(xe){var Me=null;if(xe!==null)if(Me=xe.bindings[0],typeof Te=="string"){var Ee=Me.serviceIdentifier;return Ee===Te}else{var Mt=xe.bindings[0].implementationType;return Te===Mt}return!1}};K.typeConstraint=U},SUU4:function(He,K,O){(function(W,re){He.exports=re(O("szb8"))})(this,function(W){"use strict";var re=function(ae){return ae instanceof Uint8Array||ae instanceof Uint16Array||ae instanceof Uint32Array||ae instanceof Int8Array||ae instanceof Int16Array||ae instanceof Int32Array||ae instanceof Float32Array||ae instanceof Float64Array||ae instanceof Uint8ClampedArray},ne=function(ae,Ge){for(var Vt=Object.keys(Ge),hr=0;hr<Vt.length;++hr)ae[Vt[hr]]=Ge[Vt[hr]];return ae},j=`
`;function m(X){return typeof atob!="undefined"?atob(X):"base64:"+X}function U(X){var ae=new Error("(regl) "+X);throw console.error(ae),ae}function G(X,ae){X||U(ae)}function Te(X){return X?": "+X:""}function xe(X,ae,Ge){X in ae||U("unknown parameter ("+X+")"+Te(Ge)+". possible values: "+Object.keys(ae).join())}function Me(X,ae){re(X)||U("invalid parameter type"+Te(ae)+". must be a typed array")}function Ee(X,ae){switch(ae){case"number":return typeof X=="number";case"object":return typeof X=="object";case"string":return typeof X=="string";case"boolean":return typeof X=="boolean";case"function":return typeof X=="function";case"undefined":return typeof X=="undefined";case"symbol":return typeof X=="symbol"}}function Mt(X,ae,Ge){Ee(X,ae)||U("invalid parameter type"+Te(Ge)+". expected "+ae+", got "+typeof X)}function at(X,ae){X>=0&&(X|0)===X||U("invalid parameter type, ("+X+")"+Te(ae)+". must be a nonnegative integer")}function ht(X,ae,Ge){ae.indexOf(X)<0&&U("invalid value"+Te(Ge)+". must be one of: "+ae)}var vt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function _t(X){Object.keys(X).forEach(function(ae){vt.indexOf(ae)<0&&U('invalid regl constructor argument "'+ae+'". must be one of '+vt)})}function Ve(X,ae){for(X=X+"";X.length<ae;)X=" "+X;return X}function xt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function st(X,ae){this.number=X,this.line=ae,this.errors=[]}function it(X,ae,Ge){this.file=X,this.line=ae,this.message=Ge}function N(){var X=new Error,ae=(X.stack||X).toString(),Ge=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ae);if(Ge)return Ge[1];var Vt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ae);return Vt?Vt[1]:"unknown"}function Re(){var X=new Error,ae=(X.stack||X).toString(),Ge=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ae);if(Ge)return Ge[1];var Vt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ae);return Vt?Vt[1]:"unknown"}function Nr(X,ae){var Ge=X.split(`
`),Vt=1,hr=0,nr={unknown:new xt,0:new xt};nr.unknown.name=nr[0].name=ae||N(),nr.unknown.lines.push(new st(0,""));for(var Jt=0;Jt<Ge.length;++Jt){var wr=Ge[Jt],jr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(wr);if(jr)switch(jr[1]){case"line":var Vr=/(\d+)(\s+\d+)?/.exec(jr[2]);Vr&&(Vt=Vr[1]|0,Vr[2]&&(hr=Vr[2]|0,hr in nr||(nr[hr]=new xt)));break;case"define":var Xr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(jr[2]);Xr&&(nr[hr].name=Xr[1]?m(Xr[2]):Xr[2]);break}nr[hr].lines.push(new st(Vt++,wr))}return Object.keys(nr).forEach(function(Gr){var fn=nr[Gr];fn.lines.forEach(function(rn){fn.index[rn.number]=rn})}),nr}function Pr(X){var ae=[];return X.split(`
`).forEach(function(Ge){if(!(Ge.length<5)){var Vt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ge);Vt?ae.push(new it(Vt[1]|0,Vt[2]|0,Vt[3].trim())):Ge.length>0&&ae.push(new it("unknown",0,Ge))}}),ae}function Wt(X,ae){ae.forEach(function(Ge){var Vt=X[Ge.file];if(Vt){var hr=Vt.index[Ge.line];if(hr){hr.errors.push(Ge),Vt.hasErrors=!0;return}}X.unknown.hasErrors=!0,X.unknown.lines[0].errors.push(Ge)})}function Oe(X,ae,Ge,Vt,hr){if(!X.getShaderParameter(ae,X.COMPILE_STATUS)){var nr=X.getShaderInfoLog(ae),Jt=Vt===X.FRAGMENT_SHADER?"fragment":"vertex";fe(Ge,"string",Jt+" shader source must be a string",hr);var wr=Nr(Ge,hr),jr=Pr(nr);Wt(wr,jr),Object.keys(wr).forEach(function(Vr){var Xr=wr[Vr];if(!Xr.hasErrors)return;var Gr=[""],fn=[""];function rn(zr,Gt){Gr.push(zr),fn.push(Gt||"")}rn("file number "+Vr+": "+Xr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Xr.lines.forEach(function(zr){if(zr.errors.length>0){rn(Ve(zr.number,4)+"|  ","background-color:yellow; font-weight:bold"),rn(zr.line+j,"color:red; background-color:yellow; font-weight:bold");var Gt=0;zr.errors.forEach(function(Ht){var Br=Ht.message,Sn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Br);if(Sn){var cr=Sn[1];switch(Br=Sn[2],cr){case"assign":cr="=";break}Gt=Math.max(zr.line.indexOf(cr,Gt),0)}else Gt=0;rn(Ve("| ",6)),rn(Ve("^^^",Gt+3)+j,"font-weight:bold"),rn(Ve("| ",6)),rn(Br+j,"font-weight:bold")}),rn(Ve("| ",6)+j)}else rn(Ve(zr.number,4)+"|  "),rn(zr.line+j,"color:red")}),typeof document!="undefined"&&!window.chrome?(fn[0]=Gr.join("%c"),console.log.apply(console,fn)):console.log(Gr.join(""))}),G.raise("Error compiling "+Jt+" shader, "+wr[0].name)}}function Bt(X,ae,Ge,Vt,hr){if(!X.getProgramParameter(ae,X.LINK_STATUS)){var nr=X.getProgramInfoLog(ae),Jt=Nr(Ge,hr),wr=Nr(Vt,hr),jr='Error linking program with vertex shader, "'+wr[0].name+'", and fragment shader "'+Jt[0].name+'"';typeof document!="undefined"?console.log("%c"+jr+j+"%c"+nr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(jr+j+nr),G.raise(jr)}}function Zt(X){X._commandRef=N()}function ir(X,ae,Ge,Vt){Zt(X);function hr(jr){return jr?Vt.id(jr):0}X._fragId=hr(X.static.frag),X._vertId=hr(X.static.vert);function nr(jr,Vr){Object.keys(Vr).forEach(function(Xr){jr[Vt.id(Xr)]=!0})}var Jt=X._uniformSet={};nr(Jt,ae.static),nr(Jt,ae.dynamic);var wr=X._attributeSet={};nr(wr,Ge.static),nr(wr,Ge.dynamic),X._hasCount="count"in X.static||"count"in X.dynamic||"elements"in X.static||"elements"in X.dynamic}function Fr(X,ae){var Ge=Re();U(X+" in command "+(ae||N())+(Ge==="unknown"?"":" called from "+Ge))}function qr(X,ae,Ge){X||Fr(ae,Ge||N())}function br(X,ae,Ge,Vt){X in ae||Fr("unknown parameter ("+X+")"+Te(Ge)+". possible values: "+Object.keys(ae).join(),Vt||N())}function fe(X,ae,Ge,Vt){Ee(X,ae)||Fr("invalid parameter type"+Te(Ge)+". expected "+ae+", got "+typeof X,Vt||N())}function Pe(X){X()}function Se(X,ae,Ge){X.texture?ht(X.texture._texture.internalformat,ae,"unsupported texture format for attachment"):ht(X.renderbuffer._renderbuffer.format,Ge,"unsupported renderbuffer format for attachment")}var lt=33071,ut=9728,Ot=9984,wt=9985,sr=9986,Or=9987,Nt=5120,Tt=5121,It=5122,$t=5123,gr=5124,qt=5125,dr=5126,Ur=32819,Ir=32820,ur=33635,Rr=34042,Yn=36193,un={};un[Nt]=un[Tt]=1,un[It]=un[$t]=un[Yn]=un[ur]=un[Ur]=un[Ir]=2,un[gr]=un[qt]=un[dr]=un[Rr]=4;function _n(X,ae){return X===Ir||X===Ur||X===ur?2:X===Rr?4:un[X]*ae}function qn(X){return!(X&X-1)&&!!X}function oi(X,ae,Ge){var Vt,hr=ae.width,nr=ae.height,Jt=ae.channels;G(hr>0&&hr<=Ge.maxTextureSize&&nr>0&&nr<=Ge.maxTextureSize,"invalid texture shape"),(X.wrapS!==lt||X.wrapT!==lt)&&G(qn(hr)&&qn(nr),"incompatible wrap mode for texture, both width and height must be power of 2"),ae.mipmask===1?hr!==1&&nr!==1&&G(X.minFilter!==Ot&&X.minFilter!==sr&&X.minFilter!==wt&&X.minFilter!==Or,"min filter requires mipmap"):(G(qn(hr)&&qn(nr),"texture must be a square power of 2 to support mipmapping"),G(ae.mipmask===(hr<<1)-1,"missing or incomplete mipmap data")),ae.type===dr&&(Ge.extensions.indexOf("oes_texture_float_linear")<0&&G(X.minFilter===ut&&X.magFilter===ut,"filter not supported, must enable oes_texture_float_linear"),G(!X.genMipmaps,"mipmap generation not supported with float textures"));var wr=ae.images;for(Vt=0;Vt<16;++Vt)if(wr[Vt]){var jr=hr>>Vt,Vr=nr>>Vt;G(ae.mipmask&1<<Vt,"missing mipmap data");var Xr=wr[Vt];if(G(Xr.width===jr&&Xr.height===Vr,"invalid shape for mip images"),G(Xr.format===ae.format&&Xr.internalformat===ae.internalformat&&Xr.type===ae.type,"incompatible type for mip image"),!Xr.compressed)if(Xr.data){var Gr=Math.ceil(_n(Xr.type,Jt)*jr/Xr.unpackAlignment)*Xr.unpackAlignment;G(Xr.data.byteLength===Gr*Vr,"invalid data for image, buffer size is inconsistent with image format")}else Xr.element||Xr.copy}else X.genMipmaps||G((ae.mipmask&1<<Vt)==0,"extra mipmap data");ae.compressed&&G(!X.genMipmaps,"mipmap generation for compressed images not supported")}function Gi(X,ae,Ge,Vt){var hr=X.width,nr=X.height,Jt=X.channels;G(hr>0&&hr<=Vt.maxTextureSize&&nr>0&&nr<=Vt.maxTextureSize,"invalid texture shape"),G(hr===nr,"cube map must be square"),G(ae.wrapS===lt&&ae.wrapT===lt,"wrap mode not supported by cube map");for(var wr=0;wr<Ge.length;++wr){var jr=Ge[wr];G(jr.width===hr&&jr.height===nr,"inconsistent cube map face shape"),ae.genMipmaps&&(G(!jr.compressed,"can not generate mipmap for compressed textures"),G(jr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Vr=jr.images,Xr=0;Xr<16;++Xr){var Gr=Vr[Xr];if(Gr){var fn=hr>>Xr,rn=nr>>Xr;G(jr.mipmask&1<<Xr,"missing mipmap data"),G(Gr.width===fn&&Gr.height===rn,"invalid shape for mip images"),G(Gr.format===X.format&&Gr.internalformat===X.internalformat&&Gr.type===X.type,"incompatible type for mip image"),Gr.compressed||(Gr.data?G(Gr.data.byteLength===fn*rn*Math.max(_n(Gr.type,Jt),Gr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Gr.element||Gr.copy)}}}}var he=ne(G,{optional:Pe,raise:U,commandRaise:Fr,command:qr,parameter:xe,commandParameter:br,constructor:_t,type:Mt,commandType:fe,isTypedArray:Me,nni:at,oneOf:ht,shaderError:Oe,linkError:Bt,callSite:Re,saveCommandRef:Zt,saveDrawInfo:ir,framebufferFormat:Se,guessCommand:N,texture2D:oi,textureCube:Gi}),Fn=0,Li=0,Ko=5,us=6;function Ut(X,ae){this.id=Fn++,this.type=X,this.data=ae}function Er(X){return X.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Hr(X){if(X.length===0)return[];var ae=X.charAt(0),Ge=X.charAt(X.length-1);if(X.length>1&&ae===Ge&&(ae==='"'||ae==="'"))return['"'+Er(X.substr(1,X.length-2))+'"'];var Vt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(X);if(Vt)return Hr(X.substr(0,Vt.index)).concat(Hr(Vt[1])).concat(Hr(X.substr(Vt.index+Vt[0].length)));var hr=X.split(".");if(hr.length===1)return['"'+Er(X)+'"'];for(var nr=[],Jt=0;Jt<hr.length;++Jt)nr=nr.concat(Hr(hr[Jt]));return nr}function dn(X){return"["+Hr(X).join("][")+"]"}function Kr(X,ae){return new Ut(X,dn(ae+""))}function Ia(X){return typeof X=="function"&&!X._reglType||X instanceof Ut}function li(X,ae){if(typeof X=="function")return new Ut(Li,X);if(typeof X=="number"||typeof X=="boolean")return new Ut(Ko,X);if(Array.isArray(X))return new Ut(us,X.map(function(Ge,Vt){return li(Ge,ae+"["+Vt+"]")}));if(X instanceof Ut)return X;he(!1,"invalid option type in uniform "+ae)}var Hn={DynamicVariable:Ut,define:Kr,isDynamic:Ia,unbox:li,accessor:dn},ii={next:typeof requestAnimationFrame=="function"?function(X){return requestAnimationFrame(X)}:function(X){return setTimeout(X,16)},cancel:typeof cancelAnimationFrame=="function"?function(X){return cancelAnimationFrame(X)}:clearTimeout},Hi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Wi=Hi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function To(){var X={"":0},ae=[""];return{id:function(Vt){var hr=X[Vt];return hr||(hr=X[Vt]=ae.length,ae.push(Vt),hr)},str:function(Vt){return ae[Vt]}}}function Wa(X,ae,Ge){var Vt=document.createElement("canvas");ne(Vt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),X.appendChild(Vt),X===document.body&&(Vt.style.position="absolute",ne(X.style,{margin:0,padding:0}));function hr(){var wr=window.innerWidth,jr=window.innerHeight;if(X!==document.body){var Vr=Vt.getBoundingClientRect();wr=Vr.right-Vr.left,jr=Vr.bottom-Vr.top}Vt.width=Ge*wr,Vt.height=Ge*jr}var nr;X!==document.body&&typeof ResizeObserver=="function"?(nr=new ResizeObserver(function(){setTimeout(hr)}),nr.observe(X)):window.addEventListener("resize",hr,!1);function Jt(){nr?nr.disconnect():window.removeEventListener("resize",hr),X.removeChild(Vt)}return hr(),{canvas:Vt,onDestroy:Jt}}function ma(X,ae){function Ge(Vt){try{return X.getContext(Vt,ae)}catch(hr){return null}}return Ge("webgl")||Ge("experimental-webgl")||Ge("webgl-experimental")}function As(X){return typeof X.nodeName=="string"&&typeof X.appendChild=="function"&&typeof X.getBoundingClientRect=="function"}function js(X){return typeof X.drawArrays=="function"||typeof X.drawElements=="function"}function Ra(X){return typeof X=="string"?X.split():(he(Array.isArray(X),"invalid extension array"),X)}function J(X){return typeof X=="string"?(he(typeof document!="undefined","not supported outside of DOM"),document.querySelector(X)):X}function $(X){var ae=X||{},Ge,Vt,hr,nr,Jt={},wr=[],jr=[],Vr=typeof window=="undefined"?1:window.devicePixelRatio,Xr=!1,Gr=function(Gt){Gt&&he.raise(Gt)},fn=function(){};if(typeof ae=="string"?(he(typeof document!="undefined","selector queries only supported in DOM environments"),Ge=document.querySelector(ae),he(Ge,"invalid query string for element")):typeof ae=="object"?As(ae)?Ge=ae:js(ae)?(nr=ae,hr=nr.canvas):(he.constructor(ae),"gl"in ae?nr=ae.gl:"canvas"in ae?hr=J(ae.canvas):"container"in ae&&(Vt=J(ae.container)),"attributes"in ae&&(Jt=ae.attributes,he.type(Jt,"object","invalid context attributes")),"extensions"in ae&&(wr=Ra(ae.extensions)),"optionalExtensions"in ae&&(jr=Ra(ae.optionalExtensions)),"onDone"in ae&&(he.type(ae.onDone,"function","invalid or missing onDone callback"),Gr=ae.onDone),"profile"in ae&&(Xr=!!ae.profile),"pixelRatio"in ae&&(Vr=+ae.pixelRatio,he(Vr>0,"invalid pixel ratio"))):he.raise("invalid arguments to regl"),Ge&&(Ge.nodeName.toLowerCase()==="canvas"?hr=Ge:Vt=Ge),!nr){if(!hr){he(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var rn=Wa(Vt||document.body,Gr,Vr);if(!rn)return null;hr=rn.canvas,fn=rn.onDestroy}Jt.premultipliedAlpha===void 0&&(Jt.premultipliedAlpha=!0),nr=ma(hr,Jt)}return nr?{gl:nr,canvas:hr,container:Vt,extensions:wr,optionalExtensions:jr,pixelRatio:Vr,profile:Xr,onDone:Gr,onDestroy:fn}:(fn(),Gr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function le(X,ae){var Ge={};function Vt(wr){he.type(wr,"string","extension name must be string");var jr=wr.toLowerCase(),Vr;try{Vr=Ge[jr]=hr(wr)}catch(Xr){}return!!Vr}function hr(wr){return X.getExtension(wr)?X.getExtension(wr):X.getExtension(wr.toLowerCase())?X.getExtension(wr.toLowerCase()):null}for(var nr=0;nr<ae.extensions.length;++nr){var Jt=ae.extensions[nr];if(!Vt(Jt))return ae.onDestroy(),ae.onDone('"'+Jt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ae.optionalExtensions.forEach(Vt),{extensions:Ge,restore:function(){Object.keys(Ge).forEach(function(jr){if(Ge[jr]&&!Vt(jr))throw new Error("(regl): error restoring extension "+jr)})}}}function ge(X,ae){for(var Ge=Array(X),Vt=0;Vt<X;++Vt)Ge[Vt]=ae(Vt);return Ge}var ke=5120,nt=5121,pt=5122,pe=5123,Ue=5124,qe=5125,Cr=5126;function Tr(X){for(var ae=16;ae<=1<<28;ae*=16)if(X<=ae)return ae;return 0}function tr(X){var ae,Ge;return ae=(X>65535)<<4,X>>>=ae,Ge=(X>255)<<3,X>>>=Ge,ae|=Ge,Ge=(X>15)<<2,X>>>=Ge,ae|=Ge,Ge=(X>3)<<1,X>>>=Ge,ae|=Ge,ae|X>>1}function Dr(){var X=ge(8,function(){return[]});function ae(nr){var Jt=Tr(nr),wr=X[tr(Jt)>>2];return wr.length>0?wr.pop():new ArrayBuffer(Jt)}function Ge(nr){X[tr(nr.byteLength)>>2].push(nr)}function Vt(nr,Jt){var wr=null;switch(nr){case ke:wr=new Int8Array(ae(Jt),0,Jt);break;case nt:wr=new Uint8Array(ae(Jt),0,Jt);break;case pt:wr=new Int16Array(ae(2*Jt),0,Jt);break;case pe:wr=new Uint16Array(ae(2*Jt),0,Jt);break;case Ue:wr=new Int32Array(ae(4*Jt),0,Jt);break;case qe:wr=new Uint32Array(ae(4*Jt),0,Jt);break;case Cr:wr=new Float32Array(ae(4*Jt),0,Jt);break;default:return null}return wr.length!==Jt?wr.subarray(0,Jt):wr}function hr(nr){Ge(nr.buffer)}return{alloc:ae,free:Ge,allocType:Vt,freeType:hr}}var nn=Dr();nn.zero=Dr();var Mn=3408,rr=3410,wn=3411,mn=3412,xn=3413,w=3414,An=3415,Lr=33901,Zi=33902,Ti=3379,Un=3386,Bi=34921,Mo=36347,ra=36348,to=35661,ca=35660,ci=34930,bi=36349,vo=34076,mo=34024,ia=7936,Za=7937,so=7938,bl=35724,Ta=34047,cu=36063,ga=34852,Va=3553,Co=34067,wa=34069,qo=33984,wo=6408,jo=5126,ya=5121,Nl=36160,ls=36053,uo=36064,$s=16384,Lo=function(ae,Ge){var Vt=1;Ge.ext_texture_filter_anisotropic&&(Vt=ae.getParameter(Ta));var hr=1,nr=1;Ge.webgl_draw_buffers&&(hr=ae.getParameter(ga),nr=ae.getParameter(cu));var Jt=!!Ge.oes_texture_float;if(Jt){var wr=ae.createTexture();ae.bindTexture(Va,wr),ae.texImage2D(Va,0,wo,1,1,0,wo,jo,null);var jr=ae.createFramebuffer();if(ae.bindFramebuffer(Nl,jr),ae.framebufferTexture2D(Nl,uo,Va,wr,0),ae.bindTexture(Va,null),ae.checkFramebufferStatus(Nl)!==ls)Jt=!1;else{ae.viewport(0,0,1,1),ae.clearColor(1,0,0,1),ae.clear($s);var Vr=nn.allocType(jo,4);ae.readPixels(0,0,1,1,wo,jo,Vr),ae.getError()?Jt=!1:(ae.deleteFramebuffer(jr),ae.deleteTexture(wr),Jt=Vr[0]===1),nn.freeType(Vr)}}var Xr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Gr=!0;if(!Xr){var fn=ae.createTexture(),rn=nn.allocType(ya,36);ae.activeTexture(qo),ae.bindTexture(Co,fn),ae.texImage2D(wa,0,wo,3,3,0,wo,ya,rn),nn.freeType(rn),ae.bindTexture(Co,null),ae.deleteTexture(fn),Gr=!ae.getError()}return{colorBits:[ae.getParameter(rr),ae.getParameter(wn),ae.getParameter(mn),ae.getParameter(xn)],depthBits:ae.getParameter(w),stencilBits:ae.getParameter(An),subpixelBits:ae.getParameter(Mn),extensions:Object.keys(Ge).filter(function(zr){return!!Ge[zr]}),maxAnisotropic:Vt,maxDrawbuffers:hr,maxColorAttachments:nr,pointSizeDims:ae.getParameter(Lr),lineWidthDims:ae.getParameter(Zi),maxViewportDims:ae.getParameter(Un),maxCombinedTextureUnits:ae.getParameter(to),maxCubeMapSize:ae.getParameter(vo),maxRenderbufferSize:ae.getParameter(mo),maxTextureUnits:ae.getParameter(ci),maxTextureSize:ae.getParameter(Ti),maxAttributes:ae.getParameter(Bi),maxVertexUniforms:ae.getParameter(Mo),maxVertexTextureUnits:ae.getParameter(ca),maxVaryingVectors:ae.getParameter(ra),maxFragmentUniforms:ae.getParameter(bi),glsl:ae.getParameter(bl),renderer:ae.getParameter(Za),vendor:ae.getParameter(ia),version:ae.getParameter(so),readFloat:Jt,npotTextureCube:Gr}};function go(X){return!!X&&typeof X=="object"&&Array.isArray(X.shape)&&Array.isArray(X.stride)&&typeof X.offset=="number"&&X.shape.length===X.stride.length&&(Array.isArray(X.data)||re(X.data))}var We=function(ae){return Object.keys(ae).map(function(Ge){return ae[Ge]})},se={shape:Na,flatten:Ni};function Be(X,ae,Ge){for(var Vt=0;Vt<ae;++Vt)Ge[Vt]=X[Vt]}function Rt(X,ae,Ge,Vt){for(var hr=0,nr=0;nr<ae;++nr)for(var Jt=X[nr],wr=0;wr<Ge;++wr)Vt[hr++]=Jt[wr]}function Zr(X,ae,Ge,Vt,hr,nr){for(var Jt=nr,wr=0;wr<ae;++wr)for(var jr=X[wr],Vr=0;Vr<Ge;++Vr)for(var Xr=jr[Vr],Gr=0;Gr<Vt;++Gr)hr[Jt++]=Xr[Gr]}function kn(X,ae,Ge,Vt,hr){for(var nr=1,Jt=Ge+1;Jt<ae.length;++Jt)nr*=ae[Jt];var wr=ae[Ge];if(ae.length-Ge==4){var jr=ae[Ge+1],Vr=ae[Ge+2],Xr=ae[Ge+3];for(Jt=0;Jt<wr;++Jt)Zr(X[Jt],jr,Vr,Xr,Vt,hr),hr+=nr}else for(Jt=0;Jt<wr;++Jt)kn(X[Jt],ae,Ge+1,Vt,hr),hr+=nr}function Ni(X,ae,Ge,Vt){var hr=1;if(ae.length)for(var nr=0;nr<ae.length;++nr)hr*=ae[nr];else hr=0;var Jt=Vt||nn.allocType(Ge,hr);switch(ae.length){case 0:break;case 1:Be(X,ae[0],Jt);break;case 2:Rt(X,ae[0],ae[1],Jt);break;case 3:Zr(X,ae[0],ae[1],ae[2],Jt,0);break;default:kn(X,ae,0,Jt,0)}return Jt}function Na(X){for(var ae=[],Ge=X;Ge.length;Ge=Ge[0])ae.push(Ge.length);return ae}var Ma={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Xa=5120,Do=5122,$c=5124,Ks=5121,Qo=5123,Vo=5125,qs=5126,gu=5126,Vs={int8:Xa,int16:Do,int32:$c,uint8:Ks,uint16:Qo,uint32:Vo,float:qs,float32:gu},nl=35048,Qs=35040,Ga={dynamic:nl,stream:Qs,static:35044},Ya=se.flatten,El=se.shape,yu=35044,kh=35040,Kc=5121,ec=5126,_u=[];_u[5120]=1,_u[5122]=2,_u[5124]=4,_u[5121]=1,_u[5123]=2,_u[5125]=4,_u[5126]=4;function bc(X){return Ma[Object.prototype.toString.call(X)]|0}function _(X,ae){for(var Ge=0;Ge<ae.length;++Ge)X[Ge]=ae[Ge]}function P(X,ae,Ge,Vt,hr,nr,Jt){for(var wr=0,jr=0;jr<Ge;++jr)for(var Vr=0;Vr<Vt;++Vr)X[wr++]=ae[hr*jr+nr*Vr+Jt]}function z(X,ae,Ge,Vt){var hr=0,nr={};function Jt(Gt){this.id=hr++,this.buffer=X.createBuffer(),this.type=Gt,this.usage=yu,this.byteLength=0,this.dimension=1,this.dtype=Kc,this.persistentData=null,Ge.profile&&(this.stats={size:0})}Jt.prototype.bind=function(){X.bindBuffer(this.type,this.buffer)},Jt.prototype.destroy=function(){fn(this)};var wr=[];function jr(Gt,Ht){var Br=wr.pop();return Br||(Br=new Jt(Gt)),Br.bind(),Gr(Br,Ht,kh,0,1,!1),Br}function Vr(Gt){wr.push(Gt)}function Xr(Gt,Ht,Br){Gt.byteLength=Ht.byteLength,X.bufferData(Gt.type,Ht,Br)}function Gr(Gt,Ht,Br,Sn,cr,Dn){var Rn;if(Gt.usage=Br,Array.isArray(Ht)){if(Gt.dtype=Sn||ec,Ht.length>0){var Qr;if(Array.isArray(Ht[0])){Rn=El(Ht);for(var xr=1,ar=1;ar<Rn.length;++ar)xr*=Rn[ar];Gt.dimension=xr,Qr=Ya(Ht,Rn,Gt.dtype),Xr(Gt,Qr,Br),Dn?Gt.persistentData=Qr:nn.freeType(Qr)}else if(typeof Ht[0]=="number"){Gt.dimension=cr;var an=nn.allocType(Gt.dtype,Ht.length);_(an,Ht),Xr(Gt,an,Br),Dn?Gt.persistentData=an:nn.freeType(an)}else re(Ht[0])?(Gt.dimension=Ht[0].length,Gt.dtype=Sn||bc(Ht[0])||ec,Qr=Ya(Ht,[Ht.length,Ht[0].length],Gt.dtype),Xr(Gt,Qr,Br),Dn?Gt.persistentData=Qr:nn.freeType(Qr)):he.raise("invalid buffer data")}}else if(re(Ht))Gt.dtype=Sn||bc(Ht),Gt.dimension=cr,Xr(Gt,Ht,Br),Dn&&(Gt.persistentData=new Uint8Array(new Uint8Array(Ht.buffer)));else if(go(Ht)){Rn=Ht.shape;var ln=Ht.stride,Wr=Ht.offset,vn=0,hn=0,Ii=0,Si=0;Rn.length===1?(vn=Rn[0],hn=1,Ii=ln[0],Si=0):Rn.length===2?(vn=Rn[0],hn=Rn[1],Ii=ln[0],Si=ln[1]):he.raise("invalid shape"),Gt.dtype=Sn||bc(Ht.data)||ec,Gt.dimension=hn;var yn=nn.allocType(Gt.dtype,vn*hn);P(yn,Ht.data,vn,hn,Ii,Si,Wr),Xr(Gt,yn,Br),Dn?Gt.persistentData=yn:nn.freeType(yn)}else Ht instanceof ArrayBuffer?(Gt.dtype=Kc,Gt.dimension=cr,Xr(Gt,Ht,Br),Dn&&(Gt.persistentData=new Uint8Array(new Uint8Array(Ht)))):he.raise("invalid buffer data")}function fn(Gt){ae.bufferCount--,Vt(Gt);var Ht=Gt.buffer;he(Ht,"buffer must not be deleted already"),X.deleteBuffer(Ht),Gt.buffer=null,delete nr[Gt.id]}function rn(Gt,Ht,Br,Sn){ae.bufferCount++;var cr=new Jt(Ht);nr[cr.id]=cr;function Dn(xr){var ar=yu,an=null,ln=0,Wr=0,vn=1;return Array.isArray(xr)||re(xr)||go(xr)||xr instanceof ArrayBuffer?an=xr:typeof xr=="number"?ln=xr|0:xr&&(he.type(xr,"object","buffer arguments must be an object, a number or an array"),"data"in xr&&(he(an===null||Array.isArray(an)||re(an)||go(an),"invalid data for buffer"),an=xr.data),"usage"in xr&&(he.parameter(xr.usage,Ga,"invalid buffer usage"),ar=Ga[xr.usage]),"type"in xr&&(he.parameter(xr.type,Vs,"invalid buffer type"),Wr=Vs[xr.type]),"dimension"in xr&&(he.type(xr.dimension,"number","invalid dimension"),vn=xr.dimension|0),"length"in xr&&(he.nni(ln,"buffer length must be a nonnegative integer"),ln=xr.length|0)),cr.bind(),an?Gr(cr,an,ar,Wr,vn,Sn):(ln&&X.bufferData(cr.type,ln,ar),cr.dtype=Wr||Kc,cr.usage=ar,cr.dimension=vn,cr.byteLength=ln),Ge.profile&&(cr.stats.size=cr.byteLength*_u[cr.dtype]),Dn}function Rn(xr,ar){he(ar+xr.byteLength<=cr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+xr.byteLength+" starting from offset "+ar+" to a buffer of size "+cr.byteLength),X.bufferSubData(cr.type,ar,xr)}function Qr(xr,ar){var an=(ar||0)|0,ln;if(cr.bind(),re(xr)||xr instanceof ArrayBuffer)Rn(xr,an);else if(Array.isArray(xr)){if(xr.length>0)if(typeof xr[0]=="number"){var Wr=nn.allocType(cr.dtype,xr.length);_(Wr,xr),Rn(Wr,an),nn.freeType(Wr)}else if(Array.isArray(xr[0])||re(xr[0])){ln=El(xr);var vn=Ya(xr,ln,cr.dtype);Rn(vn,an),nn.freeType(vn)}else he.raise("invalid buffer data")}else if(go(xr)){ln=xr.shape;var hn=xr.stride,Ii=0,Si=0,yn=0,En=0;ln.length===1?(Ii=ln[0],Si=1,yn=hn[0],En=0):ln.length===2?(Ii=ln[0],Si=ln[1],yn=hn[0],En=hn[1]):he.raise("invalid shape");var hi=Array.isArray(xr.data)?cr.dtype:bc(xr.data),Ci=nn.allocType(hi,Ii*Si);P(Ci,xr.data,Ii,Si,yn,En,xr.offset),Rn(Ci,an),nn.freeType(Ci)}else he.raise("invalid data for buffer subdata");return Dn}return Br||Dn(Gt),Dn._reglType="buffer",Dn._buffer=cr,Dn.subdata=Qr,Ge.profile&&(Dn.stats=cr.stats),Dn.destroy=function(){fn(cr)},Dn}function zr(){We(nr).forEach(function(Gt){Gt.buffer=X.createBuffer(),X.bindBuffer(Gt.type,Gt.buffer),X.bufferData(Gt.type,Gt.persistentData||Gt.byteLength,Gt.usage)})}return Ge.profile&&(ae.getTotalBufferSize=function(){var Gt=0;return Object.keys(nr).forEach(function(Ht){Gt+=nr[Ht].stats.size}),Gt}),{create:rn,createStream:jr,destroyStream:Vr,clear:function(){We(nr).forEach(fn),wr.forEach(fn)},getBuffer:function(Ht){return Ht&&Ht._buffer instanceof Jt?Ht._buffer:null},restore:zr,_initBuffer:Gr}}var L=0,te=0,Ce=1,rt=1,Ct=4,ft=4,Sr={points:L,point:te,lines:Ce,line:rt,triangles:Ct,triangle:ft,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},kr=0,ni=1,xi=4,gi=5120,dt=5121,ua=5122,yt=5123,fu=5124,Ha=5125,fa=34963,Sl=35040,Ec=35044;function bn(X,ae,Ge,Vt){var hr={},nr=0,Jt={uint8:dt,uint16:yt};ae.oes_element_index_uint&&(Jt.uint32=Ha);function wr(zr){this.id=nr++,hr[this.id]=this,this.buffer=zr,this.primType=xi,this.vertCount=0,this.type=0}wr.prototype.bind=function(){this.buffer.bind()};var jr=[];function Vr(zr){var Gt=jr.pop();return Gt||(Gt=new wr(Ge.create(null,fa,!0,!1)._buffer)),Gr(Gt,zr,Sl,-1,-1,0,0),Gt}function Xr(zr){jr.push(zr)}function Gr(zr,Gt,Ht,Br,Sn,cr,Dn){zr.buffer.bind();var Rn;if(Gt){var Qr=Dn;!Dn&&(!re(Gt)||go(Gt)&&!re(Gt.data))&&(Qr=ae.oes_element_index_uint?Ha:yt),Ge._initBuffer(zr.buffer,Gt,Ht,Qr,3)}else X.bufferData(fa,cr,Ht),zr.buffer.dtype=Rn||dt,zr.buffer.usage=Ht,zr.buffer.dimension=3,zr.buffer.byteLength=cr;if(Rn=Dn,!Dn){switch(zr.buffer.dtype){case dt:case gi:Rn=dt;break;case yt:case ua:Rn=yt;break;case Ha:case fu:Rn=Ha;break;default:he.raise("unsupported type for element array")}zr.buffer.dtype=Rn}zr.type=Rn,he(Rn!==Ha||!!ae.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var xr=Sn;xr<0&&(xr=zr.buffer.byteLength,Rn===yt?xr>>=1:Rn===Ha&&(xr>>=2)),zr.vertCount=xr;var ar=Br;if(Br<0){ar=xi;var an=zr.buffer.dimension;an===1&&(ar=kr),an===2&&(ar=ni),an===3&&(ar=xi)}zr.primType=ar}function fn(zr){Vt.elementsCount--,he(zr.buffer!==null,"must not double destroy elements"),delete hr[zr.id],zr.buffer.destroy(),zr.buffer=null}function rn(zr,Gt){var Ht=Ge.create(null,fa,!0),Br=new wr(Ht._buffer);Vt.elementsCount++;function Sn(cr){if(!cr)Ht(),Br.primType=xi,Br.vertCount=0,Br.type=dt;else if(typeof cr=="number")Ht(cr),Br.primType=xi,Br.vertCount=cr|0,Br.type=dt;else{var Dn=null,Rn=Ec,Qr=-1,xr=-1,ar=0,an=0;Array.isArray(cr)||re(cr)||go(cr)?Dn=cr:(he.type(cr,"object","invalid arguments for elements"),"data"in cr&&(Dn=cr.data,he(Array.isArray(Dn)||re(Dn)||go(Dn),"invalid data for element buffer")),"usage"in cr&&(he.parameter(cr.usage,Ga,"invalid element buffer usage"),Rn=Ga[cr.usage]),"primitive"in cr&&(he.parameter(cr.primitive,Sr,"invalid element buffer primitive"),Qr=Sr[cr.primitive]),"count"in cr&&(he(typeof cr.count=="number"&&cr.count>=0,"invalid vertex count for elements"),xr=cr.count|0),"type"in cr&&(he.parameter(cr.type,Jt,"invalid buffer type"),an=Jt[cr.type]),"length"in cr?ar=cr.length|0:(ar=xr,an===yt||an===ua?ar*=2:(an===Ha||an===fu)&&(ar*=4))),Gr(Br,Dn,Rn,Qr,xr,ar,an)}return Sn}return Sn(zr),Sn._reglType="elements",Sn._elements=Br,Sn.subdata=function(cr,Dn){return Ht.subdata(cr,Dn),Sn},Sn.destroy=function(){fn(Br)},Sn}return{create:rn,createStream:Vr,destroyStream:Xr,getElements:function(Gt){return typeof Gt=="function"&&Gt._elements instanceof wr?Gt._elements:null},clear:function(){We(hr).forEach(fn)}}}var qc=new Float32Array(1),In=new Uint32Array(qc.buffer),Rf=5123;function Lt(X){for(var ae=nn.allocType(Rf,X.length),Ge=0;Ge<X.length;++Ge)if(isNaN(X[Ge]))ae[Ge]=65535;else if(X[Ge]===Infinity)ae[Ge]=31744;else if(X[Ge]===-Infinity)ae[Ge]=64512;else{qc[0]=X[Ge];var Vt=In[0],hr=Vt>>>31<<15,nr=(Vt<<1>>>24)-127,Jt=Vt>>13&(1<<10)-1;if(nr<-24)ae[Ge]=hr;else if(nr<-14){var wr=-14-nr;ae[Ge]=hr+(Jt+(1<<10)>>wr)}else nr>15?ae[Ge]=hr+31744:ae[Ge]=hr+(nr+15<<10)+Jt}return ae}function Ca(X){return Array.isArray(X)||re(X)}var zl=function(ae){return!(ae&ae-1)&&!!ae},ue=34467,Du=3553,Qc=34067,Fu=34069,xu=6408,Bu=6406,il=6407,Sc=6409,Cl=6410,ka=32854,Cc=32855,sh=36194,wc=32819,kf=32820,uh=33635,Lf=34042,Ul=6402,bu=34041,jl=35904,tc=35906,Js=36193,Nu=33776,rc=33777,wl=33778,Ts=33779,Jc=35986,ef=35987,tf=34798,Vl=35840,Al=35841,rf=35842,Df=35843,al=36196,zu=5121,Ac=5123,nf=5125,nc=5126,Lh=10242,Ff=10243,Bf=10497,ys=33071,eu=33648,Nf=10240,_p=10241,_s=9728,ro=9729,ic=9984,Tl=9985,ol=9986,Qi=9987,za=33170,Ms=4352,Ml=4353,Ps=4354,af=34046,xp=3317,lh=37440,of=37441,sf=37443,Eu=37444,ha=33984,Gl=[ic,ol,Tl,Qi],ac=[0,Sc,Cl,il,xu],Xi={};Xi[Sc]=Xi[Bu]=Xi[Ul]=1,Xi[bu]=Xi[Cl]=2,Xi[il]=Xi[jl]=3,Xi[xu]=Xi[tc]=4;function Ln(X){return"[object "+X+"]"}var Os=Ln("HTMLCanvasElement"),uf=Ln("OffscreenCanvas"),oc=Ln("CanvasRenderingContext2D"),Su=Ln("ImageBitmap"),Is=Ln("HTMLImageElement"),lf=Ln("HTMLVideoElement"),gn=Object.keys(Ma).concat([Os,uf,oc,Su,Is,lf]),Hl=[];Hl[zu]=1,Hl[nc]=4,Hl[Js]=2,Hl[Ac]=2,Hl[nf]=4;var Fo=[];Fo[ka]=2,Fo[Cc]=2,Fo[sh]=2,Fo[bu]=4,Fo[Nu]=.5,Fo[rc]=.5,Fo[wl]=1,Fo[Ts]=1,Fo[Jc]=.5,Fo[ef]=1,Fo[tf]=1,Fo[Vl]=.5,Fo[Al]=.25,Fo[rf]=.5,Fo[Df]=.25,Fo[al]=.5;function zf(X){return Array.isArray(X)&&(X.length===0||typeof X[0]=="number")}function hu(X){if(!Array.isArray(X))return!1;var ae=X.length;return!(ae===0||!Ca(X[0]))}function Go(X){return Object.prototype.toString.call(X)}function cf(X){return Go(X)===Os}function ff(X){return Go(X)===uf}function tu(X){return Go(X)===oc}function Uu(X){return Go(X)===Su}function ch(X){return Go(X)===Is}function hf(X){return Go(X)===lf}function Uf(X){var ae=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ae&&X&&X.getContext)}function jf(X){var ae=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ae&&X&&"src"in X&&"crossOrigin"in X)}function Cu(X){if(!X)return!1;if(Uf(X)||jf(X))return!0;var ae=Go(X);return gn.indexOf(ae)>=0?!0:zf(X)||hu(X)||go(X)}function lo(X){return Ma[Object.prototype.toString.call(X)]|0}function $i(X,ae){var Ge=ae.length;switch(X.type){case zu:case Ac:case nf:case nc:var Vt=nn.allocType(X.type,Ge);Vt.set(ae),X.data=Vt;break;case Js:X.data=Lt(ae);break;default:he.raise("unsupported texture type, must specify a typed array")}}function ju(X,ae){return nn.allocType(X.type===Js?nc:X.type,ae)}function pu(X,ae){X.type===Js?(X.data=Lt(ae),nn.freeType(ae)):X.data=ae}function Ho(X,ae,Ge,Vt,hr,nr){for(var Jt=X.width,wr=X.height,jr=X.channels,Vr=Jt*wr*jr,Xr=ju(X,Vr),Gr=0,fn=0;fn<wr;++fn)for(var rn=0;rn<Jt;++rn)for(var zr=0;zr<jr;++zr)Xr[Gr++]=ae[Ge*rn+Vt*fn+hr*zr+nr];pu(X,Xr)}function wu(X,ae,Ge,Vt,hr,nr){var Jt;if(typeof Fo[X]!="undefined"?Jt=Fo[X]:Jt=Xi[X]*Hl[ae],nr&&(Jt*=6),hr){for(var wr=0,jr=Ge;jr>=1;)wr+=Jt*jr*jr,jr/=2;return wr}else return Jt*Ge*Vt}function Wl(X,ae,Ge,Vt,hr,nr,Jt){var wr={"don't care":Ms,"dont care":Ms,nice:Ps,fast:Ml},jr={repeat:Bf,clamp:ys,mirror:eu},Vr={nearest:_s,linear:ro},Xr=ne({mipmap:Qi,"nearest mipmap nearest":ic,"linear mipmap nearest":Tl,"nearest mipmap linear":ol,"linear mipmap linear":Qi},Vr),Gr={none:0,browser:Eu},fn={uint8:zu,rgba4:wc,rgb565:uh,"rgb5 a1":kf},rn={alpha:Bu,luminance:Sc,"luminance alpha":Cl,rgb:il,rgba:xu,rgba4:ka,"rgb5 a1":Cc,rgb565:sh},zr={};ae.ext_srgb&&(rn.srgb=jl,rn.srgba=tc),ae.oes_texture_float&&(fn.float32=fn.float=nc),ae.oes_texture_half_float&&(fn.float16=fn["half float"]=Js),ae.webgl_depth_texture&&(ne(rn,{depth:Ul,"depth stencil":bu}),ne(fn,{uint16:Ac,uint32:nf,"depth stencil":Lf})),ae.webgl_compressed_texture_s3tc&&ne(zr,{"rgb s3tc dxt1":Nu,"rgba s3tc dxt1":rc,"rgba s3tc dxt3":wl,"rgba s3tc dxt5":Ts}),ae.webgl_compressed_texture_atc&&ne(zr,{"rgb atc":Jc,"rgba atc explicit alpha":ef,"rgba atc interpolated alpha":tf}),ae.webgl_compressed_texture_pvrtc&&ne(zr,{"rgb pvrtc 4bppv1":Vl,"rgb pvrtc 2bppv1":Al,"rgba pvrtc 4bppv1":rf,"rgba pvrtc 2bppv1":Df}),ae.webgl_compressed_texture_etc1&&(zr["rgb etc1"]=al);var Gt=Array.prototype.slice.call(X.getParameter(ue)||new Uint32Array(0));Object.keys(zr).forEach(function(De){var er=zr[De];Gt.indexOf(er)>=0&&(rn[De]=er)});var Ht=Object.keys(rn);Ge.textureFormats=Ht;var Br=[];Object.keys(rn).forEach(function(De){var er=rn[De];Br[er]=De});var Sn=[];Object.keys(fn).forEach(function(De){var er=fn[De];Sn[er]=De});var cr=[];Object.keys(Vr).forEach(function(De){var er=Vr[De];cr[er]=De});var Dn=[];Object.keys(Xr).forEach(function(De){var er=Xr[De];Dn[er]=De});var Rn=[];Object.keys(jr).forEach(function(De){var er=jr[De];Rn[er]=De});var Qr=Ht.reduce(function(De,er){var Ft=rn[er];return Ft===Sc||Ft===Bu||Ft===Sc||Ft===Cl||Ft===Ul||Ft===bu||ae.ext_srgb&&(Ft===jl||Ft===tc)?De[Ft]=Ft:Ft===Cc||er.indexOf("rgba")>=0?De[Ft]=xu:De[Ft]=il,De},{});function xr(){this.internalformat=xu,this.format=xu,this.type=zu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Eu,this.width=0,this.height=0,this.channels=0}function ar(De,er){De.internalformat=er.internalformat,De.format=er.format,De.type=er.type,De.compressed=er.compressed,De.premultiplyAlpha=er.premultiplyAlpha,De.flipY=er.flipY,De.unpackAlignment=er.unpackAlignment,De.colorSpace=er.colorSpace,De.width=er.width,De.height=er.height,De.channels=er.channels}function an(De,er){if(!(typeof er!="object"||!er)){if("premultiplyAlpha"in er&&(he.type(er.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),De.premultiplyAlpha=er.premultiplyAlpha),"flipY"in er&&(he.type(er.flipY,"boolean","invalid texture flip"),De.flipY=er.flipY),"alignment"in er&&(he.oneOf(er.alignment,[1,2,4,8],"invalid texture unpack alignment"),De.unpackAlignment=er.alignment),"colorSpace"in er&&(he.parameter(er.colorSpace,Gr,"invalid colorSpace"),De.colorSpace=Gr[er.colorSpace]),"type"in er){var Ft=er.type;he(ae.oes_texture_float||!(Ft==="float"||Ft==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),he(ae.oes_texture_half_float||!(Ft==="half float"||Ft==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),he(ae.webgl_depth_texture||!(Ft==="uint16"||Ft==="uint32"||Ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(Ft,fn,"invalid texture type"),De.type=fn[Ft]}var Pn=De.width,Vi=De.height,we=De.channels,de=!1;"shape"in er?(he(Array.isArray(er.shape)&&er.shape.length>=2,"shape must be an array"),Pn=er.shape[0],Vi=er.shape[1],er.shape.length===3&&(we=er.shape[2],he(we>0&&we<=4,"invalid number of channels"),de=!0),he(Pn>=0&&Pn<=Ge.maxTextureSize,"invalid width"),he(Vi>=0&&Vi<=Ge.maxTextureSize,"invalid height")):("radius"in er&&(Pn=Vi=er.radius,he(Pn>=0&&Pn<=Ge.maxTextureSize,"invalid radius")),"width"in er&&(Pn=er.width,he(Pn>=0&&Pn<=Ge.maxTextureSize,"invalid width")),"height"in er&&(Vi=er.height,he(Vi>=0&&Vi<=Ge.maxTextureSize,"invalid height")),"channels"in er&&(we=er.channels,he(we>0&&we<=4,"invalid number of channels"),de=!0)),De.width=Pn|0,De.height=Vi|0,De.channels=we|0;var Qe=!1;if("format"in er){var Pt=er.format;he(ae.webgl_depth_texture||!(Pt==="depth"||Pt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),he.parameter(Pt,rn,"invalid texture format");var Kt=De.internalformat=rn[Pt];De.format=Qr[Kt],Pt in fn&&("type"in er||(De.type=fn[Pt])),Pt in zr&&(De.compressed=!0),Qe=!0}!de&&Qe?De.channels=Xi[De.format]:de&&!Qe?De.channels!==ac[De.format]&&(De.format=De.internalformat=ac[De.channels]):Qe&&de&&he(De.channels===Xi[De.format],"number of channels inconsistent with specified format")}}function ln(De){X.pixelStorei(lh,De.flipY),X.pixelStorei(of,De.premultiplyAlpha),X.pixelStorei(sf,De.colorSpace),X.pixelStorei(xp,De.unpackAlignment)}function Wr(){xr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function vn(De,er){var Ft=null;if(Cu(er)?Ft=er:er&&(he.type(er,"object","invalid pixel data type"),an(De,er),"x"in er&&(De.xOffset=er.x|0),"y"in er&&(De.yOffset=er.y|0),Cu(er.data)&&(Ft=er.data)),he(!De.compressed||Ft instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),er.copy){he(!Ft,"can not specify copy and data field for the same texture");var Pn=hr.viewportWidth,Vi=hr.viewportHeight;De.width=De.width||Pn-De.xOffset,De.height=De.height||Vi-De.yOffset,De.needsCopy=!0,he(De.xOffset>=0&&De.xOffset<Pn&&De.yOffset>=0&&De.yOffset<Vi&&De.width>0&&De.width<=Pn&&De.height>0&&De.height<=Vi,"copy texture read out of bounds")}else if(!Ft)De.width=De.width||1,De.height=De.height||1,De.channels=De.channels||4;else if(re(Ft))De.channels=De.channels||4,De.data=Ft,!("type"in er)&&De.type===zu&&(De.type=lo(Ft));else if(zf(Ft))De.channels=De.channels||4,$i(De,Ft),De.alignment=1,De.needsFree=!0;else if(go(Ft)){var we=Ft.data;!Array.isArray(we)&&De.type===zu&&(De.type=lo(we));var de=Ft.shape,Qe=Ft.stride,Pt,Kt,ot,tt,ct,me;de.length===3?(ot=de[2],me=Qe[2]):(he(de.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ot=1,me=1),Pt=de[0],Kt=de[1],tt=Qe[0],ct=Qe[1],De.alignment=1,De.width=Pt,De.height=Kt,De.channels=ot,De.format=De.internalformat=ac[ot],De.needsFree=!0,Ho(De,we,tt,ct,me,Ft.offset)}else if(Uf(Ft)||cf(Ft)||ff(Ft)||tu(Ft))Uf(Ft)||cf(Ft)||ff(Ft)?De.element=Ft:De.element=Ft.canvas,De.width=De.element.width,De.height=De.element.height,De.channels=4;else if(Uu(Ft))De.element=Ft,De.width=Ft.width,De.height=Ft.height,De.channels=4;else if(ch(Ft))De.element=Ft,De.width=Ft.naturalWidth,De.height=Ft.naturalHeight,De.channels=4;else if(jf(Ft))De.element=Ft,De.width=Ft.width,De.height=Ft.height,De.channels=4;else if(hf(Ft))De.element=Ft,De.width=Ft.videoWidth,De.height=Ft.videoHeight,De.channels=4;else if(hu(Ft)){var Ke=De.width||Ft[0].length,Ae=De.height||Ft.length,At=De.channels;Ca(Ft[0][0])?At=At||Ft[0][0].length:At=At||1;for(var zt=se.shape(Ft),Mr=1,on=0;on<zt.length;++on)Mr*=zt[on];var sn=ju(De,Mr);se.flatten(Ft,zt,"",sn),pu(De,sn),De.alignment=1,De.width=Ke,De.height=Ae,De.channels=At,De.format=De.internalformat=ac[At],De.needsFree=!0}De.type===nc?he(Ge.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):De.type===Js&&he(Ge.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function hn(De,er,Ft){var Pn=De.element,Vi=De.data,we=De.internalformat,de=De.format,Qe=De.type,Pt=De.width,Kt=De.height;ln(De),Pn?X.texImage2D(er,Ft,de,de,Qe,Pn):De.compressed?X.compressedTexImage2D(er,Ft,we,Pt,Kt,0,Vi):De.needsCopy?(Vt(),X.copyTexImage2D(er,Ft,de,De.xOffset,De.yOffset,Pt,Kt,0)):X.texImage2D(er,Ft,de,Pt,Kt,0,de,Qe,Vi||null)}function Ii(De,er,Ft,Pn,Vi){var we=De.element,de=De.data,Qe=De.internalformat,Pt=De.format,Kt=De.type,ot=De.width,tt=De.height;ln(De),we?X.texSubImage2D(er,Vi,Ft,Pn,Pt,Kt,we):De.compressed?X.compressedTexSubImage2D(er,Vi,Ft,Pn,Qe,ot,tt,de):De.needsCopy?(Vt(),X.copyTexSubImage2D(er,Vi,Ft,Pn,De.xOffset,De.yOffset,ot,tt)):X.texSubImage2D(er,Vi,Ft,Pn,ot,tt,Pt,Kt,de)}var Si=[];function yn(){return Si.pop()||new Wr}function En(De){De.needsFree&&nn.freeType(De.data),Wr.call(De),Si.push(De)}function hi(){xr.call(this),this.genMipmaps=!1,this.mipmapHint=Ms,this.mipmask=0,this.images=Array(16)}function Ci(De,er,Ft){var Pn=De.images[0]=yn();De.mipmask=1,Pn.width=De.width=er,Pn.height=De.height=Ft,Pn.channels=De.channels=4}function Yi(De,er){var Ft=null;if(Cu(er))Ft=De.images[0]=yn(),ar(Ft,De),vn(Ft,er),De.mipmask=1;else if(an(De,er),Array.isArray(er.mipmap))for(var Pn=er.mipmap,Vi=0;Vi<Pn.length;++Vi)Ft=De.images[Vi]=yn(),ar(Ft,De),Ft.width>>=Vi,Ft.height>>=Vi,vn(Ft,Pn[Vi]),De.mipmask|=1<<Vi;else Ft=De.images[0]=yn(),ar(Ft,De),vn(Ft,er),De.mipmask=1;ar(De,De.images[0]),De.compressed&&(De.internalformat===Nu||De.internalformat===rc||De.internalformat===wl||De.internalformat===Ts)&&he(De.width%4==0&&De.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ho(De,er){for(var Ft=De.images,Pn=0;Pn<Ft.length;++Pn){if(!Ft[Pn])return;hn(Ft[Pn],er,Pn)}}var Ao=[];function Ki(){var De=Ao.pop()||new hi;xr.call(De),De.mipmask=0;for(var er=0;er<16;++er)De.images[er]=null;return De}function ns(De){for(var er=De.images,Ft=0;Ft<er.length;++Ft)er[Ft]&&En(er[Ft]),er[Ft]=null;Ao.push(De)}function Pa(){this.minFilter=_s,this.magFilter=_s,this.wrapS=ys,this.wrapT=ys,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ms}function Xo(De,er){if("min"in er){var Ft=er.min;he.parameter(Ft,Xr),De.minFilter=Xr[Ft],Gl.indexOf(De.minFilter)>=0&&!("faces"in er)&&(De.genMipmaps=!0)}if("mag"in er){var Pn=er.mag;he.parameter(Pn,Vr),De.magFilter=Vr[Pn]}var Vi=De.wrapS,we=De.wrapT;if("wrap"in er){var de=er.wrap;typeof de=="string"?(he.parameter(de,jr),Vi=we=jr[de]):Array.isArray(de)&&(he.parameter(de[0],jr),he.parameter(de[1],jr),Vi=jr[de[0]],we=jr[de[1]])}else{if("wrapS"in er){var Qe=er.wrapS;he.parameter(Qe,jr),Vi=jr[Qe]}if("wrapT"in er){var Pt=er.wrapT;he.parameter(Pt,jr),we=jr[Pt]}}if(De.wrapS=Vi,De.wrapT=we,"anisotropic"in er){var Kt=er.anisotropic;he(typeof Kt=="number"&&Kt>=1&&Kt<=Ge.maxAnisotropic,"aniso samples must be between 1 and "),De.anisotropic=er.anisotropic}if("mipmap"in er){var ot=!1;switch(typeof er.mipmap){case"string":he.parameter(er.mipmap,wr,"invalid mipmap hint"),De.mipmapHint=wr[er.mipmap],De.genMipmaps=!0,ot=!0;break;case"boolean":ot=De.genMipmaps=er.mipmap;break;case"object":he(Array.isArray(er.mipmap),"invalid mipmap type"),De.genMipmaps=!1,ot=!0;break;default:he.raise("invalid mipmap type")}ot&&!("min"in er)&&(De.minFilter=ic)}}function Ai(De,er){X.texParameteri(er,_p,De.minFilter),X.texParameteri(er,Nf,De.magFilter),X.texParameteri(er,Lh,De.wrapS),X.texParameteri(er,Ff,De.wrapT),ae.ext_texture_filter_anisotropic&&X.texParameteri(er,af,De.anisotropic),De.genMipmaps&&(X.hint(za,De.mipmapHint),X.generateMipmap(er))}var aa=0,_o={},Fs=Ge.maxTextureUnits,xo=Array(Fs).map(function(){return null});function ji(De){xr.call(this),this.mipmask=0,this.internalformat=xu,this.id=aa++,this.refCount=1,this.target=De,this.texture=X.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Pa,Jt.profile&&(this.stats={size:0})}function is(De){X.activeTexture(ha),X.bindTexture(De.target,De.texture)}function Ea(){var De=xo[0];De?X.bindTexture(De.target,De.texture):X.bindTexture(Du,null)}function zo(De){var er=De.texture;he(er,"must not double destroy texture");var Ft=De.unit,Pn=De.target;Ft>=0&&(X.activeTexture(ha+Ft),X.bindTexture(Pn,null),xo[Ft]=null),X.deleteTexture(er),De.texture=null,De.params=null,De.pixels=null,De.refCount=0,delete _o[De.id],nr.textureCount--}ne(ji.prototype,{bind:function(){var er=this;er.bindCount+=1;var Ft=er.unit;if(Ft<0){for(var Pn=0;Pn<Fs;++Pn){var Vi=xo[Pn];if(Vi){if(Vi.bindCount>0)continue;Vi.unit=-1}xo[Pn]=er,Ft=Pn;break}Ft>=Fs&&he.raise("insufficient number of texture units"),Jt.profile&&nr.maxTextureUnits<Ft+1&&(nr.maxTextureUnits=Ft+1),er.unit=Ft,X.activeTexture(ha+Ft),X.bindTexture(er.target,er.texture)}return Ft},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&zo(this)}});function mi(De,er){var Ft=new ji(Du);_o[Ft.id]=Ft,nr.textureCount++;function Pn(de,Qe){var Pt=Ft.texInfo;Pa.call(Pt);var Kt=Ki();return typeof de=="number"?typeof Qe=="number"?Ci(Kt,de|0,Qe|0):Ci(Kt,de|0,de|0):de?(he.type(de,"object","invalid arguments to regl.texture"),Xo(Pt,de),Yi(Kt,de)):Ci(Kt,1,1),Pt.genMipmaps&&(Kt.mipmask=(Kt.width<<1)-1),Ft.mipmask=Kt.mipmask,ar(Ft,Kt),he.texture2D(Pt,Kt,Ge),Ft.internalformat=Kt.internalformat,Pn.width=Kt.width,Pn.height=Kt.height,is(Ft),ho(Kt,Du),Ai(Pt,Du),Ea(),ns(Kt),Jt.profile&&(Ft.stats.size=wu(Ft.internalformat,Ft.type,Kt.width,Kt.height,Pt.genMipmaps,!1)),Pn.format=Br[Ft.internalformat],Pn.type=Sn[Ft.type],Pn.mag=cr[Pt.magFilter],Pn.min=Dn[Pt.minFilter],Pn.wrapS=Rn[Pt.wrapS],Pn.wrapT=Rn[Pt.wrapT],Pn}function Vi(de,Qe,Pt,Kt){he(!!de,"must specify image data");var ot=Qe|0,tt=Pt|0,ct=Kt|0,me=yn();return ar(me,Ft),me.width=0,me.height=0,vn(me,de),me.width=me.width||(Ft.width>>ct)-ot,me.height=me.height||(Ft.height>>ct)-tt,he(Ft.type===me.type&&Ft.format===me.format&&Ft.internalformat===me.internalformat,"incompatible format for texture.subimage"),he(ot>=0&&tt>=0&&ot+me.width<=Ft.width&&tt+me.height<=Ft.height,"texture.subimage write out of bounds"),he(Ft.mipmask&1<<ct,"missing mipmap data"),he(me.data||me.element||me.needsCopy,"missing image data"),is(Ft),Ii(me,Du,ot,tt,ct),Ea(),En(me),Pn}function we(de,Qe){var Pt=de|0,Kt=Qe|0||Pt;if(Pt===Ft.width&&Kt===Ft.height)return Pn;Pn.width=Ft.width=Pt,Pn.height=Ft.height=Kt,is(Ft);for(var ot=0;Ft.mipmask>>ot;++ot){var tt=Pt>>ot,ct=Kt>>ot;if(!tt||!ct)break;X.texImage2D(Du,ot,Ft.format,tt,ct,0,Ft.format,Ft.type,null)}return Ea(),Jt.profile&&(Ft.stats.size=wu(Ft.internalformat,Ft.type,Pt,Kt,!1,!1)),Pn}return Pn(De,er),Pn.subimage=Vi,Pn.resize=we,Pn._reglType="texture2d",Pn._texture=Ft,Jt.profile&&(Pn.stats=Ft.stats),Pn.destroy=function(){Ft.decRef()},Pn}function Fi(De,er,Ft,Pn,Vi,we){var de=new ji(Qc);_o[de.id]=de,nr.cubeCount++;var Qe=new Array(6);function Pt(tt,ct,me,Ke,Ae,At){var zt,Mr=de.texInfo;for(Pa.call(Mr),zt=0;zt<6;++zt)Qe[zt]=Ki();if(typeof tt=="number"||!tt){var on=tt|0||1;for(zt=0;zt<6;++zt)Ci(Qe[zt],on,on)}else if(typeof tt=="object")if(ct)Yi(Qe[0],tt),Yi(Qe[1],ct),Yi(Qe[2],me),Yi(Qe[3],Ke),Yi(Qe[4],Ae),Yi(Qe[5],At);else if(Xo(Mr,tt),an(de,tt),"faces"in tt){var sn=tt.faces;for(he(Array.isArray(sn)&&sn.length===6,"cube faces must be a length 6 array"),zt=0;zt<6;++zt)he(typeof sn[zt]=="object"&&!!sn[zt],"invalid input for cube map face"),ar(Qe[zt],de),Yi(Qe[zt],sn[zt])}else for(zt=0;zt<6;++zt)Yi(Qe[zt],tt);else he.raise("invalid arguments to cube map");for(ar(de,Qe[0]),he.optional(function(){Ge.npotTextureCube||he(zl(de.width)&&zl(de.height),"your browser does not support non power or two texture dimensions")}),Mr.genMipmaps?de.mipmask=(Qe[0].width<<1)-1:de.mipmask=Qe[0].mipmask,he.textureCube(de,Mr,Qe,Ge),de.internalformat=Qe[0].internalformat,Pt.width=Qe[0].width,Pt.height=Qe[0].height,is(de),zt=0;zt<6;++zt)ho(Qe[zt],Fu+zt);for(Ai(Mr,Qc),Ea(),Jt.profile&&(de.stats.size=wu(de.internalformat,de.type,Pt.width,Pt.height,Mr.genMipmaps,!0)),Pt.format=Br[de.internalformat],Pt.type=Sn[de.type],Pt.mag=cr[Mr.magFilter],Pt.min=Dn[Mr.minFilter],Pt.wrapS=Rn[Mr.wrapS],Pt.wrapT=Rn[Mr.wrapT],zt=0;zt<6;++zt)ns(Qe[zt]);return Pt}function Kt(tt,ct,me,Ke,Ae){he(!!ct,"must specify image data"),he(typeof tt=="number"&&tt===(tt|0)&&tt>=0&&tt<6,"invalid face");var At=me|0,zt=Ke|0,Mr=Ae|0,on=yn();return ar(on,de),on.width=0,on.height=0,vn(on,ct),on.width=on.width||(de.width>>Mr)-At,on.height=on.height||(de.height>>Mr)-zt,he(de.type===on.type&&de.format===on.format&&de.internalformat===on.internalformat,"incompatible format for texture.subimage"),he(At>=0&&zt>=0&&At+on.width<=de.width&&zt+on.height<=de.height,"texture.subimage write out of bounds"),he(de.mipmask&1<<Mr,"missing mipmap data"),he(on.data||on.element||on.needsCopy,"missing image data"),is(de),Ii(on,Fu+tt,At,zt,Mr),Ea(),En(on),Pt}function ot(tt){var ct=tt|0;if(ct!==de.width){Pt.width=de.width=ct,Pt.height=de.height=ct,is(de);for(var me=0;me<6;++me)for(var Ke=0;de.mipmask>>Ke;++Ke)X.texImage2D(Fu+me,Ke,de.format,ct>>Ke,ct>>Ke,0,de.format,de.type,null);return Ea(),Jt.profile&&(de.stats.size=wu(de.internalformat,de.type,Pt.width,Pt.height,!1,!0)),Pt}}return Pt(De,er,Ft,Pn,Vi,we),Pt.subimage=Kt,Pt.resize=ot,Pt._reglType="textureCube",Pt._texture=de,Jt.profile&&(Pt.stats=de.stats),Pt.destroy=function(){de.decRef()},Pt}function Da(){for(var De=0;De<Fs;++De)X.activeTexture(ha+De),X.bindTexture(Du,null),xo[De]=null;We(_o).forEach(zo),nr.cubeCount=0,nr.textureCount=0}Jt.profile&&(nr.getTotalTextureSize=function(){var De=0;return Object.keys(_o).forEach(function(er){De+=_o[er].stats.size}),De});function Bs(){for(var De=0;De<Fs;++De){var er=xo[De];er&&(er.bindCount=0,er.unit=-1,xo[De]=null)}We(_o).forEach(function(Ft){Ft.texture=X.createTexture(),X.bindTexture(Ft.target,Ft.texture);for(var Pn=0;Pn<32;++Pn)if((Ft.mipmask&1<<Pn)!=0)if(Ft.target===Du)X.texImage2D(Du,Pn,Ft.internalformat,Ft.width>>Pn,Ft.height>>Pn,0,Ft.internalformat,Ft.type,null);else for(var Vi=0;Vi<6;++Vi)X.texImage2D(Fu+Vi,Pn,Ft.internalformat,Ft.width>>Pn,Ft.height>>Pn,0,Ft.internalformat,Ft.type,null);Ai(Ft.texInfo,Ft.target)})}function Ss(){for(var De=0;De<Fs;++De){var er=xo[De];er&&(er.bindCount=0,er.unit=-1,xo[De]=null),X.activeTexture(ha+De),X.bindTexture(Du,null),X.bindTexture(Qc,null)}}return{create2D:mi,createCube:Fi,clear:Da,getTexture:function(er){return null},restore:Bs,refresh:Ss}}var xs=36161,cs=32854,pf=32855,si=36194,Kn=33189,df=36168,bs=34041,du=35907,Jo=34836,Vu=34842,Vf=34843,ru=[];ru[cs]=2,ru[pf]=2,ru[si]=2,ru[Kn]=2,ru[df]=1,ru[bs]=4,ru[du]=4,ru[Jo]=16,ru[Vu]=8,ru[Vf]=6;function la(X,ae,Ge){return ru[X]*ae*Ge}var es=function(ae,Ge,Vt,hr,nr){var Jt={rgba4:cs,rgb565:si,"rgb5 a1":pf,depth:Kn,stencil:df,"depth stencil":bs};Ge.ext_srgb&&(Jt.srgba=du),Ge.ext_color_buffer_half_float&&(Jt.rgba16f=Vu,Jt.rgb16f=Vf),Ge.webgl_color_buffer_float&&(Jt.rgba32f=Jo);var wr=[];Object.keys(Jt).forEach(function(zr){var Gt=Jt[zr];wr[Gt]=zr});var jr=0,Vr={};function Xr(zr){this.id=jr++,this.refCount=1,this.renderbuffer=zr,this.format=cs,this.width=0,this.height=0,nr.profile&&(this.stats={size:0})}Xr.prototype.decRef=function(){--this.refCount<=0&&Gr(this)};function Gr(zr){var Gt=zr.renderbuffer;he(Gt,"must not double destroy renderbuffer"),ae.bindRenderbuffer(xs,null),ae.deleteRenderbuffer(Gt),zr.renderbuffer=null,zr.refCount=0,delete Vr[zr.id],hr.renderbufferCount--}function fn(zr,Gt){var Ht=new Xr(ae.createRenderbuffer());Vr[Ht.id]=Ht,hr.renderbufferCount++;function Br(cr,Dn){var Rn=0,Qr=0,xr=cs;if(typeof cr=="object"&&cr){var ar=cr;if("shape"in ar){var an=ar.shape;he(Array.isArray(an)&&an.length>=2,"invalid renderbuffer shape"),Rn=an[0]|0,Qr=an[1]|0}else"radius"in ar&&(Rn=Qr=ar.radius|0),"width"in ar&&(Rn=ar.width|0),"height"in ar&&(Qr=ar.height|0);"format"in ar&&(he.parameter(ar.format,Jt,"invalid renderbuffer format"),xr=Jt[ar.format])}else typeof cr=="number"?(Rn=cr|0,typeof Dn=="number"?Qr=Dn|0:Qr=Rn):cr?he.raise("invalid arguments to renderbuffer constructor"):Rn=Qr=1;if(he(Rn>0&&Qr>0&&Rn<=Vt.maxRenderbufferSize&&Qr<=Vt.maxRenderbufferSize,"invalid renderbuffer size"),!(Rn===Ht.width&&Qr===Ht.height&&xr===Ht.format))return Br.width=Ht.width=Rn,Br.height=Ht.height=Qr,Ht.format=xr,ae.bindRenderbuffer(xs,Ht.renderbuffer),ae.renderbufferStorage(xs,xr,Rn,Qr),he(ae.getError()===0,"invalid render buffer format"),nr.profile&&(Ht.stats.size=la(Ht.format,Ht.width,Ht.height)),Br.format=wr[Ht.format],Br}function Sn(cr,Dn){var Rn=cr|0,Qr=Dn|0||Rn;return Rn===Ht.width&&Qr===Ht.height||(he(Rn>0&&Qr>0&&Rn<=Vt.maxRenderbufferSize&&Qr<=Vt.maxRenderbufferSize,"invalid renderbuffer size"),Br.width=Ht.width=Rn,Br.height=Ht.height=Qr,ae.bindRenderbuffer(xs,Ht.renderbuffer),ae.renderbufferStorage(xs,Ht.format,Rn,Qr),he(ae.getError()===0,"invalid render buffer format"),nr.profile&&(Ht.stats.size=la(Ht.format,Ht.width,Ht.height))),Br}return Br(zr,Gt),Br.resize=Sn,Br._reglType="renderbuffer",Br._renderbuffer=Ht,nr.profile&&(Br.stats=Ht.stats),Br.destroy=function(){Ht.decRef()},Br}nr.profile&&(hr.getTotalRenderbufferSize=function(){var zr=0;return Object.keys(Vr).forEach(function(Gt){zr+=Vr[Gt].stats.size}),zr});function rn(){We(Vr).forEach(function(zr){zr.renderbuffer=ae.createRenderbuffer(),ae.bindRenderbuffer(xs,zr.renderbuffer),ae.renderbufferStorage(xs,zr.format,zr.width,zr.height)}),ae.bindRenderbuffer(xs,null)}return{create:fn,clear:function(){We(Vr).forEach(Gr)},restore:rn}},sl=36160,Pl=36161,Gu=3553,Hu=34069,nu=36064,Tc=36096,Wu=36128,vf=33306,Mc=36053,sc=36054,Dh=36055,mf=36057,Pc=36061,fh=36193,Zl=5121,_a=5126,gf=6407,Wn=6408,Au=6402,Fh=[gf,Wn],uc=[];uc[Wn]=4,uc[gf]=3;var Xl=[];Xl[Zl]=1,Xl[_a]=4,Xl[fh]=2;var yf=32854,h=32855,f=36194,c=33189,d=36168,E=34041,A=35907,I=34836,k=34842,V=34843,Y=[yf,h,f,A,k,V,I],ce={};ce[Mc]="complete",ce[sc]="incomplete attachment",ce[mf]="incomplete dimensions",ce[Dh]="incomplete, missing attachment",ce[Pc]="unsupported";function ve(X,ae,Ge,Vt,hr,nr){var Jt={cur:null,next:null,dirty:!1,setFBO:null},wr=["rgba"],jr=["rgba4","rgb565","rgb5 a1"];ae.ext_srgb&&jr.push("srgba"),ae.ext_color_buffer_half_float&&jr.push("rgba16f","rgb16f"),ae.webgl_color_buffer_float&&jr.push("rgba32f");var Vr=["uint8"];ae.oes_texture_half_float&&Vr.push("half float","float16"),ae.oes_texture_float&&Vr.push("float","float32");function Xr(Wr,vn,hn){this.target=Wr,this.texture=vn,this.renderbuffer=hn;var Ii=0,Si=0;vn?(Ii=vn.width,Si=vn.height):hn&&(Ii=hn.width,Si=hn.height),this.width=Ii,this.height=Si}function Gr(Wr){Wr&&(Wr.texture&&Wr.texture._texture.decRef(),Wr.renderbuffer&&Wr.renderbuffer._renderbuffer.decRef())}function fn(Wr,vn,hn){if(!!Wr)if(Wr.texture){var Ii=Wr.texture._texture,Si=Math.max(1,Ii.width),yn=Math.max(1,Ii.height);he(Si===vn&&yn===hn,"inconsistent width/height for supplied texture"),Ii.refCount+=1}else{var En=Wr.renderbuffer._renderbuffer;he(En.width===vn&&En.height===hn,"inconsistent width/height for renderbuffer"),En.refCount+=1}}function rn(Wr,vn){vn&&(vn.texture?X.framebufferTexture2D(sl,Wr,vn.target,vn.texture._texture.texture,0):X.framebufferRenderbuffer(sl,Wr,Pl,vn.renderbuffer._renderbuffer.renderbuffer))}function zr(Wr){var vn=Gu,hn=null,Ii=null,Si=Wr;typeof Wr=="object"&&(Si=Wr.data,"target"in Wr&&(vn=Wr.target|0)),he.type(Si,"function","invalid attachment data");var yn=Si._reglType;return yn==="texture2d"?(hn=Si,he(vn===Gu)):yn==="textureCube"?(hn=Si,he(vn>=Hu&&vn<Hu+6,"invalid cube map target")):yn==="renderbuffer"?(Ii=Si,vn=Pl):he.raise("invalid regl object for attachment"),new Xr(vn,hn,Ii)}function Gt(Wr,vn,hn,Ii,Si){if(hn){var yn=Vt.create2D({width:Wr,height:vn,format:Ii,type:Si});return yn._texture.refCount=0,new Xr(Gu,yn,null)}else{var En=hr.create({width:Wr,height:vn,format:Ii});return En._renderbuffer.refCount=0,new Xr(Pl,null,En)}}function Ht(Wr){return Wr&&(Wr.texture||Wr.renderbuffer)}function Br(Wr,vn,hn){Wr&&(Wr.texture?Wr.texture.resize(vn,hn):Wr.renderbuffer&&Wr.renderbuffer.resize(vn,hn),Wr.width=vn,Wr.height=hn)}var Sn=0,cr={};function Dn(){this.id=Sn++,cr[this.id]=this,this.framebuffer=X.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Rn(Wr){Wr.colorAttachments.forEach(Gr),Gr(Wr.depthAttachment),Gr(Wr.stencilAttachment),Gr(Wr.depthStencilAttachment)}function Qr(Wr){var vn=Wr.framebuffer;he(vn,"must not double destroy framebuffer"),X.deleteFramebuffer(vn),Wr.framebuffer=null,nr.framebufferCount--,delete cr[Wr.id]}function xr(Wr){var vn;X.bindFramebuffer(sl,Wr.framebuffer);var hn=Wr.colorAttachments;for(vn=0;vn<hn.length;++vn)rn(nu+vn,hn[vn]);for(vn=hn.length;vn<Ge.maxColorAttachments;++vn)X.framebufferTexture2D(sl,nu+vn,Gu,null,0);X.framebufferTexture2D(sl,vf,Gu,null,0),X.framebufferTexture2D(sl,Tc,Gu,null,0),X.framebufferTexture2D(sl,Wu,Gu,null,0),rn(Tc,Wr.depthAttachment),rn(Wu,Wr.stencilAttachment),rn(vf,Wr.depthStencilAttachment);var Ii=X.checkFramebufferStatus(sl);!X.isContextLost()&&Ii!==Mc&&he.raise("framebuffer configuration not supported, status = "+ce[Ii]),X.bindFramebuffer(sl,Jt.next?Jt.next.framebuffer:null),Jt.cur=Jt.next,X.getError()}function ar(Wr,vn){var hn=new Dn;nr.framebufferCount++;function Ii(yn,En){var hi;he(Jt.next!==hn,"can not update framebuffer which is currently in use");var Ci=0,Yi=0,ho=!0,Ao=!0,Ki=null,ns=!0,Pa="rgba",Xo="uint8",Ai=1,aa=null,_o=null,Fs=null,xo=!1;if(typeof yn=="number")Ci=yn|0,Yi=En|0||Ci;else if(!yn)Ci=Yi=1;else{he.type(yn,"object","invalid arguments for framebuffer");var ji=yn;if("shape"in ji){var is=ji.shape;he(Array.isArray(is)&&is.length>=2,"invalid shape for framebuffer"),Ci=is[0],Yi=is[1]}else"radius"in ji&&(Ci=Yi=ji.radius),"width"in ji&&(Ci=ji.width),"height"in ji&&(Yi=ji.height);("color"in ji||"colors"in ji)&&(Ki=ji.color||ji.colors,Array.isArray(Ki)&&he(Ki.length===1||ae.webgl_draw_buffers,"multiple render targets not supported")),Ki||("colorCount"in ji&&(Ai=ji.colorCount|0,he(Ai>0,"invalid color buffer count")),"colorTexture"in ji&&(ns=!!ji.colorTexture,Pa="rgba4"),"colorType"in ji&&(Xo=ji.colorType,ns?(he(ae.oes_texture_float||!(Xo==="float"||Xo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),he(ae.oes_texture_half_float||!(Xo==="half float"||Xo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Xo==="half float"||Xo==="float16"?(he(ae.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Pa="rgba16f"):(Xo==="float"||Xo==="float32")&&(he(ae.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Pa="rgba32f"),he.oneOf(Xo,Vr,"invalid color type")),"colorFormat"in ji&&(Pa=ji.colorFormat,wr.indexOf(Pa)>=0?ns=!0:jr.indexOf(Pa)>=0?ns=!1:he.optional(function(){ns?he.oneOf(ji.colorFormat,wr,"invalid color format for texture"):he.oneOf(ji.colorFormat,jr,"invalid color format for renderbuffer")}))),("depthTexture"in ji||"depthStencilTexture"in ji)&&(xo=!!(ji.depthTexture||ji.depthStencilTexture),he(!xo||ae.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in ji&&(typeof ji.depth=="boolean"?ho=ji.depth:(aa=ji.depth,Ao=!1)),"stencil"in ji&&(typeof ji.stencil=="boolean"?Ao=ji.stencil:(_o=ji.stencil,ho=!1)),"depthStencil"in ji&&(typeof ji.depthStencil=="boolean"?ho=Ao=ji.depthStencil:(Fs=ji.depthStencil,ho=!1,Ao=!1))}var Ea=null,zo=null,mi=null,Fi=null;if(Array.isArray(Ki))Ea=Ki.map(zr);else if(Ki)Ea=[zr(Ki)];else for(Ea=new Array(Ai),hi=0;hi<Ai;++hi)Ea[hi]=Gt(Ci,Yi,ns,Pa,Xo);he(ae.webgl_draw_buffers||Ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),he(Ea.length<=Ge.maxColorAttachments,"too many color attachments, not supported"),Ci=Ci||Ea[0].width,Yi=Yi||Ea[0].height,aa?zo=zr(aa):ho&&!Ao&&(zo=Gt(Ci,Yi,xo,"depth","uint32")),_o?mi=zr(_o):Ao&&!ho&&(mi=Gt(Ci,Yi,!1,"stencil","uint8")),Fs?Fi=zr(Fs):!aa&&!_o&&Ao&&ho&&(Fi=Gt(Ci,Yi,xo,"depth stencil","depth stencil")),he(!!aa+!!_o+!!Fs<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Da=null;for(hi=0;hi<Ea.length;++hi)if(fn(Ea[hi],Ci,Yi),he(!Ea[hi]||Ea[hi].texture&&Fh.indexOf(Ea[hi].texture._texture.format)>=0||Ea[hi].renderbuffer&&Y.indexOf(Ea[hi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+hi+" is invalid"),Ea[hi]&&Ea[hi].texture){var Bs=uc[Ea[hi].texture._texture.format]*Xl[Ea[hi].texture._texture.type];Da===null?Da=Bs:he(Da===Bs,"all color attachments much have the same number of bits per pixel.")}return fn(zo,Ci,Yi),he(!zo||zo.texture&&zo.texture._texture.format===Au||zo.renderbuffer&&zo.renderbuffer._renderbuffer.format===c,"invalid depth attachment for framebuffer object"),fn(mi,Ci,Yi),he(!mi||mi.renderbuffer&&mi.renderbuffer._renderbuffer.format===d,"invalid stencil attachment for framebuffer object"),fn(Fi,Ci,Yi),he(!Fi||Fi.texture&&Fi.texture._texture.format===E||Fi.renderbuffer&&Fi.renderbuffer._renderbuffer.format===E,"invalid depth-stencil attachment for framebuffer object"),Rn(hn),hn.width=Ci,hn.height=Yi,hn.colorAttachments=Ea,hn.depthAttachment=zo,hn.stencilAttachment=mi,hn.depthStencilAttachment=Fi,Ii.color=Ea.map(Ht),Ii.depth=Ht(zo),Ii.stencil=Ht(mi),Ii.depthStencil=Ht(Fi),Ii.width=hn.width,Ii.height=hn.height,xr(hn),Ii}function Si(yn,En){he(Jt.next!==hn,"can not resize a framebuffer which is currently in use");var hi=Math.max(yn|0,1),Ci=Math.max(En|0||hi,1);if(hi===hn.width&&Ci===hn.height)return Ii;for(var Yi=hn.colorAttachments,ho=0;ho<Yi.length;++ho)Br(Yi[ho],hi,Ci);return Br(hn.depthAttachment,hi,Ci),Br(hn.stencilAttachment,hi,Ci),Br(hn.depthStencilAttachment,hi,Ci),hn.width=Ii.width=hi,hn.height=Ii.height=Ci,xr(hn),Ii}return Ii(Wr,vn),ne(Ii,{resize:Si,_reglType:"framebuffer",_framebuffer:hn,destroy:function(){Qr(hn),Rn(hn)},use:function(En){Jt.setFBO({framebuffer:Ii},En)}})}function an(Wr){var vn=Array(6);function hn(Si){var yn;he(vn.indexOf(Jt.next)<0,"can not update framebuffer which is currently in use");var En={color:null},hi=0,Ci=null,Yi="rgba",ho="uint8",Ao=1;if(typeof Si=="number")hi=Si|0;else if(!Si)hi=1;else{he.type(Si,"object","invalid arguments for framebuffer");var Ki=Si;if("shape"in Ki){var ns=Ki.shape;he(Array.isArray(ns)&&ns.length>=2,"invalid shape for framebuffer"),he(ns[0]===ns[1],"cube framebuffer must be square"),hi=ns[0]}else"radius"in Ki&&(hi=Ki.radius|0),"width"in Ki?(hi=Ki.width|0,"height"in Ki&&he(Ki.height===hi,"must be square")):"height"in Ki&&(hi=Ki.height|0);("color"in Ki||"colors"in Ki)&&(Ci=Ki.color||Ki.colors,Array.isArray(Ci)&&he(Ci.length===1||ae.webgl_draw_buffers,"multiple render targets not supported")),Ci||("colorCount"in Ki&&(Ao=Ki.colorCount|0,he(Ao>0,"invalid color buffer count")),"colorType"in Ki&&(he.oneOf(Ki.colorType,Vr,"invalid color type"),ho=Ki.colorType),"colorFormat"in Ki&&(Yi=Ki.colorFormat,he.oneOf(Ki.colorFormat,wr,"invalid color format for texture"))),"depth"in Ki&&(En.depth=Ki.depth),"stencil"in Ki&&(En.stencil=Ki.stencil),"depthStencil"in Ki&&(En.depthStencil=Ki.depthStencil)}var Pa;if(Ci)if(Array.isArray(Ci))for(Pa=[],yn=0;yn<Ci.length;++yn)Pa[yn]=Ci[yn];else Pa=[Ci];else{Pa=Array(Ao);var Xo={radius:hi,format:Yi,type:ho};for(yn=0;yn<Ao;++yn)Pa[yn]=Vt.createCube(Xo)}for(En.color=Array(Pa.length),yn=0;yn<Pa.length;++yn){var Ai=Pa[yn];he(typeof Ai=="function"&&Ai._reglType==="textureCube","invalid cube map"),hi=hi||Ai.width,he(Ai.width===hi&&Ai.height===hi,"invalid cube map shape"),En.color[yn]={target:Hu,data:Pa[yn]}}for(yn=0;yn<6;++yn){for(var aa=0;aa<Pa.length;++aa)En.color[aa].target=Hu+yn;yn>0&&(En.depth=vn[0].depth,En.stencil=vn[0].stencil,En.depthStencil=vn[0].depthStencil),vn[yn]?vn[yn](En):vn[yn]=ar(En)}return ne(hn,{width:hi,height:hi,color:Pa})}function Ii(Si){var yn,En=Si|0;if(he(En>0&&En<=Ge.maxCubeMapSize,"invalid radius for cube fbo"),En===hn.width)return hn;var hi=hn.color;for(yn=0;yn<hi.length;++yn)hi[yn].resize(En);for(yn=0;yn<6;++yn)vn[yn].resize(En);return hn.width=hn.height=En,hn}return hn(Wr),ne(hn,{faces:vn,resize:Ii,_reglType:"framebufferCube",destroy:function(){vn.forEach(function(yn){yn.destroy()})}})}function ln(){Jt.cur=null,Jt.next=null,Jt.dirty=!0,We(cr).forEach(function(Wr){Wr.framebuffer=X.createFramebuffer(),xr(Wr)})}return ne(Jt,{getFramebuffer:function(vn){if(typeof vn=="function"&&vn._reglType==="framebuffer"){var hn=vn._framebuffer;if(hn instanceof Dn)return hn}return null},create:ar,createCube:an,clear:function(){We(cr).forEach(Qr)},restore:ln})}var ye=5126,ze=34962,Fe=34963,$e=["attributes","elements","offset","count","primitive","instances"];function Ne(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ye,this.offset=0,this.stride=0,this.divisor=0}function Ze(X,ae,Ge,Vt,hr,nr,Jt){for(var wr=Ge.maxAttributes,jr=new Array(wr),Vr=0;Vr<wr;++Vr)jr[Vr]=new Ne;var Xr=0,Gr={},fn={Record:Ne,scope:{},state:jr,currentVAO:null,targetVAO:null,restore:zr()?Rn:function(){},createVAO:Qr,getVAO:Ht,destroyBuffer:rn,setVAO:zr()?Br:Sn,clear:zr()?cr:function(){}};function rn(xr){for(var ar=0;ar<jr.length;++ar){var an=jr[ar];an.buffer===xr&&(X.disableVertexAttribArray(ar),an.buffer=null)}}function zr(){return ae.oes_vertex_array_object}function Gt(){return ae.angle_instanced_arrays}function Ht(xr){return typeof xr=="function"&&xr._vao?xr._vao:null}function Br(xr){if(xr!==fn.currentVAO){var ar=zr();xr?ar.bindVertexArrayOES(xr.vao):ar.bindVertexArrayOES(null),fn.currentVAO=xr}}function Sn(xr){if(xr!==fn.currentVAO){if(xr)xr.bindAttrs();else{for(var ar=Gt(),an=0;an<jr.length;++an){var ln=jr[an];ln.buffer?(X.enableVertexAttribArray(an),ln.buffer.bind(),X.vertexAttribPointer(an,ln.size,ln.type,ln.normalized,ln.stride,ln.offfset),ar&&ln.divisor&&ar.vertexAttribDivisorANGLE(an,ln.divisor)):(X.disableVertexAttribArray(an),X.vertexAttrib4f(an,ln.x,ln.y,ln.z,ln.w))}Jt.elements?X.bindBuffer(Fe,Jt.elements.buffer.buffer):X.bindBuffer(Fe,null)}fn.currentVAO=xr}}function cr(){We(Gr).forEach(function(xr){xr.destroy()})}function Dn(){this.id=++Xr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var xr=zr();xr?this.vao=xr.createVertexArrayOES():this.vao=null,Gr[this.id]=this,this.buffers=[]}Dn.prototype.bindAttrs=function(){for(var xr=Gt(),ar=this.attributes,an=0;an<ar.length;++an){var ln=ar[an];ln.buffer?(X.enableVertexAttribArray(an),X.bindBuffer(ze,ln.buffer.buffer),X.vertexAttribPointer(an,ln.size,ln.type,ln.normalized,ln.stride,ln.offset),xr&&ln.divisor&&xr.vertexAttribDivisorANGLE(an,ln.divisor)):(X.disableVertexAttribArray(an),X.vertexAttrib4f(an,ln.x,ln.y,ln.z,ln.w))}for(var Wr=ar.length;Wr<wr;++Wr)X.disableVertexAttribArray(Wr);var vn=nr.getElements(this.elements);vn?X.bindBuffer(Fe,vn.buffer.buffer):X.bindBuffer(Fe,null)},Dn.prototype.refresh=function(){var xr=zr();xr&&(xr.bindVertexArrayOES(this.vao),this.bindAttrs(),fn.currentVAO=null,xr.bindVertexArrayOES(null))},Dn.prototype.destroy=function(){if(this.vao){var xr=zr();this===fn.currentVAO&&(fn.currentVAO=null,xr.bindVertexArrayOES(null)),xr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Gr[this.id]&&(delete Gr[this.id],Vt.vaoCount-=1)};function Rn(){var xr=zr();xr&&We(Gr).forEach(function(ar){ar.refresh()})}function Qr(xr){var ar=new Dn;Vt.vaoCount+=1;function an(ln){var Wr;if(Array.isArray(ln))Wr=ln,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(he(typeof ln=="object","invalid arguments for create vao"),he("attributes"in ln,"must specify attributes for vao"),ln.elements){var vn=ln.elements;ar.ownsElements?typeof vn=="function"&&vn._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements(vn),ar.ownsElements=!1):nr.getElements(ln.elements)?(ar.elements=ln.elements,ar.ownsElements=!1):(ar.elements=nr.create(ln.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;Wr=ln.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in ln&&(ar.offset=ln.offset|0),"count"in ln&&(ar.count=ln.count|0),"instances"in ln&&(ar.instances=ln.instances|0),"primitive"in ln&&(he(ln.primitive in Sr,"bad primitive type: "+ln.primitive),ar.primitive=Sr[ln.primitive]),he.optional(function(){for(var ho=Object.keys(ln),Ao=0;Ao<ho.length;++Ao)he($e.indexOf(ho[Ao])>=0,'invalid option for vao: "'+ho[Ao]+'" valid options are '+$e)}),he(Array.isArray(Wr),"attributes must be an array")}he(Wr.length<wr,"too many attributes"),he(Wr.length>0,"must specify at least one attribute");var hn={},Ii=ar.attributes;Ii.length=Wr.length;for(var Si=0;Si<Wr.length;++Si){var yn=Wr[Si],En=Ii[Si]=new Ne,hi=yn.data||yn;if(Array.isArray(hi)||re(hi)||go(hi)){var Ci;ar.buffers[Si]&&(Ci=ar.buffers[Si],re(hi)&&Ci._buffer.byteLength>=hi.byteLength?Ci.subdata(hi):(Ci.destroy(),ar.buffers[Si]=null)),ar.buffers[Si]||(Ci=ar.buffers[Si]=hr.create(yn,ze,!1,!0)),En.buffer=hr.getBuffer(Ci),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1,hn[Si]=1}else hr.getBuffer(yn)?(En.buffer=hr.getBuffer(yn),En.size=En.buffer.dimension|0,En.normalized=!1,En.type=En.buffer.dtype,En.offset=0,En.stride=0,En.divisor=0,En.state=1):hr.getBuffer(yn.buffer)?(En.buffer=hr.getBuffer(yn.buffer),En.size=(+yn.size||En.buffer.dimension)|0,En.normalized=!!yn.normalized||!1,"type"in yn?(he.parameter(yn.type,Vs,"invalid buffer type"),En.type=Vs[yn.type]):En.type=En.buffer.dtype,En.offset=(yn.offset||0)|0,En.stride=(yn.stride||0)|0,En.divisor=(yn.divisor||0)|0,En.state=1,he(En.size>=1&&En.size<=4,"size must be between 1 and 4"),he(En.offset>=0,"invalid offset"),he(En.stride>=0&&En.stride<=255,"stride must be between 0 and 255"),he(En.divisor>=0,"divisor must be positive"),he(!En.divisor||!!ae.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in yn?(he(Si>0,"first attribute must not be a constant"),En.x=+yn.x||0,En.y=+yn.y||0,En.z=+yn.z||0,En.w=+yn.w||0,En.state=2):he(!1,"invalid attribute spec for location "+Si)}for(var Yi=0;Yi<ar.buffers.length;++Yi)!hn[Yi]&&ar.buffers[Yi]&&(ar.buffers[Yi].destroy(),ar.buffers[Yi]=null);return ar.refresh(),an}return an.destroy=function(){for(var ln=0;ln<ar.buffers.length;++ln)ar.buffers[ln]&&ar.buffers[ln].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},an._vao=ar,an._reglType="vao",an(xr)}return fn}var St=35632,mt=35633,lr=35718,Qt=35721;function fr(X,ae,Ge,Vt){var hr={},nr={};function Jt(Gt,Ht,Br,Sn){this.name=Gt,this.id=Ht,this.location=Br,this.info=Sn}function wr(Gt,Ht){for(var Br=0;Br<Gt.length;++Br)if(Gt[Br].id===Ht.id){Gt[Br].location=Ht.location;return}Gt.push(Ht)}function jr(Gt,Ht,Br){var Sn=Gt===St?hr:nr,cr=Sn[Ht];if(!cr){var Dn=ae.str(Ht);cr=X.createShader(Gt),X.shaderSource(cr,Dn),X.compileShader(cr),he.shaderError(X,cr,Dn,Gt,Br),Sn[Ht]=cr}return cr}var Vr={},Xr=[],Gr=0;function fn(Gt,Ht){this.id=Gr++,this.fragId=Gt,this.vertId=Ht,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Vt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function rn(Gt,Ht,Br){var Sn,cr,Dn=jr(St,Gt.fragId),Rn=jr(mt,Gt.vertId),Qr=Gt.program=X.createProgram();if(X.attachShader(Qr,Dn),X.attachShader(Qr,Rn),Br)for(Sn=0;Sn<Br.length;++Sn){var xr=Br[Sn];X.bindAttribLocation(Qr,xr[0],xr[1])}X.linkProgram(Qr),he.linkError(X,Qr,ae.str(Gt.fragId),ae.str(Gt.vertId),Ht);var ar=X.getProgramParameter(Qr,lr);Vt.profile&&(Gt.stats.uniformsCount=ar);var an=Gt.uniforms;for(Sn=0;Sn<ar;++Sn)if(cr=X.getActiveUniform(Qr,Sn),cr)if(cr.size>1)for(var ln=0;ln<cr.size;++ln){var Wr=cr.name.replace("[0]","["+ln+"]");wr(an,new Jt(Wr,ae.id(Wr),X.getUniformLocation(Qr,Wr),cr))}else wr(an,new Jt(cr.name,ae.id(cr.name),X.getUniformLocation(Qr,cr.name),cr));var vn=X.getProgramParameter(Qr,Qt);Vt.profile&&(Gt.stats.attributesCount=vn);var hn=Gt.attributes;for(Sn=0;Sn<vn;++Sn)cr=X.getActiveAttrib(Qr,Sn),cr&&wr(hn,new Jt(cr.name,ae.id(cr.name),X.getAttribLocation(Qr,cr.name),cr))}Vt.profile&&(Ge.getMaxUniformsCount=function(){var Gt=0;return Xr.forEach(function(Ht){Ht.stats.uniformsCount>Gt&&(Gt=Ht.stats.uniformsCount)}),Gt},Ge.getMaxAttributesCount=function(){var Gt=0;return Xr.forEach(function(Ht){Ht.stats.attributesCount>Gt&&(Gt=Ht.stats.attributesCount)}),Gt});function zr(){hr={},nr={};for(var Gt=0;Gt<Xr.length;++Gt)rn(Xr[Gt],null,Xr[Gt].attributes.map(function(Ht){return[Ht.location,Ht.name]}))}return{clear:function(){var Ht=X.deleteShader.bind(X);We(hr).forEach(Ht),hr={},We(nr).forEach(Ht),nr={},Xr.forEach(function(Br){X.deleteProgram(Br.program)}),Xr.length=0,Vr={},Ge.shaderCount=0},program:function(Ht,Br,Sn,cr){he.command(Ht>=0,"missing vertex shader",Sn),he.command(Br>=0,"missing fragment shader",Sn);var Dn=Vr[Br];Dn||(Dn=Vr[Br]={});var Rn=Dn[Ht];if(Rn&&(Rn.refCount++,!cr))return Rn;var Qr=new fn(Br,Ht);return Ge.shaderCount++,rn(Qr,Sn,cr),Rn||(Dn[Ht]=Qr),Xr.push(Qr),ne(Qr,{destroy:function(){if(Qr.refCount--,Qr.refCount<=0){X.deleteProgram(Qr.program);var ar=Xr.indexOf(Qr);Xr.splice(ar,1),Ge.shaderCount--}Dn[Qr.vertId].refCount<=0&&(X.deleteShader(nr[Qr.vertId]),delete nr[Qr.vertId],delete Vr[Qr.fragId][Qr.vertId]),Object.keys(Vr[Qr.fragId]).length||(X.deleteShader(hr[Qr.fragId]),delete hr[Qr.fragId],delete Vr[Qr.fragId])}})},restore:zr,shader:jr,frag:-1,vert:-1}}var _r=6408,Yr=5121,$r=3333,cn=5126;function Zn(X,ae,Ge,Vt,hr,nr,Jt){function wr(Xr){var Gr;ae.next===null?(he(hr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Gr=Yr):(he(ae.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Gr=ae.next.colorAttachments[0].texture._texture.type,he.optional(function(){nr.oes_texture_float?(he(Gr===Yr||Gr===cn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Gr===cn&&he(Jt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):he(Gr===Yr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var fn=0,rn=0,zr=Vt.framebufferWidth,Gt=Vt.framebufferHeight,Ht=null;re(Xr)?Ht=Xr:Xr&&(he.type(Xr,"object","invalid arguments to regl.read()"),fn=Xr.x|0,rn=Xr.y|0,he(fn>=0&&fn<Vt.framebufferWidth,"invalid x offset for regl.read"),he(rn>=0&&rn<Vt.framebufferHeight,"invalid y offset for regl.read"),zr=(Xr.width||Vt.framebufferWidth-fn)|0,Gt=(Xr.height||Vt.framebufferHeight-rn)|0,Ht=Xr.data||null),Ht&&(Gr===Yr?he(Ht instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Gr===cn&&he(Ht instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),he(zr>0&&zr+fn<=Vt.framebufferWidth,"invalid width for read pixels"),he(Gt>0&&Gt+rn<=Vt.framebufferHeight,"invalid height for read pixels"),Ge();var Br=zr*Gt*4;return Ht||(Gr===Yr?Ht=new Uint8Array(Br):Gr===cn&&(Ht=Ht||new Float32Array(Br))),he.isTypedArray(Ht,"data buffer for regl.read() must be a typedarray"),he(Ht.byteLength>=Br,"data buffer for regl.read() too small"),X.pixelStorei($r,4),X.readPixels(fn,rn,zr,Gt,_r,Gr,Ht),Ht}function jr(Xr){var Gr;return ae.setFBO({framebuffer:Xr.framebuffer},function(){Gr=wr(Xr)}),Gr}function Vr(Xr){return!Xr||!("framebuffer"in Xr)?wr(Xr):jr(Xr)}return Vr}function ai(X){return Array.prototype.slice.call(X)}function pi(X){return ai(X).join("")}function Ui(){var X=0,ae=[],Ge=[];function Vt(Gr){for(var fn=0;fn<Ge.length;++fn)if(Ge[fn]===Gr)return ae[fn];var rn="g"+X++;return ae.push(rn),Ge.push(Gr),rn}function hr(){var Gr=[];function fn(){Gr.push.apply(Gr,ai(arguments))}var rn=[];function zr(){var Gt="v"+X++;return rn.push(Gt),arguments.length>0&&(Gr.push(Gt,"="),Gr.push.apply(Gr,ai(arguments)),Gr.push(";")),Gt}return ne(fn,{def:zr,toString:function(){return pi([rn.length>0?"var "+rn.join(",")+";":"",pi(Gr)])}})}function nr(){var Gr=hr(),fn=hr(),rn=Gr.toString,zr=fn.toString;function Gt(Ht,Br){fn(Ht,Br,"=",Gr.def(Ht,Br),";")}return ne(function(){Gr.apply(Gr,ai(arguments))},{def:Gr.def,entry:Gr,exit:fn,save:Gt,set:function(Br,Sn,cr){Gt(Br,Sn),Gr(Br,Sn,"=",cr,";")},toString:function(){return rn()+zr()}})}function Jt(){var Gr=pi(arguments),fn=nr(),rn=nr(),zr=fn.toString,Gt=rn.toString;return ne(fn,{then:function(){return fn.apply(fn,ai(arguments)),this},else:function(){return rn.apply(rn,ai(arguments)),this},toString:function(){var Br=Gt();return Br&&(Br="else{"+Br+"}"),pi(["if(",Gr,"){",zr(),"}",Br])}})}var wr=hr(),jr={};function Vr(Gr,fn){var rn=[];function zr(){var cr="a"+rn.length;return rn.push(cr),cr}fn=fn||0;for(var Gt=0;Gt<fn;++Gt)zr();var Ht=nr(),Br=Ht.toString,Sn=jr[Gr]=ne(Ht,{arg:zr,toString:function(){return pi(["function(",rn.join(),"){",Br(),"}"])}});return Sn}function Xr(){var Gr=['"use strict";',wr,"return {"];Object.keys(jr).forEach(function(Gt){Gr.push('"',Gt,'":',jr[Gt].toString(),",")}),Gr.push("}");var fn=pi(Gr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),rn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,zr=rn?W.Function.apply(null,ae.concat(fn)):Function.apply(null,ae.concat(fn));return zr.apply(null,Ge)}return{global:wr,link:Vt,block:hr,proc:Vr,scope:nr,cond:Jt,compile:Xr}}var zi="xyzw".split(""),Bn=5121,Ei=1,Oi=2,ei=0,vi=1,fi=2,Di=3,Ji=4,yo=5,co=6,Bo="dither",$a="blend.enable",fo="blend.color",Rs="blend.equation",fs="blend.func",Ol="depth.enable",Il="depth.func",Es="depth.range",ts="depth.mask",lc="colorMask",cc="cull.enable",Zu="cull.face",Tu="frontFace",Mu="lineWidth",iu="polygonOffset.enable",Xu="polygonOffset.offset",Gs="sample.alpha",La="sample.enable",Yu="sample.coverage",_f="stencil.enable",Rl="stencil.mask",Wo="stencil.func",ks="stencil.opFront",Zo="stencil.opBack",Hs="scissor.enable",hs="scissor.box",Ls="viewport",xf="profile",kl="framebuffer",vu="vert",$u="frag",Ku="elements",Pu="primitive",ps="count",Ua="offset",hh="instances",bf="vao",ph="Width",Bh="Height",Ef=kl+ph,Gf=kl+Bh,ul=Ls+ph,bp=Ls+Bh,dh="drawingBuffer",Ka=dh+ph,Ou=dh+Bh,fc=[fs,Rs,Wo,ks,Zo,Yu,Ls,hs,Xu],Oc=34962,Hf=34963,Nh=35632,xd=35633,rs=3553,bd=34067,Ed=2884,vh=3042,Sd=3024,Sf=2960,Cd=2929,No=3089,zh=32823,Ep=32926,Uh=32928,Wf=5126,Ic=35664,mh=35665,gh=35666,Ws=5124,Zf=35667,ll=35668,jh=35669,Yl=35670,Ds=35671,Zs=35672,Vh=35673,Cf=35674,Rc=35675,au=35676,Xf=35678,Yf=35680,Sp=4,yh=1028,kc=1029,Lc=2304,Cp=2305,bv=32775,wd=32776,wp=519,Ll=7680,Ad=0,wf=1,Td=32774,Ap=513,$f=36160,cl=36064,$l={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Tp=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Dc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},fl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Mp={frag:Nh,vert:xd},Pp={cw:Lc,ccw:Cp};function Gh(X){return Array.isArray(X)||re(X)||go(X)}function Md(X){return X.sort(function(ae,Ge){return ae===Ls?-1:Ge===Ls?1:ae<Ge?-1:1})}function ds(X,ae,Ge,Vt){this.thisDep=X,this.contextDep=ae,this.propDep=Ge,this.append=Vt}function Iu(X){return X&&!(X.thisDep||X.contextDep||X.propDep)}function ba(X){return new ds(!1,!1,!1,X)}function Ru(X,ae){var Ge=X.type;if(Ge===ei){var Vt=X.data.length;return new ds(!0,Vt>=1,Vt>=2,ae)}else if(Ge===Ji){var hr=X.data;return new ds(hr.thisDep,hr.contextDep,hr.propDep,ae)}else{if(Ge===yo)return new ds(!1,!1,!1,ae);if(Ge===co){for(var nr=!1,Jt=!1,wr=!1,jr=0;jr<X.data.length;++jr){var Vr=X.data[jr];if(Vr.type===vi)wr=!0;else if(Vr.type===fi)Jt=!0;else if(Vr.type===Di)nr=!0;else if(Vr.type===ei){nr=!0;var Xr=Vr.data;Xr>=1&&(Jt=!0),Xr>=2&&(wr=!0)}else Vr.type===Ji&&(nr=nr||Vr.data.thisDep,Jt=Jt||Vr.data.contextDep,wr=wr||Vr.data.propDep)}return new ds(nr,Jt,wr,ae)}else return new ds(Ge===Di,Ge===fi,Ge===vi,ae)}}var Op=new ds(!1,!1,!1,function(){});function Pd(X,ae,Ge,Vt,hr,nr,Jt,wr,jr,Vr,Xr,Gr,fn,rn,zr){var Gt=Vr.Record,Ht={add:32774,subtract:32778,"reverse subtract":32779};Ge.ext_blend_minmax&&(Ht.min=bv,Ht.max=wd);var Br=Ge.angle_instanced_arrays,Sn=Ge.webgl_draw_buffers,cr=Ge.oes_vertex_array_object,Dn={dirty:!0,profile:zr.profile},Rn={},Qr=[],xr={},ar={};function an(we){return we.replace(".","_")}function ln(we,de,Qe){var Pt=an(we);Qr.push(we),Rn[Pt]=Dn[Pt]=!!Qe,xr[Pt]=de}function Wr(we,de,Qe){var Pt=an(we);Qr.push(we),Array.isArray(Qe)?(Dn[Pt]=Qe.slice(),Rn[Pt]=Qe.slice()):Dn[Pt]=Rn[Pt]=Qe,ar[Pt]=de}ln(Bo,Sd),ln($a,vh),Wr(fo,"blendColor",[0,0,0,0]),Wr(Rs,"blendEquationSeparate",[Td,Td]),Wr(fs,"blendFuncSeparate",[wf,Ad,wf,Ad]),ln(Ol,Cd,!0),Wr(Il,"depthFunc",Ap),Wr(Es,"depthRange",[0,1]),Wr(ts,"depthMask",!0),Wr(lc,lc,[!0,!0,!0,!0]),ln(cc,Ed),Wr(Zu,"cullFace",kc),Wr(Tu,Tu,Cp),Wr(Mu,Mu,1),ln(iu,zh),Wr(Xu,"polygonOffset",[0,0]),ln(Gs,Ep),ln(La,Uh),Wr(Yu,"sampleCoverage",[1,!1]),ln(_f,Sf),Wr(Rl,"stencilMask",-1),Wr(Wo,"stencilFunc",[wp,0,-1]),Wr(ks,"stencilOpSeparate",[yh,Ll,Ll,Ll]),Wr(Zo,"stencilOpSeparate",[kc,Ll,Ll,Ll]),ln(Hs,No),Wr(hs,"scissor",[0,0,X.drawingBufferWidth,X.drawingBufferHeight]),Wr(Ls,Ls,[0,0,X.drawingBufferWidth,X.drawingBufferHeight]);var vn={gl:X,context:fn,strings:ae,next:Rn,current:Dn,draw:Gr,elements:nr,buffer:hr,shader:Xr,attributes:Vr.state,vao:Vr,uniforms:jr,framebuffer:wr,extensions:Ge,timer:rn,isBufferArgs:Gh},hn={primTypes:Sr,compareFuncs:Dc,blendFuncs:$l,blendEquations:Ht,stencilOps:fl,glTypes:Vs,orientationType:Pp};he.optional(function(){vn.isArrayLike=Ca}),Sn&&(hn.backBuffer=[kc],hn.drawBuffer=ge(Vt.maxDrawbuffers,function(we){return we===0?[0]:ge(we,function(de){return cl+de})}));var Ii=0;function Si(){var we=Ui(),de=we.link,Qe=we.global;we.id=Ii++,we.batchId="0";var Pt=de(vn),Kt=we.shared={props:"a0"};Object.keys(vn).forEach(function(Ke){Kt[Ke]=Qe.def(Pt,".",Ke)}),he.optional(function(){we.CHECK=de(he),we.commandStr=he.guessCommand(),we.command=de(we.commandStr),we.assert=function(Ke,Ae,At){Ke("if(!(",Ae,"))",this.CHECK,".commandRaise(",de(At),",",this.command,");")},hn.invalidBlendCombinations=Tp});var ot=we.next={},tt=we.current={};Object.keys(ar).forEach(function(Ke){Array.isArray(Dn[Ke])&&(ot[Ke]=Qe.def(Kt.next,".",Ke),tt[Ke]=Qe.def(Kt.current,".",Ke))});var ct=we.constants={};Object.keys(hn).forEach(function(Ke){ct[Ke]=Qe.def(JSON.stringify(hn[Ke]))}),we.invoke=function(Ke,Ae){switch(Ae.type){case ei:var At=["this",Kt.context,Kt.props,we.batchId];return Ke.def(de(Ae.data),".call(",At.slice(0,Math.max(Ae.data.length+1,4)),")");case vi:return Ke.def(Kt.props,Ae.data);case fi:return Ke.def(Kt.context,Ae.data);case Di:return Ke.def("this",Ae.data);case Ji:return Ae.data.append(we,Ke),Ae.data.ref;case yo:return Ae.data.toString();case co:return Ae.data.map(function(zt){return we.invoke(Ke,zt)})}},we.attribCache={};var me={};return we.scopeAttrib=function(Ke){var Ae=ae.id(Ke);if(Ae in me)return me[Ae];var At=Vr.scope[Ae];At||(At=Vr.scope[Ae]=new Gt);var zt=me[Ae]=de(At);return zt},we}function yn(we){var de=we.static,Qe=we.dynamic,Pt;if(xf in de){var Kt=!!de[xf];Pt=ba(function(tt,ct){return Kt}),Pt.enable=Kt}else if(xf in Qe){var ot=Qe[xf];Pt=Ru(ot,function(tt,ct){return tt.invoke(ct,ot)})}return Pt}function En(we,de){var Qe=we.static,Pt=we.dynamic;if(kl in Qe){var Kt=Qe[kl];return Kt?(Kt=wr.getFramebuffer(Kt),he.command(Kt,"invalid framebuffer object"),ba(function(tt,ct){var me=tt.link(Kt),Ke=tt.shared;ct.set(Ke.framebuffer,".next",me);var Ae=Ke.context;return ct.set(Ae,"."+Ef,me+".width"),ct.set(Ae,"."+Gf,me+".height"),me})):ba(function(tt,ct){var me=tt.shared;ct.set(me.framebuffer,".next","null");var Ke=me.context;return ct.set(Ke,"."+Ef,Ke+"."+Ka),ct.set(Ke,"."+Gf,Ke+"."+Ou),"null"})}else if(kl in Pt){var ot=Pt[kl];return Ru(ot,function(tt,ct){var me=tt.invoke(ct,ot),Ke=tt.shared,Ae=Ke.framebuffer,At=ct.def(Ae,".getFramebuffer(",me,")");he.optional(function(){tt.assert(ct,"!"+me+"||"+At,"invalid framebuffer object")}),ct.set(Ae,".next",At);var zt=Ke.context;return ct.set(zt,"."+Ef,At+"?"+At+".width:"+zt+"."+Ka),ct.set(zt,"."+Gf,At+"?"+At+".height:"+zt+"."+Ou),At})}else return null}function hi(we,de,Qe){var Pt=we.static,Kt=we.dynamic;function ot(me){if(me in Pt){var Ke=Pt[me];he.commandType(Ke,"object","invalid "+me,Qe.commandStr);var Ae=!0,At=Ke.x|0,zt=Ke.y|0,Mr,on;return"width"in Ke?(Mr=Ke.width|0,he.command(Mr>=0,"invalid "+me,Qe.commandStr)):Ae=!1,"height"in Ke?(on=Ke.height|0,he.command(on>=0,"invalid "+me,Qe.commandStr)):Ae=!1,new ds(!Ae&&de&&de.thisDep,!Ae&&de&&de.contextDep,!Ae&&de&&de.propDep,function(en,$n){var On=en.shared.context,jn=Mr;"width"in Ke||(jn=$n.def(On,".",Ef,"-",At));var Vn=on;return"height"in Ke||(Vn=$n.def(On,".",Gf,"-",zt)),[At,zt,jn,Vn]})}else if(me in Kt){var sn=Kt[me],Cn=Ru(sn,function(en,$n){var On=en.invoke($n,sn);he.optional(function(){en.assert($n,On+"&&typeof "+On+'==="object"',"invalid "+me)});var jn=en.shared.context,Vn=$n.def(On,".x|0"),Xn=$n.def(On,".y|0"),di=$n.def('"width" in ',On,"?",On,".width|0:","(",jn,".",Ef,"-",Vn,")"),pa=$n.def('"height" in ',On,"?",On,".height|0:","(",jn,".",Gf,"-",Xn,")");return he.optional(function(){en.assert($n,di+">=0&&"+pa+">=0","invalid "+me)}),[Vn,Xn,di,pa]});return de&&(Cn.thisDep=Cn.thisDep||de.thisDep,Cn.contextDep=Cn.contextDep||de.contextDep,Cn.propDep=Cn.propDep||de.propDep),Cn}else return de?new ds(de.thisDep,de.contextDep,de.propDep,function(en,$n){var On=en.shared.context;return[0,0,$n.def(On,".",Ef),$n.def(On,".",Gf)]}):null}var tt=ot(Ls);if(tt){var ct=tt;tt=new ds(tt.thisDep,tt.contextDep,tt.propDep,function(me,Ke){var Ae=ct.append(me,Ke),At=me.shared.context;return Ke.set(At,"."+ul,Ae[2]),Ke.set(At,"."+bp,Ae[3]),Ae})}return{viewport:tt,scissor_box:ot(hs)}}function Ci(we,de){var Qe=we.static,Pt=typeof Qe[$u]=="string"&&typeof Qe[vu]=="string";if(Pt){if(Object.keys(de.dynamic).length>0)return null;var Kt=de.static,ot=Object.keys(Kt);if(ot.length>0&&typeof Kt[ot[0]]=="number"){for(var tt=[],ct=0;ct<ot.length;++ct)he(typeof Kt[ot[ct]]=="number","must specify all vertex attribute locations when using vaos"),tt.push([Kt[ot[ct]]|0,ot[ct]]);return tt}}return null}function Yi(we,de,Qe){var Pt=we.static,Kt=we.dynamic;function ot(Ae){if(Ae in Pt){var At=ae.id(Pt[Ae]);he.optional(function(){Xr.shader(Mp[Ae],At,he.guessCommand())});var zt=ba(function(){return At});return zt.id=At,zt}else if(Ae in Kt){var Mr=Kt[Ae];return Ru(Mr,function(on,sn){var Cn=on.invoke(sn,Mr),en=sn.def(on.shared.strings,".id(",Cn,")");return he.optional(function(){sn(on.shared.shader,".shader(",Mp[Ae],",",en,",",on.command,");")}),en})}return null}var tt=ot($u),ct=ot(vu),me=null,Ke;return Iu(tt)&&Iu(ct)?(me=Xr.program(ct.id,tt.id,null,Qe),Ke=ba(function(Ae,At){return Ae.link(me)})):Ke=new ds(tt&&tt.thisDep||ct&&ct.thisDep,tt&&tt.contextDep||ct&&ct.contextDep,tt&&tt.propDep||ct&&ct.propDep,function(Ae,At){var zt=Ae.shared.shader,Mr;tt?Mr=tt.append(Ae,At):Mr=At.def(zt,".",$u);var on;ct?on=ct.append(Ae,At):on=At.def(zt,".",vu);var sn=zt+".program("+on+","+Mr;return he.optional(function(){sn+=","+Ae.command}),At.def(sn+")")}),{frag:tt,vert:ct,progVar:Ke,program:me}}function ho(we,de){var Qe=we.static,Pt=we.dynamic,Kt={},ot=!1;function tt(){if(bf in Qe){var $n=Qe[bf];return $n!==null&&Vr.getVAO($n)===null&&($n=Vr.createVAO($n)),ot=!0,Kt.vao=$n,ba(function(jn){var Vn=Vr.getVAO($n);return Vn?jn.link(Vn):"null"})}else if(bf in Pt){ot=!0;var On=Pt[bf];return Ru(On,function(jn,Vn){var Xn=jn.invoke(Vn,On);return Vn.def(jn.shared.vao+".getVAO("+Xn+")")})}return null}var ct=tt(),me=!1;function Ke(){if(Ku in Qe){var $n=Qe[Ku];if(Kt.elements=$n,Gh($n)){var On=Kt.elements=nr.create($n,!0);$n=nr.getElements(On),me=!0}else $n&&($n=nr.getElements($n),me=!0,he.command($n,"invalid elements",de.commandStr));var jn=ba(function(Xn,di){if($n){var pa=Xn.link($n);return Xn.ELEMENTS=pa,pa}return Xn.ELEMENTS=null,null});return jn.value=$n,jn}else if(Ku in Pt){me=!0;var Vn=Pt[Ku];return Ru(Vn,function(Xn,di){var pa=Xn.shared,Po=pa.isBufferArgs,Xs=pa.elements,ql=Xn.invoke(di,Vn),Fa=di.def("null"),na=di.def(Po,"(",ql,")"),hl=Xn.cond(na).then(Fa,"=",Xs,".createStream(",ql,");").else(Fa,"=",Xs,".getElements(",ql,");");return he.optional(function(){Xn.assert(hl.else,"!"+ql+"||"+Fa,"invalid elements")}),di.entry(hl),di.exit(Xn.cond(na).then(Xs,".destroyStream(",Fa,");")),Xn.ELEMENTS=Fa,Fa})}else if(ot)return new ds(ct.thisDep,ct.contextDep,ct.propDep,function(Xn,di){return di.def(Xn.shared.vao+".currentVAO?"+Xn.shared.elements+".getElements("+Xn.shared.vao+".currentVAO.elements):null")});return null}var Ae=Ke();function At(){if(Pu in Qe){var $n=Qe[Pu];return Kt.primitive=$n,he.commandParameter($n,Sr,"invalid primitve",de.commandStr),ba(function(jn,Vn){return Sr[$n]})}else if(Pu in Pt){var On=Pt[Pu];return Ru(On,function(jn,Vn){var Xn=jn.constants.primTypes,di=jn.invoke(Vn,On);return he.optional(function(){jn.assert(Vn,di+" in "+Xn,"invalid primitive, must be one of "+Object.keys(Sr))}),Vn.def(Xn,"[",di,"]")})}else{if(me)return Iu(Ae)?Ae.value?ba(function(jn,Vn){return Vn.def(jn.ELEMENTS,".primType")}):ba(function(){return Sp}):new ds(Ae.thisDep,Ae.contextDep,Ae.propDep,function(jn,Vn){var Xn=jn.ELEMENTS;return Vn.def(Xn,"?",Xn,".primType:",Sp)});if(ot)return new ds(ct.thisDep,ct.contextDep,ct.propDep,function(jn,Vn){return Vn.def(jn.shared.vao+".currentVAO?"+jn.shared.vao+".currentVAO.primitive:"+Sp)})}return null}function zt($n,On){if($n in Qe){var jn=Qe[$n]|0;return On?Kt.offset=jn:Kt.instances=jn,he.command(!On||jn>=0,"invalid "+$n,de.commandStr),ba(function(Xn,di){return On&&(Xn.OFFSET=jn),jn})}else if($n in Pt){var Vn=Pt[$n];return Ru(Vn,function(Xn,di){var pa=Xn.invoke(di,Vn);return On&&(Xn.OFFSET=pa,he.optional(function(){Xn.assert(di,pa+">=0","invalid "+$n)})),pa})}else if(On){if(me)return ba(function(Xn,di){return Xn.OFFSET=0,0});if(ot)return new ds(ct.thisDep,ct.contextDep,ct.propDep,function(Xn,di){return di.def(Xn.shared.vao+".currentVAO?"+Xn.shared.vao+".currentVAO.offset:0")})}else if(ot)return new ds(ct.thisDep,ct.contextDep,ct.propDep,function(Xn,di){return di.def(Xn.shared.vao+".currentVAO?"+Xn.shared.vao+".currentVAO.instances:-1")});return null}var Mr=zt(Ua,!0);function on(){if(ps in Qe){var $n=Qe[ps]|0;return Kt.count=$n,he.command(typeof $n=="number"&&$n>=0,"invalid vertex count",de.commandStr),ba(function(){return $n})}else if(ps in Pt){var On=Pt[ps];return Ru(On,function(di,pa){var Po=di.invoke(pa,On);return he.optional(function(){di.assert(pa,"typeof "+Po+'==="number"&&'+Po+">=0&&"+Po+"===("+Po+"|0)","invalid vertex count")}),Po})}else if(me)if(Iu(Ae)){if(Ae)return Mr?new ds(Mr.thisDep,Mr.contextDep,Mr.propDep,function(di,pa){var Po=pa.def(di.ELEMENTS,".vertCount-",di.OFFSET);return he.optional(function(){di.assert(pa,Po+">=0","invalid vertex offset/element buffer too small")}),Po}):ba(function(di,pa){return pa.def(di.ELEMENTS,".vertCount")});var jn=ba(function(){return-1});return he.optional(function(){jn.MISSING=!0}),jn}else{var Vn=new ds(Ae.thisDep||Mr.thisDep,Ae.contextDep||Mr.contextDep,Ae.propDep||Mr.propDep,function(di,pa){var Po=di.ELEMENTS;return di.OFFSET?pa.def(Po,"?",Po,".vertCount-",di.OFFSET,":-1"):pa.def(Po,"?",Po,".vertCount:-1")});return he.optional(function(){Vn.DYNAMIC=!0}),Vn}else if(ot){var Xn=new ds(ct.thisDep,ct.contextDep,ct.propDep,function(di,pa){return pa.def(di.shared.vao,".currentVAO?",di.shared.vao,".currentVAO.count:-1")});return Xn}return null}var sn=At(),Cn=on(),en=zt(hh,!1);return{elements:Ae,primitive:sn,count:Cn,instances:en,offset:Mr,vao:ct,vaoActive:ot,elementsActive:me,static:Kt}}function Ao(we,de){var Qe=we.static,Pt=we.dynamic,Kt={};return Qr.forEach(function(ot){var tt=an(ot);function ct(me,Ke){if(ot in Qe){var Ae=me(Qe[ot]);Kt[tt]=ba(function(){return Ae})}else if(ot in Pt){var At=Pt[ot];Kt[tt]=Ru(At,function(zt,Mr){return Ke(zt,Mr,zt.invoke(Mr,At))})}}switch(ot){case cc:case $a:case Bo:case _f:case Ol:case Hs:case iu:case Gs:case La:case ts:return ct(function(me){return he.commandType(me,"boolean",ot,de.commandStr),me},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,"typeof "+Ae+'==="boolean"',"invalid flag "+ot,me.commandStr)}),Ae});case Il:return ct(function(me){return he.commandParameter(me,Dc,"invalid "+ot,de.commandStr),Dc[me]},function(me,Ke,Ae){var At=me.constants.compareFuncs;return he.optional(function(){me.assert(Ke,Ae+" in "+At,"invalid "+ot+", must be one of "+Object.keys(Dc))}),Ke.def(At,"[",Ae,"]")});case Es:return ct(function(me){return he.command(Ca(me)&&me.length===2&&typeof me[0]=="number"&&typeof me[1]=="number"&&me[0]<=me[1],"depth range is 2d array",de.commandStr),me},function(me,Ke,Ae){he.optional(function(){me.assert(Ke,me.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var At=Ke.def("+",Ae,"[0]"),zt=Ke.def("+",Ae,"[1]");return[At,zt]});case fs:return ct(function(me){he.commandType(me,"object","blend.func",de.commandStr);var Ke="srcRGB"in me?me.srcRGB:me.src,Ae="srcAlpha"in me?me.srcAlpha:me.src,At="dstRGB"in me?me.dstRGB:me.dst,zt="dstAlpha"in me?me.dstAlpha:me.dst;return he.commandParameter(Ke,$l,tt+".srcRGB",de.commandStr),he.commandParameter(Ae,$l,tt+".srcAlpha",de.commandStr),he.commandParameter(At,$l,tt+".dstRGB",de.commandStr),he.commandParameter(zt,$l,tt+".dstAlpha",de.commandStr),he.command(Tp.indexOf(Ke+", "+At)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ke+", "+At+")",de.commandStr),[$l[Ke],$l[At],$l[Ae],$l[zt]]},function(me,Ke,Ae){var At=me.constants.blendFuncs;he.optional(function(){me.assert(Ke,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function zt(On,jn){var Vn=Ke.def('"',On,jn,'" in ',Ae,"?",Ae,".",On,jn,":",Ae,".",On);return he.optional(function(){me.assert(Ke,Vn+" in "+At,"invalid "+ot+"."+On+jn+", must be one of "+Object.keys($l))}),Vn}var Mr=zt("src","RGB"),on=zt("dst","RGB");he.optional(function(){var On=me.constants.invalidBlendCombinations;me.assert(Ke,On+".indexOf("+Mr+'+", "+'+on+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var sn=Ke.def(At,"[",Mr,"]"),Cn=Ke.def(At,"[",zt("src","Alpha"),"]"),en=Ke.def(At,"[",on,"]"),$n=Ke.def(At,"[",zt("dst","Alpha"),"]");return[sn,en,Cn,$n]});case Rs:return ct(function(me){if(typeof me=="string")return he.commandParameter(me,Ht,"invalid "+ot,de.commandStr),[Ht[me],Ht[me]];if(typeof me=="object")return he.commandParameter(me.rgb,Ht,ot+".rgb",de.commandStr),he.commandParameter(me.alpha,Ht,ot+".alpha",de.commandStr),[Ht[me.rgb],Ht[me.alpha]];he.commandRaise("invalid blend.equation",de.commandStr)},function(me,Ke,Ae){var At=me.constants.blendEquations,zt=Ke.def(),Mr=Ke.def(),on=me.cond("typeof ",Ae,'==="string"');return he.optional(function(){function sn(Cn,en,$n){me.assert(Cn,$n+" in "+At,"invalid "+en+", must be one of "+Object.keys(Ht))}sn(on.then,ot,Ae),me.assert(on.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+ot),sn(on.else,ot+".rgb",Ae+".rgb"),sn(on.else,ot+".alpha",Ae+".alpha")}),on.then(zt,"=",Mr,"=",At,"[",Ae,"];"),on.else(zt,"=",At,"[",Ae,".rgb];",Mr,"=",At,"[",Ae,".alpha];"),Ke(on),[zt,Mr]});case fo:return ct(function(me){return he.command(Ca(me)&&me.length===4,"blend.color must be a 4d array",de.commandStr),ge(4,function(Ke){return+me[Ke]})},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,me.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),ge(4,function(At){return Ke.def("+",Ae,"[",At,"]")})});case Rl:return ct(function(me){return he.commandType(me,"number",tt,de.commandStr),me|0},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),Ke.def(Ae,"|0")});case Wo:return ct(function(me){he.commandType(me,"object",tt,de.commandStr);var Ke=me.cmp||"keep",Ae=me.ref||0,At="mask"in me?me.mask:-1;return he.commandParameter(Ke,Dc,ot+".cmp",de.commandStr),he.commandType(Ae,"number",ot+".ref",de.commandStr),he.commandType(At,"number",ot+".mask",de.commandStr),[Dc[Ke],Ae,At]},function(me,Ke,Ae){var At=me.constants.compareFuncs;he.optional(function(){function sn(){me.assert(Ke,Array.prototype.join.call(arguments,""),"invalid stencil.func")}sn(Ae+"&&typeof ",Ae,'==="object"'),sn('!("cmp" in ',Ae,")||(",Ae,".cmp in ",At,")")});var zt=Ke.def('"cmp" in ',Ae,"?",At,"[",Ae,".cmp]",":",Ll),Mr=Ke.def(Ae,".ref|0"),on=Ke.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[zt,Mr,on]});case ks:case Zo:return ct(function(me){he.commandType(me,"object",tt,de.commandStr);var Ke=me.fail||"keep",Ae=me.zfail||"keep",At=me.zpass||"keep";return he.commandParameter(Ke,fl,ot+".fail",de.commandStr),he.commandParameter(Ae,fl,ot+".zfail",de.commandStr),he.commandParameter(At,fl,ot+".zpass",de.commandStr),[ot===Zo?kc:yh,fl[Ke],fl[Ae],fl[At]]},function(me,Ke,Ae){var At=me.constants.stencilOps;he.optional(function(){me.assert(Ke,Ae+"&&typeof "+Ae+'==="object"',"invalid "+ot)});function zt(Mr){return he.optional(function(){me.assert(Ke,'!("'+Mr+'" in '+Ae+")||("+Ae+"."+Mr+" in "+At+")","invalid "+ot+"."+Mr+", must be one of "+Object.keys(fl))}),Ke.def('"',Mr,'" in ',Ae,"?",At,"[",Ae,".",Mr,"]:",Ll)}return[ot===Zo?kc:yh,zt("fail"),zt("zfail"),zt("zpass")]});case Xu:return ct(function(me){he.commandType(me,"object",tt,de.commandStr);var Ke=me.factor|0,Ae=me.units|0;return he.commandType(Ke,"number",tt+".factor",de.commandStr),he.commandType(Ae,"number",tt+".units",de.commandStr),[Ke,Ae]},function(me,Ke,Ae){he.optional(function(){me.assert(Ke,Ae+"&&typeof "+Ae+'==="object"',"invalid "+ot)});var At=Ke.def(Ae,".factor|0"),zt=Ke.def(Ae,".units|0");return[At,zt]});case Zu:return ct(function(me){var Ke=0;return me==="front"?Ke=yh:me==="back"&&(Ke=kc),he.command(!!Ke,tt,de.commandStr),Ke},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),Ke.def(Ae,'==="front"?',yh,":",kc)});case Mu:return ct(function(me){return he.command(typeof me=="number"&&me>=Vt.lineWidthDims[0]&&me<=Vt.lineWidthDims[1],"invalid line width, must be a positive number between "+Vt.lineWidthDims[0]+" and "+Vt.lineWidthDims[1],de.commandStr),me},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,"typeof "+Ae+'==="number"&&'+Ae+">="+Vt.lineWidthDims[0]+"&&"+Ae+"<="+Vt.lineWidthDims[1],"invalid line width")}),Ae});case Tu:return ct(function(me){return he.commandParameter(me,Pp,tt,de.commandStr),Pp[me]},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ke.def(Ae+'==="cw"?'+Lc+":"+Cp)});case lc:return ct(function(me){return he.command(Ca(me)&&me.length===4,"color.mask must be length 4 array",de.commandStr),me.map(function(Ke){return!!Ke})},function(me,Ke,Ae){return he.optional(function(){me.assert(Ke,me.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),ge(4,function(At){return"!!"+Ae+"["+At+"]"})});case Yu:return ct(function(me){he.command(typeof me=="object"&&me,tt,de.commandStr);var Ke="value"in me?me.value:1,Ae=!!me.invert;return he.command(typeof Ke=="number"&&Ke>=0&&Ke<=1,"sample.coverage.value must be a number between 0 and 1",de.commandStr),[Ke,Ae]},function(me,Ke,Ae){he.optional(function(){me.assert(Ke,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var At=Ke.def('"value" in ',Ae,"?+",Ae,".value:1"),zt=Ke.def("!!",Ae,".invert");return[At,zt]})}}),Kt}function Ki(we,de){var Qe=we.static,Pt=we.dynamic,Kt={};return Object.keys(Qe).forEach(function(ot){var tt=Qe[ot],ct;if(typeof tt=="number"||typeof tt=="boolean")ct=ba(function(){return tt});else if(typeof tt=="function"){var me=tt._reglType;me==="texture2d"||me==="textureCube"?ct=ba(function(Ke){return Ke.link(tt)}):me==="framebuffer"||me==="framebufferCube"?(he.command(tt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ot+'"',de.commandStr),ct=ba(function(Ke){return Ke.link(tt.color[0])})):he.commandRaise('invalid data for uniform "'+ot+'"',de.commandStr)}else Ca(tt)?ct=ba(function(Ke){var Ae=Ke.global.def("[",ge(tt.length,function(At){return he.command(typeof tt[At]=="number"||typeof tt[At]=="boolean","invalid uniform "+ot,Ke.commandStr),tt[At]}),"]");return Ae}):he.commandRaise('invalid or missing data for uniform "'+ot+'"',de.commandStr);ct.value=tt,Kt[ot]=ct}),Object.keys(Pt).forEach(function(ot){var tt=Pt[ot];Kt[ot]=Ru(tt,function(ct,me){return ct.invoke(me,tt)})}),Kt}function ns(we,de){var Qe=we.static,Pt=we.dynamic,Kt={};return Object.keys(Qe).forEach(function(ot){var tt=Qe[ot],ct=ae.id(ot),me=new Gt;if(Gh(tt))me.state=Ei,me.buffer=hr.getBuffer(hr.create(tt,Oc,!1,!0)),me.type=0;else{var Ke=hr.getBuffer(tt);if(Ke)me.state=Ei,me.buffer=Ke,me.type=0;else if(he.command(typeof tt=="object"&&tt,"invalid data for attribute "+ot,de.commandStr),"constant"in tt){var Ae=tt.constant;me.buffer="null",me.state=Oi,typeof Ae=="number"?me.x=Ae:(he.command(Ca(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+ot,de.commandStr),zi.forEach(function(en,$n){$n<Ae.length&&(me[en]=Ae[$n])}))}else{Gh(tt.buffer)?Ke=hr.getBuffer(hr.create(tt.buffer,Oc,!1,!0)):Ke=hr.getBuffer(tt.buffer),he.command(!!Ke,'missing buffer for attribute "'+ot+'"',de.commandStr);var At=tt.offset|0;he.command(At>=0,'invalid offset for attribute "'+ot+'"',de.commandStr);var zt=tt.stride|0;he.command(zt>=0&&zt<256,'invalid stride for attribute "'+ot+'", must be integer betweeen [0, 255]',de.commandStr);var Mr=tt.size|0;he.command(!("size"in tt)||Mr>0&&Mr<=4,'invalid size for attribute "'+ot+'", must be 1,2,3,4',de.commandStr);var on=!!tt.normalized,sn=0;"type"in tt&&(he.commandParameter(tt.type,Vs,"invalid type for attribute "+ot,de.commandStr),sn=Vs[tt.type]);var Cn=tt.divisor|0;he.optional(function(){"divisor"in tt&&(he.command(Cn===0||Br,'cannot specify divisor for attribute "'+ot+'", instancing not supported',de.commandStr),he.command(Cn>=0,'invalid divisor for attribute "'+ot+'"',de.commandStr));var en=de.commandStr,$n=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(tt).forEach(function(On){he.command($n.indexOf(On)>=0,'unknown parameter "'+On+'" for attribute pointer "'+ot+'" (valid parameters are '+$n+")",en)})}),me.buffer=Ke,me.state=Ei,me.size=Mr,me.normalized=on,me.type=sn||Ke.dtype,me.offset=At,me.stride=zt,me.divisor=Cn}}Kt[ot]=ba(function(en,$n){var On=en.attribCache;if(ct in On)return On[ct];var jn={isStream:!1};return Object.keys(me).forEach(function(Vn){jn[Vn]=me[Vn]}),me.buffer&&(jn.buffer=en.link(me.buffer),jn.type=jn.type||jn.buffer+".dtype"),On[ct]=jn,jn})}),Object.keys(Pt).forEach(function(ot){var tt=Pt[ot];function ct(me,Ke){var Ae=me.invoke(Ke,tt),At=me.shared,zt=me.constants,Mr=At.isBufferArgs,on=At.buffer;he.optional(function(){me.assert(Ke,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+Mr+"("+Ae+")||"+on+".getBuffer("+Ae+")||"+on+".getBuffer("+Ae+".buffer)||"+Mr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+At.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+ot+'"')});var sn={isStream:Ke.def(!1)},Cn=new Gt;Cn.state=Ei,Object.keys(Cn).forEach(function(jn){sn[jn]=Ke.def(""+Cn[jn])});var en=sn.buffer,$n=sn.type;Ke("if(",Mr,"(",Ae,")){",sn.isStream,"=true;",en,"=",on,".createStream(",Oc,",",Ae,");",$n,"=",en,".dtype;","}else{",en,"=",on,".getBuffer(",Ae,");","if(",en,"){",$n,"=",en,".dtype;",'}else if("constant" in ',Ae,"){",sn.state,"=",Oi,";","if(typeof "+Ae+'.constant === "number"){',sn[zi[0]],"=",Ae,".constant;",zi.slice(1).map(function(jn){return sn[jn]}).join("="),"=0;","}else{",zi.map(function(jn,Vn){return sn[jn]+"="+Ae+".constant.length>"+Vn+"?"+Ae+".constant["+Vn+"]:0;"}).join(""),"}}else{","if(",Mr,"(",Ae,".buffer)){",en,"=",on,".createStream(",Oc,",",Ae,".buffer);","}else{",en,"=",on,".getBuffer(",Ae,".buffer);","}",$n,'="type" in ',Ae,"?",zt.glTypes,"[",Ae,".type]:",en,".dtype;",sn.normalized,"=!!",Ae,".normalized;");function On(jn){Ke(sn[jn],"=",Ae,".",jn,"|0;")}return On("size"),On("offset"),On("stride"),On("divisor"),Ke("}}"),Ke.exit("if(",sn.isStream,"){",on,".destroyStream(",en,");","}"),sn}Kt[ot]=Ru(tt,ct)}),Kt}function Pa(we){var de=we.static,Qe=we.dynamic,Pt={};return Object.keys(de).forEach(function(Kt){var ot=de[Kt];Pt[Kt]=ba(function(tt,ct){return typeof ot=="number"||typeof ot=="boolean"?""+ot:tt.link(ot)})}),Object.keys(Qe).forEach(function(Kt){var ot=Qe[Kt];Pt[Kt]=Ru(ot,function(tt,ct){return tt.invoke(ct,ot)})}),Pt}function Xo(we,de,Qe,Pt,Kt){var ot=we.static,tt=we.dynamic;he.optional(function(){var On=[kl,vu,$u,Ku,Pu,Ua,ps,hh,xf,bf].concat(Qr);function jn(Vn){Object.keys(Vn).forEach(function(Xn){he.command(On.indexOf(Xn)>=0,'unknown parameter "'+Xn+'"',Kt.commandStr)})}jn(ot),jn(tt)});var ct=Ci(we,de),me=En(we,Kt),Ke=hi(we,me,Kt),Ae=ho(we,Kt),At=Ao(we,Kt),zt=Yi(we,Kt,ct);function Mr(On){var jn=Ke[On];jn&&(At[On]=jn)}Mr(Ls),Mr(an(hs));var on=Object.keys(At).length>0,sn={framebuffer:me,draw:Ae,shader:zt,state:At,dirty:on,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(sn.profile=yn(we,Kt),sn.uniforms=Ki(Qe,Kt),sn.drawVAO=sn.scopeVAO=Ae.vao,!sn.drawVAO&&zt.program&&!ct&&Ge.angle_instanced_arrays&&Ae.static.elements){var Cn=!0,en=zt.program.attributes.map(function(On){var jn=de.static[On];return Cn=Cn&&!!jn,jn});if(Cn&&en.length>0){var $n=Vr.getVAO(Vr.createVAO({attributes:en,elements:Ae.static.elements}));sn.drawVAO=new ds(null,null,null,function(On,jn){return On.link($n)}),sn.useVAO=!0}}return ct?sn.useVAO=!0:sn.attributes=ns(de,Kt),sn.context=Pa(Pt,Kt),sn}function Ai(we,de,Qe){var Pt=we.shared,Kt=Pt.context,ot=we.scope();Object.keys(Qe).forEach(function(tt){de.save(Kt,"."+tt);var ct=Qe[tt],me=ct.append(we,de);Array.isArray(me)?ot(Kt,".",tt,"=[",me.join(),"];"):ot(Kt,".",tt,"=",me,";")}),de(ot)}function aa(we,de,Qe,Pt){var Kt=we.shared,ot=Kt.gl,tt=Kt.framebuffer,ct;Sn&&(ct=de.def(Kt.extensions,".webgl_draw_buffers"));var me=we.constants,Ke=me.drawBuffer,Ae=me.backBuffer,At;Qe?At=Qe.append(we,de):At=de.def(tt,".next"),Pt||de("if(",At,"!==",tt,".cur){"),de("if(",At,"){",ot,".bindFramebuffer(",$f,",",At,".framebuffer);"),Sn&&de(ct,".drawBuffersWEBGL(",Ke,"[",At,".colorAttachments.length]);"),de("}else{",ot,".bindFramebuffer(",$f,",null);"),Sn&&de(ct,".drawBuffersWEBGL(",Ae,");"),de("}",tt,".cur=",At,";"),Pt||de("}")}function _o(we,de,Qe){var Pt=we.shared,Kt=Pt.gl,ot=we.current,tt=we.next,ct=Pt.current,me=Pt.next,Ke=we.cond(ct,".dirty");Qr.forEach(function(Ae){var At=an(Ae);if(!(At in Qe.state)){var zt,Mr;if(At in tt){zt=tt[At],Mr=ot[At];var on=ge(Dn[At].length,function(Cn){return Ke.def(zt,"[",Cn,"]")});Ke(we.cond(on.map(function(Cn,en){return Cn+"!=="+Mr+"["+en+"]"}).join("||")).then(Kt,".",ar[At],"(",on,");",on.map(function(Cn,en){return Mr+"["+en+"]="+Cn}).join(";"),";"))}else{zt=Ke.def(me,".",At);var sn=we.cond(zt,"!==",ct,".",At);Ke(sn),At in xr?sn(we.cond(zt).then(Kt,".enable(",xr[At],");").else(Kt,".disable(",xr[At],");"),ct,".",At,"=",zt,";"):sn(Kt,".",ar[At],"(",zt,");",ct,".",At,"=",zt,";")}}}),Object.keys(Qe.state).length===0&&Ke(ct,".dirty=false;"),de(Ke)}function Fs(we,de,Qe,Pt){var Kt=we.shared,ot=we.current,tt=Kt.current,ct=Kt.gl;Md(Object.keys(Qe)).forEach(function(me){var Ke=Qe[me];if(!(Pt&&!Pt(Ke))){var Ae=Ke.append(we,de);if(xr[me]){var At=xr[me];Iu(Ke)?Ae?de(ct,".enable(",At,");"):de(ct,".disable(",At,");"):de(we.cond(Ae).then(ct,".enable(",At,");").else(ct,".disable(",At,");")),de(tt,".",me,"=",Ae,";")}else if(Ca(Ae)){var zt=ot[me];de(ct,".",ar[me],"(",Ae,");",Ae.map(function(Mr,on){return zt+"["+on+"]="+Mr}).join(";"),";")}else de(ct,".",ar[me],"(",Ae,");",tt,".",me,"=",Ae,";")}})}function xo(we,de){Br&&(we.instancing=de.def(we.shared.extensions,".angle_instanced_arrays"))}function ji(we,de,Qe,Pt,Kt){var ot=we.shared,tt=we.stats,ct=ot.current,me=ot.timer,Ke=Qe.profile;function Ae(){var On=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return On||typeof performance=="undefined"?"Date.now()":"performance.now()"}var At,zt;function Mr(On){At=de.def(),On(At,"=",Ae(),";"),typeof Kt=="string"?On(tt,".count+=",Kt,";"):On(tt,".count++;"),rn&&(Pt?(zt=de.def(),On(zt,"=",me,".getNumPendingQueries();")):On(me,".beginQuery(",tt,");"))}function on(On){On(tt,".cpuTime+=",Ae(),"-",At,";"),rn&&(Pt?On(me,".pushScopeStats(",zt,",",me,".getNumPendingQueries(),",tt,");"):On(me,".endQuery();"))}function sn(On){var jn=de.def(ct,".profile");de(ct,".profile=",On,";"),de.exit(ct,".profile=",jn,";")}var Cn;if(Ke){if(Iu(Ke)){Ke.enable?(Mr(de),on(de.exit),sn("true")):sn("false");return}Cn=Ke.append(we,de),sn(Cn)}else Cn=de.def(ct,".profile");var en=we.block();Mr(en),de("if(",Cn,"){",en,"}");var $n=we.block();on($n),de.exit("if(",Cn,"){",$n,"}")}function is(we,de,Qe,Pt,Kt){var ot=we.shared;function tt(me){switch(me){case Ic:case Zf:case Ds:return 2;case mh:case ll:case Zs:return 3;case gh:case jh:case Vh:return 4;default:return 1}}function ct(me,Ke,Ae){var At=ot.gl,zt=de.def(me,".location"),Mr=de.def(ot.attributes,"[",zt,"]"),on=Ae.state,sn=Ae.buffer,Cn=[Ae.x,Ae.y,Ae.z,Ae.w],en=["buffer","normalized","offset","stride"];function $n(){de("if(!",Mr,".buffer){",At,".enableVertexAttribArray(",zt,");}");var jn=Ae.type,Vn;if(Ae.size?Vn=de.def(Ae.size,"||",Ke):Vn=Ke,de("if(",Mr,".type!==",jn,"||",Mr,".size!==",Vn,"||",en.map(function(di){return Mr+"."+di+"!=="+Ae[di]}).join("||"),"){",At,".bindBuffer(",Oc,",",sn,".buffer);",At,".vertexAttribPointer(",[zt,Vn,jn,Ae.normalized,Ae.stride,Ae.offset],");",Mr,".type=",jn,";",Mr,".size=",Vn,";",en.map(function(di){return Mr+"."+di+"="+Ae[di]+";"}).join(""),"}"),Br){var Xn=Ae.divisor;de("if(",Mr,".divisor!==",Xn,"){",we.instancing,".vertexAttribDivisorANGLE(",[zt,Xn],");",Mr,".divisor=",Xn,";}")}}function On(){de("if(",Mr,".buffer){",At,".disableVertexAttribArray(",zt,");",Mr,".buffer=null;","}if(",zi.map(function(jn,Vn){return Mr+"."+jn+"!=="+Cn[Vn]}).join("||"),"){",At,".vertexAttrib4f(",zt,",",Cn,");",zi.map(function(jn,Vn){return Mr+"."+jn+"="+Cn[Vn]+";"}).join(""),"}")}on===Ei?$n():on===Oi?On():(de("if(",on,"===",Ei,"){"),$n(),de("}else{"),On(),de("}"))}Pt.forEach(function(me){var Ke=me.name,Ae=Qe.attributes[Ke],At;if(Ae){if(!Kt(Ae))return;At=Ae.append(we,de)}else{if(!Kt(Op))return;var zt=we.scopeAttrib(Ke);he.optional(function(){we.assert(de,zt+".state","missing attribute "+Ke)}),At={},Object.keys(new Gt).forEach(function(Mr){At[Mr]=de.def(zt,".",Mr)})}ct(we.link(me),tt(me.info.type),At)})}function Ea(we,de,Qe,Pt,Kt,ot){for(var tt=we.shared,ct=tt.gl,me,Ke=0;Ke<Pt.length;++Ke){var Ae=Pt[Ke],At=Ae.name,zt=Ae.info.type,Mr=Qe.uniforms[At],on=we.link(Ae),sn=on+".location",Cn;if(Mr){if(!Kt(Mr))continue;if(Iu(Mr)){var en=Mr.value;if(he.command(en!==null&&typeof en!="undefined",'missing uniform "'+At+'"',we.commandStr),zt===Xf||zt===Yf){he.command(typeof en=="function"&&(zt===Xf&&(en._reglType==="texture2d"||en._reglType==="framebuffer")||zt===Yf&&(en._reglType==="textureCube"||en._reglType==="framebufferCube")),"invalid texture for uniform "+At,we.commandStr);var $n=we.link(en._texture||en.color[0]._texture);de(ct,".uniform1i(",sn,",",$n+".bind());"),de.exit($n,".unbind();")}else if(zt===Cf||zt===Rc||zt===au){he.optional(function(){he.command(Ca(en),"invalid matrix for uniform "+At,we.commandStr),he.command(zt===Cf&&en.length===4||zt===Rc&&en.length===9||zt===au&&en.length===16,"invalid length for matrix uniform "+At,we.commandStr)});var On=we.global.def("new Float32Array(["+Array.prototype.slice.call(en)+"])"),jn=2;zt===Rc?jn=3:zt===au&&(jn=4),de(ct,".uniformMatrix",jn,"fv(",sn,",false,",On,");")}else{switch(zt){case Wf:he.commandType(en,"number","uniform "+At,we.commandStr),me="1f";break;case Ic:he.command(Ca(en)&&en.length===2,"uniform "+At,we.commandStr),me="2f";break;case mh:he.command(Ca(en)&&en.length===3,"uniform "+At,we.commandStr),me="3f";break;case gh:he.command(Ca(en)&&en.length===4,"uniform "+At,we.commandStr),me="4f";break;case Yl:he.commandType(en,"boolean","uniform "+At,we.commandStr),me="1i";break;case Ws:he.commandType(en,"number","uniform "+At,we.commandStr),me="1i";break;case Ds:he.command(Ca(en)&&en.length===2,"uniform "+At,we.commandStr),me="2i";break;case Zf:he.command(Ca(en)&&en.length===2,"uniform "+At,we.commandStr),me="2i";break;case Zs:he.command(Ca(en)&&en.length===3,"uniform "+At,we.commandStr),me="3i";break;case ll:he.command(Ca(en)&&en.length===3,"uniform "+At,we.commandStr),me="3i";break;case Vh:he.command(Ca(en)&&en.length===4,"uniform "+At,we.commandStr),me="4i";break;case jh:he.command(Ca(en)&&en.length===4,"uniform "+At,we.commandStr),me="4i";break}de(ct,".uniform",me,"(",sn,",",Ca(en)?Array.prototype.slice.call(en):en,");")}continue}else Cn=Mr.append(we,de)}else{if(!Kt(Op))continue;Cn=de.def(tt.uniforms,"[",ae.id(At),"]")}zt===Xf?(he(!Array.isArray(Cn),"must specify a scalar prop for textures"),de("if(",Cn,"&&",Cn,'._reglType==="framebuffer"){',Cn,"=",Cn,".color[0];","}")):zt===Yf&&(he(!Array.isArray(Cn),"must specify a scalar prop for cube maps"),de("if(",Cn,"&&",Cn,'._reglType==="framebufferCube"){',Cn,"=",Cn,".color[0];","}")),he.optional(function(){function na(pl,Fp){we.assert(de,pl,'bad data or missing for uniform "'+At+'".  '+Fp)}function hl(pl){he(!Array.isArray(Cn),"must not specify an array type for uniform"),na("typeof "+Cn+'==="'+pl+'"',"invalid type, expected "+pl)}function qu(pl,Fp){Array.isArray(Cn)?he(Cn.length===pl,"must have length "+pl):na(tt.isArrayLike+"("+Cn+")&&"+Cn+".length==="+pl,"invalid vector, should have length "+pl,we.commandStr)}function Dp(pl){he(!Array.isArray(Cn),"must not specify a value type"),na("typeof "+Cn+'==="function"&&'+Cn+'._reglType==="texture'+(pl===rs?"2d":"Cube")+'"',"invalid texture type",we.commandStr)}switch(zt){case Ws:hl("number");break;case Zf:qu(2,"number");break;case ll:qu(3,"number");break;case jh:qu(4,"number");break;case Wf:hl("number");break;case Ic:qu(2,"number");break;case mh:qu(3,"number");break;case gh:qu(4,"number");break;case Yl:hl("boolean");break;case Ds:qu(2,"boolean");break;case Zs:qu(3,"boolean");break;case Vh:qu(4,"boolean");break;case Cf:qu(4,"number");break;case Rc:qu(9,"number");break;case au:qu(16,"number");break;case Xf:Dp(rs);break;case Yf:Dp(bd);break}});var Vn=1;switch(zt){case Xf:case Yf:var Xn=de.def(Cn,"._texture");de(ct,".uniform1i(",sn,",",Xn,".bind());"),de.exit(Xn,".unbind();");continue;case Ws:case Yl:me="1i";break;case Zf:case Ds:me="2i",Vn=2;break;case ll:case Zs:me="3i",Vn=3;break;case jh:case Vh:me="4i",Vn=4;break;case Wf:me="1f";break;case Ic:me="2f",Vn=2;break;case mh:me="3f",Vn=3;break;case gh:me="4f",Vn=4;break;case Cf:me="Matrix2fv";break;case Rc:me="Matrix3fv";break;case au:me="Matrix4fv";break}if(me.charAt(0)==="M"){de(ct,".uniform",me,"(",sn,",");var di=Math.pow(zt-Cf+2,2),pa=we.global.def("new Float32Array(",di,")");Array.isArray(Cn)?de("false,(",ge(di,function(na){return pa+"["+na+"]="+Cn[na]}),",",pa,")"):de("false,(Array.isArray(",Cn,")||",Cn," instanceof Float32Array)?",Cn,":(",ge(di,function(na){return pa+"["+na+"]="+Cn+"["+na+"]"}),",",pa,")"),de(");")}else if(Vn>1){for(var Po=[],Xs=[],ql=0;ql<Vn;++ql)Array.isArray(Cn)?Xs.push(Cn[ql]):Xs.push(de.def(Cn+"["+ql+"]")),ot&&Po.push(de.def());ot&&de("if(!",we.batchId,"||",Po.map(function(na,hl){return na+"!=="+Xs[hl]}).join("||"),"){",Po.map(function(na,hl){return na+"="+Xs[hl]+";"}).join("")),de(ct,".uniform",me,"(",sn,",",Xs.join(","),");"),ot&&de("}")}else{if(he(!Array.isArray(Cn),"uniform value must not be an array"),ot){var Fa=de.def();de("if(!",we.batchId,"||",Fa,"!==",Cn,"){",Fa,"=",Cn,";")}de(ct,".uniform",me,"(",sn,",",Cn,");"),ot&&de("}")}}}function zo(we,de,Qe,Pt){var Kt=we.shared,ot=Kt.gl,tt=Kt.draw,ct=Pt.draw;function me(){var Vn=ct.elements,Xn,di=de;return Vn?((Vn.contextDep&&Pt.contextDynamic||Vn.propDep)&&(di=Qe),Xn=Vn.append(we,di),ct.elementsActive&&di("if("+Xn+")"+ot+".bindBuffer("+Hf+","+Xn+".buffer.buffer);")):(Xn=di.def(),di(Xn,"=",tt,".",Ku,";","if(",Xn,"){",ot,".bindBuffer(",Hf,",",Xn,".buffer.buffer);}","else if(",Kt.vao,".currentVAO){",Xn,"=",we.shared.elements+".getElements("+Kt.vao,".currentVAO.elements);",cr?"":"if("+Xn+")"+ot+".bindBuffer("+Hf+","+Xn+".buffer.buffer);","}")),Xn}function Ke(){var Vn=ct.count,Xn,di=de;return Vn?((Vn.contextDep&&Pt.contextDynamic||Vn.propDep)&&(di=Qe),Xn=Vn.append(we,di),he.optional(function(){Vn.MISSING&&we.assert(de,"false","missing vertex count"),Vn.DYNAMIC&&we.assert(di,Xn+">=0","missing vertex count")})):(Xn=di.def(tt,".",ps),he.optional(function(){we.assert(di,Xn+">=0","missing vertex count")})),Xn}var Ae=me();function At(Vn){var Xn=ct[Vn];return Xn?Xn.contextDep&&Pt.contextDynamic||Xn.propDep?Xn.append(we,Qe):Xn.append(we,de):de.def(tt,".",Vn)}var zt=At(Pu),Mr=At(Ua),on=Ke();if(typeof on=="number"){if(on===0)return}else Qe("if(",on,"){"),Qe.exit("}");var sn,Cn;Br&&(sn=At(hh),Cn=we.instancing);var en=Ae+".type",$n=ct.elements&&Iu(ct.elements)&&!ct.vaoActive;function On(){function Vn(){Qe(Cn,".drawElementsInstancedANGLE(",[zt,on,en,Mr+"<<(("+en+"-"+Bn+")>>1)",sn],");")}function Xn(){Qe(Cn,".drawArraysInstancedANGLE(",[zt,Mr,on,sn],");")}Ae&&Ae!=="null"?$n?Vn():(Qe("if(",Ae,"){"),Vn(),Qe("}else{"),Xn(),Qe("}")):Xn()}function jn(){function Vn(){Qe(ot+".drawElements("+[zt,on,en,Mr+"<<(("+en+"-"+Bn+")>>1)"]+");")}function Xn(){Qe(ot+".drawArrays("+[zt,Mr,on]+");")}Ae&&Ae!=="null"?$n?Vn():(Qe("if(",Ae,"){"),Vn(),Qe("}else{"),Xn(),Qe("}")):Xn()}Br&&(typeof sn!="number"||sn>=0)?typeof sn=="string"?(Qe("if(",sn,">0){"),On(),Qe("}else if(",sn,"<0){"),jn(),Qe("}")):On():jn()}function mi(we,de,Qe,Pt,Kt){var ot=Si(),tt=ot.proc("body",Kt);return he.optional(function(){ot.commandStr=de.commandStr,ot.command=ot.link(de.commandStr)}),Br&&(ot.instancing=tt.def(ot.shared.extensions,".angle_instanced_arrays")),we(ot,tt,Qe,Pt),ot.compile().body}function Fi(we,de,Qe,Pt){xo(we,de),Qe.useVAO?Qe.drawVAO?de(we.shared.vao,".setVAO(",Qe.drawVAO.append(we,de),");"):de(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(de(we.shared.vao,".setVAO(null);"),is(we,de,Qe,Pt.attributes,function(){return!0})),Ea(we,de,Qe,Pt.uniforms,function(){return!0},!1),zo(we,de,de,Qe)}function Da(we,de){var Qe=we.proc("draw",1);xo(we,Qe),Ai(we,Qe,de.context),aa(we,Qe,de.framebuffer),_o(we,Qe,de),Fs(we,Qe,de.state),ji(we,Qe,de,!1,!0);var Pt=de.shader.progVar.append(we,Qe);if(Qe(we.shared.gl,".useProgram(",Pt,".program);"),de.shader.program)Fi(we,Qe,de,de.shader.program);else{Qe(we.shared.vao,".setVAO(null);");var Kt=we.global.def("{}"),ot=Qe.def(Pt,".id"),tt=Qe.def(Kt,"[",ot,"]");Qe(we.cond(tt).then(tt,".call(this,a0);").else(tt,"=",Kt,"[",ot,"]=",we.link(function(ct){return mi(Fi,we,de,ct,1)}),"(",Pt,");",tt,".call(this,a0);"))}Object.keys(de.state).length>0&&Qe(we.shared.current,".dirty=true;"),we.shared.vao&&Qe(we.shared.vao,".setVAO(null);")}function Bs(we,de,Qe,Pt){we.batchId="a1",xo(we,de);function Kt(){return!0}is(we,de,Qe,Pt.attributes,Kt),Ea(we,de,Qe,Pt.uniforms,Kt,!1),zo(we,de,de,Qe)}function Ss(we,de,Qe,Pt){xo(we,de);var Kt=Qe.contextDep,ot=de.def(),tt="a0",ct="a1",me=de.def();we.shared.props=me,we.batchId=ot;var Ke=we.scope(),Ae=we.scope();de(Ke.entry,"for(",ot,"=0;",ot,"<",ct,";++",ot,"){",me,"=",tt,"[",ot,"];",Ae,"}",Ke.exit);function At(en){return en.contextDep&&Kt||en.propDep}function zt(en){return!At(en)}if(Qe.needsContext&&Ai(we,Ae,Qe.context),Qe.needsFramebuffer&&aa(we,Ae,Qe.framebuffer),Fs(we,Ae,Qe.state,At),Qe.profile&&At(Qe.profile)&&ji(we,Ae,Qe,!1,!0),Pt)Qe.useVAO?Qe.drawVAO?At(Qe.drawVAO)?Ae(we.shared.vao,".setVAO(",Qe.drawVAO.append(we,Ae),");"):Ke(we.shared.vao,".setVAO(",Qe.drawVAO.append(we,Ke),");"):Ke(we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"):(Ke(we.shared.vao,".setVAO(null);"),is(we,Ke,Qe,Pt.attributes,zt),is(we,Ae,Qe,Pt.attributes,At)),Ea(we,Ke,Qe,Pt.uniforms,zt,!1),Ea(we,Ae,Qe,Pt.uniforms,At,!0),zo(we,Ke,Ae,Qe);else{var Mr=we.global.def("{}"),on=Qe.shader.progVar.append(we,Ae),sn=Ae.def(on,".id"),Cn=Ae.def(Mr,"[",sn,"]");Ae(we.shared.gl,".useProgram(",on,".program);","if(!",Cn,"){",Cn,"=",Mr,"[",sn,"]=",we.link(function(en){return mi(Bs,we,Qe,en,2)}),"(",on,");}",Cn,".call(this,a0[",ot,"],",ot,");")}}function De(we,de){var Qe=we.proc("batch",2);we.batchId="0",xo(we,Qe);var Pt=!1,Kt=!0;Object.keys(de.context).forEach(function(Mr){Pt=Pt||de.context[Mr].propDep}),Pt||(Ai(we,Qe,de.context),Kt=!1);var ot=de.framebuffer,tt=!1;ot?(ot.propDep?Pt=tt=!0:ot.contextDep&&Pt&&(tt=!0),tt||aa(we,Qe,ot)):aa(we,Qe,null),de.state.viewport&&de.state.viewport.propDep&&(Pt=!0);function ct(Mr){return Mr.contextDep&&Pt||Mr.propDep}_o(we,Qe,de),Fs(we,Qe,de.state,function(Mr){return!ct(Mr)}),(!de.profile||!ct(de.profile))&&ji(we,Qe,de,!1,"a1"),de.contextDep=Pt,de.needsContext=Kt,de.needsFramebuffer=tt;var me=de.shader.progVar;if(me.contextDep&&Pt||me.propDep)Ss(we,Qe,de,null);else{var Ke=me.append(we,Qe);if(Qe(we.shared.gl,".useProgram(",Ke,".program);"),de.shader.program)Ss(we,Qe,de,de.shader.program);else{Qe(we.shared.vao,".setVAO(null);");var Ae=we.global.def("{}"),At=Qe.def(Ke,".id"),zt=Qe.def(Ae,"[",At,"]");Qe(we.cond(zt).then(zt,".call(this,a0,a1);").else(zt,"=",Ae,"[",At,"]=",we.link(function(Mr){return mi(Ss,we,de,Mr,2)}),"(",Ke,");",zt,".call(this,a0,a1);"))}}Object.keys(de.state).length>0&&Qe(we.shared.current,".dirty=true;"),we.shared.vao&&Qe(we.shared.vao,".setVAO(null);")}function er(we,de){var Qe=we.proc("scope",3);we.batchId="a2";var Pt=we.shared,Kt=Pt.current;Ai(we,Qe,de.context),de.framebuffer&&de.framebuffer.append(we,Qe),Md(Object.keys(de.state)).forEach(function(tt){var ct=de.state[tt],me=ct.append(we,Qe);Ca(me)?me.forEach(function(Ke,Ae){Qe.set(we.next[tt],"["+Ae+"]",Ke)}):Qe.set(Pt.next,"."+tt,me)}),ji(we,Qe,de,!0,!0),[Ku,Ua,ps,hh,Pu].forEach(function(tt){var ct=de.draw[tt];!ct||Qe.set(Pt.draw,"."+tt,""+ct.append(we,Qe))}),Object.keys(de.uniforms).forEach(function(tt){var ct=de.uniforms[tt].append(we,Qe);Array.isArray(ct)&&(ct="["+ct.join()+"]"),Qe.set(Pt.uniforms,"["+ae.id(tt)+"]",ct)}),Object.keys(de.attributes).forEach(function(tt){var ct=de.attributes[tt].append(we,Qe),me=we.scopeAttrib(tt);Object.keys(new Gt).forEach(function(Ke){Qe.set(me,"."+Ke,ct[Ke])})}),de.scopeVAO&&Qe.set(Pt.vao,".targetVAO",de.scopeVAO.append(we,Qe));function ot(tt){var ct=de.shader[tt];ct&&Qe.set(Pt.shader,"."+tt,ct.append(we,Qe))}ot(vu),ot($u),Object.keys(de.state).length>0&&(Qe(Kt,".dirty=true;"),Qe.exit(Kt,".dirty=true;")),Qe("a1(",we.shared.context,",a0,",we.batchId,");")}function Ft(we){if(!(typeof we!="object"||Ca(we))){for(var de=Object.keys(we),Qe=0;Qe<de.length;++Qe)if(Hn.isDynamic(we[de[Qe]]))return!0;return!1}}function Pn(we,de,Qe){var Pt=de.static[Qe];if(!Pt||!Ft(Pt))return;var Kt=we.global,ot=Object.keys(Pt),tt=!1,ct=!1,me=!1,Ke=we.global.def("{}");ot.forEach(function(At){var zt=Pt[At];if(Hn.isDynamic(zt)){typeof zt=="function"&&(zt=Pt[At]=Hn.unbox(zt));var Mr=Ru(zt,null);tt=tt||Mr.thisDep,me=me||Mr.propDep,ct=ct||Mr.contextDep}else{switch(Kt(Ke,".",At,"="),typeof zt){case"number":Kt(zt);break;case"string":Kt('"',zt,'"');break;case"object":Array.isArray(zt)&&Kt("[",zt.join(),"]");break;default:Kt(we.link(zt));break}Kt(";")}});function Ae(At,zt){ot.forEach(function(Mr){var on=Pt[Mr];if(!!Hn.isDynamic(on)){var sn=At.invoke(zt,on);zt(Ke,".",Mr,"=",sn,";")}})}de.dynamic[Qe]=new Hn.DynamicVariable(Ji,{thisDep:tt,contextDep:ct,propDep:me,ref:Ke,append:Ae}),delete de.static[Qe]}function Vi(we,de,Qe,Pt,Kt){var ot=Si();ot.stats=ot.link(Kt),Object.keys(de.static).forEach(function(ct){Pn(ot,de,ct)}),fc.forEach(function(ct){Pn(ot,we,ct)});var tt=Xo(we,de,Qe,Pt,ot);return Da(ot,tt),er(ot,tt),De(ot,tt),ne(ot.compile(),{destroy:function(){tt.shader.program.destroy()}})}return{next:Rn,current:Dn,procs:function(){var we=Si(),de=we.proc("poll"),Qe=we.proc("refresh"),Pt=we.block();de(Pt),Qe(Pt);var Kt=we.shared,ot=Kt.gl,tt=Kt.next,ct=Kt.current;Pt(ct,".dirty=false;"),aa(we,de),aa(we,Qe,null,!0);var me;Br&&(me=we.link(Br)),Ge.oes_vertex_array_object&&Qe(we.link(Ge.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ke=0;Ke<Vt.maxAttributes;++Ke){var Ae=Qe.def(Kt.attributes,"[",Ke,"]"),At=we.cond(Ae,".buffer");At.then(ot,".enableVertexAttribArray(",Ke,");",ot,".bindBuffer(",Oc,",",Ae,".buffer.buffer);",ot,".vertexAttribPointer(",Ke,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(ot,".disableVertexAttribArray(",Ke,");",ot,".vertexAttrib4f(",Ke,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Qe(At),Br&&Qe(me,".vertexAttribDivisorANGLE(",Ke,",",Ae,".divisor);")}return Qe(we.shared.vao,".currentVAO=null;",we.shared.vao,".setVAO(",we.shared.vao,".targetVAO);"),Object.keys(xr).forEach(function(zt){var Mr=xr[zt],on=Pt.def(tt,".",zt),sn=we.block();sn("if(",on,"){",ot,".enable(",Mr,")}else{",ot,".disable(",Mr,")}",ct,".",zt,"=",on,";"),Qe(sn),de("if(",on,"!==",ct,".",zt,"){",sn,"}")}),Object.keys(ar).forEach(function(zt){var Mr=ar[zt],on=Dn[zt],sn,Cn,en=we.block();if(en(ot,".",Mr,"("),Ca(on)){var $n=on.length;sn=we.global.def(tt,".",zt),Cn=we.global.def(ct,".",zt),en(ge($n,function(On){return sn+"["+On+"]"}),");",ge($n,function(On){return Cn+"["+On+"]="+sn+"["+On+"];"}).join("")),de("if(",ge($n,function(On){return sn+"["+On+"]!=="+Cn+"["+On+"]"}).join("||"),"){",en,"}")}else sn=Pt.def(tt,".",zt),Cn=Pt.def(ct,".",zt),en(sn,");",ct,".",zt,"=",sn,";"),de("if(",sn,"!==",Cn,"){",en,"}");Qe(en)}),we.compile()}(),compile:Vi}}function Od(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ip=34918,Ev=34919,Id=35007,Rd=function(ae,Ge){if(!Ge.ext_disjoint_timer_query)return null;var Vt=[];function hr(){return Vt.pop()||Ge.ext_disjoint_timer_query.createQueryEXT()}function nr(Sn){Vt.push(Sn)}var Jt=[];function wr(Sn){var cr=hr();Ge.ext_disjoint_timer_query.beginQueryEXT(Id,cr),Jt.push(cr),zr(Jt.length-1,Jt.length,Sn)}function jr(){Ge.ext_disjoint_timer_query.endQueryEXT(Id)}function Vr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Xr=[];function Gr(){return Xr.pop()||new Vr}function fn(Sn){Xr.push(Sn)}var rn=[];function zr(Sn,cr,Dn){var Rn=Gr();Rn.startQueryIndex=Sn,Rn.endQueryIndex=cr,Rn.sum=0,Rn.stats=Dn,rn.push(Rn)}var Gt=[],Ht=[];function Br(){var Sn,cr,Dn=Jt.length;if(Dn!==0){Ht.length=Math.max(Ht.length,Dn+1),Gt.length=Math.max(Gt.length,Dn+1),Gt[0]=0,Ht[0]=0;var Rn=0;for(Sn=0,cr=0;cr<Jt.length;++cr){var Qr=Jt[cr];Ge.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Ev)?(Rn+=Ge.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Ip),nr(Qr)):Jt[Sn++]=Qr,Gt[cr+1]=Rn,Ht[cr+1]=Sn}for(Jt.length=Sn,Sn=0,cr=0;cr<rn.length;++cr){var xr=rn[cr],ar=xr.startQueryIndex,an=xr.endQueryIndex;xr.sum+=Gt[an]-Gt[ar];var ln=Ht[ar],Wr=Ht[an];Wr===ln?(xr.stats.gpuTime+=xr.sum/1e6,fn(xr)):(xr.startQueryIndex=ln,xr.endQueryIndex=Wr,rn[Sn++]=xr)}rn.length=Sn}}return{beginQuery:wr,endQuery:jr,pushScopeStats:zr,update:Br,getNumPendingQueries:function(){return Jt.length},clear:function(){Vt.push.apply(Vt,Jt);for(var cr=0;cr<Vt.length;cr++)Ge.ext_disjoint_timer_query.deleteQueryEXT(Vt[cr]);Jt.length=0,Vt.length=0},restore:function(){Jt.length=0,Vt.length=0}}},Rp=16384,Sv=256,Cv=1024,_h=34962,kp="webglcontextlost",Lp="webglcontextrestored",Hh=1,vr=2,kd=3;function Kl(X,ae){for(var Ge=0;Ge<X.length;++Ge)if(X[Ge]===ae)return Ge;return-1}function Yt(X){var ae=$(X);if(!ae)return null;var Ge=ae.gl,Vt=Ge.getContextAttributes(),hr=Ge.isContextLost(),nr=le(Ge,ae);if(!nr)return null;var Jt=To(),wr=Od(),jr=nr.extensions,Vr=Rd(Ge,jr),Xr=Wi(),Gr=Ge.drawingBufferWidth,fn=Ge.drawingBufferHeight,rn={tick:0,time:0,viewportWidth:Gr,viewportHeight:fn,framebufferWidth:Gr,framebufferHeight:fn,drawingBufferWidth:Gr,drawingBufferHeight:fn,pixelRatio:ae.pixelRatio},zr={},Gt={elements:null,primitive:4,count:-1,offset:0,instances:-1},Ht=Lo(Ge,jr),Br=z(Ge,wr,ae,Dn),Sn=bn(Ge,jr,Br,wr),cr=Ze(Ge,jr,Ht,wr,Br,Sn,Gt);function Dn(mi){return cr.destroyBuffer(mi)}var Rn=fr(Ge,Jt,wr,ae),Qr=Wl(Ge,jr,Ht,function(){an.procs.poll()},rn,wr,ae),xr=es(Ge,jr,Ht,wr,ae),ar=ve(Ge,jr,Ht,Qr,xr,wr),an=Pd(Ge,Jt,jr,Ht,Br,Sn,Qr,ar,zr,cr,Rn,Gt,rn,Vr,ae),ln=Zn(Ge,ar,an.procs.poll,rn,Vt,jr,Ht),Wr=an.next,vn=Ge.canvas,hn=[],Ii=[],Si=[],yn=[ae.onDestroy],En=null;function hi(){if(hn.length===0){Vr&&Vr.update(),En=null;return}En=ii.next(hi),xo();for(var mi=hn.length-1;mi>=0;--mi){var Fi=hn[mi];Fi&&Fi(rn,null,0)}Ge.flush(),Vr&&Vr.update()}function Ci(){!En&&hn.length>0&&(En=ii.next(hi))}function Yi(){En&&(ii.cancel(hi),En=null)}function ho(mi){mi.preventDefault(),hr=!0,Yi(),Ii.forEach(function(Fi){Fi()})}function Ao(mi){Ge.getError(),hr=!1,nr.restore(),Rn.restore(),Br.restore(),Qr.restore(),xr.restore(),ar.restore(),cr.restore(),Vr&&Vr.restore(),an.procs.refresh(),Ci(),Si.forEach(function(Fi){Fi()})}var Ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Ki&&vn&&(vn.addEventListener(kp,ho,!1),vn.addEventListener(Lp,Ao,!1));function ns(){hn.length=0,Yi(),!Ki&&vn&&(vn.removeEventListener(kp,ho),vn.removeEventListener(Lp,Ao)),Rn.clear(),ar.clear(),xr.clear(),cr.clear(),Qr.clear(),Sn.clear(),Br.clear(),Vr&&Vr.clear(),yn.forEach(function(mi){mi()})}function Pa(mi){he(!!mi,"invalid args to regl({...})"),he.type(mi,"object","invalid args to regl({...})");function Fi(ot){var tt=ne({},ot);delete tt.uniforms,delete tt.attributes,delete tt.context,delete tt.vao,"stencil"in tt&&tt.stencil.op&&(tt.stencil.opBack=tt.stencil.opFront=tt.stencil.op,delete tt.stencil.op);function ct(me){if(me in tt){var Ke=tt[me];delete tt[me],Object.keys(Ke).forEach(function(Ae){tt[me+"."+Ae]=Ke[Ae]})}}return ct("blend"),ct("depth"),ct("cull"),ct("stencil"),ct("polygonOffset"),ct("scissor"),ct("sample"),"vao"in ot&&(tt.vao=ot.vao),tt}function Da(ot,tt){var ct={},me={};return Object.keys(ot).forEach(function(Ke){var Ae=ot[Ke];if(Hn.isDynamic(Ae)){me[Ke]=Hn.unbox(Ae,Ke);return}else if(tt&&Array.isArray(Ae)){for(var At=0;At<Ae.length;++At)if(Hn.isDynamic(Ae[At])){me[Ke]=Hn.unbox(Ae,Ke);return}}ct[Ke]=Ae}),{dynamic:me,static:ct}}var Bs=Da(mi.context||{},!0),Ss=Da(mi.uniforms||{},!0),De=Da(mi.attributes||{},!1),er=Da(Fi(mi),!1),Ft={gpuTime:0,cpuTime:0,count:0},Pn=an.compile(er,De,Ss,Bs,Ft),Vi=Pn.draw,we=Pn.batch,de=Pn.scope,Qe=[];function Pt(ot){for(;Qe.length<ot;)Qe.push(null);return Qe}function Kt(ot,tt){var ct;if(hr&&he.raise("context lost"),typeof ot=="function")return de.call(this,null,ot,0);if(typeof tt=="function")if(typeof ot=="number")for(ct=0;ct<ot;++ct)de.call(this,null,tt,ct);else if(Array.isArray(ot))for(ct=0;ct<ot.length;++ct)de.call(this,ot[ct],tt,ct);else return de.call(this,ot,tt,0);else if(typeof ot=="number"){if(ot>0)return we.call(this,Pt(ot|0),ot|0)}else if(Array.isArray(ot)){if(ot.length)return we.call(this,ot,ot.length)}else return Vi.call(this,ot)}return ne(Kt,{stats:Ft,destroy:function(){Pn.destroy()}})}var Xo=ar.setFBO=Pa({framebuffer:Hn.define.call(null,Hh,"framebuffer")});function Ai(mi,Fi){var Da=0;an.procs.poll();var Bs=Fi.color;Bs&&(Ge.clearColor(+Bs[0]||0,+Bs[1]||0,+Bs[2]||0,+Bs[3]||0),Da|=Rp),"depth"in Fi&&(Ge.clearDepth(+Fi.depth),Da|=Sv),"stencil"in Fi&&(Ge.clearStencil(Fi.stencil|0),Da|=Cv),he(!!Da,"called regl.clear with no buffer specified"),Ge.clear(Da)}function aa(mi){if(he(typeof mi=="object"&&mi,"regl.clear() takes an object as input"),"framebuffer"in mi)if(mi.framebuffer&&mi.framebuffer_reglType==="framebufferCube")for(var Fi=0;Fi<6;++Fi)Xo(ne({framebuffer:mi.framebuffer.faces[Fi]},mi),Ai);else Xo(mi,Ai);else Ai(null,mi)}function _o(mi){he.type(mi,"function","regl.frame() callback must be a function"),hn.push(mi);function Fi(){var Da=Kl(hn,mi);he(Da>=0,"cannot cancel a frame twice");function Bs(){var Ss=Kl(hn,Bs);hn[Ss]=hn[hn.length-1],hn.length-=1,hn.length<=0&&Yi()}hn[Da]=Bs}return Ci(),{cancel:Fi}}function Fs(){var mi=Wr.viewport,Fi=Wr.scissor_box;mi[0]=mi[1]=Fi[0]=Fi[1]=0,rn.viewportWidth=rn.framebufferWidth=rn.drawingBufferWidth=mi[2]=Fi[2]=Ge.drawingBufferWidth,rn.viewportHeight=rn.framebufferHeight=rn.drawingBufferHeight=mi[3]=Fi[3]=Ge.drawingBufferHeight}function xo(){rn.tick+=1,rn.time=is(),Fs(),an.procs.poll()}function ji(){Qr.refresh(),Fs(),an.procs.refresh(),Vr&&Vr.update()}function is(){return(Wi()-Xr)/1e3}ji();function Ea(mi,Fi){he.type(Fi,"function","listener callback must be a function");var Da;switch(mi){case"frame":return _o(Fi);case"lost":Da=Ii;break;case"restore":Da=Si;break;case"destroy":Da=yn;break;default:he.raise("invalid event, must be one of frame,lost,restore,destroy")}return Da.push(Fi),{cancel:function(){for(var Ss=0;Ss<Da.length;++Ss)if(Da[Ss]===Fi){Da[Ss]=Da[Da.length-1],Da.pop();return}}}}var zo=ne(Pa,{clear:aa,prop:Hn.define.bind(null,Hh),context:Hn.define.bind(null,vr),this:Hn.define.bind(null,kd),draw:Pa({}),buffer:function(Fi){return Br.create(Fi,_h,!1,!1)},elements:function(Fi){return Sn.create(Fi,!1)},texture:Qr.create2D,cube:Qr.createCube,renderbuffer:xr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:cr.createVAO,attributes:Vt,frame:_o,on:Ea,limits:Ht,hasExtension:function(Fi){return Ht.extensions.indexOf(Fi.toLowerCase())>=0},read:ln,destroy:ns,_gl:Ge,_refresh:ji,poll:function(){xo(),Vr&&Vr.update()},now:is,stats:wr});return ae.onDone(null,zo),zo}return Yt})},Sk89:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.postConstruct=void 0;var W=O("MON2"),re=O("xfSm"),ne=O("GXnB");function j(){return function(m,U,G){var Te=new ne.Metadata(re.POST_CONSTRUCT,U);if(Reflect.hasOwnMetadata(re.POST_CONSTRUCT,m.constructor))throw new Error(W.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(re.POST_CONSTRUCT,Te,m.constructor)}}K.postConstruct=j},Sq3C:function(He,K,O){var W=O("sKgW"),re=O("zoYe"),ne=O("wy8a"),j=O("quyA"),m=O("Z1HP"),U=O("Em2t"),G=Math.ceil;function Te(xe,Me){Me=Me===void 0?" ":re(Me);var Ee=Me.length;if(Ee<2)return Ee?W(Me,xe):Me;var Mt=W(Me,G(xe/m(Me)));return j(Me)?ne(U(Mt),0,xe).join(""):Mt.slice(0,xe)}He.exports=Te},Sxd8:function(He,K,O){var W=O("ZCgT");function re(ne){var j=W(ne),m=j%1;return j===j?m?j-m:j:0}He.exports=re},TIQr:function(He,K,O){"use strict";He.exports=re,He.exports.default=re;var W=1e20;function re(G,Te,xe,Me,Ee,Mt){this.fontSize=G||24,this.buffer=Te===void 0?3:Te,this.cutoff=Me||.25,this.fontFamily=Ee||"sans-serif",this.fontWeight=Mt||"normal",this.radius=xe||8;var at=this.size=this.fontSize+this.buffer*2,ht=at+this.buffer*2,vt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;vt?this.canvas=my.createOffscreenCanvas(at,at,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=at),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(ht*ht),this.gridInner=new Float64Array(ht*ht),this.f=new Float64Array(ht),this.z=new Float64Array(ht+1),this.v=new Uint16Array(ht),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,vt?this.middle=Math.round(at/2*1):this.middle=Math.round(at/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ne(G,Te,xe,Me,Ee,Mt,at){Mt.fill(W,0,Te*xe),at.fill(0,0,Te*xe);for(var ht=(Te-Me)/2,vt=0;vt<Ee;vt++)for(var _t=0;_t<Me;_t++){var Ve=(vt+ht)*Te+_t+ht,xt=G.data[4*(vt*Me+_t)+3]/255;if(xt===1)Mt[Ve]=0,at[Ve]=W;else if(xt===0)Mt[Ve]=W,at[Ve]=0;else{var st=Math.max(0,.5-xt),it=Math.max(0,xt-.5);Mt[Ve]=st*st,at[Ve]=it*it}}}function j(G,Te,xe,Me,Ee,Mt,at){for(var ht=0;ht<Te*xe;ht++){var vt=Math.sqrt(Me[ht])-Math.sqrt(Ee[ht]);G[ht]=Math.round(255-255*(vt/Mt+at))}}re.prototype._draw=function(G,Te){var xe=this.ctx.measureText(G),Me=xe.width,Ee=2*this.buffer,Mt,at,ht,vt,_t,Ve,xt,st;Te&&this.useMetrics?(_t=Math.floor(xe.actualBoundingBoxAscent),st=this.buffer+Math.ceil(xe.actualBoundingBoxAscent),Ve=this.buffer,xt=this.buffer,at=Math.min(this.size,Math.ceil(xe.actualBoundingBoxRight-xe.actualBoundingBoxLeft)),vt=Math.min(this.size-Ve,Math.ceil(xe.actualBoundingBoxAscent+xe.actualBoundingBoxDescent)),Mt=at+Ee,ht=vt+Ee,this.ctx.textBaseline="alphabetic"):(Mt=at=this.size,ht=vt=this.size,_t=19*this.fontSize/24,Ve=xt=0,st=this.middle,this.ctx.textBaseline="middle");var it;at&&vt&&(this.ctx.clearRect(xt,Ve,at,vt),this.ctx.fillText(G,this.buffer,st),it=this.ctx.getImageData(xt,Ve,at,vt));var N=new Uint8ClampedArray(Mt*ht);return ne(it,Mt,ht,at,vt,this.gridOuter,this.gridInner),m(this.gridOuter,Mt,ht,this.f,this.v,this.z),m(this.gridInner,Mt,ht,this.f,this.v,this.z),j(N,Mt,ht,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:N,metrics:{width:at,height:vt,sdfWidth:Mt,sdfHeight:ht,top:_t,left:0,advance:Me}}},re.prototype.draw=function(G){return this._draw(G,!1).data},re.prototype.drawWithMetrics=function(G){return this._draw(G,!0)};function m(G,Te,xe,Me,Ee,Mt){for(var at=0;at<Te;at++)U(G,at,Te,xe,Me,Ee,Mt);for(var ht=0;ht<xe;ht++)U(G,ht*Te,1,Te,Me,Ee,Mt)}function U(G,Te,xe,Me,Ee,Mt,at){var ht,vt,_t,Ve;for(Mt[0]=0,at[0]=-W,at[1]=W,ht=0;ht<Me;ht++)Ee[ht]=G[Te+ht*xe];for(ht=1,vt=0,_t=0;ht<Me;ht++){do Ve=Mt[vt],_t=(Ee[ht]-Ee[Ve]+ht*ht-Ve*Ve)/(ht-Ve)/2;while(_t<=at[vt]&&--vt>-1);vt++,Mt[vt]=ht,at[vt]=_t,at[vt+1]=W}for(ht=0,vt=0;ht<Me;ht++){for(;at[vt+1]<ht;)vt++;Ve=Mt[vt],G[Te+ht*xe]=Ee[Ve]+(ht-Ve)*(ht-Ve)}}},TKrE:function(He,K,O){var W=O("qRkn"),re=O("dt0z"),ne=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,j="\\u0300-\\u036f",m="\\ufe20-\\ufe2f",U="\\u20d0-\\u20ff",G=j+m+U,Te="["+G+"]",xe=RegExp(Te,"g");function Me(Ee){return Ee=re(Ee),Ee&&Ee.replace(ne,W).replace(xe,"")}He.exports=Me},"U+yc":function(He,K){function O(W,re,ne,j,m){var U={};return Object.keys(j).forEach(function(G){U[G]=j[G]}),U.enumerable=!!U.enumerable,U.configurable=!!U.configurable,("value"in U||U.initializer)&&(U.writable=!0),U=ne.slice().reverse().reduce(function(G,Te){return Te(W,re,G)||G},U),m&&U.initializer!==void 0&&(U.value=U.initializer?U.initializer.call(m):void 0,U.initializer=void 0),U.initializer===void 0&&(Object.defineProperty(W,re,U),U=null),U}He.exports=O,He.exports.__esModule=!0,He.exports.default=He.exports},UB5X:function(He,K,O){var W=O("NykK"),re=O("ExA7"),ne="[object Number]";function j(m){return typeof m=="number"||re(m)&&W(m)==ne}He.exports=j},Ucsi:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0});var W=Symbol.for("INJECTION");function re(G,Te,xe,Me){function Ee(){return Me&&!Reflect.hasMetadata(W,this,Te)&&Reflect.defineMetadata(W,xe(),this,Te),Reflect.hasMetadata(W,this,Te)?Reflect.getMetadata(W,this,Te):xe()}function Mt(at){Reflect.defineMetadata(W,at,this,Te)}Object.defineProperty(G,Te,{configurable:!0,enumerable:!0,get:Ee,set:Mt})}function ne(G,Te){return function(xe){return function(Me,Ee){var Mt=function(){return G.get(xe)};re(Me,Ee,Mt,Te)}}}K.makePropertyInjectDecorator=ne;function j(G,Te){return function(xe,Me){return function(Ee,Mt){var at=function(){return G.getNamed(xe,Me)};re(Ee,Mt,at,Te)}}}K.makePropertyInjectNamedDecorator=j;function m(G,Te){return function(xe,Me,Ee){return function(Mt,at){var ht=function(){return G.getTagged(xe,Me,Ee)};re(Mt,at,ht,Te)}}}K.makePropertyInjectTaggedDecorator=m;function U(G,Te){return function(xe){return function(Me,Ee){var Mt=function(){return G.getAll(xe)};re(Me,Ee,Mt,Te)}}}K.makePropertyMultiInjectDecorator=U},VOtZ:function(He,K,O){var W=O("juv8"),re=O("MvSz");function ne(j,m){return W(j,re(j),m)}He.exports=ne},VmRL:function(He,K,O){"use strict";He.exports=W,He.exports.default=W;function W(fe,Pe,Se){Se=Se||2;var lt=Pe&&Pe.length,ut=lt?Pe[0]*Se:fe.length,Ot=re(fe,0,ut,Se,!0),wt=[];if(!Ot||Ot.next===Ot.prev)return wt;var sr,Or,Nt,Tt,It,$t,gr;if(lt&&(Ot=xe(fe,Pe,Ot,Se)),fe.length>80*Se){sr=Nt=fe[0],Or=Tt=fe[1];for(var qt=Se;qt<ut;qt+=Se)It=fe[qt],$t=fe[qt+1],It<sr&&(sr=It),$t<Or&&(Or=$t),It>Nt&&(Nt=It),$t>Tt&&(Tt=$t);gr=Math.max(Nt-sr,Tt-Or),gr=gr!==0?1/gr:0}return j(Ot,wt,Se,sr,Or,gr),wt}function re(fe,Pe,Se,lt,ut){var Ot,wt;if(ut===br(fe,Pe,Se,lt)>0)for(Ot=Pe;Ot<Se;Ot+=lt)wt=ir(Ot,fe[Ot],fe[Ot+1],wt);else for(Ot=Se-lt;Ot>=Pe;Ot-=lt)wt=ir(Ot,fe[Ot],fe[Ot+1],wt);return wt&&N(wt,wt.next)&&(Fr(wt),wt=wt.next),wt}function ne(fe,Pe){if(!fe)return fe;Pe||(Pe=fe);var Se=fe,lt;do if(lt=!1,!Se.steiner&&(N(Se,Se.next)||it(Se.prev,Se,Se.next)===0)){if(Fr(Se),Se=Pe=Se.prev,Se===Se.next)break;lt=!0}else Se=Se.next;while(lt||Se!==Pe);return Pe}function j(fe,Pe,Se,lt,ut,Ot,wt){if(!!fe){!wt&&Ot&&ht(fe,lt,ut,Ot);for(var sr=fe,Or,Nt;fe.prev!==fe.next;){if(Or=fe.prev,Nt=fe.next,Ot?U(fe,lt,ut,Ot):m(fe)){Pe.push(Or.i/Se),Pe.push(fe.i/Se),Pe.push(Nt.i/Se),Fr(fe),fe=Nt.next,sr=Nt.next;continue}if(fe=Nt,fe===sr){wt?wt===1?(fe=G(ne(fe),Pe,Se),j(fe,Pe,Se,lt,ut,Ot,2)):wt===2&&Te(fe,Pe,Se,lt,ut,Ot):j(ne(fe),Pe,Se,lt,ut,Ot,1);break}}}}function m(fe){var Pe=fe.prev,Se=fe,lt=fe.next;if(it(Pe,Se,lt)>=0)return!1;for(var ut=fe.next.next;ut!==fe.prev;){if(xt(Pe.x,Pe.y,Se.x,Se.y,lt.x,lt.y,ut.x,ut.y)&&it(ut.prev,ut,ut.next)>=0)return!1;ut=ut.next}return!0}function U(fe,Pe,Se,lt){var ut=fe.prev,Ot=fe,wt=fe.next;if(it(ut,Ot,wt)>=0)return!1;for(var sr=ut.x<Ot.x?ut.x<wt.x?ut.x:wt.x:Ot.x<wt.x?Ot.x:wt.x,Or=ut.y<Ot.y?ut.y<wt.y?ut.y:wt.y:Ot.y<wt.y?Ot.y:wt.y,Nt=ut.x>Ot.x?ut.x>wt.x?ut.x:wt.x:Ot.x>wt.x?Ot.x:wt.x,Tt=ut.y>Ot.y?ut.y>wt.y?ut.y:wt.y:Ot.y>wt.y?Ot.y:wt.y,It=_t(sr,Or,Pe,Se,lt),$t=_t(Nt,Tt,Pe,Se,lt),gr=fe.prevZ,qt=fe.nextZ;gr&&gr.z>=It&&qt&&qt.z<=$t;){if(gr!==fe.prev&&gr!==fe.next&&xt(ut.x,ut.y,Ot.x,Ot.y,wt.x,wt.y,gr.x,gr.y)&&it(gr.prev,gr,gr.next)>=0||(gr=gr.prevZ,qt!==fe.prev&&qt!==fe.next&&xt(ut.x,ut.y,Ot.x,Ot.y,wt.x,wt.y,qt.x,qt.y)&&it(qt.prev,qt,qt.next)>=0))return!1;qt=qt.nextZ}for(;gr&&gr.z>=It;){if(gr!==fe.prev&&gr!==fe.next&&xt(ut.x,ut.y,Ot.x,Ot.y,wt.x,wt.y,gr.x,gr.y)&&it(gr.prev,gr,gr.next)>=0)return!1;gr=gr.prevZ}for(;qt&&qt.z<=$t;){if(qt!==fe.prev&&qt!==fe.next&&xt(ut.x,ut.y,Ot.x,Ot.y,wt.x,wt.y,qt.x,qt.y)&&it(qt.prev,qt,qt.next)>=0)return!1;qt=qt.nextZ}return!0}function G(fe,Pe,Se){var lt=fe;do{var ut=lt.prev,Ot=lt.next.next;!N(ut,Ot)&&Re(ut,lt,lt.next,Ot)&&Oe(ut,Ot)&&Oe(Ot,ut)&&(Pe.push(ut.i/Se),Pe.push(lt.i/Se),Pe.push(Ot.i/Se),Fr(lt),Fr(lt.next),lt=fe=Ot),lt=lt.next}while(lt!==fe);return ne(lt)}function Te(fe,Pe,Se,lt,ut,Ot){var wt=fe;do{for(var sr=wt.next.next;sr!==wt.prev;){if(wt.i!==sr.i&&st(wt,sr)){var Or=Zt(wt,sr);wt=ne(wt,wt.next),Or=ne(Or,Or.next),j(wt,Pe,Se,lt,ut,Ot),j(Or,Pe,Se,lt,ut,Ot);return}sr=sr.next}wt=wt.next}while(wt!==fe)}function xe(fe,Pe,Se,lt){var ut=[],Ot,wt,sr,Or,Nt;for(Ot=0,wt=Pe.length;Ot<wt;Ot++)sr=Pe[Ot]*lt,Or=Ot<wt-1?Pe[Ot+1]*lt:fe.length,Nt=re(fe,sr,Or,lt,!1),Nt===Nt.next&&(Nt.steiner=!0),ut.push(Ve(Nt));for(ut.sort(Me),Ot=0;Ot<ut.length;Ot++)Se=Ee(ut[Ot],Se),Se=ne(Se,Se.next);return Se}function Me(fe,Pe){return fe.x-Pe.x}function Ee(fe,Pe){var Se=Mt(fe,Pe);if(!Se)return Pe;var lt=Zt(Se,fe),ut=ne(Se,Se.next);return ne(lt,lt.next),Pe===Se?ut:Pe}function Mt(fe,Pe){var Se=Pe,lt=fe.x,ut=fe.y,Ot=-Infinity,wt;do{if(ut<=Se.y&&ut>=Se.next.y&&Se.next.y!==Se.y){var sr=Se.x+(ut-Se.y)*(Se.next.x-Se.x)/(Se.next.y-Se.y);if(sr<=lt&&sr>Ot){if(Ot=sr,sr===lt){if(ut===Se.y)return Se;if(ut===Se.next.y)return Se.next}wt=Se.x<Se.next.x?Se:Se.next}}Se=Se.next}while(Se!==Pe);if(!wt)return null;if(lt===Ot)return wt;var Or=wt,Nt=wt.x,Tt=wt.y,It=Infinity,$t;Se=wt;do lt>=Se.x&&Se.x>=Nt&&lt!==Se.x&&xt(ut<Tt?lt:Ot,ut,Nt,Tt,ut<Tt?Ot:lt,ut,Se.x,Se.y)&&($t=Math.abs(ut-Se.y)/(lt-Se.x),Oe(Se,fe)&&($t<It||$t===It&&(Se.x>wt.x||Se.x===wt.x&&at(wt,Se)))&&(wt=Se,It=$t)),Se=Se.next;while(Se!==Or);return wt}function at(fe,Pe){return it(fe.prev,fe,Pe.prev)<0&&it(Pe.next,fe,fe.next)<0}function ht(fe,Pe,Se,lt){var ut=fe;do ut.z===null&&(ut.z=_t(ut.x,ut.y,Pe,Se,lt)),ut.prevZ=ut.prev,ut.nextZ=ut.next,ut=ut.next;while(ut!==fe);ut.prevZ.nextZ=null,ut.prevZ=null,vt(ut)}function vt(fe){var Pe,Se,lt,ut,Ot,wt,sr,Or,Nt=1;do{for(Se=fe,fe=null,Ot=null,wt=0;Se;){for(wt++,lt=Se,sr=0,Pe=0;Pe<Nt&&(sr++,lt=lt.nextZ,!!lt);Pe++);for(Or=Nt;sr>0||Or>0&&lt;)sr!==0&&(Or===0||!lt||Se.z<=lt.z)?(ut=Se,Se=Se.nextZ,sr--):(ut=lt,lt=lt.nextZ,Or--),Ot?Ot.nextZ=ut:fe=ut,ut.prevZ=Ot,Ot=ut;Se=lt}Ot.nextZ=null,Nt*=2}while(wt>1);return fe}function _t(fe,Pe,Se,lt,ut){return fe=32767*(fe-Se)*ut,Pe=32767*(Pe-lt)*ut,fe=(fe|fe<<8)&16711935,fe=(fe|fe<<4)&252645135,fe=(fe|fe<<2)&858993459,fe=(fe|fe<<1)&1431655765,Pe=(Pe|Pe<<8)&16711935,Pe=(Pe|Pe<<4)&252645135,Pe=(Pe|Pe<<2)&858993459,Pe=(Pe|Pe<<1)&1431655765,fe|Pe<<1}function Ve(fe){var Pe=fe,Se=fe;do(Pe.x<Se.x||Pe.x===Se.x&&Pe.y<Se.y)&&(Se=Pe),Pe=Pe.next;while(Pe!==fe);return Se}function xt(fe,Pe,Se,lt,ut,Ot,wt,sr){return(ut-wt)*(Pe-sr)-(fe-wt)*(Ot-sr)>=0&&(fe-wt)*(lt-sr)-(Se-wt)*(Pe-sr)>=0&&(Se-wt)*(Ot-sr)-(ut-wt)*(lt-sr)>=0}function st(fe,Pe){return fe.next.i!==Pe.i&&fe.prev.i!==Pe.i&&!Wt(fe,Pe)&&(Oe(fe,Pe)&&Oe(Pe,fe)&&Bt(fe,Pe)&&(it(fe.prev,fe,Pe.prev)||it(fe,Pe.prev,Pe))||N(fe,Pe)&&it(fe.prev,fe,fe.next)>0&&it(Pe.prev,Pe,Pe.next)>0)}function it(fe,Pe,Se){return(Pe.y-fe.y)*(Se.x-Pe.x)-(Pe.x-fe.x)*(Se.y-Pe.y)}function N(fe,Pe){return fe.x===Pe.x&&fe.y===Pe.y}function Re(fe,Pe,Se,lt){var ut=Pr(it(fe,Pe,Se)),Ot=Pr(it(fe,Pe,lt)),wt=Pr(it(Se,lt,fe)),sr=Pr(it(Se,lt,Pe));return!!(ut!==Ot&&wt!==sr||ut===0&&Nr(fe,Se,Pe)||Ot===0&&Nr(fe,lt,Pe)||wt===0&&Nr(Se,fe,lt)||sr===0&&Nr(Se,Pe,lt))}function Nr(fe,Pe,Se){return Pe.x<=Math.max(fe.x,Se.x)&&Pe.x>=Math.min(fe.x,Se.x)&&Pe.y<=Math.max(fe.y,Se.y)&&Pe.y>=Math.min(fe.y,Se.y)}function Pr(fe){return fe>0?1:fe<0?-1:0}function Wt(fe,Pe){var Se=fe;do{if(Se.i!==fe.i&&Se.next.i!==fe.i&&Se.i!==Pe.i&&Se.next.i!==Pe.i&&Re(Se,Se.next,fe,Pe))return!0;Se=Se.next}while(Se!==fe);return!1}function Oe(fe,Pe){return it(fe.prev,fe,fe.next)<0?it(fe,Pe,fe.next)>=0&&it(fe,fe.prev,Pe)>=0:it(fe,Pe,fe.prev)<0||it(fe,fe.next,Pe)<0}function Bt(fe,Pe){var Se=fe,lt=!1,ut=(fe.x+Pe.x)/2,Ot=(fe.y+Pe.y)/2;do Se.y>Ot!=Se.next.y>Ot&&Se.next.y!==Se.y&&ut<(Se.next.x-Se.x)*(Ot-Se.y)/(Se.next.y-Se.y)+Se.x&&(lt=!lt),Se=Se.next;while(Se!==fe);return lt}function Zt(fe,Pe){var Se=new qr(fe.i,fe.x,fe.y),lt=new qr(Pe.i,Pe.x,Pe.y),ut=fe.next,Ot=Pe.prev;return fe.next=Pe,Pe.prev=fe,Se.next=ut,ut.prev=Se,lt.next=Se,Se.prev=lt,Ot.next=lt,lt.prev=Ot,lt}function ir(fe,Pe,Se,lt){var ut=new qr(fe,Pe,Se);return lt?(ut.next=lt.next,ut.prev=lt,lt.next.prev=ut,lt.next=ut):(ut.prev=ut,ut.next=ut),ut}function Fr(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function qr(fe,Pe,Se){this.i=fe,this.x=Pe,this.y=Se,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}W.deviation=function(fe,Pe,Se,lt){var ut=Pe&&Pe.length,Ot=ut?Pe[0]*Se:fe.length,wt=Math.abs(br(fe,0,Ot,Se));if(ut)for(var sr=0,Or=Pe.length;sr<Or;sr++){var Nt=Pe[sr]*Se,Tt=sr<Or-1?Pe[sr+1]*Se:fe.length;wt-=Math.abs(br(fe,Nt,Tt,Se))}var It=0;for(sr=0;sr<lt.length;sr+=3){var $t=lt[sr]*Se,gr=lt[sr+1]*Se,qt=lt[sr+2]*Se;It+=Math.abs((fe[$t]-fe[qt])*(fe[gr+1]-fe[$t+1])-(fe[$t]-fe[gr])*(fe[qt+1]-fe[$t+1]))}return wt===0&&It===0?0:Math.abs((It-wt)/wt)};function br(fe,Pe,Se,lt){for(var ut=0,Ot=Pe,wt=Se-lt;Ot<Se;Ot+=lt)ut+=(fe[wt]-fe[Ot])*(fe[Ot+1]+fe[wt+1]),wt=Ot;return ut}W.flatten=function(fe){for(var Pe=fe[0][0].length,Se={vertices:[],holes:[],dimensions:Pe},lt=0,ut=0;ut<fe.length;ut++){for(var Ot=0;Ot<fe[ut].length;Ot++)for(var wt=0;wt<Pe;wt++)Se.vertices.push(fe[ut][Ot][wt]);ut>0&&(lt+=fe[ut-1].length,Se.holes.push(lt))}return Se}},Wnft:function(He,K,O){He.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},WwFo:function(He,K,O){var W=O("juv8"),re=O("7GkX");function ne(j,m){return j&&W(m,re(m),j)}He.exports=ne},XYm9:function(He,K,O){var W=O("+K+b");function re(ne,j){var m=j?W(ne.buffer):ne.buffer;return new ne.constructor(m,ne.byteOffset,ne.byteLength)}He.exports=re},"Xt/L":function(He,K){function O(W,re,ne){for(var j=-1,m=W==null?0:W.length;++j<m;)if(ne(re,W[j]))return!0;return!1}He.exports=O},Yk9n:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.inject=K.LazyServiceIdentifer=void 0;var W=O("MON2"),re=O("xfSm"),ne=O("GXnB"),j=O("Ztfv"),m=function(){function G(Te){this._cb=Te}return G.prototype.unwrap=function(){return this._cb()},G}();K.LazyServiceIdentifer=m;function U(G){return function(Te,xe,Me){if(G===void 0)throw new Error(W.UNDEFINED_INJECT_ANNOTATION(Te.name));var Ee=new ne.Metadata(re.INJECT_TAG,G);typeof Me=="number"?j.tagParameter(Te,xe,Me,Ee):j.tagProperty(Te,xe,Ee)}}K.inject=U},Z1HP:function(He,K,O){var W=O("ycre"),re=O("quyA"),ne=O("q4HE");function j(m){return re(m)?ne(m):W(m)}He.exports=j},ZCgT:function(He,K,O){var W=O("tLB3"),re=1/0,ne=17976931348623157e292;function j(m){if(!m)return m===0?m:0;if(m=W(m),m===re||m===-re){var U=m<0?-1:1;return U*ne}return m===m?m:0}He.exports=j},ZK94:function(He,K){He.exports.RADIUS=6378137,He.exports.FLATTENING=1/298.257223563,He.exports.POLAR_RADIUS=63567523142e-4},Ztfv:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.tagProperty=K.tagParameter=K.decorate=void 0;var W=O("MON2"),re=O("xfSm");function ne(xe,Me,Ee,Mt){var at=re.TAGGED;m(at,xe,Me,Mt,Ee)}K.tagParameter=ne;function j(xe,Me,Ee){var Mt=re.TAGGED_PROP;m(Mt,xe.constructor,Me,Ee)}K.tagProperty=j;function m(xe,Me,Ee,Mt,at){var ht={},vt=typeof at=="number",_t=at!==void 0&&vt?at.toString():Ee;if(vt&&Ee!==void 0)throw new Error(W.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(xe,Me)&&(ht=Reflect.getMetadata(xe,Me));var Ve=ht[_t];if(!Array.isArray(Ve))Ve=[];else for(var xt=0,st=Ve;xt<st.length;xt++){var it=st[xt];if(it.key===Mt.key)throw new Error(W.DUPLICATED_METADATA+" "+it.key.toString())}Ve.push(Mt),ht[_t]=Ve,Reflect.defineMetadata(xe,ht,Me)}function U(xe,Me){Reflect.decorate(xe,Me)}function G(xe,Me){return function(Ee,Mt){Me(Ee,Mt,xe)}}function Te(xe,Me,Ee){typeof Ee=="number"?U([G(Ee,xe)],Me):typeof Ee=="string"?Reflect.decorate([xe],Me,Ee):U([xe],Me)}K.decorate=Te},ZzCi:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.named=void 0;var W=O("xfSm"),re=O("GXnB"),ne=O("Ztfv");function j(m){return function(U,G,Te){var xe=new re.Metadata(W.NAMED_TAG,m);typeof Te=="number"?ne.tagParameter(U,G,Te,xe):ne.tagProperty(U,G,xe)}}K.named=j},a5Wf:function(He,K,O){"use strict";O.r(K);var W={};O.r(W),O.d(W,"getContainer",function(){return uc}),O.d(W,"trim",function(){return Xl}),O.d(W,"splitWords",function(){return yf}),O.d(W,"create",function(){return f}),O.d(W,"remove",function(){return c}),O.d(W,"addClass",function(){return d}),O.d(W,"removeClass",function(){return E}),O.d(W,"hasClass",function(){return A}),O.d(W,"setClass",function(){return I}),O.d(W,"getClass",function(){return k}),O.d(W,"empty",function(){return V}),O.d(W,"setTransform",function(){return ce}),O.d(W,"triggerResize",function(){return ve}),O.d(W,"printCanvas",function(){return ye}),O.d(W,"getViewPortScale",function(){return ze}),O.d(W,"DPR",function(){return Fe});var re={};O.r(re),O.d(re,"sum",function(){return vh}),O.d(re,"max",function(){return bd}),O.d(re,"min",function(){return Ed}),O.d(re,"mean",function(){return Sd}),O.d(re,"mode",function(){return Sf}),O.d(re,"statMap",function(){return Cd}),O.d(re,"getColumn",function(){return No}),O.d(re,"getSatByColumn",function(){return zh});var ne={};O.r(ne),O.d(ne,"create",function(){return Ea}),O.d(ne,"clone",function(){return zo}),O.d(ne,"copy",function(){return mi}),O.d(ne,"identity",function(){return Fi}),O.d(ne,"fromValues",function(){return Da}),O.d(ne,"set",function(){return Bs}),O.d(ne,"transpose",function(){return Ss}),O.d(ne,"invert",function(){return De}),O.d(ne,"adjoint",function(){return er}),O.d(ne,"determinant",function(){return Ft}),O.d(ne,"multiply",function(){return Pn}),O.d(ne,"rotate",function(){return Vi}),O.d(ne,"scale",function(){return we}),O.d(ne,"fromRotation",function(){return de}),O.d(ne,"fromScaling",function(){return Qe}),O.d(ne,"str",function(){return Pt}),O.d(ne,"frob",function(){return Kt}),O.d(ne,"LDU",function(){return ot}),O.d(ne,"add",function(){return tt}),O.d(ne,"subtract",function(){return ct}),O.d(ne,"exactEquals",function(){return me}),O.d(ne,"equals",function(){return Ke}),O.d(ne,"multiplyScalar",function(){return Ae}),O.d(ne,"multiplyScalarAndAdd",function(){return At}),O.d(ne,"mul",function(){return zt}),O.d(ne,"sub",function(){return Mr});var j={};O.r(j),O.d(j,"create",function(){return on}),O.d(j,"clone",function(){return sn}),O.d(j,"copy",function(){return Cn}),O.d(j,"fromValues",function(){return en}),O.d(j,"set",function(){return $n}),O.d(j,"identity",function(){return On}),O.d(j,"transpose",function(){return jn}),O.d(j,"invert",function(){return Vn}),O.d(j,"adjoint",function(){return Xn}),O.d(j,"determinant",function(){return di}),O.d(j,"multiply",function(){return pa}),O.d(j,"translate",function(){return Po}),O.d(j,"scale",function(){return Xs}),O.d(j,"rotate",function(){return ql}),O.d(j,"rotateX",function(){return Fa}),O.d(j,"rotateY",function(){return na}),O.d(j,"rotateZ",function(){return hl}),O.d(j,"fromTranslation",function(){return qu}),O.d(j,"fromScaling",function(){return Dp}),O.d(j,"fromRotation",function(){return pl}),O.d(j,"fromXRotation",function(){return Fp}),O.d(j,"fromYRotation",function(){return wv}),O.d(j,"fromZRotation",function(){return xh}),O.d(j,"fromRotationTranslation",function(){return Kf}),O.d(j,"fromQuat2",function(){return wm}),O.d(j,"getTranslation",function(){return as}),O.d(j,"getScaling",function(){return Wh}),O.d(j,"getRotation",function(){return Af}),O.d(j,"fromRotationTranslationScale",function(){return Ld}),O.d(j,"fromRotationTranslationScaleOrigin",function(){return Dd}),O.d(j,"fromQuat",function(){return Av}),O.d(j,"frustum",function(){return Zh}),O.d(j,"perspectiveNO",function(){return Fc}),O.d(j,"perspective",function(){return Tv}),O.d(j,"perspectiveZO",function(){return Am}),O.d(j,"perspectiveFromFieldOfView",function(){return og}),O.d(j,"orthoNO",function(){return vs}),O.d(j,"ortho",function(){return qf}),O.d(j,"orthoZO",function(){return Tm}),O.d(j,"lookAt",function(){return a}),O.d(j,"targetTo",function(){return o}),O.d(j,"str",function(){return u}),O.d(j,"frob",function(){return p}),O.d(j,"add",function(){return y}),O.d(j,"subtract",function(){return b}),O.d(j,"multiplyScalar",function(){return S}),O.d(j,"multiplyScalarAndAdd",function(){return M}),O.d(j,"exactEquals",function(){return D}),O.d(j,"equals",function(){return B}),O.d(j,"mul",function(){return Z}),O.d(j,"sub",function(){return q});var m={};O.r(m),O.d(m,"create",function(){return ee}),O.d(m,"clone",function(){return _e}),O.d(m,"fromValues",function(){return Le}),O.d(m,"copy",function(){return Ie}),O.d(m,"set",function(){return Ye}),O.d(m,"add",function(){return Xe}),O.d(m,"subtract",function(){return gt}),O.d(m,"multiply",function(){return Dt}),O.d(m,"divide",function(){return Xt}),O.d(m,"ceil",function(){return yr}),O.d(m,"floor",function(){return or}),O.d(m,"min",function(){return Jr}),O.d(m,"max",function(){return tn}),O.d(m,"round",function(){return Gn}),O.d(m,"scale",function(){return ti}),O.d(m,"scaleAndAdd",function(){return Qn}),O.d(m,"distance",function(){return Nn}),O.d(m,"squaredDistance",function(){return wi}),O.d(m,"length",function(){return ui}),O.d(m,"squaredLength",function(){return ri}),O.d(m,"negate",function(){return ea}),O.d(m,"inverse",function(){return Ri}),O.d(m,"normalize",function(){return Aa}),O.d(m,"dot",function(){return _i}),O.d(m,"cross",function(){return oa}),O.d(m,"lerp",function(){return qa}),O.d(m,"random",function(){return Qa}),O.d(m,"transformMat2",function(){return bo}),O.d(m,"transformMat2d",function(){return Eo}),O.d(m,"transformMat3",function(){return Oo}),O.d(m,"transformMat4",function(){return Ns}),O.d(m,"rotate",function(){return Yo}),O.d(m,"angle",function(){return ou}),O.d(m,"zero",function(){return Cs}),O.d(m,"str",function(){return su}),O.d(m,"exactEquals",function(){return ms}),O.d(m,"equals",function(){return os}),O.d(m,"len",function(){return gs}),O.d(m,"sub",function(){return xa}),O.d(m,"mul",function(){return sa}),O.d(m,"div",function(){return ja}),O.d(m,"dist",function(){return Ja}),O.d(m,"sqrDist",function(){return uu}),O.d(m,"sqrLen",function(){return no}),O.d(m,"forEach",function(){return So});var U={};O.r(U),O.d(U,"create",function(){return zs}),O.d(U,"clone",function(){return da}),O.d(U,"length",function(){return Bc}),O.d(U,"fromValues",function(){return Dl}),O.d(U,"copy",function(){return hc}),O.d(U,"set",function(){return dl}),O.d(U,"add",function(){return Us}),O.d(U,"subtract",function(){return Nc}),O.d(U,"multiply",function(){return zc}),O.d(U,"divide",function(){return Uc}),O.d(U,"ceil",function(){return Bp}),O.d(U,"floor",function(){return jc}),O.d(U,"min",function(){return Np}),O.d(U,"max",function(){return zp}),O.d(U,"round",function(){return Xh}),O.d(U,"scale",function(){return Fd}),O.d(U,"scaleAndAdd",function(){return Up}),O.d(U,"distance",function(){return jp}),O.d(U,"squaredDistance",function(){return Tf}),O.d(U,"squaredLength",function(){return bh}),O.d(U,"negate",function(){return Vp}),O.d(U,"inverse",function(){return Yh}),O.d(U,"normalize",function(){return Qf}),O.d(U,"dot",function(){return $h}),O.d(U,"cross",function(){return Bd}),O.d(U,"lerp",function(){return Nd}),O.d(U,"hermite",function(){return Kh}),O.d(U,"bezier",function(){return zd}),O.d(U,"random",function(){return Ud}),O.d(U,"transformMat4",function(){return qh}),O.d(U,"transformMat3",function(){return jd}),O.d(U,"transformQuat",function(){return Gp}),O.d(U,"rotateX",function(){return Hp}),O.d(U,"rotateY",function(){return Wp}),O.d(U,"rotateZ",function(){return Qh}),O.d(U,"angle",function(){return Zp}),O.d(U,"zero",function(){return Jh}),O.d(U,"str",function(){return ep}),O.d(U,"exactEquals",function(){return Xp}),O.d(U,"equals",function(){return Mv}),O.d(U,"sub",function(){return Pv}),O.d(U,"mul",function(){return Mm}),O.d(U,"div",function(){return Ov}),O.d(U,"dist",function(){return Pm}),O.d(U,"sqrDist",function(){return Iv}),O.d(U,"len",function(){return Dy}),O.d(U,"sqrLen",function(){return sg}),O.d(U,"forEach",function(){return Yp});var G={};O.r(G),O.d(G,"create",function(){return Io}),O.d(G,"clone",function(){return pc}),O.d(G,"fromValues",function(){return ug}),O.d(G,"copy",function(){return Jf}),O.d(G,"set",function(){return Rv}),O.d(G,"add",function(){return Om}),O.d(G,"subtract",function(){return $p}),O.d(G,"multiply",function(){return dc}),O.d(G,"divide",function(){return Kp}),O.d(G,"ceil",function(){return qp}),O.d(G,"floor",function(){return Vd}),O.d(G,"min",function(){return Gd}),O.d(G,"max",function(){return kv}),O.d(G,"round",function(){return Im}),O.d(G,"scale",function(){return tp}),O.d(G,"scaleAndAdd",function(){return Rm}),O.d(G,"distance",function(){return Lv}),O.d(G,"squaredDistance",function(){return Dv}),O.d(G,"length",function(){return Fv}),O.d(G,"squaredLength",function(){return Bv}),O.d(G,"negate",function(){return vl}),O.d(G,"inverse",function(){return Hd}),O.d(G,"normalize",function(){return km}),O.d(G,"dot",function(){return Vc}),O.d(G,"cross",function(){return lg}),O.d(G,"lerp",function(){return Lm}),O.d(G,"random",function(){return Eh}),O.d(G,"transformMat4",function(){return Sh}),O.d(G,"transformQuat",function(){return rp}),O.d(G,"zero",function(){return np}),O.d(G,"str",function(){return ip}),O.d(G,"exactEquals",function(){return Dm}),O.d(G,"equals",function(){return Fm}),O.d(G,"sub",function(){return Bm}),O.d(G,"mul",function(){return Nm}),O.d(G,"div",function(){return Nv}),O.d(G,"dist",function(){return zv}),O.d(G,"sqrDist",function(){return Mf}),O.d(G,"len",function(){return zm}),O.d(G,"sqrLen",function(){return Uv}),O.d(G,"forEach",function(){return jv});var Te=O("IzEo"),xe=O("bx4M"),Me=O("14J3"),Ee=O("BMrR"),Mt=O("jCWc"),at=O("kPKH"),ht=O("fWQN"),vt=O("mtLc"),_t=O("yKVA"),Ve=O("879j"),xt=O("aHsQ"),st=O("sGsY"),it=O("9kvl"),N=O("q1tI"),Re=O.n(N),Nr=O("FRQA"),Pr=O("ZhIB"),Wt=O.n(Pr),Oe=O("yP6+"),Bt=O("0Owb");function Zt(e){var r=e.style;r.height="100%";var t=parseInt("".concat(getComputedStyle(e).height),10),n=parseInt("".concat(getComputedStyle(e).paddingTop),10)+parseInt("".concat(getComputedStyle(e).paddingBottom),10);return t-n}function ir(e){if(!e)return 0;var r=e,t=Zt(r),n=r.parentNode;return n&&(t=Zt(n)),t}function Fr(){return function(e){var r=function(t){Object(_t.a)(i,t);var n=Object(Ve.a)(i);function i(){var s;Object(ht.a)(this,i);for(var l=arguments.length,v=new Array(l),g=0;g<l;g++)v[g]=arguments[g];return s=n.call.apply(n,[this].concat(v)),s.state={computedHeight:0},s.root=null,s.handleRoot=function(x){s.root=x},s}return Object(vt.a)(i,[{key:"componentDidMount",value:function(){var l=this.props.height;if(!l&&this.root){var v=ir(this.root);this.setState({computedHeight:v}),v<1&&(v=ir(this.root),this.setState({computedHeight:v}))}}},{key:"render",value:function(){var l=this.props.height,v=this.state.computedHeight,g=l||v;return Re.a.createElement("div",{ref:this.handleRoot},g>0&&Re.a.createElement(e,Object(Bt.a)({},this.props,{height:g})))}}]),i}(Re.a.Component);return r}}var qr=Fr,br=O("gPzx"),fe=Oe.Guide.Arc,Pe=Oe.Guide.Html,Se=Oe.Guide.Line,lt=function(r){switch(r){case"2":return"\u5DEE";case"4":return"\u4E2D";case"6":return"\u826F";case"8":return"\u4F18";default:return""}};Oe.Shape.registerShape&&Oe.Shape.registerShape("point","pointer",{drawShape:function(r,t){var n=r.points[0];n=this.parsePoint(n);var i=this.parsePoint({x:0,y:0});return t.addShape("line",{attrs:{x1:i.x,y1:i.y,x2:n.x,y2:n.y,stroke:r.color,lineWidth:2,lineCap:"round"}}),t.addShape("circle",{attrs:{x:i.x,y:i.y,r:6,stroke:r.color,lineWidth:3,fill:"#fff"}})}});var ut=function(r){var t=r.title,n=r.height,i=n===void 0?1:n,s=r.percent,l=r.forceFit,v=l===void 0?!0:l,g=r.formatter,x=g===void 0?lt:g,C=r.color,T=C===void 0?"#2F9CFF":C,R=r.bgColor,F=R===void 0?"#F0F2F5":R,H={value:{type:"linear",min:0,max:10,tickCount:6,nice:!0}},Q=[{value:s/10}],ie=function(){return`
  <div style="width: 300px;text-align: center;font-size: 12px!important;">
    <div style="font-size: 14px; color: rgba(0,0,0,0.43);margin: 0;">`.concat(t,`</div>
    <div style="font-size: 24px;color: rgba(0,0,0,0.85);margin: 0;">
      `).concat((Q[0].value*10).toFixed(2),`%
    </div>
  </div>`)},be={fontSize:12,fill:"rgba(0, 0, 0, 0.65)",textAlign:"center"};return Re.a.createElement(Oe.Chart,{height:i,data:Q,scale:H,padding:[-16,0,16,0],forceFit:v},Re.a.createElement(Oe.Coord,{type:"polar",startAngle:-1.25*Math.PI,endAngle:.25*Math.PI,radius:.8}),Re.a.createElement(Oe.Axis,{name:"1",line:void 0}),Re.a.createElement(Oe.Axis,{line:void 0,tickLine:void 0,subTickLine:void 0,name:"value",zIndex:br.a.cssStyle.zIndex.zIndex_2,label:{offset:-12,formatter:x,textStyle:be}}),Re.a.createElement(Oe.Guide,null,Re.a.createElement(Se,{start:[3,.905],end:[3,.85],lineStyle:{stroke:T,lineDash:void 0,lineWidth:2}}),Re.a.createElement(Se,{start:[5,.905],end:[5,.85],lineStyle:{stroke:T,lineDash:void 0,lineWidth:3}}),Re.a.createElement(Se,{start:[7,.905],end:[7,.85],lineStyle:{stroke:T,lineDash:void 0,lineWidth:3}}),Re.a.createElement(fe,{start:[0,.965],end:[10,.965],style:{stroke:F,lineWidth:10}}),Re.a.createElement(fe,{start:[0,.965],end:[Q[0].value,.965],style:{stroke:T,lineWidth:10}}),Re.a.createElement(Pe,{position:["50%","95%"],html:ie()})),Re.a.createElement(Oe.Geom,{line:!1,type:"point",position:"value*1",shape:"pointer",color:T,active:!1}))},Ot=qr()(ut),wt=O("k1fw"),sr=O("iz+Y"),Or=O.n(sr),Nt=function(r){var t=r.height,n=t===void 0?1:t,i=r.data,s=i===void 0?[]:i,l=r.forceFit,v=l===void 0?!0:l,g=r.color,x=g===void 0?"rgba(24, 144, 255, 0.2)":g,C=r.borderColor,T=C===void 0?"#1089ff":C,R=r.scale,F=R===void 0?{x:{},y:{}}:R,H=r.borderWidth,Q=H===void 0?2:H,ie=r.line,be=r.xAxis,je=r.yAxis,Je=r.animate,et=Je===void 0?!0:Je,bt=[36,5,30,5],Et={x:Object(wt.a)({type:"cat",range:[0,1]},F.x),y:Object(wt.a)({min:0},F.y)},kt=["x*y",function(mr,Ar){return{name:mr,value:Ar}}],jt=n+54;return Re.a.createElement("div",{className:Or.a.miniChart,style:{height:n}},Re.a.createElement("div",{className:Or.a.chartContent},n>0&&Re.a.createElement(Oe.Chart,{animate:et,scale:Et,height:jt,forceFit:v,data:s,padding:bt},Re.a.createElement(Oe.Axis,Object(Bt.a)({key:"axis-x",name:"x",label:null,line:null,tickLine:null,grid:null},be)),Re.a.createElement(Oe.Axis,Object(Bt.a)({key:"axis-y",name:"y",label:null,line:null,tickLine:null,grid:null},je)),Re.a.createElement(Oe.Tooltip,{showTitle:!1,crosshairs:!1}),Re.a.createElement(Oe.Geom,{type:"area",position:"x*y",color:x,tooltip:kt,shape:"smooth",style:{fillOpacity:1}}),ie?Re.a.createElement(Oe.Geom,{type:"line",position:"x*y",shape:"smooth",color:T,size:Q,tooltip:!1}):Re.a.createElement("span",{style:{display:"none"}}))))},Tt=qr()(Nt),It=O("/zsF"),$t=O("PArb"),gr=O("jrin"),qt=O("cQSq"),dr=O.n(qt),Ur=O("9/5/"),Ir=O.n(Ur),ur=O("Jssm"),Rr=O.n(ur),Yn=O("TSYQ"),un=O.n(Yn),_n=O("d9mD"),qn=O.n(_n),oi=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){var n;Object(ht.a)(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),n.state={legendData:[],legendBlock:!1},n.chart=void 0,n.root=void 0,n.requestRef=0,n.resize=Ir()(function(){var v=n.props.hasLegend,g=n.state.legendBlock;if(!v||!n.root){window.removeEventListener("resize",n.resize);return}n.root&&n.root.parentNode&&n.root.parentNode.clientWidth<=380?g||n.setState({legendBlock:!0}):g&&n.setState({legendBlock:!1})},300),n.getG2Instance=function(v){n.chart=v,requestAnimationFrame(function(){n.getLegendData(),n.resize()})},n.getLegendData=function(){if(!!n.chart){var v=n.chart.getAllGeoms()[0];if(!!v){var g=v.get("dataArray")||[],x=g.map(function(C){var T=C[0]._origin;return T.color=C[0].color,T.checked=!0,T});n.setState({legendData:x})}}},n.handleRoot=function(v){n.root=v},n.handleLegendClick=function(v,g){var x=v;x.checked=!x.checked;var C=n.state.legendData;C[g]=x;var T=C.filter(function(R){return R.checked}).map(function(R){return R.x});n.chart&&n.chart.filter("x",function(R){return T.indexOf("".concat(R))>-1}),n.setState({legendData:C})},n}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){var i=this;window.addEventListener("resize",function(){i.requestRef=requestAnimationFrame(function(){return i.resize()})},{passive:!0})}},{key:"componentDidUpdate",value:function(i){var s=this.props.data;s!==i.data&&this.getLegendData()}},{key:"componentWillUnmount",value:function(){this.requestRef&&window.cancelAnimationFrame(this.requestRef),window.removeEventListener("resize",this.resize),this.resize&&this.resize.cancel()}},{key:"render",value:function(){var i,s=this,l=this.props,v=l.valueFormat,g=l.subTitle,x=l.total,C=l.hasLegend,T=C===void 0?!1:C,R=l.className,F=l.style,H=l.height,Q=H===void 0?0:H,ie=l.forceFit,be=ie===void 0?!0:ie,je=l.percent,Je=l.color,et=l.inner,bt=et===void 0?.75:et,Et=l.animate,kt=Et===void 0?!0:Et,jt=l.colors,mr=l.lineWidth,Ar=mr===void 0?1:mr,pr=this.state,pn=pr.legendData,Tn=pr.legendBlock,Jn=un()(qn.a.pie,R,(i={},Object(gr.a)(i,qn.a.hasLegend,!!T),Object(gr.a)(i,qn.a.legendBlock,Tn),i)),va=this.props,oo=va.data,ko=va.selected,ss=ko===void 0?!0:ko,eo=va.tooltip,Bl=eo===void 0?!0:eo,yc=oo||[],_l=ss,Yc=Bl,yp=jt;yc=yc||[],_l=_l||!0,Yc=Yc||!0;var po,xl={x:{type:"cat",range:[0,1]},y:{min:0}};(je||je===0)&&(_l=!1,Yc=!1,po=function(qi){return qi==="\u5360\u6BD4"?Je||"rgba(24, 144, 255, 0.85)":"#F0F2F5"},yc=[{x:"\u5360\u6BD4",y:parseFloat("".concat(je))},{x:"\u53CD\u6BD4",y:100-parseFloat("".concat(je))}]);var _v=["x*percent",function(ta,qi){return{name:ta,value:"".concat((qi*100).toFixed(2),"%")}}],xv=[12,0,12,0],ki=new qt.DataView;return ki.source(yc).transform({type:"percent",field:"y",dimension:"x",as:"percent"}),Re.a.createElement("div",{ref:this.handleRoot,className:Jn,style:F},Re.a.createElement(Rr.a,{maxFontSize:25},Re.a.createElement("div",{className:qn.a.chart},Re.a.createElement(Oe.Chart,{scale:xl,height:Q,forceFit:be,data:ki,padding:xv,animate:kt,onGetG2Instance:this.getG2Instance},!!Yc&&Re.a.createElement(Oe.Tooltip,{showTitle:!1}),Re.a.createElement(Oe.Coord,{type:"theta",innerRadius:bt}),Re.a.createElement(Oe.Geom,{style:{lineWidth:Ar,stroke:"#fff"},tooltip:Yc?_v:void 0,type:"intervalStack",position:"percent",color:["x",je||je===0?po:yp],selected:_l})),(g||x)&&Re.a.createElement("div",{className:qn.a.total},g&&Re.a.createElement("h4",{className:"pie-sub-title"},g),x&&Re.a.createElement("div",{className:"pie-stat"},typeof x=="function"?x():x)))),T&&Re.a.createElement("ul",{className:qn.a.legend},pn.map(function(ta,qi){return Re.a.createElement("li",{key:ta.x,onClick:function(){return s.handleLegendClick(ta,qi)}},Re.a.createElement("span",{className:qn.a.dot,style:{backgroundColor:ta.checked?ta.color:"#aaa"}}),Re.a.createElement("span",{className:qn.a.legendTitle},ta.x),Re.a.createElement($t.a,{type:"vertical"}),Re.a.createElement("span",{className:qn.a.percent},"".concat((Number.isNaN(ta.percent)?0:ta.percent*100).toFixed(2),"%")),Re.a.createElement("span",{className:qn.a.value},v?v(ta.y):ta.y))})))}}]),t}(N.Component),Gi=qr()(oi),he=O("tJVT"),Fn=O("1XEM"),Li=O.n(Fn),Ko="https://gw.alipayobjects.com/zos/rmsportal/gWyeGLCdFFRavBGIDzWk.png",us=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){var n;Object(ht.a)(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),n.state={dv:null,height:0,width:0},n.requestRef=0,n.isUnmount=!1,n.root=void 0,n.imageMask=void 0,n.resize=function(){n.requestRef=requestAnimationFrame(function(){n.renderChart(n.props)})},n.saveRootRef=function(v){n.root=v},n.initTagCloud=function(){function v(g){return Object(wt.a)(Object(wt.a)({},g.style),{},{fillOpacity:g.opacity,fontSize:g.origin._origin.size,rotate:g.origin._origin.rotate,text:g.origin._origin.text,textAlign:"center",fontFamily:g.origin._origin.font,fill:g.color,textBaseline:"Alphabetic"})}Oe.Shape.registerShape("point","cloud",{drawShape:function(x,C){var T=v(x);return C.addShape("text",{attrs:Object(wt.a)(Object(wt.a)({},T),{},{x:x.x,y:x.y})})}})},n.renderChart=Ir()(function(v){var g=v||n.props,x=g.data,C=g.height;if(!(x.length<1||!n.root)){var T=C,R=n.root.offsetWidth,F=function(){var Q=new dr.a.View().source(x),ie=Q.range("value"),be=Object(he.a)(ie,2),je=be[0],Je=be[1];Q.transform({type:"tag-cloud",fields:["name","value"],imageMask:n.imageMask,font:"Verdana",size:[R,T],padding:0,timeInterval:5e3,rotate:function(){return 0},fontSize:function(bt){var Et=Math.pow((bt.value-je)/(Je-je),2);return Et*(17.5-5)+5}}),!n.isUnmount&&n.setState({dv:Q,width:R,height:T})};n.imageMask?F():(n.imageMask=new Image,n.imageMask.crossOrigin="",n.imageMask.src=Ko,n.imageMask.onload=F)}},200),n}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){var i=this;requestAnimationFrame(function(){i.initTagCloud(),i.renderChart(i.props)}),window.addEventListener("resize",this.resize,{passive:!0})}},{key:"componentDidUpdate",value:function(i){var s=this.props.data;i&&JSON.stringify(i.data)!==JSON.stringify(s)&&this.renderChart(this.props)}},{key:"componentWillUnmount",value:function(){this.isUnmount=!0,window.cancelAnimationFrame(this.requestRef),window.removeEventListener("resize",this.resize)}},{key:"render",value:function(){var i=this.props,s=i.className,l=i.height,v=this.state,g=v.dv,x=v.width,C=v.height;return Re.a.createElement("div",{className:un()(Li.a.tagCloud,s),style:{width:"100%",height:l},ref:this.saveRootRef},g&&Re.a.createElement(Oe.Chart,{width:x,height:C,data:g,padding:0,scale:{x:{nice:!1},y:{nice:!1}}},Re.a.createElement(Oe.Tooltip,{showTitle:!1}),Re.a.createElement(Oe.Coord,{reflect:"y"}),Re.a.createElement(Oe.Geom,{type:"point",position:"x*y",color:"text",shape:"cloud",tooltip:["text*value",function(R,F){return{name:R,value:F}}]})))}}]),t}(N.Component),Ut=qr()(us),Er=O("CIdX"),Hr=O.n(Er),dn=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){var n;Object(ht.a)(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),n.state={radio:1},n.timer=0,n.root=null,n.node=null,n.resize=function(){if(n.root){var v=n.props.height,g=v===void 0?1:v,x=n.root.parentNode,C=x.offsetWidth;n.setState({radio:C<g?C/g:1})}},n}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){var i=this;this.renderChart(),this.resize(),window.addEventListener("resize",function(){requestAnimationFrame(function(){return i.resize()})},{passive:!0})}},{key:"componentDidUpdate",value:function(i){var s=this.props.percent;i.percent!==s&&this.renderChart("update")}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.timer),this.node&&(this.node.innerHTML=""),window.removeEventListener("resize",this.resize)}},{key:"renderChart",value:function(i){var s=this.props,l=s.percent,v=s.color,g=v===void 0?"#1890FF":v,x=l/100,C=this;if(cancelAnimationFrame(this.timer),!this.node||x!==0&&!x)return;var T=this.node,R=T.getContext("2d");if(!R)return;var F=T.width,H=T.height,Q=F/2,ie=2,be=Q-ie;R.beginPath(),R.lineWidth=ie*2;for(var je=F-ie,Je=je/8,et=.2,bt=et,Et=ie,kt=0,jt=0,mr=.005,Ar=[],pr=Q-ie,pn=-(Math.PI/2),Tn=!0,Jn=pn;Jn<pn+2*Math.PI;Jn+=1/(8*Math.PI))Ar.push([Q+pr*Math.cos(Jn),Q+pr*Math.sin(Jn)]);var va=Ar.shift();R.strokeStyle=g,R.moveTo(va[0],va[1]);function oo(){if(!!R){R.beginPath(),R.save();for(var ss=[],eo=Et;eo<=Et+je;eo+=20/je){var Bl=kt+(Et+eo)/Je,yc=Math.sin(Bl)*bt,_l=eo,Yc=2*be*(1-jt)+(Q-be)-Je*yc;R.lineTo(_l,Yc),ss.push([_l,Yc])}var yp=ss.shift();R.lineTo(Et+je,H),R.lineTo(Et,H),R.lineTo(yp[0],yp[1]);var po=R.createLinearGradient(0,0,0,H);po.addColorStop(0,"#ffffff"),po.addColorStop(1,g),R.fillStyle=po,R.fill(),R.restore()}}function ko(){if(!!R){if(R.clearRect(0,0,F,H),Tn&&i!=="update")if(Ar.length){var ss=Ar.shift();R.lineTo(ss[0],ss[1]),R.stroke()}else Tn=!1,R.lineTo(va[0],va[1]),R.stroke(),Ar=[],R.globalCompositeOperation="destination-over",R.beginPath(),R.lineWidth=ie,R.arc(Q,Q,pr,0,2*Math.PI,!0),R.beginPath(),R.save(),R.arc(Q,Q,Q-3*ie,0,2*Math.PI,!0),R.restore(),R.clip(),R.fillStyle=g;else{if(x>=.85){if(bt>et/4){var eo=et*.01;bt-=eo}}else if(x<=.1){if(bt<et*1.5){var Bl=et*.01;bt+=Bl}}else{if(bt<=et){var yc=et*.01;bt+=yc}if(bt>=et){var _l=et*.01;bt-=_l}}x-jt>0&&(jt+=mr),x-jt<0&&(jt-=mr),kt+=.07,oo()}C.timer=requestAnimationFrame(ko)}}ko()}},{key:"render",value:function(){var i=this,s=this.state.radio,l=this.props,v=l.percent,g=l.title,x=l.height,C=x===void 0?1:x;return Re.a.createElement("div",{className:Hr.a.waterWave,ref:function(R){return i.root=R},style:{transform:"scale(".concat(s,")")}},Re.a.createElement("div",{style:{width:C,height:C,overflow:"hidden"}},Re.a.createElement("canvas",{className:Hr.a.waterWaveCanvasWrapper,ref:function(R){return i.node=R},width:C*2,height:C*2})),Re.a.createElement("div",{className:Hr.a.text,style:{width:C}},g&&Re.a.createElement("span",null,g),Re.a.createElement("h4",null,v,"%")))}}]),t}(N.Component),Kr=qr()(dn),Ia=O("9og8"),li=O("WmNS"),Hn=O.n(li),ii=Object(N.createContext)({});function Hi(){return Object(N.useContext)(ii)}var Wi={},To={},Wa=function(r){return To[r]},ma=function(r,t){To[r]=t},As=function(r){return Wi[r]},js=function(r,t){Wi[r]=t},Ra={},J={},$=34,le=10,ge=13;function ke(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function nt(e,r){var t=ke(e);return function(n,i){return r(t(n),i,e)}}function pt(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function pe(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function Ue(e){return e<0?"-"+pe(-e,6):e>9999?"+"+pe(e,6):pe(e,4)}function qe(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Ue(e.getUTCFullYear(),4)+"-"+pe(e.getUTCMonth()+1,2)+"-"+pe(e.getUTCDate(),2)+(i?"T"+pe(r,2)+":"+pe(t,2)+":"+pe(n,2)+"."+pe(i,3)+"Z":n?"T"+pe(r,2)+":"+pe(t,2)+":"+pe(n,2)+"Z":t||r?"T"+pe(r,2)+":"+pe(t,2)+"Z":"")}var Cr=function(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(T,R){var F,H,Q=i(T,function(ie,be){if(F)return F(ie,be-1);H=ie,F=R?nt(ie,R):ke(ie)});return Q.columns=H||[],Q}function i(T,R){var F=[],H=T.length,Q=0,ie=0,be,je=H<=0,Je=!1;T.charCodeAt(H-1)===le&&--H,T.charCodeAt(H-1)===ge&&--H;function et(){if(je)return J;if(Je)return Je=!1,Ra;var Et,kt=Q,jt;if(T.charCodeAt(kt)===$){for(;Q++<H&&T.charCodeAt(Q)!==$||T.charCodeAt(++Q)===$;);return(Et=Q)>=H?je=!0:(jt=T.charCodeAt(Q++))===le?Je=!0:jt===ge&&(Je=!0,T.charCodeAt(Q)===le&&++Q),T.slice(kt+1,Et-1).replace(/""/g,'"')}for(;Q<H;){if((jt=T.charCodeAt(Et=Q++))===le)Je=!0;else if(jt===ge)Je=!0,T.charCodeAt(Q)===le&&++Q;else if(jt!==t)continue;return T.slice(kt,Et)}return je=!0,T.slice(kt,H)}for(;(be=et())!==J;){for(var bt=[];be!==Ra&&be!==J;)bt.push(be),be=et();R&&(bt=R(bt,ie++))==null||F.push(bt)}return F}function s(T,R){return T.map(function(F){return R.map(function(H){return C(F[H])}).join(e)})}function l(T,R){return R==null&&(R=pt(T)),[R.map(C).join(e)].concat(s(T,R)).join(`
`)}function v(T,R){return R==null&&(R=pt(T)),s(T,R).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?qe(T):r.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:i,format:l,formatBody:v,formatRows:g,formatRow:x,formatValue:C}},Tr=Cr(","),tr=Tr.parse,Dr=Tr.parseRows,nn=Tr.format,Mn=Tr.formatBody,rr=Tr.formatRows,wn=Tr.formatRow,mn=Tr.formatValue,xn=O("lSNA"),w=O.n(xn),An=O("RIqP"),Lr=O.n(An),Zi=O("Aib3"),Ti=O.n(Zi);function Un(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Bi(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Un(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Un(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Mo(e,r){var t=r.x,n=r.y,i=r.x1,s=r.y1,l=r.coordinates,v=[];return e.forEach(function(g,x){var C=[];if(t&&n&&(C=[parseFloat(g[t]),parseFloat(g[n])]),t&&n&&i&&s){var T=[parseFloat(g[t]),parseFloat(g[n])],R=[parseFloat(g[i]),parseFloat(g[s])];C=[T,R]}if(l){var F="Polygon";Array.isArray(l[0])||(F="Point"),Array.isArray(l[0])&&!Array.isArray(l[0][0])&&(F="LineString");var H={type:F,coordinates:Lr()(g[l])};Ti()(H,!0),C=H.coordinates}var Q=Bi(Bi({},g),{},{_id:x,coordinates:C});v.push(Q)}),{dataArray:v}}var ra=[{lng1:100,lat1:30,lng2:130,lat2:30}],to={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function ca(e,r){var t=tr(e);return Mo(t,r)}var ci=63710088e-1,bi={centimeters:ci*100,centimetres:ci*100,degrees:ci/111325,feet:ci*3.28084,inches:ci*39.37,kilometers:ci/1e3,kilometres:ci/1e3,meters:ci,metres:ci,miles:ci/1609.344,millimeters:ci*1e3,millimetres:ci*1e3,nauticalmiles:ci/1852,radians:1,yards:ci*1.0936},vo={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ci,yards:1.0936133},mo={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ia(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Za(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return so(r).geometry;case"LineString":return ga(r).geometry;case"Polygon":return Ta(r).geometry;case"MultiPoint":return qo(r).geometry;case"MultiLineString":return wa(r).geometry;case"MultiPolygon":return wo(r).geometry;default:throw new Error(e+" is invalid")}}function so(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Be(e[0])||!Be(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return ia(n,r,t)}function bl(e,r,t){return t===void 0&&(t={}),Co(e.map(function(n){return so(n,r)}),t)}function Ta(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var s=i[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var l=0;l<s[s.length-1].length;l++)if(s[s.length-1][l]!==s[0][l])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return ia(v,r,t)}function cu(e,r,t){return t===void 0&&(t={}),Co(e.map(function(n){return Ta(n,r)}),t)}function ga(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return ia(n,r,t)}function Va(e,r,t){return t===void 0&&(t={}),Co(e.map(function(n){return ga(n,r)}),t)}function Co(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function wa(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return ia(n,r,t)}function qo(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return ia(n,r,t)}function wo(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return ia(n,r,t)}function jo(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return ia(n,r,t)}function ya(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function Nl(e,r){r===void 0&&(r="kilometers");var t=bi[r];if(!t)throw new Error(r+" units is invalid");return e*t}function ls(e,r){r===void 0&&(r="kilometers");var t=bi[r];if(!t)throw new Error(r+" units is invalid");return e/t}function uo(e,r){return Lo(ls(e,r))}function $s(e){var r=e%360;return r<0&&(r+=360),r}function Lo(e){var r=e%(2*Math.PI);return r*180/Math.PI}function go(e){var r=e%360;return r*Math.PI/180}function We(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return Nl(ls(e,r),t)}function se(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=mo[r];if(!n)throw new Error("invalid original units");var i=mo[t];if(!i)throw new Error("invalid final units");return e/n*i}function Be(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Rt(e){return!!e&&e.constructor===Object}function Zr(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Be(r))throw new Error("bbox must only contain numbers")})}function kn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Ni(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Na(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ma(e){if(e.length>1&&Be(e[0])&&Be(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ma(e[0]);throw new Error("coordinates must only contain numbers")}function Xa(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function Do(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function $c(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var s=i[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!s.geometry||s.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+s.geometry.type)}}function Ks(e){return e.type==="Feature"?e.geometry:e}function Qo(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Vo(e,r,t){if(e!==null)for(var n,i,s,l,v,g,x,C=0,T=0,R,F=e.type,H=F==="FeatureCollection",Q=F==="Feature",ie=H?e.features.length:1,be=0;be<ie;be++){x=H?e.features[be].geometry:Q?e.geometry:e,R=x?x.type==="GeometryCollection":!1,v=R?x.geometries.length:1;for(var je=0;je<v;je++){var Je=0,et=0;if(l=R?x.geometries[je]:x,l!==null){g=l.coordinates;var bt=l.type;switch(C=t&&(bt==="Polygon"||bt==="MultiPolygon")?1:0,bt){case null:break;case"Point":if(r(g,T,be,Je,et)===!1)return!1;T++,Je++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(r(g[n],T,be,Je,et)===!1)return!1;T++,bt==="MultiPoint"&&Je++}bt==="LineString"&&Je++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(i=0;i<g[n].length-C;i++){if(r(g[n][i],T,be,Je,et)===!1)return!1;T++}bt==="MultiLineString"&&Je++,bt==="Polygon"&&et++}bt==="Polygon"&&Je++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(et=0,i=0;i<g[n].length;i++){for(s=0;s<g[n][i].length-C;s++){if(r(g[n][i][s],T,be,Je,et)===!1)return!1;T++}et++}Je++}break;case"GeometryCollection":for(n=0;n<l.geometries.length;n++)if(Vo(l.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qs(e,r,t,n){var i=t;return Vo(e,function(s,l,v,g,x){l===0&&t===void 0?i=s:i=r(i,s,l,v,g,x)},n),i}function gu(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function Vs(e,r,t){var n=t;return gu(e,function(i,s){s===0&&t===void 0?n=i:n=r(n,i,s)}),n}function nl(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function Qs(e,r,t){var n=t;return nl(e,function(i,s){s===0&&t===void 0?n=i:n=r(n,i,s)}),n}function Ga(e){var r=[];return Vo(e,function(t){r.push(t)}),r}function Ya(e,r){var t,n,i,s,l,v,g,x,C,T,R=0,F=e.type==="FeatureCollection",H=e.type==="Feature",Q=F?e.features.length:1;for(t=0;t<Q;t++){for(v=F?e.features[t].geometry:H?e.geometry:e,x=F?e.features[t].properties:H?e.properties:{},C=F?e.features[t].bbox:H?e.bbox:void 0,T=F?e.features[t].id:H?e.id:void 0,g=v?v.type==="GeometryCollection":!1,l=g?v.geometries.length:1,i=0;i<l;i++){if(s=g?v.geometries[i]:v,s===null){if(r(null,R,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(s,R,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(r(s.geometries[n],R,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function El(e,r,t){var n=t;return Ya(e,function(i,s,l,v,g){s===0&&t===void 0?n=i:n=r(n,i,s,l,v,g)}),n}function yu(e,r){Ya(e,function(t,n,i,s,l){var v=t===null?null:t.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return r(ia(t,i,{bbox:s,id:l}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var C=t.coordinates[x],T={type:g,coordinates:C};if(r(ia(T,i),n,x)===!1)return!1}})}function kh(e,r,t){var n=t;return yu(e,function(i,s,l){s===0&&l===0&&t===void 0?n=i:n=r(n,i,s,l)}),n}function Kc(e,r){yu(e,function(t,n,i){var s=0;if(!!t.geometry){var l=t.geometry.type;if(!(l==="Point"||l==="MultiPoint")){var v,g=0,x=0,C=0;if(Vo(t,function(T,R,F,H,Q){if(v===void 0||n>g||H>x||Q>C){v=T,g=n,x=H,C=Q,s=0;return}var ie=ga([v,T],t.properties);if(r(ie,n,i,Q,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function ec(e,r,t){var n=t,i=!1;return Kc(e,function(s,l,v,g,x){i===!1&&t===void 0?n=s:n=r(n,s,l,v,g,x),i=!0}),n}function _u(e,r){if(!e)throw new Error("geojson is required");yu(e,function(t,n,i){if(t.geometry!==null){var s=t.geometry.type,l=t.geometry.coordinates;switch(s){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<l.length;v++)if(r(ga(l[v],t.properties),n,i,v)===!1)return!1;break}}})}function bc(e,r,t){var n=t;return _u(e,function(i,s,l,v){s===0&&t===void 0?n=i:n=r(n,i,s,l,v)}),n}function _(e,r){if(r=r||{},!Rt(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,s=r.segmentIndex||0,l=r.properties,v;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,v=e.features[t].geometry;break;case"Feature":l=l||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),ga([g[s],g[s+1]],l,r);case"Polygon":return i<0&&(i=g.length+i),s<0&&(s=g[i].length+s-1),ga([g[i][s],g[i][s+1]],l,r);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),ga([g[n][s],g[n][s+1]],l,r);case"MultiPolygon":return n<0&&(n=g.length+n),i<0&&(i=g[n].length+i),s<0&&(s=g[n][i].length-s-1),ga([g[n][i][s],g[n][i][s+1]],l,r)}throw new Error("geojson is invalid")}function P(e,r){if(r=r||{},!Rt(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,s=r.coordIndex||0,l=r.properties,v;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),l=l||e.features[t].properties,v=e.features[t].geometry;break;case"Feature":l=l||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return so(g,l,r);case"MultiPoint":return n<0&&(n=g.length+n),so(g[n],l,r);case"LineString":return s<0&&(s=g.length+s),so(g[s],l,r);case"Polygon":return i<0&&(i=g.length+i),s<0&&(s=g[i].length+s),so(g[i][s],l,r);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),so(g[n][s],l,r);case"MultiPolygon":return n<0&&(n=g.length+n),i<0&&(i=g[n].length+i),s<0&&(s=g[n][i].length-s),so(g[n][i][s],l,r)}throw new Error("geojson is invalid")}function z(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function L(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?z(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):z(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function te(e,r){var t=[],n={};if(e.features=e.features.filter(function(s){var l=s.geometry;return s!=null&&l&&l.type&&l.coordinates&&l.coordinates.length>0}),Ti()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var i=0;return yu(e,function(s,l){var v=Na(s),g=l,x=L(L({},s.properties),{},{coordinates:v,_id:g});t.push(x)}),{dataArray:t,featureKeys:n}}function Ce(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),s=0;s<e.length;s++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(s);return n}function rt(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}var Ct=O("J4zp"),ft=O.n(Ct),Sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function kr(e){this.message=e}kr.prototype=new Error,kr.prototype.name="InvalidCharacterError";function ni(e){var r=String(e).replace(/=+$/,"");if(r.length%4==1)throw new kr("'atob' failed: The string to be decoded is not correctly encoded.");for(var t="",n=0,i,s,l=0;s=r.charAt(l++);~s&&(i=n%4?i*64+s:s,n++%4)?t+=String.fromCharCode(255&i>>(-2*n&6)):0)s=Sr.indexOf(s);return t}function xi(e){e=String(e);for(var r,t,n,i,s="",l=0,v=e.length%3;l<e.length;){if((t=e.charCodeAt(l++))>255||(n=e.charCodeAt(l++))>255||(i=e.charCodeAt(l++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");r=t<<16|n<<8|i,s+=Sr.charAt(r>>18&63)+Sr.charAt(r>>12&63)+Sr.charAt(r>>6&63)+Sr.charAt(r&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var gi=O("lwsE"),dt=O.n(gi),ua=O("W8MJ"),yt=O.n(ua),fu=function(){function e(r,t){dt()(this,e),this.buffers=r,this.type=t}return yt()(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,n,i){throw new Error("not implemented")}}]),e}(),Ha;typeof window=="undefined"?Ha={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(r){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(r){return!0},Event:function(r,t){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ha=window;var fa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Sl=fa?my.getSystemInfoSync().pixelRatio:Ha.devicePixelRatio,Ec=O("7W2i"),bn=O.n(Ec),qc=O("a1gu"),In=O.n(qc),Rf=O("Nsbk"),Lt=O.n(Rf),Ca=yt()(function e(r,t){dt()(this,e),w()(this,"cancelBubble",void 0),w()(this,"cancelable",void 0),w()(this,"target",void 0),w()(this,"currentTarget",void 0),w()(this,"preventDefault",void 0),w()(this,"stopPropagation",void 0),w()(this,"type",void 0),w()(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=r,this.timeStamp=Date.now()}),zl=O("PJYZ"),ue=O.n(zl);function Du(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Qc(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function Qc(e,r){if(!!e){if(typeof e=="string")return Fu(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Fu(e,r)}}function Fu(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var xu=new WeakMap,Bu=function(){function e(){dt()(this,e),xu.set(this,{})}return yt()(e,[{key:"addEventListener",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=xu.get(this);s||(s={}),s[t]||(s[t]=[]),s[t].push(n),xu.set(this,s),i.capture,i.once,i.passive}},{key:"removeEventListener",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=xu.get(this);if(s){var l=s[t];if(l&&l.length>0){for(var v=l.length;v--;v>0)if(l[v]===n){l.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(t){var n=xu.get(this)[t.type];if(n){var i=Du(n),s;try{for(i.s();!(s=i.n()).done;){var l=s.value;l(t)}}catch(v){i.e(v)}finally{i.f()}}}}]),e}();function il(e){var r=Sc();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Sc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cl=function(e){bn()(t,e);var r=il(t);function t(){var n;return dt()(this,t),n=r.call(this),w()(ue()(n),"childNodes",void 0),n.childNodes=[],n}return yt()(t,[{key:"appendChild",value:function(i){this.childNodes.push(i)}},{key:"cloneNode",value:function(){var i=Object.create(this);return Object.assign(i,this),i}},{key:"removeChild",value:function(i){var s=this.childNodes.findIndex(function(l){return l===i});return s>-1?this.childNodes.splice(s,1):null}}]),t}(Bu);function ka(e){var r=Cc();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Cc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sh=function(e){bn()(t,e);var r=ka(t);function t(){var n;return dt()(this,t),n=r.call(this),w()(ue()(n),"className",void 0),w()(ue()(n),"children",void 0),n.className="",n.children=[],n}return yt()(t,[{key:"setAttribute",value:function(i,s){this[i]=s}},{key:"getAttribute",value:function(i){return this[i]}},{key:"setAttributeNS",value:function(i,s){this[i]=s}},{key:"getAttributeNS",value:function(i){return this[i]}}]),t}(Cl),wc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,kf,uh,Lf,Ul;if(wc){var bu=my.getSystemInfoSync();kf=bu.screenWidth,uh=bu.screenHeight,Lf=bu.windowWidth,Ul=bu.windowHeight}else{var jl=Ha.innerWidth,tc=Ha.innerHeight;kf=jl,uh=tc,Lf=jl,Ul=tc}var Js={width:kf,height:uh,availWidth:Lf,availHeight:Ul,availLeft:0,availTop:0},Nu=Js.availWidth,rc=Js.availHeight,wl={style:[]};function Ts(e,r){if(!("parentNode"in e)){var t;r===0?t=function(){return null}:r===1?t=function(){return wl}:t=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:t})}if(!("parentElement"in e)){var n;r===0?n=function(){return null}:r===1?n=function(){return wl}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Jc(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:Nu+"px",height:rc+"px",margin:"0px",padding:"0px"})}function ef(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=Nu,e.clientHeight=rc),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var r={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return r})}function tf(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=Nu,e.offsetHeight=rc)}function Vl(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=Nu,e.scrollHeight=rc)}function Al(e){var r=function(){return!0};e.classList=[],e.classList.add=r,e.classList.remove=r,e.classList.contains=r,e.classList.toggle=r}function rf(e){var r=Df();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function al(){}var zu=function(e){bn()(t,e);var r=rf(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return dt()(this,t),n=r.call(this),w()(ue()(n),"className",void 0),w()(ue()(n),"children",void 0),w()(ue()(n),"focus",void 0),w()(ue()(n),"blur",void 0),w()(ue()(n),"insertBefore",void 0),w()(ue()(n),"appendChild",void 0),w()(ue()(n),"removeChild",void 0),w()(ue()(n),"remove",void 0),w()(ue()(n),"innerHTML",void 0),w()(ue()(n),"tagName",void 0),n.className="",n.children=[],n.focus=al,n.blur=al,n.insertBefore=al,n.appendChild=al,n.removeChild=al,n.remove=al,n.innerHTML="",n.tagName=i.toUpperCase(),Ts(ue()(n),s),Jc(ue()(n)),Al(ue()(n)),ef(ue()(n)),tf(ue()(n)),Vl(ue()(n)),n}return yt()(t)}(sh);function Ac(e){var r=nf();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function nf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nc=function(e){bn()(t,e);var r=Ac(t);function t(n){return dt()(this,t),r.call(this,n)}return yt()(t,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),t}(zu);function Lh(e){var r=Ff();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Bf=function(e){bn()(t,e);var r=Lh(t);function t(){return dt()(this,t),r.call(this,"video")}return yt()(t)}(nc),ys={},eu={};function Nf(e,r){ys=e,ys.id=r,"tagName"in ys||(ys.tagName="CANVAS"),ys.type="canvas",Ts(ys),Jc(ys),Al(ys),ef(ys),tf(ys),ys.focus=function(){},ys.blur=function(){}}function _p(e,r){var t=1024,n=1024;eu={width:t,height:n,clientWidth:t/Sl,clientHeight:n/Sl,id:r,type:"canvas"},"tagName"in eu||(eu.tagName="CANVAS"),Ts(eu),Jc(eu),Al(eu),ef(eu),tf(eu),eu.getContext=function(i){if(i==="2d")return e},eu.focus=function(){},eu.blur=function(){}}function _s(){return ys}function ro(){return eu}var ic=yt()(function e(){dt()(this,e);var r=_s(),t=r.createImage&&r.createImage()||{};return"tagName"in t||(t.tagName="IMG",t.__proto__=e.prototype),Ts(t),Al(t),Object.assign(t,{addEventListener:function(i,s){t["on".concat(i)]=s.bind(t)},removeEventListener:function(i){t["on".concat(i)]=null}}),t}),Tl={href:"",protocol:"",host:""};function ol(e){var r=Qi();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Qi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var za=function(e){bn()(t,e);var r=ol(t);function t(){return dt()(this,t),r.call(this,"body",0)}return yt()(t,[{key:"addEventListener",value:function(i,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(i,s,l){}},{key:"dispatchEvent",value:function(i){}}]),t}(zu),Ms=function(e){bn()(t,e);var r=ol(t);function t(){return dt()(this,t),r.call(this,"html",0)}return yt()(t,[{key:"addEventListener",value:function(i,s){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(i,s){}},{key:"dispatchEvent",value:function(i){}}]),t}(zu),Ml={},Ps={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Tl,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(r){return r=r.toLowerCase(),r==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):r==="img"?new ic:r==="video"?new Bf:new zu(r)},createElementNS:function(r,t){return this.createElement(t)},createTextNode:function(r){return r},getElementById:function(r){return null},getElementsByTagName:function(r){return r=r.toLowerCase(),[]},getElementsByTagNameNS:function(r,t){return this.getElementsByTagName(t)},getElementsByName:function(r){return[]},querySelector:function(r){return null},querySelectorAll:function(r){return[]},addEventListener:function(r,t,n){Ml[r]||(Ml[r]=[]),Ml[r].push(t)},removeEventListener:function(r,t){var n=Ml[r];if(n&&n.length>0){for(var i=n.length;i--;i>0)if(n[i]===t){n.splice(i,1);break}}},dispatchEvent:function(r){var t=r.type,n=Ml[t];if(n)for(var i=0;i<n.length;i++)n[i](r);r.target&&typeof r.target["on"+t]=="function"&&r.target["on"+t](r)},createEvent:function(r){return new Ca(r)}};Ps.documentElement=new Ms,Ps.head=new zu("head"),Ps.body=new za;var af=Object,xp=O("cDf5"),lh=O.n(xp),of=function(){function e(){dt()(this,e),w()(this,"_w",void 0),w()(this,"_h",void 0),w()(this,"_data",void 0);var r=arguments.length;if(r===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else r===3&&lh()(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return yt()(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),sf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Eu,ha,Gl;if(sf){var ac=my.getSystemInfoSync();Eu=ac.system,ha=ac.platform,Gl=ac.language}else{var Xi={versions:function(){var e=Ha.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ha.navigator.browserLanguage||Ha.navigator.language).toLowerCase()};Xi.versions.android?ha="android":Xi.versions.trident?ha="IE":Xi.versions.presto?ha="Opera":Xi.versions.webKit?ha="webKit":Xi.versions.gecko?ha="Firefox":Xi.versions.mobile?ha="mobile":Xi.versions.ios?ha="ios":Xi.versions.iPhone?ha="iPhone":Xi.versions.iPad?ha="ipad":Xi.versions.webApp?ha="webApp":Xi.versions.weixin?ha="weixin":Xi.versions.qq&&(ha="qq"),Eu=Ha.navigator.userAgent,Gl=Xi.language}var Ln=Eu.toLowerCase().indexOf("android")!==-1,Os=Ln?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",uf="Mozilla/5.0 (".concat(Os,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Gl),oc={platform:ha,language:Gl,appVersion:"5.0 (".concat(Os,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:uf},Su={mark:function(r){return null},clearMeasures:function(r){return null},clearMarks:function(r){return null},measure:function(r,t,n){return{duration:0}},now:function(){}},Is=0,lf=0;function gn(e){var r=Date.now(),t=Math.max(Is+23,r);return lf=setTimeout(function(){e(Is=t)},t-r),lf}function Hl(e){var r=_s();return r.requestAnimationFrame?r.requestAnimationFrame(e):gn(e)}function Fo(e){var r=_s();return r.cancelAnimationFrame?r.cancelAnimationFrame(e):clearTimeout(e)}var zf=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(dt()(this,e),w()(this,"href",void 0),r.indexOf("http://")==0||r.indexOf("https://")==0){this.href=r;return}this.href=t+r}return yt()(e,null,[{key:"createObjectURL",value:function(t){var n=t.buffers[0],i=t.type,s=hu(n),l="data:".concat(i,";base64, ");return l+s}}]),e}();function hu(e){for(var r="",t=new Uint8Array(e),n=t.byteLength,i=0;i<n;i++)r+=String.fromCharCode(t[i]);return xi(r)}var Go={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},cf={};function ff(e){var r=tu();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function tu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uu=new Map,ch=new Map,hf=new Map,Uf={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function jf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,r)}function Cu(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,jf.call(this,"readystatechange",r)}var lo=function(e){bn()(t,e);var r=ff(t);function t(){var n;return dt()(this,t),n=r.call(this),w()(ue()(n),"onabort",void 0),w()(ue()(n),"onerror",void 0),w()(ue()(n),"onload",void 0),w()(ue()(n),"onloadstart",void 0),w()(ue()(n),"onprogress",void 0),w()(ue()(n),"ontimeout",void 0),w()(ue()(n),"onloadend",void 0),w()(ue()(n),"onreadystatechange",void 0),w()(ue()(n),"readyState",void 0),w()(ue()(n),"response",void 0),w()(ue()(n),"responseText",void 0),w()(ue()(n),"_responseType",void 0),w()(ue()(n),"responseXML",void 0),w()(ue()(n),"status",void 0),w()(ue()(n),"statusText",void 0),w()(ue()(n),"upload",void 0),w()(ue()(n),"withCredentials",void 0),w()(ue()(n),"timeout",void 0),w()(ue()(n),"_url",void 0),w()(ue()(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Uu.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return yt()(t,[{key:"responseType",set:function(i){this._responseType=i}},{key:"abort",value:function(){var i=hf.get("requestTask");i&&i.abort()}},{key:"getAllResponseHeaders",value:function(){var i=ch.get("responseHeader");return Object.keys(i).map(function(s){return"".concat(s,": ").concat(i[s])}).join(`
`)}},{key:"getResponseHeader",value:function(i){return ch.get("responseHeader")[i]}},{key:"open",value:function(i,s,l){this._method=i,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(i,s){var l=Uu.get("requestHeader");l[i]=s,Uu.set("requestHeader",l)}},{key:"addEventListener",value:function(i,s){var l=this;typeof s=="function"&&(this["on"+i]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||l,s.call(l,v)})}},{key:"removeEventListener",value:function(i,s){this["on"+i]===s&&(this["on"+i]=null)}}]),t}(Bu);w()(lo,"UNSEND",void 0),w()(lo,"OPENED",void 0),w()(lo,"HEADERS_RECEIVED",void 0),w()(lo,"LOADING",void 0),w()(lo,"DONE",void 0),lo.UNSEND=0,lo.OPENED=1,lo.HEADERS_RECEIVED=2,lo.LOADING=3,lo.DONE=4;function $i(e){var r=ju();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function ju(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pu=function(e){bn()(t,e);var r=$i(t);function t(n){var i;return dt()(this,t),i=r.call(this,n),w()(ue()(i),"touches",void 0),w()(ue()(i),"targetTouches",void 0),w()(ue()(i),"changedTouches",void 0),i.touches=[],i.targetTouches=[],i.changedTouches=[],i.target=_s(),i.currentTarget=_s(),i}return yt()(t)}(Ca);function Ho(e){var r=e||{},t=r.x,n=t===void 0?0:t,i=r.y,s=i===void 0?0:i,l=r.clientX,v=l===void 0?0:l,g=r.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function wu(e){return function(r){var t=new pu(e);t.changedTouches=r.changedTouches,t.touches=r.touches,t.targetTouches=Array.prototype.slice.call(r.touches),t.timeStamp=r.timeStamp,t.changedTouches.forEach(function(n){return Ho(n)}),t.touches.forEach(function(n){return Ho(n)}),t.targetTouches.forEach(function(n){return Ho(n)}),Ps.dispatchEvent(t)}}function Wl(e){return function(r){r.type=e,Ps.dispatchEvent(r)}}var xs=wu("touchstart"),cs=wu("touchmove"),pf=wu("touchend"),si=Wl("mapCameaParams");function Kn(e){var r=df();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function df(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bs=function(e){bn()(t,e);var r=Kn(t);function t(n){var i;return dt()(this,t),i=r.call(this,n),w()(ue()(i),"buttons",void 0),w()(ue()(i),"which",void 0),w()(ue()(i),"pointerId",void 0),w()(ue()(i),"bubbles",void 0),w()(ue()(i),"button",void 0),w()(ue()(i),"width",void 0),w()(ue()(i),"height",void 0),w()(ue()(i),"pressure",void 0),w()(ue()(i),"isPrimary",void 0),w()(ue()(i),"pointerType",void 0),w()(ue()(i),"altKey",void 0),w()(ue()(i),"ctrlKey",void 0),w()(ue()(i),"metaKey",void 0),w()(ue()(i),"shiftKey",void 0),i.target=_s(),i.currentTarget=_s(),i}return yt()(t)}(Ca),du=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Jo=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Vu="touch";function Vf(e,r,t){for(var n=new bs(e),i=0;i<du.length;i++){var s=du[i];n[s]=r[s]||Jo[i]}return n.type=e,n.target=_s(),n.currentTarget=_s(),n.buttons=ru(e),n.which=n.buttons,n.pointerId=(r.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(r.radiusX||.5)*2,n.height=(r.radiusY||.5)*2,n.pressure=r.force||.5,n.isPrimary=es(r),n.pointerType=Vu,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey,t.preventDefault&&(n.preventDefault=function(){t.preventDefault()}),n}function ru(e){var r=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(r=1),r}var la=null;function es(e){return la===e.identifier}function sl(e){la===null&&(la=e.identifier)}function Pl(e){la===e.identifier&&(la=null)}function Gu(e){return function(r){for(var t=r.changedTouches,n=0;n<t.length;n++){var i=t[n];n===0&&e==="pointerdown"?sl(i):(e==="pointerup"||e==="pointercancel")&&Pl(i);var s=Vf(e,i,r);Ps.dispatchEvent(s)}}}var Hu=Gu("pointerdown"),nu=Gu("pointermove"),Tc=Gu("pointerup");function Wu(e){var r=vf();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mc=function(e){bn()(t,e);var r=Wu(t);function t(n){return dt()(this,t),r.call(this,n)}return yt()(t)}(Ca);function sc(e){return function(r){r.type=e,Ps.dispatchEvent(r)}}var Dh=sc("mousedown"),mf=sc("mousemove"),Pc=sc("mouseup"),fh=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Zl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),_a=fh||Zl,gf={atob:ni,btoa:xi,devicePixelRatio:Sl,Blob:fu,document:Ps,Element:sh,Event:Ca,EventTarget:Bu,HTMLCanvasElement:af,HTMLElement:zu,HTMLMediaElement:nc,HTMLVideoElement:Bf,Image:ic,ImageData:of,navigator:oc,Node:Cl,requestAnimationFrame:Hl,cancelAnimationFrame:Fo,screen:Js,XMLHttpRequest:lo,performance:Su,URL:zf,WebGLRenderingContext:Go,WebGL2RenderingContext:cf,addEventListener:function(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Ps.addEventListener(r,t,n)},removeEventListener:function(r,t,n){Ps.removeEventListener(r,t)},dispatchEvent:function(r){Ps.dispatchEvent(r)},innerWidth:Js.availWidth,innerHeight:Js.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Wn=_a?gf:Ha,Au=_a?lo:Ha.XMLHttpRequest,Fh=_a?Tl:Ha.location;function uc(e){var r=e;return typeof e=="string"&&(r=Wn.document.getElementById(e)),r}function Xl(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function yf(e){return Xl(e).split(/\s+/)}function h(e){var r,t,n=Wn==null||(r=Wn.document)===null||r===void 0||(t=r.documentElement)===null||t===void 0?void 0:t.style;if(!n)return e[0];for(var i in e)if(e[i]&&e[i]in n)return e[i];return e[0]}function f(e,r,t){var n=Wn.document.createElement(e);return n.className=r||"",t&&t.appendChild(n),n}function c(e){var r=e.parentNode;r&&r.removeChild(e)}function d(e,r){if(e.classList!==void 0)for(var t=yf(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!A(e,r)){var s=k(e);I(e,(s?s+" ":"")+r)}}function E(e,r){e.classList!==void 0?e.classList.remove(r):I(e,Xl((" "+k(e)+" ").replace(" "+r+" "," ")))}function A(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=k(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function I(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function k(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function V(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Y=h(["transform","WebkitTransform"]);function ce(e,r){e.style[Y]=r}function ve(){if(typeof Event=="function")Wn.dispatchEvent(new Event("resize"));else{var e=Wn.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Wn,0),Wn.dispatchEvent(e)}}function ye(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function ze(){var e,r=Wn.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var s=i.split("="),l=ft()(s,2),v=l[0],g=l[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var Fe=ze()<1?1:Wn.devicePixelRatio,$e=O("oShl"),Ne=O.n($e);function Ze(e){var r=St();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function St(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mt=function(e){bn()(t,e);var r=Ze(t);function t(n,i,s){var l;return dt()(this,t),l=r.call(this,n),w()(ue()(l),"status",void 0),w()(ue()(l),"url",void 0),l.status=i,l.url=s,l.name=l.constructor.name,l.message=n,l}return yt()(t,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),t}(Ne()(Error));function lr(e){var r=new Au;r.open("GET",e.url,!0);for(var t in e.headers)e.headers.hasOwnProperty(t)&&r.setRequestHeader(t,e.headers[t]);return r.withCredentials=e.credentials==="include",r}var Qt=function(r,t){var n=lr(r);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var i;try{i=JSON.parse(n.response)}catch(s){return t(s)}t(null,i)}else n.status===401?t(new mt("".concat(n.statusText),n.status,r.url)):t(new mt(n.statusText,n.status,r.url))},n.send(),n},fr=function(r,t){var n=lr(r);return n.responseType="arraybuffer",n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){var i=n.response;if(i.byteLength===0&&n.status===200)return t(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?t(null,{data:i,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):t(new mt(n.statusText,n.status,r.url))},n.send(),n};function _r(e){var r=Wn.document.createElement("a");return r.href=e,r.protocol===Wn.document.location.protocol&&r.host===Wn.document.location.host}var Yr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",$r=function(r,t){return fr(r,function(n,i){if(n)t(n);else if(i){var s=new Wn.Image;s.crossOrigin="anonymous";var l=Wn.URL||Wn.webkitURL;s.onload=function(){t(null,s),l.revokeObjectURL(s.src)};var v=new Wn.Blob([new Uint8Array(i.data)],{type:"image/png"});s.src=i.data.byteLength?l.createObjectURL(v):Yr}})},cn=2*Math.PI*6378137/2;function Zn(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;ai(r,n)}),r}function ai(e,r){return Array.isArray(r[0])?r.forEach(function(t){ai(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function pi(e,r){return Ui(e,r)}function Ui(e,r){return Array.isArray(e[0])?e.map(function(t){return Ui(t,r)}):r(e)}function zi(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=ei(e,r);var n=e[0],i=e[1],s=n*cn/180,l=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return l=l*cn/180,t.enable&&(s=Number(s.toFixed(t.decimal)),l=Number(l.toFixed(t.decimal))),e.length===3?[s,l,e[2]]:[s,l]}function Bn(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/cn*180,s=n/cn*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),s=Number(s.toFixed(r))),e.length===3?[i,s,e[2]]:[i,s]}function Ei(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Oi(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function ei(e,r){if(r===!1)return e;var t=Ei(e[0]),n=Oi(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function vi(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,s=e[0]*i,l=t*i;l=Math.log(Math.tan(Math.PI/4+l/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return i=.5,s=n*(v*s+g),l=n*(x*l+i),[Math.floor(s),Math.floor(l)]}function fi(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,s=256<<20,l=ft()(e,2),v=l[0],g=l[1];v=(v/s-t)/r,g=(g/s-i)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,i=Math.PI/180;var x=g/i,C=v/i;return[C,x]}function Di(e,r,t){var n=go(r[1]-e[1]),i=go(r[0]-e[0]),s=go(e[1]),l=go(r[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(s)*Math.cos(l);return Nl(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),t="meters")}function Ji(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),s=Math.sin(i*r),l=n*e[0]*r,v=n*Math.log((1+s)/(1-s))/2;return[l,v]}function yo(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function co(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function Bo(e){return[[e[0],e[1]],[e[2],e[3]]]}function $a(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function fo(e,r){return e[0]*r[0]+e[1]*r[1]}function Rs(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function fs(e,r){return Math.acos(fo(e,r)/(Rs(e)*Rs(r)))*180/Math.PI}function Ol(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function Il(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],s=0;s<e.length-1;s++){var l=e[s],v=e[s+1],g=$a(l,v);n+=g;var x=[l[0]-v[0],l[1]-v[1]],C=Ol(t,x);if(s>0){var T=i[s-1].rotation;T-C>360-T+C&&(C=C+360)}i.push({start:l,end:v,dis:g,rotation:C,duration:0})}return i.map(function(R){R.duration=r*(R.dis/n)}),i}}var Es=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;dt()(this,e),w()(this,"limit",void 0),w()(this,"cache",void 0),w()(this,"destroy",void 0),w()(this,"order",void 0),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return yt()(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function ts(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}var lc=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;dt()(this,e),w()(this,"duration",16),w()(this,"timestamp",new Date().getTime()),this.duration=r}return yt()(e,[{key:"run",value:function(t){var n=new Date().getTime(),i=n-this.timestamp;this.timestamp=n,i>=this.duration&&t()}}]),e}(),cc=function(e,r,t){e.prototype=r.prototype=t,t.constructor=e};function Zu(e,r){var t=Object.create(e.prototype);for(var n in r)t[n]=r[n];return t}function Tu(){}var Mu=.7,iu=1/Mu,Xu="\\s*([+-]?\\d+)\\s*",Gs="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",La="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Yu=/^#([0-9a-f]{3,8})$/,_f=new RegExp("^rgb\\("+[Xu,Xu,Xu]+"\\)$"),Rl=new RegExp("^rgb\\("+[La,La,La]+"\\)$"),Wo=new RegExp("^rgba\\("+[Xu,Xu,Xu,Gs]+"\\)$"),ks=new RegExp("^rgba\\("+[La,La,La,Gs]+"\\)$"),Zo=new RegExp("^hsl\\("+[Gs,La,La]+"\\)$"),Hs=new RegExp("^hsla\\("+[Gs,La,La,Gs]+"\\)$"),hs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};cc(Tu,vu,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:Ls,formatHex:Ls,formatHsl:xf,formatRgb:kl,toString:kl});function Ls(){return this.rgb().formatHex()}function xf(){return Ef(this).formatHsl()}function kl(){return this.rgb().formatRgb()}function vu(e){var r,t;return e=(e+"").trim().toLowerCase(),(r=Yu.exec(e))?(t=r[1].length,r=parseInt(r[1],16),t===6?$u(r):t===3?new Ua(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):t===8?Ku(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):t===4?Ku(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=_f.exec(e))?new Ua(r[1],r[2],r[3],1):(r=Rl.exec(e))?new Ua(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=Wo.exec(e))?Ku(r[1],r[2],r[3],r[4]):(r=ks.exec(e))?Ku(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=Zo.exec(e))?Bh(r[1],r[2]/100,r[3]/100,1):(r=Hs.exec(e))?Bh(r[1],r[2]/100,r[3]/100,r[4]):hs.hasOwnProperty(e)?$u(hs[e]):e==="transparent"?new Ua(NaN,NaN,NaN,0):null}function $u(e){return new Ua(e>>16&255,e>>8&255,e&255,1)}function Ku(e,r,t,n){return n<=0&&(e=r=t=NaN),new Ua(e,r,t,n)}function Pu(e){return e instanceof Tu||(e=vu(e)),e?(e=e.rgb(),new Ua(e.r,e.g,e.b,e.opacity)):new Ua}function ps(e,r,t,n){return arguments.length===1?Pu(e):new Ua(e,r,t,n==null?1:n)}function Ua(e,r,t,n){this.r=+e,this.g=+r,this.b=+t,this.opacity=+n}cc(Ua,ps,Zu(Tu,{brighter:function(r){return r=r==null?iu:Math.pow(iu,r),new Ua(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?Mu:Math.pow(Mu,r),new Ua(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:hh,formatHex:hh,formatRgb:bf,toString:bf}));function hh(){return"#"+ph(this.r)+ph(this.g)+ph(this.b)}function bf(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function ph(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Bh(e,r,t,n){return n<=0?e=r=t=NaN:t<=0||t>=1?e=r=NaN:r<=0&&(e=NaN),new ul(e,r,t,n)}function Ef(e){if(e instanceof ul)return new ul(e.h,e.s,e.l,e.opacity);if(e instanceof Tu||(e=vu(e)),!e)return new ul;if(e instanceof ul)return e;e=e.rgb();var r=e.r/255,t=e.g/255,n=e.b/255,i=Math.min(r,t,n),s=Math.max(r,t,n),l=NaN,v=s-i,g=(s+i)/2;return v?(r===s?l=(t-n)/v+(t<n)*6:t===s?l=(n-r)/v+2:l=(r-t)/v+4,v/=g<.5?s+i:2-s-i,l*=60):v=g>0&&g<1?0:l,new ul(l,v,g,e.opacity)}function Gf(e,r,t,n){return arguments.length===1?Ef(e):new ul(e,r,t,n==null?1:n)}function ul(e,r,t,n){this.h=+e,this.s=+r,this.l=+t,this.opacity=+n}cc(ul,Gf,Zu(Tu,{brighter:function(r){return r=r==null?iu:Math.pow(iu,r),new ul(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?Mu:Math.pow(Mu,r),new ul(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,s=2*n-i;return new Ua(bp(r>=240?r-240:r+120,s,i),bp(r,s,i),bp(r<120?r+240:r-120,s,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function bp(e,r,t){return(e<60?r+(t-r)*e/60:e<180?t:e<240?r+(t-r)*(240-e)/60:r)*255}function dh(e){return typeof e=="string"?!!vu(e):!1}function Ka(e){var r=vu(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function Ou(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function fc(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Oc(e){var r=Wn.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=t.createLinearGradient(0,0,256,1),i=null,s=e.positions[0],l=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(l-s);n.addColorStop(g,e.colors[v])}return t.fillStyle=n,t.fillRect(0,0,256,1),i=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),_a?{data:i,width:256,height:1}:new ImageData(i,256,1)}var Hf;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Hf||(Hf={}));var Nh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function xd(e,r,t){var n=e.classList;for(var i in Nh)Nh.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}function rs(e,r){return{enable:e,mask:255,func:{cmp:514,ref:r?1:0,mask:255}}}function bd(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function Ed(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function vh(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function Sd(e){if(e.length===0)throw new Error("mean requires at least one data point");return vh(e)/e.length}function Sf(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,s=1;s<e.length+1;s++)e[s]!==r?(i>n&&(n=i,t=r),i=1,r=e[s]):i++;return t*1}var Cd={min:Ed,max:bd,mean:Sd,sum:vh,mode:Sf};function No(e,r){return e.map(function(t){return t[r]})}function zh(e,r){return Cd[e](r)}function Ep(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=new Promise(function(l){Uh(e,function(v){l(v)})}),s={originData:e,images:i,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Uh(e,r){var t=e,n=[];if(typeof t=="string")$r({url:t},function(l,v){n.push(v),r(n)});else{var i=t.length,s=0;t.forEach(function(l){$r({url:l},function(v,g){s++,n.push(g),s===i&&r(n)})})}return Ep}function Wf(e,r){var t=r.extent,n=r.width,i=r.height,s=r.min,l=r.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:i,min:s,max:l,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return v}var Ic=O("JBE3"),mh=O.n(Ic),gh=O("4qC0"),Ws=O.n(gh),Zf=O("lSCD"),ll=O.n(Zf),jh=O("BkRI"),Yl=O.n(jh),Ds=O("xp6e"),Zs=O("uhBA"),Vh=O.n(Zs),Cf=O("mpbz"),Rc=O.n(Cf);function au(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Xf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?au(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):au(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Yf(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,s=i===void 0?18:i,l=r.minZoom,v=l===void 0?0:l,g=r.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=Sp(C),e}var T=new Rc.a({radius:n,minZoom:v,maxZoom:s}),R={type:"FeatureCollection",features:[]};return R.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:Xf({},F)}}),T.load(R.features),T}function Sp(e){return e.map(function(r,t){return Xf({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function yh(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function kc(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function Lc(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function Cp(e){if(e.length===0)throw new Error("mean requires at least one data point");return Lc(e)/e.length}var bv={min:kc,max:yh,mean:Cp,sum:Lc};function wd(e,r){return e.map(function(t){return t[r]*1})}function wp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ll(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?wp(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):wp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ad(e){var r=wf();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function wf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Td(e,r){if(Array.isArray(r))return r}var Ap=function(e){bn()(t,e);var r=Ad(t);function t(n,i){var s;return dt()(this,t),s=r.call(this),w()(ue()(s),"data",void 0),w()(ue()(s),"extent",void 0),w()(ue()(s),"hooks",{init:new Ds.c}),w()(ue()(s),"parser",{type:"geojson"}),w()(ue()(s),"transforms",[]),w()(ue()(s),"cluster",!1),w()(ue()(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),w()(ue()(s),"mapService",void 0),w()(ue()(s),"invalidExtent",!1),w()(ue()(s),"dataArrayChanged",!1),w()(ue()(s),"originData",void 0),w()(ue()(s),"rawData",void 0),w()(ue()(s),"cfg",{}),w()(ue()(s),"clusterIndex",void 0),s.originData=n,s.initCfg(i),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return yt()(t,[{key:"setData",value:function(i,s){this.originData=i,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"updateClusterData",value:function(i){var s=this,l=this.clusterOptions,v=l.method,g=v===void 0?"sum":v,x=l.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||ll()(g))&&(C=C.map(function(T){var R=T.id;if(R){var F=s.clusterIndex.getLeaves(R,Infinity),H=F.map(function(be){return be.properties}),Q;if(Ws()(g)&&x){var ie=wd(H,x);Q=bv[g](ie)}ll()(g)&&(Q=g(H)),T.properties.stat=Q}else T.properties.point_count=1;return T})),this.data=Wa("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var s=this.parser.type,l=s===void 0?"geojson":s;if(l==="geojson"&&!this.cluster){var v=i<this.originData.features.length?this.originData.features[i]:"null",g=Yl()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===i});g.properties=x}return g}else return i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,s){this.data.dataArray=this.data.dataArray.map(function(l){return l._id===i?Ll(Ll({},l),s):l}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(i,s){var l=this.data.dataArray.find(function(v){return v[i]===s});return l==null?void 0:l._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(i){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=yo(Bo(this.extent),i)),s[0].concat(s[1])}},{key:"initCfg",value:function(i){this.cfg=mh()(this.cfg,i,Td);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=Ll(Ll({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var i=this.parser,s=i.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var l=Wa(s);this.data=l(this.originData,i),this.extent=Zn(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var i=this,s=this.transforms;s.forEach(function(l){var v=l.type,g=As(v)(i.data,l);Object.assign(i.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=Yf(this.data,i)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),t}(Zs.EventEmitter);function $f(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function cl(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$l(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function $l(e,r){if(!!e){if(typeof e=="string")return Tp(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Tp(e,r)}}function Tp(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Dc=6378e3;function fl(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,s=i/(2*Math.PI*Dc)*(256<<20)/2,l=Mp(t,i),v=l.gridHash,g=l.gridOffset,x=ds(v,g,r);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Mp(e,r){var t=Infinity,n=-Infinity,i,s=cl(e),l;try{for(s.s();!(l=s.n()).done;){var v=l.value;i=v.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(Je){s.e(Je)}finally{s.f()}var g=(t+n)/2,x=Pp(r,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=cl(e),R;try{for(T.s();!(R=T.n()).done;){var F=R.value,H=F.coordinates[1],Q=F.coordinates[0];if(Number.isFinite(H)&&Number.isFinite(Q)){var ie=Math.floor((H+90)/x.yOffset),be=Math.floor((Q+180)/x.xOffset),je="".concat(ie,"-").concat(be);C[je]=C[je]||{count:0,points:[]},C[je].count+=1,C[je].points.push(F)}}}catch(Je){T.e(Je)}finally{T.f()}return{gridHash:C,gridOffset:x}}function Pp(e,r){var t=Gh(e),n=Md(r,e);return{yOffset:t,xOffset:n}}function Gh(e){return e/Dc*(180/Math.PI)}function Md(e,r){return r/Dc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function ds(e,r,t){return Object.keys(e).reduce(function(n,i,s){var l=i.split("-"),v=parseInt(l[0],10),g=parseInt(l[1],10),x={};if(t.field&&t.method){var C=re.getColumn(e[i].points,t.field);x[t.method]=re.statMap[t.method](C)}return Object.assign(x,{_id:s,coordinates:vi([-180+r.xOffset*(g+.5),-90+r.yOffset*(v+.5)]),rawData:e[i].points,count:e[i].count}),n.push(x),n},[])}var Iu=Math.PI/3,ba=[0,Iu,2*Iu,3*Iu,4*Iu,5*Iu];function Ru(e){return e[0]}function Op(e){return e[1]}var Pd=function(){var e=0,r=0,t=1,n=1,i=Ru,s=Op,l,v,g;function x(T){var R={},F=[],H,Q=T.length;for(H=0;H<Q;++H)if(!(isNaN(be=+i.call(null,ie=T[H],H,T))||isNaN(je=+s.call(null,ie,H,T)))){var ie,be,je,Je=Math.round(je=je/g),et=Math.round(be=be/v-(Je&1)/2),bt=je-Je;if(Math.abs(bt)*3>1){var Et=be-et,kt=et+(be<et?-1:1)/2,jt=Je+(je<Je?-1:1),mr=be-kt,Ar=je-jt;Et*Et+bt*bt>mr*mr+Ar*Ar&&(et=kt+(Je&1?1:-1)/2,Je=jt)}var pr=et+"-"+Je,pn=R[pr];pn?pn.push(ie):(F.push(pn=R[pr]=[ie]),pn.x=(et+(Je&1)/2)*v,pn.y=Je*g)}return F}function C(T){var R=0,F=0;return ba.map(function(H){var Q=Math.sin(H)*T,ie=-Math.cos(H)*T,be=Q-R,je=ie-F;return R=Q,F=ie,[be,je]})}return x.hexagon=function(T){return"m"+C(T==null?l:+T).join("l")+"z"},x.centers=function(){for(var T=[],R=Math.round(r/g),F=Math.round(e/v),H=R*g;H<n+l;H+=g,++R)for(var Q=F*v+(R&1)*v/2;Q<t+v/2;Q+=v)T.push([Q,H]);return T},x.mesh=function(){var T=C(l).slice(0,4).join("l");return x.centers().map(function(R){return"M"+R+"m"+T}).join("")},x.x=function(T){return arguments.length?(i=T,x):i},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(l=+T,v=l*2*Math.sin(Iu),g=l*1.5,x):l},x.size=function(T){return arguments.length?(e=r=0,t=+T[0],n=+T[1],x):[t-e,n-r]},x.extent=function(T){return arguments.length?(e=+T[0][0],r=+T[0][1],t=+T[1][0],n=+T[1][1],x):[[e,r],[t,n]]},x.radius(1)};function Od(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ip(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Od(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Od(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Ev=6378e3;function Id(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,s=r.method,l=s===void 0?"sum":s,v=i/(2*Math.PI*Ev)*(256<<20)/2,g=t.map(function(R){var F=vi(R.coordinates),H=ft()(F,2),Q=H[0],ie=H[1];return Ip(Ip({},R),{},{coordinates:[Q,ie]})}),x=Pd().radius(v).x(function(R){return R.coordinates[0]}).y(function(R){return R.coordinates[1]}),C=x(g),T={dataArray:C.map(function(R,F){var H;if(r.field&&l){var Q=re.getColumn(R,r.field);R[l]=re.statMap[l](Q)}return H={},w()(H,r.method,R[l]),w()(H,"count",R.length),w()(H,"rawData",R),w()(H,"coordinates",[R.x,R.y]),w()(H,"_id",F),H}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Rd(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Rp(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Rd(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Rd(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Sv(e,r){var t=r.sourceField,n=r.targetField,i=r.data,s={};return i.forEach(function(l){s[l[t]]=l}),e.dataArray=e.dataArray.map(function(l){var v=l[n];return Rp(Rp({},l),s[v])}),e}function Cv(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}ma("geojson",te),ma("image",Ep),ma("csv",ca),ma("json",Mo),ma("raster",Wf),js("cluster",Yf),js("filter",$f),js("join",Sv),js("map",Cv),js("grid",fl),js("hexagon",Id);var _h=ra,kp=to,Lp=Ap,Hh=O("mNvP"),vr=O("4cb6"),kd=O("APxj"),Kl=O.n(kd),Yt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},X=O("TIQr"),ae=O.n(X);function Ge(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Vt(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ge(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ge(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function hr(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=nr(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function nr(e,r){if(!!e){if(typeof e=="string")return Jt(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Jt(e,r)}}function Jt(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var wr=30;function jr(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,s=e.maxCanvasWidth,l=e.mapping,v=l===void 0?{}:l,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,R=0,F=x;Array.from(r).forEach(function(Q,ie){if(!v[Q]){var be=t(Q,ie);F+wr>s&&(F=0,R++),v[Q]={x:F,y:T+R*wr,width:wr,height:wr,advance:be},F+=wr}});var H=n+i*2;return{mapping:v,xOffset:F,yOffset:T+R*H,canvasHeight:Gr(T+(R+1)*H)}}function Vr(e,r,t){var n=0,i=0,s=0,l=[],v={},g=hr(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+r>t&&(Xr(v,l,i),n=0,i=s+i+r,s=0,l=[]),l.push({icon:C,xOffset:n}),n=n+T+r,s=Math.max(s,T)}}}catch(F){g.e(F)}finally{g.f()}l.length>0&&Xr(v,l,i);var R=Gr(s+i+r);return{mapping:v,canvasHeight:R}}function Xr(e,r,t){var n=hr(r),i;try{for(n.s();!(i=n.n()).done;){var s=i.value,l=s.icon,v=s.xOffset;e[l.id]=Vt(Vt({},l),{},{x:v,y:t,image:l.image,width:l.width,height:l.height})}}catch(g){n.e(g)}finally{n.f()}}function Gr(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var fn,rn;function zr(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Gt(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function Gt(e,r){if(!!e){if(typeof e=="string")return Ht(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ht(e,r)}}function Ht(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Br(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Sn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Br(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Br(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var cr=Si(),Dn="sans-serif",Rn="normal",Qr=24,xr=3,ar=.25,an=8,ln=1024,Wr=1,vn=1,hn=3,Ii=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function Si(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function yn(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function En(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var hi=(fn=Object(vr.injectable)(),fn(rn=function(){function e(){dt()(this,e),w()(this,"fontAtlas",void 0),w()(this,"iconFontMap",void 0),w()(this,"iconFontGlyphs",{}),w()(this,"fontOptions",void 0),w()(this,"key",void 0),w()(this,"cache",new Es(hn))}return yt()(e,[{key:"scale",get:function(){return vn}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Dn,fontWeight:Rn,characterSet:cr,fontSize:Qr,buffer:xr,sdf:!0,cutoff:ar,radius:an,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var n=this;t.forEach(function(i){n.iconFontGlyphs[i.name]=i.unicode})}},{key:"addIconFont",value:function(t,n){this.iconFontMap.set(t,n)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=Sn(Sn({},this.fontOptions),t),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),i=this.cache.get(this.key);if(!(i&&n.length===0)){var s=this.generateFontAtlas(this.key,n,i);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,n,i){var s=this.fontOptions,l=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,R=s.cutoff,F=s.iconfont,H=i&&i.data;H||(H=Wn.document.createElement("canvas"),H.width=ln);var Q=H.getContext("2d");yn(Q,l,g,v);var ie=jr(Sn({getFontWidth:function(ko){return Q.measureText(ko).width},fontHeight:g*vn,buffer:x,characterSet:n,maxCanvasWidth:ln},i&&{mapping:i.mapping,xOffset:i.xOffset,yOffset:i.yOffset})),be=ie.mapping,je=ie.canvasHeight,Je=ie.xOffset,et=ie.yOffset,bt=Q.getImageData(0,0,H.width,H.height);if(H.height=je,Q.putImageData(bt,0,0),yn(Q,l,g,v),C){var Et=new ae.a(g,x,T,R,l,v),kt=Q.getImageData(0,0,Et.size,Et.size),jt=zr(n),mr;try{for(jt.s();!(mr=jt.n()).done;){var Ar=mr.value;if(F){var pr=String.fromCharCode(parseInt(Ar.replace("&#x","").replace(";",""),16)),pn=Et.draw(pr);En(pn,kt)}else En(Et.draw(Ar),kt);Q.putImageData(kt,be[Ar].x,be[Ar].y)}}catch(oo){jt.e(oo)}finally{jt.f()}}else{var Tn=zr(n),Jn;try{for(Tn.s();!(Jn=Tn.n()).done;){var va=Jn.value;Q.fillText(va,be[va].x,be[va].y+g*Wr)}}catch(oo){Tn.e(oo)}finally{Tn.f()}}return{xOffset:Je,yOffset:et,mapping:be,data:H,width:H.width,height:H.height}}},{key:"getKey",value:function(){return"key";var t,n,i,s,l,v,g,x}},{key:"getNewChars",value:function(t,n){var i=this.cache.get(t);if(!i)return n;var s=[],l=i.mapping,v=new Set(Object.keys(l)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||rn),Ci,Yi;function ho(e){var r=Ao();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Ao(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ki=3,ns=1024,Pa=64,Xo=(Ci=Object(vr.injectable)(),Ci(Yi=function(e){bn()(t,e);var r=ho(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"canvasHeight",128),w()(ue()(n),"texture",void 0),w()(ue()(n),"canvas",void 0),w()(ue()(n),"iconData",void 0),w()(ue()(n),"iconMap",void 0),w()(ue()(n),"ctx",void 0),w()(ue()(n),"loadingImageCount",0),n}return yt()(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Wn.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(i,s){var l=this,v=new Image;if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Pa}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=l.iconData.find(function(C){return C.id===i});x&&(x.image=v,x.width=v.width,x.height=v.height),l.update()})}},{key:"addImageMini",value:function(i,s,l){var v=this,g=l.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Pa}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(R){return R.id===i});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(s){return s.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=ns,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var l=i.iconMap[s],v=l.x,g=l.y,x=l.image,C=l.width,T=C===void 0?64:C,R=l.height,F=R===void 0?64:R,H=Math.max(T,F),Q=H/Pa,ie=F/Q,be=T/Q;x&&i.ctx.drawImage(x,v+(Pa-be)/2,g+(Pa-ie)/2,be,ie)})}},{key:"updateIconMap",value:function(){var i=Vr(this.iconData,Ki,ns),s=i.mapping,l=i.canvasHeight;this.iconMap=s,this.canvasHeight=l}},{key:"loadImage",value:function(i){return new Promise(function(s,l){if(i instanceof HTMLImageElement){s(i);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){l(new Error("Could not load image at "+i))},v.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"loadImageMini",value:function(i,s){return new Promise(function(l,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){l(g)},g.onerror=function(){v(new Error("Could not load image at "+i))},g.src=i})}}]),t}(Zs.EventEmitter))||Yi),Ai=1e-6,aa=typeof Float32Array!="undefined"?Float32Array:Array,_o=Math.random;function Fs(e){aa=e}var xo=Math.PI/180;function ji(e){return e*xo}function is(e,r){return Math.abs(e-r)<=Ai*Math.max(1,Math.abs(e),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function Ea(){var e=new aa(4);return aa!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function zo(e){var r=new aa(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function mi(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Fi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Da(e,r,t,n){var i=new aa(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Bs(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function Ss(e,r){if(e===r){var t=r[1];e[1]=r[2],e[2]=t}else e[0]=r[0],e[1]=r[2],e[2]=r[1],e[3]=r[3];return e}function De(e,r){var t=r[0],n=r[1],i=r[2],s=r[3],l=t*s-i*n;return l?(l=1/l,e[0]=s*l,e[1]=-n*l,e[2]=-i*l,e[3]=t*l,e):null}function er(e,r){var t=r[0];return e[0]=r[3],e[1]=-r[1],e[2]=-r[2],e[3]=t,e}function Ft(e){return e[0]*e[3]-e[2]*e[1]}function Pn(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3],v=t[0],g=t[1],x=t[2],C=t[3];return e[0]=n*v+s*g,e[1]=i*v+l*g,e[2]=n*x+s*C,e[3]=i*x+l*C,e}function Vi(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3],v=Math.sin(t),g=Math.cos(t);return e[0]=n*g+s*v,e[1]=i*g+l*v,e[2]=n*-v+s*g,e[3]=i*-v+l*g,e}function we(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3],v=t[0],g=t[1];return e[0]=n*v,e[1]=i*v,e[2]=s*g,e[3]=l*g,e}function de(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=-t,e[3]=n,e}function Qe(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=r[1],e}function Pt(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Kt(e){return Math.hypot(e[0],e[1],e[2],e[3])}function ot(e,r,t,n){return e[2]=n[2]/n[0],t[0]=n[0],t[1]=n[1],t[3]=n[3]-e[2]*t[1],[e,r,t]}function tt(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function ct(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function me(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Ke(e,r){var t=e[0],n=e[1],i=e[2],s=e[3],l=r[0],v=r[1],g=r[2],x=r[3];return Math.abs(t-l)<=Ai*Math.max(1,Math.abs(t),Math.abs(l))&&Math.abs(n-v)<=Ai*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-g)<=Ai*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(s-x)<=Ai*Math.max(1,Math.abs(s),Math.abs(x))}function Ae(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function At(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}var zt=Pn,Mr=ct;function on(){var e=new aa(16);return aa!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function sn(e){var r=new aa(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Cn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function en(e,r,t,n,i,s,l,v,g,x,C,T,R,F,H,Q){var ie=new aa(16);return ie[0]=e,ie[1]=r,ie[2]=t,ie[3]=n,ie[4]=i,ie[5]=s,ie[6]=l,ie[7]=v,ie[8]=g,ie[9]=x,ie[10]=C,ie[11]=T,ie[12]=R,ie[13]=F,ie[14]=H,ie[15]=Q,ie}function $n(e,r,t,n,i,s,l,v,g,x,C,T,R,F,H,Q,ie){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=s,e[5]=l,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=R,e[12]=F,e[13]=H,e[14]=Q,e[15]=ie,e}function On(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jn(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],s=r[6],l=r[7],v=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=s,e[11]=r[14],e[12]=i,e[13]=l,e[14]=v}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function Vn(e,r){var t=r[0],n=r[1],i=r[2],s=r[3],l=r[4],v=r[5],g=r[6],x=r[7],C=r[8],T=r[9],R=r[10],F=r[11],H=r[12],Q=r[13],ie=r[14],be=r[15],je=t*v-n*l,Je=t*g-i*l,et=t*x-s*l,bt=n*g-i*v,Et=n*x-s*v,kt=i*x-s*g,jt=C*Q-T*H,mr=C*ie-R*H,Ar=C*be-F*H,pr=T*ie-R*Q,pn=T*be-F*Q,Tn=R*be-F*ie,Jn=je*Tn-Je*pn+et*pr+bt*Ar-Et*mr+kt*jt;return Jn?(Jn=1/Jn,e[0]=(v*Tn-g*pn+x*pr)*Jn,e[1]=(i*pn-n*Tn-s*pr)*Jn,e[2]=(Q*kt-ie*Et+be*bt)*Jn,e[3]=(R*Et-T*kt-F*bt)*Jn,e[4]=(g*Ar-l*Tn-x*mr)*Jn,e[5]=(t*Tn-i*Ar+s*mr)*Jn,e[6]=(ie*et-H*kt-be*Je)*Jn,e[7]=(C*kt-R*et+F*Je)*Jn,e[8]=(l*pn-v*Ar+x*jt)*Jn,e[9]=(n*Ar-t*pn-s*jt)*Jn,e[10]=(H*Et-Q*et+be*je)*Jn,e[11]=(T*et-C*Et-F*je)*Jn,e[12]=(v*mr-l*pr-g*jt)*Jn,e[13]=(t*pr-n*mr+i*jt)*Jn,e[14]=(Q*Je-H*bt-ie*je)*Jn,e[15]=(C*bt-T*Je+R*je)*Jn,e):null}function Xn(e,r){var t=r[0],n=r[1],i=r[2],s=r[3],l=r[4],v=r[5],g=r[6],x=r[7],C=r[8],T=r[9],R=r[10],F=r[11],H=r[12],Q=r[13],ie=r[14],be=r[15];return e[0]=v*(R*be-F*ie)-T*(g*be-x*ie)+Q*(g*F-x*R),e[1]=-(n*(R*be-F*ie)-T*(i*be-s*ie)+Q*(i*F-s*R)),e[2]=n*(g*be-x*ie)-v*(i*be-s*ie)+Q*(i*x-s*g),e[3]=-(n*(g*F-x*R)-v*(i*F-s*R)+T*(i*x-s*g)),e[4]=-(l*(R*be-F*ie)-C*(g*be-x*ie)+H*(g*F-x*R)),e[5]=t*(R*be-F*ie)-C*(i*be-s*ie)+H*(i*F-s*R),e[6]=-(t*(g*be-x*ie)-l*(i*be-s*ie)+H*(i*x-s*g)),e[7]=t*(g*F-x*R)-l*(i*F-s*R)+C*(i*x-s*g),e[8]=l*(T*be-F*Q)-C*(v*be-x*Q)+H*(v*F-x*T),e[9]=-(t*(T*be-F*Q)-C*(n*be-s*Q)+H*(n*F-s*T)),e[10]=t*(v*be-x*Q)-l*(n*be-s*Q)+H*(n*x-s*v),e[11]=-(t*(v*F-x*T)-l*(n*F-s*T)+C*(n*x-s*v)),e[12]=-(l*(T*ie-R*Q)-C*(v*ie-g*Q)+H*(v*R-g*T)),e[13]=t*(T*ie-R*Q)-C*(n*ie-i*Q)+H*(n*R-i*T),e[14]=-(t*(v*ie-g*Q)-l*(n*ie-i*Q)+H*(n*g-i*v)),e[15]=t*(v*R-g*T)-l*(n*R-i*T)+C*(n*g-i*v),e}function di(e){var r=e[0],t=e[1],n=e[2],i=e[3],s=e[4],l=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],R=e[11],F=e[12],H=e[13],Q=e[14],ie=e[15],be=r*l-t*s,je=r*v-n*s,Je=r*g-i*s,et=t*v-n*l,bt=t*g-i*l,Et=n*g-i*v,kt=x*H-C*F,jt=x*Q-T*F,mr=x*ie-R*F,Ar=C*Q-T*H,pr=C*ie-R*H,pn=T*ie-R*Q;return be*pn-je*pr+Je*Ar+et*mr-bt*jt+Et*kt}function pa(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3],v=r[4],g=r[5],x=r[6],C=r[7],T=r[8],R=r[9],F=r[10],H=r[11],Q=r[12],ie=r[13],be=r[14],je=r[15],Je=t[0],et=t[1],bt=t[2],Et=t[3];return e[0]=Je*n+et*v+bt*T+Et*Q,e[1]=Je*i+et*g+bt*R+Et*ie,e[2]=Je*s+et*x+bt*F+Et*be,e[3]=Je*l+et*C+bt*H+Et*je,Je=t[4],et=t[5],bt=t[6],Et=t[7],e[4]=Je*n+et*v+bt*T+Et*Q,e[5]=Je*i+et*g+bt*R+Et*ie,e[6]=Je*s+et*x+bt*F+Et*be,e[7]=Je*l+et*C+bt*H+Et*je,Je=t[8],et=t[9],bt=t[10],Et=t[11],e[8]=Je*n+et*v+bt*T+Et*Q,e[9]=Je*i+et*g+bt*R+Et*ie,e[10]=Je*s+et*x+bt*F+Et*be,e[11]=Je*l+et*C+bt*H+Et*je,Je=t[12],et=t[13],bt=t[14],Et=t[15],e[12]=Je*n+et*v+bt*T+Et*Q,e[13]=Je*i+et*g+bt*R+Et*ie,e[14]=Je*s+et*x+bt*F+Et*be,e[15]=Je*l+et*C+bt*H+Et*je,e}function Po(e,r,t){var n=t[0],i=t[1],s=t[2],l,v,g,x,C,T,R,F,H,Q,ie,be;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*s+r[12],e[13]=r[1]*n+r[5]*i+r[9]*s+r[13],e[14]=r[2]*n+r[6]*i+r[10]*s+r[14],e[15]=r[3]*n+r[7]*i+r[11]*s+r[15]):(l=r[0],v=r[1],g=r[2],x=r[3],C=r[4],T=r[5],R=r[6],F=r[7],H=r[8],Q=r[9],ie=r[10],be=r[11],e[0]=l,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=R,e[7]=F,e[8]=H,e[9]=Q,e[10]=ie,e[11]=be,e[12]=l*n+C*i+H*s+r[12],e[13]=v*n+T*i+Q*s+r[13],e[14]=g*n+R*i+ie*s+r[14],e[15]=x*n+F*i+be*s+r[15]),e}function Xs(e,r,t){var n=t[0],i=t[1],s=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=r[11]*s,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function ql(e,r,t,n){var i=n[0],s=n[1],l=n[2],v=Math.hypot(i,s,l),g,x,C,T,R,F,H,Q,ie,be,je,Je,et,bt,Et,kt,jt,mr,Ar,pr,pn,Tn,Jn,va;return v<Ai?null:(v=1/v,i*=v,s*=v,l*=v,g=Math.sin(t),x=Math.cos(t),C=1-x,T=r[0],R=r[1],F=r[2],H=r[3],Q=r[4],ie=r[5],be=r[6],je=r[7],Je=r[8],et=r[9],bt=r[10],Et=r[11],kt=i*i*C+x,jt=s*i*C+l*g,mr=l*i*C-s*g,Ar=i*s*C-l*g,pr=s*s*C+x,pn=l*s*C+i*g,Tn=i*l*C+s*g,Jn=s*l*C-i*g,va=l*l*C+x,e[0]=T*kt+Q*jt+Je*mr,e[1]=R*kt+ie*jt+et*mr,e[2]=F*kt+be*jt+bt*mr,e[3]=H*kt+je*jt+Et*mr,e[4]=T*Ar+Q*pr+Je*pn,e[5]=R*Ar+ie*pr+et*pn,e[6]=F*Ar+be*pr+bt*pn,e[7]=H*Ar+je*pr+Et*pn,e[8]=T*Tn+Q*Jn+Je*va,e[9]=R*Tn+ie*Jn+et*va,e[10]=F*Tn+be*Jn+bt*va,e[11]=H*Tn+je*Jn+Et*va,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Fa(e,r,t){var n=Math.sin(t),i=Math.cos(t),s=r[4],l=r[5],v=r[6],g=r[7],x=r[8],C=r[9],T=r[10],R=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=s*i+x*n,e[5]=l*i+C*n,e[6]=v*i+T*n,e[7]=g*i+R*n,e[8]=x*i-s*n,e[9]=C*i-l*n,e[10]=T*i-v*n,e[11]=R*i-g*n,e}function na(e,r,t){var n=Math.sin(t),i=Math.cos(t),s=r[0],l=r[1],v=r[2],g=r[3],x=r[8],C=r[9],T=r[10],R=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=s*i-x*n,e[1]=l*i-C*n,e[2]=v*i-T*n,e[3]=g*i-R*n,e[8]=s*n+x*i,e[9]=l*n+C*i,e[10]=v*n+T*i,e[11]=g*n+R*i,e}function hl(e,r,t){var n=Math.sin(t),i=Math.cos(t),s=r[0],l=r[1],v=r[2],g=r[3],x=r[4],C=r[5],T=r[6],R=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=s*i+x*n,e[1]=l*i+C*n,e[2]=v*i+T*n,e[3]=g*i+R*n,e[4]=x*i-s*n,e[5]=C*i-l*n,e[6]=T*i-v*n,e[7]=R*i-g*n,e}function qu(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Dp(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pl(e,r,t){var n=t[0],i=t[1],s=t[2],l=Math.hypot(n,i,s),v,g,x;return l<Ai?null:(l=1/l,n*=l,i*=l,s*=l,v=Math.sin(r),g=Math.cos(r),x=1-g,e[0]=n*n*x+g,e[1]=i*n*x+s*v,e[2]=s*n*x-i*v,e[3]=0,e[4]=n*i*x-s*v,e[5]=i*i*x+g,e[6]=s*i*x+n*v,e[7]=0,e[8]=n*s*x+i*v,e[9]=i*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Fp(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wv(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function xh(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kf(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3],v=n+n,g=i+i,x=s+s,C=n*v,T=n*g,R=n*x,F=i*g,H=i*x,Q=s*x,ie=l*v,be=l*g,je=l*x;return e[0]=1-(F+Q),e[1]=T+je,e[2]=R-be,e[3]=0,e[4]=T-je,e[5]=1-(C+Q),e[6]=H+ie,e[7]=0,e[8]=R+be,e[9]=H-ie,e[10]=1-(C+F),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function wm(e,r){var t=new aa(3),n=-r[0],i=-r[1],s=-r[2],l=r[3],v=r[4],g=r[5],x=r[6],C=r[7],T=n*n+i*i+s*s+l*l;return T>0?(t[0]=(v*l+C*n+g*s-x*i)*2/T,t[1]=(g*l+C*i+x*n-v*s)*2/T,t[2]=(x*l+C*s+v*i-g*n)*2/T):(t[0]=(v*l+C*n+g*s-x*i)*2,t[1]=(g*l+C*i+x*n-v*s)*2,t[2]=(x*l+C*s+v*i-g*n)*2),Kf(e,r,t),e}function as(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function Wh(e,r){var t=r[0],n=r[1],i=r[2],s=r[4],l=r[5],v=r[6],g=r[8],x=r[9],C=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(s,l,v),e[2]=Math.hypot(g,x,C),e}function Af(e,r){var t=new aa(3);Wh(t,r);var n=1/t[0],i=1/t[1],s=1/t[2],l=r[0]*n,v=r[1]*i,g=r[2]*s,x=r[4]*n,C=r[5]*i,T=r[6]*s,R=r[8]*n,F=r[9]*i,H=r[10]*s,Q=l+C+H,ie=0;return Q>0?(ie=Math.sqrt(Q+1)*2,e[3]=.25*ie,e[0]=(T-F)/ie,e[1]=(R-g)/ie,e[2]=(v-x)/ie):l>C&&l>H?(ie=Math.sqrt(1+l-C-H)*2,e[3]=(T-F)/ie,e[0]=.25*ie,e[1]=(v+x)/ie,e[2]=(R+g)/ie):C>H?(ie=Math.sqrt(1+C-l-H)*2,e[3]=(R-g)/ie,e[0]=(v+x)/ie,e[1]=.25*ie,e[2]=(T+F)/ie):(ie=Math.sqrt(1+H-l-C)*2,e[3]=(v-x)/ie,e[0]=(R+g)/ie,e[1]=(T+F)/ie,e[2]=.25*ie),e}function Ld(e,r,t,n){var i=r[0],s=r[1],l=r[2],v=r[3],g=i+i,x=s+s,C=l+l,T=i*g,R=i*x,F=i*C,H=s*x,Q=s*C,ie=l*C,be=v*g,je=v*x,Je=v*C,et=n[0],bt=n[1],Et=n[2];return e[0]=(1-(H+ie))*et,e[1]=(R+Je)*et,e[2]=(F-je)*et,e[3]=0,e[4]=(R-Je)*bt,e[5]=(1-(T+ie))*bt,e[6]=(Q+be)*bt,e[7]=0,e[8]=(F+je)*Et,e[9]=(Q-be)*Et,e[10]=(1-(T+H))*Et,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function Dd(e,r,t,n,i){var s=r[0],l=r[1],v=r[2],g=r[3],x=s+s,C=l+l,T=v+v,R=s*x,F=s*C,H=s*T,Q=l*C,ie=l*T,be=v*T,je=g*x,Je=g*C,et=g*T,bt=n[0],Et=n[1],kt=n[2],jt=i[0],mr=i[1],Ar=i[2],pr=(1-(Q+be))*bt,pn=(F+et)*bt,Tn=(H-Je)*bt,Jn=(F-et)*Et,va=(1-(R+be))*Et,oo=(ie+je)*Et,ko=(H+Je)*kt,ss=(ie-je)*kt,eo=(1-(R+Q))*kt;return e[0]=pr,e[1]=pn,e[2]=Tn,e[3]=0,e[4]=Jn,e[5]=va,e[6]=oo,e[7]=0,e[8]=ko,e[9]=ss,e[10]=eo,e[11]=0,e[12]=t[0]+jt-(pr*jt+Jn*mr+ko*Ar),e[13]=t[1]+mr-(pn*jt+va*mr+ss*Ar),e[14]=t[2]+Ar-(Tn*jt+oo*mr+eo*Ar),e[15]=1,e}function Av(e,r){var t=r[0],n=r[1],i=r[2],s=r[3],l=t+t,v=n+n,g=i+i,x=t*l,C=n*l,T=n*v,R=i*l,F=i*v,H=i*g,Q=s*l,ie=s*v,be=s*g;return e[0]=1-T-H,e[1]=C+be,e[2]=R-ie,e[3]=0,e[4]=C-be,e[5]=1-x-H,e[6]=F+Q,e[7]=0,e[8]=R+ie,e[9]=F-Q,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Zh(e,r,t,n,i,s,l){var v=1/(t-r),g=1/(i-n),x=1/(s-l);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(t+r)*v,e[9]=(i+n)*g,e[10]=(l+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=l*s*2*x,e[15]=0,e}function Fc(e,r,t,n,i){var s=1/Math.tan(r/2),l;return e[0]=s/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(l=1/(n-i),e[10]=(i+n)*l,e[14]=2*i*n*l):(e[10]=-1,e[14]=-2*n),e}var Tv=Fc;function Am(e,r,t,n,i){var s=1/Math.tan(r/2),l;return e[0]=s/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(l=1/(n-i),e[10]=i*l,e[14]=i*n*l):(e[10]=-1,e[14]=-n),e}function og(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),s=Math.tan(r.downDegrees*Math.PI/180),l=Math.tan(r.leftDegrees*Math.PI/180),v=Math.tan(r.rightDegrees*Math.PI/180),g=2/(l+v),x=2/(i+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((l-v)*g*.5),e[9]=(i-s)*x*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function vs(e,r,t,n,i,s,l){var v=1/(r-t),g=1/(n-i),x=1/(s-l);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(r+t)*v,e[13]=(i+n)*g,e[14]=(l+s)*x,e[15]=1,e}var qf=vs;function Tm(e,r,t,n,i,s,l){var v=1/(r-t),g=1/(n-i),x=1/(s-l);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(r+t)*v,e[13]=(i+n)*g,e[14]=s*x,e[15]=1,e}function a(e,r,t,n){var i,s,l,v,g,x,C,T,R,F,H=r[0],Q=r[1],ie=r[2],be=n[0],je=n[1],Je=n[2],et=t[0],bt=t[1],Et=t[2];return Math.abs(H-et)<Ai&&Math.abs(Q-bt)<Ai&&Math.abs(ie-Et)<Ai?On(e):(C=H-et,T=Q-bt,R=ie-Et,F=1/Math.hypot(C,T,R),C*=F,T*=F,R*=F,i=je*R-Je*T,s=Je*C-be*R,l=be*T-je*C,F=Math.hypot(i,s,l),F?(F=1/F,i*=F,s*=F,l*=F):(i=0,s=0,l=0),v=T*l-R*s,g=R*i-C*l,x=C*s-T*i,F=Math.hypot(v,g,x),F?(F=1/F,v*=F,g*=F,x*=F):(v=0,g=0,x=0),e[0]=i,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=l,e[9]=x,e[10]=R,e[11]=0,e[12]=-(i*H+s*Q+l*ie),e[13]=-(v*H+g*Q+x*ie),e[14]=-(C*H+T*Q+R*ie),e[15]=1,e)}function o(e,r,t,n){var i=r[0],s=r[1],l=r[2],v=n[0],g=n[1],x=n[2],C=i-t[0],T=s-t[1],R=l-t[2],F=C*C+T*T+R*R;F>0&&(F=1/Math.sqrt(F),C*=F,T*=F,R*=F);var H=g*R-x*T,Q=x*C-v*R,ie=v*T-g*C;return F=H*H+Q*Q+ie*ie,F>0&&(F=1/Math.sqrt(F),H*=F,Q*=F,ie*=F),e[0]=H,e[1]=Q,e[2]=ie,e[3]=0,e[4]=T*ie-R*Q,e[5]=R*H-C*ie,e[6]=C*Q-T*H,e[7]=0,e[8]=C,e[9]=T,e[10]=R,e[11]=0,e[12]=i,e[13]=s,e[14]=l,e[15]=1,e}function u(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function p(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function y(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function b(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function S(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function M(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function D(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function B(e,r){var t=e[0],n=e[1],i=e[2],s=e[3],l=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],R=e[10],F=e[11],H=e[12],Q=e[13],ie=e[14],be=e[15],je=r[0],Je=r[1],et=r[2],bt=r[3],Et=r[4],kt=r[5],jt=r[6],mr=r[7],Ar=r[8],pr=r[9],pn=r[10],Tn=r[11],Jn=r[12],va=r[13],oo=r[14],ko=r[15];return Math.abs(t-je)<=Ai*Math.max(1,Math.abs(t),Math.abs(je))&&Math.abs(n-Je)<=Ai*Math.max(1,Math.abs(n),Math.abs(Je))&&Math.abs(i-et)<=Ai*Math.max(1,Math.abs(i),Math.abs(et))&&Math.abs(s-bt)<=Ai*Math.max(1,Math.abs(s),Math.abs(bt))&&Math.abs(l-Et)<=Ai*Math.max(1,Math.abs(l),Math.abs(Et))&&Math.abs(v-kt)<=Ai*Math.max(1,Math.abs(v),Math.abs(kt))&&Math.abs(g-jt)<=Ai*Math.max(1,Math.abs(g),Math.abs(jt))&&Math.abs(x-mr)<=Ai*Math.max(1,Math.abs(x),Math.abs(mr))&&Math.abs(C-Ar)<=Ai*Math.max(1,Math.abs(C),Math.abs(Ar))&&Math.abs(T-pr)<=Ai*Math.max(1,Math.abs(T),Math.abs(pr))&&Math.abs(R-pn)<=Ai*Math.max(1,Math.abs(R),Math.abs(pn))&&Math.abs(F-Tn)<=Ai*Math.max(1,Math.abs(F),Math.abs(Tn))&&Math.abs(H-Jn)<=Ai*Math.max(1,Math.abs(H),Math.abs(Jn))&&Math.abs(Q-va)<=Ai*Math.max(1,Math.abs(Q),Math.abs(va))&&Math.abs(ie-oo)<=Ai*Math.max(1,Math.abs(ie),Math.abs(oo))&&Math.abs(be-ko)<=Ai*Math.max(1,Math.abs(be),Math.abs(ko))}var Z=pa,q=b;function ee(){var e=new aa(2);return aa!=Float32Array&&(e[0]=0,e[1]=0),e}function _e(e){var r=new aa(2);return r[0]=e[0],r[1]=e[1],r}function Le(e,r){var t=new aa(2);return t[0]=e,t[1]=r,t}function Ie(e,r){return e[0]=r[0],e[1]=r[1],e}function Ye(e,r,t){return e[0]=r,e[1]=t,e}function Xe(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function gt(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function Dt(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function Xt(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function yr(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function or(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Jr(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function tn(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function Gn(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function ti(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function Qn(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function Nn(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function wi(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function ui(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function ri(e){var r=e[0],t=e[1];return r*r+t*t}function ea(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Ri(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function Aa(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function _i(e,r){return e[0]*r[0]+e[1]*r[1]}function oa(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function qa(e,r,t,n){var i=r[0],s=r[1];return e[0]=i+n*(t[0]-i),e[1]=s+n*(t[1]-s),e}function Qa(e,r){r=r||1;var t=_o()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function bo(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i,e[1]=t[1]*n+t[3]*i,e}function Eo(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function Oo(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[3]*i+t[6],e[1]=t[1]*n+t[4]*i+t[7],e}function Ns(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[4]*i+t[12],e[1]=t[1]*n+t[5]*i+t[13],e}function Yo(e,r,t,n){var i=r[0]-t[0],s=r[1]-t[1],l=Math.sin(n),v=Math.cos(n);return e[0]=i*v-s*l+t[0],e[1]=i*l+s*v+t[1],e}function ou(e,r){var t=e[0],n=e[1],i=r[0],s=r[1],l=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+s*s),v=l&&(t*i+n*s)/l;return Math.acos(Math.min(Math.max(v,-1),1))}function Cs(e){return e[0]=0,e[1]=0,e}function su(e){return"vec2("+e[0]+", "+e[1]+")"}function ms(e,r){return e[0]===r[0]&&e[1]===r[1]}function os(e,r){var t=e[0],n=e[1],i=r[0],s=r[1];return Math.abs(t-i)<=Ai*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-s)<=Ai*Math.max(1,Math.abs(n),Math.abs(s))}var gs=ui,xa=gt,sa=Dt,ja=Xt,Ja=Nn,uu=wi,no=ri,So=function(){var e=ee();return function(r,t,n,i,s,l){var v,g;for(t||(t=2),n||(n=0),i?g=Math.min(i*t+n,r.length):g=r.length,v=n;v<g;v+=t)e[0]=r[v],e[1]=r[v+1],s(e,e,l),r[v]=e[0],r[v+1]=e[1];return r}}();function zs(){var e=new aa(3);return aa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function da(e){var r=new aa(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Bc(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function Dl(e,r,t){var n=new aa(3);return n[0]=e,n[1]=r,n[2]=t,n}function hc(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function dl(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function Us(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Nc(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function zc(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function Uc(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function Bp(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function jc(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function Np(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function zp(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function Xh(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Fd(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function Up(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function jp(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function Tf(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function bh(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function Vp(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function Yh(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function Qf(e,r){var t=r[0],n=r[1],i=r[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=r[0]*s,e[1]=r[1]*s,e[2]=r[2]*s,e}function $h(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function Bd(e,r,t){var n=r[0],i=r[1],s=r[2],l=t[0],v=t[1],g=t[2];return e[0]=i*g-s*v,e[1]=s*l-n*g,e[2]=n*v-i*l,e}function Nd(e,r,t,n){var i=r[0],s=r[1],l=r[2];return e[0]=i+n*(t[0]-i),e[1]=s+n*(t[1]-s),e[2]=l+n*(t[2]-l),e}function Kh(e,r,t,n,i,s){var l=s*s,v=l*(2*s-3)+1,g=l*(s-2)+s,x=l*(s-1),C=l*(3-2*s);return e[0]=r[0]*v+t[0]*g+n[0]*x+i[0]*C,e[1]=r[1]*v+t[1]*g+n[1]*x+i[1]*C,e[2]=r[2]*v+t[2]*g+n[2]*x+i[2]*C,e}function zd(e,r,t,n,i,s){var l=1-s,v=l*l,g=s*s,x=v*l,C=3*s*v,T=3*g*l,R=g*s;return e[0]=r[0]*x+t[0]*C+n[0]*T+i[0]*R,e[1]=r[1]*x+t[1]*C+n[1]*T+i[1]*R,e[2]=r[2]*x+t[2]*C+n[2]*T+i[2]*R,e}function Ud(e,r){r=r||1;var t=_o()*2*Math.PI,n=_o()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function qh(e,r,t){var n=r[0],i=r[1],s=r[2],l=t[3]*n+t[7]*i+t[11]*s+t[15];return l=l||1,e[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/l,e[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/l,e[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/l,e}function jd(e,r,t){var n=r[0],i=r[1],s=r[2];return e[0]=n*t[0]+i*t[3]+s*t[6],e[1]=n*t[1]+i*t[4]+s*t[7],e[2]=n*t[2]+i*t[5]+s*t[8],e}function Gp(e,r,t){var n=t[0],i=t[1],s=t[2],l=t[3],v=r[0],g=r[1],x=r[2],C=i*x-s*g,T=s*v-n*x,R=n*g-i*v,F=i*R-s*T,H=s*C-n*R,Q=n*T-i*C,ie=l*2;return C*=ie,T*=ie,R*=ie,F*=2,H*=2,Q*=2,e[0]=v+C+F,e[1]=g+T+H,e[2]=x+R+Q,e}function Hp(e,r,t,n){var i=[],s=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=s[0]+t[0],e[1]=s[1]+t[1],e[2]=s[2]+t[2],e}function Wp(e,r,t,n){var i=[],s=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=s[0]+t[0],e[1]=s[1]+t[1],e[2]=s[2]+t[2],e}function Qh(e,r,t,n){var i=[],s=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],e[0]=s[0]+t[0],e[1]=s[1]+t[1],e[2]=s[2]+t[2],e}function Zp(e,r){var t=e[0],n=e[1],i=e[2],s=r[0],l=r[1],v=r[2],g=Math.sqrt(t*t+n*n+i*i),x=Math.sqrt(s*s+l*l+v*v),C=g*x,T=C&&$h(e,r)/C;return Math.acos(Math.min(Math.max(T,-1),1))}function Jh(e){return e[0]=0,e[1]=0,e[2]=0,e}function ep(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Xp(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Mv(e,r){var t=e[0],n=e[1],i=e[2],s=r[0],l=r[1],v=r[2];return Math.abs(t-s)<=Ai*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(n-l)<=Ai*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-v)<=Ai*Math.max(1,Math.abs(i),Math.abs(v))}var Pv=Nc,Mm=zc,Ov=Uc,Pm=jp,Iv=Tf,Dy=Bc,sg=bh,Yp=function(){var e=zs();return function(r,t,n,i,s,l){var v,g;for(t||(t=3),n||(n=0),i?g=Math.min(i*t+n,r.length):g=r.length,v=n;v<g;v+=t)e[0]=r[v],e[1]=r[v+1],e[2]=r[v+2],s(e,e,l),r[v]=e[0],r[v+1]=e[1],r[v+2]=e[2];return r}}();function Io(){var e=new aa(4);return aa!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function pc(e){var r=new aa(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function ug(e,r,t,n){var i=new aa(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Jf(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Rv(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function Om(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function $p(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function dc(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function Kp(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function qp(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Vd(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Gd(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function kv(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function Im(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function tp(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Rm(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function Lv(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],s=r[3]-e[3];return Math.hypot(t,n,i,s)}function Dv(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],s=r[3]-e[3];return t*t+n*n+i*i+s*s}function Fv(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function Bv(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function vl(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function Hd(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function km(e,r){var t=r[0],n=r[1],i=r[2],s=r[3],l=t*t+n*n+i*i+s*s;return l>0&&(l=1/Math.sqrt(l)),e[0]=t*l,e[1]=n*l,e[2]=i*l,e[3]=s*l,e}function Vc(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function lg(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],s=t[0]*n[2]-t[2]*n[0],l=t[0]*n[3]-t[3]*n[0],v=t[1]*n[2]-t[2]*n[1],g=t[1]*n[3]-t[3]*n[1],x=t[2]*n[3]-t[3]*n[2],C=r[0],T=r[1],R=r[2],F=r[3];return e[0]=T*x-R*g+F*v,e[1]=-(C*x)+R*l-F*s,e[2]=C*g-T*l+F*i,e[3]=-(C*v)+T*s-R*i,e}function Lm(e,r,t,n){var i=r[0],s=r[1],l=r[2],v=r[3];return e[0]=i+n*(t[0]-i),e[1]=s+n*(t[1]-s),e[2]=l+n*(t[2]-l),e[3]=v+n*(t[3]-v),e}function Eh(e,r){r=r||1;var t,n,i,s,l,v;do t=_o()*2-1,n=_o()*2-1,l=t*t+n*n;while(l>=1);do i=_o()*2-1,s=_o()*2-1,v=i*i+s*s;while(v>=1);var g=Math.sqrt((1-l)/v);return e[0]=r*t,e[1]=r*n,e[2]=r*i*g,e[3]=r*s*g,e}function Sh(e,r,t){var n=r[0],i=r[1],s=r[2],l=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*l,e[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*l,e[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*l,e[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*l,e}function rp(e,r,t){var n=r[0],i=r[1],s=r[2],l=t[0],v=t[1],g=t[2],x=t[3],C=x*n+v*s-g*i,T=x*i+g*n-l*s,R=x*s+l*i-v*n,F=-l*n-v*i-g*s;return e[0]=C*x+F*-l+T*-g-R*-v,e[1]=T*x+F*-v+R*-l-C*-g,e[2]=R*x+F*-g+C*-v-T*-l,e[3]=r[3],e}function np(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ip(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Dm(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Fm(e,r){var t=e[0],n=e[1],i=e[2],s=e[3],l=r[0],v=r[1],g=r[2],x=r[3];return Math.abs(t-l)<=Ai*Math.max(1,Math.abs(t),Math.abs(l))&&Math.abs(n-v)<=Ai*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(i-g)<=Ai*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(s-x)<=Ai*Math.max(1,Math.abs(s),Math.abs(x))}var Bm=$p,Nm=dc,Nv=Kp,zv=Lv,Mf=Dv,zm=Fv,Uv=Bv,jv=function(){var e=Io();return function(r,t,n,i,s,l){var v,g;for(t||(t=4),n||(n=0),i?g=Math.min(i*t+n,r.length):g=r.length,v=n;v<g;v+=t)e[0]=r[v],e[1]=r[v+1],e[2]=r[v+2],e[3]=r[v+3],s(e,e,l),r[v]=e[0],r[v+1]=e[1],r[v+2]=e[2],r[v+3]=e[3];return r}}(),Vv,Wd,Um=(Vv=Object(vr.injectable)(),Vv(Wd=function(){function e(){dt()(this,e),w()(this,"viewport",void 0),w()(this,"overridedViewProjectionMatrix",void 0),w()(this,"jitteredViewProjectionMatrix",void 0),w()(this,"jitteredProjectionMatrix",void 0),w()(this,"viewMatrixInverse",void 0),w()(this,"cameraPosition",void 0)}return yt()(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=j.create(),j.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=ft()(t,2),i=n[0],s=n[1];return[i,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=j.fromTranslation(j.create(),[t,n,0]);this.jitteredProjectionMatrix=j.multiply(j.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=j.multiply(j.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Wd),Gv,Zd;function jm(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Qp(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function Qp(e,r){if(!!e){if(typeof e=="string")return Hv(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hv(e,r)}}function Hv(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Xd=(Gv=Object(vr.injectable)(),Gv(Zd=function(){function e(){dt()(this,e),w()(this,"container",void 0),w()(this,"controlCorners",void 0),w()(this,"controlContainer",void 0),w()(this,"scene",void 0),w()(this,"mapsService",void 0),w()(this,"controls",[]),w()(this,"unAddControls",[])}return yt()(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Yt.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Yt.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=jm(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(s){t.e(s)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=W.create("div",n+"control-container",this.container);function s(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=l.map(function(g){return n+g}).join(" ");t[l.join("")]=W.create("div",v,i)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&W.remove(this.controlCorners[t]);this.controlContainer&&W.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Zd),Vm,Wv,cg=(Vm=Object(vr.injectable)(),Vm(Wv=function(){function e(){dt()(this,e),w()(this,"container",void 0),w()(this,"scene",void 0),w()(this,"mapsService",void 0),w()(this,"markers",[]),w()(this,"markerLayers",[]),w()(this,"unAddMarkers",[]),w()(this,"unAddMarkerLayers",[])}return yt()(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||Wv),Gm,Hm,fg=(Gm=Object(vr.injectable)(),Gm(Hm=function(){function e(){dt()(this,e),w()(this,"scene",void 0),w()(this,"popup",void 0),w()(this,"mapsService",void 0),w()(this,"unAddPopup",void 0)}return yt()(e,[{key:"removePopup",value:function(t){t.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(t){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(t.addTo(this.scene),this.popup=t):this.unAddPopup=t}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Yt.IMapService)}}]),e}())||Hm),hg=O("QkVN"),Ro=O.n(hg),pg={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},dg=pg,vc,Jp;function Zv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Yd(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Zv(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Zv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Xv={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Wm={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Tw=(vc=Object(vr.injectable)(),vc(Jp=function(){function e(){dt()(this,e),w()(this,"sceneConfigCache",{}),w()(this,"layerConfigCache",{})}return yt()(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return dg[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=Yd(Yd({},Xv),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=Yd({},Ro()({},this.sceneConfigCache[t],Wm,i))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Jp),Mw=O("yG8O"),Pi=O.n(Mw),Pw=O("U+yc"),Mi=O.n(Pw),h6=O("1ABj"),vg=Math.PI/180,Ow=512,Fy=4003e4;function By(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,s=e.scale,l=e.highPrecision,v=l===void 0?!1:l,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,i);var C={},T=Ow*s,R=Math.cos(t*vg),F=T/360,H=F/R,Q=T/Fy/R;if(C.pixelsPerMeter=[Q,-Q,Q],C.metersPerPixel=[1/Q,-1/Q,1/Q],C.pixelsPerDegree=[F,-H,Q],C.degreesPerPixel=[1/F,-1/H,1/Q],v){var ie=vg*Math.tan(t*vg)/R,be=F*ie/2,je=T/Fy*ie,Je=je/H*Q;C.pixelsPerDegree2=[0,-be,je],C.pixelsPerMeter2=[Je,0,Je],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var ml;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(ml||(ml={}));var ed={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ny,zy,Uy,mg,jy,Iw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Rw=(Ny=Object(vr.injectable)(),zy=Object(vr.inject)(Yt.ICameraService),Ny(Uy=(mg=function(){function e(){dt()(this,e),w()(this,"needRefresh",!0),Pi()(this,"cameraService",jy,this),w()(this,"coordinateSystem",void 0),w()(this,"viewportCenter",void 0),w()(this,"viewportCenterProjection",void 0),w()(this,"pixelsPerDegree",void 0),w()(this,"pixelsPerDegree2",void 0),w()(this,"pixelsPerMeter",void 0)}return yt()(e,[{key:"refresh",value:function(){var t=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),i=this.cameraService.getCenter(),s=By({latitude:i[1],zoom:t}),l=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ml.LNGLAT||this.coordinateSystem===ml.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ml.LNGLAT_OFFSET?this.calculateLnglatOffset(i,t):this.coordinateSystem===ml.P20_OFFSET&&this.calculateLnglatOffset(i,t,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,s){var l=By({latitude:t[1],zoom:n,scale:i,flipY:s,highPrecision:!0}),v=l.pixelsPerMeter,g=l.pixelsPerDegree,x=l.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),R=j.multiply([],T,C),F=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=G.transformMat4([],[F[0],F[1],0,1],R),C=this.cameraService.getViewMatrixUncentered()||C,R=j.multiply([],T,C),R=j.multiply([],R,Iw),this.cameraService.setViewProjectionMatrix(R),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),jy=Mi()(mg.prototype,"cameraService",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mg))||Uy),kw=O("AfwI"),Yv=O.n(kw),Qu;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(Qu||(Qu={}));var Vy,Gy,Hy,gg,Wy;function Lw(e){var r=Dw();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fw={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Bw=(Vy=Object(vr.injectable)(),Gy=Object(vr.inject)(Yt.IMapService),Vy(Hy=(gg=function(e){bn()(t,e);var r=Lw(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),Pi()(ue()(n),"mapService",Wy,ue()(n)),w()(ue()(n),"hammertime",void 0),w()(ue()(n),"lastClickTime",0),w()(ue()(n),"lastClickXY",[-1,-1]),w()(ue()(n),"clickTimer",void 0),w()(ue()(n),"$containter",void 0),w()(ue()(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=Fw[g.type],n.emit(Qu.Drag,g)}),w()(ue()(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(Qu.Hover,g)}),w()(ue()(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),w()(ue()(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,R=v.type,F=n.mapService.getMapContainer();if(F)if(_a)C=C-F.left-0,T=T-F.top-0;else{var H=F.getBoundingClientRect(),Q=H.top,ie=H.left;C=C-ie-F.clientLeft,T=T-Q-F.clientTop}var be=n.mapService.containerToLngLat([C,T]);if(R==="click"){if(!_a&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,be);return}if(R==="touch"){n.isDoubleTap(C,T,be);return}R!=="click"&&R!=="dblclick"&&n.emit(Qu.Hover,{x:C,y:T,lngLat:be,type:R,target:v})}),n}return yt()(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Qu.Hover)}},{key:"triggerHover",value:function(i){var s=i.x,l=i.y;this.emit(Qu.Hover,{x:s,y:l})}},{key:"triggerSelect",value:function(i){this.emit(Qu.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(Qu.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i)if(_a)Wn.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new Yv.a.Manager(i);s.add(new Yv.a.Tap({event:"dblclick",taps:2})),s.add(new Yv.a.Tap({event:"click"})),s.add(new Yv.a.Pan({threshold:0,pointers:0})),s.add(new Yv.a.Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(_a)Wn.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(i){var s=i.type,l=i.pointerType,v,g;l==="touch"?(g=Math.floor(i.pointers[0].clientY),v=Math.floor(i.pointers[0].clientX)):(g=Math.floor(i.srcEvent.y),v=Math.floor(i.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,R=C.left;v-=R,g-=T}var F=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:F,type:s,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,s,l){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(Qu.Hover,{x:i,y:s,lngLat:l,type:x})):(this.lastClickTime=g,this.lastClickXY=[i,s],this.clickTimer=setTimeout(function(){x="click",v.emit(Qu.Hover,{x:i,y:s,lngLat:l,type:x})},400))}}]),t}(Vh.a),Wy=Mi()(gg.prototype,"mapService",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gg))||Hy),Nw=O("yXPU"),Ys=O.n(Nw),zw=O("o0o1"),Sa=O.n(zw),Uw=0;function jw(e){if(_a)return null;var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(Uw++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function Vw(e){var r,t,n=!0;return e==null||(r=e.target)===null||r===void 0||(t=r.path)===null||t===void 0||t.map(function(i){if(i!=null&&i.classList){var s;i==null||(s=i.classList)===null||s===void 0||s.forEach(function(l){(l==="l7-marker"||l==="l7-popup")&&(n=!1)})}}),n}var oe;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(oe||(oe={}));var Zy,Xy,Yy,$y,Ky,qy,$d,Qy,Jy,e_,t_;function r_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Zm(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?r_(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Gw=(Zy=Object(vr.injectable)(),Xy=Object(vr.inject)(Yt.IRendererService),Yy=Object(vr.inject)(Yt.IGlobalConfigService),$y=Object(vr.inject)(Yt.IInteractionService),Ky=Object(vr.inject)(Yt.ILayerService),Zy(qy=($d=function(){function e(){var r=this;dt()(this,e),Pi()(this,"rendererService",Qy,this),Pi()(this,"configService",Jy,this),Pi()(this,"interactionService",e_,this),Pi()(this,"layerService",t_,this),w()(this,"pickingFBO",void 0),w()(this,"width",0),w()(this,"height",0),w()(this,"alreadyInPicking",!1),w()(this,"pickBufferScale",1),w()(this,"lastPickTime",new Date().getTime()),w()(this,"pickFromPickingFBO",function(t,n){var i,s=n.x,l=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=r.rendererService,R=T.getViewportSize,F=T.readPixels,H=T.getContainer,Q=r.getContainerSize(H()),ie=Q.width,be=Q.height;ie*=W.DPR,be*=W.DPR;var je=t.getLayerConfig(),Je=je.enableHighlight,et=je.enableSelect,bt=s*W.DPR,Et=l*W.DPR;if(bt>ie-1*W.DPR||bt<0||Et>be-1*W.DPR||Et<0)return!1;var kt;if(kt=F({x:Math.floor(bt/r.pickBufferScale),y:Math.floor((be-(l+1)*W.DPR)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),kt[0]!==0||kt[1]!==0||kt[2]!==0){var jt=Ou(kt),mr=t.getSource().getFeatureById(jt);jt!==t.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var Ar={x:s,y:l,type:g,lngLat:v,featureId:jt,feature:mr,target:x};mr&&(C=!0,t.setCurrentPickId(jt),r.triggerHoverOnLayer(t,Ar))}else{var pr={x:s,y:l,lngLat:v,type:t.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};r.triggerHoverOnLayer(t,Zm(Zm({},pr),{},{type:"unpick"})),r.triggerHoverOnLayer(t,pr),t.setCurrentPickId(null)}if(Je&&r.highlightPickedFeature(t,kt),et&&g==="click"&&((i=kt)===null||i===void 0?void 0:i.toString())!==[0,0,0,0].toString()){var pn=Ou(kt);t.getCurrentSelectedId()===null||pn!==t.getCurrentSelectedId()?(r.selectFeature(t,kt),t.setCurrentSelectedId(pn)):(r.selectFeature(t,new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return C})}return yt()(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,s=n.createFramebuffer,l=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=W.DPR,C*=W.DPR,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=s({color:i({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.interactionService.on(Qu.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=Ys()(Sa.a.mark(function n(i,s,l){var v=this,g,x,C,T;return Sa.a.wrap(function(F){for(;;)switch(F.prev=F.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels(),i.hooks.afterPickingEncode.call();var H=v.pickBox(i,s);l(H)});case 3:case"end":return F.stop()}},n,this)}));function t(n,i,s){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,s=n.map(function(pr){var pn=pr<0?0:pr;return Math.floor(pn*W.DPR/i.pickBufferScale)}),l=ft()(s,4),v=l[0],g=l[1],x=l[2],C=l[3],T=this.rendererService,R=T.getViewportSize,F=T.readPixels,H=T.getContainer,Q=this.getContainerSize(H()),ie=Q.width,be=Q.height;if(ie*=W.DPR,be*=W.DPR,v>(ie-1)*W.DPR/this.pickBufferScale||x<0||g>(be-1)*W.DPR/this.pickBufferScale||C<0)return[];var je,Je=Math.min(ie/this.pickBufferScale,x)-v,et=Math.min(be/this.pickBufferScale,C)-g;je=F({x:v,y:Math.floor(be/this.pickBufferScale-(C+1)),width:Je,height:et,data:new Uint8Array(Je*et*4),framebuffer:this.pickingFBO});for(var bt=[],Et={},kt=0;kt<je.length/4;kt=kt+1){var jt=je.slice(kt*4,kt*4+4),mr=Ou(jt);if(mr!==-1&&!Et[mr]){var Ar=t.getSource().getFeatureById(mr);bt.push(Zm(Zm({},Ar),{},{pickedFeatureIdx:mr})),Et[mr]=!0}}return bt}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/W.DPR,height:t.height/W.DPR}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=Ys()(Sa.a.mark(function n(i){var s;return Sa.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||i.type==="contextmenu"||i.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(i);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,s=n.height;i*=W.DPR,s*=W.DPR,(this.width!==i||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=i,this.height=s)}},{key:"pickingLayers",value:function(){var r=Ys()(Sa.a.mark(function n(i){var s=this,l,v,g,x,C;return Sa.a.wrap(function(R){for(;;)switch(R.prev=R.next){case 0:l=this.rendererService,v=l.getViewportSize,g=l.useFramebuffer,x=l.clear,C=l.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(H){return H.needPick(i.type)}).reverse().some(function(H){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),H.hooks.beforePickingEncode.call(),H.renderModels(!0),H.hooks.afterPickingEncode.call();var Q=s.pickFromPickingFBO(H,i);return Q&&!H.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Vw(n)&&t.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(t,n){var i=ft()(n,3),s=i[0],l=i[1],v=i[2];t.hooks.beforeHighlight.call([s,l,v])}},{key:"selectFeature",value:function(t,n){var i=ft()(n,3),s=i[0],l=i[1],v=i[2];t.hooks.beforeSelect.call([s,l,v])}}]),e}(),Qy=Mi()($d.prototype,"rendererService",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jy=Mi()($d.prototype,"configService",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e_=Mi()($d.prototype,"interactionService",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=Mi()($d.prototype,"layerService",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$d))||qy),Hw=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;dt()(this,e),w()(this,"autoStart",void 0),w()(this,"startTime",0),w()(this,"oldTime",0),w()(this,"running",!1),w()(this,"elapsedTime",0),this.autoStart=r}return yt()(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),n_,i_,a_,o_,s_,$v,u_,l_,c_;function Ww(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Zw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function Zw(e,r){if(!!e){if(typeof e=="string")return f_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f_(e,r)}}function f_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Xw=(n_=Object(vr.injectable)(),i_=Object(vr.inject)(Yt.IRendererService),a_=Object(vr.inject)(Yt.IMapService),o_=Object(vr.inject)(Yt.IGlobalConfigService),n_(s_=($v=function(){function e(){dt()(this,e),w()(this,"clock",new Hw),w()(this,"alreadyInRendering",!1),w()(this,"layers",[]),w()(this,"layerList",[]),w()(this,"layerRenderID",void 0),w()(this,"sceneInited",!1),w()(this,"animateInstanceCount",0),w()(this,"shaderPicking",!0),w()(this,"enableRender",!0),Pi()(this,"renderService",u_,this),Pi()(this,"mapService",l_,this),Pi()(this,"configService",c_,this)}return yt()(e,[{key:"add",value:function(t){this.sceneInited&&t.init(),this.layers.push(t),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(t){t.inited||t.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find(function(n){return n.id===t})}},{key:"getLayerByName",value:function(t){return this.layers.find(function(n){return n.name===t})}},{key:"cleanRemove",value:function(t,n){if(n){var i=n.layerChildren.indexOf(t);i>-1&&n.layerChildren.splice(i,1)}else{var s=this.layers.indexOf(t);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(t,n){if(n){var i=n.layerChildren.indexOf(t);i>-1&&n.layerChildren.splice(i,1)}else{var s=this.layers.indexOf(t);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),t.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var r=Ys()(Sa.a.mark(function n(){var i,s,l;return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),i=Ww(this.layerList),g.prev=5,i.s();case 7:if((s=i.n()).done){g.next=20;break}if(l=s.value,l.hooks.beforeRenderData.call(),l.hooks.beforeRender.call(),!l.getLayerConfig().enableMultiPassRenderer){g.next=16;break}return g.next=14,l.renderMultiPass();case 14:g.next=17;break;case 16:l.render();case 17:l.hooks.afterRender.call();case 18:g.next=7;break;case 20:g.next=25;break;case 22:g.prev=22,g.t0=g.catch(5),i.e(g.t0);case 25:return g.prev=25,i.f(),g.finish(25);case 28:this.alreadyInRendering=!1;case 29:case"end":return g.stop()}},n,this,[[5,22,25,28]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){t.layerList.push(n),n.layerChildren.filter(function(i){return i.inited}).filter(function(i){return i.isVisible()}).forEach(function(i){t.layerList.push(i)})}),this.layerList.sort(function(n,i){return n.zIndex-i.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(t){t.layerChildren&&(t.layerChildren.forEach(function(n){return n.destroy()}),t.layerChildren=[]),t.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Wn.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var t=Ka(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){Wn.cancelAnimationFrame(this.layerRenderID)}}]),e}(),u_=Mi()($v.prototype,"renderService",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=Mi()($v.prototype,"mapService",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=Mi()($v.prototype,"configService",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$v))||s_),Yw=O("QILm"),Ch=O.n(Yw),$w=O("J2iB"),wh=O.n($w),Kw=function(){function e(r){var t=this;dt()(this,e),w()(this,"name",void 0),w()(this,"type",void 0),w()(this,"scale",void 0),w()(this,"descriptor",void 0),w()(this,"featureBufferLayout",[]),w()(this,"needRescale",!1),w()(this,"needRemapping",!1),w()(this,"needRegenerateVertices",!1),w()(this,"featureRange",{startIndex:0,endIndex:Infinity}),w()(this,"vertexAttribute",void 0),w()(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(s,l){var v,g=(v=t.scale)===null||v===void 0?void 0:v.scalers[l].func,x=g(s);return x})}),this.setProps(r)}return yt()(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,s=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,Lr()(t));if(!wh()(s))return[s]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),qw=["buffer","update","name"],Kv,h_,p_,d_,yg,v_;function m_(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function _g(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?m_(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m_(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function p6(e){return new Promise(function(r){return setTimeout(r,e)})}var Qw=(Kv={},w()(Kv,oe.FLOAT,4),w()(Kv,oe.UNSIGNED_BYTE,1),w()(Kv,oe.UNSIGNED_SHORT,2),Kv),Jw=(h_=Object(vr.injectable)(),p_=Object(vr.inject)(Yt.IRendererService),h_(d_=(yg=function(){function e(){dt()(this,e),w()(this,"attributesAndIndices",void 0),Pi()(this,"rendererService",v_,this),w()(this,"attributes",[]),w()(this,"triangulation",void 0),w()(this,"featureLayout",{sizePerElement:0,elements:[]})}return yt()(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Kw(t),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(t,n,i){var s=this.getLayerStyleAttribute(t);s||(s=this.registerStyleAttribute(_g(_g({},n),{},{name:t})));var l=n.scale;l&&s&&(s.scale=l,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,i&&i.featureRange&&(s.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),s=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,l=this.attributes.find(function(et){return et.name===t});if(l&&l.descriptor){var v=l.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,R=Qw[x.type||oe.FLOAT];if(g){var F=this.featureLayout,H=F.elements,Q=F.sizePerElement,ie=H.slice(i,s);if(!ie.length)return;var be=ie[0].offset,je=be*T*R,Je=ie.map(function(et,bt){for(var Et=et.featureIdx,kt=et.vertices,jt=et.normals,mr=kt.length/Q,Ar=[],pr=0;pr<mr;pr++){var pn=jt?jt.slice(pr*3,pr*3+3):[];Ar.push.apply(Ar,Lr()(g(n[Et],Et,kt.slice(pr*Q,pr*Q+Q),bt,pn)))}return Ar}).reduce(function(et,bt){return et.push.apply(et,Lr()(bt)),et},[]);l.vertexAttribute.updateBuffer({data:Je,offset:je})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var l=this.attributes.map(function(je){return je.resetDescriptor(),je.descriptor}),v=0,g=[],x=[],C=[],T=3;t.forEach(function(je,Je){var et=s.triangulation(je,i),bt=et.indices,Et=et.vertices,kt=et.normals,jt=et.size;bt.forEach(function(pn){x.push(pn+v)}),T=jt;var mr=Et.length/jt;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Je,vertices:Et,normals:kt,offset:v}),v+=mr;for(var Ar=function(Tn){var Jn=(kt==null?void 0:kt.slice(Tn*3,Tn*3+3))||[],va=Et.slice(Tn*jt,Tn*jt+jt);l.forEach(function(oo,ko){if(oo&&oo.update){var ss;(ss=oo.buffer.data).push.apply(ss,Lr()(oo.update(je,Je,va,Tn,Jn)))}})},pr=0;pr<mr;pr++)Ar(pr)});var R=this.rendererService,F=R.createAttribute,H=R.createBuffer,Q=R.createElements,ie={};l.forEach(function(je,Je){if(je){var et=je.buffer,bt=je.update,Et=je.name,kt=Ch()(je,qw),jt=F(_g({buffer:H(et)},kt));ie[je.name||""]=jt,s.attributes[Je].vertexAttribute=jt}});var be=Q({data:x,type:oe.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:ie,elements:be},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),v_=Mi()(yg.prototype,"rendererService",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg))||d_),g_=O("iegG"),eA=O.n(g_),y_,__,x_,b_,E_,S_,C_,w_,A_,T_,M_,P_,O_,I_,R_,k_,L_,Ju,D_,F_,B_,N_,z_,U_,j_,V_,G_,H_,W_,Z_,X_,Y_,$_;function tA(e){var r=rA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function rA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nA=(y_=Object(vr.injectable)(),__=Object(vr.inject)(Yt.SceneID),x_=Object(vr.inject)(Yt.IIconService),b_=Object(vr.inject)(Yt.IFontService),E_=Object(vr.inject)(Yt.IControlService),S_=Object(vr.inject)(Yt.IGlobalConfigService),C_=Object(vr.inject)(Yt.IMapService),w_=Object(vr.inject)(Yt.ICoordinateSystemService),A_=Object(vr.inject)(Yt.IRendererService),T_=Object(vr.inject)(Yt.ILayerService),M_=Object(vr.inject)(Yt.ICameraService),P_=Object(vr.inject)(Yt.IInteractionService),O_=Object(vr.inject)(Yt.IPickingService),I_=Object(vr.inject)(Yt.IShaderModuleService),R_=Object(vr.inject)(Yt.IMarkerService),k_=Object(vr.inject)(Yt.IPopupService),y_(L_=(Ju=function(e){bn()(t,e);var r=tA(t);function t(){var n;return dt()(this,t),n=r.call(this),w()(ue()(n),"destroyed",!1),w()(ue()(n),"loaded",!1),w()(ue()(n),"loadFont",!1),w()(ue()(n),"fontFamily",""),Pi()(ue()(n),"id",D_,ue()(n)),Pi()(ue()(n),"iconService",F_,ue()(n)),Pi()(ue()(n),"fontService",B_,ue()(n)),Pi()(ue()(n),"controlService",N_,ue()(n)),Pi()(ue()(n),"configService",z_,ue()(n)),Pi()(ue()(n),"map",U_,ue()(n)),Pi()(ue()(n),"coordinateSystemService",j_,ue()(n)),Pi()(ue()(n),"rendererService",V_,ue()(n)),Pi()(ue()(n),"layerService",G_,ue()(n)),Pi()(ue()(n),"cameraService",H_,ue()(n)),Pi()(ue()(n),"interactionService",W_,ue()(n)),Pi()(ue()(n),"pickingService",Z_,ue()(n)),Pi()(ue()(n),"shaderModuleService",X_,ue()(n)),Pi()(ue()(n),"markerService",Y_,ue()(n)),Pi()(ue()(n),"popupService",$_,ue()(n)),w()(ue()(n),"inited",!1),w()(ue()(n),"initPromise",void 0),w()(ue()(n),"rendering",!1),w()(ue()(n),"$container",void 0),w()(ue()(n),"canvas",void 0),w()(ue()(n),"markerContainer",void 0),w()(ue()(n),"hooks",void 0),w()(ue()(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),W.triggerResize(),n.coordinateSystemService.needRefresh=!0,n.render())}),w()(ue()(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new Ds.a},n}return yt()(t,[{key:"init",value:function(i){var s=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Ys()(Sa.a.mark(function l(){return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(Qu.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},l)}))),this.hooks.init.tapPromise("initRenderer",Ys()(Sa.a.mark(function l(){var v,g;return Sa.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=jw(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=W.create("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:eA()(s.$container,s.handleWindowResized),Wn.matchMedia&&((g=Wn.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},l)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(i){var s=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Ys()(Sa.a.mark(function l(){return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(Qu.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},l)}))),this.hooks.init.tapPromise("initRenderer",Ys()(Sa.a.mark(function l(){var v;return Sa.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=i.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(i.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},l)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i),this.render()}},{key:"render",value:function(){var n=Ys()(Sa.a.mark(function s(){return Sa.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=15;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=10;break}return v.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return v.stop()}},s,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,s){this.fontFamily=i;var l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(l),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(i){var s,l=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=i==="jpg"?l==null?void 0:l.toDataURL("image/jpeg"):l==null?void 0:l.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=W.create("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,s,l;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){i.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(l=s.parentNode)===null||l===void 0||l.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,Object(g_.unbind)(this.$container,this.handleWindowResized),Wn.matchMedia){var v;(v=Wn.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var i,s,l=W.DPR,v=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*l,x.height=g*l),this.rendererService.viewport({x:0,y:0,width:l*v,height:l*g})}},{key:"setCanvas",value:function(){var i,s,l=W.DPR,v=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*l,x.height=g*l,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(Zs.EventEmitter),D_=Mi()(Ju.prototype,"id",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=Mi()(Ju.prototype,"iconService",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=Mi()(Ju.prototype,"fontService",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=Mi()(Ju.prototype,"controlService",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=Mi()(Ju.prototype,"configService",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=Mi()(Ju.prototype,"map",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j_=Mi()(Ju.prototype,"coordinateSystemService",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=Mi()(Ju.prototype,"rendererService",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G_=Mi()(Ju.prototype,"layerService",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=Mi()(Ju.prototype,"cameraService",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_=Mi()(Ju.prototype,"interactionService",[P_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z_=Mi()(Ju.prototype,"pickingService",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_=Mi()(Ju.prototype,"shaderModuleService",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=Mi()(Ju.prototype,"markerService",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$_=Mi()(Ju.prototype,"popupService",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju))||L_),iA=O("7tbW"),K_=O.n(iA);function aA(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var oA=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function q_(e){var r={};return e=e.replace(oA,function(t,n,i){var s=i.split(":"),l=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(aA(n)).fill(0);break;default:}return r[l]=v,"uniform ".concat(n," ").concat(l,`;
`)}),{content:e,uniforms:r}}var Q_,J_;function e1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function qv(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?e1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var t1="#define PI 3.14159265359",sA=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,uA=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,lA=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,cA=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,fA=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,hA=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,pA=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,dA=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,vA=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,mA=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,gA=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,yA=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,_A=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,xA=/precision\s+(high|low|medium)p\s+float/,bA=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,EA=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,SA=(Q_=Object(vr.injectable)(),Q_(J_=function(){function e(){dt()(this,e),w()(this,"moduleCache",{}),w()(this,"rawContentCache",{})}return yt()(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:t1,fs:t1}),this.registerModule("decode",{vs:sA,fs:""}),this.registerModule("projection",{vs:pA,fs:""}),this.registerModule("project",{vs:hA,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:dA}),this.registerModule("lighting",{vs:lA,fs:""}),this.registerModule("light",{vs:uA,fs:""}),this.registerModule("picking",{vs:fA,fs:cA}),this.registerModule("styleMapping",{vs:vA,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:_A,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:mA,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:gA,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:yA,fs:""})}},{key:"registerModule",value:function(t,n){if(!this.rawContentCache[t]){var i=n.vs,s=n.fs,l=n.uniforms,v=q_(i),g=v.content,x=v.uniforms,C=q_(s),T=C.content,R=C.uniforms;this.rawContentCache[t]={fs:T,uniforms:qv(qv(qv({},x),R),l),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this;if(this.moduleCache[t])return this.moduleCache[t];var i=this.rawContentCache[t].vs,s=this.rawContentCache[t].fs,l=this.processModule(i,[],"vs"),v=l.content,g=l.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,R=C,F=K_()(g.concat(T).concat(t)).reduce(function(H,Q){return qv(qv({},H),n.rawContentCache[Q].uniforms)},{});return xA.test(C)||(R=bA+C),this.moduleCache[t]={fs:R.trim(),uniforms:F,vs:v.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var s=this,l=t.replace(EA,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][i];n.push(C);var R=s.processModule(T,n,i),F=R.content;return F});return{content:l,includeList:n}}}]),e}())||J_),CA=O("iWIM"),ap=O.n(CA),op;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(op||(op={}));var r1,n1,Xm=(r1=Object(vr.injectable)(),r1(n1=function(){function e(){dt()(this,e),w()(this,"shaderModuleService",void 0),w()(this,"rendererService",void 0),w()(this,"cameraService",void 0),w()(this,"mapService",void 0),w()(this,"interactionService",void 0),w()(this,"layerService",void 0),w()(this,"config",void 0)}return yt()(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return op.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Yt.IRendererService),this.cameraService=t.getContainer().get(Yt.ICameraService),this.mapService=t.getContainer().get(Yt.IMapService),this.interactionService=t.getContainer().get(Yt.IInteractionService),this.layerService=t.getContainer().get(Yt.ILayerService),this.shaderModuleService=t.getContainer().get(Yt.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||n1),i1,a1;function wA(e){var r=AA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TA=(i1=Object(vr.injectable)(),i1(a1=function(e){bn()(t,e);var r=wA(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,s){ap()(Lt()(t.prototype),"init",this).call(this,i,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Xm))||a1),o1,s1,u1,xg,l1;function MA(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=PA(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function PA(e,r){if(!!e){if(typeof e=="string")return c1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return c1(e,r)}}function c1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var OA=(o1=Object(vr.injectable)(),s1=Object(vr.inject)(Yt.IPostProcessor),o1(u1=(xg=function(){function e(){dt()(this,e),w()(this,"passes",[]),Pi()(this,"postProcessor",l1,this),w()(this,"layer",void 0),w()(this,"renderFlag",void 0),w()(this,"width",0),w()(this,"height",0)}return yt()(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=Ys()(Sa.a.mark(function n(){var i,s,l;return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:i=MA(this.passes),g.prev=1,i.s();case 3:if((s=i.n()).done){g.next=9;break}return l=s.value,g.next=7,l.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),i.e(g.t0);case 14:return g.prev=14,i.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===op.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),l1=Mi()(xg.prototype,"postProcessor",[s1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg))||u1),f1,h1;function p1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function d1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?p1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):p1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function IA(e){var r=RA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function RA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=(f1=Object(vr.injectable)(),f1(h1=function(e){bn()(t,e);var r=IA(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"pickingFBO",void 0),w()(ue()(n),"layer",void 0),w()(ue()(n),"width",0),w()(ue()(n),"height",0),w()(ue()(n),"alreadyInRendering",!1),w()(ue()(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var R=n.rendererService,F=R.getViewportSize,H=R.readPixels,Q=R.useFramebuffer,ie=F(),be=ie.width,je=ie.height,Je=n.layer.getLayerConfig(),et=Je.enableHighlight,bt=Je.enableSelect,Et=g*W.DPR,kt=x*W.DPR;if(!(Et>be||Et<0||kt>je||kt<0)){var jt;Q(n.pickingFBO,function(){var mr;if(jt=H({x:Math.round(Et),y:Math.round(je-(x+1)*W.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),jt[0]!==0||jt[1]!==0||jt[2]!==0){var Ar=Ou(jt),pr=n.layer.getSource().getFeatureById(Ar),pn={x:g,y:x,type:T,lngLat:C,featureId:Ar,feature:pr};pr&&(n.layer.setCurrentPickId(Ar),n.triggerHoverOnLayer(pn))}else{var Tn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(d1(d1({},Tn),{},{type:"unpick"})),n.triggerHoverOnLayer(Tn),n.layer.setCurrentPickId(null)}et&&n.highlightPickedFeature(jt),bt&&T==="click"&&((mr=jt)===null||mr===void 0?void 0:mr.toString())!==[0,0,0,0].toString()&&n.selectFeature(jt)})}}}),n}return yt()(t,[{key:"getType",value:function(){return op.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,s){ap()(Lt()(t.prototype),"init",this).call(this,i,s),this.layer=i;var l=this.rendererService,v=l.createTexture2D,g=l.createFramebuffer,x=l.getViewportSize,C=x(),T=C.width,R=C.height;this.pickingFBO=g({color:v({width:T,height:R,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.interactionService.on(Qu.Hover,this.pickFromPickingFBO),this.interactionService.on(Qu.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Qu.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var s=this;if(!this.alreadyInRendering){var l=this.rendererService,v=l.getViewportSize,g=l.useFramebuffer,x=l.clear,C=v(),T=C.width,R=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==R)&&(this.pickingFBO.resize({width:T,height:R}),this.width=T,this.height=R),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var s=ft()(i,3),l=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([l,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var s=ft()(i,3),l=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([l,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var s=i.featureId,l=fc(s);this.selectFeature(new Uint8Array(l))}},{key:"highlightFeatureHandle",value:function(i){var s=i.featureId,l=fc(s);this.highlightPickedFeature(new Uint8Array(l))}}]),t}(Xm))||h1),LA=O("gQMU"),DA=O.n(LA),FA=O("u6S6"),BA=O.n(FA),v1,m1,g1,bg,y1;function _1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Qv(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?_1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var NA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ah=(v1=Object(vr.injectable)(),m1=Object(vr.inject)(Yt.IShaderModuleService),v1(g1=(bg=function(){function e(){dt()(this,e),Pi()(this,"shaderModuleService",y1,this),w()(this,"rendererService",void 0),w()(this,"config",void 0),w()(this,"quad",NA),w()(this,"enabled",!0),w()(this,"renderToScreen",!1),w()(this,"model",void 0),w()(this,"name",void 0),w()(this,"optionsToUpdate",{})}return yt()(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return op.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Yt.IRendererService),this.shaderModuleService=t.getContainer().get(Yt.IShaderModuleService);var i=this.rendererService,s=i.createAttribute,l=i.createBuffer,v=i.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:l({data:[-4,-4,4,-4,0,4],type:oe.FLOAT}),size:2})},uniforms:Qv(Qv({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,s=t.multiPassRenderer.getPostProcessor(),l=this.rendererService,v=l.useFramebuffer,g=l.getViewportSize,x=l.clear,C=g(),T=C.width,R=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Qv({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,R]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),i.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=Qv(Qv({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){wh()(t[i])||(n["u_".concat(DA()(BA()(i)))]=t[i])}),n}}]),e}(),y1=Mi()(bg.prototype,"shaderModuleService",[m1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bg))||g1),x1,b1;function E1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function S1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?E1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):E1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function zA(e){var r=UA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function UA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jA=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);
  // float lum = luminance(baseColor);
  // baseColor.a *= lum;

  // gl_FragColor = baseColor;

  // if(u_BloomFinal > 0.0) { // 
  //   gl_FragColor = baseColor; //-- 
  // }

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    // float lum = luminance(inbloomColor);
    // vec4 bloom = vec4(lum);
    // inbloomColor.a *= lum;
    // gl_FragColor = inbloomColor * u_intensity + texture2D(u_Texture2, v_UV);
    // gl_FragColor = inbloomColor * 0.5 + texture2D(u_Texture2, v_UV);
    // gl_FragColor = baseColor;
    // gl_FragColor = inbloomColor;
    // vec4 mixColor = mix(baseColor, inbloomColor, max(u_intensity - 0.3, 0.0));
    // mixColor.a = max(baseColor.a, mixColor.a);
    gl_FragColor = mix(inbloomColor, baseColor, max(1.0 - u_intensity, u_baseRadio));
    // gl_FragColor = mixColor;
    // gl_FragColor = baseColor;
    
    if(baselum <= 0.0) {
      // float lum = luminance(inbloomColor);
      // inbloomColor.rgb *= lum;
      gl_FragColor += inbloomColor * u_intensity;
    }
    // gl_FragColor = inbloomColor * baseColor + baseColor;
    // gl_FragColor = baseColor + bloom * 0.5;
  } else {
    gl_FragColor = inbloomColor;
  }
  // gl_FragColor = inbloomColor;

  // float h = 0.01;
  
  // vec4 color11 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color12 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y + 1.0 * h) );
  // vec4 color13 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y + 1.0 * h) );

  // vec4 color21 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y) );
  // vec4 color23 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y) );

  // vec4 color31 = texture2D( u_Texture, vec2( v_UV.x - 1.0 * h, v_UV.y-1.0*h) );
  // vec4 color32 = texture2D( u_Texture, vec2( v_UV.x - 0.0 * h, v_UV.y-1.0*h) );
  // vec4 color33 = texture2D( u_Texture, vec2( v_UV.x + 1.0 * h, v_UV.y-1.0*h) );

  // vec4 bloomColor =
  //   color11 + 
  //   color12 + 
  //   color13 + 
  //   color21 + 
  //   color21 + 
  //   color23 + 
  //   color31 + 
  //   color32 + 
  //   color33;

  //   if(baseColor.a > 0.0) {
      
  //     gl_FragColor.r = min(bloomColor.r, baseColor.r);
  //     gl_FragColor.g = min(bloomColor.g, baseColor.g);
  //     gl_FragColor.b = min(bloomColor.b, baseColor.b);
  //     gl_FragColor.a = min(bloomColor.a, baseColor.a);

  //     gl_FragColor = mix(inbloomColor, gl_FragColor, 0.7);
  //   } else {
  //     gl_FragColor = bloomColor/9.0;
  //   } 
}`,VA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,GA=(x1=Object(vr.injectable)(),x1(b1=function(e){bn()(t,e);var r=zA(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:VA,fs:jA});var i=this.shaderModuleService.getModule("blur-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:S1(S1({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(i){var s={};return wh()(i.bloomRadius)||(s.u_radius=i.bloomRadius),wh()(i.bloomIntensity)||(s.u_intensity=i.bloomIntensity),wh()(i.bloomBaseRadio)||(s.u_baseRadio=i.bloomBaseRadio),s}}]),t}(Ah))||b1),C1,w1;function A1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function T1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?A1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function HA(e){var r=WA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function WA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,XA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,YA=(C1=Object(vr.injectable)(),C1(w1=function(e){bn()(t,e);var r=HA(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:XA,fs:ZA});var i=this.shaderModuleService.getModule("blur-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:T1(T1({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(i){var s={};return wh()(i.blurRadius)||(s.u_BlurDir=[i.blurRadius,0]),s}}]),t}(Ah))||w1),M1,P1;function O1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function I1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?O1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):O1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $A(e){var r=KA();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,QA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,JA=(M1=Object(vr.injectable)(),M1(P1=function(e){bn()(t,e);var r=$A(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:QA,fs:qA});var i=this.shaderModuleService.getModule("blur-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:I1(I1({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(i){var s={};return wh()(i.blurRadius)||(s.u_BlurDir=[0,i.blurRadius]),s}}]),t}(Ah))||P1),R1,k1;function L1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function D1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?L1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function eT(e){var r=tT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function tT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,nT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,iT=(R1=Object(vr.injectable)(),R1(k1=function(e){bn()(t,e);var r=eT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:nT,fs:rT});var i=this.shaderModuleService.getModule("colorhalftone-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:D1(D1({},v),{},{u_ViewportSize:[x,C]})}}}]),t}(Ah))||k1),F1,B1;function aT(e){var r=oT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function oT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,uT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lT=(F1=Object(vr.injectable)(),F1(B1=function(e){bn()(t,e);var r=aT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:uT,fs:sT}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Ah))||B1),N1,z1;function U1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function j1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?U1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):U1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function cT(e){var r=fT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function fT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,pT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dT=(N1=Object(vr.injectable)(),N1(z1=function(e){bn()(t,e);var r=cT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:pT,fs:hT});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:j1(j1({},v),{},{u_ViewportSize:[x,C]})}}}]),t}(Ah))||z1),V1,G1;function H1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function W1(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?H1(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):H1(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function vT(e){var r=mT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function mT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gT=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,yT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_T=(V1=Object(vr.injectable)(),V1(G1=function(e){bn()(t,e);var r=vT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:yT,fs:gT});var i=this.shaderModuleService.getModule("ink-pass"),s=i.vs,l=i.fs,v=i.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:l,uniforms:W1(W1({},v),{},{u_ViewportSize:[x,C]})}}}]),t}(Ah))||G1),Z1,X1;function xT(e){var r=bT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function bT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ET=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,ST=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,CT=(Z1=Object(vr.injectable)(),Z1(X1=function(e){bn()(t,e);var r=xT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:ST,fs:ET}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Ah))||X1),Y1,$1;function wT(e){var r=AT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function AT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,MT=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,PT=(Y1=Object(vr.injectable)(),Y1($1=function(e){bn()(t,e);var r=wT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:TT,fs:MT}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Ah))||$1),K1,q1,Q1,J1,Kd,ex,OT=(K1=Object(vr.injectable)(),q1=Object(vr.inject)(Yt.IRendererService),Q1=Object(vr.postConstruct)(),K1(J1=(Kd=function(){function e(){dt()(this,e),Pi()(this,"rendererService",ex,this),w()(this,"passes",[]),w()(this,"readFBO",void 0),w()(this,"writeFBO",void 0)}return yt()(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,s=n(),l=s.width,v=s.height;return i({x:0,y:0,width:l,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i,s){n(t.readFBO,Ys()(Sa.a.mark(function l(){return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return g.stop()}},l)})))})}},{key:"renderBloomPass",value:function(){var r=Ys()(Sa.a.mark(function n(i,s){var l,v;return Sa.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:l=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(i,l);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=Ys()(Sa.a.mark(function n(i){var s,l;return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(l=this.passes[s],l.setRenderToScreen(this.isLastEnabledPass(s)),l.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(i,l);case 7:g.next=12;break;case 9:return g.next=11,l.render(i);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,s){t.init(i,s),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),ex=Mi()(Kd.prototype,"rendererService",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi()(Kd.prototype,"init",[Q1],Object.getOwnPropertyDescriptor(Kd.prototype,"init"),Kd.prototype),Kd))||J1),tx,rx;function IT(e){var r=RT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function RT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kT=(tx=Object(vr.injectable)(),tx(rx=function(e){bn()(t,e);var r=IT(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getType",value:function(){return op.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,s){ap()(Lt()(t.prototype),"init",this).call(this,i,s)}},{key:"render",value:function(i){var s=this.rendererService,l=s.useFramebuffer,v=s.clear,g=i.multiPassRenderer.getPostProcessor().getReadFBO();l(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(x){x.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Xm))||rx),nx,ix,ax,Eg,ox;function sx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ux(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?sx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function LT(e){var r=DT();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function DT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FT=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,lx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,BT=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function cx(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var NT=1,zT=(nx=Object(vr.injectable)(),ix=Object(vr.inject)(Yt.IShaderModuleService),nx(ax=(Eg=function(e){bn()(t,e);var r=LT(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),Pi()(ue()(n),"shaderModuleService",ox,ue()(n)),w()(ue()(n),"haltonSequence",[]),w()(ue()(n),"accumulatingId",0),w()(ue()(n),"frame",0),w()(ue()(n),"timer",void 0),w()(ue()(n),"sampleRenderTarget",void 0),w()(ue()(n),"prevRenderTarget",void 0),w()(ue()(n),"outputRenderTarget",void 0),w()(ue()(n),"copyRenderTarget",void 0),w()(ue()(n),"blendModel",void 0),w()(ue()(n),"outputModel",void 0),w()(ue()(n),"copyModel",void 0),n}return yt()(t,[{key:"getType",value:function(){return op.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,s){ap()(Lt()(t.prototype),"init",this).call(this,i,s);var l=this.rendererService,v=l.createFramebuffer,g=l.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([cx(x,2),cx(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",FT),this.outputModel=this.createTriangleModel("copy-pass",lx,{blend:{enable:!0,func:{srcRGB:oe.ONE,dstRGB:oe.ONE_MINUS_SRC_ALPHA,srcAlpha:oe.ONE,dstAlpha:oe.ONE_MINUS_SRC_ALPHA},equation:{rgb:oe.FUNC_ADD,alpha:oe.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",lx)}},{key:"render",value:function(i){var s=this,l=this.rendererService,v=l.clear,g=l.getViewportSize,x=l.useFramebuffer,C=g(),T=C.width,R=C.height;this.sampleRenderTarget.resize({width:T,height:R}),this.prevRenderTarget.resize({width:T,height:R}),this.outputRenderTarget.resize({width:T,height:R}),this.copyRenderTarget.resize({width:T,height:R}),this.resetFrame(),this.stopAccumulating();var F=i.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var H=function Q(ie){!s.accumulatingId||ie!==s.accumulatingId||s.isFinished()||(s.doRender(i),Wn.requestAnimationFrame(function(){Q(ie)}))};this.accumulatingId=NT++,this.timer=Wn.setTimeout(function(){H(s.accumulatingId)},50)}},{key:"doRender",value:function(i){var s=this,l=this.rendererService,v=l.clear,g=l.getViewportSize,x=l.useFramebuffer,C=g(),T=C.width,R=C.height,F=i.getLayerConfig(),H=F.jitterScale,Q=H===void 0?1:H,ie=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ie[0]*2-1)/T*Q,(ie[1]*2-1)/R*Q),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var be=i.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:be.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var je=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=je,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Wn.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,s,l){this.shaderModuleService.registerModule(i,{vs:BT,fs:s});var v=this.shaderModuleService.getModule(i),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,R=T.createAttribute,F=T.createBuffer,H=T.createModel;return H(ux({vs:g,fs:x,attributes:{a_Position:R({buffer:F({data:[-4,-4,4,-4,0,4],type:oe.FLOAT}),size:2})},uniforms:ux({},C),depth:{enable:!1},count:3},l))}}]),t}(Xm),ox=Mi()(Eg.prototype,"shaderModuleService",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eg))||ax),Jv=new vr.Container;Jv.bind(Yt.IGlobalConfigService).to(Tw).inSingletonScope(),Object(vr.decorate)(Object(vr.injectable)(),Zs.EventEmitter),Jv.bind(Yt.IEventEmitter).to(Zs.EventEmitter);var fx=Kl()(Jv,!1),Sg=function(r){var t=fx.lazyInject(r);return function(n,i,s){t.call(this,n,i),s&&(s.initializer=function(){return n[i]})}},d6=function(r){var t=fx.lazyMultiInject(r);return function(n,i,s){t.call(this,n,i),s&&(s.initializer=function(){return n[i]})}},mc=Jv,UT=0;function jT(){var e=new vr.Container;return e.parent=Jv,e.bind(Yt.SceneID).toConstantValue("".concat(UT++)),e.bind(Yt.IShaderModuleService).to(SA).inSingletonScope(),e.bind(Yt.ILayerService).to(Xw).inSingletonScope(),e.bind(Yt.ISceneService).to(nA).inSingletonScope(),e.bind(Yt.ICameraService).to(Um).inSingletonScope(),e.bind(Yt.ICoordinateSystemService).to(Rw).inSingletonScope(),e.bind(Yt.IInteractionService).to(Bw).inSingletonScope(),e.bind(Yt.IPickingService).to(Gw).inSingletonScope(),e.bind(Yt.IControlService).to(Xd).inSingletonScope(),e.bind(Yt.IMarkerService).to(cg).inSingletonScope(),e.bind(Yt.IIconService).to(Xo).inSingletonScope(),e.bind(Yt.IFontService).to(hi).inSingletonScope(),e.bind(Yt.IPopupService).to(fg).inSingletonScope(),e.bind(Yt.INormalPass).to(TA).whenTargetNamed("clear"),e.bind(Yt.INormalPass).to(kA).whenTargetNamed("pixelPicking"),e.bind(Yt.INormalPass).to(kT).whenTargetNamed("render"),e.bind(Yt.INormalPass).to(zT).whenTargetNamed("taa"),e.bind(Yt.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Yt.INormalPass,t)}}),e.bind(Yt.IPostProcessingPass).to(lT).whenTargetNamed("copy"),e.bind(Yt.IPostProcessingPass).to(GA).whenTargetNamed("bloom"),e.bind(Yt.IPostProcessingPass).to(YA).whenTargetNamed("blurH"),e.bind(Yt.IPostProcessingPass).to(JA).whenTargetNamed("blurV"),e.bind(Yt.IPostProcessingPass).to(CT).whenTargetNamed("noise"),e.bind(Yt.IPostProcessingPass).to(PT).whenTargetNamed("sepia"),e.bind(Yt.IPostProcessingPass).to(iT).whenTargetNamed("colorHalftone"),e.bind(Yt.IPostProcessingPass).to(dT).whenTargetNamed("hexagonalPixelate"),e.bind(Yt.IPostProcessingPass).to(_T).whenTargetNamed("ink"),e.bind(Yt.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Yt.IPostProcessingPass,t);return n.setName(t),n}}),e}function VT(e){var r=new vr.Container;return r.parent=e,r.bind(Yt.IStyleAttributeService).to(Jw).inSingletonScope(),r.bind(Yt.IMultiPassRenderer).to(OA).inSingletonScope(),r.bind(Yt.IPostProcessor).to(OT).inSingletonScope(),r}var GT=O("9nhX"),hx=O.n(GT),HT=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function WT(e){return HT.indexOf(e)}var ZT=2,v6=4,XT=64,m6=128,YT=256,$T=512,g6=8192,y6=16384,_6=32768,KT=32768*2,px=131072,x6=262144,qT=524288,b6=1048576,QT=2097152,E6=4194304,JT=8388608,eM=16777216,tM=16777216*2;function Ym(e,r){return e=hx()(Math.floor(e),0,255),r=hx()(Math.floor(r),0,255),256*e+r}function S6(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,s=e.shape,l=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],R=[],F=[Ym(r[0],r[1]),Ym(r[2],r[3])],H=[Ym(v[0],v[1]),Ym(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Q){var ie=ft()(Q,2),be=ie[0],je=ie[1];C.push([].concat(F,[(be+1)*JT+(je+1)*QT+WT(s)*px+t,(n+512)*qT+(i+512)*XT])),T.push([].concat(H,[g,x])),R.push([l,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:R}}function C6(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*tM+t*eM+n*px+t*KT+n*$T+t*YT+n*ZT+t}var Gc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Gc||(Gc={}));var mu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(mu||(mu={}));var sp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(sp||(sp={}));var yi;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(yi||(yi={}));var qd=["mapload","mapchange"],td={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Cg=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],up;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(up||(up={}));function dx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function vx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?dx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):dx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function rM(e){var r=nM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function nM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iM=0,em=function(e){bn()(t,e);var r=rM(t);function t(n){var i;return dt()(this,t),i=r.call(this),w()(ue()(i),"controlOption",void 0),w()(ue()(i),"container",void 0),w()(ue()(i),"sceneContainer",void 0),w()(ue()(i),"mapsService",void 0),w()(ue()(i),"renderService",void 0),w()(ue()(i),"layerService",void 0),w()(ue()(i),"controlService",void 0),w()(ue()(i),"isShow",void 0),i.controlOption=vx(vx({},i.getDefault()),n||{}),i}return yt()(t,[{key:"getDefault",value:function(){return{position:up.TOPRIGHT,name:"".concat(iM++)}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:up.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=i,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(i){this.mapsService=i.get(Yt.IMapService),this.renderService=i.get(Yt.IRendererService),this.layerService=i.get(Yt.ILayerService),this.controlService=i.get(Yt.IControlService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd();var s=this.container,l=this.controlOption.position,v=this.controlService.controlCorners[l];return W.addClass(s,"l7-control"),l.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var i=this.container;W.addClass(i,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var i=this.container;W.removeClass(i,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;W.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),t}(Zs.EventEmitter);function aM(e){var r=oM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function oM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sM=function(e){bn()(t,e);var r=aM(t);function t(n){var i;return dt()(this,t),i=r.call(this,n),w()(ue()(i),"layerControlInputs",void 0),w()(ue()(i),"layers",void 0),w()(ue()(i),"lastZIndex",void 0),w()(ue()(i),"handlingClick",void 0),w()(ue()(i),"layersLink",void 0),w()(ue()(i),"baseLayersList",void 0),w()(ue()(i),"separator",void 0),w()(ue()(i),"overlaysList",void 0),w()(ue()(i),"form",void 0),i.layerControlInputs=[],i.layers=[],i.lastZIndex=0,i.handlingClick=!1,i.initLayers(),ts(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],ue()(i)),i}return yt()(t,[{key:"getDefault",value:function(){return{collapsed:!0,position:up.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var i=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",i.onLayerChange),s.layer.on("add",i.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(i,s){return this.addLayer(i,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var i=this.renderService.getViewportSize(),s=i.height;W.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var l=s-(this.container.offsetTop+50);return l<this.form.clientHeight?(W.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=l+"px"):W.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return W.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var i=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",i.onLayerChange),s.layer.off("add",i.onLayerChange)}))}},{key:"initLayout",value:function(){var i="l7-control-layers",s=this.container=W.create("div",i),l=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=W.create("form",i+"-list");l&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=W.create("a",i+"-toggle",s);var g=this.layersLink;g.title="Layers",l||this.expand(),this.baseLayersList=W.create("div",i+"-base",v),this.separator=W.create("div",i+"-separator",v),this.overlaysList=W.create("div",i+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var i=this,s=this.controlOption,l=s.baseLayers,v=l===void 0?{}:l,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){i.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){i.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;W.empty(this.baseLayersList),W.empty(this.overlaysList),this.layerControlInputs=[];var i,s,l,v,g=0;for(l=0;l<this.layers.length;l++)v=this.layers[l],this.addItem(v),s=s||v.overlay,i=i||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(i=i&&g>1,this.baseLayersList.style.display=i?"":"none"),this.separator.style.display=s&&i?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var i=this.layerControlInputs,s,l,v=this.mapsService.getZoom(),g=i.length-1;g>=0;g--)if(s=i[g],l=this.layerService.getLayer(s.layerId),l&&l.inited){var x=l.getMinZoom(),C=l.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(i,s,l){this.mapsService&&(i.on("add",this.onLayerChange),i.on("remove",this.onLayerChange)),this.layers.push({layer:i,name:s,overlay:l});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,R){return x(T.layer,R.layer,T.name,R.name)}),C&&i.setZIndex&&(this.lastZIndex++,i.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(i){this.handlingClick||this.update();var s=this.layerService.getLayer(i.target.layerId),l=s!=null&&s.overlay?i.type==="add"?"overlayadd":"overlayremove":i.type==="add"?"baselayerchange":null;l&&this.emit(l,s)}},{key:"createRadioElement",value:function(i,s){var l='<input type="radio" class="l7-control-layers-selector" name="'+i+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=l,v.firstChild}},{key:"addItem",value:function(i){var s=document.createElement("label"),l=this.layerService.getLayer(i.layer.id),v=l&&l.inited&&i.layer.isVisible(),g;i.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=i.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+i.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=i.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var i=this.layerControlInputs,s,l,v=[],g=[];this.handlingClick=!0;for(var x=i.length-1;x>=0;x--)s=i[x],l=this.layerService.getLayer(s.layerId),s.checked?v.push(l):s.checked||g.push(l);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),t}(em);function uM(e){var r=lM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mx=function(e){bn()(t,e);var r=uM(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getDefault",value:function(){return{position:up.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var i="l7-control-logo",s=W.create("div",i),l=W.create("a","l7-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://antv.alipay.com/l7",l.setAttribute("aria-label","AntV logo"),l.setAttribute("rel","noopener nofollow"),s.appendChild(l),s}},{key:"onRemove",value:function(){return null}}]),t}(em);function cM(e){var r=fM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hM=function(e){bn()(t,e);var r=cM(t);function t(n){var i;return dt()(this,t),i=r.call(this,n),w()(ue()(i),"mScale",void 0),w()(ue()(i),"iScale",void 0),ts(["update"],ue()(i)),i}return yt()(t,[{key:"getDefault",value:function(){return{position:up.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var i="l7-control-scale",s=W.create("div",i);this.addScales(i+"-line",s);var l=this.controlOption.updateWhenIdle;return this.mapsService.on(l?"moveend":"mapmove",this.update),this.mapsService.on(l?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var i=this.mapsService,s=this.controlOption.maxWidth,l=i.getSize()[1]/2,v=i.containerToLngLat([0,l]),g=i.containerToLngLat([s,l]),x=Di([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(i){var s=this.controlOption,l=s.metric,v=s.imperial;l&&i&&this.updateMetric(i),v&&i&&this.updateImperial(i)}},{key:"updateMetric",value:function(i){var s=this.getRoundNum(i),l=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,l,s/i)}},{key:"updateImperial",value:function(i){var s=i*3.2808399,l,v,g;s>5280?(l=s/5280,v=this.getRoundNum(l),this.updateScale(this.iScale,v+" mi",v/l)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(i,s,l){var v=this.controlOption.maxWidth;i.style.width=Math.round(v*l)+"px",i.innerHTML=s}},{key:"getRoundNum",value:function(i){var s=Math.pow(10,(Math.floor(i)+"").length-1),l=i/s;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:1,s*l}},{key:"addScales",value:function(i,s){var l=this.controlOption,v=l.metric,g=l.imperial;v&&(this.mScale=W.create("div",i,s)),g&&(this.iScale=W.create("div",i,s))}}]),t}(em);function pM(e){var r=dM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function dM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vM=function(e){bn()(t,e);var r=pM(t);function t(n){var i;return dt()(this,t),i=r.call(this,n),w()(ue()(i),"disabled",void 0),w()(ue()(i),"zoomInButton",void 0),w()(ue()(i),"zoomOutButton",void 0),ts(["updateDisabled","zoomIn","zoomOut"],ue()(i)),i}return yt()(t,[{key:"getDefault",value:function(){return{position:up.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var i="l7-control-zoom",s=W.create("div",i+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,i+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,i+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(i,s,l,v,g){var x=W.create("a",l,v);return x.innerHTML=i,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var i=this.mapsService,s="l7-disabled";W.removeClass(this.zoomInButton,s),W.removeClass(this.zoomOutButton,s),(this.disabled||i.getZoom()<=i.getMinZoom())&&W.addClass(this.zoomOutButton,s),(this.disabled||i.getZoom()>=i.getMaxZoom())&&W.addClass(this.zoomInButton,s)}}]),t}(em);function gx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?gx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mM(e){var r=gM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function gM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _x=function(e){bn()(t,e);var r=mM(t);function t(n){var i;return dt()(this,t),i=r.call(this),w()(ue()(i),"markerOption",void 0),w()(ue()(i),"defaultMarker",void 0),w()(ue()(i),"popup",void 0),w()(ue()(i),"mapsService",void 0),w()(ue()(i),"sceneSerive",void 0),w()(ue()(i),"lngLat",void 0),w()(ue()(i),"scene",void 0),w()(ue()(i),"added",!1),w()(ue()(i),"eventHandle",function(s){i.emit(s.type,{target:s,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=yx(yx({},i.getDefault()),n),ts(["update","onMove","onUp","addDragHandler","onMapClick"],ue()(i)),i.init(),i}return yt()(t,[{key:"getDefault",value:function(){return{element:void 0,anchor:Hf.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Yt.IMapService),this.sceneSerive=i.get(Yt.ISceneService);var s=this.markerOption,l=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&W.remove(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var s=this;if(!this.added)return this.once("added",function(){s.setElement(i)}),this;var l=this.markerOption.element;return l&&W.remove(l),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,s=i.element,l=i.anchor;this.updatePosition(),W.setTransform(s,"".concat(Nh[l]))}}},{key:"onMapClick",value:function(i){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,s=i.element,l=i.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var R=this.mapsService.getContainer(),F=0,H=0;if(R&&(F=R.scrollWidth,H=R.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>F){var Q=this.mapsService.lngLatToContainer([g-360,x]);T.x=Q.x}if(T.x<0){var ie=this.mapsService.lngLatToContainer([g+360,x]);T.x=ie.x}}(T.x>F||T.x<0||T.y>H||T.y<0)&&(s.style.display="none"),s.style.left=T.x+l[0]+"px",s.style.top=T.y-l[1]+"px"}}}},{key:"init",value:function(){var i=this,s=this.markerOption.element,l=this.markerOption,v=l.color,g=l.anchor;if(!s){this.defaultMarker=!0,s=W.create("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}W.addClass(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var R,F,H=((R=i.markerOption)===null||R===void 0?void 0:R.style)&&((F=i.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=H)}),s.addEventListener("click",function(T){i.onMapClick(T)}),s.addEventListener("click",this.eventHandle),xd(s,g,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(i){throw new Error("Method not implemented.")}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(Zs.EventEmitter);function xx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function bx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?xx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function yM(e){var r=_M();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function _M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w6=function(e){bn()(t,e);var r=yM(t);function t(n){var i,s;return dt()(this,t),s=r.call(this),w()(ue()(s),"markers",[]),w()(ue()(s),"markerLayerOption",void 0),w()(ue()(s),"clusterIndex",void 0),w()(ue()(s),"points",[]),w()(ue()(s),"clusterMarkers",[]),w()(ue()(s),"mapsService",void 0),w()(ue()(s),"scene",void 0),w()(ue()(s),"zoom",void 0),w()(ue()(s),"bbox",void 0),s.markerLayerOption=Ro()(s.getDefault(),n),ts(["update"],ue()(s)),s.zoom=((i=s.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,s}return yt()(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(Yt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(i){var s=this.markerLayerOption.cluster;s&&this.addPoint(i,this.markers.length),this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var s=this.markers.indexOf(i);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(s){s.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(i,s){var l=i.getLnglat(),v=l.lng,g=l.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:bx(bx({},i.getExtData()),{},{marker_id:s})};this.points.push(x)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,s=i.radius,l=i.minZoom,v=l===void 0?0:l,g=i.maxZoom;this.clusterIndex=new Rc.a({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,s){var l=this,v=i[0].concat(i[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=l.markerLayerOption.clusterOption,R=T.field,F=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var H,Q=l.getLeaves((H=x.properties)===null||H===void 0?void 0:H.cluster_id);if(x.properties.clusterData=Q,R&&F){var ie=Q==null?void 0:Q.map(function(bt){var Et=w()({},R,bt.properties[R]);return Et}),be=re.getColumn(ie,R),je=re.getSatByColumn(F,be),Je="point_"+F;x.properties[Je]=je.toFixed(2)}}var et=l.clusterMarker(x);l.clusterMarkers.push(et),et.addTo(l.scene)})}},{key:"getLeaves",value:function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,s,l):null}},{key:"clusterMarker",value:function(i){var s=this.markerLayerOption.clusterOption,l=s,v=l.element,g=v===void 0?this.generateElement.bind(this):v,x=new _x({element:g(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(i){var s=i.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var i=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!co(this.bbox,s))&&(this.bbox=yo(s,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(i){var s=W.create("div","l7-marker-cluster"),l=W.create("div","",s),v=W.create("span","",l),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;i.properties.point_count=i.properties.point_count||1;var T=x&&C?i.properties["point_"+C]||i.properties[x]:i.properties.point_count;return v.textContent=T,s}}]),t}(Zs.EventEmitter);function Ex(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Sx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ex(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ex(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function xM(e){var r=bM();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cx=function(e){bn()(t,e);var r=xM(t);function t(n){var i;return dt()(this,t),i=r.call(this),w()(ue()(i),"popupOption",void 0),w()(ue()(i),"mapsService",void 0),w()(ue()(i),"sceneSerive",void 0),w()(ue()(i),"lngLat",void 0),w()(ue()(i),"content",void 0),w()(ue()(i),"closeButton",void 0),w()(ue()(i),"timeoutInstance",void 0),w()(ue()(i),"container",void 0),w()(ue()(i),"tip",void 0),w()(ue()(i),"scene",void 0),i.popupOption=Sx(Sx({},i.getdefault()),n),ts(["update","onClickClose","remove"],ue()(i)),i}return yt()(t,[{key:"addTo",value:function(i){var s=this;return this.mapsService=i.get(Yt.IMapService),this.sceneSerive=i.get(Yt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(i){var s=window.document.createDocumentFragment(),l=window.document.createElement("body"),v;for(l.innerHTML=i;v=l.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(i){return this.setDOMContent(window.document.createTextNode(i))}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"setDOMContent",value:function(i){return this.createContent(),this.content.appendChild(i),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&W.remove(this.content),this.content=W.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=W.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(i,s,l){var v=window.document.createElement(i);return s!==void 0&&(v.className=s),l&&l.appendChild(v),v}},{key:"removeDom",value:function(i){i.parentNode&&i.parentNode.removeChild(i)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Hf.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(i){i.stopPropagation&&i.stopPropagation(),this.remove()}},{key:"update",value:function(){var i=this,s=this.lngLat,l=this.popupOption,v=l.className,g=l.maxWidth,x=l.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(R){return i.container.classList.add(R)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){i.container.addEventListener(R,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),W.setTransform(this.container,"".concat(Nh[x])),xd(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.lngLat,s=i.lng,l=i.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,l]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),t}(Zs.EventEmitter);function EM(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}EM(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var SM=O("SUU4"),CM=O.n(SM),wM=function(){function e(r,t){dt()(this,e),w()(this,"attribute",void 0),w()(this,"buffer",void 0);var n=t.buffer,i=t.offset,s=t.stride,l=t.normalized,v=t.size,g=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:s||0,normalized:l||!1,divisor:g||0},v&&(this.attribute.size=v)}return yt()(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Th,tm,Mh,Hc,rm,lp,nm,$m,eh,rd,el,th,rh,Km,AM=(Th={},w()(Th,oe.POINTS,"points"),w()(Th,oe.LINES,"lines"),w()(Th,oe.LINE_LOOP,"line loop"),w()(Th,oe.LINE_STRIP,"line strip"),w()(Th,oe.TRIANGLES,"triangles"),w()(Th,oe.TRIANGLE_FAN,"triangle fan"),w()(Th,oe.TRIANGLE_STRIP,"triangle strip"),Th),Ax=(tm={},w()(tm,oe.STATIC_DRAW,"static"),w()(tm,oe.DYNAMIC_DRAW,"dynamic"),w()(tm,oe.STREAM_DRAW,"stream"),tm),wg=(Mh={},w()(Mh,oe.BYTE,"int8"),w()(Mh,oe.UNSIGNED_INT,"int16"),w()(Mh,oe.INT,"int32"),w()(Mh,oe.UNSIGNED_BYTE,"uint8"),w()(Mh,oe.UNSIGNED_SHORT,"uint16"),w()(Mh,oe.UNSIGNED_INT,"uint32"),w()(Mh,oe.FLOAT,"float"),Mh),TM=(Hc={},w()(Hc,oe.ALPHA,"alpha"),w()(Hc,oe.LUMINANCE,"luminance"),w()(Hc,oe.LUMINANCE_ALPHA,"luminance alpha"),w()(Hc,oe.RGB,"rgb"),w()(Hc,oe.RGBA,"rgba"),w()(Hc,oe.RGBA4,"rgba4"),w()(Hc,oe.RGB5_A1,"rgb5 a1"),w()(Hc,oe.RGB565,"rgb565"),w()(Hc,oe.DEPTH_COMPONENT,"depth"),w()(Hc,oe.DEPTH_STENCIL,"depth stencil"),Hc),MM=(rm={},w()(rm,oe.DONT_CARE,"dont care"),w()(rm,oe.NICEST,"nice"),w()(rm,oe.FASTEST,"fast"),rm),Tx=(lp={},w()(lp,oe.NEAREST,"nearest"),w()(lp,oe.LINEAR,"linear"),w()(lp,oe.LINEAR_MIPMAP_LINEAR,"mipmap"),w()(lp,oe.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),w()(lp,oe.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),w()(lp,oe.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),lp),Mx=(nm={},w()(nm,oe.REPEAT,"repeat"),w()(nm,oe.CLAMP_TO_EDGE,"clamp"),w()(nm,oe.MIRRORED_REPEAT,"mirror"),nm),PM=($m={},w()($m,oe.NONE,"none"),w()($m,oe.BROWSER_DEFAULT_WEBGL,"browser"),$m),OM=(eh={},w()(eh,oe.NEVER,"never"),w()(eh,oe.ALWAYS,"always"),w()(eh,oe.LESS,"less"),w()(eh,oe.LEQUAL,"lequal"),w()(eh,oe.GREATER,"greater"),w()(eh,oe.GEQUAL,"gequal"),w()(eh,oe.EQUAL,"equal"),w()(eh,oe.NOTEQUAL,"notequal"),eh),Px=(rd={},w()(rd,oe.FUNC_ADD,"add"),w()(rd,oe.MIN_EXT,"min"),w()(rd,oe.MAX_EXT,"max"),w()(rd,oe.FUNC_SUBTRACT,"subtract"),w()(rd,oe.FUNC_REVERSE_SUBTRACT,"reverse subtract"),rd),qm=(el={},w()(el,oe.ZERO,"zero"),w()(el,oe.ONE,"one"),w()(el,oe.SRC_COLOR,"src color"),w()(el,oe.ONE_MINUS_SRC_COLOR,"one minus src color"),w()(el,oe.SRC_ALPHA,"src alpha"),w()(el,oe.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),w()(el,oe.DST_COLOR,"dst color"),w()(el,oe.ONE_MINUS_DST_COLOR,"one minus dst color"),w()(el,oe.DST_ALPHA,"dst alpha"),w()(el,oe.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),w()(el,oe.CONSTANT_COLOR,"constant color"),w()(el,oe.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),w()(el,oe.CONSTANT_ALPHA,"constant alpha"),w()(el,oe.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),w()(el,oe.SRC_ALPHA_SATURATE,"src alpha saturate"),el),IM=(th={},w()(th,oe.NEVER,"never"),w()(th,oe.ALWAYS,"always"),w()(th,oe.LESS,"less"),w()(th,oe.LEQUAL,"lequal"),w()(th,oe.GREATER,"greater"),w()(th,oe.GEQUAL,"gequal"),w()(th,oe.EQUAL,"equal"),w()(th,oe.NOTEQUAL,"notequal"),th),Qd=(rh={},w()(rh,oe.ZERO,"zero"),w()(rh,oe.KEEP,"keep"),w()(rh,oe.REPLACE,"replace"),w()(rh,oe.INVERT,"invert"),w()(rh,oe.INCR,"increment"),w()(rh,oe.DECR,"decrement"),w()(rh,oe.INCR_WRAP,"increment wrap"),w()(rh,oe.DECR_WRAP,"decrement wrap"),rh),RM=(Km={},w()(Km,oe.FRONT,"front"),w()(Km,oe.BACK,"back"),Km),kM=function(){function e(r,t){dt()(this,e),w()(this,"buffer",void 0);var n=t.data,i=t.usage,s=t.type;this.buffer=r.buffer({data:n,usage:Ax[i||oe.STATIC_DRAW],type:wg[s||oe.UNSIGNED_BYTE]})}return yt()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),LM=function(){function e(r,t){dt()(this,e),w()(this,"elements",void 0);var n=t.data,i=t.usage,s=t.type,l=t.count;this.elements=r.elements({data:n,usage:Ax[i||oe.STATIC_DRAW],type:wg[s||oe.UNSIGNED_BYTE],count:l})}return yt()(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),DM=function(){function e(r,t){dt()(this,e),w()(this,"framebuffer",void 0);var n=t.width,i=t.height,s=t.color,l=t.colors,v=t.depth,g=t.stencil,x={width:n,height:i};Array.isArray(l)&&(x.colors=l.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=r.framebuffer(x)}return yt()(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),FM=O("c6wG"),BM=O.n(FM),NM=O("YO3V"),zM=O.n(NM);function Ox(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function nh(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ox(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ox(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var UM=function(){function e(r,t){dt()(this,e),w()(this,"reGl",void 0),w()(this,"destroyed",!1),w()(this,"drawCommand",void 0),w()(this,"drawPickCommand",void 0),w()(this,"drawParams",void 0),w()(this,"options",void 0),w()(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,s=t.attributes,l=t.uniforms,v=t.primitive,g=t.count,x=t.elements,C=t.depth,T=t.blend,R=t.stencil,F=t.cull,H=t.instances,Q={};this.options=t,l&&(this.uniforms=this.extractUniforms(l),Object.keys(l).forEach(function(Je){Q[Je]=r.prop(Je)}));var ie={};Object.keys(s).forEach(function(Je){ie[Je]=s[Je].get()});var be={attributes:ie,frag:i,uniforms:Q,vert:n,blend:{},primitive:AM[v===void 0?oe.TRIANGLES:v]};H&&(be.instances=H),g&&(be.count=g),x&&(be.elements=x.get()),this.initDepthDrawParams({depth:C},be),this.initBlendDrawParams({blend:T},be),this.initStencilDrawParams({stencil:R},be),this.initCullDrawParams({cull:F},be),this.drawCommand=r(be);var je=Yl()(be);je.blend=nh(nh({},je.blend),{},{enable:!1}),je.stencil=nh(nh({},je.stencil),{},{enable:!1}),this.drawPickCommand=r(je),this.drawParams=be}return yt()(e,[{key:"addUniforms",value:function(t){this.uniforms=nh(nh({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=nh(nh({},this.uniforms),this.extractUniforms(t.uniforms||{})),s={};Object.keys(i).forEach(function(l){var v=lh()(i[l]);v==="boolean"||v==="number"||Array.isArray(i[l])||i[l].BYTES_PER_ELEMENT?s[l]=i[l]:s[l]=i[l].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(t){t.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:OM[i.func||oe.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(t,n){var i=t.blend;if(i){var s=i.enable,l=i.func,v=i.equation,g=i.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:qm[l&&l.srcRGB||oe.SRC_ALPHA],srcAlpha:qm[l&&l.srcAlpha||oe.SRC_ALPHA],dstRGB:qm[l&&l.dstRGB||oe.ONE_MINUS_SRC_ALPHA],dstAlpha:qm[l&&l.dstAlpha||oe.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Px[v&&v.rgb||oe.FUNC_ADD],alpha:Px[v&&v.alpha||oe.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(t,n){var i=t.stencil;if(i){var s=i.enable,l=i.mask,v=l===void 0?-1:l,g=i.func,x=g===void 0?{cmp:oe.ALWAYS,ref:0,mask:-1}:g,C=i.opFront,T=C===void 0?{fail:oe.KEEP,zfail:oe.KEEP,zpass:oe.KEEP}:C,R=i.opBack,F=R===void 0?{fail:oe.KEEP,zfail:oe.KEEP,zpass:oe.KEEP}:R;n.stencil={enable:!!s,mask:v,func:nh(nh({},x),{},{cmp:IM[x.cmp]}),opFront:{fail:Qd[T.fail],zfail:Qd[T.zfail],zpass:Qd[T.zpass]},opBack:{fail:Qd[F.fail],zfail:Qd[F.zfail],zpass:Qd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var s=i.enable,l=i.face,v=l===void 0?oe.BACK:l;n.cull={enable:!!s,face:RM[v]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(s){n.extractUniformsRecursively(s,t[s],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,s){var l=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||BM()(n)||n===""||"resize"in n){i["".concat(s&&s+".").concat(t)]=n;return}zM()(n)&&Object.keys(n).forEach(function(v){l.extractUniformsRecursively(v,n[v],i,"".concat(s&&s+".").concat(t))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){l.extractUniformsRecursively(x,v[x],i,"".concat(s&&s+".").concat(t,"[").concat(g,"]"))})})}}]),e}(),jM=function(){function e(r,t){dt()(this,e),w()(this,"texture",void 0),w()(this,"width",void 0),w()(this,"height",void 0),w()(this,"isDistroy",!1);var n=t.data,i=t.type,s=i===void 0?oe.UNSIGNED_BYTE:i,l=t.width,v=t.height,g=t.flipY,x=g===void 0?!1:g,C=t.format,T=C===void 0?oe.RGBA:C,R=t.mipmap,F=R===void 0?!1:R,H=t.wrapS,Q=H===void 0?oe.CLAMP_TO_EDGE:H,ie=t.wrapT,be=ie===void 0?oe.CLAMP_TO_EDGE:ie,je=t.aniso,Je=je===void 0?0:je,et=t.alignment,bt=et===void 0?1:et,Et=t.premultiplyAlpha,kt=Et===void 0?!1:Et,jt=t.mag,mr=jt===void 0?oe.NEAREST:jt,Ar=t.min,pr=Ar===void 0?oe.NEAREST:Ar,pn=t.colorSpace,Tn=pn===void 0?oe.BROWSER_DEFAULT_WEBGL:pn,Jn=t.x,va=Jn===void 0?0:Jn,oo=t.y,ko=oo===void 0?0:oo,ss=t.copy,eo=ss===void 0?!1:ss;this.width=l,this.height=v;var Bl={width:l,height:v,type:wg[s],format:TM[T],wrapS:Mx[Q],wrapT:Mx[be],mag:Tx[mr],min:Tx[pr],alignment:bt,flipY:x,colorSpace:PM[Tn],premultiplyAlpha:kt,aniso:Je,x:va,y:ko,copy:eo};n&&(Bl.data=n),typeof F=="number"?Bl.mipmap=MM[F]:typeof F=="boolean"&&(Bl.mipmap=F),this.texture=r.texture(Bl)}return yt()(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),Ix,Rx,VM=(Ix=Object(vr.injectable)(),Ix(Rx=function(){function e(){var r=this;dt()(this,e),w()(this,"extensionObject",void 0),w()(this,"gl",void 0),w()(this,"$container",void 0),w()(this,"canvas",void 0),w()(this,"width",void 0),w()(this,"height",void 0),w()(this,"isDirty",void 0),w()(this,"createModel",function(t){return new UM(r.gl,t)}),w()(this,"createAttribute",function(t){return new wM(r.gl,t)}),w()(this,"createBuffer",function(t){return new kM(r.gl,t)}),w()(this,"createElements",function(t){return new LM(r.gl,t)}),w()(this,"createTexture2D",function(t){return new jM(r.gl,t)}),w()(this,"createFramebuffer",function(t){return new DM(r.gl,t)}),w()(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),w()(this,"clear",function(t){var n=t.color,i=t.depth,s=t.stencil,l=t.framebuffer,v=l===void 0?null:l,g={color:n,depth:i,stencil:s};g.framebuffer=v===null?v:v.get(),r.gl.clear(g)}),w()(this,"viewport",function(t){var n=t.x,i=t.y,s=t.width,l=t.height;r.gl._gl.viewport(n,i,s,l),r.width=s,r.height=l,r.gl._refresh()}),w()(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,s=t.y,l=t.width,v=t.height,g={x:i,y:s,width:l,height:v};return n&&(g.framebuffer=n.get()),r.gl.read(g)}),w()(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),w()(this,"getContainer",function(){if(_a)return r.canvas;var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),w()(this,"getCanvas",function(){return r.canvas}),w()(this,"getGLContext",function(){return r.gl._gl}),w()(this,"destroy",function(){r.gl.destroy()})}return yt()(e,[{key:"init",value:function(){var r=Ys()(Sa.a.mark(function n(i,s){var l=this;return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=i,g.next=3,new Promise(function(x,C){CM()({canvas:l.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(R,F){(R||!F)&&C(R),x(F)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Rx);function kx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Lx(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?kx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var im=function(){function e(r){dt()(this,e),w()(this,"sceneService",void 0),w()(this,"mapService",void 0),w()(this,"controlService",void 0),w()(this,"layerService",void 0),w()(this,"iconService",void 0),w()(this,"markerService",void 0),w()(this,"popupService",void 0),w()(this,"fontService",void 0),w()(this,"interactionService",void 0),w()(this,"container",void 0);var t=r.id,n=r.map,i=r.canvas,s=r.hasBaseMap,l=jT();this.container=l,n.setContainer(l,t,i,s),l.bind(Yt.IRendererService).to(VM).inSingletonScope(),this.sceneService=l.get(Yt.ISceneService),this.mapService=l.get(Yt.IMapService),this.iconService=l.get(Yt.IIconService),this.fontService=l.get(Yt.IFontService),this.controlService=l.get(Yt.IControlService),this.layerService=l.get(Yt.ILayerService),this.markerService=l.get(Yt.IMarkerService),this.interactionService=l.get(Yt.IInteractionService),this.popupService=l.get(Yt.IPopupService),_a?this.sceneService.initMiniScene(r):(this.initComponent(t),this.sceneService.init(r),this.initControl())}return yt()(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(t){return this.sceneService.exportPng(t)}},{key:"exportMap",value:function(t){return this.sceneService.exportPng(t)}},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var s=new t(n);s.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=VT(this.container);t.setContainer(n,this.container),this.sceneService.addLayer(t)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(t,n){this.layerService.remove(t,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var s=ft()(i,2),l=s[0],v=s[1];n.fontService.addIconFont(l,v)})}},{key:"addFontFace",value:function(t,n){this.sceneService.addFontFace(t,n)}},{key:"addImage",value:function(t,n){_a?this.iconService.addImageMini(t,n,this.sceneService):this.iconService.addImage(t,n)}},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"on",value:function(t,n){Cg.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.on(t,n)}},{key:"once",value:function(t,n){Cg.indexOf(t)===-1?this.mapService.once(t,n):this.sceneService.once(t,n)}},{key:"off",value:function(t,n){Cg.indexOf(t)===-1?this.mapService.off(t,n):this.sceneService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),s=i.fitBoundsOptions,l=i.animate;this.mapService.fitBounds(t,n||Lx(Lx({},s),{},{animate:l}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Yt.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:W.getContainer(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new mx({position:i}))}}]),e}(),GM=O("GoyQ"),gl=O.n(GM),Dx,Fx,Bx,Ag,Nx;function zx(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}var HM=(Dx=Object(vr.injectable)(),Fx=Object(vr.inject)(Yt.IGlobalConfigService),Dx(Bx=(Ag=function(){function e(){dt()(this,e),Pi()(this,"configService",Nx,this),w()(this,"enabled",void 0)}return yt()(e,[{key:"apply",value:function(t,n){var i=this,s=n.rendererService,l=n.postProcessingPassFactory,v=n.normalPassFactory;t.hooks.init.tap("MultiPassRendererPlugin",function(){var g=t.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;i.enabled=!!x&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=i.createMultiPassRenderer(t,T,l,v),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;t.multiPassRenderer.resize(x,C)}})}},{key:"createMultiPassRenderer",value:function(t,n,i,s){var l=t.multiPassRenderer,v=t.getLayerConfig(),g=v.enablePicking,x=v.enableTAA;return x?l.add(s("taa")):l.add(s("render")),zx(n).forEach(function(C){var T=ft()(C,2),R=T[0],F=T[1];l.add(i(R),F)}),l.add(i("copy")),l}}]),e}(),Nx=Mi()(Ag.prototype,"configService",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ag))||Bx),cp,Ux=(cp={},w()(cp,Gc.additive,{enable:!0,func:{srcRGB:oe.ONE,dstRGB:oe.ONE,srcAlpha:1,dstAlpha:1}}),w()(cp,Gc.none,{enable:!1}),w()(cp,Gc.normal,{enable:!0,func:{srcRGB:oe.SRC_ALPHA,dstRGB:oe.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),w()(cp,Gc.subtractive,{enable:!0,func:{srcRGB:oe.ONE,dstRGB:oe.ONE,srcAlpha:oe.ZERO,dstAlpha:oe.ONE_MINUS_SRC_COLOR},equation:{rgb:oe.FUNC_SUBTRACT,alpha:oe.FUNC_SUBTRACT}}),w()(cp,Gc.max,{enable:!0,func:{srcRGB:oe.ONE,dstRGB:oe.ONE},equation:{rgb:oe.MAX_EXT}}),w()(cp,Gc.min,{enable:!0,func:{srcRGB:oe.ONE,dstRGB:oe.ONE},equation:{rgb:oe.MIN_EXT}}),cp),WM=O("UB5X"),Ba=O.n(WM),ZM=O("Z0cm"),nd=O.n(ZM),A6=1024;function Fl(e,r,t,n,i){r.updateStyleAttribute(e,t,n,i)}function XM(e,r){e.opacity&&Qm("opacity",r,e.opacity),e.strokeWidth&&Qm("strokeWidth",r,e.strokeWidth),e.strokeOpacity&&Qm("strokeOpacity",r,e.strokeOpacity),e.stroke&&YM("stroke",r,e.stroke),e.offsets&&jx("offsets",r,e.offsets),e.textOffset&&jx("textOffset",r,e.textOffset),e.thetaOffset&&Qm("thetaOffset",r,e.thetaOffset)}function Qm(e,r,t){Ws()(t)?Fl(e,r,t,function(n){return n}):Ba()(t)?Fl(e,r,[t],void 0):nd()(t)&&t.length===2?Ws()(t[0])&&ll()(t[1])||Ws()(t[0])&&nd()(t[1])&&Ba()(t[1][0])&&Ba()(t[1][1])?Fl(e,r,t[0],t[1]):Fl(e,r,[1],void 0):Fl(e,r,[1],void 0)}function jx(e,r,t){Ws()(t)?Fl(e,r,t,function(n){return n}):nd()(t)&&t.length===2&&Ws()(t[0])&&ll()(t[1])?Fl(e,r,t[0],t[1]):nd()(t)&&t.length===2&&Ba()(t[0])&&Ba()(t[1])?Fl(e,r,t,void 0):Fl(e,r,[0,0],void 0)}function YM(e,r,t){Ws()(t)?Fl(e,r,t,void 0):nd()(t)&&t.length===2&&(Ws()(t[0])&&ll()(t[1])||Ws()(t[0])&&nd()(t[1])&&t[1].length>0)?Fl(e,r,t[0],t[1]):Fl(e,r,"#fff",void 0)}var $M=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function KM(e,r,t){typeof r=="string"&&typeof t=="string"&&r!==t&&$M.map(function(n){n.includes(r)&&n.includes(t)&&(e.dataState.dataSourceNeedUpdate=!0)})}var qM=["passes"],QM=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Vx,Tg,Gx;function JM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=eP(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function eP(e,r){if(!!e){if(typeof e=="string")return Hx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Hx(e,r)}}function Hx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Wx(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yl(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Wx(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Wx(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tP(e){var r=rP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function rP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zx=0,id=(Vx=Sg(Yt.IGlobalConfigService),Tg=function(e){bn()(t,e);var r=tP(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return dt()(this,t),n=r.call(this),w()(ue()(n),"id","".concat(Zx++)),w()(ue()(n),"name","".concat(Zx)),w()(ue()(n),"type",void 0),w()(ue()(n),"visible",!0),w()(ue()(n),"zIndex",0),w()(ue()(n),"minZoom",void 0),w()(ue()(n),"maxZoom",void 0),w()(ue()(n),"inited",!1),w()(ue()(n),"layerModelNeedUpdate",!1),w()(ue()(n),"pickedFeatureID",null),w()(ue()(n),"selectedFeatureID",null),w()(ue()(n),"styleNeedUpdate",!1),w()(ue()(n),"rendering",void 0),w()(ue()(n),"clusterZoom",0),w()(ue()(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),w()(ue()(n),"hooks",{init:new Ds.b,afterInit:new Ds.b,beforeRender:new Ds.b,beforeRenderData:new Ds.d,afterRender:new Ds.c,beforePickingEncode:new Ds.c,afterPickingEncode:new Ds.c,beforeHighlight:new Ds.c(["pickedColor"]),afterHighlight:new Ds.c,beforeSelect:new Ds.c(["pickedColor"]),afterSelect:new Ds.c,beforeDestroy:new Ds.c,afterDestroy:new Ds.c}),w()(ue()(n),"models",[]),w()(ue()(n),"multiPassRenderer",void 0),w()(ue()(n),"plugins",void 0),w()(ue()(n),"sourceOption",void 0),w()(ue()(n),"layerModel",void 0),w()(ue()(n),"sceneContainer",void 0),w()(ue()(n),"layerChildren",[]),Pi()(ue()(n),"configService",Gx,ue()(n)),w()(ue()(n),"shaderModuleService",void 0),w()(ue()(n),"cameraService",void 0),w()(ue()(n),"coordinateService",void 0),w()(ue()(n),"iconService",void 0),w()(ue()(n),"fontService",void 0),w()(ue()(n),"pickingService",void 0),w()(ue()(n),"rendererService",void 0),w()(ue()(n),"layerService",void 0),w()(ue()(n),"interactionService",void 0),w()(ue()(n),"mapService",void 0),w()(ue()(n),"styleAttributeService",void 0),w()(ue()(n),"layerSource",void 0),w()(ue()(n),"postProcessingPassFactory",void 0),w()(ue()(n),"normalPassFactory",void 0),w()(ue()(n),"animateOptions",{enable:!1}),w()(ue()(n),"container",void 0),w()(ue()(n),"encodedData",void 0),w()(ue()(n),"configSchema",void 0),w()(ue()(n),"currentPickId",null),w()(ue()(n),"rawConfig",void 0),w()(ue()(n),"needUpdateConfig",void 0),w()(ue()(n),"pendingStyleAttributes",[]),w()(ue()(n),"scaleOptions",{}),w()(ue()(n),"animateStartTime",void 0),w()(ue()(n),"aniamateStatus",!1),w()(ue()(n),"bottomColor","rgba(0, 0, 0, 0)"),w()(ue()(n),"isDestroied",!1),w()(ue()(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),l=s.autoFit,v=s.fitBoundsOptions;l&&n.fitBounds(v),n.emit("dataUpdate"),n.reRender()}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return yt()(t,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){if(!this.inited)this.needUpdateConfig=yl(yl({},this.needUpdateConfig),i);else{var s=this.container.get(Yt.SceneID);XM(i,this),this.configService.setLayerConfig(s,this.id,yl(yl(yl({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,s){this.container=i,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(i){this.bottomColor=i}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var i=this,s=this.container.get(Yt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.iconService=this.container.get(Yt.IIconService),this.fontService=this.container.get(Yt.IFontService),this.rendererService=this.container.get(Yt.IRendererService),this.layerService=this.container.get(Yt.ILayerService),this.interactionService=this.container.get(Yt.IInteractionService),this.pickingService=this.container.get(Yt.IPickingService),this.mapService=this.container.get(Yt.IMapService),this.cameraService=this.container.get(Yt.ICameraService),this.coordinateService=this.container.get(Yt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Yt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Yt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Yt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Yt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Yt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(x){var C=x.attributeName,T=x.attributeField,R=x.attributeValues,F=x.updateOptions;i.styleAttributeService.updateStyleAttribute(C,{scale:yl({field:T},i.splitValuesAndCallbackInAttribute(R,i.getLayerConfig()[C]))},F)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Yt.ILayerPlugin);var l=JM(this.plugins),v;try{for(l.s();!(v=l.n()).done;){var g=v.value;g.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(x){l.e(x)}finally{l.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(yl(yl({},this.getDefaultConfig()),this.rawConfig));var i=this.getLayerConfig(),s=i.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(i,s,l){return this.updateStyleAttribute("color",i,s,l),this}},{key:"texture",value:function(i,s,l){return this.updateStyleAttribute("texture",i,s,l),this}},{key:"rotate",value:function(i,s,l){return this.updateStyleAttribute("rotate",i,s,l),this}},{key:"size",value:function(i,s,l){return this.updateStyleAttribute("size",i,s,l),this}},{key:"filter",value:function(i,s,l){return this.updateStyleAttribute("filter",i,s,l),this}},{key:"shape",value:function(i,s,l){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=i;return this.updateStyleAttribute("shape",i,s,l),KM(this,C,T),this}},{key:"label",value:function(i,s,l){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:s,updateOptions:l}),this}},{key:"animate",value:function(i){var s={};return gl()(i)?(s.enable=!0,s=yl(yl({},s),i)):s.enable=i,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(i,s){return i!=null&&i.data?(this.setSource(i),this):(this.sourceOption={data:i,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(i,s){var l=this;return this.inited?this.layerSource.setData(i,s):this.on("inited",function(){l.layerSource.setData(i,s)}),this}},{key:"style",value:function(i){var s=this,l=i.passes,v=Ch()(i,qM);return l&&zx(l).forEach(function(g){var x=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(g[0]);x&&x.updateOptions(g[1])}),this.rawConfig=yl(yl({},this.rawConfig),v),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(i,s){return gl()(i)?this.scaleOptions=yl(yl({},this.scaleOptions),i):this.scaleOptions[i]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=Ys()(Sa.a.mark(function s(){return Sa.a.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var s={};return s.enableHighlight=gl()(i)?!0:i,gl()(i)?(s.enableHighlight=!0,i.color&&(s.highlightColor=i.color),i.mix&&(s.activeMix=i.mix)):s.enableHighlight=!!i,this.updateLayerConfig(s),this}},{key:"setActive",value:function(i,s){var l=this;if(gl()(i)){var v=i.x,g=v===void 0?0:v,x=i.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:gl()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:gl()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:gl()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:gl()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(fc(i)).then(function(){setTimeout(function(){l.reRender()},1)})}},{key:"select",value:function(i){var s={};return s.enableSelect=gl()(i)?!0:i,gl()(i)?(s.enableSelect=!0,i.color&&(s.selectColor=i.color),i.mix&&(s.selectMix=i.mix)):s.enableSelect=!!i,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(i,s){var l=this;if(gl()(i)){var v=i.x,g=v===void 0?0:v,x=i.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:gl()(s)?s.color:this.getLayerConfig().selectColor,selectMix:gl()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:gl()(s)?s.color:this.getLayerConfig().selectColor,selectMix:gl()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(fc(i)).then(function(){setTimeout(function(){l.reRender()},1)})}},{key:"setBlend",value:function(i){this.updateLayerConfig({blend:i}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),s=this.getLayerConfig(),l=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!l&&i>=g&&i<=C}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),s=i.minZoom;return s}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),s=i.maxZoom;return s}},{key:"get",value:function(i){var s=this.getLayerConfig();return s[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),l=s.extent,v=l.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[l[0],l[1]],[l[2],l[3]]],i),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(i){return i.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegendItems",value:function(i){var s=this.styleAttributeService.getLayerAttributeScale(i);if(s){if(s.ticks){var l=s.ticks().map(function(x){return w()({value:x},i,s(x))});return l}else if(s.invertExtent){var v=s.range().map(function(x){return w()({value:s.invertExtent(x)},i,x)});return v}else if(s!=null&&s.domain){var g=s.domain().map(function(x){return{value:x||"\u65E0",color:s(x)}});return g}}else return[]}},{key:"pick",value:function(i){var s=i.x,l=i.y;this.interactionService.triggerHover({x:s,y:l})}},{key:"boxSelect",value:function(i,s){this.pickingService.boxPickLayer(this,i,s)}},{key:"buildLayerModel",value:function(i){var s=i.moduleName,l=i.vertexShader,v=i.fragmentShader,g=i.triangulation,x=i.segmentNumber,C=Ch()(i,QM);this.shaderModuleService.registerModule(s,{vs:l,fs:v});var T=this.shaderModuleService.getModule(s),R=T.vs,F=T.fs,H=T.uniforms,Q=this.rendererService.createModel,ie=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),be=ie.attributes,je=ie.elements;return Q(yl({attributes:be,uniforms:H,fs:F,vs:R,elements:je,blend:Ux[Gc.normal]},C))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var s=this.getLayerConfig(),l=s.enableHighlight,v=l===void 0?!0:l,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&x&&(C=!0),i==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=Ys()(Sa.a.mark(function s(l){return Sa.a.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,l.render();case 2:case"end":return g.stop()}},s)}));function i(s){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(i){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(l){l.draw({uniforms:s.layerModel.getUninforms()},i)})),this}},{key:"updateStyleAttribute",value:function(i,s,l,v){this.inited?this.styleAttributeService.updateStyleAttribute(i,{scale:yl({field:s},this.splitValuesAndCallbackInAttribute(l,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:i,attributeField:s,attributeValues:l,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(i,s){return{values:ll()(i)?void 0:i||s,callback:ll()(i)?i:void 0}}}]),t}(Zs.EventEmitter),Gx=Mi()(Tg.prototype,"configService",[Vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg),nP=O("Y+p1"),Jd=O.n(nP),Xx,Mg,Yx;function iP(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=aP(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function aP(e,r){if(!!e){if(typeof e=="string")return $x(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $x(e,r)}}function $x(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var ws=(Xx=Sg(Yt.IGlobalConfigService),Mg=function(){function e(r){dt()(this,e),w()(this,"triangulation",void 0),w()(this,"createTexture2D",void 0),w()(this,"layer",void 0),w()(this,"dataTexture",void 0),w()(this,"DATA_TEXTURE_WIDTH",void 0),w()(this,"rowCount",void 0),w()(this,"cacheStyleProperties",void 0),w()(this,"cellLength",void 0),w()(this,"cellProperties",void 0),w()(this,"cellTypeLayout",void 0),w()(this,"stylePropertyesExist",void 0),w()(this,"dataTextureTest",void 0),Pi()(this,"configService",Yx,this),w()(this,"shaderModuleService",void 0),w()(this,"rendererService",void 0),w()(this,"iconService",void 0),w()(this,"fontService",void 0),w()(this,"styleAttributeService",void 0),w()(this,"mapService",void 0),w()(this,"cameraService",void 0),w()(this,"layerService",void 0),this.layer=r,this.rendererService=r.getContainer().get(Yt.IRendererService),this.shaderModuleService=r.getContainer().get(Yt.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Yt.IStyleAttributeService),this.mapService=r.getContainer().get(Yt.IMapService),this.iconService=r.getContainer().get(Yt.IIconService),this.fontService=r.getContainer().get(Yt.IFontService),this.cameraService=r.getContainer().get(Yt.ICameraService),this.layerService=r.getContainer().get(Yt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:oe.NEAREST,min:oe.NEAREST,width:1,height:1}))}return yt()(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(t){var n=!1;return Jd()(t.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=t.thetaOffset),Jd()(t.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=t.opacity),Jd()(t.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=t.strokeOpacity),Jd()(t.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=t.strokeWidth),Jd()(t.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=t.stroke),Jd()(t.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=t.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(t){this.clearLastCalRes(),t.opacity!==void 0&&!Ba()(t.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),t.strokeOpacity!==void 0&&!Ba()(t.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),t.strokeWidth!==void 0&&!Ba()(t.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),t.stroke!==void 0&&!this.isStaticColor(t.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),t.offsets!==void 0&&!this.isOffsetStatic(t.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),t.thetaOffset!==void 0&&!Ba()(t.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(t){return Ws()(t)?!!vu(t):!1}},{key:"getStrokeColor",value:function(t){if(this.isStaticColor(t)){var n=Ka(t);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(t){return!!(nd()(t)&&t.length===2&&Ba()(t[0])&&Ba()(t[1]))}},{key:"patchMod",value:function(t,n){for(var i=0;i<n;i++)t.push(-1)}},{key:"patchData",value:function(t,n,i){var s=iP(i),l;try{for(s.s();!(l=s.n()).done;){var v=l.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?t.push.apply(t,Lr()(Ka(C))):g==="offsets"?this.isOffsetStatic(C)?t.push(-C[0],C[1]):t.push(0,0):t.push(Ba()(C)?C:1):this.patchMod(t,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(t,n,i){for(var s=n.length,l=Math.ceil(s*t/this.DATA_TEXTURE_WIDTH),v=l*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,i)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:l}}},{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return Ux[Gc[i]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Yx=Mi()(Mg.prototype,"configService",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg),oP=O("VmRL"),ih=O.n(oP),Jm=100,Kx=36,sP=40;function qx(e){return e/180*Math.acos(-1)}function Qx(e){var r=qx(e[0])+Math.PI/2,t=qx(e[1]),n=Jm+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),s=n*Math.cos(t)*Math.sin(r),l=n*Math.sin(t);return[s,l,i]}function Jx(e,r){var t=j.create(),n=j.create(),i=U.fromValues(0,1,0),s=U.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var l=typeof r.segments!="undefined"?r.segments:32,v=2+l,g=2*v,x=[],C=[],T=[],R=[],F=[],H=[],Q=0;Q<=v;Q++){for(var ie=Q/v,be=ie*Math.PI,je=0;je<=g;je++){var Je=je/g,et=Je*Math.PI*2;j.identity(n),j.rotateZ(n,n,-be),j.identity(t),j.rotateY(t,t,et),U.transformMat4(s,i,n),U.transformMat4(s,s,t),U.scale(s,s,-e),T.push(s.slice()),R.push.apply(R,Lr()(s.slice())),U.normalize(s,s),F.push.apply(F,Lr()(s.slice())),H.push([Je,1-ie]),R.push(Je,1-ie)}if(Q>0)for(var bt=T.length,Et=bt-2*(g+1);Et+g+2<bt;Et++)x.push([Et,Et+1,Et+g+1]),C.push(Et,Et+1,Et+g+1),x.push([Et+g+1,Et+1,Et+g+2]),C.push(Et+g+1,Et+1,Et+g+2)}return{cells:x,positions:T,uvs:H,positionsArr:R,indicesArr:C,normalArr:F}}var e0=m.create(),T6=m.create(),lu=m.create(),fp=m.create(),ev=m.create();function Pg(e,r,t,n,i){m.add(e,t,n),m.normalize(e,e),r=m.fromValues(-e[1],e[0]);var s=m.fromValues(-t[1],t[0]);return[i/m.dot(r,s),r]}function hp(e,r){return m.set(e,-r[1],r[0])}function tv(e,r,t){return m.sub(e,r,t),m.normalize(e,e),e}function Og(e,r){return e[0]===r[0]&&e[1]===r[1]}function M6(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var eb=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};dt()(this,e),w()(this,"complex",void 0),w()(this,"join",void 0),w()(this,"cap",void 0),w()(this,"miterLimit",void 0),w()(this,"thickness",void 0),w()(this,"normal",void 0),w()(this,"lastFlip",-1),w()(this,"miter",m.fromValues(0,0)),w()(this,"started",!1),w()(this,"dash",!1),w()(this,"totalDistance",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return yt()(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=t.length,l=i.startIndex,v=1;v<s;v++){var g,x,C,T=t[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=t[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var H=n[v],Q=v<t.length-1?[].concat(Lr()(t[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ie=v<n.length-1?n[v+1]:null,be=this.segment_gaode2(i,l,T,F,Q,R,H,ie);l+=be}if(this.dash)for(var je=0;je<i.positions.length/6;je++)i.positions[je*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=t.length,l=i.startIndex,v=1;v<s;v++){var g,x,C,T=t[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=t[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var H=n[v],Q=v<t.length-1?[].concat(Lr()(t[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,ie=v<n.length-1?n[v+1]:null,be=this.simpleSegment(i,l,T,F,Q,R,H,ie);l+=be}if(this.dash)for(var je=0;je<i.positions.length/6;je++)i.positions[je*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,s=n.startIndex,l=1;l<i;l++){var v=t[l-1],g=t[l],x=l<t.length-1?t[l+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,s=n.startIndex,l=1;l<i;l++){var v=t[l-1],g=t[l],x=l<t.length-1?t[l+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,s,l,v,g,x){var C=0,T=t.indices,R=t.positions,F=t.normals,H=this.cap==="square",Q=this.join==="bevel",ie=vi([g[0],g[1]]),be=vi([v[0],v[1]]);tv(lu,s,i);var je=0;if(this.dash&&(je=this.lineSegmentDistance(ie,be),this.totalDistance+=je),this.normal||(this.normal=m.create(),hp(this.normal,lu)),!this.started)if(this.started=!0,H){var Je=m.create(),et=m.create();m.add(Je,this.normal,lu),m.add(et,this.normal,lu),F.push(et[0],et[1],0),F.push(Je[0],Je[1],0),R.push(i[0],i[1],i[2]|0,this.totalDistance-je,-this.thickness,i[2]|0),R.push(i[0],i[1],i[2]|0,this.totalDistance-je,this.thickness,i[2]|0)}else this.extrusions(R,F,i,this.normal,this.thickness,this.totalDistance-je);if(T.push(n+0,n+1,n+2),l){Og(s,l)&&m.add(l,s,m.normalize(l,m.subtract(l,s,i))),tv(fp,l,s);var kt=Pg(ev,m.create(),lu,fp,this.thickness),jt=ft()(kt,2),mr=jt[0],Ar=jt[1],pr=m.dot(ev,this.normal)<0?-1:1,pn=Q;if(!pn&&this.join==="miter"){var Tn=mr;Tn>this.miterLimit&&(pn=!0)}pn?(F.push(this.normal[0],this.normal[1],0),F.push(Ar[0],Ar[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*pr,s[2]|0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*pr,s[2]|0),T.push.apply(T,Lr()(this.lastFlip!==-pr?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),hp(e0,fp),m.copy(this.normal,e0),F.push(this.normal[0],this.normal[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*pr,s[2]|0),C+=3):(this.extrusions(R,F,s,Ar,mr,this.totalDistance),T.push.apply(T,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),pr=-1,m.copy(this.normal,Ar),C+=2),this.lastFlip=pr}else{if(hp(this.normal,lu),H){var bt=m.create(),Et=m.create();m.sub(Et,lu,this.normal),m.add(bt,lu,this.normal),F.push(Et[0],Et[1],0),F.push(bt[0],bt[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(R,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(t,n,i,s,l){var v=0,g=t.indices,x=t.positions,C=t.normals,T=vi([s[0],s[1]]),R=vi([i[0],i[1]]);tv(lu,T,R);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,R),this.totalDistance+=F),this.normal||(this.normal=m.create(),hp(this.normal,lu)),this.started||(this.started=!0,this.extrusions(x,C,i,this.normal,this.thickness,this.totalDistance-F)),g.push(n+0,n+1,n+2),!l)hp(this.normal,lu),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var H=vi([l[0],l[1]]);Og(T,H)&&m.add(H,T,m.normalize(H,m.subtract(H,T,R))),tv(fp,H,T);var Q=Pg(ev,m.create(),lu,fp,this.thickness),ie=ft()(Q,2),be=ie[0],je=ie[1],Je=m.dot(ev,this.normal)<0?-1:1;this.extrusions(x,C,s,je,be,this.totalDistance),g.push.apply(g,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Je=-1,m.copy(this.normal,je),v+=2,this.lastFlip=Je}return v}},{key:"segment",value:function(t,n,i,s,l){var v=0,g=t.indices,x=t.positions,C=t.normals,T=this.cap==="square",R=this.join==="bevel",F=vi([s[0],s[1]]),H=vi([i[0],i[1]]);tv(lu,F,H);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(F,H),this.totalDistance+=Q),this.normal||(this.normal=m.create(),hp(this.normal,lu)),!this.started)if(this.started=!0,T){var ie=m.create(),be=m.create();m.add(ie,this.normal,lu),m.add(be,this.normal,lu),C.push(be[0],be[1],0),C.push(ie[0],ie[1],0),x.push(i[0],i[1],i[2]|0,this.totalDistance-Q,-this.thickness,i[2]|0),x.push(i[0],i[1],i[2]|0,this.totalDistance-Q,this.thickness,i[2]|0)}else this.extrusions(x,C,i,this.normal,this.thickness,this.totalDistance-Q);if(g.push(n+0,n+1,n+2),l){var et=vi([l[0],l[1]]);Og(F,et)&&m.add(et,F,m.normalize(et,m.subtract(et,F,H))),tv(fp,et,F);var bt=Pg(ev,m.create(),lu,fp,this.thickness),Et=ft()(bt,2),kt=Et[0],jt=Et[1],mr=m.dot(ev,this.normal)<0?-1:1,Ar=R;if(!Ar&&this.join==="miter"){var pr=kt;pr>this.miterLimit&&(Ar=!0)}Ar?(C.push(this.normal[0],this.normal[1],0),C.push(jt[0],jt[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*mr,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*mr,s[2]|0),g.push.apply(g,Lr()(this.lastFlip!==-mr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),hp(e0,fp),m.copy(this.normal,e0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*mr,s[2]|0),v+=3):(this.extrusions(x,C,s,jt,kt,this.totalDistance),g.push.apply(g,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),mr=-1,m.copy(this.normal,jt),v+=2),this.lastFlip=mr}else{if(hp(this.normal,lu),T){var je=m.create(),Je=m.create();m.sub(Je,lu,this.normal),m.add(je,lu,this.normal),C.push(Je[0],Je[1],0),C.push(je[0],je[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,Lr()(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(t,n,i,s,l,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),t.push(i[0],i[1],i[2]|0,v,-l,i[2]|0),t.push(i[0],i[1],i[2]|0,v,l,i[2]|0)}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(i*i+s*s)}}]),e}();function ad(e){if(Ba()(e[0]))return e;if(Ba()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ba()(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(s){s.forEach(function(l){t+=l[0],n+=l[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function uP(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],s=0,l=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(r=Math.max(x,r),t=Math.max(C,t),n=Math.min(x,n),i=Math.min(C,i),s+=x,l+=C,v++)}return{center:[s/v,l/v],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function lP(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=ih.a.flatten(e),s=i.vertices,l=i.dimensions,v=[],g=[],x=0;x<s.length/l;x++)l===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=ih()(i.vertices,i.holes,i.dimensions);g.push.apply(g,Lr()(C));for(var T=function(H){var Q=i.vertices.slice(H*l,(H+1)*l),ie=i.vertices.slice((H+1)*l,(H+2)*l);ie.length===0&&(ie=i.vertices.slice(0,l));var be=v.length/3;v.push(Q[0],Q[1],1,ie[0],ie[1],1,Q[0],Q[1],0,ie[0],ie[1],0),g.push.apply(g,Lr()([0,2,1,2,3,1].map(function(je){return je+be})))},R=0;R<n;R++)T(R);return{positions:v,index:g}}function cP(e){var r=ih.a.flatten(e),t=ih()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function tb(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,s=ih.a.flatten(e),l=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<l.length/v;T++)v===2?g.push(l[T*2],l[T*2+1],1,-1,-1):g.push(l[T*3],l[T*3+1],1,-1,-1),C.push(0,0,1);var R=ih()(s.vertices,s.holes,s.dimensions);x.push.apply(x,Lr()(R));for(var F=function(ie){var be=s.vertices.slice(ie*v,(ie+1)*v),je=s.vertices.slice((ie+1)*v,(ie+2)*v);je.length===0&&(je=s.vertices.slice(0,v));var Je=g.length/5;g.push(be[0],be[1],1,0,0,je[0],je[1],1,.1,0,be[0],be[1],0,0,.8,je[0],je[1],0,.1,.8);var et=fP([je[0],je[1],1],[be[0],be[1],0],[be[0],be[1],1],r);C.push.apply(C,Lr()(et).concat(Lr()(et),Lr()(et),Lr()(et))),x.push.apply(x,Lr()([1,2,0,3,2,1].map(function(bt){return bt+Je})))},H=0;H<i;H++)F(H);return{positions:g,index:x,normals:C}}function fP(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=U.create(),s=U.create(),l=U.create();n&&(e=zi(e),r=zi(r),t=zi(t));var v=U.fromValues.apply(U,Lr()(e)),g=U.fromValues.apply(U,Lr()(r)),x=U.fromValues.apply(U,Lr()(t));U.sub(i,x,g),U.sub(s,v,g),U.cross(l,i,s);var C=U.create();return U.normalize(C,l),C}var Wc,od;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(od||(od={}));var sd;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(sd||(sd={}));function am(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var s=n.map(function(l){var v=Math.sin(l+Math.PI/4),g=Math.cos(l+Math.PI/4);return[v,g,0]});return s}function rb(){return am(30)}function nb(){return am(4)}function ib(){return am(3)}function ab(){return am(6,1)}function ob(){return am(5)}var rv=(Wc={},w()(Wc,sd.CIRCLE,rb),w()(Wc,sd.HEXAGON,ab),w()(Wc,sd.TRIANGLE,ib),w()(Wc,sd.SQUARE,nb),w()(Wc,sd.PENTAGON,ob),w()(Wc,od.CYLINDER,rb),w()(Wc,od.HEXAGONCOLUMN,ab),w()(Wc,od.TRIANGLECOLUMN,ib),w()(Wc,od.SQUARECOLUMN,nb),w()(Wc,od.PENTAGONCOLUMN,ob),Wc),t0={};function sb(e){var r=ad(e.coordinates);return{vertices:[].concat(Lr()(r),Lr()(r),Lr()(r),Lr()(r)),indices:[0,1,2,2,3,0],size:r.length}}function hP(e){var r=ad(e.coordinates),t=Qx(r);return{vertices:[].concat(Lr()(t),Lr()(t),Lr()(t),Lr()(t)),indices:[0,1,2,2,3,0],size:t.length}}function ub(e){var r=e.shape,t=yP(r,!1),n=t.positions,i=t.index,s=t.normals;return{vertices:n,indices:i,normals:s,size:5}}function lb(e){var r=ad(e.coordinates);return{vertices:Lr()(r),indices:[0],size:r.length}}function cb(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new eb({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=r;Array.isArray(s[0][0])||(s=[r]);var l=t;Array.isArray(l[0][0])||(l=[t]);for(var v=0;v<s.length;v++){var g=s[v],x=l[v];i.extrude_gaode2(g,x)}}else{var C=r;Array.isArray(C[0][0])||(C=[r]),C.forEach(function(R){i.extrude(R)})}var T=i.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function pP(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new eb({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=r;Array.isArray(s[0][0])||(s=[r]);var l=t;Array.isArray(l[0][0])||(l=[t]);for(var v=0;v<s.length;v++){var g=s[v],x=l[v];i.simpleExtrude_gaode2(g,x)}}else{var C=r;Array.isArray(C[0][0])||(C=[r]),C.forEach(function(R){i.simpleExtrude(R)})}var T=i.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function dP(e){var r=e.coordinates,t=ih.a.flatten(r),n=t.vertices,i=t.dimensions,s=t.holes;return{indices:ih()(n,s,i),vertices:n,size:i}}function vP(e){var r=e.coordinates,t=ih.a.flatten(r),n=t.vertices,i=t.dimensions,s=t.holes;return{indices:ih()(n,s,i),vertices:mP(n),size:i+4}}function mP(e){for(var r=[],t=uP(e),n=t.center,i=t.radius,s=0;s<e.length;s+=2){var l=e[s],v=e[s+1];r.push.apply(r,[l,v,0].concat(Lr()(n),[i]))}return r}function fb(e){var r=e.coordinates,t=tb(r,!0),n=t.positions,i=t.index,s=t.normals;return{vertices:n,indices:i,normals:s,size:5}}function hb(e){var r=e.shape,t=xP(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function pb(e){var r=e.coordinates,t=[].concat(Lr()(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],Lr()(r[1]),[0,1,0],Lr()(r[0]),[0,0,1],Lr()(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function r0(e,r){for(var t=r||30,n=e.coordinates,i=[],s=[],l=function(x){i.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==t-1&&s.push.apply(s,Lr()([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<t;v++)l(v);return{vertices:i,indices:s,size:7}}function gP(e){var r=e.coordinates;r.length===2&&r.push(0);var t=e.size,n=n0(-1,1),i=n0(1,1),s=n0(-1,-1),l=n0(1,-1),v=[].concat(Lr()(r),Lr()(n),Lr()(r),Lr()(s),Lr()(r),Lr()(l),Lr()(r),Lr()(i)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function yP(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t0&&t0[e])return t0[e];var t=rv[e]?rv[e]():rv.cylinder(),n=tb([t],r);return t0[e]=n,n}function P6(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),s,l,v,g=U.create(),x=U.create(),C=U.create(),T=0,R=r.length;T<R;T+=3){s=r[T+0]*3,l=r[T+1]*3,v=r[T+2]*3;var F=[e[s],e[s+1]],H=[e[l],e[l+1]],Q=[e[v],e[v+1]];n&&(F=zi(F),H=zi(H),Q=zi(Q));var ie=F,be=ft()(ie,2),je=be[0],Je=be[1],et=U.fromValues(je,Je,e[s+2]),bt=H,Et=ft()(bt,2),kt=Et[0],jt=Et[1],mr=U.fromValues(kt,jt,e[l+2]),Ar=Q,pr=ft()(Ar,2),pn=pr[0],Tn=pr[1],Jn=U.fromValues(pn,Tn,e[v+2]);U.sub(g,Jn,mr),U.sub(x,et,mr),U.cross(C,g,x),i[s]+=g[0],i[s+1]+=g[1],i[s+2]+=g[2],i[l]+=g[0],i[l+1]+=g[1],i[l+2]+=g[2],i[v]+=g[0],i[v+1]+=g[1],i[v+2]+=g[2]}return _P(i),i}function _P(e){for(var r=0,t=e.length;r<t;r+=3){var n=U.fromValues(e[r],e[r+1],e[r+2]),i=U.create();U.normalize(i,n),e.set(i,r)}}function O6(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function xP(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=rv[e]?rv[e]():rv.circle(),n=r.indexOf(e)===-1?cP([t]):lP([t]);return n}function n0(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function I6(){var e=Jx(Jm,{segments:Kx}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function R6(){var e=Jx(Jm+sP,{segments:Kx}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function bP(e){var r=EP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function EP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SP=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CP=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,wP=function(e){bn()(t,e);var r=bP(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"cityCenter",void 0),w()(ue()(n),"cityMinSize",void 0),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=i.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=i.windowColor,R=T===void 0?"rgb(30,60,89)":T,F=i.time,H=F===void 0?0:F,Q=i.sweep,ie=Q===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:Q;return{u_cityCenter:ie.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*ie.sweepRadius,u_circleSweep:ie.enable?1:0,u_circleSweepColor:Ka(ie.sweepColor).slice(0,3),u_circleSweepSpeed:ie.sweepSpeed,u_opacity:l,u_baseColor:Ka(g),u_brightColor:Ka(C),u_windowColor:Ka(R),u_time:this.layer.getLayerAnimateTime()||H}}},{key:"calCityGeo",value:function(){var i=ft()(this.layer.getSource().extent,4),s=i[0],l=i[1],v=i[2],g=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+l)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,l]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,R=g-l;this.cityCenter=[(v+s)/2,(g+l)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(R,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:CP,fragmentShader:SP,triangulation:fb})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),t}(ws);function AP(e){var r=TP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function TP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MP=function(e){bn()(t,e);var r=AP(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","PolygonLayer"),n}return yt()(t,[{key:"buildModels",value:function(){this.layerModel=new wP(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(id);function PP(e){var r=OP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function OP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IP=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,RP=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,kP=function(e){bn()(t,e);var r=PP(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.coverage,v=i.angle;return{u_opacity:s||1,u_coverage:l||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:IP,fragmentShader:RP,triangulation:hb,depth:{enable:!1},primitive:oe.TRIANGLES,blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),t}(ws);function LP(e){var r=DP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function DP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FP=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,BP=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,NP=function(e){bn()(t,e);var r=LP(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.coverage,v=i.angle;return{u_opacity:s||1,u_coverage:l||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:FP,fragmentShader:BP,triangulation:ub,depth:{enable:!0},blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),t}(ws);function zP(e,r){for(var t=[],n=[],i=[],s=e+1,l=r+1,v=e/2,g=r/2,x=0;x<l;x++)for(var C=x-g,T=0;T<s;T++){var R=T-v;n.push(R/v,-C/g,0),i.push(T/e),i.push(1-x/r)}for(var F=0;F<r;F++)for(var H=0;H<e;H++){var Q=H+s*F,ie=H+s*(F+1),be=H+1+s*(F+1),je=H+1+s*F;t.push(Q,ie,je),t.push(ie,be,je)}return{vertices:n,indices:t,uvs:i}}var db,vb;function mb(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function gb(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?mb(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):mb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function UP(e){var r=jP();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function jP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VP=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,GP=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,HP=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,WP=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,ZP=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,XP=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,yb=(db=Object(vr.injectable)(),db(vb=function(e){bn()(t,e);var r=UP(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"colorTexture",void 0),w()(ue()(n),"heatmapFramerBuffer",void 0),w()(ue()(n),"intensityModel",void 0),w()(ue()(n),"colorModel",void 0),w()(ue()(n),"shapeType",void 0),n}return yt()(t,[{key:"render",value:function(){var i=this,s=this.rendererService,l=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var i,s=this.rendererService,l=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),R=(T==null||(i=T.scale)===null||i===void 0?void 0:i.field)||"heatmap";this.shapeType=R,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=R==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=g(),H=F.width,Q=F.height;return this.heatmapFramerBuffer=l({color:x({width:Math.floor(H/4),height:Math.floor(Q/4),wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE,min:oe.LINEAR,mag:oe.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:yi.Attribute,descriptor:{name:"a_Dir",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:ZP,fragmentShader:WP,triangulation:gP,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:oe.ONE,srcAlpha:1,dstRGB:oe.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:XP,fs:HP});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,R=x.uniforms,F=this.rendererService,H=F.createAttribute,Q=F.createElements,ie=F.createBuffer,be=F.createModel;return be({vs:C,fs:T,attributes:{a_Position:H({buffer:ie({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:oe.FLOAT}),size:3}),a_Uv:H({buffer:ie({data:[0,1,1,1,0,0,1,0],type:oe.FLOAT}),size:2})},uniforms:gb({},R),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Q({data:[0,2,1,2,3,1],type:oe.UNSIGNED_INT,count:6}),stencil:rs(l,g)})}},{key:"drawIntensityMode",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.intensity,v=l===void 0?10:l,g=i.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=j.create();j.invert(l,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:Lr()(l)}})}},{key:"build3dHeatMap",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,R=C.height,F=zP(T/4,R/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:GP,fs:VP});var H=this.shaderModuleService.getModule("heatmap3dColor"),Q=H.vs,ie=H.fs,be=H.uniforms,je=this.rendererService,Je=je.createAttribute,et=je.createElements,bt=je.createBuffer,Et=je.createModel;return Et({vs:Q,fs:ie,attributes:{a_Position:Je({buffer:bt({data:F.vertices,type:oe.FLOAT}),size:3}),a_Uv:Je({buffer:bt({data:F.uvs,type:oe.FLOAT}),size:2})},primitive:oe.TRIANGLES,uniforms:gb({},be),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:oe.SRC_ALPHA,srcAlpha:1,dstRGB:oe.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:et({data:F.indices,type:oe.UNSIGNED_INT,count:F.indices.length}),stencil:rs(l,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),l=s.rampColors,v=Oc(l);this.colorTexture=i({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:oe.CLAMP_TO_EDGE,wrapT:oe.CLAMP_TO_EDGE,min:oe.NEAREST,mag:oe.NEAREST,flipY:!1})}}]),t}(ws))||vb);function YP(e){var r=$P();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function $P(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KP=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qP=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,QP=function(e){bn()(t,e);var r=YP(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.coverage,v=i.angle;return{u_opacity:s||1,u_coverage:l||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:qP,fragmentShader:KP,triangulation:hb,depth:{enable:!1},primitive:oe.TRIANGLES,blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:yi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),t}(ws),JP={heatmap:yb,heatmap3d:yb,grid:kP,grid3d:NP,hexagon:QP},eO=JP;function tO(e){var r=rO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function rO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nO=function(e){bn()(t,e);var r=tO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","HeatMapLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new eO[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var i=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var i,s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=this.getLayerConfig(),v=l.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(i=s.scale)===null||i===void 0?void 0:i.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),t}(id);function iO(e){var r=aO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function aO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oO=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,sO=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,uO=function(e){bn()(t,e);var r=iO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var i=this,s=this.layer.getLayerConfig(),l=s.mask,v=l===void 0?!1:l,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),_a){var R=this.layerService.sceneService.getSceneConfig().canvas,F=R.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){i.texture=T({data:F,width:F.width,height:F.height}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()}}else C.data.images.then(function(H){i.texture=T({data:H[0],width:H[0].width,height:H[0].height}),i.layerService.updateLayerRenderList(),i.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:sO,fragmentShader:oO,triangulation:pb,primitive:oe.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rs(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){return[v[3],v[4]]}}})}}]),t}(ws),lO={image:uO},cO=lO;function fO(e){var r=hO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function hO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pO=function(e){bn()(t,e);var r=fO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","ImageLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new cO[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),s={image:{}};return s[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(id);function dO(e){var r=vO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function vO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mO=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,gO=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,yO=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,_O=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,xO=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,bO=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,EO={solid:0,dash:1},SO=function(e){bn()(t,e);var r=dO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.NEAREST,min:oe.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.textureBlend,x=g===void 0?"normal":g,C=i.lineType,T=C===void 0?"solid":C,R=i.dashArray,F=R===void 0?[10,5]:R,H=i.forward,Q=H===void 0?!0:H,ie=i.lineTexture,be=ie===void 0?!1:ie,je=i.iconStep,Je=je===void 0?100:je,et=i.segmentNumber,bt=et===void 0?30:et,Et=i.thetaOffset,kt=Et===void 0?.314:Et;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:kt})){this.judgeStyleAttributes({opacity:s,thetaOffset:kt});var jt=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,jt,this.cellProperties),Ar=mr.data,pr=mr.width,pn=mr.height;this.rowCount=pn,this.dataTexture=this.cellLength>0&&Ar.length>0?this.createTexture2D({flipY:!0,data:Ar,format:oe.LUMINANCE,type:oe.FLOAT,width:pr,height:pn}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Tn=0,Jn=[0,0,0,0],va=[0,0,0,0];return l&&v&&(Jn=Ka(l),va=Ka(v),Tn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Ba()(kt)?kt:0,u_opacity:Ba()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:bt,u_line_type:EO[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Q?1:-1,u_texture:this.texture,u_line_texture:be?1:0,u_icon_step:Je,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Tn,u_sourceColor:Jn,u_targetColor:va}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),s=i.sourceColor,l=i.targetColor,v=i.lineType;return v==="dash"?{frag:mO,vert:gO,type:"dash"}:s&&l?{frag:xO,vert:bO,type:"linear"}:{frag:yO,vert:_O,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.segmentNumber,l=s===void 0?30:s,v=i.mask,g=v===void 0?!1:v,x=i.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,H=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+H,vertexShader:F,fragmentShader:R,triangulation:r0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:l,stencil:rs(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){var C=l.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:4,update:function(l,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.iconService.getIconMap(),T=l.texture,R=C[T]||{x:0,y:0},F=R.x,H=R.y;return[F,H]}}})}}]),t}(ws);function CO(e){var r=wO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function wO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,TO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,MO=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,PO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,OO={solid:0,dash:1},IO=function(e){bn()(t,e);var r=CO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.NEAREST,min:oe.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.textureBlend,x=g===void 0?"normal":g,C=i.lineType,T=C===void 0?"solid":C,R=i.dashArray,F=R===void 0?[10,5]:R,H=i.lineTexture,Q=H===void 0?!1:H,ie=i.iconStep,be=ie===void 0?100:ie,je=i.segmentNumber,Je=je===void 0?30:je,et=i.globalArcHeight,bt=et===void 0?10:et;F.length===2&&F.push(0,0);var Et=0,kt=[0,0,0,0],jt=[0,0,0,0];if(l&&v&&(kt=Ka(l),jt=Ka(v),Et=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var mr=this.layer.getEncodedData(),Ar=this.calDataFrame(this.cellLength,mr,this.cellProperties),pr=Ar.data,pn=Ar.width,Tn=Ar.height;this.rowCount=Tn,this.dataTexture=this.cellLength>0&&pr.length>0?this.createTexture2D({flipY:!0,data:pr,format:oe.LUMINANCE,type:oe.FLOAT,width:pn,height:Tn}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Jm,u_global_height:bt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Je,u_line_type:OO[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Et,u_sourceColor:kt,u_targetColor:jt}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),s=i.sourceColor,l=i.targetColor,v=i.lineType;return s&&l?{frag:MO,vert:PO,type:"linear"}:{frag:AO,vert:TO,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.segmentNumber,l=s===void 0?30:s,v=i.mask,g=v===void 0?!1:v,x=i.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,H=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+H,vertexShader:F,fragmentShader:R,triangulation:r0,blend:this.getBlend(),segmentNumber:l,stencil:rs(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){var C=l.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:4,update:function(l,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.iconService.getIconMap(),T=l.texture,R=C[T]||{x:0,y:0},F=R.x,H=R.y;return[F,H]}}})}}]),t}(ws);function RO(e){var r=kO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function kO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LO=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,DO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,FO=function(e){bn()(t,e);var r=RO(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.forward,x=g===void 0?!0:g,C=i.segmentNumber,T=C===void 0?30:C,R=i.thetaOffset,F=R===void 0?.314:R,H=0,Q=[0,0,0,0],ie=[0,0,0,0];return l&&v&&(Q=Ka(l),ie=Ka(v),H=1),{u_thetaOffset:F,u_opacity:Ba()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:H,u_sourceColor:Q,u_targetColor:ie}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.segmentNumber,l=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:DO,fragmentShader:LO,triangulation:r0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:l})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:4,update:function(s,l,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),t}(ws);function BO(e){var r=NO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function NO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,UO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,jO={solid:0,dash:1},VO=function(e){bn()(t,e);var r=BO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.NEAREST,min:oe.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.textureBlend,x=g===void 0?"normal":g,C=i.lineType,T=C===void 0?"solid":C,R=i.dashArray,F=R===void 0?[10,5]:R,H=i.lineTexture,Q=H===void 0?!1:H,ie=i.iconStep,be=ie===void 0?100:ie,je=i.segmentNumber,Je=je===void 0?30:je;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var et=0,bt=[0,0,0,0],Et=[0,0,0,0];if(l&&v&&(bt=Ka(l),Et=Ka(v),et=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var kt=this.layer.getEncodedData(),jt=this.calDataFrame(this.cellLength,kt,this.cellProperties),mr=jt.data,Ar=jt.width,pr=jt.height;this.rowCount=pr,this.dataTexture=this.cellLength>0&&mr.length>0?this.createTexture2D({flipY:!0,data:mr,format:oe.LUMINANCE,type:oe.FLOAT,width:Ar,height:pr}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Je,u_line_type:jO[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:et,u_sourceColor:bt,u_targetColor:Et}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:UO,fragmentShader:zO,triangulation:r0,depth:{enable:!1},blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){var C=l.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:yi.Attribute,descriptor:{name:"a_Instance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:4,update:function(l,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.iconService.getIconMap(),T=l.texture,R=C[T]||{x:0,y:0},F=R.x,H=R.y;return[F,H]}}})}}]),t}(ws);function GO(e){var r=HO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function HO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WO=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,XO=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,_b=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_Distance / a_Total_Distance;; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,YO=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,$O={solid:0,dash:1},xb=function(e){bn()(t,e);var r=GO(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.NEAREST,min:oe.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.textureBlend,x=g===void 0?"normal":g,C=i.lineType,T=C===void 0?"solid":C,R=i.dashArray,F=R===void 0?[10,5,0,0]:R,H=i.lineTexture,Q=H===void 0?!1:H,ie=i.iconStep,be=ie===void 0?100:ie,je=i.vertexHeightScale,Je=je===void 0?20:je,et=i.borderWidth,bt=et===void 0?0:et,Et=i.borderColor,kt=Et===void 0?"#ccc":Et;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var jt=0,mr=[0,0,0,0],Ar=[0,0,0,0];if(l&&v&&(mr=Ka(l),Ar=Ka(v),jt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var pr=this.layer.getEncodedData(),pn=this.calDataFrame(this.cellLength,pr,this.cellProperties),Tn=pn.data,Jn=pn.width,va=pn.height;this.rowCount=va,this.dataTexture=this.cellLength>0&&Tn.length>0?this.createTexture2D({flipY:!0,data:Tn,format:oe.LUMINANCE,type:oe.FLOAT,width:Jn,height:va}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:$O[T],u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:be,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:bt,u_borderColor:Ka(kt),u_linearColor:jt,u_sourceColor:mr,u_targetColor:Ar,u_vertexScale:Je}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"line"+R,vertexShader:T,fragmentShader:C,triangulation:cb,primitive:oe.TRIANGLES,blend:this.getBlend(),depth:{enable:!1},stencil:rs(l,g)})]}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),s=i.sourceColor,l=i.targetColor,v=i.lineType;return v==="dash"?{frag:WO,vert:ZO,type:"dash"}:s&&l?{frag:YO,vert:_b,type:"linear"}:{frag:XO,vert:_b,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:yi.Attribute,descriptor:{name:"a_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yi.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=l.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(l,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yi.Attribute,descriptor:{name:"a_Miter",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.iconService.getIconMap(),T=l.texture,R=C[T]||{x:0,y:0},F=R.x,H=R.y;return[F,H]}}})}}]),t}(ws);function KO(e){var r=qO();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function qO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QO=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,JO=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,bb=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,e5=function(e){bn()(t,e);var r=KO(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.vertexHeightScale,x=g===void 0?20:g,C=0,T=[0,0,0,0],R=[0,0,0,0];if(l&&v&&(T=Ka(l),R=Ka(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),H=this.calDataFrame(this.cellLength,F,this.cellProperties),Q=H.data,ie=H.width,be=H.height;this.rowCount=be,this.dataTexture=this.cellLength>0&&Q.length>0?this.createTexture2D({flipY:!0,data:Q,format:oe.LUMINANCE,type:oe.FLOAT,width:ie,height:be}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(s)?s:1,u_linearColor:C,u_sourceColor:T,u_targetColor:R,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),s=i.sourceColor,l=i.targetColor;return s&&l?{frag:QO,vert:bb,type:"linear"}:{frag:JO,vert:bb,type:"normal"}}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+R,vertexShader:T,fragmentShader:C,triangulation:pP,primitive:oe.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:yi.Attribute,descriptor:{name:"a_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yi.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yi.Attribute,descriptor:{name:"a_Miter",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){return[v[4]]}}})}}]),t}(ws);function t5(e){var r=r5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var n5=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,i5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,a5=function(e){bn()(t,e);var r=t5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.NEAREST,min:oe.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.sourceColor,v=i.targetColor,g=i.textureBlend,x=g===void 0?"normal":g,C=i.heightfixed,T=C===void 0?!1:C,R=i.lineTexture,F=R===void 0?!1:R,H=i.iconStep,Q=H===void 0?100:H,ie=i.iconStepCount,be=ie===void 0?1:ie;this.rendererService.getDirty()&&this.texture.bind();var je=0,Je=[0,0,0,0],et=[0,0,0,0];if(l&&v&&(Je=Ka(l),et=Ka(v),je=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var bt=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,bt,this.cellProperties),kt=Et.data,jt=Et.width,mr=Et.height;this.rowCount=mr,this.dataTexture=this.cellLength>0&&kt.length>0?this.createTexture2D({flipY:!0,data:kt,format:oe.LUMINANCE,type:oe.FLOAT,width:jt,height:mr}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:be,u_icon_step:Q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:je,u_sourceColor:Je,u_targetColor:et}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:i5,fragmentShader:n5,triangulation:cb,primitive:oe.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var i=this,s=this.layer.getLayerConfig(),l=s.lineType,v=l===void 0?"solid":l;this.styleAttributeService.registerStyleAttribute({name:"distance",type:yi.Attribute,descriptor:{name:"a_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(x,C,T,R){return[T[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:yi.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(x,C,T,R){return[T[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(x,C,T,R){var F=x.size,H=F===void 0?1:F;return Array.isArray(H)?[H[0],H[1]]:[H,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(x,C,T,R,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:yi.Attribute,descriptor:{name:"a_Miter",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(x,C,T,R){return[T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(x,C,T,R){var F=i.iconService.getIconMap(),H=x.texture,Q=F[H]||{x:0,y:0},ie=Q.x,be=Q.y;return[ie,be]}}})}}]),t}(ws),o5={arc:SO,arcmini:FO,arc3d:IO,greatcircle:VO,wall:a5,line:xb,simple:e5},s5=o5;function u5(e){var r=l5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function l5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c5=function(e){bn()(t,e);var r=u5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","LineLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new s5[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),s={line:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[i]}},{key:"getModelType",value:function(){var i,s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=s==null||(i=s.scale)===null||i===void 0?void 0:i.field;return l||"line"}}]),t}(id);function f5(e){var r=h5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p5=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,d5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    offset = project_pixel(offset);
  }

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Eb=function(e){bn()(t,e);var r=f5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"raiseCount",0),w()(ue()(n),"raiserepeat",0),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption,l=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=i.opacity,g=v===void 0?1:v,x=i.sourceColor,C=i.targetColor,T=i.pickLight,R=T===void 0?!1:T,F=i.heightfixed,H=F===void 0?!1:F,Q=i.opacityLinear,ie=Q===void 0?{enable:!1,dir:"up"}:Q,be=i.lightEnable,je=be===void 0?!0:be;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var Je=this.layer.getEncodedData(),et=this.calDataFrame(this.cellLength,Je,this.cellProperties),bt=et.data,Et=et.width,kt=et.height;this.rowCount=kt,this.dataTexture=this.cellLength>0&&bt.length>0?this.createTexture2D({flipY:!0,data:bt,format:oe.LUMINANCE,type:oe.FLOAT,width:Et,height:kt}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}var jt=0,mr=[0,0,0,0],Ar=[0,0,0,0];if(x&&C&&(mr=Ka(x),Ar=Ka(C),jt=1),this.raiseCount<1&&this.raiserepeat>0&&l.enable){var pr=l.speed,pn=pr===void 0?.01:pr,Tn=l.repeat,Jn=Tn===void 0?!1:Tn;this.raiseCount+=pn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(R),u_heightfixed:Number(H),u_r:l.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(g)?g:1,u_linearColor:jt,u_sourceColor:mr,u_targetColor:Ar,u_opacitylinear:Number(ie.enable),u_opacitylinear_dir:ie.dir==="up"?1:0,u_lightEnable:Number(je)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.depth,l=s===void 0?!0:s,v=i.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:d5,fragmentShader:p5,triangulation:ub,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?oe.FRONT:oe.BACK},depth:{enable:l}})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(l,v,g,x){var C=l.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(l,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:yi.Attribute,descriptor:{name:"a_Pos",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(l,v){var g=ad(l.coordinates);return i?Qx([g[0],g[1]]):[g[0],g[1],0]}}})}}]),t}(ws),ah;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(ah||(ah={}));function v5(e){var r=m5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function m5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sb=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  float r = v_radius / (v_radius + strokeWidth);

  // 'circle'
  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);
 
  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float PI = 3.14159;
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);

  // TODO: \u6839\u636E\u53E0\u52A0\u6C34\u6CE2\u6548\u679C
  gl_FragColor = vec4(v_color.xyz, v_color.a * opacity * intensity);

  // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6
  if(d < 0.5) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,g5=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Ig=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Cb=function(e){bn()(t,e);var r=v5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"meter2coord",1),w()(ue()(n),"isMeter",!1),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.strokeOpacity,g=v===void 0?1:v,x=i.strokeWidth,C=x===void 0?0:x,T=i.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=i.offsets,H=F===void 0?[0,0]:F,Q=i.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:H})){this.judgeStyleAttributes({opacity:l,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:H});var ie=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,ie,this.cellProperties),je=be.data,Je=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:oe.LUMINANCE,type:oe.FLOAT,width:Je,height:et}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:Q==="additive"?1:0,u_globel:this.mapService.version===ah.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1,u_stroke_opacity:Ba()(g)?g:1,u_stroke_width:Ba()(C)?C:0,u_stroke_color:this.getStrokeColor(R),u_offsets:this.isOffsetStatic(H)?H:[0,0]}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),s=i.animateOption,l=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(l),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),sb)}},{key:"initModels",value:function(){var i=this.layer.getLayerConfig(),s=i.unit,l=s===void 0?"l7size":s,v=this.mapService.version;return l==="meter"&&v!==ah.L7MAP&&v!==ah.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var i=ft()(this.layer.getSource().extent,4),s=i[0],l=i[1],v=i[2],g=i[3],x=[(s+v)/2,(l+g)/2],C=this.mapService.version;if(C===ah.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),H=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),Q=H.toLngLat();this.meter2coord=x[0]-Q.lng;return}var ie=this.mapService.meterToCoord(x,[s,l]),be=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===l?l+.1:g]);this.meter2coord=(ie+be)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v,x=i.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),R=T.frag,F=T.vert,H=T.type,Q=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill-"+H,vertexShader:F,fragmentShader:R,triangulation:Q?hP:sb,depth:{enable:Q},blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:Sb,vert:Ig,type:"wave"};default:return{frag:Sb,vert:Ig,type:"wave"}}else return{frag:g5,vert:Ig,type:"normal"}}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:yi.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var R=ft()(x,3),F=R[0],H=R[1],Q=R[2],ie=U.fromValues(0,0,1),be=U.fromValues(F,0,Q),je=F>=0?U.angle(ie,be):Math.PI*2-U.angle(ie,be),Je=Math.PI*2-Math.asin(H/100),et=j.create();j.rotateY(et,et,je),j.rotateX(et,et,Je);var bt=U.fromValues(1,1,0);U.transformMat4(bt,bt,et),U.normalize(bt,bt);var Et=U.fromValues(-1,1,0);U.transformMat4(Et,Et,et),U.normalize(Et,Et);var kt=U.fromValues(-1,-1,0);U.transformMat4(kt,kt,et),U.normalize(kt,kt);var jt=U.fromValues(1,-1,0);U.transformMat4(jt,jt,et),U.normalize(jt,jt),T=[].concat(Lr()(bt),Lr()(Et),Lr()(kt),Lr()(jt))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var mr=C%4*3;return[T[mr],T[mr+1],T[mr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,R=T===void 0?5:T;return Array.isArray(R)?[R[0]*i.meter2coord]:[R*i.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:yi.Attribute,descriptor:{name:"a_Shape",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,R=T===void 0?2:T,F=i.layer.getLayerConfig().shape2d,H=F.indexOf(R);return[H]}}})}}]),t}(ws);function y5(e){var r=_5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function _5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,b5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,E5=function(e){bn()(t,e);var r=y5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var i=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){i.updateTexture(),i.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:b5,fragmentShader:x5,triangulation:lb,primitive:oe.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){var C=l.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.fontService.mapping,T=l.shape,R=i.fontService.getGlyph(T),F=C[R],H=F.x,Q=F.y;return[H,Q]}}})}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=i({data:s,mag:oe.LINEAR,min:oe.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var i=this,s=this.layer.getLayerConfig(),l=s.fontWeight,v=l===void 0?"normal":l,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(R){var F=R.shape,H=F===void 0?"":F;H=H.toString();var Q=i.fontService.getGlyph(H);T.indexOf(Q)===-1&&T.push(Q)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),t}(ws);function S5(e){var r=C5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function C5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w5=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,A5=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,wb=function(e){bn()(t,e);var r=S5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:oe.LINEAR,min:oe.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=i.offsets,v=l===void 0?[0,0]:l;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,T=x.width,R=x.height;this.rowCount=R,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:oe.LUMINANCE,type:oe.FLOAT,width:T,height:R}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Ba()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var i,s;(i=this.texture)===null||i===void 0||i.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:A5,fragmentShader:w5,triangulation:lb,primitive:oe.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(l,v,g,x){var C=l.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(l,v,g,x){var C=i.iconService.getIconMap(),T=l.shape,R=C[T]||{x:0,y:0},F=R.x,H=R.y;return[F,H]}}})}}]),t}(ws);function T5(e){var r=M5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function M5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,O5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function I5(e){var r=e.coordinates;return{vertices:Lr()(r),indices:[0],size:r.length}}var Ab=function(e){bn()(t,e);var r=T5(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:g})){this.judgeStyleAttributes({opacity:l,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:oe.LUMINANCE,type:oe.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:O5,fragmentShader:P5,triangulation:I5,depth:{enable:!1},primitive:oe.POINTS,blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Gc.additive}}}]),t}(ws);function R5(e){var r=k5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function k5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L5=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,D5=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function F5(e){var r=e.coordinates;return{vertices:Lr()(r),indices:[0],size:r.length}}var B5=function(e){bn()(t,e);var r=R5(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.offsets,g=v===void 0?[0,0]:v,x=i.blend,C=i.strokeOpacity,T=C===void 0?1:C,R=i.strokeWidth,F=R===void 0?0:R,H=i.stroke,Q=H===void 0?"#fff":H;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,offsets:g})){this.judgeStyleAttributes({opacity:l,offsets:g});var ie=this.layer.getEncodedData(),be=this.calDataFrame(this.cellLength,ie,this.cellProperties),je=be.data,Je=be.width,et=be.height;this.rowCount=et,this.dataTexture=this.cellLength>0&&je.length>0?this.createTexture2D({flipY:!0,data:je,format:oe.LUMINANCE,type:oe.FLOAT,width:Je,height:et}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:Ba()(T)?T:1,u_stroke_width:Ba()(F)?F:0,u_stroke_color:this.getStrokeColor(Q)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:D5,fragmentShader:L5,triangulation:F5,depth:{enable:!1},primitive:oe.POINTS,blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Gc.additive}}}]),t}(ws);function N5(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=z5(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function z5(e,r){if(!!e){if(typeof e=="string")return Tb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Tb(e,r)}}function Tb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var U5=function(){function e(r,t,n){dt()(this,e),w()(this,"boxCells",[]),w()(this,"xCellCount",void 0),w()(this,"yCellCount",void 0),w()(this,"boxKeys",void 0),w()(this,"bboxes",void 0),w()(this,"width",void 0),w()(this,"height",void 0),w()(this,"xScale",void 0),w()(this,"yScale",void 0),w()(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return yt()(e,[{key:"insert",value:function(t,n,i,s,l){this.forEachCell(n,i,s,l,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(l)}},{key:"query",value:function(t,n,i,s,l){return this.queryHitTest(t,n,i,s,!1,l)}},{key:"hitTest",value:function(t,n,i,s,l){return this.queryHitTest(t,n,i,s,!0,l)}},{key:"insertBoxCell",value:function(t,n,i,s,l,v){this.boxCells[l].push(v)}},{key:"queryHitTest",value:function(t,n,i,s,l,v){if(i<0||t>this.width||s<0||n>this.height)return l?!1:[];var g=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=s){if(l)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:l,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,s,this.queryCell,g,C,v),l?g.length>0:g}},{key:"queryCell",value:function(t,n,i,s,l,v,g,x){var C=g.seenUids,T=this.boxCells[l];if(T!==null){var R=this.bboxes,F=N5(T),H;try{for(F.s();!(H=F.n()).done;){var Q=H.value;if(!C.box[Q]){C.box[Q]=!0;var ie=Q*4;if(t<=R[ie+2]&&n<=R[ie+3]&&i>=R[ie+0]&&s>=R[ie+1]&&(!x||x(this.boxKeys[Q]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[Q],x1:R[ie],y1:R[ie+1],x2:R[ie+2],y2:R[ie+3]})}}}}catch(be){F.e(be)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,s,l,v,g,x){for(var C=this.convertToXCellCoord(t),T=this.convertToYCellCoord(n),R=this.convertToXCellCoord(i),F=this.convertToYCellCoord(s),H=C;H<=R;H++)for(var Q=T;Q<=F;Q++){var ie=this.xCellCount*Q+H;if(l.call(this,t,n,i,s,ie,v,g,x))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),j5=U5,V5=function(){function e(r,t){dt()(this,e),w()(this,"width",void 0),w()(this,"height",void 0),w()(this,"grid",void 0),w()(this,"viewportPadding",100),w()(this,"screenRightBoundary",void 0),w()(this,"screenBottomBoundary",void 0),w()(this,"gridRightBoundary",void 0),w()(this,"gridBottomBoundary",void 0),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new j5(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return yt()(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,s=t.x2+t.anchorPointX+this.viewportPadding,l=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,s,l)||this.grid.hitTest(n,i,s,l)?{box:[]}:{box:[n,i,s,l]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var s=G.fromValues(n,i,0,1),l=G.create(),v=j.fromValues.apply(j,Lr()(t));return G.transformMat4(l,s,v),{x:(l[0]/l[3]+1)/2*this.width+this.viewportPadding,y:(-l[1]/l[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,s){return i>=0&&t<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Mb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=G5(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function G5(e,r){if(!!e){if(typeof e=="string")return Pb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Pb(e,r)}}function Pb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ob(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function Ib(e,r,t,n,i){if(!!i){var s=e[n],l=s.glyph;if(l)for(var v=r[l].advance*s.scale,g=(e[n].x+v)*i,x=t;x<=n;x++)e[x].x-=g}}function Rb(e,r,t,n,i,s,l){var v=(r-t)*i,g=(-n*l+.5)*s,x=Mb(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(R){x.e(R)}finally{x.f()}}function H5(e,r,t,n,i,s,l){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;t.forEach(function(je){if(je.split("").forEach(function(et){var bt=r[et],Et=0;bt&&(T.push({glyph:et,x:g,y:x+Et,vertical:!1,scale:1,metrics:bt}),g+=bt.advance+l)}),T.length!==F){var Je=g-l;C=Math.max(Je,C),Ib(T,r,F,T.length-1,R)}g=0,x-=n+5});var H=Ob(i),Q=H.horizontalAlign,ie=H.verticalAlign;Rb(T,R,Q,ie,C,n,t.length);var be=x-v;e.top+=-ie*be,e.bottom=e.top-be,e.left+=-Q*C,e.right=e.left+C}function W5(e,r,t,n,i,s,l){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;t.forEach(function(je){var Je=r[je],et=0;if(Je&&(T.push({glyph:je,x:g,y:x+et,vertical:!1,scale:1,metrics:Je}),g+=Je.advance+l),T.length!==F){var bt=g-l;C=Math.max(bt,C),Ib(T,r,F,T.length-1,R)}g=0,x-=n+5});var H=Ob(i),Q=H.horizontalAlign,ie=H.verticalAlign;Rb(T,R,Q,ie,C,n,t.length);var be=x-v;e.top+=-ie*be,e.bottom=e.top-be,e.left+=-Q*C,e.right=e.left+C}function Z5(e,r,t,n,i,s){var l=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:l[1],bottom:l[1],left:l[0],right:l[0],lineCount:g.length,text:e};return v?W5(C,r,g,t,n,i,s):H5(C,r,g,t,n,i,s),x.length?C:!1}function X5(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,s=[],l=Mb(i),v;try{for(l.s();!(v=l.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,R=t?[g.x+T,g.y]:[0,0],F=t?[0,0]:[g.x+T+r[0],g.y+r[1]],H=(0-C)*g.scale-T+F[0],Q=(0-C)*g.scale+F[1],ie=H+x.width*g.scale,be=Q+x.height*g.scale,je={x:H,y:Q},Je={x:ie,y:Q},et={x:H,y:be},bt={x:ie,y:be};s.push({tl:je,tr:Je,bl:et,br:bt,tex:x,glyphOffset:R})}}catch(Et){l.e(Et)}finally{l.f()}return s}function Y5(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$5(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function $5(e,r){if(!!e){if(typeof e=="string")return kb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return kb(e,r)}}function kb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function K5(e){var r=q5();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function q5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Db=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Fb(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var s=r.glyphInfoMap[t].centroid,l=s.length===2?[s[0],s[1],0]:s;return r.glyphInfoMap[t].glyphQuads.forEach(function(v,g){n.push.apply(n,Lr()(l).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],Lr()(l),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],Lr()(l),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],Lr()(l),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),i.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:i,size:7}}var Bb=function(e){bn()(t,e);var r=K5(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"glyphInfo",void 0),w()(ue()(n),"glyphInfoMap",{}),w()(ue()(n),"texture",void 0),w()(ue()(n),"currentZoom",-1),w()(ue()(n),"extent",void 0),w()(ue()(n),"textureHeight",0),w()(ue()(n),"textCount",0),w()(ue()(n),"preTextStyle",{}),w()(ue()(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Db,fragmentShader:Lb,triangulation:Fb.bind(ue()(n)),depth:{enable:!1},blend:n.getBlend(),stencil:rs(x,T)})]}),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.stroke,g=v===void 0?"#fff":v,x=i.strokeWidth,C=x===void 0?0:x,T=i.textAnchor,R=T===void 0?"center":T,F=i.textAllowOverlap,H=F===void 0?!1:F,Q=i.halo,ie=Q===void 0?.5:Q,be=i.gamma,je=be===void 0?2:be,Je=this.fontService,et=Je.canvas,bt=Je.mapping;if(Object.keys(bt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(bt).length),this.preTextStyle={textAnchor:R,textAllowOverlap:H},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:l,strokeWidth:C,stroke:g});var Et=this.layer.getEncodedData(),kt=this.calDataFrame(this.cellLength,Et,this.cellProperties),jt=kt.data,mr=kt.width,Ar=kt.height;this.rowCount=Ar,this.dataTexture=this.cellLength>0&&jt.length>0?this.createTexture2D({flipY:!0,data:jt,format:oe.LUMINANCE,type:oe.FLOAT,width:mr,height:Ar}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1,u_stroke_width:Ba()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:ie,u_gamma_scale:je,u_sdf_map_size:[et.width,et.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var i=this.layer.getLayerConfig(),s=i.textAnchor,l=s===void 0?"center":s,v=i.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:l,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var i=this.layer.getLayerConfig(),s=i.textAllowOverlap,l=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=co(this.extent,g);return!l&&(Math.abs(this.currentZoom-v)>1||!x)||l!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:yi.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:yi.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:yi.Attribute,descriptor:{name:"a_tex",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return yo(i,.5)}},{key:"initTextFont",value:function(){var i=this.layer.getLayerConfig(),s=i.fontWeight,l=s===void 0?"400":s,v=i.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F=F.toString();var H=Y5(F),Q;try{for(H.s();!(Q=H.n()).done;){var ie=Q.value;C.indexOf(ie)===-1&&C.push(ie)}}catch(be){H.e(be)}finally{H.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:l,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.layer.getLayerConfig(),s=i.fontWeight,l=s===void 0?"400":s,v=i.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:l,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(i){var s=this,l=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,R=this.layer.getEncodedData();this.glyphInfo=R.map(function(F){var H=F.shape,Q=H===void 0?"":H,ie=F.id,be=F.size,je=be===void 0?1:be,Je=F.textOffset,et=Je===void 0?[0,0]:Je,bt=Z5(Q.toString(),l,je,T,"left",x,et,i),Et=X5(bt,et,!1);return F.shaping=bt,F.glyphQuads=Et,F.centroid=ad(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?ad(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[ie]={shaping:bt,glyphQuads:Et,centroid:ad(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var i=this,s=this.layer.getLayerConfig(),l=s.padding,v=l===void 0?[4,4]:l,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,R=C.height,F=new V5(T,R),H=this.glyphInfo.filter(function(Q){var ie=Q.shaping,be=Q.id,je=be===void 0?0:be,Je=Q.version==="GAODE2.x"?Q.originCentroid:Q.centroid,et=Q.size,bt=et/24,Et=i.mapService.lngLatToContainer(Je),kt=F.placeCollisionBox({x1:ie.left*bt-v[0],x2:ie.right*bt+v[0],y1:ie.top*bt-v[1],y2:ie.bottom*bt+v[1],anchorPointX:Et.x,anchorPointY:Et.y}),jt=kt.box;return jt&&jt.length?(F.insertCollisionBox(jt,je),!0):!1});H.forEach(function(Q){i.glyphInfoMap[Q.id]=Q})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),s=i.iconfont,l=s===void 0?!1:s;l?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(l)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=i({data:s,mag:oe.LINEAR,min:oe.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Db,fragmentShader:Lb,triangulation:Fb.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:rs(l,g)})]}}]),t}(ws),Q5={fill:Cb,image:wb,normal:Ab,simplePoint:B5,extrude:Eb,text:Bb,icon:E5},J5=Q5;function eI(e){var r=tI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function tI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rI=function(e){bn()(t,e);var r=eI(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","PointLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new J5[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),s={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),s=this.getLayerConfig(),l=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=i.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"normal":C==="simple"?"simplePoint":(l==null?void 0:l.indexOf(C))!==-1?"fill":(v==null?void 0:v.indexOf(C))!==-1?"extrude":g.hasOwnProperty(C)?"image":this.fontService.getGlyph(C)!==""?"icon":"text"}else return"normal"}}]),t}(id);function nI(e){var r=iI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function iI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aI=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,oI=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,sI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,uI=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      project_pos.z *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,lI=function(e){bn()(t,e);var r=nI(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.heightfixed,g=v===void 0?!1:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:oe.LUMINANCE,type:oe.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.pickLight,l=s===void 0?!1:s,v=i.mask,g=v===void 0?!1:v,x=i.maskInside,C=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:l?sI:uI,fragmentShader:l?oI:aI,triangulation:fb,stencil:rs(g,C)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:yi.Attribute,descriptor:{name:"a_Normal",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(s,l,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:yi.Attribute,descriptor:{name:"a_Size",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(s,l,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}})}}]),t}(ws);function cI(e){var r=fI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function fI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hI=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pI=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dI=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,vI=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,mI=function(e){bn()(t,e);var r=cI(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.opacityLinear,g=v===void 0?{enable:!1,dir:"in"}:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:l})){this.judgeStyleAttributes({opacity:l});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:oe.LUMINANCE,type:oe.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:oe.LUMINANCE,type:oe.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ba()(l)?l:1,u_opacitylinear:Number(g.enable),u_dir:g.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var i=this.layer.getLayerConfig(),s=i.opacityLinear,l=s===void 0?{enable:!1,dir:"in"}:s,v=i.mask,g=v===void 0?!1:v,x=i.maskInside,C=x===void 0?!0:x;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:l.enable?dI:vI,fragmentShader:l.enable?pI:hI,triangulation:l.enable?vP:dP,blend:this.getBlend(),depth:{enable:!1},stencil:rs(g,C)})]}},{key:"clearModels",value:function(){var i;(i=this.dataTexture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),s=i.opacityLinear,l=s===void 0?{enable:!1,dir:"in"}:s;l.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:yi.Attribute,descriptor:{name:"a_linear",buffer:{usage:oe.STATIC_DRAW,data:[],type:oe.FLOAT},size:3,update:function(g,x,C,T,R){return[C[3],C[4],C[5]]}}})}}]),t}(ws),gI={fill:mI,line:xb,extrude:lI,text:Bb,point_fill:Cb,point_image:wb,point_normal:Ab,point_extrude:Eb},yI=gI;function _I(e){var r=xI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function xI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nb=function(e){bn()(t,e);var r=_I(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","PolygonLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new yI[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var i,s=this.styleAttributeService.getLayerStyleAttribute("shape"),l=s==null||(i=s.scale)===null||i===void 0?void 0:i.field;return l==="fill"?"fill":l==="extrude"?"extrude":l==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),s=this.getLayerConfig(),l=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=i.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(l==null?void 0:l.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),t}(id);function bI(e){var r=EI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function EI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SI=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,CI=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,zb=function(e){bn()(t,e);var r=bI(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"texture",void 0),w()(ue()(n),"colorTexture",void 0),n}return yt()(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),s=i.opacity,l=s===void 0?1:s,v=i.clampLow,g=v===void 0?!0:v,x=i.clampHigh,C=x===void 0?!0:x,T=i.noDataValue,R=T===void 0?-9999999:T,F=i.domain,H=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:l||1,u_texture:this.texture,u_domain:H,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:R,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var i=this.layer.getLayerConfig(),s=i.mask,l=s===void 0?!1:s,v=i.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:oe.LUMINANCE,type:oe.FLOAT});var R=this.layer.getLayerConfig(),F=R.rampColors,H=Oc(F);return this.colorTexture=C({data:H.data,width:H.width,height:H.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:CI,fragmentShader:SI,triangulation:pb,primitive:oe.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rs(l,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:yi.Attribute,descriptor:{name:"a_Uv",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:2,update:function(s,l,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var i=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),l=s.rampColors,v=Oc(l);this.colorTexture=i({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),t}(ws),wI={raster:zb,raster3d:zb},AI=wI;function TI(e){var r=MI();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function MI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PI=function(e){bn()(t,e);var r=TI(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","RasterLayer"),n}return yt()(t,[{key:"buildModels",value:function(){var i=this.getModelType();this.layerModel=new AI[i](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),s={raster:{},raster3d:{}};return s[i]}},{key:"getModelType",value:function(){return"raster"}}]),t}(id),Ub,jb,Vb,Gb,Hb,om,Wb,Zb,Xb;function Yb(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function OI(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Yb(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Yb(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var II=(Ub=Object(vr.injectable)(),jb=Object(vr.inject)(Yt.IGlobalConfigService),Vb=Object(vr.inject)(Yt.IMapService),Gb=Object(vr.inject)(Yt.IFontService),Ub(Hb=(om=function(){function e(){dt()(this,e),Pi()(this,"configService",Wb,this),Pi()(this,"mapService",Zb,this),Pi()(this,"fontService",Xb,this)}return yt()(e,[{key:"apply",value:function(t,n){var i=this,s=n.styleAttributeService;t.hooks.init.tap("DataMappingPlugin",function(){i.generateMaping(t,{styleAttributeService:s})}),t.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return t.dataState.dataMappingNeedUpdate=!1,i.generateMaping(t,{styleAttributeService:s}),!0}),t.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!t.layerModelNeedUpdate){var l=t.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=t.getSource().data.dataArray,C=v.filter(function(R){return R.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(R){return i.applyAttributeMapping(g,R,l)[0]})),C.length&&(g!=null&&g.needRemapping?(t.setEncodedData(i.mapping(v,T,void 0,l)),g.needRemapping=!1):t.setEncodedData(i.mapping(C,T,t.getEncodedData(),l)),t.emit("remapping",null))}})}},{key:"generateMaping",value:function(t,n){var i=this,s=n.styleAttributeService,l=t.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=t.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return i.applyAttributeMapping(g,T,l)[0]})),t.setEncodedData(this.mapping(v,C,void 0,l))}},{key:"mapping",value:function(t,n,i,s){var l=this,v=n.map(function(g,x){var C=i?i[x]:{},T=OI({id:g._id,coordinates:g.coordinates},C);return t.filter(function(R){return R.scale!==void 0}).forEach(function(R){var F=l.applyAttributeMapping(R,g,s);R.needRemapping=!1,R.name==="color"&&(F=F.map(function(H){return Ka(H)})),T[R.name]=Array.isArray(F)&&F.length===1?F[0]:F,R.name==="shape"&&(T.shape=l.fontService.getIconFontKey(T[R.name]))}),T});return v.length>0&&this.mapService.version==="GAODE2.x"&&(typeof v[0].coordinates[0]=="number"?v.filter(function(g){return!g.originCoordinates}).map(function(g){g.version="GAODE2.x",g.originCoordinates=Yl()(g.coordinates),g.coordinates=l.mapService.lngLatToCoord(g.coordinates)}):v.filter(function(g){return!g.originCoordinates}).map(function(g){g.version="GAODE2.x",g.originCoordinates=Yl()(g.coordinates),g.coordinates=l.mapService.lngLatToCoords(g.coordinates)})),v}},{key:"applyAttributeMapping",value:function(t,n,i){var s;if(!t.scale)return[];var l=(t==null||(s=t.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];l.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=t.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=t.mapping?t.mapping(v):[];return t.name==="color"&&!dh(g[0])?[i]:g}}]),e}(),Wb=Mi()(om.prototype,"configService",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zb=Mi()(om.prototype,"mapService",[Vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xb=Mi()(om.prototype,"fontService",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om))||Hb),$b,Kb,RI=($b=Object(vr.injectable)(),$b(Kb=function(){function e(){dt()(this,e),w()(this,"mapService",void 0)}return yt()(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Yt.IMapService),t.hooks.init.tap("DataSourcePlugin",function(){var i=t.getSource();if(!i){var s=t.sourceOption||{data:_h,options:kp},l=s.data,v=s.options;t.setSource(new Lp(l,v))}n.updateClusterData(t)}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var i=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,i||s})}},{key:"updateClusterData",value:function(t){var n=t.getSource(),i=n.cluster,s=n.clusterOptions,l=s.zoom,v=l===void 0?0:l,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=t.dataState.dataSourceNeedUpdate;return i&&(T||Math.abs(t.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),t.clusterZoom=C,!0):!1}}]),e}())||Kb),sm=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},kI=function(e){return e.length===1&&(e=LI(e)),{left:function(t,n,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var l=i+s>>>1;e(t[l],n)<0?i=l+1:s=l}return i},right:function(t,n,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var l=i+s>>>1;e(t[l],n)>0?s=l:i=l+1}return i}}};function LI(e){return function(r,t){return sm(e(r),t)}}var qb=kI(sm),DI=qb.right,k6=qb.left,FI=DI,L6=function(e,r){r==null&&(r=Qb);for(var t=0,n=e.length-1,i=e[0],s=new Array(n<0?0:n);t<n;)s[t]=r(i,i=e[++t]);return s};function Qb(e,r){return[e,r]}var D6=function(e,r,t){var n=e.length,i=r.length,s=new Array(n*i),l,v,g,x;for(t==null&&(t=Qb),l=g=0;l<n;++l)for(x=e[l],v=0;v<i;++v,++g)s[g]=t(x,r[v]);return s},F6=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},pp=function(e){return e===null?NaN:+e},BI=function(e,r){var t=e.length,n=0,i=-1,s=0,l,v,g=0;if(r==null)for(;++i<t;)isNaN(l=pp(e[i]))||(v=l-s,s+=v/++n,g+=v*(l-s));else for(;++i<t;)isNaN(l=pp(r(e[i],i,e)))||(v=l-s,s+=v/++n,g+=v*(l-s));if(n>1)return g/(n-1)},NI=function(e,r){var t=BI(e,r);return t&&Math.sqrt(t)},Jb=function(e,r){var t=e.length,n=-1,i,s,l;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=l=i;++n<t;)(i=e[n])!=null&&(s>i&&(s=i),l<i&&(l=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=l=i;++n<t;)(i=r(e[n],n,e))!=null&&(s>i&&(s=i),l<i&&(l=i));return[s,l]},eE=Array.prototype,zI=eE.slice,UI=eE.map,i0=function(e){return function(){return e}},jI=function(e){return e},VI=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,s=new Array(i);++n<i;)s[n]=e+n*t;return s},Rg=Math.sqrt(50),kg=Math.sqrt(10),Lg=Math.sqrt(2),B6=function(e,r,t){var n,i=-1,s,l,v;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(s=e,e=r,r=s),(v=GI(e,r,t))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),r=Math.floor(r/v),l=new Array(s=Math.ceil(r-e+1));++i<s;)l[i]=(e+i)*v;else for(e=Math.floor(e*v),r=Math.ceil(r*v),l=new Array(s=Math.ceil(e-r+1));++i<s;)l[i]=(e-i)/v;return n&&l.reverse(),l};function GI(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,i);return i>=0?(s>=Rg?10:s>=kg?5:s>=Lg?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=Rg?10:s>=kg?5:s>=Lg?2:1)}function HI(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/i;return s>=Rg?i*=10:s>=kg?i*=5:s>=Lg&&(i*=2),r<e?-i:i}var WI=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},N6=function(){var e=jI,r=Jb,t=WI;function n(i){var s,l=i.length,v,g=new Array(l);for(s=0;s<l;++s)g[s]=e(i[s],s,i);var x=r(g),C=x[0],T=x[1],R=t(g,C,T);Array.isArray(R)||(R=HI(C,T,R),R=VI(Math.ceil(C/R)*R,T,R));for(var F=R.length;R[0]<=C;)R.shift(),--F;for(;R[F-1]>T;)R.pop(),--F;var H=new Array(F+1),Q;for(s=0;s<=F;++s)Q=H[s]=[],Q.x0=s>0?R[s-1]:C,Q.x1=s<F?R[s]:T;for(s=0;s<l;++s)v=g[s],C<=v&&v<=T&&H[FI(R,v,0,F)].push(i[s]);return H}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:i0(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:i0([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?i0(zI.call(i)):i0(i),n):t},n},Dg=function(e,r,t){if(t==null&&(t=pp),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,s=Math.floor(i),l=+t(e[s],s,e),v=+t(e[s+1],s+1,e);return l+(v-l)*(i-s)}},z6=function(e,r,t){return e=UI.call(e,pp).sort(sm),Math.ceil((t-r)/(2*(Dg(e,.75)-Dg(e,.25))*Math.pow(e.length,-1/3)))},U6=function(e,r,t){return Math.ceil((t-r)/(3.5*NI(e)*Math.pow(e.length,-1/3)))},j6=function(e,r){var t=e.length,n=-1,i,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=i;++n<t;)(i=e[n])!=null&&i>s&&(s=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=i;++n<t;)(i=r(e[n],n,e))!=null&&i>s&&(s=i);return s},V6=function(e,r){var t=e.length,n=t,i=-1,s,l=0;if(r==null)for(;++i<t;)isNaN(s=pp(e[i]))?--n:l+=s;else for(;++i<t;)isNaN(s=pp(r(e[i],i,e)))?--n:l+=s;if(n)return l/n},G6=function(e,r){var t=e.length,n=-1,i,s=[];if(r==null)for(;++n<t;)isNaN(i=pp(e[n]))||s.push(i);else for(;++n<t;)isNaN(i=pp(r(e[n],n,e)))||s.push(i);return Dg(s.sort(sm),.5)},H6=function(e){for(var r=e.length,t,n=-1,i=0,s,l;++n<r;)i+=e[n].length;for(s=new Array(i);--r>=0;)for(l=e[r],t=l.length;--t>=0;)s[--i]=l[t];return s},ZI=function(e,r){var t=e.length,n=-1,i,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=i;++n<t;)(i=e[n])!=null&&s>i&&(s=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=i;++n<t;)(i=r(e[n],n,e))!=null&&s>i&&(s=i);return s},W6=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},Z6=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,s,l=e[i];for(r==null&&(r=sm);++n<t;)(r(s=e[n],l)<0||r(l,l)!==0)&&(l=s,i=n);if(r(l,l)===0)return i}},X6=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,s;n;)s=Math.random()*n--|0,i=e[n+r],e[n+r]=e[s+r],e[s+r]=i;return e},Y6=function(e,r){var t=e.length,n=-1,i,s=0;if(r==null)for(;++n<t;)(i=+e[n])&&(s+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(s+=i);return s},XI=function(e){if(!(s=e.length))return[];for(var r=-1,t=ZI(e,YI),n=new Array(t);++r<t;)for(var i=-1,s,l=n[r]=new Array(s);++i<s;)l[i]=e[i][r];return n};function YI(e){return e.length}var $6=function(){return XI(arguments)},ud=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},tE=function(e){return e.length===1&&(e=$I(e)),{left:function(t,n,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var l=i+s>>>1;e(t[l],n)<0?i=l+1:s=l}return i},right:function(t,n,i,s){for(i==null&&(i=0),s==null&&(s=t.length);i<s;){var l=i+s>>>1;e(t[l],n)>0?s=l:i=l+1}return i}}};function $I(e){return function(r,t){return ud(e(r),t)}}var rE=tE(ud),KI=rE.right,K6=rE.left,nv=KI,q6=function(e,r){r==null&&(r=nE);for(var t=0,n=e.length-1,i=e[0],s=new Array(n<0?0:n);t<n;)s[t]=r(i,i=e[++t]);return s};function nE(e,r){return[e,r]}var Q6=function(e,r,t){var n=e.length,i=r.length,s=new Array(n*i),l,v,g,x;for(t==null&&(t=nE),l=g=0;l<n;++l)for(x=e[l],v=0;v<i;++v,++g)s[g]=t(x,r[v]);return s},J6=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},dp=function(e){return e===null?NaN:+e},qI=function(e,r){var t=e.length,n=0,i=-1,s=0,l,v,g=0;if(r==null)for(;++i<t;)isNaN(l=dp(e[i]))||(v=l-s,s+=v/++n,g+=v*(l-s));else for(;++i<t;)isNaN(l=dp(r(e[i],i,e)))||(v=l-s,s+=v/++n,g+=v*(l-s));if(n>1)return g/(n-1)},QI=function(e,r){var t=qI(e,r);return t&&Math.sqrt(t)},JI=function(e,r){var t=e.length,n=-1,i,s,l;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=l=i;++n<t;)(i=e[n])!=null&&(s>i&&(s=i),l<i&&(l=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=l=i;++n<t;)(i=r(e[n],n,e))!=null&&(s>i&&(s=i),l<i&&(l=i));return[s,l]},iE=Array.prototype,e3=iE.slice,t3=iE.map,a0=function(e){return function(){return e}},r3=function(e){return e},aE=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,s=new Array(i);++n<i;)s[n]=e+n*t;return s},Fg=Math.sqrt(50),Bg=Math.sqrt(10),Ng=Math.sqrt(2),oE=function(e,r,t){var n,i=-1,s,l,v;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(s=e,e=r,r=s),(v=o0(e,r,t))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),r=Math.floor(r/v),l=new Array(s=Math.ceil(r-e+1));++i<s;)l[i]=(e+i)*v;else for(e=Math.floor(e*v),r=Math.ceil(r*v),l=new Array(s=Math.ceil(e-r+1));++i<s;)l[i]=(e-i)/v;return n&&l.reverse(),l};function o0(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,i);return i>=0?(s>=Fg?10:s>=Bg?5:s>=Ng?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=Fg?10:s>=Bg?5:s>=Ng?2:1)}function s0(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/i;return s>=Fg?i*=10:s>=Bg?i*=5:s>=Ng&&(i*=2),r<e?-i:i}var n3=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},eB=function(){var e=r3,r=JI,t=n3;function n(i){var s,l=i.length,v,g=new Array(l);for(s=0;s<l;++s)g[s]=e(i[s],s,i);var x=r(g),C=x[0],T=x[1],R=t(g,C,T);Array.isArray(R)||(R=s0(C,T,R),R=aE(Math.ceil(C/R)*R,T,R));for(var F=R.length;R[0]<=C;)R.shift(),--F;for(;R[F-1]>T;)R.pop(),--F;var H=new Array(F+1),Q;for(s=0;s<=F;++s)Q=H[s]=[],Q.x0=s>0?R[s-1]:C,Q.x1=s<F?R[s]:T;for(s=0;s<l;++s)v=g[s],C<=v&&v<=T&&H[nv(R,v,0,F)].push(i[s]);return H}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:a0(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:a0([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?a0(e3.call(i)):a0(i),n):t},n},u0=function(e,r,t){if(t==null&&(t=dp),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,s=Math.floor(i),l=+t(e[s],s,e),v=+t(e[s+1],s+1,e);return l+(v-l)*(i-s)}},tB=function(e,r,t){return e=t3.call(e,dp).sort(ud),Math.ceil((t-r)/(2*(u0(e,.75)-u0(e,.25))*Math.pow(e.length,-1/3)))},rB=function(e,r,t){return Math.ceil((t-r)/(3.5*QI(e)*Math.pow(e.length,-1/3)))},nB=function(e,r){var t=e.length,n=-1,i,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=i;++n<t;)(i=e[n])!=null&&i>s&&(s=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=i;++n<t;)(i=r(e[n],n,e))!=null&&i>s&&(s=i);return s},iB=function(e,r){var t=e.length,n=t,i=-1,s,l=0;if(r==null)for(;++i<t;)isNaN(s=dp(e[i]))?--n:l+=s;else for(;++i<t;)isNaN(s=dp(r(e[i],i,e)))?--n:l+=s;if(n)return l/n},aB=function(e,r){var t=e.length,n=-1,i,s=[];if(r==null)for(;++n<t;)isNaN(i=dp(e[n]))||s.push(i);else for(;++n<t;)isNaN(i=dp(r(e[n],n,e)))||s.push(i);return u0(s.sort(ud),.5)},oB=function(e){for(var r=e.length,t,n=-1,i=0,s,l;++n<r;)i+=e[n].length;for(s=new Array(i);--r>=0;)for(l=e[r],t=l.length;--t>=0;)s[--i]=l[t];return s},i3=function(e,r){var t=e.length,n=-1,i,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(s=i;++n<t;)(i=e[n])!=null&&s>i&&(s=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(s=i;++n<t;)(i=r(e[n],n,e))!=null&&s>i&&(s=i);return s},sB=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},uB=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,s,l=e[i];for(r==null&&(r=ud);++n<t;)(r(s=e[n],l)<0||r(l,l)!==0)&&(l=s,i=n);if(r(l,l)===0)return i}},lB=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,s;n;)s=Math.random()*n--|0,i=e[n+r],e[n+r]=e[s+r],e[s+r]=i;return e},cB=function(e,r){var t=e.length,n=-1,i,s=0;if(r==null)for(;++n<t;)(i=+e[n])&&(s+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(s+=i);return s},a3=function(e){if(!(s=e.length))return[];for(var r=-1,t=i3(e,o3),n=new Array(t);++r<t;)for(var i=-1,s,l=n[r]=new Array(s);++i<s;)l[i]=e[i][r];return n};function o3(e){return e.length}var fB=function(){return a3(arguments)};function Pf(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function Ph(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Zc="$";function l0(){}l0.prototype=sE.prototype={constructor:l0,has:function(r){return Zc+r in this},get:function(r){return this[Zc+r]},set:function(r,t){return this[Zc+r]=t,this},remove:function(r){var t=Zc+r;return t in this&&delete this[t]},clear:function(){for(var r in this)r[0]===Zc&&delete this[r]},keys:function(){var r=[];for(var t in this)t[0]===Zc&&r.push(t.slice(1));return r},values:function(){var r=[];for(var t in this)t[0]===Zc&&r.push(this[t]);return r},entries:function(){var r=[];for(var t in this)t[0]===Zc&&r.push({key:t.slice(1),value:this[t]});return r},size:function(){var r=0;for(var t in this)t[0]===Zc&&++r;return r},empty:function(){for(var r in this)if(r[0]===Zc)return!1;return!0},each:function(r){for(var t in this)t[0]===Zc&&r(this[t],t.slice(1),this)}};function sE(e,r){var t=new l0;if(e instanceof l0)e.each(function(v,g){t.set(g,v)});else if(Array.isArray(e)){var n=-1,i=e.length,s;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(s=e[n],n,e),s)}else if(e)for(var l in e)t.set(l,e[l]);return t}var um=sE,hB=function(){var e=[],r=[],t,n,i;function s(v,g,x,C){if(g>=e.length)return t!=null&&v.sort(t),n!=null?n(v):v;for(var T=-1,R=v.length,F=e[g++],H,Q,ie=um(),be,je=x();++T<R;)(be=ie.get(H=F(Q=v[T])+""))?be.push(Q):ie.set(H,[Q]);return ie.each(function(Je,et){C(je,et,s(Je,g,x,C))}),je}function l(v,g){if(++g>e.length)return v;var x,C=r[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,R){x.push({key:R,values:l(T,g)})})),C!=null?x.sort(function(T,R){return C(T.key,R.key)}):x}return i={object:function(g){return s(g,0,s3,u3)},map:function(g){return s(g,0,uE,lE)},entries:function(g){return l(s(g,0,uE,lE),0)},key:function(g){return e.push(g),i},sortKeys:function(g){return r[e.length-1]=g,i},sortValues:function(g){return t=g,i},rollup:function(g){return n=g,i}}};function s3(){return{}}function u3(e,r,t){e[r]=t}function uE(){return um()}function lE(e,r,t){e.set(r,t)}function c0(){}var ld=um.prototype;c0.prototype=cE.prototype={constructor:c0,has:ld.has,add:function(r){return r+="",this[Zc+r]=r,this},remove:ld.remove,clear:ld.clear,values:ld.keys,size:ld.size,empty:ld.empty,each:ld.each};function cE(e,r){var t=new c0;if(e instanceof c0)e.each(function(s){t.add(s)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var pB=cE,dB=function(e){var r=[];for(var t in e)r.push(t);return r},vB=function(e){var r=[];for(var t in e)r.push(e[t]);return r},mB=function(e){var r=[];for(var t in e)r.push({key:t,value:e[t]});return r},fE=Array.prototype,f0=fE.map,cd=fE.slice,hE={name:"implicit"};function lm(){var e=um(),r=[],t=[],n=hE;function i(s){var l=s+"",v=e.get(l);if(!v){if(n!==hE)return n;e.set(l,v=r.push(s))}return t[(v-1)%t.length]}return i.domain=function(s){if(!arguments.length)return r.slice();r=[],e=um();for(var l=-1,v=s.length,g,x;++l<v;)e.has(x=(g=s[l])+"")||e.set(x,r.push(g));return i},i.range=function(s){return arguments.length?(t=cd.call(s),i):t.slice()},i.unknown=function(s){return arguments.length?(n=s,i):n},i.copy=function(){return lm(r,t).unknown(n)},Pf.apply(i,arguments),i}function pE(){var e=lm().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,s,l=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=r().length,R=n[1]<n[0],F=n[R-0],H=n[1-R];i=(H-F)/Math.max(1,T-v+g*2),l&&(i=Math.floor(i)),F+=(H-F-i*(T-v))*x,s=i*(1-v),l&&(F=Math.round(F),s=Math.round(s));var Q=aE(T).map(function(ie){return F+i*ie});return t(R?Q.reverse():Q)}return e.domain=function(T){return arguments.length?(r(T),C()):r()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],l=!0,C()},e.bandwidth=function(){return s},e.step=function(){return i},e.round=function(T){return arguments.length?(l=!!T,C()):l},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return pE(r(),n).round(l).paddingInner(v).paddingOuter(g).align(x)},Pf.apply(C(),arguments)}function dE(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return dE(r())},e}function gB(){return dE(pE.apply(null,arguments).paddingInner(1))}function vE(e,r,t,n,i){var s=e*e,l=s*e;return((1-3*e+3*s-l)*r+(4-6*s+3*l)*t+(1+3*e+3*s-3*l)*n+l*i)/6}var l3=function(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],s=e[n+1],l=n>0?e[n-1]:2*i-s,v=n<r-1?e[n+2]:2*s-i;return vE((t-n/r)*r,l,i,s,v)}},c3=function(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],s=e[n%r],l=e[(n+1)%r],v=e[(n+2)%r];return vE((t-n/r)*r,i,s,l,v)}},h0=function(e){return function(){return e}};function mE(e,r){return function(t){return e+t*r}}function f3(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function yB(e,r){var t=r-e;return t?mE(e,t>180||t<-180?t-360*Math.round(t/360):t):h0(isNaN(e)?r:e)}function h3(e){return(e=+e)==1?gE:function(r,t){return t-r?f3(r,t,e):h0(isNaN(r)?t:r)}}function gE(e,r){var t=r-e;return t?mE(e,t):h0(isNaN(e)?r:e)}var yE=function e(r){var t=h3(r);function n(i,s){var l=t((i=ps(i)).r,(s=ps(s)).r),v=t(i.g,s.g),g=t(i.b,s.b),x=gE(i.opacity,s.opacity);return function(C){return i.r=l(C),i.g=v(C),i.b=g(C),i.opacity=x(C),i+""}}return n.gamma=e,n}(1);function _E(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),s=new Array(t),l,v;for(l=0;l<t;++l)v=ps(r[l]),n[l]=v.r||0,i[l]=v.g||0,s[l]=v.b||0;return n=e(n),i=e(i),s=e(s),v.opacity=1,function(g){return v.r=n(g),v.g=i(g),v.b=s(g),v+""}}}var _B=_E(l3),xB=_E(c3),xE=function(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(s){for(i=0;i<t;++i)n[i]=e[i]*(1-s)+r[i]*s;return n}};function bE(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var bB=function(e,r){return(bE(r)?xE:EE)(e,r)};function EE(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),s=new Array(t),l;for(l=0;l<n;++l)i[l]=jg(e[l],r[l]);for(;l<t;++l)s[l]=r[l];return function(v){for(l=0;l<n;++l)s[l]=i[l](v);return s}}var p3=function(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}},p0=function(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}},d3=function(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=jg(e[i],r[i]):n[i]=r[i];return function(s){for(i in t)n[i]=t[i](s);return n}},zg=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ug=new RegExp(zg.source,"g");function v3(e){return function(){return e}}function m3(e){return function(r){return e(r)+""}}var g3=function(e,r){var t=zg.lastIndex=Ug.lastIndex=0,n,i,s,l=-1,v=[],g=[];for(e=e+"",r=r+"";(n=zg.exec(e))&&(i=Ug.exec(r));)(s=i.index)>t&&(s=r.slice(t,s),v[l]?v[l]+=s:v[++l]=s),(n=n[0])===(i=i[0])?v[l]?v[l]+=i:v[++l]=i:(v[++l]=null,g.push({i:l,x:p0(n,i)})),t=Ug.lastIndex;return t<r.length&&(s=r.slice(t),v[l]?v[l]+=s:v[++l]=s),v.length<2?g[0]?m3(g[0].x):v3(r):(r=g.length,function(x){for(var C=0,T;C<r;++C)v[(T=g[C]).i]=T.x(x);return v.join("")})},jg=function(e,r){var t=typeof r,n;return r==null||t==="boolean"?h0(r):(t==="number"?p0:t==="string"?(n=vu(r))?(r=n,yE):g3:r instanceof vu?yE:r instanceof Date?p3:bE(r)?xE:Array.isArray(r)?EE:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?d3:p0)(e,r)},y3=function(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}},_3=function(e){return function(){return e}},Vg=function(e){return+e},SE=[0,1];function tl(e){return e}function Gg(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:_3(isNaN(r)?NaN:.5)}function CE(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function x3(e,r,t){var n=e[0],i=e[1],s=r[0],l=r[1];return i<n?(n=Gg(i,n),s=t(l,s)):(n=Gg(n,i),s=t(s,l)),function(v){return s(n(v))}}function b3(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),s=new Array(n),l=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++l<n;)i[l]=Gg(e[l],e[l+1]),s[l]=t(r[l],r[l+1]);return function(v){var g=nv(e,v,1,n)-1;return s[g](i[g](v))}}function cm(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function d0(){var e=SE,r=SE,t=jg,n,i,s,l=tl,v,g,x;function C(){return v=Math.min(e.length,r.length)>2?b3:x3,g=x=null,T}function T(R){return isNaN(R=+R)?s:(g||(g=v(e.map(n),r,t)))(n(l(R)))}return T.invert=function(R){return l(i((x||(x=v(r,e.map(n),p0)))(R)))},T.domain=function(R){return arguments.length?(e=f0.call(R,Vg),l===tl||(l=CE(e)),C()):e.slice()},T.range=function(R){return arguments.length?(r=cd.call(R),C()):r.slice()},T.rangeRound=function(R){return r=cd.call(R),t=y3,C()},T.clamp=function(R){return arguments.length?(l=R?CE(e):tl,T):l!==tl},T.interpolate=function(R){return arguments.length?(t=R,C()):t},T.unknown=function(R){return arguments.length?(s=R,T):s},function(R,F){return n=R,i=F,C()}}function wE(e,r){return d0()(e,r)}var E3=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function v0(e){if(!(r=E3.exec(e)))throw new Error("invalid format: "+e);var r;return new Hg({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}v0.prototype=Hg.prototype;function Hg(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Hg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};var S3=function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)};function m0(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}var iv=function(e){return e=m0(Math.abs(e)),e?e[1]:NaN},C3=function(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(iv(r)/3)))*3-iv(Math.abs(e)))},w3=function(e,r){return function(t,n){for(var i=t.length,s=[],l=0,v=e[0],g=0;i>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(t.substring(i-=v,i+v)),!((g+=v+1)>n));)v=e[l=(l+1)%e.length];return s.reverse().join(r)}},A3=function(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}},T3=function(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e},AE,M3=function(e,r){var t=m0(e,r);if(!t)return e+"";var n=t[0],i=t[1],s=i-(AE=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,l=n.length;return s===l?n:s>l?n+new Array(s-l+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+m0(e,Math.max(0,r+s-1))[0]},TE=function(e,r){var t=m0(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")},ME={"%":function(r,t){return(r*100).toFixed(t)},b:function(r){return Math.round(r).toString(2)},c:function(r){return r+""},d:S3,e:function(r,t){return r.toExponential(t)},f:function(r,t){return r.toFixed(t)},g:function(r,t){return r.toPrecision(t)},o:function(r){return Math.round(r).toString(8)},p:function(r,t){return TE(r*100,t)},r:TE,s:M3,X:function(r){return Math.round(r).toString(16).toUpperCase()},x:function(r){return Math.round(r).toString(16)}},PE=function(e){return e},OE=Array.prototype.map,IE=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"],P3=function(e){var r=e.grouping===void 0||e.thousands===void 0?PE:w3(OE.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?PE:A3(OE.call(e.numerals,String)),l=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=v0(T);var R=T.fill,F=T.align,H=T.sign,Q=T.symbol,ie=T.zero,be=T.width,je=T.comma,Je=T.precision,et=T.trim,bt=T.type;bt==="n"?(je=!0,bt="g"):ME[bt]||(Je===void 0&&(Je=12),et=!0,bt="g"),(ie||R==="0"&&F==="=")&&(ie=!0,R="0",F="=");var Et=Q==="$"?t:Q==="#"&&/[boxX]/.test(bt)?"0"+bt.toLowerCase():"",kt=Q==="$"?n:/[%p]/.test(bt)?l:"",jt=ME[bt],mr=/[defgprs%]/.test(bt);Je=Je===void 0?6:/[gprs]/.test(bt)?Math.max(1,Math.min(21,Je)):Math.max(0,Math.min(20,Je));function Ar(pr){var pn=Et,Tn=kt,Jn,va,oo;if(bt==="c")Tn=jt(pr)+Tn,pr="";else{pr=+pr;var ko=pr<0||1/pr<0;if(pr=isNaN(pr)?g:jt(Math.abs(pr),Je),et&&(pr=T3(pr)),ko&&+pr==0&&H!=="+"&&(ko=!1),pn=(ko?H==="("?H:v:H==="-"||H==="("?"":H)+pn,Tn=(bt==="s"?IE[8+AE/3]:"")+Tn+(ko&&H==="("?")":""),mr){for(Jn=-1,va=pr.length;++Jn<va;)if(oo=pr.charCodeAt(Jn),48>oo||oo>57){Tn=(oo===46?i+pr.slice(Jn+1):pr.slice(Jn))+Tn,pr=pr.slice(0,Jn);break}}}je&&!ie&&(pr=r(pr,Infinity));var ss=pn.length+pr.length+Tn.length,eo=ss<be?new Array(be-ss+1).join(R):"";switch(je&&ie&&(pr=r(eo+pr,eo.length?be-Tn.length:Infinity),eo=""),F){case"<":pr=pn+pr+Tn+eo;break;case"=":pr=pn+eo+pr+Tn;break;case"^":pr=eo.slice(0,ss=eo.length>>1)+pn+pr+Tn+eo.slice(ss);break;default:pr=eo+pn+pr+Tn;break}return s(pr)}return Ar.toString=function(){return T+""},Ar}function C(T,R){var F=x((T=v0(T),T.type="f",T)),H=Math.max(-8,Math.min(8,Math.floor(iv(R)/3)))*3,Q=Math.pow(10,-H),ie=IE[8+H/3];return function(be){return F(Q*be)+ie}}return{format:x,formatPrefix:C}},g0,Wg,RE;O3({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function O3(e){return g0=P3(e),Wg=g0.format,RE=g0.formatPrefix,g0}var I3=function(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,iv(r)-iv(e))+1},R3=function(e){return Math.max(0,-iv(Math.abs(e)))},k3=function(e,r,t,n){var i=s0(e,r,t),s;switch(n=v0(n==null?",f":n),n.type){case"s":{var l=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(s=C3(i,l))&&(n.precision=s),RE(n,l)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=I3(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=R3(i))&&(n.precision=s-(n.type==="%")*2);break}}return Wg(n)};function fd(e){var r=e.domain;return e.ticks=function(t){var n=r();return oE(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return k3(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,s=n.length-1,l=n[i],v=n[s],g;return v<l&&(g=l,l=v,v=g,g=i,i=s,s=g),g=o0(l,v,t),g>0?(l=Math.floor(l/g)*g,v=Math.ceil(v/g)*g,g=o0(l,v,t)):g<0&&(l=Math.ceil(l*g)/g,v=Math.floor(v*g)/g,g=o0(l,v,t)),g>0?(n[i]=Math.floor(l/g)*g,n[s]=Math.ceil(v/g)*g,r(n)):g<0&&(n[i]=Math.ceil(l*g)/g,n[s]=Math.floor(v*g)/g,r(n)),e},e}function kE(){var e=wE(tl,tl);return e.copy=function(){return cm(e,kE())},Pf.apply(e,arguments),fd(e)}function LE(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=f0.call(n,Vg),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return LE(e).unknown(r)},e=arguments.length?f0.call(e,Vg):[0,1],fd(t)}var DE=function(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],s=e[n],l;return s<i&&(l=t,t=n,n=l,l=i,i=s,s=l),e[t]=r.floor(i),e[n]=r.ceil(s),e};function FE(e){return Math.log(e)}function BE(e){return Math.exp(e)}function L3(e){return-Math.log(-e)}function D3(e){return-Math.exp(-e)}function F3(e){return isFinite(e)?+("1e"+e):e<0?0:e}function B3(e){return e===10?F3:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function N3(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function NE(e){return function(r){return-e(-r)}}function Zg(e){var r=e(FE,BE),t=r.domain,n=10,i,s;function l(){return i=N3(n),s=B3(n),t()[0]<0?(i=NE(i),s=NE(s),e(L3,D3)):e(FE,BE),r}return r.base=function(v){return arguments.length?(n=+v,l()):n},r.domain=function(v){return arguments.length?(t(v),l()):t()},r.ticks=function(v){var g=t(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(R=x,x=C,C=R);var R=i(x),F=i(C),H,Q,ie,be=v==null?10:+v,je=[];if(!(n%1)&&F-R<be){if(R=Math.round(R)-1,F=Math.round(F)+1,x>0){for(;R<F;++R)for(Q=1,H=s(R);Q<n;++Q)if(ie=H*Q,!(ie<x)){if(ie>C)break;je.push(ie)}}else for(;R<F;++R)for(Q=n-1,H=s(R);Q>=1;--Q)if(ie=H*Q,!(ie<x)){if(ie>C)break;je.push(ie)}}else je=oE(R,F,Math.min(F-R,be)).map(s);return T?je.reverse():je},r.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Wg(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/r.ticks().length);return function(C){var T=C/s(Math.round(i(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},r.nice=function(){return t(DE(t(),{floor:function(g){return s(Math.floor(i(g)))},ceil:function(g){return s(Math.ceil(i(g)))}}))},r}function zE(){var e=Zg(d0()).domain([1,10]);return e.copy=function(){return cm(e,zE()).base(e.base())},Pf.apply(e,arguments),e}function UE(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function jE(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function Xg(e){var r=1,t=e(UE(r),jE(r));return t.constant=function(n){return arguments.length?e(UE(r=+n),jE(r)):r},fd(t)}function z3(){var e=Xg(d0());return e.copy=function(){return cm(e,z3()).constant(e.constant())},Pf.apply(e,arguments)}function VE(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function U3(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function j3(e){return e<0?-e*e:e*e}function Yg(e){var r=e(tl,tl),t=1;function n(){return t===1?e(tl,tl):t===.5?e(U3,j3):e(VE(t),VE(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},fd(r)}function $g(){var e=Yg(d0());return e.copy=function(){return cm(e,$g()).exponent(e.exponent())},Pf.apply(e,arguments),e}function EB(){return $g.apply(null,arguments).exponent(.5)}function GE(){var e=[],r=[],t=[],n;function i(){var l=0,v=Math.max(1,r.length);for(t=new Array(v-1);++l<v;)t[l-1]=u0(e,l/v);return s}function s(l){return isNaN(l=+l)?n:r[nv(t,l)]}return s.invertExtent=function(l){var v=r.indexOf(l);return v<0?[NaN,NaN]:[v>0?t[v-1]:e[0],v<t.length?t[v]:e[e.length-1]]},s.domain=function(l){if(!arguments.length)return e.slice();e=[];for(var v=0,g=l.length,x;v<g;++v)x=l[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(ud),i()},s.range=function(l){return arguments.length?(r=cd.call(l),i()):r.slice()},s.unknown=function(l){return arguments.length?(n=l,s):n},s.quantiles=function(){return t.slice()},s.copy=function(){return GE().domain(e).range(r).unknown(n)},Pf.apply(s,arguments)}function HE(){var e=0,r=1,t=1,n=[.5],i=[0,1],s;function l(g){return g<=g?i[nv(n,g,0,t)]:s}function v(){var g=-1;for(n=new Array(t);++g<t;)n[g]=((g+1)*r-(g-t)*e)/(t+1);return l}return l.domain=function(g){return arguments.length?(e=+g[0],r=+g[1],v()):[e,r]},l.range=function(g){return arguments.length?(t=(i=cd.call(g)).length-1,v()):i.slice()},l.invertExtent=function(g){var x=i.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=t?[n[t-1],r]:[n[x-1],n[x]]},l.unknown=function(g){return arguments.length&&(s=g),l},l.thresholds=function(){return n.slice()},l.copy=function(){return HE().domain([e,r]).range(i).unknown(s)},Pf.apply(fd(l),arguments)}function WE(){var e=[.5],r=[0,1],t,n=1;function i(s){return s<=s?r[nv(e,s,0,n)]:t}return i.domain=function(s){return arguments.length?(e=cd.call(s),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(s){return arguments.length?(r=cd.call(s),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(s){var l=r.indexOf(s);return[e[l-1],e[l]]},i.unknown=function(s){return arguments.length?(t=s,i):t},i.copy=function(){return WE().domain(e).range(r).unknown(t)},Pf.apply(i,arguments)}var Kg=new Date,qg=new Date;function ku(e,r,t,n){function i(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return i.floor=function(s){return e(s=new Date(+s)),s},i.ceil=function(s){return e(s=new Date(s-1)),r(s,1),e(s),s},i.round=function(s){var l=i(s),v=i.ceil(s);return s-l<v-s?l:v},i.offset=function(s,l){return r(s=new Date(+s),l==null?1:Math.floor(l)),s},i.range=function(s,l,v){var g=[],x;if(s=i.ceil(s),v=v==null?1:Math.floor(v),!(s<l)||!(v>0))return g;do g.push(x=new Date(+s)),r(s,v),e(s);while(x<s&&s<l);return g},i.filter=function(s){return ku(function(l){if(l>=l)for(;e(l),!s(l);)l.setTime(l-1)},function(l,v){if(l>=l)if(v<0)for(;++v<=0;)for(;r(l,-1),!s(l););else for(;--v>=0;)for(;r(l,1),!s(l););})},t&&(i.count=function(s,l){return Kg.setTime(+s),qg.setTime(+l),e(Kg),e(qg),Math.floor(t(Kg,qg))},i.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?i.filter(n?function(l){return n(l)%s==0}:function(l){return i.count(0,l)%s==0}):i}),i}var Qg=ku(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Qg.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ku(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var av=Qg,SB=Qg.range,ZE=ku(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),V3=ZE,CB=ZE.range,y0=1e3,hd=6e4,_0=36e5,XE=864e5,YE=6048e5;function pd(e){return ku(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*hd)/YE})}var Jg=pd(0),x0=pd(1),G3=pd(2),H3=pd(3),ov=pd(4),W3=pd(5),Z3=pd(6),wB=Jg.range,AB=x0.range,TB=G3.range,MB=H3.range,PB=ov.range,OB=W3.range,IB=Z3.range,$E=ku(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*hd)/XE},function(e){return e.getDate()-1}),ey=$E,RB=$E.range,KE=ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*y0-e.getMinutes()*hd)},function(e,r){e.setTime(+e+r*_0)},function(e,r){return(r-e)/_0},function(e){return e.getHours()}),X3=KE,kB=KE.range,qE=ku(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*y0)},function(e,r){e.setTime(+e+r*hd)},function(e,r){return(r-e)/hd},function(e){return e.getMinutes()}),Y3=qE,LB=qE.range,QE=ku(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*y0)},function(e,r){return(r-e)/y0},function(e){return e.getUTCSeconds()}),JE=QE,DB=QE.range,b0=ku(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});b0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ku(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):b0};var e2=b0,FB=b0.range;function dd(e){return ku(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/YE})}var ty=dd(0),E0=dd(1),$3=dd(2),K3=dd(3),sv=dd(4),q3=dd(5),Q3=dd(6),BB=ty.range,NB=E0.range,zB=$3.range,UB=K3.range,jB=sv.range,VB=q3.range,GB=Q3.range,t2=ku(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/XE},function(e){return e.getUTCDate()-1}),ry=t2,HB=t2.range,ny=ku(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});ny.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:ku(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var uv=ny,WB=ny.range;function iy(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function ay(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function fm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function J3(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,s=e.days,l=e.shortDays,v=e.months,g=e.shortMonths,x=hm(i),C=pm(i),T=hm(s),R=pm(s),F=hm(l),H=pm(l),Q=hm(v),ie=pm(v),be=hm(g),je=pm(g),Je={a:ko,A:ss,b:eo,B:Bl,c:null,d:s2,e:s2,f:ER,g:RR,G:LR,H:_R,I:xR,j:bR,L:u2,m:SR,M:CR,p:yc,q:_l,Q:d2,s:v2,S:wR,u:AR,U:TR,V:MR,w:PR,W:OR,x:null,X:null,y:IR,Y:kR,Z:DR,"%":p2},et={a:Yc,A:yp,b:po,B:xl,c:null,d:c2,e:c2,f:zR,g:$R,G:qR,H:FR,I:BR,j:NR,L:f2,m:UR,M:jR,p:_v,q:xv,Q:d2,s:v2,S:VR,u:GR,U:HR,V:WR,w:ZR,W:XR,x:null,X:null,y:YR,Y:KR,Z:QR,"%":p2},bt={a:Ar,A:pr,b:pn,B:Tn,c:Jn,d:a2,e:a2,f:vR,g:i2,G:n2,H:o2,I:o2,j:fR,L:dR,m:cR,M:hR,p:mr,q:lR,Q:gR,s:yR,S:pR,u:iR,U:aR,V:oR,w:nR,W:sR,x:va,X:oo,y:i2,Y:n2,Z:uR,"%":mR};Je.x=Et(t,Je),Je.X=Et(n,Je),Je.c=Et(r,Je),et.x=Et(t,et),et.X=Et(n,et),et.c=Et(r,et);function Et(ki,ta){return function(qi){var zn=[],Jl=-1,$o=0,_c=ki.length,xc,_d,Aw;for(qi instanceof Date||(qi=new Date(+qi));++Jl<_c;)ki.charCodeAt(Jl)===37&&(zn.push(ki.slice($o,Jl)),(_d=r2[xc=ki.charAt(++Jl)])!=null?xc=ki.charAt(++Jl):_d=xc==="e"?" ":"0",(Aw=ta[xc])&&(xc=Aw(qi,_d)),zn.push(xc),$o=Jl+1);return zn.push(ki.slice($o,Jl)),zn.join("")}}function kt(ki,ta){return function(qi){var zn=fm(1900,void 0,1),Jl=jt(zn,ki,qi+="",0),$o,_c;if(Jl!=qi.length)return null;if("Q"in zn)return new Date(zn.Q);if("s"in zn)return new Date(zn.s*1e3+("L"in zn?zn.L:0));if(ta&&!("Z"in zn)&&(zn.Z=0),"p"in zn&&(zn.H=zn.H%12+zn.p*12),zn.m===void 0&&(zn.m="q"in zn?zn.q:0),"V"in zn){if(zn.V<1||zn.V>53)return null;"w"in zn||(zn.w=1),"Z"in zn?($o=ay(fm(zn.y,0,1)),_c=$o.getUTCDay(),$o=_c>4||_c===0?E0.ceil($o):E0($o),$o=ry.offset($o,(zn.V-1)*7),zn.y=$o.getUTCFullYear(),zn.m=$o.getUTCMonth(),zn.d=$o.getUTCDate()+(zn.w+6)%7):($o=iy(fm(zn.y,0,1)),_c=$o.getDay(),$o=_c>4||_c===0?x0.ceil($o):x0($o),$o=ey.offset($o,(zn.V-1)*7),zn.y=$o.getFullYear(),zn.m=$o.getMonth(),zn.d=$o.getDate()+(zn.w+6)%7)}else("W"in zn||"U"in zn)&&("w"in zn||(zn.w="u"in zn?zn.u%7:"W"in zn?1:0),_c="Z"in zn?ay(fm(zn.y,0,1)).getUTCDay():iy(fm(zn.y,0,1)).getDay(),zn.m=0,zn.d="W"in zn?(zn.w+6)%7+zn.W*7-(_c+5)%7:zn.w+zn.U*7-(_c+6)%7);return"Z"in zn?(zn.H+=zn.Z/100|0,zn.M+=zn.Z%100,ay(zn)):iy(zn)}}function jt(ki,ta,qi,zn){for(var Jl=0,$o=ta.length,_c=qi.length,xc,_d;Jl<$o;){if(zn>=_c)return-1;if(xc=ta.charCodeAt(Jl++),xc===37){if(xc=ta.charAt(Jl++),_d=bt[xc in r2?ta.charAt(Jl++):xc],!_d||(zn=_d(ki,qi,zn))<0)return-1}else if(xc!=qi.charCodeAt(zn++))return-1}return zn}function mr(ki,ta,qi){var zn=x.exec(ta.slice(qi));return zn?(ki.p=C[zn[0].toLowerCase()],qi+zn[0].length):-1}function Ar(ki,ta,qi){var zn=F.exec(ta.slice(qi));return zn?(ki.w=H[zn[0].toLowerCase()],qi+zn[0].length):-1}function pr(ki,ta,qi){var zn=T.exec(ta.slice(qi));return zn?(ki.w=R[zn[0].toLowerCase()],qi+zn[0].length):-1}function pn(ki,ta,qi){var zn=be.exec(ta.slice(qi));return zn?(ki.m=je[zn[0].toLowerCase()],qi+zn[0].length):-1}function Tn(ki,ta,qi){var zn=Q.exec(ta.slice(qi));return zn?(ki.m=ie[zn[0].toLowerCase()],qi+zn[0].length):-1}function Jn(ki,ta,qi){return jt(ki,r,ta,qi)}function va(ki,ta,qi){return jt(ki,t,ta,qi)}function oo(ki,ta,qi){return jt(ki,n,ta,qi)}function ko(ki){return l[ki.getDay()]}function ss(ki){return s[ki.getDay()]}function eo(ki){return g[ki.getMonth()]}function Bl(ki){return v[ki.getMonth()]}function yc(ki){return i[+(ki.getHours()>=12)]}function _l(ki){return 1+~~(ki.getMonth()/3)}function Yc(ki){return l[ki.getUTCDay()]}function yp(ki){return s[ki.getUTCDay()]}function po(ki){return g[ki.getUTCMonth()]}function xl(ki){return v[ki.getUTCMonth()]}function _v(ki){return i[+(ki.getUTCHours()>=12)]}function xv(ki){return 1+~~(ki.getUTCMonth()/3)}return{format:function(ta){var qi=Et(ta+="",Je);return qi.toString=function(){return ta},qi},parse:function(ta){var qi=kt(ta+="",!1);return qi.toString=function(){return ta},qi},utcFormat:function(ta){var qi=Et(ta+="",et);return qi.toString=function(){return ta},qi},utcParse:function(ta){var qi=kt(ta+="",!0);return qi.toString=function(){return ta},qi}}}var r2={"-":"",_:" ","0":"0"},Lu=/^\s*\d+/,eR=/^%/,tR=/[\\^$*+?|[\]().{}]/g;function io(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",s=i.length;return n+(s<t?new Array(t-s+1).join(r)+i:i)}function rR(e){return e.replace(tR,"\\$&")}function hm(e){return new RegExp("^(?:"+e.map(rR).join("|")+")","i")}function pm(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function nR(e,r,t){var n=Lu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function iR(e,r,t){var n=Lu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function aR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function oR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function sR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function n2(e,r,t){var n=Lu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function i2(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function uR(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function lR(e,r,t){var n=Lu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function cR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function a2(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function fR(e,r,t){var n=Lu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function o2(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function hR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function pR(e,r,t){var n=Lu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function dR(e,r,t){var n=Lu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function vR(e,r,t){var n=Lu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function mR(e,r,t){var n=eR.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function gR(e,r,t){var n=Lu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function yR(e,r,t){var n=Lu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function s2(e,r){return io(e.getDate(),r,2)}function _R(e,r){return io(e.getHours(),r,2)}function xR(e,r){return io(e.getHours()%12||12,r,2)}function bR(e,r){return io(1+ey.count(av(e),e),r,3)}function u2(e,r){return io(e.getMilliseconds(),r,3)}function ER(e,r){return u2(e,r)+"000"}function SR(e,r){return io(e.getMonth()+1,r,2)}function CR(e,r){return io(e.getMinutes(),r,2)}function wR(e,r){return io(e.getSeconds(),r,2)}function AR(e){var r=e.getDay();return r===0?7:r}function TR(e,r){return io(Jg.count(av(e)-1,e),r,2)}function l2(e){var r=e.getDay();return r>=4||r===0?ov(e):ov.ceil(e)}function MR(e,r){return e=l2(e),io(ov.count(av(e),e)+(av(e).getDay()===4),r,2)}function PR(e){return e.getDay()}function OR(e,r){return io(x0.count(av(e)-1,e),r,2)}function IR(e,r){return io(e.getFullYear()%100,r,2)}function RR(e,r){return e=l2(e),io(e.getFullYear()%100,r,2)}function kR(e,r){return io(e.getFullYear()%1e4,r,4)}function LR(e,r){var t=e.getDay();return e=t>=4||t===0?ov(e):ov.ceil(e),io(e.getFullYear()%1e4,r,4)}function DR(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+io(r/60|0,"0",2)+io(r%60,"0",2)}function c2(e,r){return io(e.getUTCDate(),r,2)}function FR(e,r){return io(e.getUTCHours(),r,2)}function BR(e,r){return io(e.getUTCHours()%12||12,r,2)}function NR(e,r){return io(1+ry.count(uv(e),e),r,3)}function f2(e,r){return io(e.getUTCMilliseconds(),r,3)}function zR(e,r){return f2(e,r)+"000"}function UR(e,r){return io(e.getUTCMonth()+1,r,2)}function jR(e,r){return io(e.getUTCMinutes(),r,2)}function VR(e,r){return io(e.getUTCSeconds(),r,2)}function GR(e){var r=e.getUTCDay();return r===0?7:r}function HR(e,r){return io(ty.count(uv(e)-1,e),r,2)}function h2(e){var r=e.getUTCDay();return r>=4||r===0?sv(e):sv.ceil(e)}function WR(e,r){return e=h2(e),io(sv.count(uv(e),e)+(uv(e).getUTCDay()===4),r,2)}function ZR(e){return e.getUTCDay()}function XR(e,r){return io(E0.count(uv(e)-1,e),r,2)}function YR(e,r){return io(e.getUTCFullYear()%100,r,2)}function $R(e,r){return e=h2(e),io(e.getUTCFullYear()%100,r,2)}function KR(e,r){return io(e.getUTCFullYear()%1e4,r,4)}function qR(e,r){var t=e.getUTCDay();return e=t>=4||t===0?sv(e):sv.ceil(e),io(e.getUTCFullYear()%1e4,r,4)}function QR(){return"+0000"}function p2(){return"%"}function d2(e){return+e}function v2(e){return Math.floor(+e/1e3)}var lv,m2,JR,g2,e4;t4({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function t4(e){return lv=J3(e),m2=lv.format,JR=lv.parse,g2=lv.utcFormat,e4=lv.utcParse,lv}var dm=1e3,vm=dm*60,mm=vm*60,gm=mm*24,r4=gm*7,y2=gm*30,oy=gm*365;function n4(e){return new Date(e)}function i4(e){return e instanceof Date?+e:+new Date(+e)}function sy(e,r,t,n,i,s,l,v,g){var x=wE(tl,tl),C=x.invert,T=x.domain,R=g(".%L"),F=g(":%S"),H=g("%I:%M"),Q=g("%I %p"),ie=g("%a %d"),be=g("%b %d"),je=g("%B"),Je=g("%Y"),et=[[l,1,dm],[l,5,5*dm],[l,15,15*dm],[l,30,30*dm],[s,1,vm],[s,5,5*vm],[s,15,15*vm],[s,30,30*vm],[i,1,mm],[i,3,3*mm],[i,6,6*mm],[i,12,12*mm],[n,1,gm],[n,2,2*gm],[t,1,r4],[r,1,y2],[r,3,3*y2],[e,1,oy]];function bt(kt){return(l(kt)<kt?R:s(kt)<kt?F:i(kt)<kt?H:n(kt)<kt?Q:r(kt)<kt?t(kt)<kt?ie:be:e(kt)<kt?je:Je)(kt)}function Et(kt,jt,mr,Ar){if(kt==null&&(kt=10),typeof kt=="number"){var pr=Math.abs(mr-jt)/kt,pn=tE(function(Tn){return Tn[2]}).right(et,pr);pn===et.length?(Ar=s0(jt/oy,mr/oy,kt),kt=e):pn?(pn=et[pr/et[pn-1][2]<et[pn][2]/pr?pn-1:pn],Ar=pn[1],kt=pn[0]):(Ar=Math.max(s0(jt,mr,kt),1),kt=v)}return Ar==null?kt:kt.every(Ar)}return x.invert=function(kt){return new Date(C(kt))},x.domain=function(kt){return arguments.length?T(f0.call(kt,i4)):T().map(n4)},x.ticks=function(kt,jt){var mr=T(),Ar=mr[0],pr=mr[mr.length-1],pn=pr<Ar,Tn;return pn&&(Tn=Ar,Ar=pr,pr=Tn),Tn=Et(kt,Ar,pr,jt),Tn=Tn?Tn.range(Ar,pr+1):[],pn?Tn.reverse():Tn},x.tickFormat=function(kt,jt){return jt==null?bt:g(jt)},x.nice=function(kt,jt){var mr=T();return(kt=Et(kt,mr[0],mr[mr.length-1],jt))?T(DE(mr,kt)):x},x.copy=function(){return cm(x,sy(e,r,t,n,i,s,l,v,g))},x}var a4=function(){return Pf.apply(sy(av,V3,Jg,ey,X3,Y3,JE,e2,m2).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},_2=ku(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCMonth(e.getUTCMonth()+r)},function(e,r){return r.getUTCMonth()-e.getUTCMonth()+(r.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),o4=_2,ZB=_2.range,x2=ku(function(e){e.setUTCMinutes(0,0,0)},function(e,r){e.setTime(+e+r*_0)},function(e,r){return(r-e)/_0},function(e){return e.getUTCHours()}),s4=x2,XB=x2.range,b2=ku(function(e){e.setUTCSeconds(0,0)},function(e,r){e.setTime(+e+r*hd)},function(e,r){return(r-e)/hd},function(e){return e.getUTCMinutes()}),u4=b2,YB=b2.range,$B=function(){return Pf.apply(sy(uv,o4,ty,ry,s4,u4,JE,e2,g2).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)};function S0(){var e=0,r=1,t,n,i,s,l=tl,v=!1,g;function x(C){return isNaN(C=+C)?g:l(i===0?.5:(C=(s(C)-t)*i,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(t=s(e=+C[0]),n=s(r=+C[1]),i=t===n?0:1/(n-t),x):[e,r]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(l=C,x):l},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,t=C(e),n=C(r),i=t===n?0:1/(n-t),x}}function vp(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function l4(){var e=fd(S0()(tl));return e.copy=function(){return vp(e,l4())},Ph.apply(e,arguments)}function c4(){var e=Zg(S0()).domain([1,10]);return e.copy=function(){return vp(e,c4()).base(e.base())},Ph.apply(e,arguments)}function f4(){var e=Xg(S0());return e.copy=function(){return vp(e,f4()).constant(e.constant())},Ph.apply(e,arguments)}function E2(){var e=Yg(S0());return e.copy=function(){return vp(e,E2()).exponent(e.exponent())},Ph.apply(e,arguments)}function KB(){return E2.apply(null,arguments).exponent(.5)}function h4(){var e=[],r=tl;function t(n){if(!isNaN(n=+n))return r((nv(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,s=n.length,l;i<s;++i)l=n[i],l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(ud),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return h4(r).domain(e)},Ph.apply(t,arguments)}function C0(){var e=0,r=.5,t=1,n,i,s,l,v,g=tl,x,C=!1,T;function R(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-i)*(F<i?l:v),g(C?Math.max(0,Math.min(1,F)):F))}return R.domain=function(F){return arguments.length?(n=x(e=+F[0]),i=x(r=+F[1]),s=x(t=+F[2]),l=n===i?0:.5/(i-n),v=i===s?0:.5/(s-i),R):[e,r,t]},R.clamp=function(F){return arguments.length?(C=!!F,R):C},R.interpolator=function(F){return arguments.length?(g=F,R):g},R.unknown=function(F){return arguments.length?(T=F,R):T},function(F){return x=F,n=F(e),i=F(r),s=F(t),l=n===i?0:.5/(i-n),v=i===s?0:.5/(s-i),R}}function p4(){var e=fd(C0()(tl));return e.copy=function(){return vp(e,p4())},Ph.apply(e,arguments)}function d4(){var e=Zg(C0()).domain([.1,1,10]);return e.copy=function(){return vp(e,d4()).base(e.base())},Ph.apply(e,arguments)}function v4(){var e=Xg(C0());return e.copy=function(){return vp(e,v4()).constant(e.constant())},Ph.apply(e,arguments)}function S2(){var e=Yg(C0());return e.copy=function(){return vp(e,S2()).exponent(e.exponent())},Ph.apply(e,arguments)}function qB(){return S2.apply(null,arguments).exponent(.5)}var Of,C2,w2,A2,uy,T2,m4=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,g4=(Of={},w()(Of,mu.LINEAR,kE),w()(Of,mu.POWER,$g),w()(Of,mu.LOG,zE),w()(Of,mu.IDENTITY,LE),w()(Of,mu.TIME,a4),w()(Of,mu.QUANTILE,GE),w()(Of,mu.QUANTIZE,HE),w()(Of,mu.THRESHOLD,WE),w()(Of,mu.CAT,lm),Of),y4=(C2=Object(vr.injectable)(),w2=Object(vr.inject)(Yt.IGlobalConfigService),C2(A2=(uy=function(){function e(){dt()(this,e),Pi()(this,"configService",T2,this),w()(this,"scaleCache",{}),w()(this,"scaleOptions",{})}return yt()(e,[{key:"apply",value:function(t,n){var i=this,s=n.styleAttributeService;t.hooks.init.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes(),v=t.getSource().data.dataArray;v.length!==0&&i.caculateScalesForAttributes(l||[],v)}),t.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){i.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes(),v=t.getSource().data.dataArray;return i.caculateScalesForAttributes(l||[],v),t.layerModelNeedUpdate=!0,!0}),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var l=s.getLayerStyleAttributes();if(l){var v=t.getSource().data.dataArray;if(v.length===0)return;var g=l.filter(function(x){return x.needRescale});g.length&&i.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;this.scaleCache={},t.forEach(function(s){if(s.scale){var l=s.scale,v=s.name;l.names=i.parseFields(s.scale.field||[]);var g=[];l.names.forEach(function(x){g.push(i.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===sp.VARIABLE})?(l.type=sp.VARIABLE,g.forEach(function(x){if(!l.callback){var C;if(l.values&&l.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&l.values.length>2){var R=x.scale.ticks(l.values.length);v==="color"&&x.scale.domain(R)}x.scale.range(l.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(l.type=sp.CONSTANT,l.defaultValues=g.map(function(x,C){return x.scale(l.names[C])})),l.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(t,n,i){var s,l=[t,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(t,n.name,v,i);return g}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:Ws()(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,s){var l,v,g=this.scaleOptions[n]&&((l=this.scaleOptions[n])===null||l===void 0?void 0:l.field)===t?this.scaleOptions[n]:this.scaleOptions[t],x={field:t,scale:void 0,type:sp.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=lm([t]),x.type=sp.CONSTANT),x;var C=(v=s.find(function(F){return!wh()(F[t])}))===null||v===void 0?void 0:v[t];if(this.isNumber(t)||wh()(C)&&!g)x.scale=lm([t]),x.type=sp.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);i==="text"&&(T=mu.CAT);var R=this.createDefaultScaleConfig(T,t,s);Object.assign(R,g),x.scale=this.createDefaultScale(R),x.option=R}return x}},{key:"getDefaultType",value:function(t){var n=mu.LINEAR;return typeof t=="string"&&(n=m4.test(t)?mu.TIME:mu.CAT),n}},{key:"createDefaultScaleConfig",value:function(t,n,i){var s={type:t},l=(i==null?void 0:i.map(function(v){return v[n]}))||[];return t!==mu.CAT&&t!==mu.QUANTILE?s.domain=Jb(l):t===mu.CAT?s.domain=K_()(l):t===mu.QUANTILE&&(s.domain=l),s}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,s=g4[n]();return i&&s.domain(i),s}}]),e}(),T2=Mi()(uy.prototype,"configService",[w2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uy))||A2),M2,P2,O2,I2,w0,R2,k2;function L2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function _4(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?L2(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var x4=(M2=Object(vr.injectable)(),P2=Object(vr.inject)(Yt.ICameraService),O2=Object(vr.inject)(Yt.IRendererService),M2(I2=(w0=function(){function e(){dt()(this,e),Pi()(this,"cameraService",R2,this),Pi()(this,"rendererService",k2,this)}return yt()(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){t.models.forEach(function(n){n.addUniforms(_4({},t.layerModel.getAnimateUniforms()))})})}}]),e}(),R2=Mi()(w0.prototype,"cameraService",[P2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k2=Mi()(w0.prototype,"rendererService",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w0))||I2),D2,F2,b4=(D2=Object(vr.injectable)(),D2(F2=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t){t.hooks.init.tap("LayerModelPlugin",function(){t.prepareBuildModel(),t.buildModels(),t.styleNeedUpdate=!1}),t.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return t.prepareBuildModel(),t.clearModels(),t.buildModels(),t.layerModelNeedUpdate=!1,!1})}}]),e}())||F2),B2,N2,E4=(B2=Object(vr.injectable)(),B2(N2=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){t.updateLayerConfig({});var n=t.getLayerConfig(),i=n.autoFit,s=n.fitBoundsOptions;i&&setTimeout(function(){t.fitBounds(s)},100)})}}]),e}())||N2),z2,U2,S4=["type"];function j2(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ym(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?j2(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):j2(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var V2={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},C4={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},w4={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},A4={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},QB=["ambient","diffuse","specular"];function T4(e){var r={u_DirectionalLights:new Array(3).fill(ym({},w4)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(ym({},A4)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[C4]),e.forEach(function(t,n){var i=t.type,s=i===void 0?"directional":i,l=Ch()(t,S4),v=V2[s].lights,g=V2[s].num,x=r[g];r[v][x]=ym(ym({},r[v][x]),l),r[g]++}),r}var M4=(z2=Object(vr.injectable)(),z2(U2=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(s){return s.addUniforms(ym({},T4()))})})}}]),e}())||U2),G2,H2,A0={NONE:0,ENCODE:1,HIGHLIGHT:2},P4=(G2=Object(vr.injectable)(),G2(H2=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t,n){var i=n.rendererService,s=n.styleAttributeService;t.hooks.init.tap("PixelPickingPlugin",function(){var l=!0;s.registerStyleAttribute({name:"pickingColor",type:yi.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:oe.FLOAT},size:3,update:function(g,x){var C=g.id;return l?fc(C):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var l=t.getLayerConfig(),v=l.enablePicking;v&&t.isVisible()&&t.models.forEach(function(g){return g.addUniforms({u_PickingStage:A0.ENCODE})})}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var l=t.getLayerConfig(),v=l.enablePicking;v&&t.isVisible()&&t.models.forEach(function(g){return g.addUniforms({u_PickingStage:A0.HIGHLIGHT})})}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(l){var v=t.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?Ka(g):g||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(l))}),t.models.forEach(function(R){return R.addUniforms({u_PickingStage:A0.HIGHLIGHT,u_PickingColor:l,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C})})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(l){var v=t.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?Ka(g):g||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:Ou(new Uint8Array(l))}),t.models.forEach(function(R){return R.addUniforms({u_PickingStage:A0.HIGHLIGHT,u_PickingColor:l,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:l,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||H2),W2,Z2,O4=(W2=Object(vr.injectable)(),W2(Z2=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t,n){var i=this,s=n.styleAttributeService;t.hooks.init.tap("RegisterStyleAttributePlugin",function(){i.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(t){t.registerStyleAttribute({name:"position",type:yi.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:oe.FLOAT},size:3,update:function(i,s,l){return l.length===2?[l[0],l[1],0]:[l[0],l[1],l[2]]}}}),t.registerStyleAttribute({name:"filter",type:yi.Attribute,descriptor:{name:"filter",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(i,s){var l=i.filter;return l?[1]:[0]}}}),t.registerStyleAttribute({name:"color",type:yi.Attribute,descriptor:{name:"a_Color",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:4,update:function(i,s){var l=i.color;return!l||!l.length?[1,1,1,1]:l}}}),t.registerStyleAttribute({name:"vertexId",type:yi.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:oe.DYNAMIC_DRAW,data:[],type:oe.FLOAT},size:1,update:function(i,s,l,v){return[s]}}})}}]),e}())||Z2),X2,Y2,$2,K2,q2,Q2,cv,J2,eS,tS,rS,I4=(X2=Object(vr.injectable)(),Y2=Object(vr.inject)(Yt.ICameraService),$2=Object(vr.inject)(Yt.ICoordinateSystemService),K2=Object(vr.inject)(Yt.IRendererService),q2=Object(vr.inject)(Yt.IMapService),X2(Q2=(cv=function(){function e(){dt()(this,e),Pi()(this,"cameraService",J2,this),Pi()(this,"coordinateSystemService",eS,this),Pi()(this,"rendererService",tS,this),Pi()(this,"mapService",rS,this)}return yt()(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),i==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),l=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;t.models.forEach(function(C){var T;C.addUniforms((T={},w()(T,td.ProjectionMatrix,n.cameraService.getProjectionMatrix()),w()(T,td.ViewMatrix,n.cameraService.getViewMatrix()),w()(T,td.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),w()(T,td.Zoom,n.cameraService.getZoom()),w()(T,td.ZoomScale,n.cameraService.getZoomScale()),w()(T,td.FocalDistance,n.cameraService.getFocalDistance()),w()(T,td.CameraPosition,n.cameraService.getCameraPosition()),w()(T,ed.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),w()(T,ed.ViewportCenter,n.coordinateSystemService.getViewportCenter()),w()(T,ed.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),w()(T,ed.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),w()(T,ed.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),w()(T,ed.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),w()(T,ed.Mvp,s),w()(T,"u_SceneCenterMKT",l),w()(T,"u_ViewportSize",[g,x]),w()(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),w()(T,"u_DevicePixelRatio",Wn.devicePixelRatio),w()(T,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),w()(T,"u_shaderPick",Number(t.getShaderPickStat())),T))})})}}]),e}(),J2=Mi()(cv.prototype,"cameraService",[Y2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eS=Mi()(cv.prototype,"coordinateSystemService",[$2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tS=Mi()(cv.prototype,"rendererService",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rS=Mi()(cv.prototype,"mapService",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cv))||Q2),nS,iS,R4=(nS=Object(vr.injectable)(),nS(iS=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate()})}}]),e}())||iS),aS,oS,k4=(aS=Object(vr.injectable)(),aS(oS=function(){function e(){dt()(this,e)}return yt()(e,[{key:"apply",value:function(t,n){var i=this,s=n.styleAttributeService;t.hooks.init.tap("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:s})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||i.updateStyleAtrribute(t,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(t,n){var i=n.styleAttributeService,s=i.getLayerStyleAttributes()||[],l=i.getLayerStyleAttribute("filter"),v=i.getLayerStyleAttribute("shape");if(l&&l.needRegenerateVertices){t.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){i.updateAttributeByFeatureRange(g.name,t.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,s=i.getLayerStyleAttributes()||[];s.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex),l.needRegenerateVertices=!1})}}]),e}())||oS);mc.bind(Yt.ILayerPlugin).to(RI).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(O4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(y4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(II).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(E4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(k4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(R4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(HM).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(I4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(x4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(M4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(P4).inRequestScope(),mc.bind(Yt.ILayerPlugin).to(b4).inRequestScope();var JB="2.7.18",sS,ly,uS;function lS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function cS(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?lS(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var T0=(sS=Sg(Yt.IGlobalConfigService),ly=function(){function e(r){dt()(this,e),Pi()(this,"configService",uS,this),w()(this,"config",void 0),this.config=r}return yt()(e,[{key:"setContainer",value:function(t,n,i,s){t.bind(Yt.MapConfig).toConstantValue(cS(cS({},this.config),{},{id:n,canvas:i,hasBaseMap:s})),t.bind(Yt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),uS=Mi()(ly.prototype,"configService",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ly),L4=O("sXyB"),M0=O.n(L4),D4=O("hi0z"),fS=O.n(D4);function hS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function pS(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?hS(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function P0(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return pS(pS({},r),e)}var dS={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},vS=Math.PI/180,F4=function(){function e(){dt()(this,e),w()(this,"projectionMatrix",j.create()),w()(this,"viewMatrix",j.create()),w()(this,"viewProjectionMatrix",j.create()),w()(this,"ViewProjectionMatrixUncentered",j.create()),w()(this,"viewUncenteredMatrix",j.create()),w()(this,"zoom",void 0),w()(this,"center",void 0)}return yt()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,s=t.pitch,l=s===void 0?0:s,v=t.bearing,g=v===void 0?0:v,x=t.center,C=x===void 0?[0,0]:x,T=t.offsetOrigin,R=T===void 0?[0,0]:T,F=t.cameraHeight,H=F===void 0?1:F,Q=t.aspect,ie=Q===void 0?1:Q,be=t.near,je=be===void 0?.1:be,Je=t.far,et=Je===void 0?1e3:Je,bt=t.fov,Et=bt===void 0?0:bt;this.zoom=i,this.center=C;var kt=l*vS,jt=(360-g)*vS;j.perspective(this.projectionMatrix,Et,ie,je,et);var mr=U.fromValues(H*Math.sin(kt)*Math.sin(jt),-H*Math.sin(kt)*Math.cos(jt),H*Math.cos(kt)),Ar=U.fromValues(-Math.cos(kt)*Math.sin(jt),Math.cos(kt)*Math.cos(jt),Math.sin(kt));j.lookAt(this.viewMatrix,mr,U.fromValues(0,0,0),Ar),this.viewUncenteredMatrix=j.clone(this.viewMatrix),j.translate(this.viewMatrix,this.viewMatrix,U.fromValues(-R[0],R[1],0)),j.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),j.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=ft()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,s=Math.max(Math.min(i,t[1]),-i),l=256<<20,v=Math.PI/180,g=t[0]*v,x=s*v;x=Math.log(Math.tan(Math.PI/4+x/2));var C=.5/Math.PI,T=.5,R=-.5/Math.PI;return v=.5,g=l*(C*g+T)-215440491,x=-(l*(R*x+v)-106744817),[g,x]}}]),e}(),B4=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],mS,gS,yS,_S,xS,bS,fv,ES,SS,CS,wS;function AS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function N4(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?AS(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):AS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function z4(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}z4(`.amap-logo{
 display: none !important;
}
`);var U4=0;window.forceWebGL=!0;var TS="15cd8a57710d40c9b7c0e3cc120f1200",j4="1.4.15",V4="amap-script",cy=!1,O0=[],G4=12,H4=(mS=Object(vr.injectable)(),gS=Object(vr.inject)(Yt.IGlobalConfigService),yS=Object(vr.inject)(Yt.MapConfig),_S=Object(vr.inject)(Yt.ICoordinateSystemService),xS=Object(vr.inject)(Yt.IEventEmitter),mS(bS=(fv=function(){function e(){var r=this;dt()(this,e),w()(this,"version",ah["GAODE1.x"]),w()(this,"map",void 0),w()(this,"dragging",!1),w()(this,"bgColor","rgba(0, 0, 0, 0)"),Pi()(this,"configService",ES,this),Pi()(this,"config",SS,this),Pi()(this,"coordinateSystemService",CS,this),Pi()(this,"eventEmitter",wS,this),w()(this,"markerContainer",void 0),w()(this,"$mapContainer",void 0),w()(this,"viewport",void 0),w()(this,"cameraChangedCallback",void 0),w()(this,"handleCameraChanged",function(t){var n=t.camera,i=n.fov,s=n.near,l=n.far,v=n.height,g=n.pitch,x=n.rotation,C=n.aspect,T=n.position,R=r.getCenter(),F=R.lng,H=R.lat;if(r.emit("mapchange"),r.cameraChangedCallback){r.viewport.syncWithMapCamera({aspect:C,bearing:360-x,far:l,fov:i,cameraHeight:v,near:s,pitch:g,zoom:r.map.getZoom()-1,center:[F,H],offsetOrigin:[T.x,T.y]});var Q=r.config.offsetZoom,ie=Q===void 0?G4:Q;r.viewport.getZoom()>ie?r.coordinateSystemService.setCoordinateSystem(ml.P20_OFFSET):r.coordinateSystemService.setCoordinateSystem(ml.P20),r.cameraChangedCallback(r.viewport)}})}return yt()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=W.create("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),s=ft()(i,2),l=s[0],v=s[1],g=P0(t.padding),x=this.lngLatToPixel([n.lng,n.lat]),C=[(g.right-g.left)/2,(g.bottom-g.top)/2],T=this.pixelToLngLat([x.x-C[0],x.y-C[1]]);return T}var R=this.map.getCenter();return{lng:R.getLng(),lat:R.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=P0(n.padding),s=this.lngLatToPixel(t),l=[(i.right-i.left)/2,(i.bottom-i.top)/2],v=this.pixelToLngLat([s.x+l[0],s.y+l[1]]);this.map.setCenter([v.lng,v.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),i=t.getSouthWest(),s=this.getCenter(),l=s.lng>n.getLng()||s.lng<i.getLng()?180-n.getLng():n.getLng(),v=s.lng<i.getLng()?i.getLng()-180:i.getLng();return[[v,i.getLat()],[l,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),i=n.x,s=n.y;return[i,-s]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=this.viewport.projectFlat(t),g=j.create();return j.translate(g,g,U.fromValues(v[0],v[1],n)),j.scale(g,g,U.fromValues(s[0],s[1],s[2])),j.rotateX(g,g,i[0]),j.rotateY(g,g,i[1]),j.rotateZ(g,g,i[2]),g}},{key:"init",value:function(){var r=Ys()(Sa.a.mark(function n(){var i=this,s,l,v,g,x,C,T,R,F,H,Q,ie,be,je;return Sa.a.wrap(function(et){for(;;)switch(et.prev=et.next){case 0:return s=this.config,l=s.id,v=s.style,g=v===void 0?"light":v,x=s.minZoom,C=x===void 0?0:x,T=s.maxZoom,R=T===void 0?18:T,F=s.token,H=F===void 0?TS:F,Q=s.mapInstance,ie=s.plugin,be=ie===void 0?[]:ie,je=Ch()(s,B4),et.next=3,new Promise(function(bt){var Et=function(){if(Q)i.map=Q,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),bt()},30);else{i.$mapContainer=i.creatAmapContainer(l);var jt=N4({mapStyle:i.getMapStyle(g),zooms:[C,R],viewMode:"3D"},je);jt.zoom&&(jt.zoom+=1);var mr=new AMap.Map(i.$mapContainer,jt);mr.on("camerachange",i.handleCameraChanged),i.map=mr,setTimeout(function(){bt()},10)}};!cy&&!Q?(H===TS&&console.warn(i.configService.getSceneWarninfo("MapToken")),cy=!0,be.push("Map3D"),fS.a.load({key:H,version:j4,plugins:be}).then(function(kt){Et(),O0.length&&(O0.forEach(function(jt){return jt()}),O0=[])}).catch(function(kt){throw new Error(kt)})):cy&&window.AMap||Q?Et():O0.push(Et)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.viewport=new F4;case 6:case"end":return et.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(M0()(AMap.LngLat,Lr()(t)),M0()(AMap.LngLat,Lr()(n))),s=this.lngLatToCoord(t),l=ft()(s,2),v=l[0],g=l[1],x=this.lngLatToCoord(n),C=ft()(x,2),T=C[0],R=C[1],F=Math.sqrt(Math.pow(v-T,2)+Math.pow(g-R,2));return F/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],s=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return s}},{key:"emit",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).emit.apply(n,[t].concat(s))}},{key:"once",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).once.apply(n,[t].concat(s))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(V4);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"getMapStyle",value:function(t){return dS[t]?dS[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+U4++,n.appendChild(i),i}}]),e}(),ES=Mi()(fv.prototype,"configService",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SS=Mi()(fv.prototype,"config",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CS=Mi()(fv.prototype,"coordinateSystemService",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wS=Mi()(fv.prototype,"eventEmitter",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fv))||bS);function W4(e){var r=Z4();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function Z4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X4=function(e){bn()(t,e);var r=W4(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getServiceConstructor",value:function(){return H4}}]),t}(T0);function MS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function PS(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?MS(Object(t),!0).forEach(function(n){Y4(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):MS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Y4(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function $4(e,r){return J4(e)||Q4(e,r)||q4(e,r)||K4()}function K4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function q4(e,r){if(!!e){if(typeof e=="string")return OS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OS(e,r)}}function OS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Q4(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function J4(e){if(Array.isArray(e))return e}var ek=Re.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,s=e.onSceneLoaded,l=e.children,v=Object(N.useRef)(null),g=Object(N.useState)(),x=$4(g,2),C=x[0],T=x[1];return Object(N.useEffect)(function(){var R=new im(PS(PS({id:v.current},i),{},{map:new X4(n)}));return R.on("loaded",function(){T(R),s&&s(R)}),function(){R.destroy()}},[]),Object(N.useEffect)(function(){C&&n.style&&C.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(N.useEffect)(function(){C&&n.zoom&&C.setZoom(n.zoom)},[n.zoom]),Object(N.useEffect)(function(){C&&n.center&&C.setCenter(n.center)},[JSON.stringify(n.center)]),Object(N.useEffect)(function(){C&&n.pitch&&C.setPitch(n.pitch)},[n.pitch]),Object(N.useEffect)(function(){C&&n.rotation&&C.setRotation(n.rotation)},[n.rotation]),Re.a.createElement(ii.Provider,{value:C},Re.a.createElement("div",{ref:v,className:t,style:r},C&&l))}),e8=ek,tk=O("4ZJM"),_m=O.n(tk),IS=O("1OyB"),RS=O("vuIU"),rk=O("md7G"),nk=O("foSv"),ik=O("Ji7U"),I0=O("JX7q"),Ql=O("ODXe");function xm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function R0(e,r){var t=Sh([],r,e);return tp(t,t,1/t[3]),t}function t8(e,r){var t=e%r;return t<0?r+t:t}function r8(e,r,t){return t*r+(1-t)*e}function mp(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var If=Math.PI,kS=If/4,Oh=If/180,LS=180/If,fy=512,hy=4003e4,ak=1.5;function DS(e){return Math.pow(2,e)}function ok(e){return Math.log2(e)}function k0(e,r){var t=Object(Ql.a)(e,2),n=t[0],i=t[1];mp(Number.isFinite(n)&&Number.isFinite(r)),mp(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=fy;var s=n*Oh,l=i*Oh,v=r*(s+If)/(2*If),g=r*(If-Math.log(Math.tan(kS+l*.5)))/(2*If);return[v,g]}function py(e,r){var t=Object(Ql.a)(e,2),n=t[0],i=t[1];r*=fy;var s=n/r*(2*If)-If,l=2*(Math.atan(Math.exp(If-i/r*(2*If)))-kS);return[s*LS,l*LS]}function n8(e){var r=e.latitude;mp(Number.isFinite(r));var t=Math.cos(r*Oh);return ok(hy*t)-9}function FS(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,s=e.highPrecision,l=s===void 0?!1:s;i=i!==void 0?i:DS(n),mp(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var v={},g=fy*i,x=Math.cos(r*Oh),C=g/360,T=C/x,R=g/hy/x;if(v.pixelsPerMeter=[R,-R,R],v.metersPerPixel=[1/R,-1/R,1/R],v.pixelsPerDegree=[C,-T,R],v.degreesPerPixel=[1/C,-1/T,1/R],l){var F=Oh*Math.tan(r*Oh)/x,H=C*F/2,Q=g/hy*F,ie=Q/T*R;v.pixelsPerDegree2=[0,-H,Q],v.pixelsPerMeter2=[ie,0,ie]}return v}function i8(e,r){var t=Object(Ql.a)(e,3),n=t[0],i=t[1],s=t[2],l=Object(Ql.a)(r,3),v=l[0],g=l[1],x=l[2],C=1,T=FS({longitude:n,latitude:i,scale:C,highPrecision:!0}),R=T.pixelsPerMeter,F=T.pixelsPerMeter2,H=k0(e,C);H[0]+=v*(R[0]+F[0]*g),H[1]+=g*(R[1]+F[1]*g);var Q=py(H,C),ie=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[Q[0],Q[1],ie]:Q}function sk(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,s=e.center,l=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=xm();return Po(x,x,[0,0,-i]),Xs(x,x,[1,1,1/r]),Fa(x,x,-t*Oh),hl(x,x,n*Oh),g&&Xs(x,x,[1,-1,1]),l&&Po(x,x,Vp([],l)),x}function uk(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?ak:n,s=e.pitch,l=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=l*Oh,R=Math.atan(.5/i),F=Math.sin(R)*i/Math.sin(Math.PI/2-T-R),H=Math.cos(Math.PI/2-T)*F+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:g,far:H*C}}function lk(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,s=e.nearZMultiplier,l=e.farZMultiplier,v=uk({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:s,farZMultiplier:l}),g=v.fov,x=v.aspect,C=v.near,T=v.far,R=Tv([],g,x,C,T);return R}function ck(e,r){var t=Object(Ql.a)(e,3),n=t[0],i=t[1],s=t[2],l=s===void 0?0:s;return mp(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(l)),R0(r,[n,i,l,1])}function BS(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Object(Ql.a)(e,3),i=n[0],s=n[1],l=n[2];if(mp(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(l)){var v=R0(r,[i,s,l,1]);return v}var g=R0(r,[i,s,0,1]),x=R0(r,[i,s,1,1]),C=g[2],T=x[2],R=C===T?0:((t||0)-C)/(T-C);return qa([],g,x,R)}var NS=xm(),fk=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,s=i===void 0?NS:i,l=r.projectionMatrix,v=l===void 0?NS:l;Object(IS.a)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=xm();pa(g,g,this.projectionMatrix),pa(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=xm();Xs(x,x,[this.width/2,-this.height/2,1]),Po(x,x,[1,-1,0]),pa(x,x,this.viewProjectionMatrix);var C=Vn(xm(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(RS.a)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&B(t.projectionMatrix,this.projectionMatrix)&&B(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,s=i===void 0?!0:i,l=this.projectPosition(t),v=ck(l,this.pixelProjectionMatrix),g=Object(Ql.a)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return t.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,s=i===void 0?!0:i,l=n.targetZ,v=Object(Ql.a)(t,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,R=l&&l*this.pixelsPerMeter,F=BS([g,T,C],this.pixelUnprojectionMatrix,R),H=this.unprojectPosition(F),Q=Object(Ql.a)(H,3),ie=Q[0],be=Q[1],je=Q[2];return Number.isFinite(C)?[ie,be,je]:Number.isFinite(l)?[ie,be,l]:[ie,be]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=Object(Ql.a)(n,2),s=i[0],l=i[1],v=(t[2]||0)*this.pixelsPerMeter;return[s,l,v]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=Object(Ql.a)(n,2),s=i[0],l=i[1],v=(t[2]||0)/this.pixelsPerMeter;return[s,l,v]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function hk(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,s=i===void 0?0:i,l=e.maxZoom,v=l===void 0?24:l,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,R=Object(Ql.a)(n,2),F=Object(Ql.a)(R[0],2),H=F[0],Q=F[1],ie=Object(Ql.a)(R[1],2),be=ie[0],je=ie[1];if(Number.isFinite(x)){var Je=x;x={top:Je,bottom:Je,left:Je,right:Je}}else mp(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var et=new dy({width:r,height:t,longitude:0,latitude:0,zoom:0}),bt=et.project([H,je]),Et=et.project([be,Q]),kt=[Math.max(Math.abs(Et[0]-bt[0]),s),Math.max(Math.abs(Et[1]-bt[1]),s)],jt=[r-x.left-x.right-Math.abs(T[0])*2,t-x.top-x.bottom-Math.abs(T[1])*2];mp(jt[0]>0&&jt[1]>0);var mr=jt[0]/kt[0],Ar=jt[1]/kt[1],pr=(x.right-x.left)/2/mr,pn=(x.bottom-x.top)/2/Ar,Tn=[(Et[0]+bt[0])/2+pr,(Et[1]+bt[1])/2+pn],Jn=et.unproject(Tn),va=et.zoom+Math.log2(Math.abs(Math.min(mr,Ar)));return{longitude:Jn[0],latitude:Jn[1],zoom:Math.min(va,v)}}var dy=function(e){Object(ik.a)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,s=n.height,l=n.latitude,v=l===void 0?0:l,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,R=n.pitch,F=R===void 0?0:R,H=n.bearing,Q=H===void 0?0:H,ie=n.altitude,be=ie===void 0?1.5:ie,je=n.nearZMultiplier,Je=n.farZMultiplier;Object(IS.a)(this,r),i=i||1,s=s||1;var et=DS(T);be=Math.max(.75,be);var bt=k0([x,v],et);bt[2]=0;var Et=lk({width:i,height:s,pitch:F,bearing:Q,altitude:be,nearZMultiplier:je||1/s,farZMultiplier:Je||1.01}),kt=sk({height:s,center:bt,pitch:F,bearing:Q,altitude:be,flipY:!0});return t=Object(rk.a)(this,Object(nk.a)(r).call(this,{width:i,height:s,viewMatrix:kt,projectionMatrix:Et})),t.latitude=v,t.longitude=x,t.zoom=T,t.pitch=F,t.bearing=Q,t.altitude=be,t.scale=et,t.center=bt,t.pixelsPerMeter=FS(Object(I0.a)(Object(I0.a)(t))).pixelsPerMeter[2],Object.freeze(Object(I0.a)(Object(I0.a)(t))),t}return Object(RS.a)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return k0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return py(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,s=n.pos,l=BS(s,this.pixelUnprojectionMatrix),v=k0(i,this.scale),g=Xe([],v,ea([],l)),x=Xe([],this.center,g);return py(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:s})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,l=this.height,v=hk(Object.assign({width:s,height:l,bounds:n},i)),g=v.longitude,x=v.latitude,C=v.zoom;return new r({width:s,height:l,longitude:g,latitude:x,zoom:C})}}]),r}(fk),pk=function(){function e(){dt()(this,e),w()(this,"viewport",void 0)}return yt()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,s=t.pitch,l=t.bearing,v=t.viewportHeight,g=t.viewportWidth;this.viewport=new dy({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:s,bearing:l})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),zS={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},dk=["id","attributionControl","style","token","rotation","mapInstance"],US,jS,VS,GS,HS,WS,hv,ZS,XS,YS,$S;function KS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function vk(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?KS(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):KS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mk(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}mk(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=_m.a;var qS={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},gk=0,yk=12,QS="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",_k=(US=Object(vr.injectable)(),jS=Object(vr.inject)(Yt.MapConfig),VS=Object(vr.inject)(Yt.IGlobalConfigService),GS=Object(vr.inject)(Yt.ICoordinateSystemService),HS=Object(vr.inject)(Yt.IEventEmitter),US(WS=(hv=function(){function e(){var r=this;dt()(this,e),w()(this,"version",ah.MAPBOX),w()(this,"map",void 0),w()(this,"dragging",!1),w()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Pi()(this,"config",ZS,this),Pi()(this,"configService",XS,this),Pi()(this,"coordinateSystemService",YS,this),Pi()(this,"eventEmitter",$S,this),w()(this,"viewport",void 0),w()(this,"markerContainer",void 0),w()(this,"cameraChangedCallback",void 0),w()(this,"$mapContainer",void 0),w()(this,"handleCameraChanged",function(){var t=r.map.getCenter().wrap(),n=t.lat,i=t.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0});var s=r.config.offsetZoom,l=s===void 0?yk:s;r.viewport.getZoom()>l?r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT),r.cameraChangedCallback(r.viewport)})}return yt()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=W.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(qS[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(qS[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},i=this.lngLatToMercator(t,0),s=i.x,l=i.y;return[s-n.x,l-n.y]}},{key:"lngLatToMercator",value:function(t,n){var i=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),s=i.x,l=s===void 0?0:s,v=i.y,g=v===void 0?0:v,x=i.z,C=x===void 0?0:x;return{x:l,y:g,z:C}}},{key:"getModelMatrix",value:function(t,n,i){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),g=v.meterInMercatorCoordinateUnits(),x=j.create();return j.translate(x,x,U.fromValues(v.x-l.x,v.y-l.y,v.z||0-l.z)),j.scale(x,x,U.fromValues(g*s[0],-g*s[1],g*s[2])),j.rotateX(x,x,i[0]),j.rotateY(x,x,i[1]),j.rotateZ(x,x,i[2]),x}},{key:"init",value:function(){var r=Ys()(Sa.a.mark(function n(){var i=this,s,l,v,g,x,C,T,R,F,H,Q,ie,be;return Sa.a.wrap(function(Je){for(;;)switch(Je.prev=Je.next){case 0:s=this.config,l=s.id,v=l===void 0?"map":l,g=s.attributionControl,x=g===void 0?!1:g,C=s.style,T=C===void 0?"light":C,R=s.token,F=R===void 0?QS:R,H=s.rotation,Q=H===void 0?0:H,ie=s.mapInstance,be=Ch()(s,dk),this.viewport=new pk,!ie&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),F===QS&&T!=="blank"&&!window.mapboxgl.accessToken&&!ie&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ie&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=F),ie?(this.map=ie,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(v),this.map=new window.mapboxgl.Map(vk({container:this.$mapContainer,style:this.getMapStyle(T),attributionControl:x,bearing:Q},be))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return Je.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).emit.apply(n,[t].concat(s))}},{key:"once",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).once.apply(n,[t].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var i=new _m.a.LngLat(t[0],t[1]),s=new _m.a.LngLat(n[0],n[1]),l=i.distanceTo(s),v=_m.a.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),g=_m.a.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,R=g.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-R,2))*4194304*2;return F/l}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+gk++,n.appendChild(i),i}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:zS[t]?zS[t]:t}}]),e}(),ZS=Mi()(hv.prototype,"config",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XS=Mi()(hv.prototype,"configService",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YS=Mi()(hv.prototype,"coordinateSystemService",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$S=Mi()(hv.prototype,"eventEmitter",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv))||WS);function xk(e){var r=bk();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function bk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ek(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}Ek(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Sk=function(e){bn()(t,e);var r=xk(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getServiceConstructor",value:function(){return _k}}]),t}(T0);function JS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function eC(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?JS(Object(t),!0).forEach(function(n){Ck(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):JS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ck(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function wk(e,r){return Pk(e)||Mk(e,r)||Tk(e,r)||Ak()}function Ak(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tk(e,r){if(!!e){if(typeof e=="string")return tC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tC(e,r)}}function tC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Mk(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function Pk(e){if(Array.isArray(e))return e}var Ok=Re.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,s=e.onSceneLoaded,l=Object(N.createRef)(),v=Object(N.useState)(),g=wk(v,2),x=g[0],C=g[1];return Object(N.useEffect)(function(){var T=new im(eC(eC({id:l.current},i),{},{map:new Sk(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),Object(N.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(N.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),Object(N.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),Object(N.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),Object(N.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),Re.a.createElement(ii.Provider,{value:x},Object(N.createElement)("div",{ref:l,style:r,className:t},x&&e.children))}),Ik=Ok,rC={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},Rk=function(){function e(){dt()(this,e),w()(this,"projectionMatrix",j.create()),w()(this,"viewMatrix",j.create()),w()(this,"viewProjectionMatrix",j.create()),w()(this,"ViewProjectionMatrixUncentered",j.create()),w()(this,"viewUncenteredMatrix",j.create()),w()(this,"zoom",void 0),w()(this,"center",void 0)}return yt()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,s=t.center,l=s===void 0?[0,0]:s,v=t.offsetOrigin,g=v===void 0?[0,0]:v,x=t.cameraPosition,C=x===void 0?[0,0,0]:x,T=t.up,R=T===void 0?[0,1,0]:T,F=t.lookAt,H=F===void 0?[0,0,0]:F,Q=t.aspect,ie=Q===void 0?1:Q,be=t.near,je=be===void 0?.1:be,Je=t.far,et=Je===void 0?1e3:Je,bt=t.fov,Et=bt===void 0?45:bt;this.zoom=i,this.center=l,j.perspective(this.projectionMatrix,Et/180*Math.PI,ie,je,et);var kt=U.fromValues.apply(U,Lr()(C)),jt=U.fromValues.apply(U,Lr()(H)),mr=U.fromValues.apply(U,Lr()(R));j.lookAt(this.viewMatrix,kt,jt,mr),this.viewUncenteredMatrix=j.clone(this.viewMatrix),j.translate(this.viewMatrix,this.viewMatrix,U.fromValues(-g[0],g[1],0)),j.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),j.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=ft()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,s=Math.max(Math.min(i,t[1]),-i),l=256<<20,v=Math.PI/180,g=t[0]*v,x=s*v;x=Math.log(Math.tan(Math.PI/4+x/2));var C=.5/Math.PI,T=.5,R=-.5/Math.PI;return v=.5,g=l*(C*g+T)-215440491,x=-(l*(R*x+v)-106744817),[g,x]}}]),e}(),kk=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],nC,iC,aC,oC,sC,uC,pv,lC,cC,fC,hC;function pC(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Lk(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?pC(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pC(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Dk(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}Dk(`.amap-logo{
 display: none !important;
}
`);var Fk=0;window.forceWebGL=!0;var dC="ff533602d57df6f8ab3b0fea226ae52f",Bk="2.0",Nk="amap-script",vy=!1,L0=[],zk=(nC=Object(vr.injectable)(),iC=Object(vr.inject)(Yt.IGlobalConfigService),aC=Object(vr.inject)(Yt.MapConfig),oC=Object(vr.inject)(Yt.ICoordinateSystemService),sC=Object(vr.inject)(Yt.IEventEmitter),nC(uC=(pv=function(){function e(){var r=this;dt()(this,e),w()(this,"version",ah["GAODE2.x"]),w()(this,"map",void 0),w()(this,"dragging",!1),w()(this,"sceneCenter",void 0),w()(this,"sceneCenterMKT",void 0),w()(this,"bgColor","rgba(0, 0, 0, 0)"),Pi()(this,"configService",lC,this),Pi()(this,"config",cC,this),Pi()(this,"coordinateSystemService",fC,this),Pi()(this,"eventEmitter",hC,this),w()(this,"markerContainer",void 0),w()(this,"$mapContainer",void 0),w()(this,"viewport",void 0),w()(this,"cameraChangedCallback",void 0),w()(this,"handleViewChanged",function(t){var n=r.map.customCoords.getCameraParams(),i=n.fov,s=n.near,l=n.far,v=n.aspect,g=n.position,x=n.lookAt,C=n.up;r.emit("mapchange");var T=t.zoom,R=r.map.customCoords.getCenter();r.cameraChangedCallback&&(r.viewport.syncWithMapCamera({aspect:v,far:l,fov:i,cameraPosition:g,lookAt:x,up:C,near:s,zoom:T-1,center:R,offsetOrigin:[g[0],g[1]]}),r.coordinateSystemService.setCoordinateSystem(ml.P20_2),r.cameraChangedCallback(r.viewport))})}return yt()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setCustomCoordCenter",value:function(t){var n;this.sceneCenter=t,this.sceneCenterMKT=(n=this.map.getProjection()).project.apply(n,Lr()(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(t){var n=this.map.getProjection(),i=n.project;return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(i(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var n=this;return t.map(function(i){return typeof i[0]=="number"?n.lngLatToCoord(i):i.map(function(s){return n.lngLatToCoord(s)})})}},{key:"addMarkerContainer",value:function(){if(!!this.map){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];n.style.zIndex="auto",this.markerContainer=W.create("div","l7-marker-container2",n)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),s=ft()(i,2),l=s[0],v=s[1],g=P0(t.padding),x=this.lngLatToPixel([n.lng,n.lat]),C=[(g.right-g.left)/2,(g.bottom-g.top)/2],T=this.pixelToLngLat([x.x-C[0],x.y-C[1]]);return T}var R=this.map.getCenter();return{lng:R.getLng(),lat:R.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=P0(n.padding),s=this.lngLatToPixel(t),l=[(i.right-i.left)/2,(i.bottom-i.top)/2],v=this.pixelToLngLat([s.x+l[0],s.y+l[1]]);this.map.setCenter([v.lng,v.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),n=t.getNorthEast(),i=t.getSouthWest(),s=this.getCenter(),l=s.lng>n.getLng()||s.lng<i.getLng()?180-n.getLng():n.getLng(),v=s.lng<i.getLng()?i.getLng()-180:i.getLng();return[[v,i.getLat()],[l,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.getZooms();return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.getZooms();return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=this.map.customCoords.lngLatToCoord(t),g=j.create();return j.translate(g,g,U.fromValues(v[0],v[1],n)),j.scale(g,g,U.fromValues(s[0],s[1],s[2])),j.rotateX(g,g,i[0]),j.rotateY(g,g,i[1]),j.rotateZ(g,g,i[2]),g}},{key:"init",value:function(){var r=Ys()(Sa.a.mark(function n(){var i=this,s,l,v,g,x,C,T,R,F,H,Q,ie,be,je,Je,et;return Sa.a.wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return s=this.config,l=s.id,v=s.style,g=v===void 0?"light":v,x=s.minZoom,C=x===void 0?0:x,T=s.maxZoom,R=T===void 0?18:T,F=s.token,H=F===void 0?dC:F,Q=s.mapInstance,ie=s.plugin,be=ie===void 0?[]:ie,je=s.version,Je=je===void 0?Bk:je,et=Ch()(s,kk),Et.next=3,new Promise(function(kt){var jt=function(){if(Q){var Ar;i.map=Q,i.$mapContainer=i.map.getContainer();var pr=i.map.getCenter();(Ar=i.map.customCoords)===null||Ar===void 0||Ar.setCenter([pr.lng,pr.lat]),i.setCustomCoordCenter([pr.lng,pr.lat]),setTimeout(function(){i.map.on("viewchange",i.handleViewChanged),kt()},30)}else{i.$mapContainer=i.creatAmapContainer(l);var pn=Lk({mapStyle:i.getMapStyle(g),zooms:[C,R],viewMode:"3D"},et);pn.zoom&&(pn.zoom+=1);var Tn=new AMap.Map(i.$mapContainer,pn);i.map=Tn;var Jn=Tn.getCenter();Tn.customCoords.setCenter([Jn.lng,Jn.lat]),i.setCustomCoordCenter([Jn.lng,Jn.lat]),Tn.on("viewchange",i.handleViewChanged),setTimeout(function(){kt()},10)}};i.viewport=new Rk,!vy&&!Q?(H===dC&&console.warn(i.configService.getSceneWarninfo("MapToken")),vy=!0,be.push("Map3D"),fS.a.load({key:H,version:Je,plugins:be}).then(function(mr){jt(),L0.length&&(L0.forEach(function(Ar){return Ar()}),L0=[])}).catch(function(mr){throw new Error(mr)})):vy&&window.AMap||Q?jt():L0.push(jt)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""});case 5:case"end":return Et.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(M0()(AMap.LngLat,Lr()(t)),M0()(AMap.LngLat,Lr()(n))),s=this.lngLatToCoord(t),l=ft()(s,2),v=l[0],g=l[1],x=this.lngLatToCoord(n),C=ft()(x,2),T=C[0],R=C[1],F=Math.sqrt(Math.pow(v-T,2)+Math.pow(g-R,2));return F/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],s=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return s}},{key:"emit",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).emit.apply(n,[t].concat(s))}},{key:"once",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).once.apply(n,[t].concat(s))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(Nk);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,n=(t=this.map.customCoords)===null||t===void 0?void 0:t.getCameraParams(),i=n.fov,s=n.near,l=n.far,v=n.aspect,g=n.position,x=n.lookAt,C=n.up;this.emit("mapchange");var T=this.map.customCoords.getCenter(),R=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:v,far:l,fov:i,cameraPosition:g,lookAt:x,near:s,up:C,zoom:R-1,center:T,offsetOrigin:[g[0],g[1]]}),this.coordinateSystemService.setCoordinateSystem(ml.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,n){var i=[0,0];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i}},{key:"getMapStyle",value:function(t){return rC[t]?rC[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+Fk++,n.appendChild(i),i}}]),e}(),lC=Mi()(pv.prototype,"configService",[iC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=Mi()(pv.prototype,"config",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fC=Mi()(pv.prototype,"coordinateSystemService",[oC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hC=Mi()(pv.prototype,"eventEmitter",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv))||uC);function Uk(e){var r=jk();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function jk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vk=function(e){bn()(t,e);var r=Uk(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getServiceConstructor",value:function(){return zk}}]),t}(T0);function vC(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mC(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?vC(Object(t),!0).forEach(function(n){Gk(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):vC(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Gk(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function Hk(e,r){return Yk(e)||Xk(e,r)||Zk(e,r)||Wk()}function Wk(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zk(e,r){if(!!e){if(typeof e=="string")return gC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gC(e,r)}}function gC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Xk(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function Yk(e){if(Array.isArray(e))return e}var $k=Re.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,s=e.onSceneLoaded,l=e.children,v=Object(N.useRef)(null),g=Object(N.useState)(),x=Hk(g,2),C=x[0],T=x[1];return Object(N.useEffect)(function(){var R=new im(mC(mC({id:v.current},i),{},{map:new Vk(n)}));return R.on("loaded",function(){T(R),s&&s(R)}),function(){R.destroy()}},[]),Object(N.useEffect)(function(){C&&n.style&&C.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(N.useEffect)(function(){C&&n.zoom&&C.setZoom(n.zoom)},[n.zoom]),Object(N.useEffect)(function(){C&&n.center&&C.setCenter(n.center)},[JSON.stringify(n.center)]),Object(N.useEffect)(function(){C&&n.pitch&&C.setPitch(n.pitch)},[n.pitch]),Object(N.useEffect)(function(){C&&n.rotation&&C.setRotation(n.rotation)},[n.rotation]),Re.a.createElement(ii.Provider,{value:C},Re.a.createElement("div",{ref:v,className:t,style:r},C&&l))}),a8=$k,Kk=O("zvhG"),qk=O.n(Kk);function Qk(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Jk(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function Jk(e,r){if(!!e){if(typeof e=="string")return yC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return yC(e,r)}}function yC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var gy;function yy(e,r,t){var n=t-r,i=((e-r)%n+n)%n+r;return i===r?t:i}function Ih(e,r,t){return Math.min(t,Math.max(r,e))}function Xc(e,r,t){return e*(1-t)+r*t}function _y(e,r,t,n){var i=new qk.a(e,r,t,n);return function(s){return i.solve(s)}}var xy=_y(.25,.1,.25,1);function _C(){return _a||!Wn.matchMedia?!1:(gy==null&&(gy=Wn.matchMedia("(prefers-reduced-motion: reduce)")),gy.matches)}function eL(e,r){var t={},n=Qk(r),i;try{for(n.s();!(i=n.n()).done;){var s=i.value;s in e&&(t[s]=e[s])}}catch(l){n.e(l)}finally{n.f()}return t}var gp=_a?Date.now.bind(Date):Wn.performance&&Wn.performance.now?Wn.performance.now.bind(Wn.performance):Date.now.bind(Date),tL=Wn.requestAnimationFrame||Wn.mozRequestAnimationFrame||Wn.webkitRequestAnimationFrame||Wn.msRequestAnimationFrame,rL=Wn.cancelAnimationFrame||Wn.mozCancelAnimationFrame||Wn.webkitCancelAnimationFrame||Wn.msCancelAnimationFrame;function D0(e){var r=tL(e);return{cancel:function(){return rL(r)}}}var xC=63710088e-1,Uo=function(){function e(r,t){if(dt()(this,e),w()(this,"lng",void 0),w()(this,"lat",void 0),isNaN(r)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(r,", ").concat(t,")"));if(this.lng=+r,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return yt()(e,[{key:"wrap",value:function(){return new e(yy(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var n=Math.PI/180,i=this.lat*n,s=t.lat*n,l=Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos((t.lng-this.lng)*n),v=xC*Math.acos(Math.min(l,1));return v}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&lh()(t)==="object"&&t!==null){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),bm=function(){function e(r,t){dt()(this,e),w()(this,"ne",void 0),w()(this,"sw",void 0),r&&(t?this.setSouthWest(r).setNorthEast(t):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}return yt()(e,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof Uo?new Uo(t.lng,t.lat):Uo.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof Uo?new Uo(t.lng,t.lat):Uo.convert(t),this}},{key:"extend",value:function(t){var n=this.sw,i=this.ne,s,l;if(t instanceof Uo)s=t,l=t;else if(t instanceof e){if(s=t.sw,l=t.ne,!s||!l)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){var v=t;return this.extend(e.convert(v))}else{var g=t;return this.extend(Uo.convert(g))}return this}return!n&&!i?(this.sw=new Uo(s.lng,s.lat),this.ne=new Uo(l.lng,l.lat)):(n.lng=Math.min(s.lng,n.lng),n.lat=Math.min(s.lat,n.lat),i.lng=Math.max(l.lng,i.lng),i.lat=Math.max(l.lat,i.lat)),this}},{key:"getCenter",value:function(){return new Uo((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new Uo(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Uo(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var n=Uo.convert(t),i=n.lng,s=n.lat,l=this.sw.lat<=s&&s<=this.ne.lat,v=this.sw.lng<=i&&i<=this.ne.lng;return this.sw.lng>this.ne.lng&&(v=this.sw.lng>=i&&i>=this.ne.lng),l&&v}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Oa=function(){function e(r,t){dt()(this,e),w()(this,"x",void 0),w()(this,"y",void 0),this.x=r,this.y=t}return yt()(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var n=Math.cos(t),i=Math.sin(t),s=n*this.x-i*this.y,l=i*this.x+n*this.y;return this.x=s,this.y=l,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,n){var i=Math.cos(t),s=Math.sin(t),l=n.x+i*(this.x-n.x)-s*(this.y-n.y),v=n.y+s*(this.x-n.x)+i*(this.y-n.y);return this.x=l,this.y=v,this}},{key:"roateAround",value:function(t,n){return this.clone()._rotateAround(t,n)}},{key:"_matMult",value:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),nL=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(dt()(this,e),w()(this,"top",void 0),w()(this,"bottom",void 0),w()(this,"left",void 0),w()(this,"right",void 0),isNaN(r)||r<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=t,this.left=n,this.right=i}return yt()(e,[{key:"interpolate",value:function(t,n,i){return n.top!=null&&t.top!=null&&(this.top=Xc(t.top,n.top,i)),n.bottom!=null&&t.bottom!=null&&(this.bottom=Xc(t.bottom,n.bottom,i)),n.left!=null&&t.left!=null&&(this.left=Xc(t.left,n.left,i)),n.right!=null&&t.right!=null&&(this.right=Xc(t.right,n.right,i)),this}},{key:"getCenter",value:function(t,n){var i=Ih((this.left+t-this.right)/2,0,t),s=Ih((this.top+n-this.bottom)/2,0,n);return new Oa(i,s)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),bC=2*Math.PI*xC;function EC(e){return bC*Math.cos(e*Math.PI/180)}function F0(e){return(180+e)/360}function B0(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function SC(e,r){return e/EC(r)}function iL(e){return e*360-180}function by(e){var r=180-e*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}function aL(e,r){return e*EC(by(r))}function oL(e){return 1/Math.cos(e*Math.PI/180)}var N0=function(){function e(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;dt()(this,e),w()(this,"x",void 0),w()(this,"y",void 0),w()(this,"z",void 0),this.x=+r,this.y=+t,this.z=+n}return yt()(e,[{key:"toLngLat",value:function(){return new Uo(iL(this.x),by(this.y))}},{key:"toAltitude",value:function(){return aL(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/bC*oL(by(this.y))}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=Uo.convert(t);return new e(F0(i.lng),B0(i.lat),SC(n,i.lat))}}]),e}();function sL(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=uL(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function uL(e,r){if(!!e){if(typeof e=="string")return CC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return CC(e,r)}}function CC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var o8=8192,lL=function(){function e(r,t,n,i,s){dt()(this,e),w()(this,"tileSize",void 0),w()(this,"tileZoom",void 0),w()(this,"lngRange",void 0),w()(this,"latRange",void 0),w()(this,"maxValidLatitude",void 0),w()(this,"scale",void 0),w()(this,"width",void 0),w()(this,"height",void 0),w()(this,"angle",void 0),w()(this,"rotationMatrix",void 0),w()(this,"pixelsToGLUnits",void 0),w()(this,"cameraToCenterDistance",void 0),w()(this,"mercatorMatrix",void 0),w()(this,"projMatrix",void 0),w()(this,"invProjMatrix",void 0),w()(this,"alignedProjMatrix",void 0),w()(this,"pixelMatrix",void 0),w()(this,"pixelMatrixInverse",void 0),w()(this,"glCoordMatrix",void 0),w()(this,"labelPlaneMatrix",void 0),w()(this,"_fov",void 0),w()(this,"_pitch",void 0),w()(this,"_zoom",void 0),w()(this,"_renderWorldCopies",void 0),w()(this,"_minZoom",void 0),w()(this,"_maxZoom",void 0),w()(this,"_minPitch",void 0),w()(this,"_maxPitch",void 0),w()(this,"_center",void 0),w()(this,"zoomFraction",void 0),w()(this,"unmodified",void 0),w()(this,"edgeInsets",void 0),w()(this,"constraining",void 0),w()(this,"posMatrixCache",void 0),w()(this,"alignedPosMatrixCache",void 0),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=s===void 0?!0:s,this._minZoom=r||0,this._maxZoom=t||22,this._minPitch=n==null?0:n,this._maxPitch=i==null?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Uo(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new nL,this.posMatrixCache={},this.alignedPosMatrixCache={}}return yt()(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Oa(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var n=-yy(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=ne.create(),ne.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var n=Ih(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==n&&(this.unmodified=!1,this._pitch=n,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var n=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==n&&(this.unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,n,i){this.unmodified=!1,this.edgeInsets.interpolate(t,n,i),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}},{key:"resize",value:function(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var n=Ih(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Oa(F0(t.lng)*this.worldSize,B0(n)*this.worldSize)}},{key:"unproject",value:function(t){return new N0(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,n){var i=this.pointCoordinate(n),s=this.pointCoordinate(this.centerPoint),l=this.locationCoordinate(t),v=new N0(l.x-(i.x-s.x),l.y-(i.y-s.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var n=0,i=new Float64Array([t.x,t.y,0,1]),s=new Float64Array([t.x,t.y,1,1]);G.transformMat4(i,i,this.pixelMatrixInverse),G.transformMat4(s,s,this.pixelMatrixInverse);var l=i[3],v=s[3],g=i[0]/l,x=s[0]/v,C=i[1]/l,T=s[1]/v,R=i[2]/l,F=s[2]/v,H=R===F?0:(n-R)/(F-R);return new N0(Xc(g,x,H)/this.worldSize,Xc(C,T,H)/this.worldSize)}},{key:"getBounds",value:function(){return new bm().extend(this.pointLocation(new Oa(0,0))).extend(this.pointLocation(new Oa(this.width,0))).extend(this.pointLocation(new Oa(this.width,this.height))).extend(this.pointLocation(new Oa(0,this.height)))}},{key:"getMaxBounds",value:function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new bm([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new Oa(0,0)),n=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]),i=G.transformMat4(n,n,this.pixelMatrix);return i[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,n=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Oa(0,n))}},{key:"getCameraQueryGeometry",value:function(t){var n=this.getCameraPoint();if(t.length===1)return[t[0],n];var i=n.x,s=n.y,l=n.x,v=n.y,g=sL(t),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;i=Math.min(i,C.x),s=Math.min(s,C.y),l=Math.max(l,C.x),v=Math.max(v,C.y)}}catch(T){g.e(T)}finally{g.f()}return[new Oa(i,s),new Oa(l,s),new Oa(l,v),new Oa(i,v),new Oa(i,s)]}},{key:"coordinatePoint",value:function(t){var n=G.fromValues(t.x*this.worldSize,t.y*this.worldSize,0,1);return G.transformMat4(n,n,this.pixelMatrix),new Oa(n[0]/n[3],n[1]/n[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return N0.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(!(!this.center||!this.width||!this.height||this.constraining)){this.constraining=!0;var t=-90,n=90,i=-180,s=180,l,v,g,x,C=this.size,T=this.unmodified;if(this.latRange){var R=this.latRange;t=B0(R[1])*this.worldSize,n=B0(R[0])*this.worldSize,l=n-t<C.y?C.y/(n-t):0}if(this.lngRange){var F=this.lngRange;i=F0(F[0])*this.worldSize,s=F0(F[1])*this.worldSize,v=s-i<C.x?C.x/(s-i):0}var H=this.point,Q=Math.max(v||0,l||0);if(Q){this.center=this.unproject(new Oa(v?(s+i)/2:H.x,l?(n+t)/2:H.y)),_a?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(Q),this.unmodified=T,this.constraining=!1;return}if(this.latRange){var ie=H.y,be=C.y/2;ie-be<t&&(x=t+be),ie+be>n&&(x=n-be)}if(this.lngRange){var je=H.x,Je=C.x/2;je-Je<i&&(g=i+Je),je+Je>s&&(g=s-Je)}(g!==void 0||x!==void 0)&&(this.center=this.unproject(new Oa(g!==void 0?g:H.x,x!==void 0?x:H.y))),this.unmodified=T,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(!!this.height){var t=this._fov/2,n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var i=Math.PI/2+this._pitch,s=this._fov*(.5+n.y/this.height),l=Math.sin(s)*this.cameraToCenterDistance/Math.sin(Ih(Math.PI-i-s,.01,Math.PI-.01)),v=this.point,g=v.x,x=v.y,C=Math.cos(Math.PI/2-this._pitch)*l+this.cameraToCenterDistance,T=C*1.01,R=this.height/50,F=new Float64Array(16);j.perspective(F,this._fov,this.width/this.height,R,T),F[8]=-n.x*2/this.width,F[9]=n.y*2/this.height,j.scale(F,F,[1,-1,1]),j.translate(F,F,[0,0,-this.cameraToCenterDistance]),j.rotateX(F,F,this._pitch),j.rotateZ(F,F,this.angle),j.translate(F,F,[-g,-x,0]),this.mercatorMatrix=j.scale([],F,[this.worldSize,this.worldSize,this.worldSize]),j.scale(F,F,[1,1,SC(1,this.center.lat)*this.worldSize,1]),this.projMatrix=F,this.invProjMatrix=j.invert([],this.projMatrix);var H=this.width%2/2,Q=this.height%2/2,ie=Math.cos(this.angle),be=Math.sin(this.angle),je=g-Math.round(g)+ie*H+be*Q,Je=x-Math.round(x)+ie*Q+be*H,et=new Float64Array(F);if(j.translate(et,et,[je>.5?je-1:je,Je>.5?Je-1:Je,0]),this.alignedProjMatrix=et,F=j.create(),j.scale(F,F,[this.width/2,-this.height/2,1]),j.translate(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=j.create(),j.scale(F,F,[1,-1,1]),j.translate(F,F,[-1,-1,0]),j.scale(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=j.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),F=j.invert(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");this.pixelMatrixInverse=F,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),ao=yt()(function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};dt()(this,e),w()(this,"type",void 0),Ro()(this,t),this.type=r});function cL(e){var r=fL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function fL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wC=function(e){bn()(t,e);var r=cL(t);function t(n){var i;dt()(this,t),i=r.call(this),w()(ue()(i),"transform",void 0),w()(ue()(i),"options",void 0),w()(ue()(i),"moving",void 0),w()(ue()(i),"zooming",void 0),w()(ue()(i),"rotating",void 0),w()(ue()(i),"pitching",void 0),w()(ue()(i),"padding",void 0),w()(ue()(i),"bearingSnap",void 0),w()(ue()(i),"easeEndTimeoutID",void 0),w()(ue()(i),"easeStart",void 0),w()(ue()(i),"easeOptions",void 0),w()(ue()(i),"easeId",void 0),w()(ue()(i),"onEaseFrame",void 0),w()(ue()(i),"onEaseEnd",void 0),w()(ue()(i),"easeFrameId",void 0),w()(ue()(i),"renderFrameCallback",function(){var C=Math.min((gp()-i.easeStart)/i.easeOptions.duration,1);i.onEaseFrame(i.easeOptions.easing(C)),C<1?i.easeFrameId=i.requestRenderFrame(i.renderFrameCallback):i.stop()}),i.options=n;var s=n.minZoom,l=n.maxZoom,v=n.minPitch,g=n.maxPitch,x=n.renderWorldCopies;return i.moving=!1,i.zooming=!1,i.bearingSnap=n.bearingSnap,i.transform=new lL(s,l,v,g,x),i}return yt()(t,[{key:"requestRenderFrame",value:function(i){return 0}},{key:"cancelRenderFrame",value:function(i){}},{key:"getCenter",value:function(){var i=this.transform.center,s=i.lng,l=i.lat;return new Uo(s,l)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(i,s){return this.jumpTo({center:i},s)}},{key:"setPitch",value:function(i,s){return this.jumpTo({pitch:i},s),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(i,s,l){return this.easeTo(Ro()({center:i},s),l)}},{key:"zoomOut",value:function(i,s){return this.zoomTo(this.getZoom()-1,i,s),this}},{key:"setBearing",value:function(i,s){return this.jumpTo({bearing:i},s),this}},{key:"setZoom",value:function(i,s){return this.jumpTo({zoom:i},s),this}},{key:"zoomIn",value:function(i,s){return this.zoomTo(this.getZoom()+1,i,s),this}},{key:"zoomTo",value:function(i,s,l){return this.easeTo(Ro()({zoom:i},s),l)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(i,s){return this.jumpTo({padding:i},s),this}},{key:"rotateTo",value:function(i,s,l){return this.easeTo(Ro()({bearing:i},s),l)}},{key:"resetNorth",value:function(i,s){return this.rotateTo(0,Ro()({duration:1e3},i),s),this}},{key:"resetNorthPitch",value:function(i,s){return this.easeTo(Ro()({bearing:0,pitch:0,duration:1e3},i),s),this}},{key:"fitBounds",value:function(i,s,l){return this.fitInternal(this.cameraForBounds(i,s),s,l)}},{key:"cameraForBounds",value:function(i,s){return i=bm.convert(i),this.cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),0,s)}},{key:"snapToNorth",value:function(i,s){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(i,s):this}},{key:"jumpTo",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.stop();var l=this.transform,v=!1,g=!1,x=!1;return i.zoom&&l.zoom!==+i.zoom&&(v=!0,l.zoom=+i.zoom),i.center!==void 0&&(l.center=Uo.convert(i.center)),i.bearing&&l.bearing!==+i.bearing&&(g=!0,l.bearing=+i.bearing),i.pitch&&l.pitch!==+i.pitch&&(x=!0,l.pitch=+i.pitch),i.padding!=null&&!l.isPaddingEqual(i.padding)&&(l.padding=i.padding),this.emit("movestart",new ao("movestart",s)),this.emit("move",new ao("move",s)),v&&(this.emit("zoomstart",new ao("zoomstart",s)),this.emit("zoom",new ao("zoom",s)),this.emit("zoomend",new ao("zoomend",s))),g&&(this.emit("rotatestart",new ao("rotatestart",s)),this.emit("rotate",new ao("rotate",s)),this.emit("rotateend",new ao("rotateend",s))),x&&(this.emit("pitchstart",new ao("pitchstart",s)),this.emit("pitch",new ao("pitch",s)),this.emit("pitchend",new ao("pitchend",s))),this.emit("moveend",new ao("moveend",s))}},{key:"easeTo",value:function(){var i=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;s=Ro()({offset:[0,0],duration:500,easing:xy},s),(s.animate===!1||!s.essential&&_C())&&(s.duration=0);var v=this.transform,g=this.getZoom(),x=this.getBearing(),C=this.getPitch(),T=this.getPadding(),R=s.zoom?+s.zoom:g,F=s.bearing?this.normalizeBearing(s.bearing,x):x,H=s.pitch?+s.pitch:C,Q=s.padding?s.padding:v.padding,ie=Oa.convert(s.offset),be=v.centerPoint.add(ie),je=v.pointLocation(be),Je=Uo.convert(s.center||je);this.normalizeCenter(Je);var et=v.project(je),bt=v.project(Je).sub(et),Et=v.zoomScale(R-g),kt,jt;s.around&&(kt=Uo.convert(s.around),jt=v.locationPoint(kt));var mr={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||R!==g,this.rotating=this.rotating||x!==F,this.pitching=this.pitching||H!==C,this.padding=!v.isPaddingEqual(Q),this.easeId=s.easeId,this.prepareEase(l,s.noMoveStart,mr),clearTimeout(this.easeEndTimeoutID),this.ease(function(Ar){if(i.zooming&&(v.zoom=Xc(g,R,Ar)),i.rotating&&(v.bearing=Xc(x,F,Ar)),i.pitching&&(v.pitch=Xc(C,H,Ar)),i.padding&&(v.interpolatePadding(T,Q,Ar),be=v.centerPoint.add(ie)),kt)v.setLocationAtPoint(kt,jt);else{var pr=v.zoomScale(v.zoom-g),pn=R>g?Math.min(2,Et):Math.max(.5,Et),Tn=Math.pow(pn,1-Ar),Jn=v.unproject(et.add(bt.mult(Ar*Tn)).mult(pr));v.setLocationAtPoint(v.renderWorldCopies?Jn.wrap():Jn,be)}i.fireMoveEvents(l)},function(Ar){i.afterEase(l,Ar)},s),this}},{key:"flyTo",value:function(){var i=this,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0;if(!s.essential&&_C()){var v=eL(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(v,l)}this.stop(),s=Ro()({offset:[0,0],speed:1.2,curve:1.42,easing:xy},s);var g=this.transform,x=this.getZoom(),C=this.getBearing(),T=this.getPitch(),R=this.getPadding(),F=s.zoom?Ih(+s.zoom,g.minZoom,g.maxZoom):x,H=s.bearing?this.normalizeBearing(s.bearing,C):C,Q=s.pitch?+s.pitch:T,ie="padding"in s?s.padding:g.padding,be=g.zoomScale(F-x),je=Oa.convert(s.offset),Je=g.centerPoint.add(je),et=g.pointLocation(Je),bt=Uo.convert(s.center||et);this.normalizeCenter(bt);var Et=g.project(et),kt=g.project(bt).sub(Et),jt=s.curve,mr=Math.max(g.width,g.height),Ar=mr/be,pr=kt.mag();if("minZoom"in s){var pn=Ih(Math.min(s.minZoom,x,F),g.minZoom,g.maxZoom),Tn=mr/g.zoomScale(pn-x);jt=Math.sqrt(Tn/pr*2)}var Jn=jt*jt;function va(po){var xl=(Ar*Ar-mr*mr+(po?-1:1)*Jn*Jn*pr*pr)/(2*(po?Ar:mr)*Jn*pr);return Math.log(Math.sqrt(xl*xl+1)-xl)}function oo(po){return(Math.exp(po)-Math.exp(-po))/2}function ko(po){return(Math.exp(po)+Math.exp(-po))/2}function ss(po){return oo(po)/ko(po)}var eo=va(0),Bl=function(xl){return ko(eo)/ko(eo+jt*xl)},yc=function(xl){return mr*((ko(eo)*ss(eo+jt*xl)-oo(eo))/Jn)/pr},_l=(va(1)-eo)/jt;if(Math.abs(pr)<1e-6||!isFinite(_l)){if(Math.abs(mr-Ar)<1e-6)return this.easeTo(s,l);var Yc=Ar<mr?-1:1;_l=Math.abs(Math.log(Ar/mr))/jt,yc=function(){return 0},Bl=function(xl){return Math.exp(Yc*jt*xl)}}if("duration"in s)s.duration=+s.duration;else{var yp="screenSpeed"in s?+s.screenSpeed/jt:+s.speed;s.duration=1e3*_l/yp}return s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this.zooming=!0,this.rotating=C!==H,this.pitching=Q!==T,this.padding=!g.isPaddingEqual(ie),this.prepareEase(l,!1),this.ease(function(po){var xl=po*_l,_v=1/Bl(xl);g.zoom=po===1?F:x+g.scaleZoom(_v),i.rotating&&(g.bearing=Xc(C,H,po)),i.pitching&&(g.pitch=Xc(T,Q,po)),i.padding&&(g.interpolatePadding(R,ie,po),Je=g.centerPoint.add(je));var xv=po===1?bt:g.unproject(Et.add(kt.mult(yc(xl))).mult(_v));g.setLocationAtPoint(g.renderWorldCopies?xv.wrap():xv,Je),i.fireMoveEvents(l)},function(){return i.afterEase(l)},s),this}},{key:"fitScreenCoordinates",value:function(i,s,l,v,g){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Oa.convert(i)),this.transform.pointLocation(Oa.convert(s)),l,v),v,g)}},{key:"stop",value:function(i,s){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var l=this.onEaseEnd;delete this.onEaseEnd,l.call(this,s)}return this}},{key:"normalizeBearing",value:function(i,s){i=yy(i,-180,180);var l=Math.abs(i-s);return Math.abs(i-360-s)<l&&(i-=360),Math.abs(i+360-s)<l&&(i+=360),i}},{key:"normalizeCenter",value:function(i){var s=this.transform;if(!(!s.renderWorldCopies||s.lngRange)){var l=i.lng-s.center.lng;i.lng+=l>180?-360:l<-180?360:0}}},{key:"fireMoveEvents",value:function(i){this.emit("move",new ao("move",i)),this.zooming&&this.emit("zoom",new ao("zoom",i)),this.rotating&&this.emit("rotate",new ao("rotate",i)),this.pitching&&this.emit("rotate",new ao("pitch",i))}},{key:"prepareEase",value:function(i){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.moving=!0,!s&&!l.moving&&this.emit("movestart",new ao("movestart",i)),this.zooming&&!l.zooming&&this.emit("zoomstart",new ao("zoomstart",i)),this.rotating&&!l.rotating&&this.emit("rotatestart",new ao("rotatestart",i)),this.pitching&&!l.pitching&&this.emit("pitchstart",new ao("pitchstart",i))}},{key:"afterEase",value:function(i,s){if(!(this.easeId&&s&&this.easeId===s)){delete this.easeId;var l=this.zooming,v=this.rotating,g=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,l&&this.emit("zoomend",new ao("zoomend",i)),v&&this.emit("rotateend",new ao("rotateend",i)),g&&this.emit("pitchend",new ao("pitchend",i)),this.emit("moveend",new ao("moveend",i))}}},{key:"ease",value:function(i,s,l){l.animate===!1||l.duration===0?(i(1),s()):(this.easeStart=gp(),this.easeOptions=l,this.onEaseFrame=i,this.onEaseEnd=s,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(i,s,l,v){var g={top:0,bottom:0,right:0,left:0};if(v=Ro()({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},v),typeof v.padding=="number"){var x=v.padding;v.padding={top:x,bottom:x,right:x,left:x}}v.padding=Ro()(g,v.padding);var C=this.transform,T=C.padding,R=C.project(Uo.convert(i)),F=C.project(Uo.convert(s)),H=R.rotate(-l*Math.PI/180),Q=F.rotate(-l*Math.PI/180),ie=new Oa(Math.max(H.x,Q.x),Math.max(H.y,Q.y)),be=new Oa(Math.min(H.x,Q.x),Math.min(H.y,Q.y)),je=ie.sub(be),Je=(C.width-(T.left+T.right+v.padding.left+v.padding.right))/je.x,et=(C.height-(T.top+T.bottom+v.padding.top+v.padding.bottom))/je.y;if(!(et<0||Je<0)){var bt=Math.min(C.scaleZoom(C.scale*Math.min(Je,et)),v.maxZoom),Et=Oa.convert(v.offset),kt=(v.padding.left-v.padding.right)/2,jt=(v.padding.top-v.padding.bottom)/2,mr=new Oa(Et.x+kt,Et.y+jt),Ar=mr.mult(C.scale/C.zoomScale(bt)),pr=C.unproject(R.add(F).div(2).sub(Ar));return{center:pr,zoom:bt,bearing:l}}}},{key:"fitInternal",value:function(i,s,l){return i?(s=Ro()(i,s),delete s.padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}}]),t}(Zs.EventEmitter);function Ey(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hL(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function hL(e,r){if(!!e){if(typeof e=="string")return AC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return AC(e,r)}}function AC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var gc={},rl=gc;gc.create=function(e,r,t){var n=Wn.document.createElement(e);return r!==void 0&&(n.className=r),t&&t.appendChild(n),n},gc.createNS=function(e,r){var t=Wn.document.createElementNS(e,r);return t};var vd=Wn.document&&Wn.document.documentElement.style;function TC(e){if(!vd)return e[0];var r=Ey(e),t;try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n in vd)return n}}catch(i){r.e(i)}finally{r.f()}return e[0]}var Em=TC(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),MC;gc.disableDrag=function(){vd&&Em&&(MC=vd[Em],vd[Em]="none")},gc.enableDrag=function(){vd&&Em&&(vd[Em]=MC)};var pL=TC(["transform","WebkitTransform"]);gc.setTransform=function(e,r){e.style[pL]=r};var z0=!1;try{var U0=Object.defineProperty({},"passive",{get:function(){z0=!0}});Wn.addEventListener("test",U0,U0),Wn.removeEventListener("test",U0,U0)}catch(e){z0=!1}gc.addEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&z0?e.addEventListener(r,t,n):e.addEventListener(r,t,n.capture)},gc.removeEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&z0?e.removeEventListener(r,t,n):e.removeEventListener(r,t,n.capture)};var PC=function e(r){r.preventDefault(),r.stopPropagation(),Wn.removeEventListener("click",e,!0)};gc.suppressClick=function(){_a||(Wn.addEventListener("click",PC,!0),setTimeout(function(){Wn.removeEventListener("click",PC,!0)},0))},gc.mousePos=function(e,r){if(_a)return new Oa(r.clientX-e.left-0,r.clientY-e.top-0);var t=e.getBoundingClientRect();return new Oa(r.clientX-t.left-e.clientLeft,r.clientY-t.top-e.clientTop)},gc.touchPos=function(e,r){if(_a){var v=[],g=Ey(r),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;v.push(new Oa(C.clientX-e.left,C.clientY-e.top))}}catch(T){g.e(T)}finally{g.f()}return v}else{var t=e.getBoundingClientRect(),n=[],i=Ey(r),s;try{for(i.s();!(s=i.n()).done;){var l=s.value;n.push(new Oa(l.clientX-t.left-e.clientLeft,l.clientY-t.top-e.clientTop))}}catch(T){i.e(T)}finally{i.f()}return n}},gc.mouseButton=function(e){return _a&&typeof Wn.InstallTrigger!="undefined"&&e.button===2&&e.ctrlKey&&Wn.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},gc.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};function dL(e){var r=vL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function vL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rh=function(e){bn()(t,e);var r=dL(t);function t(n,i,s){var l,v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};dt()(this,t);var g=rl.mousePos(i.getCanvasContainer(),s),x=i.unproject(g);return l=r.call(this,n,Ro()({point:g,lngLat:x,originalEvent:s},v)),w()(ue()(l),"type",void 0),w()(ue()(l),"target",void 0),w()(ue()(l),"originalEvent",void 0),w()(ue()(l),"point",void 0),w()(ue()(l),"lngLat",void 0),w()(ue()(l),"defaultPrevented",void 0),l.defaultPrevented=!1,l.target=i,l}return yt()(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(ao);function mL(e){var r=gL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function gL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j0=function(e){bn()(t,e);var r=mL(t);function t(n,i,s){var l;dt()(this,t);var v=n==="touchend"?s.changedTouches:s.touches,g=rl.touchPos(i.getCanvasContainer(),v),x=g.map(function(R){return i.unproject(R)}),C=g.reduce(function(R,F,H,Q){return R.add(F.div(Q.length))},new Oa(0,0)),T=i.unproject(C);return l=r.call(this,n,{points:g,point:C,lngLats:x,lngLat:T,originalEvent:s}),w()(ue()(l),"type",void 0),w()(ue()(l),"target",void 0),w()(ue()(l),"originalEvent",void 0),w()(ue()(l),"lngLat",void 0),w()(ue()(l),"point",void 0),w()(ue()(l),"points",void 0),w()(ue()(l),"lngLats",void 0),w()(ue()(l),"defaultPrevented",void 0),l.defaultPrevented=!1,l}return yt()(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(ao);function yL(e){var r=_L();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function _L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xL=function(e){bn()(t,e);var r=yL(t);function t(n,i,s){var l;return dt()(this,t),l=r.call(this,n,{originalEvent:s}),w()(ue()(l),"type",void 0),w()(ue()(l),"originalEvent",void 0),w()(ue()(l),"defaultPrevented",void 0),w()(ue()(l),"target",void 0),l.defaultPrevented=!1,l}return yt()(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(ao),bL=function(){function e(r){dt()(this,e),w()(this,"map",void 0),w()(this,"delayContextMenu",void 0),w()(this,"contextMenuEvent",void 0),this.map=r}return yt()(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new Rh(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new Rh("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new Rh(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),EL=function(){function e(r,t){dt()(this,e),w()(this,"map",void 0),w()(this,"el",void 0),w()(this,"container",void 0),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"startPos",void 0),w()(this,"lastPos",void 0),w()(this,"box",void 0),w()(this,"clickTolerance",void 0),this.map=r,this.el=r.getCanvasContainer(),this.container=r.getContainer(),this.clickTolerance=t.clickTolerance||1}return yt()(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"mousedown",value:function(t,n){!this.isEnabled()||!(t.shiftKey&&t.button===0)||(rl.disableDrag(),this.startPos=this.lastPos=n,this.active=!0)}},{key:"mousemoveWindow",value:function(t,n){if(!!this.active){var i=n;if(!(this.lastPos.equals(i)||!this.box&&i.dist(this.startPos)<this.clickTolerance)){var s=this.startPos;this.lastPos=i,this.box||(this.box=rl.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var l=Math.min(s.x,i.x),v=Math.max(s.x,i.x),g=Math.min(s.y,i.y),x=Math.max(s.y,i.y);rl.setTransform(this.box,"translate(".concat(l,"px,").concat(g,"px)")),this.box&&(this.box.style.width="".concat(v-l,"px"),this.box.style.height="".concat(x-g,"px"))}}}},{key:"mouseupWindow",value:function(t,n){var i=this;if(!!this.active&&t.button===0){var s=this.startPos,l=n;if(this.reset(),rl.suppressClick(),s.x===l.x&&s.y===l.y)this.fireEvent("boxzoomcancel",t);else return this.map.emit("boxzoomend",new ao("boxzoomend",{originalEvent:t})),{cameraAnimation:function(g){return g.fitScreenCoordinates(s,l,i.map.getBearing(),{linear:!0})}}}}},{key:"keydown",value:function(t){!this.active||t.keyCode===27&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(rl.remove(this.box),this.box=null),rl.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,n){return this.map.emit(t,new ao(t,{originalEvent:n}))}}]),e}(),SL=EL,CL=function(){function e(){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),this.reset()}return yt()(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,n){return t.preventDefault(),{cameraAnimation:function(s){s.easeTo({duration:300,zoom:s.getZoom()+(t.shiftKey?-1:1),around:s.unproject(n)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function wL(e){var r=AL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function AL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TL=function(e){bn()(t,e);var r=wL(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"type","renderFrame"),w()(ue()(n),"timeStamp",void 0),n}return yt()(t)}(ao);function ML(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=PL(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function PL(e,r){if(!!e){if(typeof e=="string")return OC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return OC(e,r)}}function OC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var V0={linearity:.3,easing:_y(0,0,.3,1)},OL=Ro()({deceleration:2500,maxSpeed:1400},V0),IL=Ro()({deceleration:20,maxSpeed:1400},V0),RL=Ro()({deceleration:1e3,maxSpeed:360},V0),kL=Ro()({deceleration:1e3,maxSpeed:90},V0),LL=function(){function e(r){dt()(this,e),w()(this,"map",void 0),w()(this,"inertiaBuffer",void 0),this.map=r,this.clear()}return yt()(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:gp(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,n=gp(),i=160;t.length>0&&n-t[0].time>i;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var n={zoom:0,bearing:0,pitch:0,pan:new Oa(0,0),pinchAround:void 0,around:void 0},i=ML(this.inertiaBuffer),s;try{for(i.s();!(s=i.n()).done;){var l=s.value.settings;n.zoom+=l.zoomDelta||0,n.bearing+=l.bearingDelta||0,n.pitch+=l.pitchDelta||0,l.panDelta&&n.pan._add(l.panDelta),l.around&&(n.around=l.around),l.pinchAround&&(n.pinchAround=l.pinchAround)}}catch(Q){i.e(Q)}finally{i.f()}var v=this.inertiaBuffer[this.inertiaBuffer.length-1],g=v.time-this.inertiaBuffer[0].time,x={};if(n.pan.mag()){var C=H0(n.pan.mag(),g,Ro()({},OL,t||{}));x.offset=n.pan.mult(C.amount/n.pan.mag()),x.center=this.map.transform.center,G0(x,C)}if(n.zoom){var T=H0(n.zoom,g,IL);x.zoom=this.map.transform.zoom+T.amount,G0(x,T)}if(n.bearing){var R=H0(n.bearing,g,RL);x.bearing=this.map.transform.bearing+Ih(R.amount,-179,179),G0(x,R)}if(n.pitch){var F=H0(n.pitch,g,kL);x.pitch=this.map.transform.pitch+F.amount,G0(x,F)}if(x.zoom||x.bearing){var H=n.pinchAround===void 0?n.around:n.pinchAround;x.around=H?this.map.unproject(H):this.map.getCenter()}return this.clear(),Ro()(x,{noMoveStart:!0})}}}]),e}();function G0(e,r){(!e.duration||e.duration<r.duration)&&(e.duration=r.duration,e.easing=r.easing)}function H0(e,r,t){var n=t.maxSpeed,i=t.linearity,s=t.deceleration,l=Ih(e*i/(r/1e3),-n,n),v=Math.abs(l)/(s*i);return{easing:t.easing,duration:v*1e3,amount:l*(v/2)}}var DL={panStep:100,bearingStep:15,pitchStep:10},FL=function(){function e(){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"panStep",void 0),w()(this,"bearingStep",void 0),w()(this,"pitchStep",void 0);var r=DL;this.panStep=r.panStep,this.bearingStep=r.bearingStep,this.pitchStep=r.pitchStep}return yt()(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var n=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=0,s=0,l=0,v=0,g=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?s=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?s=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?l=1:(t.preventDefault(),g=-1);break;case 40:t.shiftKey?l=-1:(t.preventDefault(),g=1);break;default:return}return{cameraAnimation:function(C){var T=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:BL,zoom:i?Math.round(T)+i*(t.shiftKey?2:1):T,bearing:C.getBearing()+s*n.bearingStep,pitch:C.getPitch()+l*n.pitchStep,offset:[-v*n.panStep,-g*n.panStep],center:C.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function BL(e){return e*(2-e)}var NL=FL,zL=function(){function e(r,t){dt()(this,e),w()(this,"mousedownPos",void 0),w()(this,"clickTolerance",void 0),w()(this,"map",void 0),this.map=r,this.clickTolerance=t.clickTolerance}return yt()(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new xL(t.type,this.map,t))}},{key:"mousedown",value:function(t,n){return this.mousedownPos=n,this.firePreventable(new Rh(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new Rh(t.type,this.map,t))}},{key:"click",value:function(t,n){this.mousedownPos&&this.mousedownPos.dist(n)>=this.clickTolerance||this.map.emit(t.type,new Rh(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new Rh(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new Rh(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new Rh(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new j0(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new j0(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new j0(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new j0(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),W0,Z0=0,Sy=2,UL=(W0={},w()(W0,Z0,1),w()(W0,Sy,2),W0);function jL(e,r){var t=UL[r];return e.buttons===void 0||(e.buttons&t)!==t}var Cy=function(){function e(r){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"lastPoint",void 0),w()(this,"eventButton",void 0),w()(this,"moved",void 0),w()(this,"clickTolerance",void 0),this.reset(),this.clickTolerance=r.clickTolerance||1}return yt()(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,n){if(!this.lastPoint){var i=rl.mouseButton(t);!this.correctButton(t,i)||(this.lastPoint=n,this.eventButton=i)}}},{key:"mousemoveWindow",value:function(t,n){var i=this.lastPoint;if(!!i){if(t.preventDefault(),jL(t,this.eventButton)){this.reset();return}if(!(!this.moved&&n.dist(i)<this.clickTolerance))return this.moved=!0,this.lastPoint=n,this.move(i,n)}}},{key:"mouseupWindow",value:function(t){if(!!this.lastPoint){var n=rl.mouseButton(t);n===this.eventButton&&(this.moved&&rl.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,n){return!1}},{key:"move",value:function(t,n){}}]),e}();function VL(e){var r=GL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function GL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HL=function(e){bn()(t,e);var r=VL(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"mousedown",value:function(i,s){ap()(Lt()(t.prototype),"mousedown",this).call(this,i,s),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(i,s){return{around:s,panDelta:s.sub(i)}}},{key:"correctButton",value:function(i,s){return s===Z0&&!i.ctrlKey}}]),t}(Cy);function WL(e){var r=ZL();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function ZL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XL=function(e){bn()(t,e);var r=WL(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"correctButton",value:function(i,s){return s===Z0&&i.ctrlKey||s===Sy}},{key:"move",value:function(i,s){var l=-.5,v=(s.y-i.y)*l;if(v)return this.active=!0,{pitchDelta:v}}},{key:"contextmenu",value:function(i){i.preventDefault()}}]),t}(Cy);function YL(e){var r=$L();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function $L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KL=function(e){bn()(t,e);var r=YL(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"contextmenu",value:function(i){i.preventDefault()}},{key:"correctButton",value:function(i,s){return s===Z0&&i.ctrlKey||s===Sy}},{key:"move",value:function(i,s){var l=.8,v=(s.x-i.x)*l;if(v)return this.active=!0,{bearingDelta:v}}}]),t}(Cy),IC=4.000244140625,qL=1/100,QL=1/450,JL=2,eD=function(){function e(r,t){var n=this;dt()(this,e),w()(this,"map",void 0),w()(this,"el",void 0),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"zooming",void 0),w()(this,"aroundCenter",void 0),w()(this,"around",void 0),w()(this,"aroundPoint",void 0),w()(this,"type",void 0),w()(this,"lastValue",void 0),w()(this,"timeout",void 0),w()(this,"finishTimeout",void 0),w()(this,"lastWheelEvent",void 0),w()(this,"lastWheelEventTime",void 0),w()(this,"startZoom",void 0),w()(this,"targetZoom",void 0),w()(this,"delta",void 0),w()(this,"easing",void 0),w()(this,"prevEase",void 0),w()(this,"frameId",void 0),w()(this,"handler",void 0),w()(this,"defaultZoomRate",void 0),w()(this,"wheelZoomRate",void 0),w()(this,"onScrollFrame",function(){if(!!n.frameId&&(n.frameId=null,!!n.isActive())){var i=n.map.transform;if(n.delta!==0){var s=n.type==="wheel"&&Math.abs(n.delta)>IC?n.wheelZoomRate:n.defaultZoomRate,l=JL/(1+Math.exp(-Math.abs(n.delta*s)));n.delta<0&&l!==0&&(l=1/l);var v=typeof n.targetZoom=="number"?i.zoomScale(n.targetZoom):i.scale;n.targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(v*l))),n.type==="wheel"&&(n.startZoom=i.zoom,n.easing=n.smoothOutEasing(200)),n.delta=0}var g=typeof n.targetZoom=="number"?n.targetZoom:i.zoom,x=n.startZoom,C=n.easing,T=!1,R;if(n.type==="wheel"&&x&&C){var F=Math.min((gp()-n.lastWheelEventTime)/200,1),H=C(F);R=Xc(x,g,H),F<1?n.frameId||(n.frameId=!0):T=!0}else R=g,T=!0;return n.active=!0,T&&(n.active=!1,n.finishTimeout=setTimeout(function(){n.zooming=!1,n.handler.triggerRenderFrame(),delete n.targetZoom,delete n.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:R-i.zoom,around:n.aroundPoint,originalEvent:n.lastWheelEvent}}}),this.map=r,this.el=r.getCanvasContainer(),this.handler=t,this.delta=0,this.defaultZoomRate=qL,this.wheelZoomRate=QL}return yt()(e,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||this.finishTimeout!==void 0}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&t.around==="center")}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"wheel",value:function(t){if(!!this.isEnabled()){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY,i=gp(),s=i-(this.lastWheelEventTime||0);this.lastWheelEventTime=i,n!==0&&n%IC==0?this.type="wheel":n!==0&&Math.abs(n)<4?this.type="trackpad":s>400?(this.type=null,this.lastValue=n,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(s*n)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,n+=this.lastValue)),t.shiftKey&&n&&(n=n/4),this.type&&(this.lastWheelEvent=t,this.delta-=n,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(!!this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var n=rl.mousePos(this.el,t);this.around=Uo.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(n)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var n=xy;if(this.prevEase){var i=this.prevEase,s=(gp()-i.start)/i.duration,l=i.easing(s+.01)-i.easing(s),v=.27/Math.sqrt(l*l+1e-4)*.01,g=Math.sqrt(.27*.27-v*v);n=_y(v,g,.25,1)}return this.prevEase={start:gp(),duration:t,easing:n},n}}]),e}(),tD=eD,rD=function(){function e(r,t){dt()(this,e),w()(this,"clickZoom",void 0),w()(this,"tapZoom",void 0),this.clickZoom=r,this.tapZoom=t}return yt()(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),nD=function(){function e(r,t,n){dt()(this,e),w()(this,"inertiaOptions",void 0),w()(this,"el",void 0),w()(this,"mousePan",void 0),w()(this,"touchPan",void 0),this.el=r,this.mousePan=t,this.touchPan=n}return yt()(e,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),_a||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),_a||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),iD=function(){function e(r,t,n){dt()(this,e),w()(this,"mouseRotate",void 0),w()(this,"mousePitch",void 0),w()(this,"pitchWithRotate",void 0),this.pitchWithRotate=r.pitchWithRotate,this.mouseRotate=t,this.mousePitch=n}return yt()(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),aD=function(){function e(r,t,n,i){dt()(this,e),w()(this,"el",void 0),w()(this,"touchZoom",void 0),w()(this,"touchRotate",void 0),w()(this,"tapDragZoom",void 0),w()(this,"rotationDisabled",void 0),w()(this,"enabled",void 0),this.el=r,this.touchZoom=t,this.touchRotate=n,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return yt()(e,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),_a||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),_a||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function wy(e,r){for(var t={},n=0;n<e.length;n++)t[e[n].identifier]=r[n];return t}function oD(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=sD(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function sD(e,r){if(!!e){if(typeof e=="string")return RC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return RC(e,r)}}function RC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function uD(e){var r=new Oa(0,0),t=oD(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;r._add(i)}}catch(s){t.e(s)}finally{t.f()}return r.div(e.length)}var kC=500,lD=500,LC=30,cD=function(){function e(r){dt()(this,e),w()(this,"numTouches",void 0),w()(this,"centroid",void 0),w()(this,"startTime",void 0),w()(this,"aborted",void 0),w()(this,"touches",void 0),this.reset(),this.numTouches=r.numTouches}return yt()(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=uD(n),this.touches=wy(i,n)))}},{key:"touchmove",value:function(t,n,i){if(!(this.aborted||!this.centroid)){var s=wy(i,n);for(var l in this.touches)if(this.touches[l]){var v=this.touches[l],g=s[l];(!g||g.dist(v)>LC)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,n,i){if((!this.centroid||t.timeStamp-this.startTime>lD)&&(this.aborted=!0),i.length===0){var s=!this.aborted&&this.centroid;if(this.reset(),s)return s}}}]),e}(),Ay=function(){function e(r){dt()(this,e),w()(this,"singleTap",void 0),w()(this,"numTaps",void 0),w()(this,"lastTime",void 0),w()(this,"lastTap",void 0),w()(this,"count",void 0),this.singleTap=new cD(r),this.numTaps=r.numTaps,this.reset()}return yt()(e,[{key:"reset",value:function(){this.lastTime=Infinity,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,n,i){this.singleTap.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.singleTap.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var s=this.singleTap.touchend(t,n,i);if(s){var l=t.timeStamp-this.lastTime<kC,v=!this.lastTap||this.lastTap.dist(s)<LC;if((!l||!v)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=s,this.count===this.numTaps)return this.reset(),s}}}]),e}(),fD=function(){function e(){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"swipePoint",void 0),w()(this,"swipeTouch",void 0),w()(this,"tapTime",void 0),w()(this,"tap",void 0),this.tap=new Ay({numTouches:1,numTaps:1}),this.reset()}return yt()(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,n,i){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>kC&&this.reset(),this.tapTime?i.length>0&&(this.swipePoint=n[0],this.swipeTouch=i[0].identifier):this.tap.touchstart(t,n,i))}},{key:"touchmove",value:function(t,n,i){if(!this.tapTime)this.tap.touchmove(t,n,i);else if(this.swipePoint){if(i[0].identifier!==this.swipeTouch)return;var s=n[0],l=s.y-this.swipePoint.y;return this.swipePoint=s,t.preventDefault(),this.active=!0,{zoomDelta:l/128}}}},{key:"touchend",value:function(t,n,i){if(this.tapTime)this.swipePoint&&i.length===0&&this.reset();else{var s=this.tap.touchend(t,n,i);s&&(this.tapTime=t.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),hD=function(){function e(){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"zoomIn",void 0),w()(this,"zoomOut",void 0),this.zoomIn=new Ay({numTouches:1,numTaps:2}),this.zoomOut=new Ay({numTouches:2,numTaps:1}),this.reset()}return yt()(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,n,i){this.zoomIn.touchstart(t,n,i),this.zoomOut.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.zoomIn.touchmove(t,n,i),this.zoomOut.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var s=this,l=this.zoomIn.touchend(t,n,i),v=this.zoomOut.touchend(t,n,i);if(l)return this.active=!0,t.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(x){return x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(l)},{originalEvent:t})}};if(v)return this.active=!0,t.preventDefault(),setTimeout(function(){return s.reset()},0),{cameraAnimation:function(x){return x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(v)},{originalEvent:t})}}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),pD=function(){function e(r){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"touches",void 0),w()(this,"minTouches",void 0),w()(this,"clickTolerance",void 0),w()(this,"sum",void 0),this.minTouches=1,this.clickTolerance=r.clickTolerance||1,this.reset()}return yt()(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Oa(0,0)}},{key:"touchstart",value:function(t,n,i){return this.calculateTransform(t,n,i)}},{key:"touchmove",value:function(t,n,i){if(!!this.active)return t.preventDefault(),this.calculateTransform(t,n,i)}},{key:"touchend",value:function(t,n,i){this.calculateTransform(t,n,i),this.active&&i.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,n,i){i.length>0&&(this.active=!0);var s=wy(i,n),l=new Oa(0,0),v=new Oa(0,0),g=0;for(var x in s)if(s[x]){var C=s[x],T=this.touches[x];T&&(l._add(C),v._add(C.sub(T)),g++,s[x]=C)}if(this.touches=s,!(g<this.minTouches||!v.mag())){var R=v.div(g);if(this.sum._add(R),!(this.sum.mag()<this.clickTolerance)){var F=l.div(g);return{around:F,panDelta:R}}}}}]),e}(),Ty=function(){function e(){dt()(this,e),w()(this,"enabled",void 0),w()(this,"active",void 0),w()(this,"firstTwoTouches",void 0),w()(this,"vector",void 0),w()(this,"startVector",void 0),w()(this,"aroundCenter",void 0),this.reset()}return yt()(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,n,i){}},{key:"touchstart",value:function(t,n,i){this.firstTwoTouches||i.length<2||(this.firstTwoTouches=[i[0].identifier,i[1].identifier],this.start([n[0],n[1]]))}},{key:"touchmove",value:function(t,n,i){if(!!this.firstTwoTouches){t.preventDefault();var s=ft()(this.firstTwoTouches,2),l=s[0],v=s[1],g=X0(i,n,l),x=X0(i,n,v);if(!(!g||!x)){var C=this.aroundCenter?null:g.add(x).div(2);return this.move([g,x],C,t)}}}},{key:"touchend",value:function(t,n,i){if(!!this.firstTwoTouches){var s=ft()(this.firstTwoTouches,2),l=s[0],v=s[1],g=X0(i,n,l),x=X0(i,n,v);g&&x||(this.active&&rl.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&t.around==="center"}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function X0(e,r,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return r[n]}function dD(e){var r=vD();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function vD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function My(e){return Math.abs(e.y)>Math.abs(e.x)}var mD=100,gD=function(e){bn()(t,e);var r=dD(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"valid",void 0),w()(ue()(n),"firstMove",void 0),w()(ue()(n),"lastPoints",void 0),n}return yt()(t,[{key:"reset",value:function(){ap()(Lt()(t.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(i){this.lastPoints=i,My(i[0].sub(i[1]))&&(this.valid=!1)}},{key:"move",value:function(i,s,l){var v=i[0].sub(this.lastPoints[0]),g=i[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(v,g,l.timeStamp),!!this.valid){this.lastPoints=i,this.active=!0;var x=(v.y+g.y)/2,C=-.5;return{pitchDelta:x*C}}}},{key:"gestureBeginsVertically",value:function(i,s,l){if(this.valid!==void 0)return this.valid;var v=2,g=i.mag()>=v,x=s.mag()>=v;if(!(!g&&!x)){if(!g||!x)return this.firstMove===void 0&&(this.firstMove=l),l-this.firstMove<mD?void 0:!1;var C=i.y>0==s.y>0;return My(i)&&My(s)&&C}}}]),t}(Ty);function yD(e){var r=_D();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function _D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xD=25;function DC(e,r){return e.angleWith(r)*180/Math.PI}var bD=function(e){bn()(t,e);var r=yD(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"minDiameter",void 0),n}return yt()(t,[{key:"reset",value:function(){ap()(Lt()(t.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(i){this.startVector=this.vector=i[0].sub(i[1]),this.minDiameter=i[0].dist(i[1])}},{key:"move",value:function(i,s){var l=this.vector;if(this.vector=i[0].sub(i[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:DC(this.vector,l),pinchAround:s}}},{key:"isBelowThreshold",value:function(i){this.minDiameter=Math.min(this.minDiameter,i.mag());var s=Math.PI*this.minDiameter,l=xD/s*360,v=DC(i,this.startVector);return Math.abs(v)<l}}]),t}(Ty);function ED(e){var r=SD();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function SD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var CD=.1;function FC(e,r){return Math.log(e/r)/Math.LN2}var wD=function(e){bn()(t,e);var r=ED(t);function t(){var n;dt()(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),w()(ue()(n),"distance",void 0),w()(ue()(n),"startDistance",void 0),n}return yt()(t,[{key:"reset",value:function(){ap()(Lt()(t.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(i){this.startDistance=this.distance=i[0].dist(i[1])}},{key:"move",value:function(i,s){var l=this.distance;if(this.distance=i[0].dist(i[1]),!(!this.active&&Math.abs(FC(this.distance,this.startDistance))<CD))return this.active=!0,{zoomDelta:FC(this.distance,l),pinchAround:s}}}]),t}(Ty);function md(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=AD(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function AD(e,r){if(!!e){if(typeof e=="string")return BC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return BC(e,r)}}function BC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Y0=function(r){return r.zoom||r.drag||r.pitch||r.rotate};function Py(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var TD=function(){function e(r,t){var n=this;dt()(this,e),w()(this,"map",void 0),w()(this,"el",void 0),w()(this,"handlers",void 0),w()(this,"eventsInProgress",void 0),w()(this,"frameId",void 0),w()(this,"inertia",void 0),w()(this,"bearingSnap",void 0),w()(this,"handlersById",void 0),w()(this,"updatingCamera",void 0),w()(this,"changes",void 0),w()(this,"previousActiveHandlers",void 0),w()(this,"bearingChanged",void 0),w()(this,"listeners",void 0),w()(this,"handleWindowEvent",function(T){n.handleEvent(T,"".concat(T.type,"Window"))}),w()(this,"handleEvent",function(T,R){if(T.type==="blur"){n.stop();return}n.updatingCamera=!0;var F=T.type==="renderFrame"?void 0:T,H={needsRenderFrame:!1},Q={},ie={},be=T.touches?n.getMapTouches(T.touches):void 0,je=be?rl.touchPos(n.el,be):rl.mousePos(n.el,T),Je=md(n.handlers),et;try{for(Je.s();!(et=Je.n()).done;){var bt=et.value,Et=bt.handlerName,kt=bt.handler,jt=bt.allowed;if(!!kt.isEnabled()){var mr=void 0;if(n.blockedByActive(ie,jt,Et))kt.reset();else{var Ar=R||T.type;kt&&kt[Ar]&&(mr=kt[Ar](T,je,be),n.mergeIHandlerResult(H,Q,mr,Et,F),mr&&mr.needsRenderFrame&&n.triggerRenderFrame())}(mr||kt.isActive())&&(ie[Et]=kt)}}}catch(Jn){Je.e(Jn)}finally{Je.f()}var pr={};for(var pn in n.previousActiveHandlers)ie[pn]||(pr[pn]=F);n.previousActiveHandlers=ie,(Object.keys(pr).length||Py(H))&&(n.changes.push([H,Q,pr]),n.triggerRenderFrame()),(Object.keys(ie).length||Py(H))&&n.map.stop(!0),n.updatingCamera=!1;var Tn=H.cameraAnimation;Tn&&(n.inertia.clear(),n.fireEvents({},{}),n.changes=[],Tn(n.map))}),this.map=r,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new LL(r),this.bearingSnap=t.bearingSnap,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(t);var i=this.el;if(this.listeners=[],_a)Wn.document.addEventListener("touchstart",function(T){n.handleEvent(T)},{}),Wn.document.addEventListener("touchmove",function(T){n.handleEvent(T)},{}),Wn.document.addEventListener("touchend",function(T){n.handleEvent(T)},{}),Wn.document.addEventListener("touchcancel",function(T){n.handleEvent(T)},{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var s=md(this.listeners),l;try{for(s.s();!(l=s.n()).done;){var v=ft()(l.value,3),g=v[0],x=v[1],C=v[2];rl.addEventListener(g,x,g===window.document?this.handleWindowEvent:this.handleEvent,C)}}catch(T){s.e(T)}finally{s.f()}}}return yt()(e,[{key:"destroy",value:function(){var t=md(this.listeners),n;try{for(t.s();!(n=t.n()).done;){var i=ft()(n.value,3),s=i[0],l=i[1],v=i[2];rl.removeEventListener(s,l,s===window.document?this.handleWindowEvent:this.handleEvent,v)}}catch(g){t.e(g)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t=md(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;i.reset()}}catch(s){t.e(s)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t=md(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;if(i.isActive())return!0}}catch(s){t.e(s)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(Y0(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,n,i,s,l){if(!!i){Ro()(t,i);var v={handlerName:s,originalEvent:i.originalEvent||l};i.zoomDelta!==void 0&&(n.zoom=v),i.panDelta!==void 0&&(n.drag=v),i.pitchDelta!==void 0&&(n.pitch=v),i.bearingDelta!==void 0&&(n.rotate=v)}}},{key:"triggerRenderFrame",value:function(){var t=this;this.frameId===void 0&&(this.frameId=this.map.requestRenderFrame(function(n){delete t.frameId,t.handleEvent(new TL("renderFrame",{timeStamp:n})),t.applyChanges()}))}},{key:"addDefaultHandlers",value:function(t){var n=this.map,i=n.getCanvasContainer();this.add("mapEvent",new zL(n,t));var s=n.boxZoom=new SL(n,t);this.add("boxZoom",s);var l=new hD,v=new CL;n.doubleClickZoom=new rD(v,l),this.add("tapZoom",l),this.add("clickZoom",v);var g=new fD;this.add("tapDragZoom",g);var x=n.touchPitch=new gD;this.add("touchPitch",x);var C=new XL(t),T=new KL(t);n.dragRotate=new iD(t,C,T),this.add("mouseRotate",C,["mousePitch"]),this.add("mousePitch",T,["mouseRotate"]);var R=new HL(t),F=new pD(t);n.dragPan=new nD(i,R,F),this.add("mousePan",R),this.add("touchPan",F,["touchZoom","touchRotate"]);var H=new bD,Q=new wD;n.touchZoomRotate=new aD(i,Q,H,g),this.add("touchRotate",H,["touchPan","touchZoom"]),this.add("touchZoom",Q,["touchPan","touchRotate"]);var ie=n.scrollZoom=new tD(n,this);this.add("scrollZoom",ie,["mousePan"]);var be=n.keyboard=new NL;this.add("keyboard",be),this.add("blockableMapEvent",new bL(n));for(var je=0,Je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];je<Je.length;je++){var et=Je[je];t.interactive&&t[et]&&n[et].enable(t[et])}}},{key:"add",value:function(t,n,i){this.handlers.push({handlerName:t,handler:n,allowed:i}),this.handlersById[t]=n}},{key:"blockedByActive",value:function(t,n,i){for(var s in t)if(s!==i&&(!n||n.indexOf(s)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var n=[],i=md(t),s;try{for(i.s();!(s=i.n()).done;){var l=s.value,v=l.target;(_a||this.el.contains(v))&&n.push(l)}}catch(g){i.e(g)}finally{i.f()}return n}},{key:"applyChanges",value:function(){var t={},n={},i={},s=md(this.changes),l;try{for(s.s();!(l=s.n()).done;){var v=ft()(l.value,3),g=v[0],x=v[1],C=v[2];g.panDelta&&(t.panDelta=(t.panDelta||new Oa(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),Ro()(n,x),Ro()(i,C)}}catch(T){s.e(T)}finally{s.f()}this.updateMapTransform(t,n,i),this.changes=[]}},{key:"updateMapTransform",value:function(t,n,i){var s=this.map,l=s.transform;if(!Py(t))return this.fireEvents(n,i);var v=t.panDelta,g=t.zoomDelta,x=t.bearingDelta,C=t.pitchDelta,T=t.pinchAround,R=t.around;T!==void 0&&(R=T),s.stop(!0),R=R||s.transform.centerPoint;var F=l.pointLocation(v?R.sub(v):R);x&&(l.bearing+=x),C&&(l.pitch+=C),g&&(l.zoom+=g),l.setLocationAtPoint(F,R),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(n,i)}},{key:"fireEvents",value:function(t,n){var i=this,s=Y0(this.eventsInProgress),l=Y0(t),v={};for(var g in t)if(t[g]){var x=t[g].originalEvent;this.eventsInProgress[g]||(v["".concat(g,"start")]=x),this.eventsInProgress[g]=t[g]}!s&&l&&this.fireEvent("movestart",l.originalEvent);for(var C in v)v[C]&&this.fireEvent(C,v[C]);t.rotate&&(this.bearingChanged=!0),l&&this.fireEvent("move",l.originalEvent);for(var T in t)if(t[T]){var R=t[T].originalEvent;this.fireEvent(T,R)}var F={},H;for(var Q in this.eventsInProgress)if(this.eventsInProgress[Q]){var ie=this.eventsInProgress[Q],be=ie.handlerName,je=ie.originalEvent;this.handlersById[be].isActive()||(delete this.eventsInProgress[Q],H=n[be]||je,F["".concat(Q,"end")]=H)}for(var Je in F)F[Je]&&this.fireEvent(Je,F[Je]);var et=Y0(this.eventsInProgress);if((s||l)&&!et){this.updatingCamera=!0;var bt=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),Et=function(jt){return jt!==0&&-i.bearingSnap<jt&&jt<i.bearingSnap};bt?(Et(bt.bearing||this.map.getBearing())&&(bt.bearing=0),this.map.easeTo(bt,{originalEvent:H})):(this.map.emit("moveend",new ao("moveend",{originalEvent:H})),Et(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,n){this.map.emit(t,new ao(t,n?{originalEvent:n}:{}))}}]),e}(),NC=TD,MD=O("DzJC"),PD=O.n(MD),OD=function(){function e(r){var t=this;dt()(this,e),w()(this,"map",void 0),w()(this,"updateHash",void 0),w()(this,"hashName",void 0),w()(this,"onHashChange",function(){var n=t.getCurrentHash();if(n.length>=3&&!n.some(function(s){return isNaN(+s)})){var i=t.map.dragRotate.isEnabled()&&t.map.touchZoomRotate.isEnabled()?+(n[3]||0):t.map.getBearing();return t.map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}),w()(this,"getCurrentHash",function(){var n=window.location.hash.replace("#","");if(t.hashName){var i;return n.split("&").map(function(s){return s.split("=")}).forEach(function(s){s[0]===t.hashName&&(i=s)}),(i&&i[1]||"").split("/")}return n.split("/")}),w()(this,"updateHashUnthrottled",function(){var n=t.getHashString();try{window.history.replaceState(window.history.state,"",n)}catch(i){}}),this.hashName=r&&encodeURIComponent(r),this.updateHash=PD()(this.updateHashUnthrottled,30*1e3/100)}return yt()(e,[{key:"addTo",value:function(t){return this.map=t,Wn.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return Wn.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var n=this.map.getCenter(),i=Math.round(this.map.getZoom()*100)/100,s=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,s),v=Math.round(n.lng*l)/l,g=Math.round(n.lat*l)/l,x=this.map.getBearing(),C=this.map.getPitch(),T="";if(t?T+="/".concat(v,"/").concat(g,"/").concat(i):T+="".concat(i,"/").concat(g,"/").concat(v),(x||C)&&(T+="/".concat(Math.round(x*10)/10)),C&&(T+="/".concat(Math.round(C))),this.hashName){var R=this.hashName,F=!1,H=window.location.hash.slice(1).split("&").map(function(Q){var ie=Q.split("=")[0];return ie===R?(F=!0,"".concat(ie,"=").concat(T)):Q}).filter(function(Q){return Q});return F||H.push("".concat(R,"=").concat(T)),"#".concat(H.join("&"))}return"#".concat(T)}}]),e}(),ID=OD,$0=null,Sm=[],RD=30,Oy=1e3/RD,dv=Wn.performance,vv={create:"create",load:"load",fullLoad:"fullLoad"},K0={mark:function(r){dv.mark(r)},frame:function(r){var t=r;if($0!=null){var n=t-$0;Sm.push(n)}$0=t},clearMetrics:function(){$0=null,Sm=[],dv.clearMeasures("loadTime"),dv.clearMeasures("fullLoadTime");for(var r in vv)dv.clearMarks(vv[r])},getPerformanceMetrics:function(){var r=dv.measure("loadTime",vv.create,vv.load).duration,t=dv.measure("fullLoadTime",vv.create,vv.fullLoad).duration,n=Sm.length,i=Sm.reduce(function(g,x){return g+x},0)/n/1e3,s=1/i,l=Sm.filter(function(g){return g>Oy}).reduce(function(g,x){return g+(x-Oy)/Oy},0),v=l/(n+l)*100;return{loadTime:r,fullLoadTime:t,fps:s,percentDroppedFrames:v}}};function zC(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kD(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,l=!1,v;return{s:function(){t=t.call(e)},n:function(){var x=t.next();return s=x.done,x},e:function(x){l=!0,v=x},f:function(){try{!s&&t.return!=null&&t.return()}finally{if(l)throw v}}}}function kD(e,r){if(!!e){if(typeof e=="string")return UC(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return UC(e,r)}}function UC(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var LD=function(){function e(){dt()(this,e),w()(this,"queue",void 0),w()(this,"id",void 0),w()(this,"cleared",void 0),w()(this,"currentlyRunning",void 0),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return yt()(e,[{key:"add",value:function(t){var n=++this.id,i=this.queue;return i.push({callback:t,id:n,cancelled:!1}),n}},{key:"remove",value:function(t){var n=this.currentlyRunning,i=n?this.queue.concat(n):this.queue,s=zC(i),l;try{for(s.s();!(l=s.n()).done;){var v=l.value;if(v.id===t){v.cancelled=!0;return}}}catch(g){s.e(g)}finally{s.f()}}},{key:"run",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=this.currentlyRunning=this.queue;this.queue=[];var i=zC(n),s;try{for(i.s();!(s=i.n()).done;){var l=s.value;if(!l.cancelled&&(l.callback(t),this.cleared))break}}catch(v){i.e(v)}finally{i.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),jC=LD;function DD(e){var r=FD();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function FD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function BD(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}BD(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var q0=-2,VC=22,mv=0,Q0=60,ND={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:q0,maxZoom:VC,minPitch:mv,maxPitch:Q0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},GC=function(e){bn()(t,e);var r=DD(t);function t(n){var i;if(dt()(this,t),i=r.call(this,Ro()({},ND,n)),w()(ue()(i),"doubleClickZoom",void 0),w()(ue()(i),"dragRotate",void 0),w()(ue()(i),"dragPan",void 0),w()(ue()(i),"touchZoomRotate",void 0),w()(ue()(i),"scrollZoom",void 0),w()(ue()(i),"keyboard",void 0),w()(ue()(i),"touchPitch",void 0),w()(ue()(i),"boxZoom",void 0),w()(ue()(i),"handlers",void 0),w()(ue()(i),"container",void 0),w()(ue()(i),"canvas",void 0),w()(ue()(i),"canvasContainer",void 0),w()(ue()(i),"renderTaskQueue",new jC),w()(ue()(i),"frame",void 0),w()(ue()(i),"trackResize",!0),w()(ue()(i),"hash",void 0),w()(ue()(i),"onWindowOnline",function(){i.update()}),w()(ue()(i),"onWindowResize",function(l){i.trackResize&&i.resize({originalEvent:l}).update()}),_a?i.initMiniContainer():i.initContainer(),i.resize(),i.handlers=new NC(ue()(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1)),!_a){var s=typeof n.hash=="string"&&n.hash||void 0;n.hash&&(i.hash=new ID(s).addTo(ue()(i)))}return(!i.hash||!i.hash.onHashChange())&&(i.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),n.bounds&&(i.resize(),i.fitBounds(n.bounds,Ro()({},n.fitBoundsOptions,{duration:0})))),i}return yt()(t,[{key:"resize",value:function(i){var s=this.containerDimensions(),l=s[0],v=s[1];if(this.transform.resize(l,v),_a)return this;var g=!this.moving;return g&&(this.stop(),this.emit("movestart",new Wn.Event("movestart",i)),this.emit("move",new Wn.Event("move",i))),this.emit("resize",new Wn.Event("resize",i)),g&&this.emit("moveend",new Wn.Event("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(Uo.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Oa.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(bm.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?q0:i,i>=q0&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(q0," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?VC:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?mv:i,i<mv)throw new Error("minPitch must be greater than or equal to ".concat(mv));if(i>=mv&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(mv," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?Q0:i,i>Q0)throw new Error("maxPitch must be less than or equal to ".concat(Q0));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=D0(function(s){K0.frame(s),i.frame=null,i.update(s)}))}},{key:"update",value:function(i){var s=this;this.frame||(this.frame=D0(function(l){K0.frame(l),s.frame=null,s.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var s=this.canvasContainer=W.create("div","l7-canvas-container",i);this.options.interactive&&s.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var i=0,s=0;return this.container&&(_a?(i=this.container.width/Wn.devicePixelRatio,s=this.container.height/Wn.devicePixelRatio):(i=this.container.clientWidth,s=this.container.clientHeight)),[i,s]}}]),t}(wC);function zD(e){var r=UD();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function UD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function jD(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var s=r.body||r.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(i,s):r.documentElement.appendChild(i)}var l=r.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=e:l.appendChild(r.createTextNode(e)),i.appendChild(l),l}}jD(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var J0=-2,HC=22,gv=0,eg=60,VD={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:J0,maxZoom:HC,minPitch:gv,maxPitch:eg,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0},s8=function(e){bn()(t,e);var r=zD(t);function t(n){var i;return dt()(this,t),i=r.call(this,Ro()({},VD,n)),w()(ue()(i),"doubleClickZoom",void 0),w()(ue()(i),"dragRotate",void 0),w()(ue()(i),"dragPan",void 0),w()(ue()(i),"touchZoomRotate",void 0),w()(ue()(i),"scrollZoom",void 0),w()(ue()(i),"keyboard",void 0),w()(ue()(i),"touchPitch",void 0),w()(ue()(i),"boxZoom",void 0),w()(ue()(i),"handlers",void 0),w()(ue()(i),"container",void 0),w()(ue()(i),"canvas",void 0),w()(ue()(i),"canvasContainer",void 0),w()(ue()(i),"renderTaskQueue",new jC),w()(ue()(i),"frame",void 0),w()(ue()(i),"trackResize",!0),w()(ue()(i),"onWindowOnline",function(){i.update()}),w()(ue()(i),"onWindowResize",function(s){i.trackResize&&i.resize({originalEvent:s}).update()}),i.initContainer(),i.resize(),i.handlers=new NC(ue()(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1)),i}return yt()(t,[{key:"resize",value:function(i){var s=this.containerDimensions(),l=s[0],v=s[1];this.transform.resize(l,v);var g=!this.moving;return g&&(this.stop(),this.emit("movestart",new Event("movestart",i)),this.emit("move",new Event("move",i))),this.emit("resize",new Event("resize",i)),g&&this.emit("moveend",new Event("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(Uo.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Oa.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(bm.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?J0:i,i>=J0&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(J0," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?HC:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?gv:i,i<gv)throw new Error("minPitch must be greater than or equal to ".concat(gv));if(i>=gv&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(gv," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?eg:i,i>eg)throw new Error("maxPitch must be less than or equal to ".concat(eg));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=D0(function(s){K0.frame(s),i.frame=null,i.update(s)}))}},{key:"update",value:function(i){var s=this;this.frame||(this.frame=D0(function(l){K0.frame(l),s.frame=null,s.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var s=this.canvasContainer=W.create("div","l7-canvas-container",i);this.options.interactive&&s.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var i=0,s=0;return this.container&&(i=this.container.clientWidth||400,s=this.container.clientHeight||300),[i,s]}},{key:"resizeCanvas",value:function(i,s){var l=W.DPR||1;this.canvas.width=l*i,this.canvas.height=l*s,this.canvas.style.width="".concat(i,"px"),this.canvas.style.height="".concat(s,"px")}}]),t}(wC),WC=function(){function e(){dt()(this,e),w()(this,"viewport",void 0)}return yt()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,s=t.pitch,l=t.bearing,v=t.viewportHeight,g=t.viewportWidth;this.viewport=new dy({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:s,bearing:l})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),ZC={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},GD=["id","attributionControl","style","rotation","mapInstance"],HD=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"],XC,YC,$C,KC,qC,QC,yv,JC,ew,tw,rw;function nw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function iw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?nw(Object(t),!0).forEach(function(n){w()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var aw={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},ow=12,WD=(XC=Object(vr.injectable)(),YC=Object(vr.inject)(Yt.MapConfig),$C=Object(vr.inject)(Yt.IGlobalConfigService),KC=Object(vr.inject)(Yt.ICoordinateSystemService),qC=Object(vr.inject)(Yt.IEventEmitter),XC(QC=(yv=function(){function e(){var r=this;dt()(this,e),w()(this,"version",ah.L7MAP),w()(this,"map",void 0),w()(this,"dragging",!1),w()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Pi()(this,"config",JC,this),Pi()(this,"configService",ew,this),Pi()(this,"coordinateSystemService",tw,this),Pi()(this,"eventEmitter",rw,this),w()(this,"viewport",void 0),w()(this,"markerContainer",void 0),w()(this,"cameraChangedCallback",void 0),w()(this,"$mapContainer",void 0),w()(this,"handleMiniCameraChanged",function(t,n,i,s,l){var v=r.config.offsetCoordinate,g=v===void 0?!0:v;r.viewport.syncWithMapCamera({bearing:s,center:[t,n],viewportHeight:r.map.transform.height,pitch:l,viewportWidth:r.map.transform.width,zoom:i,cameraHeight:0}),r.viewport.getZoom()>ow&&g?r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT),r.cameraChangedCallback(r.viewport)}),w()(this,"handleCameraChanged",function(){var t=r.map.getCenter(),n=t.lat,i=t.lng,s=r.config.offsetCoordinate,l=s===void 0?!0:s;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.viewport.getZoom()>ow&&l?r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ml.LNGLAT),r.cameraChangedCallback(r.viewport)})}return yt()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=W.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){qd.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(aw[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(aw[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,n){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,n,i){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0};throw new Error("not implement")}},{key:"init",value:function(){var r=Ys()(Sa.a.mark(function n(){var i=this,s,l,v,g,x,C,T,R,F,H,Q;return Sa.a.wrap(function(be){for(;;)switch(be.prev=be.next){case 0:s=this.config,l=s.id,v=l===void 0?"map":l,g=s.attributionControl,x=g===void 0?!1:g,C=s.style,T=C===void 0?"light":C,R=s.rotation,F=R===void 0?0:R,H=s.mapInstance,Q=Ch()(s,GD),this.viewport=new WC,H?(this.map=H,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(v),this.map=new GC(iw({container:this.$mapContainer,style:this.getMapStyle(T),bearing:F},Q))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 8:case"end":return be.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initMiniMap",value:function(){var r=Ys()(Sa.a.mark(function n(){var i=this,s,l,v,g,x,C,T,R,F,H,Q,ie,be,je,Je,et;return Sa.a.wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:s=this.config,l=s.id,v=l===void 0?"map":l,g=s.attributionControl,x=g===void 0?!1:g,C=s.style,T=C===void 0?"light":C,R=s.rotation,F=R===void 0?0:R,H=s.mapInstance,Q=s.canvas,ie=Q===void 0?null:Q,be=s.hasBaseMap,je=be===void 0?!1:be,Je=Ch()(s,HD),this.viewport=new WC,this.$mapContainer=ie,this.map=new GC(iw({container:this.$mapContainer,style:this.getMapStyle(T),bearing:F,canvas:ie},Je)),je?(et=this.map.getCenter(),this.handleMiniCameraChanged(et.lng,et.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),Wn.document.addEventListener("mapCameaParams",function(kt){var jt=kt.e,mr=jt.longitude,Ar=jt.latitude,pr=jt.scale,pn=jt.bearing,Tn=jt.pitch;i.handleMiniCameraChanged(mr,Ar,pr-1.25,pn,Tn)})):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return Et.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).emit.apply(n,[t].concat(s))}},{key:"once",value:function(t){for(var n,i=arguments.length,s=new Array(i>1?i-1:0),l=1;l<i;l++)s[l-1]=arguments[l];(n=this.eventEmitter).once.apply(n,[t].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:ZC[t]?ZC[t]:t}}]),e}(),JC=Mi()(yv.prototype,"config",[YC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ew=Mi()(yv.prototype,"configService",[$C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tw=Mi()(yv.prototype,"coordinateSystemService",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rw=Mi()(yv.prototype,"eventEmitter",[qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yv))||QC);function ZD(e){var r=XD();return function(){var n=Lt()(e),i;if(r){var s=Lt()(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return In()(this,i)}}function XD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YD=function(e){bn()(t,e);var r=ZD(t);function t(){return dt()(this,t),r.apply(this,arguments)}return yt()(t,[{key:"getServiceConstructor",value:function(){return WD}}]),t}(T0);function sw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function uw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?sw(Object(t),!0).forEach(function(n){$D(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):sw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $D(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function KD(e,r){return eF(e)||JD(e,r)||QD(e,r)||qD()}function qD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QD(e,r){if(!!e){if(typeof e=="string")return lw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lw(e,r)}}function lw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function JD(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function eF(e){if(Array.isArray(e))return e}var tF=Re.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,s=e.onSceneLoaded,l=e.children,v=Object(N.useRef)(null),g=Object(N.useState)(),x=KD(g,2),C=x[0],T=x[1];return Object(N.useEffect)(function(){var R=new im(uw(uw({id:v.current},i),{},{map:new YD(n)}));return R.on("loaded",function(){T(R),s&&s(R)}),function(){R.destroy()}},[]),Object(N.useEffect)(function(){C&&n.style&&C.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(N.useEffect)(function(){C&&n.zoom&&C.setZoom(n.zoom)},[n.zoom]),Object(N.useEffect)(function(){C&&n.center&&C.setCenter(n.center)},[JSON.stringify(n.center)]),Object(N.useEffect)(function(){C&&n.pitch&&C.setPitch(n.pitch)},[n.pitch]),Object(N.useEffect)(function(){C&&n.rotation&&C.setRotation(n.rotation)},[n.rotation]),Re.a.createElement(ii.Provider,{value:C},Re.a.createElement("div",{ref:v,className:t,style:r},C&&l))}),u8=tF;function rF(e,r){return oF(e)||aF(e,r)||iF(e,r)||nF()}function nF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iF(e,r){if(!!e){if(typeof e=="string")return cw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return cw(e,r)}}function cw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function aF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function oF(e){if(Array.isArray(e))return e}var l8=Re.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.children,s=Object(N.useRef)(null),l=Object(N.useState)(),v=rF(l,2),g=v[0],x=v[1];return Object(N.useEffect)(function(){var C=new im({id:s.current,map:n});return C.on("loaded",function(){x(C)}),function(){C.destroy()}},[]),Re.a.createElement(ii.Provider,{value:g},Re.a.createElement("div",{ref:s,className:t,style:r},g&&i))}),sF=["type","position"];function fw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Iy(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?fw(Object(t),!0).forEach(function(n){uF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function uF(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function lF(e,r){if(e==null)return{};var t=cF(e,r),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function cF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,s;for(s=0;s<n.length;s++)i=n[s],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var c8=Re.a.memo(function(r){var t=Hi(),n=Object(N.useRef)(),i=r.type,s=r.position,l=lF(r,sF);return Object(N.useEffect)(function(){var v;switch(i){case"scale":v=new hM({position:s||"bottomright"});break;case"zoom":v=new vM(Iy({position:s||"topright"},l));break;case"logo":v=new mx(Iy({position:s||"bottomleft"},l));case"layer":v=new sM(Iy({position:s||"bottomleft"},l))}return n.current=v,t.addControl(v),function(){n.current=void 0,t.removeControl(v)}},[i]),Object(N.useEffect)(function(){n.current&&n.current.setPosition(s||"bottomleft")},[s]),null}),Ry=O("i8i4");function hw(e,r){return dF(e)||pF(e,r)||hF(e,r)||fF()}function fF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hF(e,r){if(!!e){if(typeof e=="string")return pw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return pw(e,r)}}function pw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function pF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function dF(e){if(Array.isArray(e))return e}var dw=N.useEffect,vw=N.useState,vF=/\B([A-Z])/g,mF=function(r){return r.replace(vF,"-$1").toLowerCase()};function f8(e){var r=e.className,t=e.style,n=e.children,i=e.position,s=vw(),l=hw(s,2),v=l[0],g=l[1],x=Hi(),C=vw(function(){return document.createElement("div")}),T=hw(C,1),R=T[0];return dw(function(){var F=new em({position:i});return F.onAdd=function(){if(r&&(R.className=r),t){var H=Object.keys(t).map(function(Q){return"".concat(mF(Q),":").concat(t[Q])}).join(";");R.style.cssText=H}return R},F.onRemove=function(){},g(F),x.addControl(F),function(){x.removeControl(F)}},[]),dw(function(){v&&v.setPosition(i||"bottomleft")},[i]),Object(Ry.createPortal)(n,R)}var mw=Object(N.createContext)({});function gF(){return Object(N.useContext)(mw)}var oh=O("LvDl"),h8=N.useEffect,yF=N.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},oh.isEqual),p8=N.useEffect,_F=N.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},oh.isEqual),d8=N.useEffect,xF=N.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},oh.isEqual),bF=N.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},oh.isEqual),EF=N.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},oh.isEqual),v8=N.useEffect,SF=N.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},oh.isEqual),CF=N.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},oh.isEqual),wF=N.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},oh.isEqual),AF=["data"];function TF(e,r){if(e==null)return{};var t=MF(e,r),n,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function MF(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,s;for(s=0;s<n.length;s++)i=n[s],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var PF=N.memo(function(r){var t=r.layer,n=r.source,i=n.data,s=TF(n,AF);return t.inited?t.setData(i,s):t.source(i,s),s.autoFit&&t.fitBounds(s&&s.fitBoundsOptions),null},oh.isEqual),m8=N.useEffect,OF=N.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},oh.isEqual);function IF(e,r){return DF(e)||LF(e,r)||kF(e,r)||RF()}function RF(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kF(e,r){if(!!e){if(typeof e=="string")return gw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return gw(e,r)}}function gw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function LF(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,s=!1,l,v;try{for(t=t.call(e);!(i=(l=t.next()).done)&&(n.push(l.value),!(r&&n.length===r));i=!0);}catch(g){s=!0,v=g}finally{try{!i&&t.return!=null&&t.return()}finally{if(s)throw v}}return n}}function DF(e){if(Array.isArray(e))return e}var Cm=N.useEffect,FF=N.useState;function gd(e,r){var t=r.source,n=r.color,i=r.shape,s=r.style,l=r.size,v=r.scale,g=r.active,x=r.select,C=r.filter,T=r.animate,R=r.options,F=r.onLayerLoaded,H=Hi(),Q=FF(function(){var je;switch(e){case"polygonLayer":je=new Nb(R);break;case"lineLayer":je=new c5(R);break;case"pointLayer":je=new rI(R);break;case"heatmapLayer":je=new nO(R);break;case"rasterLayer":je=new PI(R);break;case"imageLayer":je=new pO(R);break;case"citybuildingLayer":je=new MP(R);break;default:je=new Nb(R)}return je.on("inited",function(){F&&F(je,H)}),je}),ie=IF(Q,1),be=ie[0];return Cm(function(){return H.addLayer(be),function(){H.removeLayer(be)}},[]),Cm(function(){be.inited&&R&&be.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),Cm(function(){be.inited&&(R==null?void 0:R.zIndex)&&be.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),Cm(function(){be.inited&&(R==null?void 0:R.blend)&&be.setBlend(R.blend)},[R==null?void 0:R.blend]),Cm(function(){H.render()}),N.createElement(mw.Provider,{value:be},N.createElement(PF,{layer:be,source:t}),v&&N.createElement(EF,{layer:be,scale:v}),n&&N.createElement(xF,{layer:be,color:n}),l&&N.createElement(wF,{layer:be,size:l}),i&&N.createElement(CF,{layer:be,shape:i}),s&&N.createElement(OF,{layer:be,style:s}),g&&N.createElement(yF,{layer:be,active:g}),x&&N.createElement(SF,{layer:be,select:x}),C&&N.createElement(bF,{layer:be,filter:C}),T&&N.createElement(_F,{layer:be,animate:T}),r.children)}var g8=N.memo(function(r){return gd("polygonLayer",r)}),y8=N.memo(function(r){return gd("lineLayer",r)}),yw=N.memo(function(r){return gd("pointLayer",r)}),BF=N.memo(function(r){return gd("heatmapLayer",r)}),_8=N.memo(function(r){return gd("rasterLayer",r)}),x8=N.memo(function(r){return gd("imageLayer",r)}),b8=N.memo(function(r){return gd("citybuildingLayer",r)}),NF=N.useEffect,E8=N.memo(function(e){var r=e.type,t=e.handler,n=gF();return NF(function(){return n.off(r,t),n.on(r,t),function(){n.off(r,t)}},[r,t]),null}),S8=N.memo(function(e){var r=[{title:"1",color:"rgb(239,243,255)"},{title:"10",color:"rgb(198,219,239)"},{title:"30",color:"rgb(158,202,225)"},{title:"50",color:"rgb(107,174,214)"},{title:"60",color:"rgb(49,130,189)"},{title:"100",color:"rgb(8,81,156)"}],t=e.items,n=t===void 0?r:t;return N.createElement("div",null,N.createElement("div",null,n.map(function(i,s){return N.createElement("div",{key:s,style:{background:i.color,height:"100%",display:"inline-block",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%",padding:5}})})),N.createElement("div",null,n.map(function(i,s){return N.createElement("div",{key:s,style:{background:"#fff",height:"100%",display:"inline-block",textAlign:"left",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%"}},i.title)})))});function tg(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tg=function(t){return typeof t}:tg=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tg(e)}function _w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function rg(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?_w(Object(t),!0).forEach(function(n){zF(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_w(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function zF(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function UF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function xw(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function jF(e,r,t){return r&&xw(e.prototype,r),t&&xw(e,t),e}function VF(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&ky(e,r)}function ky(e,r){return ky=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},ky(e,r)}function GF(e){var r=ZF();return function(){var n=ng(e),i;if(r){var s=ng(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return HF(this,i)}}function HF(e,r){if(r&&(tg(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WF(e)}function WF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ZF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ng(e){return ng=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ng(e)}var C8=function(e){VF(t,e);var r=GF(t);function t(n){var i;return UF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return jF(t,[{key:"componentDidMount",value:function(){var i,s=this.props,l=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new Cx(rg(rg({},g),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));l&&C.setLnglat(l),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(i){var s,l,v,g,x,C,T=Array.isArray(i.lnglat)?i.lnglat:[i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lng,i==null||(l=i.lnglat)===null||l===void 0?void 0:l.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=T.toString()!==R.toString();if(F){var H;this.popup.remove(),this.popup=new Cx(rg(rg({},this.props.option),{},{stopPropagation:(H=this.props.option)===null||H===void 0?void 0:H.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return N.createElement(ii.Consumer,{},function(s){return s&&(i.scene=s),Object(Ry.createPortal)(i.props.children,i.el)})}}]),t}(N.PureComponent);function ig(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ig=function(t){return typeof t}:ig=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ig(e)}function XF(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function bw(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function YF(e,r,t){return r&&bw(e.prototype,r),t&&bw(e,t),e}function $F(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Ly(e,r)}function Ly(e,r){return Ly=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Ly(e,r)}function KF(e){var r=JF();return function(){var n=ag(e),i;if(r){var s=ag(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return qF(this,i)}}function qF(e,r){if(r&&(ig(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QF(e)}function QF(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ag(e){return ag=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ag(e)}var w8=function(e){$F(t,e);var r=KF(t);function t(n){var i;return XF(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return YF(t,[{key:"componentDidMount",value:function(){var i=this.props,s=i.lnglat,l=i.children,v=i.option,g=i.onMarkerLoaded,x=new _x(v);s&&x.setLnglat(s),l&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(i){var s,l=(i==null?void 0:i.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());l&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return N.createElement(ii.Consumer,{},function(s){return s&&(i.scene=s),Object(Ry.createPortal)(i.props.children,i.el)})}}]),t}(N.PureComponent),e6=N.useEffect,t6=N.memo(function(e){var r=e.type,t=e.handler,n=Hi();return e6(function(){return n.on(r,t),function(){n.off(r,t)}},[r]),null}),A8=t6,r6=N.useEffect,T8=N.memo(function(r){var t=r.name,n=r.url,i=Hi();return r6(function(){i.addImage(t,n)},[t,n]),null}),n6=O("95SA"),i6=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],Ew=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){var n;Object(ht.a)(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){var n=Object(Ia.a)(Hn.a.mark(function s(){var l,v,g,x;return Hn.a.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(R){return R.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(R){return R.json()})]);case 2:l=T.sent,v=Object(he.a)(l,2),g=v[0],x=v[1],this.setState({data:g,grid:x,loading:!0});case 7:case"end":return T.stop()}},s,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"render",value:function(){var i=this.state,s=i.data,l=i.grid,v=i.loading;return v===!1?N.createElement(n6.a,null):N.createElement(Ik,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"}},l&&N.createElement(BF,{key:"1",source:{data:l,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}}),s&&[N.createElement(yw,{key:"2",options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:i6},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}}),N.createElement(yw,{key:"5",source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}})])}}]),t}(N.Component),M8={Pie:Gi,WaterWave:Kr,Gauge:Ot,MiniArea:Tt,TagCloud:Ut,Map:Ew},Sw=O("oBTY"),a6=O("H+7v"),yd=O.n(a6);function o6(e){return e*1<10?"0".concat(e):e}function Cw(){for(var e=[],r=0;r<24;r+=1)e.push({x:"".concat(o6(r),":00"),y:Math.floor(Math.random()*200)+r*50});return e}var s6=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){var n;Object(ht.a)(this,t);for(var i=arguments.length,s=new Array(i),l=0;l<i;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),n.state={activeData:Cw()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:Cw()},function(){n.loopData()})},1e3)})},n}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var i=this.state.activeData,s=i===void 0?[]:i;return Re.a.createElement("div",{className:yd.a.activeChart},Re.a.createElement(st.a,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),Re.a.createElement("div",{style:{marginTop:32}},Re.a.createElement(Tt,{animate:!1,line:!0,borderWidth:2,height:84,scale:{y:{tickCount:3}},yAxis:{tickLine:void 0,label:void 0,title:void 0,line:void 0},data:s})),s&&Re.a.createElement("div",null,Re.a.createElement("div",{className:yd.a.activeChartGrid},Re.a.createElement("p",null,Object(Sw.a)(s).sort()[s.length-1].y+200," \u4EBF\u5143"),Re.a.createElement("p",null,Object(Sw.a)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143")),Re.a.createElement("div",{className:yd.a.dashedLine},Re.a.createElement("div",{className:yd.a.line})),Re.a.createElement("div",{className:yd.a.dashedLine},Re.a.createElement("div",{className:yd.a.line}))),s&&Re.a.createElement("div",{className:yd.a.activeChartLegend},Re.a.createElement("span",null,"00:00"),Re.a.createElement("span",null,s[Math.floor(s.length/2)].x),Re.a.createElement("span",null,s[s.length-1].x)))}}]),t}(N.Component),u6=O("Wnft"),ww=O.n(u6),l6=st.a.Countdown,c6=Date.now()+1e3*60*60*24*2+1e3*30,f6=function(e){Object(_t.a)(t,e);var r=Object(Ve.a)(t);function t(){return Object(ht.a)(this,t),r.apply(this,arguments)}return Object(vt.a)(t,[{key:"componentDidMount",value:function(){var i=this.props.dispatch;i({type:"dashboardAndmonitor/fetchTags"})}},{key:"render",value:function(){var i=this.props,s=i.dashboardAndmonitor,l=i.loading,v=s.tags;return Re.a.createElement(Nr.a,null,Re.a.createElement(Re.a.Fragment,null,Re.a.createElement(Ee.a,{gutter:24},Re.a.createElement(at.a,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24}},Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.trading-activity",defaultMessage:"Real-Time Trading Activity"}),bordered:!1},Re.a.createElement(Ee.a,null,Re.a.createElement(at.a,{md:6,sm:12,xs:24},Re.a.createElement(st.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.total-transactions",defaultMessage:"Total transactions today"}),suffix:"\u5143",value:Wt()(124543233).format("0,0")})),Re.a.createElement(at.a,{md:6,sm:12,xs:24},Re.a.createElement(st.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.sales-target",defaultMessage:"Sales target completion rate"}),value:"92%"})),Re.a.createElement(at.a,{md:6,sm:12,xs:24},Re.a.createElement(l6,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.remaining-time",defaultMessage:"Remaining time of activity"}),value:c6,format:"HH:mm:ss:SSS"})),Re.a.createElement(at.a,{md:6,sm:12,xs:24},Re.a.createElement(st.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.total-transactions-per-second",defaultMessage:"Total transactions per second"}),suffix:"\u5143",value:Wt()(234).format("0,0")}))),Re.a.createElement("div",{className:ww.a.mapChart},Re.a.createElement(Ew,null)))),Re.a.createElement(at.a,{xl:6,lg:24,md:24,sm:24,xs:24},Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.activity-forecast",defaultMessage:"Activity forecast"}),style:{marginBottom:24},bordered:!1},Re.a.createElement(s6,null)),Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.efficiency",defaultMessage:"Efficiency"}),style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1},Re.a.createElement(Ot,{title:Object(it.d)({id:"dashboardandmonitor.monitor.ratio",defaultMessage:"Ratio"}),height:180,percent:87})))),Re.a.createElement(Ee.a,{gutter:24},Re.a.createElement(at.a,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24}},Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.proportion-per-category",defaultMessage:"Proportion Per Category"}),bordered:!1,className:ww.a.pieCard},Re.a.createElement(Ee.a,{style:{padding:"16px 0"}},Re.a.createElement(at.a,{span:8},Re.a.createElement(Gi,{animate:!1,percent:28,title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.fast-food",defaultMessage:"Fast food"}),total:"28%",height:128,lineWidth:2})),Re.a.createElement(at.a,{span:8},Re.a.createElement(Gi,{animate:!1,color:"#5DDECF",percent:22,title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.western-food",defaultMessage:"Western food"}),total:"22%",height:128,lineWidth:2})),Re.a.createElement(at.a,{span:8},Re.a.createElement(Gi,{animate:!1,color:"#2FC25B",percent:32,title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.hot-pot",defaultMessage:"Hot pot"}),total:"32%",height:128,lineWidth:2}))))),Re.a.createElement(at.a,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24}},Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.popular-searches",defaultMessage:"Popular Searches"}),loading:l,bordered:!1,bodyStyle:{overflow:"hidden"}},Re.a.createElement(Ut,{data:v||[],height:161}))),Re.a.createElement(at.a,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24}},Re.a.createElement(xe.a,{title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.resource-surplus",defaultMessage:"Resource Surplus"}),bodyStyle:{textAlign:"center",fontSize:0},bordered:!1},Re.a.createElement(Kr,{height:161,title:Re.a.createElement(it.a,{id:"dashboardandmonitor.monitor.fund-surplus",defaultMessage:"Fund Surplus"}),percent:34}))))))}}]),t}(N.Component),P8=K.default=Object(it.c)(function(e){var r=e.dashboardAndmonitor,t=e.loading;return{dashboardAndmonitor:r,loading:t.models.dashboardAndmonitor}})(f6)},aHsQ:function(He,K,O){"use strict";var W=O("EFp3"),re=O.n(W),ne=O("6D9b"),j=O.n(ne),m=O("cWXX")},aPG5:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.resolve=void 0;var W=O("MON2"),re=O("FV85"),ne=O("qK8v"),j=O("ujMp"),m=O("cSJO"),U=function(Me,Ee,Mt){try{return Mt()}catch(at){throw ne.isStackOverflowExeption(at)?new Error(W.CIRCULAR_DEPENDENCY_IN_FACTORY(Me,Ee.toString())):at}},G=function xe(Me){return function(Ee){Ee.parentContext.setCurrentRequest(Ee);var Mt=Ee.bindings,at=Ee.childRequests,ht=Ee.target&&Ee.target.isArray(),vt=!Ee.parentRequest||!Ee.parentRequest.target||!Ee.target||!Ee.parentRequest.target.matchesArray(Ee.target.serviceIdentifier);if(ht&&vt)return at.map(function(N){var Re=xe(Me);return Re(N)});var _t=null;if(Ee.target.isOptional()&&Mt.length===0)return;var Ve=Mt[0],xt=Ve.scope===re.BindingScopeEnum.Singleton,st=Ve.scope===re.BindingScopeEnum.Request;if(xt&&Ve.activated)return Ve.cache;if(st&&Me!==null&&Me.has(Ve.id))return Me.get(Ve.id);if(Ve.type===re.BindingTypeEnum.ConstantValue)_t=Ve.cache,Ve.activated=!0;else if(Ve.type===re.BindingTypeEnum.Function)_t=Ve.cache,Ve.activated=!0;else if(Ve.type===re.BindingTypeEnum.Constructor)_t=Ve.implementationType;else if(Ve.type===re.BindingTypeEnum.DynamicValue&&Ve.dynamicValue!==null)_t=U("toDynamicValue",Ve.serviceIdentifier,function(){return Ve.dynamicValue(Ee.parentContext)});else if(Ve.type===re.BindingTypeEnum.Factory&&Ve.factory!==null)_t=U("toFactory",Ve.serviceIdentifier,function(){return Ve.factory(Ee.parentContext)});else if(Ve.type===re.BindingTypeEnum.Provider&&Ve.provider!==null)_t=U("toProvider",Ve.serviceIdentifier,function(){return Ve.provider(Ee.parentContext)});else if(Ve.type===re.BindingTypeEnum.Instance&&Ve.implementationType!==null)_t=m.resolveInstance(Ve.implementationType,at,xe(Me));else{var it=j.getServiceIdentifierAsString(Ee.serviceIdentifier);throw new Error(W.INVALID_BINDING_TYPE+" "+it)}return typeof Ve.onActivation=="function"&&(_t=Ve.onActivation(Ee.parentContext,_t)),xt&&(Ve.cache=_t,Ve.activated=!0),st&&Me!==null&&!Me.has(Ve.id)&&Me.set(Ve.id,_t),_t}};function Te(xe){var Me=G(xe.plan.rootRequest.requestScope);return Me(xe.plan.rootRequest)}K.resolve=Te},asDA:function(He,K){function O(W,re,ne,j){var m=-1,U=W==null?0:W.length;for(j&&U&&(ne=W[++m]);++m<U;)ne=re(ne,W[m],m,W);return ne}He.exports=O},b2z7:function(He,K){var O=/\w*$/;function W(re){var ne=new re.constructor(re.source,O.exec(re));return ne.lastIndex=re.lastIndex,ne}He.exports=W},b48C:function(He,K){function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(W){return!1}}He.exports=O,He.exports.__esModule=!0,He.exports.default=He.exports},cSJO:function(He,K,O){"use strict";var W=this&&this.__spreadArray||function(xe,Me){for(var Ee=0,Mt=Me.length,at=xe.length;Ee<Mt;Ee++,at++)xe[at]=Me[Ee];return xe};Object.defineProperty(K,"__esModule",{value:!0}),K.resolveInstance=void 0;var re=O("MON2"),ne=O("FV85"),j=O("xfSm");function m(xe,Me,Ee){var Mt=Me.filter(function(ht){return ht.target!==null&&ht.target.type===ne.TargetTypeEnum.ClassProperty}),at=Mt.map(Ee);return Mt.forEach(function(ht,vt){var _t="";_t=ht.target.name.value();var Ve=at[vt];xe[_t]=Ve}),xe}function U(xe,Me){return new(xe.bind.apply(xe,W([void 0],Me)))}function G(xe,Me){if(Reflect.hasMetadata(j.POST_CONSTRUCT,xe)){var Ee=Reflect.getMetadata(j.POST_CONSTRUCT,xe);try{Me[Ee.value]()}catch(Mt){throw new Error(re.POST_CONSTRUCT_ERROR(xe.name,Mt.message))}}}function Te(xe,Me,Ee){var Mt=null;if(Me.length>0){var at=Me.filter(function(vt){return vt.target!==null&&vt.target.type===ne.TargetTypeEnum.ConstructorArgument}),ht=at.map(Ee);Mt=U(xe,ht),Mt=m(Mt,Me,Ee)}else Mt=new xe;return G(xe,Mt),Mt}K.resolveInstance=Te},cWXX:function(He,K,O){"use strict";var W=O("EFp3"),re=O.n(W),ne=O("oIFs"),j=O.n(ne)},cZ5Q:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.injectable=void 0;var W=O("MON2"),re=O("xfSm");function ne(){return function(j){if(Reflect.hasOwnMetadata(re.PARAM_TYPES,j))throw new Error(W.DUPLICATED_INJECTABLE_DECORATOR);var m=Reflect.getMetadata(re.DESIGN_PARAM_TYPES,j)||[];return Reflect.defineMetadata(re.PARAM_TYPES,m,j),j}}K.injectable=ne},d9O0:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.id=void 0;var W=0;function re(){return W++}K.id=re},d9mD:function(He,K,O){He.exports={pie:"pie___2nzPi",chart:"chart____y02v",hasLegend:"hasLegend___2tvLi",legend:"legend___aOylG",dot:"dot___3cUod",line:"line___3wzdx",legendTitle:"legendTitle___3d-qz",percent:"percent___1EUip",value:"value___3oEZu",title:"title___3EZr5",total:"total___2C3lg",legendBlock:"legendBlock___1RfCR"}},dQpi:function(He,K,O){var W=O("yGk4"),re=O("vN+2"),ne=O("rEGp"),j=1/0,m=W&&1/ne(new W([,-0]))[1]==j?function(U){return new W(U)}:re;He.exports=m},dVn5:function(He,K){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function W(re){return re.match(O)||[]}He.exports=W},dX1H:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Target=void 0;var W=O("xfSm"),re=O("d9O0"),ne=O("GXnB"),j=O("zxMA"),m=function(){function U(G,Te,xe,Me){this.id=re.id(),this.type=G,this.serviceIdentifier=xe,this.name=new j.QueryableString(Te||""),this.metadata=new Array;var Ee=null;typeof Me=="string"?Ee=new ne.Metadata(W.NAMED_TAG,Me):Me instanceof ne.Metadata&&(Ee=Me),Ee!==null&&this.metadata.push(Ee)}return U.prototype.hasTag=function(G){for(var Te=0,xe=this.metadata;Te<xe.length;Te++){var Me=xe[Te];if(Me.key===G)return!0}return!1},U.prototype.isArray=function(){return this.hasTag(W.MULTI_INJECT_TAG)},U.prototype.matchesArray=function(G){return this.matchesTag(W.MULTI_INJECT_TAG)(G)},U.prototype.isNamed=function(){return this.hasTag(W.NAMED_TAG)},U.prototype.isTagged=function(){return this.metadata.some(function(G){return W.NON_CUSTOM_TAG_KEYS.every(function(Te){return G.key!==Te})})},U.prototype.isOptional=function(){return this.matchesTag(W.OPTIONAL_TAG)(!0)},U.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(G){return G.key===W.NAMED_TAG})[0]:null},U.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(G){return W.NON_CUSTOM_TAG_KEYS.every(function(Te){return G.key!==Te})}):null},U.prototype.matchesNamedTag=function(G){return this.matchesTag(W.NAMED_TAG)(G)},U.prototype.matchesTag=function(G){var Te=this;return function(xe){for(var Me=0,Ee=Te.metadata;Me<Ee.length;Me++){var Mt=Ee[Me];if(Mt.key===G&&Mt.value===xe)return!0}return!1}},U}();K.Target=m},doU7:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingCount=void 0;var W={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};K.BindingCount=W},dxzI:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.AsyncContainerModule=K.ContainerModule=void 0;var W=O("d9O0"),re=function(){function j(m){this.id=W.id(),this.registry=m}return j}();K.ContainerModule=re;var ne=function(){function j(m){this.id=W.id(),this.registry=m}return j}();K.AsyncContainerModule=ne},fbrv:function(He,K,O){"use strict";var W=this&&this.__spreadArray||function(vt,_t){for(var Ve=0,xt=_t.length,st=vt.length;Ve<xt;Ve++,st++)vt[st]=_t[Ve];return vt};Object.defineProperty(K,"__esModule",{value:!0}),K.getFunctionName=K.getBaseClassDependencyCount=K.getDependencies=void 0;var re=O("Yk9n"),ne=O("MON2"),j=O("FV85"),m=O("xfSm"),U=O("ujMp");Object.defineProperty(K,"getFunctionName",{enumerable:!0,get:function(){return U.getFunctionName}});var G=O("dX1H");function Te(vt,_t){var Ve=U.getFunctionName(_t),xt=xe(vt,Ve,_t,!1);return xt}K.getDependencies=Te;function xe(vt,_t,Ve,xt){var st=vt.getConstructorMetadata(Ve),it=st.compilerGeneratedMetadata;if(it===void 0){var N=ne.MISSING_INJECTABLE_ANNOTATION+" "+_t+".";throw new Error(N)}var Re=st.userGeneratedMetadata,Nr=Object.keys(Re),Pr=Ve.length===0&&Nr.length>0,Wt=Nr.length>Ve.length,Oe=Pr||Wt?Nr.length:Ve.length,Bt=Ee(xt,_t,it,Re,Oe),Zt=Mt(vt,Ve),ir=W(W([],Bt),Zt);return ir}function Me(vt,_t,Ve,xt,st){var it=st[vt.toString()]||[],N=ht(it),Re=N.unmanaged!==!0,Nr=xt[vt],Pr=N.inject||N.multiInject;if(Nr=Pr||Nr,Nr instanceof re.LazyServiceIdentifer&&(Nr=Nr.unwrap()),Re){var Wt=Nr===Object,Oe=Nr===Function,Bt=Nr===void 0,Zt=Wt||Oe||Bt;if(!_t&&Zt){var ir=ne.MISSING_INJECT_ANNOTATION+" argument "+vt+" in class "+Ve+".";throw new Error(ir)}var Fr=new G.Target(j.TargetTypeEnum.ConstructorArgument,N.targetName,Nr);return Fr.metadata=it,Fr}return null}function Ee(vt,_t,Ve,xt,st){for(var it=[],N=0;N<st;N++){var Re=N,Nr=Me(Re,vt,_t,Ve,xt);Nr!==null&&it.push(Nr)}return it}function Mt(vt,_t){for(var Ve=vt.getPropertiesMetadata(_t),xt=[],st=Object.keys(Ve),it=0,N=st;it<N.length;it++){var Re=N[it],Nr=Ve[Re],Pr=ht(Ve[Re]),Wt=Pr.targetName||Re,Oe=Pr.inject||Pr.multiInject,Bt=new G.Target(j.TargetTypeEnum.ClassProperty,Wt,Oe);Bt.metadata=Nr,xt.push(Bt)}var Zt=Object.getPrototypeOf(_t.prototype).constructor;if(Zt!==Object){var ir=Mt(vt,Zt);xt=W(W([],xt),ir)}return xt}function at(vt,_t){var Ve=Object.getPrototypeOf(_t.prototype).constructor;if(Ve!==Object){var xt=U.getFunctionName(Ve),st=xe(vt,xt,Ve,!0),it=st.map(function(Nr){return Nr.metadata.filter(function(Pr){return Pr.key===m.UNMANAGED_TAG})}),N=[].concat.apply([],it).length,Re=st.length-N;return Re>0?Re:at(vt,Ve)}else return 0}K.getBaseClassDependencyCount=at;function ht(vt){var _t={};return vt.forEach(function(Ve){_t[Ve.key.toString()]=Ve.value}),{inject:_t[m.INJECT_TAG],multiInject:_t[m.MULTI_INJECT_TAG],targetName:_t[m.NAME_TAG],unmanaged:_t[m.UNMANAGED_TAG]}}},fo6e:function(He,K){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function W(re){return O.test(re)}He.exports=W},g4R6:function(He,K){function O(W,re,ne){return W===W&&(ne!==void 0&&(W=W<=ne?W:ne),re!==void 0&&(W=W>=re?W:re)),W}He.exports=O},gFfm:function(He,K){function O(W,re){for(var ne=-1,j=W==null?0:W.length;++ne<j&&re(W[ne],ne,W)!==!1;);return W}He.exports=O},gzZq:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingToSyntax=void 0;var W=O("MON2"),re=O("FV85"),ne=O("D9lx"),j=O("LKzl"),m=function(){function U(G){this._binding=G}return U.prototype.to=function(G){return this._binding.type=re.BindingTypeEnum.Instance,this._binding.implementationType=G,new ne.BindingInWhenOnSyntax(this._binding)},U.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+W.INVALID_TO_SELF_VALUE);var G=this._binding.serviceIdentifier;return this.to(G)},U.prototype.toConstantValue=function(G){return this._binding.type=re.BindingTypeEnum.ConstantValue,this._binding.cache=G,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=re.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},U.prototype.toDynamicValue=function(G){return this._binding.type=re.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=G,this._binding.implementationType=null,new ne.BindingInWhenOnSyntax(this._binding)},U.prototype.toConstructor=function(G){return this._binding.type=re.BindingTypeEnum.Constructor,this._binding.implementationType=G,this._binding.scope=re.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},U.prototype.toFactory=function(G){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=G,this._binding.scope=re.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},U.prototype.toFunction=function(G){if(typeof G!="function")throw new Error(W.INVALID_FUNCTION_BINDING);var Te=this.toConstantValue(G);return this._binding.type=re.BindingTypeEnum.Function,this._binding.scope=re.BindingScopeEnum.Singleton,Te},U.prototype.toAutoFactory=function(G){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=function(Te){var xe=function(){return Te.container.get(G)};return xe},this._binding.scope=re.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},U.prototype.toProvider=function(G){return this._binding.type=re.BindingTypeEnum.Provider,this._binding.provider=G,this._binding.scope=re.BindingScopeEnum.Singleton,new j.BindingWhenOnSyntax(this._binding)},U.prototype.toService=function(G){this.toDynamicValue(function(Te){return Te.container.get(G)})},U}();K.BindingToSyntax=m},h7MG:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.getBindingDictionary=K.createMockRequest=K.plan=void 0;var W=O("doU7"),re=O("MON2"),ne=O("FV85"),j=O("xfSm"),m=O("qK8v"),U=O("ujMp"),G=O("oy+k"),Te=O("GXnB"),xe=O("yMAV"),Me=O("fbrv"),Ee=O("xiII"),Mt=O("dX1H");function at(N){return N._bindingDictionary}K.getBindingDictionary=at;function ht(N,Re,Nr,Pr,Wt,Oe){var Bt=N?j.MULTI_INJECT_TAG:j.INJECT_TAG,Zt=new Te.Metadata(Bt,Nr),ir=new Mt.Target(Re,Pr,Nr,Zt);if(Wt!==void 0){var Fr=new Te.Metadata(Wt,Oe);ir.metadata.push(Fr)}return ir}function vt(N,Re,Nr,Pr,Wt){var Oe=xt(Nr.container,Wt.serviceIdentifier),Bt=[];return Oe.length===W.BindingCount.NoBindingsAvailable&&Nr.container.options.autoBindInjectable&&typeof Wt.serviceIdentifier=="function"&&N.getConstructorMetadata(Wt.serviceIdentifier).compilerGeneratedMetadata&&(Nr.container.bind(Wt.serviceIdentifier).toSelf(),Oe=xt(Nr.container,Wt.serviceIdentifier)),Re?Bt=Oe:Bt=Oe.filter(function(Zt){var ir=new Ee.Request(Zt.serviceIdentifier,Nr,Pr,Zt,Wt);return Zt.constraint(ir)}),_t(Wt.serviceIdentifier,Bt,Wt,Nr.container),Bt}function _t(N,Re,Nr,Pr){switch(Re.length){case W.BindingCount.NoBindingsAvailable:if(Nr.isOptional())return Re;var Wt=U.getServiceIdentifierAsString(N),Oe=re.NOT_REGISTERED;throw Oe+=U.listMetadataForTarget(Wt,Nr),Oe+=U.listRegisteredBindingsForServiceIdentifier(Pr,Wt,xt),new Error(Oe);case W.BindingCount.OnlyOneBindingAvailable:if(!Nr.isArray())return Re;case W.BindingCount.MultipleBindingsAvailable:default:if(Nr.isArray())return Re;var Wt=U.getServiceIdentifierAsString(N),Oe=re.AMBIGUOUS_MATCH+" "+Wt;throw Oe+=U.listRegisteredBindingsForServiceIdentifier(Pr,Wt,xt),new Error(Oe)}}function Ve(N,Re,Nr,Pr,Wt,Oe){var Bt,Zt;if(Wt===null){Bt=vt(N,Re,Pr,null,Oe),Zt=new Ee.Request(Nr,Pr,null,Bt,Oe);var ir=new xe.Plan(Pr,Zt);Pr.addPlan(ir)}else Bt=vt(N,Re,Pr,Wt,Oe),Zt=Wt.addChildRequest(Oe.serviceIdentifier,Bt,Oe);Bt.forEach(function(Fr){var qr=null;if(Oe.isArray())qr=Zt.addChildRequest(Fr.serviceIdentifier,Fr,Oe);else{if(Fr.cache)return;qr=Zt}if(Fr.type===ne.BindingTypeEnum.Instance&&Fr.implementationType!==null){var br=Me.getDependencies(N,Fr.implementationType);if(!Pr.container.options.skipBaseClassChecks){var fe=Me.getBaseClassDependencyCount(N,Fr.implementationType);if(br.length<fe){var Pe=re.ARGUMENTS_LENGTH_MISMATCH(Me.getFunctionName(Fr.implementationType));throw new Error(Pe)}}br.forEach(function(Se){Ve(N,!1,Se.serviceIdentifier,Pr,qr,Se)})}})}function xt(N,Re){var Nr=[],Pr=at(N);return Pr.hasKey(Re)?Nr=Pr.get(Re):N.parent!==null&&(Nr=xt(N.parent,Re)),Nr}function st(N,Re,Nr,Pr,Wt,Oe,Bt,Zt){Zt===void 0&&(Zt=!1);var ir=new G.Context(Re),Fr=ht(Nr,Pr,Wt,"",Oe,Bt);try{return Ve(N,Zt,Wt,ir,null,Fr),ir}catch(qr){throw m.isStackOverflowExeption(qr)&&ir.plan&&U.circularDependencyToException(ir.plan.rootRequest),qr}}K.plan=st;function it(N,Re,Nr,Pr){var Wt=new Mt.Target(ne.TargetTypeEnum.Variable,"",Re,new Te.Metadata(Nr,Pr)),Oe=new G.Context(N),Bt=new Ee.Request(Re,Oe,null,[],Wt);return Bt}K.createMockRequest=it},hi0z:function(He,K,O){"use strict";(function(W,re){He.exports=re()})(this,function(){function W(Me){var Ee=[];return Me.AMapUI&&Ee.push(re(Me.AMapUI)),Me.Loca&&Ee.push(ne(Me.Loca)),Promise.all(Ee)}function re(Me){return new Promise(function(Ee,Mt){var at=[];if(Me.plugins)for(var ht=0;ht<Me.plugins.length;ht+=1)m.AMapUI.plugins.indexOf(Me.plugins[ht])==-1&&at.push(Me.plugins[ht]);if(U.AMapUI===j.failed)Mt("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(U.AMapUI===j.notload){U.AMapUI=j.loading,m.AMapUI.version=Me.version||m.AMapUI.version,ht=m.AMapUI.version;var vt=document.body||document.head,_t=document.createElement("script");_t.type="text/javascript",_t.src="https://webapi.amap.com/ui/"+ht+"/main.js",_t.onerror=function(Ve){U.AMapUI=j.failed,Mt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},_t.onload=function(){if(U.AMapUI=j.loaded,at.length)window.AMapUI.loadUI(at,function(){for(var Ve=0,xt=at.length;Ve<xt;Ve++){var st=at[Ve].split("/").slice(-1)[0];window.AMapUI[st]=arguments[Ve]}for(Ee();G.AMapUI.length;)G.AMapUI.splice(0,1)[0]()});else for(Ee();G.AMapUI.length;)G.AMapUI.splice(0,1)[0]()},vt.appendChild(_t)}else U.AMapUI===j.loaded?Me.version&&Me.version!==m.AMapUI.version?Mt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):at.length?window.AMapUI.loadUI(at,function(){for(var Ve=0,xt=at.length;Ve<xt;Ve++){var st=at[Ve].split("/").slice(-1)[0];window.AMapUI[st]=arguments[Ve]}Ee()}):Ee():Me.version&&Me.version!==m.AMapUI.version?Mt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):G.AMapUI.push(function(Ve){Ve?Mt(Ve):at.length?window.AMapUI.loadUI(at,function(){for(var xt=0,st=at.length;xt<st;xt++){var it=at[xt].split("/").slice(-1)[0];window.AMapUI[it]=arguments[xt]}Ee()}):Ee()})})}function ne(Me){return new Promise(function(Ee,Mt){if(m.AMap.version.startsWith("2.0"))Mt("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(U.Loca===j.failed)Mt("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(U.Loca===j.notload){U.Loca=j.loading,m.Loca.version=Me.version||m.Loca.version;var at=m.Loca.version,ht=m.key,vt=document.body||document.head,_t=document.createElement("script");_t.type="text/javascript",_t.src="https://webapi.amap.com/loca?v="+at+"&key="+ht,_t.onerror=function(Ve){U.Loca=j.failed,Mt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},_t.onload=function(){for(U.Loca=j.loaded,Ee();G.Loca.length;)G.Loca.splice(0,1)[0]()},vt.appendChild(_t)}else U.Loca===j.loaded?Me.version&&Me.version!==m.Loca.version?Mt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):Ee():Me.version&&Me.version!==m.Loca.version?Mt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):G.Loca.push(function(Ve){Ve?Mt(Ve):Mt()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var j;(function(Me){Me.notload="notload",Me.loading="loading",Me.loaded="loaded",Me.failed="failed"})(j||(j={}));var m={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},U={AMap:j.notload,AMapUI:j.notload,Loca:j.notload},G={AMap:[],AMapUI:[],Loca:[]},Te=[],xe=function(Ee){typeof Ee=="function"&&(U.AMap===j.loaded?Ee(window.AMap):Te.push(Ee))};return{load:function(Ee){return new Promise(function(Mt,at){if(U.AMap==j.failed)at("");else if(U.AMap==j.notload){var ht=Ee.key,vt=Ee.version,_t=Ee.plugins;ht?(window.AMap&&location.host!=="lbs.amap.com"&&at("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),m.key=ht,m.AMap.version=vt||m.AMap.version,m.AMap.plugins=_t||m.AMap.plugins,U.AMap=j.loading,vt=document.body||document.head,window.___onAPILoaded=function(xt){if(delete window.___onAPILoaded,xt)U.AMap=j.failed,at(xt);else for(U.AMap=j.loaded,W(Ee).then(function(){Mt(window.AMap)}).catch(at);Te.length;)Te.splice(0,1)[0]()},_t=document.createElement("script"),_t.type="text/javascript",_t.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+m.AMap.version+"&key="+ht+"&plugin="+m.AMap.plugins.join(","),_t.onerror=function(xt){U.AMap=j.failed,at(xt)},vt.appendChild(_t)):at("\u8BF7\u586B\u5199key")}else if(U.AMap==j.loaded)if(Ee.key&&Ee.key!==m.key)at("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Ee.version&&Ee.version!==m.AMap.version)at("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(ht=[],Ee.plugins)for(vt=0;vt<Ee.plugins.length;vt+=1)m.AMap.plugins.indexOf(Ee.plugins[vt])==-1&&ht.push(Ee.plugins[vt]);ht.length?window.AMap.plugin(ht,function(){W(Ee).then(function(){Mt(window.AMap)}).catch(at)}):W(Ee).then(function(){Mt(window.AMap)}).catch(at)}else if(Ee.key&&Ee.key!==m.key)at("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(Ee.version&&Ee.version!==m.AMap.version)at("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var Ve=[];if(Ee.plugins)for(vt=0;vt<Ee.plugins.length;vt+=1)m.AMap.plugins.indexOf(Ee.plugins[vt])==-1&&Ve.push(Ee.plugins[vt]);xe(function(){Ve.length?window.AMap.plugin(Ve,function(){W(Ee).then(function(){Mt(window.AMap)}).catch(at)}):W(Ee).then(function(){Mt(window.AMap)}).catch(at)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,m={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},U={AMap:j.notload,AMapUI:j.notload,Loca:j.notload},G={AMap:[],AMapUI:[],Loca:[]}}}})},iegG:function(He,K){function O(re){var ne=re.target||re.srcElement;ne.__resizeRAF__&&cancelAnimationFrame(ne.__resizeRAF__),ne.__resizeRAF__=requestAnimationFrame(function(){var j=ne.__resizeTrigger__,m=j&&j.__resizeListeners__;m&&m.forEach(function(U){U.call(j,re)})})}var W=function(ne,j){var m=this,U=m.document,G,Te=U.attachEvent;typeof navigator!="undefined"&&(G=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function xe(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!ne.__resizeListeners__)if(ne.__resizeListeners__=[],Te)ne.__resizeTrigger__=ne,ne.attachEvent("onresize",O);else{getComputedStyle(ne).position==="static"&&(ne.style.position="relative");var Me=ne.__resizeTrigger__=U.createElement("object");Me.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),Me.setAttribute("class","resize-sensor"),Me.setAttribute("tabindex","-1"),Me.setAttribute("title",""),Me.__resizeElement__=ne,Me.onload=xe,Me.type="text/html",G&&ne.appendChild(Me),Me.data="about:blank",G||ne.appendChild(Me)}ne.__resizeListeners__.push(j)};He.exports=typeof window=="undefined"?W:W.bind(window),He.exports.unbind=function(re,ne){var j=document.attachEvent,m=re.__resizeListeners__||[];if(ne){var U=m.indexOf(ne);U!==-1&&m.splice(U,1)}else m=re.__resizeListeners__=[];if(!m.length){if(j)re.detachEvent("onresize",O);else if(re.__resizeTrigger__){var G=re.__resizeTrigger__.contentDocument,Te=G&&G.defaultView;Te&&(Te.removeEventListener("resize",O),delete Te.__resizeTrigger__),re.__resizeTrigger__=!re.removeChild(re.__resizeTrigger__)}delete re.__resizeListeners__}}},"iz+Y":function(He,K,O){He.exports={miniChart:"miniChart___27WlV",chartContent:"chartContent___2FNqq",chartLoading:"chartLoading___2DxhP"}},"jIg/":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.multiInject=void 0;var W=O("xfSm"),re=O("GXnB"),ne=O("Ztfv");function j(m){return function(U,G,Te){var xe=new re.Metadata(W.MULTI_INJECT_TAG,m);typeof Te=="number"?ne.tagParameter(U,G,Te,xe):ne.tagProperty(U,G,xe)}}K.multiInject=j},jYQm:function(He,K,O){"use strict";var W=O("q1tI"),re=O.n(W),ne=Object(W.createContext)({});K.a=ne},jYx5:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.optional=void 0;var W=O("xfSm"),re=O("GXnB"),ne=O("Ztfv");function j(){return function(m,U,G){var Te=new re.Metadata(W.OPTIONAL_TAG,!0);typeof G=="number"?ne.tagParameter(m,U,G,Te):ne.tagProperty(m,U,Te)}}K.optional=j},"jbM+":function(He,K,O){var W=O("R/W3");function re(ne,j){var m=ne==null?0:ne.length;return!!m&&W(ne,j,0)>-1}He.exports=re},mNvP:function(He,K,O){(function(W,re){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ne;(function(j){(function(m){var U=typeof re=="object"?re:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),G=Te(j);typeof U.Reflect=="undefined"?U.Reflect=j:G=Te(U.Reflect,G),m(G);function Te(xe,Me){return function(Ee,Mt){typeof xe[Ee]!="function"&&Object.defineProperty(xe,Ee,{configurable:!0,writable:!0,value:Mt}),Me&&Me(Ee,Mt)}}})(function(m){var U=Object.prototype.hasOwnProperty,G=typeof Symbol=="function",Te=G&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",xe=G&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",Me=typeof Object.create=="function",Ee={__proto__:[]}instanceof Array,Mt=!Me&&!Ee,at={create:Me?function(){return us(Object.create(null))}:Ee?function(){return us({__proto__:null})}:function(){return us({})},has:Mt?function(Ut,Er){return U.call(Ut,Er)}:function(Ut,Er){return Er in Ut},get:Mt?function(Ut,Er){return U.call(Ut,Er)?Ut[Er]:void 0}:function(Ut,Er){return Ut[Er]}},ht=Object.getPrototypeOf(Function),vt=typeof W=="object"&&Object({NODE_ENV:"production"})&&Object({NODE_ENV:"production"}).REFLECT_METADATA_USE_MAP_POLYFILL==="true",_t=!vt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Fn(),Ve=!vt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Li(),xt=!vt&&typeof WeakMap=="function"?WeakMap:Ko(),st=new xt;function it(Ut,Er,Hr,dn){if(Or(Hr)){if(!Ir(Ut))throw new TypeError;if(!Rr(Er))throw new TypeError;return Fr(Ut,Er)}else{if(!Ir(Ut))throw new TypeError;if(!It(Er))throw new TypeError;if(!It(dn)&&!Or(dn)&&!Nt(dn))throw new TypeError;return Nt(dn)&&(dn=void 0),Hr=Ur(Hr),qr(Ut,Er,Hr,dn)}}m("decorate",it);function N(Ut,Er){function Hr(dn,Kr){if(!It(dn))throw new TypeError;if(!Or(Kr)&&!Yn(Kr))throw new TypeError;ut(Ut,Er,dn,Kr)}return Hr}m("metadata",N);function Re(Ut,Er,Hr,dn){if(!It(Hr))throw new TypeError;return Or(dn)||(dn=Ur(dn)),ut(Ut,Er,Hr,dn)}m("defineMetadata",Re);function Nr(Ut,Er,Hr){if(!It(Er))throw new TypeError;return Or(Hr)||(Hr=Ur(Hr)),fe(Ut,Er,Hr)}m("hasMetadata",Nr);function Pr(Ut,Er,Hr){if(!It(Er))throw new TypeError;return Or(Hr)||(Hr=Ur(Hr)),Pe(Ut,Er,Hr)}m("hasOwnMetadata",Pr);function Wt(Ut,Er,Hr){if(!It(Er))throw new TypeError;return Or(Hr)||(Hr=Ur(Hr)),Se(Ut,Er,Hr)}m("getMetadata",Wt);function Oe(Ut,Er,Hr){if(!It(Er))throw new TypeError;return Or(Hr)||(Hr=Ur(Hr)),lt(Ut,Er,Hr)}m("getOwnMetadata",Oe);function Bt(Ut,Er){if(!It(Ut))throw new TypeError;return Or(Er)||(Er=Ur(Er)),Ot(Ut,Er)}m("getMetadataKeys",Bt);function Zt(Ut,Er){if(!It(Ut))throw new TypeError;return Or(Er)||(Er=Ur(Er)),wt(Ut,Er)}m("getOwnMetadataKeys",Zt);function ir(Ut,Er,Hr){if(!It(Er))throw new TypeError;Or(Hr)||(Hr=Ur(Hr));var dn=br(Er,Hr,!1);if(Or(dn)||!dn.delete(Ut))return!1;if(dn.size>0)return!0;var Kr=st.get(Er);return Kr.delete(Hr),Kr.size>0||st.delete(Er),!0}m("deleteMetadata",ir);function Fr(Ut,Er){for(var Hr=Ut.length-1;Hr>=0;--Hr){var dn=Ut[Hr],Kr=dn(Er);if(!Or(Kr)&&!Nt(Kr)){if(!Rr(Kr))throw new TypeError;Er=Kr}}return Er}function qr(Ut,Er,Hr,dn){for(var Kr=Ut.length-1;Kr>=0;--Kr){var Ia=Ut[Kr],li=Ia(Er,Hr,dn);if(!Or(li)&&!Nt(li)){if(!It(li))throw new TypeError;dn=li}}return dn}function br(Ut,Er,Hr){var dn=st.get(Ut);if(Or(dn)){if(!Hr)return;dn=new _t,st.set(Ut,dn)}var Kr=dn.get(Er);if(Or(Kr)){if(!Hr)return;Kr=new _t,dn.set(Er,Kr)}return Kr}function fe(Ut,Er,Hr){var dn=Pe(Ut,Er,Hr);if(dn)return!0;var Kr=he(Er);return Nt(Kr)?!1:fe(Ut,Kr,Hr)}function Pe(Ut,Er,Hr){var dn=br(Er,Hr,!1);return Or(dn)?!1:qt(dn.has(Ut))}function Se(Ut,Er,Hr){var dn=Pe(Ut,Er,Hr);if(dn)return lt(Ut,Er,Hr);var Kr=he(Er);if(!Nt(Kr))return Se(Ut,Kr,Hr)}function lt(Ut,Er,Hr){var dn=br(Er,Hr,!1);if(!Or(dn))return dn.get(Ut)}function ut(Ut,Er,Hr,dn){var Kr=br(Hr,dn,!0);Kr.set(Ut,Er)}function Ot(Ut,Er){var Hr=wt(Ut,Er),dn=he(Ut);if(dn===null)return Hr;var Kr=Ot(dn,Er);if(Kr.length<=0)return Hr;if(Hr.length<=0)return Kr;for(var Ia=new Ve,li=[],Hn=0,ii=Hr;Hn<ii.length;Hn++){var Hi=ii[Hn],Wi=Ia.has(Hi);Wi||(Ia.add(Hi),li.push(Hi))}for(var To=0,Wa=Kr;To<Wa.length;To++){var Hi=Wa[To],Wi=Ia.has(Hi);Wi||(Ia.add(Hi),li.push(Hi))}return li}function wt(Ut,Er){var Hr=[],dn=br(Ut,Er,!1);if(Or(dn))return Hr;for(var Kr=dn.keys(),Ia=_n(Kr),li=0;;){var Hn=oi(Ia);if(!Hn)return Hr.length=li,Hr;var ii=qn(Hn);try{Hr[li]=ii}catch(Hi){try{Gi(Ia)}finally{throw Hi}}li++}}function sr(Ut){if(Ut===null)return 1;switch(typeof Ut){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ut===null?1:6;default:return 6}}function Or(Ut){return Ut===void 0}function Nt(Ut){return Ut===null}function Tt(Ut){return typeof Ut=="symbol"}function It(Ut){return typeof Ut=="object"?Ut!==null:typeof Ut=="function"}function $t(Ut,Er){switch(sr(Ut)){case 0:return Ut;case 1:return Ut;case 2:return Ut;case 3:return Ut;case 4:return Ut;case 5:return Ut}var Hr=Er===3?"string":Er===5?"number":"default",dn=un(Ut,Te);if(dn!==void 0){var Kr=dn.call(Ut,Hr);if(It(Kr))throw new TypeError;return Kr}return gr(Ut,Hr==="default"?"number":Hr)}function gr(Ut,Er){if(Er==="string"){var Hr=Ut.toString;if(ur(Hr)){var dn=Hr.call(Ut);if(!It(dn))return dn}var Kr=Ut.valueOf;if(ur(Kr)){var dn=Kr.call(Ut);if(!It(dn))return dn}}else{var Kr=Ut.valueOf;if(ur(Kr)){var dn=Kr.call(Ut);if(!It(dn))return dn}var Ia=Ut.toString;if(ur(Ia)){var dn=Ia.call(Ut);if(!It(dn))return dn}}throw new TypeError}function qt(Ut){return!!Ut}function dr(Ut){return""+Ut}function Ur(Ut){var Er=$t(Ut,3);return Tt(Er)?Er:dr(Er)}function Ir(Ut){return Array.isArray?Array.isArray(Ut):Ut instanceof Object?Ut instanceof Array:Object.prototype.toString.call(Ut)==="[object Array]"}function ur(Ut){return typeof Ut=="function"}function Rr(Ut){return typeof Ut=="function"}function Yn(Ut){switch(sr(Ut)){case 3:return!0;case 4:return!0;default:return!1}}function un(Ut,Er){var Hr=Ut[Er];if(Hr!=null){if(!ur(Hr))throw new TypeError;return Hr}}function _n(Ut){var Er=un(Ut,xe);if(!ur(Er))throw new TypeError;var Hr=Er.call(Ut);if(!It(Hr))throw new TypeError;return Hr}function qn(Ut){return Ut.value}function oi(Ut){var Er=Ut.next();return Er.done?!1:Er}function Gi(Ut){var Er=Ut.return;Er&&Er.call(Ut)}function he(Ut){var Er=Object.getPrototypeOf(Ut);if(typeof Ut!="function"||Ut===ht||Er!==ht)return Er;var Hr=Ut.prototype,dn=Hr&&Object.getPrototypeOf(Hr);if(dn==null||dn===Object.prototype)return Er;var Kr=dn.constructor;return typeof Kr!="function"||Kr===Ut?Er:Kr}function Fn(){var Ut={},Er=[],Hr=function(){function li(Hn,ii,Hi){this._index=0,this._keys=Hn,this._values=ii,this._selector=Hi}return li.prototype["@@iterator"]=function(){return this},li.prototype[xe]=function(){return this},li.prototype.next=function(){var Hn=this._index;if(Hn>=0&&Hn<this._keys.length){var ii=this._selector(this._keys[Hn],this._values[Hn]);return Hn+1>=this._keys.length?(this._index=-1,this._keys=Er,this._values=Er):this._index++,{value:ii,done:!1}}return{value:void 0,done:!0}},li.prototype.throw=function(Hn){throw this._index>=0&&(this._index=-1,this._keys=Er,this._values=Er),Hn},li.prototype.return=function(Hn){return this._index>=0&&(this._index=-1,this._keys=Er,this._values=Er),{value:Hn,done:!0}},li}();return function(){function li(){this._keys=[],this._values=[],this._cacheKey=Ut,this._cacheIndex=-2}return Object.defineProperty(li.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),li.prototype.has=function(Hn){return this._find(Hn,!1)>=0},li.prototype.get=function(Hn){var ii=this._find(Hn,!1);return ii>=0?this._values[ii]:void 0},li.prototype.set=function(Hn,ii){var Hi=this._find(Hn,!0);return this._values[Hi]=ii,this},li.prototype.delete=function(Hn){var ii=this._find(Hn,!1);if(ii>=0){for(var Hi=this._keys.length,Wi=ii+1;Wi<Hi;Wi++)this._keys[Wi-1]=this._keys[Wi],this._values[Wi-1]=this._values[Wi];return this._keys.length--,this._values.length--,Hn===this._cacheKey&&(this._cacheKey=Ut,this._cacheIndex=-2),!0}return!1},li.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ut,this._cacheIndex=-2},li.prototype.keys=function(){return new Hr(this._keys,this._values,dn)},li.prototype.values=function(){return new Hr(this._keys,this._values,Kr)},li.prototype.entries=function(){return new Hr(this._keys,this._values,Ia)},li.prototype["@@iterator"]=function(){return this.entries()},li.prototype[xe]=function(){return this.entries()},li.prototype._find=function(Hn,ii){return this._cacheKey!==Hn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Hn)),this._cacheIndex<0&&ii&&(this._cacheIndex=this._keys.length,this._keys.push(Hn),this._values.push(void 0)),this._cacheIndex},li}();function dn(li,Hn){return li}function Kr(li,Hn){return Hn}function Ia(li,Hn){return[li,Hn]}}function Li(){return function(){function Ut(){this._map=new _t}return Object.defineProperty(Ut.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ut.prototype.has=function(Er){return this._map.has(Er)},Ut.prototype.add=function(Er){return this._map.set(Er,Er),this},Ut.prototype.delete=function(Er){return this._map.delete(Er)},Ut.prototype.clear=function(){this._map.clear()},Ut.prototype.keys=function(){return this._map.keys()},Ut.prototype.values=function(){return this._map.values()},Ut.prototype.entries=function(){return this._map.entries()},Ut.prototype["@@iterator"]=function(){return this.keys()},Ut.prototype[xe]=function(){return this.keys()},Ut}()}function Ko(){var Ut=16,Er=at.create(),Hr=dn();return function(){function ii(){this._key=dn()}return ii.prototype.has=function(Hi){var Wi=Kr(Hi,!1);return Wi!==void 0?at.has(Wi,this._key):!1},ii.prototype.get=function(Hi){var Wi=Kr(Hi,!1);return Wi!==void 0?at.get(Wi,this._key):void 0},ii.prototype.set=function(Hi,Wi){var To=Kr(Hi,!0);return To[this._key]=Wi,this},ii.prototype.delete=function(Hi){var Wi=Kr(Hi,!1);return Wi!==void 0?delete Wi[this._key]:!1},ii.prototype.clear=function(){this._key=dn()},ii}();function dn(){var ii;do ii="@@WeakMap@@"+Hn();while(at.has(Er,ii));return Er[ii]=!0,ii}function Kr(ii,Hi){if(!U.call(ii,Hr)){if(!Hi)return;Object.defineProperty(ii,Hr,{value:at.create()})}return ii[Hr]}function Ia(ii,Hi){for(var Wi=0;Wi<Hi;++Wi)ii[Wi]=Math.random()*255|0;return ii}function li(ii){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(ii)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(ii)):Ia(new Uint8Array(ii),ii):Ia(new Array(ii),ii)}function Hn(){var ii=li(Ut);ii[6]=ii[6]&79|64,ii[8]=ii[8]&191|128;for(var Hi="",Wi=0;Wi<Ut;++Wi){var To=ii[Wi];(Wi===4||Wi===6||Wi===8)&&(Hi+="-"),To<16&&(Hi+="0"),Hi+=To.toString(16).toLowerCase()}return Hi}}function us(Ut){return Ut.__=void 0,delete Ut.__,Ut}})})(ne||(ne={}))}).call(this,O("Q2Ig"),O("IyRk"))},mhV4:function(He,K,O){var W=O("ZK94");He.exports.geometry=re,He.exports.ring=j;function re(U){var G=0,Te;switch(U.type){case"Polygon":return ne(U.coordinates);case"MultiPolygon":for(Te=0;Te<U.coordinates.length;Te++)G+=ne(U.coordinates[Te]);return G;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Te=0;Te<U.geometries.length;Te++)G+=re(U.geometries[Te]);return G}}function ne(U){var G=0;if(U&&U.length>0){G+=Math.abs(j(U[0]));for(var Te=1;Te<U.length;Te++)G-=Math.abs(j(U[Te]))}return G}function j(U){var G,Te,xe,Me,Ee,Mt,at,ht=0,vt=U.length;if(vt>2){for(at=0;at<vt;at++)at===vt-2?(Me=vt-2,Ee=vt-1,Mt=0):at===vt-1?(Me=vt-1,Ee=0,Mt=1):(Me=at,Ee=at+1,Mt=at+2),G=U[Me],Te=U[Ee],xe=U[Mt],ht+=(m(xe[0])-m(G[0]))*Math.sin(m(Te[1]));ht=ht*W.RADIUS*W.RADIUS/2}return ht}function m(U){return U*Math.PI/180}},mpbz:function(He,K,O){(function(W,re){He.exports=re()})(this,function(){"use strict";function W(Wt,Oe,Bt,Zt,ir,Fr){if(!(ir-Zt<=Bt)){var qr=Zt+ir>>1;re(Wt,Oe,qr,Zt,ir,Fr%2),W(Wt,Oe,Bt,Zt,qr-1,Fr+1),W(Wt,Oe,Bt,qr+1,ir,Fr+1)}}function re(Wt,Oe,Bt,Zt,ir,Fr){for(;ir>Zt;){if(ir-Zt>600){var qr=ir-Zt+1,br=Bt-Zt+1,fe=Math.log(qr),Pe=.5*Math.exp(2*fe/3),Se=.5*Math.sqrt(fe*Pe*(qr-Pe)/qr)*(br-qr/2<0?-1:1),lt=Math.max(Zt,Math.floor(Bt-br*Pe/qr+Se)),ut=Math.min(ir,Math.floor(Bt+(qr-br)*Pe/qr+Se));re(Wt,Oe,Bt,lt,ut,Fr)}var Ot=Oe[2*Bt+Fr],wt=Zt,sr=ir;for(ne(Wt,Oe,Zt,Bt),Oe[2*ir+Fr]>Ot&&ne(Wt,Oe,Zt,ir);wt<sr;){for(ne(Wt,Oe,wt,sr),wt++,sr--;Oe[2*wt+Fr]<Ot;)wt++;for(;Oe[2*sr+Fr]>Ot;)sr--}Oe[2*Zt+Fr]===Ot?ne(Wt,Oe,Zt,sr):(sr++,ne(Wt,Oe,sr,ir)),sr<=Bt&&(Zt=sr+1),Bt<=sr&&(ir=sr-1)}}function ne(Wt,Oe,Bt,Zt){j(Wt,Bt,Zt),j(Oe,2*Bt,2*Zt),j(Oe,2*Bt+1,2*Zt+1)}function j(Wt,Oe,Bt){var Zt=Wt[Oe];Wt[Oe]=Wt[Bt],Wt[Bt]=Zt}function m(Wt,Oe,Bt,Zt,ir,Fr,qr){for(var br=[0,Wt.length-1,0],fe=[],Pe,Se;br.length;){var lt=br.pop(),ut=br.pop(),Ot=br.pop();if(ut-Ot<=qr){for(var wt=Ot;wt<=ut;wt++)Pe=Oe[2*wt],Se=Oe[2*wt+1],Pe>=Bt&&Pe<=ir&&Se>=Zt&&Se<=Fr&&fe.push(Wt[wt]);continue}var sr=Math.floor((Ot+ut)/2);Pe=Oe[2*sr],Se=Oe[2*sr+1],Pe>=Bt&&Pe<=ir&&Se>=Zt&&Se<=Fr&&fe.push(Wt[sr]);var Or=(lt+1)%2;(lt===0?Bt<=Pe:Zt<=Se)&&(br.push(Ot),br.push(sr-1),br.push(Or)),(lt===0?ir>=Pe:Fr>=Se)&&(br.push(sr+1),br.push(ut),br.push(Or))}return fe}function U(Wt,Oe,Bt,Zt,ir,Fr){for(var qr=[0,Wt.length-1,0],br=[],fe=ir*ir;qr.length;){var Pe=qr.pop(),Se=qr.pop(),lt=qr.pop();if(Se-lt<=Fr){for(var ut=lt;ut<=Se;ut++)G(Oe[2*ut],Oe[2*ut+1],Bt,Zt)<=fe&&br.push(Wt[ut]);continue}var Ot=Math.floor((lt+Se)/2),wt=Oe[2*Ot],sr=Oe[2*Ot+1];G(wt,sr,Bt,Zt)<=fe&&br.push(Wt[Ot]);var Or=(Pe+1)%2;(Pe===0?Bt-ir<=wt:Zt-ir<=sr)&&(qr.push(lt),qr.push(Ot-1),qr.push(Or)),(Pe===0?Bt+ir>=wt:Zt+ir>=sr)&&(qr.push(Ot+1),qr.push(Se),qr.push(Or))}return br}function G(Wt,Oe,Bt,Zt){var ir=Wt-Bt,Fr=Oe-Zt;return ir*ir+Fr*Fr}var Te=function(Oe){return Oe[0]},xe=function(Oe){return Oe[1]},Me=function(Oe,Bt,Zt,ir,Fr){Bt===void 0&&(Bt=Te),Zt===void 0&&(Zt=xe),ir===void 0&&(ir=64),Fr===void 0&&(Fr=Float64Array),this.nodeSize=ir,this.points=Oe;for(var qr=Oe.length<65536?Uint16Array:Uint32Array,br=this.ids=new qr(Oe.length),fe=this.coords=new Fr(Oe.length*2),Pe=0;Pe<Oe.length;Pe++)br[Pe]=Pe,fe[2*Pe]=Bt(Oe[Pe]),fe[2*Pe+1]=Zt(Oe[Pe]);W(br,fe,ir,0,br.length-1,0)};Me.prototype.range=function(Oe,Bt,Zt,ir){return m(this.ids,this.coords,Oe,Bt,Zt,ir,this.nodeSize)},Me.prototype.within=function(Oe,Bt,Zt){return U(this.ids,this.coords,Oe,Bt,Zt,this.nodeSize)};var Ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Oe){return Oe}},Mt=Math.fround||function(Wt){return function(Oe){return Wt[0]=+Oe,Wt[0]}}(new Float32Array(1)),at=function(Oe){this.options=Re(Object.create(Ee),Oe),this.trees=new Array(this.options.maxZoom+1)};at.prototype.load=function(Oe){var Bt=this.options,Zt=Bt.log,ir=Bt.minZoom,Fr=Bt.maxZoom,qr=Bt.nodeSize;Zt&&console.time("total time");var br="prepare "+Oe.length+" points";Zt&&console.time(br),this.points=Oe;for(var fe=[],Pe=0;Pe<Oe.length;Pe++)!Oe[Pe].geometry||fe.push(vt(Oe[Pe],Pe));this.trees[Fr+1]=new Me(fe,Nr,Pr,qr,Float32Array),Zt&&console.timeEnd(br);for(var Se=Fr;Se>=ir;Se--){var lt=+Date.now();fe=this._cluster(fe,Se),this.trees[Se]=new Me(fe,Nr,Pr,qr,Float32Array),Zt&&console.log("z%d: %d clusters in %dms",Se,fe.length,+Date.now()-lt)}return Zt&&console.timeEnd("total time"),this},at.prototype.getClusters=function(Oe,Bt){var Zt=((Oe[0]+180)%360+360)%360-180,ir=Math.max(-90,Math.min(90,Oe[1])),Fr=Oe[2]===180?180:((Oe[2]+180)%360+360)%360-180,qr=Math.max(-90,Math.min(90,Oe[3]));if(Oe[2]-Oe[0]>=360)Zt=-180,Fr=180;else if(Zt>Fr){var br=this.getClusters([Zt,ir,180,qr],Bt),fe=this.getClusters([-180,ir,Fr,qr],Bt);return br.concat(fe)}for(var Pe=this.trees[this._limitZoom(Bt)],Se=Pe.range(xt(Zt),st(qr),xt(Fr),st(ir)),lt=[],ut=0,Ot=Se;ut<Ot.length;ut+=1){var wt=Ot[ut],sr=Pe.points[wt];lt.push(sr.numPoints?_t(sr):this.points[sr.index])}return lt},at.prototype.getChildren=function(Oe){var Bt=this._getOriginId(Oe),Zt=this._getOriginZoom(Oe),ir="No cluster with the specified id.",Fr=this.trees[Zt];if(!Fr)throw new Error(ir);var qr=Fr.points[Bt];if(!qr)throw new Error(ir);for(var br=this.options.radius/(this.options.extent*Math.pow(2,Zt-1)),fe=Fr.within(qr.x,qr.y,br),Pe=[],Se=0,lt=fe;Se<lt.length;Se+=1){var ut=lt[Se],Ot=Fr.points[ut];Ot.parentId===Oe&&Pe.push(Ot.numPoints?_t(Ot):this.points[Ot.index])}if(Pe.length===0)throw new Error(ir);return Pe},at.prototype.getLeaves=function(Oe,Bt,Zt){Bt=Bt||10,Zt=Zt||0;var ir=[];return this._appendLeaves(ir,Oe,Bt,Zt,0),ir},at.prototype.getTile=function(Oe,Bt,Zt){var ir=this.trees[this._limitZoom(Oe)],Fr=Math.pow(2,Oe),qr=this.options,br=qr.extent,fe=qr.radius,Pe=fe/br,Se=(Zt-Pe)/Fr,lt=(Zt+1+Pe)/Fr,ut={features:[]};return this._addTileFeatures(ir.range((Bt-Pe)/Fr,Se,(Bt+1+Pe)/Fr,lt),ir.points,Bt,Zt,Fr,ut),Bt===0&&this._addTileFeatures(ir.range(1-Pe/Fr,Se,1,lt),ir.points,Fr,Zt,Fr,ut),Bt===Fr-1&&this._addTileFeatures(ir.range(0,Se,Pe/Fr,lt),ir.points,-1,Zt,Fr,ut),ut.features.length?ut:null},at.prototype.getClusterExpansionZoom=function(Oe){for(var Bt=this._getOriginZoom(Oe)-1;Bt<=this.options.maxZoom;){var Zt=this.getChildren(Oe);if(Bt++,Zt.length!==1)break;Oe=Zt[0].properties.cluster_id}return Bt},at.prototype._appendLeaves=function(Oe,Bt,Zt,ir,Fr){for(var qr=this.getChildren(Bt),br=0,fe=qr;br<fe.length;br+=1){var Pe=fe[br],Se=Pe.properties;if(Se&&Se.cluster?Fr+Se.point_count<=ir?Fr+=Se.point_count:Fr=this._appendLeaves(Oe,Se.cluster_id,Zt,ir,Fr):Fr<ir?Fr++:Oe.push(Pe),Oe.length===Zt)break}return Fr},at.prototype._addTileFeatures=function(Oe,Bt,Zt,ir,Fr,qr){for(var br=0,fe=Oe;br<fe.length;br+=1){var Pe=fe[br],Se=Bt[Pe],lt=Se.numPoints,ut=void 0,Ot=void 0,wt=void 0;if(lt)ut=Ve(Se),Ot=Se.x,wt=Se.y;else{var sr=this.points[Se.index];ut=sr.properties,Ot=xt(sr.geometry.coordinates[0]),wt=st(sr.geometry.coordinates[1])}var Or={type:1,geometry:[[Math.round(this.options.extent*(Ot*Fr-Zt)),Math.round(this.options.extent*(wt*Fr-ir))]],tags:ut},Nt=void 0;lt?Nt=Se.id:this.options.generateId?Nt=Se.index:this.points[Se.index].id&&(Nt=this.points[Se.index].id),Nt!==void 0&&(Or.id=Nt),qr.features.push(Or)}},at.prototype._limitZoom=function(Oe){return Math.max(this.options.minZoom,Math.min(+Oe,this.options.maxZoom+1))},at.prototype._cluster=function(Oe,Bt){for(var Zt=[],ir=this.options,Fr=ir.radius,qr=ir.extent,br=ir.reduce,fe=ir.minPoints,Pe=Fr/(qr*Math.pow(2,Bt)),Se=0;Se<Oe.length;Se++){var lt=Oe[Se];if(!(lt.zoom<=Bt)){lt.zoom=Bt;for(var ut=this.trees[Bt+1],Ot=ut.within(lt.x,lt.y,Pe),wt=lt.numPoints||1,sr=wt,Or=0,Nt=Ot;Or<Nt.length;Or+=1){var Tt=Nt[Or],It=ut.points[Tt];It.zoom>Bt&&(sr+=It.numPoints||1)}if(sr>wt&&sr>=fe){for(var $t=lt.x*wt,gr=lt.y*wt,qt=br&&wt>1?this._map(lt,!0):null,dr=(Se<<5)+(Bt+1)+this.points.length,Ur=0,Ir=Ot;Ur<Ir.length;Ur+=1){var ur=Ir[Ur],Rr=ut.points[ur];if(!(Rr.zoom<=Bt)){Rr.zoom=Bt;var Yn=Rr.numPoints||1;$t+=Rr.x*Yn,gr+=Rr.y*Yn,Rr.parentId=dr,br&&(qt||(qt=this._map(lt,!0)),br(qt,this._map(Rr)))}}lt.parentId=dr,Zt.push(ht($t/sr,gr/sr,dr,sr,qt))}else if(Zt.push(lt),sr>1)for(var un=0,_n=Ot;un<_n.length;un+=1){var qn=_n[un],oi=ut.points[qn];oi.zoom<=Bt||(oi.zoom=Bt,Zt.push(oi))}}}return Zt},at.prototype._getOriginId=function(Oe){return Oe-this.points.length>>5},at.prototype._getOriginZoom=function(Oe){return(Oe-this.points.length)%32},at.prototype._map=function(Oe,Bt){if(Oe.numPoints)return Bt?Re({},Oe.properties):Oe.properties;var Zt=this.points[Oe.index].properties,ir=this.options.map(Zt);return Bt&&ir===Zt?Re({},ir):ir};function ht(Wt,Oe,Bt,Zt,ir){return{x:Mt(Wt),y:Mt(Oe),zoom:Infinity,id:Bt,parentId:-1,numPoints:Zt,properties:ir}}function vt(Wt,Oe){var Bt=Wt.geometry.coordinates,Zt=Bt[0],ir=Bt[1];return{x:Mt(xt(Zt)),y:Mt(st(ir)),zoom:Infinity,index:Oe,parentId:-1}}function _t(Wt){return{type:"Feature",id:Wt.id,properties:Ve(Wt),geometry:{type:"Point",coordinates:[it(Wt.x),N(Wt.y)]}}}function Ve(Wt){var Oe=Wt.numPoints,Bt=Oe>=1e4?Math.round(Oe/1e3)+"k":Oe>=1e3?Math.round(Oe/100)/10+"k":Oe;return Re(Re({},Wt.properties),{cluster:!0,cluster_id:Wt.id,point_count:Oe,point_count_abbreviated:Bt})}function xt(Wt){return Wt/360+.5}function st(Wt){var Oe=Math.sin(Wt*Math.PI/180),Bt=.5-.25*Math.log((1+Oe)/(1-Oe))/Math.PI;return Bt<0?0:Bt>1?1:Bt}function it(Wt){return(Wt-.5)*360}function N(Wt){var Oe=(180-Wt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Oe))/Math.PI-90}function Re(Wt,Oe){for(var Bt in Oe)Wt[Bt]=Oe[Bt];return Wt}function Nr(Wt){return Wt.x}function Pr(Wt){return Wt.y}return at})},n2J3:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.unmanaged=void 0;var W=O("xfSm"),re=O("GXnB"),ne=O("Ztfv");function j(){return function(m,U,G){var Te=new re.Metadata(W.UNMANAGED_TAG,!0);ne.tagParameter(m,U,G,Te)}}K.unmanaged=j},"oCl/":function(He,K,O){var W=O("CH3K"),re=O("LcsW"),ne=O("MvSz"),j=O("0ycA"),m=Object.getOwnPropertySymbols,U=m?function(G){for(var Te=[];G;)W(Te,ne(G)),G=re(G);return Te}:j;He.exports=U},oIFs:function(He,K,O){},oShl:function(He,K,O){var W=O("Nsbk"),re=O("SksO"),ne=O("xfeJ"),j=O("sXyB");function m(U){var G=typeof Map=="function"?new Map:void 0;return He.exports=m=function(xe){if(xe===null||!ne(xe))return xe;if(typeof xe!="function")throw new TypeError("Super expression must either be null or a function");if(typeof G!="undefined"){if(G.has(xe))return G.get(xe);G.set(xe,Me)}function Me(){return j(xe,arguments,W(this).constructor)}return Me.prototype=Object.create(xe.prototype,{constructor:{value:Me,enumerable:!1,writable:!0,configurable:!0}}),re(Me,xe)},He.exports.__esModule=!0,He.exports.default=He.exports,m(U)}He.exports=m,He.exports.__esModule=!0,He.exports.default=He.exports},oaX6:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.targetName=void 0;var W=O("xfSm"),re=O("GXnB"),ne=O("Ztfv");function j(m){return function(U,G,Te){var xe=new re.Metadata(W.NAME_TAG,m);ne.tagParameter(U,G,Te,xe)}}K.targetName=j},"otv/":function(He,K,O){var W=O("nmnc"),re=W?W.prototype:void 0,ne=re?re.valueOf:void 0;function j(m){return ne?Object(ne.call(m)):{}}He.exports=j},"oy+k":function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Context=void 0;var W=O("d9O0"),re=function(){function ne(j){this.id=W.id(),this.container=j}return ne.prototype.addPlan=function(j){this.plan=j},ne.prototype.setCurrentRequest=function(j){this.currentRequest=j},ne}();K.Context=re},q4HE:function(He,K){var O="\\ud800-\\udfff",W="\\u0300-\\u036f",re="\\ufe20-\\ufe2f",ne="\\u20d0-\\u20ff",j=W+re+ne,m="\\ufe0e\\ufe0f",U="["+O+"]",G="["+j+"]",Te="\\ud83c[\\udffb-\\udfff]",xe="(?:"+G+"|"+Te+")",Me="[^"+O+"]",Ee="(?:\\ud83c[\\udde6-\\uddff]){2}",Mt="[\\ud800-\\udbff][\\udc00-\\udfff]",at="\\u200d",ht=xe+"?",vt="["+m+"]?",_t="(?:"+at+"(?:"+[Me,Ee,Mt].join("|")+")"+vt+ht+")*",Ve=vt+ht+_t,xt="(?:"+[Me+G+"?",G,Ee,Mt,U].join("|")+")",st=RegExp(Te+"(?="+Te+")|"+xt+Ve,"g");function it(N){for(var Re=st.lastIndex=0;st.test(N);)++Re;return Re}He.exports=it},qK8v:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.isStackOverflowExeption=void 0;var W=O("MON2");function re(ne){return ne instanceof RangeError||ne.message===W.STACK_OVERFLOW}K.isStackOverflowExeption=re},qRkn:function(He,K,O){var W=O("3cYt"),re={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},ne=W(re);He.exports=ne},sGsY:function(He,K,O){"use strict";var W=O("rePB"),re=O("wx14"),ne=O("q1tI"),j=O("TSYQ"),m=O.n(j),U=O("H84U"),G=O("/ezw"),Te=O("B6l+"),xe=O.n(Te),Me=function(br){var fe=br.value,Pe=br.formatter,Se=br.precision,lt=br.decimalSeparator,ut=br.groupSeparator,Ot=ut===void 0?"":ut,wt=br.prefixCls,sr;if(typeof Pe=="function")sr=Pe(fe);else{var Or=String(fe),Nt=Or.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Nt||Or==="-")sr=Or;else{var Tt=Nt[1],It=Nt[2]||"0",$t=Nt[4]||"";It=It.replace(/\B(?=(\d{3})+(?!\d))/g,Ot),typeof Se=="number"&&($t=xe()($t,Se,"0").slice(0,Se)),$t&&($t="".concat(lt).concat($t)),sr=[ne.createElement("span",{key:"int",className:"".concat(wt,"-content-value-int")},Tt,It),$t&&ne.createElement("span",{key:"decimal",className:"".concat(wt,"-content-value-decimal")},$t)]}}return ne.createElement("span",{className:"".concat(wt,"-content-value")},sr)},Ee=Me,Mt=function(br){var fe=br.prefixCls,Pe=br.className,Se=br.style,lt=br.valueStyle,ut=br.value,Ot=ut===void 0?0:ut,wt=br.title,sr=br.valueRender,Or=br.prefix,Nt=br.suffix,Tt=br.loading,It=br.direction,$t=br.onMouseEnter,gr=br.onMouseLeave,qt=ne.createElement(Ee,Object(re.a)({},br,{value:Ot})),dr=m()(fe,Object(W.a)({},"".concat(fe,"-rtl"),It==="rtl"),Pe);return ne.createElement("div",{className:dr,style:Se,onMouseEnter:$t,onMouseLeave:gr},wt&&ne.createElement("div",{className:"".concat(fe,"-title")},wt),ne.createElement(G.a,{paragraph:!1,loading:Tt},ne.createElement("div",{style:lt,className:"".concat(fe,"-content")},Or&&ne.createElement("span",{className:"".concat(fe,"-content-prefix")},Or),sr?sr(qt):qt,Nt&&ne.createElement("span",{className:"".concat(fe,"-content-suffix")},Nt))))};Mt.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var at=Object(U.c)({prefixCls:"statistic"})(Mt),ht=at,vt=O("1OyB"),_t=O("vuIU"),Ve=O("Ji7U"),xt=O("LK+K"),st=O("ODXe"),it=O("QQZ/"),N=O.n(it),Re=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Nr(qr,br){var fe=qr,Pe=/\[[^\]]*]/g,Se=(br.match(Pe)||[]).map(function(wt){return wt.slice(1,-1)}),lt=br.replace(Pe,"[]"),ut=Re.reduce(function(wt,sr){var Or=Object(st.a)(sr,2),Nt=Or[0],Tt=Or[1];if(wt.indexOf(Nt)!==-1){var It=Math.floor(fe/Tt);return fe-=It*Tt,wt.replace(new RegExp("".concat(Nt,"+"),"g"),function($t){var gr=$t.length;return N()(It.toString(),gr,"0")})}return wt},lt),Ot=0;return ut.replace(Pe,function(){var wt=Se[Ot];return Ot+=1,wt})}function Pr(qr,br){var fe=br.format,Pe=fe===void 0?"":fe,Se=new Date(qr).getTime(),lt=Date.now(),ut=Math.max(Se-lt,0);return Nr(ut,Pe)}var Wt=O("0n0R"),Oe=1e3/30;function Bt(qr){return new Date(qr).getTime()}var Zt=function(qr){Object(Ve.a)(fe,qr);var br=Object(xt.a)(fe);function fe(){var Pe;return Object(vt.a)(this,fe),Pe=br.apply(this,arguments),Pe.syncTimer=function(){var Se=Pe.props.value,lt=Bt(Se);lt>=Date.now()?Pe.startTimer():Pe.stopTimer()},Pe.startTimer=function(){if(!Pe.countdownId){var Se=Pe.props,lt=Se.onChange,ut=Se.value,Ot=Bt(ut);Pe.countdownId=window.setInterval(function(){Pe.forceUpdate(),lt&&Ot>Date.now()&&lt(Ot-Date.now())},Oe)}},Pe.stopTimer=function(){var Se=Pe.props,lt=Se.onFinish,ut=Se.value;if(Pe.countdownId){clearInterval(Pe.countdownId),Pe.countdownId=void 0;var Ot=Bt(ut);lt&&Ot<Date.now()&&lt()}},Pe.formatCountdown=function(Se,lt){var ut=Pe.props.format;return Pr(Se,Object(re.a)(Object(re.a)({},lt),{format:ut}))},Pe.valueRender=function(Se){return Object(Wt.a)(Se,{title:void 0})},Pe}return Object(_t.a)(fe,[{key:"componentDidMount",value:function(){this.syncTimer()}},{key:"componentDidUpdate",value:function(){this.syncTimer()}},{key:"componentWillUnmount",value:function(){this.stopTimer()}},{key:"render",value:function(){return ne.createElement(ht,Object(re.a)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),fe}(ne.Component);Zt.defaultProps={format:"HH:mm:ss"};var ir=Zt;ht.Countdown=ir;var Fr=K.a=ht},sKgW:function(He,K){var O=9007199254740991,W=Math.floor;function re(ne,j){var m="";if(!ne||j<1||j>O)return m;do j%2&&(m+=ne),j=W(j/2),j&&(ne+=ne);while(j);return m}He.exports=re},sXyB:function(He,K,O){var W=O("SksO"),re=O("b48C");function ne(j,m,U){return re()?(He.exports=ne=Reflect.construct,He.exports.__esModule=!0,He.exports.default=He.exports):(He.exports=ne=function(Te,xe,Me){var Ee=[null];Ee.push.apply(Ee,xe);var Mt=Function.bind.apply(Te,Ee),at=new Mt;return Me&&W(at,Me.prototype),at},He.exports.__esModule=!0,He.exports.default=He.exports),ne.apply(null,arguments)}He.exports=ne,He.exports.__esModule=!0,He.exports.default=He.exports},sgoq:function(He,K,O){var W=O("asDA"),re=O("TKrE"),ne=O("6nK8"),j="['\u2019]",m=RegExp(j,"g");function U(G){return function(Te){return W(ne(re(Te).replace(m,"")),G,"")}}He.exports=U},szb8:function(He,K,O){"use strict";O.r(K),O.d(K,"Interpreter",function(){return Ga}),O.d(K,"vm",function(){return W}),O.d(K,"evaluate",function(){return ec}),O.d(K,"Function",function(){return _u});var W={};O.r(W),O.d(W,"createContext",function(){return Ya}),O.d(W,"compileFunction",function(){return El}),O.d(W,"runInContext",function(){return yu}),O.d(W,"runInNewContext",function(){return kh}),O.d(W,"Script",function(){return Kc});var re={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},ne="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",j={5:ne,"5module":ne+" export import",6:ne+" const class extends export import super"},m=/^in(stanceof)?$/,U="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",G="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Te=new RegExp("["+U+"]"),xe=new RegExp("["+U+G+"]");U=G=null;var Me=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ee=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Mt(_,P){for(var z=65536,L=0;L<P.length;L+=2){if(z+=P[L],z>_)return!1;if(z+=P[L+1],z>=_)return!0}}function at(_,P){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Te.test(String.fromCharCode(_)):P===!1?!1:Mt(_,Me)}function ht(_,P){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&xe.test(String.fromCharCode(_)):P===!1?!1:Mt(_,Me)||Mt(_,Ee)}var vt=function(P,z){z===void 0&&(z={}),this.label=P,this.keyword=z.keyword,this.beforeExpr=!!z.beforeExpr,this.startsExpr=!!z.startsExpr,this.isLoop=!!z.isLoop,this.isAssign=!!z.isAssign,this.prefix=!!z.prefix,this.postfix=!!z.postfix,this.binop=z.binop||null,this.updateContext=null};function _t(_,P){return new vt(_,{beforeExpr:!0,binop:P})}var Ve={beforeExpr:!0},xt={startsExpr:!0},st={};function it(_,P){return P===void 0&&(P={}),P.keyword=_,st[_]=new vt(_,P)}var N={num:new vt("num",xt),regexp:new vt("regexp",xt),string:new vt("string",xt),name:new vt("name",xt),eof:new vt("eof"),bracketL:new vt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new vt("]"),braceL:new vt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new vt("}"),parenL:new vt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new vt(")"),comma:new vt(",",Ve),semi:new vt(";",Ve),colon:new vt(":",Ve),dot:new vt("."),question:new vt("?",Ve),questionDot:new vt("?."),arrow:new vt("=>",Ve),template:new vt("template"),invalidTemplate:new vt("invalidTemplate"),ellipsis:new vt("...",Ve),backQuote:new vt("`",xt),dollarBraceL:new vt("${",{beforeExpr:!0,startsExpr:!0}),eq:new vt("=",{beforeExpr:!0,isAssign:!0}),assign:new vt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new vt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new vt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:_t("||",1),logicalAND:_t("&&",2),bitwiseOR:_t("|",3),bitwiseXOR:_t("^",4),bitwiseAND:_t("&",5),equality:_t("==/!=/===/!==",6),relational:_t("</>/<=/>=",7),bitShift:_t("<</>>/>>>",8),plusMin:new vt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:_t("%",10),star:_t("*",10),slash:_t("/",10),starstar:new vt("**",{beforeExpr:!0}),coalesce:_t("??",1),_break:it("break"),_case:it("case",Ve),_catch:it("catch"),_continue:it("continue"),_debugger:it("debugger"),_default:it("default",Ve),_do:it("do",{isLoop:!0,beforeExpr:!0}),_else:it("else",Ve),_finally:it("finally"),_for:it("for",{isLoop:!0}),_function:it("function",xt),_if:it("if"),_return:it("return",Ve),_switch:it("switch"),_throw:it("throw",Ve),_try:it("try"),_var:it("var"),_const:it("const"),_while:it("while",{isLoop:!0}),_with:it("with"),_new:it("new",{beforeExpr:!0,startsExpr:!0}),_this:it("this",xt),_super:it("super",xt),_class:it("class",xt),_extends:it("extends",Ve),_export:it("export"),_import:it("import",xt),_null:it("null",xt),_true:it("true",xt),_false:it("false",xt),_in:it("in",{beforeExpr:!0,binop:7}),_instanceof:it("instanceof",{beforeExpr:!0,binop:7}),_typeof:it("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:it("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:it("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Re=/\r\n?|\n|\u2028|\u2029/,Nr=new RegExp(Re.source,"g");function Pr(_,P){return _===10||_===13||!P&&(_===8232||_===8233)}var Wt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Oe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Bt=Object.prototype,Zt=Bt.hasOwnProperty,ir=Bt.toString;function Fr(_,P){return Zt.call(_,P)}var qr=Array.isArray||function(_){return ir.call(_)==="[object Array]"};function br(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var fe=function(P,z){this.line=P,this.column=z};fe.prototype.offset=function(P){return new fe(this.line,this.column+P)};var Pe=function(P,z,L){this.start=z,this.end=L,P.sourceFile!==null&&(this.source=P.sourceFile)};function Se(_,P){for(var z=1,L=0;;){Nr.lastIndex=L;var te=Nr.exec(_);if(te&&te.index<P)++z,L=te.index+te[0].length;else return new fe(z,P-L)}}var lt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function ut(_){var P={};for(var z in lt)P[z]=_&&Fr(_,z)?_[z]:lt[z];if(P.ecmaVersion>=2015&&(P.ecmaVersion-=2009),P.allowReserved==null&&(P.allowReserved=P.ecmaVersion<5),qr(P.onToken)){var L=P.onToken;P.onToken=function(te){return L.push(te)}}return qr(P.onComment)&&(P.onComment=Ot(P,P.onComment)),P}function Ot(_,P){return function(z,L,te,Ce,rt,Ct){var ft={type:z?"Block":"Line",value:L,start:te,end:Ce};_.locations&&(ft.loc=new Pe(this,rt,Ct)),_.ranges&&(ft.range=[te,Ce]),P.push(ft)}}var wt=1,sr=2,Or=wt|sr,Nt=4,Tt=8,It=16,$t=32,gr=64,qt=128;function dr(_,P){return sr|(_?Nt:0)|(P?Tt:0)}var Ur=0,Ir=1,ur=2,Rr=3,Yn=4,un=5,_n=function(P,z,L){this.options=P=ut(P),this.sourceFile=P.sourceFile,this.keywords=br(j[P.ecmaVersion>=6?6:P.sourceType==="module"?"5module":5]);var te="";if(P.allowReserved!==!0){for(var Ce=P.ecmaVersion;!(te=re[Ce]);Ce--);P.sourceType==="module"&&(te+=" await")}this.reservedWords=br(te);var rt=(te?te+" ":"")+re.strict;this.reservedWordsStrict=br(rt),this.reservedWordsStrictBind=br(rt+" "+re.strictBind),this.input=String(z),this.containsEsc=!1,L?(this.pos=L,this.lineStart=this.input.lastIndexOf(`
`,L-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Re).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=N.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=P.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&P.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(wt),this.regexpState=null},qn={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};_n.prototype.parse=function(){var P=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(P)},qn.inFunction.get=function(){return(this.currentVarScope().flags&sr)>0},qn.inGenerator.get=function(){return(this.currentVarScope().flags&Tt)>0},qn.inAsync.get=function(){return(this.currentVarScope().flags&Nt)>0},qn.allowSuper.get=function(){return(this.currentThisScope().flags&gr)>0},qn.allowDirectSuper.get=function(){return(this.currentThisScope().flags&qt)>0},qn.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},_n.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&sr)>0},_n.extend=function(){for(var P=[],z=arguments.length;z--;)P[z]=arguments[z];for(var L=this,te=0;te<P.length;te++)L=P[te](L);return L},_n.parse=function(P,z){return new this(z,P).parse()},_n.parseExpressionAt=function(P,z,L){var te=new this(L,P,z);return te.nextToken(),te.parseExpression()},_n.tokenizer=function(P,z){return new this(z,P)},Object.defineProperties(_n.prototype,qn);var oi=_n.prototype,Gi=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;oi.strictDirective=function(_){for(;;){Oe.lastIndex=_,_+=Oe.exec(this.input)[0].length;var P=Gi.exec(this.input.slice(_));if(!P)return!1;if((P[1]||P[2])==="use strict"){Oe.lastIndex=_+P[0].length;var z=Oe.exec(this.input),L=z.index+z[0].length,te=this.input.charAt(L);return te===";"||te==="}"||Re.test(z[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(te)||te==="!"&&this.input.charAt(L+1)==="=")}_+=P[0].length,Oe.lastIndex=_,_+=Oe.exec(this.input)[0].length,this.input[_]===";"&&_++}},oi.eat=function(_){return this.type===_?(this.next(),!0):!1},oi.isContextual=function(_){return this.type===N.name&&this.value===_&&!this.containsEsc},oi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},oi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},oi.canInsertSemicolon=function(){return this.type===N.eof||this.type===N.braceR||Re.test(this.input.slice(this.lastTokEnd,this.start))},oi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},oi.semicolon=function(){!this.eat(N.semi)&&!this.insertSemicolon()&&this.unexpected()},oi.afterTrailingComma=function(_,P){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),P||this.next(),!0},oi.expect=function(_){this.eat(_)||this.unexpected()},oi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function he(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}oi.checkPatternErrors=function(_,P){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var z=P?_.parenthesizedAssign:_.parenthesizedBind;z>-1&&this.raiseRecoverable(z,"Parenthesized pattern")}},oi.checkExpressionErrors=function(_,P){if(!_)return!1;var z=_.shorthandAssign,L=_.doubleProto;if(!P)return z>=0||L>=0;z>=0&&this.raise(z,"Shorthand property assignments are valid only in destructuring patterns"),L>=0&&this.raiseRecoverable(L,"Redefinition of __proto__ property")},oi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},oi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Fn=_n.prototype;Fn.parseTopLevel=function(_){var P={};for(_.body||(_.body=[]);this.type!==N.eof;){var z=this.parseStatement(null,!0,P);_.body.push(z)}if(this.inModule)for(var L=0,te=Object.keys(this.undefinedExports);L<te.length;L+=1){var Ce=te[L];this.raiseRecoverable(this.undefinedExports[Ce].start,"Export '"+Ce+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Li={kind:"loop"},Ko={kind:"switch"};Fn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Oe.lastIndex=this.pos;var P=Oe.exec(this.input),z=this.pos+P[0].length,L=this.input.charCodeAt(z);if(L===91)return!0;if(_)return!1;if(L===123)return!0;if(at(L,!0)){for(var te=z+1;ht(this.input.charCodeAt(te),!0);)++te;var Ce=this.input.slice(z,te);if(!m.test(Ce))return!0}return!1},Fn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Oe.lastIndex=this.pos;var _=Oe.exec(this.input),P=this.pos+_[0].length;return!Re.test(this.input.slice(this.pos,P))&&this.input.slice(P,P+8)==="function"&&(P+8===this.input.length||!ht(this.input.charAt(P+8)))},Fn.parseStatement=function(_,P,z){var L=this.type,te=this.startNode(),Ce;switch(this.isLet(_)&&(L=N._var,Ce="let"),L){case N._break:case N._continue:return this.parseBreakContinueStatement(te,L.keyword);case N._debugger:return this.parseDebuggerStatement(te);case N._do:return this.parseDoStatement(te);case N._for:return this.parseForStatement(te);case N._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(te,!1,!_);case N._class:return _&&this.unexpected(),this.parseClass(te,!0);case N._if:return this.parseIfStatement(te);case N._return:return this.parseReturnStatement(te);case N._switch:return this.parseSwitchStatement(te);case N._throw:return this.parseThrowStatement(te);case N._try:return this.parseTryStatement(te);case N._const:case N._var:return Ce=Ce||this.value,_&&Ce!=="var"&&this.unexpected(),this.parseVarStatement(te,Ce);case N._while:return this.parseWhileStatement(te);case N._with:return this.parseWithStatement(te);case N.braceL:return this.parseBlock(!0,te);case N.semi:return this.parseEmptyStatement(te);case N._export:case N._import:if(this.options.ecmaVersion>10&&L===N._import){Oe.lastIndex=this.pos;var rt=Oe.exec(this.input),Ct=this.pos+rt[0].length,ft=this.input.charCodeAt(Ct);if(ft===40||ft===46)return this.parseExpressionStatement(te,this.parseExpression())}return this.options.allowImportExportEverywhere||(P||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),L===N._import?this.parseImport(te):this.parseExport(te,z);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(te,!0,!_);var Sr=this.value,kr=this.parseExpression();return L===N.name&&kr.type==="Identifier"&&this.eat(N.colon)?this.parseLabeledStatement(te,Sr,kr,_):this.parseExpressionStatement(te,kr)}},Fn.parseBreakContinueStatement=function(_,P){var z=P==="break";this.next(),this.eat(N.semi)||this.insertSemicolon()?_.label=null:this.type!==N.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var L=0;L<this.labels.length;++L){var te=this.labels[L];if((_.label==null||te.name===_.label.name)&&(te.kind!=null&&(z||te.kind==="loop")||_.label&&z))break}return L===this.labels.length&&this.raise(_.start,"Unsyntactic "+P),this.finishNode(_,z?"BreakStatement":"ContinueStatement")},Fn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Fn.parseDoStatement=function(_){return this.next(),this.labels.push(Li),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(N._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(N.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Fn.parseForStatement=function(_){this.next();var P=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Li),this.enterScope(0),this.expect(N.parenL),this.type===N.semi)return P>-1&&this.unexpected(P),this.parseFor(_,null);var z=this.isLet();if(this.type===N._var||this.type===N._const||z){var L=this.startNode(),te=z?"let":this.value;return this.next(),this.parseVar(L,!0,te),this.finishNode(L,"VariableDeclaration"),(this.type===N._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&L.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===N._in?P>-1&&this.unexpected(P):_.await=P>-1),this.parseForIn(_,L)):(P>-1&&this.unexpected(P),this.parseFor(_,L))}var Ce=new he,rt=this.parseExpression(!0,Ce);return this.type===N._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===N._in?P>-1&&this.unexpected(P):_.await=P>-1),this.toAssignable(rt,!1,Ce),this.checkLVal(rt),this.parseForIn(_,rt)):(this.checkExpressionErrors(Ce,!0),P>-1&&this.unexpected(P),this.parseFor(_,rt))},Fn.parseFunctionStatement=function(_,P,z){return this.next(),this.parseFunction(_,Ut|(z?0:Er),!1,P)},Fn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(N._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Fn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(N.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Fn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(N.braceL),this.labels.push(Ko),this.enterScope(0);for(var P,z=!1;this.type!==N.braceR;)if(this.type===N._case||this.type===N._default){var L=this.type===N._case;P&&this.finishNode(P,"SwitchCase"),_.cases.push(P=this.startNode()),P.consequent=[],this.next(),L?P.test=this.parseExpression():(z&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),z=!0,P.test=null),this.expect(N.colon)}else P||this.unexpected(),P.consequent.push(this.parseStatement(null));return this.exitScope(),P&&this.finishNode(P,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Fn.parseThrowStatement=function(_){return this.next(),Re.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var us=[];Fn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===N._catch){var P=this.startNode();if(this.next(),this.eat(N.parenL)){P.param=this.parseBindingAtom();var z=P.param.type==="Identifier";this.enterScope(z?$t:0),this.checkLVal(P.param,z?Yn:ur),this.expect(N.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),P.param=null,this.enterScope(0);P.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(P,"CatchClause")}return _.finalizer=this.eat(N._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Fn.parseVarStatement=function(_,P){return this.next(),this.parseVar(_,!1,P),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Fn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Li),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Fn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Fn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Fn.parseLabeledStatement=function(_,P,z,L){for(var te=0,Ce=this.labels;te<Ce.length;te+=1){var rt=Ce[te];rt.name===P&&this.raise(z.start,"Label '"+P+"' is already declared")}for(var Ct=this.type.isLoop?"loop":this.type===N._switch?"switch":null,ft=this.labels.length-1;ft>=0;ft--){var Sr=this.labels[ft];if(Sr.statementStart===_.start)Sr.statementStart=this.start,Sr.kind=Ct;else break}return this.labels.push({name:P,kind:Ct,statementStart:this.start}),_.body=this.parseStatement(L?L.indexOf("label")===-1?L+"label":L:"label"),this.labels.pop(),_.label=z,this.finishNode(_,"LabeledStatement")},Fn.parseExpressionStatement=function(_,P){return _.expression=P,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Fn.parseBlock=function(_,P,z){for(_===void 0&&(_=!0),P===void 0&&(P=this.startNode()),P.body=[],this.expect(N.braceL),_&&this.enterScope(0);this.type!==N.braceR;){var L=this.parseStatement(null);P.body.push(L)}return z&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(P,"BlockStatement")},Fn.parseFor=function(_,P){return _.init=P,this.expect(N.semi),_.test=this.type===N.semi?null:this.parseExpression(),this.expect(N.semi),_.update=this.type===N.parenR?null:this.parseExpression(),this.expect(N.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Fn.parseForIn=function(_,P){var z=this.type===N._in;return this.next(),P.type==="VariableDeclaration"&&P.declarations[0].init!=null&&(!z||this.options.ecmaVersion<8||this.strict||P.kind!=="var"||P.declarations[0].id.type!=="Identifier")?this.raise(P.start,(z?"for-in":"for-of")+" loop variable declaration may not have an initializer"):P.type==="AssignmentPattern"&&this.raise(P.start,"Invalid left-hand side in for-loop"),_.left=P,_.right=z?this.parseExpression():this.parseMaybeAssign(),this.expect(N.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,z?"ForInStatement":"ForOfStatement")},Fn.parseVar=function(_,P,z){for(_.declarations=[],_.kind=z;;){var L=this.startNode();if(this.parseVarId(L,z),this.eat(N.eq)?L.init=this.parseMaybeAssign(P):z==="const"&&!(this.type===N._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():L.id.type!=="Identifier"&&!(P&&(this.type===N._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):L.init=null,_.declarations.push(this.finishNode(L,"VariableDeclarator")),!this.eat(N.comma))break}return _},Fn.parseVarId=function(_,P){_.id=this.parseBindingAtom(),this.checkLVal(_.id,P==="var"?Ir:ur,!1)};var Ut=1,Er=2,Hr=4;Fn.parseFunction=function(_,P,z,L){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!L)&&(this.type===N.star&&P&Er&&this.unexpected(),_.generator=this.eat(N.star)),this.options.ecmaVersion>=8&&(_.async=!!L),P&Ut&&(_.id=P&Hr&&this.type!==N.name?null:this.parseIdent(),_.id&&!(P&Er)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Ir:ur:Rr));var te=this.yieldPos,Ce=this.awaitPos,rt=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(dr(_.async,_.generator)),P&Ut||(_.id=this.type===N.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,z,!1),this.yieldPos=te,this.awaitPos=Ce,this.awaitIdentPos=rt,this.finishNode(_,P&Ut?"FunctionDeclaration":"FunctionExpression")},Fn.parseFunctionParams=function(_){this.expect(N.parenL),_.params=this.parseBindingList(N.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Fn.parseClass=function(_,P){this.next();var z=this.strict;this.strict=!0,this.parseClassId(_,P),this.parseClassSuper(_);var L=this.startNode(),te=!1;for(L.body=[],this.expect(N.braceL);this.type!==N.braceR;){var Ce=this.parseClassElement(_.superClass!==null);Ce&&(L.body.push(Ce),Ce.type==="MethodDefinition"&&Ce.kind==="constructor"&&(te&&this.raise(Ce.start,"Duplicate constructor in the same class"),te=!0))}return this.strict=z,this.next(),_.body=this.finishNode(L,"ClassBody"),this.finishNode(_,P?"ClassDeclaration":"ClassExpression")},Fn.parseClassElement=function(_){var P=this;if(this.eat(N.semi))return null;var z=this.startNode(),L=function(Sr,kr){kr===void 0&&(kr=!1);var ni=P.start,xi=P.startLoc;return P.eatContextual(Sr)?P.type!==N.parenL&&(!kr||!P.canInsertSemicolon())?!0:(z.key&&P.unexpected(),z.computed=!1,z.key=P.startNodeAt(ni,xi),z.key.name=Sr,P.finishNode(z.key,"Identifier"),!1):!1};z.kind="method",z.static=L("static");var te=this.eat(N.star),Ce=!1;te||(this.options.ecmaVersion>=8&&L("async",!0)?(Ce=!0,te=this.options.ecmaVersion>=9&&this.eat(N.star)):L("get")?z.kind="get":L("set")&&(z.kind="set")),z.key||this.parsePropertyName(z);var rt=z.key,Ct=!1;return!z.computed&&!z.static&&(rt.type==="Identifier"&&rt.name==="constructor"||rt.type==="Literal"&&rt.value==="constructor")?(z.kind!=="method"&&this.raise(rt.start,"Constructor can't have get/set modifier"),te&&this.raise(rt.start,"Constructor can't be a generator"),Ce&&this.raise(rt.start,"Constructor can't be an async method"),z.kind="constructor",Ct=_):z.static&&rt.type==="Identifier"&&rt.name==="prototype"&&this.raise(rt.start,"Classes may not have a static property named prototype"),this.parseClassMethod(z,te,Ce,Ct),z.kind==="get"&&z.value.params.length!==0&&this.raiseRecoverable(z.value.start,"getter should have no params"),z.kind==="set"&&z.value.params.length!==1&&this.raiseRecoverable(z.value.start,"setter should have exactly one param"),z.kind==="set"&&z.value.params[0].type==="RestElement"&&this.raiseRecoverable(z.value.params[0].start,"Setter cannot use rest params"),z},Fn.parseClassMethod=function(_,P,z,L){return _.value=this.parseMethod(P,z,L),this.finishNode(_,"MethodDefinition")},Fn.parseClassId=function(_,P){this.type===N.name?(_.id=this.parseIdent(),P&&this.checkLVal(_.id,ur,!1)):(P===!0&&this.unexpected(),_.id=null)},Fn.parseClassSuper=function(_){_.superClass=this.eat(N._extends)?this.parseExprSubscripts():null},Fn.parseExport=function(_,P){if(this.next(),this.eat(N.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(P,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==N.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(N._default)){this.checkExport(P,"default",this.lastTokStart);var z;if(this.type===N._function||(z=this.isAsyncFunction())){var L=this.startNode();this.next(),z&&this.next(),_.declaration=this.parseFunction(L,Ut|Hr,!1,z)}else if(this.type===N._class){var te=this.startNode();_.declaration=this.parseClass(te,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(P,_.declaration.declarations):this.checkExport(P,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(P),this.eatContextual("from"))this.type!==N.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var Ce=0,rt=_.specifiers;Ce<rt.length;Ce+=1){var Ct=rt[Ce];this.checkUnreserved(Ct.local),this.checkLocalExport(Ct.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Fn.checkExport=function(_,P,z){!_||(Fr(_,P)&&this.raiseRecoverable(z,"Duplicate export '"+P+"'"),_[P]=!0)},Fn.checkPatternExport=function(_,P){var z=P.type;if(z==="Identifier")this.checkExport(_,P.name,P.start);else if(z==="ObjectPattern")for(var L=0,te=P.properties;L<te.length;L+=1){var Ce=te[L];this.checkPatternExport(_,Ce)}else if(z==="ArrayPattern")for(var rt=0,Ct=P.elements;rt<Ct.length;rt+=1){var ft=Ct[rt];ft&&this.checkPatternExport(_,ft)}else z==="Property"?this.checkPatternExport(_,P.value):z==="AssignmentPattern"?this.checkPatternExport(_,P.left):z==="RestElement"?this.checkPatternExport(_,P.argument):z==="ParenthesizedExpression"&&this.checkPatternExport(_,P.expression)},Fn.checkVariableExport=function(_,P){if(!!_)for(var z=0,L=P;z<L.length;z+=1){var te=L[z];this.checkPatternExport(_,te.id)}},Fn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Fn.parseExportSpecifiers=function(_){var P=[],z=!0;for(this.expect(N.braceL);!this.eat(N.braceR);){if(z)z=!1;else if(this.expect(N.comma),this.afterTrailingComma(N.braceR))break;var L=this.startNode();L.local=this.parseIdent(!0),L.exported=this.eatContextual("as")?this.parseIdent(!0):L.local,this.checkExport(_,L.exported.name,L.exported.start),P.push(this.finishNode(L,"ExportSpecifier"))}return P},Fn.parseImport=function(_){return this.next(),this.type===N.string?(_.specifiers=us,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===N.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Fn.parseImportSpecifiers=function(){var _=[],P=!0;if(this.type===N.name){var z=this.startNode();if(z.local=this.parseIdent(),this.checkLVal(z.local,ur),_.push(this.finishNode(z,"ImportDefaultSpecifier")),!this.eat(N.comma))return _}if(this.type===N.star){var L=this.startNode();return this.next(),this.expectContextual("as"),L.local=this.parseIdent(),this.checkLVal(L.local,ur),_.push(this.finishNode(L,"ImportNamespaceSpecifier")),_}for(this.expect(N.braceL);!this.eat(N.braceR);){if(P)P=!1;else if(this.expect(N.comma),this.afterTrailingComma(N.braceR))break;var te=this.startNode();te.imported=this.parseIdent(!0),this.eatContextual("as")?te.local=this.parseIdent():(this.checkUnreserved(te.imported),te.local=te.imported),this.checkLVal(te.local,ur),_.push(this.finishNode(te,"ImportSpecifier"))}return _},Fn.adaptDirectivePrologue=function(_){for(var P=0;P<_.length&&this.isDirectiveCandidate(_[P]);++P)_[P].directive=_[P].expression.raw.slice(1,-1)},Fn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var dn=_n.prototype;dn.toAssignable=function(_,P,z){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",z&&this.checkPatternErrors(z,!0);for(var L=0,te=_.properties;L<te.length;L+=1){var Ce=te[L];this.toAssignable(Ce,P),Ce.type==="RestElement"&&(Ce.argument.type==="ArrayPattern"||Ce.argument.type==="ObjectPattern")&&this.raise(Ce.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,P);break;case"ArrayExpression":_.type="ArrayPattern",z&&this.checkPatternErrors(z,!0),this.toAssignableList(_.elements,P);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,P),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,P);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,P,z);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!P)break;default:this.raise(_.start,"Assigning to rvalue")}else z&&this.checkPatternErrors(z,!0);return _},dn.toAssignableList=function(_,P){for(var z=_.length,L=0;L<z;L++){var te=_[L];te&&this.toAssignable(te,P)}if(z){var Ce=_[z-1];this.options.ecmaVersion===6&&P&&Ce&&Ce.type==="RestElement"&&Ce.argument.type!=="Identifier"&&this.unexpected(Ce.argument.start)}return _},dn.parseSpread=function(_){var P=this.startNode();return this.next(),P.argument=this.parseMaybeAssign(!1,_),this.finishNode(P,"SpreadElement")},dn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==N.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},dn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case N.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(N.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case N.braceL:return this.parseObj(!0)}return this.parseIdent()},dn.parseBindingList=function(_,P,z){for(var L=[],te=!0;!this.eat(_);)if(te?te=!1:this.expect(N.comma),P&&this.type===N.comma)L.push(null);else{if(z&&this.afterTrailingComma(_))break;if(this.type===N.ellipsis){var Ce=this.parseRestBinding();this.parseBindingListItem(Ce),L.push(Ce),this.type===N.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var rt=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(rt),L.push(rt)}}return L},dn.parseBindingListItem=function(_){return _},dn.parseMaybeDefault=function(_,P,z){if(z=z||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(N.eq))return z;var L=this.startNodeAt(_,P);return L.left=z,L.right=this.parseMaybeAssign(),this.finishNode(L,"AssignmentPattern")},dn.checkLVal=function(_,P,z){switch(P===void 0&&(P=Ur),_.type){case"Identifier":P===ur&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(P?"Binding ":"Assigning to ")+_.name+" in strict mode"),z&&(Fr(z,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),z[_.name]=!0),P!==Ur&&P!==un&&this.declareName(_.name,P,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":P&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var L=0,te=_.properties;L<te.length;L+=1){var Ce=te[L];this.checkLVal(Ce,P,z)}break;case"Property":this.checkLVal(_.value,P,z);break;case"ArrayPattern":for(var rt=0,Ct=_.elements;rt<Ct.length;rt+=1){var ft=Ct[rt];ft&&this.checkLVal(ft,P,z)}break;case"AssignmentPattern":this.checkLVal(_.left,P,z);break;case"RestElement":this.checkLVal(_.argument,P,z);break;case"ParenthesizedExpression":this.checkLVal(_.expression,P,z);break;default:this.raise(_.start,(P?"Binding":"Assigning to")+" rvalue")}};var Kr=_n.prototype;Kr.checkPropClash=function(_,P,z){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var L=_.key,te;switch(L.type){case"Identifier":te=L.name;break;case"Literal":te=String(L.value);break;default:return}var Ce=_.kind;if(this.options.ecmaVersion>=6){te==="__proto__"&&Ce==="init"&&(P.proto&&(z?z.doubleProto<0&&(z.doubleProto=L.start):this.raiseRecoverable(L.start,"Redefinition of __proto__ property")),P.proto=!0);return}te="$"+te;var rt=P[te];if(rt){var Ct;Ce==="init"?Ct=this.strict&&rt.init||rt.get||rt.set:Ct=rt.init||rt[Ce],Ct&&this.raiseRecoverable(L.start,"Redefinition of property")}else rt=P[te]={init:!1,get:!1,set:!1};rt[Ce]=!0}},Kr.parseExpression=function(_,P){var z=this.start,L=this.startLoc,te=this.parseMaybeAssign(_,P);if(this.type===N.comma){var Ce=this.startNodeAt(z,L);for(Ce.expressions=[te];this.eat(N.comma);)Ce.expressions.push(this.parseMaybeAssign(_,P));return this.finishNode(Ce,"SequenceExpression")}return te},Kr.parseMaybeAssign=function(_,P,z){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var L=!1,te=-1,Ce=-1;P?(te=P.parenthesizedAssign,Ce=P.trailingComma,P.parenthesizedAssign=P.trailingComma=-1):(P=new he,L=!0);var rt=this.start,Ct=this.startLoc;(this.type===N.parenL||this.type===N.name)&&(this.potentialArrowAt=this.start);var ft=this.parseMaybeConditional(_,P);if(z&&(ft=z.call(this,ft,rt,Ct)),this.type.isAssign){var Sr=this.startNodeAt(rt,Ct);return Sr.operator=this.value,Sr.left=this.type===N.eq?this.toAssignable(ft,!1,P):ft,L||(P.parenthesizedAssign=P.trailingComma=P.doubleProto=-1),P.shorthandAssign>=Sr.left.start&&(P.shorthandAssign=-1),this.checkLVal(ft),this.next(),Sr.right=this.parseMaybeAssign(_),this.finishNode(Sr,"AssignmentExpression")}else L&&this.checkExpressionErrors(P,!0);return te>-1&&(P.parenthesizedAssign=te),Ce>-1&&(P.trailingComma=Ce),ft},Kr.parseMaybeConditional=function(_,P){var z=this.start,L=this.startLoc,te=this.parseExprOps(_,P);if(this.checkExpressionErrors(P))return te;if(this.eat(N.question)){var Ce=this.startNodeAt(z,L);return Ce.test=te,Ce.consequent=this.parseMaybeAssign(),this.expect(N.colon),Ce.alternate=this.parseMaybeAssign(_),this.finishNode(Ce,"ConditionalExpression")}return te},Kr.parseExprOps=function(_,P){var z=this.start,L=this.startLoc,te=this.parseMaybeUnary(P,!1);return this.checkExpressionErrors(P)||te.start===z&&te.type==="ArrowFunctionExpression"?te:this.parseExprOp(te,z,L,-1,_)},Kr.parseExprOp=function(_,P,z,L,te){var Ce=this.type.binop;if(Ce!=null&&(!te||this.type!==N._in)&&Ce>L){var rt=this.type===N.logicalOR||this.type===N.logicalAND,Ct=this.type===N.coalesce;Ct&&(Ce=N.logicalAND.binop);var ft=this.value;this.next();var Sr=this.start,kr=this.startLoc,ni=this.parseExprOp(this.parseMaybeUnary(null,!1),Sr,kr,Ce,te),xi=this.buildBinary(P,z,_,ni,ft,rt||Ct);return(rt&&this.type===N.coalesce||Ct&&(this.type===N.logicalOR||this.type===N.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(xi,P,z,L,te)}return _},Kr.buildBinary=function(_,P,z,L,te,Ce){var rt=this.startNodeAt(_,P);return rt.left=z,rt.operator=te,rt.right=L,this.finishNode(rt,Ce?"LogicalExpression":"BinaryExpression")},Kr.parseMaybeUnary=function(_,P){var z=this.start,L=this.startLoc,te;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))te=this.parseAwait(),P=!0;else if(this.type.prefix){var Ce=this.startNode(),rt=this.type===N.incDec;Ce.operator=this.value,Ce.prefix=!0,this.next(),Ce.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),rt?this.checkLVal(Ce.argument):this.strict&&Ce.operator==="delete"&&Ce.argument.type==="Identifier"?this.raiseRecoverable(Ce.start,"Deleting local variable in strict mode"):P=!0,te=this.finishNode(Ce,rt?"UpdateExpression":"UnaryExpression")}else{if(te=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return te;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ct=this.startNodeAt(z,L);Ct.operator=this.value,Ct.prefix=!1,Ct.argument=te,this.checkLVal(te),this.next(),te=this.finishNode(Ct,"UpdateExpression")}}return!P&&this.eat(N.starstar)?this.buildBinary(z,L,te,this.parseMaybeUnary(null,!1),"**",!1):te},Kr.parseExprSubscripts=function(_){var P=this.start,z=this.startLoc,L=this.parseExprAtom(_);if(L.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return L;var te=this.parseSubscripts(L,P,z);return _&&te.type==="MemberExpression"&&(_.parenthesizedAssign>=te.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=te.start&&(_.parenthesizedBind=-1)),te},Kr.parseSubscripts=function(_,P,z,L){for(var te=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,Ce=!1;;){var rt=this.parseSubscript(_,P,z,L,te,Ce);if(rt.optional&&(Ce=!0),rt===_||rt.type==="ArrowFunctionExpression"){if(Ce){var Ct=this.startNodeAt(P,z);Ct.expression=rt,rt=this.finishNode(Ct,"ChainExpression")}return rt}_=rt}},Kr.parseSubscript=function(_,P,z,L,te,Ce){var rt=this.options.ecmaVersion>=11,Ct=rt&&this.eat(N.questionDot);L&&Ct&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ft=this.eat(N.bracketL);if(ft||Ct&&this.type!==N.parenL&&this.type!==N.backQuote||this.eat(N.dot)){var Sr=this.startNodeAt(P,z);Sr.object=_,Sr.property=ft?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Sr.computed=!!ft,ft&&this.expect(N.bracketR),rt&&(Sr.optional=Ct),_=this.finishNode(Sr,"MemberExpression")}else if(!L&&this.eat(N.parenL)){var kr=new he,ni=this.yieldPos,xi=this.awaitPos,gi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var dt=this.parseExprList(N.parenR,this.options.ecmaVersion>=8,!1,kr);if(te&&!Ct&&!this.canInsertSemicolon()&&this.eat(N.arrow))return this.checkPatternErrors(kr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ni,this.awaitPos=xi,this.awaitIdentPos=gi,this.parseArrowExpression(this.startNodeAt(P,z),dt,!0);this.checkExpressionErrors(kr,!0),this.yieldPos=ni||this.yieldPos,this.awaitPos=xi||this.awaitPos,this.awaitIdentPos=gi||this.awaitIdentPos;var ua=this.startNodeAt(P,z);ua.callee=_,ua.arguments=dt,rt&&(ua.optional=Ct),_=this.finishNode(ua,"CallExpression")}else if(this.type===N.backQuote){(Ct||Ce)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var yt=this.startNodeAt(P,z);yt.tag=_,yt.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(yt,"TaggedTemplateExpression")}return _},Kr.parseExprAtom=function(_){this.type===N.slash&&this.readRegexp();var P,z=this.potentialArrowAt===this.start;switch(this.type){case N._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),P=this.startNode(),this.next(),this.type===N.parenL&&!this.allowDirectSuper&&this.raise(P.start,"super() call outside constructor of a subclass"),this.type!==N.dot&&this.type!==N.bracketL&&this.type!==N.parenL&&this.unexpected(),this.finishNode(P,"Super");case N._this:return P=this.startNode(),this.next(),this.finishNode(P,"ThisExpression");case N.name:var L=this.start,te=this.startLoc,Ce=this.containsEsc,rt=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Ce&&rt.name==="async"&&!this.canInsertSemicolon()&&this.eat(N._function))return this.parseFunction(this.startNodeAt(L,te),0,!1,!0);if(z&&!this.canInsertSemicolon()){if(this.eat(N.arrow))return this.parseArrowExpression(this.startNodeAt(L,te),[rt],!1);if(this.options.ecmaVersion>=8&&rt.name==="async"&&this.type===N.name&&!Ce)return rt=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(N.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(L,te),[rt],!0)}return rt;case N.regexp:var Ct=this.value;return P=this.parseLiteral(Ct.value),P.regex={pattern:Ct.pattern,flags:Ct.flags},P;case N.num:case N.string:return this.parseLiteral(this.value);case N._null:case N._true:case N._false:return P=this.startNode(),P.value=this.type===N._null?null:this.type===N._true,P.raw=this.type.keyword,this.next(),this.finishNode(P,"Literal");case N.parenL:var ft=this.start,Sr=this.parseParenAndDistinguishExpression(z);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Sr)&&(_.parenthesizedAssign=ft),_.parenthesizedBind<0&&(_.parenthesizedBind=ft)),Sr;case N.bracketL:return P=this.startNode(),this.next(),P.elements=this.parseExprList(N.bracketR,!0,!0,_),this.finishNode(P,"ArrayExpression");case N.braceL:return this.parseObj(!1,_);case N._function:return P=this.startNode(),this.next(),this.parseFunction(P,0);case N._class:return this.parseClass(this.startNode(),!1);case N._new:return this.parseNew();case N.backQuote:return this.parseTemplate();case N._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Kr.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var P=this.parseIdent(!0);switch(this.type){case N.parenL:return this.parseDynamicImport(_);case N.dot:return _.meta=P,this.parseImportMeta(_);default:this.unexpected()}},Kr.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(N.parenR)){var P=this.start;this.eat(N.comma)&&this.eat(N.parenR)?this.raiseRecoverable(P,"Trailing comma is not allowed in import()"):this.unexpected(P)}return this.finishNode(_,"ImportExpression")},Kr.parseImportMeta=function(_){this.next();var P=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),P&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Kr.parseLiteral=function(_){var P=this.startNode();return P.value=_,P.raw=this.input.slice(this.start,this.end),P.raw.charCodeAt(P.raw.length-1)===110&&(P.bigint=P.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(P,"Literal")},Kr.parseParenExpression=function(){this.expect(N.parenL);var _=this.parseExpression();return this.expect(N.parenR),_},Kr.parseParenAndDistinguishExpression=function(_){var P=this.start,z=this.startLoc,L,te=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Ce=this.start,rt=this.startLoc,Ct=[],ft=!0,Sr=!1,kr=new he,ni=this.yieldPos,xi=this.awaitPos,gi;for(this.yieldPos=0,this.awaitPos=0;this.type!==N.parenR;)if(ft?ft=!1:this.expect(N.comma),te&&this.afterTrailingComma(N.parenR,!0)){Sr=!0;break}else if(this.type===N.ellipsis){gi=this.start,Ct.push(this.parseParenItem(this.parseRestBinding())),this.type===N.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Ct.push(this.parseMaybeAssign(!1,kr,this.parseParenItem));var dt=this.start,ua=this.startLoc;if(this.expect(N.parenR),_&&!this.canInsertSemicolon()&&this.eat(N.arrow))return this.checkPatternErrors(kr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=ni,this.awaitPos=xi,this.parseParenArrowList(P,z,Ct);(!Ct.length||Sr)&&this.unexpected(this.lastTokStart),gi&&this.unexpected(gi),this.checkExpressionErrors(kr,!0),this.yieldPos=ni||this.yieldPos,this.awaitPos=xi||this.awaitPos,Ct.length>1?(L=this.startNodeAt(Ce,rt),L.expressions=Ct,this.finishNodeAt(L,"SequenceExpression",dt,ua)):L=Ct[0]}else L=this.parseParenExpression();if(this.options.preserveParens){var yt=this.startNodeAt(P,z);return yt.expression=L,this.finishNode(yt,"ParenthesizedExpression")}else return L},Kr.parseParenItem=function(_){return _},Kr.parseParenArrowList=function(_,P,z){return this.parseArrowExpression(this.startNodeAt(_,P),z)};var Ia=[];Kr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),P=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(N.dot)){_.meta=P;var z=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),z&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var L=this.start,te=this.startLoc,Ce=this.type===N._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),L,te,!0),Ce&&_.callee.type==="ImportExpression"&&this.raise(L,"Cannot use new with import()"),this.eat(N.parenL)?_.arguments=this.parseExprList(N.parenR,this.options.ecmaVersion>=8,!1):_.arguments=Ia,this.finishNode(_,"NewExpression")},Kr.parseTemplateElement=function(_){var P=_.isTagged,z=this.startNode();return this.type===N.invalidTemplate?(P||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),z.value={raw:this.value,cooked:null}):z.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),z.tail=this.type===N.backQuote,this.finishNode(z,"TemplateElement")},Kr.parseTemplate=function(_){_===void 0&&(_={});var P=_.isTagged;P===void 0&&(P=!1);var z=this.startNode();this.next(),z.expressions=[];var L=this.parseTemplateElement({isTagged:P});for(z.quasis=[L];!L.tail;)this.type===N.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(N.dollarBraceL),z.expressions.push(this.parseExpression()),this.expect(N.braceR),z.quasis.push(L=this.parseTemplateElement({isTagged:P}));return this.next(),this.finishNode(z,"TemplateLiteral")},Kr.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===N.name||this.type===N.num||this.type===N.string||this.type===N.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===N.star)&&!Re.test(this.input.slice(this.lastTokEnd,this.start))},Kr.parseObj=function(_,P){var z=this.startNode(),L=!0,te={};for(z.properties=[],this.next();!this.eat(N.braceR);){if(L)L=!1;else if(this.expect(N.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(N.braceR))break;var Ce=this.parseProperty(_,P);_||this.checkPropClash(Ce,te,P),z.properties.push(Ce)}return this.finishNode(z,_?"ObjectPattern":"ObjectExpression")},Kr.parseProperty=function(_,P){var z=this.startNode(),L,te,Ce,rt;if(this.options.ecmaVersion>=9&&this.eat(N.ellipsis))return _?(z.argument=this.parseIdent(!1),this.type===N.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(z,"RestElement")):(this.type===N.parenL&&P&&(P.parenthesizedAssign<0&&(P.parenthesizedAssign=this.start),P.parenthesizedBind<0&&(P.parenthesizedBind=this.start)),z.argument=this.parseMaybeAssign(!1,P),this.type===N.comma&&P&&P.trailingComma<0&&(P.trailingComma=this.start),this.finishNode(z,"SpreadElement"));this.options.ecmaVersion>=6&&(z.method=!1,z.shorthand=!1,(_||P)&&(Ce=this.start,rt=this.startLoc),_||(L=this.eat(N.star)));var Ct=this.containsEsc;return this.parsePropertyName(z),!_&&!Ct&&this.options.ecmaVersion>=8&&!L&&this.isAsyncProp(z)?(te=!0,L=this.options.ecmaVersion>=9&&this.eat(N.star),this.parsePropertyName(z,P)):te=!1,this.parsePropertyValue(z,_,L,te,Ce,rt,P,Ct),this.finishNode(z,"Property")},Kr.parsePropertyValue=function(_,P,z,L,te,Ce,rt,Ct){if((z||L)&&this.type===N.colon&&this.unexpected(),this.eat(N.colon))_.value=P?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,rt),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===N.parenL)P&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(z,L);else if(!P&&!Ct&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==N.comma&&this.type!==N.braceR&&this.type!==N.eq){(z||L)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var ft=_.kind==="get"?0:1;if(_.value.params.length!==ft){var Sr=_.value.start;_.kind==="get"?this.raiseRecoverable(Sr,"getter should have no params"):this.raiseRecoverable(Sr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((z||L)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=te),_.kind="init",P?_.value=this.parseMaybeDefault(te,Ce,_.key):this.type===N.eq&&rt?(rt.shorthandAssign<0&&(rt.shorthandAssign=this.start),_.value=this.parseMaybeDefault(te,Ce,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Kr.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(N.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(N.bracketR),_.key;_.computed=!1}return _.key=this.type===N.num||this.type===N.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Kr.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Kr.parseMethod=function(_,P,z){var L=this.startNode(),te=this.yieldPos,Ce=this.awaitPos,rt=this.awaitIdentPos;return this.initFunction(L),this.options.ecmaVersion>=6&&(L.generator=_),this.options.ecmaVersion>=8&&(L.async=!!P),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(dr(P,L.generator)|gr|(z?qt:0)),this.expect(N.parenL),L.params=this.parseBindingList(N.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(L,!1,!0),this.yieldPos=te,this.awaitPos=Ce,this.awaitIdentPos=rt,this.finishNode(L,"FunctionExpression")},Kr.parseArrowExpression=function(_,P,z){var L=this.yieldPos,te=this.awaitPos,Ce=this.awaitIdentPos;return this.enterScope(dr(z,!1)|It),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!z),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(P,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=L,this.awaitPos=te,this.awaitIdentPos=Ce,this.finishNode(_,"ArrowFunctionExpression")},Kr.parseFunctionBody=function(_,P,z){var L=P&&this.type!==N.braceL,te=this.strict,Ce=!1;if(L)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var rt=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!te||rt)&&(Ce=this.strictDirective(this.end),Ce&&rt&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ct=this.labels;this.labels=[],Ce&&(this.strict=!0),this.checkParams(_,!te&&!Ce&&!P&&!z&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,un),_.body=this.parseBlock(!1,void 0,Ce&&!te),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=Ct}this.exitScope()},Kr.isSimpleParamList=function(_){for(var P=0,z=_;P<z.length;P+=1){var L=z[P];if(L.type!=="Identifier")return!1}return!0},Kr.checkParams=function(_,P){for(var z={},L=0,te=_.params;L<te.length;L+=1){var Ce=te[L];this.checkLVal(Ce,Ir,P?null:z)}},Kr.parseExprList=function(_,P,z,L){for(var te=[],Ce=!0;!this.eat(_);){if(Ce)Ce=!1;else if(this.expect(N.comma),P&&this.afterTrailingComma(_))break;var rt=void 0;z&&this.type===N.comma?rt=null:this.type===N.ellipsis?(rt=this.parseSpread(L),L&&this.type===N.comma&&L.trailingComma<0&&(L.trailingComma=this.start)):rt=this.parseMaybeAssign(!1,L),te.push(rt)}return te},Kr.checkUnreserved=function(_){var P=_.start,z=_.end,L=_.name;if(this.inGenerator&&L==="yield"&&this.raiseRecoverable(P,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&L==="await"&&this.raiseRecoverable(P,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(L)&&this.raise(P,"Unexpected keyword '"+L+"'"),!(this.options.ecmaVersion<6&&this.input.slice(P,z).indexOf("\\")!==-1)){var te=this.strict?this.reservedWordsStrict:this.reservedWords;te.test(L)&&(!this.inAsync&&L==="await"&&this.raiseRecoverable(P,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(P,"The keyword '"+L+"' is reserved"))}},Kr.parseIdent=function(_,P){var z=this.startNode();return this.type===N.name?z.name=this.value:this.type.keyword?(z.name=this.type.keyword,(z.name==="class"||z.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(z,"Identifier"),_||(this.checkUnreserved(z),z.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=z.start)),z},Kr.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var P=this.startNode();return this.next(),this.type===N.semi||this.canInsertSemicolon()||this.type!==N.star&&!this.type.startsExpr?(P.delegate=!1,P.argument=null):(P.delegate=this.eat(N.star),P.argument=this.parseMaybeAssign(_)),this.finishNode(P,"YieldExpression")},Kr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var li=_n.prototype;li.raise=function(_,P){var z=Se(this.input,_);P+=" ("+z.line+":"+z.column+")";var L=new SyntaxError(P);throw L.pos=_,L.loc=z,L.raisedAt=this.pos,L},li.raiseRecoverable=li.raise,li.curPosition=function(){if(this.options.locations)return new fe(this.curLine,this.pos-this.lineStart)};var Hn=_n.prototype,ii=function(P){this.flags=P,this.var=[],this.lexical=[],this.functions=[]};Hn.enterScope=function(_){this.scopeStack.push(new ii(_))},Hn.exitScope=function(){this.scopeStack.pop()},Hn.treatFunctionsAsVarInScope=function(_){return _.flags&sr||!this.inModule&&_.flags&wt},Hn.declareName=function(_,P,z){var L=!1;if(P===ur){var te=this.currentScope();L=te.lexical.indexOf(_)>-1||te.functions.indexOf(_)>-1||te.var.indexOf(_)>-1,te.lexical.push(_),this.inModule&&te.flags&wt&&delete this.undefinedExports[_]}else if(P===Yn){var Ce=this.currentScope();Ce.lexical.push(_)}else if(P===Rr){var rt=this.currentScope();this.treatFunctionsAsVar?L=rt.lexical.indexOf(_)>-1:L=rt.lexical.indexOf(_)>-1||rt.var.indexOf(_)>-1,rt.functions.push(_)}else for(var Ct=this.scopeStack.length-1;Ct>=0;--Ct){var ft=this.scopeStack[Ct];if(ft.lexical.indexOf(_)>-1&&!(ft.flags&$t&&ft.lexical[0]===_)||!this.treatFunctionsAsVarInScope(ft)&&ft.functions.indexOf(_)>-1){L=!0;break}if(ft.var.push(_),this.inModule&&ft.flags&wt&&delete this.undefinedExports[_],ft.flags&Or)break}L&&this.raiseRecoverable(z,"Identifier '"+_+"' has already been declared")},Hn.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},Hn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Hn.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var P=this.scopeStack[_];if(P.flags&Or)return P}},Hn.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var P=this.scopeStack[_];if(P.flags&Or&&!(P.flags&It))return P}};var Hi=function(P,z,L){this.type="",this.start=z,this.end=0,P.options.locations&&(this.loc=new Pe(P,L)),P.options.directSourceFile&&(this.sourceFile=P.options.directSourceFile),P.options.ranges&&(this.range=[z,0])},Wi=_n.prototype;Wi.startNode=function(){return new Hi(this,this.start,this.startLoc)},Wi.startNodeAt=function(_,P){return new Hi(this,_,P)};function To(_,P,z,L){return _.type=P,_.end=z,this.options.locations&&(_.loc.end=L),this.options.ranges&&(_.range[1]=z),_}Wi.finishNode=function(_,P){return To.call(this,_,P,this.lastTokEnd,this.lastTokEndLoc)},Wi.finishNodeAt=function(_,P,z,L){return To.call(this,_,P,z,L)};var Wa=function(P,z,L,te,Ce){this.token=P,this.isExpr=!!z,this.preserveSpace=!!L,this.override=te,this.generator=!!Ce},ma={b_stat:new Wa("{",!1),b_expr:new Wa("{",!0),b_tmpl:new Wa("${",!1),p_stat:new Wa("(",!1),p_expr:new Wa("(",!0),q_tmpl:new Wa("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Wa("function",!1),f_expr:new Wa("function",!0),f_expr_gen:new Wa("function",!0,!1,null,!0),f_gen:new Wa("function",!1,!1,null,!0)},As=_n.prototype;As.initialContext=function(){return[ma.b_stat]},As.braceIsBlock=function(_){var P=this.curContext();return P===ma.f_expr||P===ma.f_stat?!0:_===N.colon&&(P===ma.b_stat||P===ma.b_expr)?!P.isExpr:_===N._return||_===N.name&&this.exprAllowed?Re.test(this.input.slice(this.lastTokEnd,this.start)):_===N._else||_===N.semi||_===N.eof||_===N.parenR||_===N.arrow?!0:_===N.braceL?P===ma.b_stat:_===N._var||_===N._const||_===N.name?!1:!this.exprAllowed},As.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var P=this.context[_];if(P.token==="function")return P.generator}return!1},As.updateContext=function(_){var P,z=this.type;z.keyword&&_===N.dot?this.exprAllowed=!1:(P=z.updateContext)?P.call(this,_):this.exprAllowed=z.beforeExpr},N.parenR.updateContext=N.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===ma.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},N.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?ma.b_stat:ma.b_expr),this.exprAllowed=!0},N.dollarBraceL.updateContext=function(){this.context.push(ma.b_tmpl),this.exprAllowed=!0},N.parenL.updateContext=function(_){var P=_===N._if||_===N._for||_===N._with||_===N._while;this.context.push(P?ma.p_stat:ma.p_expr),this.exprAllowed=!0},N.incDec.updateContext=function(){},N._function.updateContext=N._class.updateContext=function(_){_.beforeExpr&&_!==N.semi&&_!==N._else&&!(_===N._return&&Re.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===N.colon||_===N.braceL)&&this.curContext()===ma.b_stat)?this.context.push(ma.f_expr):this.context.push(ma.f_stat),this.exprAllowed=!1},N.backQuote.updateContext=function(){this.curContext()===ma.q_tmpl?this.context.pop():this.context.push(ma.q_tmpl),this.exprAllowed=!1},N.star.updateContext=function(_){if(_===N._function){var P=this.context.length-1;this.context[P]===ma.f_expr?this.context[P]=ma.f_expr_gen:this.context[P]=ma.f_gen}this.exprAllowed=!0},N.name.updateContext=function(_){var P=!1;this.options.ecmaVersion>=6&&_!==N.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(P=!0),this.exprAllowed=P};var js="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Ra=js+" Extended_Pictographic",J=Ra,$={9:js,10:Ra,11:J},le="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",ke=ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",nt=ke+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",pt={9:ge,10:ke,11:nt},pe={};function Ue(_){var P=pe[_]={binary:br($[_]+" "+le),nonBinary:{General_Category:br(le),Script:br(pt[_])}};P.nonBinary.Script_Extensions=P.nonBinary.Script,P.nonBinary.gc=P.nonBinary.General_Category,P.nonBinary.sc=P.nonBinary.Script,P.nonBinary.scx=P.nonBinary.Script_Extensions}Ue(9),Ue(10),Ue(11);var qe=_n.prototype,Cr=function(P){this.parser=P,this.validFlags="gim"+(P.options.ecmaVersion>=6?"uy":"")+(P.options.ecmaVersion>=9?"s":""),this.unicodeProperties=pe[P.options.ecmaVersion>=11?11:P.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Cr.prototype.reset=function(P,z,L){var te=L.indexOf("u")!==-1;this.start=P|0,this.source=z+"",this.flags=L,this.switchU=te&&this.parser.options.ecmaVersion>=6,this.switchN=te&&this.parser.options.ecmaVersion>=9},Cr.prototype.raise=function(P){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+P)},Cr.prototype.at=function(P,z){z===void 0&&(z=!1);var L=this.source,te=L.length;if(P>=te)return-1;var Ce=L.charCodeAt(P);if(!(z||this.switchU)||Ce<=55295||Ce>=57344||P+1>=te)return Ce;var rt=L.charCodeAt(P+1);return rt>=56320&&rt<=57343?(Ce<<10)+rt-56613888:Ce},Cr.prototype.nextIndex=function(P,z){z===void 0&&(z=!1);var L=this.source,te=L.length;if(P>=te)return te;var Ce=L.charCodeAt(P),rt;return!(z||this.switchU)||Ce<=55295||Ce>=57344||P+1>=te||(rt=L.charCodeAt(P+1))<56320||rt>57343?P+1:P+2},Cr.prototype.current=function(P){return P===void 0&&(P=!1),this.at(this.pos,P)},Cr.prototype.lookahead=function(P){return P===void 0&&(P=!1),this.at(this.nextIndex(this.pos,P),P)},Cr.prototype.advance=function(P){P===void 0&&(P=!1),this.pos=this.nextIndex(this.pos,P)},Cr.prototype.eat=function(P,z){return z===void 0&&(z=!1),this.current(z)===P?(this.advance(z),!0):!1};function Tr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}qe.validateRegExpFlags=function(_){for(var P=_.validFlags,z=_.flags,L=0;L<z.length;L++){var te=z.charAt(L);P.indexOf(te)===-1&&this.raise(_.start,"Invalid regular expression flag"),z.indexOf(te,L+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},qe.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},qe.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var P=0,z=_.backReferenceNames;P<z.length;P+=1){var L=z[P];_.groupNames.indexOf(L)===-1&&_.raise("Invalid named capture referenced")}},qe.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},qe.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},qe.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},qe.regexp_eatAssertion=function(_){var P=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=P}if(_.eat(40)&&_.eat(63)){var z=!1;if(this.options.ecmaVersion>=9&&(z=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!z,!0}return _.pos=P,!1},qe.regexp_eatQuantifier=function(_,P){return P===void 0&&(P=!1),this.regexp_eatQuantifierPrefix(_,P)?(_.eat(63),!0):!1},qe.regexp_eatQuantifierPrefix=function(_,P){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,P)},qe.regexp_eatBracedQuantifier=function(_,P){var z=_.pos;if(_.eat(123)){var L=0,te=-1;if(this.regexp_eatDecimalDigits(_)&&(L=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(te=_.lastIntValue),_.eat(125)))return te!==-1&&te<L&&!P&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!P&&_.raise("Incomplete quantifier"),_.pos=z}return!1},qe.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},qe.regexp_eatReverseSolidusAtomEscape=function(_){var P=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=P}return!1},qe.regexp_eatUncapturingGroup=function(_){var P=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=P}return!1},qe.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},qe.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},qe.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},qe.regexp_eatSyntaxCharacter=function(_){var P=_.current();return tr(P)?(_.lastIntValue=P,_.advance(),!0):!1};function tr(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}qe.regexp_eatPatternCharacters=function(_){for(var P=_.pos,z=0;(z=_.current())!==-1&&!tr(z);)_.advance();return _.pos!==P},qe.regexp_eatExtendedPatternCharacter=function(_){var P=_.current();return P!==-1&&P!==36&&!(P>=40&&P<=43)&&P!==46&&P!==63&&P!==91&&P!==94&&P!==124?(_.advance(),!0):!1},qe.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},qe.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},qe.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=Tr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=Tr(_.lastIntValue);return!0}return!1},qe.regexp_eatRegExpIdentifierStart=function(_){var P=_.pos,z=this.options.ecmaVersion>=11,L=_.current(z);return _.advance(z),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,z)&&(L=_.lastIntValue),Dr(L)?(_.lastIntValue=L,!0):(_.pos=P,!1)};function Dr(_){return at(_,!0)||_===36||_===95}qe.regexp_eatRegExpIdentifierPart=function(_){var P=_.pos,z=this.options.ecmaVersion>=11,L=_.current(z);return _.advance(z),L===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,z)&&(L=_.lastIntValue),nn(L)?(_.lastIntValue=L,!0):(_.pos=P,!1)};function nn(_){return ht(_,!0)||_===36||_===95||_===8204||_===8205}qe.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},qe.regexp_eatBackReference=function(_){var P=_.pos;if(this.regexp_eatDecimalEscape(_)){var z=_.lastIntValue;if(_.switchU)return z>_.maxBackReference&&(_.maxBackReference=z),!0;if(z<=_.numCapturingParens)return!0;_.pos=P}return!1},qe.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},qe.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},qe.regexp_eatCControlLetter=function(_){var P=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=P}return!1},qe.regexp_eatZero=function(_){return _.current()===48&&!w(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},qe.regexp_eatControlEscape=function(_){var P=_.current();return P===116?(_.lastIntValue=9,_.advance(),!0):P===110?(_.lastIntValue=10,_.advance(),!0):P===118?(_.lastIntValue=11,_.advance(),!0):P===102?(_.lastIntValue=12,_.advance(),!0):P===114?(_.lastIntValue=13,_.advance(),!0):!1},qe.regexp_eatControlLetter=function(_){var P=_.current();return Mn(P)?(_.lastIntValue=P%32,_.advance(),!0):!1};function Mn(_){return _>=65&&_<=90||_>=97&&_<=122}qe.regexp_eatRegExpUnicodeEscapeSequence=function(_,P){P===void 0&&(P=!1);var z=_.pos,L=P||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var te=_.lastIntValue;if(L&&te>=55296&&te<=56319){var Ce=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var rt=_.lastIntValue;if(rt>=56320&&rt<=57343)return _.lastIntValue=(te-55296)*1024+(rt-56320)+65536,!0}_.pos=Ce,_.lastIntValue=te}return!0}if(L&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&rr(_.lastIntValue))return!0;L&&_.raise("Invalid unicode escape"),_.pos=z}return!1};function rr(_){return _>=0&&_<=1114111}qe.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var P=_.current();return P!==99&&(!_.switchN||P!==107)?(_.lastIntValue=P,_.advance(),!0):!1},qe.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var P=_.current();if(P>=49&&P<=57){do _.lastIntValue=10*_.lastIntValue+(P-48),_.advance();while((P=_.current())>=48&&P<=57);return!0}return!1},qe.regexp_eatCharacterClassEscape=function(_){var P=_.current();if(wn(P))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(P===80||P===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function wn(_){return _===100||_===68||_===115||_===83||_===119||_===87}qe.regexp_eatUnicodePropertyValueExpression=function(_){var P=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var z=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var L=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,z,L),!0}}if(_.pos=P,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var te=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,te),!0}return!1},qe.regexp_validateUnicodePropertyNameAndValue=function(_,P,z){Fr(_.unicodeProperties.nonBinary,P)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[P].test(z)||_.raise("Invalid property value")},qe.regexp_validateUnicodePropertyNameOrValue=function(_,P){_.unicodeProperties.binary.test(P)||_.raise("Invalid property name")},qe.regexp_eatUnicodePropertyName=function(_){var P=0;for(_.lastStringValue="";mn(P=_.current());)_.lastStringValue+=Tr(P),_.advance();return _.lastStringValue!==""};function mn(_){return Mn(_)||_===95}qe.regexp_eatUnicodePropertyValue=function(_){var P=0;for(_.lastStringValue="";xn(P=_.current());)_.lastStringValue+=Tr(P),_.advance();return _.lastStringValue!==""};function xn(_){return mn(_)||w(_)}qe.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},qe.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},qe.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var P=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var z=_.lastIntValue;_.switchU&&(P===-1||z===-1)&&_.raise("Invalid character class"),P!==-1&&z!==-1&&P>z&&_.raise("Range out of order in character class")}}},qe.regexp_eatClassAtom=function(_){var P=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var z=_.current();(z===99||Zi(z))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=P}var L=_.current();return L!==93?(_.lastIntValue=L,_.advance(),!0):!1},qe.regexp_eatClassEscape=function(_){var P=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=P}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},qe.regexp_eatClassControlLetter=function(_){var P=_.current();return w(P)||P===95?(_.lastIntValue=P%32,_.advance(),!0):!1},qe.regexp_eatHexEscapeSequence=function(_){var P=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=P}return!1},qe.regexp_eatDecimalDigits=function(_){var P=_.pos,z=0;for(_.lastIntValue=0;w(z=_.current());)_.lastIntValue=10*_.lastIntValue+(z-48),_.advance();return _.pos!==P};function w(_){return _>=48&&_<=57}qe.regexp_eatHexDigits=function(_){var P=_.pos,z=0;for(_.lastIntValue=0;An(z=_.current());)_.lastIntValue=16*_.lastIntValue+Lr(z),_.advance();return _.pos!==P};function An(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function Lr(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}qe.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var P=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var z=_.lastIntValue;P<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=P*64+z*8+_.lastIntValue:_.lastIntValue=P*8+z}else _.lastIntValue=P;return!0}return!1},qe.regexp_eatOctalDigit=function(_){var P=_.current();return Zi(P)?(_.lastIntValue=P-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Zi(_){return _>=48&&_<=55}qe.regexp_eatFixedHexDigits=function(_,P){var z=_.pos;_.lastIntValue=0;for(var L=0;L<P;++L){var te=_.current();if(!An(te))return _.pos=z,!1;_.lastIntValue=16*_.lastIntValue+Lr(te),_.advance()}return!0};var Ti=function(P){this.type=P.type,this.value=P.value,this.start=P.start,this.end=P.end,P.options.locations&&(this.loc=new Pe(P,P.startLoc,P.endLoc)),P.options.ranges&&(this.range=[P.start,P.end])},Un=_n.prototype;Un.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Ti(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Un.getToken=function(){return this.next(),new Ti(this)},typeof Symbol!="undefined"&&(Un[Symbol.iterator]=function(){var _=this;return{next:function(){var z=_.getToken();return{done:z.type===N.eof,value:z}}}}),Un.curContext=function(){return this.context[this.context.length-1]},Un.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(N.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},Un.readToken=function(_){return at(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},Un.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var P=this.input.charCodeAt(this.pos+1);return(_<<10)+P-56613888},Un.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),P=this.pos,z=this.input.indexOf("*/",this.pos+=2);if(z===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=z+2,this.options.locations){Nr.lastIndex=P;for(var L;(L=Nr.exec(this.input))&&L.index<this.pos;)++this.curLine,this.lineStart=L.index+L[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(P+2,z),P,this.pos,_,this.curPosition())},Un.skipLineComment=function(_){for(var P=this.pos,z=this.options.onComment&&this.curPosition(),L=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Pr(L);)L=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(P+_,this.pos),P,this.pos,z,this.curPosition())},Un.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&Wt.test(String.fromCharCode(_)))++this.pos;else break e}}},Un.finishToken=function(_,P){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var z=this.type;this.type=_,this.value=P,this.updateContext(z)},Un.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var P=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&P===46?(this.pos+=3,this.finishToken(N.ellipsis)):(++this.pos,this.finishToken(N.dot))},Un.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(N.assign,2):this.finishOp(N.slash,1)},Un.readToken_mult_modulo_exp=function(_){var P=this.input.charCodeAt(this.pos+1),z=1,L=_===42?N.star:N.modulo;return this.options.ecmaVersion>=7&&_===42&&P===42&&(++z,L=N.starstar,P=this.input.charCodeAt(this.pos+2)),P===61?this.finishOp(N.assign,z+1):this.finishOp(L,z)},Un.readToken_pipe_amp=function(_){var P=this.input.charCodeAt(this.pos+1);if(P===_){if(this.options.ecmaVersion>=12){var z=this.input.charCodeAt(this.pos+2);if(z===61)return this.finishOp(N.assign,3)}return this.finishOp(_===124?N.logicalOR:N.logicalAND,2)}return P===61?this.finishOp(N.assign,2):this.finishOp(_===124?N.bitwiseOR:N.bitwiseAND,1)},Un.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(N.assign,2):this.finishOp(N.bitwiseXOR,1)},Un.readToken_plus_min=function(_){var P=this.input.charCodeAt(this.pos+1);return P===_?P===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Re.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(N.incDec,2):P===61?this.finishOp(N.assign,2):this.finishOp(N.plusMin,1)},Un.readToken_lt_gt=function(_){var P=this.input.charCodeAt(this.pos+1),z=1;return P===_?(z=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+z)===61?this.finishOp(N.assign,z+1):this.finishOp(N.bitShift,z)):P===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(P===61&&(z=2),this.finishOp(N.relational,z))},Un.readToken_eq_excl=function(_){var P=this.input.charCodeAt(this.pos+1);return P===61?this.finishOp(N.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&P===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(N.arrow)):this.finishOp(_===61?N.eq:N.prefix,1)},Un.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var P=this.input.charCodeAt(this.pos+1);if(P===46){var z=this.input.charCodeAt(this.pos+2);if(z<48||z>57)return this.finishOp(N.questionDot,2)}if(P===63){if(_>=12){var L=this.input.charCodeAt(this.pos+2);if(L===61)return this.finishOp(N.assign,3)}return this.finishOp(N.coalesce,2)}}return this.finishOp(N.question,1)},Un.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(N.parenL);case 41:return++this.pos,this.finishToken(N.parenR);case 59:return++this.pos,this.finishToken(N.semi);case 44:return++this.pos,this.finishToken(N.comma);case 91:return++this.pos,this.finishToken(N.bracketL);case 93:return++this.pos,this.finishToken(N.bracketR);case 123:return++this.pos,this.finishToken(N.braceL);case 125:return++this.pos,this.finishToken(N.braceR);case 58:return++this.pos,this.finishToken(N.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(N.backQuote);case 48:var P=this.input.charCodeAt(this.pos+1);if(P===120||P===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(P===111||P===79)return this.readRadixNumber(8);if(P===98||P===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(N.prefix,1)}this.raise(this.pos,"Unexpected character '"+ra(_)+"'")},Un.finishOp=function(_,P){var z=this.input.slice(this.pos,this.pos+P);return this.pos+=P,this.finishToken(_,z)},Un.readRegexp=function(){for(var _,P,z=this.pos;;){this.pos>=this.input.length&&this.raise(z,"Unterminated regular expression");var L=this.input.charAt(this.pos);if(Re.test(L)&&this.raise(z,"Unterminated regular expression"),_)_=!1;else{if(L==="[")P=!0;else if(L==="]"&&P)P=!1;else if(L==="/"&&!P)break;_=L==="\\"}++this.pos}var te=this.input.slice(z,this.pos);++this.pos;var Ce=this.pos,rt=this.readWord1();this.containsEsc&&this.unexpected(Ce);var Ct=this.regexpState||(this.regexpState=new Cr(this));Ct.reset(z,te,rt),this.validateRegExpFlags(Ct),this.validateRegExpPattern(Ct);var ft=null;try{ft=new RegExp(te,rt)}catch(Sr){}return this.finishToken(N.regexp,{pattern:te,flags:rt,value:ft})},Un.readInt=function(_,P,z){for(var L=this.options.ecmaVersion>=12&&P===void 0,te=z&&this.input.charCodeAt(this.pos)===48,Ce=this.pos,rt=0,Ct=0,ft=0,Sr=P==null?Infinity:P;ft<Sr;++ft,++this.pos){var kr=this.input.charCodeAt(this.pos),ni=void 0;if(L&&kr===95){te&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ct===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),ft===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ct=kr;continue}if(kr>=97?ni=kr-97+10:kr>=65?ni=kr-65+10:kr>=48&&kr<=57?ni=kr-48:ni=Infinity,ni>=_)break;Ct=kr,rt=rt*_+ni}return L&&Ct===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Ce||P!=null&&this.pos-Ce!==P?null:rt};function Bi(_,P){return P?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Mo(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}Un.readRadixNumber=function(_){var P=this.pos;this.pos+=2;var z=this.readInt(_);return z==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(z=Mo(this.input.slice(P,this.pos)),++this.pos):at(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(N.num,z)},Un.readNumber=function(_){var P=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(P,"Invalid number");var z=this.pos-P>=2&&this.input.charCodeAt(P)===48;z&&this.strict&&this.raise(P,"Invalid number");var L=this.input.charCodeAt(this.pos);if(!z&&!_&&this.options.ecmaVersion>=11&&L===110){var te=Mo(this.input.slice(P,this.pos));return++this.pos,at(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(N.num,te)}z&&/[89]/.test(this.input.slice(P,this.pos))&&(z=!1),L===46&&!z&&(++this.pos,this.readInt(10),L=this.input.charCodeAt(this.pos)),(L===69||L===101)&&!z&&(L=this.input.charCodeAt(++this.pos),(L===43||L===45)&&++this.pos,this.readInt(10)===null&&this.raise(P,"Invalid number")),at(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Ce=Bi(this.input.slice(P,this.pos),z);return this.finishToken(N.num,Ce)},Un.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),P;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var z=++this.pos;P=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,P>1114111&&this.invalidStringToken(z,"Code point out of bounds")}else P=this.readHexChar(4);return P};function ra(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Un.readString=function(_){for(var P="",z=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var L=this.input.charCodeAt(this.pos);if(L===_)break;L===92?(P+=this.input.slice(z,this.pos),P+=this.readEscapedChar(!1),z=this.pos):(Pr(L,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return P+=this.input.slice(z,this.pos++),this.finishToken(N.string,P)};var to={};Un.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===to)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},Un.invalidStringToken=function(_,P){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw to;this.raise(_,P)},Un.readTmplToken=function(){for(var _="",P=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var z=this.input.charCodeAt(this.pos);if(z===96||z===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===N.template||this.type===N.invalidTemplate)?z===36?(this.pos+=2,this.finishToken(N.dollarBraceL)):(++this.pos,this.finishToken(N.backQuote)):(_+=this.input.slice(P,this.pos),this.finishToken(N.template,_));if(z===92)_+=this.input.slice(P,this.pos),_+=this.readEscapedChar(!0),P=this.pos;else if(Pr(z)){switch(_+=this.input.slice(P,this.pos),++this.pos,z){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(z);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),P=this.pos}else++this.pos}},Un.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(N.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Un.readEscapedChar=function(_){var P=this.input.charCodeAt(++this.pos);switch(++this.pos,P){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ra(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var z=this.pos-1;return this.invalidStringToken(z,"Invalid escape sequence in template string"),null}default:if(P>=48&&P<=55){var L=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],te=parseInt(L,8);return te>255&&(L=L.slice(0,-1),te=parseInt(L,8)),this.pos+=L.length-1,P=this.input.charCodeAt(this.pos),(L!=="0"||P===56||P===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-L.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(te)}return Pr(P)?"":String.fromCharCode(P)}},Un.readHexChar=function(_){var P=this.pos,z=this.readInt(16,_);return z===null&&this.invalidStringToken(P,"Bad character escape sequence"),z},Un.readWord1=function(){this.containsEsc=!1;for(var _="",P=!0,z=this.pos,L=this.options.ecmaVersion>=6;this.pos<this.input.length;){var te=this.fullCharCodeAtPos();if(ht(te,L))this.pos+=te<=65535?1:2;else if(te===92){this.containsEsc=!0,_+=this.input.slice(z,this.pos);var Ce=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var rt=this.readCodePoint();(P?at:ht)(rt,L)||this.invalidStringToken(Ce,"Invalid Unicode escape"),_+=ra(rt),z=this.pos}else break;P=!1}return _+this.input.slice(z,this.pos)},Un.readWord=function(){var _=this.readWord1(),P=N.name;return this.keywords.test(_)&&(P=st[_]),this.finishToken(P,_)};var ca="7.4.1";_n.acorn={Parser:_n,version:ca,defaultOptions:lt,Position:fe,SourceLocation:Pe,getLineInfo:Se,Node:Hi,TokenType:vt,tokTypes:N,keywordTypes:st,TokContext:Wa,tokContexts:ma,isIdentifierChar:ht,isIdentifierStart:at,Token:Ti,isNewLine:Pr,lineBreak:Re,lineBreakG:Nr,nonASCIIwhitespace:Wt};function ci(_,P){return _n.parse(_,P)}function bi(_,P,z){return _n.parseExpressionAt(_,P,z)}function vo(_,P){return _n.tokenizer(_,P)}function mo(_,P){_.prototype=Object.create(P.prototype),_.prototype.constructor=_,_.__proto__=P}function ia(_){var P=typeof Map=="function"?new Map:void 0;return ia=function(L){if(L===null||!bl(L))return L;if(typeof L!="function")throw new TypeError("Super expression must either be null or a function");if(typeof P!="undefined"){if(P.has(L))return P.get(L);P.set(L,te)}function te(){return so(L,arguments,cu(this).constructor)}return te.prototype=Object.create(L.prototype,{constructor:{value:te,enumerable:!1,writable:!0,configurable:!0}}),Ta(te,L)},ia(_)}function Za(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function so(_,P,z){return Za()?so=Reflect.construct:so=function(te,Ce,rt){var Ct=[null];Ct.push.apply(Ct,Ce);var ft=Function.bind.apply(te,Ct),Sr=new ft;return rt&&Ta(Sr,rt.prototype),Sr},so.apply(null,arguments)}function bl(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function Ta(_,P){return Ta=Object.setPrototypeOf||function(L,te){return L.__proto__=te,L},Ta(_,P)}function cu(_){return cu=Object.setPrototypeOf?Object.getPrototypeOf:function(z){return z.__proto__||Object.getPrototypeOf(z)},cu(_)}var ga=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(ia(Error)),Va=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(ia(SyntaxError)),Co=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(ia(ReferenceError)),wa=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(ia(TypeError)),qo=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(ga),wo=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(Va),jo=function(_){mo(P,_);function P(){return _.apply(this,arguments)||this}return P}(Co),ya={UnknownError:[3001,"%0",qo],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",qo],NodeTypeSyntaxError:[1001,"Unknown node type: %0",jo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",jo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",jo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",jo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",jo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",jo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",jo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",jo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",jo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",jo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Co],VariableUndefinedReferenceError:[2002,"%0 is not defined",Co],IsNotConstructor:[2003,"%0 is not a constructor",wa]};function Nl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ls(_,P,z){return Nl()?ls=Reflect.construct:ls=function(te,Ce,rt){var Ct=[null];Ct.push.apply(Ct,Ce);var ft=Function.bind.apply(te,Ct),Sr=new ft;return rt&&uo(Sr,rt.prototype),Sr},ls.apply(null,arguments)}function uo(_,P){return uo=Object.setPrototypeOf||function(L,te){return L.__proto__=te,L},uo(_,P)}var $s="0.0.3";function Lo(_,P){Object.defineProperty(_,"name",{value:P,writable:!1,enumerable:!1,configurable:!0})}var go=Object.prototype.hasOwnProperty,We=Symbol("Break"),se=Symbol("Continue"),Be=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),Zr=Symbol("WithScopeName"),kn=Symbol("SuperScopeName"),Ni=Symbol("RootScopeName"),Na=Symbol("GlobalScopeName");function Ma(_){return typeof _=="function"}var Xa=function(){function _(z){this.interpreter=z}var P=_.prototype;return P.generator=function(){var L=this.interpreter;function te(){return this.getCurrentScope()}function Ce(){return this.getGlobalScope()}function rt(){return this.getCurrentContext()}return{getOptions:L.getOptions.bind(L),getCurrentScope:te.bind(L),getGlobalScope:Ce.bind(L),getCurrentContext:rt.bind(L),getExecStartTime:L.getExecStartTime.bind(L)}},_}();function Do(_,P,z){if(z===void 0&&(z=!0),!(_ instanceof Xa))throw new Error("Illegal call");if(typeof P!="string")return P;if(!!P){var L=_.generator(),te=L.getOptions(),Ce={timeout:te.timeout,_initEnv:function(){z||this.setCurrentContext(L.getCurrentContext()),this.execStartTime=L.getExecStartTime(),this.execEndTime=this.execStartTime}},rt=z?L.getGlobalScope():L.getCurrentScope(),Ct=new Ga(rt,Ce);return Ct.evaluate(P)}}Object.defineProperty(Do,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function $c(_){if(!(_ instanceof Xa))throw new Error("Illegal call");for(var P=_.generator(),z=arguments.length,L=new Array(z>1?z-1:0),te=1;te<z;te++)L[te-1]=arguments[te];var Ce=L.pop(),rt=new Ga(P.getGlobalScope(),P.getOptions()),Ct=`
		    (function anonymous(`+L.join(",")+`){
		        `+Ce+`
		    });
		    `;return rt.evaluate(Ct)}Object.defineProperty($c,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var Ks=function(P){this.value=P},Qo=function(P){this.value=P},Vo=function(P){this.value=P},qs=function(P,z,L){z===void 0&&(z=null),this.name=L,this.parent=z,this.data=P,this.labelStack=[]};function gu(){}function Vs(_,P){return _===void 0&&(_=null),new qs(Object.create(null),_,P)}function nl(_){return Object.create(_)}var Qs={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Do,Function:$c};typeof JSON!="undefined"&&(Qs.JSON=JSON),typeof Promise!="undefined"&&(Qs.Promise=Promise),typeof Set!="undefined"&&(Qs.Set=Set),typeof Map!="undefined"&&(Qs.Map=Map),typeof Symbol!="undefined"&&(Qs.Symbol=Symbol),typeof Proxy!="undefined"&&(Qs.Proxy=Proxy),typeof WeakMap!="undefined"&&(Qs.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Qs.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Qs.Reflect=Reflect);var Ga=function(){function _(z,L){z===void 0&&(z=_.global),L===void 0&&(L={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:L.ecmaVersion||_.ecmaVersion,timeout:L.timeout||0,rootContext:L.rootContext,globalContextInFunction:L.globalContextInFunction===void 0?_.globalContextInFunction:L.globalContextInFunction,_initEnv:L._initEnv},this.context=z||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var P=_.prototype;return P.initEnvironment=function(L){var te;if(L instanceof qs)te=L;else{var Ce=null,rt=this.createSuperScope(L);this.options.rootContext&&(Ce=new qs(nl(this.options.rootContext),rt,Ni)),te=new qs(L,Ce||rt,Na)}this.globalScope=te,this.currentScope=this.globalScope,this.globalContext=te.data,this.currentContext=te.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Ct=this.options._initEnv;Ct&&Ct.call(this)},P.getExecStartTime=function(){return this.execStartTime},P.getExecutionTime=function(){return this.execEndTime-this.execStartTime},P.setExecTimeout=function(L){L===void 0&&(L=0),this.options.timeout=L},P.getOptions=function(){return this.options},P.getGlobalScope=function(){return this.globalScope},P.getCurrentScope=function(){return this.currentScope},P.getCurrentContext=function(){return this.currentContext},P.isInterruptThrow=function(L){return L instanceof qo||L instanceof jo||L instanceof wo},P.createSuperScope=function(L){var te=Object.assign({},Qs),Ce=Object.keys(te);return Ce.forEach(function(rt){rt in L&&delete te[rt]}),new qs(te,null,kn)},P.setCurrentContext=function(L){this.currentContext=L},P.setCurrentScope=function(L){this.currentScope=L},P.evaluate=function(L){L===void 0&&(L="");var te;if(!!L)return te=ci(L,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(te,L)},P.appendCode=function(L){return this.evaluate(L)},P.evaluateNode=function(L,te){var Ce=this;te===void 0&&(te=""),this.value=void 0,this.source=te,this.sourceList.push(te),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var rt=this.getCurrentScope(),Ct=this.getCurrentContext(),ft=rt.labelStack.concat([]),Sr=this.callStack.concat([]),kr=function(){Ce.setCurrentScope(rt),Ce.setCurrentContext(Ct),rt.labelStack=ft,Ce.callStack=Sr};try{var ni=this.createClosure(L);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),ni()}catch(xi){throw xi}finally{kr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},P.createErrorMessage=function(L,te,Ce){var rt=L[1].replace("%0",String(te));return Ce!==null&&(rt+=this.getNodePosition(Ce||this.lastExecNode)),rt},P.createError=function(L,te){return new te(L)},P.createThrowError=function(L,te){return this.createError(L,te)},P.createInternalThrowError=function(L,te,Ce){return this.createError(this.createErrorMessage(L,te,Ce),L[2])},P.checkTimeout=function(){if(!this.isRunning)return!1;var L=this.options.timeout||0,te=Date.now();return te-this.execStartTime>L},P.getNodePosition=function(L){if(L){var te="";return L.loc?" ["+L.loc.start.line+":"+L.loc.start.column+"]"+te:""}return""},P.createClosure=function(L){var te=this,Ce;switch(L.type){case"BinaryExpression":Ce=this.binaryExpressionHandler(L);break;case"LogicalExpression":Ce=this.logicalExpressionHandler(L);break;case"UnaryExpression":Ce=this.unaryExpressionHandler(L);break;case"UpdateExpression":Ce=this.updateExpressionHandler(L);break;case"ObjectExpression":Ce=this.objectExpressionHandler(L);break;case"ArrayExpression":Ce=this.arrayExpressionHandler(L);break;case"CallExpression":Ce=this.callExpressionHandler(L);break;case"NewExpression":Ce=this.newExpressionHandler(L);break;case"MemberExpression":Ce=this.memberExpressionHandler(L);break;case"ThisExpression":Ce=this.thisExpressionHandler(L);break;case"SequenceExpression":Ce=this.sequenceExpressionHandler(L);break;case"Literal":Ce=this.literalHandler(L);break;case"Identifier":Ce=this.identifierHandler(L);break;case"AssignmentExpression":Ce=this.assignmentExpressionHandler(L);break;case"FunctionDeclaration":Ce=this.functionDeclarationHandler(L);break;case"VariableDeclaration":Ce=this.variableDeclarationHandler(L);break;case"BlockStatement":case"Program":Ce=this.programHandler(L);break;case"ExpressionStatement":Ce=this.expressionStatementHandler(L);break;case"EmptyStatement":Ce=this.emptyStatementHandler(L);break;case"ReturnStatement":Ce=this.returnStatementHandler(L);break;case"FunctionExpression":Ce=this.functionExpressionHandler(L);break;case"IfStatement":Ce=this.ifStatementHandler(L);break;case"ConditionalExpression":Ce=this.conditionalExpressionHandler(L);break;case"ForStatement":Ce=this.forStatementHandler(L);break;case"WhileStatement":Ce=this.whileStatementHandler(L);break;case"DoWhileStatement":Ce=this.doWhileStatementHandler(L);break;case"ForInStatement":Ce=this.forInStatementHandler(L);break;case"WithStatement":Ce=this.withStatementHandler(L);break;case"ThrowStatement":Ce=this.throwStatementHandler(L);break;case"TryStatement":Ce=this.tryStatementHandler(L);break;case"ContinueStatement":Ce=this.continueStatementHandler(L);break;case"BreakStatement":Ce=this.breakStatementHandler(L);break;case"SwitchStatement":Ce=this.switchStatementHandler(L);break;case"LabeledStatement":Ce=this.labeledStatementHandler(L);break;case"DebuggerStatement":Ce=this.debuggerStatementHandler(L);break;default:throw this.createInternalThrowError(ya.NodeTypeSyntaxError,L.type,L)}return function(){var rt=te.options.timeout;if(rt&&rt>0&&te.checkTimeout())throw te.createInternalThrowError(ya.ExecutionTimeOutError,rt,null);return te.lastExecNode=L,Ce.apply(void 0,arguments)}},P.binaryExpressionHandler=function(L){var te=this,Ce=this.createClosure(L.left),rt=this.createClosure(L.right);return function(){var Ct=Ce(),ft=rt();switch(L.operator){case"==":return Ct==ft;case"!=":return Ct!=ft;case"===":return Ct===ft;case"!==":return Ct!==ft;case"<":return Ct<ft;case"<=":return Ct<=ft;case">":return Ct>ft;case">=":return Ct>=ft;case"<<":return Ct<<ft;case">>":return Ct>>ft;case">>>":return Ct>>>ft;case"+":return Ct+ft;case"-":return Ct-ft;case"*":return Ct*ft;case"**":return Math.pow(Ct,ft);case"/":return Ct/ft;case"%":return Ct%ft;case"|":return Ct|ft;case"^":return Ct^ft;case"&":return Ct&ft;case"in":return Ct in ft;case"instanceof":return Ct instanceof ft;default:throw te.createInternalThrowError(ya.BinaryOperatorSyntaxError,L.operator,L)}}},P.logicalExpressionHandler=function(L){var te=this,Ce=this.createClosure(L.left),rt=this.createClosure(L.right);return function(){switch(L.operator){case"||":return Ce()||rt();case"&&":return Ce()&&rt();default:throw te.createInternalThrowError(ya.LogicalOperatorSyntaxError,L.operator,L)}}},P.unaryExpressionHandler=function(L){var te=this;switch(L.operator){case"delete":var Ce=this.createObjectGetter(L.argument),rt=this.createNameGetter(L.argument);return function(){var kr=Ce(),ni=rt();return delete kr[ni]};default:var Ct;if(L.operator==="typeof"&&L.argument.type==="Identifier"){var ft=this.createObjectGetter(L.argument),Sr=this.createNameGetter(L.argument);Ct=function(){return ft()[Sr()]}}else Ct=this.createClosure(L.argument);return function(){var kr=Ct();switch(L.operator){case"-":return-kr;case"+":return+kr;case"!":return!kr;case"~":return~kr;case"void":return;case"typeof":return typeof kr;default:throw te.createInternalThrowError(ya.UnaryOperatorSyntaxError,L.operator,L)}}}},P.updateExpressionHandler=function(L){var te=this,Ce=this.createObjectGetter(L.argument),rt=this.createNameGetter(L.argument);return function(){var Ct=Ce(),ft=rt();switch(te.assertVariable(Ct,ft,L),L.operator){case"++":return L.prefix?++Ct[ft]:Ct[ft]++;case"--":return L.prefix?--Ct[ft]:Ct[ft]--;default:throw te.createInternalThrowError(ya.UpdateOperatorSyntaxError,L.operator,L)}}},P.objectExpressionHandler=function(L){var te=this,Ce=[];function rt(ft){return ft.type==="Identifier"?ft.name:ft.type==="Literal"?ft.value:this.throwError(ya.ObjectStructureSyntaxError,ft.type,ft)}var Ct=Object.create(null);return L.properties.forEach(function(ft){var Sr=ft.kind,kr=rt(ft.key);(!Ct[kr]||Sr==="init")&&(Ct[kr]={}),Ct[kr][Sr]=te.createClosure(ft.value),Ce.push({key:kr,property:ft})}),function(){for(var ft={},Sr=Ce.length,kr=0;kr<Sr;kr++){var ni=Ce[kr],xi=ni.key,gi=Ct[xi],dt=gi.init?gi.init():void 0,ua=gi.get?gi.get():function(){},yt=gi.set?gi.set():function(Sl){};if("set"in gi||"get"in gi){var fu={configurable:!0,enumerable:!0,get:ua,set:yt};Object.defineProperty(ft,xi,fu)}else{var Ha=ni.property,fa=Ha.kind;Ha.key.type==="Identifier"&&Ha.value.type==="FunctionExpression"&&fa==="init"&&!Ha.value.id&&Lo(dt,Ha.key.name),ft[xi]=dt}}return ft}},P.arrayExpressionHandler=function(L){var te=this,Ce=L.elements.map(function(rt){return rt&&te.createClosure(rt)});return function(){for(var rt=Ce.length,Ct=Array(rt),ft=0;ft<rt;ft++){var Sr=Ce[ft];Sr&&(Ct[ft]=Sr())}return Ct}},P.safeObjectGet=function(L,te,Ce){return L[te]},P.createCallFunctionGetter=function(L){var te=this;switch(L.type){case"MemberExpression":var Ce=this.createClosure(L.object),rt=this.createMemberKeyGetter(L),Ct=this.source;return function(){var Sr=Ce(),kr=rt(),ni=te.safeObjectGet(Sr,kr,L);if(!ni||!Ma(ni)){var xi=Ct.slice(L.start,L.end);throw te.createInternalThrowError(ya.FunctionUndefinedReferenceError,xi,L)}return ni.__IS_EVAL_FUNC?function(gi){return ni(new Xa(te),gi,!0)}:ni.__IS_FUNCTION_FUNC?function(){for(var gi=arguments.length,dt=new Array(gi),ua=0;ua<gi;ua++)dt[ua]=arguments[ua];return ni.apply(void 0,[new Xa(te)].concat(dt))}:ni.bind(Sr)};default:var ft=this.createClosure(L);return function(){var Sr="";L.type==="Identifier"&&(Sr=L.name);var kr=ft();if(!kr||!Ma(kr))throw te.createInternalThrowError(ya.FunctionUndefinedReferenceError,Sr,L);if(L.type==="Identifier"&&kr.__IS_EVAL_FUNC&&Sr==="eval")return function(gi){var dt=te.getScopeFromName(Sr,te.getCurrentScope()),ua=dt.name===kn||dt.name===Na||dt.name===Ni;return kr(new Xa(te),gi,!ua)};if(kr.__IS_EVAL_FUNC)return function(gi){return kr(new Xa(te),gi,!0)};if(kr.__IS_FUNCTION_FUNC)return function(){for(var gi=arguments.length,dt=new Array(gi),ua=0;ua<gi;ua++)dt[ua]=arguments[ua];return kr.apply(void 0,[new Xa(te)].concat(dt))};var ni=te.options.globalContextInFunction;if(L.type==="Identifier"){var xi=te.getIdentifierScope(L);xi.name===Zr&&(ni=xi.data)}return kr.bind(ni)}}},P.callExpressionHandler=function(L){var te=this,Ce=this.createCallFunctionGetter(L.callee),rt=L.arguments.map(function(Ct){return te.createClosure(Ct)});return function(){return Ce().apply(void 0,rt.map(function(Ct){return Ct()}))}},P.functionExpressionHandler=function(L){var te=this,Ce=this,rt=this.source,Ct=this.collectDeclVars,ft=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Sr=L.id?L.id.name:"",kr=L.params.length,ni=L.params.map(function(ua){return te.createParamNameGetter(ua)}),xi=this.createClosure(L.body),gi=this.collectDeclVars,dt=this.collectDeclFuncs;return this.collectDeclVars=Ct,this.collectDeclFuncs=ft,function(){var ua=Ce.getCurrentScope(),yt=function fu(){for(var Ha=arguments.length,fa=new Array(Ha),Sl=0;Sl<Ha;Sl++)fa[Sl]=arguments[Sl];Ce.callStack.push(""+Sr);var Ec=Ce.getCurrentScope(),bn=Vs(ua,"FunctionScope("+Sr+")");Ce.setCurrentScope(bn),Ce.addDeclarationsToScope(gi,dt,bn),Sr&&(bn.data[Sr]=fu),bn.data.arguments=arguments,ni.forEach(function(Rf,Lt){bn.data[Rf()]=fa[Lt]});var qc=Ce.getCurrentContext();Ce.setCurrentContext(this);var In=xi();if(Ce.setCurrentContext(qc),Ce.setCurrentScope(Ec),Ce.callStack.pop(),In instanceof Ks)return In.value};return Lo(yt,Sr),Object.defineProperty(yt,"length",{value:kr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(yt,"toString",{value:function(){return rt.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(yt,"valueOf",{value:function(){return rt.slice(L.start,L.end)},writable:!0,configurable:!0,enumerable:!1}),yt}},P.newExpressionHandler=function(L){var te=this,Ce=this.source,rt=this.createClosure(L.callee),Ct=L.arguments.map(function(ft){return te.createClosure(ft)});return function(){var ft=rt();if(!Ma(ft)||ft.__IS_EVAL_FUNC){var Sr=L.callee,kr=Ce.slice(Sr.start,Sr.end);throw te.createInternalThrowError(ya.IsNotConstructor,kr,L)}return ft.__IS_FUNCTION_FUNC?ft.apply(void 0,[new Xa(te)].concat(Ct.map(function(ni){return ni()}))):ls(ft,Ct.map(function(ni){return ni()}))}},P.memberExpressionHandler=function(L){var te=this.createClosure(L.object),Ce=this.createMemberKeyGetter(L);return function(){var rt=te(),Ct=Ce();return rt[Ct]}},P.thisExpressionHandler=function(L){var te=this;return function(){return te.getCurrentContext()}},P.sequenceExpressionHandler=function(L){var te=this,Ce=L.expressions.map(function(rt){return te.createClosure(rt)});return function(){for(var rt,Ct=Ce.length,ft=0;ft<Ct;ft++){var Sr=Ce[ft];rt=Sr()}return rt}},P.literalHandler=function(L){return function(){return L.regex?new RegExp(L.regex.pattern,L.regex.flags):L.value}},P.identifierHandler=function(L){var te=this;return function(){var Ce=te.getCurrentScope(),rt=te.getScopeDataFromName(L.name,Ce);return te.assertVariable(rt,L.name,L),rt[L.name]}},P.getIdentifierScope=function(L){var te=this.getCurrentScope(),Ce=this.getScopeFromName(L.name,te);return Ce},P.assignmentExpressionHandler=function(L){var te=this;L.left.type==="Identifier"&&L.right.type==="FunctionExpression"&&!L.right.id&&(L.right.id={type:"Identifier",name:L.left.name});var Ce=this.createObjectGetter(L.left),rt=this.createNameGetter(L.left),Ct=this.createClosure(L.right);return function(){var ft=Ce(),Sr=rt(),kr=Ct();switch(L.operator!=="="&&te.assertVariable(ft,Sr,L),L.operator){case"=":return ft[Sr]=kr;case"+=":return ft[Sr]+=kr;case"-=":return ft[Sr]-=kr;case"*=":return ft[Sr]*=kr;case"**=":return ft[Sr]=Math.pow(ft[Sr],kr);case"/=":return ft[Sr]/=kr;case"%=":return ft[Sr]%=kr;case"<<=":return ft[Sr]<<=kr;case">>=":return ft[Sr]>>=kr;case">>>=":return ft[Sr]>>>=kr;case"&=":return ft[Sr]&=kr;case"^=":return ft[Sr]^=kr;case"|=":return ft[Sr]|=kr;default:throw te.createInternalThrowError(ya.AssignmentExpressionSyntaxError,L.type,L)}}},P.functionDeclarationHandler=function(L){if(L.id){var te=this.functionExpressionHandler(L);Object.defineProperty(te,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(L.id.name,te)}return function(){return Rt}},P.getVariableName=function(L){if(L.type==="Identifier")return L.name;throw this.createInternalThrowError(ya.VariableTypeSyntaxError,L.type,L)},P.variableDeclarationHandler=function(L){for(var te=this,Ce,rt=[],Ct=0;Ct<L.declarations.length;Ct++){var ft=L.declarations[Ct];this.varDeclaration(this.getVariableName(ft.id)),ft.init&&rt.push({type:"AssignmentExpression",operator:"=",left:ft.id,right:ft.init})}return rt.length&&(Ce=this.createClosure({type:"BlockStatement",body:rt})),function(){if(Ce){var Sr=te.isVarDeclMode;te.isVarDeclMode=!0,Ce(),te.isVarDeclMode=Sr}return Rt}},P.assertVariable=function(L,te,Ce){if(L===this.globalScope.data&&!(te in L))throw this.createInternalThrowError(ya.VariableUndefinedReferenceError,te,Ce)},P.programHandler=function(L){var te=this,Ce=L.body.map(function(rt){return te.createClosure(rt)});return function(){for(var rt=Rt,Ct=0;Ct<Ce.length;Ct++){var ft=Ce[Ct],Sr=te.setValue(ft());if(Sr!==Rt&&(rt=Sr,rt instanceof Ks||rt instanceof Qo||rt instanceof Vo||rt===We||rt===se))break}return rt}},P.expressionStatementHandler=function(L){return this.createClosure(L.expression)},P.emptyStatementHandler=function(L){return function(){return Rt}},P.returnStatementHandler=function(L){var te=L.argument?this.createClosure(L.argument):gu;return function(){return new Ks(te())}},P.ifStatementHandler=function(L){var te=this.createClosure(L.test),Ce=this.createClosure(L.consequent),rt=L.alternate?this.createClosure(L.alternate):function(){return Rt};return function(){return te()?Ce():rt()}},P.conditionalExpressionHandler=function(L){return this.ifStatementHandler(L)},P.forStatementHandler=function(L){var te=this,Ce=gu,rt=L.test?this.createClosure(L.test):function(){return!0},Ct=gu,ft=this.createClosure(L.body);return L.type==="ForStatement"&&(Ce=L.init?this.createClosure(L.init):Ce,Ct=L.update?this.createClosure(L.update):gu),function(Sr){var kr,ni=Rt,xi=L.type==="DoWhileStatement";for(Sr&&Sr.type==="LabeledStatement"&&(kr=Sr.label.name),Ce();xi||rt();Ct()){xi=!1;var gi=te.setValue(ft());if(!(gi===Rt||gi===se)){if(gi===We)break;if(ni=gi,ni instanceof Vo&&ni.value===kr){ni=Rt;continue}if(ni instanceof Ks||ni instanceof Qo||ni instanceof Vo)break}}return ni}},P.whileStatementHandler=function(L){return this.forStatementHandler(L)},P.doWhileStatementHandler=function(L){return this.forStatementHandler(L)},P.forInStatementHandler=function(L){var te=this,Ce=L.left,rt=this.createClosure(L.right),Ct=this.createClosure(L.body);return L.left.type==="VariableDeclaration"&&(this.createClosure(L.left)(),Ce=L.left.declarations[0].id),function(ft){var Sr,kr=Rt,ni;ft&&ft.type==="LabeledStatement"&&(Sr=ft.label.name);var xi=rt();for(ni in xi){te.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Ce,right:{type:"Literal",value:ni}})();var gi=te.setValue(Ct());if(!(gi===Rt||gi===se)){if(gi===We)break;if(kr=gi,kr instanceof Vo&&kr.value===Sr){kr=Rt;continue}if(kr instanceof Ks||kr instanceof Qo||kr instanceof Vo)break}}return kr}},P.withStatementHandler=function(L){var te=this,Ce=this.createClosure(L.object),rt=this.createClosure(L.body);return function(){var Ct=Ce(),ft=te.getCurrentScope(),Sr=new qs(Ct,ft,Zr);te.setCurrentScope(Sr);var kr=te.setValue(rt());return te.setCurrentScope(ft),kr}},P.throwStatementHandler=function(L){var te=this,Ce=this.createClosure(L.argument);return function(){throw te.setValue(void 0),Ce()}},P.tryStatementHandler=function(L){var te=this,Ce=this.createClosure(L.block),rt=L.handler?this.catchClauseHandler(L.handler):null,Ct=L.finalizer?this.createClosure(L.finalizer):null;return function(){var ft=te.getCurrentScope(),Sr=te.getCurrentContext(),kr=ft.labelStack.concat([]),ni=te.callStack.concat([]),xi=Rt,gi,dt,ua=function(){te.setCurrentScope(ft),te.setCurrentContext(Sr),ft.labelStack=kr,te.callStack=ni};try{xi=te.setValue(Ce()),xi instanceof Ks&&(gi=xi)}catch(yt){if(ua(),te.isInterruptThrow(yt))throw yt;if(rt)try{xi=te.setValue(rt(yt)),xi instanceof Ks&&(gi=xi)}catch(fu){if(ua(),te.isInterruptThrow(fu))throw fu;dt=fu}}if(Ct)try{xi=Ct(),xi instanceof Ks&&(gi=xi)}catch(yt){if(ua(),te.isInterruptThrow(yt))throw yt;dt=yt}if(dt)throw dt;return gi||xi}},P.catchClauseHandler=function(L){var te=this,Ce=this.createParamNameGetter(L.param),rt=this.createClosure(L.body);return function(Ct){var ft,Sr=te.getCurrentScope(),kr=Sr.data,ni=Ce(),xi=go.call(kr,ni),gi=kr[ni];return kr[ni]=Ct,ft=rt(),xi?kr[ni]=gi:delete kr[ni],ft}},P.continueStatementHandler=function(L){return function(){return L.label?new Vo(L.label.name):se}},P.breakStatementHandler=function(L){return function(){return L.label?new Qo(L.label.name):We}},P.switchStatementHandler=function(L){var te=this,Ce=this.createClosure(L.discriminant),rt=L.cases.map(function(Ct){return te.switchCaseHandler(Ct)});return function(){for(var Ct=Ce(),ft=!1,Sr,kr,ni,xi=0;xi<rt.length;xi++){var gi=rt[xi](),dt=gi.testClosure();if(dt===Be){ni=gi;continue}if(ft||dt===Ct){if(ft=!0,kr=te.setValue(gi.bodyClosure()),kr===Rt)continue;if(kr===We||(Sr=kr,Sr instanceof Ks||Sr instanceof Qo||Sr instanceof Vo||Sr===se))break}}if(!ft&&ni){kr=te.setValue(ni.bodyClosure());var ua=kr===Rt||kr===We||kr===se;ua||(Sr=kr)}return Sr}},P.switchCaseHandler=function(L){var te=L.test?this.createClosure(L.test):function(){return Be},Ce=this.createClosure({type:"BlockStatement",body:L.consequent});return function(){return{testClosure:te,bodyClosure:Ce}}},P.labeledStatementHandler=function(L){var te=this,Ce=L.label.name,rt=this.createClosure(L.body);return function(){var Ct,ft=te.getCurrentScope();return ft.labelStack.push(Ce),Ct=rt(L),Ct instanceof Qo&&Ct.value===Ce&&(Ct=Rt),ft.labelStack.pop(),Ct}},P.debuggerStatementHandler=function(L){return function(){debugger;return Rt}},P.createParamNameGetter=function(L){if(L.type==="Identifier")return function(){return L.name};throw this.createInternalThrowError(ya.ParamTypeSyntaxError,L.type,L)},P.createObjectKeyGetter=function(L){var te;return L.type==="Identifier"?te=function(){return L.name}:te=this.createClosure(L),function(){return te()}},P.createMemberKeyGetter=function(L){return L.computed?this.createClosure(L.property):this.createObjectKeyGetter(L.property)},P.createObjectGetter=function(L){var te=this;switch(L.type){case"Identifier":return function(){return te.getScopeDataFromName(L.name,te.getCurrentScope())};case"MemberExpression":return this.createClosure(L.object);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,L.type,L)}},P.createNameGetter=function(L){switch(L.type){case"Identifier":return function(){return L.name};case"MemberExpression":return this.createMemberKeyGetter(L);default:throw this.createInternalThrowError(ya.AssignmentTypeSyntaxError,L.type,L)}},P.varDeclaration=function(L){var te=this.collectDeclVars;te[L]=void 0},P.funcDeclaration=function(L,te){var Ce=this.collectDeclFuncs;Ce[L]=te},P.addDeclarationsToScope=function(L,te,Ce){var rt=Ce.data;for(var Ct in te){var ft=te[Ct];rt[Ct]=ft&&ft()}for(var Sr in L)Sr in rt||(rt[Sr]=void 0)},P.getScopeValue=function(L,te){var Ce=this.getScopeFromName(L,te);return Ce.data[L]},P.getScopeDataFromName=function(L,te){return this.getScopeFromName(L,te).data},P.getScopeFromName=function(L,te){var Ce=te;do if(L in Ce.data)return Ce;while(Ce=Ce.parent);return this.globalScope},P.setValue=function(L){var te=this.callStack.length;return this.isVarDeclMode||te||L===Rt||L===We||L===se||L instanceof Qo||L instanceof Vo||(this.value=L instanceof Ks?L.value:L),L},P.getValue=function(){return this.value},_}();Ga.version=$s,Ga.eval=Do,Ga.Function=$c,Ga.ecmaVersion=5,Ga.globalContextInFunction=void 0,Ga.global=Object.create(null);function Ya(_){return _===void 0&&(_=Object.create(null)),_}function El(_,P,z){P===void 0&&(P=[]),z===void 0&&(z={});var L=z.parsingContext,te=z.timeout===void 0?0:z.timeout,Ce=`
    (function anonymous(`+P.join(",")+`){
         `+_+`
    });
    `,rt=new Ga(L,{ecmaVersion:z.ecmaVersion,timeout:te,rootContext:z.rootContext,globalContextInFunction:z.globalContextInFunction});return rt.evaluate(Ce)}function yu(_,P,z){var L=new Ga(P,z);return L.evaluate(_)}var kh=yu,Kc=function(){function _(z){this._code=z}var P=_.prototype;return P.runInContext=function(L){return yu(this._code,L)},P.runInNewContext=function(L){return yu(this._code,L)},_}(),ec=function(_,P,z){return yu(_,P,z)},_u=function(){for(var _=arguments.length,P=new Array(_),z=0;z<_;z++)P[z]=arguments[z];var L=P.pop();return El(L||"",P)},bc=K.default=ec},u6S6:function(He,K,O){var W=O("6acW"),re=O("sgoq"),ne=re(function(j,m,U){return m=m.toLowerCase(),j+(U?W(m):m)});He.exports=ne},uhBA:function(He,K,O){"use strict";var W=Object.prototype.hasOwnProperty,re="~";function ne(){}Object.create&&(ne.prototype=Object.create(null),new ne().__proto__||(re=!1));function j(Te,xe,Me){this.fn=Te,this.context=xe,this.once=Me||!1}function m(Te,xe,Me,Ee,Mt){if(typeof Me!="function")throw new TypeError("The listener must be a function");var at=new j(Me,Ee||Te,Mt),ht=re?re+xe:xe;return Te._events[ht]?Te._events[ht].fn?Te._events[ht]=[Te._events[ht],at]:Te._events[ht].push(at):(Te._events[ht]=at,Te._eventsCount++),Te}function U(Te,xe){--Te._eventsCount==0?Te._events=new ne:delete Te._events[xe]}function G(){this._events=new ne,this._eventsCount=0}G.prototype.eventNames=function(){var xe=[],Me,Ee;if(this._eventsCount===0)return xe;for(Ee in Me=this._events)W.call(Me,Ee)&&xe.push(re?Ee.slice(1):Ee);return Object.getOwnPropertySymbols?xe.concat(Object.getOwnPropertySymbols(Me)):xe},G.prototype.listeners=function(xe){var Me=re?re+xe:xe,Ee=this._events[Me];if(!Ee)return[];if(Ee.fn)return[Ee.fn];for(var Mt=0,at=Ee.length,ht=new Array(at);Mt<at;Mt++)ht[Mt]=Ee[Mt].fn;return ht},G.prototype.listenerCount=function(xe){var Me=re?re+xe:xe,Ee=this._events[Me];return Ee?Ee.fn?1:Ee.length:0},G.prototype.emit=function(xe,Me,Ee,Mt,at,ht){var vt=re?re+xe:xe;if(!this._events[vt])return!1;var _t=this._events[vt],Ve=arguments.length,xt,st;if(_t.fn){switch(_t.once&&this.removeListener(xe,_t.fn,void 0,!0),Ve){case 1:return _t.fn.call(_t.context),!0;case 2:return _t.fn.call(_t.context,Me),!0;case 3:return _t.fn.call(_t.context,Me,Ee),!0;case 4:return _t.fn.call(_t.context,Me,Ee,Mt),!0;case 5:return _t.fn.call(_t.context,Me,Ee,Mt,at),!0;case 6:return _t.fn.call(_t.context,Me,Ee,Mt,at,ht),!0}for(st=1,xt=new Array(Ve-1);st<Ve;st++)xt[st-1]=arguments[st];_t.fn.apply(_t.context,xt)}else{var it=_t.length,N;for(st=0;st<it;st++)switch(_t[st].once&&this.removeListener(xe,_t[st].fn,void 0,!0),Ve){case 1:_t[st].fn.call(_t[st].context);break;case 2:_t[st].fn.call(_t[st].context,Me);break;case 3:_t[st].fn.call(_t[st].context,Me,Ee);break;case 4:_t[st].fn.call(_t[st].context,Me,Ee,Mt);break;default:if(!xt)for(N=1,xt=new Array(Ve-1);N<Ve;N++)xt[N-1]=arguments[N];_t[st].fn.apply(_t[st].context,xt)}}return!0},G.prototype.on=function(xe,Me,Ee){return m(this,xe,Me,Ee,!1)},G.prototype.once=function(xe,Me,Ee){return m(this,xe,Me,Ee,!0)},G.prototype.removeListener=function(xe,Me,Ee,Mt){var at=re?re+xe:xe;if(!this._events[at])return this;if(!Me)return U(this,at),this;var ht=this._events[at];if(ht.fn)ht.fn===Me&&(!Mt||ht.once)&&(!Ee||ht.context===Ee)&&U(this,at);else{for(var vt=0,_t=[],Ve=ht.length;vt<Ve;vt++)(ht[vt].fn!==Me||Mt&&!ht[vt].once||Ee&&ht[vt].context!==Ee)&&_t.push(ht[vt]);_t.length?this._events[at]=_t.length===1?_t[0]:_t:U(this,at)}return this},G.prototype.removeAllListeners=function(xe){var Me;return xe?(Me=re?re+xe:xe,this._events[Me]&&U(this,Me)):(this._events=new ne,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=re,G.EventEmitter=G,He.exports=G},ujMp:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.circularDependencyToException=K.listMetadataForTarget=K.listRegisteredBindingsForServiceIdentifier=K.getServiceIdentifierAsString=K.getFunctionName=void 0;var W=O("MON2");function re(xe){if(typeof xe=="function"){var Me=xe;return Me.name}else{if(typeof xe=="symbol")return xe.toString();var Me=xe;return Me}}K.getServiceIdentifierAsString=re;function ne(xe,Me,Ee){var Mt="",at=Ee(xe,Me);return at.length!==0&&(Mt=`
Registered bindings:`,at.forEach(function(ht){var vt="Object";ht.implementationType!==null&&(vt=Te(ht.implementationType)),Mt=Mt+`
 `+vt,ht.constraint.metaData&&(Mt=Mt+" - "+ht.constraint.metaData)})),Mt}K.listRegisteredBindingsForServiceIdentifier=ne;function j(xe,Me){return xe.parentRequest===null?!1:xe.parentRequest.serviceIdentifier===Me?!0:j(xe.parentRequest,Me)}function m(xe){function Me(Mt,at){at===void 0&&(at=[]);var ht=re(Mt.serviceIdentifier);return at.push(ht),Mt.parentRequest!==null?Me(Mt.parentRequest,at):at}var Ee=Me(xe);return Ee.reverse().join(" --> ")}function U(xe){xe.childRequests.forEach(function(Me){if(j(Me,Me.serviceIdentifier)){var Ee=m(Me);throw new Error(W.CIRCULAR_DEPENDENCY+" "+Ee)}else U(Me)})}K.circularDependencyToException=U;function G(xe,Me){if(Me.isTagged()||Me.isNamed()){var Ee="",Mt=Me.getNamedTag(),at=Me.getCustomTags();return Mt!==null&&(Ee+=Mt.toString()+`
`),at!==null&&at.forEach(function(ht){Ee+=ht.toString()+`
`})," "+xe+`
 `+xe+" - "+Ee}else return" "+xe}K.listMetadataForTarget=G;function Te(xe){if(xe.name)return xe.name;var Me=xe.toString(),Ee=Me.match(/^function\s*([^\s(]+)/);return Ee?Ee[1]:"Anonymous function: "+Me}K.getFunctionName=Te},"vN+2":function(He,K){function O(){}He.exports=O},"w/wX":function(He,K,O){var W=O("QqLw"),re=O("ExA7"),ne="[object Set]";function j(m){return re(m)&&W(m)==ne}He.exports=j},wnjb:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.MetadataReader=void 0;var W=O("xfSm"),re=function(){function ne(){}return ne.prototype.getConstructorMetadata=function(j){var m=Reflect.getMetadata(W.PARAM_TYPES,j),U=Reflect.getMetadata(W.TAGGED,j);return{compilerGeneratedMetadata:m,userGeneratedMetadata:U||{}}},ne.prototype.getPropertiesMetadata=function(j){var m=Reflect.getMetadata(W.TAGGED_PROP,j)||[];return m},ne}();K.MetadataReader=re},wrZu:function(He,K,O){var W=O("+K+b"),re=O("XYm9"),ne=O("b2z7"),j=O("otv/"),m=O("yP5f"),U="[object Boolean]",G="[object Date]",Te="[object Map]",xe="[object Number]",Me="[object RegExp]",Ee="[object Set]",Mt="[object String]",at="[object Symbol]",ht="[object ArrayBuffer]",vt="[object DataView]",_t="[object Float32Array]",Ve="[object Float64Array]",xt="[object Int8Array]",st="[object Int16Array]",it="[object Int32Array]",N="[object Uint8Array]",Re="[object Uint8ClampedArray]",Nr="[object Uint16Array]",Pr="[object Uint32Array]";function Wt(Oe,Bt,Zt){var ir=Oe.constructor;switch(Bt){case ht:return W(Oe);case U:case G:return new ir(+Oe);case vt:return re(Oe,Zt);case _t:case Ve:case xt:case st:case it:case N:case Re:case Nr:case Pr:return m(Oe,Zt);case Te:return new ir;case xe:case Mt:return new ir(Oe);case Me:return ne(Oe);case Ee:return new ir;case at:return j(Oe)}}He.exports=Wt},xfSm:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.NON_CUSTOM_TAG_KEYS=K.POST_CONSTRUCT=K.DESIGN_PARAM_TYPES=K.PARAM_TYPES=K.TAGGED_PROP=K.TAGGED=K.MULTI_INJECT_TAG=K.INJECT_TAG=K.OPTIONAL_TAG=K.UNMANAGED_TAG=K.NAME_TAG=K.NAMED_TAG=void 0,K.NAMED_TAG="named",K.NAME_TAG="name",K.UNMANAGED_TAG="unmanaged",K.OPTIONAL_TAG="optional",K.INJECT_TAG="inject",K.MULTI_INJECT_TAG="multi_inject",K.TAGGED="inversify:tagged",K.TAGGED_PROP="inversify:tagged_props",K.PARAM_TYPES="inversify:paramtypes",K.DESIGN_PARAM_TYPES="design:paramtypes",K.POST_CONSTRUCT="post_construct";function W(){return[K.INJECT_TAG,K.MULTI_INJECT_TAG,K.NAME_TAG,K.UNMANAGED_TAG,K.NAMED_TAG,K.OPTIONAL_TAG]}K.NON_CUSTOM_TAG_KEYS=W()},xfeJ:function(He,K){function O(W){return Function.toString.call(W).indexOf("[native code]")!==-1}He.exports=O,He.exports.__esModule=!0,He.exports.default=He.exports},xiII:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Request=void 0;var W=O("d9O0"),re=function(){function ne(j,m,U,G,Te){this.id=W.id(),this.serviceIdentifier=j,this.parentContext=m,this.parentRequest=U,this.target=Te,this.childRequests=[],this.bindings=Array.isArray(G)?G:[G],this.requestScope=U===null?new Map:null}return ne.prototype.addChildRequest=function(j,m,U){var G=new ne(j,this.parentContext,this,m,U);return this.childRequests.push(G),G},ne}();K.Request=re},xp6e:function(He,K,O){"use strict";(function(W){O.d(K,"a",function(){return ut}),O.d(K,"b",function(){return Or}),O.d(K,"c",function(){return fe}),O.d(K,"d",function(){return sr});/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function re(Nt,Tt,It,$t){function gr(qt){return qt instanceof It?qt:new It(function(dr){dr(qt)})}return new(It||(It=Promise))(function(qt,dr){function Ur(Rr){try{ur($t.next(Rr))}catch(Yn){dr(Yn)}}function Ir(Rr){try{ur($t.throw(Rr))}catch(Yn){dr(Yn)}}function ur(Rr){Rr.done?qt(Rr.value):gr(Rr.value).then(Ur,Ir)}ur(($t=$t.apply(Nt,Tt||[])).next())})}function ne(Nt,Tt){var It={label:0,sent:function(){if(qt[0]&1)throw qt[1];return qt[1]},trys:[],ops:[]},$t,gr,qt,dr;return dr={next:Ur(0),throw:Ur(1),return:Ur(2)},typeof Symbol=="function"&&(dr[Symbol.iterator]=function(){return this}),dr;function Ur(ur){return function(Rr){return Ir([ur,Rr])}}function Ir(ur){if($t)throw new TypeError("Generator is already executing.");for(;It;)try{if($t=1,gr&&(qt=ur[0]&2?gr.return:ur[0]?gr.throw||((qt=gr.return)&&qt.call(gr),0):gr.next)&&!(qt=qt.call(gr,ur[1])).done)return qt;switch(gr=0,qt&&(ur=[ur[0]&2,qt.value]),ur[0]){case 0:case 1:qt=ur;break;case 4:return It.label++,{value:ur[1],done:!1};case 5:It.label++,gr=ur[1],ur=[0];continue;case 7:ur=It.ops.pop(),It.trys.pop();continue;default:if(qt=It.trys,!(qt=qt.length>0&&qt[qt.length-1])&&(ur[0]===6||ur[0]===2)){It=0;continue}if(ur[0]===3&&(!qt||ur[1]>qt[0]&&ur[1]<qt[3])){It.label=ur[1];break}if(ur[0]===6&&It.label<qt[1]){It.label=qt[1],qt=ur;break}if(qt&&It.label<qt[2]){It.label=qt[2],It.ops.push(ur);break}qt[2]&&It.ops.pop(),It.trys.pop();continue}ur=Tt.call(Nt,It)}catch(Rr){ur=[6,Rr],gr=0}finally{$t=qt=0}if(ur[0]&5)throw ur[1];return{value:ur[0]?ur[1]:void 0,done:!0}}}function j(Nt,Tt){var It=typeof Symbol=="function"&&Nt[Symbol.iterator];if(!It)return Nt;var $t=It.call(Nt),gr,qt=[],dr;try{for(;(Tt===void 0||Tt-- >0)&&!(gr=$t.next()).done;)qt.push(gr.value)}catch(Ur){dr={error:Ur}}finally{try{gr&&!gr.done&&(It=$t.return)&&It.call($t)}finally{if(dr)throw dr.error}}return qt}function m(){for(var Nt=[],Tt=0;Tt<arguments.length;Tt++)Nt=Nt.concat(j(arguments[Tt]));return Nt}function U(Nt){return Nt&&Nt.__esModule&&Object.prototype.hasOwnProperty.call(Nt,"default")?Nt.default:Nt}function G(Nt,Tt){return Tt={exports:{}},Nt(Tt,Tt.exports),Tt.exports}var Te=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=It;function It($t){return $t&&typeof $t.length=="number"&&$t.length>=0&&$t.length%1==0}Nt.exports=Tt.default});U(Te);var xe=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=function(It){return function(){for(var $t=[],gr=arguments.length;gr--;)$t[gr]=arguments[gr];var qt=$t.pop();return It.call(this,$t,qt)}},Nt.exports=Tt.default});U(xe);var Me=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.fallback=gr,Tt.wrap=qt;var It=Tt.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,$t=Tt.hasNextTick=typeof W=="object"&&typeof W.nextTick=="function";function gr(Ur){setTimeout(Ur,0)}function qt(Ur){return function(Ir){for(var ur=[],Rr=arguments.length-1;Rr-- >0;)ur[Rr]=arguments[Rr+1];return Ur(function(){return Ir.apply(void 0,ur)})}}var dr;It?dr=setImmediate:$t?dr=W.nextTick:dr=gr,Tt.default=qt(dr)});U(Me);var Ee=Me.fallback,Mt=Me.wrap,at=Me.hasSetImmediate,ht=Me.hasNextTick,vt=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=qt;var It=gr(xe),$t=gr(Me);function gr(Ir){return Ir&&Ir.__esModule?Ir:{default:Ir}}function qt(Ir){return(0,_t.isAsync)(Ir)?function(){for(var ur=[],Rr=arguments.length;Rr--;)ur[Rr]=arguments[Rr];var Yn=ur.pop(),un=Ir.apply(this,ur);return dr(un,Yn)}:(0,It.default)(function(ur,Rr){var Yn;try{Yn=Ir.apply(this,ur)}catch(un){return Rr(un)}if(Yn&&typeof Yn.then=="function")return dr(Yn,Rr);Rr(null,Yn)})}function dr(Ir,ur){return Ir.then(function(Rr){Ur(ur,null,Rr)},function(Rr){Ur(ur,Rr&&Rr.message?Rr:new Error(Rr))})}function Ur(Ir,ur,Rr){try{Ir(ur,Rr)}catch(Yn){(0,$t.default)(function(un){throw un},Yn)}}Nt.exports=Tt.default});U(vt);var _t=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.isAsyncIterable=Tt.isAsyncGenerator=Tt.isAsync=void 0;var It=$t(vt);function $t(Ir){return Ir&&Ir.__esModule?Ir:{default:Ir}}function gr(Ir){return Ir[Symbol.toStringTag]==="AsyncFunction"}function qt(Ir){return Ir[Symbol.toStringTag]==="AsyncGenerator"}function dr(Ir){return typeof Ir[Symbol.asyncIterator]=="function"}function Ur(Ir){if(typeof Ir!="function")throw new Error("expected a function");return gr(Ir)?(0,It.default)(Ir):Ir}Tt.default=Ur,Tt.isAsync=gr,Tt.isAsyncGenerator=qt,Tt.isAsyncIterable=dr});U(_t);var Ve=_t.isAsyncIterable,xt=_t.isAsyncGenerator,st=_t.isAsync,it=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=It;function It($t,gr){if(gr===void 0&&(gr=$t.length),!gr)throw new Error("arity is undefined");function qt(){for(var dr=this,Ur=[],Ir=arguments.length;Ir--;)Ur[Ir]=arguments[Ir];return typeof Ur[gr-1]=="function"?$t.apply(this,Ur):new Promise(function(ur,Rr){Ur[gr-1]=function(Yn){for(var un=[],_n=arguments.length-1;_n-- >0;)un[_n]=arguments[_n+1];if(Yn)return Rr(Yn);ur(un.length>1?un:un[0])},$t.apply(dr,Ur)})}return Object.defineProperty(qt,"name",{configurable:!0,value:"awaitable("+$t.name+")"}),qt}Nt.exports=Tt.default});U(it);var N=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=qt(Te),$t=qt(_t),gr=qt(it);function qt(dr){return dr&&dr.__esModule?dr:{default:dr}}Tt.default=(0,gr.default)(function(dr,Ur,Ir){var ur=(0,It.default)(Ur)?[]:{};dr(Ur,function(Rr,Yn,un){(0,$t.default)(Rr)(function(_n){for(var qn,oi=[],Gi=arguments.length-1;Gi-- >0;)oi[Gi]=arguments[Gi+1];oi.length<2&&(qn=oi,oi=qn[0]),ur[Yn]=oi,un(_n)})},function(Rr){return Ir(Rr,ur)})},3),Nt.exports=Tt.default});U(N);var Re=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=It;function It($t){function gr(){for(var qt=[],dr=arguments.length;dr--;)qt[dr]=arguments[dr];if($t!==null){var Ur=$t;$t=null,Ur.apply(this,qt)}}return Object.assign(gr,$t),gr}Nt.exports=Tt.default});U(Re);var Nr=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=function(It){return It[Symbol.iterator]&&It[Symbol.iterator]()},Nt.exports=Tt.default});U(Nr);var Pr=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=Ir;var It=gr(Te),$t=gr(Nr);function gr(ur){return ur&&ur.__esModule?ur:{default:ur}}function qt(ur){var Rr=-1,Yn=ur.length;return function(){return++Rr<Yn?{value:ur[Rr],key:Rr}:null}}function dr(ur){var Rr=-1;return function(){var un=ur.next();return un.done?null:(Rr++,{value:un.value,key:Rr})}}function Ur(ur){var Rr=ur?Object.keys(ur):[],Yn=-1,un=Rr.length;return function(){var qn=Rr[++Yn];return Yn<un?{value:ur[qn],key:qn}:null}}function Ir(ur){if((0,It.default)(ur))return qt(ur);var Rr=(0,$t.default)(ur);return Rr?dr(Rr):Ur(ur)}Nt.exports=Tt.default});U(Pr);var Wt=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=It;function It($t){return function(){for(var gr=[],qt=arguments.length;qt--;)gr[qt]=arguments[qt];if($t===null)throw new Error("Callback was already called.");var dr=$t;$t=null,dr.apply(this,gr)}}Nt.exports=Tt.default});U(Wt);var Oe=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It={};Tt.default=It,Nt.exports=Tt.default});U(Oe);var Bt=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=gr;var It=$t(Oe);function $t(qt){return qt&&qt.__esModule?qt:{default:qt}}function gr(qt,dr,Ur,Ir){var ur=!1,Rr=!1,Yn=!1,un=0,_n=0;function qn(){un>=dr||Yn||ur||(Yn=!0,qt.next().then(function(he){var Fn=he.value,Li=he.done;if(!(Rr||ur)){if(Yn=!1,Li){ur=!0,un<=0&&Ir(null);return}un++,Ur(Fn,_n,oi),_n++,qn()}}).catch(Gi))}function oi(he,Fn){if(un-=1,!Rr){if(he)return Gi(he);if(he===!1){ur=!0,Rr=!0;return}if(Fn===It.default||ur&&un<=0)return ur=!0,Ir(null);qn()}}function Gi(he){Rr||(Yn=!1,ur=!0,Ir(he))}qn()}Nt.exports=Tt.default});U(Bt);var Zt=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=Ur(Re),$t=Ur(Pr),gr=Ur(Wt),qt=Ur(Bt),dr=Ur(Oe);function Ur(Ir){return Ir&&Ir.__esModule?Ir:{default:Ir}}Tt.default=function(Ir){return function(ur,Rr,Yn){if(Yn=(0,It.default)(Yn),Ir<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!ur)return Yn(null);if((0,_t.isAsyncGenerator)(ur))return(0,qt.default)(ur,Ir,Rr,Yn);if((0,_t.isAsyncIterable)(ur))return(0,qt.default)(ur[Symbol.asyncIterator](),Ir,Rr,Yn);var un=(0,$t.default)(ur),_n=!1,qn=!1,oi=0,Gi=!1;function he(Li,Ko){if(!qn)if(oi-=1,Li)_n=!0,Yn(Li);else if(Li===!1)_n=!0,qn=!0;else{if(Ko===dr.default||_n&&oi<=0)return _n=!0,Yn(null);Gi||Fn()}}function Fn(){for(Gi=!0;oi<Ir&&!_n;){var Li=un();if(Li===null){_n=!0,oi<=0&&Yn(null);return}oi+=1,Rr(Li.value,Li.key,(0,gr.default)(he))}Gi=!1}Fn()}},Nt.exports=Tt.default});U(Zt);var ir=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=qt(Zt),$t=qt(_t),gr=qt(it);function qt(Ur){return Ur&&Ur.__esModule?Ur:{default:Ur}}function dr(Ur,Ir,ur,Rr){return(0,It.default)(Ir)(Ur,(0,$t.default)(ur),Rr)}Tt.default=(0,gr.default)(dr,4),Nt.exports=Tt.default});U(ir);var Fr=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=gr(ir),$t=gr(it);function gr(dr){return dr&&dr.__esModule?dr:{default:dr}}function qt(dr,Ur,Ir){return(0,It.default)(dr,1,Ur,Ir)}Tt.default=(0,$t.default)(qt,3),Nt.exports=Tt.default});U(Fr);var qr=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=qt;var It=gr(N),$t=gr(Fr);function gr(dr){return dr&&dr.__esModule?dr:{default:dr}}function qt(dr,Ur){return(0,It.default)($t.default,dr,Ur)}Nt.exports=Tt.default}),br=U(qr),fe=function(){function Nt(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];this.args=[],this.tasks=[]}return Nt.prototype.call=function(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];return this.args=It,br(this.tasks)},Nt.prototype.tap=function(Tt,It){var $t=this;this.tasks.push(function(gr){It.apply(void 0,m($t.args)),gr(null,Tt)})},Nt}(),Pe=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=ur(Te),$t=ur(Oe),gr=ur(ir),qt=ur(Re),dr=ur(Wt),Ur=ur(_t),Ir=ur(it);function ur(_n){return _n&&_n.__esModule?_n:{default:_n}}function Rr(_n,qn,oi){oi=(0,qt.default)(oi);var Gi=0,he=0,Fn=_n.length,Li=!1;Fn===0&&oi(null);function Ko(us,Ut){us===!1&&(Li=!0),Li!==!0&&(us?oi(us):(++he===Fn||Ut===$t.default)&&oi(null))}for(;Gi<Fn;Gi++)qn(_n[Gi],Gi,(0,dr.default)(Ko))}function Yn(_n,qn,oi){return(0,gr.default)(_n,Infinity,qn,oi)}function un(_n,qn,oi){var Gi=(0,It.default)(_n)?Rr:Yn;return Gi(_n,(0,Ur.default)(qn),oi)}Tt.default=(0,Ir.default)(un,3),Nt.exports=Tt.default});U(Pe);var Se=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.default=qt;var It=gr(Pe),$t=gr(N);function gr(dr){return dr&&dr.__esModule?dr:{default:dr}}function qt(dr,Ur){return(0,$t.default)(It.default,dr,Ur)}Nt.exports=Tt.default}),lt=U(Se),ut=function(){function Nt(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];this.tasks=[]}return Nt.prototype.promise=function(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];return lt(this.tasks)},Nt.prototype.tapPromise=function(Tt,It){var $t=this;this.tasks.push(function(gr){return re($t,void 0,void 0,function(){return ne(this,function(qt){switch(qt.label){case 0:return[4,It()];case 1:return qt.sent(),gr(null,Tt),[2]}})})})},Nt}(),Ot=G(function(Nt,Tt){Object.defineProperty(Tt,"__esModule",{value:!0});var It=dr(Re),$t=dr(Wt),gr=dr(_t),qt=dr(it);function dr(Ir){return Ir&&Ir.__esModule?Ir:{default:Ir}}function Ur(Ir,ur){if(ur=(0,It.default)(ur),!Array.isArray(Ir))return ur(new Error("First argument to waterfall must be an array of functions"));if(!Ir.length)return ur();var Rr=0;function Yn(_n){var qn=(0,gr.default)(Ir[Rr++]);qn.apply(void 0,_n.concat([(0,$t.default)(un)]))}function un(_n){for(var qn=[],oi=arguments.length-1;oi-- >0;)qn[oi]=arguments[oi+1];if(_n!==!1){if(_n||Rr===Ir.length)return ur.apply(void 0,[_n].concat(qn));Yn(qn)}}Yn([])}Tt.default=(0,qt.default)(Ur),Nt.exports=Tt.default}),wt=U(Ot),sr=function(){function Nt(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];this.tasks=[]}return Nt.prototype.call=function(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];return wt(this.tasks)},Nt.prototype.tap=function(Tt,It){this.tasks.length===0?this.tasks.push(function($t){var gr=It();$t(gr?null:!1,gr)}):this.tasks.push(function($t,gr){var qt=It();gr(qt?null:!1,Tt)})},Nt}(),Or=function(){function Nt(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];this.tasks=[]}return Nt.prototype.call=function(){for(var Tt=arguments,It=[],$t=0;$t<arguments.length;$t++)It[$t]=Tt[$t];return br(this.tasks)},Nt.prototype.tap=function(Tt,It){this.tasks.push(function($t){var gr=It();$t(gr,Tt)})},Nt}()}).call(this,O("Q2Ig"))},yG8O:function(He,K){function O(W,re,ne,j){!ne||Object.defineProperty(W,re,{enumerable:ne.enumerable,configurable:ne.configurable,writable:ne.writable,value:ne.initializer?ne.initializer.call(j):void 0})}He.exports=O,He.exports.__esModule=!0,He.exports.default=He.exports},yHx3:function(He,K){var O=Object.prototype,W=O.hasOwnProperty;function re(ne){var j=ne.length,m=new ne.constructor(j);return j&&typeof ne[0]=="string"&&W.call(ne,"index")&&(m.index=ne.index,m.input=ne.input),m}He.exports=re},yMAV:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.Plan=void 0;var W=function(){function re(ne,j){this.parentContext=ne,this.rootRequest=j}return re}();K.Plan=W},yXPU:function(He,K){function O(re,ne,j,m,U,G,Te){try{var xe=re[G](Te),Me=xe.value}catch(Ee){j(Ee);return}xe.done?ne(Me):Promise.resolve(Me).then(m,U)}function W(re){return function(){var ne=this,j=arguments;return new Promise(function(m,U){var G=re.apply(ne,j);function Te(Me){O(G,m,U,Te,xe,"next",Me)}function xe(Me){O(G,m,U,Te,xe,"throw",Me)}Te(void 0)})}}He.exports=W,He.exports.__esModule=!0,He.exports.default=He.exports},ycre:function(He,K,O){var W=O("711d"),re=W("length");He.exports=re},z4Hk:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.BindingWhenSyntax=void 0;var W=O("406g"),re=O("RR/i"),ne=function(){function j(m){this._binding=m}return j.prototype.when=function(m){return this._binding.constraint=m,new W.BindingOnSyntax(this._binding)},j.prototype.whenTargetNamed=function(m){return this._binding.constraint=re.namedConstraint(m),new W.BindingOnSyntax(this._binding)},j.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(m){var U=m.target!==null&&!m.target.isNamed()&&!m.target.isTagged();return U},new W.BindingOnSyntax(this._binding)},j.prototype.whenTargetTagged=function(m,U){return this._binding.constraint=re.taggedConstraint(m)(U),new W.BindingOnSyntax(this._binding)},j.prototype.whenInjectedInto=function(m){return this._binding.constraint=function(U){return re.typeConstraint(m)(U.parentRequest)},new W.BindingOnSyntax(this._binding)},j.prototype.whenParentNamed=function(m){return this._binding.constraint=function(U){return re.namedConstraint(m)(U.parentRequest)},new W.BindingOnSyntax(this._binding)},j.prototype.whenParentTagged=function(m,U){return this._binding.constraint=function(G){return re.taggedConstraint(m)(U)(G.parentRequest)},new W.BindingOnSyntax(this._binding)},j.prototype.whenAnyAncestorIs=function(m){return this._binding.constraint=function(U){return re.traverseAncerstors(U,re.typeConstraint(m))},new W.BindingOnSyntax(this._binding)},j.prototype.whenNoAncestorIs=function(m){return this._binding.constraint=function(U){return!re.traverseAncerstors(U,re.typeConstraint(m))},new W.BindingOnSyntax(this._binding)},j.prototype.whenAnyAncestorNamed=function(m){return this._binding.constraint=function(U){return re.traverseAncerstors(U,re.namedConstraint(m))},new W.BindingOnSyntax(this._binding)},j.prototype.whenNoAncestorNamed=function(m){return this._binding.constraint=function(U){return!re.traverseAncerstors(U,re.namedConstraint(m))},new W.BindingOnSyntax(this._binding)},j.prototype.whenAnyAncestorTagged=function(m,U){return this._binding.constraint=function(G){return re.traverseAncerstors(G,re.taggedConstraint(m)(U))},new W.BindingOnSyntax(this._binding)},j.prototype.whenNoAncestorTagged=function(m,U){return this._binding.constraint=function(G){return!re.traverseAncerstors(G,re.taggedConstraint(m)(U))},new W.BindingOnSyntax(this._binding)},j.prototype.whenAnyAncestorMatches=function(m){return this._binding.constraint=function(U){return re.traverseAncerstors(U,m)},new W.BindingOnSyntax(this._binding)},j.prototype.whenNoAncestorMatches=function(m){return this._binding.constraint=function(U){return!re.traverseAncerstors(U,m)},new W.BindingOnSyntax(this._binding)},j}();K.BindingWhenSyntax=ne},zEVN:function(He,K,O){var W=O("Gi0A"),re=O("sEf8"),ne=O("mdPL"),j=ne&&ne.isMap,m=j?re(j):W;He.exports=m},zvhG:function(He,K){He.exports=O;function O(W,re,ne,j){this.cx=3*W,this.bx=3*(ne-W)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*re,this.by=3*(j-re)-this.cy,this.ay=1-this.cy-this.by,this.p1x=W,this.p1y=j,this.p2x=ne,this.p2y=j}O.prototype.sampleCurveX=function(W){return((this.ax*W+this.bx)*W+this.cx)*W},O.prototype.sampleCurveY=function(W){return((this.ay*W+this.by)*W+this.cy)*W},O.prototype.sampleCurveDerivativeX=function(W){return(3*this.ax*W+2*this.bx)*W+this.cx},O.prototype.solveCurveX=function(W,re){typeof re=="undefined"&&(re=1e-6);var ne,j,m,U,G;for(m=W,G=0;G<8;G++){if(U=this.sampleCurveX(m)-W,Math.abs(U)<re)return m;var Te=this.sampleCurveDerivativeX(m);if(Math.abs(Te)<1e-6)break;m=m-U/Te}if(ne=0,j=1,m=W,m<ne)return ne;if(m>j)return j;for(;ne<j;){if(U=this.sampleCurveX(m),Math.abs(U-W)<re)return m;W>U?ne=m:j=m,m=(j-ne)*.5+ne}return m},O.prototype.solve=function(W,re){return this.sampleCurveY(this.solveCurveX(W,re))}},zxMA:function(He,K,O){"use strict";Object.defineProperty(K,"__esModule",{value:!0}),K.QueryableString=void 0;var W=function(){function re(ne){this.str=ne}return re.prototype.startsWith=function(ne){return this.str.indexOf(ne)===0},re.prototype.endsWith=function(ne){var j="",m=ne.split("").reverse().join("");return j=this.str.split("").reverse().join(""),this.startsWith.call({str:j},m)},re.prototype.contains=function(ne){return this.str.indexOf(ne)!==-1},re.prototype.equals=function(ne){return this.str===ne},re.prototype.value=function(){return this.str},re}();K.QueryableString=W}}]);
