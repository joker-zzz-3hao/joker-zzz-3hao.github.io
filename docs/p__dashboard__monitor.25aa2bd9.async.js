(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{"/ezw":function(Qe,Q,O){"use strict";var j=O("rePB"),H=O("wx14"),X=O("U8pU"),N=O("q1tI"),v=O("TSYQ"),z=O.n(v),W=function(ae){var Ce=ae.prefixCls,Ae=ae.className,vt=ae.width,At=ae.style;return N.createElement("h3",{className:z()(Ce,Ae),style:Object(H.a)({width:vt},At)})},Pe=W,se=O("KQm4"),ve=function(ae){var Ce=function(Tr){var Br=ae.width,On=ae.rows,Fr=On===void 0?2:On;if(Array.isArray(Br))return Br[Tr];if(Fr-1===Tr)return Br},Ae=ae.prefixCls,vt=ae.className,At=ae.style,Bt=ae.rows,Ft=Object(se.a)(Array(Bt)).map(function(fr,Tr){return N.createElement("li",{key:Tr,style:{width:Ce(Tr)}})});return N.createElement("ul",{className:z()(Ae,vt),style:At},Ft)},ue=ve,gt=O("H84U"),Ne=function(ae){var Ce,Ae,vt=ae.prefixCls,At=ae.className,Bt=ae.style,Ft=ae.size,fr=ae.shape,Tr=z()((Ce={},Object(j.a)(Ce,"".concat(vt,"-lg"),Ft==="large"),Object(j.a)(Ce,"".concat(vt,"-sm"),Ft==="small"),Ce)),Br=z()((Ae={},Object(j.a)(Ae,"".concat(vt,"-circle"),fr==="circle"),Object(j.a)(Ae,"".concat(vt,"-square"),fr==="square"),Object(j.a)(Ae,"".concat(vt,"-round"),fr==="round"),Ae)),On=typeof Ft=="number"?{width:Ft,height:Ft,lineHeight:"".concat(Ft,"px")}:{};return N.createElement("span",{className:z()(vt,Tr,Br,At),style:Object(H.a)(Object(H.a)({},On),Bt)})},st=Ne,Dt=O("bT9E"),pt=function(ae){var Ce=function(vt){var At=vt.getPrefixCls,Bt=ae.prefixCls,Ft=ae.className,fr=ae.active,Tr=At("skeleton",Bt),Br=Object(Dt.a)(ae,["prefixCls","className"]),On=z()(Tr,"".concat(Tr,"-element"),Object(j.a)({},"".concat(Tr,"-active"),fr),Ft);return N.createElement("div",{className:On},N.createElement(st,Object(H.a)({prefixCls:"".concat(Tr,"-avatar")},Br)))};return N.createElement(gt.a,null,Ce)};pt.defaultProps={size:"default",shape:"circle"};var $e=pt,Ct=function(ae){var Ce=function(vt){var At,Bt=vt.getPrefixCls,Ft=ae.prefixCls,fr=ae.className,Tr=ae.active,Br=ae.block,On=Br===void 0?!1:Br,Fr=Bt("skeleton",Ft),Hn=Object(Dt.a)(ae,["prefixCls"]),ni=z()(Fr,"".concat(Fr,"-element"),(At={},Object(j.a)(At,"".concat(Fr,"-active"),Tr),Object(j.a)(At,"".concat(Fr,"-block"),On),At),fr);return N.createElement("div",{className:ni},N.createElement(st,Object(H.a)({prefixCls:"".concat(Fr,"-button")},Hn)))};return N.createElement(gt.a,null,Ce)};Ct.defaultProps={size:"default"};var et=Ct,kt=function(ae){var Ce=function(vt){var At=vt.getPrefixCls,Bt=ae.prefixCls,Ft=ae.className,fr=ae.active,Tr=At("skeleton",Bt),Br=Object(Dt.a)(ae,["prefixCls"]),On=z()(Tr,"".concat(Tr,"-element"),Object(j.a)({},"".concat(Tr,"-active"),fr),Ft);return N.createElement("div",{className:On},N.createElement(st,Object(H.a)({prefixCls:"".concat(Tr,"-input")},Br)))};return N.createElement(gt.a,null,Ce)};kt.defaultProps={size:"default"};var Je=kt,Xe="M365.714286 329.142857q0 45.714286-32.036571 77.677714t-77.677714 32.036571-77.677714-32.036571-32.036571-77.677714 32.036571-77.677714 77.677714-32.036571 77.677714 32.036571 32.036571 77.677714zM950.857143 548.571429l0 256-804.571429 0 0-109.714286 182.857143-182.857143 91.428571 91.428571 292.571429-292.571429zM1005.714286 146.285714l-914.285714 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 694.857143q0 7.460571 5.412571 12.873143t12.873143 5.412571l914.285714 0q7.460571 0 12.873143-5.412571t5.412571-12.873143l0-694.857143q0-7.460571-5.412571-12.873143t-12.873143-5.412571zM1097.142857 164.571429l0 694.857143q0 37.741714-26.843429 64.585143t-64.585143 26.843429l-914.285714 0q-37.741714 0-64.585143-26.843429t-26.843429-64.585143l0-694.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l914.285714 0q37.741714 0 64.585143 26.843429t26.843429 64.585143z",jr=function(ae){var Ce=function(vt){var At=vt.getPrefixCls,Bt=ae.prefixCls,Ft=ae.className,fr=ae.style,Tr=At("skeleton",Bt),Br=z()(Tr,"".concat(Tr,"-element"),Ft);return N.createElement("div",{className:Br},N.createElement("div",{className:z()("".concat(Tr,"-image"),Ft),style:fr},N.createElement("svg",{viewBox:"0 0 1098 1024",xmlns:"http://www.w3.org/2000/svg",className:"".concat(Tr,"-image-svg")},N.createElement("path",{d:Xe,className:"".concat(Tr,"-image-path")}))))};return N.createElement(gt.a,null,Ce)},Dr=jr;function Jt(Ut){return Ut&&Object(X.a)(Ut)==="object"?Ut:{}}function Be(Ut,ae){return Ut&&!ae?{size:"large",shape:"square"}:{size:"large",shape:"circle"}}function Nt(Ut,ae){return!Ut&&ae?{width:"38%"}:Ut&&ae?{width:"50%"}:{}}function Gt(Ut,ae){var Ce={};return(!Ut||!ae)&&(Ce.width="61%"),!Ut&&ae?Ce.rows=3:Ce.rows=2,Ce}var Te=function(ae){var Ce=function(vt){var At=vt.getPrefixCls,Bt=vt.direction,Ft=ae.prefixCls,fr=ae.loading,Tr=ae.className,Br=ae.style,On=ae.children,Fr=ae.avatar,Hn=ae.title,ni=ae.paragraph,Yn=ae.active,ei=ae.round,ci=At("skeleton",Ft);if(fr||!("loading"in ae)){var Sr,_r=!!Fr,Kt=!!Hn,Wt=!!ni,Ir;if(_r){var je=Object(H.a)(Object(H.a)({prefixCls:"".concat(ci,"-avatar")},Be(Kt,Wt)),Jt(Fr));Ir=N.createElement("div",{className:"".concat(ci,"-header")},N.createElement(st,je))}var oe;if(Kt||Wt){var ne;if(Kt){var D=Object(H.a)(Object(H.a)({prefixCls:"".concat(ci,"-title")},Nt(_r,Wt)),Jt(Hn));ne=N.createElement(Pe,D)}var Ee;if(Wt){var He=Object(H.a)(Object(H.a)({prefixCls:"".concat(ci,"-paragraph")},Gt(_r,Kt)),Jt(ni));Ee=N.createElement(ue,He)}oe=N.createElement("div",{className:"".concat(ci,"-content")},ne,Ee)}var xt=z()(ci,(Sr={},Object(j.a)(Sr,"".concat(ci,"-with-avatar"),_r),Object(j.a)(Sr,"".concat(ci,"-active"),Yn),Object(j.a)(Sr,"".concat(ci,"-rtl"),Bt==="rtl"),Object(j.a)(Sr,"".concat(ci,"-round"),ei),Sr),Tr);return N.createElement("div",{className:xt,style:Br},Ir,oe)}return On};return N.createElement(gt.a,null,Ce)};Te.defaultProps={avatar:!1,title:!0,paragraph:!0},Te.Button=et,Te.Avatar=$e,Te.Input=Je,Te.Image=Dr;var me=Te,Re=Q.a=me},"/kpp":function(Qe,Q,O){"use strict";var j=O("rePB"),H=O("wx14"),X=O("U8pU"),N=O("q1tI"),v=O.n(N),z=O("TSYQ"),W=O.n(z),Pe=O("o/2+"),se=O("H84U"),ve=function(st,Dt){var pt={};for(var $e in st)Object.prototype.hasOwnProperty.call(st,$e)&&Dt.indexOf($e)<0&&(pt[$e]=st[$e]);if(st!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Ct=0,$e=Object.getOwnPropertySymbols(st);Ct<$e.length;Ct++)Dt.indexOf($e[Ct])<0&&Object.prototype.propertyIsEnumerable.call(st,$e[Ct])&&(pt[$e[Ct]]=st[$e[Ct]]);return pt};function ue(st){return typeof st=="number"?"".concat(st," ").concat(st," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(st)?"0 0 ".concat(st):st}var gt=["xs","sm","md","lg","xl","xxl"],Ne=N.forwardRef(function(st,Dt){var pt,$e=N.useContext(se.b),Ct=$e.getPrefixCls,et=$e.direction,kt=N.useContext(Pe.a),Je=kt.gutter,Xe=kt.wrap,jr=kt.supportFlexGap,Dr=st.prefixCls,Jt=st.span,Be=st.order,Nt=st.offset,Gt=st.push,Te=st.pull,me=st.className,Re=st.children,Ut=st.flex,ae=st.style,Ce=ve(st,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),Ae=Ct("col",Dr),vt={};gt.forEach(function(Tr){var Br,On={},Fr=st[Tr];typeof Fr=="number"?On.span=Fr:Object(X.a)(Fr)==="object"&&(On=Fr||{}),delete Ce[Tr],vt=Object(H.a)(Object(H.a)({},vt),(Br={},Object(j.a)(Br,"".concat(Ae,"-").concat(Tr,"-").concat(On.span),On.span!==void 0),Object(j.a)(Br,"".concat(Ae,"-").concat(Tr,"-order-").concat(On.order),On.order||On.order===0),Object(j.a)(Br,"".concat(Ae,"-").concat(Tr,"-offset-").concat(On.offset),On.offset||On.offset===0),Object(j.a)(Br,"".concat(Ae,"-").concat(Tr,"-push-").concat(On.push),On.push||On.push===0),Object(j.a)(Br,"".concat(Ae,"-").concat(Tr,"-pull-").concat(On.pull),On.pull||On.pull===0),Object(j.a)(Br,"".concat(Ae,"-rtl"),et==="rtl"),Br))});var At=W()(Ae,(pt={},Object(j.a)(pt,"".concat(Ae,"-").concat(Jt),Jt!==void 0),Object(j.a)(pt,"".concat(Ae,"-order-").concat(Be),Be),Object(j.a)(pt,"".concat(Ae,"-offset-").concat(Nt),Nt),Object(j.a)(pt,"".concat(Ae,"-push-").concat(Gt),Gt),Object(j.a)(pt,"".concat(Ae,"-pull-").concat(Te),Te),pt),me,vt),Bt={};if(Je&&Je[0]>0){var Ft=Je[0]/2;Bt.paddingLeft=Ft,Bt.paddingRight=Ft}if(Je&&Je[1]>0&&!jr){var fr=Je[1]/2;Bt.paddingTop=fr,Bt.paddingBottom=fr}return Ut&&(Bt.flex=ue(Ut),Xe===!1&&!Bt.minWidth&&(Bt.minWidth=0)),N.createElement("div",Object(H.a)({},Ce,{style:Object(H.a)(Object(H.a)({},Bt),ae),className:At,ref:Dt}),Re)});Ne.displayName="Col",Q.a=Ne},"0Q2g":function(Qe,Q,O){var j=O("W6/K");function H(X,N){return X&&X.length&&N&&N.length?j(X,N):X}Qe.exports=H},"0gSV":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagged=void 0;var j=O("GXnB"),H=O("Ztfv");function X(N,v){return function(z,W,Pe){var se=new j.Metadata(N,v);typeof Pe=="number"?H.tagParameter(z,W,Pe,se):H.tagProperty(z,W,se)}}Q.tagged=X},"1+5i":function(Qe,Q,O){var j=O("w/wX"),H=O("sEf8"),X=O("mdPL"),N=X&&X.isSet,v=N?H(N):j;Qe.exports=v},"1ABj":function(Qe,Q){function O(j,H){throw new Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}Qe.exports=O,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},"1XEM":function(Qe,Q,O){Qe.exports={tagCloud:"tagCloud___Blez5"}},"2GsC":function(Qe,Q){function O(j,H,X,N){for(var v=X-1,z=j.length;++v<z;)if(N(j[v],H))return v;return-1}Qe.exports=O},"2ajD":function(Qe,Q){function O(j){return j!==j}Qe.exports=O},"3L5V":function(Qe,Q,O){(function(j){(function(H,X){Qe.exports=X()})(this,function(){"use strict";function H(je,oe){if(!(je instanceof oe))throw new TypeError("Cannot call a class as a function")}function X(je,oe){for(var ne=0;ne<oe.length;ne++){var D=oe[ne];D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(je,D.key,D)}}function N(je,oe,ne){return oe&&X(je.prototype,oe),ne&&X(je,ne),je}/**
 * splaytree v3.1.0
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */var v=function(){function je(oe,ne){this.next=null,this.key=oe,this.data=ne,this.left=null,this.right=null}return je}();function z(je,oe){return je>oe?1:je<oe?-1:0}function W(je,oe,ne){for(var D=new v(null,null),Ee=D,He=D;;){var xt=ne(je,oe.key);if(xt<0){if(oe.left===null)break;if(ne(je,oe.left.key)<0){var er=oe.left;if(oe.left=er.right,er.right=oe,oe=er,oe.left===null)break}He.left=oe,He=oe,oe=oe.left}else if(xt>0){if(oe.right===null)break;if(ne(je,oe.right.key)>0){var er=oe.right;if(oe.right=er.left,er.left=oe,oe=er,oe.right===null)break}Ee.right=oe,Ee=oe,oe=oe.right}else break}return Ee.right=oe.left,He.left=oe.right,oe.left=D.right,oe.right=D.left,oe}function Pe(je,oe,ne,D){var Ee=new v(je,oe);if(ne===null)return Ee.left=Ee.right=null,Ee;ne=W(je,ne,D);var He=D(je,ne.key);return He<0?(Ee.left=ne.left,Ee.right=ne,ne.left=null):He>=0&&(Ee.right=ne.right,Ee.left=ne,ne.right=null),Ee}function se(je,oe,ne){var D=null,Ee=null;if(oe){oe=W(je,oe,ne);var He=ne(oe.key,je);He===0?(D=oe.left,Ee=oe.right):He<0?(Ee=oe.right,oe.right=null,D=oe):(D=oe.left,oe.left=null,Ee=oe)}return{left:D,right:Ee}}function ve(je,oe,ne){return oe===null?je:(je===null||(oe=W(je.key,oe,ne),oe.left=je),oe)}function ue(je,oe,ne,D,Ee){if(je){D(""+oe+(ne?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+Ee(je)+`
`);var He=oe+(ne?"    ":"\u2502   ");je.left&&ue(je.left,He,!1,D,Ee),je.right&&ue(je.right,He,!0,D,Ee)}}var gt=function(){function je(oe){oe===void 0&&(oe=z),this._root=null,this._size=0,this._comparator=oe}return je.prototype.insert=function(oe,ne){return this._size++,this._root=Pe(oe,ne,this._root,this._comparator)},je.prototype.add=function(oe,ne){var D=new v(oe,ne);this._root===null&&(D.left=D.right=null,this._size++,this._root=D);var Ee=this._comparator,He=W(oe,this._root,Ee),xt=Ee(oe,He.key);return xt===0?this._root=He:(xt<0?(D.left=He.left,D.right=He,He.left=null):xt>0&&(D.right=He.right,D.left=He,He.right=null),this._size++,this._root=D),this._root},je.prototype.remove=function(oe){this._root=this._remove(oe,this._root,this._comparator)},je.prototype._remove=function(oe,ne,D){var Ee;if(ne===null)return null;ne=W(oe,ne,D);var He=D(oe,ne.key);return He===0?(ne.left===null?Ee=ne.right:(Ee=W(oe,ne.left,D),Ee.right=ne.right),this._size--,Ee):ne},je.prototype.pop=function(){var oe=this._root;if(oe){for(;oe.left;)oe=oe.left;return this._root=W(oe.key,this._root,this._comparator),this._root=this._remove(oe.key,this._root,this._comparator),{key:oe.key,data:oe.data}}return null},je.prototype.findStatic=function(oe){for(var ne=this._root,D=this._comparator;ne;){var Ee=D(oe,ne.key);if(Ee===0)return ne;Ee<0?ne=ne.left:ne=ne.right}return null},je.prototype.find=function(oe){return this._root&&(this._root=W(oe,this._root,this._comparator),this._comparator(oe,this._root.key)!==0)?null:this._root},je.prototype.contains=function(oe){for(var ne=this._root,D=this._comparator;ne;){var Ee=D(oe,ne.key);if(Ee===0)return!0;Ee<0?ne=ne.left:ne=ne.right}return!1},je.prototype.forEach=function(oe,ne){for(var D=this._root,Ee=[],He=!1;!He;)D!==null?(Ee.push(D),D=D.left):Ee.length!==0?(D=Ee.pop(),oe.call(ne,D),D=D.right):He=!0;return this},je.prototype.range=function(oe,ne,D,Ee){for(var He=[],xt=this._comparator,er=this._root,ur;He.length!==0||er;)if(er)He.push(er),er=er.left;else{if(er=He.pop(),ur=xt(er.key,ne),ur>0)break;if(xt(er.key,oe)>=0&&D.call(Ee,er))return this;er=er.right}return this},je.prototype.keys=function(){var oe=[];return this.forEach(function(ne){var D=ne.key;return oe.push(D)}),oe},je.prototype.values=function(){var oe=[];return this.forEach(function(ne){var D=ne.data;return oe.push(D)}),oe},je.prototype.min=function(){return this._root?this.minNode(this._root).key:null},je.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},je.prototype.minNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.left;)oe=oe.left;return oe},je.prototype.maxNode=function(oe){if(oe===void 0&&(oe=this._root),oe)for(;oe.right;)oe=oe.right;return oe},je.prototype.at=function(oe){for(var ne=this._root,D=!1,Ee=0,He=[];!D;)if(ne)He.push(ne),ne=ne.left;else if(He.length>0){if(ne=He.pop(),Ee===oe)return ne;Ee++,ne=ne.right}else D=!0;return null},je.prototype.next=function(oe){var ne=this._root,D=null;if(oe.right){for(D=oe.right;D.left;)D=D.left;return D}for(var Ee=this._comparator;ne;){var He=Ee(oe.key,ne.key);if(He===0)break;He<0?(D=ne,ne=ne.left):ne=ne.right}return D},je.prototype.prev=function(oe){var ne=this._root,D=null;if(oe.left!==null){for(D=oe.left;D.right;)D=D.right;return D}for(var Ee=this._comparator;ne;){var He=Ee(oe.key,ne.key);if(He===0)break;He<0?ne=ne.left:(D=ne,ne=ne.right)}return D},je.prototype.clear=function(){return this._root=null,this._size=0,this},je.prototype.toList=function(){return Dt(this._root)},je.prototype.load=function(oe,ne,D){ne===void 0&&(ne=[]),D===void 0&&(D=!1);var Ee=oe.length,He=this._comparator;if(D&&Ct(oe,ne,0,Ee-1,He),this._root===null)this._root=Ne(oe,ne,0,Ee),this._size=Ee;else{var xt=$e(this.toList(),st(oe,ne),He);Ee=this._size+Ee,this._root=pt({head:xt},0,Ee)}return this},je.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(je.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(je.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),je.prototype.toString=function(oe){oe===void 0&&(oe=function(Ee){return String(Ee.key)});var ne=[];return ue(this._root,"",!0,function(D){return ne.push(D)},oe),ne.join("")},je.prototype.update=function(oe,ne,D){var Ee=this._comparator,He=se(oe,this._root,Ee),xt=He.left,er=He.right;Ee(oe,ne)<0?er=Pe(ne,D,er,Ee):xt=Pe(ne,D,xt,Ee),this._root=ve(xt,er,Ee)},je.prototype.split=function(oe){return se(oe,this._root,this._comparator)},je}();function Ne(je,oe,ne,D){var Ee=D-ne;if(Ee>0){var He=ne+Math.floor(Ee/2),xt=je[He],er=oe[He],ur=new v(xt,er);return ur.left=Ne(je,oe,ne,He),ur.right=Ne(je,oe,He+1,D),ur}return null}function st(je,oe){for(var ne=new v(null,null),D=ne,Ee=0;Ee<je.length;Ee++)D=D.next=new v(je[Ee],oe[Ee]);return D.next=null,ne.next}function Dt(je){for(var oe=je,ne=[],D=!1,Ee=new v(null,null),He=Ee;!D;)oe?(ne.push(oe),oe=oe.left):ne.length>0?(oe=He=He.next=ne.pop(),oe=oe.right):D=!0;return He.next=null,Ee.next}function pt(je,oe,ne){var D=ne-oe;if(D>0){var Ee=oe+Math.floor(D/2),He=pt(je,oe,Ee),xt=je.head;return xt.left=He,je.head=je.head.next,xt.right=pt(je,Ee+1,ne),xt}return null}function $e(je,oe,ne){for(var D=new v(null,null),Ee=D,He=je,xt=oe;He!==null&&xt!==null;)ne(He.key,xt.key)<0?(Ee.next=He,He=He.next):(Ee.next=xt,xt=xt.next),Ee=Ee.next;return He!==null?Ee.next=He:xt!==null&&(Ee.next=xt),D.next}function Ct(je,oe,ne,D,Ee){if(!(ne>=D)){for(var He=je[ne+D>>1],xt=ne-1,er=D+1;;){do xt++;while(Ee(je[xt],He)<0);do er--;while(Ee(je[er],He)>0);if(xt>=er)break;var ur=je[xt];je[xt]=je[er],je[er]=ur,ur=oe[xt],oe[xt]=oe[er],oe[er]=ur}Ct(je,oe,ne,er,Ee),Ct(je,oe,er+1,D,Ee)}}var et=function(oe,ne){return oe.ll.x<=ne.x&&ne.x<=oe.ur.x&&oe.ll.y<=ne.y&&ne.y<=oe.ur.y},kt=function(oe,ne){if(ne.ur.x<oe.ll.x||oe.ur.x<ne.ll.x||ne.ur.y<oe.ll.y||oe.ur.y<ne.ll.y)return null;var D=oe.ll.x<ne.ll.x?ne.ll.x:oe.ll.x,Ee=oe.ur.x<ne.ur.x?oe.ur.x:ne.ur.x,He=oe.ll.y<ne.ll.y?ne.ll.y:oe.ll.y,xt=oe.ur.y<ne.ur.y?oe.ur.y:ne.ur.y;return{ll:{x:D,y:He},ur:{x:Ee,y:xt}}},Je=Number.EPSILON;Je===void 0&&(Je=Math.pow(2,-52));var Xe=Je*Je,jr=function(oe,ne){if(-Je<oe&&oe<Je&&-Je<ne&&ne<Je)return 0;var D=oe-ne;return D*D<Xe*oe*ne?0:oe<ne?-1:1},Dr=function(){function je(){H(this,je),this.reset()}return N(je,[{key:"reset",value:function(){this.xRounder=new Jt,this.yRounder=new Jt}},{key:"round",value:function(ne,D){return{x:this.xRounder.round(ne),y:this.yRounder.round(D)}}}]),je}(),Jt=function(){function je(){H(this,je),this.tree=new gt,this.round(0)}return N(je,[{key:"round",value:function(ne){var D=this.tree.add(ne),Ee=this.tree.prev(D);if(Ee!==null&&jr(D.key,Ee.key)===0)return this.tree.remove(ne),Ee.key;var He=this.tree.next(D);return He!==null&&jr(D.key,He.key)===0?(this.tree.remove(ne),He.key):ne}}]),je}(),Be=new Dr,Nt=function(oe,ne){return oe.x*ne.y-oe.y*ne.x},Gt=function(oe,ne){return oe.x*ne.x+oe.y*ne.y},Te=function(oe,ne,D){var Ee={x:ne.x-oe.x,y:ne.y-oe.y},He={x:D.x-oe.x,y:D.y-oe.y},xt=Nt(Ee,He);return jr(xt,0)},me=function(oe){return Math.sqrt(Gt(oe,oe))},Re=function(oe,ne,D){var Ee={x:ne.x-oe.x,y:ne.y-oe.y},He={x:D.x-oe.x,y:D.y-oe.y};return Nt(He,Ee)/me(He)/me(Ee)},Ut=function(oe,ne,D){var Ee={x:ne.x-oe.x,y:ne.y-oe.y},He={x:D.x-oe.x,y:D.y-oe.y};return Gt(He,Ee)/me(He)/me(Ee)},ae=function(oe,ne,D){return ne.y===0?null:{x:oe.x+ne.x/ne.y*(D-oe.y),y:D}},Ce=function(oe,ne,D){return ne.x===0?null:{x:D,y:oe.y+ne.y/ne.x*(D-oe.x)}},Ae=function(oe,ne,D,Ee){if(ne.x===0)return Ce(D,Ee,oe.x);if(Ee.x===0)return Ce(oe,ne,D.x);if(ne.y===0)return ae(D,Ee,oe.y);if(Ee.y===0)return ae(oe,ne,D.y);var He=Nt(ne,Ee);if(He==0)return null;var xt={x:D.x-oe.x,y:D.y-oe.y},er=Nt(xt,ne)/He,ur=Nt(xt,Ee)/He,tt=oe.x+ur*ne.x,It=D.x+er*Ee.x,or=oe.y+ur*ne.y,Cr=D.y+er*Ee.y,Or=(tt+It)/2,Nn=(or+Cr)/2;return{x:Or,y:Nn}},vt=function(){N(je,null,[{key:"compare",value:function(ne,D){var Ee=je.comparePoints(ne.point,D.point);return Ee!==0?Ee:(ne.point!==D.point&&ne.link(D),ne.isLeft!==D.isLeft?ne.isLeft?1:-1:Bt.compare(ne.segment,D.segment))}},{key:"comparePoints",value:function(ne,D){return ne.x<D.x?-1:ne.x>D.x?1:ne.y<D.y?-1:ne.y>D.y?1:0}}]);function je(oe,ne){H(this,je),oe.events===void 0?oe.events=[this]:oe.events.push(this),this.point=oe,this.isLeft=ne}return N(je,[{key:"link",value:function(ne){if(ne.point===this.point)throw new Error("Tried to link already linked events");for(var D=ne.point.events,Ee=0,He=D.length;Ee<He;Ee++){var xt=D[Ee];this.point.events.push(xt),xt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var ne=this.point.events.length,D=0;D<ne;D++){var Ee=this.point.events[D];if(Ee.segment.consumedBy===void 0)for(var He=D+1;He<ne;He++){var xt=this.point.events[He];xt.consumedBy===void 0&&Ee.otherSE.point.events===xt.otherSE.point.events&&Ee.segment.consume(xt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var ne=[],D=0,Ee=this.point.events.length;D<Ee;D++){var He=this.point.events[D];He!==this&&!He.segment.ringOut&&He.segment.isInResult()&&ne.push(He)}return ne}},{key:"getLeftmostComparator",value:function(ne){var D=this,Ee=new Map,He=function(er){var ur=er.otherSE;Ee.set(er,{sine:Re(D.point,ne.point,ur.point),cosine:Ut(D.point,ne.point,ur.point)})};return function(xt,er){Ee.has(xt)||He(xt),Ee.has(er)||He(er);var ur=Ee.get(xt),tt=ur.sine,It=ur.cosine,or=Ee.get(er),Cr=or.sine,Or=or.cosine;return tt>=0&&Cr>=0?It<Or?1:It>Or?-1:0:tt<0&&Cr<0?It<Or?-1:It>Or?1:0:Cr<tt?-1:Cr>tt?1:0}}}]),je}(),At=0,Bt=function(){N(je,null,[{key:"compare",value:function(ne,D){var Ee=ne.leftSE.point.x,He=D.leftSE.point.x,xt=ne.rightSE.point.x,er=D.rightSE.point.x;if(er<Ee)return 1;if(xt<He)return-1;var ur=ne.leftSE.point.y,tt=D.leftSE.point.y,It=ne.rightSE.point.y,or=D.rightSE.point.y;if(Ee<He){if(tt<ur&&tt<It)return 1;if(tt>ur&&tt>It)return-1;var Cr=ne.comparePoint(D.leftSE.point);if(Cr<0)return 1;if(Cr>0)return-1;var Or=D.comparePoint(ne.rightSE.point);return Or!==0?Or:-1}if(Ee>He){if(ur<tt&&ur<or)return-1;if(ur>tt&&ur>or)return 1;var Nn=D.comparePoint(ne.leftSE.point);if(Nn!==0)return Nn;var sn=ne.comparePoint(D.rightSE.point);return sn<0?1:sn>0?-1:1}if(ur<tt)return-1;if(ur>tt)return 1;if(xt<er){var gn=D.comparePoint(ne.rightSE.point);if(gn!==0)return gn}if(xt>er){var dn=ne.comparePoint(D.rightSE.point);if(dn<0)return 1;if(dn>0)return-1}if(xt!==er){var ri=It-ur,mi=xt-Ee,ki=or-tt,Aa=er-He;if(ri>mi&&ki<Aa)return 1;if(ri<mi&&ki>Aa)return-1}return xt>er?1:xt<er||It<or?-1:It>or?1:ne.id<D.id?-1:ne.id>D.id?1:0}}]);function je(oe,ne,D,Ee){H(this,je),this.id=++At,this.leftSE=oe,oe.segment=this,oe.otherSE=ne,this.rightSE=ne,ne.segment=this,ne.otherSE=oe,this.rings=D,this.windings=Ee}return N(je,[{key:"replaceRightSE",value:function(ne){this.rightSE=ne,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var ne=this.leftSE.point.y,D=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:ne<D?ne:D},ur:{x:this.rightSE.point.x,y:ne>D?ne:D}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(ne){return ne.x===this.leftSE.point.x&&ne.y===this.leftSE.point.y||ne.x===this.rightSE.point.x&&ne.y===this.rightSE.point.y}},{key:"comparePoint",value:function(ne){if(this.isAnEndpoint(ne))return 0;var D=this.leftSE.point,Ee=this.rightSE.point,He=this.vector();if(D.x===Ee.x)return ne.x===D.x?0:ne.x<D.x?1:-1;var xt=(ne.y-D.y)/He.y,er=D.x+xt*He.x;if(ne.x===er)return 0;var ur=(ne.x-D.x)/He.x,tt=D.y+ur*He.y;return ne.y===tt?0:ne.y<tt?-1:1}},{key:"getIntersection",value:function(ne){var D=this.bbox(),Ee=ne.bbox(),He=kt(D,Ee);if(He===null)return null;var xt=this.leftSE.point,er=this.rightSE.point,ur=ne.leftSE.point,tt=ne.rightSE.point,It=et(D,ur)&&this.comparePoint(ur)===0,or=et(Ee,xt)&&ne.comparePoint(xt)===0,Cr=et(D,tt)&&this.comparePoint(tt)===0,Or=et(Ee,er)&&ne.comparePoint(er)===0;if(or&&It)return Or&&!Cr?er:!Or&&Cr?tt:null;if(or)return Cr&&xt.x===tt.x&&xt.y===tt.y?null:xt;if(It)return Or&&er.x===ur.x&&er.y===ur.y?null:ur;if(Or&&Cr)return null;if(Or)return er;if(Cr)return tt;var Nn=Ae(xt,this.vector(),ur,ne.vector());return Nn===null||!et(He,Nn)?null:Be.round(Nn.x,Nn.y)}},{key:"split",value:function(ne){var D=[],Ee=ne.events!==void 0,He=new vt(ne,!0),xt=new vt(ne,!1),er=this.rightSE;this.replaceRightSE(xt),D.push(xt),D.push(He);var ur=new je(He,er,this.rings.slice(),this.windings.slice());return vt.comparePoints(ur.leftSE.point,ur.rightSE.point)>0&&ur.swapEvents(),vt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ee&&(He.checkForConsuming(),xt.checkForConsuming()),D}},{key:"swapEvents",value:function(){var ne=this.rightSE;this.rightSE=this.leftSE,this.leftSE=ne,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var D=0,Ee=this.windings.length;D<Ee;D++)this.windings[D]*=-1}},{key:"consume",value:function(ne){for(var D=this,Ee=ne;D.consumedBy;)D=D.consumedBy;for(;Ee.consumedBy;)Ee=Ee.consumedBy;var He=je.compare(D,Ee);if(He!==0){if(He>0){var xt=D;D=Ee,Ee=xt}if(D.prev===Ee){var er=D;D=Ee,Ee=er}for(var ur=0,tt=Ee.rings.length;ur<tt;ur++){var It=Ee.rings[ur],or=Ee.windings[ur],Cr=D.rings.indexOf(It);Cr===-1?(D.rings.push(It),D.windings.push(or)):D.windings[Cr]+=or}Ee.rings=null,Ee.windings=null,Ee.consumedBy=D,Ee.leftSE.consumedBy=D.leftSE,Ee.rightSE.consumedBy=D.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var ne=this.prev.consumedBy||this.prev;this._beforeState=ne.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var ne=this.beforeState();this._afterState={rings:ne.rings.slice(0),windings:ne.windings.slice(0),multiPolys:[]};for(var D=this._afterState.rings,Ee=this._afterState.windings,He=this._afterState.multiPolys,xt=0,er=this.rings.length;xt<er;xt++){var ur=this.rings[xt],tt=this.windings[xt],It=D.indexOf(ur);It===-1?(D.push(ur),Ee.push(tt)):Ee[It]+=tt}for(var or=[],Cr=[],Or=0,Nn=D.length;Or<Nn;Or++)if(Ee[Or]!==0){var sn=D[Or],gn=sn.poly;if(Cr.indexOf(gn)===-1)if(sn.isExterior)or.push(gn);else{Cr.indexOf(gn)===-1&&Cr.push(gn);var dn=or.indexOf(sn.poly);dn!==-1&&or.splice(dn,1)}}for(var ri=0,mi=or.length;ri<mi;ri++){var ki=or[ri].multiPoly;He.indexOf(ki)===-1&&He.push(ki)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var ne=this.beforeState().multiPolys,D=this.afterState().multiPolys;switch(ci.type){case"union":{var Ee=ne.length===0,He=D.length===0;this._isInResult=Ee!==He;break}case"intersection":{var xt,er;ne.length<D.length?(xt=ne.length,er=D.length):(xt=D.length,er=ne.length),this._isInResult=er===ci.numMultiPolys&&xt<er;break}case"xor":{var ur=Math.abs(ne.length-D.length);this._isInResult=ur%2==1;break}case"difference":{var tt=function(or){return or.length===1&&or[0].isSubject};this._isInResult=tt(ne)!==tt(D);break}default:throw new Error("Unrecognized operation type found ".concat(ci.type))}return this._isInResult}}],[{key:"fromRing",value:function(ne,D,Ee){var He,xt,er,ur=vt.comparePoints(ne,D);if(ur<0)He=ne,xt=D,er=1;else if(ur>0)He=D,xt=ne,er=-1;else throw new Error("Tried to create degenerate segment at [".concat(ne.x,", ").concat(ne.y,"]"));var tt=new vt(He,!0),It=new vt(xt,!1);return new je(tt,It,[Ee],[er])}}]),je}(),Ft=function(){function je(oe,ne,D){if(H(this,je),!Array.isArray(oe)||oe.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=ne,this.isExterior=D,this.segments=[],typeof oe[0][0]!="number"||typeof oe[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ee=Be.round(oe[0][0],oe[0][1]);this.bbox={ll:{x:Ee.x,y:Ee.y},ur:{x:Ee.x,y:Ee.y}};for(var He=Ee,xt=1,er=oe.length;xt<er;xt++){if(typeof oe[xt][0]!="number"||typeof oe[xt][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var ur=Be.round(oe[xt][0],oe[xt][1]);ur.x===He.x&&ur.y===He.y||(this.segments.push(Bt.fromRing(He,ur,this)),ur.x<this.bbox.ll.x&&(this.bbox.ll.x=ur.x),ur.y<this.bbox.ll.y&&(this.bbox.ll.y=ur.y),ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ur.x),ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ur.y),He=ur)}(Ee.x!==He.x||Ee.y!==He.y)&&this.segments.push(Bt.fromRing(He,Ee,this))}return N(je,[{key:"getSweepEvents",value:function(){for(var ne=[],D=0,Ee=this.segments.length;D<Ee;D++){var He=this.segments[D];ne.push(He.leftSE),ne.push(He.rightSE)}return ne}}]),je}(),fr=function(){function je(oe,ne){if(H(this,je),!Array.isArray(oe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ft(oe[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var D=1,Ee=oe.length;D<Ee;D++){var He=new Ft(oe[D],this,!1);He.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=He.bbox.ll.x),He.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=He.bbox.ll.y),He.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=He.bbox.ur.x),He.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=He.bbox.ur.y),this.interiorRings.push(He)}this.multiPoly=ne}return N(je,[{key:"getSweepEvents",value:function(){for(var ne=this.exteriorRing.getSweepEvents(),D=0,Ee=this.interiorRings.length;D<Ee;D++)for(var He=this.interiorRings[D].getSweepEvents(),xt=0,er=He.length;xt<er;xt++)ne.push(He[xt]);return ne}}]),je}(),Tr=function(){function je(oe,ne){if(H(this,je),!Array.isArray(oe))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof oe[0][0][0]=="number"&&(oe=[oe])}catch(xt){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var D=0,Ee=oe.length;D<Ee;D++){var He=new fr(oe[D],this);He.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=He.bbox.ll.x),He.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=He.bbox.ll.y),He.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=He.bbox.ur.x),He.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=He.bbox.ur.y),this.polys.push(He)}this.isSubject=ne}return N(je,[{key:"getSweepEvents",value:function(){for(var ne=[],D=0,Ee=this.polys.length;D<Ee;D++)for(var He=this.polys[D].getSweepEvents(),xt=0,er=He.length;xt<er;xt++)ne.push(He[xt]);return ne}}]),je}(),Br=function(){N(je,null,[{key:"factory",value:function(ne){for(var D=[],Ee=0,He=ne.length;Ee<He;Ee++){var xt=ne[Ee];if(!(!xt.isInResult()||xt.ringOut)){for(var er=null,ur=xt.leftSE,tt=xt.rightSE,It=[ur],or=ur.point,Cr=[];er=ur,ur=tt,It.push(ur),ur.point!==or;)for(;;){var Or=ur.getAvailableLinkedEvents();if(Or.length===0){var Nn=It[0].point,sn=It[It.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Nn.x,",")+" ".concat(Nn.y,"]. Last matching segment found ends at")+" [".concat(sn.x,", ").concat(sn.y,"]."))}if(Or.length===1){tt=Or[0].otherSE;break}for(var gn=null,dn=0,ri=Cr.length;dn<ri;dn++)if(Cr[dn].point===ur.point){gn=dn;break}if(gn!==null){var mi=Cr.splice(gn)[0],ki=It.splice(mi.index);ki.unshift(ki[0].otherSE),D.push(new je(ki.reverse()));continue}Cr.push({index:It.length,point:ur.point});var Aa=ur.getLeftmostComparator(er);tt=Or.sort(Aa)[0].otherSE;break}D.push(new je(It))}}return D}}]);function je(oe){H(this,je),this.events=oe;for(var ne=0,D=oe.length;ne<D;ne++)oe[ne].segment.ringOut=this;this.poly=null}return N(je,[{key:"getGeom",value:function(){for(var ne=this.events[0].point,D=[ne],Ee=1,He=this.events.length-1;Ee<He;Ee++){var xt=this.events[Ee].point,er=this.events[Ee+1].point;Te(xt,ne,er)!==0&&(D.push(xt),ne=xt)}if(D.length===1)return null;var ur=D[0],tt=D[1];Te(ur,ne,tt)===0&&D.shift(),D.push(D[0]);for(var It=this.isExteriorRing()?1:-1,or=this.isExteriorRing()?0:D.length-1,Cr=this.isExteriorRing()?D.length:-1,Or=[],Nn=or;Nn!=Cr;Nn+=It)Or.push([D[Nn].x,D[Nn].y]);return Or}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var ne=this.enclosingRing();this._isExteriorRing=ne?!ne.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var ne=this.events[0],D=1,Ee=this.events.length;D<Ee;D++){var He=this.events[D];vt.compare(ne,He)>0&&(ne=He)}for(var xt=ne.segment.prevInResult(),er=xt?xt.prevInResult():null;;){if(!xt)return null;if(!er)return xt.ringOut;if(er.ringOut!==xt.ringOut)return er.ringOut.enclosingRing()!==xt.ringOut?xt.ringOut:xt.ringOut.enclosingRing();xt=er.prevInResult(),er=xt?xt.prevInResult():null}}}]),je}(),On=function(){function je(oe){H(this,je),this.exteriorRing=oe,oe.poly=this,this.interiorRings=[]}return N(je,[{key:"addInterior",value:function(ne){this.interiorRings.push(ne),ne.poly=this}},{key:"getGeom",value:function(){var ne=[this.exteriorRing.getGeom()];if(ne[0]===null)return null;for(var D=0,Ee=this.interiorRings.length;D<Ee;D++){var He=this.interiorRings[D].getGeom();He!==null&&ne.push(He)}return ne}}]),je}(),Fr=function(){function je(oe){H(this,je),this.rings=oe,this.polys=this._composePolys(oe)}return N(je,[{key:"getGeom",value:function(){for(var ne=[],D=0,Ee=this.polys.length;D<Ee;D++){var He=this.polys[D].getGeom();He!==null&&ne.push(He)}return ne}},{key:"_composePolys",value:function(ne){for(var D=[],Ee=0,He=ne.length;Ee<He;Ee++){var xt=ne[Ee];if(!xt.poly)if(xt.isExteriorRing())D.push(new On(xt));else{var er=xt.enclosingRing();er.poly||D.push(new On(er)),er.poly.addInterior(xt)}}return D}}]),je}(),Hn=function(){function je(oe){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bt.compare;H(this,je),this.queue=oe,this.tree=new gt(ne),this.segments=[]}return N(je,[{key:"process",value:function(ne){var D=ne.segment,Ee=[];if(ne.consumedBy)return ne.isLeft?this.queue.remove(ne.otherSE):this.tree.remove(D),Ee;var He=ne.isLeft?this.tree.insert(D):this.tree.find(D);if(!He)throw new Error("Unable to find segment #".concat(D.id," ")+"[".concat(D.leftSE.point.x,", ").concat(D.leftSE.point.y,"] -> ")+"[".concat(D.rightSE.point.x,", ").concat(D.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var xt=He,er=He,ur=void 0,tt=void 0;ur===void 0;)xt=this.tree.prev(xt),xt===null?ur=null:xt.key.consumedBy===void 0&&(ur=xt.key);for(;tt===void 0;)er=this.tree.next(er),er===null?tt=null:er.key.consumedBy===void 0&&(tt=er.key);if(ne.isLeft){var It=null;if(ur){var or=ur.getIntersection(D);if(or!==null&&(D.isAnEndpoint(or)||(It=or),!ur.isAnEndpoint(or)))for(var Cr=this._splitSafely(ur,or),Or=0,Nn=Cr.length;Or<Nn;Or++)Ee.push(Cr[Or])}var sn=null;if(tt){var gn=tt.getIntersection(D);if(gn!==null&&(D.isAnEndpoint(gn)||(sn=gn),!tt.isAnEndpoint(gn)))for(var dn=this._splitSafely(tt,gn),ri=0,mi=dn.length;ri<mi;ri++)Ee.push(dn[ri])}if(It!==null||sn!==null){var ki=null;if(It===null)ki=sn;else if(sn===null)ki=It;else{var Aa=vt.comparePoints(It,sn);ki=Aa<=0?It:sn}this.queue.remove(D.rightSE),Ee.push(D.rightSE);for(var Pa=D.split(ki),Co=0,yo=Pa.length;Co<yo;Co++)Ee.push(Pa[Co])}Ee.length>0?(this.tree.remove(D),Ee.push(ne)):(this.segments.push(D),D.prev=ur)}else{if(ur&&tt){var Mi=ur.getIntersection(tt);if(Mi!==null){if(!ur.isAnEndpoint(Mi))for(var te=this._splitSafely(ur,Mi),K=0,fe=te.length;K<fe;K++)Ee.push(te[K]);if(!tt.isAnEndpoint(Mi))for(var Se=this._splitSafely(tt,Mi),Le=0,mt=Se.length;Le<mt;Le++)Ee.push(Se[Le])}}this.tree.remove(D)}return Ee}},{key:"_splitSafely",value:function(ne,D){this.tree.remove(ne);var Ee=ne.rightSE;this.queue.remove(Ee);var He=ne.split(D);return He.push(Ee),ne.consumedBy===void 0&&this.tree.insert(ne),He}}]),je}(),ni=typeof j!="undefined"&&Object({NODE_ENV:"production"}).POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Yn=typeof j!="undefined"&&Object({NODE_ENV:"production"}).POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,ei=function(){function je(){H(this,je)}return N(je,[{key:"run",value:function(ne,D,Ee){ci.type=ne,Be.reset();for(var He=[new Tr(D,!0)],xt=0,er=Ee.length;xt<er;xt++)He.push(new Tr(Ee[xt],!1));if(ci.numMultiPolys=He.length,ci.type==="difference")for(var ur=He[0],tt=1;tt<He.length;)kt(He[tt].bbox,ur.bbox)!==null?tt++:He.splice(tt,1);if(ci.type==="intersection"){for(var It=0,or=He.length;It<or;It++)for(var Cr=He[It],Or=It+1,Nn=He.length;Or<Nn;Or++)if(kt(Cr.bbox,He[Or].bbox)===null)return[]}for(var sn=new gt(vt.compare),gn=0,dn=He.length;gn<dn;gn++)for(var ri=He[gn].getSweepEvents(),mi=0,ki=ri.length;mi<ki;mi++)if(sn.insert(ri[mi]),sn.size>ni)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Aa=new Hn(sn),Pa=sn.size,Co=sn.pop();Co;){var yo=Co.key;if(sn.size===Pa){var Mi=yo.segment;throw new Error("Unable to pop() ".concat(yo.isLeft?"left":"right"," SweepEvent ")+"[".concat(yo.point.x,", ").concat(yo.point.y,"] from segment #").concat(Mi.id," ")+"[".concat(Mi.leftSE.point.x,", ").concat(Mi.leftSE.point.y,"] -> ")+"[".concat(Mi.rightSE.point.x,", ").concat(Mi.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(sn.size>ni)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Aa.segments.length>Yn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var te=Aa.process(yo),K=0,fe=te.length;K<fe;K++){var Se=te[K];Se.consumedBy===void 0&&sn.insert(Se)}Pa=sn.size,Co=sn.pop()}Be.reset();var Le=Br.factory(Aa.segments),mt=new Fr(Le);return mt.getGeom()}}]),je}(),ci=new ei,Sr=function(oe){for(var ne=arguments.length,D=new Array(ne>1?ne-1:0),Ee=1;Ee<ne;Ee++)D[Ee-1]=arguments[Ee];return ci.run("union",oe,D)},_r=function(oe){for(var ne=arguments.length,D=new Array(ne>1?ne-1:0),Ee=1;Ee<ne;Ee++)D[Ee-1]=arguments[Ee];return ci.run("intersection",oe,D)},Kt=function(oe){for(var ne=arguments.length,D=new Array(ne>1?ne-1:0),Ee=1;Ee<ne;Ee++)D[Ee-1]=arguments[Ee];return ci.run("xor",oe,D)},Wt=function(oe){for(var ne=arguments.length,D=new Array(ne>1?ne-1:0),Ee=1;Ee<ne;Ee++)D[Ee-1]=arguments[Ee];return ci.run("difference",oe,D)},Ir={union:Sr,intersection:_r,xor:Kt,difference:Wt};return Ir})}).call(this,O("Q2Ig"))},"3cYt":function(Qe,Q){function O(j){return function(H){return j==null?void 0:j[H]}}Qe.exports=O},"406g":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingOnSyntax=void 0;var j=O("z4Hk"),H=function(){function X(N){this._binding=N}return X.prototype.onActivation=function(N){return this._binding.onActivation=N,new j.BindingWhenSyntax(this._binding)},X}();Q.BindingOnSyntax=H},"4ZJM":function(Qe,Q,O){(function(j,H){Qe.exports=H()})(this,function(){"use strict";var j,H,X;function N(v,z){if(!j)j=z;else if(!H)H=z;else{var W="var sharedChunk = {}; ("+j+")(sharedChunk); ("+H+")(sharedChunk);",Pe={};j(Pe),X=z(Pe),typeof window!="undefined"&&(X.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}return N(["exports"],function(v){"use strict";function z(s,u){return s(u={exports:{}},u.exports),u.exports}var W=Pe;function Pe(s,u,f,g){this.cx=3*s,this.bx=3*(f-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(g-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=g,this.p2x=f,this.p2y=g}Pe.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},Pe.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},Pe.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},Pe.prototype.solveCurveX=function(s,u){var f,g,b,S,T;for(u===void 0&&(u=1e-6),b=s,T=0;T<8;T++){if(S=this.sampleCurveX(b)-s,Math.abs(S)<u)return b;var R=this.sampleCurveDerivativeX(b);if(Math.abs(R)<1e-6)break;b-=S/R}if((b=s)<(f=0))return f;if(b>(g=1))return g;for(;f<g;){if(S=this.sampleCurveX(b),Math.abs(S-s)<u)return b;s>S?f=b:g=b,b=.5*(g-f)+f}return b},Pe.prototype.solve=function(s,u){return this.sampleCurveY(this.solveCurveX(s,u))};var se=ve;function ve(s,u){this.x=s,this.y=u}ve.prototype={clone:function(){return new ve(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,f){return this.clone()._rotateAround(u,f)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var f=u.x-this.x,g=u.y-this.y;return f*f+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,f){return Math.atan2(this.x*f-this.y*u,this.x*u+this.y*f)},_matMult:function(u){var f=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=f,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var f=Math.cos(u),g=Math.sin(u),b=g*this.x+f*this.y;return this.x=f*this.x-g*this.y,this.y=b,this},_rotateAround:function(u,f){var g=Math.cos(u),b=Math.sin(u),S=f.y+b*(this.x-f.x)+g*(this.y-f.y);return this.x=f.x+g*(this.x-f.x)-b*(this.y-f.y),this.y=S,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ve.convert=function(s){return s instanceof ve?s:Array.isArray(s)?new ve(s[0],s[1]):s};var ue=typeof self!="undefined"?self:{},gt=Math.pow(2,53)-1;function Ne(s,u,f,g){var b=new W(s,u,f,g);return function(S){return b.solve(S)}}var st=Ne(.25,.1,.25,1);function Dt(s,u,f){return Math.min(f,Math.max(u,s))}function pt(s,u,f){var g=f-u,b=((s-u)%g+g)%g+u;return b===u?f:b}function $e(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var g=0,b=u;g<b.length;g+=1){var S=b[g];for(var T in S)s[T]=S[T]}return s}var Ct=1;function et(){return Ct++}function kt(){return function s(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Je(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Xe(s,u){s.forEach(function(f){u[f]&&(u[f]=u[f].bind(u))})}function jr(s,u){return s.indexOf(u,s.length-u.length)!==-1}function Dr(s,u,f){var g={};for(var b in s)g[b]=u.call(f||this,s[b],b,s);return g}function Jt(s,u,f){var g={};for(var b in s)u.call(f||this,s[b],b,s)&&(g[b]=s[b]);return g}function Be(s){return Array.isArray(s)?s.map(Be):typeof s=="object"&&s?Dr(s,Be):s}var Nt={};function Gt(s){Nt[s]||(typeof console!="undefined"&&console.warn(s),Nt[s]=!0)}function Te(s,u,f){return(f.y-s.y)*(u.x-s.x)>(u.y-s.y)*(f.x-s.x)}function me(s){for(var u=0,f=0,g=s.length,b=g-1,S=void 0,T=void 0;f<g;b=f++)u+=((T=s[b]).x-(S=s[f]).x)*(S.y+T.y);return u}function Re(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Ut(s){var u={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(g,b,S,T){var R=S||T;return u[b]=!R||R.toLowerCase(),""}),u["max-age"]){var f=parseInt(u["max-age"],10);isNaN(f)?delete u["max-age"]:u["max-age"]=f}return u}var ae=null;function Ce(s){if(ae==null){var u=s.navigator?s.navigator.userAgent:null;ae=!!s.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return ae}function Ae(s){try{var u=ue[s];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(f){return!1}}var vt,At,Bt,Ft,fr=ue.performance&&ue.performance.now?ue.performance.now.bind(ue.performance):Date.now.bind(Date),Tr=ue.requestAnimationFrame||ue.mozRequestAnimationFrame||ue.webkitRequestAnimationFrame||ue.msRequestAnimationFrame,Br=ue.cancelAnimationFrame||ue.mozCancelAnimationFrame||ue.webkitCancelAnimationFrame||ue.msCancelAnimationFrame,On={now:fr,frame:function(u){var f=Tr(u);return{cancel:function(){return Br(f)}}},getImageData:function(u,f){f===void 0&&(f=0);var g=ue.document.createElement("canvas"),b=g.getContext("2d");if(!b)throw new Error("failed to create canvas 2d context");return g.width=u.width,g.height=u.height,b.drawImage(u,0,0,u.width,u.height),b.getImageData(-f,-f,u.width+2*f,u.height+2*f)},resolveURL:function(u){return vt||(vt=ue.document.createElement("a")),vt.href=u,vt.href},hardwareConcurrency:ue.navigator&&ue.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ue.devicePixelRatio},get prefersReducedMotion(){return!!ue.matchMedia&&(At==null&&(At=ue.matchMedia("(prefers-reduced-motion: reduce)")),At.matches)}},Fr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Hn={supported:!1,testSupport:function(u){!ni&&Ft&&(Yn?ei(u):Bt=u)}},ni=!1,Yn=!1;function ei(s){var u=s.createTexture();s.bindTexture(s.TEXTURE_2D,u);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Ft),s.isContextLost())return;Hn.supported=!0}catch(f){}s.deleteTexture(u),ni=!0}ue.document&&((Ft=ue.document.createElement("img")).onload=function(){Bt&&ei(Bt),Bt=null,Yn=!0},Ft.onerror=function(){ni=!0,Bt=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ci="01",Sr=function(u,f){this._transformRequestFn=u,this._customAccessToken=f,this._createSkuToken()};function _r(s){return s.indexOf("mapbox:")===0}Sr.prototype._createSkuToken=function(){var s=function(){for(var u="",f=0;f<10;f++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ci,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt},Sr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Sr.prototype.transformRequest=function(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}},Sr.prototype.normalizeStyleURL=function(s,u){if(!_r(s))return s;var f=je(s);return f.path="/styles/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},Sr.prototype.normalizeGlyphsURL=function(s,u){if(!_r(s))return s;var f=je(s);return f.path="/fonts/v1"+f.path,this._makeAPIURL(f,this._customAccessToken||u)},Sr.prototype.normalizeSourceURL=function(s,u){if(!_r(s))return s;var f=je(s);return f.path="/v4/"+f.authority+".json",f.params.push("secure"),this._makeAPIURL(f,this._customAccessToken||u)},Sr.prototype.normalizeSpriteURL=function(s,u,f,g){var b=je(s);return _r(s)?(b.path="/styles/v1"+b.path+"/sprite"+u+f,this._makeAPIURL(b,this._customAccessToken||g)):(b.path+=""+u+f,oe(b))},Sr.prototype.normalizeTileURL=function(s,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!_r(s))return s;var f=je(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,(On.devicePixelRatio>=2||u===512?"@2x":"")+(Hn.supported?".webp":"$1")),f.path=f.path.replace(/^.+\/v4\//,"/"),f.path="/v4"+f.path;var g=this._customAccessToken||function(b){for(var S=0,T=b;S<T.length;S+=1){var R=T[S].match(/^access_token=(.*)$/);if(R)return R[1]}return null}(f.params)||Fr.ACCESS_TOKEN;return Fr.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&f.params.push("sku="+this._skuToken),this._makeAPIURL(f,g)},Sr.prototype.canonicalizeTileURL=function(s,u){var f=je(s);if(!f.path.match(/(^\/v4\/)/)||!f.path.match(/\.[\w]+$/))return s;var g="mapbox://tiles/";g+=f.path.replace("/v4/","");var b=f.params;return u&&(b=b.filter(function(S){return!S.match(/^access_token=/)})),b.length&&(g+="?"+b.join("&")),g},Sr.prototype.canonicalizeTileset=function(s,u){for(var f=!!u&&_r(u),g=[],b=0,S=s.tiles||[];b<S.length;b+=1){var T=S[b];Wt(T)?g.push(this.canonicalizeTileURL(T,f)):g.push(T)}return g},Sr.prototype._makeAPIURL=function(s,u){var f="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",g=je(Fr.API_URL);if(s.protocol=g.protocol,s.authority=g.authority,s.protocol==="http"){var b=s.params.indexOf("secure");b>=0&&s.params.splice(b,1)}if(g.path!=="/"&&(s.path=""+g.path+s.path),!Fr.REQUIRE_ACCESS_TOKEN)return oe(s);if(!(u=u||Fr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+f);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+f);return s.params=s.params.filter(function(S){return S.indexOf("access_token")===-1}),s.params.push("access_token="+u),oe(s)};var Kt=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Wt(s){return Kt.test(s)}var Ir=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function je(s){var u=s.match(Ir);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function oe(s){var u=s.params.length?"?"+s.params.join("&"):"";return s.protocol+"://"+s.authority+s.path+u}function ne(s){if(!s)return null;var u=s.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(ue.atob(u[1]).split("").map(function(f){return"%"+("00"+f.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(f){return null}}var D=function(u){this.type=u,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};D.prototype.getStorageKey=function(s){var u,f=ne(Fr.ACCESS_TOKEN);return u=f&&f.u?ue.btoa(encodeURIComponent(f.u).replace(/%([0-9A-F]{2})/g,function(g,b){return String.fromCharCode(Number("0x"+b))})):Fr.ACCESS_TOKEN||"",s?"mapbox.eventData."+s+":"+u:"mapbox.eventData:"+u},D.prototype.fetchEventData=function(){var s=Ae("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{var g=ue.localStorage.getItem(u);g&&(this.eventData=JSON.parse(g));var b=ue.localStorage.getItem(f);b&&(this.anonId=b)}catch(S){Gt("Unable to read from LocalStorage")}},D.prototype.saveEventData=function(){var s=Ae("localStorage"),u=this.getStorageKey(),f=this.getStorageKey("uuid");if(s)try{ue.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ue.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(g){Gt("Unable to write to LocalStorage")}},D.prototype.processRequests=function(s){},D.prototype.postEvent=function(s,u,f,g){var b=this;if(Fr.EVENTS_URL){var S=je(Fr.EVENTS_URL);S.params.push("access_token="+(g||Fr.ACCESS_TOKEN||""));var T={event:this.type,created:new Date(s).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:ci,userId:this.anonId},R=u?$e(T,u):T,F={url:oe(S),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=Mi(F,function(V){b.pendingRequest=null,f(V),b.saveEventData(),b.processRequests(g)})}},D.prototype.queueRequest=function(s,u){this.queue.push(s),this.processRequests(u)};var Ee,He,xt=function(s){function u(){s.call(this,"map.load"),this.success={},this.skuToken=""}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(f,g,b,S){this.skuToken=b;var T=!(!S&&!Fr.ACCESS_TOKEN),R=Array.isArray(f)&&f.some(function(F){return _r(F)||Wt(F)});Fr.EVENTS_URL&&T&&R&&this.queueRequest({id:g,timestamp:Date.now()},S)},u.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){var b=this.queue.shift(),S=b.id,T=b.timestamp;S&&this.success[S]||(this.anonId||this.fetchEventData(),Je(this.anonId)||(this.anonId=kt()),this.postEvent(T,{skuToken:this.skuToken},function(R){R||S&&(g.success[S]=!0)},f))}},u}(D),er=new(function(s){function u(f){s.call(this,"appUserTurnstile"),this._customAccessToken=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(f,g){Fr.EVENTS_URL&&Fr.ACCESS_TOKEN&&Array.isArray(f)&&f.some(function(b){return _r(b)||Wt(b)})&&this.queueRequest(Date.now(),g)},u.prototype.processRequests=function(f){var g=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var b=ne(Fr.ACCESS_TOKEN),S=b?b.u:Fr.ACCESS_TOKEN,T=S!==this.eventData.tokenU;Je(this.anonId)||(this.anonId=kt(),T=!0);var R=this.queue.shift();if(this.eventData.lastSuccess){var F=new Date(this.eventData.lastSuccess),V=new Date(R),$=(R-this.eventData.lastSuccess)/864e5;T=T||$>=1||$<-1||F.getDate()!==V.getDate()}else T=!0;if(!T)return this.processRequests();this.postEvent(R,{"enabled.telemetry":!1},function(J){J||(g.eventData.lastSuccess=R,g.eventData.tokenU=S)},f)}},u}(D)),ur=er.postTurnstileEvent.bind(er),tt=new xt,It=tt.postMapLoadEvent.bind(tt),or=500,Cr=50;function Or(){ue.caches&&!Ee&&(Ee=ue.caches.open("mapbox-tiles"))}function Nn(s){var u=s.indexOf("?");return u<0?s:s.slice(0,u)}var sn,gn=1/0;function dn(){return sn==null&&(sn=ue.OffscreenCanvas&&new ue.OffscreenCanvas(1,1).getContext("2d")&&typeof ue.createImageBitmap=="function"),sn}var ri={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ri);var mi=function(s){function u(f,g,b){g===401&&Wt(b)&&(f+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),s.call(this,f),this.status=g,this.url=b,this.name=this.constructor.name,this.message=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),ki=Re()?function(){return self.worker&&self.worker.referrer}:function(){return(ue.location.protocol==="blob:"?ue.parent:ue).location.href},Aa,Pa,Co=function(u,f){if(!(/^file:/.test(g=u.url)||/^file:/.test(ki())&&!/^\w+:/.test(g))){if(ue.fetch&&ue.Request&&ue.AbortController&&ue.Request.prototype.hasOwnProperty("signal"))return function(b,S){var T,R=new ue.AbortController,F=new ue.Request(b.url,{method:b.method||"GET",body:b.body,credentials:b.credentials,headers:b.headers,referrer:ki(),signal:R.signal}),V=!1,$=!1,J=(T=F.url).indexOf("sku=")>0&&Wt(T);b.type==="json"&&F.headers.set("Accept","application/json");var re=function(Fe,lt,ct){if(!$){if(Fe&&Fe.message!=="SecurityError"&&Gt(Fe),lt&&ct)return xe(lt);var wt=Date.now();ue.fetch(F).then(function(Ht){if(Ht.ok){var ar=J?Ht.clone():null;return xe(Ht,ar,wt)}return S(new mi(Ht.statusText,Ht.status,b.url))}).catch(function(Ht){Ht.code!==20&&S(new Error(Ht.message))})}},xe=function(Fe,lt,ct){(b.type==="arrayBuffer"?Fe.arrayBuffer():b.type==="json"?Fe.json():Fe.text()).then(function(wt){$||(lt&&ct&&function(Ht,ar,Mr){if(Or(),Ee){var gr={status:ar.status,statusText:ar.statusText,headers:new ue.Headers};ar.headers.forEach(function(fn,Fn){return gr.headers.set(Fn,fn)});var un=Ut(ar.headers.get("Cache-Control")||"");un["no-store"]||(un["max-age"]&&gr.headers.set("Expires",new Date(Mr+1e3*un["max-age"]).toUTCString()),new Date(gr.headers.get("Expires")).getTime()-Mr<42e4||function(fn,Fn){if(He===void 0)try{new Response(new ReadableStream),He=!0}catch($n){He=!1}He?Fn(fn.body):fn.blob().then(Fn)}(ar,function(fn){var Fn=new ue.Response(fn,gr);Or(),Ee&&Ee.then(function($n){return $n.put(Nn(Ht.url),Fn)}).catch(function($n){return Gt($n.message)})}))}}(F,lt,ct),V=!0,S(null,wt,Fe.headers.get("Cache-Control"),Fe.headers.get("Expires")))}).catch(function(wt){$||S(new Error(wt.message))})};return J?function(ze,Fe){if(Or(),!Ee)return Fe(null);var lt=Nn(ze.url);Ee.then(function(ct){ct.match(lt).then(function(wt){var Ht=function(ar){if(!ar)return!1;var Mr=new Date(ar.headers.get("Expires")||0),gr=Ut(ar.headers.get("Cache-Control")||"");return Mr>Date.now()&&!gr["no-cache"]}(wt);ct.delete(lt),Ht&&ct.put(lt,wt.clone()),Fe(null,wt,Ht)}).catch(Fe)}).catch(Fe)}(F,re):re(null,null),{cancel:function(){$=!0,V||R.abort()}}}(u,f);if(Re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,f,void 0,!0)}var g;return function(b,S){var T=new ue.XMLHttpRequest;for(var R in T.open(b.method||"GET",b.url,!0),b.type==="arrayBuffer"&&(T.responseType="arraybuffer"),b.headers)T.setRequestHeader(R,b.headers[R]);return b.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=b.credentials==="include",T.onerror=function(){S(new Error(T.statusText))},T.onload=function(){if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){var F=T.response;if(b.type==="json")try{F=JSON.parse(T.response)}catch(V){return S(V)}S(null,F,T.getResponseHeader("Cache-Control"),T.getResponseHeader("Expires"))}else S(new mi(T.statusText,T.status,b.url))},T.send(b.body),{cancel:function(){return T.abort()}}}(u,f)},yo=function(u,f){return Co($e(u,{type:"arrayBuffer"}),f)},Mi=function(u,f){return Co($e(u,{method:"POST"}),f)},te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Aa=[],Pa=0;var K=function s(u,f){if(Hn.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Pa>=Fr.MAX_PARALLEL_IMAGE_REQUESTS){var g={requestParameters:u,callback:f,cancelled:!1,cancel:function(){this.cancelled=!0}};return Aa.push(g),g}Pa++;var b=!1,S=function(){if(!b)for(b=!0,Pa--;Aa.length&&Pa<Fr.MAX_PARALLEL_IMAGE_REQUESTS;){var F=Aa.shift();F.cancelled||(F.cancel=s(F.requestParameters,F.callback).cancel)}},T=yo(u,function(R,F,V,$){S(),R?f(R):F&&(dn()?function(J,re){var xe=new ue.Blob([new Uint8Array(J)],{type:"image/png"});ue.createImageBitmap(xe).then(function(ze){re(null,ze)}).catch(function(ze){re(new Error("Could not load image because of "+ze.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(F,f):function(J,re,xe,ze){var Fe=new ue.Image,lt=ue.URL;Fe.onload=function(){re(null,Fe),lt.revokeObjectURL(Fe.src),Fe.onload=null,ue.requestAnimationFrame(function(){Fe.src=te})},Fe.onerror=function(){return re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ct=new ue.Blob([new Uint8Array(J)],{type:"image/png"});Fe.cacheControl=xe,Fe.expires=ze,Fe.src=J.byteLength?lt.createObjectURL(ct):te}(F,f,V,$))});return{cancel:function(){T.cancel(),S()}}};function fe(s,u,f){f[s]&&f[s].indexOf(u)!==-1||(f[s]=f[s]||[],f[s].push(u))}function Se(s,u,f){if(f&&f[s]){var g=f[s].indexOf(u);g!==-1&&f[s].splice(g,1)}}var Le=function(u,f){f===void 0&&(f={}),$e(this,f),this.type=u},mt=function(s){function u(f,g){g===void 0&&(g={}),s.call(this,"error",$e({error:f},g))}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Le),St=function(){};St.prototype.on=function(s,u){return this._listeners=this._listeners||{},fe(s,u,this._listeners),this},St.prototype.off=function(s,u){return Se(s,u,this._listeners),Se(s,u,this._oneTimeListeners),this},St.prototype.once=function(s,u){return this._oneTimeListeners=this._oneTimeListeners||{},fe(s,u,this._oneTimeListeners),this},St.prototype.fire=function(s,u){typeof s=="string"&&(s=new Le(s,u||{}));var f=s.type;if(this.listens(f)){s.target=this;for(var g=0,b=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];g<b.length;g+=1)b[g].call(this,s);for(var S=0,T=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];S<T.length;S+=1){var R=T[S];Se(f,R,this._oneTimeListeners),R.call(this,s)}var F=this._eventedParent;F&&($e(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),F.fire(s))}else s instanceof mt&&console.error(s.error);return this},St.prototype.listens=function(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)},St.prototype.setEventedParent=function(s,u){return this._eventedParent=s,this._eventedParentData=u,this};var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ye=function(u,f,g,b){this.message=(u?u+": ":"")+g,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)};function zt(s){var u=s.value;return u?[new Ye(s.key,u,"constants have been deprecated as of v8")]:[]}function Rr(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];for(var g=0,b=u;g<b.length;g+=1){var S=b[g];for(var T in S)s[T]=S[T]}return s}function Nr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function pr(s){if(Array.isArray(s))return s.map(pr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){var u={};for(var f in s)u[f]=pr(s[f]);return u}return Nr(s)}var Wr=function(s){function u(f,g){s.call(this,g),this.message=g,this.key=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(Error),Gn=function(u,f){f===void 0&&(f=[]),this.parent=u,this.bindings={};for(var g=0,b=f;g<b.length;g+=1){var S=b[g];this.bindings[S[0]]=S[1]}};Gn.prototype.concat=function(s){return new Gn(this,s)},Gn.prototype.get=function(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(s+" not found in scope.")},Gn.prototype.has=function(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)};var wn={kind:"null"},dr={kind:"number"},Sn={kind:"string"},bn={kind:"boolean"},we={kind:"color"},Kn={kind:"object"},xn={kind:"value"},Vi={kind:"collator"},ia={kind:"formatted"},bi={kind:"resolvedImage"};function ta(s,u){return{kind:"array",itemType:s,N:u}}function Ni(s){if(s.kind==="array"){var u=Ni(s.itemType);return typeof s.N=="number"?"array<"+u+", "+s.N+">":s.itemType.kind==="value"?"array":"array<"+u+">"}return s.kind}var ns=[wn,dr,Sn,bn,we,ia,Kn,ta(xn),bi];function wi(s,u){if(u.kind==="error")return null;if(s.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!wi(s.itemType,u.itemType))&&(typeof s.N!="number"||s.N===u.N))return null}else{if(s.kind===u.kind)return null;if(s.kind==="value"){for(var f=0,g=ns;f<g.length;f+=1)if(!wi(g[f],u))return null}}return"Expected "+Ni(s)+" but found "+Ni(u)+" instead."}function Xa(s,u){return u.some(function(f){return f.kind===s.kind})}function Hi(s,u){return u.some(function(f){return f==="null"?s===null:f==="array"?Array.isArray(s):f==="object"?s&&!Array.isArray(s)&&typeof s=="object":f===typeof s})}var Zi=z(function(s,u){var f={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function g(R){return(R=Math.round(R))<0?0:R>255?255:R}function b(R){return g(R[R.length-1]==="%"?parseFloat(R)/100*255:parseInt(R))}function S(R){return(F=R[R.length-1]==="%"?parseFloat(R)/100:parseFloat(R))<0?0:F>1?1:F;var F}function T(R,F,V){return V<0?V+=1:V>1&&(V-=1),6*V<1?R+(F-R)*V*6:2*V<1?F:3*V<2?R+(F-R)*(2/3-V)*6:R}try{u.parseCSSColor=function(R){var F,V=R.replace(/ /g,"").toLowerCase();if(V in f)return f[V].slice();if(V[0]==="#")return V.length===4?(F=parseInt(V.substr(1),16))>=0&&F<=4095?[(3840&F)>>4|(3840&F)>>8,240&F|(240&F)>>4,15&F|(15&F)<<4,1]:null:V.length===7&&(F=parseInt(V.substr(1),16))>=0&&F<=16777215?[(16711680&F)>>16,(65280&F)>>8,255&F,1]:null;var $=V.indexOf("("),J=V.indexOf(")");if($!==-1&&J+1===V.length){var re=V.substr(0,$),xe=V.substr($+1,J-($+1)).split(","),ze=1;switch(re){case"rgba":if(xe.length!==4)return null;ze=S(xe.pop());case"rgb":return xe.length!==3?null:[b(xe[0]),b(xe[1]),b(xe[2]),ze];case"hsla":if(xe.length!==4)return null;ze=S(xe.pop());case"hsl":if(xe.length!==3)return null;var Fe=(parseFloat(xe[0])%360+360)%360/360,lt=S(xe[1]),ct=S(xe[2]),wt=ct<=.5?ct*(lt+1):ct+lt-ct*lt,Ht=2*ct-wt;return[g(255*T(Ht,wt,Fe+1/3)),g(255*T(Ht,wt,Fe)),g(255*T(Ht,wt,Fe-1/3)),ze];default:return null}}return null}}catch(R){}}).parseCSSColor,gi=function(u,f,g,b){b===void 0&&(b=1),this.r=u,this.g=f,this.b=g,this.a=b};gi.parse=function(s){if(s){if(s instanceof gi)return s;if(typeof s=="string"){var u=Zi(s);if(u)return new gi(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},gi.prototype.toString=function(){var s=this.toArray(),u=s[1],f=s[2],g=s[3];return"rgba("+Math.round(s[0])+","+Math.round(u)+","+Math.round(f)+","+g+")"},gi.prototype.toArray=function(){var s=this.a;return s===0?[0,0,0,0]:[255*this.r/s,255*this.g/s,255*this.b/s,s]},gi.black=new gi(0,0,0,1),gi.white=new gi(1,1,1,1),gi.transparent=new gi(0,0,0,0),gi.red=new gi(1,0,0,1);var eo=function(u,f,g){this.sensitivity=u?f?"variant":"case":f?"accent":"base",this.locale=g,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};eo.prototype.compare=function(s,u){return this.collator.compare(s,u)},eo.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Fs=function(u,f,g,b,S){this.text=u,this.image=f,this.scale=g,this.fontStack=b,this.textColor=S},_o=function(u){this.sections=u};_o.fromString=function(s){return new _o([new Fs(s,null,null,null,null)])},_o.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(s){return s.text.length!==0||s.image&&s.image.name.length!==0})},_o.factory=function(s){return s instanceof _o?s:_o.fromString(s)},_o.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(s){return s.text}).join("")},_o.prototype.serialize=function(){for(var s=["format"],u=0,f=this.sections;u<f.length;u+=1){var g=f[u];if(g.image)s.push(["image",g.image.name]);else{s.push(g.text);var b={};g.fontStack&&(b["text-font"]=["literal",g.fontStack.split(",")]),g.scale&&(b["font-scale"]=g.scale),g.textColor&&(b["text-color"]=["rgba"].concat(g.textColor.toArray())),s.push(b)}}return s};var ms=function(u){this.name=u.name,this.available=u.available};function oc(s,u,f,g){return typeof s=="number"&&s>=0&&s<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof f=="number"&&f>=0&&f<=255?g===void 0||typeof g=="number"&&g>=0&&g<=1?null:"Invalid rgba value ["+[s,u,f,g].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof g=="number"?[s,u,f,g]:[s,u,f]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function wo(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof gi||s instanceof eo||s instanceof _o||s instanceof ms)return!0;if(Array.isArray(s)){for(var u=0,f=s;u<f.length;u+=1)if(!wo(f[u]))return!1;return!0}if(typeof s=="object"){for(var g in s)if(!wo(s[g]))return!1;return!0}return!1}function Ia(s){if(s===null)return wn;if(typeof s=="string")return Sn;if(typeof s=="boolean")return bn;if(typeof s=="number")return dr;if(s instanceof gi)return we;if(s instanceof eo)return Vi;if(s instanceof _o)return ia;if(s instanceof ms)return bi;if(Array.isArray(s)){for(var u,f=s.length,g=0,b=s;g<b.length;g+=1){var S=Ia(b[g]);if(u){if(u===S)continue;u=xn;break}u=S}return ta(u||xn,f)}return Kn}function Ol(s){var u=typeof s;return s===null?"":u==="string"||u==="number"||u==="boolean"?String(s):s instanceof gi||s instanceof _o||s instanceof ms?s.toString():JSON.stringify(s)}ms.prototype.toString=function(){return this.name},ms.fromString=function(s){return s?new ms({name:s,available:!1}):null},ms.prototype.serialize=function(){return["image",this.name]};var Zo=function(u,f){this.type=u,this.value=f};Zo.parse=function(s,u){if(s.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(!wo(s[1]))return u.error("invalid value");var f=s[1],g=Ia(f),b=u.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Zo(g,f)},Zo.prototype.evaluate=function(){return this.value},Zo.prototype.eachChild=function(){},Zo.prototype.outputDefined=function(){return!0},Zo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof gi?["rgba"].concat(this.value.toArray()):this.value instanceof _o?this.value.serialize():this.value};var Na=function(u){this.name="ExpressionEvaluationError",this.message=u};Na.prototype.toJSON=function(){return this.message};var ao={string:Sn,number:dr,boolean:bn,object:Kn},Ta=function(u,f){this.type=u,this.args=f};Ta.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f,g=1,b=s[0];if(b==="array"){var S,T;if(s.length>2){var R=s[1];if(typeof R!="string"||!(R in ao)||R==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);S=ao[R],g++}else S=xn;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return u.error('The length argument to "array" must be a positive integer literal',2);T=s[2],g++}f=ta(S,T)}else f=ao[b];for(var F=[];g<s.length;g++){var V=u.parse(s[g],g,xn);if(!V)return null;F.push(V)}return new Ta(f,F)},Ta.prototype.evaluate=function(s){for(var u=0;u<this.args.length;u++){var f=this.args[u].evaluate(s);if(!wi(this.type,Ia(f)))return f;if(u===this.args.length-1)throw new Na("Expected value to be of type "+Ni(this.type)+", but found "+Ni(Ia(f))+" instead.")}return null},Ta.prototype.eachChild=function(s){this.args.forEach(s)},Ta.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Ta.prototype.serialize=function(){var s=this.type,u=[s.kind];if(s.kind==="array"){var f=s.itemType;if(f.kind==="string"||f.kind==="number"||f.kind==="boolean"){u.push(f.kind);var g=s.N;(typeof g=="number"||this.args.length>1)&&u.push(g)}}return u.concat(this.args.map(function(b){return b.serialize()}))};var Do=function(u){this.type=ia,this.sections=u};Do.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f=s[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");for(var g=[],b=!1,S=1;S<=s.length-1;++S){var T=s[S];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;var R=null;if(T["font-scale"]&&!(R=u.parse(T["font-scale"],1,dr)))return null;var F=null;if(T["text-font"]&&!(F=u.parse(T["text-font"],1,ta(Sn))))return null;var V=null;if(T["text-color"]&&!(V=u.parse(T["text-color"],1,we)))return null;var $=g[g.length-1];$.scale=R,$.font=F,$.textColor=V}else{var J=u.parse(s[S],1,xn);if(!J)return null;var re=J.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:J,scale:null,font:null,textColor:null})}}return new Do(g)},Do.prototype.evaluate=function(s){return new _o(this.sections.map(function(u){var f=u.content.evaluate(s);return Ia(f)===bi?new Fs("",f,null,null,null):new Fs(Ol(f),null,u.scale?u.scale.evaluate(s):null,u.font?u.font.evaluate(s).join(","):null,u.textColor?u.textColor.evaluate(s):null)}))},Do.prototype.eachChild=function(s){for(var u=0,f=this.sections;u<f.length;u+=1){var g=f[u];s(g.content),g.scale&&s(g.scale),g.font&&s(g.font),g.textColor&&s(g.textColor)}},Do.prototype.outputDefined=function(){return!1},Do.prototype.serialize=function(){for(var s=["format"],u=0,f=this.sections;u<f.length;u+=1){var g=f[u];s.push(g.content.serialize());var b={};g.scale&&(b["font-scale"]=g.scale.serialize()),g.font&&(b["text-font"]=g.font.serialize()),g.textColor&&(b["text-color"]=g.textColor.serialize()),s.push(b)}return s};var $o=function(u){this.type=bi,this.input=u};$o.parse=function(s,u){if(s.length!==2)return u.error("Expected two arguments.");var f=u.parse(s[1],1,Sn);return f?new $o(f):u.error("No image name provided.")},$o.prototype.evaluate=function(s){var u=this.input.evaluate(s),f=ms.fromString(u);return f&&s.availableImages&&(f.available=s.availableImages.indexOf(u)>-1),f},$o.prototype.eachChild=function(s){s(this.input)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){return["image",this.input.serialize()]};var kc={"to-boolean":bn,"to-color":we,"to-number":dr,"to-string":Sn},Bs=function(u,f){this.type=u,this.args=f};Bs.parse=function(s,u){if(s.length<2)return u.error("Expected at least one argument.");var f=s[0];if((f==="to-boolean"||f==="to-string")&&s.length!==2)return u.error("Expected one argument.");for(var g=kc[f],b=[],S=1;S<s.length;S++){var T=u.parse(s[S],S,xn);if(!T)return null;b.push(T)}return new Bs(g,b)},Bs.prototype.evaluate=function(s){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(s));if(this.type.kind==="color"){for(var u,f,g=0,b=this.args;g<b.length;g+=1){if(f=null,(u=b[g].evaluate(s))instanceof gi)return u;if(typeof u=="string"){var S=s.parseColor(u);if(S)return S}else if(Array.isArray(u)&&!(f=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":oc(u[0],u[1],u[2],u[3])))return new gi(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new Na(f||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var T=null,R=0,F=this.args;R<F.length;R+=1){if((T=F[R].evaluate(s))===null)return 0;var V=Number(T);if(!isNaN(V))return V}throw new Na("Could not convert "+JSON.stringify(T)+" to number.")}return this.type.kind==="formatted"?_o.fromString(Ol(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?ms.fromString(Ol(this.args[0].evaluate(s))):Ol(this.args[0].evaluate(s))},Bs.prototype.eachChild=function(s){this.args.forEach(s)},Bs.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Bs.prototype.serialize=function(){if(this.type.kind==="formatted")return new Do([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $o(this.args[0]).serialize();var s=["to-"+this.type.kind];return this.eachChild(function(u){s.push(u.serialize())}),s};var Dh=["Unknown","Point","LineString","Polygon"],Fo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Fo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Fo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Dh[this.feature.type]:this.feature.type:null},Fo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Fo.prototype.canonicalID=function(){return this.canonical},Fo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Fo.prototype.parseColor=function(s){var u=this._parseColorCache[s];return u||(u=this._parseColorCache[s]=gi.parse(s)),u};var _a=function(u,f,g,b){this.name=u,this.type=f,this._evaluate=g,this.args=b};_a.prototype.evaluate=function(s){return this._evaluate(s,this.args)},_a.prototype.eachChild=function(s){this.args.forEach(s)},_a.prototype.outputDefined=function(){return!1},_a.prototype.serialize=function(){return[this.name].concat(this.args.map(function(s){return s.serialize()}))},_a.parse=function(s,u){var f,g=s[0],b=_a.definitions[g];if(!b)return u.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0);for(var S=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,R=T.filter(function(Un){var In=Un[0];return!Array.isArray(In)||In.length===s.length-1}),F=null,V=0,$=R;V<$.length;V+=1){var J=$[V],re=J[0],xe=J[1];F=new Pl(u.registry,u.path,null,u.scope);for(var ze=[],Fe=!1,lt=1;lt<s.length;lt++){var ct=s[lt],wt=Array.isArray(re)?re[lt-1]:re.type,Ht=F.parse(ct,1+ze.length,wt);if(!Ht){Fe=!0;break}ze.push(Ht)}if(!Fe)if(Array.isArray(re)&&re.length!==ze.length)F.error("Expected "+re.length+" arguments, but found "+ze.length+" instead.");else{for(var ar=0;ar<ze.length;ar++){var Mr=Array.isArray(re)?re[ar]:re.type,gr=ze[ar];F.concat(ar+1).checkSubtype(Mr,gr.type)}if(F.errors.length===0)return new _a(g,S,xe,ze)}}if(R.length===1)(f=u.errors).push.apply(f,F.errors);else{for(var un=(R.length?R:T).map(function(Un){var In;return In=Un[0],Array.isArray(In)?"("+In.map(Ni).join(", ")+")":"("+Ni(In.type)+"...)"}).join(" | "),fn=[],Fn=1;Fn<s.length;Fn++){var $n=u.parse(s[Fn],1+fn.length);if(!$n)return null;fn.push(Ni($n.type))}u.error("Expected arguments of type "+un+", but found ("+fn.join(", ")+") instead.")}return null},_a.register=function(s,u){for(var f in _a.definitions=u,u)s[f]=_a};var ft=function(u,f,g){this.type=Vi,this.locale=g,this.caseSensitive=u,this.diacriticSensitive=f};function le(s,u){s[0]=Math.min(s[0],u[0]),s[1]=Math.min(s[1],u[1]),s[2]=Math.max(s[2],u[0]),s[3]=Math.max(s[3],u[1])}function Ze(s,u){return!(s[0]<=u[0]||s[2]>=u[2]||s[1]<=u[1]||s[3]>=u[3])}function sr(s,u){var f=(180+s[0])/360,g=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,b=Math.pow(2,u.z);return[Math.round(f*b*8192),Math.round(g*b*8192)]}function rn(s,u,f){return u[1]>s[1]!=f[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]}function Pn(s,u){for(var f,g,b,S,T,R,F,V=!1,$=0,J=u.length;$<J;$++)for(var re=u[$],xe=0,ze=re.length;xe<ze-1;xe++){if((S=(f=s)[0]-(g=re[xe])[0])*(F=f[1]-(b=re[xe+1])[1])-(R=f[0]-b[0])*(T=f[1]-g[1])==0&&S*R<=0&&T*F<=0)return!1;rn(s,re[xe],re[xe+1])&&(V=!V)}return V}function ji(s,u){for(var f=0;f<u.length;f++)if(Pn(s,u[f]))return!0;return!1}function Za(s,u,f,g){var b=g[0]-f[0],S=g[1]-f[1],T=(s[0]-f[0])*S-b*(s[1]-f[1]),R=(u[0]-f[0])*S-b*(u[1]-f[1]);return T>0&&R<0||T<0&&R>0}function Oo(s,u,f){for(var g=0,b=f;g<b.length;g+=1)for(var S=b[g],T=0;T<S.length-1;++T)if((J=[($=S[T+1])[0]-(V=S[T])[0],$[1]-V[1]])[0]*(re=[(F=u)[0]-(R=s)[0],F[1]-R[1]])[1]-J[1]*re[0]!=0&&Za(R,F,V,$)&&Za(V,$,R,F))return!0;var R,F,V,$,J,re;return!1}function gs(s,u){for(var f=0;f<s.length;++f)if(!Pn(s[f],u))return!1;for(var g=0;g<s.length-1;++g)if(Oo(s[g],s[g+1],u))return!1;return!0}function Ls(s,u){for(var f=0;f<u.length;f++)if(gs(s,u[f]))return!0;return!1}function df(s,u,f){for(var g=[],b=0;b<s.length;b++){for(var S=[],T=0;T<s[b].length;T++){var R=sr(s[b][T],f);le(u,R),S.push(R)}g.push(S)}return g}function gp(s,u,f){for(var g=[],b=0;b<s.length;b++){var S=df(s[b],u,f);g.push(S)}return g}function Dc(s,u,f,g){if(s[0]<f[0]||s[0]>f[2]){var b=.5*g,S=s[0]-f[0]>b?-g:f[0]-s[0]>b?g:0;S===0&&(S=s[0]-f[2]>b?-g:f[2]-s[0]>b?g:0),s[0]+=S}le(u,s)}function dd(s,u,f,g){for(var b=8192*Math.pow(2,g.z),S=[8192*g.x,8192*g.y],T=[],R=0,F=s;R<F.length;R+=1)for(var V=0,$=F[R];V<$.length;V+=1){var J=$[V],re=[J.x+S[0],J.y+S[1]];Dc(re,u,f,b),T.push(re)}return T}function Rl(s,u,f,g){for(var b,S=8192*Math.pow(2,g.z),T=[8192*g.x,8192*g.y],R=[],F=0,V=s;F<V.length;F+=1){for(var $=[],J=0,re=V[F];J<re.length;J+=1){var xe=re[J],ze=[xe.x+T[0],xe.y+T[1]];le(u,ze),$.push(ze)}R.push($)}if(u[2]-u[0]<=S/2){(b=u)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(var Fe=0,lt=R;Fe<lt.length;Fe+=1)for(var ct=0,wt=lt[Fe];ct<wt.length;ct+=1)Dc(wt[ct],u,f,S)}return R}ft.parse=function(s,u){if(s.length!==2)return u.error("Expected one argument.");var f=s[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");var g=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,bn);if(!g)return null;var b=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,bn);if(!b)return null;var S=null;return f.locale&&!(S=u.parse(f.locale,1,Sn))?null:new ft(g,b,S)},ft.prototype.evaluate=function(s){return new eo(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)},ft.prototype.eachChild=function(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)},ft.prototype.outputDefined=function(){return!1},ft.prototype.serialize=function(){var s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]};var ys=function(u,f){this.type=bn,this.geojson=u,this.geometries=f};function Ml(s){if(s instanceof _a&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ys)return!1;var u=!0;return s.eachChild(function(f){u&&!Ml(f)&&(u=!1)}),u}function sc(s){if(s instanceof _a&&s.name==="feature-state")return!1;var u=!0;return s.eachChild(function(f){u&&!sc(f)&&(u=!1)}),u}function Gu(s,u){if(s instanceof _a&&u.indexOf(s.name)>=0)return!1;var f=!0;return s.eachChild(function(g){f&&!Gu(g,u)&&(f=!1)}),f}ys.parse=function(s,u){if(s.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(s.length-1)+" instead.");if(wo(s[1])){var f=s[1];if(f.type==="FeatureCollection")for(var g=0;g<f.features.length;++g){var b=f.features[g].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new ys(f,f.features[g].geometry)}else if(f.type==="Feature"){var S=f.geometry.type;if(S==="Polygon"||S==="MultiPolygon")return new ys(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ys(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ys.prototype.evaluate=function(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(u,f){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(f.type==="Polygon"){var T=df(f.coordinates,b,S),R=dd(u.geometry(),g,b,S);if(!Ze(g,b))return!1;for(var F=0,V=R;F<V.length;F+=1)if(!Pn(V[F],T))return!1}if(f.type==="MultiPolygon"){var $=gp(f.coordinates,b,S),J=dd(u.geometry(),g,b,S);if(!Ze(g,b))return!1;for(var re=0,xe=J;re<xe.length;re+=1)if(!ji(xe[re],$))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(u,f){var g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],S=u.canonicalID();if(f.type==="Polygon"){var T=df(f.coordinates,b,S),R=Rl(u.geometry(),g,b,S);if(!Ze(g,b))return!1;for(var F=0,V=R;F<V.length;F+=1)if(!gs(V[F],T))return!1}if(f.type==="MultiPolygon"){var $=gp(f.coordinates,b,S),J=Rl(u.geometry(),g,b,S);if(!Ze(g,b))return!1;for(var re=0,xe=J;re<xe.length;re+=1)if(!Ls(xe[re],$))return!1}return!0}(s,this.geometries)}return!1},ys.prototype.eachChild=function(){},ys.prototype.outputDefined=function(){return!0},ys.prototype.serialize=function(){return["within",this.geojson]};var sl=function(u,f){this.type=f.type,this.name=u,this.boundExpression=f};sl.parse=function(s,u){if(s.length!==2||typeof s[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var f=s[1];return u.scope.has(f)?new sl(f,u.scope.get(f)):u.error('Unknown variable "'+f+'". Make sure "'+f+'" has been bound in an enclosing "let" expression before using it.',1)},sl.prototype.evaluate=function(s){return this.boundExpression.evaluate(s)},sl.prototype.eachChild=function(){},sl.prototype.outputDefined=function(){return!1},sl.prototype.serialize=function(){return["var",this.name]};var Pl=function(u,f,g,b,S){f===void 0&&(f=[]),b===void 0&&(b=new Gn),S===void 0&&(S=[]),this.registry=u,this.path=f,this.key=f.map(function(T){return"["+T+"]"}).join(""),this.scope=b,this.errors=S,this.expectedType=g};function Yf(s,u){for(var f,g=s.length-1,b=0,S=g,T=0;b<=S;)if((f=s[T=Math.floor((b+S)/2)])<=u){if(T===g||u<s[T+1])return T;b=T+1}else{if(!(f>u))throw new Na("Input is not a number.");S=T-1}return 0}Pl.prototype.parse=function(s,u,f,g,b){return b===void 0&&(b={}),u?this.concat(u,f,g)._parse(s,b):this._parse(s,b)},Pl.prototype._parse=function(s,u){function f(V,$,J){return J==="assert"?new Ta($,[V]):J==="coerce"?new Bs($,[V]):V}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var g=s[0];if(typeof g!="string")return this.error("Expression name must be a string, but found "+typeof g+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var b=this.registry[g];if(b){var S=b.parse(s,this);if(!S)return null;if(this.expectedType){var T=this.expectedType,R=S.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||R.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(T,R))return null}else S=f(S,T,u.typeAnnotation||"coerce");else S=f(S,T,u.typeAnnotation||"assert")}if(!(S instanceof Zo)&&S.type.kind!=="resolvedImage"&&function V($){if($ instanceof sl)return V($.boundExpression);if($ instanceof _a&&$.name==="error"||$ instanceof ft||$ instanceof ys)return!1;var J=$ instanceof Bs||$ instanceof Ta,re=!0;return $.eachChild(function(xe){re=J?re&&V(xe):re&&xe instanceof Zo}),!!re&&Ml($)&&Gu($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(S)){var F=new Fo;try{S=new Zo(S.type,S.evaluate(F))}catch(V){return this.error(V.message),null}}return S}return this.error('Unknown expression "'+g+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof s+" instead.")},Pl.prototype.concat=function(s,u,f){var g=typeof s=="number"?this.path.concat(s):this.path,b=f?this.scope.concat(f):this.scope;return new Pl(this.registry,g,u||null,b,this.errors)},Pl.prototype.error=function(s){for(var u=[],f=arguments.length-1;f-- >0;)u[f]=arguments[f+1];var g=""+this.key+u.map(function(b){return"["+b+"]"}).join("");this.errors.push(new Wr(g,s))},Pl.prototype.checkSubtype=function(s,u){var f=wi(s,u);return f&&this.error(f),f};var Rt=function(u,f,g){this.type=u,this.input=f,this.labels=[],this.outputs=[];for(var b=0,S=g;b<S.length;b+=1){var T=S[b],R=T[1];this.labels.push(T[0]),this.outputs.push(R)}};function Et(s,u,f){return s*(1-f)+u*f}Rt.parse=function(s,u){if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");var f=u.parse(s[1],1,dr);if(!f)return null;var g=[],b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(var S=1;S<s.length;S+=2){var T=S===1?-1/0:s[S],R=s[S+1],F=S,V=S+1;if(typeof T!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(g.length&&g[g.length-1][0]>=T)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);var $=u.parse(R,V,b);if(!$)return null;b=b||$.type,g.push([T,$])}return new Rt(b,f,g)},Rt.prototype.evaluate=function(s){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);var b=u.length;return g>=u[b-1]?f[b-1].evaluate(s):f[Yf(u,g)].evaluate(s)},Rt.prototype.eachChild=function(s){s(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)s(f[u])},Rt.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},Rt.prototype.serialize=function(){for(var s=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&s.push(this.labels[u]),s.push(this.outputs[u].serialize());return s};var qr=Object.freeze({__proto__:null,number:Et,color:function(u,f,g){return new gi(Et(u.r,f.r,g),Et(u.g,f.g,g),Et(u.b,f.b,g),Et(u.a,f.a,g))},array:function(u,f,g){return u.map(function(b,S){return Et(b,f[S],g)})}}),Zr=6/29*3*(6/29),ut=Math.PI/180,Fh=180/Math.PI;function Kf(s){return s>.008856451679035631?Math.pow(s,1/3):s/Zr+4/29}function Bh(s){return s>6/29?s*s*s:Zr*(s-4/29)}function Fc(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function vf(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function mf(s){var u=vf(s.r),f=vf(s.g),g=vf(s.b),b=Kf((.4124564*u+.3575761*f+.1804375*g)/.95047),S=Kf((.2126729*u+.7151522*f+.072175*g)/1);return{l:116*S-16,a:500*(b-S),b:200*(S-Kf((.0193339*u+.119192*f+.9503041*g)/1.08883)),alpha:s.a}}function yp(s){var u=(s.l+16)/116,f=isNaN(s.a)?u:u+s.a/500,g=isNaN(s.b)?u:u-s.b/200;return u=1*Bh(u),f=.95047*Bh(f),g=1.08883*Bh(g),new gi(Fc(3.2404542*f-1.5371385*u-.4985314*g),Fc(-.969266*f+1.8760108*u+.041556*g),Fc(.0556434*f-.2040259*u+1.0572252*g),s.alpha)}function vd(s,u,f){var g=u-s;return s+f*(g>180||g<-180?g-360*Math.round(g/360):g)}var uc={forward:mf,reverse:yp,interpolate:function(u,f,g){return{l:Et(u.l,f.l,g),a:Et(u.a,f.a,g),b:Et(u.b,f.b,g),alpha:Et(u.alpha,f.alpha,g)}}},Xu={forward:function(u){var f=mf(u),g=f.l,b=f.a,S=f.b,T=Math.atan2(S,b)*Fh;return{h:T<0?T+360:T,c:Math.sqrt(b*b+S*S),l:g,alpha:u.a}},reverse:function(u){var f=u.h*ut,g=u.c;return yp({l:u.l,a:Math.cos(f)*g,b:Math.sin(f)*g,alpha:u.alpha})},interpolate:function(u,f,g){return{h:vd(u.h,f.h,g),c:Et(u.c,f.c,g),l:Et(u.l,f.l,g),alpha:Et(u.alpha,f.alpha,g)}}},Lh=Object.freeze({__proto__:null,lab:uc,hcl:Xu}),is=function(u,f,g,b,S){this.type=u,this.operator=f,this.interpolation=g,this.input=b,this.labels=[],this.outputs=[];for(var T=0,R=S;T<R.length;T+=1){var F=R[T],V=F[1];this.labels.push(F[0]),this.outputs.push(V)}};function Zu(s,u,f,g){var b=g-f,S=s-f;return b===0?0:u===1?S/b:(Math.pow(u,S)-1)/(Math.pow(u,b)-1)}is.interpolationFactor=function(s,u,f,g){var b=0;if(s.name==="exponential")b=Zu(u,s.base,f,g);else if(s.name==="linear")b=Zu(u,1,f,g);else if(s.name==="cubic-bezier"){var S=s.controlPoints;b=new W(S[0],S[1],S[2],S[3]).solve(Zu(u,1,f,g))}return b},is.parse=function(s,u){var f=s[0],g=s[1],b=s[2],S=s.slice(3);if(!Array.isArray(g)||g.length===0)return u.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){var T=g[1];if(typeof T!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:T}}else{if(g[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(g[0]),1,0);var R=g.slice(1);if(R.length!==4||R.some(function(lt){return typeof lt!="number"||lt<0||lt>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:R}}if(s.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if((s.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(b=u.parse(b,2,dr)))return null;var F=[],V=null;f==="interpolate-hcl"||f==="interpolate-lab"?V=we:u.expectedType&&u.expectedType.kind!=="value"&&(V=u.expectedType);for(var $=0;$<S.length;$+=2){var J=S[$],re=S[$+1],xe=$+3,ze=$+4;if(typeof J!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(F.length&&F[F.length-1][0]>=J)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);var Fe=u.parse(re,ze,V);if(!Fe)return null;V=V||Fe.type,F.push([J,Fe])}return V.kind==="number"||V.kind==="color"||V.kind==="array"&&V.itemType.kind==="number"&&typeof V.N=="number"?new is(V,f,g,b,F):u.error("Type "+Ni(V)+" is not interpolatable.")},is.prototype.evaluate=function(s){var u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(s);var g=this.input.evaluate(s);if(g<=u[0])return f[0].evaluate(s);var b=u.length;if(g>=u[b-1])return f[b-1].evaluate(s);var S=Yf(u,g),T=is.interpolationFactor(this.interpolation,g,u[S],u[S+1]),R=f[S].evaluate(s),F=f[S+1].evaluate(s);return this.operator==="interpolate"?qr[this.type.kind.toLowerCase()](R,F,T):this.operator==="interpolate-hcl"?Xu.reverse(Xu.interpolate(Xu.forward(R),Xu.forward(F),T)):uc.reverse(uc.interpolate(uc.forward(R),uc.forward(F),T))},is.prototype.eachChild=function(s){s(this.input);for(var u=0,f=this.outputs;u<f.length;u+=1)s(f[u])},is.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})},is.prototype.serialize=function(){var s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,s,this.input.serialize()],f=0;f<this.labels.length;f++)u.push(this.labels[f],this.outputs[f].serialize());return u};var Il=function(u,f){this.type=u,this.args=f};Il.parse=function(s,u){if(s.length<2)return u.error("Expectected at least one argument.");var f=null,g=u.expectedType;g&&g.kind!=="value"&&(f=g);for(var b=[],S=0,T=s.slice(1);S<T.length;S+=1){var R=u.parse(T[S],1+b.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,b.push(R)}var F=g&&b.some(function(V){return wi(g,V.type)});return new Il(F?xn:f,b)},Il.prototype.evaluate=function(s){for(var u,f=null,g=0,b=0,S=this.args;b<S.length&&(g++,(f=S[b].evaluate(s))&&f instanceof ms&&!f.available&&(u||(u=f.name),f=null,g===this.args.length&&(f=u)),f===null);b+=1);return f},Il.prototype.eachChild=function(s){this.args.forEach(s)},Il.prototype.outputDefined=function(){return this.args.every(function(s){return s.outputDefined()})},Il.prototype.serialize=function(){var s=["coalesce"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Ns=function(u,f){this.type=f.type,this.bindings=[].concat(u),this.result=f};Ns.prototype.evaluate=function(s){return this.result.evaluate(s)},Ns.prototype.eachChild=function(s){for(var u=0,f=this.bindings;u<f.length;u+=1)s(f[u][1]);s(this.result)},Ns.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found "+(s.length-1)+" instead.");for(var f=[],g=1;g<s.length-1;g+=2){var b=s[g];if(typeof b!="string")return u.error("Expected string, but found "+typeof b+" instead.",g);if(/[^a-zA-Z0-9_]/.test(b))return u.error("Variable names must contain only alphanumeric characters or '_'.",g);var S=u.parse(s[g+1],g+1);if(!S)return null;f.push([b,S])}var T=u.parse(s[s.length-1],s.length-1,u.expectedType,f);return T?new Ns(f,T):null},Ns.prototype.outputDefined=function(){return this.result.outputDefined()},Ns.prototype.serialize=function(){for(var s=["let"],u=0,f=this.bindings;u<f.length;u+=1){var g=f[u];s.push(g[0],g[1].serialize())}return s.push(this.result.serialize()),s};var lc=function(u,f,g){this.type=u,this.index=f,this.input=g};lc.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,dr),g=u.parse(s[2],2,ta(u.expectedType||xn));return f&&g?new lc(g.type.itemType,f,g):null},lc.prototype.evaluate=function(s){var u=this.index.evaluate(s),f=this.input.evaluate(s);if(u<0)throw new Na("Array index out of bounds: "+u+" < 0.");if(u>=f.length)throw new Na("Array index out of bounds: "+u+" > "+(f.length-1)+".");if(u!==Math.floor(u))throw new Na("Array index must be an integer, but found "+u+" instead.");return f[u]},lc.prototype.eachChild=function(s){s(this.index),s(this.input)},lc.prototype.outputDefined=function(){return!1},lc.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var mu=function(u,f){this.type=bn,this.needle=u,this.haystack=f};mu.parse=function(s,u){if(s.length!==3)return u.error("Expected 2 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,xn),g=u.parse(s[2],2,xn);return f&&g?Xa(f.type,[bn,Sn,dr,wn,xn])?new mu(f,g):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(f.type)+" instead"):null},mu.prototype.evaluate=function(s){var u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!f)return!1;if(!Hi(u,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Ia(u))+" instead.");if(!Hi(f,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Ni(Ia(f))+" instead.");return f.indexOf(u)>=0},mu.prototype.eachChild=function(s){s(this.needle),s(this.haystack)},mu.prototype.outputDefined=function(){return!0},mu.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var kl=function(u,f,g){this.type=dr,this.needle=u,this.haystack=f,this.fromIndex=g};kl.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,xn),g=u.parse(s[2],2,xn);if(!f||!g)return null;if(!Xa(f.type,[bn,Sn,dr,wn,xn]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ni(f.type)+" instead");if(s.length===4){var b=u.parse(s[3],3,dr);return b?new kl(f,g,b):null}return new kl(f,g)},kl.prototype.evaluate=function(s){var u=this.needle.evaluate(s),f=this.haystack.evaluate(s);if(!Hi(u,["boolean","string","number","null"]))throw new Na("Expected first argument to be of type boolean, string, number or null, but found "+Ni(Ia(u))+" instead.");if(!Hi(f,["string","array"]))throw new Na("Expected second argument to be of type array or string, but found "+Ni(Ia(f))+" instead.");if(this.fromIndex){var g=this.fromIndex.evaluate(s);return f.indexOf(u,g)}return f.indexOf(u)},kl.prototype.eachChild=function(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)},kl.prototype.outputDefined=function(){return!1},kl.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Zs=function(u,f,g,b,S,T){this.inputType=u,this.type=f,this.input=g,this.cases=b,this.outputs=S,this.otherwise=T};Zs.parse=function(s,u){if(s.length<5)return u.error("Expected at least 4 arguments, but found only "+(s.length-1)+".");if(s.length%2!=1)return u.error("Expected an even number of arguments.");var f,g;u.expectedType&&u.expectedType.kind!=="value"&&(g=u.expectedType);for(var b={},S=[],T=2;T<s.length-1;T+=2){var R=s[T],F=s[T+1];Array.isArray(R)||(R=[R]);var V=u.concat(T);if(R.length===0)return V.error("Expected at least one branch label.");for(var $=0,J=R;$<J.length;$+=1){var re=J[$];if(typeof re!="number"&&typeof re!="string")return V.error("Branch labels must be numbers or strings.");if(typeof re=="number"&&Math.abs(re)>Number.MAX_SAFE_INTEGER)return V.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof re=="number"&&Math.floor(re)!==re)return V.error("Numeric branch labels must be integer values.");if(f){if(V.checkSubtype(f,Ia(re)))return null}else f=Ia(re);if(b[String(re)]!==void 0)return V.error("Branch labels must be unique.");b[String(re)]=S.length}var xe=u.parse(F,T,g);if(!xe)return null;g=g||xe.type,S.push(xe)}var ze=u.parse(s[1],1,xn);if(!ze)return null;var Fe=u.parse(s[s.length-1],s.length-1,g);return Fe?ze.type.kind!=="value"&&u.concat(1).checkSubtype(f,ze.type)?null:new Zs(f,g,ze,b,S,Fe):null},Zs.prototype.evaluate=function(s){var u=this.input.evaluate(s);return(Ia(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(s)},Zs.prototype.eachChild=function(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)},Zs.prototype.outputDefined=function(){return this.outputs.every(function(s){return s.outputDefined()})&&this.otherwise.outputDefined()},Zs.prototype.serialize=function(){for(var s=this,u=["match",this.input.serialize()],f=[],g={},b=0,S=Object.keys(this.cases).sort();b<S.length;b+=1){var T=S[b];(J=g[this.cases[T]])===void 0?(g[this.cases[T]]=f.length,f.push([this.cases[T],[T]])):f[J][1].push(T)}for(var R=function(ze){return s.inputType.kind==="number"?Number(ze):ze},F=0,V=f;F<V.length;F+=1){var $=V[F],J=$[0],re=$[1];u.push(re.length===1?R(re[0]):re.map(R)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var $u=function(u,f,g){this.type=u,this.branches=f,this.otherwise=g};$u.parse=function(s,u){if(s.length<4)return u.error("Expected at least 3 arguments, but found only "+(s.length-1)+".");if(s.length%2!=0)return u.error("Expected an odd number of arguments.");var f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);for(var g=[],b=1;b<s.length-1;b+=2){var S=u.parse(s[b],b,bn);if(!S)return null;var T=u.parse(s[b+1],b+1,f);if(!T)return null;g.push([S,T]),f=f||T.type}var R=u.parse(s[s.length-1],s.length-1,f);return R?new $u(f,g,R):null},$u.prototype.evaluate=function(s){for(var u=0,f=this.branches;u<f.length;u+=1){var g=f[u],b=g[1];if(g[0].evaluate(s))return b.evaluate(s)}return this.otherwise.evaluate(s)},$u.prototype.eachChild=function(s){for(var u=0,f=this.branches;u<f.length;u+=1){var g=f[u],b=g[1];s(g[0]),s(b)}s(this.otherwise)},$u.prototype.outputDefined=function(){return this.branches.every(function(s){return s[1].outputDefined()})&&this.otherwise.outputDefined()},$u.prototype.serialize=function(){var s=["case"];return this.eachChild(function(u){s.push(u.serialize())}),s};var ul=function(u,f,g,b){this.type=u,this.input=f,this.beginIndex=g,this.endIndex=b};function qf(s,u){return s==="=="||s==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function _p(s,u,f,g){return g.compare(u,f)===0}function ba(s,u,f){var g=s!=="=="&&s!=="!=";return function(){function b(S,T,R){this.type=bn,this.lhs=S,this.rhs=T,this.collator=R,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}return b.parse=function(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");var R=S[0],F=T.parse(S[1],1,xn);if(!F)return null;if(!qf(R,F.type))return T.concat(1).error('"'+R+`" comparisons are not supported for type '`+Ni(F.type)+"'.");var V=T.parse(S[2],2,xn);if(!V)return null;if(!qf(R,V.type))return T.concat(2).error('"'+R+`" comparisons are not supported for type '`+Ni(V.type)+"'.");if(F.type.kind!==V.type.kind&&F.type.kind!=="value"&&V.type.kind!=="value")return T.error("Cannot compare types '"+Ni(F.type)+"' and '"+Ni(V.type)+"'.");g&&(F.type.kind==="value"&&V.type.kind!=="value"?F=new Ta(V.type,[F]):F.type.kind!=="value"&&V.type.kind==="value"&&(V=new Ta(F.type,[V])));var $=null;if(S.length===4){if(F.type.kind!=="string"&&V.type.kind!=="string"&&F.type.kind!=="value"&&V.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(!($=T.parse(S[3],3,Vi)))return null}return new b(F,V,$)},b.prototype.evaluate=function(S){var T=this.lhs.evaluate(S),R=this.rhs.evaluate(S);if(g&&this.hasUntypedArgument){var F=Ia(T),V=Ia(R);if(F.kind!==V.kind||F.kind!=="string"&&F.kind!=="number")throw new Na('Expected arguments for "'+s+'" to be (string, string) or (number, number), but found ('+F.kind+", "+V.kind+") instead.")}if(this.collator&&!g&&this.hasUntypedArgument){var $=Ia(T),J=Ia(R);if($.kind!=="string"||J.kind!=="string")return u(S,T,R)}return this.collator?f(S,T,R,this.collator.evaluate(S)):u(S,T,R)},b.prototype.eachChild=function(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)},b.prototype.outputDefined=function(){return!0},b.prototype.serialize=function(){var S=[s];return this.eachChild(function(T){S.push(T.serialize())}),S},b}()}ul.parse=function(s,u){if(s.length<=2||s.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1,xn),g=u.parse(s[2],2,dr);if(!f||!g)return null;if(!Xa(f.type,[ta(xn),Sn,xn]))return u.error("Expected first argument to be of type array or string, but found "+Ni(f.type)+" instead");if(s.length===4){var b=u.parse(s[3],3,dr);return b?new ul(f.type,f,g,b):null}return new ul(f.type,f,g)},ul.prototype.evaluate=function(s){var u=this.input.evaluate(s),f=this.beginIndex.evaluate(s);if(!Hi(u,["string","array"]))throw new Na("Expected first argument to be of type array or string, but found "+Ni(Ia(u))+" instead.");if(this.endIndex){var g=this.endIndex.evaluate(s);return u.slice(f,g)}return u.slice(f)},ul.prototype.eachChild=function(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)},ul.prototype.outputDefined=function(){return!1},ul.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Qf=ba("==",function(s,u,f){return u===f},_p),gf=ba("!=",function(s,u,f){return u!==f},function(s,u,f,g){return!_p(0,u,f,g)}),yf=ba("<",function(s,u,f){return u<f},function(s,u,f,g){return g.compare(u,f)<0}),oo=ba(">",function(s,u,f){return u>f},function(s,u,f,g){return g.compare(u,f)>0}),cc=ba("<=",function(s,u,f){return u<=f},function(s,u,f,g){return g.compare(u,f)<=0}),Bc=ba(">=",function(s,u,f){return u>=f},function(s,u,f,g){return g.compare(u,f)>=0}),as=function(u,f,g,b,S){this.type=Sn,this.number=u,this.locale=f,this.currency=g,this.minFractionDigits=b,this.maxFractionDigits=S};as.parse=function(s,u){if(s.length!==3)return u.error("Expected two arguments.");var f=u.parse(s[1],1,dr);if(!f)return null;var g=s[2];if(typeof g!="object"||Array.isArray(g))return u.error("NumberFormat options argument must be an object.");var b=null;if(g.locale&&!(b=u.parse(g.locale,1,Sn)))return null;var S=null;if(g.currency&&!(S=u.parse(g.currency,1,Sn)))return null;var T=null;if(g["min-fraction-digits"]&&!(T=u.parse(g["min-fraction-digits"],1,dr)))return null;var R=null;return g["max-fraction-digits"]&&!(R=u.parse(g["max-fraction-digits"],1,dr))?null:new as(f,b,S,T,R)},as.prototype.evaluate=function(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))},as.prototype.eachChild=function(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)},as.prototype.outputDefined=function(){return!1},as.prototype.serialize=function(){var s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]};var $s=function(u){this.type=dr,this.input=u};$s.parse=function(s,u){if(s.length!==2)return u.error("Expected 1 argument, but found "+(s.length-1)+" instead.");var f=u.parse(s[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ni(f.type)+" instead."):new $s(f):null},$s.prototype.evaluate=function(s){var u=this.input.evaluate(s);if(typeof u=="string"||Array.isArray(u))return u.length;throw new Na("Expected value to be of type string or array, but found "+Ni(Ia(u))+" instead.")},$s.prototype.eachChild=function(s){s(this.input)},$s.prototype.outputDefined=function(){return!1},$s.prototype.serialize=function(){var s=["length"];return this.eachChild(function(u){s.push(u.serialize())}),s};var Ys={"==":Qf,"!=":gf,">":oo,"<":yf,">=":Bc,"<=":cc,array:Ta,at:lc,boolean:Ta,case:$u,coalesce:Il,collator:ft,format:Do,image:$o,in:mu,"index-of":kl,interpolate:is,"interpolate-hcl":is,"interpolate-lab":is,length:$s,let:Ns,literal:Zo,match:Zs,number:Ta,"number-format":as,object:Ta,slice:ul,step:Rt,string:Ta,"to-boolean":Bs,"to-color":Bs,"to-number":Bs,"to-string":Bs,var:sl,within:ys};function _s(s,u){var f=u[0],g=u[1],b=u[2],S=u[3];f=f.evaluate(s),g=g.evaluate(s),b=b.evaluate(s);var T=S?S.evaluate(s):1,R=oc(f,g,b,T);if(R)throw new Na(R);return new gi(f/255*T,g/255*T,b/255*T,T)}function Jf(s,u){return s in u}function Lc(s,u){var f=u[s];return f===void 0?null:f}function Ou(s){return{type:s}}function _f(s){return{result:"success",value:s}}function Dl(s){return{result:"error",value:s}}function ll(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function Nh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Nc(s){return!!s.expression&&s.expression.interpolated}function ka(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function eh(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function bp(s){return s}function Ks(s,u,f){return s!==void 0?s:u!==void 0?u:f!==void 0?f:void 0}function jc(s,u,f,g,b){return Ks(typeof f===b?g[f]:void 0,s.default,u.default)}function zc(s,u,f){if(ka(f)!=="number")return Ks(s.default,u.default);var g=s.stops.length;if(g===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[g-1][0])return s.stops[g-1][1];var b=Yf(s.stops.map(function(S){return S[0]}),f);return s.stops[b][1]}function th(s,u,f){var g=s.base!==void 0?s.base:1;if(ka(f)!=="number")return Ks(s.default,u.default);var b=s.stops.length;if(b===1||f<=s.stops[0][0])return s.stops[0][1];if(f>=s.stops[b-1][0])return s.stops[b-1][1];var S=Yf(s.stops.map(function(J){return J[0]}),f),T=function(J,re,xe,ze){var Fe=ze-xe,lt=J-xe;return Fe===0?0:re===1?lt/Fe:(Math.pow(re,lt)-1)/(Math.pow(re,Fe)-1)}(f,g,s.stops[S][0],s.stops[S+1][0]),R=s.stops[S][1],F=s.stops[S+1][1],V=qr[u.type]||bp;if(s.colorSpace&&s.colorSpace!=="rgb"){var $=Lh[s.colorSpace];V=function(re,xe){return $.reverse($.interpolate($.forward(re),$.forward(xe),T))}}return typeof R.evaluate=="function"?{evaluate:function(){for(var re=[],xe=arguments.length;xe--;)re[xe]=arguments[xe];var ze=R.evaluate.apply(void 0,re),Fe=F.evaluate.apply(void 0,re);if(ze!==void 0&&Fe!==void 0)return V(ze,Fe,T)}}:V(R,F,T)}function gu(s,u,f){return u.type==="color"?f=gi.parse(f):u.type==="formatted"?f=_o.fromString(f.toString()):u.type==="resolvedImage"?f=ms.fromString(f.toString()):ka(f)===u.type||u.type==="enum"&&u.values[f]||(f=void 0),Ks(f,s.default,u.default)}_a.register(Ys,{error:[{kind:"error"},[Sn],function(s,u){throw new Na(u[0].evaluate(s))}],typeof:[Sn,[xn],function(s,u){return Ni(Ia(u[0].evaluate(s)))}],"to-rgba":[ta(dr,4),[we],function(s,u){return u[0].evaluate(s).toArray()}],rgb:[we,[dr,dr,dr],_s],rgba:[we,[dr,dr,dr,dr],_s],has:{type:bn,overloads:[[[Sn],function(s,u){return Jf(u[0].evaluate(s),s.properties())}],[[Sn,Kn],function(s,u){var f=u[1];return Jf(u[0].evaluate(s),f.evaluate(s))}]]},get:{type:xn,overloads:[[[Sn],function(s,u){return Lc(u[0].evaluate(s),s.properties())}],[[Sn,Kn],function(s,u){var f=u[1];return Lc(u[0].evaluate(s),f.evaluate(s))}]]},"feature-state":[xn,[Sn],function(s,u){return Lc(u[0].evaluate(s),s.featureState||{})}],properties:[Kn,[],function(s){return s.properties()}],"geometry-type":[Sn,[],function(s){return s.geometryType()}],id:[xn,[],function(s){return s.id()}],zoom:[dr,[],function(s){return s.globals.zoom}],"heatmap-density":[dr,[],function(s){return s.globals.heatmapDensity||0}],"line-progress":[dr,[],function(s){return s.globals.lineProgress||0}],accumulated:[xn,[],function(s){return s.globals.accumulated===void 0?null:s.globals.accumulated}],"+":[dr,Ou(dr),function(s,u){for(var f=0,g=0,b=u;g<b.length;g+=1)f+=b[g].evaluate(s);return f}],"*":[dr,Ou(dr),function(s,u){for(var f=1,g=0,b=u;g<b.length;g+=1)f*=b[g].evaluate(s);return f}],"-":{type:dr,overloads:[[[dr,dr],function(s,u){var f=u[1];return u[0].evaluate(s)-f.evaluate(s)}],[[dr],function(s,u){return-u[0].evaluate(s)}]]},"/":[dr,[dr,dr],function(s,u){var f=u[1];return u[0].evaluate(s)/f.evaluate(s)}],"%":[dr,[dr,dr],function(s,u){var f=u[1];return u[0].evaluate(s)%f.evaluate(s)}],ln2:[dr,[],function(){return Math.LN2}],pi:[dr,[],function(){return Math.PI}],e:[dr,[],function(){return Math.E}],"^":[dr,[dr,dr],function(s,u){var f=u[1];return Math.pow(u[0].evaluate(s),f.evaluate(s))}],sqrt:[dr,[dr],function(s,u){return Math.sqrt(u[0].evaluate(s))}],log10:[dr,[dr],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN10}],ln:[dr,[dr],function(s,u){return Math.log(u[0].evaluate(s))}],log2:[dr,[dr],function(s,u){return Math.log(u[0].evaluate(s))/Math.LN2}],sin:[dr,[dr],function(s,u){return Math.sin(u[0].evaluate(s))}],cos:[dr,[dr],function(s,u){return Math.cos(u[0].evaluate(s))}],tan:[dr,[dr],function(s,u){return Math.tan(u[0].evaluate(s))}],asin:[dr,[dr],function(s,u){return Math.asin(u[0].evaluate(s))}],acos:[dr,[dr],function(s,u){return Math.acos(u[0].evaluate(s))}],atan:[dr,[dr],function(s,u){return Math.atan(u[0].evaluate(s))}],min:[dr,Ou(dr),function(s,u){return Math.min.apply(Math,u.map(function(f){return f.evaluate(s)}))}],max:[dr,Ou(dr),function(s,u){return Math.max.apply(Math,u.map(function(f){return f.evaluate(s)}))}],abs:[dr,[dr],function(s,u){return Math.abs(u[0].evaluate(s))}],round:[dr,[dr],function(s,u){var f=u[0].evaluate(s);return f<0?-Math.round(-f):Math.round(f)}],floor:[dr,[dr],function(s,u){return Math.floor(u[0].evaluate(s))}],ceil:[dr,[dr],function(s,u){return Math.ceil(u[0].evaluate(s))}],"filter-==":[bn,[Sn,xn],function(s,u){var f=u[0],g=u[1];return s.properties()[f.value]===g.value}],"filter-id-==":[bn,[xn],function(s,u){var f=u[0];return s.id()===f.value}],"filter-type-==":[bn,[Sn],function(s,u){var f=u[0];return s.geometryType()===f.value}],"filter-<":[bn,[Sn,xn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],S=g.value;return typeof b==typeof S&&b<S}],"filter-id-<":[bn,[xn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g<b}],"filter->":[bn,[Sn,xn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],S=g.value;return typeof b==typeof S&&b>S}],"filter-id->":[bn,[xn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g>b}],"filter-<=":[bn,[Sn,xn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],S=g.value;return typeof b==typeof S&&b<=S}],"filter-id-<=":[bn,[xn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g<=b}],"filter->=":[bn,[Sn,xn],function(s,u){var f=u[0],g=u[1],b=s.properties()[f.value],S=g.value;return typeof b==typeof S&&b>=S}],"filter-id->=":[bn,[xn],function(s,u){var f=u[0],g=s.id(),b=f.value;return typeof g==typeof b&&g>=b}],"filter-has":[bn,[xn],function(s,u){return u[0].value in s.properties()}],"filter-has-id":[bn,[],function(s){return s.id()!==null&&s.id()!==void 0}],"filter-type-in":[bn,[ta(Sn)],function(s,u){return u[0].value.indexOf(s.geometryType())>=0}],"filter-id-in":[bn,[ta(xn)],function(s,u){return u[0].value.indexOf(s.id())>=0}],"filter-in-small":[bn,[Sn,ta(xn)],function(s,u){var f=u[0];return u[1].value.indexOf(s.properties()[f.value])>=0}],"filter-in-large":[bn,[Sn,ta(xn)],function(s,u){var f=u[0],g=u[1];return function(b,S,T,R){for(;T<=R;){var F=T+R>>1;if(S[F]===b)return!0;S[F]>b?R=F-1:T=F+1}return!1}(s.properties()[f.value],g.value,0,g.value.length-1)}],all:{type:bn,overloads:[[[bn,bn],function(s,u){var f=u[1];return u[0].evaluate(s)&&f.evaluate(s)}],[Ou(bn),function(s,u){for(var f=0,g=u;f<g.length;f+=1)if(!g[f].evaluate(s))return!1;return!0}]]},any:{type:bn,overloads:[[[bn,bn],function(s,u){var f=u[1];return u[0].evaluate(s)||f.evaluate(s)}],[Ou(bn),function(s,u){for(var f=0,g=u;f<g.length;f+=1)if(g[f].evaluate(s))return!0;return!1}]]},"!":[bn,[bn],function(s,u){return!u[0].evaluate(s)}],"is-supported-script":[bn,[Sn],function(s,u){var f=s.globals&&s.globals.isSupportedScript;return!f||f(u[0].evaluate(s))}],upcase:[Sn,[Sn],function(s,u){return u[0].evaluate(s).toUpperCase()}],downcase:[Sn,[Sn],function(s,u){return u[0].evaluate(s).toLowerCase()}],concat:[Sn,Ou(xn),function(s,u){return u.map(function(f){return Ol(f.evaluate(s))}).join("")}],"resolved-locale":[Sn,[Vi],function(s,u){return u[0].evaluate(s).resolvedLocale()}]});var Bo=function(u,f){this.expression=u,this._warningHistory={},this._evaluator=new Fo,this._defaultValue=f?function(g){return g.type==="color"&&eh(g.default)?new gi(0,0,0,0):g.type==="color"?gi.parse(g.default)||null:g.default===void 0?null:g.default}(f):null,this._enumValues=f&&f.type==="enum"?f.values:null};function Fl(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ys}function fc(s,u){var f=new Pl(Ys,[],u?function(b){var S={color:we,string:Sn,number:dr,enum:Sn,boolean:bn,formatted:ia,resolvedImage:bi};return b.type==="array"?ta(S[b.value]||xn,b.length):S[b.type]}(u):void 0),g=f.parse(s,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?_f(new Bo(g,u)):Dl(f.errors)}Bo.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,S){return this._evaluator.globals=s,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)},Bo.prototype.evaluate=function(s,u,f,g,b,S){this._evaluator.globals=s,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=S||null;try{var T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Na("Expected value to be one of "+Object.keys(this._enumValues).map(function(R){return JSON.stringify(R)}).join(", ")+", but found "+JSON.stringify(T)+" instead.");return T}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console!="undefined"&&console.warn(R.message)),this._defaultValue}};var cl=function(u,f){this.kind=u,this._styleExpression=f,this.isStateDependent=u!=="constant"&&!sc(f.expression)};cl.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,S){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,b,S)},cl.prototype.evaluate=function(s,u,f,g,b,S){return this._styleExpression.evaluate(s,u,f,g,b,S)};var Bl=function(u,f,g,b){this.kind=u,this.zoomStops=g,this._styleExpression=f,this.isStateDependent=u!=="camera"&&!sc(f.expression),this.interpolationType=b};function rh(s,u){if((s=fc(s,u)).result==="error")return s;var f=s.value.expression,g=Ml(f);if(!g&&!ll(u))return Dl([new Wr("","data expressions not supported")]);var b=Gu(f,["zoom"]);if(!b&&!Nh(u))return Dl([new Wr("","zoom expressions not supported")]);var S=function T(R){var F=null;if(R instanceof Ns)F=T(R.result);else if(R instanceof Il)for(var V=0,$=R.args;V<$.length&&!(F=T($[V]));V+=1);else(R instanceof Rt||R instanceof is)&&R.input instanceof _a&&R.input.name==="zoom"&&(F=R);return F instanceof Wr||R.eachChild(function(J){var re=T(J);re instanceof Wr?F=re:!F&&re?F=new Wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):F&&re&&F!==re&&(F=new Wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),F}(f);return S||b?S instanceof Wr?Dl([S]):S instanceof is&&!Nc(u)?Dl([new Wr("",'"interpolate" expressions cannot be used with this property')]):_f(S?new Bl(g?"camera":"composite",s.value,S.labels,S instanceof is?S.interpolation:void 0):new cl(g?"constant":"source",s.value)):Dl([new Wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Bl.prototype.evaluateWithoutErrorHandling=function(s,u,f,g,b,S){return this._styleExpression.evaluateWithoutErrorHandling(s,u,f,g,b,S)},Bl.prototype.evaluate=function(s,u,f,g,b,S){return this._styleExpression.evaluate(s,u,f,g,b,S)},Bl.prototype.interpolationFactor=function(s,u,f){return this.interpolationType?is.interpolationFactor(this.interpolationType,s,u,f):0};var hc=function(u,f){this._parameters=u,this._specification=f,Rr(this,function g(b,S){var T,R,F,V=S.type==="color",$=b.stops&&typeof b.stops[0][0]=="object",J=$||!($||b.property!==void 0),re=b.type||(Nc(S)?"exponential":"interval");if(V&&((b=Rr({},b)).stops&&(b.stops=b.stops.map(function(Un){return[Un[0],gi.parse(Un[1])]})),b.default=gi.parse(b.default?b.default:S.default)),b.colorSpace&&b.colorSpace!=="rgb"&&!Lh[b.colorSpace])throw new Error("Unknown color space: "+b.colorSpace);if(re==="exponential")T=th;else if(re==="interval")T=zc;else if(re==="categorical"){T=jc,R=Object.create(null);for(var xe=0,ze=b.stops;xe<ze.length;xe+=1){var Fe=ze[xe];R[Fe[0]]=Fe[1]}F=typeof b.stops[0][0]}else{if(re!=="identity")throw new Error('Unknown function type "'+re+'"');T=gu}if($){for(var lt={},ct=[],wt=0;wt<b.stops.length;wt++){var Ht=b.stops[wt],ar=Ht[0].zoom;lt[ar]===void 0&&(lt[ar]={zoom:ar,type:b.type,property:b.property,default:b.default,stops:[]},ct.push(ar)),lt[ar].stops.push([Ht[0].value,Ht[1]])}for(var Mr=[],gr=0,un=ct;gr<un.length;gr+=1){var fn=un[gr];Mr.push([lt[fn].zoom,g(lt[fn],S)])}var Fn={name:"linear"};return{kind:"composite",interpolationType:Fn,interpolationFactor:is.interpolationFactor.bind(void 0,Fn),zoomStops:Mr.map(function(Un){return Un[0]}),evaluate:function(In,Si){var ai=In.zoom;return th({stops:Mr,base:b.base},S,ai).evaluate(ai,Si)}}}if(J){var $n=re==="exponential"?{name:"exponential",base:b.base!==void 0?b.base:1}:null;return{kind:"camera",interpolationType:$n,interpolationFactor:is.interpolationFactor.bind(void 0,$n),zoomStops:b.stops.map(function(Un){return Un[0]}),evaluate:function(In){return T(b,S,In.zoom,R,F)}}}return{kind:"source",evaluate:function(In,Si){var ai=Si&&Si.properties?Si.properties[b.property]:void 0;return ai===void 0?Ks(b.default,S.default):T(b,S,ai,R,F)}}}(this._parameters,this._specification))};function Ro(s){var u=s.key,f=s.value,g=s.valueSpec||{},b=s.objectElementValidators||{},S=s.style,T=s.styleSpec,R=[],F=ka(f);if(F!=="object")return[new Ye(u,f,"object expected, "+F+" found")];for(var V in f){var $=V.split(".")[0],J=g[$]||g["*"],re=void 0;if(b[$])re=b[$];else if(g[$])re=ra;else if(b["*"])re=b["*"];else{if(!g["*"]){R.push(new Ye(u,f[V],'unknown property "'+V+'"'));continue}re=ra}R=R.concat(re({key:(u&&u+".")+V,value:f[V],valueSpec:J,style:S,styleSpec:T,object:f,objectKey:V},f))}for(var xe in g)b[xe]||g[xe].required&&g[xe].default===void 0&&f[xe]===void 0&&R.push(new Ye(u,f,'missing required property "'+xe+'"'));return R}function bf(s){var u=s.value,f=s.valueSpec,g=s.style,b=s.styleSpec,S=s.key,T=s.arrayElementValidator||ra;if(ka(u)!=="array")return[new Ye(S,u,"array expected, "+ka(u)+" found")];if(f.length&&u.length!==f.length)return[new Ye(S,u,"array length "+f.length+" expected, length "+u.length+" found")];if(f["min-length"]&&u.length<f["min-length"])return[new Ye(S,u,"array length at least "+f["min-length"]+" expected, length "+u.length+" found")];var R={type:f.value,values:f.values};b.$version<7&&(R.function=f.function),ka(f.value)==="object"&&(R=f.value);for(var F=[],V=0;V<u.length;V++)F=F.concat(T({array:u,arrayIndex:V,value:u[V],valueSpec:R,style:g,styleSpec:b,key:S+"["+V+"]"}));return F}function xp(s){var u=s.key,f=s.value,g=s.valueSpec,b=ka(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new Ye(u,f,"number expected, "+b+" found")]:"minimum"in g&&f<g.minimum?[new Ye(u,f,f+" is less than the minimum value "+g.minimum)]:"maximum"in g&&f>g.maximum?[new Ye(u,f,f+" is greater than the maximum value "+g.maximum)]:[]}function oa(s){var u,f,g,b=s.valueSpec,S=Nr(s.value.type),T={},R=S!=="categorical"&&s.value.property===void 0,F=!R,V=ka(s.value.stops)==="array"&&ka(s.value.stops[0])==="array"&&ka(s.value.stops[0][0])==="object",$=Ro({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ze){if(S==="identity")return[new Ye(ze.key,ze.value,'identity function may not have a "stops" property')];var Fe=[],lt=ze.value;return Fe=Fe.concat(bf({key:ze.key,value:lt,valueSpec:ze.valueSpec,style:ze.style,styleSpec:ze.styleSpec,arrayElementValidator:J})),ka(lt)==="array"&&lt.length===0&&Fe.push(new Ye(ze.key,lt,"array must have at least one stop")),Fe},default:function(ze){return ra({key:ze.key,value:ze.value,valueSpec:b,style:ze.style,styleSpec:ze.styleSpec})}}});return S==="identity"&&R&&$.push(new Ye(s.key,s.value,'missing required property "property"')),S==="identity"||s.value.stops||$.push(new Ye(s.key,s.value,'missing required property "stops"')),S==="exponential"&&s.valueSpec.expression&&!Nc(s.valueSpec)&&$.push(new Ye(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(F&&!ll(s.valueSpec)?$.push(new Ye(s.key,s.value,"property functions not supported")):R&&!Nh(s.valueSpec)&&$.push(new Ye(s.key,s.value,"zoom functions not supported"))),S!=="categorical"&&!V||s.value.property!==void 0||$.push(new Ye(s.key,s.value,'"property" property is required')),$;function J(xe){var ze=[],Fe=xe.value,lt=xe.key;if(ka(Fe)!=="array")return[new Ye(lt,Fe,"array expected, "+ka(Fe)+" found")];if(Fe.length!==2)return[new Ye(lt,Fe,"array length 2 expected, length "+Fe.length+" found")];if(V){if(ka(Fe[0])!=="object")return[new Ye(lt,Fe,"object expected, "+ka(Fe[0])+" found")];if(Fe[0].zoom===void 0)return[new Ye(lt,Fe,"object stop key must have zoom")];if(Fe[0].value===void 0)return[new Ye(lt,Fe,"object stop key must have value")];if(g&&g>Nr(Fe[0].zoom))return[new Ye(lt,Fe[0].zoom,"stop zoom values must appear in ascending order")];Nr(Fe[0].zoom)!==g&&(g=Nr(Fe[0].zoom),f=void 0,T={}),ze=ze.concat(Ro({key:lt+"[0]",value:Fe[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:xp,value:re}}))}else ze=ze.concat(re({key:lt+"[0]",value:Fe[0],valueSpec:{},style:xe.style,styleSpec:xe.styleSpec},Fe));return Fl(pr(Fe[1]))?ze.concat([new Ye(lt+"[1]",Fe[1],"expressions are not allowed in function stops.")]):ze.concat(ra({key:lt+"[1]",value:Fe[1],valueSpec:b,style:xe.style,styleSpec:xe.styleSpec}))}function re(xe,ze){var Fe=ka(xe.value),lt=Nr(xe.value),ct=xe.value!==null?xe.value:ze;if(u){if(Fe!==u)return[new Ye(xe.key,ct,Fe+" stop domain type must match previous stop domain type "+u)]}else u=Fe;if(Fe!=="number"&&Fe!=="string"&&Fe!=="boolean")return[new Ye(xe.key,ct,"stop domain value must be a number, string, or boolean")];if(Fe!=="number"&&S!=="categorical"){var wt="number expected, "+Fe+" found";return ll(b)&&S===void 0&&(wt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(xe.key,ct,wt)]}return S!=="categorical"||Fe!=="number"||isFinite(lt)&&Math.floor(lt)===lt?S!=="categorical"&&Fe==="number"&&f!==void 0&&lt<f?[new Ye(xe.key,ct,"stop domain values must appear in ascending order")]:(f=lt,S==="categorical"&&lt in T?[new Ye(xe.key,ct,"stop domain values must be unique")]:(T[lt]=!0,[])):[new Ye(xe.key,ct,"integer expected, found "+lt)]}}function qs(s){var u=(s.expressionContext==="property"?rh:fc)(pr(s.value),s.valueSpec);if(u.result==="error")return u.value.map(function(g){return new Ye(""+s.key+g.key,s.value,g.message)});var f=u.value.expression||u.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!f.outputDefined())return[new Ye(s.key,s.value,'Invalid data expression for "'+s.propertyKey+'". Output values must be contained as literals within the expression.')];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!sc(f))return[new Ye(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!sc(f))return[new Ye(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Gu(f,["zoom","feature-state"]))return[new Ye(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ml(f))return[new Ye(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function os(s){var u=s.key,f=s.value,g=s.valueSpec,b=[];return Array.isArray(g.values)?g.values.indexOf(Nr(f))===-1&&b.push(new Ye(u,f,"expected one of ["+g.values.join(", ")+"], "+JSON.stringify(f)+" found")):Object.keys(g.values).indexOf(Nr(f))===-1&&b.push(new Ye(u,f,"expected one of ["+Object.keys(g.values).join(", ")+"], "+JSON.stringify(f)+" found")),b}function Ll(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(var u=0,f=s.slice(1);u<f.length;u+=1){var g=f[u];if(!Ll(g)&&typeof g!="boolean")return!1}return!0;default:return!0}}hc.deserialize=function(s){return new hc(s._parameters,s._specification)},hc.serialize=function(s){return{_parameters:s._parameters,_specification:s._specification}};var xf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Nl(s){if(s==null)return{filter:function(){return!0},needGeometry:!1};Ll(s)||(s=nh(s));var u=fc(s,xf);if(u.result==="error")throw new Error(u.value.map(function(f){return f.key+": "+f.message}).join(", "));return{filter:function(g,b,S){return u.value.evaluate(g,b,{},S)},needGeometry:function f(g){if(!Array.isArray(g))return!1;if(g[0]==="within")return!0;for(var b=1;b<g.length;b++)if(f(g[b]))return!0;return!1}(s)}}function md(s,u){return s<u?-1:s>u?1:0}function nh(s){if(!s)return!0;var u,f=s[0];return s.length<=1?f!=="any":f==="=="?Ef(s[1],s[2],"=="):f==="!="?pc(Ef(s[1],s[2],"==")):f==="<"||f===">"||f==="<="||f===">="?Ef(s[1],s[2],f):f==="any"?(u=s.slice(1),["any"].concat(u.map(nh))):f==="all"?["all"].concat(s.slice(1).map(nh)):f==="none"?["all"].concat(s.slice(1).map(nh).map(pc)):f==="in"?Uc(s[1],s.slice(2)):f==="!in"?pc(Uc(s[1],s.slice(2))):f==="has"?jl(s[1]):f==="!has"?pc(jl(s[1])):f!=="within"||s}function Ef(s,u,f){switch(s){case"$type":return["filter-type-"+f,u];case"$id":return["filter-id-"+f,u];default:return["filter-"+f,s,u]}}function Uc(s,u){if(u.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(f){return typeof f!=typeof u[0]})?["filter-in-large",s,["literal",u.sort(md)]]:["filter-in-small",s,["literal",u]]}}function jl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function pc(s){return["!",s]}function cr(s){return Ll(pr(s.value))?qs(Rr({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(f){var g=f.value,b=f.key;if(ka(g)!=="array")return[new Ye(b,g,"array expected, "+ka(g)+" found")];var S,T=f.styleSpec,R=[];if(g.length<1)return[new Ye(b,g,"filter array must have at least 1 element")];switch(R=R.concat(os({key:b+"[0]",value:g[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),Nr(g[0])){case"<":case"<=":case">":case">=":g.length>=2&&Nr(g[1])==="$type"&&R.push(new Ye(b,g,'"$type" cannot be use with operator "'+g[0]+'"'));case"==":case"!=":g.length!==3&&R.push(new Ye(b,g,'filter array for operator "'+g[0]+'" must have 3 elements'));case"in":case"!in":g.length>=2&&(S=ka(g[1]))!=="string"&&R.push(new Ye(b+"[1]",g[1],"string expected, "+S+" found"));for(var F=2;F<g.length;F++)S=ka(g[F]),Nr(g[1])==="$type"?R=R.concat(os({key:b+"["+F+"]",value:g[F],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):S!=="string"&&S!=="number"&&S!=="boolean"&&R.push(new Ye(b+"["+F+"]",g[F],"string, number, or boolean expected, "+S+" found"));break;case"any":case"all":case"none":for(var V=1;V<g.length;V++)R=R.concat(u({key:b+"["+V+"]",value:g[V],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":S=ka(g[1]),g.length!==2?R.push(new Ye(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):S!=="string"&&R.push(new Ye(b+"[1]",g[1],"string expected, "+S+" found"));break;case"within":S=ka(g[1]),g.length!==2?R.push(new Ye(b,g,'filter array for "'+g[0]+'" operator must have 2 elements')):S!=="object"&&R.push(new Ye(b+"[1]",g[1],"object expected, "+S+" found"))}return R}(s)}function Bn(s,u){var f=s.key,g=s.style,b=s.styleSpec,S=s.value,T=s.objectKey,R=b[u+"_"+s.layerType];if(!R)return[];var F=T.match(/^(.*)-transition$/);if(u==="paint"&&F&&R[F[1]]&&R[F[1]].transition)return ra({key:f,value:S,valueSpec:b.transition,style:g,styleSpec:b});var V,$=s.valueSpec||R[T];if(!$)return[new Ye(f,S,'unknown property "'+T+'"')];if(ka(S)==="string"&&ll($)&&!$.tokens&&(V=/^{([^}]+)}$/.exec(S)))return[new Ye(f,S,'"'+T+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(V[1])+" }`.")];var J=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&J.push(new Ye(f,S,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&eh(pr(S))&&Nr(S.type)==="identity"&&J.push(new Ye(f,S,'"text-font" does not support identity functions'))),J.concat(ra({key:s.key,value:S,valueSpec:$,style:g,styleSpec:b,expressionContext:"property",propertyType:u,propertyKey:T}))}function jh(s){return Bn(s,"paint")}function dc(s){return Bn(s,"layout")}function zh(s){var u=[],f=s.value,g=s.key,b=s.style,S=s.styleSpec;f.type||f.ref||u.push(new Ye(g,f,'either "type" or "ref" is required'));var T,R=Nr(f.type),F=Nr(f.ref);if(f.id)for(var V=Nr(f.id),$=0;$<s.arrayIndex;$++){var J=b.layers[$];Nr(J.id)===V&&u.push(new Ye(g,f.id,'duplicate layer id "'+f.id+'", previously used at line '+J.id.__line__))}if("ref"in f)["type","source","source-layer","filter","layout"].forEach(function(ze){ze in f&&u.push(new Ye(g,f[ze],'"'+ze+'" is prohibited for ref layers'))}),b.layers.forEach(function(ze){Nr(ze.id)===F&&(T=ze)}),T?T.ref?u.push(new Ye(g,f.ref,"ref cannot reference another ref layer")):R=Nr(T.type):u.push(new Ye(g,f.ref,'ref layer "'+F+'" not found'));else if(R!=="background")if(f.source){var re=b.sources&&b.sources[f.source],xe=re&&Nr(re.type);re?xe==="vector"&&R==="raster"?u.push(new Ye(g,f.source,'layer "'+f.id+'" requires a raster source')):xe==="raster"&&R!=="raster"?u.push(new Ye(g,f.source,'layer "'+f.id+'" requires a vector source')):xe!=="vector"||f["source-layer"]?xe==="raster-dem"&&R!=="hillshade"?u.push(new Ye(g,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!f.paint||!f.paint["line-gradient"]||xe==="geojson"&&re.lineMetrics||u.push(new Ye(g,f,'layer "'+f.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Ye(g,f,'layer "'+f.id+'" must specify a "source-layer"')):u.push(new Ye(g,f.source,'source "'+f.source+'" not found'))}else u.push(new Ye(g,f,'missing required property "source"'));return u=u.concat(Ro({key:g,value:f,valueSpec:S.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ra({key:g+".type",value:f.type,valueSpec:S.layer.type,style:s.style,styleSpec:s.styleSpec,object:f,objectKey:"type"})},filter:cr,layout:function(Fe){return Ro({layer:f,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(ct){return dc(Rr({layerType:R},ct))}}})},paint:function(Fe){return Ro({layer:f,key:Fe.key,value:Fe.value,style:Fe.style,styleSpec:Fe.styleSpec,objectElementValidators:{"*":function(ct){return jh(Rr({layerType:R},ct))}}})}}}))}function zl(s){var u=s.value,f=s.key,g=ka(u);return g!=="string"?[new Ye(f,u,"string expected, "+g+" found")]:[]}var ja={promoteId:function(u){var f=u.key,g=u.value;if(ka(g)==="string")return zl({key:f,value:g});var b=[];for(var S in g)b.push.apply(b,zl({key:f+"."+S,value:g[S]}));return b}};function ih(s){var u=s.value,f=s.key,g=s.styleSpec,b=s.style;if(!u.type)return[new Ye(f,u,'"type" is required')];var S,T=Nr(u.type);switch(T){case"vector":case"raster":case"raster-dem":return Ro({key:f,value:u,valueSpec:g["source_"+T.replace("-","_")],style:s.style,styleSpec:g,objectElementValidators:ja});case"geojson":if(S=Ro({key:f,value:u,valueSpec:g.source_geojson,style:b,styleSpec:g,objectElementValidators:ja}),u.cluster)for(var R in u.clusterProperties){var F=u.clusterProperties[R],V=F[0],$=typeof V=="string"?[V,["accumulated"],["get",R]]:V;S.push.apply(S,qs({key:f+"."+R+".map",value:F[1],expressionContext:"cluster-map"})),S.push.apply(S,qs({key:f+"."+R+".reduce",value:$,expressionContext:"cluster-reduce"}))}return S;case"video":return Ro({key:f,value:u,valueSpec:g.source_video,style:b,styleSpec:g});case"image":return Ro({key:f,value:u,valueSpec:g.source_image,style:b,styleSpec:g});case"canvas":return[new Ye(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return os({key:f+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,styleSpec:g})}}function Yu(s){var u=s.value,f=s.styleSpec,g=f.light,b=s.style,S=[],T=ka(u);if(u===void 0)return S;if(T!=="object")return S.concat([new Ye("light",u,"object expected, "+T+" found")]);for(var R in u){var F=R.match(/^(.*)-transition$/);S=S.concat(F&&g[F[1]]&&g[F[1]].transition?ra({key:R,value:u[R],valueSpec:f.transition,style:b,styleSpec:f}):g[R]?ra({key:R,value:u[R],valueSpec:g[R],style:b,styleSpec:f}):[new Ye(R,u[R],'unknown property "'+R+'"')])}return S}var Ul={"*":function(){return[]},array:bf,boolean:function(u){var f=u.value,g=u.key,b=ka(f);return b!=="boolean"?[new Ye(g,f,"boolean expected, "+b+" found")]:[]},number:xp,color:function(u){var f=u.key,g=u.value,b=ka(g);return b!=="string"?[new Ye(f,g,"color expected, "+b+" found")]:Zi(g)===null?[new Ye(f,g,'color expected, "'+g+'" found')]:[]},constants:zt,enum:os,filter:cr,function:oa,layer:zh,object:Ro,source:ih,light:Yu,string:zl,formatted:function(u){return zl(u).length===0?[]:qs(u)},resolvedImage:function(u){return zl(u).length===0?[]:qs(u)}};function ra(s){var u=s.value,f=s.valueSpec,g=s.styleSpec;return f.expression&&eh(Nr(u))?oa(s):f.expression&&Fl(pr(u))?qs(s):f.type&&Ul[f.type]?Ul[f.type](s):Ro(Rr({},s,{valueSpec:f.type?g[f.type]:f}))}function za(s){var u=s.value,f=s.key,g=zl(s);return g.length||(u.indexOf("{fontstack}")===-1&&g.push(new Ye(f,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&g.push(new Ye(f,u,'"glyphs" url must include a "{range}" token'))),g}function cu(s,u){u===void 0&&(u=ge);var f=[];return f=f.concat(ra({key:"",value:s,valueSpec:u.$root,styleSpec:u,style:s,objectElementValidators:{glyphs:za,"*":function(){return[]}}})),s.constants&&(f=f.concat(zt({key:"constants",value:s.constants,style:s,styleSpec:u}))),Sf(f)}function Sf(s){return[].concat(s).sort(function(u,f){return u.line-f.line})}function Vc(s){return function(){for(var u=[],f=arguments.length;f--;)u[f]=arguments[f];return Sf(s.apply(this,u))}}cu.source=Vc(ih),cu.light=Vc(Yu),cu.layer=Vc(zh),cu.filter=Vc(cr),cu.paintProperty=Vc(jh),cu.layoutProperty=Vc(dc);var Af=cu,Ep=Af.light,ah=Af.paintProperty,Tf=Af.layoutProperty;function Vl(s,u){var f=!1;if(u&&u.length)for(var g=0,b=u;g<b.length;g+=1)s.fire(new mt(new Error(b[g].message))),f=!0;return f}var Lo=to;function to(s,u,f){var g=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var b=new Int32Array(this.arrayBuffer);s=b[0],this.d=(u=b[1])+2*(f=b[2]);for(var S=0;S<this.d*this.d;S++){var T=b[3+S],R=b[3+S+1];g.push(T===R?null:b.subarray(T,R))}var F=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],F),this.bboxes=b.subarray(F),this.insert=this._insertReadonly}else{this.d=u+2*f;for(var V=0;V<this.d*this.d;V++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=s,this.padding=f,this.scale=u/s,this.uid=0;var $=f/u*s;this.min=-$,this.max=s+$}to.prototype.insert=function(s,u,f,g,b){this._forEachCell(u,f,g,b,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b)},to.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},to.prototype._insertCell=function(s,u,f,g,b,S){this.cells[b].push(S)},to.prototype.query=function(s,u,f,g,b){var S=this.min,T=this.max;if(s<=S&&u<=S&&T<=f&&T<=g&&!b)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(s,u,f,g,this._queryCell,R,{},b),R},to.prototype._queryCell=function(s,u,f,g,b,S,T,R){var F=this.cells[b];if(F!==null)for(var V=this.keys,$=this.bboxes,J=0;J<F.length;J++){var re=F[J];if(T[re]===void 0){var xe=4*re;(R?R($[xe+0],$[xe+1],$[xe+2],$[xe+3]):s<=$[xe+2]&&u<=$[xe+3]&&f>=$[xe+0]&&g>=$[xe+1])?(T[re]=!0,S.push(V[re])):T[re]=!1}}},to.prototype._forEachCell=function(s,u,f,g,b,S,T,R){for(var F=this._convertToCellCoord(s),V=this._convertToCellCoord(u),$=this._convertToCellCoord(f),J=this._convertToCellCoord(g),re=F;re<=$;re++)for(var xe=V;xe<=J;xe++){var ze=this.d*xe+re;if((!R||R(this._convertFromCellCoord(re),this._convertFromCellCoord(xe),this._convertFromCellCoord(re+1),this._convertFromCellCoord(xe+1)))&&b.call(this,s,u,f,g,ze,S,T,R))return}},to.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},to.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},to.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,u=3+this.cells.length+1+1,f=0,g=0;g<this.cells.length;g++)f+=this.cells[g].length;var b=new Int32Array(u+f+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;for(var S=u,T=0;T<s.length;T++){var R=s[T];b[3+T]=S,b.set(R,S),S+=R.length}return b[3+s.length]=S,b.set(this.keys,S),b[3+s.length+1]=S+=this.keys.length,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer};var Hc=ue.ImageData,Uh=ue.ImageBitmap,bo={};function kn(s,u,f){f===void 0&&(f={}),Object.defineProperty(u,"_classRegistryKey",{value:s,writeable:!1}),bo[s]={klass:u,omit:f.omit||[],shallow:f.shallow||[]}}for(var js in kn("Object",Object),Lo.serialize=function(s,u){var f=s.toArrayBuffer();return u&&u.push(f),{buffer:f}},Lo.deserialize=function(s){return new Lo(s.buffer)},kn("Grid",Lo),kn("Color",gi),kn("Error",Error),kn("ResolvedImage",ms),kn("StylePropertyFunction",hc),kn("StyleExpression",Bo,{omit:["_evaluator"]}),kn("ZoomDependentExpression",Bl),kn("ZoomConstantExpression",cl),kn("CompoundExpression",_a,{omit:["_evaluate"]}),Ys)Ys[js]._classRegistryKey||kn("Expression_"+js,Ys[js]);function Cf(s){return s&&typeof ArrayBuffer!="undefined"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Wc(s){return Uh&&s instanceof Uh}function Cs(s,u){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Cf(s)||Wc(s))return u&&u.push(s),s;if(ArrayBuffer.isView(s)){var f=s;return u&&u.push(f.buffer),f}if(s instanceof Hc)return u&&u.push(s.data.buffer),s;if(Array.isArray(s)){for(var g=[],b=0,S=s;b<S.length;b+=1)g.push(Cs(S[b],u));return g}if(typeof s=="object"){var T=s.constructor,R=T._classRegistryKey;if(!R)throw new Error("can't serialize object of unregistered class");var F=T.serialize?T.serialize(s,u):{};if(!T.serialize){for(var V in s)if(s.hasOwnProperty(V)&&!(bo[R].omit.indexOf(V)>=0)){var $=s[V];F[V]=bo[R].shallow.indexOf(V)>=0?$:Cs($,u)}s instanceof Error&&(F.message=s.message)}if(F.$name)throw new Error("$name property is reserved for worker serialization logic.");return R!=="Object"&&(F.$name=R),F}throw new Error("can't serialize object of type "+typeof s)}function Oa(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Cf(s)||Wc(s)||ArrayBuffer.isView(s)||s instanceof Hc)return s;if(Array.isArray(s))return s.map(Oa);if(typeof s=="object"){var u=s.$name||"Object",f=bo[u].klass;if(!f)throw new Error("can't deserialize unregistered class "+u);if(f.deserialize)return f.deserialize(s);for(var g=Object.create(f.prototype),b=0,S=Object.keys(s);b<S.length;b+=1){var T=S[b];if(T!=="$name"){var R=s[T];g[T]=bo[u].shallow.indexOf(T)>=0?R:Oa(R)}}return g}throw new Error("can't deserialize object of type "+typeof s)}var oh=function(){this.first=!0};oh.prototype.update=function(s,u){var f=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=f,!0))};var vn={"Latin-1 Supplement":function(u){return u>=128&&u<=255},Arabic:function(u){return u>=1536&&u<=1791},"Arabic Supplement":function(u){return u>=1872&&u<=1919},"Arabic Extended-A":function(u){return u>=2208&&u<=2303},"Hangul Jamo":function(u){return u>=4352&&u<=4607},"Unified Canadian Aboriginal Syllabics":function(u){return u>=5120&&u<=5759},Khmer:function(u){return u>=6016&&u<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(u){return u>=6320&&u<=6399},"General Punctuation":function(u){return u>=8192&&u<=8303},"Letterlike Symbols":function(u){return u>=8448&&u<=8527},"Number Forms":function(u){return u>=8528&&u<=8591},"Miscellaneous Technical":function(u){return u>=8960&&u<=9215},"Control Pictures":function(u){return u>=9216&&u<=9279},"Optical Character Recognition":function(u){return u>=9280&&u<=9311},"Enclosed Alphanumerics":function(u){return u>=9312&&u<=9471},"Geometric Shapes":function(u){return u>=9632&&u<=9727},"Miscellaneous Symbols":function(u){return u>=9728&&u<=9983},"Miscellaneous Symbols and Arrows":function(u){return u>=11008&&u<=11263},"CJK Radicals Supplement":function(u){return u>=11904&&u<=12031},"Kangxi Radicals":function(u){return u>=12032&&u<=12255},"Ideographic Description Characters":function(u){return u>=12272&&u<=12287},"CJK Symbols and Punctuation":function(u){return u>=12288&&u<=12351},Hiragana:function(u){return u>=12352&&u<=12447},Katakana:function(u){return u>=12448&&u<=12543},Bopomofo:function(u){return u>=12544&&u<=12591},"Hangul Compatibility Jamo":function(u){return u>=12592&&u<=12687},Kanbun:function(u){return u>=12688&&u<=12703},"Bopomofo Extended":function(u){return u>=12704&&u<=12735},"CJK Strokes":function(u){return u>=12736&&u<=12783},"Katakana Phonetic Extensions":function(u){return u>=12784&&u<=12799},"Enclosed CJK Letters and Months":function(u){return u>=12800&&u<=13055},"CJK Compatibility":function(u){return u>=13056&&u<=13311},"CJK Unified Ideographs Extension A":function(u){return u>=13312&&u<=19903},"Yijing Hexagram Symbols":function(u){return u>=19904&&u<=19967},"CJK Unified Ideographs":function(u){return u>=19968&&u<=40959},"Yi Syllables":function(u){return u>=40960&&u<=42127},"Yi Radicals":function(u){return u>=42128&&u<=42191},"Hangul Jamo Extended-A":function(u){return u>=43360&&u<=43391},"Hangul Syllables":function(u){return u>=44032&&u<=55215},"Hangul Jamo Extended-B":function(u){return u>=55216&&u<=55295},"Private Use Area":function(u){return u>=57344&&u<=63743},"CJK Compatibility Ideographs":function(u){return u>=63744&&u<=64255},"Arabic Presentation Forms-A":function(u){return u>=64336&&u<=65023},"Vertical Forms":function(u){return u>=65040&&u<=65055},"CJK Compatibility Forms":function(u){return u>=65072&&u<=65103},"Small Form Variants":function(u){return u>=65104&&u<=65135},"Arabic Presentation Forms-B":function(u){return u>=65136&&u<=65279},"Halfwidth and Fullwidth Forms":function(u){return u>=65280&&u<=65519}};function fl(s){for(var u=0,f=s;u<f.length;u+=1)if(wf(f[u].charCodeAt(0)))return!0;return!1}function wf(s){return!(s!==746&&s!==747&&(s<4352||!(vn["Bopomofo Extended"](s)||vn.Bopomofo(s)||vn["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||vn["CJK Compatibility Ideographs"](s)||vn["CJK Compatibility"](s)||vn["CJK Radicals Supplement"](s)||vn["CJK Strokes"](s)||!(!vn["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||vn["CJK Unified Ideographs Extension A"](s)||vn["CJK Unified Ideographs"](s)||vn["Enclosed CJK Letters and Months"](s)||vn["Hangul Compatibility Jamo"](s)||vn["Hangul Jamo Extended-A"](s)||vn["Hangul Jamo Extended-B"](s)||vn["Hangul Jamo"](s)||vn["Hangul Syllables"](s)||vn.Hiragana(s)||vn["Ideographic Description Characters"](s)||vn.Kanbun(s)||vn["Kangxi Radicals"](s)||vn["Katakana Phonetic Extensions"](s)||vn.Katakana(s)&&s!==12540||!(!vn["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!vn["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||vn["Unified Canadian Aboriginal Syllabics"](s)||vn["Unified Canadian Aboriginal Syllabics Extended"](s)||vn["Vertical Forms"](s)||vn["Yijing Hexagram Symbols"](s)||vn["Yi Syllables"](s)||vn["Yi Radicals"](s))))}function sh(s){return!(wf(s)||function(u){return!!(vn["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||vn["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||vn["Letterlike Symbols"](u)||vn["Number Forms"](u)||vn["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||vn["Control Pictures"](u)&&u!==9251||vn["Optical Character Recognition"](u)||vn["Enclosed Alphanumerics"](u)||vn["Geometric Shapes"](u)||vn["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||vn["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||vn["CJK Symbols and Punctuation"](u)||vn.Katakana(u)||vn["Private Use Area"](u)||vn["CJK Compatibility Forms"](u)||vn["Small Form Variants"](u)||vn["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(s))}function yu(s){return s>=1424&&s<=2303||vn["Arabic Presentation Forms-A"](s)||vn["Arabic Presentation Forms-B"](s)}function Qs(s,u){return!(!u&&yu(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||vn.Khmer(s))}function uh(s){for(var u=0,f=s;u<f.length;u+=1)if(yu(f[u].charCodeAt(0)))return!0;return!1}var lh=null,ws="unavailable",Ku=null,Sp=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(ws="error"),lh&&lh(u)};function Gc(){xi.fire(new Le("pluginStateChange",{pluginStatus:ws,pluginURL:Ku}))}var xi=new St,Vh=function(){return ws},Js=function(){if(ws!=="deferred"||!Ku)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws="loading",Gc(),Ku&&yo({url:Ku},function(u){u?Sp(u):(ws="loaded",Gc())})},zs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ws==="loaded"||zs.applyArabicShaping!=null},isLoading:function(){return ws==="loading"},setState:function(u){ws=u.pluginStatus,Ku=u.pluginURL},isParsed:function(){return zs.applyArabicShaping!=null&&zs.processBidirectionalText!=null&&zs.processStyledBidirectionalText!=null},getPluginURL:function(){return Ku}},Oi=function(u,f){this.zoom=u,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new oh,this.transition={})};Oi.prototype.isSupportedScript=function(s){return function(u,f){for(var g=0,b=u;g<b.length;g+=1)if(!Qs(b[g].charCodeAt(0),f))return!1;return!0}(s,zs.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var s=this.zoom,u=s-Math.floor(s),f=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}};var fu=function(u,f){this.property=u,this.value=f,this.expression=function(g,b){if(eh(g))return new hc(g,b);if(Fl(g)){var S=rh(g,b);if(S.result==="error")throw new Error(S.value.map(function(R){return R.key+": "+R.message}).join(", "));return S.value}var T=g;return typeof g=="string"&&b.type==="color"&&(T=gi.parse(g)),{kind:"constant",evaluate:function(){return T}}}(f===void 0?u.specification.default:f,u.specification)};fu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},fu.prototype.possiblyEvaluate=function(s,u,f){return this.property.possiblyEvaluate(this,s,u,f)};var hu=function(u){this.property=u,this.value=new fu(u,void 0)};hu.prototype.transitioned=function(s,u){return new Hl(this.property,this.value,u,$e({},s.transition,this.transition),s.now)},hu.prototype.untransitioned=function(){return new Hl(this.property,this.value,null,{},0)};var Yo=function(u){this._properties=u,this._values=Object.create(u.defaultTransitionablePropertyValues)};Yo.prototype.getValue=function(s){return Be(this._values[s].value.value)},Yo.prototype.setValue=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new hu(this._values[s].property)),this._values[s].value=new fu(this._values[s].property,u===null?void 0:Be(u))},Yo.prototype.getTransition=function(s){return Be(this._values[s].transition)},Yo.prototype.setTransition=function(s,u){this._values.hasOwnProperty(s)||(this._values[s]=new hu(this._values[s].property)),this._values[s].transition=Be(u)||void 0},Yo.prototype.serialize=function(){for(var s={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u],b=this.getValue(g);b!==void 0&&(s[g]=b);var S=this.getTransition(g);S!==void 0&&(s[g+"-transition"]=S)}return s},Yo.prototype.transitioned=function(s,u){for(var f=new hl(this._properties),g=0,b=Object.keys(this._values);g<b.length;g+=1){var S=b[g];f._values[S]=this._values[S].transitioned(s,u._values[S])}return f},Yo.prototype.untransitioned=function(){for(var s=new hl(this._properties),u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u];s._values[g]=this._values[g].untransitioned()}return s};var Hl=function(u,f,g,b,S){this.property=u,this.value=f,this.begin=S+b.delay||0,this.end=this.begin+b.duration||0,u.specification.transition&&(b.delay||b.duration)&&(this.prior=g)};Hl.prototype.possiblyEvaluate=function(s,u,f){var g=s.now||0,b=this.value.possiblyEvaluate(s,u,f),S=this.prior;if(S){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return S.possiblyEvaluate(s,u,f);var T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(s,u,f),b,function(R){if(R<=0)return 0;if(R>=1)return 1;var F=R*R,V=F*R;return 4*(R<.5?V:3*(R-F)+V-.75)}(T))}return b};var hl=function(u){this._properties=u,this._values=Object.create(u.defaultTransitioningPropertyValues)};hl.prototype.possiblyEvaluate=function(s,u,f){for(var g=new pl(this._properties),b=0,S=Object.keys(this._values);b<S.length;b+=1){var T=S[b];g._values[T]=this._values[T].possiblyEvaluate(s,u,f)}return g},hl.prototype.hasTransition=function(){for(var s=0,u=Object.keys(this._values);s<u.length;s+=1)if(this._values[u[s]].prior)return!0;return!1};var pu=function(u){this._properties=u,this._values=Object.create(u.defaultPropertyValues)};pu.prototype.getValue=function(s){return Be(this._values[s].value)},pu.prototype.setValue=function(s,u){this._values[s]=new fu(this._values[s].property,u===null?void 0:Be(u))},pu.prototype.serialize=function(){for(var s={},u=0,f=Object.keys(this._values);u<f.length;u+=1){var g=f[u],b=this.getValue(g);b!==void 0&&(s[g]=b)}return s},pu.prototype.possiblyEvaluate=function(s,u,f){for(var g=new pl(this._properties),b=0,S=Object.keys(this._values);b<S.length;b+=1){var T=S[b];g._values[T]=this._values[T].possiblyEvaluate(s,u,f)}return g};var Ko=function(u,f,g){this.property=u,this.value=f,this.parameters=g};Ko.prototype.isConstant=function(){return this.value.kind==="constant"},Ko.prototype.constantOr=function(s){return this.value.kind==="constant"?this.value.value:s},Ko.prototype.evaluate=function(s,u,f,g){return this.property.evaluate(this.value,this.parameters,s,u,f,g)};var pl=function(u){this._properties=u,this._values=Object.create(u.defaultPossiblyEvaluatedValues)};pl.prototype.get=function(s){return this._values[s]};var ti=function(u){this.specification=u};ti.prototype.possiblyEvaluate=function(s,u){return s.expression.evaluate(u)},ti.prototype.interpolate=function(s,u,f){var g=qr[this.specification.type];return g?g(s,u,f):s};var jn=function(u,f){this.specification=u,this.overrides=f};jn.prototype.possiblyEvaluate=function(s,u,f,g){return new Ko(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(u,null,{},f,g)}:s.expression,u)},jn.prototype.interpolate=function(s,u,f){if(s.value.kind!=="constant"||u.value.kind!=="constant")return s;if(s.value.value===void 0||u.value.value===void 0)return new Ko(this,{kind:"constant",value:void 0},s.parameters);var g=qr[this.specification.type];return g?new Ko(this,{kind:"constant",value:g(s.value.value,u.value.value,f)},s.parameters):s},jn.prototype.evaluate=function(s,u,f,g,b,S){return s.kind==="constant"?s.value:s.evaluate(u,f,g,b,S)};var eu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,g,b,S){if(f.value===void 0)return new Ko(this,{kind:"constant",value:void 0},g);if(f.expression.kind==="constant"){var T=f.expression.evaluate(g,null,{},b,S),R=f.property.specification.type==="resolvedImage"&&typeof T!="string"?T.name:T,F=this._calculate(R,R,R,g);return new Ko(this,{kind:"constant",value:F},g)}if(f.expression.kind==="camera"){var V=this._calculate(f.expression.evaluate({zoom:g.zoom-1}),f.expression.evaluate({zoom:g.zoom}),f.expression.evaluate({zoom:g.zoom+1}),g);return new Ko(this,{kind:"constant",value:V},g)}return new Ko(this,f.expression,g)},u.prototype.evaluate=function(f,g,b,S,T,R){if(f.kind==="source"){var F=f.evaluate(g,b,S,T,R);return this._calculate(F,F,F,g)}return f.kind==="composite"?this._calculate(f.evaluate({zoom:Math.floor(g.zoom)-1},b,S),f.evaluate({zoom:Math.floor(g.zoom)},b,S),f.evaluate({zoom:Math.floor(g.zoom)+1},b,S),g):f.value},u.prototype._calculate=function(f,g,b,S){return S.zoom>S.zoomHistory.lastIntegerZoom?{from:f,to:g}:{from:b,to:g}},u.prototype.interpolate=function(f){return f},u}(jn),bs=function(u){this.specification=u};bs.prototype.possiblyEvaluate=function(s,u,f,g){if(s.value!==void 0){if(s.expression.kind==="constant"){var b=s.expression.evaluate(u,null,{},f,g);return this._calculate(b,b,b,u)}return this._calculate(s.expression.evaluate(new Oi(Math.floor(u.zoom-1),u)),s.expression.evaluate(new Oi(Math.floor(u.zoom),u)),s.expression.evaluate(new Oi(Math.floor(u.zoom+1),u)),u)}},bs.prototype._calculate=function(s,u,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:u}:{from:f,to:u}},bs.prototype.interpolate=function(s){return s};var Ru=function(u){this.specification=u};Ru.prototype.possiblyEvaluate=function(s,u,f,g){return!!s.expression.evaluate(u,null,{},f,g)},Ru.prototype.interpolate=function(){return!1};var $a=function(u){for(var f in this.properties=u,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],u){var g=u[f];g.specification.overridable&&this.overridableProperties.push(f);var b=this.defaultPropertyValues[f]=new fu(g,void 0),S=this.defaultTransitionablePropertyValues[f]=new hu(g);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}};kn("DataDrivenProperty",jn),kn("DataConstantProperty",ti),kn("CrossFadedDataDrivenProperty",eu),kn("CrossFadedProperty",bs),kn("ColorRampProperty",Ru);var _u=function(s){function u(f,g){if(s.call(this),this.id=f.id,this.type=f.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},f.type!=="custom"&&(this.metadata=(f=f).metadata,this.minzoom=f.minzoom,this.maxzoom=f.maxzoom,f.type!=="background"&&(this.source=f.source,this.sourceLayer=f["source-layer"],this.filter=f.filter),g.layout&&(this._unevaluatedLayout=new pu(g.layout)),g.paint)){for(var b in this._transitionablePaint=new Yo(g.paint),f.paint)this.setPaintProperty(b,f.paint[b],{validate:!1});for(var S in f.layout)this.setLayoutProperty(S,f.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pl(g.paint)}}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(f){return f==="visibility"?this.visibility:this._unevaluatedLayout.getValue(f)},u.prototype.setLayoutProperty=function(f,g,b){b===void 0&&(b={}),g!=null&&this._validate(Tf,"layers."+this.id+".layout."+f,f,g,b)||(f!=="visibility"?this._unevaluatedLayout.setValue(f,g):this.visibility=g)},u.prototype.getPaintProperty=function(f){return jr(f,"-transition")?this._transitionablePaint.getTransition(f.slice(0,-"-transition".length)):this._transitionablePaint.getValue(f)},u.prototype.setPaintProperty=function(f,g,b){if(b===void 0&&(b={}),g!=null&&this._validate(ah,"layers."+this.id+".paint."+f,f,g,b))return!1;if(jr(f,"-transition"))return this._transitionablePaint.setTransition(f.slice(0,-"-transition".length),g||void 0),!1;var S=this._transitionablePaint._values[f],T=S.property.specification["property-type"]==="cross-faded-data-driven",R=S.value.isDataDriven(),F=S.value;this._transitionablePaint.setValue(f,g),this._handleSpecialPaintPropertyUpdate(f);var V=this._transitionablePaint._values[f].value;return V.isDataDriven()||R||T||this._handleOverridablePaintPropertyUpdate(f,F,V)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){},u.prototype._handleOverridablePaintPropertyUpdate=function(f,g,b){return!1},u.prototype.isHidden=function(f){return!!(this.minzoom&&f<this.minzoom)||!!(this.maxzoom&&f>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(f){this._transitioningPaint=this._transitionablePaint.transitioned(f,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(f,g){f.getCrossfadeParameters&&(this._crossfadeParameters=f.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(f,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(f,void 0,g)},u.prototype.serialize=function(){var f={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(f.layout=f.layout||{},f.layout.visibility=this.visibility),Jt(f,function(g,b){return!(g===void 0||b==="layout"&&!Object.keys(g).length||b==="paint"&&!Object.keys(g).length)})},u.prototype._validate=function(f,g,b,S,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&Vl(this,f.call(Af,{key:g,layerType:this.type,objectKey:b,value:S,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var f in this.paint._values){var g=this.paint.get(f);if(g instanceof Ko&&ll(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1},u}(St),dl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},vl=function(u,f){this._structArray=u,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},pa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function No(s,u){u===void 0&&(u=1);var f=0,g=0;return{members:s.map(function(b){var S=dl[b.type].BYTES_PER_ELEMENT,T=f=Hh(f,Math.max(u,S)),R=b.components||1;return g=Math.max(g,S),f+=S*R,{name:b.name,type:b.type,components:R,offset:T}}),size:Hh(f,Math.max(g,u)),alignment:u}}function Hh(s,u){return Math.ceil(s/u)*u}pa.serialize=function(s,u){return s._trim(),u&&(s.isTransferred=!0,u.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}},pa.deserialize=function(s){var u=Object.create(this.prototype);return u.arrayBuffer=s.arrayBuffer,u.length=s.length,u.capacity=s.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},pa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},pa.prototype.clear=function(){this.length=0},pa.prototype.resize=function(s){this.reserve(s),this.length=s},pa.prototype.reserve=function(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},pa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Wl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var S=2*f;return this.int16[S+0]=g,this.int16[S+1]=b,f},u}(pa);Wl.prototype.bytesPerElement=4,kn("StructArrayLayout2i4",Wl);var ch=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,S)},u.prototype.emplace=function(f,g,b,S,T){var R=4*f;return this.int16[R+0]=g,this.int16[R+1]=b,this.int16[R+2]=S,this.int16[R+3]=T,f},u}(pa);ch.prototype.bytesPerElement=8,kn("StructArrayLayout4i8",ch);var ml=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R){var F=this.length;return this.resize(F+1),this.emplace(F,f,g,b,S,T,R)},u.prototype.emplace=function(f,g,b,S,T,R,F){var V=6*f;return this.int16[V+0]=g,this.int16[V+1]=b,this.int16[V+2]=S,this.int16[V+3]=T,this.int16[V+4]=R,this.int16[V+5]=F,f},u}(pa);ml.prototype.bytesPerElement=12,kn("StructArrayLayout2i4i12",ml);var tu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R){var F=this.length;return this.resize(F+1),this.emplace(F,f,g,b,S,T,R)},u.prototype.emplace=function(f,g,b,S,T,R,F){var V=4*f,$=8*f;return this.int16[V+0]=g,this.int16[V+1]=b,this.uint8[$+4]=S,this.uint8[$+5]=T,this.uint8[$+6]=R,this.uint8[$+7]=F,f},u}(pa);tu.prototype.bytesPerElement=8,kn("StructArrayLayout2i4ub8",tu);var Xc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var S=2*f;return this.float32[S+0]=g,this.float32[S+1]=b,f},u}(pa);Xc.prototype.bytesPerElement=8,kn("StructArrayLayout2f8",Xc);var bu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R,F,V,$,J){var re=this.length;return this.resize(re+1),this.emplace(re,f,g,b,S,T,R,F,V,$,J)},u.prototype.emplace=function(f,g,b,S,T,R,F,V,$,J,re){var xe=10*f;return this.uint16[xe+0]=g,this.uint16[xe+1]=b,this.uint16[xe+2]=S,this.uint16[xe+3]=T,this.uint16[xe+4]=R,this.uint16[xe+5]=F,this.uint16[xe+6]=V,this.uint16[xe+7]=$,this.uint16[xe+8]=J,this.uint16[xe+9]=re,f},u}(pa);bu.prototype.bytesPerElement=20,kn("StructArrayLayout10ui20",bu);var fh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R,F,V,$,J,re,xe){var ze=this.length;return this.resize(ze+1),this.emplace(ze,f,g,b,S,T,R,F,V,$,J,re,xe)},u.prototype.emplace=function(f,g,b,S,T,R,F,V,$,J,re,xe,ze){var Fe=12*f;return this.int16[Fe+0]=g,this.int16[Fe+1]=b,this.int16[Fe+2]=S,this.int16[Fe+3]=T,this.uint16[Fe+4]=R,this.uint16[Fe+5]=F,this.uint16[Fe+6]=V,this.uint16[Fe+7]=$,this.int16[Fe+8]=J,this.int16[Fe+9]=re,this.int16[Fe+10]=xe,this.int16[Fe+11]=ze,f},u}(pa);fh.prototype.bytesPerElement=24,kn("StructArrayLayout4i4ui4i24",fh);var Zc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,b)},u.prototype.emplace=function(f,g,b,S){var T=3*f;return this.float32[T+0]=g,this.float32[T+1]=b,this.float32[T+2]=S,f},u}(pa);Zc.prototype.bytesPerElement=12,kn("StructArrayLayout3f12",Zc);var hh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.uint32[1*f+0]=g,f},u}(pa);hh.prototype.bytesPerElement=4,kn("StructArrayLayout1ul4",hh);var vc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R,F,V,$){var J=this.length;return this.resize(J+1),this.emplace(J,f,g,b,S,T,R,F,V,$)},u.prototype.emplace=function(f,g,b,S,T,R,F,V,$,J){var re=10*f,xe=5*f;return this.int16[re+0]=g,this.int16[re+1]=b,this.int16[re+2]=S,this.int16[re+3]=T,this.int16[re+4]=R,this.int16[re+5]=F,this.uint32[xe+3]=V,this.uint16[re+8]=$,this.uint16[re+9]=J,f},u}(pa);vc.prototype.bytesPerElement=20,kn("StructArrayLayout6i1ul2ui20",vc);var $c=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R){var F=this.length;return this.resize(F+1),this.emplace(F,f,g,b,S,T,R)},u.prototype.emplace=function(f,g,b,S,T,R,F){var V=6*f;return this.int16[V+0]=g,this.int16[V+1]=b,this.int16[V+2]=S,this.int16[V+3]=T,this.int16[V+4]=R,this.int16[V+5]=F,f},u}(pa);$c.prototype.bytesPerElement=12,kn("StructArrayLayout2i2i2i12",$c);var Yc=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T){var R=this.length;return this.resize(R+1),this.emplace(R,f,g,b,S,T)},u.prototype.emplace=function(f,g,b,S,T,R){var F=4*f,V=8*f;return this.float32[F+0]=g,this.float32[F+1]=b,this.float32[F+2]=S,this.int16[V+6]=T,this.int16[V+7]=R,f},u}(pa);Yc.prototype.bytesPerElement=16,kn("StructArrayLayout2f1f2i16",Yc);var Wh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,S)},u.prototype.emplace=function(f,g,b,S,T){var R=12*f,F=3*f;return this.uint8[R+0]=g,this.uint8[R+1]=b,this.float32[F+1]=S,this.float32[F+2]=T,f},u}(pa);Wh.prototype.bytesPerElement=12,kn("StructArrayLayout2ub2f12",Wh);var L=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,b)},u.prototype.emplace=function(f,g,b,S){var T=3*f;return this.uint16[T+0]=g,this.uint16[T+1]=b,this.uint16[T+2]=S,f},u}(pa);L.prototype.bytesPerElement=6,kn("StructArrayLayout3ui6",L);var xu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt){var Ht=this.length;return this.resize(Ht+1),this.emplace(Ht,f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt)},u.prototype.emplace=function(f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt,Ht){var ar=24*f,Mr=12*f,gr=48*f;return this.int16[ar+0]=g,this.int16[ar+1]=b,this.uint16[ar+2]=S,this.uint16[ar+3]=T,this.uint32[Mr+2]=R,this.uint32[Mr+3]=F,this.uint32[Mr+4]=V,this.uint16[ar+10]=$,this.uint16[ar+11]=J,this.uint16[ar+12]=re,this.float32[Mr+7]=xe,this.float32[Mr+8]=ze,this.uint8[gr+36]=Fe,this.uint8[gr+37]=lt,this.uint8[gr+38]=ct,this.uint32[Mr+10]=wt,this.int16[ar+22]=Ht,f},u}(pa);xu.prototype.bytesPerElement=48,kn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xu);var Gh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt,Ht,ar,Mr,gr,un,fn,Fn,$n,Un,In,Si){var ai=this.length;return this.resize(ai+1),this.emplace(ai,f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt,Ht,ar,Mr,gr,un,fn,Fn,$n,Un,In,Si)},u.prototype.emplace=function(f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe,lt,ct,wt,Ht,ar,Mr,gr,un,fn,Fn,$n,Un,In,Si,ai){var qn=34*f,ea=17*f;return this.int16[qn+0]=g,this.int16[qn+1]=b,this.int16[qn+2]=S,this.int16[qn+3]=T,this.int16[qn+4]=R,this.int16[qn+5]=F,this.int16[qn+6]=V,this.int16[qn+7]=$,this.uint16[qn+8]=J,this.uint16[qn+9]=re,this.uint16[qn+10]=xe,this.uint16[qn+11]=ze,this.uint16[qn+12]=Fe,this.uint16[qn+13]=lt,this.uint16[qn+14]=ct,this.uint16[qn+15]=wt,this.uint16[qn+16]=Ht,this.uint16[qn+17]=ar,this.uint16[qn+18]=Mr,this.uint16[qn+19]=gr,this.uint16[qn+20]=un,this.uint16[qn+21]=fn,this.uint16[qn+22]=Fn,this.uint32[ea+12]=$n,this.float32[ea+13]=Un,this.float32[ea+14]=In,this.float32[ea+15]=Si,this.float32[ea+16]=ai,f},u}(pa);Gh.prototype.bytesPerElement=68,kn("StructArrayLayout8i15ui1ul4f68",Gh);var qu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.float32[1*f+0]=g,f},u}(pa);qu.prototype.bytesPerElement=4,kn("StructArrayLayout1f4",qu);var Eu=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,b)},u.prototype.emplace=function(f,g,b,S){var T=3*f;return this.int16[T+0]=g,this.int16[T+1]=b,this.int16[T+2]=S,f},u}(pa);Eu.prototype.bytesPerElement=6,kn("StructArrayLayout3i6",Eu);var Of=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b){var S=this.length;return this.resize(S+1),this.emplace(S,f,g,b)},u.prototype.emplace=function(f,g,b,S){var T=4*f;return this.uint32[2*f+0]=g,this.uint16[T+2]=b,this.uint16[T+3]=S,f},u}(pa);Of.prototype.bytesPerElement=8,kn("StructArrayLayout1ul2ui8",Of);var Gl=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g){var b=this.length;return this.resize(b+1),this.emplace(b,f,g)},u.prototype.emplace=function(f,g,b){var S=2*f;return this.uint16[S+0]=g,this.uint16[S+1]=b,f},u}(pa);Gl.prototype.bytesPerElement=4,kn("StructArrayLayout2ui4",Gl);var ph=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f){var g=this.length;return this.resize(g+1),this.emplace(g,f)},u.prototype.emplace=function(f,g){return this.uint16[1*f+0]=g,f},u}(pa);ph.prototype.bytesPerElement=2,kn("StructArrayLayout1ui2",ph);var dh=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(f,g,b,S){var T=this.length;return this.resize(T+1),this.emplace(T,f,g,b,S)},u.prototype.emplace=function(f,g,b,S,T){var R=4*f;return this.float32[R+0]=g,this.float32[R+1]=b,this.float32[R+2]=S,this.float32[R+3]=T,f},u}(pa);dh.prototype.bytesPerElement=16,kn("StructArrayLayout4f16",dh);var m=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return f.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},f.x1.get=function(){return this._structArray.int16[this._pos2+2]},f.y1.get=function(){return this._structArray.int16[this._pos2+3]},f.x2.get=function(){return this._structArray.int16[this._pos2+4]},f.y2.get=function(){return this._structArray.int16[this._pos2+5]},f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,f),u}(vl);m.prototype.size=20;var d=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new m(this,f)},u}(vc);kn("CollisionBoxArray",d);var p=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},f.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},f.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},f.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},f.segment.get=function(){return this._structArray.uint16[this._pos2+10]},f.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},f.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},f.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},f.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},f.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},f.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},f.placedOrientation.set=function(g){this._structArray.uint8[this._pos1+37]=g},f.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},f.hidden.set=function(g){this._structArray.uint8[this._pos1+38]=g},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+10]=g},f.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,f),u}(vl);p.prototype.size=48;var y=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new p(this,f)},u}(xu);kn("PlacedSymbolArray",y);var A=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return f.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},f.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},f.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},f.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},f.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},f.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},f.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},f.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},f.key.get=function(){return this._structArray.uint16[this._pos2+8]},f.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},f.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},f.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},f.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},f.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},f.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},f.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},f.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},f.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},f.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},f.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},f.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},f.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},f.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},f.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},f.crossTileID.set=function(g){this._structArray.uint32[this._pos4+12]=g},f.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},f.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},f.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},f.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,f),u}(vl);A.prototype.size=68;var w=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new A(this,f)},u}(Gh);kn("SymbolInstanceArray",w);var M=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getoffsetX=function(f){return this.float32[1*f+0]},u}(qu);kn("GlyphOffsetArray",M);var k=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.getx=function(f){return this.int16[3*f+0]},u.prototype.gety=function(f){return this.int16[3*f+1]},u.prototype.gettileUnitDistanceFromAnchor=function(f){return this.int16[3*f+2]},u}(Eu);kn("SymbolLineVertexArray",k);var G=function(s){function u(){s.apply(this,arguments)}s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u;var f={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return f.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},f.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},f.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,f),u}(vl);G.prototype.size=8;var q=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.get=function(f){return new G(this,f)},u}(Of);kn("FeatureIndexArray",q);var pe=No([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(u){u===void 0&&(u=[]),this.segments=u};function be(s,u){return 256*(s=Dt(Math.floor(s),0,255))+Dt(Math.floor(u),0,255)}ye.prototype.prepareSegment=function(s,u,f,g){var b=this.segments[this.segments.length-1];return s>ye.MAX_VERTEX_ARRAY_LENGTH&&Gt("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+s),(!b||b.vertexLength+s>ye.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var s=0,u=this.segments;s<u.length;s+=1){var f=u[s];for(var g in f.vaos)f.vaos[g].destroy()}},ye.simpleSegment=function(s,u,f,g){return new ye([{vertexOffset:s,primitiveOffset:u,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,kn("SegmentVector",ye);var qe=No([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ue=z(function(s){s.exports=function(u,f){var g,b,S,T,R,F,V,$;for(b=u.length-(g=3&u.length),S=f,R=3432918353,F=461845907,$=0;$<b;)V=255&u.charCodeAt($)|(255&u.charCodeAt(++$))<<8|(255&u.charCodeAt(++$))<<16|(255&u.charCodeAt(++$))<<24,++$,S=27492+(65535&(T=5*(65535&(S=(S^=V=(65535&(V=(V=(65535&V)*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*F+(((V>>>16)*F&65535)<<16)&4294967295)<<13|S>>>19))+((5*(S>>>16)&65535)<<16)&4294967295))+((58964+(T>>>16)&65535)<<16);switch(V=0,g){case 3:V^=(255&u.charCodeAt($+2))<<16;case 2:V^=(255&u.charCodeAt($+1))<<8;case 1:S^=V=(65535&(V=(V=(65535&(V^=255&u.charCodeAt($)))*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*F+(((V>>>16)*F&65535)<<16)&4294967295}return S^=u.length,S=2246822507*(65535&(S^=S>>>16))+((2246822507*(S>>>16)&65535)<<16)&4294967295,S=3266489909*(65535&(S^=S>>>13))+((3266489909*(S>>>16)&65535)<<16)&4294967295,(S^=S>>>16)>>>0}}),ht=z(function(s){s.exports=function(u,f){for(var g,b=u.length,S=f^b,T=0;b>=4;)g=1540483477*(65535&(g=255&u.charCodeAt(T)|(255&u.charCodeAt(++T))<<8|(255&u.charCodeAt(++T))<<16|(255&u.charCodeAt(++T))<<24))+((1540483477*(g>>>16)&65535)<<16),S=1540483477*(65535&S)+((1540483477*(S>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),b-=4,++T;switch(b){case 3:S^=(255&u.charCodeAt(T+2))<<16;case 2:S^=(255&u.charCodeAt(T+1))<<8;case 1:S=1540483477*(65535&(S^=255&u.charCodeAt(T)))+((1540483477*(S>>>16)&65535)<<16)}return S=1540483477*(65535&(S^=S>>>13))+((1540483477*(S>>>16)&65535)<<16),(S^=S>>>15)>>>0}}),We=Ue,nt=ht;We.murmur3=Ue,We.murmur2=nt;var Mt=function(){this.ids=[],this.positions=[],this.indexed=!1};Mt.prototype.add=function(s,u,f,g){this.ids.push(vr(s)),this.positions.push(u,f,g)},Mt.prototype.getPositions=function(s){for(var u=vr(s),f=0,g=this.ids.length-1;f<g;){var b=f+g>>1;this.ids[b]>=u?g=b:f=b+1}for(var S=[];this.ids[f]===u;)S.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return S},Mt.serialize=function(s,u){var f=new Float64Array(s.ids),g=new Uint32Array(s.positions);return function b(S,T,R,F){for(;R<F;){for(var V=S[R+F>>1],$=R-1,J=F+1;;){do $++;while(S[$]<V);do J--;while(S[J]>V);if($>=J)break;rr(S,$,J),rr(T,3*$,3*J),rr(T,3*$+1,3*J+1),rr(T,3*$+2,3*J+2)}J-R<F-J?(b(S,T,R,J),R=J+1):(b(S,T,J+1,F),F=J)}}(f,g,0,f.length-1),u&&u.push(f.buffer,g.buffer),{ids:f,positions:g}},Mt.deserialize=function(s){var u=new Mt;return u.ids=s.ids,u.positions=s.positions,u.indexed=!0,u};var Pt=Math.pow(2,53)-1;function vr(s){var u=+s;return!isNaN(u)&&u<=Pt?u:We(String(s))}function rr(s,u,f){var g=s[u];s[u]=s[f],s[f]=g}kn("FeaturePositionMap",Mt);var br=function(u,f){this.gl=u.gl,this.location=f},wr=function(s){function u(f,g){s.call(this,f,g),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))},u}(br),$r=function(s){function u(f,g){s.call(this,f,g),this.current=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))},u}(br),Qr=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))},u}(br),_n=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))},u}(br),Ln=function(s){function u(f,g){s.call(this,f,g),this.current=[0,0,0,0]}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3]))},u}(br),si=function(s){function u(f,g){s.call(this,f,g),this.current=gi.transparent}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a))},u}(br),hi=new Float32Array(16),Wi=function(s){function u(f,g){s.call(this,f,g),this.current=hi}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.set=function(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(var g=1;g<16;g++)if(f[g]!==this.current[g]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}},u}(br);function Qi(s){return[be(255*s.r,255*s.g),be(255*s.b,255*s.a)]}var An=function(u,f,g){this.value=u,this.uniformNames=f.map(function(b){return"u_"+b}),this.type=g};An.prototype.setUniform=function(s,u,f){s.set(f.constantOr(this.value))},An.prototype.getBinding=function(s,u,f){return this.type==="color"?new si(s,u):new $r(s,u)};var Ri=function(u,f){this.uniformNames=f.map(function(g){return"u_"+g}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Ri.prototype.setConstantPatternPositions=function(s,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=s.tlbr},Ri.prototype.setUniform=function(s,u,f,g){var b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&s.set(b)},Ri.prototype.getBinding=function(s,u,f){return f.substr(0,9)==="u_pattern"?new Ln(s,u):new $r(s,u)};var Pi=function(u,f,g,b){this.expression=u,this.type=g,this.maxValue=0,this.paintVertexAttributes=f.map(function(S){return{name:"a_"+S,type:"Float32",components:g==="color"?2:1,offset:0}}),this.paintVertexArray=new b};Pi.prototype.populatePaintArray=function(s,u,f,g,b){var S=this.paintVertexArray.length,T=this.expression.evaluate(new Oi(0),u,{},g,[],b);this.paintVertexArray.resize(s),this._setPaintValue(S,s,T)},Pi.prototype.updatePaintArray=function(s,u,f,g){var b=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(s,u,b)},Pi.prototype._setPaintValue=function(s,u,f){if(this.type==="color")for(var g=Qi(f),b=s;b<u;b++)this.paintVertexArray.emplace(b,g[0],g[1]);else{for(var S=s;S<u;S++)this.paintVertexArray.emplace(S,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}},Pi.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Pi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Xn=function(u,f,g,b,S,T){this.expression=u,this.uniformNames=f.map(function(R){return"u_"+R+"_t"}),this.type=g,this.useIntegerZoom=b,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=f.map(function(R){return{name:"a_"+R,type:"Float32",components:g==="color"?4:2,offset:0}}),this.paintVertexArray=new T};Xn.prototype.populatePaintArray=function(s,u,f,g,b){var S=this.expression.evaluate(new Oi(this.zoom),u,{},g,[],b),T=this.expression.evaluate(new Oi(this.zoom+1),u,{},g,[],b),R=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(R,s,S,T)},Xn.prototype.updatePaintArray=function(s,u,f,g){var b=this.expression.evaluate({zoom:this.zoom},f,g),S=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(s,u,b,S)},Xn.prototype._setPaintValue=function(s,u,f,g){if(this.type==="color")for(var b=Qi(f),S=Qi(g),T=s;T<u;T++)this.paintVertexArray.emplace(T,b[0],b[1],S[0],S[1]);else{for(var R=s;R<u;R++)this.paintVertexArray.emplace(R,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}},Xn.prototype.upload=function(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Xn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Xn.prototype.setUniform=function(s,u){var f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,g=Dt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);s.set(g)},Xn.prototype.getBinding=function(s,u,f){return new $r(s,u)};var Ii=function(u,f,g,b,S,T){this.expression=u,this.type=f,this.useIntegerZoom=g,this.zoom=b,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S};Ii.prototype.populatePaintArray=function(s,u,f){var g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(g,s,u.patterns&&u.patterns[this.layerId],f)},Ii.prototype.updatePaintArray=function(s,u,f,g,b){this._setPaintValues(s,u,f.patterns&&f.patterns[this.layerId],b)},Ii.prototype._setPaintValues=function(s,u,f,g){if(g&&f){var b=g[f.min],S=g[f.mid],T=g[f.max];if(b&&S&&T)for(var R=s;R<u;R++)this.zoomInPaintVertexArray.emplace(R,S.tl[0],S.tl[1],S.br[0],S.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],S.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,S.tl[0],S.tl[1],S.br[0],S.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],S.pixelRatio,T.pixelRatio)}},Ii.prototype.upload=function(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,qe.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,qe.members,this.expression.isStateDependent))},Ii.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var ui=function(u,f,g){this.binders={},this._buffers=[];var b=[];for(var S in u.paint._values)if(g(S)){var T=u.paint.get(S);if(T instanceof Ko&&ll(T.property.specification)){var R=Ji(S,u.type),F=T.value,V=T.property.specification.type,$=T.property.useIntegerZoom,J=T.property.specification["property-type"],re=J==="cross-faded"||J==="cross-faded-data-driven";if(F.kind==="constant")this.binders[S]=re?new Ri(F.value,R):new An(F.value,R,V),b.push("/u_"+S);else if(F.kind==="source"||re){var xe=Ao(S,V,"source");this.binders[S]=re?new Ii(F,V,$,f,xe,u.id):new Pi(F,R,V,xe),b.push("/a_"+S)}else{var ze=Ao(S,V,"composite");this.binders[S]=new Xn(F,R,V,$,f,ze),b.push("/z_"+S)}}}this.cacheKey=b.sort().join("")};ui.prototype.getMaxValue=function(s){var u=this.binders[s];return u instanceof Pi||u instanceof Xn?u.maxValue:0},ui.prototype.populatePaintArrays=function(s,u,f,g,b){for(var S in this.binders){var T=this.binders[S];(T instanceof Pi||T instanceof Xn||T instanceof Ii)&&T.populatePaintArray(s,u,f,g,b)}},ui.prototype.setConstantPatternPositions=function(s,u){for(var f in this.binders){var g=this.binders[f];g instanceof Ri&&g.setConstantPatternPositions(s,u)}},ui.prototype.updatePaintArrays=function(s,u,f,g,b){var S=!1;for(var T in s)for(var R=0,F=u.getPositions(T);R<F.length;R+=1){var V=F[R],$=f.feature(V.index);for(var J in this.binders){var re=this.binders[J];if((re instanceof Pi||re instanceof Xn||re instanceof Ii)&&re.expression.isStateDependent===!0){var xe=g.paint.get(J);re.expression=xe.value,re.updatePaintArray(V.start,V.end,$,s[T],b),S=!0}}}return S},ui.prototype.defines=function(){var s=[];for(var u in this.binders){var f=this.binders[u];(f instanceof An||f instanceof Ri)&&s.push.apply(s,f.uniformNames.map(function(g){return"#define HAS_UNIFORM_"+g}))}return s},ui.prototype.getBinderAttributes=function(){var s=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof Pi||f instanceof Xn)for(var g=0;g<f.paintVertexAttributes.length;g++)s.push(f.paintVertexAttributes[g].name);else if(f instanceof Ii)for(var b=0;b<qe.members.length;b++)s.push(qe.members[b].name)}return s},ui.prototype.getBinderUniforms=function(){var s=[];for(var u in this.binders){var f=this.binders[u];if(f instanceof An||f instanceof Ri||f instanceof Xn)for(var g=0,b=f.uniformNames;g<b.length;g+=1)s.push(b[g])}return s},ui.prototype.getPaintVertexBuffers=function(){return this._buffers},ui.prototype.getUniforms=function(s,u){var f=[];for(var g in this.binders){var b=this.binders[g];if(b instanceof An||b instanceof Ri||b instanceof Xn)for(var S=0,T=b.uniformNames;S<T.length;S+=1){var R=T[S];if(u[R]){var F=b.getBinding(s,u[R],R);f.push({name:R,property:g,binding:F})}}}return f},ui.prototype.setUniforms=function(s,u,f,g){for(var b=0,S=u;b<S.length;b+=1){var T=S[b],R=T.name,F=T.property;this.binders[F].setUniform(T.binding,g,f.get(F),R)}},ui.prototype.updatePaintBuffers=function(s){for(var u in this._buffers=[],this.binders){var f=this.binders[u];if(s&&f instanceof Ii){var g=s.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof Pi||f instanceof Xn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}},ui.prototype.upload=function(s){for(var u in this.binders){var f=this.binders[u];(f instanceof Pi||f instanceof Xn||f instanceof Ii)&&f.upload(s)}this.updatePaintBuffers()},ui.prototype.destroy=function(){for(var s in this.binders){var u=this.binders[s];(u instanceof Pi||u instanceof Xn||u instanceof Ii)&&u.destroy()}};var zi=function(u,f,g){g===void 0&&(g=function(){return!0}),this.programConfigurations={};for(var b=0,S=u;b<S.length;b+=1){var T=S[b];this.programConfigurations[T.id]=new ui(T,f,g)}this.needsUpload=!1,this._featureMap=new Mt,this._bufferOffset=0};function Ji(s,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(u+"-","").replace(/-/g,"_")]}function Ao(s,u,f){var g={color:{source:Xc,composite:dh},number:{source:qu,composite:Xc}},b=function(S){return{"line-pattern":{source:bu,composite:bu},"fill-pattern":{source:bu,composite:bu},"fill-extrusion-pattern":{source:bu,composite:bu}}[S]}(s);return b&&b[f]||g[u][f]}zi.prototype.populatePaintArrays=function(s,u,f,g,b,S){for(var T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(s,u,g,b,S);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0},zi.prototype.updatePaintArrays=function(s,u,f,g){for(var b=0,S=f;b<S.length;b+=1){var T=S[b];this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(s,this._featureMap,u,T,g)||this.needsUpload}},zi.prototype.get=function(s){return this.programConfigurations[s]},zi.prototype.upload=function(s){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(s);this.needsUpload=!1}},zi.prototype.destroy=function(){for(var s in this.programConfigurations)this.programConfigurations[s].destroy()},kn("ConstantBinder",An),kn("CrossFadedConstantBinder",Ri),kn("SourceExpressionBinder",Pi),kn("CrossFadedCompositeBinder",Ii),kn("CompositeExpressionBinder",Xn),kn("ProgramConfiguration",ui,{omit:["_buffers"]}),kn("ProgramConfigurationSet",zi);var so=Math.pow(2,14)-1,Mo=-so-1;function Ya(s){for(var u=8192/s.extent,f=s.loadGeometry(),g=0;g<f.length;g++)for(var b=f[g],S=0;S<b.length;S++){var T=b[S],R=Math.round(T.x*u),F=Math.round(T.y*u);T.x=Dt(R,Mo,so),T.y=Dt(F,Mo,so),(R<T.x||R>T.x+1||F<T.y||F>T.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return f}function Ka(s,u){return{type:s.type,id:s.id,properties:s.properties,geometry:u?Ya(s):[]}}function ru(s,u,f,g,b){s.emplaceBack(2*u+(g+1)/2,2*f+(b+1)/2)}var ss=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new Wl,this.indexArray=new L,this.segments=new ye,this.programConfigurations=new zi(u.layers,u.zoom),this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};function Qu(s,u){for(var f=0;f<s.length;f++)if(Xt(u,s[f]))return!0;for(var g=0;g<u.length;g++)if(Xt(s,u[g]))return!0;return!!Xl(s,u)}function Mu(s,u,f){return!!Xt(s,u)||!!Su(u,s,f)}function us(s,u){if(s.length===1)return Ju(u,s[0]);for(var f=0;f<u.length;f++)for(var g=u[f],b=0;b<g.length;b++)if(Xt(s,g[b]))return!0;for(var S=0;S<s.length;S++)if(Ju(u,s[S]))return!0;for(var T=0;T<u.length;T++)if(Xl(s,u[T]))return!0;return!1}function xs(s,u,f){if(s.length>1){if(Xl(s,u))return!0;for(var g=0;g<u.length;g++)if(Su(u[g],s,f))return!0}for(var b=0;b<s.length;b++)if(Su(s[b],u,f))return!0;return!1}function Xl(s,u){if(s.length===0||u.length===0)return!1;for(var f=0;f<s.length-1;f++)for(var g=s[f],b=s[f+1],S=0;S<u.length-1;S++)if(Kc(g,b,u[S],u[S+1]))return!0;return!1}function Kc(s,u,f,g){return Te(s,f,g)!==Te(u,f,g)&&Te(s,u,f)!==Te(s,u,g)}function Su(s,u,f){var g=f*f;if(u.length===1)return s.distSqr(u[0])<g;for(var b=1;b<u.length;b++)if(Zl(s,u[b-1],u[b])<g)return!0;return!1}function Zl(s,u,f){var g=u.distSqr(f);if(g===0)return s.distSqr(u);var b=((s.x-u.x)*(f.x-u.x)+(s.y-u.y)*(f.y-u.y))/g;return s.distSqr(b<0?u:b>1?f:f.sub(u)._mult(b)._add(u))}function Ju(s,u){for(var f,g,b,S=!1,T=0;T<s.length;T++)for(var R=0,F=(f=s[T]).length-1;R<f.length;F=R++)(g=f[R]).y>u.y!=(b=f[F]).y>u.y&&u.x<(b.x-g.x)*(u.y-g.y)/(b.y-g.y)+g.x&&(S=!S);return S}function Xt(s,u){for(var f=!1,g=0,b=s.length-1;g<s.length;b=g++){var S=s[g],T=s[b];S.y>u.y!=T.y>u.y&&u.x<(T.x-S.x)*(u.y-S.y)/(T.y-S.y)+S.x&&(f=!f)}return f}function De(s,u,f){var g=f[0],b=f[2];if(s.x<g.x&&u.x<g.x||s.x>b.x&&u.x>b.x||s.y<g.y&&u.y<g.y||s.y>b.y&&u.y>b.y)return!1;var S=Te(s,u,f[0]);return S!==Te(s,u,f[1])||S!==Te(s,u,f[2])||S!==Te(s,u,f[3])}function ls(s,u,f){var g=u.paint.get(s).value;return g.kind==="constant"?g.value:f.programConfigurations.get(u.id).getMaxValue(s)}function he(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Us(s,u,f,g,b){if(!u[0]&&!u[1])return s;var S=se.convert(u)._mult(b);f==="viewport"&&S._rotate(-g);for(var T=[],R=0;R<s.length;R++)T.push(s[R].sub(S));return T}ss.prototype.populate=function(s,u,f){var g=this.layers[0],b=[],S=null;g.type==="circle"&&(S=g.layout.get("circle-sort-key"));for(var T=0,R=s;T<R.length;T+=1){var F=R[T],V=F.feature,$=F.id,J=F.index,re=F.sourceLayerIndex,xe=this.layers[0]._featureFilter.needGeometry,ze=Ka(V,xe);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ze,f)){var Fe=S?S.evaluate(ze,{},f):void 0,lt={id:$,properties:V.properties,type:V.type,sourceLayerIndex:re,index:J,geometry:xe?ze.geometry:Ya(V),patterns:{},sortKey:Fe};b.push(lt)}}S&&b.sort(function(fn,Fn){return fn.sortKey-Fn.sortKey});for(var ct=0,wt=b;ct<wt.length;ct+=1){var Ht=wt[ct],ar=Ht.geometry,Mr=Ht.index,gr=Ht.sourceLayerIndex,un=s[Mr].feature;this.addFeature(Ht,ar,Mr,f),u.featureIndex.insert(un,ar,Mr,gr,this.index)}},ss.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ss.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,pe),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ss.prototype.addFeature=function(s,u,f,g){for(var b=0,S=u;b<S.length;b+=1)for(var T=0,R=S[b];T<R.length;T+=1){var F=R[T],V=F.x,$=F.y;if(!(V<0||V>=8192||$<0||$>=8192)){var J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),re=J.vertexLength;ru(this.layoutVertexArray,V,$,-1,-1),ru(this.layoutVertexArray,V,$,1,-1),ru(this.layoutVertexArray,V,$,1,1),ru(this.layoutVertexArray,V,$,-1,1),this.indexArray.emplaceBack(re,re+1,re+2),this.indexArray.emplaceBack(re,re+3,re+2),J.vertexLength+=4,J.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,{},g)},kn("CircleBucket",ss,{omit:["layers"]});var uo=new $a({"circle-sort-key":new jn(ge.layout_circle["circle-sort-key"])}),nu={paint:new $a({"circle-radius":new jn(ge.paint_circle["circle-radius"]),"circle-color":new jn(ge.paint_circle["circle-color"]),"circle-blur":new jn(ge.paint_circle["circle-blur"]),"circle-opacity":new jn(ge.paint_circle["circle-opacity"]),"circle-translate":new ti(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new ti(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ti(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ti(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new jn(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new jn(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new jn(ge.paint_circle["circle-stroke-opacity"])}),layout:uo},qa=typeof Float32Array!="undefined"?Float32Array:Array;function Da(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function xo(s,u,f){var g=u[0],b=u[1],S=u[2],T=u[3],R=u[4],F=u[5],V=u[6],$=u[7],J=u[8],re=u[9],xe=u[10],ze=u[11],Fe=u[12],lt=u[13],ct=u[14],wt=u[15],Ht=f[0],ar=f[1],Mr=f[2],gr=f[3];return s[0]=Ht*g+ar*R+Mr*J+gr*Fe,s[1]=Ht*b+ar*F+Mr*re+gr*lt,s[2]=Ht*S+ar*V+Mr*xe+gr*ct,s[3]=Ht*T+ar*$+Mr*ze+gr*wt,s[4]=(Ht=f[4])*g+(ar=f[5])*R+(Mr=f[6])*J+(gr=f[7])*Fe,s[5]=Ht*b+ar*F+Mr*re+gr*lt,s[6]=Ht*S+ar*V+Mr*xe+gr*ct,s[7]=Ht*T+ar*$+Mr*ze+gr*wt,s[8]=(Ht=f[8])*g+(ar=f[9])*R+(Mr=f[10])*J+(gr=f[11])*Fe,s[9]=Ht*b+ar*F+Mr*re+gr*lt,s[10]=Ht*S+ar*V+Mr*xe+gr*ct,s[11]=Ht*T+ar*$+Mr*ze+gr*wt,s[12]=(Ht=f[12])*g+(ar=f[13])*R+(Mr=f[14])*J+(gr=f[15])*Fe,s[13]=Ht*b+ar*F+Mr*re+gr*lt,s[14]=Ht*S+ar*V+Mr*xe+gr*ct,s[15]=Ht*T+ar*$+Mr*ze+gr*wt,s}Math.hypot||(Math.hypot=function(){for(var s=arguments,u=0,f=arguments.length;f--;)u+=s[f]*s[f];return Math.sqrt(u)});var cs,jo=xo;function Pu(s,u,f){var g=u[0],b=u[1],S=u[2],T=u[3];return s[0]=f[0]*g+f[4]*b+f[8]*S+f[12]*T,s[1]=f[1]*g+f[5]*b+f[9]*S+f[13]*T,s[2]=f[2]*g+f[6]*b+f[10]*S+f[14]*T,s[3]=f[3]*g+f[7]*b+f[11]*S+f[15]*T,s}cs=new qa(3),qa!=Float32Array&&(cs[0]=0,cs[1]=0,cs[2]=0),function(){var s=new qa(4);qa!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0)}();var Xh=(function(){var s=new qa(2);qa!=Float32Array&&(s[0]=0,s[1]=0)}(),function(s){function u(f){s.call(this,f,nu)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new ss(f)},u.prototype.queryRadius=function(f){var g=f;return ls("circle-radius",this,g)+ls("circle-stroke-width",this,g)+he(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,S,T,R,F,V){for(var $=Us(f,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,F),J=this.paint.get("circle-radius").evaluate(g,b)+this.paint.get("circle-stroke-width").evaluate(g,b),re=this.paint.get("circle-pitch-alignment")==="map",xe=re?$:function(un,fn){return un.map(function(Fn){return vh(Fn,fn)})}($,V),ze=re?J*F:J,Fe=0,lt=S;Fe<lt.length;Fe+=1)for(var ct=0,wt=lt[Fe];ct<wt.length;ct+=1){var Ht=wt[ct],ar=re?Ht:vh(Ht,V),Mr=ze,gr=Pu([],[Ht.x,Ht.y,0,1],V);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Mr*=gr[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Mr*=R.cameraToCenterDistance/gr[3]),Mu(xe,ar,Mr))return!0}return!1},u}(_u));function vh(s,u){var f=Pu([],[s.x,s.y,0,1],u);return new se(f[0]/f[3],f[1]/f[3])}var $l=function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(ss);function du(s,u,f,g){var b=u.width,S=u.height;if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==b*S*f)throw new RangeError("mismatched image size")}else g=new Uint8Array(b*S*f);return s.width=b,s.height=S,s.data=g,s}function qc(s,u,f){var g=u.width,b=u.height;if(g!==s.width||b!==s.height){var S=du({},{width:g,height:b},f);Rf(s,S,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,g),height:Math.min(s.height,b)},f),s.width=g,s.height=b,s.data=S.data}}function Rf(s,u,f,g,b,S){if(b.width===0||b.height===0)return u;if(b.width>s.width||b.height>s.height||f.x>s.width-b.width||f.y>s.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>u.width||b.height>u.height||g.x>u.width-b.width||g.y>u.height-b.height)throw new RangeError("out of range destination coordinates for image copy");for(var T=s.data,R=u.data,F=0;F<b.height;F++)for(var V=((f.y+F)*s.width+f.x)*S,$=((g.y+F)*u.width+g.x)*S,J=0;J<b.width*S;J++)R[$+J]=T[V+J];return u}kn("HeatmapBucket",$l,{omit:["layers"]});var Iu=function(u,f){du(this,u,1,f)};Iu.prototype.resize=function(s){qc(this,s,1)},Iu.prototype.clone=function(){return new Iu({width:this.width,height:this.height},new Uint8Array(this.data))},Iu.copy=function(s,u,f,g,b){Rf(s,u,f,g,b,1)};var Vs=function(u,f){du(this,u,4,f)};Vs.prototype.resize=function(s){qc(this,s,4)},Vs.prototype.replace=function(s,u){u?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s},Vs.prototype.clone=function(){return new Vs({width:this.width,height:this.height},new Uint8Array(this.data))},Vs.copy=function(s,u,f,g,b){Rf(s,u,f,g,b,4)},kn("AlphaImage",Iu),kn("RGBAImage",Vs);var yv={paint:new $a({"heatmap-radius":new jn(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new jn(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ti(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ru(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ti(ge.paint_heatmap["heatmap-opacity"])})};function _v(s){var u={},f=s.resolution||256,g=s.clips?s.clips.length:1,b=s.image||new Vs({width:f,height:g}),S=function(Fe,lt,ct){u[s.evaluationKey]=ct;var wt=s.expression.evaluate(u);b.data[Fe+lt+0]=Math.floor(255*wt.r/wt.a),b.data[Fe+lt+1]=Math.floor(255*wt.g/wt.a),b.data[Fe+lt+2]=Math.floor(255*wt.b/wt.a),b.data[Fe+lt+3]=Math.floor(255*wt.a)};if(s.clips)for(var T=0,R=0;T<g;++T,R+=4*f)for(var F=0,V=0;F<f;F++,V+=4){var $=F/(f-1),J=s.clips[T];S(R,V,J.start*(1-$)+J.end*$)}else for(var re=0,xe=0;re<f;re++,xe+=4)S(0,xe,re/(f-1));return b}var mh=function(s){function u(f){s.call(this,f,yv),this._updateColorRamp()}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new $l(f)},u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=_v({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(_u),gd={paint:new $a({"hillshade-illumination-direction":new ti(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ti(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ti(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ti(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ti(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ti(ge.paint_hillshade["hillshade-accent-color"])})},bv=function(s){function u(f){s.call(this,f,gd)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(_u),xv=No([{name:"a_pos",components:2,type:"Int16"}],4).members,Ap=Tp,jm=Tp;function Tp(s,u,f){f=f||2;var g,b,S,T,R,F,V,$=u&&u.length,J=$?u[0]*f:s.length,re=Ev(s,0,J,f,!0),xe=[];if(!re||re.next===re.prev)return xe;if($&&(re=function(Fe,lt,ct,wt){var Ht,ar,Mr,gr=[];for(Ht=0,ar=lt.length;Ht<ar;Ht++)(Mr=Ev(Fe,lt[Ht]*wt,Ht<ar-1?lt[Ht+1]*wt:Fe.length,wt,!1))===Mr.next&&(Mr.steiner=!0),gr.push(wp(Mr));for(gr.sort(Vm),Ht=0;Ht<gr.length;Ht++)yd(gr[Ht],ct),ct=Qc(ct,ct.next);return ct}(s,u,re,f)),s.length>80*f){g=S=s[0],b=T=s[1];for(var ze=f;ze<J;ze+=f)(R=s[ze])<g&&(g=R),(F=s[ze+1])<b&&(b=F),R>S&&(S=R),F>T&&(T=F);V=(V=Math.max(S-g,T-b))!==0?1/V:0}return Zh(re,xe,f,g,b,V),xe}function Ev(s,u,f,g,b){var S,T;if(b===Df(s,u,f,g)>0)for(S=u;S<f;S+=g)T=$h(S,s[S],s[S+1],T);else for(S=f-g;S>=u;S-=g)T=$h(S,s[S],s[S+1],T);return T&&Pf(T,T.next)&&(yl(T),T=T.next),T}function Qc(s,u){if(!s)return s;u||(u=s);var f,g=s;do if(f=!1,g.steiner||!Pf(g,g.next)&&Ua(g.prev,g,g.next)!==0)g=g.next;else{if(yl(g),(g=u=g.prev)===g.next)break;f=!0}while(f||g!==u);return u}function Zh(s,u,f,g,b,S,T){if(s){!T&&S&&function($,J,re,xe){var ze=$;do ze.z===null&&(ze.z=gl(ze.x,ze.y,J,re,xe)),ze.prevZ=ze.prev,ze.nextZ=ze.next,ze=ze.next;while(ze!==$);ze.prevZ.nextZ=null,ze.prevZ=null,function(Fe){var lt,ct,wt,Ht,ar,Mr,gr,un,fn=1;do{for(ct=Fe,Fe=null,ar=null,Mr=0;ct;){for(Mr++,wt=ct,gr=0,lt=0;lt<fn&&(gr++,wt=wt.nextZ);lt++);for(un=fn;gr>0||un>0&&wt;)gr!==0&&(un===0||!wt||ct.z<=wt.z)?(Ht=ct,ct=ct.nextZ,gr--):(Ht=wt,wt=wt.nextZ,un--),ar?ar.nextZ=Ht:Fe=Ht,Ht.prevZ=ar,ar=Ht;ct=wt}ar.nextZ=null,fn*=2}while(Mr>1)}(ze)}(s,g,b,S);for(var R,F,V=s;s.prev!==s.next;)if(R=s.prev,F=s.next,S?Jc(s,g,b,S):zm(s))u.push(R.i/f),u.push(s.i/f),u.push(F.i/f),yl(s),s=F.next,V=F.next;else if((s=F)===V){T?T===1?Zh(s=Um(Qc(s),u,f),u,f,g,b,S,2):T===2&&Sv(s,u,f,g,b,S):Zh(Qc(s),u,f,g,b,S,1);break}}}function zm(s){var u=s.prev,f=s,g=s.next;if(Ua(u,f,g)>=0)return!1;for(var b=s.next.next;b!==s.prev;){if(Mf(u.x,u.y,f.x,f.y,g.x,g.y,b.x,b.y)&&Ua(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function Jc(s,u,f,g){var b=s.prev,S=s,T=s.next;if(Ua(b,S,T)>=0)return!1;for(var R=b.x>S.x?b.x>T.x?b.x:T.x:S.x>T.x?S.x:T.x,F=b.y>S.y?b.y>T.y?b.y:T.y:S.y>T.y?S.y:T.y,V=gl(b.x<S.x?b.x<T.x?b.x:T.x:S.x<T.x?S.x:T.x,b.y<S.y?b.y<T.y?b.y:T.y:S.y<T.y?S.y:T.y,u,f,g),$=gl(R,F,u,f,g),J=s.prevZ,re=s.nextZ;J&&J.z>=V&&re&&re.z<=$;){if(J!==s.prev&&J!==s.next&&Mf(b.x,b.y,S.x,S.y,T.x,T.y,J.x,J.y)&&Ua(J.prev,J,J.next)>=0||(J=J.prevZ,re!==s.prev&&re!==s.next&&Mf(b.x,b.y,S.x,S.y,T.x,T.y,re.x,re.y)&&Ua(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;J&&J.z>=V;){if(J!==s.prev&&J!==s.next&&Mf(b.x,b.y,S.x,S.y,T.x,T.y,J.x,J.y)&&Ua(J.prev,J,J.next)>=0)return!1;J=J.prevZ}for(;re&&re.z<=$;){if(re!==s.prev&&re!==s.next&&Mf(b.x,b.y,S.x,S.y,T.x,T.y,re.x,re.y)&&Ua(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function Um(s,u,f){var g=s;do{var b=g.prev,S=g.next.next;!Pf(b,S)&&Yl(b,g,g.next,S)&&If(b,S)&&If(S,b)&&(u.push(b.i/f),u.push(g.i/f),u.push(S.i/f),yl(g),yl(g.next),g=s=S),g=g.next}while(g!==s);return Qc(g)}function Sv(s,u,f,g,b,S){var T=s;do{for(var R=T.next.next;R!==T.prev;){if(T.i!==R.i&&Op(T,R)){var F=yh(T,R);return T=Qc(T,T.next),F=Qc(F,F.next),Zh(T,u,f,g,b,S),void Zh(F,u,f,g,b,S)}R=R.next}T=T.next}while(T!==s)}function Vm(s,u){return s.x-u.x}function yd(s,u){if(u=function(g,b){var S,T=b,R=g.x,F=g.y,V=-1/0;do{if(F<=T.y&&F>=T.next.y&&T.next.y!==T.y){var $=T.x+(F-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if($<=R&&$>V){if(V=$,$===R){if(F===T.y)return T;if(F===T.next.y)return T.next}S=T.x<T.next.x?T:T.next}}T=T.next}while(T!==b);if(!S)return null;if(R===V)return S;var J,re=S,xe=S.x,ze=S.y,Fe=1/0;T=S;do R>=T.x&&T.x>=xe&&R!==T.x&&Mf(F<ze?R:V,F,xe,ze,F<ze?V:R,F,T.x,T.y)&&(J=Math.abs(F-T.y)/(R-T.x),If(T,g)&&(J<Fe||J===Fe&&(T.x>S.x||T.x===S.x&&Cp(S,T)))&&(S=T,Fe=J)),T=T.next;while(T!==re);return S}(s,u)){var f=yh(u,s);Qc(u,u.next),Qc(f,f.next)}}function Cp(s,u){return Ua(s.prev,s,u.prev)<0&&Ua(u.next,s,s.next)<0}function gl(s,u,f,g,b){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-f)*b)|s<<8))|s<<4))|s<<2))|s<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-g)*b)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function wp(s){var u=s,f=s;do(u.x<f.x||u.x===f.x&&u.y<f.y)&&(f=u),u=u.next;while(u!==s);return f}function Mf(s,u,f,g,b,S,T,R){return(b-T)*(u-R)-(s-T)*(S-R)>=0&&(s-T)*(g-R)-(f-T)*(u-R)>=0&&(f-T)*(S-R)-(b-T)*(g-R)>=0}function Op(s,u){return s.next.i!==u.i&&s.prev.i!==u.i&&!function(f,g){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==g.i&&b.next.i!==g.i&&Yl(b,b.next,f,g))return!0;b=b.next}while(b!==f);return!1}(s,u)&&(If(s,u)&&If(u,s)&&function(f,g){var b=f,S=!1,T=(f.x+g.x)/2,R=(f.y+g.y)/2;do b.y>R!=b.next.y>R&&b.next.y!==b.y&&T<(b.next.x-b.x)*(R-b.y)/(b.next.y-b.y)+b.x&&(S=!S),b=b.next;while(b!==f);return S}(s,u)&&(Ua(s.prev,s,u.prev)||Ua(s,u.prev,u))||Pf(s,u)&&Ua(s.prev,s,s.next)>0&&Ua(u.prev,u,u.next)>0)}function Ua(s,u,f){return(u.y-s.y)*(f.x-u.x)-(u.x-s.x)*(f.y-u.y)}function Pf(s,u){return s.x===u.x&&s.y===u.y}function Yl(s,u,f,g){var b=gh(Ua(s,u,f)),S=gh(Ua(s,u,g)),T=gh(Ua(f,g,s)),R=gh(Ua(f,g,u));return b!==S&&T!==R||!(b!==0||!ku(s,f,u))||!(S!==0||!ku(s,g,u))||!(T!==0||!ku(f,s,g))||!(R!==0||!ku(f,u,g))}function ku(s,u,f){return u.x<=Math.max(s.x,f.x)&&u.x>=Math.min(s.x,f.x)&&u.y<=Math.max(s.y,f.y)&&u.y>=Math.min(s.y,f.y)}function gh(s){return s>0?1:s<0?-1:0}function If(s,u){return Ua(s.prev,s,s.next)<0?Ua(s,u,s.next)>=0&&Ua(s,s.prev,u)>=0:Ua(s,u,s.prev)<0||Ua(s,s.next,u)<0}function yh(s,u){var f=new kf(s.i,s.x,s.y),g=new kf(u.i,u.x,u.y),b=s.next,S=u.prev;return s.next=u,u.prev=s,f.next=b,b.prev=f,g.next=f,f.prev=g,S.next=g,g.prev=S,g}function $h(s,u,f,g){var b=new kf(s,u,f);return g?(b.next=g.next,b.prev=g,g.next.prev=b,g.next=b):(b.prev=b,b.next=b),b}function yl(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kf(s,u,f){this.i=s,this.x=u,this.y=f,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Df(s,u,f,g){for(var b=0,S=u,T=f-g;S<f;S+=g)b+=(s[T]-s[S])*(s[S+1]+s[T+1]),T=S;return b}function Av(s,u,f,g,b){(function S(T,R,F,V,$){for(;V>F;){if(V-F>600){var J=V-F+1,re=R-F+1,xe=Math.log(J),ze=.5*Math.exp(2*xe/3),Fe=.5*Math.sqrt(xe*ze*(J-ze)/J)*(re-J/2<0?-1:1);S(T,R,Math.max(F,Math.floor(R-re*ze/J+Fe)),Math.min(V,Math.floor(R+(J-re)*ze/J+Fe)),$)}var lt=T[R],ct=F,wt=V;for(_l(T,F,R),$(T[V],lt)>0&&_l(T,F,V);ct<wt;){for(_l(T,ct,wt),ct++,wt--;$(T[ct],lt)<0;)ct++;for(;$(T[wt],lt)>0;)wt--}$(T[F],lt)===0?_l(T,F,wt):_l(T,++wt,V),wt<=R&&(F=wt+1),R<=wt&&(V=wt-1)}})(s,u,f||0,g||s.length-1,b||Ff)}function _l(s,u,f){var g=s[u];s[u]=s[f],s[f]=g}function Ff(s,u){return s<u?-1:s>u?1:0}function Rp(s,u){var f=s.length;if(f<=1)return[s];for(var g,b,S=[],T=0;T<f;T++){var R=me(s[T]);R!==0&&(s[T].area=Math.abs(R),b===void 0&&(b=R<0),b===R<0?(g&&S.push(g),g=[s[T]]):g.push(s[T]))}if(g&&S.push(g),u>1)for(var F=0;F<S.length;F++)S[F].length<=u||(Av(S[F],u,1,S[F].length-1,Mp),S[F]=S[F].slice(0,u));return S}function Mp(s,u){return u.area-s.area}function _d(s,u,f){for(var g=f.patternDependencies,b=!1,S=0,T=u;S<T.length;S+=1){var R=T[S].paint.get(s+"-pattern");R.isConstant()||(b=!0);var F=R.constantOr(null);F&&(b=!0,g[F.to]=!0,g[F.from]=!0)}return b}function Yh(s,u,f,g,b){for(var S=b.patternDependencies,T=0,R=u;T<R.length;T+=1){var F=R[T],V=F.paint.get(s+"-pattern").value;if(V.kind!=="constant"){var $=V.evaluate({zoom:g-1},f,{},b.availableImages),J=V.evaluate({zoom:g},f,{},b.availableImages),re=V.evaluate({zoom:g+1},f,{},b.availableImages);J=J&&J.name?J.name:J,re=re&&re.name?re.name:re,S[$=$&&$.name?$.name:$]=!0,S[J]=!0,S[re]=!0,f.patterns[F.id]={min:$,mid:J,max:re}}}return f}Tp.deviation=function(s,u,f,g){var b=u&&u.length,S=Math.abs(Df(s,0,b?u[0]*f:s.length,f));if(b)for(var T=0,R=u.length;T<R;T++)S-=Math.abs(Df(s,u[T]*f,T<R-1?u[T+1]*f:s.length,f));var F=0;for(T=0;T<g.length;T+=3){var V=g[T]*f,$=g[T+1]*f,J=g[T+2]*f;F+=Math.abs((s[V]-s[J])*(s[$+1]-s[V+1])-(s[V]-s[$])*(s[J+1]-s[V+1]))}return S===0&&F===0?0:Math.abs((F-S)/S)},Tp.flatten=function(s){for(var u=s[0][0].length,f={vertices:[],holes:[],dimensions:u},g=0,b=0;b<s.length;b++){for(var S=0;S<s[b].length;S++)for(var T=0;T<u;T++)f.vertices.push(s[b][S][T]);b>0&&f.holes.push(g+=s[b-1].length)}return f},Ap.default=jm;var el=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Wl,this.indexArray=new L,this.indexArray2=new Gl,this.programConfigurations=new zi(u.layers,u.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};el.prototype.populate=function(s,u,f){this.hasPattern=_d("fill",this.layers,u);for(var g=this.layers[0].layout.get("fill-sort-key"),b=[],S=0,T=s;S<T.length;S+=1){var R=T[S],F=R.feature,V=R.id,$=R.index,J=R.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,xe=Ka(F,re);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),xe,f)){var ze=g?g.evaluate(xe,{},f,u.availableImages):void 0,Fe={id:V,properties:F.properties,type:F.type,sourceLayerIndex:J,index:$,geometry:re?xe.geometry:Ya(F),patterns:{},sortKey:ze};b.push(Fe)}}g&&b.sort(function(un,fn){return un.sortKey-fn.sortKey});for(var lt=0,ct=b;lt<ct.length;lt+=1){var wt=ct[lt],Ht=wt.geometry,ar=wt.index,Mr=wt.sourceLayerIndex;if(this.hasPattern){var gr=Yh("fill",this.layers,wt,this.zoom,u);this.patternFeatures.push(gr)}else this.addFeature(wt,Ht,ar,f,{});u.featureIndex.insert(s[ar].feature,Ht,ar,Mr,this.index)}},el.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},el.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var S=b[g];this.addFeature(S,S.geometry,S.index,u,f)}},el.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},el.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},el.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,xv),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0},el.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},el.prototype.addFeature=function(s,u,f,g,b){for(var S=0,T=Rp(u,500);S<T.length;S+=1){for(var R=T[S],F=0,V=0,$=R;V<$.length;V+=1)F+=$[V].length;for(var J=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray),re=J.vertexLength,xe=[],ze=[],Fe=0,lt=R;Fe<lt.length;Fe+=1){var ct=lt[Fe];if(ct.length!==0){ct!==R[0]&&ze.push(xe.length/2);var wt=this.segments2.prepareSegment(ct.length,this.layoutVertexArray,this.indexArray2),Ht=wt.vertexLength;this.layoutVertexArray.emplaceBack(ct[0].x,ct[0].y),this.indexArray2.emplaceBack(Ht+ct.length-1,Ht),xe.push(ct[0].x),xe.push(ct[0].y);for(var ar=1;ar<ct.length;ar++)this.layoutVertexArray.emplaceBack(ct[ar].x,ct[ar].y),this.indexArray2.emplaceBack(Ht+ar-1,Ht+ar),xe.push(ct[ar].x),xe.push(ct[ar].y);wt.vertexLength+=ct.length,wt.primitiveLength+=ct.length}}for(var Mr=Ap(xe,ze),gr=0;gr<Mr.length;gr+=3)this.indexArray.emplaceBack(re+Mr[gr],re+Mr[gr+1],re+Mr[gr+2]);J.vertexLength+=F,J.primitiveLength+=Mr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},kn("FillBucket",el,{omit:["layers","patternFeatures"]});var Kl=new $a({"fill-sort-key":new jn(ge.layout_fill["fill-sort-key"])}),Tv={paint:new $a({"fill-antialias":new ti(ge.paint_fill["fill-antialias"]),"fill-opacity":new jn(ge.paint_fill["fill-opacity"]),"fill-color":new jn(ge.paint_fill["fill-color"]),"fill-outline-color":new jn(ge.paint_fill["fill-outline-color"]),"fill-translate":new ti(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new ti(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new eu(ge.paint_fill["fill-pattern"])}),layout:Kl},bd=function(s){function u(f){s.call(this,f,Tv)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g);var b=this.paint._values["fill-outline-color"];b.value.kind==="constant"&&b.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(f){return new el(f)},u.prototype.queryRadius=function(){return he(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,S,T,R,F){return us(Us(f,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,F),S)},u.prototype.isTileClipped=function(){return!0},u}(_u),Kh=No([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,xd=ef;function ef(s,u,f,g,b){this.properties={},this.extent=f,this.type=0,this._pbf=s,this._geometry=-1,this._keys=g,this._values=b,s.readFields(Hm,this,u)}function Hm(s,u,f){s==1?u.id=f.readVarint():s==2?function(g,b){for(var S=g.readVarint()+g.pos;g.pos<S;){var T=b._keys[g.readVarint()],R=b._values[g.readVarint()];b.properties[T]=R}}(f,u):s==3?u.type=f.readVarint():s==4&&(u._geometry=f.pos)}function ql(s){for(var u,f,g=0,b=0,S=s.length,T=S-1;b<S;T=b++)g+=((f=s[T]).x-(u=s[b]).x)*(u.y+f.y);return g}ef.types=["Unknown","Point","LineString","Polygon"],ef.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var u,f=s.readVarint()+s.pos,g=1,b=0,S=0,T=0,R=[];s.pos<f;){if(b<=0){var F=s.readVarint();g=7&F,b=F>>3}if(b--,g===1||g===2)S+=s.readSVarint(),T+=s.readSVarint(),g===1&&(u&&R.push(u),u=[]),u.push(new se(S,T));else{if(g!==7)throw new Error("unknown command "+g);u&&u.push(u[0].clone())}}return u&&R.push(u),R},ef.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var u=s.readVarint()+s.pos,f=1,g=0,b=0,S=0,T=1/0,R=-1/0,F=1/0,V=-1/0;s.pos<u;){if(g<=0){var $=s.readVarint();f=7&$,g=$>>3}if(g--,f===1||f===2)(b+=s.readSVarint())<T&&(T=b),b>R&&(R=b),(S+=s.readSVarint())<F&&(F=S),S>V&&(V=S);else if(f!==7)throw new Error("unknown command "+f)}return[T,F,R,V]},ef.prototype.toGeoJSON=function(s,u,f){var g,b,S=this.extent*Math.pow(2,f),T=this.extent*s,R=this.extent*u,F=this.loadGeometry(),V=ef.types[this.type];function $(xe){for(var ze=0;ze<xe.length;ze++){var Fe=xe[ze];xe[ze]=[360*(Fe.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(Fe.y+R)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(g=0;g<F.length;g++)J[g]=F[g][0];$(F=J);break;case 2:for(g=0;g<F.length;g++)$(F[g]);break;case 3:for(F=function(xe){var ze=xe.length;if(ze<=1)return[xe];for(var Fe,lt,ct=[],wt=0;wt<ze;wt++){var Ht=ql(xe[wt]);Ht!==0&&(lt===void 0&&(lt=Ht<0),lt===Ht<0?(Fe&&ct.push(Fe),Fe=[xe[wt]]):Fe.push(xe[wt]))}return Fe&&ct.push(Fe),ct}(F),g=0;g<F.length;g++)for(b=0;b<F[g].length;b++)$(F[g][b])}F.length===1?F=F[0]:V="Multi"+V;var re={type:"Feature",geometry:{type:V,coordinates:F},properties:this.properties};return"id"in this&&(re.id=this.id),re};var Bf=tf;function tf(s,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(rf,this,u),this.length=this._features.length}function rf(s,u,f){s===15?u.version=f.readVarint():s===1?u.name=f.readString():s===5?u.extent=f.readVarint():s===2?u._features.push(f.pos):s===3?u._keys.push(f.readString()):s===4&&u._values.push(function(g){for(var b=null,S=g.readVarint()+g.pos;g.pos<S;){var T=g.readVarint()>>3;b=T===1?g.readString():T===2?g.readFloat():T===3?g.readDouble():T===4?g.readVarint64():T===5?g.readVarint():T===6?g.readSVarint():T===7?g.readBoolean():null}return b}(f))}function Cv(s,u,f){if(s===3){var g=new Bf(f,f.readVarint()+f.pos);g.length&&(u[g.name]=g)}}tf.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var u=this._pbf.readVarint()+this._pbf.pos;return new xd(this._pbf,u,this.extent,this._keys,this._values)};var Ql={VectorTile:function(u,f){this.layers=u.readFields(Cv,{},f)},VectorTileFeature:xd,VectorTileLayer:Bf},_h=Ql.VectorTileFeature.types,Pp=Math.pow(2,13);function Eo(s,u,f,g,b,S,T,R){s.emplaceBack(u,f,2*Math.floor(g*Pp)+T,b*Pp*2,S*Pp*2,Math.round(R))}var Es=function(u){this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(f){return f.id}),this.index=u.index,this.hasPattern=!1,this.layoutVertexArray=new ml,this.indexArray=new L,this.programConfigurations=new zi(u.layers,u.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(f){return f.isStateDependent()}).map(function(f){return f.id})};function zo(s,u){return s.x===u.x&&(s.x<0||s.x>8192)||s.y===u.y&&(s.y<0||s.y>8192)}Es.prototype.populate=function(s,u,f){this.features=[],this.hasPattern=_d("fill-extrusion",this.layers,u);for(var g=0,b=s;g<b.length;g+=1){var S=b[g],T=S.feature,R=S.id,F=S.index,V=S.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,J=Ka(T,$);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),J,f)){var re={id:R,sourceLayerIndex:V,index:F,geometry:$?J.geometry:Ya(T),properties:T.properties,type:T.type,patterns:{}};this.hasPattern?this.features.push(Yh("fill-extrusion",this.layers,re,this.zoom,u)):this.addFeature(re,re.geometry,F,f,{}),u.featureIndex.insert(T,re.geometry,F,V,this.index,!0)}}},Es.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.features;g<b.length;g+=1){var S=b[g];this.addFeature(S,S.geometry,S.index,u,f)}},Es.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},Es.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(s,u,f,g,b){for(var S=0,T=Rp(u,500);S<T.length;S+=1){for(var R=T[S],F=0,V=0,$=R;V<$.length;V+=1)F+=$[V].length;for(var J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),re=0,xe=R;re<xe.length;re+=1){var ze=xe[re];if(ze.length!==0&&!((ea=ze).every(function(Bi){return Bi.x<0})||ea.every(function(Bi){return Bi.x>8192})||ea.every(function(Bi){return Bi.y<0})||ea.every(function(Bi){return Bi.y>8192})))for(var Fe=0,lt=0;lt<ze.length;lt++){var ct=ze[lt];if(lt>=1){var wt=ze[lt-1];if(!zo(ct,wt)){J.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(J=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ht=ct.sub(wt)._perp()._unit(),ar=wt.dist(ct);Fe+ar>32768&&(Fe=0),Eo(this.layoutVertexArray,ct.x,ct.y,Ht.x,Ht.y,0,0,Fe),Eo(this.layoutVertexArray,ct.x,ct.y,Ht.x,Ht.y,0,1,Fe),Eo(this.layoutVertexArray,wt.x,wt.y,Ht.x,Ht.y,0,0,Fe+=ar),Eo(this.layoutVertexArray,wt.x,wt.y,Ht.x,Ht.y,0,1,Fe);var Mr=J.vertexLength;this.indexArray.emplaceBack(Mr,Mr+2,Mr+1),this.indexArray.emplaceBack(Mr+1,Mr+2,Mr+3),J.vertexLength+=4,J.primitiveLength+=2}}}}if(J.vertexLength+F>ye.MAX_VERTEX_ARRAY_LENGTH&&(J=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),_h[s.type]==="Polygon"){for(var gr=[],un=[],fn=J.vertexLength,Fn=0,$n=R;Fn<$n.length;Fn+=1){var Un=$n[Fn];if(Un.length!==0){Un!==R[0]&&un.push(gr.length/2);for(var In=0;In<Un.length;In++){var Si=Un[In];Eo(this.layoutVertexArray,Si.x,Si.y,0,0,1,1,0),gr.push(Si.x),gr.push(Si.y)}}}for(var ai=Ap(gr,un),qn=0;qn<ai.length;qn+=3)this.indexArray.emplaceBack(fn+ai[qn],fn+ai[qn+2],fn+ai[qn+1]);J.primitiveLength+=ai.length/3,J.vertexLength+=F}}var ea;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},kn("FillExtrusionBucket",Es,{omit:["layers","features"]});var Au={paint:new $a({"fill-extrusion-opacity":new ti(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new jn(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ti(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ti(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new eu(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new jn(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new jn(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ti(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},wv=function(s){function u(f){s.call(this,f,Au)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.createBucket=function(f){return new Es(f)},u.prototype.queryRadius=function(){return he(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(f,g,b,S,T,R,F,V){var $=Us(f,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,F),J=this.paint.get("fill-extrusion-height").evaluate(g,b),re=this.paint.get("fill-extrusion-base").evaluate(g,b),xe=function(Fe,lt,ct,wt){for(var Ht=[],ar=0,Mr=Fe;ar<Mr.length;ar+=1){var gr=Mr[ar],un=[gr.x,gr.y,0,1];Pu(un,un,lt),Ht.push(new se(un[0]/un[3],un[1]/un[3]))}return Ht}($,V),ze=function(Fe,lt,ct,wt){for(var Ht=[],ar=[],Mr=wt[8]*lt,gr=wt[9]*lt,un=wt[10]*lt,fn=wt[11]*lt,Fn=wt[8]*ct,$n=wt[9]*ct,Un=wt[10]*ct,In=wt[11]*ct,Si=0,ai=Fe;Si<ai.length;Si+=1){for(var qn=[],ea=[],Bi=0,xa=ai[Si];Bi<xa.length;Bi+=1){var vi=xa[Bi],na=vi.x,Qa=vi.y,Wa=wt[0]*na+wt[4]*Qa+wt[12],ho=wt[1]*na+wt[5]*Qa+wt[13],po=wt[2]*na+wt[6]*Qa+wt[14],So=wt[3]*na+wt[7]*Qa+wt[15],Rs=po+un,Go=So+fn,au=Wa+Fn,Ts=ho+$n,ou=po+Un,ps=So+In,es=new se((Wa+Mr)/Go,(ho+gr)/Go);es.z=Rs/Go,qn.push(es);var ds=new se(au/ps,Ts/ps);ds.z=ou/ps,ea.push(ds)}Ht.push(qn),ar.push(ea)}return[Ht,ar]}(S,re,J,V);return function(Fe,lt,ct){var wt=1/0;us(ct,lt)&&(wt=Ed(ct,lt[0]));for(var Ht=0;Ht<lt.length;Ht++)for(var ar=lt[Ht],Mr=Fe[Ht],gr=0;gr<ar.length-1;gr++){var un=ar[gr],fn=[un,ar[gr+1],Mr[gr+1],Mr[gr],un];Qu(ct,fn)&&(wt=Math.min(wt,Ed(ct,fn)))}return wt!==1/0&&wt}(ze[0],ze[1],xe)},u}(_u);function qh(s,u){return s.x*u.x+s.y*u.y}function Ed(s,u){if(s.length===1){for(var f,g=0,b=u[g++];!f||b.equals(f);)if(!(f=u[g++]))return 1/0;for(;g<u.length;g++){var S=u[g],T=s[0],R=f.sub(b),F=S.sub(b),V=T.sub(b),$=qh(R,R),J=qh(R,F),re=qh(F,F),xe=qh(V,R),ze=qh(V,F),Fe=$*re-J*J,lt=(re*xe-J*ze)/Fe,ct=($*ze-J*xe)/Fe,wt=b.z*(1-lt-ct)+f.z*lt+S.z*ct;if(isFinite(wt))return wt}return 1/0}for(var Ht=1/0,ar=0,Mr=u;ar<Mr.length;ar+=1)Ht=Math.min(Ht,Mr[ar].z);return Ht}var Ov=No([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,cy=No([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Wm=Ql.VectorTileFeature.types,Gm=Math.cos(Math.PI/180*37.5),Rv=Math.pow(2,14)/.5,Hs=function(u){var f=this;this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=u.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(g){f.gradients[g.id]={}}),this.layoutVertexArray=new tu,this.layoutVertexArray2=new Xc,this.indexArray=new L,this.programConfigurations=new zi(u.layers,u.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id})};Hs.prototype.populate=function(s,u,f){this.hasPattern=_d("line",this.layers,u);for(var g=this.layers[0].layout.get("line-sort-key"),b=[],S=0,T=s;S<T.length;S+=1){var R=T[S],F=R.feature,V=R.id,$=R.index,J=R.sourceLayerIndex,re=this.layers[0]._featureFilter.needGeometry,xe=Ka(F,re);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),xe,f)){var ze=g?g.evaluate(xe,{},f):void 0,Fe={id:V,properties:F.properties,type:F.type,sourceLayerIndex:J,index:$,geometry:re?xe.geometry:Ya(F),patterns:{},sortKey:ze};b.push(Fe)}}g&&b.sort(function(un,fn){return un.sortKey-fn.sortKey});for(var lt=0,ct=b;lt<ct.length;lt+=1){var wt=ct[lt],Ht=wt.geometry,ar=wt.index,Mr=wt.sourceLayerIndex;if(this.hasPattern){var gr=Yh("line",this.layers,wt,this.zoom,u);this.patternFeatures.push(gr)}else this.addFeature(wt,Ht,ar,f,{});u.featureIndex.insert(s[ar].feature,Ht,ar,Mr,this.index)}},Hs.prototype.update=function(s,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,u,this.stateDependentLayers,f)},Hs.prototype.addFeatures=function(s,u,f){for(var g=0,b=this.patternFeatures;g<b.length;g+=1){var S=b[g];this.addFeature(S,S.geometry,S.index,u,f)}},Hs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Hs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Hs.prototype.upload=function(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,cy)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Ov),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0},Hs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Hs.prototype.lineFeatureClips=function(s){if(s.properties&&s.properties.hasOwnProperty("mapbox_clip_start")&&s.properties.hasOwnProperty("mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}},Hs.prototype.addFeature=function(s,u,f,g,b){var S=this.layers[0].layout,T=S.get("line-join").evaluate(s,{}),R=S.get("line-cap"),F=S.get("line-miter-limit"),V=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(var $=0,J=u;$<J.length;$+=1)this.addLine(J[$],s,T,R,F,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,f,b,g)},Hs.prototype.addLine=function(s,u,f,g,b,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var T=0;T<s.length-1;T++)this.totalDistance+=s[T].dist(s[T+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var R=Wm[u.type]==="Polygon",F=s.length;F>=2&&s[F-1].equals(s[F-2]);)F--;for(var V=0;V<F-1&&s[V].equals(s[V+1]);)V++;if(!(F<(R?3:2))){f==="bevel"&&(b=1.05);var $,J=this.overscaling<=16?122880/(512*this.overscaling):0,re=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray),xe=void 0,ze=void 0,Fe=void 0,lt=void 0;this.e1=this.e2=-1,R&&(lt=s[V].sub($=s[F-2])._unit()._perp());for(var ct=V;ct<F;ct++)if(!(ze=ct===F-1?R?s[V+1]:void 0:s[ct+1])||!s[ct].equals(ze)){lt&&(Fe=lt),$&&(xe=$),$=s[ct],lt=ze?ze.sub($)._unit()._perp():Fe;var wt=(Fe=Fe||lt).add(lt);wt.x===0&&wt.y===0||wt._unit();var Ht=Fe.x*lt.x+Fe.y*lt.y,ar=wt.x*lt.x+wt.y*lt.y,Mr=ar!==0?1/ar:1/0,gr=2*Math.sqrt(2-2*ar),un=ar<Gm&&xe&&ze,fn=Fe.x*lt.y-Fe.y*lt.x>0;if(un&&ct>V){var Fn=$.dist(xe);if(Fn>2*J){var $n=$.sub($.sub(xe)._mult(J/Fn)._round());this.updateDistance(xe,$n),this.addCurrentVertex($n,Fe,0,0,re),xe=$n}}var Un=xe&&ze,In=Un?f:R?"butt":g;if(Un&&In==="round"&&(Mr<S?In="miter":Mr<=2&&(In="fakeround")),In==="miter"&&Mr>b&&(In="bevel"),In==="bevel"&&(Mr>2&&(In="flipbevel"),Mr<b&&(In="miter")),xe&&this.updateDistance(xe,$),In==="miter")wt._mult(Mr),this.addCurrentVertex($,wt,0,0,re);else if(In==="flipbevel"){if(Mr>100)wt=lt.mult(-1);else{var Si=Mr*Fe.add(lt).mag()/Fe.sub(lt).mag();wt._perp()._mult(Si*(fn?-1:1))}this.addCurrentVertex($,wt,0,0,re),this.addCurrentVertex($,wt.mult(-1),0,0,re)}else if(In==="bevel"||In==="fakeround"){var ai=-Math.sqrt(Mr*Mr-1),qn=fn?ai:0,ea=fn?0:ai;if(xe&&this.addCurrentVertex($,Fe,qn,ea,re),In==="fakeround")for(var Bi=Math.round(180*gr/Math.PI/20),xa=1;xa<Bi;xa++){var vi=xa/Bi;if(vi!==.5){var na=vi-.5;vi+=vi*na*(vi-1)*((1.0904+Ht*(Ht*(3.55645-1.43519*Ht)-3.2452))*na*na+(.848013+Ht*(.215638*Ht-1.06021)))}var Qa=lt.sub(Fe)._mult(vi)._add(Fe)._unit()._mult(fn?-1:1);this.addHalfVertex($,Qa.x,Qa.y,!1,fn,0,re)}ze&&this.addCurrentVertex($,lt,-qn,-ea,re)}else if(In==="butt")this.addCurrentVertex($,wt,0,0,re);else if(In==="square"){var Wa=xe?1:-1;this.addCurrentVertex($,wt,Wa,Wa,re)}else In==="round"&&(xe&&(this.addCurrentVertex($,Fe,0,0,re),this.addCurrentVertex($,Fe,1,1,re,!0)),ze&&(this.addCurrentVertex($,lt,-1,-1,re,!0),this.addCurrentVertex($,lt,0,0,re)));if(un&&ct<F-1){var ho=$.dist(ze);if(ho>2*J){var po=$.add(ze.sub($)._mult(J/ho)._round());this.updateDistance($,po),this.addCurrentVertex(po,lt,0,0,re),$=po}}}}},Hs.prototype.addCurrentVertex=function(s,u,f,g,b,S){S===void 0&&(S=!1);var T=u.y*g-u.x,R=-u.y-u.x*g;this.addHalfVertex(s,u.x+u.y*f,u.y-u.x*f,S,!1,f,b),this.addHalfVertex(s,T,R,S,!0,-g,b),this.distance>Rv/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(s,u,f,g,b,S))},Hs.prototype.addHalfVertex=function(s,u,f,g,b,S,T){var R=.5*(this.lineClips?this.scaledDistance*(Rv-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s.x<<1)+(g?1:0),(s.y<<1)+(b?1:0),Math.round(63*u)+128,Math.round(63*f)+128,1+(S===0?0:S<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var F=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),T.primitiveLength++),b?this.e2=F:this.e1=F},Hs.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Hs.prototype.updateDistance=function(s,u){this.distance+=s.dist(u),this.updateScaledDistance()},kn("LineBucket",Hs,{omit:["layers","patternFeatures"]});var Xm=new $a({"line-cap":new ti(ge.layout_line["line-cap"]),"line-join":new jn(ge.layout_line["line-join"]),"line-miter-limit":new ti(ge.layout_line["line-miter-limit"]),"line-round-limit":new ti(ge.layout_line["line-round-limit"]),"line-sort-key":new jn(ge.layout_line["line-sort-key"])}),Mv={paint:new $a({"line-opacity":new jn(ge.paint_line["line-opacity"]),"line-color":new jn(ge.paint_line["line-color"]),"line-translate":new ti(ge.paint_line["line-translate"]),"line-translate-anchor":new ti(ge.paint_line["line-translate-anchor"]),"line-width":new jn(ge.paint_line["line-width"]),"line-gap-width":new jn(ge.paint_line["line-gap-width"]),"line-offset":new jn(ge.paint_line["line-offset"]),"line-blur":new jn(ge.paint_line["line-blur"]),"line-dasharray":new bs(ge.paint_line["line-dasharray"]),"line-pattern":new eu(ge.paint_line["line-pattern"]),"line-gradient":new Ru(ge.paint_line["line-gradient"])}),layout:Xm},Sd=new(function(s){function u(){s.apply(this,arguments)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(f,g){return g=new Oi(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),s.prototype.possiblyEvaluate.call(this,f,g)},u.prototype.evaluate=function(f,g,b,S){return g=$e({},g,{zoom:Math.floor(g.zoom)}),s.prototype.evaluate.call(this,f,g,b,S)},u}(jn))(Mv.paint.properties["line-width"].specification);Sd.useIntegerZoom=!0;var Pv=function(s){function u(f){s.call(this,f,Mv),this.gradientVersion=0}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(f){f==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Rt,this.gradientVersion=(this.gradientVersion+1)%gt)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(f,g){s.prototype.recalculate.call(this,f,g),this.paint._values["line-floorwidth"]=Sd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,f)},u.prototype.createBucket=function(f){return new Hs(f)},u.prototype.queryRadius=function(f){var g=f,b=bh(ls("line-width",this,g),ls("line-gap-width",this,g)),S=ls("line-offset",this,g);return b/2+Math.abs(S)+he(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(f,g,b,S,T,R,F){var V=Us(f,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,F),$=F/2*bh(this.paint.get("line-width").evaluate(g,b),this.paint.get("line-gap-width").evaluate(g,b)),J=this.paint.get("line-offset").evaluate(g,b);return J&&(S=function(re,xe){for(var ze=[],Fe=new se(0,0),lt=0;lt<re.length;lt++){for(var ct=re[lt],wt=[],Ht=0;Ht<ct.length;Ht++){var ar=ct[Ht],Mr=ct[Ht+1],gr=Ht===0?Fe:ar.sub(ct[Ht-1])._unit()._perp(),un=Ht===ct.length-1?Fe:Mr.sub(ar)._unit()._perp(),fn=gr._add(un)._unit();fn._mult(1/(fn.x*un.x+fn.y*un.y)),wt.push(fn._mult(xe)._add(ar))}ze.push(wt)}return ze}(S,J*F)),function(re,xe,ze){for(var Fe=0;Fe<xe.length;Fe++){var lt=xe[Fe];if(re.length>=3){for(var ct=0;ct<lt.length;ct++)if(Xt(re,lt[ct]))return!0}if(xs(re,lt,ze))return!0}return!1}(V,S,$)},u.prototype.isTileClipped=function(){return!0},u}(_u);function bh(s,u){return u>0?u+2*s:s}var Iv=No([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fy=No([{name:"a_projected_pos",components:3,type:"Float32"}],4),kv=(No([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),No([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Ad=(No([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),No([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Y=No([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function ce(s,u,f){return s.sections.forEach(function(g){g.text=function(b,S,T){var R=S.layout.get("text-transform").evaluate(T,{});return R==="uppercase"?b=b.toLocaleUpperCase():R==="lowercase"&&(b=b.toLocaleLowerCase()),zs.applyArabicShaping&&(b=zs.applyArabicShaping(b)),b}(g.text,u,f)}),s}No([{name:"triangle",components:3,type:"Uint16"}]),No([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),No([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),No([{type:"Float32",name:"offsetX"}]),No([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var it={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},tr=function(u,f,g,b,S){var T,R,F=8*S-b-1,V=(1<<F)-1,$=V>>1,J=-7,re=g?S-1:0,xe=g?-1:1,ze=u[f+re];for(re+=xe,T=ze&(1<<-J)-1,ze>>=-J,J+=F;J>0;T=256*T+u[f+re],re+=xe,J-=8);for(R=T&(1<<-J)-1,T>>=-J,J+=b;J>0;R=256*R+u[f+re],re+=xe,J-=8);if(T===0)T=1-$;else{if(T===V)return R?NaN:1/0*(ze?-1:1);R+=Math.pow(2,b),T-=$}return(ze?-1:1)*R*Math.pow(2,T-b)},Ar=function(u,f,g,b,S,T){var R,F,V,$=8*T-S-1,J=(1<<$)-1,re=J>>1,xe=S===23?Math.pow(2,-24)-Math.pow(2,-77):0,ze=b?0:T-1,Fe=b?1:-1,lt=f<0||f===0&&1/f<0?1:0;for(f=Math.abs(f),isNaN(f)||f===1/0?(F=isNaN(f)?1:0,R=J):(R=Math.floor(Math.log(f)/Math.LN2),f*(V=Math.pow(2,-R))<1&&(R--,V*=2),(f+=R+re>=1?xe/V:xe*Math.pow(2,1-re))*V>=2&&(R++,V/=2),R+re>=J?(F=0,R=J):R+re>=1?(F=(f*V-1)*Math.pow(2,S),R+=re):(F=f*Math.pow(2,re-1)*Math.pow(2,S),R=0));S>=8;u[g+ze]=255&F,ze+=Fe,F/=256,S-=8);for(R=R<<S|F,$+=S;$>0;u[g+ze]=255&R,ze+=Fe,R/=256,$-=8);u[g+ze-Fe]|=128*lt},yr=Lt;function Lt(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Lt.Varint=0,Lt.Fixed64=1,Lt.Bytes=2,Lt.Fixed32=5;var Gr=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Jr(s){return s.type===Lt.Bytes?s.readVarint()+s.pos:s.pos+1}function nn(s,u,f){return f?4294967296*u+(s>>>0):4294967296*(u>>>0)+(s>>>0)}function tn(s,u,f){var g=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));f.realloc(g);for(var b=f.pos-1;b>=s;b--)f.buf[b+g]=f.buf[b]}function an(s,u){for(var f=0;f<s.length;f++)u.writeVarint(s[f])}function yn(s,u){for(var f=0;f<s.length;f++)u.writeSVarint(s[f])}function Yr(s,u){for(var f=0;f<s.length;f++)u.writeFloat(s[f])}function xr(s,u){for(var f=0;f<s.length;f++)u.writeDouble(s[f])}function jt(s,u){for(var f=0;f<s.length;f++)u.writeBoolean(s[f])}function $t(s,u){for(var f=0;f<s.length;f++)u.writeFixed32(s[f])}function en(s,u){for(var f=0;f<s.length;f++)u.writeSFixed32(s[f])}function Tn(s,u){for(var f=0;f<s.length;f++)u.writeFixed64(s[f])}function Er(s,u){for(var f=0;f<s.length;f++)u.writeSFixed64(s[f])}function Jn(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+16777216*s[u+3]}function Ur(s,u,f){s[f]=u,s[f+1]=u>>>8,s[f+2]=u>>>16,s[f+3]=u>>>24}function cn(s,u){return(s[u]|s[u+1]<<8|s[u+2]<<16)+(s[u+3]<<24)}function Lr(s,u,f){s===1&&f.readMessage(hn,u)}function hn(s,u,f){if(s===3){var g=f.readMessage(Qn,{}),b=g.width,S=g.height,T=g.left,R=g.top,F=g.advance;u.push({id:g.id,bitmap:new Iu({width:b+6,height:S+6},g.bitmap),metrics:{width:b,height:S,left:T,top:R,advance:F}})}}function Qn(s,u,f){s===1?u.id=f.readVarint():s===2?u.bitmap=f.readBytes():s===3?u.width=f.readVarint():s===4?u.height=f.readVarint():s===5?u.left=f.readSVarint():s===6?u.top=f.readSVarint():s===7&&(u.advance=f.readVarint())}function Ai(s){for(var u=0,f=0,g=0,b=s;g<b.length;g+=1){var S=b[g];u+=S.w*S.h,f=Math.max(f,S.w)}s.sort(function(Fe,lt){return lt.h-Fe.h});for(var T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),f),h:1/0}],R=0,F=0,V=0,$=s;V<$.length;V+=1)for(var J=$[V],re=T.length-1;re>=0;re--){var xe=T[re];if(!(J.w>xe.w||J.h>xe.h)){if(J.x=xe.x,J.y=xe.y,F=Math.max(F,J.y+J.h),R=Math.max(R,J.x+J.w),J.w===xe.w&&J.h===xe.h){var ze=T.pop();re<T.length&&(T[re]=ze)}else J.h===xe.h?(xe.x+=J.w,xe.w-=J.w):J.w===xe.w?(xe.y+=J.h,xe.h-=J.h):(T.push({x:xe.x+J.w,y:xe.y,w:xe.w-J.w,h:J.h}),xe.y+=J.h,xe.h-=J.h);break}}return{w:R,h:F,fill:u/(R*F)||0}}Lt.prototype={destroy:function(){this.buf=null},readFields:function(u,f,g){for(g=g||this.length;this.pos<g;){var b=this.readVarint(),S=b>>3,T=this.pos;this.type=7&b,u(S,f,this),this.pos===T&&this.skip(b)}return f},readMessage:function(u,f){return this.readFields(u,f,this.readVarint()+this.pos)},readFixed32:function(){var u=Jn(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=cn(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Jn(this.buf,this.pos)+4294967296*Jn(this.buf,this.pos+4);return this.pos+=8,u},readSFixed64:function(){var u=Jn(this.buf,this.pos)+4294967296*cn(this.buf,this.pos+4);return this.pos+=8,u},readFloat:function(){var u=tr(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=tr(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var f,g,b=this.buf;return f=127&(g=b[this.pos++]),g<128?f:(f|=(127&(g=b[this.pos++]))<<7,g<128?f:(f|=(127&(g=b[this.pos++]))<<14,g<128?f:(f|=(127&(g=b[this.pos++]))<<21,g<128?f:function(S,T,R){var F,V,$=R.buf;if(F=(112&(V=$[R.pos++]))>>4,V<128||(F|=(127&(V=$[R.pos++]))<<3,V<128)||(F|=(127&(V=$[R.pos++]))<<10,V<128)||(F|=(127&(V=$[R.pos++]))<<17,V<128)||(F|=(127&(V=$[R.pos++]))<<24,V<128)||(F|=(1&(V=$[R.pos++]))<<31,V<128))return nn(S,F,T);throw new Error("Expected varint not more than 10 bytes")}(f|=(15&(g=b[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var u=this.readVarint()+this.pos,f=this.pos;return this.pos=u,u-f>=12&&Gr?function(g,b,S){return Gr.decode(g.subarray(b,S))}(this.buf,f,u):function(g,b,S){for(var T="",R=b;R<S;){var F,V,$,J=g[R],re=null,xe=J>239?4:J>223?3:J>191?2:1;if(R+xe>S)break;xe===1?J<128&&(re=J):xe===2?(192&(F=g[R+1]))==128&&(re=(31&J)<<6|63&F)<=127&&(re=null):xe===3?(V=g[R+2],(192&(F=g[R+1]))==128&&(192&V)==128&&((re=(15&J)<<12|(63&F)<<6|63&V)<=2047||re>=55296&&re<=57343)&&(re=null)):xe===4&&(V=g[R+2],$=g[R+3],(192&(F=g[R+1]))==128&&(192&V)==128&&(192&$)==128&&((re=(15&J)<<18|(63&F)<<12|(63&V)<<6|63&$)<=65535||re>=1114112)&&(re=null)),re===null?(re=65533,xe=1):re>65535&&(re-=65536,T+=String.fromCharCode(re>>>10&1023|55296),re=56320|1023&re),T+=String.fromCharCode(re),R+=xe}return T}(this.buf,f,u)},readBytes:function(){var u=this.readVarint()+this.pos,f=this.buf.subarray(this.pos,u);return this.pos=u,f},readPackedVarint:function(u,f){if(this.type!==Lt.Bytes)return u.push(this.readVarint(f));var g=Jr(this);for(u=u||[];this.pos<g;)u.push(this.readVarint(f));return u},readPackedSVarint:function(u){if(this.type!==Lt.Bytes)return u.push(this.readSVarint());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Lt.Bytes)return u.push(this.readBoolean());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Lt.Bytes)return u.push(this.readFloat());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Lt.Bytes)return u.push(this.readDouble());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Lt.Bytes)return u.push(this.readFixed32());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Lt.Bytes)return u.push(this.readSFixed32());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Lt.Bytes)return u.push(this.readFixed64());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Lt.Bytes)return u.push(this.readSFixed64());var f=Jr(this);for(u=u||[];this.pos<f;)u.push(this.readSFixed64());return u},skip:function(u){var f=7&u;if(f===Lt.Varint)for(;this.buf[this.pos++]>127;);else if(f===Lt.Bytes)this.pos=this.readVarint()+this.pos;else if(f===Lt.Fixed32)this.pos+=4;else{if(f!==Lt.Fixed64)throw new Error("Unimplemented type: "+f);this.pos+=8}},writeTag:function(u,f){this.writeVarint(u<<3|f)},realloc:function(u){for(var f=this.length||16;f<this.pos+u;)f*=2;if(f!==this.length){var g=new Uint8Array(f);g.set(this.buf),this.buf=g,this.length=f}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),Ur(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),Ur(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),Ur(this.buf,-1&u,this.pos),Ur(this.buf,Math.floor(u*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),Ur(this.buf,-1&u,this.pos),Ur(this.buf,Math.floor(u*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(f,g){var b,S;if(f>=0?(b=f%4294967296|0,S=f/4294967296|0):(S=~(-f/4294967296),4294967295^(b=~(-f%4294967296))?b=b+1|0:(b=0,S=S+1|0)),f>=18446744073709552e3||f<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),function(T,R,F){F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,T>>>=7,F.buf[F.pos++]=127&T|128,F.buf[F.pos]=127&(T>>>=7)}(b,0,g),function(T,R){var F=(7&T)<<4;R.buf[R.pos++]|=F|((T>>>=3)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T|((T>>>=7)?128:0),T&&(R.buf[R.pos++]=127&T)))))}(S,g)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(Boolean(u))},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var f=this.pos;this.pos=function(b,S,T){for(var R,F,V=0;V<S.length;V++){if((R=S.charCodeAt(V))>55295&&R<57344){if(!F){R>56319||V+1===S.length?(b[T++]=239,b[T++]=191,b[T++]=189):F=R;continue}if(R<56320){b[T++]=239,b[T++]=191,b[T++]=189,F=R;continue}R=F-55296<<10|R-56320|65536,F=null}else F&&(b[T++]=239,b[T++]=191,b[T++]=189,F=null);R<128?b[T++]=R:(R<2048?b[T++]=R>>6|192:(R<65536?b[T++]=R>>12|224:(b[T++]=R>>18|240,b[T++]=R>>12&63|128),b[T++]=R>>6&63|128),b[T++]=63&R|128)}return T}(this.buf,u,this.pos);var g=this.pos-f;g>=128&&tn(f,g,this),this.pos=f-1,this.writeVarint(g),this.pos+=g},writeFloat:function(u){this.realloc(4),Ar(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),Ar(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var f=u.length;this.writeVarint(f),this.realloc(f);for(var g=0;g<f;g++)this.buf[this.pos++]=u[g]},writeRawMessage:function(u,f){this.pos++;var g=this.pos;u(f,this);var b=this.pos-g;b>=128&&tn(g,b,this),this.pos=g-1,this.writeVarint(b),this.pos+=b},writeMessage:function(u,f,g){this.writeTag(u,Lt.Bytes),this.writeRawMessage(f,g)},writePackedVarint:function(u,f){f.length&&this.writeMessage(u,an,f)},writePackedSVarint:function(u,f){f.length&&this.writeMessage(u,yn,f)},writePackedBoolean:function(u,f){f.length&&this.writeMessage(u,jt,f)},writePackedFloat:function(u,f){f.length&&this.writeMessage(u,Yr,f)},writePackedDouble:function(u,f){f.length&&this.writeMessage(u,xr,f)},writePackedFixed32:function(u,f){f.length&&this.writeMessage(u,$t,f)},writePackedSFixed32:function(u,f){f.length&&this.writeMessage(u,en,f)},writePackedFixed64:function(u,f){f.length&&this.writeMessage(u,Tn,f)},writePackedSFixed64:function(u,f){f.length&&this.writeMessage(u,Er,f)},writeBytesField:function(u,f){this.writeTag(u,Lt.Bytes),this.writeBytes(f)},writeFixed32Field:function(u,f){this.writeTag(u,Lt.Fixed32),this.writeFixed32(f)},writeSFixed32Field:function(u,f){this.writeTag(u,Lt.Fixed32),this.writeSFixed32(f)},writeFixed64Field:function(u,f){this.writeTag(u,Lt.Fixed64),this.writeFixed64(f)},writeSFixed64Field:function(u,f){this.writeTag(u,Lt.Fixed64),this.writeSFixed64(f)},writeVarintField:function(u,f){this.writeTag(u,Lt.Varint),this.writeVarint(f)},writeSVarintField:function(u,f){this.writeTag(u,Lt.Varint),this.writeSVarint(f)},writeStringField:function(u,f){this.writeTag(u,Lt.Bytes),this.writeString(f)},writeFloatField:function(u,f){this.writeTag(u,Lt.Fixed32),this.writeFloat(f)},writeDoubleField:function(u,f){this.writeTag(u,Lt.Fixed64),this.writeDouble(f)},writeBooleanField:function(u,f){this.writeVarintField(u,Boolean(f))}};var mn=function(u,f){var g=f.pixelRatio,b=f.version,S=f.stretchX,T=f.stretchY,R=f.content;this.paddedRect=u,this.pixelRatio=g,this.stretchX=S,this.stretchY=T,this.content=R,this.version=b},Kr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Kr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Kr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Kr.tlbr.get=function(){return this.tl.concat(this.br)},Kr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(mn.prototype,Kr);var Pr=function(u,f){var g={},b={};this.haveRenderCallbacks=[];var S=[];this.addImages(u,g,S),this.addImages(f,b,S);var T=Ai(S),R=new Vs({width:T.w||1,height:T.h||1});for(var F in u){var V=u[F],$=g[F].paddedRect;Vs.copy(V.data,R,{x:0,y:0},{x:$.x+1,y:$.y+1},V.data)}for(var J in f){var re=f[J],xe=b[J].paddedRect,ze=xe.x+1,Fe=xe.y+1,lt=re.data.width,ct=re.data.height;Vs.copy(re.data,R,{x:0,y:0},{x:ze,y:Fe},re.data),Vs.copy(re.data,R,{x:0,y:ct-1},{x:ze,y:Fe-1},{width:lt,height:1}),Vs.copy(re.data,R,{x:0,y:0},{x:ze,y:Fe+ct},{width:lt,height:1}),Vs.copy(re.data,R,{x:lt-1,y:0},{x:ze-1,y:Fe},{width:1,height:ct}),Vs.copy(re.data,R,{x:0,y:0},{x:ze+lt,y:Fe},{width:1,height:ct})}this.image=R,this.iconPositions=g,this.patternPositions=b};Pr.prototype.addImages=function(s,u,f){for(var g in s){var b=s[g],S={x:0,y:0,w:b.data.width+2,h:b.data.height+2};f.push(S),u[g]=new mn(S,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}},Pr.prototype.patchUpdatedImages=function(s,u){for(var f in s.dispatchRenderCallbacks(this.haveRenderCallbacks),s.updatedImages)this.patchUpdatedImage(this.iconPositions[f],s.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],s.getImage(f),u)},Pr.prototype.patchUpdatedImage=function(s,u,f){if(s&&u&&s.version!==u.version){s.version=u.version;var g=s.tl;f.update(u.data,void 0,{x:g[0],y:g[1]})}},kn("ImagePosition",mn),kn("ImageAtlas",Pr);var ii={horizontal:1,vertical:2,horizontalOnly:3},Xi=function(){this.scale=1,this.fontStack="",this.imageName=null};Xi.forText=function(s,u){var f=new Xi;return f.scale=s||1,f.fontStack=u,f},Xi.forImage=function(s){var u=new Xi;return u.imageName=s,u};var Cn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Ui(s,u,f,g,b,S,T,R,F,V,$,J,re,xe,ze,Fe){var lt,ct=Cn.fromFeature(s,b);J===ii.vertical&&ct.verticalizePunctuation();var wt=zs.processBidirectionalText,Ht=zs.processStyledBidirectionalText;if(wt&&ct.sections.length===1){lt=[];for(var ar=0,Mr=wt(ct.toString(),To(ct,V,S,u,g,xe,ze));ar<Mr.length;ar+=1){var gr=Mr[ar],un=new Cn;un.text=gr,un.sections=ct.sections;for(var fn=0;fn<gr.length;fn++)un.sectionIndex.push(0);lt.push(un)}}else if(Ht){lt=[];for(var Fn=0,$n=Ht(ct.text,ct.sectionIndex,To(ct,V,S,u,g,xe,ze));Fn<$n.length;Fn+=1){var Un=$n[Fn],In=new Cn;In.text=Un[0],In.sectionIndex=Un[1],In.sections=ct.sections,lt.push(In)}}else lt=function(qn,ea){for(var Bi=[],xa=qn.text,vi=0,na=0,Qa=ea;na<Qa.length;na+=1){var Wa=Qa[na];Bi.push(qn.substring(vi,Wa)),vi=Wa}return vi<xa.length&&Bi.push(qn.substring(vi,xa.length)),Bi}(ct,To(ct,V,S,u,g,xe,ze));var Si=[],ai={positionedLines:Si,text:ct.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:J,iconsInText:!1,verticalizable:!1};return function(qn,ea,Bi,xa,vi,na,Qa,Wa,ho,po,So,Rs){for(var Go=0,au=-17,Ts=0,ou=0,ps=Wa==="right"?1:Wa==="left"?0:.5,es=0,ds=0,fa=vi;ds<fa.length;ds+=1){var aa=fa[ds];aa.trim();var Va=aa.getMaxScale(),Ja=24*(Va-1),su={positionedGlyphs:[],lineOffset:0};qn.positionedLines[es]=su;var ro=su.positionedGlyphs,vo=0;if(aa.length()){for(var Ws=0;Ws<aa.length();Ws++){var la=aa.getSection(Ws),jf=aa.getSectionIndex(Ws),xl=aa.getCharCode(Ws),gc=0,rl=null,Ms=null,zf=null,Uf=24,af=!(ho===ii.horizontal||!So&&!wf(xl)||So&&(Ei[xl]||(xh=xl,vn.Arabic(xh)||vn["Arabic Supplement"](xh)||vn["Arabic Extended-A"](xh)||vn["Arabic Presentation Forms-A"](xh)||vn["Arabic Presentation Forms-B"](xh))));if(la.imageName){var Rd=xa[la.imageName];if(!Rd)continue;zf=la.imageName,qn.iconsInText=qn.iconsInText||!0,Ms=Rd.paddedRect;var of=Rd.displaySize;la.scale=24*la.scale/Rs,gc=Ja+(24-of[1]*la.scale),Uf=(rl={width:of[0],height:of[1],left:1,top:-3,advance:af?of[1]:of[0]}).advance;var Md=af?of[0]*la.scale-24*Va:of[1]*la.scale-24*Va;Md>0&&Md>vo&&(vo=Md)}else{var Pd=Bi[la.fontStack],Dp=Pd&&Pd[xl];if(Dp&&Dp.rect)Ms=Dp.rect,rl=Dp.metrics;else{var Id=ea[la.fontStack],Fp=Id&&Id[xl];if(!Fp)continue;rl=Fp.metrics}gc=24*(Va-la.scale)}af?(qn.verticalizable=!0,ro.push({glyph:xl,imageName:zf,x:Go,y:au+gc,vertical:af,scale:la.scale,fontStack:la.fontStack,sectionIndex:jf,metrics:rl,rect:Ms}),Go+=Uf*la.scale+po):(ro.push({glyph:xl,imageName:zf,x:Go,y:au+gc,vertical:af,scale:la.scale,fontStack:la.fontStack,sectionIndex:jf,metrics:rl,rect:Ms}),Go+=rl.advance*la.scale+po)}ro.length!==0&&(Ts=Math.max(Go-po,Ts),Uo(ro,0,ro.length-1,ps,vo)),Go=0;var kd=na*Va+vo;su.lineOffset=Math.max(vo,Ja),au+=kd,ou=Math.max(kd,ou),++es}else au+=na,++es}var xh,Bp=au- -17,Lv=Ha(Qa),Lp=Lv.horizontalAlign,Eh=Lv.verticalAlign;(function(Np,Nv,Dd,np,Fd,Bd,jp,jv,Ld){var Nd,jd=(Nv-Dd)*Fd;Nd=Bd!==jp?-jv*np- -17:(-np*Ld+.5)*jp;for(var zp=0,zd=Np;zp<zd.length;zp+=1)for(var ip=0,Up=zd[zp].positionedGlyphs;ip<Up.length;ip+=1){var Ud=Up[ip];Ud.x+=jd,Ud.y+=Nd}})(qn.positionedLines,ps,Lp,Eh,Ts,ou,na,Bp,vi.length),qn.top+=-Eh*Bp,qn.bottom=qn.top+Bp,qn.left+=-Lp*Ts,qn.right=qn.left+Ts}(ai,u,f,g,lt,T,R,F,J,V,re,Fe),!function(qn){for(var ea=0,Bi=qn;ea<Bi.length;ea+=1)if(Bi[ea].positionedGlyphs.length!==0)return!1;return!0}(Si)&&ai}Cn.fromFeature=function(s,u){for(var f=new Cn,g=0;g<s.sections.length;g++){var b=s.sections[g];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f},Cn.prototype.length=function(){return this.text.length},Cn.prototype.getSection=function(s){return this.sections[this.sectionIndex[s]]},Cn.prototype.getSectionIndex=function(s){return this.sectionIndex[s]},Cn.prototype.getCharCode=function(s){return this.text.charCodeAt(s)},Cn.prototype.verticalizePunctuation=function(){this.text=function(s){for(var u="",f=0;f<s.length;f++){var g=s.charCodeAt(f+1)||null,b=s.charCodeAt(f-1)||null;u+=g&&sh(g)&&!it[s[f+1]]||b&&sh(b)&&!it[s[f-1]]||!it[s[f]]?s[f]:it[s[f]]}return u}(this.text)},Cn.prototype.trim=function(){for(var s=0,u=0;u<this.text.length&&Ei[this.text.charCodeAt(u)];u++)s++;for(var f=this.text.length,g=this.text.length-1;g>=0&&g>=s&&Ei[this.text.charCodeAt(g)];g--)f--;this.text=this.text.substring(s,f),this.sectionIndex=this.sectionIndex.slice(s,f)},Cn.prototype.substring=function(s,u){var f=new Cn;return f.text=this.text.substring(s,u),f.sectionIndex=this.sectionIndex.slice(s,u),f.sections=this.sections,f},Cn.prototype.toString=function(){return this.text},Cn.prototype.getMaxScale=function(){var s=this;return this.sectionIndex.reduce(function(u,f){return Math.max(u,s.sections[f].scale)},0)},Cn.prototype.addTextSection=function(s,u){this.text+=s.text,this.sections.push(Xi.forText(s.scale,s.fontStack||u));for(var f=this.sections.length-1,g=0;g<s.text.length;++g)this.sectionIndex.push(f)},Cn.prototype.addImageSection=function(s){var u=s.image?s.image.name:"";if(u.length!==0){var f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Xi.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}else Gt("Can't add FormattedSection with an empty image.")},Cn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ei={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pi={};function ca(s,u,f,g,b,S){if(u.imageName){var T=g[u.imageName];return T?T.displaySize[0]*u.scale*24/S+b:0}var R=f[u.fontStack],F=R&&R[s];return F?F.metrics.advance*u.scale+b:0}function Po(s,u,f,g){var b=Math.pow(s-u,2);return g?s<u?b/2:2*b:b+Math.abs(f)*f}function fs(s,u,f){var g=0;return s===10&&(g-=1e4),f&&(g+=150),s!==40&&s!==65288||(g+=50),u!==41&&u!==65289||(g+=50),g}function Yi(s,u,f,g,b,S){for(var T=null,R=Po(u,f,b,S),F=0,V=g;F<V.length;F+=1){var $=V[F],J=Po(u-$.x,f,b,S)+$.badness;J<=R&&(T=$,R=J)}return{index:s,x:u,priorBreak:T,badness:R}}function To(s,u,f,g,b,S,T){if(S!=="point")return[];if(!s)return[];for(var R,F=[],V=function(lt,ct,wt,Ht,ar,Mr){for(var gr=0,un=0;un<lt.length();un++){var fn=lt.getSection(un);gr+=ca(lt.getCharCode(un),fn,Ht,ar,ct,Mr)}return gr/Math.max(1,Math.ceil(gr/wt))}(s,u,f,g,b,T),$=s.text.indexOf("\u200B")>=0,J=0,re=0;re<s.length();re++){var xe=s.getSection(re),ze=s.getCharCode(re);if(Ei[ze]||(J+=ca(ze,xe,g,b,u,T)),re<s.length()-1){var Fe=!((R=ze)<11904||!(vn["Bopomofo Extended"](R)||vn.Bopomofo(R)||vn["CJK Compatibility Forms"](R)||vn["CJK Compatibility Ideographs"](R)||vn["CJK Compatibility"](R)||vn["CJK Radicals Supplement"](R)||vn["CJK Strokes"](R)||vn["CJK Symbols and Punctuation"](R)||vn["CJK Unified Ideographs Extension A"](R)||vn["CJK Unified Ideographs"](R)||vn["Enclosed CJK Letters and Months"](R)||vn["Halfwidth and Fullwidth Forms"](R)||vn.Hiragana(R)||vn["Ideographic Description Characters"](R)||vn["Kangxi Radicals"](R)||vn["Katakana Phonetic Extensions"](R)||vn.Katakana(R)||vn["Vertical Forms"](R)||vn["Yi Radicals"](R)||vn["Yi Syllables"](R)));(pi[ze]||Fe||xe.imageName)&&F.push(Yi(re+1,J,V,F,fs(ze,s.getCharCode(re+1),Fe&&$),!1))}}return function lt(ct){return ct?lt(ct.priorBreak).concat(ct.index):[]}(Yi(s.length(),J,V,F,0,!0))}function Ha(s){var u=.5,f=.5;switch(s){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:u,verticalAlign:f}}function Uo(s,u,f,g,b){if(g||b)for(var S=s[f],T=(s[f].x+S.metrics.advance*S.scale)*g,R=u;R<=f;R++)s[R].x-=T,s[R].y+=b}function Vo(s,u,f,g,b,S){var T,R=s.image;if(R.content){var F=R.content,V=R.pixelRatio||1;T=[F[0]/V,F[1]/V,R.displaySize[0]-F[2]/V,R.displaySize[1]-F[3]/V]}var $,J,re,xe,ze=u.left*S,Fe=u.right*S;f==="width"||f==="both"?(xe=b[0]+ze-g[3],J=b[0]+Fe+g[1]):J=(xe=b[0]+(ze+Fe-R.displaySize[0])/2)+R.displaySize[0];var lt=u.top*S,ct=u.bottom*S;return f==="height"||f==="both"?($=b[1]+lt-g[0],re=b[1]+ct+g[2]):re=($=b[1]+(lt+ct-R.displaySize[1])/2)+R.displaySize[1],{image:R,top:$,right:J,bottom:re,left:xe,collisionPadding:T}}pi[10]=!0,pi[32]=!0,pi[38]=!0,pi[40]=!0,pi[41]=!0,pi[43]=!0,pi[45]=!0,pi[47]=!0,pi[173]=!0,pi[183]=!0,pi[8203]=!0,pi[8208]=!0,pi[8211]=!0,pi[8231]=!0;var fo=function(s){function u(f,g,b,S){s.call(this,f,g),this.angle=b,S!==void 0&&(this.segment=S)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(se);function qo(s,u){var f=u.expression;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Oi(s+1))};if(f.kind==="source")return{kind:"source"};for(var g=f.zoomStops,b=f.interpolationType,S=0;S<g.length&&g[S]<=s;)S++;for(var T=S=Math.max(0,S-1);T<g.length&&g[T]<s+1;)T++;T=Math.min(g.length-1,T);var R=g[S],F=g[T];return f.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:F,interpolationType:b}:{kind:"camera",minZoom:R,maxZoom:F,minSize:f.evaluate(new Oi(R)),maxSize:f.evaluate(new Oi(F)),interpolationType:b}}function Os(s,u,f){var g=u.uSize,b=f.lowerSize;return s.kind==="source"?b/128:s.kind==="composite"?Et(b/128,f.upperSize/128,u.uSizeT):g}function Ho(s,u){var f=0,g=0;if(s.kind==="constant")g=s.layoutSize;else if(s.kind!=="source"){var b=s.interpolationType,S=b?Dt(is.interpolationFactor(b,u,s.minZoom,s.maxZoom),0,1):0;s.kind==="camera"?g=Et(s.minSize,s.maxSize,S):f=S}return{uSizeT:f,uSize:g}}kn("Anchor",fo);var Gi=Object.freeze({__proto__:null,getSizeData:qo,evaluateSizeForFeature:Os,evaluateSizeForZoom:Ho,SIZE_PACK_FACTOR:128});function Ss(s,u,f,g,b){if(u.segment===void 0)return!0;for(var S=u,T=u.segment+1,R=0;R>-f/2;){if(--T<0)return!1;R-=s[T].dist(S),S=s[T]}R+=s[T].dist(s[T+1]),T++;for(var F=[],V=0;R<f/2;){var $=s[T],J=s[T+1];if(!J)return!1;var re=s[T-1].angleTo($)-$.angleTo(J);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:R,angleDelta:re}),V+=re;R-F[0].distance>g;)V-=F.shift().angleDelta;if(V>b)return!1;T++,R+=$.dist(J)}return!0}function da(s){for(var u=0,f=0;f<s.length-1;f++)u+=s[f].dist(s[f+1]);return u}function di(s,u,f){return s?.6*u*f:0}function Di(s,u){return Math.max(s?s.right-s.left:0,u?u.right-u.left:0)}function ua(s,u,f,g,b,S){for(var T=di(f,b,S),R=Di(f,g)*S,F=0,V=da(s)/2,$=0;$<s.length-1;$++){var J=s[$],re=s[$+1],xe=J.dist(re);if(F+xe>V){var ze=(V-F)/xe,Fe=Et(J.x,re.x,ze),lt=Et(J.y,re.y,ze),ct=new fo(Fe,lt,re.angleTo(J),$);return ct._round(),!T||Ss(s,ct,R,T,u)?ct:void 0}F+=xe}}function hs(s,u,f,g,b,S,T,R,F){var V=di(g,S,T),$=Di(g,b),J=$*T,re=s[0].x===0||s[0].x===F||s[0].y===0||s[0].y===F;return u-J<u/4&&(u=J+u/4),function xe(ze,Fe,lt,ct,wt,Ht,ar,Mr,gr){for(var un=Ht/2,fn=da(ze),Fn=0,$n=Fe-lt,Un=[],In=0;In<ze.length-1;In++){for(var Si=ze[In],ai=ze[In+1],qn=Si.dist(ai),ea=ai.angleTo(Si);$n+lt<Fn+qn;){var Bi=(($n+=lt)-Fn)/qn,xa=Et(Si.x,ai.x,Bi),vi=Et(Si.y,ai.y,Bi);if(xa>=0&&xa<gr&&vi>=0&&vi<gr&&$n-un>=0&&$n+un<=fn){var na=new fo(xa,vi,ea,In);na._round(),ct&&!Ss(ze,na,Ht,ct,wt)||Un.push(na)}}Fn+=qn}return Mr||Un.length||ar||(Un=xe(ze,Fn/2,lt,ct,wt,Ht,ar,!0,gr)),Un}(s,re?u/2*R%u:($/2+2*S)*T*R%u,u,V,f,J,re,!1,F)}function iu(s,u,f,g,b){for(var S=[],T=0;T<s.length;T++)for(var R=s[T],F=void 0,V=0;V<R.length-1;V++){var $=R[V],J=R[V+1];$.x<u&&J.x<u||($.x<u?$=new se(u,$.y+(u-$.x)/(J.x-$.x)*(J.y-$.y))._round():J.x<u&&(J=new se(u,$.y+(u-$.x)/(J.x-$.x)*(J.y-$.y))._round()),$.y<f&&J.y<f||($.y<f?$=new se($.x+(f-$.y)/(J.y-$.y)*(J.x-$.x),f)._round():J.y<f&&(J=new se($.x+(f-$.y)/(J.y-$.y)*(J.x-$.x),f)._round()),$.x>=g&&J.x>=g||($.x>=g?$=new se(g,$.y+(g-$.x)/(J.x-$.x)*(J.y-$.y))._round():J.x>=g&&(J=new se(g,$.y+(g-$.x)/(J.x-$.x)*(J.y-$.y))._round()),$.y>=b&&J.y>=b||($.y>=b?$=new se($.x+(b-$.y)/(J.y-$.y)*(J.x-$.x),b)._round():J.y>=b&&(J=new se($.x+(b-$.y)/(J.y-$.y)*(J.x-$.x),b)._round()),F&&$.equals(F[F.length-1])||S.push(F=[$]),F.push(J)))))}return S}function Ge(s,u,f,g){var b=[],S=s.image,T=S.pixelRatio,R=S.paddedRect.w-2,F=S.paddedRect.h-2,V=s.right-s.left,$=s.bottom-s.top,J=S.stretchX||[[0,R]],re=S.stretchY||[[0,F]],xe=function(vi,na){return vi+na[1]-na[0]},ze=J.reduce(xe,0),Fe=re.reduce(xe,0),lt=R-ze,ct=F-Fe,wt=0,Ht=ze,ar=0,Mr=Fe,gr=0,un=lt,fn=0,Fn=ct;if(S.content&&g){var $n=S.content;wt=lr(J,0,$n[0]),ar=lr(re,0,$n[1]),Ht=lr(J,$n[0],$n[2]),Mr=lr(re,$n[1],$n[3]),gr=$n[0]-wt,fn=$n[1]-ar,un=$n[2]-$n[0]-Ht,Fn=$n[3]-$n[1]-Mr}var Un=function(vi,na,Qa,Wa){var ho=En(vi.stretch-wt,Ht,V,s.left),po=Fi(vi.fixed-gr,un,vi.stretch,ze),So=En(na.stretch-ar,Mr,$,s.top),Rs=Fi(na.fixed-fn,Fn,na.stretch,Fe),Go=En(Qa.stretch-wt,Ht,V,s.left),au=Fi(Qa.fixed-gr,un,Qa.stretch,ze),Ts=En(Wa.stretch-ar,Mr,$,s.top),ou=Fi(Wa.fixed-fn,Fn,Wa.stretch,Fe),ps=new se(ho,So),es=new se(Go,So),ds=new se(Go,Ts),fa=new se(ho,Ts),aa=new se(po/T,Rs/T),Va=new se(au/T,ou/T),Ja=u*Math.PI/180;if(Ja){var su=Math.sin(Ja),ro=Math.cos(Ja),vo=[ro,-su,su,ro];ps._matMult(vo),es._matMult(vo),fa._matMult(vo),ds._matMult(vo)}var Ws=vi.stretch+vi.fixed,la=na.stretch+na.fixed;return{tl:ps,tr:es,bl:fa,br:ds,tex:{x:S.paddedRect.x+1+Ws,y:S.paddedRect.y+1+la,w:Qa.stretch+Qa.fixed-Ws,h:Wa.stretch+Wa.fixed-la},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:aa,pixelOffsetBR:Va,minFontScaleX:un/T/V,minFontScaleY:Fn/T/$,isSDF:f}};if(g&&(S.stretchX||S.stretchY))for(var In=Yt(J,lt,ze),Si=Yt(re,ct,Fe),ai=0;ai<In.length-1;ai++)for(var qn=In[ai],ea=In[ai+1],Bi=0;Bi<Si.length-1;Bi++)b.push(Un(qn,Si[Bi],ea,Si[Bi+1]));else b.push(Un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:F+1}));return b}function lr(s,u,f){for(var g=0,b=0,S=s;b<S.length;b+=1){var T=S[b];g+=Math.max(u,Math.min(f,T[1]))-Math.max(u,Math.min(f,T[0]))}return g}function Yt(s,u,f){for(var g=[{fixed:-1,stretch:0}],b=0,S=s;b<S.length;b+=1){var T=S[b],R=T[0],F=T[1],V=g[g.length-1];g.push({fixed:R-V.stretch,stretch:V.stretch}),g.push({fixed:R-V.stretch,stretch:V.stretch+(F-R)})}return g.push({fixed:u+1,stretch:f}),g}function En(s,u,f,g){return s/u*f+g}function Fi(s,u,f,g){return s-u*f/g}var Ca=function(u,f,g,b,S,T,R,F,V,$){if(this.boxStartIndex=u.length,V){var J=T.top,re=T.bottom,xe=T.collisionPadding;xe&&(J-=xe[1],re+=xe[3]);var ze=re-J;ze>0&&(ze=Math.max(10,ze),this.circleDiameter=ze)}else{var Fe=T.top*R-F,lt=T.bottom*R+F,ct=T.left*R-F,wt=T.right*R+F,Ht=T.collisionPadding;if(Ht&&(ct-=Ht[0]*R,Fe-=Ht[1]*R,wt+=Ht[2]*R,lt+=Ht[3]*R),$){var ar=new se(ct,Fe),Mr=new se(wt,Fe),gr=new se(ct,lt),un=new se(wt,lt),fn=$*Math.PI/180;ar._rotate(fn),Mr._rotate(fn),gr._rotate(fn),un._rotate(fn),ct=Math.min(ar.x,Mr.x,gr.x,un.x),wt=Math.max(ar.x,Mr.x,gr.x,un.x),Fe=Math.min(ar.y,Mr.y,gr.y,un.y),lt=Math.max(ar.y,Mr.y,gr.y,un.y)}u.emplaceBack(f.x,f.y,ct,Fe,wt,lt,g,b,S)}this.boxEndIndex=u.length},de=function(u,f){if(u===void 0&&(u=[]),f===void 0&&(f=Ie),this.data=u,this.length=this.data.length,this.compare=f,this.length>0)for(var g=(this.length>>1)-1;g>=0;g--)this._down(g)};function Ie(s,u){return s<u?-1:s>u?1:0}function rt(s,u,f){u===void 0&&(u=1),f===void 0&&(f=!1);for(var g=1/0,b=1/0,S=-1/0,T=-1/0,R=s[0],F=0;F<R.length;F++){var V=R[F];(!F||V.x<g)&&(g=V.x),(!F||V.y<b)&&(b=V.y),(!F||V.x>S)&&(S=V.x),(!F||V.y>T)&&(T=V.y)}var $=Math.min(S-g,T-b),J=$/2,re=new de([],nr);if($===0)return new se(g,b);for(var xe=g;xe<S;xe+=$)for(var ze=b;ze<T;ze+=$)re.push(new qt(xe+J,ze+J,J,s));for(var Fe=function(wt){for(var Ht=0,ar=0,Mr=0,gr=wt[0],un=0,fn=gr.length,Fn=fn-1;un<fn;Fn=un++){var $n=gr[un],Un=gr[Fn],In=$n.x*Un.y-Un.x*$n.y;ar+=($n.x+Un.x)*In,Mr+=($n.y+Un.y)*In,Ht+=3*In}return new qt(ar/Ht,Mr/Ht,0,wt)}(s),lt=re.length;re.length;){var ct=re.pop();(ct.d>Fe.d||!Fe.d)&&(Fe=ct,f&&console.log("found best %d after %d probes",Math.round(1e4*ct.d)/1e4,lt)),ct.max-Fe.d<=u||(re.push(new qt(ct.p.x-(J=ct.h/2),ct.p.y-J,J,s)),re.push(new qt(ct.p.x+J,ct.p.y-J,J,s)),re.push(new qt(ct.p.x-J,ct.p.y+J,J,s)),re.push(new qt(ct.p.x+J,ct.p.y+J,J,s)),lt+=4)}return f&&(console.log("num probes: "+lt),console.log("best distance: "+Fe.d)),Fe.p}function nr(s,u){return u.max-s.max}function qt(s,u,f,g){this.p=new se(s,u),this.h=f,this.d=function(b,S){for(var T=!1,R=1/0,F=0;F<S.length;F++)for(var V=S[F],$=0,J=V.length,re=J-1;$<J;re=$++){var xe=V[$],ze=V[re];xe.y>b.y!=ze.y>b.y&&b.x<(ze.x-xe.x)*(b.y-xe.y)/(ze.y-xe.y)+xe.x&&(T=!T),R=Math.min(R,Zl(b,xe,ze))}return(T?1:-1)*Math.sqrt(R)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}de.prototype.push=function(s){this.data.push(s),this.length++,this._up(this.length-1)},de.prototype.pop=function(){if(this.length!==0){var s=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),s}},de.prototype.peek=function(){return this.data[0]},de.prototype._up=function(s){for(var u=this.data,f=this.compare,g=u[s];s>0;){var b=s-1>>1,S=u[b];if(f(g,S)>=0)break;u[s]=S,s=b}u[s]=g},de.prototype._down=function(s){for(var u=this.data,f=this.compare,g=this.length>>1,b=u[s];s<g;){var S=1+(s<<1),T=u[S],R=S+1;if(R<this.length&&f(u[R],T)<0&&(S=R,T=u[R]),f(T,b)>=0)break;u[s]=T,s=S}u[s]=b};var dt=Number.POSITIVE_INFINITY;function bt(s,u){return u[1]!==dt?function(f,g,b){var S=0,T=0;switch(g=Math.abs(g),b=Math.abs(b),f){case"top-right":case"top-left":case"top":T=b-7;break;case"bottom-right":case"bottom-left":case"bottom":T=7-b}switch(f){case"top-right":case"bottom-right":case"right":S=-g;break;case"top-left":case"bottom-left":case"left":S=g}return[S,T]}(s,u[0],u[1]):function(f,g){var b=0,S=0;g<0&&(g=0);var T=g/Math.sqrt(2);switch(f){case"top-right":case"top-left":S=T-7;break;case"bottom-right":case"bottom-left":S=7-T;break;case"bottom":S=7-g;break;case"top":S=g-7}switch(f){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=g;break;case"right":b=-g}return[b,S]}(s,u[0])}function Tt(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ve(s,u,f,g,b,S,T,R,F,V,$,J,re,xe,ze){var Fe=function(ar,Mr,gr,un,fn,Fn,$n,Un){for(var In=un.layout.get("text-rotate").evaluate(Fn,{})*Math.PI/180,Si=[],ai=0,qn=Mr.positionedLines;ai<qn.length;ai+=1)for(var ea=qn[ai],Bi=0,xa=ea.positionedGlyphs;Bi<xa.length;Bi+=1){var vi=xa[Bi];if(vi.rect){var na=vi.rect||{},Qa=4,Wa=!0,ho=1,po=0,So=(fn||Un)&&vi.vertical,Rs=vi.metrics.advance*vi.scale/2;if(Un&&Mr.verticalizable&&(po=ea.lineOffset/2-(vi.imageName?-(24-vi.metrics.width*vi.scale)/2:24*(vi.scale-1))),vi.imageName){var Go=$n[vi.imageName];Wa=Go.sdf,Qa=1/(ho=Go.pixelRatio)}var au=fn?[vi.x+Rs,vi.y]:[0,0],Ts=fn?[0,0]:[vi.x+Rs+gr[0],vi.y+gr[1]-po],ou=[0,0];So&&(ou=Ts,Ts=[0,0]);var ps=(vi.metrics.left-Qa)*vi.scale-Rs+Ts[0],es=(-vi.metrics.top-Qa)*vi.scale+Ts[1],ds=ps+na.w*vi.scale/ho,fa=es+na.h*vi.scale/ho,aa=new se(ps,es),Va=new se(ds,es),Ja=new se(ps,fa),su=new se(ds,fa);if(So){var ro=new se(-Rs,Rs- -17),vo=-Math.PI/2,Ws=12-Rs,la=new se(22-Ws,-(vi.imageName?Ws:0)),jf=new(Function.prototype.bind.apply(se,[null].concat(ou)));aa._rotateAround(vo,ro)._add(la)._add(jf),Va._rotateAround(vo,ro)._add(la)._add(jf),Ja._rotateAround(vo,ro)._add(la)._add(jf),su._rotateAround(vo,ro)._add(la)._add(jf)}if(In){var xl=Math.sin(In),gc=Math.cos(In),rl=[gc,-xl,xl,gc];aa._matMult(rl),Va._matMult(rl),Ja._matMult(rl),su._matMult(rl)}var Ms=new se(0,0),zf=new se(0,0);Si.push({tl:aa,tr:Va,bl:Ja,br:su,tex:na,writingMode:Mr.writingMode,glyphOffset:au,sectionIndex:vi.sectionIndex,isSDF:Wa,pixelOffsetTL:Ms,pixelOffsetBR:zf,minFontScaleX:0,minFontScaleY:0})}}return Si}(0,f,R,b,S,T,g,s.allowVerticalPlacement),lt=s.textSizeData,ct=null;lt.kind==="source"?(ct=[128*b.layout.get("text-size").evaluate(T,{})])[0]>32640&&Gt(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):lt.kind==="composite"&&((ct=[128*xe.compositeTextSizes[0].evaluate(T,{},ze),128*xe.compositeTextSizes[1].evaluate(T,{},ze)])[0]>32640||ct[1]>32640)&&Gt(s.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),s.addSymbols(s.text,Fe,ct,R,S,T,V,u,F.lineStartIndex,F.lineLength,re,ze);for(var wt=0,Ht=$;wt<Ht.length;wt+=1)J[Ht[wt]]=s.text.placedSymbolArray.length-1;return 4*Fe.length}function yt(s){for(var u in s)return s[u];return null}function Me(s,u,f,g){var b=s.compareText;if(u in b){for(var S=b[u],T=S.length-1;T>=0;T--)if(g.dist(S[T])<f)return!0}else b[u]=[];return b[u].push(g),!1}var _t=Ql.VectorTileFeature.types,hr=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function mr(s,u,f,g,b,S,T,R,F,V,$,J,re){var xe=R?Math.min(32640,Math.round(R[0])):0,ze=R?Math.min(32640,Math.round(R[1])):0;s.emplaceBack(u,f,Math.round(32*g),Math.round(32*b),S,T,(xe<<1)+(F?1:0),ze,16*V,16*$,256*J,256*re)}function zr(s,u,f){s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f),s.emplaceBack(u.x,u.y,f)}function kr(s){for(var u=0,f=s.sections;u<f.length;u+=1)if(uh(f[u].text))return!0;return!1}var Xr=function(u){this.layoutVertexArray=new fh,this.indexArray=new L,this.programConfigurations=u,this.segments=new ye,this.dynamicLayoutVertexArray=new Zc,this.opacityVertexArray=new hh,this.placedSymbolArray=new y};Xr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Xr.prototype.upload=function(s,u,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Iv.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,fy.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,hr,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(s))},Xr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},kn("SymbolBuffers",Xr);var Zn=function(u,f,g){this.layoutVertexArray=new u,this.layoutAttributes=f,this.indexArray=new g,this.segments=new ye,this.collisionVertexArray=new Wh};Zn.prototype.upload=function(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,kv.members,!0)},Zn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},kn("CollisionBuffers",Zn);var Dn=function(u){this.collisionBoxArray=u.collisionBoxArray,this.zoom=u.zoom,this.overscaling=u.overscaling,this.layers=u.layers,this.layerIds=this.layers.map(function(T){return T.id}),this.index=u.index,this.pixelRatio=u.pixelRatio,this.sourceLayerIndex=u.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Da([]),this.placementViewportMatrix=Da([]);var f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qo(this.zoom,f["text-size"]),this.iconSizeData=qo(this.zoom,f["icon-size"]);var g=this.layers[0].layout,b=g.get("symbol-sort-key"),S=g.get("symbol-z-order");this.canOverlap=g.get("text-allow-overlap")||g.get("icon-allow-overlap")||g.get("text-ignore-placement")||g.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&b.constantOr(1)!==void 0,this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,g.get("symbol-placement")==="point"&&(this.writingModes=g.get("text-writing-mode").map(function(T){return ii[T]})),this.stateDependentLayerIds=this.layers.filter(function(T){return T.isStateDependent()}).map(function(T){return T.id}),this.sourceID=u.sourceID};Dn.prototype.createArrays=function(){this.text=new Xr(new zi(this.layers,this.zoom,function(s){return/^text/.test(s)})),this.icon=new Xr(new zi(this.layers,this.zoom,function(s){return/^icon/.test(s)})),this.glyphOffsetArray=new M,this.lineVertexArray=new k,this.symbolInstances=new w},Dn.prototype.calculateGlyphDependencies=function(s,u,f,g,b){for(var S=0;S<s.length;S++)if(u[s.charCodeAt(S)]=!0,(f||g)&&b){var T=it[s.charAt(S)];T&&(u[T.charCodeAt(0)]=!0)}},Dn.prototype.populate=function(s,u,f){var g=this.layers[0],b=g.layout,S=b.get("text-font"),T=b.get("text-field"),R=b.get("icon-image"),F=(T.value.kind!=="constant"||T.value.value instanceof _o&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),V=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,$=b.get("symbol-sort-key");if(this.features=[],F||V){for(var J=u.iconDependencies,re=u.glyphDependencies,xe=u.availableImages,ze=new Oi(this.zoom),Fe=0,lt=s;Fe<lt.length;Fe+=1){var ct=lt[Fe],wt=ct.feature,Ht=ct.id,ar=ct.index,Mr=ct.sourceLayerIndex,gr=g._featureFilter.needGeometry,un=Ka(wt,gr);if(g._featureFilter.filter(ze,un,f)){gr||(un.geometry=Ya(wt));var fn=void 0;if(F){var Fn=g.getValueAndResolveTokens("text-field",un,f,xe),$n=_o.factory(Fn);kr($n)&&(this.hasRTLText=!0),(!this.hasRTLText||Vh()==="unavailable"||this.hasRTLText&&zs.isParsed())&&(fn=ce($n,g,un))}var Un=void 0;if(V){var In=g.getValueAndResolveTokens("icon-image",un,f,xe);Un=In instanceof ms?In:ms.fromString(In)}if(fn||Un){var Si=this.sortFeaturesByKey?$.evaluate(un,{},f):void 0;if(this.features.push({id:Ht,text:fn,icon:Un,index:ar,sourceLayerIndex:Mr,geometry:un.geometry,properties:wt.properties,type:_t[wt.type],sortKey:Si}),Un&&(J[Un.name]=!0),fn){var ai=S.evaluate(un,{},f).join(","),qn=b.get("text-rotation-alignment")==="map"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ii.vertical)>=0;for(var ea=0,Bi=fn.sections;ea<Bi.length;ea+=1){var xa=Bi[ea];if(xa.image)J[xa.image.name]=!0;else{var vi=fl(fn.toString()),na=xa.fontStack||ai,Qa=re[na]=re[na]||{};this.calculateGlyphDependencies(xa.text,Qa,qn,this.allowVerticalPlacement,vi)}}}}}}b.get("symbol-placement")==="line"&&(this.features=function(Wa){var ho={},po={},So=[],Rs=0;function Go(ro){So.push(Wa[ro]),Rs++}function au(ro,vo,Ws){var la=po[ro];return delete po[ro],po[vo]=la,So[la].geometry[0].pop(),So[la].geometry[0]=So[la].geometry[0].concat(Ws[0]),la}function Ts(ro,vo,Ws){var la=ho[vo];return delete ho[vo],ho[ro]=la,So[la].geometry[0].shift(),So[la].geometry[0]=Ws[0].concat(So[la].geometry[0]),la}function ou(ro,vo,Ws){var la=Ws?vo[0][vo[0].length-1]:vo[0][0];return ro+":"+la.x+":"+la.y}for(var ps=0;ps<Wa.length;ps++){var es=Wa[ps],ds=es.geometry,fa=es.text?es.text.toString():null;if(fa){var aa=ou(fa,ds),Va=ou(fa,ds,!0);if(aa in po&&Va in ho&&po[aa]!==ho[Va]){var Ja=Ts(aa,Va,ds),su=au(aa,Va,So[Ja].geometry);delete ho[aa],delete po[Va],po[ou(fa,So[su].geometry,!0)]=su,So[Ja].geometry=null}else aa in po?au(aa,Va,ds):Va in ho?Ts(aa,Va,ds):(Go(ps),ho[aa]=Rs-1,po[Va]=Rs-1)}else Go(ps)}return So.filter(function(ro){return ro.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Wa,ho){return Wa.sortKey-ho.sortKey})}},Dn.prototype.update=function(s,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(s,u,this.layers,f))},Dn.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Dn.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Dn.prototype.upload=function(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Dn.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Dn.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Dn.prototype.addToLineVertexArray=function(s,u){var f=this.lineVertexArray.length;if(s.segment!==void 0){for(var g=s.dist(u[s.segment+1]),b=s.dist(u[s.segment]),S={},T=s.segment+1;T<u.length;T++)S[T]={x:u[T].x,y:u[T].y,tileUnitDistanceFromAnchor:g},T<u.length-1&&(g+=u[T+1].dist(u[T]));for(var R=s.segment||0;R>=0;R--)S[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:b},R>0&&(b+=u[R-1].dist(u[R]));for(var F=0;F<u.length;F++){var V=S[F];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}},Dn.prototype.addSymbols=function(s,u,f,g,b,S,T,R,F,V,$,J){for(var re=s.indexArray,xe=s.layoutVertexArray,ze=s.segments.prepareSegment(4*u.length,xe,re,this.canOverlap?S.sortKey:void 0),Fe=this.glyphOffsetArray.length,lt=ze.vertexLength,ct=this.allowVerticalPlacement&&T===ii.vertical?Math.PI/2:0,wt=S.text&&S.text.sections,Ht=0;Ht<u.length;Ht++){var ar=u[Ht],Mr=ar.tl,gr=ar.tr,un=ar.bl,fn=ar.br,Fn=ar.tex,$n=ar.pixelOffsetTL,Un=ar.pixelOffsetBR,In=ar.minFontScaleX,Si=ar.minFontScaleY,ai=ar.glyphOffset,qn=ar.isSDF,ea=ar.sectionIndex,Bi=ze.vertexLength,xa=ai[1];mr(xe,R.x,R.y,Mr.x,xa+Mr.y,Fn.x,Fn.y,f,qn,$n.x,$n.y,In,Si),mr(xe,R.x,R.y,gr.x,xa+gr.y,Fn.x+Fn.w,Fn.y,f,qn,Un.x,$n.y,In,Si),mr(xe,R.x,R.y,un.x,xa+un.y,Fn.x,Fn.y+Fn.h,f,qn,$n.x,Un.y,In,Si),mr(xe,R.x,R.y,fn.x,xa+fn.y,Fn.x+Fn.w,Fn.y+Fn.h,f,qn,Un.x,Un.y,In,Si),zr(s.dynamicLayoutVertexArray,R,ct),re.emplaceBack(Bi,Bi+1,Bi+2),re.emplaceBack(Bi+1,Bi+2,Bi+3),ze.vertexLength+=4,ze.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ai[0]),Ht!==u.length-1&&ea===u[Ht+1].sectionIndex||s.programConfigurations.populatePaintArrays(xe.length,S,S.index,{},J,wt&&wt[ea])}s.placedSymbolArray.emplaceBack(R.x,R.y,Fe,this.glyphOffsetArray.length-Fe,lt,F,V,R.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,$)},Dn.prototype._addCollisionDebugVertex=function(s,u,f,g,b,S){return u.emplaceBack(0,0),s.emplaceBack(f.x,f.y,g,b,Math.round(S.x),Math.round(S.y))},Dn.prototype.addCollisionDebugVertices=function(s,u,f,g,b,S,T){var R=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),F=R.vertexLength,V=b.layoutVertexArray,$=b.collisionVertexArray,J=T.anchorX,re=T.anchorY;this._addCollisionDebugVertex(V,$,S,J,re,new se(s,u)),this._addCollisionDebugVertex(V,$,S,J,re,new se(f,u)),this._addCollisionDebugVertex(V,$,S,J,re,new se(f,g)),this._addCollisionDebugVertex(V,$,S,J,re,new se(s,g)),R.vertexLength+=4;var xe=b.indexArray;xe.emplaceBack(F,F+1),xe.emplaceBack(F+1,F+2),xe.emplaceBack(F+2,F+3),xe.emplaceBack(F+3,F),R.primitiveLength+=4},Dn.prototype.addDebugCollisionBoxes=function(s,u,f,g){for(var b=s;b<u;b++){var S=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,g?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,f)}},Dn.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zn($c,Ad.members,Gl),this.iconCollisionBox=new Zn($c,Ad.members,Gl);for(var s=0;s<this.symbolInstances.length;s++){var u=this.symbolInstances.get(s);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},Dn.prototype._deserializeCollisionBoxesForSymbol=function(s,u,f,g,b,S,T,R,F){for(var V={},$=u;$<f;$++){var J=s.get($);V.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},V.textFeatureIndex=J.featureIndex;break}for(var re=g;re<b;re++){var xe=s.get(re);V.verticalTextBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},V.verticalTextFeatureIndex=xe.featureIndex;break}for(var ze=S;ze<T;ze++){var Fe=s.get(ze);V.iconBox={x1:Fe.x1,y1:Fe.y1,x2:Fe.x2,y2:Fe.y2,anchorPointX:Fe.anchorPointX,anchorPointY:Fe.anchorPointY},V.iconFeatureIndex=Fe.featureIndex;break}for(var lt=R;lt<F;lt++){var ct=s.get(lt);V.verticalIconBox={x1:ct.x1,y1:ct.y1,x2:ct.x2,y2:ct.y2,anchorPointX:ct.anchorPointX,anchorPointY:ct.anchorPointY},V.verticalIconFeatureIndex=ct.featureIndex;break}return V},Dn.prototype.deserializeCollisionBoxes=function(s){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}},Dn.prototype.hasTextData=function(){return this.text.segments.get().length>0},Dn.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Dn.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Dn.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Dn.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Dn.prototype.addIndicesForPlacedSymbol=function(s,u){for(var f=s.placedSymbolArray.get(u),g=f.vertexStartIndex+4*f.numGlyphs,b=f.vertexStartIndex;b<g;b+=4)s.indexArray.emplaceBack(b,b+1,b+2),s.indexArray.emplaceBack(b+1,b+2,b+3)},Dn.prototype.getSortedSymbolIndexes=function(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(s),f=Math.cos(s),g=[],b=[],S=[],T=0;T<this.symbolInstances.length;++T){S.push(T);var R=this.symbolInstances.get(T);g.push(0|Math.round(u*R.anchorX+f*R.anchorY)),b.push(R.featureIndex)}return S.sort(function(F,V){return g[F]-g[V]||b[V]-b[F]}),S},Dn.prototype.addToSortKeyRanges=function(s,u){var f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:s,symbolInstanceEnd:s+1})},Dn.prototype.sortFeatures=function(s){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var f=0,g=this.symbolInstanceIndexes;f<g.length;f+=1){var b=this.symbolInstances.get(g[f]);this.featureSortOrder.push(b.featureIndex),[b.rightJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.leftJustifiedTextSymbolIndex].forEach(function(S,T,R){S>=0&&R.indexOf(S)===T&&u.addIndicesForPlacedSymbol(u.text,S)}),b.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,b.verticalPlacedTextSymbolIndex),b.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.placedIconSymbolIndex),b.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,b.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},kn("SymbolBucket",Dn,{omit:["layers","collisionBoxArray","features","compareText"]}),Dn.MAX_GLYPHS=65535,Dn.addDynamicAttributes=zr;var zn=new $a({"symbol-placement":new ti(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new ti(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ti(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new jn(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ti(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ti(ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ti(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new ti(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ti(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new jn(ge.layout_symbol["icon-size"]),"icon-text-fit":new ti(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ti(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new jn(ge.layout_symbol["icon-image"]),"icon-rotate":new jn(ge.layout_symbol["icon-rotate"]),"icon-padding":new ti(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new ti(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new jn(ge.layout_symbol["icon-offset"]),"icon-anchor":new jn(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ti(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ti(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ti(ge.layout_symbol["text-rotation-alignment"]),"text-field":new jn(ge.layout_symbol["text-field"]),"text-font":new jn(ge.layout_symbol["text-font"]),"text-size":new jn(ge.layout_symbol["text-size"]),"text-max-width":new jn(ge.layout_symbol["text-max-width"]),"text-line-height":new ti(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new jn(ge.layout_symbol["text-letter-spacing"]),"text-justify":new jn(ge.layout_symbol["text-justify"]),"text-radial-offset":new jn(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ti(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new jn(ge.layout_symbol["text-anchor"]),"text-max-angle":new ti(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new ti(ge.layout_symbol["text-writing-mode"]),"text-rotate":new jn(ge.layout_symbol["text-rotate"]),"text-padding":new ti(ge.layout_symbol["text-padding"]),"text-keep-upright":new ti(ge.layout_symbol["text-keep-upright"]),"text-transform":new jn(ge.layout_symbol["text-transform"]),"text-offset":new jn(ge.layout_symbol["text-offset"]),"text-allow-overlap":new ti(ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ti(ge.layout_symbol["text-ignore-placement"]),"text-optional":new ti(ge.layout_symbol["text-optional"])}),fi={paint:new $a({"icon-opacity":new jn(ge.paint_symbol["icon-opacity"]),"icon-color":new jn(ge.paint_symbol["icon-color"]),"icon-halo-color":new jn(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new jn(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new jn(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new ti(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new ti(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new jn(ge.paint_symbol["text-opacity"]),"text-color":new jn(ge.paint_symbol["text-color"],{runtimeType:we,getOverride:function(u){return u.textColor},hasOverride:function(u){return!!u.textColor}}),"text-halo-color":new jn(ge.paint_symbol["text-halo-color"]),"text-halo-width":new jn(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new jn(ge.paint_symbol["text-halo-blur"]),"text-translate":new ti(ge.paint_symbol["text-translate"]),"text-translate-anchor":new ti(ge.paint_symbol["text-translate-anchor"])}),layout:zn},yi=function(u){this.type=u.property.overrides?u.property.overrides.runtimeType:wn,this.defaultValue=u};yi.prototype.evaluate=function(s){if(s.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(s.formattedSection))return u.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default},yi.prototype.eachChild=function(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)},yi.prototype.outputDefined=function(){return!1},yi.prototype.serialize=function(){return null},kn("FormatSectionOverride",yi,{omit:["defaultValue"]});var va=function(s){function u(f){s.call(this,f,fi)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.recalculate=function(f,g){if(s.prototype.recalculate.call(this,f,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var b=this.layout.get("text-writing-mode");if(b){for(var S=[],T=0,R=b;T<R.length;T+=1){var F=R[T];S.indexOf(F)<0&&S.push(F)}this.layout._values["text-writing-mode"]=S}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(f,g,b,S){var T=this.layout.get(f).evaluate(g,{},b,S),R=this._unevaluatedLayout._values[f];return R.isDataDriven()||Fl(R.value)||!T?T:function(F,V){return V.replace(/{([^{}]+)}/g,function($,J){return J in F?String(F[J]):""})}(g.properties,T)},u.prototype.createBucket=function(f){return new Dn(f)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var f=0,g=fi.paint.overridableProperties;f<g.length;f+=1){var b=g[f];if(u.hasPaintOverride(this.layout,b)){var S,T=this.paint.get(b),R=new yi(T),F=new Bo(R,T.property.specification);S=T.value.kind==="constant"||T.value.kind==="source"?new cl("source",F):new Bl("composite",F,T.value.zoomStops,T.value._interpolationType),this.paint._values[b]=new Ko(T.property,S,T.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(f,g,b){return!(!this.layout||g.isDataDriven()||b.isDataDriven())&&u.hasPaintOverride(this.layout,f)},u.hasPaintOverride=function(f,g){var b=f.get("text-field"),S=fi.paint.properties[g],T=!1,R=function(J){for(var re=0,xe=J;re<xe.length;re+=1)if(S.overrides&&S.overrides.hasOverride(xe[re]))return void(T=!0)};if(b.value.kind==="constant"&&b.value.value instanceof _o)R(b.value.value.sections);else if(b.value.kind==="source"){var F=function $(J){T||(J instanceof Zo&&Ia(J.value)===ia?R(J.value.sections):J instanceof Do?R(J.sections):J.eachChild($))},V=b.value;V._styleExpression&&F(V._styleExpression.expression)}return T},u}(_u),Wo={paint:new $a({"background-color":new ti(ge.paint_background["background-color"]),"background-pattern":new bs(ge.paint_background["background-pattern"]),"background-opacity":new ti(ge.paint_background["background-opacity"])})},bl=function(s){function u(f){s.call(this,f,Wo)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(_u),Td={paint:new $a({"raster-opacity":new ti(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new ti(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ti(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ti(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new ti(ge.paint_raster["raster-saturation"]),"raster-contrast":new ti(ge.paint_raster["raster-contrast"]),"raster-resampling":new ti(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new ti(ge.paint_raster["raster-fade-duration"])})},tl=function(s){function u(f){s.call(this,f,Td)}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u}(_u),Dv=function(s){function u(f){s.call(this,f,{}),this.implementation=f}return s&&(u.__proto__=s),(u.prototype=Object.create(s&&s.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(f){this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},u.prototype.onRemove=function(f){this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},u}(_u),mc={circle:Xh,heatmap:mh,hillshade:bv,fill:bd,"fill-extrusion":wv,line:Pv,symbol:va,background:bl,raster:tl},Ip=ue.HTMLImageElement,hy=ue.HTMLCanvasElement,py=ue.HTMLVideoElement,dy=ue.ImageData,kp=ue.ImageBitmap,Qh=function(u,f,g,b){this.context=u,this.format=g,this.texture=u.gl.createTexture(),this.update(f,b)};Qh.prototype.update=function(s,u,f){var g=s.width,b=s.height,S=!(this.size&&this.size[0]===g&&this.size[1]===b||f),T=this.context,R=T.gl;if(this.useMipmap=Boolean(u&&u.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),T.pixelStoreUnpackFlipY.set(!1),T.pixelStoreUnpack.set(1),T.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!u||u.premultiply!==!1)),S)this.size=[g,b],s instanceof Ip||s instanceof hy||s instanceof py||s instanceof dy||kp&&s instanceof kp?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,s):R.texImage2D(R.TEXTURE_2D,0,this.format,g,b,0,this.format,R.UNSIGNED_BYTE,s.data);else{var F=f||{x:0,y:0},V=F.x,$=F.y;s instanceof Ip||s instanceof hy||s instanceof py||s instanceof dy||kp&&s instanceof kp?R.texSubImage2D(R.TEXTURE_2D,0,V,$,R.RGBA,R.UNSIGNED_BYTE,s):R.texSubImage2D(R.TEXTURE_2D,0,V,$,g,b,R.RGBA,R.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)},Qh.prototype.bind=function(s,u,f){var g=this.context.gl;g.bindTexture(g.TEXTURE_2D,this.texture),f!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=g.LINEAR),s!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,f||s),this.filter=s),u!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,u),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,u),this.wrap=u)},Qh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Qh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Zm=function(u){var f=this;this._callback=u,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){f._triggered=!1,f._callback()})};Zm.prototype.trigger=function(){var s=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){s._triggered=!1,s._callback()},0))},Zm.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Jh=function(u,f,g){this.target=u,this.parent=f,this.mapId=g,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Xe(["receive","process"],this),this.invoker=new Zm(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Re()?u:ue};function vy(s,u,f){var g=2*Math.PI*6378137/256/Math.pow(2,f);return[s*g-2*Math.PI*6378137/2,u*g-2*Math.PI*6378137/2]}Jh.prototype.send=function(s,u,f,g,b){var S=this;b===void 0&&(b=!1);var T=Math.round(1e18*Math.random()).toString(36).substring(0,10);f&&(this.callbacks[T]=f);var R=Ce(this.globalScope)?void 0:[];return this.target.postMessage({id:T,type:s,hasCallback:!!f,targetMapId:g,mustQueue:b,sourceMapId:this.mapId,data:Cs(u,R)},R),{cancel:function(){f&&delete S.callbacks[T],S.target.postMessage({id:T,type:"<cancel>",targetMapId:g,sourceMapId:S.mapId})}}},Jh.prototype.receive=function(s){var u=s.data,f=u.id;if(f&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[f];var g=this.cancelCallbacks[f];delete this.cancelCallbacks[f],g&&g()}else Re()||u.mustQueue?(this.tasks[f]=u,this.taskQueue.push(f),this.invoker.trigger()):this.processTask(f,u)},Jh.prototype.process=function(){if(this.taskQueue.length){var s=this.taskQueue.shift(),u=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(s,u)}},Jh.prototype.processTask=function(s,u){var f=this;if(u.type==="<response>"){var g=this.callbacks[s];delete this.callbacks[s],g&&(u.error?g(Oa(u.error)):g(null,Oa(u.data)))}else{var b=!1,S=Ce(this.globalScope)?void 0:[],T=u.hasCallback?function($,J){b=!0,delete f.cancelCallbacks[s],f.target.postMessage({id:s,type:"<response>",sourceMapId:f.mapId,error:$?Cs($):null,data:Cs(J,S)},S)}:function($){b=!0},R=null,F=Oa(u.data);if(this.parent[u.type])R=this.parent[u.type](u.sourceMapId,F,T);else if(this.parent.getWorkerSource){var V=u.type.split(".");R=this.parent.getWorkerSource(u.sourceMapId,V[0],F.source)[V[1]](F,T)}else T(new Error("Could not find function "+u.type));!b&&R&&R.cancel&&(this.cancelCallbacks[s]=R.cancel)}},Jh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Qo=function(u,f){u&&(f?this.setSouthWest(u).setNorthEast(f):u.length===4?this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]]):this.setSouthWest(u[0]).setNorthEast(u[1]))};Qo.prototype.setNorthEast=function(s){return this._ne=s instanceof lo?new lo(s.lng,s.lat):lo.convert(s),this},Qo.prototype.setSouthWest=function(s){return this._sw=s instanceof lo?new lo(s.lng,s.lat):lo.convert(s),this},Qo.prototype.extend=function(s){var u,f,g=this._sw,b=this._ne;if(s instanceof lo)u=s,f=s;else{if(!(s instanceof Qo))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Qo.convert(s)):this.extend(lo.convert(s)):this;if(f=s._ne,!(u=s._sw)||!f)return this}return g||b?(g.lng=Math.min(u.lng,g.lng),g.lat=Math.min(u.lat,g.lat),b.lng=Math.max(f.lng,b.lng),b.lat=Math.max(f.lat,b.lat)):(this._sw=new lo(u.lng,u.lat),this._ne=new lo(f.lng,f.lat)),this},Qo.prototype.getCenter=function(){return new lo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Qo.prototype.getSouthWest=function(){return this._sw},Qo.prototype.getNorthEast=function(){return this._ne},Qo.prototype.getNorthWest=function(){return new lo(this.getWest(),this.getNorth())},Qo.prototype.getSouthEast=function(){return new lo(this.getEast(),this.getSouth())},Qo.prototype.getWest=function(){return this._sw.lng},Qo.prototype.getSouth=function(){return this._sw.lat},Qo.prototype.getEast=function(){return this._ne.lng},Qo.prototype.getNorth=function(){return this._ne.lat},Qo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Qo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Qo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Qo.prototype.contains=function(s){var u=lo.convert(s),f=u.lng,g=u.lat,b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&b},Qo.convert=function(s){return!s||s instanceof Qo?s:new Qo(s)};var lo=function(u,f){if(isNaN(u)||isNaN(f))throw new Error("Invalid LngLat object: ("+u+", "+f+")");if(this.lng=+u,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};lo.prototype.wrap=function(){return new lo(pt(this.lng,-180,180),this.lat)},lo.prototype.toArray=function(){return[this.lng,this.lat]},lo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},lo.prototype.distanceTo=function(s){var u=Math.PI/180,f=this.lat*u,g=s.lat*u,b=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((s.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(b,1))},lo.prototype.toBounds=function(s){s===void 0&&(s=0);var u=360*s/40075017,f=u/Math.cos(Math.PI/180*this.lat);return new Qo(new lo(this.lng-f,this.lat-u),new lo(this.lng+f,this.lat+u))},lo.convert=function(s){if(s instanceof lo)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new lo(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new lo(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var gy=2*Math.PI*63710088e-1;function Fv(s){return gy*Math.cos(s*Math.PI/180)}function $m(s){return(180+s)/360}function Ym(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Km(s,u){return s/Fv(u)}function qm(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}var ep=function(u,f,g){g===void 0&&(g=0),this.x=+u,this.y=+f,this.z=+g};ep.fromLngLat=function(s,u){u===void 0&&(u=0);var f=lo.convert(s);return new ep($m(f.lng),Ym(f.lat),Km(u,f.lat))},ep.prototype.toLngLat=function(){return new lo(360*this.x-180,qm(this.y))},ep.prototype.toAltitude=function(){return this.z*Fv(qm(this.y))},ep.prototype.meterInMercatorCoordinateUnits=function(){return 1/gy*(s=qm(this.y),1/Math.cos(s*Math.PI/180));var s};var tp=function(u,f,g){this.z=u,this.x=f,this.y=g,this.key=Cd(0,u,u,f,g)};tp.prototype.equals=function(s){return this.z===s.z&&this.x===s.x&&this.y===s.y},tp.prototype.url=function(s,u){var f,g,b,S,T,R=(g=this.y,b=this.z,S=vy(256*(f=this.x),256*(g=Math.pow(2,b)-g-1),b),T=vy(256*(f+1),256*(g+1),b),S[0]+","+S[1]+","+T[0]+","+T[1]),F=function(V,$,J){for(var re,xe="",ze=V;ze>0;ze--)xe+=($&(re=1<<ze-1)?1:0)+(J&re?2:0);return xe}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",F).replace("{bbox-epsg-3857}",R)},tp.prototype.getTilePoint=function(s){var u=Math.pow(2,this.z);return new se(8192*(s.x*u-this.x),8192*(s.y*u-this.y))},tp.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var yy=function(u,f){this.wrap=u,this.canonical=f,this.key=Cd(u,f.z,f.z,f.x,f.y)},Jo=function(u,f,g,b,S){this.overscaledZ=u,this.wrap=f,this.canonical=new tp(g,+b,+S),this.key=Cd(f,u,g,b,S)};function Cd(s,u,f,g,b){(s*=2)<0&&(s=-1*s-1);var S=1<<f;return(S*S*s+S*b+g).toString(36)+f.toString(36)+u.toString(36)}Jo.prototype.equals=function(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)},Jo.prototype.scaledTo=function(s){var u=this.canonical.z-s;return s>this.canonical.z?new Jo(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jo(s,this.wrap,s,this.canonical.x>>u,this.canonical.y>>u)},Jo.prototype.calculateScaledKey=function(s,u){var f=this.canonical.z-s;return s>this.canonical.z?Cd(this.wrap*+u,s,this.canonical.z,this.canonical.x,this.canonical.y):Cd(this.wrap*+u,s,s,this.canonical.x>>f,this.canonical.y>>f)},Jo.prototype.isChildOf=function(s){if(s.wrap!==this.wrap)return!1;var u=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>u&&s.canonical.y===this.canonical.y>>u},Jo.prototype.children=function(s){if(this.overscaledZ>=s)return[new Jo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Jo(u,this.wrap,u,f,g),new Jo(u,this.wrap,u,f+1,g),new Jo(u,this.wrap,u,f,g+1),new Jo(u,this.wrap,u,f+1,g+1)]},Jo.prototype.isLessThan=function(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))},Jo.prototype.wrapped=function(){return new Jo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Jo.prototype.unwrapTo=function(s){return new Jo(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)},Jo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Jo.prototype.toUnwrapped=function(){return new yy(this.wrap,this.canonical)},Jo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Jo.prototype.getTilePoint=function(s){return this.canonical.getTilePoint(new ep(s.x-this.wrap,s.y))},kn("CanonicalTileID",tp),kn("OverscaledTileID",Jo,{omit:["posMatrix"]});var Lf=function(u,f,g){if(this.uid=u,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(g&&g!=="mapbox"&&g!=="terrarium")return Gt('"'+g+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=f.height;var b=this.dim=f.height-2;this.data=new Uint32Array(f.data.buffer),this.encoding=g||"mapbox";for(var S=0;S<b;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(b,S)]=this.data[this._idx(b-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,b)]=this.data[this._idx(S,b-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(b,-1)]=this.data[this._idx(b-1,0)],this.data[this._idx(-1,b)]=this.data[this._idx(0,b-1)],this.data[this._idx(b,b)]=this.data[this._idx(b-1,b-1)]};Lf.prototype.get=function(s,u){var f=new Uint8Array(this.data.buffer),g=4*this._idx(s,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(f[g],f[g+1],f[g+2])},Lf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Lf.prototype._idx=function(s,u){if(s<-1||s>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(s+1)},Lf.prototype._unpackMapbox=function(s,u,f){return(256*s*256+256*u+f)/10-1e4},Lf.prototype._unpackTerrarium=function(s,u,f){return 256*s+u+f/256-32768},Lf.prototype.getPixels=function(){return new Vs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Lf.prototype.backfillBorder=function(s,u,f){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");var g=u*this.dim,b=u*this.dim+this.dim,S=f*this.dim,T=f*this.dim+this.dim;switch(u){case-1:g=b-1;break;case 1:b=g+1}switch(f){case-1:S=T-1;break;case 1:T=S+1}for(var R=-u*this.dim,F=-f*this.dim,V=S;V<T;V++)for(var $=g;$<b;$++)this.data[this._idx($,V)]=s.data[this._idx($+R,V+F)]},kn("DEMData",Lf);var wd=function(u){this._stringToNumber={},this._numberToString=[];for(var f=0;f<u.length;f++){var g=u[f];this._stringToNumber[g]=f,this._numberToString[f]=g}};wd.prototype.encode=function(s){return this._stringToNumber[s]},wd.prototype.decode=function(s){return this._numberToString[s]};var Od=function(u,f,g,b,S){this.type="Feature",this._vectorTileFeature=u,u._z=f,u._x=g,u._y=b,this.properties=u.properties,this.id=S},Bv={geometry:{configurable:!0}};Bv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Bv.geometry.set=function(s){this._geometry=s},Od.prototype.toJSON=function(){var s={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(s[u]=this[u]);return s},Object.defineProperties(Od.prototype,Bv);var rp=function(){this.state={},this.stateChanges={},this.deletedStates={}};rp.prototype.updateState=function(s,u,f){var g=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},$e(this.stateChanges[s][g],f),this.deletedStates[s]===null)for(var b in this.deletedStates[s]={},this.state[s])b!==g&&(this.deletedStates[s][b]=null);else if(this.deletedStates[s]&&this.deletedStates[s][g]===null)for(var S in this.deletedStates[s][g]={},this.state[s][g])f[S]||(this.deletedStates[s][g][S]=null);else for(var T in f)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][T]===null&&delete this.deletedStates[s][g][T]},rp.prototype.removeFeatureState=function(s,u,f){if(this.deletedStates[s]!==null){var g=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},f&&u!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][f]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(f in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][f]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}},rp.prototype.getState=function(s,u){var f=String(u),g=$e({},(this.state[s]||{})[f],(this.stateChanges[s]||{})[f]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){var b=this.deletedStates[s][u];if(b===null)return{};for(var S in b)delete g[S]}return g},rp.prototype.initializeTileState=function(s,u){s.setFeatureState(this.state,u)},rp.prototype.coalesceChanges=function(s,u){var f={};for(var g in this.stateChanges){this.state[g]=this.state[g]||{};var b={};for(var S in this.stateChanges[g])this.state[g][S]||(this.state[g][S]={}),$e(this.state[g][S],this.stateChanges[g][S]),b[S]=this.state[g][S];f[g]=b}for(var T in this.deletedStates){this.state[T]=this.state[T]||{};var R={};if(this.deletedStates[T]===null)for(var F in this.state[T])R[F]={},this.state[T][F]={};else for(var V in this.deletedStates[T]){if(this.deletedStates[T][V]===null)this.state[T][V]={};else for(var $=0,J=Object.keys(this.deletedStates[T][V]);$<J.length;$+=1)delete this.state[T][V][J[$]];R[V]=this.state[T][V]}f[T]=f[T]||{},$e(f[T],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(var re in s)s[re].setFeatureState(f,u)};var nf=function(u,f){this.tileID=u,this.x=u.canonical.x,this.y=u.canonical.y,this.z=u.canonical.z,this.grid=new Lo(8192,16,0),this.grid3D=new Lo(8192,16,0),this.featureIndexArray=new q,this.promoteId=f};function _y(s,u,f,g,b){return Dr(s,function(S,T){var R=u instanceof pl?u.get(T):null;return R&&R.evaluate?R.evaluate(f,g,b):R})}function by(s){for(var u=1/0,f=1/0,g=-1/0,b=-1/0,S=0,T=s;S<T.length;S+=1){var R=T[S];u=Math.min(u,R.x),f=Math.min(f,R.y),g=Math.max(g,R.x),b=Math.max(b,R.y)}return{minX:u,minY:f,maxX:g,maxY:b}}function O_(s,u){return u-s}nf.prototype.insert=function(s,u,f,g,b,S){var T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,b);for(var R=S?this.grid3D:this.grid,F=0;F<u.length;F++){for(var V=u[F],$=[1/0,1/0,-1/0,-1/0],J=0;J<V.length;J++){var re=V[J];$[0]=Math.min($[0],re.x),$[1]=Math.min($[1],re.y),$[2]=Math.max($[2],re.x),$[3]=Math.max($[3],re.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&R.insert(T,$[0],$[1],$[2],$[3])}},nf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ql.VectorTile(new yr(this.rawTileData)).layers,this.sourceLayerCoder=new wd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},nf.prototype.query=function(s,u,f,g){var b=this;this.loadVTLayers();for(var S=s.params||{},T=8192/s.tileSize/s.scale,R=Nl(S.filter),F=s.queryGeometry,V=s.queryPadding*T,$=by(F),J=this.grid.query($.minX-V,$.minY-V,$.maxX+V,$.maxY+V),re=by(s.cameraQueryGeometry),xe=this.grid3D.query(re.minX-V,re.minY-V,re.maxX+V,re.maxY+V,function(ar,Mr,gr,un){return function(fn,Fn,$n,Un,In){for(var Si=0,ai=fn;Si<ai.length;Si+=1){var qn=ai[Si];if(Fn<=qn.x&&$n<=qn.y&&Un>=qn.x&&In>=qn.y)return!0}var ea=[new se(Fn,$n),new se(Fn,In),new se(Un,In),new se(Un,$n)];if(fn.length>2){for(var Bi=0,xa=ea;Bi<xa.length;Bi+=1)if(Xt(fn,xa[Bi]))return!0}for(var vi=0;vi<fn.length-1;vi++)if(De(fn[vi],fn[vi+1],ea))return!0;return!1}(s.cameraQueryGeometry,ar-V,Mr-V,gr+V,un+V)}),ze=0,Fe=xe;ze<Fe.length;ze+=1)J.push(Fe[ze]);J.sort(O_);for(var lt,ct={},wt=function(Mr){var gr=J[Mr];if(gr!==lt){lt=gr;var un=b.featureIndexArray.get(gr),fn=null;b.loadMatchingFeature(ct,un.bucketIndex,un.sourceLayerIndex,un.featureIndex,R,S.layers,S.availableImages,u,f,g,function(Fn,$n,Un){return fn||(fn=Ya(Fn)),$n.queryIntersectsFeature(F,Fn,Un,fn,b.z,s.transform,T,s.pixelPosMatrix)})}},Ht=0;Ht<J.length;Ht++)wt(Ht);return ct},nf.prototype.loadMatchingFeature=function(s,u,f,g,b,S,T,R,F,V,$){var J=this.bucketLayerIDs[u];if(!S||function(fn,Fn){for(var $n=0;$n<fn.length;$n++)if(Fn.indexOf(fn[$n])>=0)return!0;return!1}(S,J)){var re=this.sourceLayerCoder.decode(f),xe=this.vtLayers[re].feature(g);if(b.needGeometry){var ze=Ka(xe,!0);if(!b.filter(new Oi(this.tileID.overscaledZ),ze,this.tileID.canonical))return}else if(!b.filter(new Oi(this.tileID.overscaledZ),xe))return;for(var Fe=this.getId(xe,re),lt=0;lt<J.length;lt++){var ct=J[lt];if(!(S&&S.indexOf(ct)<0)){var wt=R[ct];if(wt){var Ht={};Fe!==void 0&&V&&(Ht=V.getState(wt.sourceLayer||"_geojsonTileLayer",Fe));var ar=$e({},F[ct]);ar.paint=_y(ar.paint,wt.paint,xe,Ht,T),ar.layout=_y(ar.layout,wt.layout,xe,Ht,T);var Mr=!$||$(xe,wt,Ht);if(Mr){var gr=new Od(xe,this.z,this.x,this.y,Fe);gr.layer=ar;var un=s[ct];un===void 0&&(un=s[ct]=[]),un.push({featureIndex:g,feature:gr,intersectionZ:Mr})}}}}}},nf.prototype.lookupSymbolFeatures=function(s,u,f,g,b,S,T,R){var F={};this.loadVTLayers();for(var V=Nl(b),$=0,J=s;$<J.length;$+=1)this.loadMatchingFeature(F,f,g,J[$],V,S,T,R,u);return F},nf.prototype.hasLayer=function(s){for(var u=0,f=this.bucketLayerIDs;u<f.length;u+=1)for(var g=0,b=f[u];g<b.length;g+=1)if(s===b[g])return!0;return!1},nf.prototype.getId=function(s,u){var f=s.id;return this.promoteId&&typeof(f=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(f=Number(f)),f},kn("FeatureIndex",nf,{omit:["rawTileData","sourceLayerCoder"]});var As=function(u,f){this.tileID=u,this.uid=et(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};As.prototype.registerFadeDuration=function(s){var u=s+this.timeAdded;u<On.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},As.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},As.prototype.loadVectorData=function(s,u,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){for(var g in s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(V,$){var J={};if(!$)return J;for(var re=function(){var lt=ze[xe],ct=lt.layerIds.map(function(ar){return $.getLayer(ar)}).filter(Boolean);if(ct.length!==0){lt.layers=ct,lt.stateDependentLayerIds&&(lt.stateDependentLayers=lt.stateDependentLayerIds.map(function(ar){return ct.filter(function(Mr){return Mr.id===ar})[0]}));for(var wt=0,Ht=ct;wt<Ht.length;wt+=1)J[Ht[wt].id]=lt}},xe=0,ze=V;xe<ze.length;xe+=1)re();return J}(s.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var b=this.buckets[g];if(b instanceof Dn){if(this.hasSymbolBuckets=!0,!f)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var S in this.buckets){var T=this.buckets[S];if(T instanceof Dn&&T.hasRTLText){this.hasRTLText=!0,zs.isLoading()||zs.isLoaded()||Vh()!=="deferred"||Js();break}}for(var R in this.queryPadding=0,this.buckets){var F=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(R).queryRadius(F))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new d},As.prototype.unloadVectorData=function(){for(var s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},As.prototype.getBucket=function(s){return this.buckets[s.id]},As.prototype.upload=function(s){for(var u in this.buckets){var f=this.buckets[u];f.uploadPending()&&f.upload(s)}var g=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Qh(s,this.imageAtlas.image,g.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Qh(s,this.glyphAtlasImage,g.ALPHA),this.glyphAtlasImage=null)},As.prototype.prepare=function(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)},As.prototype.queryRenderedFeatures=function(s,u,f,g,b,S,T,R,F,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:S,tileSize:this.tileSize,pixelPosMatrix:V,transform:R,params:T,queryPadding:this.queryPadding*F},s,u,f):{}},As.prototype.querySourceFeatures=function(s,u){var f=this.latestFeatureIndex;if(f&&f.rawTileData){var g=f.loadVTLayers(),b=u?u.sourceLayer:"",S=g._geojsonTileLayer||g[b];if(S)for(var T=Nl(u&&u.filter),R=this.tileID.canonical,F=R.z,V=R.x,$=R.y,J={z:F,x:V,y:$},re=0;re<S.length;re++){var xe=S.feature(re);if(T.needGeometry){var ze=Ka(xe,!0);if(!T.filter(new Oi(this.tileID.overscaledZ),ze,this.tileID.canonical))continue}else if(!T.filter(new Oi(this.tileID.overscaledZ),xe))continue;var Fe=f.getId(xe,b),lt=new Od(xe,F,V,$,Fe);lt.tile=J,s.push(lt)}}},As.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},As.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},As.prototype.setExpiryData=function(s){var u=this.expirationTime;if(s.cacheControl){var f=Ut(s.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){var g=Date.now(),b=!1;if(this.expirationTime>g)b=!1;else if(u)if(this.expirationTime<u)b=!0;else{var S=this.expirationTime-u;S?this.expirationTime=g+Math.max(S,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},As.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},As.prototype.setFeatureState=function(s,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(s).length!==0){var f=this.latestFeatureIndex.loadVTLayers();for(var g in this.buckets)if(u.style.hasLayer(g)){var b=this.buckets[g],S=b.layers[0].sourceLayer||"_geojsonTileLayer",T=f[S],R=s[S];if(T&&R&&Object.keys(R).length!==0){b.update(R,T,this.imageAtlas&&this.imageAtlas.patternPositions||{});var F=u&&u.style&&u.style.getLayer(g);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(b)))}}}},As.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},As.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<On.now()},As.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},As.prototype.setHoldDuration=function(s){this.symbolFadeHoldUntil=On.now()+s},As.prototype.setDependencies=function(s,u){for(var f={},g=0,b=u;g<b.length;g+=1)f[b[g]]=!0;this.dependencies[s]=f},As.prototype.hasDependency=function(s,u){for(var f=0,g=s;f<g.length;f+=1){var b=this.dependencies[g[f]];if(b){for(var S=0,T=u;S<T.length;S+=1)if(b[T[S]])return!0}}return!1};var Nf=ue.performance,xy=function(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},Nf.mark(this._marks.start)};xy.prototype.finish=function(){Nf.mark(this._marks.end);var s=Nf.getEntriesByName(this._marks.measure);return s.length===0&&(Nf.measure(this._marks.measure,this._marks.start,this._marks.end),s=Nf.getEntriesByName(this._marks.measure),Nf.clearMarks(this._marks.start),Nf.clearMarks(this._marks.end),Nf.clearMeasures(this._marks.measure)),s},v.Actor=Jh,v.AlphaImage=Iu,v.CanonicalTileID=tp,v.CollisionBoxArray=d,v.Color=gi,v.DEMData=Lf,v.DataConstantProperty=ti,v.DictionaryCoder=wd,v.EXTENT=8192,v.ErrorEvent=mt,v.EvaluationParameters=Oi,v.Event=Le,v.Evented=St,v.FeatureIndex=nf,v.FillBucket=el,v.FillExtrusionBucket=Es,v.ImageAtlas=Pr,v.ImagePosition=mn,v.LineBucket=Hs,v.LngLat=lo,v.LngLatBounds=Qo,v.MercatorCoordinate=ep,v.ONE_EM=24,v.OverscaledTileID=Jo,v.Point=se,v.Point$1=se,v.Properties=$a,v.Protobuf=yr,v.RGBAImage=Vs,v.RequestManager=Sr,v.RequestPerformance=xy,v.ResourceType=ri,v.SegmentVector=ye,v.SourceFeatureState=rp,v.StructArrayLayout1ui2=ph,v.StructArrayLayout2f1f2i16=Yc,v.StructArrayLayout2i4=Wl,v.StructArrayLayout3ui6=L,v.StructArrayLayout4i8=ch,v.SymbolBucket=Dn,v.Texture=Qh,v.Tile=As,v.Transitionable=Yo,v.Uniform1f=$r,v.Uniform1i=wr,v.Uniform2f=Qr,v.Uniform3f=_n,v.Uniform4f=Ln,v.UniformColor=si,v.UniformMatrix4f=Wi,v.UnwrappedTileID=yy,v.ValidationError=Ye,v.WritingMode=ii,v.ZoomHistory=oh,v.add=function(s,u,f){return s[0]=u[0]+f[0],s[1]=u[1]+f[1],s[2]=u[2]+f[2],s},v.addDynamicAttributes=zr,v.asyncAll=function(s,u,f){if(!s.length)return f(null,[]);var g=s.length,b=new Array(s.length),S=null;s.forEach(function(T,R){u(T,function(F,V){F&&(S=F),b[R]=V,--g==0&&f(S,b)})})},v.bezier=Ne,v.bindAll=Xe,v.browser=On,v.cacheEntryPossiblyAdded=function(s){++gn>Cr&&(s.getActor().send("enforceCacheSizeLimit",or),gn=0)},v.clamp=Dt,v.clearTileCache=function(s){var u=ue.caches.delete("mapbox-tiles");s&&u.catch(s).then(function(){return s()})},v.clipLine=iu,v.clone=function(s){var u=new qa(16);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},v.clone$1=Be,v.clone$2=function(s){var u=new qa(3);return u[0]=s[0],u[1]=s[1],u[2]=s[2],u},v.collisionCircleLayout=Y,v.config=Fr,v.create=function(){var s=new qa(16);return qa!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},v.create$1=function(){var s=new qa(9);return qa!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s},v.create$2=function(){var s=new qa(4);return qa!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},v.createCommonjsModule=z,v.createExpression=fc,v.createLayout=No,v.createStyleLayer=function(s){return s.type==="custom"?new Dv(s):new mc[s.type](s)},v.cross=function(s,u,f){var g=u[0],b=u[1],S=u[2],T=f[0],R=f[1],F=f[2];return s[0]=b*F-S*R,s[1]=S*T-g*F,s[2]=g*R-b*T,s},v.deepEqual=function s(u,f){if(Array.isArray(u)){if(!Array.isArray(f)||u.length!==f.length)return!1;for(var g=0;g<u.length;g++)if(!s(u[g],f[g]))return!1;return!0}if(typeof u=="object"&&u!==null&&f!==null){if(typeof f!="object"||Object.keys(u).length!==Object.keys(f).length)return!1;for(var b in u)if(!s(u[b],f[b]))return!1;return!0}return u===f},v.dot=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]},v.dot$1=function(s,u){return s[0]*u[0]+s[1]*u[1]+s[2]*u[2]+s[3]*u[3]},v.ease=st,v.emitValidationErrors=Vl,v.endsWith=jr,v.enforceCacheSizeLimit=function(s){Or(),Ee&&Ee.then(function(u){u.keys().then(function(f){for(var g=0;g<f.length-s;g++)u.delete(f[g])})})},v.evaluateSizeForFeature=Os,v.evaluateSizeForZoom=Ho,v.evaluateVariableOffset=bt,v.evented=xi,v.extend=$e,v.featureFilter=Nl,v.filterObject=Jt,v.fromRotation=function(s,u){var f=Math.sin(u),g=Math.cos(u);return s[0]=g,s[1]=f,s[2]=0,s[3]=-f,s[4]=g,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},v.getAnchorAlignment=Ha,v.getAnchorJustification=Tt,v.getArrayBuffer=yo,v.getImage=K,v.getJSON=function(s,u){return Co($e(s,{type:"json"}),u)},v.getRTLTextPluginStatus=Vh,v.getReferrer=ki,v.getVideo=function(s,u){var f,g,b=ue.document.createElement("video");b.muted=!0,b.onloadstart=function(){u(null,b)};for(var S=0;S<s.length;S++){var T=ue.document.createElement("source");f=s[S],g=void 0,(g=ue.document.createElement("a")).href=f,(g.protocol!==ue.document.location.protocol||g.host!==ue.document.location.host)&&(b.crossOrigin="Anonymous"),T.src=s[S],b.appendChild(T)}return{cancel:function(){}}},v.identity=Da,v.invert=function(s,u){var f=u[0],g=u[1],b=u[2],S=u[3],T=u[4],R=u[5],F=u[6],V=u[7],$=u[8],J=u[9],re=u[10],xe=u[11],ze=u[12],Fe=u[13],lt=u[14],ct=u[15],wt=f*R-g*T,Ht=f*F-b*T,ar=f*V-S*T,Mr=g*F-b*R,gr=g*V-S*R,un=b*V-S*F,fn=$*Fe-J*ze,Fn=$*lt-re*ze,$n=$*ct-xe*ze,Un=J*lt-re*Fe,In=J*ct-xe*Fe,Si=re*ct-xe*lt,ai=wt*Si-Ht*In+ar*Un+Mr*$n-gr*Fn+un*fn;return ai?(s[0]=(R*Si-F*In+V*Un)*(ai=1/ai),s[1]=(b*In-g*Si-S*Un)*ai,s[2]=(Fe*un-lt*gr+ct*Mr)*ai,s[3]=(re*gr-J*un-xe*Mr)*ai,s[4]=(F*$n-T*Si-V*Fn)*ai,s[5]=(f*Si-b*$n+S*Fn)*ai,s[6]=(lt*ar-ze*un-ct*Ht)*ai,s[7]=($*un-re*ar+xe*Ht)*ai,s[8]=(T*In-R*$n+V*fn)*ai,s[9]=(g*$n-f*In-S*fn)*ai,s[10]=(ze*gr-Fe*ar+ct*wt)*ai,s[11]=(J*ar-$*gr-xe*wt)*ai,s[12]=(R*Fn-T*Un-F*fn)*ai,s[13]=(f*Un-g*Fn+b*fn)*ai,s[14]=(Fe*Ht-ze*Mr-lt*wt)*ai,s[15]=($*Mr-J*Ht+re*wt)*ai,s):null},v.isChar=vn,v.isMapboxURL=_r,v.keysDifference=function(s,u){var f=[];for(var g in s)g in u||f.push(g);return f},v.makeRequest=Co,v.mapObject=Dr,v.mercatorXfromLng=$m,v.mercatorYfromLat=Ym,v.mercatorZfromAltitude=Km,v.mul=jo,v.multiply=xo,v.mvt=Ql,v.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},v.normalize=function(s,u){var f=u[0],g=u[1],b=u[2],S=f*f+g*g+b*b;return S>0&&(S=1/Math.sqrt(S)),s[0]=u[0]*S,s[1]=u[1]*S,s[2]=u[2]*S,s},v.number=Et,v.offscreenCanvasSupported=dn,v.ortho=function(s,u,f,g,b,S,T){var R=1/(u-f),F=1/(g-b),V=1/(S-T);return s[0]=-2*R,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*F,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*V,s[11]=0,s[12]=(u+f)*R,s[13]=(b+g)*F,s[14]=(T+S)*V,s[15]=1,s},v.parseGlyphPBF=function(s){return new yr(s).readFields(Lr,[])},v.pbf=yr,v.performSymbolLayout=function(s,u,f,g,b,S,T){s.createArrays(),s.tilePixelRatio=8192/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;var R=s.layers[0].layout,F=s.layers[0]._unevaluatedLayout._values,V={};if(s.textSizeData.kind==="composite"){var $=s.textSizeData,J=$.maxZoom;V.compositeTextSizes=[F["text-size"].possiblyEvaluate(new Oi($.minZoom),T),F["text-size"].possiblyEvaluate(new Oi(J),T)]}if(s.iconSizeData.kind==="composite"){var re=s.iconSizeData,xe=re.maxZoom;V.compositeIconSizes=[F["icon-size"].possiblyEvaluate(new Oi(re.minZoom),T),F["icon-size"].possiblyEvaluate(new Oi(xe),T)]}V.layoutTextSize=F["text-size"].possiblyEvaluate(new Oi(s.zoom+1),T),V.layoutIconSize=F["icon-size"].possiblyEvaluate(new Oi(s.zoom+1),T),V.textMaxSize=F["text-size"].possiblyEvaluate(new Oi(18));for(var ze=24*R.get("text-line-height"),Fe=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",lt=R.get("text-keep-upright"),ct=R.get("text-size"),wt=function(){var gr=ar[Ht],un=R.get("text-font").evaluate(gr,{},T).join(","),fn=ct.evaluate(gr,{},T),Fn=V.layoutTextSize.evaluate(gr,{},T),$n=V.layoutIconSize.evaluate(gr,{},T),Un={horizontal:{},vertical:void 0},In=gr.text,Si=[0,0];if(In){var ai=In.toString(),qn=24*R.get("text-letter-spacing").evaluate(gr,{},T),ea=function(fa){for(var aa=0,Va=fa;aa<Va.length;aa+=1)if(Ja=Va[aa].charCodeAt(0),vn.Arabic(Ja)||vn["Arabic Supplement"](Ja)||vn["Arabic Extended-A"](Ja)||vn["Arabic Presentation Forms-A"](Ja)||vn["Arabic Presentation Forms-B"](Ja))return!1;var Ja;return!0}(ai)?qn:0,Bi=R.get("text-anchor").evaluate(gr,{},T),xa=R.get("text-variable-anchor");if(!xa){var vi=R.get("text-radial-offset").evaluate(gr,{},T);Si=vi?bt(Bi,[24*vi,dt]):R.get("text-offset").evaluate(gr,{},T).map(function(fa){return 24*fa})}var na=Fe?"center":R.get("text-justify").evaluate(gr,{},T),Qa=R.get("symbol-placement"),Wa=Qa==="point"?24*R.get("text-max-width").evaluate(gr,{},T):0,ho=function(){s.allowVerticalPlacement&&fl(ai)&&(Un.vertical=Ui(In,u,f,b,un,Wa,ze,Bi,"left",ea,Si,ii.vertical,!0,Qa,Fn,fn))};if(!Fe&&xa){for(var po=na==="auto"?xa.map(function(fa){return Tt(fa)}):[na],So=!1,Rs=0;Rs<po.length;Rs++){var Go=po[Rs];if(!Un.horizontal[Go])if(So)Un.horizontal[Go]=Un.horizontal[0];else{var au=Ui(In,u,f,b,un,Wa,ze,"center",Go,ea,Si,ii.horizontal,!1,Qa,Fn,fn);au&&(Un.horizontal[Go]=au,So=au.positionedLines.length===1)}}ho()}else{na==="auto"&&(na=Tt(Bi));var Ts=Ui(In,u,f,b,un,Wa,ze,Bi,na,ea,Si,ii.horizontal,!1,Qa,Fn,fn);Ts&&(Un.horizontal[na]=Ts),ho(),fl(ai)&&Fe&&lt&&(Un.vertical=Ui(In,u,f,b,un,Wa,ze,Bi,na,ea,Si,ii.vertical,!1,Qa,Fn,fn))}}var ou=void 0,ps=!1;if(gr.icon&&gr.icon.name){var es=g[gr.icon.name];es&&(ou=function(fa,aa,Va){var Ja=Ha(Va),su=aa[0]-fa.displaySize[0]*Ja.horizontalAlign,ro=aa[1]-fa.displaySize[1]*Ja.verticalAlign;return{image:fa,top:ro,bottom:ro+fa.displaySize[1],left:su,right:su+fa.displaySize[0]}}(b[gr.icon.name],R.get("icon-offset").evaluate(gr,{},T),R.get("icon-anchor").evaluate(gr,{},T)),ps=es.sdf,s.sdfIcons===void 0?s.sdfIcons=es.sdf:s.sdfIcons!==es.sdf&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(es.pixelRatio!==s.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0))}var ds=yt(Un.horizontal)||Un.vertical;s.iconsInText=!!ds&&ds.iconsInText,(ds||ou)&&function(fa,aa,Va,Ja,su,ro,vo,Ws,la,jf,xl){var gc=ro.textMaxSize.evaluate(aa,{});gc===void 0&&(gc=vo);var rl,Ms=fa.layers[0].layout,zf=Ms.get("icon-offset").evaluate(aa,{},xl),Uf=yt(Va.horizontal),af=vo/24,Rd=fa.tilePixelRatio*af,of=fa.tilePixelRatio*gc/24,Md=fa.tilePixelRatio*Ws,Pd=fa.tilePixelRatio*Ms.get("symbol-spacing"),Dp=Ms.get("text-padding")*fa.tilePixelRatio,Id=Ms.get("icon-padding")*fa.tilePixelRatio,Fp=Ms.get("text-max-angle")/180*Math.PI,kd=Ms.get("text-rotation-alignment")==="map"&&Ms.get("symbol-placement")!=="point",xh=Ms.get("icon-rotation-alignment")==="map"&&Ms.get("symbol-placement")!=="point",Bp=Ms.get("symbol-placement"),Lv=Pd/2,Lp=Ms.get("icon-text-fit");Ja&&Lp!=="none"&&(fa.allowVerticalPlacement&&Va.vertical&&(rl=Vo(Ja,Va.vertical,Lp,Ms.get("icon-text-fit-padding"),zf,af)),Uf&&(Ja=Vo(Ja,Uf,Lp,Ms.get("icon-text-fit-padding"),zf,af)));var Eh=function(R_,Vd){Vd.x<0||Vd.x>=8192||Vd.y<0||Vd.y>=8192||function(Io,yc,zv,ap,vs,Vf,Hf,Jl,_c,sf,Vp,rg,ng,Uv,Sh,ig,Ay,Ty,Cy,wy,Du,ag,Vv,bc,M_){var Oy,xc,Hp,Wp,Hd,Gp=Io.addToLineVertexArray(yc,zv),P_=0,Hv=0,Ry=0,My=0,og=-1,sg=-1,Ah={},ug=We(""),Wd=0,Wv=0;if(Jl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Wd=(Oy=Jl.layout.get("text-offset").evaluate(Du,{},bc).map(function(Yv){return 24*Yv}))[0],Wv=Oy[1]):(Wd=24*Jl.layout.get("text-radial-offset").evaluate(Du,{},bc),Wv=dt),Io.allowVerticalPlacement&&ap.vertical){var Py=Jl.layout.get("text-rotate").evaluate(Du,{},bc)+90;Wp=new Ca(_c,yc,sf,Vp,rg,ap.vertical,ng,Uv,Sh,Py),Hf&&(Hd=new Ca(_c,yc,sf,Vp,rg,Hf,Ay,Ty,Sh,Py))}if(vs){var El=Jl.layout.get("icon-rotate").evaluate(Du,{}),Iy=Jl.layout.get("icon-text-fit")!=="none",ky=Ge(vs,El,Vv,Iy),lg=Hf?Ge(Hf,El,Vv,Iy):void 0;Hp=new Ca(_c,yc,sf,Vp,rg,vs,Ay,Ty,!1,El),P_=4*ky.length;var Gv=Io.iconSizeData,Gd=null;Gv.kind==="source"?(Gd=[128*Jl.layout.get("icon-size").evaluate(Du,{})])[0]>32640&&Gt(Io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Gv.kind==="composite"&&((Gd=[128*ag.compositeIconSizes[0].evaluate(Du,{},bc),128*ag.compositeIconSizes[1].evaluate(Du,{},bc)])[0]>32640||Gd[1]>32640)&&Gt(Io.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Io.addSymbols(Io.icon,ky,Gd,wy,Cy,Du,!1,yc,Gp.lineStartIndex,Gp.lineLength,-1,bc),og=Io.icon.placedSymbolArray.length-1,lg&&(Hv=4*lg.length,Io.addSymbols(Io.icon,lg,Gd,wy,Cy,Du,ii.vertical,yc,Gp.lineStartIndex,Gp.lineLength,-1,bc),sg=Io.icon.placedSymbolArray.length-1)}for(var Xp in ap.horizontal){var Xv=ap.horizontal[Xp];if(!xc){ug=We(Xv.text);var cg=Jl.layout.get("text-rotate").evaluate(Du,{},bc);xc=new Ca(_c,yc,sf,Vp,rg,Xv,ng,Uv,Sh,cg)}var Dy=Xv.positionedLines.length===1;if(Ry+=Ve(Io,yc,Xv,Vf,Jl,Sh,Du,ig,Gp,ap.vertical?ii.horizontal:ii.horizontalOnly,Dy?Object.keys(ap.horizontal):[Xp],Ah,og,ag,bc),Dy)break}ap.vertical&&(My+=Ve(Io,yc,ap.vertical,Vf,Jl,Sh,Du,ig,Gp,ii.vertical,["vertical"],Ah,sg,ag,bc));var Zv=xc?xc.boxStartIndex:Io.collisionBoxArray.length,Fy=xc?xc.boxEndIndex:Io.collisionBoxArray.length,fg=Wp?Wp.boxStartIndex:Io.collisionBoxArray.length,hg=Wp?Wp.boxEndIndex:Io.collisionBoxArray.length,By=Hp?Hp.boxStartIndex:Io.collisionBoxArray.length,Ly=Hp?Hp.boxEndIndex:Io.collisionBoxArray.length,Wf=Hd?Hd.boxStartIndex:Io.collisionBoxArray.length,I_=Hd?Hd.boxEndIndex:Io.collisionBoxArray.length,Ec=-1,Xd=function(pg,Ny){return pg&&pg.circleDiameter?Math.max(pg.circleDiameter,Ny):Ny};Ec=Xd(xc,Ec),Ec=Xd(Wp,Ec),Ec=Xd(Hp,Ec);var $v=(Ec=Xd(Hd,Ec))>-1?1:0;$v&&(Ec*=M_/24),Io.glyphOffsetArray.length>=Dn.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Du.sortKey!==void 0&&Io.addToSortKeyRanges(Io.symbolInstances.length,Du.sortKey),Io.symbolInstances.emplaceBack(yc.x,yc.y,Ah.right>=0?Ah.right:-1,Ah.center>=0?Ah.center:-1,Ah.left>=0?Ah.left:-1,Ah.vertical||-1,og,sg,ug,Zv,Fy,fg,hg,By,Ly,Wf,I_,sf,Ry,My,P_,Hv,$v,0,ng,Wd,Wv,Ec)}(fa,Vd,R_,Va,Ja,su,rl,fa.layers[0],fa.collisionBoxArray,aa.index,aa.sourceLayerIndex,fa.index,Rd,Dp,kd,la,Md,Id,xh,zf,aa,ro,jf,xl,vo)};if(Bp==="line")for(var Np=0,Nv=iu(aa.geometry,0,0,8192,8192);Np<Nv.length;Np+=1)for(var Dd=Nv[Np],np=0,Fd=hs(Dd,Pd,Fp,Va.vertical||Uf,Ja,24,of,fa.overscaling,8192);np<Fd.length;np+=1){var Bd=Fd[np];Uf&&Me(fa,Uf.text,Lv,Bd)||Eh(Dd,Bd)}else if(Bp==="line-center")for(var jp=0,jv=aa.geometry;jp<jv.length;jp+=1){var Ld=jv[jp];if(Ld.length>1){var Nd=ua(Ld,Fp,Va.vertical||Uf,Ja,24,of);Nd&&Eh(Ld,Nd)}}else if(aa.type==="Polygon")for(var jd=0,zp=Rp(aa.geometry,0);jd<zp.length;jd+=1){var zd=zp[jd],ip=rt(zd,16);Eh(zd[0],new fo(ip.x,ip.y,0))}else if(aa.type==="LineString")for(var Up=0,Ud=aa.geometry;Up<Ud.length;Up+=1){var Qm=Ud[Up];Eh(Qm,new fo(Qm[0].x,Qm[0].y,0))}else if(aa.type==="Point")for(var Jm=0,Ey=aa.geometry;Jm<Ey.length;Jm+=1)for(var eg=0,Sy=Ey[Jm];eg<Sy.length;eg+=1){var tg=Sy[eg];Eh([tg],new fo(tg.x,tg.y,0))}}(s,gr,Un,ou,g,V,Fn,$n,Si,ps,T)},Ht=0,ar=s.features;Ht<ar.length;Ht+=1)wt();S&&s.generateCollisionDebugBuffers()},v.perspective=function(s,u,f,g,b){var S,T=1/Math.tan(u/2);return s[0]=T/f,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,b!=null&&b!==1/0?(s[10]=(b+g)*(S=1/(g-b)),s[14]=2*b*g*S):(s[10]=-1,s[14]=-2*g),s},v.pick=function(s,u){for(var f={},g=0;g<u.length;g++){var b=u[g];b in s&&(f[b]=s[b])}return f},v.plugin=zs,v.polygonIntersectsPolygon=Qu,v.postMapLoadEvent=It,v.postTurnstileEvent=ur,v.potpack=Ai,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=kn,v.registerForPluginStateChange=function(s){return s({pluginStatus:ws,pluginURL:Ku}),xi.on("pluginStateChange",s),s},v.renderColorRamp=_v,v.rotate=function(s,u,f){var g=u[0],b=u[1],S=u[2],T=u[3],R=Math.sin(f),F=Math.cos(f);return s[0]=g*F+S*R,s[1]=b*F+T*R,s[2]=g*-R+S*F,s[3]=b*-R+T*F,s},v.rotateX=function(s,u,f){var g=Math.sin(f),b=Math.cos(f),S=u[4],T=u[5],R=u[6],F=u[7],V=u[8],$=u[9],J=u[10],re=u[11];return u!==s&&(s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[4]=S*b+V*g,s[5]=T*b+$*g,s[6]=R*b+J*g,s[7]=F*b+re*g,s[8]=V*b-S*g,s[9]=$*b-T*g,s[10]=J*b-R*g,s[11]=re*b-F*g,s},v.rotateZ=function(s,u,f){var g=Math.sin(f),b=Math.cos(f),S=u[0],T=u[1],R=u[2],F=u[3],V=u[4],$=u[5],J=u[6],re=u[7];return u!==s&&(s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15]),s[0]=S*b+V*g,s[1]=T*b+$*g,s[2]=R*b+J*g,s[3]=F*b+re*g,s[4]=V*b-S*g,s[5]=$*b-T*g,s[6]=J*b-R*g,s[7]=re*b-F*g,s},v.scale=function(s,u,f){var g=f[0],b=f[1],S=f[2];return s[0]=u[0]*g,s[1]=u[1]*g,s[2]=u[2]*g,s[3]=u[3]*g,s[4]=u[4]*b,s[5]=u[5]*b,s[6]=u[6]*b,s[7]=u[7]*b,s[8]=u[8]*S,s[9]=u[9]*S,s[10]=u[10]*S,s[11]=u[11]*S,s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},v.scale$1=function(s,u,f){return s[0]=u[0]*f,s[1]=u[1]*f,s[2]=u[2]*f,s[3]=u[3]*f,s},v.scale$2=function(s,u,f){return s[0]=u[0]*f,s[1]=u[1]*f,s[2]=u[2]*f,s},v.setCacheLimits=function(s,u){or=s,Cr=u},v.setRTLTextPlugin=function(s,u,f){if(f===void 0&&(f=!1),ws==="deferred"||ws==="loading"||ws==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ku=On.resolveURL(s),ws="deferred",lh=u,Gc(),f||Js()},v.sphericalToCartesian=function(s){var u=s[0],f=s[1],g=s[2];return f+=90,f*=Math.PI/180,g*=Math.PI/180,{x:u*Math.cos(f)*Math.sin(g),y:u*Math.sin(f)*Math.sin(g),z:u*Math.cos(g)}},v.sqrLen=function(s){var u=s[0],f=s[1];return u*u+f*f},v.styleSpec=ge,v.sub=function(s,u,f){return s[0]=u[0]-f[0],s[1]=u[1]-f[1],s[2]=u[2]-f[2],s},v.symbolSize=Gi,v.transformMat3=function(s,u,f){var g=u[0],b=u[1],S=u[2];return s[0]=g*f[0]+b*f[3]+S*f[6],s[1]=g*f[1]+b*f[4]+S*f[7],s[2]=g*f[2]+b*f[5]+S*f[8],s},v.transformMat4=Pu,v.translate=function(s,u,f){var g,b,S,T,R,F,V,$,J,re,xe,ze,Fe=f[0],lt=f[1],ct=f[2];return u===s?(s[12]=u[0]*Fe+u[4]*lt+u[8]*ct+u[12],s[13]=u[1]*Fe+u[5]*lt+u[9]*ct+u[13],s[14]=u[2]*Fe+u[6]*lt+u[10]*ct+u[14],s[15]=u[3]*Fe+u[7]*lt+u[11]*ct+u[15]):(b=u[1],S=u[2],T=u[3],R=u[4],F=u[5],V=u[6],$=u[7],J=u[8],re=u[9],xe=u[10],ze=u[11],s[0]=g=u[0],s[1]=b,s[2]=S,s[3]=T,s[4]=R,s[5]=F,s[6]=V,s[7]=$,s[8]=J,s[9]=re,s[10]=xe,s[11]=ze,s[12]=g*Fe+R*lt+J*ct+u[12],s[13]=b*Fe+F*lt+re*ct+u[13],s[14]=S*Fe+V*lt+xe*ct+u[14],s[15]=T*Fe+$*lt+ze*ct+u[15]),s},v.triggerPluginCompletionEvent=Sp,v.uniqueId=et,v.validateCustomStyleLayer=function(s){var u=[],f=s.id;return f===void 0&&u.push({message:"layers."+f+': missing required property "id"'}),s.render===void 0&&u.push({message:"layers."+f+': missing required method "render"'}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&u.push({message:"layers."+f+': property "renderingMode" must be either "2d" or "3d"'}),u},v.validateLight=Ep,v.validateStyle=Af,v.values=function(s){var u=[];for(var f in s)u.push(s[f]);return u},v.vectorTile=Ql,v.version="1.13.3",v.warnOnce=Gt,v.webpSupported=Hn,v.window=ue,v.wrap=pt}),N(["./shared"],function(v){"use strict";function z(te){var K=typeof te;if(K==="number"||K==="boolean"||K==="string"||te==null)return JSON.stringify(te);if(Array.isArray(te)){for(var fe="[",Se=0,Le=te;Se<Le.length;Se+=1)fe+=z(Le[Se])+",";return fe+"]"}for(var mt=Object.keys(te).sort(),St="{",ge=0;ge<mt.length;ge++)St+=JSON.stringify(mt[ge])+":"+z(te[mt[ge]])+",";return St+"}"}function W(te){for(var K="",fe=0,Se=v.refProperties;fe<Se.length;fe+=1)K+="/"+z(te[Se[fe]]);return K}var Pe=function(K){this.keyCache={},K&&this.replace(K)};Pe.prototype.replace=function(te){this._layerConfigs={},this._layers={},this.update(te,[])},Pe.prototype.update=function(te,K){for(var fe=this,Se=0,Le=te;Se<Le.length;Se+=1){var mt=Le[Se];this._layerConfigs[mt.id]=mt;var St=this._layers[mt.id]=v.createStyleLayer(mt);St._featureFilter=v.featureFilter(St.filter),this.keyCache[mt.id]&&delete this.keyCache[mt.id]}for(var ge=0,Ye=K;ge<Ye.length;ge+=1){var zt=Ye[ge];delete this.keyCache[zt],delete this._layerConfigs[zt],delete this._layers[zt]}this.familiesBySource={};for(var Rr=0,Nr=function(bn,we){for(var Kn={},xn=0;xn<bn.length;xn++){var Vi=we&&we[bn[xn].id]||W(bn[xn]);we&&(we[bn[xn].id]=Vi);var ia=Kn[Vi];ia||(ia=Kn[Vi]=[]),ia.push(bn[xn])}var bi=[];for(var ta in Kn)bi.push(Kn[ta]);return bi}(v.values(this._layerConfigs),this.keyCache);Rr<Nr.length;Rr+=1){var pr=Nr[Rr].map(function(bn){return fe._layers[bn.id]}),Wr=pr[0];if(Wr.visibility!=="none"){var Gn=Wr.source||"",wn=this.familiesBySource[Gn];wn||(wn=this.familiesBySource[Gn]={});var dr=Wr.sourceLayer||"_geojsonTileLayer",Sn=wn[dr];Sn||(Sn=wn[dr]=[]),Sn.push(pr)}}};var se=function(K){var fe={},Se=[];for(var Le in K){var mt=K[Le],St=fe[Le]={};for(var ge in mt){var Ye=mt[+ge];if(Ye&&Ye.bitmap.width!==0&&Ye.bitmap.height!==0){var zt={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};Se.push(zt),St[ge]={rect:zt,metrics:Ye.metrics}}}}var Rr=v.potpack(Se),Nr=new v.AlphaImage({width:Rr.w||1,height:Rr.h||1});for(var pr in K){var Wr=K[pr];for(var Gn in Wr){var wn=Wr[+Gn];if(wn&&wn.bitmap.width!==0&&wn.bitmap.height!==0){var dr=fe[pr][Gn].rect;v.AlphaImage.copy(wn.bitmap,Nr,{x:0,y:0},{x:dr.x+1,y:dr.y+1},wn.bitmap)}}}this.image=Nr,this.positions=fe};v.register("GlyphAtlas",se);var ve=function(K){this.tileID=new v.OverscaledTileID(K.tileID.overscaledZ,K.tileID.wrap,K.tileID.canonical.z,K.tileID.canonical.x,K.tileID.canonical.y),this.uid=K.uid,this.zoom=K.zoom,this.pixelRatio=K.pixelRatio,this.tileSize=K.tileSize,this.source=K.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=K.showCollisionBoxes,this.collectResourceTiming=!!K.collectResourceTiming,this.returnDependencies=!!K.returnDependencies,this.promoteId=K.promoteId};function ue(te,K,fe){for(var Se=new v.EvaluationParameters(K),Le=0,mt=te;Le<mt.length;Le+=1)mt[Le].recalculate(Se,fe)}function gt(te,K){var fe=v.getArrayBuffer(te.request,function(Se,Le,mt,St){Se?K(Se):Le&&K(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Le)),rawData:Le,cacheControl:mt,expires:St})});return function(){fe.cancel(),K()}}ve.prototype.parse=function(te,K,fe,Se,Le){var mt=this;this.status="parsing",this.data=te,this.collisionBoxArray=new v.CollisionBoxArray;var St=new v.DictionaryCoder(Object.keys(te.layers).sort()),ge=new v.FeatureIndex(this.tileID,this.promoteId);ge.bucketLayerIDs=[];var Ye,zt,Rr,Nr,pr={},Wr={featureIndex:ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:fe},Gn=K.familiesBySource[this.source];for(var wn in Gn){var dr=te.layers[wn];if(dr){dr.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+wn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Sn=St.encode(wn),bn=[],we=0;we<dr.length;we++){var Kn=dr.feature(we),xn=ge.getId(Kn,wn);bn.push({feature:Kn,id:xn,index:we,sourceLayerIndex:Sn})}for(var Vi=0,ia=Gn[wn];Vi<ia.length;Vi+=1){var bi=ia[Vi],ta=bi[0];ta.minzoom&&this.zoom<Math.floor(ta.minzoom)||ta.maxzoom&&this.zoom>=ta.maxzoom||ta.visibility!=="none"&&(ue(bi,this.zoom,fe),(pr[ta.id]=ta.createBucket({index:ge.bucketLayerIDs.length,layers:bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Sn,sourceID:this.source})).populate(bn,Wr,this.tileID.canonical),ge.bucketLayerIDs.push(bi.map(function(Hi){return Hi.id})))}}}var Ni=v.mapObject(Wr.glyphDependencies,function(Hi){return Object.keys(Hi).map(Number)});Object.keys(Ni).length?Se.send("getGlyphs",{uid:this.uid,stacks:Ni},function(Hi,Zi){Ye||(Ye=Hi,zt=Zi,Xa.call(mt))}):zt={};var ns=Object.keys(Wr.iconDependencies);ns.length?Se.send("getImages",{icons:ns,source:this.source,tileID:this.tileID,type:"icons"},function(Hi,Zi){Ye||(Ye=Hi,Rr=Zi,Xa.call(mt))}):Rr={};var wi=Object.keys(Wr.patternDependencies);function Xa(){if(Ye)return Le(Ye);if(zt&&Rr&&Nr){var Hi=new se(zt),Zi=new v.ImageAtlas(Rr,Nr);for(var gi in pr){var eo=pr[gi];eo instanceof v.SymbolBucket?(ue(eo.layers,this.zoom,fe),v.performSymbolLayout(eo,zt,Hi.positions,Rr,Zi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):eo.hasPattern&&(eo instanceof v.LineBucket||eo instanceof v.FillBucket||eo instanceof v.FillExtrusionBucket)&&(ue(eo.layers,this.zoom,fe),eo.addFeatures(Wr,this.tileID.canonical,Zi.patternPositions))}this.status="done",Le(null,{buckets:v.values(pr).filter(function(Fs){return!Fs.isEmpty()}),featureIndex:ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Hi.image,imageAtlas:Zi,glyphMap:this.returnDependencies?zt:null,iconMap:this.returnDependencies?Rr:null,glyphPositions:this.returnDependencies?Hi.positions:null})}}wi.length?Se.send("getImages",{icons:wi,source:this.source,tileID:this.tileID,type:"patterns"},function(Hi,Zi){Ye||(Ye=Hi,Nr=Zi,Xa.call(mt))}):Nr={},Xa.call(this)};var Ne=function(K,fe,Se,Le){this.actor=K,this.layerIndex=fe,this.availableImages=Se,this.loadVectorData=Le||gt,this.loading={},this.loaded={}};Ne.prototype.loadTile=function(te,K){var fe=this,Se=te.uid;this.loading||(this.loading={});var Le=!!(te&&te.request&&te.request.collectResourceTiming)&&new v.RequestPerformance(te.request),mt=this.loading[Se]=new ve(te);mt.abort=this.loadVectorData(te,function(St,ge){if(delete fe.loading[Se],St||!ge)return mt.status="done",fe.loaded[Se]=mt,K(St);var Ye=ge.rawData,zt={};ge.expires&&(zt.expires=ge.expires),ge.cacheControl&&(zt.cacheControl=ge.cacheControl);var Rr={};if(Le){var Nr=Le.finish();Nr&&(Rr.resourceTiming=JSON.parse(JSON.stringify(Nr)))}mt.vectorTile=ge.vectorTile,mt.parse(ge.vectorTile,fe.layerIndex,fe.availableImages,fe.actor,function(pr,Wr){if(pr||!Wr)return K(pr);K(null,v.extend({rawTileData:Ye.slice(0)},Wr,zt,Rr))}),fe.loaded=fe.loaded||{},fe.loaded[Se]=mt})},Ne.prototype.reloadTile=function(te,K){var fe=this,Se=this.loaded,Le=te.uid,mt=this;if(Se&&Se[Le]){var St=Se[Le];St.showCollisionBoxes=te.showCollisionBoxes;var ge=function(zt,Rr){var Nr=St.reloadCallback;Nr&&(delete St.reloadCallback,St.parse(St.vectorTile,mt.layerIndex,fe.availableImages,mt.actor,Nr)),K(zt,Rr)};St.status==="parsing"?St.reloadCallback=ge:St.status==="done"&&(St.vectorTile?St.parse(St.vectorTile,this.layerIndex,this.availableImages,this.actor,ge):ge())}},Ne.prototype.abortTile=function(te,K){var fe=this.loading,Se=te.uid;fe&&fe[Se]&&fe[Se].abort&&(fe[Se].abort(),delete fe[Se]),K()},Ne.prototype.removeTile=function(te,K){var fe=this.loaded,Se=te.uid;fe&&fe[Se]&&delete fe[Se],K()};var st=v.window.ImageBitmap,Dt=function(){this.loaded={}};function pt(te,K){if(te.length!==0){$e(te[0],K);for(var fe=1;fe<te.length;fe++)$e(te[fe],!K)}}function $e(te,K){for(var fe=0,Se=0,Le=0,mt=te.length,St=mt-1;Le<mt;St=Le++){var ge=(te[Le][0]-te[St][0])*(te[St][1]+te[Le][1]),Ye=fe+ge;Se+=Math.abs(fe)>=Math.abs(ge)?fe-Ye+ge:ge-Ye+fe,fe=Ye}fe+Se>=0!=!!K&&te.reverse()}Dt.prototype.loadTile=function(te,K){var fe=te.uid,Se=te.encoding,Le=te.rawImageData,mt=st&&Le instanceof st?this.getImageData(Le):Le,St=new v.DEMData(fe,mt,Se);this.loaded=this.loaded||{},this.loaded[fe]=St,K(null,St)},Dt.prototype.getImageData=function(te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,te.width+2,te.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:K.width,height:K.height},K.data)},Dt.prototype.removeTile=function(te){var K=this.loaded,fe=te.uid;K&&K[fe]&&delete K[fe]};var Ct=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,et=function(K){this._feature=K,this.extent=v.EXTENT,this.type=K.type,this.properties=K.tags,"id"in K&&!isNaN(K.id)&&(this.id=parseInt(K.id,10))};et.prototype.loadGeometry=function(){if(this._feature.type===1){for(var te=[],K=0,fe=this._feature.geometry;K<fe.length;K+=1){var Se=fe[K];te.push([new v.Point$1(Se[0],Se[1])])}return te}for(var Le=[],mt=0,St=this._feature.geometry;mt<St.length;mt+=1){for(var ge=[],Ye=0,zt=St[mt];Ye<zt.length;Ye+=1){var Rr=zt[Ye];ge.push(new v.Point$1(Rr[0],Rr[1]))}Le.push(ge)}return Le},et.prototype.toGeoJSON=function(te,K,fe){return Ct.call(this,te,K,fe)};var kt=function(K){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=K.length,this._features=K};kt.prototype.feature=function(te){return new et(this._features[te])};var Je=v.vectorTile.VectorTileFeature,Xe=jr;function jr(te,K){this.options=K||{},this.features=te,this.length=te.length}function Dr(te,K){this.id=typeof te.id=="number"?te.id:void 0,this.type=te.type,this.rawGeometry=te.type===1?[te.geometry]:te.geometry,this.properties=te.tags,this.extent=K||4096}jr.prototype.feature=function(te){return new Dr(this.features[te],this.options.extent)},Dr.prototype.loadGeometry=function(){var te=this.rawGeometry;this.geometry=[];for(var K=0;K<te.length;K++){for(var fe=te[K],Se=[],Le=0;Le<fe.length;Le++)Se.push(new v.Point$1(fe[Le][0],fe[Le][1]));this.geometry.push(Se)}return this.geometry},Dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var te=this.geometry,K=1/0,fe=-1/0,Se=1/0,Le=-1/0,mt=0;mt<te.length;mt++)for(var St=te[mt],ge=0;ge<St.length;ge++){var Ye=St[ge];K=Math.min(K,Ye.x),fe=Math.max(fe,Ye.x),Se=Math.min(Se,Ye.y),Le=Math.max(Le,Ye.y)}return[K,Se,fe,Le]},Dr.prototype.toGeoJSON=Je.prototype.toGeoJSON;var Jt=Nt,Be=Xe;function Nt(te){var K=new v.pbf;return function(fe,Se){for(var Le in fe.layers)Se.writeMessage(3,Gt,fe.layers[Le])}(te,K),K.finish()}function Gt(te,K){var fe;K.writeVarintField(15,te.version||1),K.writeStringField(1,te.name||""),K.writeVarintField(5,te.extent||4096);var Se={keys:[],values:[],keycache:{},valuecache:{}};for(fe=0;fe<te.length;fe++)Se.feature=te.feature(fe),K.writeMessage(2,Te,Se);var Le=Se.keys;for(fe=0;fe<Le.length;fe++)K.writeStringField(3,Le[fe]);var mt=Se.values;for(fe=0;fe<mt.length;fe++)K.writeMessage(4,Ce,mt[fe])}function Te(te,K){var fe=te.feature;fe.id!==void 0&&K.writeVarintField(1,fe.id),K.writeMessage(2,me,te),K.writeVarintField(3,fe.type),K.writeMessage(4,ae,fe)}function me(te,K){var fe=te.feature,Se=te.keys,Le=te.values,mt=te.keycache,St=te.valuecache;for(var ge in fe.properties){var Ye=mt[ge];Ye===void 0&&(Se.push(ge),mt[ge]=Ye=Se.length-1),K.writeVarint(Ye);var zt=fe.properties[ge],Rr=typeof zt;Rr!=="string"&&Rr!=="boolean"&&Rr!=="number"&&(zt=JSON.stringify(zt));var Nr=Rr+":"+zt,pr=St[Nr];pr===void 0&&(Le.push(zt),St[Nr]=pr=Le.length-1),K.writeVarint(pr)}}function Re(te,K){return(K<<3)+(7&te)}function Ut(te){return te<<1^te>>31}function ae(te,K){for(var fe=te.loadGeometry(),Se=te.type,Le=0,mt=0,St=fe.length,ge=0;ge<St;ge++){var Ye=fe[ge],zt=1;Se===1&&(zt=Ye.length),K.writeVarint(Re(1,zt));for(var Rr=Se===3?Ye.length-1:Ye.length,Nr=0;Nr<Rr;Nr++){Nr===1&&Se!==1&&K.writeVarint(Re(2,Rr-1));var pr=Ye[Nr].x-Le,Wr=Ye[Nr].y-mt;K.writeVarint(Ut(pr)),K.writeVarint(Ut(Wr)),Le+=pr,mt+=Wr}Se===3&&K.writeVarint(Re(7,1))}}function Ce(te,K){var fe=typeof te;fe==="string"?K.writeStringField(1,te):fe==="boolean"?K.writeBooleanField(7,te):fe==="number"&&(te%1!=0?K.writeDoubleField(3,te):te<0?K.writeSVarintField(6,te):K.writeVarintField(5,te))}function Ae(te,K,fe,Se){vt(te,fe,Se),vt(K,2*fe,2*Se),vt(K,2*fe+1,2*Se+1)}function vt(te,K,fe){var Se=te[K];te[K]=te[fe],te[fe]=Se}function At(te,K,fe,Se){var Le=te-fe,mt=K-Se;return Le*Le+mt*mt}Jt.fromVectorTileJs=Nt,Jt.fromGeojsonVt=function(te,K){K=K||{};var fe={};for(var Se in te)fe[Se]=new Xe(te[Se].features,K),fe[Se].name=Se,fe[Se].version=K.version,fe[Se].extent=K.extent;return Nt({layers:fe})},Jt.GeoJSONWrapper=Be;var Bt=function(K){return K[0]},Ft=function(K){return K[1]},fr=function(K,fe,Se,Le,mt){fe===void 0&&(fe=Bt),Se===void 0&&(Se=Ft),Le===void 0&&(Le=64),mt===void 0&&(mt=Float64Array),this.nodeSize=Le,this.points=K;for(var St=K.length<65536?Uint16Array:Uint32Array,ge=this.ids=new St(K.length),Ye=this.coords=new mt(2*K.length),zt=0;zt<K.length;zt++)ge[zt]=zt,Ye[2*zt]=fe(K[zt]),Ye[2*zt+1]=Se(K[zt]);(function Rr(Nr,pr,Wr,Gn,wn,dr){if(!(wn-Gn<=Wr)){var Sn=Gn+wn>>1;(function bn(we,Kn,xn,Vi,ia,bi){for(;ia>Vi;){if(ia-Vi>600){var ta=ia-Vi+1,Ni=xn-Vi+1,ns=Math.log(ta),wi=.5*Math.exp(2*ns/3),Xa=.5*Math.sqrt(ns*wi*(ta-wi)/ta)*(Ni-ta/2<0?-1:1);bn(we,Kn,xn,Math.max(Vi,Math.floor(xn-Ni*wi/ta+Xa)),Math.min(ia,Math.floor(xn+(ta-Ni)*wi/ta+Xa)),bi)}var Hi=Kn[2*xn+bi],Zi=Vi,gi=ia;for(Ae(we,Kn,Vi,xn),Kn[2*ia+bi]>Hi&&Ae(we,Kn,Vi,ia);Zi<gi;){for(Ae(we,Kn,Zi,gi),Zi++,gi--;Kn[2*Zi+bi]<Hi;)Zi++;for(;Kn[2*gi+bi]>Hi;)gi--}Kn[2*Vi+bi]===Hi?Ae(we,Kn,Vi,gi):Ae(we,Kn,++gi,ia),gi<=xn&&(Vi=gi+1),xn<=gi&&(ia=gi-1)}})(Nr,pr,Sn,Gn,wn,dr%2),Rr(Nr,pr,Wr,Gn,Sn-1,dr+1),Rr(Nr,pr,Wr,Sn+1,wn,dr+1)}})(ge,Ye,Le,0,ge.length-1,0)};fr.prototype.range=function(te,K,fe,Se){return function(Le,mt,St,ge,Ye,zt,Rr){for(var Nr,pr,Wr=[0,Le.length-1,0],Gn=[];Wr.length;){var wn=Wr.pop(),dr=Wr.pop(),Sn=Wr.pop();if(dr-Sn<=Rr)for(var bn=Sn;bn<=dr;bn++)pr=mt[2*bn+1],(Nr=mt[2*bn])>=St&&Nr<=Ye&&pr>=ge&&pr<=zt&&Gn.push(Le[bn]);else{var we=Math.floor((Sn+dr)/2);pr=mt[2*we+1],(Nr=mt[2*we])>=St&&Nr<=Ye&&pr>=ge&&pr<=zt&&Gn.push(Le[we]);var Kn=(wn+1)%2;(wn===0?St<=Nr:ge<=pr)&&(Wr.push(Sn),Wr.push(we-1),Wr.push(Kn)),(wn===0?Ye>=Nr:zt>=pr)&&(Wr.push(we+1),Wr.push(dr),Wr.push(Kn))}}return Gn}(this.ids,this.coords,te,K,fe,Se,this.nodeSize)},fr.prototype.within=function(te,K,fe){return function(Se,Le,mt,St,ge,Ye){for(var zt=[0,Se.length-1,0],Rr=[],Nr=ge*ge;zt.length;){var pr=zt.pop(),Wr=zt.pop(),Gn=zt.pop();if(Wr-Gn<=Ye)for(var wn=Gn;wn<=Wr;wn++)At(Le[2*wn],Le[2*wn+1],mt,St)<=Nr&&Rr.push(Se[wn]);else{var dr=Math.floor((Gn+Wr)/2),Sn=Le[2*dr],bn=Le[2*dr+1];At(Sn,bn,mt,St)<=Nr&&Rr.push(Se[dr]);var we=(pr+1)%2;(pr===0?mt-ge<=Sn:St-ge<=bn)&&(zt.push(Gn),zt.push(dr-1),zt.push(we)),(pr===0?mt+ge>=Sn:St+ge>=bn)&&(zt.push(dr+1),zt.push(Wr),zt.push(we))}}return Rr}(this.ids,this.coords,te,K,fe,this.nodeSize)};var Tr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(K){return K}},Br=function(K){this.options=ci(Object.create(Tr),K),this.trees=new Array(this.options.maxZoom+1)};function On(te,K,fe,Se,Le){return{x:te,y:K,zoom:1/0,id:fe,parentId:-1,numPoints:Se,properties:Le}}function Fr(te,K){var fe=te.geometry.coordinates,Se=fe[1];return{x:Yn(fe[0]),y:ei(Se),zoom:1/0,index:K,parentId:-1}}function Hn(te){return{type:"Feature",id:te.id,properties:ni(te),geometry:{type:"Point",coordinates:[(Se=te.x,360*(Se-.5)),(K=te.y,fe=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(fe))/Math.PI-90)]}};var K,fe,Se}function ni(te){var K=te.numPoints,fe=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return ci(ci({},te.properties),{cluster:!0,cluster_id:te.id,point_count:K,point_count_abbreviated:fe})}function Yn(te){return te/360+.5}function ei(te){var K=Math.sin(te*Math.PI/180),fe=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return fe<0?0:fe>1?1:fe}function ci(te,K){for(var fe in K)te[fe]=K[fe];return te}function Sr(te){return te.x}function _r(te){return te.y}function Kt(te,K,fe,Se,Le,mt){var St=Le-fe,ge=mt-Se;if(St!==0||ge!==0){var Ye=((te-fe)*St+(K-Se)*ge)/(St*St+ge*ge);Ye>1?(fe=Le,Se=mt):Ye>0&&(fe+=St*Ye,Se+=ge*Ye)}return(St=te-fe)*St+(ge=K-Se)*ge}function Wt(te,K,fe,Se){var Le={id:te===void 0?null:te,type:K,geometry:fe,tags:Se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(mt){var St=mt.geometry,ge=mt.type;if(ge==="Point"||ge==="MultiPoint"||ge==="LineString")Ir(mt,St);else if(ge==="Polygon"||ge==="MultiLineString")for(var Ye=0;Ye<St.length;Ye++)Ir(mt,St[Ye]);else if(ge==="MultiPolygon")for(Ye=0;Ye<St.length;Ye++)for(var zt=0;zt<St[Ye].length;zt++)Ir(mt,St[Ye][zt])}(Le),Le}function Ir(te,K){for(var fe=0;fe<K.length;fe+=3)te.minX=Math.min(te.minX,K[fe]),te.minY=Math.min(te.minY,K[fe+1]),te.maxX=Math.max(te.maxX,K[fe]),te.maxY=Math.max(te.maxY,K[fe+1])}function je(te,K,fe,Se){if(K.geometry){var Le=K.geometry.coordinates,mt=K.geometry.type,St=Math.pow(fe.tolerance/((1<<fe.maxZoom)*fe.extent),2),ge=[],Ye=K.id;if(fe.promoteId?Ye=K.properties[fe.promoteId]:fe.generateId&&(Ye=Se||0),mt==="Point")oe(Le,ge);else if(mt==="MultiPoint")for(var zt=0;zt<Le.length;zt++)oe(Le[zt],ge);else if(mt==="LineString")ne(Le,ge,St,!1);else if(mt==="MultiLineString"){if(fe.lineMetrics){for(zt=0;zt<Le.length;zt++)ne(Le[zt],ge=[],St,!1),te.push(Wt(Ye,"LineString",ge,K.properties));return}D(Le,ge,St,!1)}else if(mt==="Polygon")D(Le,ge,St,!0);else{if(mt!=="MultiPolygon"){if(mt==="GeometryCollection"){for(zt=0;zt<K.geometry.geometries.length;zt++)je(te,{id:Ye,geometry:K.geometry.geometries[zt],properties:K.properties},fe,Se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(zt=0;zt<Le.length;zt++){var Rr=[];D(Le[zt],Rr,St,!0),ge.push(Rr)}}te.push(Wt(Ye,mt,ge,K.properties))}}function oe(te,K){K.push(Ee(te[0])),K.push(He(te[1])),K.push(0)}function ne(te,K,fe,Se){for(var Le,mt,St=0,ge=0;ge<te.length;ge++){var Ye=Ee(te[ge][0]),zt=He(te[ge][1]);K.push(Ye),K.push(zt),K.push(0),ge>0&&(St+=Se?(Le*zt-Ye*mt)/2:Math.sqrt(Math.pow(Ye-Le,2)+Math.pow(zt-mt,2))),Le=Ye,mt=zt}var Rr=K.length-3;K[2]=1,function Nr(pr,Wr,Gn,wn){for(var dr,Sn=wn,bn=Gn-Wr>>1,we=Gn-Wr,Kn=pr[Wr],xn=pr[Wr+1],Vi=pr[Gn],ia=pr[Gn+1],bi=Wr+3;bi<Gn;bi+=3){var ta=Kt(pr[bi],pr[bi+1],Kn,xn,Vi,ia);if(ta>Sn)dr=bi,Sn=ta;else if(ta===Sn){var Ni=Math.abs(bi-bn);Ni<we&&(dr=bi,we=Ni)}}Sn>wn&&(dr-Wr>3&&Nr(pr,Wr,dr,wn),pr[dr+2]=Sn,Gn-dr>3&&Nr(pr,dr,Gn,wn))}(K,0,Rr,fe),K[Rr+2]=1,K.size=Math.abs(St),K.start=0,K.end=K.size}function D(te,K,fe,Se){for(var Le=0;Le<te.length;Le++){var mt=[];ne(te[Le],mt,fe,Se),K.push(mt)}}function Ee(te){return te/360+.5}function He(te){var K=Math.sin(te*Math.PI/180),fe=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return fe<0?0:fe>1?1:fe}function xt(te,K,fe,Se,Le,mt,St,ge){if(Se/=K,mt>=(fe/=K)&&St<Se)return te;if(St<fe||mt>=Se)return null;for(var Ye=[],zt=0;zt<te.length;zt++){var Rr=te[zt],Nr=Rr.geometry,pr=Rr.type,Wr=Le===0?Rr.minX:Rr.minY,Gn=Le===0?Rr.maxX:Rr.maxY;if(Wr>=fe&&Gn<Se)Ye.push(Rr);else if(!(Gn<fe||Wr>=Se)){var wn=[];if(pr==="Point"||pr==="MultiPoint")er(Nr,wn,fe,Se,Le);else if(pr==="LineString")ur(Nr,wn,fe,Se,Le,!1,ge.lineMetrics);else if(pr==="MultiLineString")It(Nr,wn,fe,Se,Le,!1);else if(pr==="Polygon")It(Nr,wn,fe,Se,Le,!0);else if(pr==="MultiPolygon")for(var dr=0;dr<Nr.length;dr++){var Sn=[];It(Nr[dr],Sn,fe,Se,Le,!0),Sn.length&&wn.push(Sn)}if(wn.length){if(ge.lineMetrics&&pr==="LineString"){for(dr=0;dr<wn.length;dr++)Ye.push(Wt(Rr.id,pr,wn[dr],Rr.tags));continue}pr!=="LineString"&&pr!=="MultiLineString"||(wn.length===1?(pr="LineString",wn=wn[0]):pr="MultiLineString"),pr!=="Point"&&pr!=="MultiPoint"||(pr=wn.length===3?"Point":"MultiPoint"),Ye.push(Wt(Rr.id,pr,wn,Rr.tags))}}}return Ye.length?Ye:null}function er(te,K,fe,Se,Le){for(var mt=0;mt<te.length;mt+=3){var St=te[mt+Le];St>=fe&&St<=Se&&(K.push(te[mt]),K.push(te[mt+1]),K.push(te[mt+2]))}}function ur(te,K,fe,Se,Le,mt,St){for(var ge,Ye,zt=tt(te),Rr=Le===0?Cr:Or,Nr=te.start,pr=0;pr<te.length-3;pr+=3){var Wr=te[pr],Gn=te[pr+1],wn=te[pr+2],dr=te[pr+3],Sn=te[pr+4],bn=Le===0?Wr:Gn,we=Le===0?dr:Sn,Kn=!1;St&&(ge=Math.sqrt(Math.pow(Wr-dr,2)+Math.pow(Gn-Sn,2))),bn<fe?we>fe&&(Ye=Rr(zt,Wr,Gn,dr,Sn,fe),St&&(zt.start=Nr+ge*Ye)):bn>Se?we<Se&&(Ye=Rr(zt,Wr,Gn,dr,Sn,Se),St&&(zt.start=Nr+ge*Ye)):or(zt,Wr,Gn,wn),we<fe&&bn>=fe&&(Ye=Rr(zt,Wr,Gn,dr,Sn,fe),Kn=!0),we>Se&&bn<=Se&&(Ye=Rr(zt,Wr,Gn,dr,Sn,Se),Kn=!0),!mt&&Kn&&(St&&(zt.end=Nr+ge*Ye),K.push(zt),zt=tt(te)),St&&(Nr+=ge)}var xn=te.length-3;Wr=te[xn],Gn=te[xn+1],wn=te[xn+2],(bn=Le===0?Wr:Gn)>=fe&&bn<=Se&&or(zt,Wr,Gn,wn),xn=zt.length-3,mt&&xn>=3&&(zt[xn]!==zt[0]||zt[xn+1]!==zt[1])&&or(zt,zt[0],zt[1],zt[2]),zt.length&&K.push(zt)}function tt(te){var K=[];return K.size=te.size,K.start=te.start,K.end=te.end,K}function It(te,K,fe,Se,Le,mt){for(var St=0;St<te.length;St++)ur(te[St],K,fe,Se,Le,mt,!1)}function or(te,K,fe,Se){te.push(K),te.push(fe),te.push(Se)}function Cr(te,K,fe,Se,Le,mt){var St=(mt-K)/(Se-K);return te.push(mt),te.push(fe+(Le-fe)*St),te.push(1),St}function Or(te,K,fe,Se,Le,mt){var St=(mt-fe)/(Le-fe);return te.push(K+(Se-K)*St),te.push(mt),te.push(1),St}function Nn(te,K){for(var fe=[],Se=0;Se<te.length;Se++){var Le,mt=te[Se],St=mt.type;if(St==="Point"||St==="MultiPoint"||St==="LineString")Le=sn(mt.geometry,K);else if(St==="MultiLineString"||St==="Polygon"){Le=[];for(var ge=0;ge<mt.geometry.length;ge++)Le.push(sn(mt.geometry[ge],K))}else if(St==="MultiPolygon")for(Le=[],ge=0;ge<mt.geometry.length;ge++){for(var Ye=[],zt=0;zt<mt.geometry[ge].length;zt++)Ye.push(sn(mt.geometry[ge][zt],K));Le.push(Ye)}fe.push(Wt(mt.id,St,Le,mt.tags))}return fe}function sn(te,K){var fe=[];fe.size=te.size,te.start!==void 0&&(fe.start=te.start,fe.end=te.end);for(var Se=0;Se<te.length;Se+=3)fe.push(te[Se]+K,te[Se+1],te[Se+2]);return fe}function gn(te,K){if(te.transformed)return te;var fe,Se,Le,mt=1<<te.z,St=te.x,ge=te.y;for(fe=0;fe<te.features.length;fe++){var Ye=te.features[fe],zt=Ye.geometry,Rr=Ye.type;if(Ye.geometry=[],Rr===1)for(Se=0;Se<zt.length;Se+=2)Ye.geometry.push(dn(zt[Se],zt[Se+1],K,mt,St,ge));else for(Se=0;Se<zt.length;Se++){var Nr=[];for(Le=0;Le<zt[Se].length;Le+=2)Nr.push(dn(zt[Se][Le],zt[Se][Le+1],K,mt,St,ge));Ye.geometry.push(Nr)}}return te.transformed=!0,te}function dn(te,K,fe,Se,Le,mt){return[Math.round(fe*(te*Se-Le)),Math.round(fe*(K*Se-mt))]}function ri(te,K,fe,Se,Le){for(var mt=K===Le.maxZoom?0:Le.tolerance/((1<<K)*Le.extent),St={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:fe,y:Se,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<te.length;ge++){St.numFeatures++,mi(St,te[ge],mt,Le);var Ye=te[ge].minX,zt=te[ge].minY,Rr=te[ge].maxX,Nr=te[ge].maxY;Ye<St.minX&&(St.minX=Ye),zt<St.minY&&(St.minY=zt),Rr>St.maxX&&(St.maxX=Rr),Nr>St.maxY&&(St.maxY=Nr)}return St}function mi(te,K,fe,Se){var Le=K.geometry,mt=K.type,St=[];if(mt==="Point"||mt==="MultiPoint")for(var ge=0;ge<Le.length;ge+=3)St.push(Le[ge]),St.push(Le[ge+1]),te.numPoints++,te.numSimplified++;else if(mt==="LineString")ki(St,Le,te,fe,!1,!1);else if(mt==="MultiLineString"||mt==="Polygon")for(ge=0;ge<Le.length;ge++)ki(St,Le[ge],te,fe,mt==="Polygon",ge===0);else if(mt==="MultiPolygon")for(var Ye=0;Ye<Le.length;Ye++){var zt=Le[Ye];for(ge=0;ge<zt.length;ge++)ki(St,zt[ge],te,fe,!0,ge===0)}if(St.length){var Rr=K.tags||null;if(mt==="LineString"&&Se.lineMetrics){for(var Nr in Rr={},K.tags)Rr[Nr]=K.tags[Nr];Rr.mapbox_clip_start=Le.start/Le.size,Rr.mapbox_clip_end=Le.end/Le.size}var pr={geometry:St,type:mt==="Polygon"||mt==="MultiPolygon"?3:mt==="LineString"||mt==="MultiLineString"?2:1,tags:Rr};K.id!==null&&(pr.id=K.id),te.features.push(pr)}}function ki(te,K,fe,Se,Le,mt){var St=Se*Se;if(Se>0&&K.size<(Le?St:Se))fe.numPoints+=K.length/3;else{for(var ge=[],Ye=0;Ye<K.length;Ye+=3)(Se===0||K[Ye+2]>St)&&(fe.numSimplified++,ge.push(K[Ye]),ge.push(K[Ye+1])),fe.numPoints++;Le&&function(zt,Rr){for(var Nr=0,pr=0,Wr=zt.length,Gn=Wr-2;pr<Wr;Gn=pr,pr+=2)Nr+=(zt[pr]-zt[Gn])*(zt[pr+1]+zt[Gn+1]);if(Nr>0===Rr)for(pr=0,Wr=zt.length;pr<Wr/2;pr+=2){var wn=zt[pr],dr=zt[pr+1];zt[pr]=zt[Wr-2-pr],zt[pr+1]=zt[Wr-1-pr],zt[Wr-2-pr]=wn,zt[Wr-1-pr]=dr}}(ge,mt),te.push(ge)}}function Aa(te,K){var fe=(K=this.options=function(Le,mt){for(var St in mt)Le[St]=mt[St];return Le}(Object.create(this.options),K)).debug;if(fe&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var Se=function(Le,mt){var St=[];if(Le.type==="FeatureCollection")for(var ge=0;ge<Le.features.length;ge++)je(St,Le.features[ge],mt,ge);else je(St,Le.type==="Feature"?Le:{geometry:Le},mt);return St}(te,K);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Se=function(Le,mt){var St=mt.buffer/mt.extent,ge=Le,Ye=xt(Le,1,-1-St,St,0,-1,2,mt),zt=xt(Le,1,1-St,2+St,0,-1,2,mt);return(Ye||zt)&&(ge=xt(Le,1,-St,1+St,0,-1,2,mt)||[],Ye&&(ge=Nn(Ye,1).concat(ge)),zt&&(ge=ge.concat(Nn(zt,-1)))),ge}(Se,K)).length&&this.splitTile(Se,0,0,0),fe&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Pa(te,K,fe){return 32*((1<<te)*fe+K)+te}function Co(te,K){var fe=te.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var Se=this._geoJSONIndex.getTile(fe.z,fe.x,fe.y);if(!Se)return K(null,null);var Le=new kt(Se.features),mt=Jt(Le);mt.byteOffset===0&&mt.byteLength===mt.buffer.byteLength||(mt=new Uint8Array(mt)),K(null,{vectorTile:Le,rawData:mt.buffer})}Br.prototype.load=function(te){var K=this.options,fe=K.log,Se=K.minZoom,Le=K.maxZoom,mt=K.nodeSize;fe&&console.time("total time");var St="prepare "+te.length+" points";fe&&console.time(St),this.points=te;for(var ge=[],Ye=0;Ye<te.length;Ye++)te[Ye].geometry&&ge.push(Fr(te[Ye],Ye));this.trees[Le+1]=new fr(ge,Sr,_r,mt,Float32Array),fe&&console.timeEnd(St);for(var zt=Le;zt>=Se;zt--){var Rr=+Date.now();ge=this._cluster(ge,zt),this.trees[zt]=new fr(ge,Sr,_r,mt,Float32Array),fe&&console.log("z%d: %d clusters in %dms",zt,ge.length,+Date.now()-Rr)}return fe&&console.timeEnd("total time"),this},Br.prototype.getClusters=function(te,K){var fe=((te[0]+180)%360+360)%360-180,Se=Math.max(-90,Math.min(90,te[1])),Le=te[2]===180?180:((te[2]+180)%360+360)%360-180,mt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)fe=-180,Le=180;else if(fe>Le){var St=this.getClusters([fe,Se,180,mt],K),ge=this.getClusters([-180,Se,Le,mt],K);return St.concat(ge)}for(var Ye=this.trees[this._limitZoom(K)],zt=[],Rr=0,Nr=Ye.range(Yn(fe),ei(mt),Yn(Le),ei(Se));Rr<Nr.length;Rr+=1){var pr=Ye.points[Nr[Rr]];zt.push(pr.numPoints?Hn(pr):this.points[pr.index])}return zt},Br.prototype.getChildren=function(te){var K=this._getOriginId(te),fe=this._getOriginZoom(te),Se="No cluster with the specified id.",Le=this.trees[fe];if(!Le)throw new Error(Se);var mt=Le.points[K];if(!mt)throw new Error(Se);for(var St=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),ge=[],Ye=0,zt=Le.within(mt.x,mt.y,St);Ye<zt.length;Ye+=1){var Rr=Le.points[zt[Ye]];Rr.parentId===te&&ge.push(Rr.numPoints?Hn(Rr):this.points[Rr.index])}if(ge.length===0)throw new Error(Se);return ge},Br.prototype.getLeaves=function(te,K,fe){var Se=[];return this._appendLeaves(Se,te,K=K||10,fe=fe||0,0),Se},Br.prototype.getTile=function(te,K,fe){var Se=this.trees[this._limitZoom(te)],Le=Math.pow(2,te),mt=this.options,St=mt.radius/mt.extent,ge=(fe-St)/Le,Ye=(fe+1+St)/Le,zt={features:[]};return this._addTileFeatures(Se.range((K-St)/Le,ge,(K+1+St)/Le,Ye),Se.points,K,fe,Le,zt),K===0&&this._addTileFeatures(Se.range(1-St/Le,ge,1,Ye),Se.points,Le,fe,Le,zt),K===Le-1&&this._addTileFeatures(Se.range(0,ge,St/Le,Ye),Se.points,-1,fe,Le,zt),zt.features.length?zt:null},Br.prototype.getClusterExpansionZoom=function(te){for(var K=this._getOriginZoom(te)-1;K<=this.options.maxZoom;){var fe=this.getChildren(te);if(K++,fe.length!==1)break;te=fe[0].properties.cluster_id}return K},Br.prototype._appendLeaves=function(te,K,fe,Se,Le){for(var mt=0,St=this.getChildren(K);mt<St.length;mt+=1){var ge=St[mt],Ye=ge.properties;if(Ye&&Ye.cluster?Le+Ye.point_count<=Se?Le+=Ye.point_count:Le=this._appendLeaves(te,Ye.cluster_id,fe,Se,Le):Le<Se?Le++:te.push(ge),te.length===fe)break}return Le},Br.prototype._addTileFeatures=function(te,K,fe,Se,Le,mt){for(var St=0,ge=te;St<ge.length;St+=1){var Ye=K[ge[St]],zt=Ye.numPoints,Rr={type:1,geometry:[[Math.round(this.options.extent*(Ye.x*Le-fe)),Math.round(this.options.extent*(Ye.y*Le-Se))]],tags:zt?ni(Ye):this.points[Ye.index].properties},Nr=void 0;zt?Nr=Ye.id:this.options.generateId?Nr=Ye.index:this.points[Ye.index].id&&(Nr=this.points[Ye.index].id),Nr!==void 0&&(Rr.id=Nr),mt.features.push(Rr)}},Br.prototype._limitZoom=function(te){return Math.max(this.options.minZoom,Math.min(+te,this.options.maxZoom+1))},Br.prototype._cluster=function(te,K){for(var fe=[],Se=this.options,Le=Se.reduce,mt=Se.minPoints,St=Se.radius/(Se.extent*Math.pow(2,K)),ge=0;ge<te.length;ge++){var Ye=te[ge];if(!(Ye.zoom<=K)){Ye.zoom=K;for(var zt=this.trees[K+1],Rr=zt.within(Ye.x,Ye.y,St),Nr=Ye.numPoints||1,pr=Nr,Wr=0,Gn=Rr;Wr<Gn.length;Wr+=1){var wn=zt.points[Gn[Wr]];wn.zoom>K&&(pr+=wn.numPoints||1)}if(pr>=mt){for(var dr=Ye.x*Nr,Sn=Ye.y*Nr,bn=Le&&Nr>1?this._map(Ye,!0):null,we=(ge<<5)+(K+1)+this.points.length,Kn=0,xn=Rr;Kn<xn.length;Kn+=1){var Vi=zt.points[xn[Kn]];if(!(Vi.zoom<=K)){Vi.zoom=K;var ia=Vi.numPoints||1;dr+=Vi.x*ia,Sn+=Vi.y*ia,Vi.parentId=we,Le&&(bn||(bn=this._map(Ye,!0)),Le(bn,this._map(Vi)))}}Ye.parentId=we,fe.push(On(dr/pr,Sn/pr,we,pr,bn))}else if(fe.push(Ye),pr>1)for(var bi=0,ta=Rr;bi<ta.length;bi+=1){var Ni=zt.points[ta[bi]];Ni.zoom<=K||(Ni.zoom=K,fe.push(Ni))}}}return fe},Br.prototype._getOriginId=function(te){return te-this.points.length>>5},Br.prototype._getOriginZoom=function(te){return(te-this.points.length)%32},Br.prototype._map=function(te,K){if(te.numPoints)return K?ci({},te.properties):te.properties;var fe=this.points[te.index].properties,Se=this.options.map(fe);return K&&Se===fe?ci({},Se):Se},Aa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Aa.prototype.splitTile=function(te,K,fe,Se,Le,mt,St){for(var ge=[te,K,fe,Se],Ye=this.options,zt=Ye.debug;ge.length;){Se=ge.pop(),fe=ge.pop(),K=ge.pop(),te=ge.pop();var Rr=1<<K,Nr=Pa(K,fe,Se),pr=this.tiles[Nr];if(!pr&&(zt>1&&console.time("creation"),pr=this.tiles[Nr]=ri(te,K,fe,Se,Ye),this.tileCoords.push({z:K,x:fe,y:Se}),zt)){zt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,fe,Se,pr.numFeatures,pr.numPoints,pr.numSimplified),console.timeEnd("creation"));var Wr="z"+K;this.stats[Wr]=(this.stats[Wr]||0)+1,this.total++}if(pr.source=te,Le){if(K===Ye.maxZoom||K===Le)continue;var Gn=1<<Le-K;if(fe!==Math.floor(mt/Gn)||Se!==Math.floor(St/Gn))continue}else if(K===Ye.indexMaxZoom||pr.numPoints<=Ye.indexMaxPoints)continue;if(pr.source=null,te.length!==0){zt>1&&console.time("clipping");var wn,dr,Sn,bn,we,Kn,xn=.5*Ye.buffer/Ye.extent,Vi=.5-xn,ia=.5+xn,bi=1+xn;wn=dr=Sn=bn=null,we=xt(te,Rr,fe-xn,fe+ia,0,pr.minX,pr.maxX,Ye),Kn=xt(te,Rr,fe+Vi,fe+bi,0,pr.minX,pr.maxX,Ye),te=null,we&&(wn=xt(we,Rr,Se-xn,Se+ia,1,pr.minY,pr.maxY,Ye),dr=xt(we,Rr,Se+Vi,Se+bi,1,pr.minY,pr.maxY,Ye),we=null),Kn&&(Sn=xt(Kn,Rr,Se-xn,Se+ia,1,pr.minY,pr.maxY,Ye),bn=xt(Kn,Rr,Se+Vi,Se+bi,1,pr.minY,pr.maxY,Ye),Kn=null),zt>1&&console.timeEnd("clipping"),ge.push(wn||[],K+1,2*fe,2*Se),ge.push(dr||[],K+1,2*fe,2*Se+1),ge.push(Sn||[],K+1,2*fe+1,2*Se),ge.push(bn||[],K+1,2*fe+1,2*Se+1)}}},Aa.prototype.getTile=function(te,K,fe){var Se=this.options,Le=Se.extent,mt=Se.debug;if(te<0||te>24)return null;var St=1<<te,ge=Pa(te,K=(K%St+St)%St,fe);if(this.tiles[ge])return gn(this.tiles[ge],Le);mt>1&&console.log("drilling down to z%d-%d-%d",te,K,fe);for(var Ye,zt=te,Rr=K,Nr=fe;!Ye&&zt>0;)zt--,Rr=Math.floor(Rr/2),Nr=Math.floor(Nr/2),Ye=this.tiles[Pa(zt,Rr,Nr)];return Ye&&Ye.source?(mt>1&&console.log("found parent tile z%d-%d-%d",zt,Rr,Nr),mt>1&&console.time("drilling down"),this.splitTile(Ye.source,zt,Rr,Nr,te,K,fe),mt>1&&console.timeEnd("drilling down"),this.tiles[ge]?gn(this.tiles[ge],Le):null):null};var yo=function(te){function K(fe,Se,Le,mt){te.call(this,fe,Se,Le,Co),mt&&(this.loadGeoJSON=mt)}return te&&(K.__proto__=te),(K.prototype=Object.create(te&&te.prototype)).constructor=K,K.prototype.loadData=function(fe,Se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=Se,this._pendingLoadDataParams=fe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var fe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var Se=this._pendingCallback,Le=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var mt=!!(Le&&Le.request&&Le.request.collectResourceTiming)&&new v.RequestPerformance(Le.request);this.loadGeoJSON(Le,function(St,ge){if(St||!ge)return Se(St);if(typeof ge!="object")return Se(new Error("Input data given to '"+Le.source+"' is not a valid GeoJSON object."));(function pr(Wr,Gn){var wn,dr=Wr&&Wr.type;if(dr==="FeatureCollection")for(wn=0;wn<Wr.features.length;wn++)pr(Wr.features[wn],Gn);else if(dr==="GeometryCollection")for(wn=0;wn<Wr.geometries.length;wn++)pr(Wr.geometries[wn],Gn);else if(dr==="Feature")pr(Wr.geometry,Gn);else if(dr==="Polygon")pt(Wr.coordinates,Gn);else if(dr==="MultiPolygon")for(wn=0;wn<Wr.coordinates.length;wn++)pt(Wr.coordinates[wn],Gn);return Wr})(ge,!0);try{if(Le.filter){var Ye=v.createExpression(Le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ye.result==="error")throw new Error(Ye.value.map(function(pr){return pr.key+": "+pr.message}).join(", "));var zt=ge.features.filter(function(pr){return Ye.value.evaluate({zoom:0},pr)});ge={type:"FeatureCollection",features:zt}}fe._geoJSONIndex=Le.cluster?new Br(function(pr){var Wr=pr.superclusterOptions,Gn=pr.clusterProperties;if(!Gn||!Wr)return Wr;for(var wn={},dr={},Sn={accumulated:null,zoom:0},bn={properties:null},we=Object.keys(Gn),Kn=0,xn=we;Kn<xn.length;Kn+=1){var Vi=xn[Kn],ia=Gn[Vi],bi=ia[0],ta=v.createExpression(ia[1]),Ni=v.createExpression(typeof bi=="string"?[bi,["accumulated"],["get",Vi]]:bi);wn[Vi]=ta.value,dr[Vi]=Ni.value}return Wr.map=function(ns){bn.properties=ns;for(var wi={},Xa=0,Hi=we;Xa<Hi.length;Xa+=1){var Zi=Hi[Xa];wi[Zi]=wn[Zi].evaluate(Sn,bn)}return wi},Wr.reduce=function(ns,wi){bn.properties=wi;for(var Xa=0,Hi=we;Xa<Hi.length;Xa+=1){var Zi=Hi[Xa];Sn.accumulated=ns[Zi],ns[Zi]=dr[Zi].evaluate(Sn,bn)}},Wr}(Le)).load(ge.features):function(pr,Wr){return new Aa(pr,Wr)}(ge,Le.geojsonVtOptions)}catch(pr){return Se(pr)}fe.loaded={};var Rr={};if(mt){var Nr=mt.finish();Nr&&(Rr.resourceTiming={},Rr.resourceTiming[Le.source]=JSON.parse(JSON.stringify(Nr)))}Se(null,Rr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(fe,Se){var Le=this.loaded;return Le&&Le[fe.uid]?te.prototype.reloadTile.call(this,fe,Se):this.loadTile(fe,Se)},K.prototype.loadGeoJSON=function(fe,Se){if(fe.request)v.getJSON(fe.request,Se);else{if(typeof fe.data!="string")return Se(new Error("Input data given to '"+fe.source+"' is not a valid GeoJSON object."));try{return Se(null,JSON.parse(fe.data))}catch(Le){return Se(new Error("Input data given to '"+fe.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(fe,Se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),Se()},K.prototype.getClusterExpansionZoom=function(fe,Se){try{Se(null,this._geoJSONIndex.getClusterExpansionZoom(fe.clusterId))}catch(Le){Se(Le)}},K.prototype.getClusterChildren=function(fe,Se){try{Se(null,this._geoJSONIndex.getChildren(fe.clusterId))}catch(Le){Se(Le)}},K.prototype.getClusterLeaves=function(fe,Se){try{Se(null,this._geoJSONIndex.getLeaves(fe.clusterId,fe.limit,fe.offset))}catch(Le){Se(Le)}},K}(Ne),Mi=function(K){var fe=this;this.self=K,this.actor=new v.Actor(K,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ne,geojson:yo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Se,Le){if(fe.workerSourceTypes[Se])throw new Error('Worker source with name "'+Se+'" already registered.');fe.workerSourceTypes[Se]=Le},this.self.registerRTLTextPlugin=function(Se){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=Se.applyArabicShaping,v.plugin.processBidirectionalText=Se.processBidirectionalText,v.plugin.processStyledBidirectionalText=Se.processStyledBidirectionalText}};return Mi.prototype.setReferrer=function(te,K){this.referrer=K},Mi.prototype.setImages=function(te,K,fe){for(var Se in this.availableImages[te]=K,this.workerSources[te]){var Le=this.workerSources[te][Se];for(var mt in Le)Le[mt].availableImages=K}fe()},Mi.prototype.setLayers=function(te,K,fe){this.getLayerIndex(te).replace(K),fe()},Mi.prototype.updateLayers=function(te,K,fe){this.getLayerIndex(te).update(K.layers,K.removedIds),fe()},Mi.prototype.loadTile=function(te,K,fe){this.getWorkerSource(te,K.type,K.source).loadTile(K,fe)},Mi.prototype.loadDEMTile=function(te,K,fe){this.getDEMWorkerSource(te,K.source).loadTile(K,fe)},Mi.prototype.reloadTile=function(te,K,fe){this.getWorkerSource(te,K.type,K.source).reloadTile(K,fe)},Mi.prototype.abortTile=function(te,K,fe){this.getWorkerSource(te,K.type,K.source).abortTile(K,fe)},Mi.prototype.removeTile=function(te,K,fe){this.getWorkerSource(te,K.type,K.source).removeTile(K,fe)},Mi.prototype.removeDEMTile=function(te,K){this.getDEMWorkerSource(te,K.source).removeTile(K)},Mi.prototype.removeSource=function(te,K,fe){if(this.workerSources[te]&&this.workerSources[te][K.type]&&this.workerSources[te][K.type][K.source]){var Se=this.workerSources[te][K.type][K.source];delete this.workerSources[te][K.type][K.source],Se.removeSource!==void 0?Se.removeSource(K,fe):fe()}},Mi.prototype.loadWorkerSource=function(te,K,fe){try{this.self.importScripts(K.url),fe()}catch(Se){fe(Se.toString())}},Mi.prototype.syncRTLPluginState=function(te,K,fe){try{v.plugin.setState(K);var Se=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&Se!=null){this.self.importScripts(Se);var Le=v.plugin.isParsed();fe(Le?void 0:new Error("RTL Text Plugin failed to import scripts from "+Se),Le)}}catch(mt){fe(mt.toString())}},Mi.prototype.getAvailableImages=function(te){var K=this.availableImages[te];return K||(K=[]),K},Mi.prototype.getLayerIndex=function(te){var K=this.layerIndexes[te];return K||(K=this.layerIndexes[te]=new Pe),K},Mi.prototype.getWorkerSource=function(te,K,fe){var Se=this;return this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][K]||(this.workerSources[te][K]={}),this.workerSources[te][K][fe]||(this.workerSources[te][K][fe]=new this.workerSourceTypes[K]({send:function(mt,St,ge){Se.actor.send(mt,St,ge,te)}},this.getLayerIndex(te),this.getAvailableImages(te))),this.workerSources[te][K][fe]},Mi.prototype.getDEMWorkerSource=function(te,K){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][K]||(this.demWorkerSources[te][K]=new Dt),this.demWorkerSources[te][K]},Mi.prototype.enforceCacheSizeLimit=function(te,K){v.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Mi(self)),Mi}),N(["./shared"],function(v){"use strict";var z=v.createCommonjsModule(function(m){function d(A){return!p(A)}function p(A){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,k,G=new Blob([""],{type:"text/javascript"}),q=URL.createObjectURL(G);try{k=new Worker(q),M=!0}catch(pe){M=!1}return k&&k.terminate(),URL.revokeObjectURL(q),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var k=M.getContext("2d");if(!k)return!1;var G=k.getImageData(0,0,1,1);return G&&G.width===M.width}()?(y[w=A&&A.failIfMajorPerformanceCaveat]===void 0&&(y[w]=function(M){var k=function(q){var pe=document.createElement("canvas"),ye=Object.create(d.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=q,pe.probablySupportsContext?pe.probablySupportsContext("webgl",ye)||pe.probablySupportsContext("experimental-webgl",ye):pe.supportsContext?pe.supportsContext("webgl",ye)||pe.supportsContext("experimental-webgl",ye):pe.getContext("webgl",ye)||pe.getContext("experimental-webgl",ye)}(M);if(!k)return!1;var G=k.createShader(k.VERTEX_SHADER);return!(!G||k.isContextLost())&&(k.shaderSource(G,"void main() {}"),k.compileShader(G),k.getShaderParameter(G,k.COMPILE_STATUS)===!0)}(w)),y[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}m.exports?m.exports=d:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=d,window.mapboxgl.notSupportedReason=p);var y={};d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),W={create:function(d,p,y){var A=v.window.document.createElement(d);return p!==void 0&&(A.className=p),y&&y.appendChild(A),A},createNS:function(d,p){return v.window.document.createElementNS(d,p)}},Pe=v.window.document&&v.window.document.documentElement.style;function se(m){if(!Pe)return m[0];for(var d=0;d<m.length;d++)if(m[d]in Pe)return m[d];return m[0]}var ve,ue=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);W.disableDrag=function(){Pe&&ue&&(ve=Pe[ue],Pe[ue]="none")},W.enableDrag=function(){Pe&&ue&&(Pe[ue]=ve)};var gt=se(["transform","WebkitTransform"]);W.setTransform=function(m,d){m.style[gt]=d};var Ne=!1;try{var st=Object.defineProperty({},"passive",{get:function(){Ne=!0}});v.window.addEventListener("test",st,st),v.window.removeEventListener("test",st,st)}catch(m){Ne=!1}W.addEventListener=function(m,d,p,y){y===void 0&&(y={}),m.addEventListener(d,p,"passive"in y&&Ne?y:y.capture)},W.removeEventListener=function(m,d,p,y){y===void 0&&(y={}),m.removeEventListener(d,p,"passive"in y&&Ne?y:y.capture)};var Dt=function m(d){d.preventDefault(),d.stopPropagation(),v.window.removeEventListener("click",m,!0)};function pt(m){var d=m.userImage;return!!(d&&d.render&&d.render())&&(m.data.replace(new Uint8Array(d.data.buffer)),!0)}W.suppressClick=function(){v.window.addEventListener("click",Dt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Dt,!0)},0)},W.mousePos=function(m,d){var p=m.getBoundingClientRect();return new v.Point(d.clientX-p.left-m.clientLeft,d.clientY-p.top-m.clientTop)},W.touchPos=function(m,d){for(var p=m.getBoundingClientRect(),y=[],A=0;A<d.length;A++)y.push(new v.Point(d[A].clientX-p.left-m.clientLeft,d[A].clientY-p.top-m.clientTop));return y},W.mouseButton=function(m){return v.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button},W.remove=function(m){m.parentNode&&m.parentNode.removeChild(m)};var $e=function(m){function d(){m.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.isLoaded=function(){return this.loaded},d.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var y=0,A=this.requestors;y<A.length;y+=1){var w=A[y];this._notify(w.ids,w.callback)}this.requestors=[]}},d.prototype.getImage=function(p){return this.images[p]},d.prototype.addImage=function(p,y){this._validate(p,y)&&(this.images[p]=y)},d.prototype._validate=function(p,y){var A=!0;return this._validateStretch(y.stretchX,y.data&&y.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),A=!1),this._validateStretch(y.stretchY,y.data&&y.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),A=!1),this._validateContent(y.content,y)||(this.fire(new v.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),A=!1),A},d.prototype._validateStretch=function(p,y){if(!p)return!0;for(var A=0,w=0,M=p;w<M.length;w+=1){var k=M[w];if(k[0]<A||k[1]<k[0]||y<k[1])return!1;A=k[1]}return!0},d.prototype._validateContent=function(p,y){return!(p&&(p.length!==4||p[0]<0||y.data.width<p[0]||p[1]<0||y.data.height<p[1]||p[2]<0||y.data.width<p[2]||p[3]<0||y.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},d.prototype.updateImage=function(p,y){y.version=this.images[p].version+1,this.images[p]=y,this.updatedImages[p]=!0},d.prototype.removeImage=function(p){var y=this.images[p];delete this.images[p],delete this.patterns[p],y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()},d.prototype.listImages=function(){return Object.keys(this.images)},d.prototype.getImages=function(p,y){var A=!0;if(!this.isLoaded())for(var w=0,M=p;w<M.length;w+=1)this.images[M[w]]||(A=!1);this.isLoaded()||A?this._notify(p,y):this.requestors.push({ids:p,callback:y})},d.prototype._notify=function(p,y){for(var A={},w=0,M=p;w<M.length;w+=1){var k=M[w];this.images[k]||this.fire(new v.Event("styleimagemissing",{id:k}));var G=this.images[k];G?A[k]={data:G.data.clone(),pixelRatio:G.pixelRatio,sdf:G.sdf,version:G.version,stretchX:G.stretchX,stretchY:G.stretchY,content:G.content,hasRenderCallback:Boolean(G.userImage&&G.userImage.render)}:v.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}y(null,A)},d.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},d.prototype.getPattern=function(p){var y=this.patterns[p],A=this.getImage(p);if(!A)return null;if(y&&y.position.version===A.version)return y.position;if(y)y.position.version=A.version;else{var w={w:A.data.width+2,h:A.data.height+2,x:0,y:0},M=new v.ImagePosition(w,A);this.patterns[p]={bin:w,position:M}}return this._updatePatternAtlas(),this.patterns[p].position},d.prototype.bind=function(p){var y=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(p,this.atlasImage,y.RGBA),this.atlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE)},d.prototype._updatePatternAtlas=function(){var p=[];for(var y in this.patterns)p.push(this.patterns[y].bin);var A=v.potpack(p),w=A.w,M=A.h,k=this.atlasImage;for(var G in k.resize({width:w||1,height:M||1}),this.patterns){var q=this.patterns[G].bin,pe=q.x+1,ye=q.y+1,be=this.images[G].data,qe=be.width,Ue=be.height;v.RGBAImage.copy(be,k,{x:0,y:0},{x:pe,y:ye},{width:qe,height:Ue}),v.RGBAImage.copy(be,k,{x:0,y:Ue-1},{x:pe,y:ye-1},{width:qe,height:1}),v.RGBAImage.copy(be,k,{x:0,y:0},{x:pe,y:ye+Ue},{width:qe,height:1}),v.RGBAImage.copy(be,k,{x:qe-1,y:0},{x:pe-1,y:ye},{width:1,height:Ue}),v.RGBAImage.copy(be,k,{x:0,y:0},{x:pe+qe,y:ye},{width:1,height:Ue})}this.dirty=!0},d.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},d.prototype.dispatchRenderCallbacks=function(p){for(var y=0,A=p;y<A.length;y+=1){var w=A[y];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var M=this.images[w];pt(M)&&this.updateImage(w,M)}}},d}(v.Evented),Ct=Je,et=Je,kt=1e20;function Je(m,d,p,y,A,w){this.fontSize=m||24,this.buffer=d===void 0?3:d,this.cutoff=y||.25,this.fontFamily=A||"sans-serif",this.fontWeight=w||"normal",this.radius=p||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Xe(m,d,p,y,A,w,M){for(var k=0;k<d;k++){for(var G=0;G<p;G++)y[G]=m[G*d+k];for(jr(y,A,w,M,p),G=0;G<p;G++)m[G*d+k]=A[G]}for(G=0;G<p;G++){for(k=0;k<d;k++)y[k]=m[G*d+k];for(jr(y,A,w,M,d),k=0;k<d;k++)m[G*d+k]=Math.sqrt(A[k])}}function jr(m,d,p,y,A){p[0]=0,y[0]=-kt,y[1]=+kt;for(var w=1,M=0;w<A;w++){for(var k=(m[w]+w*w-(m[p[M]]+p[M]*p[M]))/(2*w-2*p[M]);k<=y[M];)M--,k=(m[w]+w*w-(m[p[M]]+p[M]*p[M]))/(2*w-2*p[M]);p[++M]=w,y[M]=k,y[M+1]=+kt}for(w=0,M=0;w<A;w++){for(;y[M+1]<w;)M++;d[w]=(w-p[M])*(w-p[M])+m[p[M]]}}Je.prototype.draw=function(m){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(m,this.buffer,this.middle);for(var d=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),y=0;y<this.size*this.size;y++){var A=d.data[4*y+3]/255;this.gridOuter[y]=A===1?0:A===0?kt:Math.pow(Math.max(0,.5-A),2),this.gridInner[y]=A===1?kt:A===0?0:Math.pow(Math.max(0,A-.5),2)}for(Xe(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Xe(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),y=0;y<this.size*this.size;y++)p[y]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[y]-this.gridInner[y])/this.radius+this.cutoff))));return p},Ct.default=et;var Dr=function(d,p){this.requestManager=d,this.localIdeographFontFamily=p,this.entries={}};Dr.prototype.setURL=function(m){this.url=m},Dr.prototype.getGlyphs=function(m,d){var p=this,y=[];for(var A in m)for(var w=0,M=m[A];w<M.length;w+=1)y.push({stack:A,id:M[w]});v.asyncAll(y,function(k,G){var q=k.stack,pe=k.id,ye=p.entries[q];ye||(ye=p.entries[q]={glyphs:{},requests:{},ranges:{}});var be=ye.glyphs[pe];if(be===void 0){if(be=p._tinySDF(ye,q,pe))return ye.glyphs[pe]=be,void G(null,{stack:q,id:pe,glyph:be});var qe=Math.floor(pe/256);if(256*qe>65535)G(new Error("glyphs > 65535 not supported"));else if(ye.ranges[qe])G(null,{stack:q,id:pe,glyph:be});else{var Ue=ye.requests[qe];Ue||(Ue=ye.requests[qe]=[],Dr.loadGlyphRange(q,qe,p.url,p.requestManager,function(ht,We){if(We){for(var nt in We)p._doesCharSupportLocalGlyph(+nt)||(ye.glyphs[+nt]=We[+nt]);ye.ranges[qe]=!0}for(var Mt=0,Pt=Ue;Mt<Pt.length;Mt+=1)(0,Pt[Mt])(ht,We);delete ye.requests[qe]})),Ue.push(function(ht,We){ht?G(ht):We&&G(null,{stack:q,id:pe,glyph:We[pe]||null})})}}else G(null,{stack:q,id:pe,glyph:be})},function(k,G){if(k)d(k);else if(G){for(var q={},pe=0,ye=G;pe<ye.length;pe+=1){var be=ye[pe],qe=be.stack,Ue=be.id,ht=be.glyph;(q[qe]||(q[qe]={}))[Ue]=ht&&{id:ht.id,bitmap:ht.bitmap.clone(),metrics:ht.metrics}}d(null,q)}})},Dr.prototype._doesCharSupportLocalGlyph=function(m){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](m)||v.isChar["Hangul Syllables"](m)||v.isChar.Hiragana(m)||v.isChar.Katakana(m))},Dr.prototype._tinySDF=function(m,d,p){var y=this.localIdeographFontFamily;if(y&&this._doesCharSupportLocalGlyph(p)){var A=m.tinySDF;if(!A){var w="400";/bold/i.test(d)?w="900":/medium/i.test(d)?w="500":/light/i.test(d)&&(w="200"),A=m.tinySDF=new Dr.TinySDF(24,3,8,.25,y,w)}return{id:p,bitmap:new v.AlphaImage({width:30,height:30},A.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Dr.loadGlyphRange=function(m,d,p,y,A){var w=256*d,M=w+255,k=y.transformRequest(y.normalizeGlyphsURL(p).replace("{fontstack}",m).replace("{range}",w+"-"+M),v.ResourceType.Glyphs);v.getArrayBuffer(k,function(G,q){if(G)A(G);else if(q){for(var pe={},ye=0,be=v.parseGlyphPBF(q);ye<be.length;ye+=1){var qe=be[ye];pe[qe.id]=qe}A(null,pe)}})},Dr.TinySDF=Ct;var Jt=function(){this.specification=v.styleSpec.light.position};Jt.prototype.possiblyEvaluate=function(m,d){return v.sphericalToCartesian(m.expression.evaluate(d))},Jt.prototype.interpolate=function(m,d,p){return{x:v.number(m.x,d.x,p),y:v.number(m.y,d.y,p),z:v.number(m.z,d.z,p)}};var Be=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new Jt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),Nt=function(m){function d(p){m.call(this),this._transitionable=new v.Transitionable(Be),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getLight=function(){return this._transitionable.serialize()},d.prototype.setLight=function(p,y){if(y===void 0&&(y={}),!this._validate(v.validateLight,p,y))for(var A in p){var w=p[A];v.endsWith(A,"-transition")?this._transitionable.setTransition(A.slice(0,-"-transition".length),w):this._transitionable.setValue(A,w)}},d.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},d.prototype.hasTransition=function(){return this._transitioning.hasTransition()},d.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},d.prototype._validate=function(p,y,A){return(!A||A.validate!==!1)&&v.emitValidationErrors(this,p.call(v.validateStyle,v.extend({value:y,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},d}(v.Evented),Gt=function(d,p){this.width=d,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Gt.prototype.getDash=function(m,d){var p=m.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(m,d)),this.dashEntry[p]},Gt.prototype.getDashRanges=function(m,d,p){var y=[],A=m.length%2==1?-m[m.length-1]*p:0,w=m[0]*p,M=!0;y.push({left:A,right:w,isDash:M,zeroLength:m[0]===0});for(var k=m[0],G=1;G<m.length;G++){var q=m[G];y.push({left:A=k*p,right:w=(k+=q)*p,isDash:M=!M,zeroLength:q===0})}return y},Gt.prototype.addRoundDash=function(m,d,p){for(var y=d/2,A=-p;A<=p;A++)for(var w=this.width*(this.nextRow+p+A),M=0,k=m[M],G=0;G<this.width;G++){G/k.right>1&&(k=m[++M]);var q=Math.abs(G-k.left),pe=Math.abs(G-k.right),ye=Math.min(q,pe),be=void 0,qe=A/p*(y+1);if(k.isDash){var Ue=y-Math.abs(qe);be=Math.sqrt(ye*ye+Ue*Ue)}else be=y-Math.sqrt(ye*ye+qe*qe);this.data[w+G]=Math.max(0,Math.min(255,be+128))}},Gt.prototype.addRegularDash=function(m){for(var d=m.length-1;d>=0;--d){var p=m[d],y=m[d+1];p.zeroLength?m.splice(d,1):y&&y.isDash===p.isDash&&(y.left=p.left,m.splice(d,1))}var A=m[0],w=m[m.length-1];A.isDash===w.isDash&&(A.left=w.left-this.width,w.right=A.right+this.width);for(var M=this.width*this.nextRow,k=0,G=m[k],q=0;q<this.width;q++){q/G.right>1&&(G=m[++k]);var pe=Math.abs(q-G.left),ye=Math.abs(q-G.right),be=Math.min(pe,ye);this.data[M+q]=Math.max(0,Math.min(255,(G.isDash?be:-be)+128))}},Gt.prototype.addDash=function(m,d){var p=d?7:0,y=2*p+1;if(this.nextRow+y>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var A=0,w=0;w<m.length;w++)A+=m[w];if(A!==0){var M=this.width/A,k=this.getDashRanges(m,this.width,M);d?this.addRoundDash(k,M,p):this.addRegularDash(k)}var G={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:A};return this.nextRow+=y,this.dirty=!0,G},Gt.prototype.bind=function(m){var d=m.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))};var Te=function m(d,p){this.workerPool=d,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var y=this.workerPool.acquire(this.id),A=0;A<y.length;A++){var w=new m.Actor(y[A],p,this.id);w.name="Worker "+A,this.actors.push(w)}};function me(m,d,p){var y=function(w,M){if(w)return p(w);if(M){var k=v.pick(v.extend(M,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(k.vectorLayers=M.vector_layers,k.vectorLayerIds=k.vectorLayers.map(function(G){return G.id})),k.tiles=d.canonicalizeTileset(k,m.url),p(null,k)}};return m.url?v.getJSON(d.transformRequest(d.normalizeSourceURL(m.url),v.ResourceType.Source),y):v.browser.frame(function(){return y(null,m)})}Te.prototype.broadcast=function(m,d,p){v.asyncAll(this.actors,function(y,A){y.send(m,d,A)},p=p||function(){})},Te.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Te.prototype.remove=function(){this.actors.forEach(function(m){m.remove()}),this.actors=[],this.workerPool.release(this.id)},Te.Actor=v.Actor;var Re=function(d,p,y){this.bounds=v.LngLatBounds.convert(this.validateBounds(d)),this.minzoom=p||0,this.maxzoom=y||24};Re.prototype.validateBounds=function(m){return Array.isArray(m)&&m.length===4?[Math.max(-180,m[0]),Math.max(-90,m[1]),Math.min(180,m[2]),Math.min(90,m[3])]:[-180,-90,180,90]},Re.prototype.contains=function(m){var d=Math.pow(2,m.z),p=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*d),y=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*d),A=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*d),w=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*d);return m.x>=p&&m.x<A&&m.y>=y&&m.y<w};var Ut=function(m){function d(p,y,A,w){if(m.call(this),this.id=p,this.dispatcher=A,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(y,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},y),this._collectResourceTiming=y.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=me(this._options,this.map._requestManager,function(y,A){p._tileJSONRequest=null,p._loaded=!0,y?p.fire(new v.ErrorEvent(y)):A&&(v.extend(p,A),A.bounds&&(p.tileBounds=new Re(A.bounds,p.minzoom,p.maxzoom)),v.postTurnstileEvent(A.tiles,p.map._requestManager._customAccessToken),v.postMapLoadEvent(A.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},d.prototype.setTiles=function(p){var y=this;return this.setSourceProperty(function(){y._options.tiles=p}),this},d.prototype.setUrl=function(p){var y=this;return this.setSourceProperty(function(){y.url=p,y._options.url=p}),this},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return v.extend({},this._options)},d.prototype.loadTile=function(p,y){var A=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(A,v.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(k,G){return delete p.request,p.aborted?y(null):k&&k.status!==404?y(k):(G&&G.resourceTiming&&(p.resourceTiming=G.resourceTiming),this.map._refreshExpiredTiles&&G&&p.setExpiryData(G),p.loadVectorData(G,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),y(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=y:p.request=p.actor.send("reloadTile",w,M.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",w,M.bind(this)))},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},d.prototype.hasTransition=function(){return!1},d}(v.Evented),ae=function(m){function d(p,y,A,w){m.call(this),this.id=p,this.dispatcher=A,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},y),v.extend(this,v.pick(y,["url","scheme","tileSize"]))}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=me(this._options,this.map._requestManager,function(y,A){p._tileJSONRequest=null,p._loaded=!0,y?p.fire(new v.ErrorEvent(y)):A&&(v.extend(p,A),A.bounds&&(p.tileBounds=new Re(A.bounds,p.minzoom,p.maxzoom)),v.postTurnstileEvent(A.tiles),v.postMapLoadEvent(A.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},d.prototype.loaded=function(){return this._loaded},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},d.prototype.serialize=function(){return v.extend({},this._options)},d.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},d.prototype.loadTile=function(p,y){var A=this,w=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=v.getImage(this.map._requestManager.transformRequest(w,v.ResourceType.Tile),function(M,k){if(delete p.request,p.aborted)p.state="unloaded",y(null);else if(M)p.state="errored",y(M);else if(k){A.map._refreshExpiredTiles&&p.setExpiryData(k),delete k.cacheControl,delete k.expires;var G=A.map.painter.context,q=G.gl;p.texture=A.map.painter.getTileTexture(k.width),p.texture?p.texture.update(k,{useMipmap:!0}):(p.texture=new v.Texture(G,k,q.RGBA,{useMipmap:!0}),p.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),G.extTextureFilterAnisotropic&&q.texParameterf(q.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax)),p.state="loaded",v.cacheEntryPossiblyAdded(A.dispatcher),y(null)}})},d.prototype.abortTile=function(p,y){p.request&&(p.request.cancel(),delete p.request),y()},d.prototype.unloadTile=function(p,y){p.texture&&this.map.painter.saveTileTexture(p.texture),y()},d.prototype.hasTransition=function(){return!1},d}(v.Evented),Ce=function(m){function d(p,y,A,w){m.call(this,p,y,A,w),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},y),this.encoding=y.encoding||"mapbox"}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},d.prototype.loadTile=function(p,y){var A=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(M,k){M&&(p.state="errored",y(M)),k&&(p.dem=k,p.needsHillshadePrepare=!0,p.state="loaded",y(null))}p.request=v.getImage(this.map._requestManager.transformRequest(A,v.ResourceType.Tile),function(M,k){if(delete p.request,p.aborted)p.state="unloaded",y(null);else if(M)p.state="errored",y(M);else if(k){this.map._refreshExpiredTiles&&p.setExpiryData(k),delete k.cacheControl,delete k.expires;var G=v.window.ImageBitmap&&k instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?k:v.browser.getImageData(k,1),q={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:G,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",q,w.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},d.prototype._getNeighboringTiles=function(p){var y=p.canonical,A=Math.pow(2,y.z),w=(y.x-1+A)%A,M=y.x===0?p.wrap-1:p.wrap,k=(y.x+1+A)%A,G=y.x+1===A?p.wrap+1:p.wrap,q={};return q[new v.OverscaledTileID(p.overscaledZ,M,y.z,w,y.y).key]={backfilled:!1},q[new v.OverscaledTileID(p.overscaledZ,G,y.z,k,y.y).key]={backfilled:!1},y.y>0&&(q[new v.OverscaledTileID(p.overscaledZ,M,y.z,w,y.y-1).key]={backfilled:!1},q[new v.OverscaledTileID(p.overscaledZ,p.wrap,y.z,y.x,y.y-1).key]={backfilled:!1},q[new v.OverscaledTileID(p.overscaledZ,G,y.z,k,y.y-1).key]={backfilled:!1}),y.y+1<A&&(q[new v.OverscaledTileID(p.overscaledZ,M,y.z,w,y.y+1).key]={backfilled:!1},q[new v.OverscaledTileID(p.overscaledZ,p.wrap,y.z,y.x,y.y+1).key]={backfilled:!1},q[new v.OverscaledTileID(p.overscaledZ,G,y.z,k,y.y+1).key]={backfilled:!1}),q},d.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},d}(ae),Ae=function(m){function d(p,y,A,w){m.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=A.getActor(),this.setEventedParent(w),this._data=y.data,this._options=v.extend({},y),this._collectResourceTiming=y.collectResourceTiming,this._resourceTiming=[],y.maxzoom!==void 0&&(this.maxzoom=y.maxzoom),y.type&&(this.type=y.type),y.attribution&&(this.attribution=y.attribution),this.promoteId=y.promoteId;var M=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:y.cluster||!1,geojsonVtOptions:{buffer:(y.buffer!==void 0?y.buffer:128)*M,tolerance:(y.tolerance!==void 0?y.tolerance:.375)*M,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:y.lineMetrics||!1,generateId:y.generateId||!1},superclusterOptions:{maxZoom:y.clusterMaxZoom!==void 0?Math.min(y.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,y.clusterMinPoints||2),extent:v.EXTENT,radius:(y.clusterRadius||50)*M,log:!1,generateId:y.generateId||!1},clusterProperties:y.clusterProperties,filter:y.filter},y.workerOptions)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var p=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)p.fire(new v.ErrorEvent(y));else{var A={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(A.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new v.Event("data",A))}})},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setData=function(p){var y=this;return this._data=p,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(A){if(A)y.fire(new v.ErrorEvent(A));else{var w={dataType:"source",sourceDataType:"content"};y._collectResourceTiming&&y._resourceTiming&&y._resourceTiming.length>0&&(w.resourceTiming=y._resourceTiming,y._resourceTiming=[]),y.fire(new v.Event("data",w))}}),this},d.prototype.getClusterExpansionZoom=function(p,y){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},y),this},d.prototype.getClusterChildren=function(p,y){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},y),this},d.prototype.getClusterLeaves=function(p,y,A,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:y,offset:A},w),this},d.prototype._updateWorkerData=function(p){var y=this;this._loaded=!1;var A=v.extend({},this.workerOptions),w=this._data;typeof w=="string"?(A.request=this.map._requestManager.transformRequest(v.browser.resolveURL(w),v.ResourceType.Source),A.request.collectResourceTiming=this._collectResourceTiming):A.data=JSON.stringify(w),this.actor.send(this.type+".loadData",A,function(M,k){y._removed||k&&k.abandoned||(y._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[y.id]&&(y._resourceTiming=k.resourceTiming[y.id].slice(0)),y.actor.send(y.type+".coalesce",{source:A.source},null),p(M))})},d.prototype.loaded=function(){return this._loaded},d.prototype.loadTile=function(p,y){var A=this,w=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(w,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,k){return delete p.request,p.unloadVectorData(),p.aborted?y(null):M?y(M):(p.loadVectorData(k,A.map.painter,w==="reloadTile"),y(null))})},d.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},d.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},d.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},d.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},d.prototype.hasTransition=function(){return!1},d}(v.Evented),vt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),At=function(m){function d(p,y,A,w){m.call(this),this.id=p,this.dispatcher=A,this.coordinates=y.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(p,y){var A=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(w,M){A._loaded=!0,w?A.fire(new v.ErrorEvent(w)):M&&(A.image=M,p&&(A.coordinates=p),y&&y(),A._finishLoading())})},d.prototype.loaded=function(){return this._loaded},d.prototype.updateImage=function(p){var y=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){y.texture=null}),this):this},d.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},d.prototype.onAdd=function(p){this.map=p,this.load()},d.prototype.setCoordinates=function(p){var y=this;this.coordinates=p;var A=p.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var k=1/0,G=1/0,q=-1/0,pe=-1/0,ye=0,be=M;ye<be.length;ye+=1){var qe=be[ye];k=Math.min(k,qe.x),G=Math.min(G,qe.y),q=Math.max(q,qe.x),pe=Math.max(pe,qe.y)}var Ue=Math.max(q-k,pe-G),ht=Math.max(0,Math.floor(-Math.log(Ue)/Math.LN2)),We=Math.pow(2,ht);return new v.CanonicalTileID(ht,Math.floor((k+q)/2*We),Math.floor((G+pe)/2*We))}(A),this.minzoom=this.maxzoom=this.tileID.z;var w=A.map(function(M){return y.tileID.getTilePoint(M)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},d.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,y=p.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(p,this.image,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[A];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},d.prototype.loadTile=function(p,y){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},y(null)):(p.state="errored",y(null))},d.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return!1},d}(v.Evented),Bt=function(m){function d(p,y,A,w){m.call(this,p,y,A,w),this.roundZoom=!0,this.type="video",this.options=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){var p=this;this._loaded=!1;var y=this.options;this.urls=[];for(var A=0,w=y.urls;A<w.length;A+=1)this.urls.push(this.map._requestManager.transformRequest(w[A],v.ResourceType.Source).url);v.getVideo(this.urls,function(M,k){p._loaded=!0,M?p.fire(new v.ErrorEvent(M)):k&&(p.video=k,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},d.prototype.pause=function(){this.video&&this.video.pause()},d.prototype.play=function(){this.video&&this.video.play()},d.prototype.seek=function(p){if(this.video){var y=this.video.seekable;p<y.start(0)||p>y.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+y.start(0)+" and "+y.end(0)+"-second mark."))):this.video.currentTime=p}},d.prototype.getVideo=function(){return this.video},d.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},d.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,y=p.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE),y.texSubImage2D(y.TEXTURE_2D,0,0,0,y.RGBA,y.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(p,this.video,y.RGBA),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[A];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this.video&&!this.video.paused},d}(At),Ft=function(m){function d(p,y,A,w){m.call(this,p,y,A,w),y.coordinates?Array.isArray(y.coordinates)&&y.coordinates.length===4&&!y.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(k){return typeof k!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+p,null,'missing required property "coordinates"'))),y.animate&&typeof y.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),y.canvas?typeof y.canvas=="string"||y.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=y,this.animate=y.animate===void 0||y.animate}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},d.prototype.getCanvas=function(){return this.canvas},d.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},d.prototype.onRemove=function(){this.pause()},d.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var y=this.map.painter.context,A=y.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=y.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(y,this.canvas,A.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[w];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},d.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},d.prototype.hasTransition=function(){return this._playing},d.prototype._hasInvalidDimensions=function(){for(var p=0,y=[this.canvas.width,this.canvas.height];p<y.length;p+=1){var A=y[p];if(isNaN(A)||A<=0)return!0}return!1},d}(At),fr={vector:Ut,raster:ae,"raster-dem":Ce,geojson:Ae,video:Bt,image:At,canvas:Ft};function Tr(m,d){var p=v.identity([]);return v.translate(p,p,[1,1,0]),v.scale(p,p,[.5*m.width,.5*m.height,1]),v.multiply(p,p,m.calculatePosMatrix(d.toUnwrapped()))}function Br(m,d,p,y,A,w){var M=function(ht,We,nt){if(ht)for(var Mt=0,Pt=ht;Mt<Pt.length;Mt+=1){var vr=We[Pt[Mt]];if(vr&&vr.source===nt&&vr.type==="fill-extrusion")return!0}else for(var rr in We){var br=We[rr];if(br.source===nt&&br.type==="fill-extrusion")return!0}return!1}(A&&A.layers,d,m.id),k=w.maxPitchScaleFactor(),G=m.tilesIn(y,k,M);G.sort(On);for(var q=[],pe=0,ye=G;pe<ye.length;pe+=1){var be=ye[pe];q.push({wrappedTileID:be.tileID.wrapped().key,queryResults:be.tile.queryRenderedFeatures(d,p,m._state,be.queryGeometry,be.cameraQueryGeometry,be.scale,A,w,k,Tr(m.transform,be.tileID))})}var qe=function(ht){for(var We={},nt={},Mt=0,Pt=ht;Mt<Pt.length;Mt+=1){var vr=Pt[Mt],rr=vr.queryResults,br=vr.wrappedTileID,wr=nt[br]=nt[br]||{};for(var $r in rr)for(var Qr=rr[$r],_n=wr[$r]=wr[$r]||{},Ln=We[$r]=We[$r]||[],si=0,hi=Qr;si<hi.length;si+=1){var Wi=hi[si];_n[Wi.featureIndex]||(_n[Wi.featureIndex]=!0,Ln.push(Wi))}}return We}(q);for(var Ue in qe)qe[Ue].forEach(function(ht){var We=ht.feature,nt=m.getFeatureState(We.layer["source-layer"],We.id);We.source=We.layer.source,We.layer["source-layer"]&&(We.sourceLayer=We.layer["source-layer"]),We.state=nt});return qe}function On(m,d){var p=m.tileID,y=d.tileID;return p.overscaledZ-y.overscaledZ||p.canonical.y-y.canonical.y||p.wrap-y.wrap||p.canonical.x-y.canonical.x}var Fr=function(d,p){this.max=d,this.onRemove=p,this.reset()};Fr.prototype.reset=function(){for(var m in this.data)for(var d=0,p=this.data[m];d<p.length;d+=1){var y=p[d];y.timeout&&clearTimeout(y.timeout),this.onRemove(y.value)}return this.data={},this.order=[],this},Fr.prototype.add=function(m,d,p){var y=this,A=m.wrapped().key;this.data[A]===void 0&&(this.data[A]=[]);var w={value:d,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(function(){y.remove(m,w)},p)),this.data[A].push(w),this.order.push(A),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Fr.prototype.has=function(m){return m.wrapped().key in this.data},Fr.prototype.getAndRemove=function(m){return this.has(m)?this._getAndRemoveByKey(m.wrapped().key):null},Fr.prototype._getAndRemoveByKey=function(m){var d=this.data[m].shift();return d.timeout&&clearTimeout(d.timeout),this.data[m].length===0&&delete this.data[m],this.order.splice(this.order.indexOf(m),1),d.value},Fr.prototype.getByKey=function(m){var d=this.data[m];return d?d[0].value:null},Fr.prototype.get=function(m){return this.has(m)?this.data[m.wrapped().key][0].value:null},Fr.prototype.remove=function(m,d){if(!this.has(m))return this;var p=m.wrapped().key,y=d===void 0?0:this.data[p].indexOf(d),A=this.data[p][y];return this.data[p].splice(y,1),A.timeout&&clearTimeout(A.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(A.value),this.order.splice(this.order.indexOf(p),1),this},Fr.prototype.setMaxSize=function(m){for(this.max=m;this.order.length>this.max;){var d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this},Fr.prototype.filter=function(m){var d=[];for(var p in this.data)for(var y=0,A=this.data[p];y<A.length;y+=1){var w=A[y];m(w.value)||d.push(w)}for(var M=0,k=d;M<k.length;M+=1){var G=k[M];this.remove(G.value.tileID,G)}};var Hn=function(d,p,y){this.context=d;var A=d.gl;this.buffer=A.createBuffer(),this.dynamicDraw=Boolean(y),this.context.unbindVAO(),d.bindElementBuffer.set(this.buffer),A.bufferData(A.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};Hn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Hn.prototype.updateData=function(m){var d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,m.arrayBuffer)},Hn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ni={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Yn=function(d,p,y,A){this.length=p.length,this.attributes=y,this.itemSize=p.bytesPerElement,this.dynamicDraw=A,this.context=d;var w=d.gl;this.buffer=w.createBuffer(),d.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer};Yn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Yn.prototype.updateData=function(m){var d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,m.arrayBuffer)},Yn.prototype.enableAttributes=function(m,d){for(var p=0;p<this.attributes.length;p++){var y=d.attributes[this.attributes[p].name];y!==void 0&&m.enableVertexAttribArray(y)}},Yn.prototype.setVertexAttribPointers=function(m,d,p){for(var y=0;y<this.attributes.length;y++){var A=this.attributes[y],w=d.attributes[A.name];w!==void 0&&m.vertexAttribPointer(w,A.components,m[ni[A.type]],!1,this.itemSize,A.offset+this.itemSize*(p||0))}},Yn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ei=function(d){this.gl=d.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ei.prototype.get=function(){return this.current},ei.prototype.set=function(m){},ei.prototype.getDefault=function(){return this.default},ei.prototype.setDefault=function(){this.set(this.default)};var ci=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return v.Color.transparent},d.prototype.set=function(p){var y=this.current;(p.r!==y.r||p.g!==y.g||p.b!==y.b||p.a!==y.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(ei),Sr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 1},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},d}(ei),_r=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},d}(ei),Kt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return[!0,!0,!0,!0]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||p[3]!==y[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(ei),Wt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},d}(ei),Ir=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 255},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},d}(ei),je=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},d.prototype.set=function(p){var y=this.current;(p.func!==y.func||p.ref!==y.ref||p.mask!==y.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},d}(ei),oe=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},d}(ei),ne=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST),this.current=p,this.dirty=!1}},d}(ei),D=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return[0,1]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},d}(ei),Ee=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST),this.current=p,this.dirty=!1}},d}(ei),He=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.LESS},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},d}(ei),xt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.BLEND):y.disable(y.BLEND),this.current=p,this.dirty=!1}},d}(ei),er=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},d}(ei),ur=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return v.Color.transparent},d.prototype.set=function(p){var y=this.current;(p.r!==y.r||p.g!==y.g||p.b!==y.b||p.a!==y.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},d}(ei),tt=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.FUNC_ADD},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},d}(ei),It=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;p?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE),this.current=p,this.dirty=!1}},d}(ei),or=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.BACK},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},d}(ei),Cr=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.CCW},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},d}(ei),Or=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},d}(ei),Nn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return this.gl.TEXTURE0},d.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},d}(ei),sn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},d.prototype.set=function(p){var y=this.current;(p[0]!==y[0]||p[1]!==y[1]||p[2]!==y[2]||p[3]!==y[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},d}(ei),gn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindFramebuffer(y.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},d}(ei),dn=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindRenderbuffer(y.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(ei),ri=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindTexture(y.TEXTURE_2D,p),this.current=p,this.dirty=!1}},d}(ei),mi=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.bindBuffer(y.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},d}(ei),ki=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){var y=this.gl;y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},d}(ei),Aa=function(m){function d(p){m.call(this,p),this.vao=p.extVertexArrayObject}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},d}(ei),Pa=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return 4},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},d}(ei),Co=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},d}(ei),yo=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return!1},d.prototype.set=function(p){if(p!==this.current||this.dirty){var y=this.gl;y.pixelStorei(y.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},d}(ei),Mi=function(m){function d(p,y){m.call(this,p),this.context=p,this.parent=y}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getDefault=function(){return null},d}(ei),te=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.setDirty=function(){this.dirty=!0},d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},d}(Mi),K=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var y=this.gl;y.framebufferRenderbuffer(y.FRAMEBUFFER,y.DEPTH_ATTACHMENT,y.RENDERBUFFER,p),this.current=p,this.dirty=!1}},d}(Mi),fe=function(d,p,y,A){this.context=d,this.width=p,this.height=y;var w=this.framebuffer=d.gl.createFramebuffer();this.colorAttachment=new te(d,w),A&&(this.depthAttachment=new K(d,w))};fe.prototype.destroy=function(){var m=this.context.gl,d=this.colorAttachment.get();if(d&&m.deleteTexture(d),this.depthAttachment){var p=this.depthAttachment.get();p&&m.deleteRenderbuffer(p)}m.deleteFramebuffer(this.framebuffer)};var Se=function(d,p,y){this.func=d,this.mask=p,this.range=y};Se.ReadOnly=!1,Se.ReadWrite=!0,Se.disabled=new Se(519,Se.ReadOnly,[0,1]);var Le=function(d,p,y,A,w,M){this.test=d,this.ref=p,this.mask=y,this.fail=A,this.depthFail=w,this.pass=M};Le.disabled=new Le({func:519,mask:0},0,0,7680,7680,7680);var mt=function(d,p,y){this.blendFunction=d,this.blendColor=p,this.mask=y};mt.disabled=new mt(mt.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),mt.unblended=new mt(mt.Replace,v.Color.transparent,[!0,!0,!0,!0]),mt.alphaBlended=new mt([1,771],v.Color.transparent,[!0,!0,!0,!0]);var St=function(d,p,y){this.enable=d,this.mode=p,this.frontFace=y};St.disabled=new St(!1,1029,2305),St.backCCW=new St(!0,1029,2305);var ge=function(d){this.gl=d,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ci(this),this.clearDepth=new Sr(this),this.clearStencil=new _r(this),this.colorMask=new Kt(this),this.depthMask=new Wt(this),this.stencilMask=new Ir(this),this.stencilFunc=new je(this),this.stencilOp=new oe(this),this.stencilTest=new ne(this),this.depthRange=new D(this),this.depthTest=new Ee(this),this.depthFunc=new He(this),this.blend=new xt(this),this.blendFunc=new er(this),this.blendColor=new ur(this),this.blendEquation=new tt(this),this.cullFace=new It(this),this.cullFaceSide=new or(this),this.frontFace=new Cr(this),this.program=new Or(this),this.activeTexture=new Nn(this),this.viewport=new sn(this),this.bindFramebuffer=new gn(this),this.bindRenderbuffer=new dn(this),this.bindTexture=new ri(this),this.bindVertexBuffer=new mi(this),this.bindElementBuffer=new ki(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Aa(this),this.pixelStoreUnpack=new Pa(this),this.pixelStoreUnpackPremultiplyAlpha=new Co(this),this.pixelStoreUnpackFlipY=new yo(this),this.extTextureFilterAnisotropic=d.getExtension("EXT_texture_filter_anisotropic")||d.getExtension("MOZ_EXT_texture_filter_anisotropic")||d.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=d.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=d.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(d.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=d.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=d.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE)};ge.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ge.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ge.prototype.createIndexBuffer=function(m,d){return new Hn(this,m,d)},ge.prototype.createVertexBuffer=function(m,d,p){return new Yn(this,m,d,p)},ge.prototype.createRenderbuffer=function(m,d,p){var y=this.gl,A=y.createRenderbuffer();return this.bindRenderbuffer.set(A),y.renderbufferStorage(y.RENDERBUFFER,m,d,p),this.bindRenderbuffer.set(null),A},ge.prototype.createFramebuffer=function(m,d,p){return new fe(this,m,d,p)},ge.prototype.clear=function(m){var d=m.color,p=m.depth,y=this.gl,A=0;d&&(A|=y.COLOR_BUFFER_BIT,this.clearColor.set(d),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(A|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),y.clear(A)},ge.prototype.setCullFace=function(m){m.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(m.mode),this.frontFace.set(m.frontFace))},ge.prototype.setDepthMode=function(m){m.func!==this.gl.ALWAYS||m.mask?(this.depthTest.set(!0),this.depthFunc.set(m.func),this.depthMask.set(m.mask),this.depthRange.set(m.range)):this.depthTest.set(!1)},ge.prototype.setStencilMode=function(m){m.test.func!==this.gl.ALWAYS||m.mask?(this.stencilTest.set(!0),this.stencilMask.set(m.mask),this.stencilOp.set([m.fail,m.depthFail,m.pass]),this.stencilFunc.set({func:m.test.func,ref:m.ref,mask:m.test.mask})):this.stencilTest.set(!1)},ge.prototype.setColorMode=function(m){v.deepEqual(m.blendFunction,mt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(m.blendFunction),this.blendColor.set(m.blendColor)),this.colorMask.set(m.mask)},ge.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ye=function(m){function d(p,y,A){var w=this;m.call(this),this.id=p,this.dispatcher=A,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(M,k,G,q){var pe=new fr[k.type](M,k,G,q);if(pe.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+pe.id);return v.bindAll(["load","abort","unload","serialize","prepare"],pe),pe}(p,y,A,this),this._tiles={},this._cache=new Fr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},d.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},d.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var y=this._tiles[p];if(y.state!=="loaded"&&y.state!=="errored")return!1}return!0},d.prototype.getSource=function(){return this._source},d.prototype.pause=function(){this._paused=!0},d.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},d.prototype._loadTile=function(p,y){return this._source.loadTile(p,y)},d.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},d.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},d.prototype.serialize=function(){return this._source.serialize()},d.prototype.prepare=function(p){for(var y in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var A=this._tiles[y];A.upload(p),A.prepare(this.map.style.imageManager)}},d.prototype.getIds=function(){return v.values(this._tiles).map(function(p){return p.tileID}).sort(zt).map(function(p){return p.key})},d.prototype.getRenderableIds=function(p){var y=this,A=[];for(var w in this._tiles)this._isIdRenderable(w,p)&&A.push(this._tiles[w]);return p?A.sort(function(M,k){var G=M.tileID,q=k.tileID,pe=new v.Point(G.canonical.x,G.canonical.y)._rotate(y.transform.angle),ye=new v.Point(q.canonical.x,q.canonical.y)._rotate(y.transform.angle);return G.overscaledZ-q.overscaledZ||ye.y-pe.y||ye.x-pe.x}).map(function(M){return M.tileID.key}):A.map(function(M){return M.tileID}).sort(zt).map(function(M){return M.key})},d.prototype.hasRenderableParent=function(p){var y=this.findLoadedParent(p,0);return!!y&&this._isIdRenderable(y.tileID.key)},d.prototype._isIdRenderable=function(p,y){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(y||!this._tiles[p].holdingForFade())},d.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},d.prototype._reloadTile=function(p,y){var A=this._tiles[p];A&&(A.state!=="loading"&&(A.state=y),this._loadTile(A,this._tileLoaded.bind(this,A,p,y)))},d.prototype._tileLoaded=function(p,y,A,w){if(w)return p.state="errored",void(w.status!==404?this._source.fire(new v.ErrorEvent(w,{tile:p})):this.update(this.transform));p.timeAdded=v.browser.now(),A==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(y,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},d.prototype._backfillDEM=function(p){for(var y=this.getRenderableIds(),A=0;A<y.length;A++){var w=y[A];if(p.neighboringTiles&&p.neighboringTiles[w]){var M=this.getTileByID(w);k(p,M),k(M,p)}}function k(G,q){G.needsHillshadePrepare=!0;var pe=q.tileID.canonical.x-G.tileID.canonical.x,ye=q.tileID.canonical.y-G.tileID.canonical.y,be=Math.pow(2,G.tileID.canonical.z),qe=q.tileID.key;pe===0&&ye===0||Math.abs(ye)>1||(Math.abs(pe)>1&&(Math.abs(pe+be)===1?pe+=be:Math.abs(pe-be)===1&&(pe-=be)),q.dem&&G.dem&&(G.dem.backfillBorder(q.dem,pe,ye),G.neighboringTiles&&G.neighboringTiles[qe]&&(G.neighboringTiles[qe].backfilled=!0)))}},d.prototype.getTile=function(p){return this.getTileByID(p.key)},d.prototype.getTileByID=function(p){return this._tiles[p]},d.prototype._retainLoadedChildren=function(p,y,A,w){for(var M in this._tiles){var k=this._tiles[M];if(!(w[M]||!k.hasData()||k.tileID.overscaledZ<=y||k.tileID.overscaledZ>A)){for(var G=k.tileID;k&&k.tileID.overscaledZ>y+1;){var q=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[q.key])&&k.hasData()&&(G=q)}for(var pe=G;pe.overscaledZ>y;)if(p[(pe=pe.scaledTo(pe.overscaledZ-1)).key]){w[G.key]=G;break}}}},d.prototype.findLoadedParent=function(p,y){if(p.key in this._loadedParentTiles){var A=this._loadedParentTiles[p.key];return A&&A.tileID.overscaledZ>=y?A:null}for(var w=p.overscaledZ-1;w>=y;w--){var M=p.scaledTo(w),k=this._getLoadedTile(M);if(k)return k}},d.prototype._getLoadedTile=function(p){var y=this._tiles[p.key];return y&&y.hasData()?y:this._cache.getByKey(p.wrapped().key)},d.prototype.updateCacheSize=function(p){var y=Math.ceil(p.width/this._source.tileSize)+1,A=Math.ceil(p.height/this._source.tileSize)+1,w=Math.floor(y*A*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(M)},d.prototype.handleWrapJump=function(p){var y=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,y){var A={};for(var w in this._tiles){var M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+y),A[M.tileID.key]=M}for(var k in this._tiles=A,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var G in this._tiles)this._setTileReloadTimer(G,this._tiles[G])}},d.prototype.update=function(p){var y=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var A;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?A=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(wr){return new v.OverscaledTileID(wr.canonical.z,wr.wrap,wr.canonical.z,wr.canonical.x,wr.canonical.y)}):(A=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(A=A.filter(function(wr){return y._source.hasTile(wr)}))):A=[];var w=p.coveringZoomLevel(this._source),M=Math.max(w-d.maxOverzooming,this._source.minzoom),k=Math.max(w+d.maxUnderzooming,this._source.minzoom),G=this._updateRetainedTiles(A,w);if(Rr(this._source.type)){for(var q={},pe={},ye=0,be=Object.keys(G);ye<be.length;ye+=1){var qe=be[ye],Ue=G[qe],ht=this._tiles[qe];if(ht&&!(ht.fadeEndTime&&ht.fadeEndTime<=v.browser.now())){var We=this.findLoadedParent(Ue,M);We&&(this._addTile(We.tileID),q[We.tileID.key]=We.tileID),pe[qe]=Ue}}for(var nt in this._retainLoadedChildren(pe,w,k,G),q)G[nt]||(this._coveredTiles[nt]=!0,G[nt]=q[nt])}for(var Mt in G)this._tiles[Mt].clearFadeHold();for(var Pt=0,vr=v.keysDifference(this._tiles,G);Pt<vr.length;Pt+=1){var rr=vr[Pt],br=this._tiles[rr];br.hasSymbolBuckets&&!br.holdingForFade()?br.setHoldDuration(this.map._fadeDuration):br.hasSymbolBuckets&&!br.symbolFadeFinished()||this._removeTile(rr)}this._updateLoadedParentTileCache()}},d.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},d.prototype._updateRetainedTiles=function(p,y){for(var A={},w={},M=Math.max(y-d.maxOverzooming,this._source.minzoom),k=Math.max(y+d.maxUnderzooming,this._source.minzoom),G={},q=0,pe=p;q<pe.length;q+=1){var ye=pe[q],be=this._addTile(ye);A[ye.key]=ye,be.hasData()||y<this._source.maxzoom&&(G[ye.key]=ye)}this._retainLoadedChildren(G,y,k,A);for(var qe=0,Ue=p;qe<Ue.length;qe+=1){var ht=Ue[qe],We=this._tiles[ht.key];if(!We.hasData()){if(y+1>this._source.maxzoom){var nt=ht.children(this._source.maxzoom)[0],Mt=this.getTile(nt);if(Mt&&Mt.hasData()){A[nt.key]=nt;continue}}else{var Pt=ht.children(this._source.maxzoom);if(A[Pt[0].key]&&A[Pt[1].key]&&A[Pt[2].key]&&A[Pt[3].key])continue}for(var vr=We.wasRequested(),rr=ht.overscaledZ-1;rr>=M;--rr){var br=ht.scaledTo(rr);if(w[br.key]||(w[br.key]=!0,!(We=this.getTile(br))&&vr&&(We=this._addTile(br)),We&&(A[br.key]=br,vr=We.wasRequested(),We.hasData())))break}}}return A},d.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var y=[],A=void 0,w=this._tiles[p].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){A=this._loadedParentTiles[w.key];break}y.push(w.key);var M=w.scaledTo(w.overscaledZ-1);if(A=this._getLoadedTile(M))break;w=M}for(var k=0,G=y;k<G.length;k+=1)this._loadedParentTiles[G[k]]=A}},d.prototype._addTile=function(p){var y=this._tiles[p.key];if(y)return y;(y=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,y),y.tileID=p,this._state.initializeTileState(y,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,y)));var A=Boolean(y);return A||(y=new v.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(y,this._tileLoaded.bind(this,y,p.key,y.state))),y?(y.uses++,this._tiles[p.key]=y,A||this._source.fire(new v.Event("dataloading",{tile:y,coord:y.tileID,dataType:"source"})),y):null},d.prototype._setTileReloadTimer=function(p,y){var A=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var w=y.getExpiryTimeout();w&&(this._timers[p]=setTimeout(function(){A._reloadTile(p,"expired"),delete A._timers[p]},w))},d.prototype._removeTile=function(p){var y=this._tiles[p];y&&(y.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),y.uses>0||(y.hasData()&&y.state!=="reloading"?this._cache.add(y.tileID,y,y.getExpiryTimeout()):(y.aborted=!0,this._abortTile(y),this._unloadTile(y))))},d.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},d.prototype.tilesIn=function(p,y,A){var w=this,M=[],k=this.transform;if(!k)return M;for(var G=A?k.getCameraQueryGeometry(p):p,q=p.map(function(rr){return k.pointCoordinate(rr)}),pe=G.map(function(rr){return k.pointCoordinate(rr)}),ye=this.getIds(),be=1/0,qe=1/0,Ue=-1/0,ht=-1/0,We=0,nt=pe;We<nt.length;We+=1){var Mt=nt[We];be=Math.min(be,Mt.x),qe=Math.min(qe,Mt.y),Ue=Math.max(Ue,Mt.x),ht=Math.max(ht,Mt.y)}for(var Pt=function(br){var wr=w._tiles[ye[br]];if(!wr.holdingForFade()){var $r=wr.tileID,Qr=Math.pow(2,k.zoom-wr.tileID.overscaledZ),_n=y*wr.queryPadding*v.EXTENT/wr.tileSize/Qr,Ln=[$r.getTilePoint(new v.MercatorCoordinate(be,qe)),$r.getTilePoint(new v.MercatorCoordinate(Ue,ht))];if(Ln[0].x-_n<v.EXTENT&&Ln[0].y-_n<v.EXTENT&&Ln[1].x+_n>=0&&Ln[1].y+_n>=0){var si=q.map(function(Wi){return $r.getTilePoint(Wi)}),hi=pe.map(function(Wi){return $r.getTilePoint(Wi)});M.push({tile:wr,tileID:$r,queryGeometry:si,cameraQueryGeometry:hi,scale:Qr})}}},vr=0;vr<ye.length;vr++)Pt(vr);return M},d.prototype.getVisibleCoordinates=function(p){for(var y=this,A=this.getRenderableIds(p).map(function(G){return y._tiles[G].tileID}),w=0,M=A;w<M.length;w+=1){var k=M[w];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return A},d.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Rr(this._source.type))for(var p in this._tiles){var y=this._tiles[p];if(y.fadeEndTime!==void 0&&y.fadeEndTime>=v.browser.now())return!0}return!1},d.prototype.setFeatureState=function(p,y,A){this._state.updateState(p=p||"_geojsonTileLayer",y,A)},d.prototype.removeFeatureState=function(p,y,A){this._state.removeFeatureState(p=p||"_geojsonTileLayer",y,A)},d.prototype.getFeatureState=function(p,y){return this._state.getState(p=p||"_geojsonTileLayer",y)},d.prototype.setDependencies=function(p,y,A){var w=this._tiles[p];w&&w.setDependencies(y,A)},d.prototype.reloadTilesForDependencies=function(p,y){for(var A in this._tiles)this._tiles[A].hasDependency(p,y)&&this._reloadTile(A,"reloading");this._cache.filter(function(w){return!w.hasDependency(p,y)})},d}(v.Evented);function zt(m,d){var p=Math.abs(2*m.wrap)-+(m.wrap<0),y=Math.abs(2*d.wrap)-+(d.wrap<0);return m.overscaledZ-d.overscaledZ||y-p||d.canonical.y-m.canonical.y||d.canonical.x-m.canonical.x}function Rr(m){return m==="raster"||m==="image"||m==="video"}function Nr(){return new v.window.Worker(dh.workerUrl)}Ye.maxOverzooming=10,Ye.maxUnderzooming=3;var pr="mapboxgl_preloaded_worker_pool",Wr=function(){this.active={}};Wr.prototype.acquire=function(m){if(!this.workers)for(this.workers=[];this.workers.length<Wr.workerCount;)this.workers.push(new Nr);return this.active[m]=!0,this.workers.slice()},Wr.prototype.release=function(m){delete this.active[m],this.numActive()===0&&(this.workers.forEach(function(d){d.terminate()}),this.workers=null)},Wr.prototype.isPreloaded=function(){return!!this.active[pr]},Wr.prototype.numActive=function(){return Object.keys(this.active).length};var Gn,wn=Math.floor(v.browser.hardwareConcurrency/2);function dr(){return Gn||(Gn=new Wr),Gn}function Sn(m,d){var p={};for(var y in m)y!=="ref"&&(p[y]=m[y]);return v.refProperties.forEach(function(A){A in d&&(p[A]=d[A])}),p}function bn(m){m=m.slice();for(var d=Object.create(null),p=0;p<m.length;p++)d[m[p].id]=m[p];for(var y=0;y<m.length;y++)"ref"in m[y]&&(m[y]=Sn(m[y],d[m[y].ref]));return m}Wr.workerCount=Math.max(Math.min(wn,6),1);var we={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Kn(m,d,p){p.push({command:we.addSource,args:[m,d[m]]})}function xn(m,d,p){d.push({command:we.removeSource,args:[m]}),p[m]=!0}function Vi(m,d,p,y){xn(m,p,y),Kn(m,d,p)}function ia(m,d,p){var y;for(y in m[p])if(m[p].hasOwnProperty(y)&&y!=="data"&&!v.deepEqual(m[p][y],d[p][y]))return!1;for(y in d[p])if(d[p].hasOwnProperty(y)&&y!=="data"&&!v.deepEqual(m[p][y],d[p][y]))return!1;return!0}function bi(m,d,p,y,A,w){var M;for(M in d=d||{},m=m||{})m.hasOwnProperty(M)&&(v.deepEqual(m[M],d[M])||p.push({command:w,args:[y,M,d[M],A]}));for(M in d)d.hasOwnProperty(M)&&!m.hasOwnProperty(M)&&(v.deepEqual(m[M],d[M])||p.push({command:w,args:[y,M,d[M],A]}))}function ta(m){return m.id}function Ni(m,d){return m[d.id]=d,m}var ns=function(d,p){this.reset(d,p)};ns.prototype.reset=function(m,d){this.points=m||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ns.prototype.lerp=function(m){if(this.points.length===1)return this.points[0];m=v.clamp(m,0,1);for(var d=1,p=this._distances[d],y=m*this.paddedLength+this.padding;p<y&&d<this._distances.length;)p=this._distances[++d];var A=d-1,w=this._distances[A],M=p-w,k=M>0?(y-w)/M:0;return this.points[A].mult(1-k).add(this.points[d].mult(k))};var wi=function(d,p,y){var A=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(d/y),this.yCellCount=Math.ceil(p/y);for(var M=0;M<this.xCellCount*this.yCellCount;M++)A.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=d,this.height=p,this.xScale=this.xCellCount/d,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0};function Xa(m,d,p,y,A){var w=v.create();return d?(v.scale(w,w,[1/A,1/A,1]),p||v.rotateZ(w,w,y.angle)):v.multiply(w,y.labelPlaneMatrix,m),w}function Hi(m,d,p,y,A){if(d){var w=v.clone(m);return v.scale(w,w,[A,A,1]),p||v.rotateZ(w,w,-y.angle),w}return y.glCoordMatrix}function Zi(m,d){var p=[m.x,m.y,0,1];Na(p,p,d);var y=p[3];return{point:new v.Point(p[0]/y,p[1]/y),signedDistanceFromCamera:y}}function gi(m,d){return .5+m/d*.5}function eo(m,d){var p=m[0]/m[3],y=m[1]/m[3];return p>=-d[0]&&p<=d[0]&&y>=-d[1]&&y<=d[1]}function Fs(m,d,p,y,A,w,M,k){var G=y?m.textSizeData:m.iconSizeData,q=v.evaluateSizeForZoom(G,p.transform.zoom),pe=[256/p.width*2+1,256/p.height*2+1],ye=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ye.clear();for(var be=m.lineVertexArray,qe=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,Ue=p.transform.width/p.transform.height,ht=!1,We=0;We<qe.length;We++){var nt=qe.get(We);if(nt.hidden||nt.writingMode===v.WritingMode.vertical&&!ht)Zo(nt.numGlyphs,ye);else{ht=!1;var Mt=[nt.anchorX,nt.anchorY,0,1];if(v.transformMat4(Mt,Mt,d),eo(Mt,pe)){var Pt=gi(p.transform.cameraToCenterDistance,Mt[3]),vr=v.evaluateSizeForFeature(G,q,nt),rr=M?vr/Pt:vr*Pt,br=new v.Point(nt.anchorX,nt.anchorY),wr=Zi(br,A).point,$r={},Qr=oc(nt,rr,!1,k,d,A,w,m.glyphOffsetArray,be,ye,wr,br,$r,Ue);ht=Qr.useVertical,(Qr.notEnoughRoom||ht||Qr.needsFlipping&&oc(nt,rr,!0,k,d,A,w,m.glyphOffsetArray,be,ye,wr,br,$r,Ue).notEnoughRoom)&&Zo(nt.numGlyphs,ye)}else Zo(nt.numGlyphs,ye)}}y?m.text.dynamicLayoutVertexBuffer.updateData(ye):m.icon.dynamicLayoutVertexBuffer.updateData(ye)}function _o(m,d,p,y,A,w,M,k,G,q,pe){var ye=k.glyphStartIndex+k.numGlyphs,be=k.lineStartIndex,qe=k.lineStartIndex+k.lineLength,Ue=d.getoffsetX(k.glyphStartIndex),ht=d.getoffsetX(ye-1),We=Ia(m*Ue,p,y,A,w,M,k.segment,be,qe,G,q,pe);if(!We)return null;var nt=Ia(m*ht,p,y,A,w,M,k.segment,be,qe,G,q,pe);return nt?{first:We,last:nt}:null}function ms(m,d,p,y){return m===v.WritingMode.horizontal&&Math.abs(p.y-d.y)>Math.abs(p.x-d.x)*y?{useVertical:!0}:(m===v.WritingMode.vertical?d.y<p.y:d.x>p.x)?{needsFlipping:!0}:null}function oc(m,d,p,y,A,w,M,k,G,q,pe,ye,be,qe){var Ue,ht=d/24,We=m.lineOffsetX*ht,nt=m.lineOffsetY*ht;if(m.numGlyphs>1){var Mt=m.glyphStartIndex+m.numGlyphs,Pt=m.lineStartIndex,vr=m.lineStartIndex+m.lineLength,rr=_o(ht,k,We,nt,p,pe,ye,m,G,w,be);if(!rr)return{notEnoughRoom:!0};var br=Zi(rr.first.point,M).point,wr=Zi(rr.last.point,M).point;if(y&&!p){var $r=ms(m.writingMode,br,wr,qe);if($r)return $r}Ue=[rr.first];for(var Qr=m.glyphStartIndex+1;Qr<Mt-1;Qr++)Ue.push(Ia(ht*k.getoffsetX(Qr),We,nt,p,pe,ye,m.segment,Pt,vr,G,w,be));Ue.push(rr.last)}else{if(y&&!p){var _n=Zi(ye,A).point,Ln=m.lineStartIndex+m.segment+1,si=new v.Point(G.getx(Ln),G.gety(Ln)),hi=Zi(si,A),Wi=hi.signedDistanceFromCamera>0?hi.point:wo(ye,si,_n,1,A),Qi=ms(m.writingMode,_n,Wi,qe);if(Qi)return Qi}var An=Ia(ht*k.getoffsetX(m.glyphStartIndex),We,nt,p,pe,ye,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,G,w,be);if(!An)return{notEnoughRoom:!0};Ue=[An]}for(var Ri=0,Pi=Ue;Ri<Pi.length;Ri+=1){var Xn=Pi[Ri];v.addDynamicAttributes(q,Xn.point,Xn.angle)}return{}}function wo(m,d,p,y,A){var w=Zi(m.add(m.sub(d)._unit()),A).point,M=p.sub(w);return p.add(M._mult(y/M.mag()))}function Ia(m,d,p,y,A,w,M,k,G,q,pe,ye){var be=y?m-d:m+d,qe=be>0?1:-1,Ue=0;y&&(qe*=-1,Ue=Math.PI),qe<0&&(Ue+=Math.PI);for(var ht=qe>0?k+M:k+M+1,We=A,nt=A,Mt=0,Pt=0,vr=Math.abs(be),rr=[];Mt+Pt<=vr;){if((ht+=qe)<k||ht>=G)return null;if(nt=We,rr.push(We),(We=ye[ht])===void 0){var br=new v.Point(q.getx(ht),q.gety(ht)),wr=Zi(br,pe);if(wr.signedDistanceFromCamera>0)We=ye[ht]=wr.point;else{var $r=ht-qe;We=wo(Mt===0?w:new v.Point(q.getx($r),q.gety($r)),br,nt,vr-Mt+1,pe)}}Mt+=Pt,Pt=nt.dist(We)}var Qr=(vr-Mt)/Pt,_n=We.sub(nt),Ln=_n.mult(Qr)._add(nt);Ln._add(_n._unit()._perp()._mult(p*qe));var si=Ue+Math.atan2(We.y-nt.y,We.x-nt.x);return rr.push(Ln),{point:Ln,angle:si,path:rr}}wi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},wi.prototype.insert=function(m,d,p,y,A){this._forEachCell(d,p,y,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(m),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(A)},wi.prototype.insertCircle=function(m,d,p,y){this._forEachCell(d-y,p-y,d+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(m),this.circles.push(d),this.circles.push(p),this.circles.push(y)},wi.prototype._insertBoxCell=function(m,d,p,y,A,w){this.boxCells[A].push(w)},wi.prototype._insertCircleCell=function(m,d,p,y,A,w){this.circleCells[A].push(w)},wi.prototype._query=function(m,d,p,y,A,w){if(p<0||m>this.width||y<0||d>this.height)return!A&&[];var M=[];if(m<=0&&d<=0&&this.width<=p&&this.height<=y){if(A)return!0;for(var k=0;k<this.boxKeys.length;k++)M.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var G=0;G<this.circleKeys.length;G++){var q=this.circles[3*G],pe=this.circles[3*G+1],ye=this.circles[3*G+2];M.push({key:this.circleKeys[G],x1:q-ye,y1:pe-ye,x2:q+ye,y2:pe+ye})}return w?M.filter(w):M}return this._forEachCell(m,d,p,y,this._queryCell,M,{hitTest:A,seenUids:{box:{},circle:{}}},w),A?M.length>0:M},wi.prototype._queryCircle=function(m,d,p,y,A){var w=m-p,M=m+p,k=d-p,G=d+p;if(M<0||w>this.width||G<0||k>this.height)return!y&&[];var q=[];return this._forEachCell(w,k,M,G,this._queryCellCircle,q,{hitTest:y,circle:{x:m,y:d,radius:p},seenUids:{box:{},circle:{}}},A),y?q.length>0:q},wi.prototype.query=function(m,d,p,y,A){return this._query(m,d,p,y,!1,A)},wi.prototype.hitTest=function(m,d,p,y,A){return this._query(m,d,p,y,!0,A)},wi.prototype.hitTestCircle=function(m,d,p,y){return this._queryCircle(m,d,p,!0,y)},wi.prototype._queryCell=function(m,d,p,y,A,w,M,k){var G=M.seenUids,q=this.boxCells[A];if(q!==null)for(var pe=this.bboxes,ye=0,be=q;ye<be.length;ye+=1){var qe=be[ye];if(!G.box[qe]){G.box[qe]=!0;var Ue=4*qe;if(m<=pe[Ue+2]&&d<=pe[Ue+3]&&p>=pe[Ue+0]&&y>=pe[Ue+1]&&(!k||k(this.boxKeys[qe]))){if(M.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[qe],x1:pe[Ue],y1:pe[Ue+1],x2:pe[Ue+2],y2:pe[Ue+3]})}}}var ht=this.circleCells[A];if(ht!==null)for(var We=this.circles,nt=0,Mt=ht;nt<Mt.length;nt+=1){var Pt=Mt[nt];if(!G.circle[Pt]){G.circle[Pt]=!0;var vr=3*Pt;if(this._circleAndRectCollide(We[vr],We[vr+1],We[vr+2],m,d,p,y)&&(!k||k(this.circleKeys[Pt]))){if(M.hitTest)return w.push(!0),!0;var rr=We[vr],br=We[vr+1],wr=We[vr+2];w.push({key:this.circleKeys[Pt],x1:rr-wr,y1:br-wr,x2:rr+wr,y2:br+wr})}}}},wi.prototype._queryCellCircle=function(m,d,p,y,A,w,M,k){var G=M.circle,q=M.seenUids,pe=this.boxCells[A];if(pe!==null)for(var ye=this.bboxes,be=0,qe=pe;be<qe.length;be+=1){var Ue=qe[be];if(!q.box[Ue]){q.box[Ue]=!0;var ht=4*Ue;if(this._circleAndRectCollide(G.x,G.y,G.radius,ye[ht+0],ye[ht+1],ye[ht+2],ye[ht+3])&&(!k||k(this.boxKeys[Ue])))return w.push(!0),!0}}var We=this.circleCells[A];if(We!==null)for(var nt=this.circles,Mt=0,Pt=We;Mt<Pt.length;Mt+=1){var vr=Pt[Mt];if(!q.circle[vr]){q.circle[vr]=!0;var rr=3*vr;if(this._circlesCollide(nt[rr],nt[rr+1],nt[rr+2],G.x,G.y,G.radius)&&(!k||k(this.circleKeys[vr])))return w.push(!0),!0}}},wi.prototype._forEachCell=function(m,d,p,y,A,w,M,k){for(var G=this._convertToXCellCoord(m),q=this._convertToYCellCoord(d),pe=this._convertToXCellCoord(p),ye=this._convertToYCellCoord(y),be=G;be<=pe;be++)for(var qe=q;qe<=ye;qe++)if(A.call(this,m,d,p,y,this.xCellCount*qe+be,w,M,k))return},wi.prototype._convertToXCellCoord=function(m){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(m*this.xScale)))},wi.prototype._convertToYCellCoord=function(m){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(m*this.yScale)))},wi.prototype._circlesCollide=function(m,d,p,y,A,w){var M=y-m,k=A-d,G=p+w;return G*G>M*M+k*k},wi.prototype._circleAndRectCollide=function(m,d,p,y,A,w,M){var k=(w-y)/2,G=Math.abs(m-(y+k));if(G>k+p)return!1;var q=(M-A)/2,pe=Math.abs(d-(A+q));if(pe>q+p)return!1;if(G<=k||pe<=q)return!0;var ye=G-k,be=pe-q;return ye*ye+be*be<=p*p};var Ol=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Zo(m,d){for(var p=0;p<m;p++){var y=d.length;d.resize(y+4),d.float32.set(Ol,3*y)}}function Na(m,d,p){var y=d[0],A=d[1];return m[0]=p[0]*y+p[4]*A+p[12],m[1]=p[1]*y+p[5]*A+p[13],m[3]=p[3]*y+p[7]*A+p[15],m}var ao=function(d,p,y){p===void 0&&(p=new wi(d.width+200,d.height+200,25)),y===void 0&&(y=new wi(d.width+200,d.height+200,25)),this.transform=d,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(d._pitch)*d.cameraToCenterDistance,this.screenRightBoundary=d.width+100,this.screenBottomBoundary=d.height+100,this.gridRightBoundary=d.width+200,this.gridBottomBoundary=d.height+200};function Ta(m,d,p){return d*(v.EXTENT/(m.tileSize*Math.pow(2,p-m.tileID.overscaledZ)))}ao.prototype.placeCollisionBox=function(m,d,p,y,A){var w=this.projectAndGetPerspectiveRatio(y,m.anchorPointX,m.anchorPointY),M=p*w.perspectiveRatio,k=m.x1*M+w.point.x,G=m.y1*M+w.point.y,q=m.x2*M+w.point.x,pe=m.y2*M+w.point.y;return!this.isInsideGrid(k,G,q,pe)||!d&&this.grid.hitTest(k,G,q,pe,A)?{box:[],offscreen:!1}:{box:[k,G,q,pe],offscreen:this.isOffscreen(k,G,q,pe)}},ao.prototype.placeCollisionCircles=function(m,d,p,y,A,w,M,k,G,q,pe,ye,be){var qe=[],Ue=new v.Point(d.anchorX,d.anchorY),ht=Zi(Ue,w),We=gi(this.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),nt=(q?A/We:A*We)/v.ONE_EM,Mt=Zi(Ue,M).point,Pt=_o(nt,y,d.lineOffsetX*nt,d.lineOffsetY*nt,!1,Mt,Ue,d,p,M,{}),vr=!1,rr=!1,br=!0;if(Pt){for(var wr=.5*ye*We+be,$r=new v.Point(-100,-100),Qr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),_n=new ns,Ln=Pt.first,si=Pt.last,hi=[],Wi=Ln.path.length-1;Wi>=1;Wi--)hi.push(Ln.path[Wi]);for(var Qi=1;Qi<si.path.length;Qi++)hi.push(si.path[Qi]);var An=2.5*wr;if(k){var Ri=hi.map(function(xs){return Zi(xs,k)});hi=Ri.some(function(xs){return xs.signedDistanceFromCamera<=0})?[]:Ri.map(function(xs){return xs.point})}var Pi=[];if(hi.length>0){for(var Xn=hi[0].clone(),Ii=hi[0].clone(),ui=1;ui<hi.length;ui++)Xn.x=Math.min(Xn.x,hi[ui].x),Xn.y=Math.min(Xn.y,hi[ui].y),Ii.x=Math.max(Ii.x,hi[ui].x),Ii.y=Math.max(Ii.y,hi[ui].y);Pi=Xn.x>=$r.x&&Ii.x<=Qr.x&&Xn.y>=$r.y&&Ii.y<=Qr.y?[hi]:Ii.x<$r.x||Xn.x>Qr.x||Ii.y<$r.y||Xn.y>Qr.y?[]:v.clipLine([hi],$r.x,$r.y,Qr.x,Qr.y)}for(var zi=0,Ji=Pi;zi<Ji.length;zi+=1){var Ao;_n.reset(Ji[zi],.25*wr),Ao=_n.length<=.5*wr?1:Math.ceil(_n.paddedLength/An)+1;for(var so=0;so<Ao;so++){var Mo=so/Math.max(Ao-1,1),Ya=_n.lerp(Mo),Ka=Ya.x+100,ru=Ya.y+100;qe.push(Ka,ru,wr,0);var ss=Ka-wr,Qu=ru-wr,Mu=Ka+wr,us=ru+wr;if(br=br&&this.isOffscreen(ss,Qu,Mu,us),rr=rr||this.isInsideGrid(ss,Qu,Mu,us),!m&&this.grid.hitTestCircle(Ka,ru,wr,pe)&&(vr=!0,!G))return{circles:[],offscreen:!1,collisionDetected:vr}}}}return{circles:!G&&vr||!rr?[]:qe,offscreen:br,collisionDetected:vr}},ao.prototype.queryRenderedSymbols=function(m){if(m.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var d=[],p=1/0,y=1/0,A=-1/0,w=-1/0,M=0,k=m;M<k.length;M+=1){var G=k[M],q=new v.Point(G.x+100,G.y+100);p=Math.min(p,q.x),y=Math.min(y,q.y),A=Math.max(A,q.x),w=Math.max(w,q.y),d.push(q)}for(var pe={},ye={},be=0,qe=this.grid.query(p,y,A,w).concat(this.ignoredGrid.query(p,y,A,w));be<qe.length;be+=1){var Ue=qe[be],ht=Ue.key;if(pe[ht.bucketInstanceId]===void 0&&(pe[ht.bucketInstanceId]={}),!pe[ht.bucketInstanceId][ht.featureIndex]){var We=[new v.Point(Ue.x1,Ue.y1),new v.Point(Ue.x2,Ue.y1),new v.Point(Ue.x2,Ue.y2),new v.Point(Ue.x1,Ue.y2)];v.polygonIntersectsPolygon(d,We)&&(pe[ht.bucketInstanceId][ht.featureIndex]=!0,ye[ht.bucketInstanceId]===void 0&&(ye[ht.bucketInstanceId]=[]),ye[ht.bucketInstanceId].push(ht.featureIndex))}}return ye},ao.prototype.insertCollisionBox=function(m,d,p,y,A){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:A},m[0],m[1],m[2],m[3])},ao.prototype.insertCollisionCircles=function(m,d,p,y,A){for(var w=d?this.ignoredGrid:this.grid,M={bucketInstanceId:p,featureIndex:y,collisionGroupID:A},k=0;k<m.length;k+=4)w.insertCircle(M,m[k],m[k+1],m[k+2])},ao.prototype.projectAndGetPerspectiveRatio=function(m,d,p){var y=[d,p,0,1];return Na(y,y,m),{point:new v.Point((y[0]/y[3]+1)/2*this.transform.width+100,(-y[1]/y[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}},ao.prototype.isOffscreen=function(m,d,p,y){return p<100||m>=this.screenRightBoundary||y<100||d>this.screenBottomBoundary},ao.prototype.isInsideGrid=function(m,d,p,y){return p>=0&&m<this.gridRightBoundary&&y>=0&&d<this.gridBottomBoundary},ao.prototype.getViewportMatrix=function(){var m=v.identity([]);return v.translate(m,m,[-100,-100,0]),m};var Do=function(d,p,y,A){this.opacity=d?Math.max(0,Math.min(1,d.opacity+(d.placed?p:-p))):A&&y?1:0,this.placed=y};Do.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var $o=function(d,p,y,A,w){this.text=new Do(d?d.text:null,p,y,w),this.icon=new Do(d?d.icon:null,p,A,w)};$o.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var kc=function(d,p,y){this.text=d,this.icon=p,this.skipFade=y},Bs=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Dh=function(d,p,y,A,w){this.bucketInstanceId=d,this.featureIndex=p,this.sourceLayerIndex=y,this.bucketIndex=A,this.tileID=w},Fo=function(d){this.crossSourceCollisions=d,this.maxGroupID=0,this.collisionGroups={}};function _a(m,d,p,y,A){var w=v.getAnchorAlignment(m),M=-(w.horizontalAlign-.5)*d,k=-(w.verticalAlign-.5)*p,G=v.evaluateVariableOffset(m,y);return new v.Point(M+G[0]*A,k+G[1]*A)}function ft(m,d,p,y,A,w){var M=m.x1,k=m.x2,G=m.y1,q=m.y2,pe=m.anchorPointX,ye=m.anchorPointY,be=new v.Point(d,p);return y&&be._rotate(A?w:-w),{x1:M+be.x,y1:G+be.y,x2:k+be.x,y2:q+be.y,anchorPointX:pe,anchorPointY:ye}}Fo.prototype.get=function(m){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[m]){var d=++this.maxGroupID;this.collisionGroups[m]={ID:d,predicate:function(y){return y.collisionGroupID===d}}}return this.collisionGroups[m]};var le=function(d,p,y,A){this.transform=d.clone(),this.collisionIndex=new ao(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Fo(y),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}};function Ze(m,d,p,y,A){m.emplaceBack(d?1:0,p?1:0,y||0,A||0),m.emplaceBack(d?1:0,p?1:0,y||0,A||0),m.emplaceBack(d?1:0,p?1:0,y||0,A||0),m.emplaceBack(d?1:0,p?1:0,y||0,A||0)}le.prototype.getBucketParts=function(m,d,p,y){var A=p.getBucket(d),w=p.latestFeatureIndex;if(A&&w&&d.id===A.layerIds[0]){var M=p.collisionBoxArray,k=A.layers[0].layout,G=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),q=p.tileSize/v.EXTENT,pe=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ye=k.get("text-pitch-alignment")==="map",be=k.get("text-rotation-alignment")==="map",qe=Ta(p,1,this.transform.zoom),Ue=Xa(pe,ye,be,this.transform,qe),ht=null;if(ye){var We=Hi(pe,ye,be,this.transform,qe);ht=v.multiply([],this.transform.labelPlaneMatrix,We)}this.retainedQueryData[A.bucketInstanceId]=new Dh(A.bucketInstanceId,w,A.sourceLayerIndex,A.index,p.tileID);var nt={bucket:A,layout:k,posMatrix:pe,textLabelPlaneMatrix:Ue,labelToScreenMatrix:ht,scale:G,textPixelRatio:q,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(y)for(var Mt=0,Pt=A.sortKeyRanges;Mt<Pt.length;Mt+=1){var vr=Pt[Mt];m.push({sortKey:vr.sortKey,symbolInstanceStart:vr.symbolInstanceStart,symbolInstanceEnd:vr.symbolInstanceEnd,parameters:nt})}else m.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:nt})}},le.prototype.attemptAnchorPlacement=function(m,d,p,y,A,w,M,k,G,q,pe,ye,be,qe,Ue){var ht,We=[ye.textOffset0,ye.textOffset1],nt=_a(m,p,y,We,A),Mt=this.collisionIndex.placeCollisionBox(ft(d,nt.x,nt.y,w,M,this.transform.angle),pe,k,G,q.predicate);if(!Ue||this.collisionIndex.placeCollisionBox(ft(Ue,nt.x,nt.y,w,M,this.transform.angle),pe,k,G,q.predicate).box.length!==0)return Mt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(ht=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:We,width:p,height:y,anchor:m,textBoxScale:A,prevAnchor:ht},this.markUsedJustification(be,m,ye,qe),be.allowVerticalPlacement&&(this.markUsedOrientation(be,qe,ye),this.placedOrientations[ye.crossTileID]=qe),{shift:nt,placedGlyphBoxes:Mt}):void 0},le.prototype.placeLayerBucketPart=function(m,d,p){var y=this,A=m.parameters,w=A.bucket,M=A.layout,k=A.posMatrix,G=A.textLabelPlaneMatrix,q=A.labelToScreenMatrix,pe=A.textPixelRatio,ye=A.holdingForFade,be=A.collisionBoxArray,qe=A.partiallyEvaluatedTextSize,Ue=A.collisionGroup,ht=M.get("text-optional"),We=M.get("icon-optional"),nt=M.get("text-allow-overlap"),Mt=M.get("icon-allow-overlap"),Pt=M.get("text-rotation-alignment")==="map",vr=M.get("text-pitch-alignment")==="map",rr=M.get("icon-text-fit")!=="none",br=M.get("symbol-z-order")==="viewport-y",wr=nt&&(Mt||!w.hasIconData()||We),$r=Mt&&(nt||!w.hasTextData()||ht);!w.collisionArrays&&be&&w.deserializeCollisionBoxes(be);var Qr=function(An,Ri){if(!d[An.crossTileID])if(ye)y.placements[An.crossTileID]=new kc(!1,!1,!1);else{var Pi,Xn=!1,Ii=!1,ui=!0,zi=null,Ji={box:null,offscreen:null},Ao={box:null,offscreen:null},so=null,Mo=null,Ya=0,Ka=0,ru=0;Ri.textFeatureIndex?Ya=Ri.textFeatureIndex:An.useRuntimeCollisionCircles&&(Ya=An.featureIndex),Ri.verticalTextFeatureIndex&&(Ka=Ri.verticalTextFeatureIndex);var ss=Ri.textBox;if(ss){var Qu=function(xo){var cs=v.WritingMode.horizontal;if(w.allowVerticalPlacement&&!xo&&y.prevPlacement){var jo=y.prevPlacement.placedOrientations[An.crossTileID];jo&&(y.placedOrientations[An.crossTileID]=jo,y.markUsedOrientation(w,cs=jo,An))}return cs},Mu=function(xo,cs){if(w.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&Ri.verticalTextBox)for(var jo=0,Pu=w.writingModes;jo<Pu.length&&(Pu[jo]===v.WritingMode.vertical?(Ji=cs(),Ao=Ji):Ji=xo(),!(Ji&&Ji.box&&Ji.box.length));jo+=1);else Ji=xo()};if(M.get("text-variable-anchor")){var us=M.get("text-variable-anchor");if(y.prevPlacement&&y.prevPlacement.variableOffsets[An.crossTileID]){var xs=y.prevPlacement.variableOffsets[An.crossTileID];us.indexOf(xs.anchor)>0&&(us=us.filter(function(Da){return Da!==xs.anchor})).unshift(xs.anchor)}var Xl=function(xo,cs,jo){for(var Pu=xo.x2-xo.x1,Xh=xo.y2-xo.y1,vh=An.textBoxScale,$l=rr&&!Mt?cs:null,du={box:[],offscreen:!1},qc=nt?2*us.length:us.length,Rf=0;Rf<qc;++Rf){var Iu=y.attemptAnchorPlacement(us[Rf%us.length],xo,Pu,Xh,vh,Pt,vr,pe,k,Ue,Rf>=us.length,An,w,jo,$l);if(Iu&&(du=Iu.placedGlyphBoxes)&&du.box&&du.box.length){Xn=!0,zi=Iu.shift;break}}return du};Mu(function(){return Xl(ss,Ri.iconBox,v.WritingMode.horizontal)},function(){var Da=Ri.verticalTextBox;return w.allowVerticalPlacement&&!(Ji&&Ji.box&&Ji.box.length)&&An.numVerticalGlyphVertices>0&&Da?Xl(Da,Ri.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Ji&&(Xn=Ji.box,ui=Ji.offscreen);var Kc=Qu(Ji&&Ji.box);if(!Xn&&y.prevPlacement){var Su=y.prevPlacement.variableOffsets[An.crossTileID];Su&&(y.variableOffsets[An.crossTileID]=Su,y.markUsedJustification(w,Su.anchor,An,Kc))}}else{var Zl=function(xo,cs){var jo=y.collisionIndex.placeCollisionBox(xo,nt,pe,k,Ue.predicate);return jo&&jo.box&&jo.box.length&&(y.markUsedOrientation(w,cs,An),y.placedOrientations[An.crossTileID]=cs),jo};Mu(function(){return Zl(ss,v.WritingMode.horizontal)},function(){var Da=Ri.verticalTextBox;return w.allowVerticalPlacement&&An.numVerticalGlyphVertices>0&&Da?Zl(Da,v.WritingMode.vertical):{box:null,offscreen:null}}),Qu(Ji&&Ji.box&&Ji.box.length)}}if(Xn=(Pi=Ji)&&Pi.box&&Pi.box.length>0,ui=Pi&&Pi.offscreen,An.useRuntimeCollisionCircles){var Ju=w.text.placedSymbolArray.get(An.centerJustifiedTextSymbolIndex),Xt=v.evaluateSizeForFeature(w.textSizeData,qe,Ju),De=M.get("text-padding");so=y.collisionIndex.placeCollisionCircles(nt,Ju,w.lineVertexArray,w.glyphOffsetArray,Xt,k,G,q,p,vr,Ue.predicate,An.collisionCircleDiameter,De),Xn=nt||so.circles.length>0&&!so.collisionDetected,ui=ui&&so.offscreen}if(Ri.iconFeatureIndex&&(ru=Ri.iconFeatureIndex),Ri.iconBox){var ls=function(xo){var cs=rr&&zi?ft(xo,zi.x,zi.y,Pt,vr,y.transform.angle):xo;return y.collisionIndex.placeCollisionBox(cs,Mt,pe,k,Ue.predicate)};Ii=Ao&&Ao.box&&Ao.box.length&&Ri.verticalIconBox?(Mo=ls(Ri.verticalIconBox)).box.length>0:(Mo=ls(Ri.iconBox)).box.length>0,ui=ui&&Mo.offscreen}var he=ht||An.numHorizontalGlyphVertices===0&&An.numVerticalGlyphVertices===0,Us=We||An.numIconVertices===0;if(he||Us?Us?he||(Ii=Ii&&Xn):Xn=Ii&&Xn:Ii=Xn=Ii&&Xn,Xn&&Pi&&Pi.box&&y.collisionIndex.insertCollisionBox(Pi.box,M.get("text-ignore-placement"),w.bucketInstanceId,Ao&&Ao.box&&Ka?Ka:Ya,Ue.ID),Ii&&Mo&&y.collisionIndex.insertCollisionBox(Mo.box,M.get("icon-ignore-placement"),w.bucketInstanceId,ru,Ue.ID),so&&(Xn&&y.collisionIndex.insertCollisionCircles(so.circles,M.get("text-ignore-placement"),w.bucketInstanceId,Ya,Ue.ID),p)){var uo=w.bucketInstanceId,nu=y.collisionCircleArrays[uo];nu===void 0&&(nu=y.collisionCircleArrays[uo]=new Bs);for(var qa=0;qa<so.circles.length;qa+=4)nu.circles.push(so.circles[qa+0]),nu.circles.push(so.circles[qa+1]),nu.circles.push(so.circles[qa+2]),nu.circles.push(so.collisionDetected?1:0)}y.placements[An.crossTileID]=new kc(Xn||wr,Ii||$r,ui||w.justReloaded),d[An.crossTileID]=!0}};if(br)for(var _n=w.getSortedSymbolIndexes(this.transform.angle),Ln=_n.length-1;Ln>=0;--Ln){var si=_n[Ln];Qr(w.symbolInstances.get(si),w.collisionArrays[si])}else for(var hi=m.symbolInstanceStart;hi<m.symbolInstanceEnd;hi++)Qr(w.symbolInstances.get(hi),w.collisionArrays[hi]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){var Wi=this.collisionCircleArrays[w.bucketInstanceId];v.invert(Wi.invProjMatrix,k),Wi.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},le.prototype.markUsedJustification=function(m,d,p,y){var A;A=y===v.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(d)];for(var w=0,M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];w<M.length;w+=1){var k=M[w];k>=0&&(m.text.placedSymbolArray.get(k).crossTileID=A>=0&&k!==A?0:p.crossTileID)}},le.prototype.markUsedOrientation=function(m,d,p){for(var y=d===v.WritingMode.horizontal||d===v.WritingMode.horizontalOnly?d:0,A=d===v.WritingMode.vertical?d:0,w=0,M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];w<M.length;w+=1)m.text.placedSymbolArray.get(M[w]).placedOrientation=y;p.verticalPlacedTextSymbolIndex&&(m.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=A)},le.prototype.commit=function(m){this.commitTime=m,this.zoomAtLastRecencyCheck=this.transform.zoom;var d=this.prevPlacement,p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;var y=d?d.symbolFadeChange(m):1,A=d?d.opacities:{},w=d?d.variableOffsets:{},M=d?d.placedOrientations:{};for(var k in this.placements){var G=this.placements[k],q=A[k];q?(this.opacities[k]=new $o(q,y,G.text,G.icon),p=p||G.text!==q.text.placed||G.icon!==q.icon.placed):(this.opacities[k]=new $o(null,y,G.text,G.icon,G.skipFade),p=p||G.text||G.icon)}for(var pe in A){var ye=A[pe];if(!this.opacities[pe]){var be=new $o(ye,y,!1,!1);be.isHidden()||(this.opacities[pe]=be,p=p||ye.text.placed||ye.icon.placed)}}for(var qe in w)this.variableOffsets[qe]||!this.opacities[qe]||this.opacities[qe].isHidden()||(this.variableOffsets[qe]=w[qe]);for(var Ue in M)this.placedOrientations[Ue]||!this.opacities[Ue]||this.opacities[Ue].isHidden()||(this.placedOrientations[Ue]=M[Ue]);p?this.lastPlacementChangeTime=m:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:m)},le.prototype.updateLayerOpacities=function(m,d){for(var p={},y=0,A=d;y<A.length;y+=1){var w=A[y],M=w.getBucket(m);M&&w.latestFeatureIndex&&m.id===M.layerIds[0]&&this.updateBucketOpacities(M,p,w.collisionBoxArray)}},le.prototype.updateBucketOpacities=function(m,d,p){var y=this;m.hasTextData()&&m.text.opacityVertexArray.clear(),m.hasIconData()&&m.icon.opacityVertexArray.clear(),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexArray.clear(),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexArray.clear();var A=m.layers[0].layout,w=new $o(null,0,!1,!1,!0),M=A.get("text-allow-overlap"),k=A.get("icon-allow-overlap"),G=A.get("text-variable-anchor"),q=A.get("text-rotation-alignment")==="map",pe=A.get("text-pitch-alignment")==="map",ye=A.get("icon-text-fit")!=="none",be=new $o(null,0,M&&(k||!m.hasIconData()||A.get("icon-optional")),k&&(M||!m.hasTextData()||A.get("text-optional")),!0);!m.collisionArrays&&p&&(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData())&&m.deserializeCollisionBoxes(p);for(var qe=function(Mt,Pt,vr){for(var rr=0;rr<Pt/4;rr++)Mt.opacityVertexArray.emplaceBack(vr)},Ue=function(Mt){var Pt=m.symbolInstances.get(Mt),vr=Pt.numHorizontalGlyphVertices,rr=Pt.numVerticalGlyphVertices,br=Pt.crossTileID,wr=y.opacities[br];d[br]?wr=w:wr||(y.opacities[br]=wr=be),d[br]=!0;var $r=Pt.numIconVertices>0,Qr=y.placedOrientations[Pt.crossTileID],_n=Qr===v.WritingMode.vertical,Ln=Qr===v.WritingMode.horizontal||Qr===v.WritingMode.horizontalOnly;if(vr>0||rr>0){var si=Ls(wr.text);qe(m.text,vr,_n?df:si),qe(m.text,rr,Ln?df:si);var hi=wr.text.isHidden();[Pt.rightJustifiedTextSymbolIndex,Pt.centerJustifiedTextSymbolIndex,Pt.leftJustifiedTextSymbolIndex].forEach(function(Ji){Ji>=0&&(m.text.placedSymbolArray.get(Ji).hidden=hi||_n?1:0)}),Pt.verticalPlacedTextSymbolIndex>=0&&(m.text.placedSymbolArray.get(Pt.verticalPlacedTextSymbolIndex).hidden=hi||Ln?1:0);var Wi=y.variableOffsets[Pt.crossTileID];Wi&&y.markUsedJustification(m,Wi.anchor,Pt,Qr);var Qi=y.placedOrientations[Pt.crossTileID];Qi&&(y.markUsedJustification(m,"left",Pt,Qi),y.markUsedOrientation(m,Qi,Pt))}if($r){var An=Ls(wr.icon),Ri=!(ye&&Pt.verticalPlacedIconSymbolIndex&&_n);Pt.placedIconSymbolIndex>=0&&(qe(m.icon,Pt.numIconVertices,Ri?An:df),m.icon.placedSymbolArray.get(Pt.placedIconSymbolIndex).hidden=wr.icon.isHidden()),Pt.verticalPlacedIconSymbolIndex>=0&&(qe(m.icon,Pt.numVerticalIconVertices,Ri?df:An),m.icon.placedSymbolArray.get(Pt.verticalPlacedIconSymbolIndex).hidden=wr.icon.isHidden())}if(m.hasIconCollisionBoxData()||m.hasTextCollisionBoxData()){var Pi=m.collisionArrays[Mt];if(Pi){var Xn=new v.Point(0,0);if(Pi.textBox||Pi.verticalTextBox){var Ii=!0;if(G){var ui=y.variableOffsets[br];ui?(Xn=_a(ui.anchor,ui.width,ui.height,ui.textOffset,ui.textBoxScale),q&&Xn._rotate(pe?y.transform.angle:-y.transform.angle)):Ii=!1}Pi.textBox&&Ze(m.textCollisionBox.collisionVertexArray,wr.text.placed,!Ii||_n,Xn.x,Xn.y),Pi.verticalTextBox&&Ze(m.textCollisionBox.collisionVertexArray,wr.text.placed,!Ii||Ln,Xn.x,Xn.y)}var zi=Boolean(!Ln&&Pi.verticalIconBox);Pi.iconBox&&Ze(m.iconCollisionBox.collisionVertexArray,wr.icon.placed,zi,ye?Xn.x:0,ye?Xn.y:0),Pi.verticalIconBox&&Ze(m.iconCollisionBox.collisionVertexArray,wr.icon.placed,!zi,ye?Xn.x:0,ye?Xn.y:0)}}},ht=0;ht<m.symbolInstances.length;ht++)Ue(ht);if(m.sortFeatures(this.transform.angle),this.retainedQueryData[m.bucketInstanceId]&&(this.retainedQueryData[m.bucketInstanceId].featureSortOrder=m.featureSortOrder),m.hasTextData()&&m.text.opacityVertexBuffer&&m.text.opacityVertexBuffer.updateData(m.text.opacityVertexArray),m.hasIconData()&&m.icon.opacityVertexBuffer&&m.icon.opacityVertexBuffer.updateData(m.icon.opacityVertexArray),m.hasIconCollisionBoxData()&&m.iconCollisionBox.collisionVertexBuffer&&m.iconCollisionBox.collisionVertexBuffer.updateData(m.iconCollisionBox.collisionVertexArray),m.hasTextCollisionBoxData()&&m.textCollisionBox.collisionVertexBuffer&&m.textCollisionBox.collisionVertexBuffer.updateData(m.textCollisionBox.collisionVertexArray),m.bucketInstanceId in this.collisionCircleArrays){var We=this.collisionCircleArrays[m.bucketInstanceId];m.placementInvProjMatrix=We.invProjMatrix,m.placementViewportMatrix=We.viewportMatrix,m.collisionCircleArray=We.circles,delete this.collisionCircleArrays[m.bucketInstanceId]}},le.prototype.symbolFadeChange=function(m){return this.fadeDuration===0?1:(m-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},le.prototype.zoomAdjustment=function(m){return Math.max(0,(this.transform.zoom-m)/1.5)},le.prototype.hasTransitions=function(m){return this.stale||m-this.lastPlacementChangeTime<this.fadeDuration},le.prototype.stillRecent=function(m,d){var p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>m},le.prototype.setStale=function(){this.stale=!0};var sr=Math.pow(2,25),rn=Math.pow(2,24),Pn=Math.pow(2,17),ji=Math.pow(2,16),Za=Math.pow(2,9),Oo=Math.pow(2,8),gs=Math.pow(2,1);function Ls(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;var d=m.placed?1:0,p=Math.floor(127*m.opacity);return p*sr+d*rn+p*Pn+d*ji+p*Za+d*Oo+p*gs+d}var df=0,gp=function(d){this._sortAcrossTiles=d.layout.get("symbol-z-order")!=="viewport-y"&&d.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};gp.prototype.continuePlacement=function(m,d,p,y,A){for(var w=this._bucketParts;this._currentTileIndex<m.length;)if(d.getBucketParts(w,y,m[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(M,k){return M.sortKey-k.sortKey}));this._currentPartIndex<w.length;)if(d.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,A())return!0;return!1};var Dc=function(d,p,y,A,w,M,k){this.placement=new le(d,w,M,k),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=A,this._done=!1};Dc.prototype.isDone=function(){return this._done},Dc.prototype.continuePlacement=function(m,d,p){for(var y=this,A=v.browser.now(),w=function(){var q=v.browser.now()-A;return!y._forceFullPlacement&&q>2};this._currentPlacementIndex>=0;){var M=d[m[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=k)&&(!M.maxzoom||M.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new gp(M)),this._inProgressLayer.continuePlacement(p[M.source],this.placement,this._showCollisionBoxes,M,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Dc.prototype.commit=function(m){return this.placement.commit(m),this.placement};var dd=512/v.EXTENT/2,Rl=function(d,p,y){this.tileID=d,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(var A=0;A<p.length;A++){var w=p.get(A),M=w.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,d)})}};Rl.prototype.getScaledCoordinates=function(m,d){var p=dd/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*v.EXTENT+m.anchorX)*p),y:Math.floor((d.canonical.y*v.EXTENT+m.anchorY)*p)}},Rl.prototype.findMatches=function(m,d,p){for(var y=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z),A=0;A<m.length;A++){var w=m.get(A);if(!w.crossTileID){var M=this.indexedSymbolInstances[w.key];if(M)for(var k=this.getScaledCoordinates(w,d),G=0,q=M;G<q.length;G+=1){var pe=q[G];if(Math.abs(pe.coord.x-k.x)<=y&&Math.abs(pe.coord.y-k.y)<=y&&!p[pe.crossTileID]){p[pe.crossTileID]=!0,w.crossTileID=pe.crossTileID;break}}}}};var ys=function(){this.maxCrossTileID=0};ys.prototype.generate=function(){return++this.maxCrossTileID};var Ml=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Ml.prototype.handleWrapJump=function(m){var d=Math.round((m-this.lng)/360);if(d!==0)for(var p in this.indexes){var y=this.indexes[p],A={};for(var w in y){var M=y[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),A[M.tileID.key]=M}this.indexes[p]=A}this.lng=m},Ml.prototype.addBucket=function(m,d,p){if(this.indexes[m.overscaledZ]&&this.indexes[m.overscaledZ][m.key]){if(this.indexes[m.overscaledZ][m.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(m.overscaledZ,this.indexes[m.overscaledZ][m.key])}for(var y=0;y<d.symbolInstances.length;y++)d.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[m.overscaledZ]||(this.usedCrossTileIDs[m.overscaledZ]={});var A=this.usedCrossTileIDs[m.overscaledZ];for(var w in this.indexes){var M=this.indexes[w];if(Number(w)>m.overscaledZ)for(var k in M){var G=M[k];G.tileID.isChildOf(m)&&G.findMatches(d.symbolInstances,m,A)}else{var q=M[m.scaledTo(Number(w)).key];q&&q.findMatches(d.symbolInstances,m,A)}}for(var pe=0;pe<d.symbolInstances.length;pe++){var ye=d.symbolInstances.get(pe);ye.crossTileID||(ye.crossTileID=p.generate(),A[ye.crossTileID]=!0)}return this.indexes[m.overscaledZ]===void 0&&(this.indexes[m.overscaledZ]={}),this.indexes[m.overscaledZ][m.key]=new Rl(m,d.symbolInstances,d.bucketInstanceId),!0},Ml.prototype.removeBucketCrossTileIDs=function(m,d){for(var p in d.indexedSymbolInstances)for(var y=0,A=d.indexedSymbolInstances[p];y<A.length;y+=1)delete this.usedCrossTileIDs[m][A[y].crossTileID]},Ml.prototype.removeStaleBuckets=function(m){var d=!1;for(var p in this.indexes){var y=this.indexes[p];for(var A in y)m[y[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[A]),delete y[A],d=!0)}return d};var sc=function(){this.layerIndexes={},this.crossTileIDs=new ys,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};sc.prototype.addLayer=function(m,d,p){var y=this.layerIndexes[m.id];y===void 0&&(y=this.layerIndexes[m.id]=new Ml);var A=!1,w={};y.handleWrapJump(p);for(var M=0,k=d;M<k.length;M+=1){var G=k[M],q=G.getBucket(m);q&&m.id===q.layerIds[0]&&(q.bucketInstanceId||(q.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(G.tileID,q,this.crossTileIDs)&&(A=!0),w[q.bucketInstanceId]=!0)}return y.removeStaleBuckets(w)&&(A=!0),A},sc.prototype.pruneUnusedLayers=function(m){var d={};for(var p in m.forEach(function(y){d[y]=!0}),this.layerIndexes)d[p]||delete this.layerIndexes[p]};var Gu=function(d,p){return v.emitValidationErrors(d,p&&p.filter(function(y){return y.identifier!=="source.canvas"}))},sl=v.pick(we,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Pl=v.pick(we,["setCenter","setZoom","setBearing","setPitch"]),Yf=function(){var m={},d=v.styleSpec.$version;for(var p in v.styleSpec.$root){var y,A=v.styleSpec.$root[p];A.required&&(y=p==="version"?d:A.type==="array"?[]:{})!=null&&(m[p]=y)}return m}(),Rt=function(m){function d(p,y){var A=this;y===void 0&&(y={}),m.call(this),this.map=p,this.dispatcher=new Te(dr(),this),this.imageManager=new $e,this.imageManager.setEventedParent(this),this.glyphManager=new Dr(p._requestManager,y.localIdeographFontFamily),this.lineAtlas=new Gt(256,512),this.crossTileSymbolIndex=new sc,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var w=this;this._rtlTextPluginCallback=d.registerForPluginStateChange(function(M){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(k,G){if(v.triggerPluginCompletionEvent(k),G&&G.every(function(pe){return pe}))for(var q in w.sourceCaches)w.sourceCaches[q].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var k=A.sourceCaches[M.sourceId];if(k){var G=k.getSource();if(G&&G.vectorLayerIds)for(var q in A._layers){var pe=A._layers[q];pe.source===G.id&&A._validateLayer(pe)}}}})}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.loadURL=function(p,y){var A=this;y===void 0&&(y={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var w=typeof y.validate=="boolean"?y.validate:!v.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,y.accessToken);var M=this.map._requestManager.transformRequest(p,v.ResourceType.Style);this._request=v.getJSON(M,function(k,G){A._request=null,k?A.fire(new v.ErrorEvent(k)):G&&A._load(G,w)})},d.prototype.loadJSON=function(p,y){var A=this;y===void 0&&(y={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){A._request=null,A._load(p,y.validate!==!1)})},d.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Yf,!1)},d.prototype._load=function(p,y){if(!y||!Gu(this,v.validateStyle(p))){for(var A in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(A,p.sources[A],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var w=bn(this.stylesheet.layers);this._order=w.map(function(q){return q.id}),this._layers={},this._serializedLayers={};for(var M=0,k=w;M<k.length;M+=1){var G=k[M];(G=v.createStyleLayer(G)).setEventedParent(this,{layer:{id:G.id}}),this._layers[G.id]=G,this._serializedLayers[G.id]=G.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Nt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},d.prototype._loadSprite=function(p){var y=this;this._spriteRequest=function(A,w,M){var k,G,q,pe=v.browser.devicePixelRatio>1?"@2x":"",ye=v.getJSON(w.transformRequest(w.normalizeSpriteURL(A,pe,".json"),v.ResourceType.SpriteJSON),function(Ue,ht){ye=null,q||(q=Ue,k=ht,qe())}),be=v.getImage(w.transformRequest(w.normalizeSpriteURL(A,pe,".png"),v.ResourceType.SpriteImage),function(Ue,ht){be=null,q||(q=Ue,G=ht,qe())});function qe(){if(q)M(q);else if(k&&G){var Ue=v.browser.getImageData(G),ht={};for(var We in k){var nt=k[We],Mt=nt.width,Pt=nt.height,vr=nt.x,rr=nt.y,br=nt.sdf,wr=nt.pixelRatio,$r=nt.stretchX,Qr=nt.stretchY,_n=nt.content,Ln=new v.RGBAImage({width:Mt,height:Pt});v.RGBAImage.copy(Ue,Ln,{x:vr,y:rr},{x:0,y:0},{width:Mt,height:Pt}),ht[We]={data:Ln,pixelRatio:wr,sdf:br,stretchX:$r,stretchY:Qr,content:_n}}M(null,ht)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),be&&(be.cancel(),be=null)}}}(p,this.map._requestManager,function(A,w){if(y._spriteRequest=null,A)y.fire(new v.ErrorEvent(A));else if(w)for(var M in w)y.imageManager.addImage(M,w[M]);y.imageManager.setLoaded(!0),y._availableImages=y.imageManager.listImages(),y.dispatcher.broadcast("setImages",y._availableImages),y.fire(new v.Event("data",{dataType:"style"}))})},d.prototype._validateLayer=function(p){var y=this.sourceCaches[p.source];if(y){var A=p.sourceLayer;if(A){var w=y.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(A)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+A+'" does not exist on source "'+w.id+'" as specified by style layer "'+p.id+'"')))}}},d.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},d.prototype._serializeLayers=function(p){for(var y=[],A=0,w=p;A<w.length;A+=1){var M=this._layers[w[A]];M.type!=="custom"&&y.push(M.serialize())}return y},d.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var y in this._layers)if(this._layers[y].hasTransition())return!0;return!1},d.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},d.prototype.update=function(p){if(this._loaded){var y=this._changed;if(this._changed){var A=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var M in(A.length||w.length)&&this._updateWorkerLayers(A,w),this._updatedSources){var k=this._updatedSources[M];k==="reload"?this._reloadSource(M):k==="clear"&&this._clearSource(M)}for(var G in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[G].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var q={};for(var pe in this.sourceCaches){var ye=this.sourceCaches[pe];q[pe]=ye.used,ye.used=!1}for(var be=0,qe=this._order;be<qe.length;be+=1){var Ue=this._layers[qe[be]];Ue.recalculate(p,this._availableImages),!Ue.isHidden(p.zoom)&&Ue.source&&(this.sourceCaches[Ue.source].used=!0)}for(var ht in q){var We=this.sourceCaches[ht];q[ht]!==We.used&&We.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ht}))}this.light.recalculate(p),this.z=p.zoom,y&&this.fire(new v.Event("data",{dataType:"style"}))}},d.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var y in this.sourceCaches)this.sourceCaches[y].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},d.prototype._updateWorkerLayers=function(p,y){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:y})},d.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},d.prototype.setState=function(p){var y=this;if(this._checkLoaded(),Gu(this,v.validateStyle(p)))return!1;(p=v.clone$1(p)).layers=bn(p.layers);var A=function(M,k){if(!M)return[{command:we.setStyle,args:[k]}];var G=[];try{if(!v.deepEqual(M.version,k.version))return[{command:we.setStyle,args:[k]}];v.deepEqual(M.center,k.center)||G.push({command:we.setCenter,args:[k.center]}),v.deepEqual(M.zoom,k.zoom)||G.push({command:we.setZoom,args:[k.zoom]}),v.deepEqual(M.bearing,k.bearing)||G.push({command:we.setBearing,args:[k.bearing]}),v.deepEqual(M.pitch,k.pitch)||G.push({command:we.setPitch,args:[k.pitch]}),v.deepEqual(M.sprite,k.sprite)||G.push({command:we.setSprite,args:[k.sprite]}),v.deepEqual(M.glyphs,k.glyphs)||G.push({command:we.setGlyphs,args:[k.glyphs]}),v.deepEqual(M.transition,k.transition)||G.push({command:we.setTransition,args:[k.transition]}),v.deepEqual(M.light,k.light)||G.push({command:we.setLight,args:[k.light]});var q={},pe=[];(function(be,qe,Ue,ht){var We;for(We in qe=qe||{},be=be||{})be.hasOwnProperty(We)&&(qe.hasOwnProperty(We)||xn(We,Ue,ht));for(We in qe)qe.hasOwnProperty(We)&&(be.hasOwnProperty(We)?v.deepEqual(be[We],qe[We])||(be[We].type==="geojson"&&qe[We].type==="geojson"&&ia(be,qe,We)?Ue.push({command:we.setGeoJSONSourceData,args:[We,qe[We].data]}):Vi(We,qe,Ue,ht)):Kn(We,qe,Ue))})(M.sources,k.sources,pe,q);var ye=[];M.layers&&M.layers.forEach(function(be){q[be.source]?G.push({command:we.removeLayer,args:[be.id]}):ye.push(be)}),G=G.concat(pe),function(be,qe,Ue){qe=qe||[];var ht,We,nt,Mt,Pt,vr,rr,br=(be=be||[]).map(ta),wr=qe.map(ta),$r=be.reduce(Ni,{}),Qr=qe.reduce(Ni,{}),_n=br.slice(),Ln=Object.create(null);for(ht=0,We=0;ht<br.length;ht++)Qr.hasOwnProperty(nt=br[ht])?We++:(Ue.push({command:we.removeLayer,args:[nt]}),_n.splice(_n.indexOf(nt,We),1));for(ht=0,We=0;ht<wr.length;ht++)_n[_n.length-1-ht]!==(nt=wr[wr.length-1-ht])&&($r.hasOwnProperty(nt)?(Ue.push({command:we.removeLayer,args:[nt]}),_n.splice(_n.lastIndexOf(nt,_n.length-We),1)):We++,Ue.push({command:we.addLayer,args:[Qr[nt],vr=_n[_n.length-ht]]}),_n.splice(_n.length-ht,0,nt),Ln[nt]=!0);for(ht=0;ht<wr.length;ht++)if(Mt=$r[nt=wr[ht]],Pt=Qr[nt],!Ln[nt]&&!v.deepEqual(Mt,Pt))if(v.deepEqual(Mt.source,Pt.source)&&v.deepEqual(Mt["source-layer"],Pt["source-layer"])&&v.deepEqual(Mt.type,Pt.type)){for(rr in bi(Mt.layout,Pt.layout,Ue,nt,null,we.setLayoutProperty),bi(Mt.paint,Pt.paint,Ue,nt,null,we.setPaintProperty),v.deepEqual(Mt.filter,Pt.filter)||Ue.push({command:we.setFilter,args:[nt,Pt.filter]}),v.deepEqual(Mt.minzoom,Pt.minzoom)&&v.deepEqual(Mt.maxzoom,Pt.maxzoom)||Ue.push({command:we.setLayerZoomRange,args:[nt,Pt.minzoom,Pt.maxzoom]}),Mt)Mt.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?bi(Mt[rr],Pt[rr],Ue,nt,rr.slice(6),we.setPaintProperty):v.deepEqual(Mt[rr],Pt[rr])||Ue.push({command:we.setLayerProperty,args:[nt,rr,Pt[rr]]}));for(rr in Pt)Pt.hasOwnProperty(rr)&&!Mt.hasOwnProperty(rr)&&rr!=="layout"&&rr!=="paint"&&rr!=="filter"&&rr!=="metadata"&&rr!=="minzoom"&&rr!=="maxzoom"&&(rr.indexOf("paint.")===0?bi(Mt[rr],Pt[rr],Ue,nt,rr.slice(6),we.setPaintProperty):v.deepEqual(Mt[rr],Pt[rr])||Ue.push({command:we.setLayerProperty,args:[nt,rr,Pt[rr]]}))}else Ue.push({command:we.removeLayer,args:[nt]}),vr=_n[_n.lastIndexOf(nt)+1],Ue.push({command:we.addLayer,args:[Pt,vr]})}(ye,k.layers,G)}catch(be){console.warn("Unable to compute style diff:",be),G=[{command:we.setStyle,args:[k]}]}return G}(this.serialize(),p).filter(function(M){return!(M.command in Pl)});if(A.length===0)return!1;var w=A.filter(function(M){return!(M.command in sl)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(M){return M.command}).join(", ")+".");return A.forEach(function(M){M.command!=="setTransition"&&y[M.command].apply(y,M.args)}),this.stylesheet=p,!0},d.prototype.addImage=function(p,y){if(this.getImage(p))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,y),this._afterImageUpdated(p)},d.prototype.updateImage=function(p,y){this.imageManager.updateImage(p,y)},d.prototype.getImage=function(p){return this.imageManager.getImage(p)},d.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},d.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},d.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},d.prototype.addSource=function(p,y,A){var w=this;if(A===void 0&&(A={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!y.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(y).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(y.type)>=0&&this._validate(v.validateStyle.source,"sources."+p,y,null,A))){this.map&&this.map._collectResourceTiming&&(y.collectResourceTiming=!0);var M=this.sourceCaches[p]=new Ye(p,y,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:M.serialize(),sourceId:p}}),M.onAdd(this.map),this._changed=!0}},d.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var y in this._layers)if(this._layers[y].source===p)return this.fire(new v.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+y+'" is using it.')));var A=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],A.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),A.setEventedParent(null),A.clearTiles(),A.onRemove&&A.onRemove(this.map),this._changed=!0},d.prototype.setGeoJSONSourceData=function(p,y){this._checkLoaded(),this.sourceCaches[p].getSource().setData(y),this._changed=!0},d.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},d.prototype.addLayer=function(p,y,A){A===void 0&&(A={}),this._checkLoaded();var w=p.id;if(this.getLayer(w))this.fire(new v.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var M;if(p.type==="custom"){if(Gu(this,v.validateCustomStyleLayer(p)))return;M=v.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(w,p.source),p=v.clone$1(p),p=v.extend(p,{source:w})),this._validate(v.validateStyle.layer,"layers."+w,p,{arrayIndex:-1},A))return;M=v.createStyleLayer(p),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[M.id]=M.serialize()}var k=y?this._order.indexOf(y):this._order.length;if(y&&k===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.')));else{if(this._order.splice(k,0,w),this._layerOrderChanged=!0,this._layers[w]=M,this._removedLayers[w]&&M.source&&M.type!=="custom"){var G=this._removedLayers[w];delete this._removedLayers[w],G.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},d.prototype.moveLayer=function(p,y){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==y){var A=this._order.indexOf(p);this._order.splice(A,1);var w=y?this._order.indexOf(y):this._order.length;y&&w===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+y+'" does not exist on this map.'))):(this._order.splice(w,0,p),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},d.prototype.removeLayer=function(p){this._checkLoaded();var y=this._layers[p];if(y){y.setEventedParent(null);var A=this._order.indexOf(p);this._order.splice(A,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=y,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],y.onRemove&&y.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},d.prototype.getLayer=function(p){return this._layers[p]},d.prototype.hasLayer=function(p){return p in this._layers},d.prototype.setLayerZoomRange=function(p,y,A){this._checkLoaded();var w=this.getLayer(p);w?w.minzoom===y&&w.maxzoom===A||(y!=null&&(w.minzoom=y),A!=null&&(w.maxzoom=A),this._updateLayer(w)):this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},d.prototype.setFilter=function(p,y,A){A===void 0&&(A={}),this._checkLoaded();var w=this.getLayer(p);if(w){if(!v.deepEqual(w.filter,y))return y==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(v.validateStyle.filter,"layers."+w.id+".filter",y,null,A)||(w.filter=v.clone$1(y),this._updateLayer(w)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},d.prototype.getFilter=function(p){return v.clone$1(this.getLayer(p).filter)},d.prototype.setLayoutProperty=function(p,y,A,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(p);M?v.deepEqual(M.getLayoutProperty(y),A)||(M.setLayoutProperty(y,A,w),this._updateLayer(M)):this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getLayoutProperty=function(p,y){var A=this.getLayer(p);if(A)return A.getLayoutProperty(y);this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},d.prototype.setPaintProperty=function(p,y,A,w){w===void 0&&(w={}),this._checkLoaded();var M=this.getLayer(p);M?v.deepEqual(M.getPaintProperty(y),A)||(M.setPaintProperty(y,A,w)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},d.prototype.getPaintProperty=function(p,y){return this.getLayer(p).getPaintProperty(y)},d.prototype.setFeatureState=function(p,y){this._checkLoaded();var A=p.source,w=p.sourceLayer,M=this.sourceCaches[A];if(M!==void 0){var k=M.getSource().type;k==="geojson"&&w?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||w?(p.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(w,p.id,y)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+A+"' does not exist in the map's style.")))},d.prototype.removeFeatureState=function(p,y){this._checkLoaded();var A=p.source,w=this.sourceCaches[A];if(w!==void 0){var M=w.getSource().type,k=M==="vector"?p.sourceLayer:void 0;M!=="vector"||k?y&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(k,p.id,y):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+A+"' does not exist in the map's style.")))},d.prototype.getFeatureState=function(p){this._checkLoaded();var y=p.source,A=p.sourceLayer,w=this.sourceCaches[y];if(w!==void 0){if(w.getSource().type!=="vector"||A)return p.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(A,p.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},d.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},d.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},d.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},d.prototype._flattenAndSortRenderedFeatures=function(p){for(var y=this,A=function(Qr){return y._layers[Qr].type==="fill-extrusion"},w={},M=[],k=this._order.length-1;k>=0;k--){var G=this._order[k];if(A(G)){w[G]=k;for(var q=0,pe=p;q<pe.length;q+=1){var ye=pe[q][G];if(ye)for(var be=0,qe=ye;be<qe.length;be+=1)M.push(qe[be])}}}M.sort(function($r,Qr){return Qr.intersectionZ-$r.intersectionZ});for(var Ue=[],ht=this._order.length-1;ht>=0;ht--){var We=this._order[ht];if(A(We))for(var nt=M.length-1;nt>=0;nt--){var Mt=M[nt].feature;if(w[Mt.layer.id]<ht)break;Ue.push(Mt),M.pop()}else for(var Pt=0,vr=p;Pt<vr.length;Pt+=1){var rr=vr[Pt][We];if(rr)for(var br=0,wr=rr;br<wr.length;br+=1)Ue.push(wr[br].feature)}}return Ue},d.prototype.queryRenderedFeatures=function(p,y,A){y&&y.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",y.filter,null,y);var w={};if(y&&y.layers){if(!Array.isArray(y.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,k=y.layers;M<k.length;M+=1){var G=k[M],q=this._layers[G];if(!q)return this.fire(new v.ErrorEvent(new Error("The layer '"+G+"' does not exist in the map's style and cannot be queried for features."))),[];w[q.source]=!0}}var pe=[];for(var ye in y.availableImages=this._availableImages,this.sourceCaches)y.layers&&!w[ye]||pe.push(Br(this.sourceCaches[ye],this._layers,this._serializedLayers,p,y,A));return this.placement&&pe.push(function(be,qe,Ue,ht,We,nt,Mt){for(var Pt={},vr=nt.queryRenderedSymbols(ht),rr=[],br=0,wr=Object.keys(vr).map(Number);br<wr.length;br+=1)rr.push(Mt[wr[br]]);rr.sort(On);for(var $r=function(){var Wi=_n[Qr],Qi=Wi.featureIndex.lookupSymbolFeatures(vr[Wi.bucketInstanceId],qe,Wi.bucketIndex,Wi.sourceLayerIndex,We.filter,We.layers,We.availableImages,be);for(var An in Qi){var Ri=Pt[An]=Pt[An]||[],Pi=Qi[An];Pi.sort(function(ui,zi){var Ji=Wi.featureSortOrder;if(Ji){var Ao=Ji.indexOf(ui.featureIndex);return Ji.indexOf(zi.featureIndex)-Ao}return zi.featureIndex-ui.featureIndex});for(var Xn=0,Ii=Pi;Xn<Ii.length;Xn+=1)Ri.push(Ii[Xn])}},Qr=0,_n=rr;Qr<_n.length;Qr+=1)$r();var Ln=function(Wi){Pt[Wi].forEach(function(Qi){var An=Qi.feature,Ri=Ue[be[Wi].source].getFeatureState(An.layer["source-layer"],An.id);An.source=An.layer.source,An.layer["source-layer"]&&(An.sourceLayer=An.layer["source-layer"]),An.state=Ri})};for(var si in Pt)Ln(si);return Pt}(this._layers,this._serializedLayers,this.sourceCaches,p,y,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(pe)},d.prototype.querySourceFeatures=function(p,y){y&&y.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",y.filter,null,y);var A=this.sourceCaches[p];return A?function(w,M){for(var k=w.getRenderableIds().map(function(qe){return w.getTileByID(qe)}),G=[],q={},pe=0;pe<k.length;pe++){var ye=k[pe],be=ye.tileID.canonical.key;q[be]||(q[be]=!0,ye.querySourceFeatures(G,M))}return G}(A,y):[]},d.prototype.addSourceType=function(p,y,A){return d.getSourceType(p)?A(new Error('A source type called "'+p+'" already exists.')):(d.setSourceType(p,y),y.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:y.workerSourceURL},A):A(null,null))},d.prototype.getLight=function(){return this.light.getLight()},d.prototype.setLight=function(p,y){y===void 0&&(y={}),this._checkLoaded();var A=this.light.getLight(),w=!1;for(var M in p)if(!v.deepEqual(p[M],A[M])){w=!0;break}if(w){var k={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,y),this.light.updateTransitions(k)}},d.prototype._validate=function(p,y,A,w,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&Gu(this,p.call(v.validateStyle,v.extend({key:y,style:this.serialize(),value:A,styleSpec:v.styleSpec},w)))},d.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var y in this.sourceCaches)this.sourceCaches[y].clearTiles(),this.sourceCaches[y].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},d.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},d.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},d.prototype._updateSources=function(p){for(var y in this.sourceCaches)this.sourceCaches[y].update(p)},d.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},d.prototype._updatePlacement=function(p,y,A,w,M){M===void 0&&(M=!1);for(var k=!1,G=!1,q={},pe=0,ye=this._order;pe<ye.length;pe+=1){var be=this._layers[ye[pe]];if(be.type==="symbol"){if(!q[be.source]){var qe=this.sourceCaches[be.source];q[be.source]=qe.getRenderableIds(!0).map(function(Mt){return qe.getTileByID(Mt)}).sort(function(Mt,Pt){return Pt.tileID.overscaledZ-Mt.tileID.overscaledZ||(Mt.tileID.isLessThan(Pt.tileID)?-1:1)})}var Ue=this.crossTileSymbolIndex.addLayer(be,q[be.source],p.center.lng);k=k||Ue}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||A===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),p.zoom))&&(this.pauseablePlacement=new Dc(p,this._order,M,y,A,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,q),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),G=!0),k&&this.pauseablePlacement.placement.setStale()),G||k)for(var ht=0,We=this._order;ht<We.length;ht+=1){var nt=this._layers[We[ht]];nt.type==="symbol"&&this.placement.updateLayerOpacities(nt,q[nt.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},d.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},d.prototype.getImages=function(p,y,A){this.imageManager.getImages(y.icons,A),this._updateTilesForChangedImages();var w=this.sourceCaches[y.source];w&&w.setDependencies(y.tileID.key,y.type,y.icons)},d.prototype.getGlyphs=function(p,y,A){this.glyphManager.getGlyphs(y.stacks,A)},d.prototype.getResource=function(p,y,A){return v.makeRequest(y,A)},d}(v.Evented);Rt.getSourceType=function(m){return fr[m]},Rt.setSourceType=function(m,d){fr[m]=d},Rt.registerForPluginStateChange=v.registerForPluginStateChange;var Et=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),qr=ba(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Zr=ba(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ut=ba(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Fh=ba(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Kf=ba("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Bh=ba(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Fc=ba(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vf=ba("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),mf=ba("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),yp=ba("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),vd=ba(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),uc=ba(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Xu=ba(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Lh=ba(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),is=ba(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Zu=ba(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Il=ba(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ns=ba(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),lc=ba(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),mu=ba(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),kl=ba(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Zs=ba(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),$u=ba(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ul=ba(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),qf=ba(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),_p=ba(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function ba(m,d){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=d.match(/attribute ([\w]+) ([\w]+)/g),A=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=w?w.concat(A):A,k={};return{fragmentSource:m=m.replace(p,function(G,q,pe,ye,be){return k[be]=!0,q==="define"?`
#ifndef HAS_UNIFORM_u_`+be+`
varying `+pe+" "+ye+" "+be+`;
#else
uniform `+pe+" "+ye+" u_"+be+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+be+`
    `+pe+" "+ye+" "+be+" = u_"+be+`;
#endif
`}),vertexSource:d=d.replace(p,function(G,q,pe,ye,be){var qe=ye==="float"?"vec2":"vec4",Ue=be.match(/color/)?"color":qe;return k[be]?q==="define"?`
#ifndef HAS_UNIFORM_u_`+be+`
uniform lowp float u_`+be+`_t;
attribute `+pe+" "+qe+" a_"+be+`;
varying `+pe+" "+ye+" "+be+`;
#else
uniform `+pe+" "+ye+" u_"+be+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+be+`
    `+be+" = a_"+be+`;
#else
    `+pe+" "+ye+" "+be+" = u_"+be+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+be+`
    `+be+" = unpack_mix_"+Ue+"(a_"+be+", u_"+be+`_t);
#else
    `+pe+" "+ye+" "+be+" = u_"+be+`;
#endif
`:q==="define"?`
#ifndef HAS_UNIFORM_u_`+be+`
uniform lowp float u_`+be+`_t;
attribute `+pe+" "+qe+" a_"+be+`;
#else
uniform `+pe+" "+ye+" u_"+be+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+be+`
    `+pe+" "+ye+" "+be+" = a_"+be+`;
#else
    `+pe+" "+ye+" "+be+" = u_"+be+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+be+`
    `+pe+" "+ye+" "+be+" = unpack_mix_"+Ue+"(a_"+be+", u_"+be+`_t);
#else
    `+pe+" "+ye+" "+be+" = u_"+be+`;
#endif
`}),staticAttributes:y,staticUniforms:M}}var Qf=Object.freeze({__proto__:null,prelude:qr,background:Zr,backgroundPattern:ut,circle:Fh,clippingMask:Kf,heatmap:Bh,heatmapTexture:Fc,collisionBox:vf,collisionCircle:mf,debug:yp,fill:vd,fillOutline:uc,fillOutlinePattern:Xu,fillPattern:Lh,fillExtrusion:is,fillExtrusionPattern:Zu,hillshadePrepare:Il,hillshade:Ns,line:lc,lineGradient:mu,linePattern:kl,lineSDF:Zs,raster:$u,symbolIcon:ul,symbolSDF:qf,symbolTextAndIcon:_p}),gf=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function yf(m){for(var d=[],p=0;p<m.length;p++)if(m[p]!==null){var y=m[p].split(" ");d.push(y.pop())}return d}gf.prototype.bind=function(m,d,p,y,A,w,M,k){this.context=m;for(var G=this.boundPaintVertexBuffers.length!==y.length,q=0;!G&&q<y.length;q++)this.boundPaintVertexBuffers[q]!==y[q]&&(G=!0);m.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===p&&!G&&this.boundIndexBuffer===A&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===k?(m.bindVertexArrayOES.set(this.vao),M&&M.bind(),A&&A.dynamicDraw&&A.bind(),k&&k.bind()):this.freshBind(d,p,y,A,w,M,k)},gf.prototype.freshBind=function(m,d,p,y,A,w,M){var k,G=m.numAttributes,q=this.context,pe=q.gl;if(q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=q.extVertexArrayObject.createVertexArrayOES(),q.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=m,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=M;else{k=q.currentNumAttributes||0;for(var ye=G;ye<k;ye++)pe.disableVertexAttribArray(ye)}d.enableAttributes(pe,m);for(var be=0,qe=p;be<qe.length;be+=1)qe[be].enableAttributes(pe,m);w&&w.enableAttributes(pe,m),M&&M.enableAttributes(pe,m),d.bind(),d.setVertexAttribPointers(pe,m,A);for(var Ue=0,ht=p;Ue<ht.length;Ue+=1){var We=ht[Ue];We.bind(),We.setVertexAttribPointers(pe,m,A)}w&&(w.bind(),w.setVertexAttribPointers(pe,m,A)),y&&y.bind(),M&&(M.bind(),M.setVertexAttribPointers(pe,m,A)),q.currentNumAttributes=G},gf.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var oo=function(d,p,y,A,w,M){var k=d.gl;this.program=k.createProgram();for(var G=yf(y.staticAttributes),q=A?A.getBinderAttributes():[],pe=G.concat(q),ye=y.staticUniforms?yf(y.staticUniforms):[],be=A?A.getBinderUniforms():[],qe=[],Ue=0,ht=ye.concat(be);Ue<ht.length;Ue+=1){var We=ht[Ue];qe.indexOf(We)<0&&qe.push(We)}var nt=A?A.defines():[];M&&nt.push("#define OVERDRAW_INSPECTOR;");var Mt=nt.concat(qr.fragmentSource,y.fragmentSource).join(`
`),Pt=nt.concat(qr.vertexSource,y.vertexSource).join(`
`),vr=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(vr,Mt),k.compileShader(vr),k.attachShader(this.program,vr);var rr=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(rr,Pt),k.compileShader(rr),k.attachShader(this.program,rr),this.attributes={};var br={};this.numAttributes=pe.length;for(var wr=0;wr<this.numAttributes;wr++)pe[wr]&&(k.bindAttribLocation(this.program,wr,pe[wr]),this.attributes[pe[wr]]=wr);k.linkProgram(this.program),k.deleteShader(rr),k.deleteShader(vr);for(var $r=0;$r<qe.length;$r++){var Qr=qe[$r];if(Qr&&!br[Qr]){var _n=k.getUniformLocation(this.program,Qr);_n&&(br[Qr]=_n)}}this.fixedUniforms=w(d,br),this.binderUniforms=A?A.getUniforms(d,br):[]}}};function cc(m,d,p){var y=1/Ta(p,1,d.transform.tileZoom),A=Math.pow(2,p.tileID.overscaledZ),w=p.tileSize*Math.pow(2,d.transform.tileZoom)/A,M=w*(p.tileID.canonical.x+p.tileID.wrap*A),k=w*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[y,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[M>>16,k>>16],u_pixel_coord_lower:[65535&M,65535&k]}}oo.prototype.draw=function(m,d,p,y,A,w,M,k,G,q,pe,ye,be,qe,Ue,ht){var We,nt=m.gl;if(!this.failedToCreate){for(var Mt in m.program.set(this.program),m.setDepthMode(p),m.setStencilMode(y),m.setColorMode(A),m.setCullFace(w),this.fixedUniforms)this.fixedUniforms[Mt].set(M[Mt]);qe&&qe.setUniforms(m,this.binderUniforms,ye,{zoom:be});for(var Pt=(We={},We[nt.LINES]=2,We[nt.TRIANGLES]=3,We[nt.LINE_STRIP]=1,We)[d],vr=0,rr=pe.get();vr<rr.length;vr+=1){var br=rr[vr],wr=br.vaos||(br.vaos={});(wr[k]||(wr[k]=new gf)).bind(m,this,G,qe?qe.getPaintVertexBuffers():[],q,br.vertexOffset,Ue,ht),nt.drawElements(d,br.primitiveLength*Pt,nt.UNSIGNED_SHORT,br.primitiveOffset*Pt*2)}}};var Bc=function(d,p,y,A){var w=p.style.light,M=w.properties.get("position"),k=[M.x,M.y,M.z],G=v.create$1();w.properties.get("anchor")==="viewport"&&v.fromRotation(G,-p.transform.angle),v.transformMat3(k,k,G);var q=w.properties.get("color");return{u_matrix:d,u_lightpos:k,u_lightintensity:w.properties.get("intensity"),u_lightcolor:[q.r,q.g,q.b],u_vertical_gradient:+y,u_opacity:A}},as=function(d,p,y,A,w,M,k){return v.extend(Bc(d,p,y,A),cc(M,p,k),{u_height_factor:-Math.pow(2,w.overscaledZ)/k.tileSize/8})},$s=function(d){return{u_matrix:d}},Ys=function(d,p,y,A){return v.extend($s(d),cc(y,p,A))},_s=function(d,p){return{u_matrix:d,u_world:p}},Jf=function(d,p,y,A,w){return v.extend(Ys(d,p,y,A),{u_world:w})},Lc=function(d,p,y,A){var w,M,k=d.transform;if(A.paint.get("circle-pitch-alignment")==="map"){var G=Ta(y,1,k.zoom);w=!0,M=[G,G]}else w=!1,M=k.pixelsToGLUnits;return{u_camera_to_center_distance:k.cameraToCenterDistance,u_scale_with_map:+(A.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(p.posMatrix,y,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:M}},Ou=function(d,p,y){var A=Ta(y,1,p.zoom),w=Math.pow(2,p.zoom-y.tileID.overscaledZ),M=y.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:p.cameraToCenterDistance,u_pixels_to_tile_units:A,u_extrude_scale:[p.pixelsToGLUnits[0]/(A*w),p.pixelsToGLUnits[1]/(A*w)],u_overscale_factor:M}},_f=function(d,p,y){return{u_matrix:d,u_inv_matrix:p,u_camera_to_center_distance:y.cameraToCenterDistance,u_viewport_size:[y.width,y.height]}},Dl=function(d,p,y){return y===void 0&&(y=1),{u_matrix:d,u_color:p,u_overlay:0,u_overlay_scale:y}},ll=function(d){return{u_matrix:d}},Nh=function(d,p,y,A){return{u_matrix:d,u_extrude_scale:Ta(p,1,y),u_intensity:A}},Nc=function(d,p,y){var A=d.transform;return{u_matrix:jc(d,p,y),u_ratio:1/Ta(p,1,A.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},ka=function(d,p,y,A){return v.extend(Nc(d,p,y),{u_image:0,u_image_height:A})},eh=function(d,p,y,A){var w=d.transform,M=Ks(p,w);return{u_matrix:jc(d,p,y),u_texsize:p.imageAtlasTexture.size,u_ratio:1/Ta(p,1,w.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[M,A.fromScale,A.toScale],u_fade:A.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},bp=function(d,p,y,A,w){var M=d.lineAtlas,k=Ks(p,d.transform),G=y.layout.get("line-cap")==="round",q=M.getDash(A.from,G),pe=M.getDash(A.to,G),ye=q.width*w.fromScale,be=pe.width*w.toScale;return v.extend(Nc(d,p,y),{u_patternscale_a:[k/ye,-q.height/2],u_patternscale_b:[k/be,-pe.height/2],u_sdfgamma:M.width/(256*Math.min(ye,be)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:q.y,u_tex_y_b:pe.y,u_mix:w.t})};function Ks(m,d){return 1/Ta(m,1,d.tileZoom)}function jc(m,d,p){return m.translatePosMatrix(d.tileID.posMatrix,d,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var zc=function(d,p,y,A,w){return{u_matrix:d,u_tl_parent:p,u_scale_parent:y,u_buffer_scale:1,u_fade_t:A.mix,u_opacity:A.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(k=w.paint.get("raster-saturation"),k>0?1-1/(1.001-k):-k),u_contrast_factor:(M=w.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:th(w.paint.get("raster-hue-rotate"))};var M,k};function th(m){m*=Math.PI/180;var d=Math.sin(m),p=Math.cos(m);return[(2*p+1)/3,(-Math.sqrt(3)*d-p+1)/3,(Math.sqrt(3)*d-p+1)/3]}var gu,Bo=function(d,p,y,A,w,M,k,G,q,pe){var ye=w.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:p?p.uSizeT:0,u_size:p?p.uSize:0,u_camera_to_center_distance:ye.cameraToCenterDistance,u_pitch:ye.pitch/360*2*Math.PI,u_rotate_symbol:+y,u_aspect_ratio:ye.width/ye.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:k,u_coord_matrix:G,u_is_text:+q,u_pitch_with_map:+A,u_texsize:pe,u_texture:0}},Fl=function(d,p,y,A,w,M,k,G,q,pe,ye){var be=w.transform;return v.extend(Bo(d,p,y,A,w,M,k,G,q,pe),{u_gamma_scale:A?Math.cos(be._pitch)*be.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+ye})},fc=function(d,p,y,A,w,M,k,G,q,pe){return v.extend(Fl(d,p,y,A,w,M,k,G,!0,q,!0),{u_texsize_icon:pe,u_texture_icon:1})},cl=function(d,p,y){return{u_matrix:d,u_opacity:p,u_color:y}},Bl=function(d,p,y,A,w,M){return v.extend(function(k,G,q,pe){var ye=q.imageManager.getPattern(k.from.toString()),be=q.imageManager.getPattern(k.to.toString()),qe=q.imageManager.getPixelSize(),Ue=qe.width,ht=qe.height,We=Math.pow(2,pe.tileID.overscaledZ),nt=pe.tileSize*Math.pow(2,q.transform.tileZoom)/We,Mt=nt*(pe.tileID.canonical.x+pe.tileID.wrap*We),Pt=nt*pe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:be.tl,u_pattern_br_b:be.br,u_texsize:[Ue,ht],u_mix:G.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:be.displaySize,u_scale_a:G.fromScale,u_scale_b:G.toScale,u_tile_units_to_pixels:1/Ta(pe,1,q.transform.tileZoom),u_pixel_coord_upper:[Mt>>16,Pt>>16],u_pixel_coord_lower:[65535&Mt,65535&Pt]}}(A,M,y,w),{u_matrix:d,u_opacity:p})},rh={fillExtrusion:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_lightpos:new v.Uniform3f(d,p.u_lightpos),u_lightintensity:new v.Uniform1f(d,p.u_lightintensity),u_lightcolor:new v.Uniform3f(d,p.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,p.u_vertical_gradient),u_opacity:new v.Uniform1f(d,p.u_opacity)}},fillExtrusionPattern:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_lightpos:new v.Uniform3f(d,p.u_lightpos),u_lightintensity:new v.Uniform1f(d,p.u_lightintensity),u_lightcolor:new v.Uniform3f(d,p.u_lightcolor),u_vertical_gradient:new v.Uniform1f(d,p.u_vertical_gradient),u_height_factor:new v.Uniform1f(d,p.u_height_factor),u_image:new v.Uniform1i(d,p.u_image),u_texsize:new v.Uniform2f(d,p.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,p.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,p.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,p.u_scale),u_fade:new v.Uniform1f(d,p.u_fade),u_opacity:new v.Uniform1f(d,p.u_opacity)}},fill:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix)}},fillPattern:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_image:new v.Uniform1i(d,p.u_image),u_texsize:new v.Uniform2f(d,p.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,p.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,p.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,p.u_scale),u_fade:new v.Uniform1f(d,p.u_fade)}},fillOutline:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_world:new v.Uniform2f(d,p.u_world)}},fillOutlinePattern:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_world:new v.Uniform2f(d,p.u_world),u_image:new v.Uniform1i(d,p.u_image),u_texsize:new v.Uniform2f(d,p.u_texsize),u_pixel_coord_upper:new v.Uniform2f(d,p.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,p.u_pixel_coord_lower),u_scale:new v.Uniform3f(d,p.u_scale),u_fade:new v.Uniform1f(d,p.u_fade)}},circle:function(d,p){return{u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(d,p.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(d,p.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(d,p.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(d,p.u_matrix)}},collisionBox:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(d,p.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(d,p.u_extrude_scale),u_overscale_factor:new v.Uniform1f(d,p.u_overscale_factor)}},collisionCircle:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_inv_matrix:new v.UniformMatrix4f(d,p.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(d,p.u_viewport_size)}},debug:function(d,p){return{u_color:new v.UniformColor(d,p.u_color),u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_overlay:new v.Uniform1i(d,p.u_overlay),u_overlay_scale:new v.Uniform1f(d,p.u_overlay_scale)}},clippingMask:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix)}},heatmap:function(d,p){return{u_extrude_scale:new v.Uniform1f(d,p.u_extrude_scale),u_intensity:new v.Uniform1f(d,p.u_intensity),u_matrix:new v.UniformMatrix4f(d,p.u_matrix)}},heatmapTexture:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_world:new v.Uniform2f(d,p.u_world),u_image:new v.Uniform1i(d,p.u_image),u_color_ramp:new v.Uniform1i(d,p.u_color_ramp),u_opacity:new v.Uniform1f(d,p.u_opacity)}},hillshade:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_image:new v.Uniform1i(d,p.u_image),u_latrange:new v.Uniform2f(d,p.u_latrange),u_light:new v.Uniform2f(d,p.u_light),u_shadow:new v.UniformColor(d,p.u_shadow),u_highlight:new v.UniformColor(d,p.u_highlight),u_accent:new v.UniformColor(d,p.u_accent)}},hillshadePrepare:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_image:new v.Uniform1i(d,p.u_image),u_dimension:new v.Uniform2f(d,p.u_dimension),u_zoom:new v.Uniform1f(d,p.u_zoom),u_unpack:new v.Uniform4f(d,p.u_unpack)}},line:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_ratio:new v.Uniform1f(d,p.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,p.u_units_to_pixels)}},lineGradient:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_ratio:new v.Uniform1f(d,p.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,p.u_units_to_pixels),u_image:new v.Uniform1i(d,p.u_image),u_image_height:new v.Uniform1f(d,p.u_image_height)}},linePattern:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_texsize:new v.Uniform2f(d,p.u_texsize),u_ratio:new v.Uniform1f(d,p.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_image:new v.Uniform1i(d,p.u_image),u_units_to_pixels:new v.Uniform2f(d,p.u_units_to_pixels),u_scale:new v.Uniform3f(d,p.u_scale),u_fade:new v.Uniform1f(d,p.u_fade)}},lineSDF:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_ratio:new v.Uniform1f(d,p.u_ratio),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(d,p.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(d,p.u_patternscale_a),u_patternscale_b:new v.Uniform2f(d,p.u_patternscale_b),u_sdfgamma:new v.Uniform1f(d,p.u_sdfgamma),u_image:new v.Uniform1i(d,p.u_image),u_tex_y_a:new v.Uniform1f(d,p.u_tex_y_a),u_tex_y_b:new v.Uniform1f(d,p.u_tex_y_b),u_mix:new v.Uniform1f(d,p.u_mix)}},raster:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_tl_parent:new v.Uniform2f(d,p.u_tl_parent),u_scale_parent:new v.Uniform1f(d,p.u_scale_parent),u_buffer_scale:new v.Uniform1f(d,p.u_buffer_scale),u_fade_t:new v.Uniform1f(d,p.u_fade_t),u_opacity:new v.Uniform1f(d,p.u_opacity),u_image0:new v.Uniform1i(d,p.u_image0),u_image1:new v.Uniform1i(d,p.u_image1),u_brightness_low:new v.Uniform1f(d,p.u_brightness_low),u_brightness_high:new v.Uniform1f(d,p.u_brightness_high),u_saturation_factor:new v.Uniform1f(d,p.u_saturation_factor),u_contrast_factor:new v.Uniform1f(d,p.u_contrast_factor),u_spin_weights:new v.Uniform3f(d,p.u_spin_weights)}},symbolIcon:function(d,p){return{u_is_size_zoom_constant:new v.Uniform1i(d,p.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,p.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,p.u_size_t),u_size:new v.Uniform1f(d,p.u_size),u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,p.u_pitch),u_rotate_symbol:new v.Uniform1i(d,p.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,p.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,p.u_fade_change),u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,p.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,p.u_coord_matrix),u_is_text:new v.Uniform1i(d,p.u_is_text),u_pitch_with_map:new v.Uniform1i(d,p.u_pitch_with_map),u_texsize:new v.Uniform2f(d,p.u_texsize),u_texture:new v.Uniform1i(d,p.u_texture)}},symbolSDF:function(d,p){return{u_is_size_zoom_constant:new v.Uniform1i(d,p.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,p.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,p.u_size_t),u_size:new v.Uniform1f(d,p.u_size),u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,p.u_pitch),u_rotate_symbol:new v.Uniform1i(d,p.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,p.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,p.u_fade_change),u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,p.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,p.u_coord_matrix),u_is_text:new v.Uniform1i(d,p.u_is_text),u_pitch_with_map:new v.Uniform1i(d,p.u_pitch_with_map),u_texsize:new v.Uniform2f(d,p.u_texsize),u_texture:new v.Uniform1i(d,p.u_texture),u_gamma_scale:new v.Uniform1f(d,p.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,p.u_is_halo)}},symbolTextAndIcon:function(d,p){return{u_is_size_zoom_constant:new v.Uniform1i(d,p.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(d,p.u_is_size_feature_constant),u_size_t:new v.Uniform1f(d,p.u_size_t),u_size:new v.Uniform1f(d,p.u_size),u_camera_to_center_distance:new v.Uniform1f(d,p.u_camera_to_center_distance),u_pitch:new v.Uniform1f(d,p.u_pitch),u_rotate_symbol:new v.Uniform1i(d,p.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(d,p.u_aspect_ratio),u_fade_change:new v.Uniform1f(d,p.u_fade_change),u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(d,p.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(d,p.u_coord_matrix),u_is_text:new v.Uniform1i(d,p.u_is_text),u_pitch_with_map:new v.Uniform1i(d,p.u_pitch_with_map),u_texsize:new v.Uniform2f(d,p.u_texsize),u_texsize_icon:new v.Uniform2f(d,p.u_texsize_icon),u_texture:new v.Uniform1i(d,p.u_texture),u_texture_icon:new v.Uniform1i(d,p.u_texture_icon),u_gamma_scale:new v.Uniform1f(d,p.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(d,p.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(d,p.u_is_halo)}},background:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_opacity:new v.Uniform1f(d,p.u_opacity),u_color:new v.UniformColor(d,p.u_color)}},backgroundPattern:function(d,p){return{u_matrix:new v.UniformMatrix4f(d,p.u_matrix),u_opacity:new v.Uniform1f(d,p.u_opacity),u_image:new v.Uniform1i(d,p.u_image),u_pattern_tl_a:new v.Uniform2f(d,p.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(d,p.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(d,p.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(d,p.u_pattern_br_b),u_texsize:new v.Uniform2f(d,p.u_texsize),u_mix:new v.Uniform1f(d,p.u_mix),u_pattern_size_a:new v.Uniform2f(d,p.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(d,p.u_pattern_size_b),u_scale_a:new v.Uniform1f(d,p.u_scale_a),u_scale_b:new v.Uniform1f(d,p.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(d,p.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(d,p.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(d,p.u_tile_units_to_pixels)}}};function hc(m,d,p,y,A,w,M){for(var k=m.context,G=k.gl,q=m.useProgram("collisionBox"),pe=[],ye=0,be=0,qe=0;qe<y.length;qe++){var Ue=y[qe],ht=d.getTile(Ue),We=ht.getBucket(p);if(We){var nt=Ue.posMatrix;A[0]===0&&A[1]===0||(nt=m.translatePosMatrix(Ue.posMatrix,ht,A,w));var Mt=M?We.textCollisionBox:We.iconCollisionBox,Pt=We.collisionCircleArray;if(Pt.length>0){var vr=v.create(),rr=nt;v.mul(vr,We.placementInvProjMatrix,m.transform.glCoordMatrix),v.mul(vr,vr,We.placementViewportMatrix),pe.push({circleArray:Pt,circleOffset:be,transform:rr,invTransform:vr}),be=ye+=Pt.length/4}Mt&&q.draw(k,G.LINES,Se.disabled,Le.disabled,m.colorModeForRenderPass(),St.disabled,Ou(nt,m.transform,ht),p.id,Mt.layoutVertexBuffer,Mt.indexBuffer,Mt.segments,null,m.transform.zoom,null,null,Mt.collisionVertexBuffer)}}if(M&&pe.length){var br=m.useProgram("collisionCircle"),wr=new v.StructArrayLayout2f1f2i16;wr.resize(4*ye),wr._trim();for(var $r=0,Qr=0,_n=pe;Qr<_n.length;Qr+=1)for(var Ln=_n[Qr],si=0;si<Ln.circleArray.length/4;si++){var hi=4*si,Wi=Ln.circleArray[hi+0],Qi=Ln.circleArray[hi+1],An=Ln.circleArray[hi+2],Ri=Ln.circleArray[hi+3];wr.emplace($r++,Wi,Qi,An,Ri,0),wr.emplace($r++,Wi,Qi,An,Ri,1),wr.emplace($r++,Wi,Qi,An,Ri,2),wr.emplace($r++,Wi,Qi,An,Ri,3)}(!gu||gu.length<2*ye)&&(gu=function(Ao){var so=2*Ao,Mo=new v.StructArrayLayout3ui6;Mo.resize(so),Mo._trim();for(var Ya=0;Ya<so;Ya++){var Ka=6*Ya;Mo.uint16[Ka+0]=4*Ya+0,Mo.uint16[Ka+1]=4*Ya+1,Mo.uint16[Ka+2]=4*Ya+2,Mo.uint16[Ka+3]=4*Ya+2,Mo.uint16[Ka+4]=4*Ya+3,Mo.uint16[Ka+5]=4*Ya+0}return Mo}(ye));for(var Pi=k.createIndexBuffer(gu,!0),Xn=k.createVertexBuffer(wr,v.collisionCircleLayout.members,!0),Ii=0,ui=pe;Ii<ui.length;Ii+=1){var zi=ui[Ii],Ji=_f(zi.transform,zi.invTransform,m.transform);br.draw(k,G.TRIANGLES,Se.disabled,Le.disabled,m.colorModeForRenderPass(),St.disabled,Ji,p.id,Xn,Pi,v.SegmentVector.simpleSegment(0,2*zi.circleOffset,zi.circleArray.length,zi.circleArray.length/2),null,m.transform.zoom,null,null,null)}Xn.destroy(),Pi.destroy()}}var Ro=v.identity(new Float32Array(16));function bf(m,d,p,y,A,w){var M=v.getAnchorAlignment(m),k=-(M.horizontalAlign-.5)*d,G=-(M.verticalAlign-.5)*p,q=v.evaluateVariableOffset(m,y);return new v.Point((k/A+q[0])*w,(G/A+q[1])*w)}function xp(m,d,p,y,A,w,M,k,G,q,pe){var ye=m.text.placedSymbolArray,be=m.text.dynamicLayoutVertexArray,qe=m.icon.dynamicLayoutVertexArray,Ue={};be.clear();for(var ht=0;ht<ye.length;ht++){var We=ye.get(ht),nt=We.hidden||!We.crossTileID||m.allowVerticalPlacement&&!We.placedOrientation?null:y[We.crossTileID];if(nt){var Mt=new v.Point(We.anchorX,We.anchorY),Pt=Zi(Mt,p?k:M),vr=gi(w.cameraToCenterDistance,Pt.signedDistanceFromCamera),rr=A.evaluateSizeForFeature(m.textSizeData,q,We)*vr/v.ONE_EM;p&&(rr*=m.tilePixelRatio/G);for(var br=bf(nt.anchor,nt.width,nt.height,nt.textOffset,nt.textBoxScale,rr),wr=p?Zi(Mt.add(br),M).point:Pt.point.add(d?br.rotate(-w.angle):br),$r=m.allowVerticalPlacement&&We.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Qr=0;Qr<We.numGlyphs;Qr++)v.addDynamicAttributes(be,wr,$r);pe&&We.associatedIconIndex>=0&&(Ue[We.associatedIconIndex]={shiftedAnchor:wr,angle:$r})}else Zo(We.numGlyphs,be)}if(pe){qe.clear();for(var _n=m.icon.placedSymbolArray,Ln=0;Ln<_n.length;Ln++){var si=_n.get(Ln);if(si.hidden)Zo(si.numGlyphs,qe);else{var hi=Ue[Ln];if(hi)for(var Wi=0;Wi<si.numGlyphs;Wi++)v.addDynamicAttributes(qe,hi.shiftedAnchor,hi.angle);else Zo(si.numGlyphs,qe)}}m.icon.dynamicLayoutVertexBuffer.updateData(qe)}m.text.dynamicLayoutVertexBuffer.updateData(be)}function oa(m,d,p){return p.iconsInText&&d?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function qs(m,d,p,y,A,w,M,k,G,q,pe,ye){for(var be=m.context,qe=be.gl,Ue=m.transform,ht=k==="map",We=G==="map",nt=ht&&p.layout.get("symbol-placement")!=="point",Mt=ht&&!We&&!nt,Pt=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,vr=!1,rr=m.depthModeForSublayer(0,Se.ReadOnly),br=p.layout.get("text-variable-anchor"),wr=[],$r=0,Qr=y;$r<Qr.length;$r+=1){var _n=Qr[$r],Ln=d.getTile(_n),si=Ln.getBucket(p);if(si){var hi=A?si.text:si.icon;if(hi&&hi.segments.get().length){var Wi=hi.programConfigurations.get(p.id),Qi=A||si.sdfIcons,An=A?si.textSizeData:si.iconSizeData,Ri=We||Ue.pitch!==0,Pi=m.useProgram(oa(Qi,A,si),Wi),Xn=v.evaluateSizeForZoom(An,Ue.zoom),Ii=void 0,ui=[0,0],zi=void 0,Ji=void 0,Ao=null,so=void 0;if(A)zi=Ln.glyphAtlasTexture,Ji=qe.LINEAR,Ii=Ln.glyphAtlasTexture.size,si.iconsInText&&(ui=Ln.imageAtlasTexture.size,Ao=Ln.imageAtlasTexture,so=Ri||m.options.rotating||m.options.zooming||An.kind==="composite"||An.kind==="camera"?qe.LINEAR:qe.NEAREST);else{var Mo=p.layout.get("icon-size").constantOr(0)!==1||si.iconsNeedLinear;zi=Ln.imageAtlasTexture,Ji=Qi||m.options.rotating||m.options.zooming||Mo||Ri?qe.LINEAR:qe.NEAREST,Ii=Ln.imageAtlasTexture.size}var Ya=Ta(Ln,1,m.transform.zoom),Ka=Xa(_n.posMatrix,We,ht,m.transform,Ya),ru=Hi(_n.posMatrix,We,ht,m.transform,Ya),ss=br&&si.hasTextData(),Qu=p.layout.get("icon-text-fit")!=="none"&&ss&&si.hasIconData();nt&&Fs(si,_n.posMatrix,m,A,Ka,ru,We,q);var Mu=m.translatePosMatrix(_n.posMatrix,Ln,w,M),us=nt||A&&br||Qu?Ro:Ka,xs=m.translatePosMatrix(ru,Ln,w,M,!0),Xl=Qi&&p.paint.get(A?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Kc={program:Pi,buffers:hi,uniformValues:Qi?si.iconsInText?fc(An.kind,Xn,Mt,We,m,Mu,us,xs,Ii,ui):Fl(An.kind,Xn,Mt,We,m,Mu,us,xs,A,Ii,!0):Bo(An.kind,Xn,Mt,We,m,Mu,us,xs,A,Ii),atlasTexture:zi,atlasTextureIcon:Ao,atlasInterpolation:Ji,atlasInterpolationIcon:so,isSDF:Qi,hasHalo:Xl};if(Pt&&si.canOverlap){vr=!0;for(var Su=0,Zl=hi.segments.get();Su<Zl.length;Su+=1){var Ju=Zl[Su];wr.push({segments:new v.SegmentVector([Ju]),sortKey:Ju.sortKey,state:Kc})}}else wr.push({segments:hi.segments,sortKey:0,state:Kc})}}}vr&&wr.sort(function(uo,nu){return uo.sortKey-nu.sortKey});for(var Xt=0,De=wr;Xt<De.length;Xt+=1){var ls=De[Xt],he=ls.state;if(be.activeTexture.set(qe.TEXTURE0),he.atlasTexture.bind(he.atlasInterpolation,qe.CLAMP_TO_EDGE),he.atlasTextureIcon&&(be.activeTexture.set(qe.TEXTURE1),he.atlasTextureIcon&&he.atlasTextureIcon.bind(he.atlasInterpolationIcon,qe.CLAMP_TO_EDGE)),he.isSDF){var Us=he.uniformValues;he.hasHalo&&(Us.u_is_halo=1,os(he.buffers,ls.segments,p,m,he.program,rr,pe,ye,Us)),Us.u_is_halo=0}os(he.buffers,ls.segments,p,m,he.program,rr,pe,ye,he.uniformValues)}}function os(m,d,p,y,A,w,M,k,G){var q=y.context;A.draw(q,q.gl.TRIANGLES,w,M,k,St.disabled,G,p.id,m.layoutVertexBuffer,m.indexBuffer,d,p.paint,y.transform.zoom,m.programConfigurations.get(p.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Ll(m,d,p,y,A,w,M){var k,G,q,pe,ye,be=m.context.gl,qe=p.paint.get("fill-pattern"),Ue=qe&&qe.constantOr(1),ht=p.getCrossfadeParameters();M?(G=Ue&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=be.LINES):(G=Ue?"fillPattern":"fill",k=be.TRIANGLES);for(var We=0,nt=y;We<nt.length;We+=1){var Mt=nt[We],Pt=d.getTile(Mt);if(!Ue||Pt.patternsLoaded()){var vr=Pt.getBucket(p);if(vr){var rr=vr.programConfigurations.get(p.id),br=m.useProgram(G,rr);Ue&&(m.context.activeTexture.set(be.TEXTURE0),Pt.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),rr.updatePaintBuffers(ht));var wr=qe.constantOr(null);if(wr&&Pt.imageAtlas){var $r=Pt.imageAtlas,Qr=$r.patternPositions[wr.to.toString()],_n=$r.patternPositions[wr.from.toString()];Qr&&_n&&rr.setConstantPatternPositions(Qr,_n)}var Ln=m.translatePosMatrix(Mt.posMatrix,Pt,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(M){pe=vr.indexBuffer2,ye=vr.segments2;var si=[be.drawingBufferWidth,be.drawingBufferHeight];q=G==="fillOutlinePattern"&&Ue?Jf(Ln,m,ht,Pt,si):_s(Ln,si)}else pe=vr.indexBuffer,ye=vr.segments,q=Ue?Ys(Ln,m,ht,Pt):$s(Ln);br.draw(m.context,k,A,m.stencilModeForClipping(Mt),w,St.disabled,q,p.id,vr.layoutVertexBuffer,pe,ye,p.paint,m.transform.zoom,rr)}}}}function xf(m,d,p,y,A,w,M){for(var k=m.context,G=k.gl,q=p.paint.get("fill-extrusion-pattern"),pe=q.constantOr(1),ye=p.getCrossfadeParameters(),be=p.paint.get("fill-extrusion-opacity"),qe=0,Ue=y;qe<Ue.length;qe+=1){var ht=Ue[qe],We=d.getTile(ht),nt=We.getBucket(p);if(nt){var Mt=nt.programConfigurations.get(p.id),Pt=m.useProgram(pe?"fillExtrusionPattern":"fillExtrusion",Mt);pe&&(m.context.activeTexture.set(G.TEXTURE0),We.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),Mt.updatePaintBuffers(ye));var vr=q.constantOr(null);if(vr&&We.imageAtlas){var rr=We.imageAtlas,br=rr.patternPositions[vr.to.toString()],wr=rr.patternPositions[vr.from.toString()];br&&wr&&Mt.setConstantPatternPositions(br,wr)}var $r=m.translatePosMatrix(ht.posMatrix,We,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Qr=p.paint.get("fill-extrusion-vertical-gradient"),_n=pe?as($r,m,Qr,be,ht,ye,We):Bc($r,m,Qr,be);Pt.draw(k,k.gl.TRIANGLES,A,w,M,St.backCCW,_n,p.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,p.paint,m.transform.zoom,Mt)}}}function Nl(m,d,p,y,A,w){var M=m.context,k=M.gl,G=d.fbo;if(G){var q=m.useProgram("hillshade");M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,G.colorAttachment.get());var pe=function(ye,be,qe){var Ue=qe.paint.get("hillshade-shadow-color"),ht=qe.paint.get("hillshade-highlight-color"),We=qe.paint.get("hillshade-accent-color"),nt=qe.paint.get("hillshade-illumination-direction")*(Math.PI/180);qe.paint.get("hillshade-illumination-anchor")==="viewport"&&(nt-=ye.transform.angle);var Mt,Pt,vr,rr=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(be.tileID.toUnwrapped(),rr),u_image:0,u_latrange:(Mt=be.tileID,Pt=Math.pow(2,Mt.canonical.z),vr=Mt.canonical.y,[new v.MercatorCoordinate(0,vr/Pt).toLngLat().lat,new v.MercatorCoordinate(0,(vr+1)/Pt).toLngLat().lat]),u_light:[qe.paint.get("hillshade-exaggeration"),nt],u_shadow:Ue,u_highlight:ht,u_accent:We}}(m,d,p);q.draw(M,k.TRIANGLES,y,A,w,St.disabled,pe,p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}}function md(m,d,p,y,A,w){var M=m.context,k=M.gl,G=d.dem;if(G&&G.data){var q=G.dim,pe=G.stride,ye=G.getPixels();if(M.activeTexture.set(k.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),d.demTexture=d.demTexture||m.getTileTexture(pe),d.demTexture){var be=d.demTexture;be.update(ye,{premultiply:!1}),be.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else d.demTexture=new v.Texture(M,ye,k.RGBA,{premultiply:!1}),d.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);M.activeTexture.set(k.TEXTURE0);var qe=d.fbo;if(!qe){var Ue=new v.Texture(M,{width:q,height:q,data:null},k.RGBA);Ue.bind(k.LINEAR,k.CLAMP_TO_EDGE),(qe=d.fbo=M.createFramebuffer(q,q,!0)).colorAttachment.set(Ue.texture)}M.bindFramebuffer.set(qe.framebuffer),M.viewport.set([0,0,q,q]),m.useProgram("hillshadePrepare").draw(M,k.TRIANGLES,y,A,w,St.disabled,function(ht,We){var nt=We.stride,Mt=v.create();return v.ortho(Mt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Mt,Mt,[0,-v.EXTENT,0]),{u_matrix:Mt,u_image:1,u_dimension:[nt,nt],u_zoom:ht.overscaledZ,u_unpack:We.getUnpackVector()}}(d.tileID,G),p.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments),d.needsHillshadePrepare=!1}}function nh(m,d,p,y,A){var w=y.paint.get("raster-fade-duration");if(w>0){var M=v.browser.now(),k=(M-m.timeAdded)/w,G=d?(M-d.timeAdded)/w:-1,q=p.getSource(),pe=A.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),ye=!d||Math.abs(d.tileID.overscaledZ-pe)>Math.abs(m.tileID.overscaledZ-pe),be=ye&&m.refreshedUponExpiration?1:v.clamp(ye?k:1-G,0,1);return m.refreshedUponExpiration&&k>=1&&(m.refreshedUponExpiration=!1),d?{opacity:1,mix:1-be}:{opacity:be,mix:0}}return{opacity:1,mix:0}}var Ef=new v.Color(1,0,0,1),Uc=new v.Color(0,1,0,1),jl=new v.Color(0,0,1,1),pc=new v.Color(1,0,1,1),cr=new v.Color(0,1,1,1);function Bn(m,d,p,y){dc(m,0,d+p/2,m.transform.width,p,y)}function jh(m,d,p,y){dc(m,d-p/2,0,p,m.transform.height,y)}function dc(m,d,p,y,A,w){var M=m.context,k=M.gl;k.enable(k.SCISSOR_TEST),k.scissor(d*v.browser.devicePixelRatio,p*v.browser.devicePixelRatio,y*v.browser.devicePixelRatio,A*v.browser.devicePixelRatio),M.clear({color:w}),k.disable(k.SCISSOR_TEST)}function zh(m,d,p){var y=m.context,A=y.gl,w=p.posMatrix,M=m.useProgram("debug"),k=Se.disabled,G=Le.disabled,q=m.colorModeForRenderPass();y.activeTexture.set(A.TEXTURE0),m.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),M.draw(y,A.LINE_STRIP,k,G,q,St.disabled,Dl(w,v.Color.red),"$debug",m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments);var pe=d.getTileByID(p.key).latestRawTileData,ye=Math.floor((pe&&pe.byteLength||0)/1024),be=d.getTile(p).tileSize,qe=512/Math.min(be,512)*(p.overscaledZ/m.transform.zoom)*.5,Ue=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Ue+=" => "+p.overscaledZ),function(ht,We){ht.initDebugOverlayCanvas();var nt=ht.debugOverlayCanvas,Mt=ht.context.gl,Pt=ht.debugOverlayCanvas.getContext("2d");Pt.clearRect(0,0,nt.width,nt.height),Pt.shadowColor="white",Pt.shadowBlur=2,Pt.lineWidth=1.5,Pt.strokeStyle="white",Pt.textBaseline="top",Pt.font="bold 36px Open Sans, sans-serif",Pt.fillText(We,5,5),Pt.strokeText(We,5,5),ht.debugOverlayTexture.update(nt),ht.debugOverlayTexture.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE)}(m,Ue+" "+ye+"kb"),M.draw(y,A.TRIANGLES,k,G,mt.alphaBlended,St.disabled,Dl(w,v.Color.transparent,qe),"$debug",m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments)}var zl={symbol:function(d,p,y,A,w){if(d.renderPass==="translucent"){var M=Le.disabled,k=d.colorModeForRenderPass();y.layout.get("text-variable-anchor")&&function(G,q,pe,ye,be,qe,Ue){for(var ht=q.transform,We=be==="map",nt=qe==="map",Mt=0,Pt=G;Mt<Pt.length;Mt+=1){var vr=Pt[Mt],rr=ye.getTile(vr),br=rr.getBucket(pe);if(br&&br.text&&br.text.segments.get().length){var wr=v.evaluateSizeForZoom(br.textSizeData,ht.zoom),$r=Ta(rr,1,q.transform.zoom),Qr=Xa(vr.posMatrix,nt,We,q.transform,$r),_n=pe.layout.get("icon-text-fit")!=="none"&&br.hasIconData();if(wr){var Ln=Math.pow(2,ht.zoom-rr.tileID.overscaledZ);xp(br,We,nt,Ue,v.symbolSize,ht,Qr,vr.posMatrix,Ln,wr,_n)}}}}(A,d,y,p,y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),w),y.paint.get("icon-opacity").constantOr(1)!==0&&qs(d,p,y,A,!1,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),y.layout.get("icon-rotation-alignment"),y.layout.get("icon-pitch-alignment"),y.layout.get("icon-keep-upright"),M,k),y.paint.get("text-opacity").constantOr(1)!==0&&qs(d,p,y,A,!0,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),y.layout.get("text-rotation-alignment"),y.layout.get("text-pitch-alignment"),y.layout.get("text-keep-upright"),M,k),p.map.showCollisionBoxes&&(hc(d,p,y,A,y.paint.get("text-translate"),y.paint.get("text-translate-anchor"),!0),hc(d,p,y,A,y.paint.get("icon-translate"),y.paint.get("icon-translate-anchor"),!1))}},circle:function(d,p,y,A){if(d.renderPass==="translucent"){var w=y.paint.get("circle-opacity"),M=y.paint.get("circle-stroke-width"),k=y.paint.get("circle-stroke-opacity"),G=y.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)!==0||M.constantOr(1)!==0&&k.constantOr(1)!==0){for(var q=d.context,pe=q.gl,ye=d.depthModeForSublayer(0,Se.ReadOnly),be=Le.disabled,qe=d.colorModeForRenderPass(),Ue=[],ht=0;ht<A.length;ht++){var We=A[ht],nt=p.getTile(We),Mt=nt.getBucket(y);if(Mt){var Pt=Mt.programConfigurations.get(y.id),vr={programConfiguration:Pt,program:d.useProgram("circle",Pt),layoutVertexBuffer:Mt.layoutVertexBuffer,indexBuffer:Mt.indexBuffer,uniformValues:Lc(d,We,nt,y)};if(G)for(var rr=0,br=Mt.segments.get();rr<br.length;rr+=1){var wr=br[rr];Ue.push({segments:new v.SegmentVector([wr]),sortKey:wr.sortKey,state:vr})}else Ue.push({segments:Mt.segments,sortKey:0,state:vr})}}G&&Ue.sort(function(si,hi){return si.sortKey-hi.sortKey});for(var $r=0,Qr=Ue;$r<Qr.length;$r+=1){var _n=Qr[$r],Ln=_n.state;Ln.program.draw(q,pe.TRIANGLES,ye,be,qe,St.disabled,Ln.uniformValues,y.id,Ln.layoutVertexBuffer,Ln.indexBuffer,_n.segments,y.paint,d.transform.zoom,Ln.programConfiguration)}}}},heatmap:function(d,p,y,A){if(y.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){var w=d.context,M=w.gl,k=Le.disabled,G=new mt([M.ONE,M.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Ue,ht,We){var nt=Ue.gl;Ue.activeTexture.set(nt.TEXTURE1),Ue.viewport.set([0,0,ht.width/4,ht.height/4]);var Mt=We.heatmapFbo;if(Mt)nt.bindTexture(nt.TEXTURE_2D,Mt.colorAttachment.get()),Ue.bindFramebuffer.set(Mt.framebuffer);else{var Pt=nt.createTexture();nt.bindTexture(nt.TEXTURE_2D,Pt),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_S,nt.CLAMP_TO_EDGE),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_WRAP_T,nt.CLAMP_TO_EDGE),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MIN_FILTER,nt.LINEAR),nt.texParameteri(nt.TEXTURE_2D,nt.TEXTURE_MAG_FILTER,nt.LINEAR),Mt=We.heatmapFbo=Ue.createFramebuffer(ht.width/4,ht.height/4,!1),function(vr,rr,br,wr){var $r=vr.gl;$r.texImage2D($r.TEXTURE_2D,0,$r.RGBA,rr.width/4,rr.height/4,0,$r.RGBA,vr.extRenderToTextureHalfFloat?vr.extTextureHalfFloat.HALF_FLOAT_OES:$r.UNSIGNED_BYTE,null),wr.colorAttachment.set(br)}(Ue,ht,Pt,Mt)}})(w,d,y),w.clear({color:v.Color.transparent});for(var q=0;q<A.length;q++){var pe=A[q];if(!p.hasRenderableParent(pe)){var ye=p.getTile(pe),be=ye.getBucket(y);if(be){var qe=be.programConfigurations.get(y.id);d.useProgram("heatmap",qe).draw(w,M.TRIANGLES,Se.disabled,k,G,St.disabled,Nh(pe.posMatrix,ye,d.transform.zoom,y.paint.get("heatmap-intensity")),y.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,y.paint,d.transform.zoom,qe)}}}w.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(Ue,ht){var We=Ue.context,nt=We.gl,Mt=ht.heatmapFbo;if(Mt){We.activeTexture.set(nt.TEXTURE0),nt.bindTexture(nt.TEXTURE_2D,Mt.colorAttachment.get()),We.activeTexture.set(nt.TEXTURE1);var Pt=ht.colorRampTexture;Pt||(Pt=ht.colorRampTexture=new v.Texture(We,ht.colorRamp,nt.RGBA)),Pt.bind(nt.LINEAR,nt.CLAMP_TO_EDGE),Ue.useProgram("heatmapTexture").draw(We,nt.TRIANGLES,Se.disabled,Le.disabled,Ue.colorModeForRenderPass(),St.disabled,function(vr,rr,br,wr){var $r=v.create();v.ortho($r,0,vr.width,vr.height,0,0,1);var Qr=vr.context.gl;return{u_matrix:$r,u_world:[Qr.drawingBufferWidth,Qr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:rr.paint.get("heatmap-opacity")}}(Ue,ht),ht.id,Ue.viewportBuffer,Ue.quadTriangleIndexBuffer,Ue.viewportSegments,ht.paint,Ue.transform.zoom)}}(d,y))},line:function(d,p,y,A){if(d.renderPass==="translucent"){var w=y.paint.get("line-opacity"),M=y.paint.get("line-width");if(w.constantOr(1)!==0&&M.constantOr(1)!==0)for(var k=d.depthModeForSublayer(0,Se.ReadOnly),G=d.colorModeForRenderPass(),q=y.paint.get("line-dasharray"),pe=y.paint.get("line-pattern"),ye=pe.constantOr(1),be=y.paint.get("line-gradient"),qe=y.getCrossfadeParameters(),Ue=ye?"linePattern":q?"lineSDF":be?"lineGradient":"line",ht=d.context,We=ht.gl,nt=!0,Mt=0,Pt=A;Mt<Pt.length;Mt+=1){var vr=Pt[Mt],rr=p.getTile(vr);if(!ye||rr.patternsLoaded()){var br=rr.getBucket(y);if(br){var wr=br.programConfigurations.get(y.id),$r=d.context.program.get(),Qr=d.useProgram(Ue,wr),_n=nt||Qr.program!==$r,Ln=pe.constantOr(null);if(Ln&&rr.imageAtlas){var si=rr.imageAtlas,hi=si.patternPositions[Ln.to.toString()],Wi=si.patternPositions[Ln.from.toString()];hi&&Wi&&wr.setConstantPatternPositions(hi,Wi)}var Qi=ye?eh(d,rr,y,qe):q?bp(d,rr,y,q,qe):be?ka(d,rr,y,br.lineClipsArray.length):Nc(d,rr,y);if(ye)ht.activeTexture.set(We.TEXTURE0),rr.imageAtlasTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE),wr.updatePaintBuffers(qe);else if(q&&(_n||d.lineAtlas.dirty))ht.activeTexture.set(We.TEXTURE0),d.lineAtlas.bind(ht);else if(be){var An=br.gradients[y.id],Ri=An.texture;if(y.gradientVersion!==An.version){var Pi=256;if(y.stepInterpolant){var Xn=p.getSource().maxzoom,Ii=vr.canonical.z===Xn?Math.ceil(1<<d.transform.maxZoom-vr.canonical.z):1;Pi=v.clamp(v.nextPowerOfTwo(br.maxLineLength/v.EXTENT*1024*Ii),256,ht.maxTextureSize)}An.gradient=v.renderColorRamp({expression:y.gradientExpression(),evaluationKey:"lineProgress",resolution:Pi,image:An.gradient||void 0,clips:br.lineClipsArray}),An.texture?An.texture.update(An.gradient):An.texture=new v.Texture(ht,An.gradient,We.RGBA),An.version=y.gradientVersion,Ri=An.texture}ht.activeTexture.set(We.TEXTURE0),Ri.bind(y.stepInterpolant?We.NEAREST:We.LINEAR,We.CLAMP_TO_EDGE)}Qr.draw(ht,We.TRIANGLES,k,d.stencilModeForClipping(vr),G,St.disabled,Qi,y.id,br.layoutVertexBuffer,br.indexBuffer,br.segments,y.paint,d.transform.zoom,wr,br.layoutVertexBuffer2),nt=!1}}}}},fill:function(d,p,y,A){var w=y.paint.get("fill-color"),M=y.paint.get("fill-opacity");if(M.constantOr(1)!==0){var k=d.colorModeForRenderPass(),G=y.paint.get("fill-pattern"),q=d.opaquePassEnabledForLayer()&&!G.constantOr(1)&&w.constantOr(v.Color.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===q){var pe=d.depthModeForSublayer(1,d.renderPass==="opaque"?Se.ReadWrite:Se.ReadOnly);Ll(d,p,y,A,pe,k,!1)}if(d.renderPass==="translucent"&&y.paint.get("fill-antialias")){var ye=d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,Se.ReadOnly);Ll(d,p,y,A,ye,k,!0)}}},"fill-extrusion":function(d,p,y,A){var w=y.paint.get("fill-extrusion-opacity");if(w!==0&&d.renderPass==="translucent"){var M=new Se(d.context.gl.LEQUAL,Se.ReadWrite,d.depthRangeFor3D);if(w!==1||y.paint.get("fill-extrusion-pattern").constantOr(1))xf(d,p,y,A,M,Le.disabled,mt.disabled),xf(d,p,y,A,M,d.stencilModeFor3D(),d.colorModeForRenderPass());else{var k=d.colorModeForRenderPass();xf(d,p,y,A,M,Le.disabled,k)}}},hillshade:function(d,p,y,A){if(d.renderPass==="offscreen"||d.renderPass==="translucent"){for(var w=d.context,M=d.depthModeForSublayer(0,Se.ReadOnly),k=d.colorModeForRenderPass(),G=d.renderPass==="translucent"?d.stencilConfigForOverlap(A):[{},A],q=G[0],pe=0,ye=G[1];pe<ye.length;pe+=1){var be=ye[pe],qe=p.getTile(be);qe.needsHillshadePrepare&&d.renderPass==="offscreen"?md(d,qe,y,M,Le.disabled,k):d.renderPass==="translucent"&&Nl(d,qe,y,M,q[be.overscaledZ],k)}w.viewport.set([0,0,d.width,d.height])}},raster:function(d,p,y,A){if(d.renderPass==="translucent"&&y.paint.get("raster-opacity")!==0&&A.length)for(var w=d.context,M=w.gl,k=p.getSource(),G=d.useProgram("raster"),q=d.colorModeForRenderPass(),pe=k instanceof At?[{},A]:d.stencilConfigForOverlap(A),ye=pe[0],be=pe[1],qe=be[be.length-1].overscaledZ,Ue=!d.options.moving,ht=0,We=be;ht<We.length;ht+=1){var nt=We[ht],Mt=d.depthModeForSublayer(nt.overscaledZ-qe,y.paint.get("raster-opacity")===1?Se.ReadWrite:Se.ReadOnly,M.LESS),Pt=p.getTile(nt),vr=d.transform.calculatePosMatrix(nt.toUnwrapped(),Ue);Pt.registerFadeDuration(y.paint.get("raster-fade-duration"));var rr=p.findLoadedParent(nt,0),br=nh(Pt,rr,p,y,d.transform),wr=void 0,$r=void 0,Qr=y.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;w.activeTexture.set(M.TEXTURE0),Pt.texture.bind(Qr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),w.activeTexture.set(M.TEXTURE1),rr?(rr.texture.bind(Qr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),wr=Math.pow(2,rr.tileID.overscaledZ-Pt.tileID.overscaledZ),$r=[Pt.tileID.canonical.x*wr%1,Pt.tileID.canonical.y*wr%1]):Pt.texture.bind(Qr,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);var _n=zc(vr,$r||[0,0],wr||1,br,y);k instanceof At?G.draw(w,M.TRIANGLES,Mt,Le.disabled,q,St.disabled,_n,y.id,k.boundsBuffer,d.quadTriangleIndexBuffer,k.boundsSegments):G.draw(w,M.TRIANGLES,Mt,ye[nt.overscaledZ],q,St.disabled,_n,y.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,p,y){var A=y.paint.get("background-color"),w=y.paint.get("background-opacity");if(w!==0){var M=d.context,k=M.gl,G=d.transform,q=G.tileSize,pe=y.paint.get("background-pattern");if(!d.isPatternMissing(pe)){var ye=!pe&&A.a===1&&w===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass===ye){var be=Le.disabled,qe=d.depthModeForSublayer(0,ye==="opaque"?Se.ReadWrite:Se.ReadOnly),Ue=d.colorModeForRenderPass(),ht=d.useProgram(pe?"backgroundPattern":"background"),We=G.coveringTiles({tileSize:q});pe&&(M.activeTexture.set(k.TEXTURE0),d.imageManager.bind(d.context));for(var nt=y.getCrossfadeParameters(),Mt=0,Pt=We;Mt<Pt.length;Mt+=1){var vr=Pt[Mt],rr=d.transform.calculatePosMatrix(vr.toUnwrapped()),br=pe?Bl(rr,w,d,pe,{tileID:vr,tileSize:q},nt):cl(rr,w,A);ht.draw(M,k.TRIANGLES,qe,be,Ue,St.disabled,br,y.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}}}},debug:function(d,p,y){for(var A=0;A<y.length;A++)zh(d,p,y[A])},custom:function(d,p,y){var A=d.context,w=y.implementation;if(d.renderPass==="offscreen"){var M=w.prerender;M&&(d.setCustomLayerDefaults(),A.setColorMode(d.colorModeForRenderPass()),M.call(w,A.gl,d.transform.customLayerMatrix()),A.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),A.setColorMode(d.colorModeForRenderPass()),A.setStencilMode(Le.disabled);var k=w.renderingMode==="3d"?new Se(d.context.gl.LEQUAL,Se.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Se.ReadOnly);A.setDepthMode(k),w.render(A.gl,d.transform.customLayerMatrix()),A.setDirty(),d.setBaseState(),A.bindFramebuffer.set(null)}}},ja=function(d,p){this.context=new ge(d),this.transform=p,this._tileTextures={},this.setup(),this.numSublayers=Ye.maxUnderzooming+Ye.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new sc,this.gpuTimers={}};ja.prototype.resize=function(m,d){if(this.width=m*v.browser.devicePixelRatio,this.height=d*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,y=this.style._order;p<y.length;p+=1)this.style._layers[y[p]].resize()},ja.prototype.setup=function(){var m=this.context,d=new v.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(v.EXTENT,0),d.emplaceBack(0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=m.createVertexBuffer(d,Et.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var p=new v.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(v.EXTENT,0),p.emplaceBack(0,v.EXTENT),p.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=m.createVertexBuffer(p,Et.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var y=new v.StructArrayLayout4i8;y.emplaceBack(0,0,0,0),y.emplaceBack(v.EXTENT,0,v.EXTENT,0),y.emplaceBack(0,v.EXTENT,0,v.EXTENT),y.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=m.createVertexBuffer(y,vt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var A=new v.StructArrayLayout2i4;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=m.createVertexBuffer(A,Et.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var w=new v.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=m.createIndexBuffer(w);var M=new v.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=m.createIndexBuffer(M),this.emptyTexture=new v.Texture(m,{width:1,height:1,data:new Uint8Array([0,0,0,0])},m.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Le({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},ja.prototype.clearStencil=function(){var m=this.context,d=m.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=v.create();v.ortho(p,0,this.width,this.height,0,0,1),v.scale(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(m,d.TRIANGLES,Se.disabled,this.stencilClearMode,mt.disabled,St.disabled,ll(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},ja.prototype._renderTileClippingMasks=function(m,d){if(this.currentStencilSource!==m.source&&m.isTileClipped()&&d&&d.length){this.currentStencilSource=m.source;var p=this.context,y=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(mt.disabled),p.setDepthMode(Se.disabled);var A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,M=d;w<M.length;w+=1){var k=M[w],G=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;A.draw(p,y.TRIANGLES,Se.disabled,new Le({func:y.ALWAYS,mask:0},G,255,y.KEEP,y.KEEP,y.REPLACE),mt.disabled,St.disabled,ll(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},ja.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var m=this.nextStencilID++,d=this.context.gl;return new Le({func:d.NOTEQUAL,mask:255},m,255,d.KEEP,d.KEEP,d.REPLACE)},ja.prototype.stencilModeForClipping=function(m){var d=this.context.gl;return new Le({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[m.key],0,d.KEEP,d.KEEP,d.REPLACE)},ja.prototype.stencilConfigForOverlap=function(m){var d,p=this.context.gl,y=m.sort(function(G,q){return q.overscaledZ-G.overscaledZ}),A=y[y.length-1].overscaledZ,w=y[0].overscaledZ-A+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var M={},k=0;k<w;k++)M[k+A]=new Le({func:p.GEQUAL,mask:255},k+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=w,[M,y]}return[(d={},d[A]=Le.disabled,d),y]},ja.prototype.colorModeForRenderPass=function(){var m=this.context.gl;return this._showOverdrawInspector?new mt([m.CONSTANT_COLOR,m.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mt.unblended:mt.alphaBlended},ja.prototype.depthModeForSublayer=function(m,d,p){if(!this.opaquePassEnabledForLayer())return Se.disabled;var y=1-((1+this.currentLayer)*this.numSublayers+m)*this.depthEpsilon;return new Se(p||this.context.gl.LEQUAL,d,[y,y])},ja.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},ja.prototype.render=function(m,d){var p=this;this.style=m,this.options=d,this.lineAtlas=m.lineAtlas,this.imageManager=m.imageManager,this.glyphManager=m.glyphManager,this.symbolFadeChange=m.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var y=this.style._order,A=this.style.sourceCaches;for(var w in A){var M=A[w];M.used&&M.prepare(this.context)}var k,G,q={},pe={},ye={};for(var be in A){var qe=A[be];q[be]=qe.getVisibleCoordinates(),pe[be]=q[be].slice().reverse(),ye[be]=qe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ue=0;Ue<y.length;Ue++)if(this.style._layers[y[Ue]].is3D()){this.opaquePassCutoff=Ue;break}this.renderPass="offscreen";for(var ht=0,We=y;ht<We.length;ht+=1){var nt=this.style._layers[We[ht]];if(nt.hasOffscreenPass()&&!nt.isHidden(this.transform.zoom)){var Mt=pe[nt.source];(nt.type==="custom"||Mt.length)&&this.renderLayer(this,A[nt.source],nt,Mt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(m._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){var Pt=this.style._layers[y[this.currentLayer]],vr=A[Pt.source],rr=q[Pt.source];this._renderTileClippingMasks(Pt,rr),this.renderLayer(this,vr,Pt,rr)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){var br=this.style._layers[y[this.currentLayer]],wr=A[br.source],$r=(br.type==="symbol"?ye:pe)[br.source];this._renderTileClippingMasks(br,q[br.source]),this.renderLayer(this,wr,br,$r)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Qr){Qr.source&&!Qr.isHidden(p.transform.zoom)&&(Qr.source!==(G&&G.id)&&(G=p.style.sourceCaches[Qr.source]),(!k||k.getSource().maxzoom<G.getSource().maxzoom)&&(k=G))}),k&&zl.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(Qr){var _n=Qr.transform.padding;Bn(Qr,Qr.transform.height-(_n.top||0),3,Ef),Bn(Qr,_n.bottom||0,3,Uc),jh(Qr,_n.left||0,3,jl),jh(Qr,Qr.transform.width-(_n.right||0),3,pc);var Ln=Qr.transform.centerPoint;(function(si,hi,Wi,Qi){dc(si,hi-1,Wi-10,2,20,Qi),dc(si,hi-10,Wi-1,20,2,Qi)})(Qr,Ln.x,Qr.transform.height-Ln.y,cr)}(this),this.context.setDefault()},ja.prototype.renderLayer=function(m,d,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||y.length)&&(this.id=p.id,this.gpuTimingStart(p),zl[p.type](m,d,p,y,this.style.placement.variableOffsets),this.gpuTimingEnd())},ja.prototype.gpuTimingStart=function(m){if(this.options.gpuTiming){var d=this.context.extTimerQuery,p=this.gpuTimers[m.id];p||(p=this.gpuTimers[m.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),p.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,p.query)}},ja.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var m=this.context.extTimerQuery;m.endQueryEXT(m.TIME_ELAPSED_EXT)}},ja.prototype.collectGpuTimers=function(){var m=this.gpuTimers;return this.gpuTimers={},m},ja.prototype.queryGpuTimers=function(m){var d={};for(var p in m){var y=m[p],A=this.context.extTimerQuery,w=A.getQueryObjectEXT(y.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(y.query),d[p]=w}return d},ja.prototype.translatePosMatrix=function(m,d,p,y,A){if(!p[0]&&!p[1])return m;var w=A?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(w){var M=Math.sin(w),k=Math.cos(w);p=[p[0]*k-p[1]*M,p[0]*M+p[1]*k]}var G=[A?p[0]:Ta(d,p[0],this.transform.zoom),A?p[1]:Ta(d,p[1],this.transform.zoom),0],q=new Float32Array(16);return v.translate(q,m,G),q},ja.prototype.saveTileTexture=function(m){var d=this._tileTextures[m.size[0]];d?d.push(m):this._tileTextures[m.size[0]]=[m]},ja.prototype.getTileTexture=function(m){var d=this._tileTextures[m];return d&&d.length>0?d.pop():null},ja.prototype.isPatternMissing=function(m){if(!m)return!1;if(!m.from||!m.to)return!0;var d=this.imageManager.getPattern(m.from.toString()),p=this.imageManager.getPattern(m.to.toString());return!d||!p},ja.prototype.useProgram=function(m,d){this.cache=this.cache||{};var p=""+m+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new oo(this.context,m,Qf[m],d,rh[m],this._showOverdrawInspector)),this.cache[p]},ja.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},ja.prototype.setBaseState=function(){var m=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(m.FUNC_ADD)},ja.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},ja.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ih=function(d,p){this.points=d,this.planes=p};ih.fromInvProjectionMatrix=function(m,d,p){var y=Math.pow(2,p),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return v.transformMat4([],M,m)}).map(function(M){return v.scale$1([],M,1/M[3]/d*y)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var k=v.sub([],A[M[0]],A[M[1]]),G=v.sub([],A[M[2]],A[M[1]]),q=v.normalize([],v.cross([],k,G)),pe=-v.dot(q,A[M[1]]);return q.concat(pe)});return new ih(A,w)};var Yu=function(d,p){this.min=d,this.max=p,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Yu.prototype.quadrant=function(m){for(var d=[m%2==0,m<2],p=v.clone$2(this.min),y=v.clone$2(this.max),A=0;A<d.length;A++)p[A]=d[A]?this.min[A]:this.center[A],y[A]=d[A]?this.center[A]:this.max[A];return y[2]=this.max[2],new Yu(p,y)},Yu.prototype.distanceX=function(m){return Math.max(Math.min(this.max[0],m[0]),this.min[0])-m[0]},Yu.prototype.distanceY=function(m){return Math.max(Math.min(this.max[1],m[1]),this.min[1])-m[1]},Yu.prototype.intersects=function(m){for(var d=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,y=0;y<m.planes.length;y++){for(var A=m.planes[y],w=0,M=0;M<d.length;M++)w+=v.dot$1(A,d[M])>=0;if(w===0)return 0;w!==d.length&&(p=!1)}if(p)return 2;for(var k=0;k<3;k++){for(var G=Number.MAX_VALUE,q=-Number.MAX_VALUE,pe=0;pe<m.points.length;pe++){var ye=m.points[pe][k]-this.min[k];G=Math.min(G,ye),q=Math.max(q,ye)}if(q<0||G>this.max[k]-this.min[k])return 0}return 1};var Ul=function(d,p,y,A){if(d===void 0&&(d=0),p===void 0&&(p=0),y===void 0&&(y=0),A===void 0&&(A=0),isNaN(d)||d<0||isNaN(p)||p<0||isNaN(y)||y<0||isNaN(A)||A<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=d,this.bottom=p,this.left=y,this.right=A};Ul.prototype.interpolate=function(m,d,p){return d.top!=null&&m.top!=null&&(this.top=v.number(m.top,d.top,p)),d.bottom!=null&&m.bottom!=null&&(this.bottom=v.number(m.bottom,d.bottom,p)),d.left!=null&&m.left!=null&&(this.left=v.number(m.left,d.left,p)),d.right!=null&&m.right!=null&&(this.right=v.number(m.right,d.right,p)),this},Ul.prototype.getCenter=function(m,d){var p=v.clamp((this.left+m-this.right)/2,0,m),y=v.clamp((this.top+d-this.bottom)/2,0,d);return new v.Point(p,y)},Ul.prototype.equals=function(m){return this.top===m.top&&this.bottom===m.bottom&&this.left===m.left&&this.right===m.right},Ul.prototype.clone=function(){return new Ul(this.top,this.bottom,this.left,this.right)},Ul.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ra=function(d,p,y,A,w){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=w===void 0||w,this._minZoom=d||0,this._maxZoom=p||22,this._minPitch=y==null?0:y,this._maxPitch=A==null?60:A,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ul,this._posMatrixCache={},this._alignedPosMatrixCache={}},za={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ra.prototype.clone=function(){var m=new ra(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return m.tileSize=this.tileSize,m.latRange=this.latRange,m.width=this.width,m.height=this.height,m._center=this._center,m.zoom=this.zoom,m.angle=this.angle,m._fov=this._fov,m._pitch=this._pitch,m._unmodified=this._unmodified,m._edgeInsets=this._edgeInsets.clone(),m._calcMatrices(),m},za.minZoom.get=function(){return this._minZoom},za.minZoom.set=function(m){this._minZoom!==m&&(this._minZoom=m,this.zoom=Math.max(this.zoom,m))},za.maxZoom.get=function(){return this._maxZoom},za.maxZoom.set=function(m){this._maxZoom!==m&&(this._maxZoom=m,this.zoom=Math.min(this.zoom,m))},za.minPitch.get=function(){return this._minPitch},za.minPitch.set=function(m){this._minPitch!==m&&(this._minPitch=m,this.pitch=Math.max(this.pitch,m))},za.maxPitch.get=function(){return this._maxPitch},za.maxPitch.set=function(m){this._maxPitch!==m&&(this._maxPitch=m,this.pitch=Math.min(this.pitch,m))},za.renderWorldCopies.get=function(){return this._renderWorldCopies},za.renderWorldCopies.set=function(m){m===void 0?m=!0:m===null&&(m=!1),this._renderWorldCopies=m},za.worldSize.get=function(){return this.tileSize*this.scale},za.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},za.size.get=function(){return new v.Point(this.width,this.height)},za.bearing.get=function(){return-this.angle/Math.PI*180},za.bearing.set=function(m){var d=-v.wrap(m,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},za.pitch.get=function(){return this._pitch/Math.PI*180},za.pitch.set=function(m){var d=v.clamp(m,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())},za.fov.get=function(){return this._fov/Math.PI*180},za.fov.set=function(m){m=Math.max(.01,Math.min(60,m)),this._fov!==m&&(this._unmodified=!1,this._fov=m/180*Math.PI,this._calcMatrices())},za.zoom.get=function(){return this._zoom},za.zoom.set=function(m){var d=Math.min(Math.max(m,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.scale=this.zoomScale(d),this.tileZoom=Math.floor(d),this.zoomFraction=d-this.tileZoom,this._constrain(),this._calcMatrices())},za.center.get=function(){return this._center},za.center.set=function(m){m.lat===this._center.lat&&m.lng===this._center.lng||(this._unmodified=!1,this._center=m,this._constrain(),this._calcMatrices())},za.padding.get=function(){return this._edgeInsets.toJSON()},za.padding.set=function(m){this._edgeInsets.equals(m)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,m,1),this._calcMatrices())},za.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ra.prototype.isPaddingEqual=function(m){return this._edgeInsets.equals(m)},ra.prototype.interpolatePadding=function(m,d,p){this._unmodified=!1,this._edgeInsets.interpolate(m,d,p),this._constrain(),this._calcMatrices()},ra.prototype.coveringZoomLevel=function(m){var d=(m.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/m.tileSize));return Math.max(0,d)},ra.prototype.getVisibleUnwrappedCoordinates=function(m){var d=[new v.UnwrappedTileID(0,m)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new v.Point(0,0)),y=this.pointCoordinate(new v.Point(this.width,0)),A=this.pointCoordinate(new v.Point(this.width,this.height)),w=this.pointCoordinate(new v.Point(0,this.height)),M=Math.floor(Math.min(p.x,y.x,A.x,w.x)),k=Math.floor(Math.max(p.x,y.x,A.x,w.x)),G=M-1;G<=k+1;G++)G!==0&&d.push(new v.UnwrappedTileID(G,m));return d},ra.prototype.coveringTiles=function(m){var d=this.coveringZoomLevel(m),p=d;if(m.minzoom!==void 0&&d<m.minzoom)return[];m.maxzoom!==void 0&&d>m.maxzoom&&(d=m.maxzoom);var y=v.MercatorCoordinate.fromLngLat(this.center),A=Math.pow(2,d),w=[A*y.x,A*y.y,0],M=ih.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d),k=m.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=d);var G=function(_n){return{aabb:new Yu([_n*A,0,0],[(_n+1)*A,A,0]),zoom:0,x:0,y:0,wrap:_n,fullyVisible:!1}},q=[],pe=[],ye=d,be=m.reparseOverscaled?p:d;if(this._renderWorldCopies)for(var qe=1;qe<=3;qe++)q.push(G(-qe)),q.push(G(qe));for(q.push(G(0));q.length>0;){var Ue=q.pop(),ht=Ue.x,We=Ue.y,nt=Ue.fullyVisible;if(!nt){var Mt=Ue.aabb.intersects(M);if(Mt===0)continue;nt=Mt===2}var Pt=Ue.aabb.distanceX(w),vr=Ue.aabb.distanceY(w),rr=Math.max(Math.abs(Pt),Math.abs(vr));if(Ue.zoom===ye||rr>3+(1<<ye-Ue.zoom)-2&&Ue.zoom>=k)pe.push({tileID:new v.OverscaledTileID(Ue.zoom===ye?be:Ue.zoom,Ue.wrap,Ue.zoom,ht,We),distanceSq:v.sqrLen([w[0]-.5-ht,w[1]-.5-We])});else for(var br=0;br<4;br++){var wr=(ht<<1)+br%2,$r=(We<<1)+(br>>1);q.push({aabb:Ue.aabb.quadrant(br),zoom:Ue.zoom+1,x:wr,y:$r,wrap:Ue.wrap,fullyVisible:nt})}}return pe.sort(function(Qr,_n){return Qr.distanceSq-_n.distanceSq}).map(function(Qr){return Qr.tileID})},ra.prototype.resize=function(m,d){this.width=m,this.height=d,this.pixelsToGLUnits=[2/m,-2/d],this._constrain(),this._calcMatrices()},za.unmodified.get=function(){return this._unmodified},ra.prototype.zoomScale=function(m){return Math.pow(2,m)},ra.prototype.scaleZoom=function(m){return Math.log(m)/Math.LN2},ra.prototype.project=function(m){var d=v.clamp(m.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(m.lng)*this.worldSize,v.mercatorYfromLat(d)*this.worldSize)},ra.prototype.unproject=function(m){return new v.MercatorCoordinate(m.x/this.worldSize,m.y/this.worldSize).toLngLat()},za.point.get=function(){return this.project(this.center)},ra.prototype.setLocationAtPoint=function(m,d){var p=this.pointCoordinate(d),y=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(m),w=new v.MercatorCoordinate(A.x-(p.x-y.x),A.y-(p.y-y.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},ra.prototype.locationPoint=function(m){return this.coordinatePoint(this.locationCoordinate(m))},ra.prototype.pointLocation=function(m){return this.coordinateLocation(this.pointCoordinate(m))},ra.prototype.locationCoordinate=function(m){return v.MercatorCoordinate.fromLngLat(m)},ra.prototype.coordinateLocation=function(m){return m.toLngLat()},ra.prototype.pointCoordinate=function(m){var d=[m.x,m.y,0,1],p=[m.x,m.y,1,1];v.transformMat4(d,d,this.pixelMatrixInverse),v.transformMat4(p,p,this.pixelMatrixInverse);var y=d[3],A=p[3],w=d[1]/y,M=p[1]/A,k=d[2]/y,G=p[2]/A,q=k===G?0:(0-k)/(G-k);return new v.MercatorCoordinate(v.number(d[0]/y,p[0]/A,q)/this.worldSize,v.number(w,M,q)/this.worldSize)},ra.prototype.coordinatePoint=function(m){var d=[m.x*this.worldSize,m.y*this.worldSize,0,1];return v.transformMat4(d,d,this.pixelMatrix),new v.Point(d[0]/d[3],d[1]/d[3])},ra.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},ra.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ra.prototype.setMaxBounds=function(m){m?(this.lngRange=[m.getWest(),m.getEast()],this.latRange=[m.getSouth(),m.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ra.prototype.calculatePosMatrix=function(m,d){d===void 0&&(d=!1);var p=m.key,y=d?this._alignedPosMatrixCache:this._posMatrixCache;if(y[p])return y[p];var A=m.canonical,w=this.worldSize/this.zoomScale(A.z),M=A.x+Math.pow(2,A.z)*m.wrap,k=v.identity(new Float64Array(16));return v.translate(k,k,[M*w,A.y*w,0]),v.scale(k,k,[w/v.EXTENT,w/v.EXTENT,1]),v.multiply(k,d?this.alignedProjMatrix:this.projMatrix,k),y[p]=new Float32Array(k),y[p]},ra.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ra.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var m,d,p,y,A=-90,w=90,M=-180,k=180,G=this.size,q=this._unmodified;if(this.latRange){var pe=this.latRange;A=v.mercatorYfromLat(pe[1])*this.worldSize,m=(w=v.mercatorYfromLat(pe[0])*this.worldSize)-A<G.y?G.y/(w-A):0}if(this.lngRange){var ye=this.lngRange;M=v.mercatorXfromLng(ye[0])*this.worldSize,d=(k=v.mercatorXfromLng(ye[1])*this.worldSize)-M<G.x?G.x/(k-M):0}var be=this.point,qe=Math.max(d||0,m||0);if(qe)return this.center=this.unproject(new v.Point(d?(k+M)/2:be.x,m?(w+A)/2:be.y)),this.zoom+=this.scaleZoom(qe),this._unmodified=q,void(this._constraining=!1);if(this.latRange){var Ue=be.y,ht=G.y/2;Ue-ht<A&&(y=A+ht),Ue+ht>w&&(y=w-ht)}if(this.lngRange){var We=be.x,nt=G.x/2;We-nt<M&&(p=M+nt),We+nt>k&&(p=k-nt)}p===void 0&&y===void 0||(this.center=this.unproject(new v.Point(p!==void 0?p:be.x,y!==void 0?y:be.y))),this._unmodified=q,this._constraining=!1}},ra.prototype._calcMatrices=function(){if(this.height){var m=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var d=Math.PI/2+this._pitch,p=this._fov*(.5+m.y/this.height),y=Math.sin(p)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-d-p,.01,Math.PI-.01)),A=this.point,w=A.x,M=A.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*y+this.cameraToCenterDistance),G=this.height/50,q=new Float64Array(16);v.perspective(q,this._fov,this.width/this.height,G,k),q[8]=2*-m.x/this.width,q[9]=2*m.y/this.height,v.scale(q,q,[1,-1,1]),v.translate(q,q,[0,0,-this.cameraToCenterDistance]),v.rotateX(q,q,this._pitch),v.rotateZ(q,q,this.angle),v.translate(q,q,[-w,-M,0]),this.mercatorMatrix=v.scale([],q,[this.worldSize,this.worldSize,this.worldSize]),v.scale(q,q,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=q,this.invProjMatrix=v.invert([],this.projMatrix);var pe=this.width%2/2,ye=this.height%2/2,be=Math.cos(this.angle),qe=Math.sin(this.angle),Ue=w-Math.round(w)+be*pe+qe*ye,ht=M-Math.round(M)+be*ye+qe*pe,We=new Float64Array(q);if(v.translate(We,We,[Ue>.5?Ue-1:Ue,ht>.5?ht-1:ht,0]),this.alignedProjMatrix=We,q=v.create(),v.scale(q,q,[this.width/2,-this.height/2,1]),v.translate(q,q,[1,-1,0]),this.labelPlaneMatrix=q,q=v.create(),v.scale(q,q,[1,-1,1]),v.translate(q,q,[-1,-1,0]),v.scale(q,q,[2/this.width,2/this.height,1]),this.glCoordMatrix=q,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(q=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=q,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ra.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var m=this.pointCoordinate(new v.Point(0,0)),d=[m.x*this.worldSize,m.y*this.worldSize,0,1];return v.transformMat4(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance},ra.prototype.getCameraPoint=function(){var m=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,m))},ra.prototype.getCameraQueryGeometry=function(m){var d=this.getCameraPoint();if(m.length===1)return[m[0],d];for(var p=d.x,y=d.y,A=d.x,w=d.y,M=0,k=m;M<k.length;M+=1){var G=k[M];p=Math.min(p,G.x),y=Math.min(y,G.y),A=Math.max(A,G.x),w=Math.max(w,G.y)}return[new v.Point(p,y),new v.Point(A,y),new v.Point(A,w),new v.Point(p,w),new v.Point(p,y)]},Object.defineProperties(ra.prototype,za);var cu=function(d){var p,y,A,w;this._hashName=d&&encodeURIComponent(d),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(p=this._updateHashUnthrottled.bind(this),y=!1,A=null,w=function(){A=null,y&&(p(),A=setTimeout(w,300),y=!1)},function(){return y=!0,A||w(),A})};cu.prototype.addTo=function(m){return this._map=m,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},cu.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},cu.prototype.getHashString=function(m){var d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,y),w=Math.round(d.lng*A)/A,M=Math.round(d.lat*A)/A,k=this._map.getBearing(),G=this._map.getPitch(),q="";if(q+=m?"/"+w+"/"+M+"/"+p:p+"/"+M+"/"+w,(k||G)&&(q+="/"+Math.round(10*k)/10),G&&(q+="/"+Math.round(G)),this._hashName){var pe=this._hashName,ye=!1,be=v.window.location.hash.slice(1).split("&").map(function(qe){var Ue=qe.split("=")[0];return Ue===pe?(ye=!0,Ue+"="+q):qe}).filter(function(qe){return qe});return ye||be.push(pe+"="+q),"#"+be.join("&")}return"#"+q},cu.prototype._getCurrentHash=function(){var m,d=this,p=v.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(y){return y.split("=")}).forEach(function(y){y[0]===d._hashName&&(m=y)}),(m&&m[1]||"").split("/")):p.split("/")},cu.prototype._onHashChange=function(){var m=this._getCurrentHash();if(m.length>=3&&!m.some(function(p){return isNaN(p)})){var d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(m[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+m[2],+m[1]],zoom:+m[0],bearing:d,pitch:+(m[4]||0)}),!0}return!1},cu.prototype._updateHashUnthrottled=function(){var m=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,m)}catch(d){}};var Sf={linearity:.3,easing:v.bezier(0,0,.3,1)},Vc=v.extend({deceleration:2500,maxSpeed:1400},Sf),Af=v.extend({deceleration:20,maxSpeed:1400},Sf),Ep=v.extend({deceleration:1e3,maxSpeed:360},Sf),ah=v.extend({deceleration:1e3,maxSpeed:90},Sf),Tf=function(d){this._map=d,this.clear()};function Vl(m,d){(!m.duration||m.duration<d.duration)&&(m.duration=d.duration,m.easing=d.easing)}function Lo(m,d,p){var y=p.maxSpeed,A=p.linearity,w=p.deceleration,M=v.clamp(m*A/(d/1e3),-y,y),k=Math.abs(M)/(w*A);return{easing:p.easing,duration:1e3*k,amount:M*(k/2)}}Tf.prototype.clear=function(){this._inertiaBuffer=[]},Tf.prototype.record=function(m){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:m})},Tf.prototype._drainInertiaBuffer=function(){for(var m=this._inertiaBuffer,d=v.browser.now();m.length>0&&d-m[0].time>160;)m.shift()},Tf.prototype._onMoveEnd=function(m){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var d={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},p=0,y=this._inertiaBuffer;p<y.length;p+=1){var A=y[p].settings;d.zoom+=A.zoomDelta||0,d.bearing+=A.bearingDelta||0,d.pitch+=A.pitchDelta||0,A.panDelta&&d.pan._add(A.panDelta),A.around&&(d.around=A.around),A.pinchAround&&(d.pinchAround=A.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(d.pan.mag()){var k=Lo(d.pan.mag(),w,v.extend({},Vc,m||{}));M.offset=d.pan.mult(k.amount/d.pan.mag()),M.center=this._map.transform.center,Vl(M,k)}if(d.zoom){var G=Lo(d.zoom,w,Af);M.zoom=this._map.transform.zoom+G.amount,Vl(M,G)}if(d.bearing){var q=Lo(d.bearing,w,Ep);M.bearing=this._map.transform.bearing+v.clamp(q.amount,-179,179),Vl(M,q)}if(d.pitch){var pe=Lo(d.pitch,w,ah);M.pitch=this._map.transform.pitch+pe.amount,Vl(M,pe)}if(M.zoom||M.bearing){var ye=d.pinchAround===void 0?d.around:d.pinchAround;M.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),v.extend(M,{noMoveStart:!0})}};var to=function(m){function d(y,A,w,M){M===void 0&&(M={});var k=W.mousePos(A.getCanvasContainer(),w),G=A.unproject(k);m.call(this,y,v.extend({point:k,lngLat:G,originalEvent:w},M)),this._defaultPrevented=!1,this.target=A}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(v.Event),Hc=function(m){function d(y,A,w){var M=y==="touchend"?w.changedTouches:w.touches,k=W.touchPos(A.getCanvasContainer(),M),G=k.map(function(ye){return A.unproject(ye)}),q=k.reduce(function(ye,be,qe,Ue){return ye.add(be.div(Ue.length))},new v.Point(0,0)),pe=A.unproject(q);m.call(this,y,{points:k,point:q,lngLats:G,lngLat:pe,originalEvent:w}),this._defaultPrevented=!1}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(v.Event),Uh=function(m){function d(y,A,w){m.call(this,y,{originalEvent:w}),this._defaultPrevented=!1}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var p={defaultPrevented:{configurable:!0}};return d.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(d.prototype,p),d}(v.Event),bo=function(d,p){this._map=d,this._clickTolerance=p.clickTolerance};bo.prototype.reset=function(){delete this._mousedownPos},bo.prototype.wheel=function(m){return this._firePreventable(new Uh(m.type,this._map,m))},bo.prototype.mousedown=function(m,d){return this._mousedownPos=d,this._firePreventable(new to(m.type,this._map,m))},bo.prototype.mouseup=function(m){this._map.fire(new to(m.type,this._map,m))},bo.prototype.click=function(m,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new to(m.type,this._map,m))},bo.prototype.dblclick=function(m){return this._firePreventable(new to(m.type,this._map,m))},bo.prototype.mouseover=function(m){this._map.fire(new to(m.type,this._map,m))},bo.prototype.mouseout=function(m){this._map.fire(new to(m.type,this._map,m))},bo.prototype.touchstart=function(m){return this._firePreventable(new Hc(m.type,this._map,m))},bo.prototype.touchmove=function(m){this._map.fire(new Hc(m.type,this._map,m))},bo.prototype.touchend=function(m){this._map.fire(new Hc(m.type,this._map,m))},bo.prototype.touchcancel=function(m){this._map.fire(new Hc(m.type,this._map,m))},bo.prototype._firePreventable=function(m){if(this._map.fire(m),m.defaultPrevented)return{}},bo.prototype.isEnabled=function(){return!0},bo.prototype.isActive=function(){return!1},bo.prototype.enable=function(){},bo.prototype.disable=function(){};var kn=function(d){this._map=d};kn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},kn.prototype.mousemove=function(m){this._map.fire(new to(m.type,this._map,m))},kn.prototype.mousedown=function(){this._delayContextMenu=!0},kn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new to("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},kn.prototype.contextmenu=function(m){this._delayContextMenu?this._contextMenuEvent=m:this._map.fire(new to(m.type,this._map,m)),this._map.listens("contextmenu")&&m.preventDefault()},kn.prototype.isEnabled=function(){return!0},kn.prototype.isActive=function(){return!1},kn.prototype.enable=function(){},kn.prototype.disable=function(){};var js=function(d,p){this._map=d,this._el=d.getCanvasContainer(),this._container=d.getContainer(),this._clickTolerance=p.clickTolerance||1};function Cf(m,d){for(var p={},y=0;y<m.length;y++)p[m[y].identifier]=d[y];return p}js.prototype.isEnabled=function(){return!!this._enabled},js.prototype.isActive=function(){return!!this._active},js.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},js.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},js.prototype.mousedown=function(m,d){this.isEnabled()&&m.shiftKey&&m.button===0&&(W.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)},js.prototype.mousemoveWindow=function(m,d){if(this._active){var p=d;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var y=this._startPos;this._lastPos=p,this._box||(this._box=W.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",m));var A=Math.min(y.x,p.x),w=Math.max(y.x,p.x),M=Math.min(y.y,p.y),k=Math.max(y.y,p.y);W.setTransform(this._box,"translate("+A+"px,"+M+"px)"),this._box.style.width=w-A+"px",this._box.style.height=k-M+"px"}}},js.prototype.mouseupWindow=function(m,d){var p=this;if(this._active&&m.button===0){var y=this._startPos,A=d;if(this.reset(),W.suppressClick(),y.x!==A.x||y.y!==A.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:m})),{cameraAnimation:function(M){return M.fitScreenCoordinates(y,A,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",m)}},js.prototype.keydown=function(m){this._active&&m.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",m))},js.prototype.blur=function(){this.reset()},js.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(W.remove(this._box),this._box=null),W.enableDrag(),delete this._startPos,delete this._lastPos},js.prototype._fireEvent=function(m,d){return this._map.fire(new v.Event(m,{originalEvent:d}))};var Wc=function(d){this.reset(),this.numTouches=d.numTouches};Wc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Wc.prototype.touchstart=function(m,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=m.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){for(var A=new v.Point(0,0),w=0,M=y;w<M.length;w+=1)A._add(M[w]);return A.div(y.length)}(d),this.touches=Cf(p,d)))},Wc.prototype.touchmove=function(m,d,p){if(!this.aborted&&this.centroid){var y=Cf(p,d);for(var A in this.touches){var w=y[A];(!w||w.dist(this.touches[A])>30)&&(this.aborted=!0)}}},Wc.prototype.touchend=function(m,d,p){if((!this.centroid||m.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var y=!this.aborted&&this.centroid;if(this.reset(),y)return y}};var Cs=function(d){this.singleTap=new Wc(d),this.numTaps=d.numTaps,this.reset()};Cs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Cs.prototype.touchstart=function(m,d,p){this.singleTap.touchstart(m,d,p)},Cs.prototype.touchmove=function(m,d,p){this.singleTap.touchmove(m,d,p)},Cs.prototype.touchend=function(m,d,p){var y=this.singleTap.touchend(m,d,p);if(y){var A=m.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(y)<30;if(A&&w||this.reset(),this.count++,this.lastTime=m.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}};var Oa=function(){this._zoomIn=new Cs({numTouches:1,numTaps:2}),this._zoomOut=new Cs({numTouches:2,numTaps:1}),this.reset()};Oa.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Oa.prototype.touchstart=function(m,d,p){this._zoomIn.touchstart(m,d,p),this._zoomOut.touchstart(m,d,p)},Oa.prototype.touchmove=function(m,d,p){this._zoomIn.touchmove(m,d,p),this._zoomOut.touchmove(m,d,p)},Oa.prototype.touchend=function(m,d,p){var y=this,A=this._zoomIn.touchend(m,d,p),w=this._zoomOut.touchend(m,d,p);return A?(this._active=!0,m.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()+1,around:k.unproject(A)},{originalEvent:m})}}):w?(this._active=!0,m.preventDefault(),setTimeout(function(){return y.reset()},0),{cameraAnimation:function(k){return k.easeTo({duration:300,zoom:k.getZoom()-1,around:k.unproject(w)},{originalEvent:m})}}):void 0},Oa.prototype.touchcancel=function(){this.reset()},Oa.prototype.enable=function(){this._enabled=!0},Oa.prototype.disable=function(){this._enabled=!1,this.reset()},Oa.prototype.isEnabled=function(){return this._enabled},Oa.prototype.isActive=function(){return this._active};var oh={0:1,2:2},vn=function(d){this.reset(),this._clickTolerance=d.clickTolerance||1};vn.prototype.blur=function(){this.reset()},vn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},vn.prototype._correctButton=function(m,d){return!1},vn.prototype._move=function(m,d){return{}},vn.prototype.mousedown=function(m,d){if(!this._lastPoint){var p=W.mouseButton(m);this._correctButton(m,p)&&(this._lastPoint=d,this._eventButton=p)}},vn.prototype.mousemoveWindow=function(m,d){var p=this._lastPoint;if(p){if(m.preventDefault(),function(y,A){var w=oh[A];return y.buttons===void 0||(y.buttons&w)!==w}(m,this._eventButton))this.reset();else if(this._moved||!(d.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(p,d)}},vn.prototype.mouseupWindow=function(m){this._lastPoint&&W.mouseButton(m)===this._eventButton&&(this._moved&&W.suppressClick(),this.reset())},vn.prototype.enable=function(){this._enabled=!0},vn.prototype.disable=function(){this._enabled=!1,this.reset()},vn.prototype.isEnabled=function(){return this._enabled},vn.prototype.isActive=function(){return this._active};var fl=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.mousedown=function(p,y){m.prototype.mousedown.call(this,p,y),this._lastPoint&&(this._active=!0)},d.prototype._correctButton=function(p,y){return y===0&&!p.ctrlKey},d.prototype._move=function(p,y){return{around:y,panDelta:y.sub(p)}},d}(vn),wf=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype._correctButton=function(p,y){return y===0&&p.ctrlKey||y===2},d.prototype._move=function(p,y){var A=.8*(y.x-p.x);if(A)return this._active=!0,{bearingDelta:A}},d.prototype.contextmenu=function(p){p.preventDefault()},d}(vn),sh=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype._correctButton=function(p,y){return y===0&&p.ctrlKey||y===2},d.prototype._move=function(p,y){var A=-.5*(y.y-p.y);if(A)return this._active=!0,{pitchDelta:A}},d.prototype.contextmenu=function(p){p.preventDefault()},d}(vn),yu=function(d){this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset()};yu.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},yu.prototype.touchstart=function(m,d,p){return this._calculateTransform(m,d,p)},yu.prototype.touchmove=function(m,d,p){if(this._active&&!(p.length<this._minTouches))return m.preventDefault(),this._calculateTransform(m,d,p)},yu.prototype.touchend=function(m,d,p){this._calculateTransform(m,d,p),this._active&&p.length<this._minTouches&&this.reset()},yu.prototype.touchcancel=function(){this.reset()},yu.prototype._calculateTransform=function(m,d,p){p.length>0&&(this._active=!0);var y=Cf(p,d),A=new v.Point(0,0),w=new v.Point(0,0),M=0;for(var k in y){var G=y[k],q=this._touches[k];q&&(A._add(G),w._add(G.sub(q)),M++,y[k]=G)}if(this._touches=y,!(M<this._minTouches)&&w.mag()){var pe=w.div(M);if(this._sum._add(pe),!(this._sum.mag()<this._clickTolerance))return{around:A.div(M),panDelta:pe}}},yu.prototype.enable=function(){this._enabled=!0},yu.prototype.disable=function(){this._enabled=!1,this.reset()},yu.prototype.isEnabled=function(){return this._enabled},yu.prototype.isActive=function(){return this._active};var Qs=function(){this.reset()};function uh(m,d,p){for(var y=0;y<m.length;y++)if(m[y].identifier===p)return d[y]}function lh(m,d){return Math.log(m/d)/Math.LN2}Qs.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Qs.prototype._start=function(m){},Qs.prototype._move=function(m,d,p){return{}},Qs.prototype.touchstart=function(m,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))},Qs.prototype.touchmove=function(m,d,p){if(this._firstTwoTouches){m.preventDefault();var y=this._firstTwoTouches,A=y[1],w=uh(p,d,y[0]),M=uh(p,d,A);if(w&&M){var k=this._aroundCenter?null:w.add(M).div(2);return this._move([w,M],k,m)}}},Qs.prototype.touchend=function(m,d,p){if(this._firstTwoTouches){var y=this._firstTwoTouches,A=y[1],w=uh(p,d,y[0]),M=uh(p,d,A);w&&M||(this._active&&W.suppressClick(),this.reset())}},Qs.prototype.touchcancel=function(){this.reset()},Qs.prototype.enable=function(m){this._enabled=!0,this._aroundCenter=!!m&&m.around==="center"},Qs.prototype.disable=function(){this._enabled=!1,this.reset()},Qs.prototype.isEnabled=function(){return this._enabled},Qs.prototype.isActive=function(){return this._active};var ws=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),delete this._distance,delete this._startDistance},d.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},d.prototype._move=function(p,y){var A=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(lh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:lh(this._distance,A),pinchAround:y}},d}(Qs);function Ku(m,d){return 180*m.angleWith(d)/Math.PI}var Sp=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},d.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},d.prototype._move=function(p,y){var A=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ku(this._vector,A),pinchAround:y}},d.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var y=25/(Math.PI*this._minDiameter)*360,A=Ku(p,this._startVector);return Math.abs(A)<y},d}(Qs);function Gc(m){return Math.abs(m.y)>Math.abs(m.x)}var xi=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.reset=function(){m.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},d.prototype._start=function(p){this._lastPoints=p,Gc(p[0].sub(p[1]))&&(this._valid=!1)},d.prototype._move=function(p,y,A){var w=p[0].sub(this._lastPoints[0]),M=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,M,A.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(w.y+M.y)/2*-.5}},d.prototype.gestureBeginsVertically=function(p,y,A){if(this._valid!==void 0)return this._valid;var w=p.mag()>=2,M=y.mag()>=2;if(w||M){if(!w||!M)return this._firstMove===void 0&&(this._firstMove=A),A-this._firstMove<100&&void 0;var k=p.y>0==y.y>0;return Gc(p)&&Gc(y)&&k}},d}(Qs),Vh={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var d=Vh;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1};function zs(m){return m*(2-m)}Js.prototype.blur=function(){this.reset()},Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(m){var d=this;if(!(m.altKey||m.ctrlKey||m.metaKey)){var p=0,y=0,A=0,w=0,M=0;switch(m.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:m.shiftKey?y=-1:(m.preventDefault(),w=-1);break;case 39:m.shiftKey?y=1:(m.preventDefault(),w=1);break;case 38:m.shiftKey?A=1:(m.preventDefault(),M=-1);break;case 40:m.shiftKey?A=-1:(m.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(y=0,A=0),{cameraAnimation:function(G){var q=G.getZoom();G.easeTo({duration:300,easeId:"keyboardHandler",easing:zs,zoom:p?Math.round(q)+p*(m.shiftKey?2:1):q,bearing:G.getBearing()+y*d._bearingStep,pitch:G.getPitch()+A*d._pitchStep,offset:[-w*d._panStep,-M*d._panStep],center:G.getCenter()},{originalEvent:m})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(d,p){this._map=d,this._el=d.getCanvasContainer(),this._handler=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(m){this._defaultZoomRate=m},Oi.prototype.setWheelZoomRate=function(m){this._wheelZoomRate=m},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(m){this.isEnabled()||(this._enabled=!0,this._aroundCenter=m&&m.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(m){if(this.isEnabled()){var d=m.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*m.deltaY:m.deltaY,p=v.browser.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%4.000244140625==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,m)):this._type||(this._type=Math.abs(y*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),m.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=m,this._delta-=d,this._active||this._start(m)),m.preventDefault()}},Oi.prototype._onTimeout=function(m){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},Oi.prototype._start=function(m){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var d=W.mousePos(this._el,m);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(d)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var m=this;if(this._frameId&&(this._frameId=null,this.isActive())){var d=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,y=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&y!==0&&(y=1/y);var A=typeof this._targetZoom=="number"?d.zoomScale(this._targetZoom):d.scale;this._targetZoom=Math.min(d.maxZoom,Math.max(d.minZoom,d.scaleZoom(A*y))),this._type==="wheel"&&(this._startZoom=d.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,M=typeof this._targetZoom=="number"?this._targetZoom:d.zoom,k=this._startZoom,G=this._easing,q=!1;if(this._type==="wheel"&&k&&G){var pe=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),ye=G(pe);w=v.number(k,M,ye),pe<1?this._frameId||(this._frameId=!0):q=!0}else w=M,q=!0;return this._active=!0,q&&(this._active=!1,this._finishTimeout=setTimeout(function(){m._zooming=!1,m._handler._triggerRenderFrame(),delete m._targetZoom,delete m._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!q,zoomDelta:w-d.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(m){var d=v.ease;if(this._prevEase){var p=this._prevEase,y=(v.browser.now()-p.start)/p.duration,A=p.easing(y+.01)-p.easing(y),w=.27/Math.sqrt(A*A+1e-4)*.01,M=Math.sqrt(.0729-w*w);d=v.bezier(w,M,.25,1)}return this._prevEase={start:v.browser.now(),duration:m,easing:d},d},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var fu=function(d,p){this._clickZoom=d,this._tapZoom=p};fu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},fu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},fu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},fu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(m,d){return m.preventDefault(),{cameraAnimation:function(y){y.easeTo({duration:300,zoom:y.getZoom()+(m.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:m})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Yo=function(){this._tap=new Cs({numTouches:1,numTaps:1}),this.reset()};Yo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Yo.prototype.touchstart=function(m,d,p){this._swipePoint||(this._tapTime&&m.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=d[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(m,d,p))},Yo.prototype.touchmove=function(m,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var y=d[0],A=y.y-this._swipePoint.y;return this._swipePoint=y,m.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(m,d,p)},Yo.prototype.touchend=function(m,d,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(m,d,p)&&(this._tapTime=m.timeStamp)},Yo.prototype.touchcancel=function(){this.reset()},Yo.prototype.enable=function(){this._enabled=!0},Yo.prototype.disable=function(){this._enabled=!1,this.reset()},Yo.prototype.isEnabled=function(){return this._enabled},Yo.prototype.isActive=function(){return this._active};var Hl=function(d,p,y){this._el=d,this._mousePan=p,this._touchPan=y};Hl.prototype.enable=function(m){this._inertiaOptions=m||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Hl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Hl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Hl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var hl=function(d,p,y){this._pitchWithRotate=d.pitchWithRotate,this._mouseRotate=p,this._mousePitch=y};hl.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},hl.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},hl.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},hl.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var pu=function(d,p,y,A){this._el=d,this._touchZoom=p,this._touchRotate=y,this._tapDragZoom=A,this._rotationDisabled=!1,this._enabled=!0};pu.prototype.enable=function(m){this._touchZoom.enable(m),this._rotationDisabled||this._touchRotate.enable(m),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},pu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},pu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},pu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},pu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},pu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ko=function(d){return d.zoom||d.drag||d.pitch||d.rotate},pl=function(m){function d(){m.apply(this,arguments)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d}(v.Event);function ti(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}var jn=function(d,p){this._map=d,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tf(d),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p),v.bindAll(["handleEvent","handleWindowEvent"],this);var y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[v.window,"blur",void 0]];for(var A=0,w=this._listeners;A<w.length;A+=1){var M=w[A],k=M[0];W.addEventListener(k,M[1],k===v.window.document?this.handleWindowEvent:this.handleEvent,M[2])}};jn.prototype.destroy=function(){for(var m=0,d=this._listeners;m<d.length;m+=1){var p=d[m],y=p[0];W.removeEventListener(y,p[1],y===v.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},jn.prototype._addDefaultHandlers=function(m){var d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new bo(d,m));var y=d.boxZoom=new js(d,m);this._add("boxZoom",y);var A=new Oa,w=new hu;d.doubleClickZoom=new fu(w,A),this._add("tapZoom",A),this._add("clickZoom",w);var M=new Yo;this._add("tapDragZoom",M);var k=d.touchPitch=new xi;this._add("touchPitch",k);var G=new wf(m),q=new sh(m);d.dragRotate=new hl(m,G,q),this._add("mouseRotate",G,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);var pe=new fl(m),ye=new yu(m);d.dragPan=new Hl(p,pe,ye),this._add("mousePan",pe),this._add("touchPan",ye,["touchZoom","touchRotate"]);var be=new Sp,qe=new ws;d.touchZoomRotate=new pu(p,qe,be,M),this._add("touchRotate",be,["touchPan","touchZoom"]),this._add("touchZoom",qe,["touchPan","touchRotate"]);var Ue=d.scrollZoom=new Oi(d,this);this._add("scrollZoom",Ue,["mousePan"]);var ht=d.keyboard=new Js;this._add("keyboard",ht),this._add("blockableMapEvent",new kn(d));for(var We=0,nt=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];We<nt.length;We+=1){var Mt=nt[We];m.interactive&&m[Mt]&&d[Mt].enable(m[Mt])}},jn.prototype._add=function(m,d,p){this._handlers.push({handlerName:m,handler:d,allowed:p}),this._handlersById[m]=d},jn.prototype.stop=function(m){if(!this._updatingCamera){for(var d=0,p=this._handlers;d<p.length;d+=1)p[d].handler.reset();this._inertia.clear(),this._fireEvents({},{},m),this._changes=[]}},jn.prototype.isActive=function(){for(var m=0,d=this._handlers;m<d.length;m+=1)if(d[m].handler.isActive())return!0;return!1},jn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},jn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},jn.prototype.isMoving=function(){return Boolean(Ko(this._eventsInProgress))||this.isZooming()},jn.prototype._blockedByActive=function(m,d,p){for(var y in m)if(y!==p&&(!d||d.indexOf(y)<0))return!0;return!1},jn.prototype.handleWindowEvent=function(m){this.handleEvent(m,m.type+"Window")},jn.prototype._getMapTouches=function(m){for(var d=[],p=0,y=m;p<y.length;p+=1){var A=y[p];this._el.contains(A.target)&&d.push(A)}return d},jn.prototype.handleEvent=function(m,d){this._updatingCamera=!0;for(var p=m.type==="renderFrame"?void 0:m,y={needsRenderFrame:!1},A={},w={},M=m.touches?this._getMapTouches(m.touches):void 0,k=M?W.touchPos(this._el,M):W.mousePos(this._el,m),G=0,q=this._handlers;G<q.length;G+=1){var pe=q[G],ye=pe.handlerName,be=pe.handler,qe=pe.allowed;if(be.isEnabled()){var Ue=void 0;this._blockedByActive(w,qe,ye)?be.reset():be[d||m.type]&&(Ue=be[d||m.type](m,k,M),this.mergeHandlerResult(y,A,Ue,ye,p),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||be.isActive())&&(w[ye]=be)}}var ht={};for(var We in this._previousActiveHandlers)w[We]||(ht[We]=p);this._previousActiveHandlers=w,(Object.keys(ht).length||ti(y))&&(this._changes.push([y,A,ht]),this._triggerRenderFrame()),(Object.keys(w).length||ti(y))&&this._map._stop(!0),this._updatingCamera=!1;var nt=y.cameraAnimation;nt&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],nt(this._map))},jn.prototype.mergeHandlerResult=function(m,d,p,y,A){if(p){v.extend(m,p);var w={handlerName:y,originalEvent:p.originalEvent||A};p.zoomDelta!==void 0&&(d.zoom=w),p.panDelta!==void 0&&(d.drag=w),p.pitchDelta!==void 0&&(d.pitch=w),p.bearingDelta!==void 0&&(d.rotate=w)}},jn.prototype._applyChanges=function(){for(var m={},d={},p={},y=0,A=this._changes;y<A.length;y+=1){var w=A[y],M=w[0],k=w[1],G=w[2];M.panDelta&&(m.panDelta=(m.panDelta||new v.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(m.zoomDelta=(m.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(m.bearingDelta=(m.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(m.pitchDelta=(m.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(m.around=M.around),M.pinchAround!==void 0&&(m.pinchAround=M.pinchAround),M.noInertia&&(m.noInertia=M.noInertia),v.extend(d,k),v.extend(p,G)}this._updateMapTransform(m,d,p),this._changes=[]},jn.prototype._updateMapTransform=function(m,d,p){var y=this._map,A=y.transform;if(!ti(m))return this._fireEvents(d,p,!0);var w=m.panDelta,M=m.zoomDelta,k=m.bearingDelta,G=m.pitchDelta,q=m.around,pe=m.pinchAround;pe!==void 0&&(q=pe),y._stop(!0),q=q||y.transform.centerPoint;var ye=A.pointLocation(w?q.sub(w):q);k&&(A.bearing+=k),G&&(A.pitch+=G),M&&(A.zoom+=M),A.setLocationAtPoint(ye,q),this._map._update(),m.noInertia||this._inertia.record(m),this._fireEvents(d,p,!0)},jn.prototype._fireEvents=function(m,d,p){var y=this,A=Ko(this._eventsInProgress),w=Ko(m),M={};for(var k in m)this._eventsInProgress[k]||(M[k+"start"]=m[k].originalEvent),this._eventsInProgress[k]=m[k];for(var G in!A&&w&&this._fireEvent("movestart",w.originalEvent),M)this._fireEvent(G,M[G]);for(var q in w&&this._fireEvent("move",w.originalEvent),m)this._fireEvent(q,m[q].originalEvent);var pe,ye={};for(var be in this._eventsInProgress){var qe=this._eventsInProgress[be],Ue=qe.handlerName,ht=qe.originalEvent;this._handlersById[Ue].isActive()||(delete this._eventsInProgress[be],ye[be+"end"]=pe=d[Ue]||ht)}for(var We in ye)this._fireEvent(We,ye[We]);var nt=Ko(this._eventsInProgress);if(p&&(A||w)&&!nt){this._updatingCamera=!0;var Mt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Pt=function(rr){return rr!==0&&-y._bearingSnap<rr&&rr<y._bearingSnap};Mt?(Pt(Mt.bearing||this._map.getBearing())&&(Mt.bearing=0),this._map.easeTo(Mt,{originalEvent:pe})):(this._map.fire(new v.Event("moveend",{originalEvent:pe})),Pt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},jn.prototype._fireEvent=function(m,d){this._map.fire(new v.Event(m,d?{originalEvent:d}:{}))},jn.prototype._requestFrame=function(){var m=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(d){delete m._frameId,m.handleEvent(new pl("renderFrame",{timeStamp:d})),m._applyChanges()})},jn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var eu=function(m){function d(p,y){m.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=y.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},d.prototype.setCenter=function(p,y){return this.jumpTo({center:p},y)},d.prototype.panBy=function(p,y,A){return p=v.Point.convert(p).mult(-1),this.panTo(this.transform.center,v.extend({offset:p},y),A)},d.prototype.panTo=function(p,y,A){return this.easeTo(v.extend({center:p},y),A)},d.prototype.getZoom=function(){return this.transform.zoom},d.prototype.setZoom=function(p,y){return this.jumpTo({zoom:p},y),this},d.prototype.zoomTo=function(p,y,A){return this.easeTo(v.extend({zoom:p},y),A)},d.prototype.zoomIn=function(p,y){return this.zoomTo(this.getZoom()+1,p,y),this},d.prototype.zoomOut=function(p,y){return this.zoomTo(this.getZoom()-1,p,y),this},d.prototype.getBearing=function(){return this.transform.bearing},d.prototype.setBearing=function(p,y){return this.jumpTo({bearing:p},y),this},d.prototype.getPadding=function(){return this.transform.padding},d.prototype.setPadding=function(p,y){return this.jumpTo({padding:p},y),this},d.prototype.rotateTo=function(p,y,A){return this.easeTo(v.extend({bearing:p},y),A)},d.prototype.resetNorth=function(p,y){return this.rotateTo(0,v.extend({duration:1e3},p),y),this},d.prototype.resetNorthPitch=function(p,y){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},p),y),this},d.prototype.snapToNorth=function(p,y){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,y):this},d.prototype.getPitch=function(){return this.transform.pitch},d.prototype.setPitch=function(p,y){return this.jumpTo({pitch:p},y),this},d.prototype.cameraForBounds=function(p,y){p=v.LngLatBounds.convert(p);var A=y&&y.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),A,y)},d.prototype._cameraForBoxAndBearing=function(p,y,A,w){var M={top:0,bottom:0,right:0,left:0};if(typeof(w=v.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var k=w.padding;w.padding={top:k,bottom:k,right:k,left:k}}w.padding=v.extend(M,w.padding);var G=this.transform,q=G.padding,pe=G.project(v.LngLat.convert(p)),ye=G.project(v.LngLat.convert(y)),be=pe.rotate(-A*Math.PI/180),qe=ye.rotate(-A*Math.PI/180),Ue=new v.Point(Math.max(be.x,qe.x),Math.max(be.y,qe.y)),ht=new v.Point(Math.min(be.x,qe.x),Math.min(be.y,qe.y)),We=Ue.sub(ht),nt=(G.width-(q.left+q.right+w.padding.left+w.padding.right))/We.x,Mt=(G.height-(q.top+q.bottom+w.padding.top+w.padding.bottom))/We.y;if(!(Mt<0||nt<0)){var Pt=Math.min(G.scaleZoom(G.scale*Math.min(nt,Mt)),w.maxZoom),vr=typeof w.offset.x=="number"?new v.Point(w.offset.x,w.offset.y):v.Point.convert(w.offset),rr=new v.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(A*Math.PI/180),br=vr.add(rr).mult(G.scale/G.zoomScale(Pt));return{center:G.unproject(pe.add(ye).div(2).sub(br)),zoom:Pt,bearing:A}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},d.prototype.fitBounds=function(p,y,A){return this._fitInternal(this.cameraForBounds(p,y),y,A)},d.prototype.fitScreenCoordinates=function(p,y,A,w,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(p)),this.transform.pointLocation(v.Point.convert(y)),A,w),w,M)},d.prototype._fitInternal=function(p,y,A){return p?(delete(y=v.extend(p,y)).padding,y.linear?this.easeTo(y,A):this.flyTo(y,A)):this},d.prototype.jumpTo=function(p,y){this.stop();var A=this.transform,w=!1,M=!1,k=!1;return"zoom"in p&&A.zoom!==+p.zoom&&(w=!0,A.zoom=+p.zoom),p.center!==void 0&&(A.center=v.LngLat.convert(p.center)),"bearing"in p&&A.bearing!==+p.bearing&&(M=!0,A.bearing=+p.bearing),"pitch"in p&&A.pitch!==+p.pitch&&(k=!0,A.pitch=+p.pitch),p.padding==null||A.isPaddingEqual(p.padding)||(A.padding=p.padding),this.fire(new v.Event("movestart",y)).fire(new v.Event("move",y)),w&&this.fire(new v.Event("zoomstart",y)).fire(new v.Event("zoom",y)).fire(new v.Event("zoomend",y)),M&&this.fire(new v.Event("rotatestart",y)).fire(new v.Event("rotate",y)).fire(new v.Event("rotateend",y)),k&&this.fire(new v.Event("pitchstart",y)).fire(new v.Event("pitch",y)).fire(new v.Event("pitchend",y)),this.fire(new v.Event("moveend",y))},d.prototype.easeTo=function(p,y){var A=this;this._stop(!1,p.easeId),((p=v.extend({offset:[0,0],duration:500,easing:v.ease},p)).animate===!1||!p.essential&&v.browser.prefersReducedMotion)&&(p.duration=0);var w=this.transform,M=this.getZoom(),k=this.getBearing(),G=this.getPitch(),q=this.getPadding(),pe="zoom"in p?+p.zoom:M,ye="bearing"in p?this._normalizeBearing(p.bearing,k):k,be="pitch"in p?+p.pitch:G,qe="padding"in p?p.padding:w.padding,Ue=v.Point.convert(p.offset),ht=w.centerPoint.add(Ue),We=w.pointLocation(ht),nt=v.LngLat.convert(p.center||We);this._normalizeCenter(nt);var Mt,Pt,vr=w.project(We),rr=w.project(nt).sub(vr),br=w.zoomScale(pe-M);p.around&&(Mt=v.LngLat.convert(p.around),Pt=w.locationPoint(Mt));var wr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||pe!==M,this._rotating=this._rotating||k!==ye,this._pitching=this._pitching||be!==G,this._padding=!w.isPaddingEqual(qe),this._easeId=p.easeId,this._prepareEase(y,p.noMoveStart,wr),this._ease(function($r){if(A._zooming&&(w.zoom=v.number(M,pe,$r)),A._rotating&&(w.bearing=v.number(k,ye,$r)),A._pitching&&(w.pitch=v.number(G,be,$r)),A._padding&&(w.interpolatePadding(q,qe,$r),ht=w.centerPoint.add(Ue)),Mt)w.setLocationAtPoint(Mt,Pt);else{var Qr=w.zoomScale(w.zoom-M),_n=pe>M?Math.min(2,br):Math.max(.5,br),Ln=Math.pow(_n,1-$r),si=w.unproject(vr.add(rr.mult($r*Ln)).mult(Qr));w.setLocationAtPoint(w.renderWorldCopies?si.wrap():si,ht)}A._fireMoveEvents(y)},function($r){A._afterEase(y,$r)},p),this},d.prototype._prepareEase=function(p,y,A){A===void 0&&(A={}),this._moving=!0,y||A.moving||this.fire(new v.Event("movestart",p)),this._zooming&&!A.zooming&&this.fire(new v.Event("zoomstart",p)),this._rotating&&!A.rotating&&this.fire(new v.Event("rotatestart",p)),this._pitching&&!A.pitching&&this.fire(new v.Event("pitchstart",p))},d.prototype._fireMoveEvents=function(p){this.fire(new v.Event("move",p)),this._zooming&&this.fire(new v.Event("zoom",p)),this._rotating&&this.fire(new v.Event("rotate",p)),this._pitching&&this.fire(new v.Event("pitch",p))},d.prototype._afterEase=function(p,y){if(!this._easeId||!y||this._easeId!==y){delete this._easeId;var A=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,A&&this.fire(new v.Event("zoomend",p)),w&&this.fire(new v.Event("rotateend",p)),M&&this.fire(new v.Event("pitchend",p)),this.fire(new v.Event("moveend",p))}},d.prototype.flyTo=function(p,y){var A=this;if(!p.essential&&v.browser.prefersReducedMotion){var w=v.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,y)}this.stop(),p=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},p);var M=this.transform,k=this.getZoom(),G=this.getBearing(),q=this.getPitch(),pe=this.getPadding(),ye="zoom"in p?v.clamp(+p.zoom,M.minZoom,M.maxZoom):k,be="bearing"in p?this._normalizeBearing(p.bearing,G):G,qe="pitch"in p?+p.pitch:q,Ue="padding"in p?p.padding:M.padding,ht=M.zoomScale(ye-k),We=v.Point.convert(p.offset),nt=M.centerPoint.add(We),Mt=M.pointLocation(nt),Pt=v.LngLat.convert(p.center||Mt);this._normalizeCenter(Pt);var vr=M.project(Mt),rr=M.project(Pt).sub(vr),br=p.curve,wr=Math.max(M.width,M.height),$r=wr/ht,Qr=rr.mag();if("minZoom"in p){var _n=v.clamp(Math.min(p.minZoom,k,ye),M.minZoom,M.maxZoom),Ln=wr/M.zoomScale(_n-k);br=Math.sqrt(Ln/Qr*2)}var si=br*br;function hi(ui){var zi=($r*$r-wr*wr+(ui?-1:1)*si*si*Qr*Qr)/(2*(ui?$r:wr)*si*Qr);return Math.log(Math.sqrt(zi*zi+1)-zi)}function Wi(ui){return(Math.exp(ui)-Math.exp(-ui))/2}function Qi(ui){return(Math.exp(ui)+Math.exp(-ui))/2}var An=hi(0),Ri=function(zi){return Qi(An)/Qi(An+br*zi)},Pi=function(zi){return wr*((Qi(An)*(Wi(Ji=An+br*zi)/Qi(Ji))-Wi(An))/si)/Qr;var Ji},Xn=(hi(1)-An)/br;if(Math.abs(Qr)<1e-6||!isFinite(Xn)){if(Math.abs(wr-$r)<1e-6)return this.easeTo(p,y);var Ii=$r<wr?-1:1;Xn=Math.abs(Math.log($r/wr))/br,Pi=function(){return 0},Ri=function(zi){return Math.exp(Ii*br*zi)}}return p.duration="duration"in p?+p.duration:1e3*Xn/("screenSpeed"in p?+p.screenSpeed/br:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=G!==be,this._pitching=qe!==q,this._padding=!M.isPaddingEqual(Ue),this._prepareEase(y,!1),this._ease(function(ui){var zi=ui*Xn,Ji=1/Ri(zi);M.zoom=ui===1?ye:k+M.scaleZoom(Ji),A._rotating&&(M.bearing=v.number(G,be,ui)),A._pitching&&(M.pitch=v.number(q,qe,ui)),A._padding&&(M.interpolatePadding(pe,Ue,ui),nt=M.centerPoint.add(We));var Ao=ui===1?Pt:M.unproject(vr.add(rr.mult(Pi(zi))).mult(Ji));M.setLocationAtPoint(M.renderWorldCopies?Ao.wrap():Ao,nt),A._fireMoveEvents(y)},function(){return A._afterEase(y)},p),this},d.prototype.isEasing=function(){return!!this._easeFrameId},d.prototype.stop=function(){return this._stop()},d.prototype._stop=function(p,y){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var A=this._onEaseEnd;delete this._onEaseEnd,A.call(this,y)}if(!p){var w=this.handlers;w&&w.stop(!1)}return this},d.prototype._ease=function(p,y,A){A.animate===!1||A.duration===0?(p(1),y()):(this._easeStart=v.browser.now(),this._easeOptions=A,this._onEaseFrame=p,this._onEaseEnd=y,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},d.prototype._renderFrameCallback=function(){var p=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},d.prototype._normalizeBearing=function(p,y){p=v.wrap(p,-180,180);var A=Math.abs(p-y);return Math.abs(p-360-y)<A&&(p-=360),Math.abs(p+360-y)<A&&(p+=360),p},d.prototype._normalizeCenter=function(p){var y=this.transform;if(y.renderWorldCopies&&!y.lngRange){var A=p.lng-y.center.lng;p.lng+=A>180?-360:A<-180?360:0}},d}(v.Evented),bs=function(d){d===void 0&&(d={}),this.options=d,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};bs.prototype.getDefaultPosition=function(){return"bottom-right"},bs.prototype.onAdd=function(m){var d=this.options&&this.options.compact;return this._map=m,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=W.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=W.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},bs.prototype.onRemove=function(){W.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},bs.prototype._setElementTitle=function(m,d){var p=this._map._getUIString("AttributionControl."+d);m.title=p,m.setAttribute("aria-label",p)},bs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},bs.prototype._updateEditLink=function(){var m=this._editLink;m||(m=this._editLink=this._container.querySelector(".mapbox-improve-map"));var d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(m){var p=d.reduce(function(y,A,w){return A.value&&(y+=A.key+"="+A.value+(w<d.length-1?"&":"")),y},"?");m.href=v.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),m.rel="noopener nofollow",this._setElementTitle(m,"MapFeedback")}},bs.prototype._updateData=function(m){!m||m.sourceDataType!=="metadata"&&m.sourceDataType!=="visibility"&&m.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},bs.prototype._updateAttributions=function(){if(this._map.style){var m=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?m=m.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&m.push(this.options.customAttribution)),this._map.style.stylesheet){var d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}var p=this._map.style.sourceCaches;for(var y in p){var A=p[y];if(A.used){var w=A.getSource();w.attribution&&m.indexOf(w.attribution)<0&&m.push(w.attribution)}}m.sort(function(k,G){return k.length-G.length});var M=(m=m.filter(function(k,G){for(var q=G+1;q<m.length;q++)if(m[q].indexOf(k)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,m.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},bs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ru=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};Ru.prototype.onAdd=function(m){this._map=m,this._container=W.create("div","mapboxgl-ctrl");var d=W.create("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ru.prototype.onRemove=function(){W.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ru.prototype.getDefaultPosition=function(){return"bottom-left"},Ru.prototype._updateLogo=function(m){m&&m.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ru.prototype._logoRequired=function(){if(this._map.style){var m=this._map.style.sourceCaches;for(var d in m)if(m[d].getSource().mapbox_logo)return!0;return!1}},Ru.prototype._updateCompact=function(){var m=this._container.children;if(m.length){var d=m[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}};var $a=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};$a.prototype.add=function(m){var d=++this._id;return this._queue.push({callback:m,id:d,cancelled:!1}),d},$a.prototype.remove=function(m){for(var d=this._currentlyRunning,p=0,y=d?this._queue.concat(d):this._queue;p<y.length;p+=1){var A=y[p];if(A.id===m)return void(A.cancelled=!0)}},$a.prototype.run=function(m){m===void 0&&(m=0);var d=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,y=d;p<y.length;p+=1){var A=y[p];if(!A.cancelled&&(A.callback(m),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},$a.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var _u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},dl=v.window.HTMLImageElement,vl=v.window.HTMLElement,pa=v.window.ImageBitmap,No={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Hh=function(m){function d(y){var A=this;if((y=v.extend({},No,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new ra(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies);if(m.call(this,w,y),this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new $a,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},_u,y.locale),this._clickTolerance=y.clickTolerance,this._requestManager=new v.RequestManager(y.transformRequest,y.accessToken),typeof y.container=="string"){if(this._container=v.window.document.getElementById(y.container),!this._container)throw new Error("Container '"+y.container+"' not found.")}else{if(!(y.container instanceof vl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return A._update(!1)}),this.on("moveend",function(){return A._update(!1)}),this.on("zoom",function(){return A._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new jn(this,y),this._hash=y.hash&&new cu(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,v.extend({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new bs({customAttribution:y.customAttribution})),this.addControl(new Ru,y.logoPosition),this.on("style.load",function(){A.transform.unmodified&&A.jumpTo(A.style.stylesheet)}),this.on("data",function(M){A._update(M.dataType==="style"),A.fire(new v.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){A.fire(new v.Event(M.dataType+"dataloading",M))})}m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return d.prototype._getMapId=function(){return this._mapId},d.prototype.addControl=function(y,A){if(A===void 0&&(A=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=y.onAdd(this);this._controls.push(y);var M=this._controlPositions[A];return A.indexOf("bottom")!==-1?M.insertBefore(w,M.firstChild):M.appendChild(w),this},d.prototype.removeControl=function(y){if(!y||!y.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var A=this._controls.indexOf(y);return A>-1&&this._controls.splice(A,1),y.onRemove(this),this},d.prototype.hasControl=function(y){return this._controls.indexOf(y)>-1},d.prototype.resize=function(y){var A=this._containerDimensions(),w=A[0],M=A[1];if(w===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(w,M),this.transform.resize(w,M),this.painter.resize(w,M);var k=!this._moving;return k&&this.fire(new v.Event("movestart",y)).fire(new v.Event("move",y)),this.fire(new v.Event("resize",y)),k&&this.fire(new v.Event("moveend",y)),this},d.prototype.getBounds=function(){return this.transform.getBounds()},d.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},d.prototype.setMaxBounds=function(y){return this.transform.setMaxBounds(v.LngLatBounds.convert(y)),this._update()},d.prototype.setMinZoom=function(y){if((y=y==null?-2:y)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},d.prototype.getMinZoom=function(){return this.transform.minZoom},d.prototype.setMaxZoom=function(y){if((y=y==null?22:y)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")},d.prototype.getMaxZoom=function(){return this.transform.maxZoom},d.prototype.setMinPitch=function(y){if((y=y==null?0:y)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},d.prototype.getMinPitch=function(){return this.transform.minPitch},d.prototype.setMaxPitch=function(y){if((y=y==null?60:y)>60)throw new Error("maxPitch must be less than or equal to 60");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")},d.prototype.getMaxPitch=function(){return this.transform.maxPitch},d.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},d.prototype.setRenderWorldCopies=function(y){return this.transform.renderWorldCopies=y,this._update()},d.prototype.project=function(y){return this.transform.locationPoint(v.LngLat.convert(y))},d.prototype.unproject=function(y){return this.transform.pointLocation(v.Point.convert(y))},d.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},d.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},d.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},d.prototype._createDelegatedListener=function(y,A,w){var M,k=this;if(y==="mouseenter"||y==="mouseover"){var G=!1;return{layer:A,listener:w,delegates:{mousemove:function(ye){var be=k.getLayer(A)?k.queryRenderedFeatures(ye.point,{layers:[A]}):[];be.length?G||(G=!0,w.call(k,new to(y,k,ye.originalEvent,{features:be}))):G=!1},mouseout:function(){G=!1}}}}if(y==="mouseleave"||y==="mouseout"){var q=!1;return{layer:A,listener:w,delegates:{mousemove:function(ye){(k.getLayer(A)?k.queryRenderedFeatures(ye.point,{layers:[A]}):[]).length?q=!0:q&&(q=!1,w.call(k,new to(y,k,ye.originalEvent)))},mouseout:function(ye){q&&(q=!1,w.call(k,new to(y,k,ye.originalEvent)))}}}}return{layer:A,listener:w,delegates:(M={},M[y]=function(pe){var ye=k.getLayer(A)?k.queryRenderedFeatures(pe.point,{layers:[A]}):[];ye.length&&(pe.features=ye,w.call(k,pe),delete pe.features)},M)}},d.prototype.on=function(y,A,w){if(w===void 0)return m.prototype.on.call(this,y,A);var M=this._createDelegatedListener(y,A,w);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(M),M.delegates)this.on(k,M.delegates[k]);return this},d.prototype.once=function(y,A,w){if(w===void 0)return m.prototype.once.call(this,y,A);var M=this._createDelegatedListener(y,A,w);for(var k in M.delegates)this.once(k,M.delegates[k]);return this},d.prototype.off=function(y,A,w){var M=this;return w===void 0?m.prototype.off.call(this,y,A):(this._delegatedListeners&&this._delegatedListeners[y]&&function(k){for(var G=k[y],q=0;q<G.length;q++){var pe=G[q];if(pe.layer===A&&pe.listener===w){for(var ye in pe.delegates)M.off(ye,pe.delegates[ye]);return G.splice(q,1),M}}}(this._delegatedListeners),this)},d.prototype.queryRenderedFeatures=function(y,A){if(!this.style)return[];var w;if(A!==void 0||y===void 0||y instanceof v.Point||Array.isArray(y)||(A=y,y=void 0),A=A||{},(y=y||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof y[0]=="number")w=[v.Point.convert(y)];else{var M=v.Point.convert(y[0]),k=v.Point.convert(y[1]);w=[M,new v.Point(k.x,M.y),k,new v.Point(M.x,k.y),M]}return this.style.queryRenderedFeatures(w,A,this.transform)},d.prototype.querySourceFeatures=function(y,A){return this.style.querySourceFeatures(y,A)},d.prototype.setStyle=function(y,A){return(A=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},A)).diff!==!1&&A.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,A),this):(this._localIdeographFontFamily=A.localIdeographFontFamily,this._updateStyle(y,A))},d.prototype._getUIString=function(y){var A=this._locale[y];if(A==null)throw new Error("Missing UI string '"+y+"'");return A},d.prototype._updateStyle=function(y,A){return this.style&&(this.style.setEventedParent(null),this.style._remove()),y?(this.style=new Rt(this,A||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y):this.style.loadJSON(y),this):(delete this.style,this)},d.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Rt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},d.prototype._diffStyle=function(y,A){var w=this;if(typeof y=="string"){var M=this._requestManager.normalizeStyleURL(y),k=this._requestManager.transformRequest(M,v.ResourceType.Style);v.getJSON(k,function(G,q){G?w.fire(new v.ErrorEvent(G)):q&&w._updateDiff(q,A)})}else typeof y=="object"&&this._updateDiff(y,A)},d.prototype._updateDiff=function(y,A){try{this.style.setState(y)&&this._update(!0)}catch(w){v.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(y,A)}},d.prototype.getStyle=function(){if(this.style)return this.style.serialize()},d.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},d.prototype.addSource=function(y,A){return this._lazyInitEmptyStyle(),this.style.addSource(y,A),this._update(!0)},d.prototype.isSourceLoaded=function(y){var A=this.style&&this.style.sourceCaches[y];if(A!==void 0)return A.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+y+"'")))},d.prototype.areTilesLoaded=function(){var y=this.style&&this.style.sourceCaches;for(var A in y){var w=y[A]._tiles;for(var M in w){var k=w[M];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},d.prototype.addSourceType=function(y,A,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(y,A,w)},d.prototype.removeSource=function(y){return this.style.removeSource(y),this._update(!0)},d.prototype.getSource=function(y){return this.style.getSource(y)},d.prototype.addImage=function(y,A,w){w===void 0&&(w={});var M=w.pixelRatio;M===void 0&&(M=1);var k=w.sdf;k===void 0&&(k=!1);var G=w.stretchX,q=w.stretchY,pe=w.content;if(this._lazyInitEmptyStyle(),A instanceof dl||pa&&A instanceof pa){var ye=v.browser.getImageData(A);this.style.addImage(y,{data:new v.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:M,stretchX:G,stretchY:q,content:pe,sdf:k,version:0})}else{if(A.width===void 0||A.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var be=A;this.style.addImage(y,{data:new v.RGBAImage({width:A.width,height:A.height},new Uint8Array(A.data)),pixelRatio:M,stretchX:G,stretchY:q,content:pe,sdf:k,version:0,userImage:be}),be.onAdd&&be.onAdd(this,y)}},d.prototype.updateImage=function(y,A){var w=this.style.getImage(y);if(!w)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=A instanceof dl||pa&&A instanceof pa?v.browser.getImageData(A):A,k=M.width,G=M.height,q=M.data;return k===void 0||G===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==w.data.width||G!==w.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(q,!(A instanceof dl||pa&&A instanceof pa)),void this.style.updateImage(y,w))},d.prototype.hasImage=function(y){return y?!!this.style.getImage(y):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},d.prototype.removeImage=function(y){this.style.removeImage(y)},d.prototype.loadImage=function(y,A){v.getImage(this._requestManager.transformRequest(y,v.ResourceType.Image),A)},d.prototype.listImages=function(){return this.style.listImages()},d.prototype.addLayer=function(y,A){return this._lazyInitEmptyStyle(),this.style.addLayer(y,A),this._update(!0)},d.prototype.moveLayer=function(y,A){return this.style.moveLayer(y,A),this._update(!0)},d.prototype.removeLayer=function(y){return this.style.removeLayer(y),this._update(!0)},d.prototype.getLayer=function(y){return this.style.getLayer(y)},d.prototype.setLayerZoomRange=function(y,A,w){return this.style.setLayerZoomRange(y,A,w),this._update(!0)},d.prototype.setFilter=function(y,A,w){return w===void 0&&(w={}),this.style.setFilter(y,A,w),this._update(!0)},d.prototype.getFilter=function(y){return this.style.getFilter(y)},d.prototype.setPaintProperty=function(y,A,w,M){return M===void 0&&(M={}),this.style.setPaintProperty(y,A,w,M),this._update(!0)},d.prototype.getPaintProperty=function(y,A){return this.style.getPaintProperty(y,A)},d.prototype.setLayoutProperty=function(y,A,w,M){return M===void 0&&(M={}),this.style.setLayoutProperty(y,A,w,M),this._update(!0)},d.prototype.getLayoutProperty=function(y,A){return this.style.getLayoutProperty(y,A)},d.prototype.setLight=function(y,A){return A===void 0&&(A={}),this._lazyInitEmptyStyle(),this.style.setLight(y,A),this._update(!0)},d.prototype.getLight=function(){return this.style.getLight()},d.prototype.setFeatureState=function(y,A){return this.style.setFeatureState(y,A),this._update()},d.prototype.removeFeatureState=function(y,A){return this.style.removeFeatureState(y,A),this._update()},d.prototype.getFeatureState=function(y){return this.style.getFeatureState(y)},d.prototype.getContainer=function(){return this._container},d.prototype.getCanvasContainer=function(){return this._canvasContainer},d.prototype.getCanvas=function(){return this._canvas},d.prototype._containerDimensions=function(){var y=0,A=0;return this._container&&(y=this._container.clientWidth||400,A=this._container.clientHeight||300),[y,A]},d.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},d.prototype._setupContainer=function(){var y=this._container;y.classList.add("mapboxgl-map"),(this._missingCSSCanary=W.create("div","mapboxgl-canary",y)).style.visibility="hidden",this._detectMissingCSS();var A=this._canvasContainer=W.create("div","mapboxgl-canvas-container",y);this._interactive&&A.classList.add("mapboxgl-interactive"),this._canvas=W.create("canvas","mapboxgl-canvas",A),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var M=this._controlContainer=W.create("div","mapboxgl-control-container",y),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(G){k[G]=W.create("div","mapboxgl-ctrl-"+G,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},d.prototype._resizeCanvas=function(y,A){var w=v.browser.devicePixelRatio||1;this._canvas.width=w*y,this._canvas.height=w*A,this._canvas.style.width=y+"px",this._canvas.style.height=A+"px"},d.prototype._setupPainter=function(){var y=v.extend({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),A=this._canvas.getContext("webgl",y)||this._canvas.getContext("experimental-webgl",y);A?(this.painter=new ja(A,this.transform),v.webpSupported.testSupport(A)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},d.prototype._contextLost=function(y){y.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:y}))},d.prototype._contextRestored=function(y){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:y}))},d.prototype._onMapScroll=function(y){if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},d.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},d.prototype._update=function(y){return this.style?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this},d.prototype._requestRenderFrame=function(y){return this._update(),this._renderTaskQueue.add(y)},d.prototype._cancelRenderFrame=function(y){this._renderTaskQueue.remove(y)},d.prototype._render=function(y){var A,w=this,M=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(A=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,A),M=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),!this._removed){var G=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var q=this.transform.zoom,pe=v.browser.now();this.style.zoomHistory.update(q,pe);var ye=new v.EvaluationParameters(q,{now:pe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),be=ye.crossFadingFactor();be===1&&be===this._crossFadingFactor||(G=!0,this._crossFadingFactor=be),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||G)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var qe=v.browser.now()-M;k.endQueryEXT(k.TIME_ELAPSED_EXT,A),setTimeout(function(){var We=k.getQueryObjectEXT(A,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(A),w.fire(new v.Event("gpu-timing-frame",{cpuTime:qe,gpuTime:We}))},50)}if(this.listens("gpu-timing-layer")){var Ue=this.painter.collectGpuTimers();setTimeout(function(){var We=w.painter.queryGpuTimers(Ue);w.fire(new v.Event("gpu-timing-layer",{layerTimes:We}))},50)}var ht=this._sourcesDirty||this._styleDirty||this._placementDirty;return ht||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||ht||(this._fullyLoaded=!0),this}},d.prototype.remove=function(){this._hash&&this._hash.remove();for(var y=0,A=this._controls;y<A.length;y+=1)A[y].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Wl(this._canvasContainer),Wl(this._controlContainer),Wl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},d.prototype.triggerRepaint=function(){var y=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(A){y._frame=null,y._render(A)}))},d.prototype._onWindowOnline=function(){this._update()},d.prototype._onWindowResize=function(y){this._trackResize&&this.resize({originalEvent:y})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(y){this._showPadding!==y&&(this._showPadding=y,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(y){this._vertices=y,this._update()},d.prototype._setCacheLimits=function(y,A){v.setCacheLimits(y,A)},p.version.get=function(){return v.version},Object.defineProperties(d.prototype,p),d}(eu);function Wl(m){m.parentNode&&m.parentNode.removeChild(m)}var ch={showCompass:!0,showZoom:!0,visualizePitch:!1},ml=function(d){var p=this;this.options=v.extend({},ch,d),this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(y){return y.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(y){return p._map.zoomIn({},{originalEvent:y})}),W.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(y){return p._map.zoomOut({},{originalEvent:y})}),W.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(y){p.options.visualizePitch?p._map.resetNorthPitch({},{originalEvent:y}):p._map.resetNorth({},{originalEvent:y})}),this._compassIcon=W.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ml.prototype._updateZoomButtons=function(){var m=this._map.getZoom(),d=m===this._map.getMaxZoom(),p=m===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},ml.prototype._rotateCompassArrow=function(){var m=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=m},ml.prototype.onAdd=function(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tu(this._map,this._compass,this.options.visualizePitch)),this._container},ml.prototype.onRemove=function(){W.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ml.prototype._createButton=function(m,d){var p=W.create("button",m,this._container);return p.type="button",p.addEventListener("click",d),p},ml.prototype._setButtonTitle=function(m,d){var p=this._map._getUIString("NavigationControl."+d);m.title=p,m.setAttribute("aria-label",p)};var tu=function(d,p,y){y===void 0&&(y=!1),this._clickTolerance=10,this.element=p,this.mouseRotate=new wf({clickTolerance:d.dragRotate._mouseRotate._clickTolerance}),this.map=d,y&&(this.mousePitch=new sh({clickTolerance:d.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),W.addEventListener(p,"mousedown",this.mousedown),W.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),W.addEventListener(p,"touchmove",this.touchmove),W.addEventListener(p,"touchend",this.touchend),W.addEventListener(p,"touchcancel",this.reset)};function Xc(m,d,p){if(m=new v.LngLat(m.lng,m.lat),d){var y=new v.LngLat(m.lng-360,m.lat),A=new v.LngLat(m.lng+360,m.lat),w=p.locationPoint(m).distSqr(d);p.locationPoint(y).distSqr(d)<w?m=y:p.locationPoint(A).distSqr(d)<w&&(m=A)}for(;Math.abs(m.lng-p.center.lng)>180;){var M=p.locationPoint(m);if(M.x>=0&&M.y>=0&&M.x<=p.width&&M.y<=p.height)break;m.lng>p.center.lng?m.lng-=360:m.lng+=360}return m}tu.prototype.down=function(m,d){this.mouseRotate.mousedown(m,d),this.mousePitch&&this.mousePitch.mousedown(m,d),W.disableDrag()},tu.prototype.move=function(m,d){var p=this.map,y=this.mouseRotate.mousemoveWindow(m,d);if(y&&y.bearingDelta&&p.setBearing(p.getBearing()+y.bearingDelta),this.mousePitch){var A=this.mousePitch.mousemoveWindow(m,d);A&&A.pitchDelta&&p.setPitch(p.getPitch()+A.pitchDelta)}},tu.prototype.off=function(){var m=this.element;W.removeEventListener(m,"mousedown",this.mousedown),W.removeEventListener(m,"touchstart",this.touchstart,{passive:!1}),W.removeEventListener(m,"touchmove",this.touchmove),W.removeEventListener(m,"touchend",this.touchend),W.removeEventListener(m,"touchcancel",this.reset),this.offTemp()},tu.prototype.offTemp=function(){W.enableDrag(),W.removeEventListener(v.window,"mousemove",this.mousemove),W.removeEventListener(v.window,"mouseup",this.mouseup)},tu.prototype.mousedown=function(m){this.down(v.extend({},m,{ctrlKey:!0,preventDefault:function(){return m.preventDefault()}}),W.mousePos(this.element,m)),W.addEventListener(v.window,"mousemove",this.mousemove),W.addEventListener(v.window,"mouseup",this.mouseup)},tu.prototype.mousemove=function(m){this.move(m,W.mousePos(this.element,m))},tu.prototype.mouseup=function(m){this.mouseRotate.mouseupWindow(m),this.mousePitch&&this.mousePitch.mouseupWindow(m),this.offTemp()},tu.prototype.touchstart=function(m){m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=W.touchPos(this.element,m.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return m.preventDefault()}},this._startPos))},tu.prototype.touchmove=function(m){m.targetTouches.length!==1?this.reset():(this._lastPos=W.touchPos(this.element,m.targetTouches)[0],this.move({preventDefault:function(){return m.preventDefault()}},this._lastPos))},tu.prototype.touchend=function(m){m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},tu.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var bu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function fh(m,d,p){var y=m.classList;for(var A in bu)y.remove("mapboxgl-"+p+"-anchor-"+A);y.add("mapboxgl-"+p+"-anchor-"+d)}var Zc,hh=function(m){function d(p,y){if(m.call(this),(p instanceof v.window.HTMLElement||y)&&(p=v.extend({element:p},y)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=v.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=W.create("div"),this._element.setAttribute("aria-label","Map marker");var A=W.createNS("http://www.w3.org/2000/svg","svg");A.setAttributeNS(null,"display","block"),A.setAttributeNS(null,"height","41px"),A.setAttributeNS(null,"width","27px"),A.setAttributeNS(null,"viewBox","0 0 27 41");var w=W.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var M=W.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var k=W.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var G=0,q=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];G<q.length;G+=1){var pe=q[G],ye=W.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",pe.rx),ye.setAttributeNS(null,"ry",pe.ry),k.appendChild(ye)}var be=W.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"fill",this._color);var qe=W.createNS("http://www.w3.org/2000/svg","path");qe.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),be.appendChild(qe);var Ue=W.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"opacity","0.25"),Ue.setAttributeNS(null,"fill","#000000");var ht=W.createNS("http://www.w3.org/2000/svg","path");ht.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ue.appendChild(ht);var We=W.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"transform","translate(6.0, 7.0)"),We.setAttributeNS(null,"fill","#FFFFFF");var nt=W.createNS("http://www.w3.org/2000/svg","g");nt.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Mt=W.createNS("http://www.w3.org/2000/svg","circle");Mt.setAttributeNS(null,"fill","#000000"),Mt.setAttributeNS(null,"opacity","0.25"),Mt.setAttributeNS(null,"cx","5.5"),Mt.setAttributeNS(null,"cy","5.5"),Mt.setAttributeNS(null,"r","5.4999962");var Pt=W.createNS("http://www.w3.org/2000/svg","circle");Pt.setAttributeNS(null,"fill","#FFFFFF"),Pt.setAttributeNS(null,"cx","5.5"),Pt.setAttributeNS(null,"cy","5.5"),Pt.setAttributeNS(null,"r","5.4999962"),nt.appendChild(Mt),nt.appendChild(Pt),M.appendChild(k),M.appendChild(be),M.appendChild(Ue),M.appendChild(We),M.appendChild(nt),A.appendChild(M),A.setAttributeNS(null,"height",41*this._scale+"px"),A.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(A),this._offset=v.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(vr){vr.preventDefault()}),this._element.addEventListener("mousedown",function(vr){vr.preventDefault()}),fh(this._element,this._anchor,"marker"),this._popup=null}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},d.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),W.remove(this._element),this._popup&&this._popup.remove(),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=v.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},d.prototype.getElement=function(){return this._element},d.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var y=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(24.6+y)],"bottom-right":[-y,-1*(24.6+y)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},d.prototype._onKeyPress=function(p){var y=p.code,A=p.charCode||p.keyCode;y!=="Space"&&y!=="Enter"&&A!==32&&A!==13||this.togglePopup()},d.prototype._onMapClick=function(p){var y=p.originalEvent.target,A=this._element;this._popup&&(y===A||A.contains(y))&&this.togglePopup()},d.prototype.getPopup=function(){return this._popup},d.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},d.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Xc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(y="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),W.setTransform(this._element,bu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+A+" "+y)}},d.prototype.getOffset=function(){return this._offset},d.prototype.setOffset=function(p){return this._offset=v.Point.convert(p),this._update(),this},d.prototype._onMove=function(p){if(!this._isDragging){var y=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},d.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},d.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},d.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},d.prototype.isDraggable=function(){return this._draggable},d.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},d.prototype.getRotation=function(){return this._rotation},d.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},d.prototype.getRotationAlignment=function(){return this._rotationAlignment},d.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},d.prototype.getPitchAlignment=function(){return this._pitchAlignment},d}(v.Evented),vc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},$c=0,Yc=!1,Wh=function(m){function d(p){m.call(this),this.options=v.extend({},vc,p),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.onAdd=function(p){var y;return this._map=p,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),y=this._setupUI,Zc!==void 0?y(Zc):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(A){y(Zc=A.state!=="denied")}):y(Zc=!!v.window.navigator.geolocation),this._container},d.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),W.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$c=0,Yc=!1},d.prototype._isOutOfMapMaxBounds=function(p){var y=this._map.getMaxBounds(),A=p.coords;return y&&(A.longitude<y.getWest()||A.longitude>y.getEast()||A.latitude<y.getSouth()||A.latitude>y.getNorth())},d.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},d.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",p)),this._finish()}},d.prototype._updateCamera=function(p){var y=new v.LngLat(p.coords.longitude,p.coords.latitude),A=p.coords.accuracy,w=this._map.getBearing(),M=v.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(y.toBounds(A),M,{geolocateSource:!0})},d.prototype._updateMarker=function(p){if(p){var y=new v.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(y).addTo(this._map),this._userLocationDotMarker.setLngLat(y).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},d.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,y=this._map.unproject([0,p]),A=this._map.unproject([1,p]),w=y.distanceTo(A),M=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},d.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},d.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&Yc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",p)),this._finish()}},d.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},d.prototype._setupUI=function(p){var y=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=W.create("button","mapboxgl-ctrl-geolocate",this._container),W.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var A=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=W.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new hh(this._dotElement),this._circleElement=W.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||y._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(y._watchState="BACKGROUND",y._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),y._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),y.fire(new v.Event("trackuserlocationend")))})},d.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$c--,Yc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++$c>1?(p={maximumAge:6e5,timeout:0},Yc=!0):(p=this.options.positionOptions,Yc=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},d.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},d}(v.Evented),L={maxWidth:100,unit:"metric"},xu=function(d){this.options=v.extend({},L,d),v.bindAll(["_onMove","setUnit"],this)};function Gh(m,d,p){var y=p&&p.maxWidth||100,A=m._container.clientHeight/2,w=m.unproject([0,A]),M=m.unproject([y,A]),k=w.distanceTo(M);if(p&&p.unit==="imperial"){var G=3.2808*k;G>5280?qu(d,y,G/5280,m._getUIString("ScaleControl.Miles")):qu(d,y,G,m._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?qu(d,y,k/1852,m._getUIString("ScaleControl.NauticalMiles")):k>=1e3?qu(d,y,k/1e3,m._getUIString("ScaleControl.Kilometers")):qu(d,y,k,m._getUIString("ScaleControl.Meters"))}function qu(m,d,p,y){var A,w,M,k=(A=p,(w=Math.pow(10,(""+Math.floor(A)).length-1))*(M=(M=A/w)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(G){var q=Math.pow(10,Math.ceil(-Math.log(G)/Math.LN10));return Math.round(G*q)/q}(M)));m.style.width=d*(k/p)+"px",m.innerHTML=k+"&nbsp;"+y}xu.prototype.getDefaultPosition=function(){return"bottom-left"},xu.prototype._onMove=function(){Gh(this._map,this._container,this.options)},xu.prototype.onAdd=function(m){return this._map=m,this._container=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},xu.prototype.onRemove=function(){W.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},xu.prototype.setUnit=function(m){this.options.unit=m,Gh(this._map,this._container,this.options)};var Eu=function(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof v.window.HTMLElement?this._container=d.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Eu.prototype.onAdd=function(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=W.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Eu.prototype.onRemove=function(){W.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Eu.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Eu.prototype._setupUI=function(){var m=this._fullscreenButton=W.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);W.create("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden",!0),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Eu.prototype._updateTitle=function(){var m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m},Eu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Eu.prototype._isFullscreen=function(){return this._fullscreen},Eu.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Eu.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Of={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ph=function(m){function d(p){m.call(this),this.options=v.extend(Object.create(Of),p),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return m&&(d.__proto__=m),(d.prototype=Object.create(m&&m.prototype)).constructor=d,d.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},d.prototype.isOpen=function(){return!!this._map},d.prototype.remove=function(){return this._content&&W.remove(this._content),this._container&&(W.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},d.prototype.getLngLat=function(){return this._lngLat},d.prototype.setLngLat=function(p){return this._lngLat=v.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},d.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},d.prototype.getElement=function(){return this._container},d.prototype.setText=function(p){return this.setDOMContent(v.window.document.createTextNode(p))},d.prototype.setHTML=function(p){var y,A=v.window.document.createDocumentFragment(),w=v.window.document.createElement("body");for(w.innerHTML=p;y=w.firstChild;)A.appendChild(y);return this.setDOMContent(A)},d.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},d.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},d.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=W.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},d.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},d.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},d.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},d.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},d.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=W.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},d.prototype._onMouseUp=function(p){this._update(p.point)},d.prototype._onMouseMove=function(p){this._update(p.point)},d.prototype._onDrag=function(p){this._update(p.point)},d.prototype._update=function(p){var y=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=W.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=W.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return y._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Xc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var A=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),w=this.options.anchor,M=function ye(be){if(be){if(typeof be=="number"){var qe=Math.round(Math.sqrt(.5*Math.pow(be,2)));return{center:new v.Point(0,0),top:new v.Point(0,be),"top-left":new v.Point(qe,qe),"top-right":new v.Point(-qe,qe),bottom:new v.Point(0,-be),"bottom-left":new v.Point(qe,-qe),"bottom-right":new v.Point(-qe,-qe),left:new v.Point(be,0),right:new v.Point(-be,0)}}if(be instanceof v.Point||Array.isArray(be)){var Ue=v.Point.convert(be);return{center:Ue,top:Ue,"top-left":Ue,"top-right":Ue,bottom:Ue,"bottom-left":Ue,"bottom-right":Ue,left:Ue,right:Ue}}return{center:v.Point.convert(be.center||[0,0]),top:v.Point.convert(be.top||[0,0]),"top-left":v.Point.convert(be["top-left"]||[0,0]),"top-right":v.Point.convert(be["top-right"]||[0,0]),bottom:v.Point.convert(be.bottom||[0,0]),"bottom-left":v.Point.convert(be["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(be["bottom-right"]||[0,0]),left:v.Point.convert(be.left||[0,0]),right:v.Point.convert(be.right||[0,0])}}return ye(new v.Point(0,0))}(this.options.offset);if(!w){var k,G=this._container.offsetWidth,q=this._container.offsetHeight;k=A.y+M.bottom.y<q?["top"]:A.y>this._map.transform.height-q?["bottom"]:[],A.x<G/2?k.push("left"):A.x>this._map.transform.width-G/2&&k.push("right"),w=k.length===0?"bottom":k.join("-")}var pe=A.add(M[w]).round();W.setTransform(this._container,bu[w]+" translate("+pe.x+"px,"+pe.y+"px)"),fh(this._container,w,"popup")}},d.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(Gl);p&&p.focus()}},d.prototype._onClose=function(){this.remove()},d}(v.Evented),dh={version:v.version,supported:z,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Hh,NavigationControl:ml,GeolocateControl:Wh,AttributionControl:bs,ScaleControl:xu,FullscreenControl:Eu,Popup:ph,Marker:hh,Style:Rt,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){dr().acquire(pr)},clearPrewarmedResources:function(){var d=Gn;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(pr),Gn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(m){v.config.ACCESS_TOKEN=m},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(m){v.config.API_URL=m},get workerCount(){return Wr.workerCount},set workerCount(m){Wr.workerCount=m},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){v.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage:function(d){v.clearTileCache(d)},workerUrl:""};return dh}),X})},"4cb6":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiBindToService=Q.getServiceIdentifierAsString=Q.typeConstraint=Q.namedConstraint=Q.taggedConstraint=Q.traverseAncerstors=Q.decorate=Q.id=Q.MetadataReader=Q.postConstruct=Q.targetName=Q.multiInject=Q.unmanaged=Q.optional=Q.LazyServiceIdentifer=Q.inject=Q.named=Q.tagged=Q.injectable=Q.ContainerModule=Q.AsyncContainerModule=Q.TargetTypeEnum=Q.BindingTypeEnum=Q.BindingScopeEnum=Q.Container=Q.METADATA_KEY=void 0;var j=O("xfSm");Q.METADATA_KEY=j;var H=O("9Fde");Object.defineProperty(Q,"Container",{enumerable:!0,get:function(){return H.Container}});var X=O("FV85");Object.defineProperty(Q,"BindingScopeEnum",{enumerable:!0,get:function(){return X.BindingScopeEnum}}),Object.defineProperty(Q,"BindingTypeEnum",{enumerable:!0,get:function(){return X.BindingTypeEnum}}),Object.defineProperty(Q,"TargetTypeEnum",{enumerable:!0,get:function(){return X.TargetTypeEnum}});var N=O("dxzI");Object.defineProperty(Q,"AsyncContainerModule",{enumerable:!0,get:function(){return N.AsyncContainerModule}}),Object.defineProperty(Q,"ContainerModule",{enumerable:!0,get:function(){return N.ContainerModule}});var v=O("cZ5Q");Object.defineProperty(Q,"injectable",{enumerable:!0,get:function(){return v.injectable}});var z=O("0gSV");Object.defineProperty(Q,"tagged",{enumerable:!0,get:function(){return z.tagged}});var W=O("ZzCi");Object.defineProperty(Q,"named",{enumerable:!0,get:function(){return W.named}});var Pe=O("Yk9n");Object.defineProperty(Q,"inject",{enumerable:!0,get:function(){return Pe.inject}}),Object.defineProperty(Q,"LazyServiceIdentifer",{enumerable:!0,get:function(){return Pe.LazyServiceIdentifer}});var se=O("jYx5");Object.defineProperty(Q,"optional",{enumerable:!0,get:function(){return se.optional}});var ve=O("n2J3");Object.defineProperty(Q,"unmanaged",{enumerable:!0,get:function(){return ve.unmanaged}});var ue=O("jIg/");Object.defineProperty(Q,"multiInject",{enumerable:!0,get:function(){return ue.multiInject}});var gt=O("oaX6");Object.defineProperty(Q,"targetName",{enumerable:!0,get:function(){return gt.targetName}});var Ne=O("Sk89");Object.defineProperty(Q,"postConstruct",{enumerable:!0,get:function(){return Ne.postConstruct}});var st=O("wnjb");Object.defineProperty(Q,"MetadataReader",{enumerable:!0,get:function(){return st.MetadataReader}});var Dt=O("d9O0");Object.defineProperty(Q,"id",{enumerable:!0,get:function(){return Dt.id}});var pt=O("Ztfv");Object.defineProperty(Q,"decorate",{enumerable:!0,get:function(){return pt.decorate}});var $e=O("RR/i");Object.defineProperty(Q,"traverseAncerstors",{enumerable:!0,get:function(){return $e.traverseAncerstors}}),Object.defineProperty(Q,"taggedConstraint",{enumerable:!0,get:function(){return $e.taggedConstraint}}),Object.defineProperty(Q,"namedConstraint",{enumerable:!0,get:function(){return $e.namedConstraint}}),Object.defineProperty(Q,"typeConstraint",{enumerable:!0,get:function(){return $e.typeConstraint}});var Ct=O("ujMp");Object.defineProperty(Q,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return Ct.getServiceIdentifierAsString}});var et=O("78VC");Object.defineProperty(Q,"multiBindToService",{enumerable:!0,get:function(){return et.multiBindToService}})},"4qC0":function(Qe,Q,O){var j=O("NykK"),H=O("Z0cm"),X=O("ExA7"),N="[object String]";function v(z){return typeof z=="string"||!H(z)&&X(z)&&j(z)==N}Qe.exports=v},"623A":function(Qe,Q,O){"use strict";(function(j,H){Qe.exports=H()})(this,function(){function j(ve){var ue=[];return ve.AMapUI&&ue.push(H(ve.AMapUI)),ve.Loca&&ue.push(X(ve.Loca)),Promise.all(ue)}function H(ve){return new Promise(function(ue,gt){var Ne=[];if(ve.plugins)for(var st=0;st<ve.plugins.length;st+=1)v.AMapUI.plugins.indexOf(ve.plugins[st])==-1&&Ne.push(ve.plugins[st]);if(z.AMapUI===N.failed)gt("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(z.AMapUI===N.notload){z.AMapUI=N.loading,v.AMapUI.version=ve.version||v.AMapUI.version,st=v.AMapUI.version;var Dt=document.body||document.head,pt=document.createElement("script");pt.type="text/javascript",pt.src="https://webapi.amap.com/ui/"+st+"/main.js",pt.onerror=function($e){z.AMapUI=N.failed,gt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},pt.onload=function(){if(z.AMapUI=N.loaded,Ne.length)window.AMapUI.loadUI(Ne,function(){for(var $e=0,Ct=Ne.length;$e<Ct;$e++){var et=Ne[$e].split("/").slice(-1)[0];window.AMapUI[et]=arguments[$e]}for(ue();W.AMapUI.length;)W.AMapUI.splice(0,1)[0]()});else for(ue();W.AMapUI.length;)W.AMapUI.splice(0,1)[0]()},Dt.appendChild(pt)}else z.AMapUI===N.loaded?ve.version&&ve.version!==v.AMapUI.version?gt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):Ne.length?window.AMapUI.loadUI(Ne,function(){for(var $e=0,Ct=Ne.length;$e<Ct;$e++){var et=Ne[$e].split("/").slice(-1)[0];window.AMapUI[et]=arguments[$e]}ue()}):ue():ve.version&&ve.version!==v.AMapUI.version?gt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):W.AMapUI.push(function($e){$e?gt($e):Ne.length?window.AMapUI.loadUI(Ne,function(){for(var Ct=0,et=Ne.length;Ct<et;Ct++){var kt=Ne[Ct].split("/").slice(-1)[0];window.AMapUI[kt]=arguments[Ct]}ue()}):ue()})})}function X(ve){return new Promise(function(ue,gt){if(v.AMap.version.startsWith("2.0"))gt("Loca \u6682\u4E0D\u9002\u914D JSAPI 2.0,\u8BF7\u4F7F\u7528 1.4.15");else if(z.Loca===N.failed)gt("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(z.Loca===N.notload){z.Loca=N.loading,v.Loca.version=ve.version||v.Loca.version;var Ne=v.Loca.version,st=v.key,Dt=document.body||document.head,pt=document.createElement("script");pt.type="text/javascript",pt.src="https://webapi.amap.com/loca?v="+Ne+"&key="+st,pt.onerror=function($e){z.Loca=N.failed,gt("\u8BF7\u6C42 AMapUI \u5931\u8D25")},pt.onload=function(){for(z.Loca=N.loaded,ue();W.Loca.length;)W.Loca.splice(0,1)[0]()},Dt.appendChild(pt)}else z.Loca===N.loaded?ve.version&&ve.version!==v.Loca.version?gt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):ue():ve.version&&ve.version!==v.Loca.version?gt("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):W.Loca.push(function($e){$e?gt($e):gt()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var N;(function(ve){ve.notload="notload",ve.loading="loading",ve.loaded="loaded",ve.failed="failed"})(N||(N={}));var v={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},z={AMap:N.notload,AMapUI:N.notload,Loca:N.notload},W={AMap:[],AMapUI:[],Loca:[]},Pe=[],se=function(ue){typeof ue=="function"&&(z.AMap===N.loaded?ue(window.AMap):Pe.push(ue))};return{load:function(ue){return new Promise(function(gt,Ne){if(z.AMap==N.failed)Ne("");else if(z.AMap==N.notload){var st=ue.key,Dt=ue.version,pt=ue.plugins;st?(window.AMap&&location.host!=="lbs.amap.com"&&Ne("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),v.key=st,v.AMap.version=Dt||v.AMap.version,v.AMap.plugins=pt||v.AMap.plugins,z.AMap=N.loading,Dt=document.body||document.head,window.___onAPILoaded=function(Ct){if(delete window.___onAPILoaded,Ct)z.AMap=N.failed,Ne(Ct);else for(z.AMap=N.loaded,j(ue).then(function(){gt(window.AMap)}).catch(Ne);Pe.length;)Pe.splice(0,1)[0]()},pt=document.createElement("script"),pt.type="text/javascript",pt.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+v.AMap.version+"&key="+st+"&plugin="+v.AMap.plugins.join(","),pt.onerror=function(Ct){z.AMap=N.failed,Ne(Ct)},Dt.appendChild(pt)):Ne("\u8BF7\u586B\u5199key")}else if(z.AMap==N.loaded)if(ue.key&&ue.key!==v.key)Ne("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(ue.version&&ue.version!==v.AMap.version)Ne("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(st=[],ue.plugins)for(Dt=0;Dt<ue.plugins.length;Dt+=1)v.AMap.plugins.indexOf(ue.plugins[Dt])==-1&&st.push(ue.plugins[Dt]);st.length?window.AMap.plugin(st,function(){j(ue).then(function(){gt(window.AMap)}).catch(Ne)}):j(ue).then(function(){gt(window.AMap)}).catch(Ne)}else if(ue.key&&ue.key!==v.key)Ne("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(ue.version&&ue.version!==v.AMap.version)Ne("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var $e=[];if(ue.plugins)for(Dt=0;Dt<ue.plugins.length;Dt+=1)v.AMap.plugins.indexOf(ue.plugins[Dt])==-1&&$e.push(ue.plugins[Dt]);se(function(){$e.length?window.AMap.plugin($e,function(){j(ue).then(function(){gt(window.AMap)}).catch(Ne)}):j(ue).then(function(){gt(window.AMap)}).catch(Ne)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,v={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},z={AMap:N.notload,AMapUI:N.notload,Loca:N.notload},W={AMap:[],AMapUI:[],Loca:[]}}}})},"6AGu":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInSyntax=void 0;var j=O("FV85"),H=O("LKzl"),X=function(){function N(v){this._binding=v}return N.prototype.inRequestScope=function(){return this._binding.scope=j.BindingScopeEnum.Request,new H.BindingWhenOnSyntax(this._binding)},N.prototype.inSingletonScope=function(){return this._binding.scope=j.BindingScopeEnum.Singleton,new H.BindingWhenOnSyntax(this._binding)},N.prototype.inTransientScope=function(){return this._binding.scope=j.BindingScopeEnum.Transient,new H.BindingWhenOnSyntax(this._binding)},N}();Q.BindingInSyntax=X},"6D9b":function(Qe,Q,O){},"6acW":function(Qe,Q,O){var j=O("dt0z"),H=O("gQMU");function X(N){return H(j(N).toLowerCase())}Qe.exports=X},"6nK8":function(Qe,Q,O){var j=O("dVn5"),H=O("fo6e"),X=O("dt0z"),N=O("9NmV");function v(z,W,Pe){return z=X(z),W=Pe?void 0:W,W===void 0?H(z)?N(z):j(z):z.match(W)||[]}Qe.exports=v},"711d":function(Qe,Q){function O(j){return function(H){return H==null?void 0:H[j]}}Qe.exports=O},"78VC":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiBindToService=void 0;var j=function(X){return function(N){return function(){for(var v=[],z=0;z<arguments.length;z++)v[z]=arguments[z];return v.forEach(function(W){return X.bind(W).toService(N)})}}};Q.multiBindToService=j},"7tbW":function(Qe,Q,O){var j=O("LGYb");function H(X){return X&&X.length?j(X):[]}Qe.exports=H},"9Fde":function(Qe,Q,O){"use strict";var j=this&&this.__awaiter||function($e,Ct,et,kt){function Je(Xe){return Xe instanceof et?Xe:new et(function(jr){jr(Xe)})}return new(et||(et=Promise))(function(Xe,jr){function Dr(Nt){try{Be(kt.next(Nt))}catch(Gt){jr(Gt)}}function Jt(Nt){try{Be(kt.throw(Nt))}catch(Gt){jr(Gt)}}function Be(Nt){Nt.done?Xe(Nt.value):Je(Nt.value).then(Dr,Jt)}Be((kt=kt.apply($e,Ct||[])).next())})},H=this&&this.__generator||function($e,Ct){var et={label:0,sent:function(){if(Xe[0]&1)throw Xe[1];return Xe[1]},trys:[],ops:[]},kt,Je,Xe,jr;return jr={next:Dr(0),throw:Dr(1),return:Dr(2)},typeof Symbol=="function"&&(jr[Symbol.iterator]=function(){return this}),jr;function Dr(Be){return function(Nt){return Jt([Be,Nt])}}function Jt(Be){if(kt)throw new TypeError("Generator is already executing.");for(;et;)try{if(kt=1,Je&&(Xe=Be[0]&2?Je.return:Be[0]?Je.throw||((Xe=Je.return)&&Xe.call(Je),0):Je.next)&&!(Xe=Xe.call(Je,Be[1])).done)return Xe;switch(Je=0,Xe&&(Be=[Be[0]&2,Xe.value]),Be[0]){case 0:case 1:Xe=Be;break;case 4:return et.label++,{value:Be[1],done:!1};case 5:et.label++,Je=Be[1],Be=[0];continue;case 7:Be=et.ops.pop(),et.trys.pop();continue;default:if(Xe=et.trys,!(Xe=Xe.length>0&&Xe[Xe.length-1])&&(Be[0]===6||Be[0]===2)){et=0;continue}if(Be[0]===3&&(!Xe||Be[1]>Xe[0]&&Be[1]<Xe[3])){et.label=Be[1];break}if(Be[0]===6&&et.label<Xe[1]){et.label=Xe[1],Xe=Be;break}if(Xe&&et.label<Xe[2]){et.label=Xe[2],et.ops.push(Be);break}Xe[2]&&et.ops.pop(),et.trys.pop();continue}Be=Ct.call($e,et)}catch(Nt){Be=[6,Nt],Je=0}finally{kt=Xe=0}if(Be[0]&5)throw Be[1];return{value:Be[0]?Be[1]:void 0,done:!0}}},X=this&&this.__spreadArray||function($e,Ct){for(var et=0,kt=Ct.length,Je=$e.length;et<kt;et++,Je++)$e[Je]=Ct[et];return $e};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Container=void 0;var N=O("LgvC"),v=O("MON2"),z=O("FV85"),W=O("xfSm"),Pe=O("wnjb"),se=O("h7MG"),ve=O("aPG5"),ue=O("gzZq"),gt=O("d9O0"),Ne=O("ujMp"),st=O("HpQ9"),Dt=O("AwBQ"),pt=function(){function $e(Ct){this._appliedMiddleware=[];var et=Ct||{};if(typeof et!="object")throw new Error(""+v.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(et.defaultScope===void 0)et.defaultScope=z.BindingScopeEnum.Transient;else if(et.defaultScope!==z.BindingScopeEnum.Singleton&&et.defaultScope!==z.BindingScopeEnum.Transient&&et.defaultScope!==z.BindingScopeEnum.Request)throw new Error(""+v.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(et.autoBindInjectable===void 0)et.autoBindInjectable=!1;else if(typeof et.autoBindInjectable!="boolean")throw new Error(""+v.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(et.skipBaseClassChecks===void 0)et.skipBaseClassChecks=!1;else if(typeof et.skipBaseClassChecks!="boolean")throw new Error(""+v.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:et.autoBindInjectable,defaultScope:et.defaultScope,skipBaseClassChecks:et.skipBaseClassChecks},this.id=gt.id(),this._bindingDictionary=new Dt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Pe.MetadataReader}return $e.merge=function(Ct,et){for(var kt=[],Je=2;Je<arguments.length;Je++)kt[Je-2]=arguments[Je];var Xe=new $e,jr=X([Ct,et],kt).map(function(Be){return se.getBindingDictionary(Be)}),Dr=se.getBindingDictionary(Xe);function Jt(Be,Nt){Be.traverse(function(Gt,Te){Te.forEach(function(me){Nt.add(me.serviceIdentifier,me.clone())})})}return jr.forEach(function(Be){Jt(Be,Dr)}),Xe},$e.prototype.load=function(){for(var Ct=[],et=0;et<arguments.length;et++)Ct[et]=arguments[et];for(var kt=this._getContainerModuleHelpersFactory(),Je=0,Xe=Ct;Je<Xe.length;Je++){var jr=Xe[Je],Dr=kt(jr.id);jr.registry(Dr.bindFunction,Dr.unbindFunction,Dr.isboundFunction,Dr.rebindFunction)}},$e.prototype.loadAsync=function(){for(var Ct=[],et=0;et<arguments.length;et++)Ct[et]=arguments[et];return j(this,void 0,void 0,function(){var kt,Je,Xe,jr,Dr;return H(this,function(Jt){switch(Jt.label){case 0:kt=this._getContainerModuleHelpersFactory(),Je=0,Xe=Ct,Jt.label=1;case 1:return Je<Xe.length?(jr=Xe[Je],Dr=kt(jr.id),[4,jr.registry(Dr.bindFunction,Dr.unbindFunction,Dr.isboundFunction,Dr.rebindFunction)]):[3,4];case 2:Jt.sent(),Jt.label=3;case 3:return Je++,[3,1];case 4:return[2]}})})},$e.prototype.unload=function(){for(var Ct=this,et=[],kt=0;kt<arguments.length;kt++)et[kt]=arguments[kt];var Je=function(jr){return function(Dr){return Dr.moduleId===jr}};et.forEach(function(Xe){var jr=Je(Xe.id);Ct._bindingDictionary.removeByCondition(jr)})},$e.prototype.bind=function(Ct){var et=this.options.defaultScope||z.BindingScopeEnum.Transient,kt=new N.Binding(Ct,et);return this._bindingDictionary.add(Ct,kt),new ue.BindingToSyntax(kt)},$e.prototype.rebind=function(Ct){return this.unbind(Ct),this.bind(Ct)},$e.prototype.unbind=function(Ct){try{this._bindingDictionary.remove(Ct)}catch(et){throw new Error(v.CANNOT_UNBIND+" "+Ne.getServiceIdentifierAsString(Ct))}},$e.prototype.unbindAll=function(){this._bindingDictionary=new Dt.Lookup},$e.prototype.isBound=function(Ct){var et=this._bindingDictionary.hasKey(Ct);return!et&&this.parent&&(et=this.parent.isBound(Ct)),et},$e.prototype.isBoundNamed=function(Ct,et){return this.isBoundTagged(Ct,W.NAMED_TAG,et)},$e.prototype.isBoundTagged=function(Ct,et,kt){var Je=!1;if(this._bindingDictionary.hasKey(Ct)){var Xe=this._bindingDictionary.get(Ct),jr=se.createMockRequest(this,Ct,et,kt);Je=Xe.some(function(Dr){return Dr.constraint(jr)})}return!Je&&this.parent&&(Je=this.parent.isBoundTagged(Ct,et,kt)),Je},$e.prototype.snapshot=function(){this._snapshots.push(st.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},$e.prototype.restore=function(){var Ct=this._snapshots.pop();if(Ct===void 0)throw new Error(v.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Ct.bindings,this._middleware=Ct.middleware},$e.prototype.createChild=function(Ct){var et=new $e(Ct||this.options);return et.parent=this,et},$e.prototype.applyMiddleware=function(){for(var Ct=[],et=0;et<arguments.length;et++)Ct[et]=arguments[et];this._appliedMiddleware=this._appliedMiddleware.concat(Ct);var kt=this._middleware?this._middleware:this._planAndResolve();this._middleware=Ct.reduce(function(Je,Xe){return Xe(Je)},kt)},$e.prototype.applyCustomMetadataReader=function(Ct){this._metadataReader=Ct},$e.prototype.get=function(Ct){return this._get(!1,!1,z.TargetTypeEnum.Variable,Ct)},$e.prototype.getTagged=function(Ct,et,kt){return this._get(!1,!1,z.TargetTypeEnum.Variable,Ct,et,kt)},$e.prototype.getNamed=function(Ct,et){return this.getTagged(Ct,W.NAMED_TAG,et)},$e.prototype.getAll=function(Ct){return this._get(!0,!0,z.TargetTypeEnum.Variable,Ct)},$e.prototype.getAllTagged=function(Ct,et,kt){return this._get(!1,!0,z.TargetTypeEnum.Variable,Ct,et,kt)},$e.prototype.getAllNamed=function(Ct,et){return this.getAllTagged(Ct,W.NAMED_TAG,et)},$e.prototype.resolve=function(Ct){var et=this.createChild();return et.bind(Ct).toSelf(),this._appliedMiddleware.forEach(function(kt){et.applyMiddleware(kt)}),et.get(Ct)},$e.prototype._getContainerModuleHelpersFactory=function(){var Ct=this,et=function(Jt,Be){Jt._binding.moduleId=Be},kt=function(Jt){return function(Be){var Nt=Ct.bind.bind(Ct),Gt=Nt(Be);return et(Gt,Jt),Gt}},Je=function(Jt){return function(Be){var Nt=Ct.unbind.bind(Ct);Nt(Be)}},Xe=function(Jt){return function(Be){var Nt=Ct.isBound.bind(Ct);return Nt(Be)}},jr=function(Jt){return function(Be){var Nt=Ct.rebind.bind(Ct),Gt=Nt(Be);return et(Gt,Jt),Gt}};return function(Dr){return{bindFunction:kt(Dr),isboundFunction:Xe(Dr),rebindFunction:jr(Dr),unbindFunction:Je(Dr)}}},$e.prototype._get=function(Ct,et,kt,Je,Xe,jr){var Dr=null,Jt={avoidConstraints:Ct,contextInterceptor:function(Nt){return Nt},isMultiInject:et,key:Xe,serviceIdentifier:Je,targetType:kt,value:jr};if(this._middleware){if(Dr=this._middleware(Jt),Dr==null)throw new Error(v.INVALID_MIDDLEWARE_RETURN)}else Dr=this._planAndResolve()(Jt);return Dr},$e.prototype._planAndResolve=function(){var Ct=this;return function(et){var kt=se.plan(Ct._metadataReader,Ct,et.isMultiInject,et.targetType,et.serviceIdentifier,et.key,et.value,et.avoidConstraints);kt=et.contextInterceptor(kt);var Je=ve.resolve(kt);return Je}},$e}();Q.Container=pt},"9NmV":function(Qe,Q){var O="\\ud800-\\udfff",j="\\u0300-\\u036f",H="\\ufe20-\\ufe2f",X="\\u20d0-\\u20ff",N=j+H+X,v="\\u2700-\\u27bf",z="a-z\\xdf-\\xf6\\xf8-\\xff",W="\\xac\\xb1\\xd7\\xf7",Pe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",se="\\u2000-\\u206f",ve=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ue="A-Z\\xc0-\\xd6\\xd8-\\xde",gt="\\ufe0e\\ufe0f",Ne=W+Pe+se+ve,st="['\u2019]",Dt="["+Ne+"]",pt="["+N+"]",$e="\\d+",Ct="["+v+"]",et="["+z+"]",kt="[^"+O+Ne+$e+v+z+ue+"]",Je="\\ud83c[\\udffb-\\udfff]",Xe="(?:"+pt+"|"+Je+")",jr="[^"+O+"]",Dr="(?:\\ud83c[\\udde6-\\uddff]){2}",Jt="[\\ud800-\\udbff][\\udc00-\\udfff]",Be="["+ue+"]",Nt="\\u200d",Gt="(?:"+et+"|"+kt+")",Te="(?:"+Be+"|"+kt+")",me="(?:"+st+"(?:d|ll|m|re|s|t|ve))?",Re="(?:"+st+"(?:D|LL|M|RE|S|T|VE))?",Ut=Xe+"?",ae="["+gt+"]?",Ce="(?:"+Nt+"(?:"+[jr,Dr,Jt].join("|")+")"+ae+Ut+")*",Ae="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",At=ae+Ut+Ce,Bt="(?:"+[Ct,Dr,Jt].join("|")+")"+At,Ft=RegExp([Be+"?"+et+"+"+me+"(?="+[Dt,Be,"$"].join("|")+")",Te+"+"+Re+"(?="+[Dt,Be+Gt,"$"].join("|")+")",Be+"?"+Gt+"+"+me,Be+"+"+Re,vt,Ae,$e,Bt].join("|"),"g");function fr(Tr){return Tr.match(Ft)||[]}Qe.exports=fr},"9nhX":function(Qe,Q,O){var j=O("g4R6"),H=O("tLB3");function X(N,v,z){return z===void 0&&(z=v,v=void 0),z!==void 0&&(z=H(z),z=z===z?z:0),v!==void 0&&(v=H(v),v=v===v?v:0),j(H(N),v,z)}Qe.exports=X},APxj:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var j=O("Ucsi");function H(X,N){N===void 0&&(N=!0);var v=j.makePropertyInjectDecorator(X,N),z=j.makePropertyInjectNamedDecorator(X,N),W=j.makePropertyInjectTaggedDecorator(X,N),Pe=j.makePropertyMultiInjectDecorator(X,N);return{lazyInject:v,lazyInjectNamed:z,lazyInjectTagged:W,lazyMultiInject:Pe}}Q.default=H},Aib3:function(Qe,Q){Qe.exports=O;function O(X,N){var v=X&&X.type,z;if(v==="FeatureCollection")for(z=0;z<X.features.length;z++)O(X.features[z],N);else if(v==="GeometryCollection")for(z=0;z<X.geometries.length;z++)O(X.geometries[z],N);else if(v==="Feature")O(X.geometry,N);else if(v==="Polygon")j(X.coordinates,N);else if(v==="MultiPolygon")for(z=0;z<X.coordinates.length;z++)j(X.coordinates[z],N);return X}function j(X,N){if(X.length!==0){H(X[0],N);for(var v=1;v<X.length;v++)H(X[v],!N)}}function H(X,N){for(var v=0,z=0,W=0,Pe=X.length,se=Pe-1;W<Pe;se=W++){var ve=(X[W][0]-X[se][0])*(X[se][1]+X[W][1]),ue=v+ve;z+=Math.abs(v)>=Math.abs(ve)?v-ue+ve:ve-ue+v,v=ue}v+z>=0!=!!N&&X.reverse()}},AwBQ:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Lookup=void 0;var j=O("MON2"),H=function(){function X(){this._map=new Map}return X.prototype.getMap=function(){return this._map},X.prototype.add=function(N,v){if(N==null)throw new Error(j.NULL_ARGUMENT);if(v==null)throw new Error(j.NULL_ARGUMENT);var z=this._map.get(N);z!==void 0?(z.push(v),this._map.set(N,z)):this._map.set(N,[v])},X.prototype.get=function(N){if(N==null)throw new Error(j.NULL_ARGUMENT);var v=this._map.get(N);if(v!==void 0)return v;throw new Error(j.KEY_NOT_FOUND)},X.prototype.remove=function(N){if(N==null)throw new Error(j.NULL_ARGUMENT);if(!this._map.delete(N))throw new Error(j.KEY_NOT_FOUND)},X.prototype.removeByCondition=function(N){var v=this;this._map.forEach(function(z,W){var Pe=z.filter(function(se){return!N(se)});Pe.length>0?v._map.set(W,Pe):v._map.delete(W)})},X.prototype.hasKey=function(N){if(N==null)throw new Error(j.NULL_ARGUMENT);return this._map.has(N)},X.prototype.clone=function(){var N=new X;return this._map.forEach(function(v,z){v.forEach(function(W){return N.add(z,W.clone())})}),N},X.prototype.traverse=function(N){this._map.forEach(function(v,z){N(z,v)})},X}();Q.Lookup=H},"B6l+":function(Qe,Q,O){var j=O("Sq3C"),H=O("Z1HP"),X=O("Sxd8"),N=O("dt0z");function v(z,W,Pe){z=N(z),W=X(W);var se=W?H(z):0;return W&&se<W?z+j(W-se,Pe):z}Qe.exports=v},B93f:function(Qe,Q,O){"use strict";var j=O("DiGy");Qe.exports=H;function H(N,v){this.layers=N.readFields(X,{},v)}function X(N,v,z){if(N===3){var W=new j(z,z.readVarint()+z.pos);W.length&&(v[W.name]=W)}}},BkRI:function(Qe,Q,O){var j=O("OBhP"),H=1,X=4;function N(v){return j(v,H|X)}Qe.exports=N},CIdX:function(Qe,Q,O){Qe.exports={waterWave:"waterWave___hvLJA",text:"text___3asSo",waterWaveCanvasWrapper:"waterWaveCanvasWrapper___2ndFj"}},CZoQ:function(Qe,Q){function O(j,H,X){for(var N=X-1,v=j.length;++N<v;)if(j[N]===H)return N;return-1}Qe.exports=O},D9lx:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInWhenOnSyntax=void 0;var j=O("6AGu"),H=O("406g"),X=O("z4Hk"),N=function(){function v(z){this._binding=z,this._bindingWhenSyntax=new X.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new H.BindingOnSyntax(this._binding),this._bindingInSyntax=new j.BindingInSyntax(z)}return v.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},v.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},v.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},v.prototype.when=function(z){return this._bindingWhenSyntax.when(z)},v.prototype.whenTargetNamed=function(z){return this._bindingWhenSyntax.whenTargetNamed(z)},v.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},v.prototype.whenTargetTagged=function(z,W){return this._bindingWhenSyntax.whenTargetTagged(z,W)},v.prototype.whenInjectedInto=function(z){return this._bindingWhenSyntax.whenInjectedInto(z)},v.prototype.whenParentNamed=function(z){return this._bindingWhenSyntax.whenParentNamed(z)},v.prototype.whenParentTagged=function(z,W){return this._bindingWhenSyntax.whenParentTagged(z,W)},v.prototype.whenAnyAncestorIs=function(z){return this._bindingWhenSyntax.whenAnyAncestorIs(z)},v.prototype.whenNoAncestorIs=function(z){return this._bindingWhenSyntax.whenNoAncestorIs(z)},v.prototype.whenAnyAncestorNamed=function(z){return this._bindingWhenSyntax.whenAnyAncestorNamed(z)},v.prototype.whenAnyAncestorTagged=function(z,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(z,W)},v.prototype.whenNoAncestorNamed=function(z){return this._bindingWhenSyntax.whenNoAncestorNamed(z)},v.prototype.whenNoAncestorTagged=function(z,W){return this._bindingWhenSyntax.whenNoAncestorTagged(z,W)},v.prototype.whenAnyAncestorMatches=function(z){return this._bindingWhenSyntax.whenAnyAncestorMatches(z)},v.prototype.whenNoAncestorMatches=function(z){return this._bindingWhenSyntax.whenNoAncestorMatches(z)},v.prototype.onActivation=function(z){return this._bindingOnSyntax.onActivation(z)},v}();Q.BindingInWhenOnSyntax=N},DiGy:function(Qe,Q,O){"use strict";var j=O("HfwV");Qe.exports=H;function H(v,z){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=v,this._keys=[],this._values=[],this._features=[],v.readFields(X,this,z),this.length=this._features.length}function X(v,z,W){v===15?z.version=W.readVarint():v===1?z.name=W.readString():v===5?z.extent=W.readVarint():v===2?z._features.push(W.pos):v===3?z._keys.push(W.readString()):v===4&&z._values.push(N(W))}function N(v){for(var z=null,W=v.readVarint()+v.pos;v.pos<W;){var Pe=v.readVarint()>>3;z=Pe===1?v.readString():Pe===2?v.readFloat():Pe===3?v.readDouble():Pe===4?v.readVarint64():Pe===5?v.readVarint():Pe===6?v.readSVarint():Pe===7?v.readBoolean():null}return z}H.prototype.feature=function(v){if(v<0||v>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[v];var z=this._pbf.readVarint()+this._pbf.pos;return new j(this._pbf,z,this.extent,this._keys,this._values)}},"Dw+G":function(Qe,Q,O){var j=O("juv8"),H=O("mTTR");function X(N,v){return N&&j(v,H(v),N)}Qe.exports=X},DzJC:function(Qe,Q,O){var j=O("sEfC"),H=O("GoyQ"),X="Expected a function";function N(v,z,W){var Pe=!0,se=!0;if(typeof v!="function")throw new TypeError(X);return H(W)&&(Pe="leading"in W?!!W.leading:Pe,se="trailing"in W?!!W.trailing:se),j(v,z,{leading:Pe,maxWait:z,trailing:se})}Qe.exports=N},EEGq:function(Qe,Q,O){var j=O("juv8"),H=O("oCl/");function X(N,v){return j(N,H(N),v)}Qe.exports=X},FV85:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.TargetTypeEnum=Q.BindingTypeEnum=Q.BindingScopeEnum=void 0;var j={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Q.BindingScopeEnum=j;var H={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Q.BindingTypeEnum=H;var X={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Q.TargetTypeEnum=X},G6z8:function(Qe,Q,O){var j=O("fR/l"),H=O("oCl/"),X=O("mTTR");function N(v){return j(v,X,H)}Qe.exports=N},GXnB:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Metadata=void 0;var j=O("xfSm"),H=function(){function X(N,v){this.key=N,this.value=v}return X.prototype.toString=function(){return this.key===j.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},X}();Q.Metadata=H},Gi0A:function(Qe,Q,O){var j=O("QqLw"),H=O("ExA7"),X="[object Map]";function N(v){return H(v)&&j(v)==X}Qe.exports=N},"H+7v":function(Qe,Q,O){Qe.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},HfwV:function(Qe,Q,O){"use strict";var j=O("xnQO");Qe.exports=H;function H(W,Pe,se,ve,ue){this.properties={},this.extent=se,this.type=0,this._pbf=W,this._geometry=-1,this._keys=ve,this._values=ue,W.readFields(X,this,Pe)}function X(W,Pe,se){W==1?Pe.id=se.readVarint():W==2?N(se,Pe):W==3?Pe.type=se.readVarint():W==4&&(Pe._geometry=se.pos)}function N(W,Pe){for(var se=W.readVarint()+W.pos;W.pos<se;){var ve=Pe._keys[W.readVarint()],ue=Pe._values[W.readVarint()];Pe.properties[ve]=ue}}H.types=["Unknown","Point","LineString","Polygon"],H.prototype.loadGeometry=function(){var W=this._pbf;W.pos=this._geometry;for(var Pe=W.readVarint()+W.pos,se=1,ve=0,ue=0,gt=0,Ne=[],st;W.pos<Pe;){if(ve<=0){var Dt=W.readVarint();se=Dt&7,ve=Dt>>3}if(ve--,se===1||se===2)ue+=W.readSVarint(),gt+=W.readSVarint(),se===1&&(st&&Ne.push(st),st=[]),st.push(new j(ue,gt));else if(se===7)st&&st.push(st[0].clone());else throw new Error("unknown command "+se)}return st&&Ne.push(st),Ne},H.prototype.bbox=function(){var W=this._pbf;W.pos=this._geometry;for(var Pe=W.readVarint()+W.pos,se=1,ve=0,ue=0,gt=0,Ne=Infinity,st=-Infinity,Dt=Infinity,pt=-Infinity;W.pos<Pe;){if(ve<=0){var $e=W.readVarint();se=$e&7,ve=$e>>3}if(ve--,se===1||se===2)ue+=W.readSVarint(),gt+=W.readSVarint(),ue<Ne&&(Ne=ue),ue>st&&(st=ue),gt<Dt&&(Dt=gt),gt>pt&&(pt=gt);else if(se!==7)throw new Error("unknown command "+se)}return[Ne,Dt,st,pt]},H.prototype.toGeoJSON=function(W,Pe,se){var ve=this.extent*Math.pow(2,se),ue=this.extent*W,gt=this.extent*Pe,Ne=this.loadGeometry(),st=H.types[this.type],Dt,pt;function $e(kt){for(var Je=0;Je<kt.length;Je++){var Xe=kt[Je],jr=180-(Xe.y+gt)*360/ve;kt[Je]=[(Xe.x+ue)*360/ve-180,360/Math.PI*Math.atan(Math.exp(jr*Math.PI/180))-90]}}switch(this.type){case 1:var Ct=[];for(Dt=0;Dt<Ne.length;Dt++)Ct[Dt]=Ne[Dt][0];Ne=Ct,$e(Ne);break;case 2:for(Dt=0;Dt<Ne.length;Dt++)$e(Ne[Dt]);break;case 3:for(Ne=v(Ne),Dt=0;Dt<Ne.length;Dt++)for(pt=0;pt<Ne[Dt].length;pt++)$e(Ne[Dt][pt]);break}Ne.length===1?Ne=Ne[0]:st="Multi"+st;var et={type:"Feature",geometry:{type:st,coordinates:Ne},properties:this.properties};return"id"in this&&(et.id=this.id),et};function v(W){var Pe=W.length;if(Pe<=1)return[W];for(var se=[],ve,ue,gt=0;gt<Pe;gt++){var Ne=z(W[gt]);Ne!==0&&(ue===void 0&&(ue=Ne<0),ue===Ne<0?(ve&&se.push(ve),ve=[W[gt]]):ve.push(W[gt]))}return ve&&se.push(ve),se}function z(W){for(var Pe=0,se=0,ve=W.length,ue=ve-1,gt,Ne;se<ve;ue=se++)gt=W[se],Ne=W[ue],Pe+=(Ne.x-gt.x)*(gt.y+Ne.y);return Pe}},HpQ9:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ContainerSnapshot=void 0;var j=function(){function H(){}return H.of=function(X,N){var v=new H;return v.bindings=X,v.middleware=N,v},H}();Q.ContainerSnapshot=j},J2iB:function(Qe,Q){function O(j){return j==null}Qe.exports=O},JBE3:function(Qe,Q,O){var j=O("+Qka"),H=O("LsHQ"),X=H(function(N,v,z,W){j(N,v,z,W)});Qe.exports=X},KwMD:function(Qe,Q){function O(j,H,X,N){for(var v=j.length,z=X+(N?1:-1);N?z--:++z<v;)if(H(j[z],z,j))return z;return-1}Qe.exports=O},LGYb:function(Qe,Q,O){var j=O("1hJj"),H=O("jbM+"),X=O("Xt/L"),N=O("xYSL"),v=O("dQpi"),z=O("rEGp"),W=200;function Pe(se,ve,ue){var gt=-1,Ne=H,st=se.length,Dt=!0,pt=[],$e=pt;if(ue)Dt=!1,Ne=X;else if(st>=W){var Ct=ve?null:v(se);if(Ct)return z(Ct);Dt=!1,Ne=N,$e=new j}else $e=ve?[]:pt;e:for(;++gt<st;){var et=se[gt],kt=ve?ve(et):et;if(et=ue||et!==0?et:0,Dt&&kt===kt){for(var Je=$e.length;Je--;)if($e[Je]===kt)continue e;ve&&$e.push(kt),pt.push(et)}else Ne($e,kt,ue)||($e!==pt&&$e.push(kt),pt.push(et))}return pt}Qe.exports=Pe},LKzl:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenOnSyntax=void 0;var j=O("406g"),H=O("z4Hk"),X=function(){function N(v){this._binding=v,this._bindingWhenSyntax=new H.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new j.BindingOnSyntax(this._binding)}return N.prototype.when=function(v){return this._bindingWhenSyntax.when(v)},N.prototype.whenTargetNamed=function(v){return this._bindingWhenSyntax.whenTargetNamed(v)},N.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},N.prototype.whenTargetTagged=function(v,z){return this._bindingWhenSyntax.whenTargetTagged(v,z)},N.prototype.whenInjectedInto=function(v){return this._bindingWhenSyntax.whenInjectedInto(v)},N.prototype.whenParentNamed=function(v){return this._bindingWhenSyntax.whenParentNamed(v)},N.prototype.whenParentTagged=function(v,z){return this._bindingWhenSyntax.whenParentTagged(v,z)},N.prototype.whenAnyAncestorIs=function(v){return this._bindingWhenSyntax.whenAnyAncestorIs(v)},N.prototype.whenNoAncestorIs=function(v){return this._bindingWhenSyntax.whenNoAncestorIs(v)},N.prototype.whenAnyAncestorNamed=function(v){return this._bindingWhenSyntax.whenAnyAncestorNamed(v)},N.prototype.whenAnyAncestorTagged=function(v,z){return this._bindingWhenSyntax.whenAnyAncestorTagged(v,z)},N.prototype.whenNoAncestorNamed=function(v){return this._bindingWhenSyntax.whenNoAncestorNamed(v)},N.prototype.whenNoAncestorTagged=function(v,z){return this._bindingWhenSyntax.whenNoAncestorTagged(v,z)},N.prototype.whenAnyAncestorMatches=function(v){return this._bindingWhenSyntax.whenAnyAncestorMatches(v)},N.prototype.whenNoAncestorMatches=function(v){return this._bindingWhenSyntax.whenNoAncestorMatches(v)},N.prototype.onActivation=function(v){return this._bindingOnSyntax.onActivation(v)},N}();Q.BindingWhenOnSyntax=X},LgvC:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Binding=void 0;var j=O("FV85"),H=O("d9O0"),X=function(){function N(v,z){this.id=H.id(),this.activated=!1,this.serviceIdentifier=v,this.scope=z,this.type=j.BindingTypeEnum.Invalid,this.constraint=function(W){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return N.prototype.clone=function(){var v=new N(this.serviceIdentifier,this.scope);return v.activated=v.scope===j.BindingScopeEnum.Singleton?this.activated:!1,v.implementationType=this.implementationType,v.dynamicValue=this.dynamicValue,v.scope=this.scope,v.type=this.type,v.factory=this.factory,v.provider=this.provider,v.constraint=this.constraint,v.onActivation=this.onActivation,v.cache=this.cache,v},N}();Q.Binding=X},MON2:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.STACK_OVERFLOW=Q.CIRCULAR_DEPENDENCY_IN_FACTORY=Q.POST_CONSTRUCT_ERROR=Q.MULTIPLE_POST_CONSTRUCT_METHODS=Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Q.ARGUMENTS_LENGTH_MISMATCH=Q.INVALID_DECORATOR_OPERATION=Q.INVALID_TO_SELF_VALUE=Q.INVALID_FUNCTION_BINDING=Q.INVALID_MIDDLEWARE_RETURN=Q.NO_MORE_SNAPSHOTS_AVAILABLE=Q.INVALID_BINDING_TYPE=Q.NOT_IMPLEMENTED=Q.CIRCULAR_DEPENDENCY=Q.UNDEFINED_INJECT_ANNOTATION=Q.MISSING_INJECT_ANNOTATION=Q.MISSING_INJECTABLE_ANNOTATION=Q.NOT_REGISTERED=Q.CANNOT_UNBIND=Q.AMBIGUOUS_MATCH=Q.KEY_NOT_FOUND=Q.NULL_ARGUMENT=Q.DUPLICATED_METADATA=Q.DUPLICATED_INJECTABLE_DECORATOR=void 0,Q.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Q.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Q.NULL_ARGUMENT="NULL argument",Q.KEY_NOT_FOUND="Key Not Found",Q.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Q.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Q.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Q.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Q.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var j=function(z){return"@inject called with undefined this could mean that the class "+z+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Q.UNDEFINED_INJECT_ANNOTATION=j,Q.CIRCULAR_DEPENDENCY="Circular dependency found:",Q.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Q.INVALID_BINDING_TYPE="Invalid binding type:",Q.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Q.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Q.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Q.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Q.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var H=function(){for(var z=[],W=0;W<arguments.length;W++)z[W]=arguments[W];return"The number of constructor arguments in the derived class "+(z[0]+" must be >= than the number of constructor arguments of its base class.")};Q.ARGUMENTS_LENGTH_MISMATCH=H,Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Q.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var X=function(){for(var z=[],W=0;W<arguments.length;W++)z[W]=arguments[W];return"@postConstruct error in class "+z[0]+": "+z[1]};Q.POST_CONSTRUCT_ERROR=X;var N=function(){for(var z=[],W=0;W<arguments.length;W++)z[W]=arguments[W];return"It looks like there is a circular dependency "+("in one of the '"+z[0]+"' bindings. Please investigate bindings with")+("service identifier '"+z[1]+"'.")};Q.CIRCULAR_DEPENDENCY_IN_FACTORY=N,Q.STACK_OVERFLOW="Maximum call stack size exceeded"},OBhP:function(Qe,Q,O){var j=O("fmRc"),H=O("gFfm"),X=O("MrPd"),N=O("WwFo"),v=O("Dw+G"),z=O("5Tg0"),W=O("Q1l4"),Pe=O("VOtZ"),se=O("EEGq"),ve=O("qZTm"),ue=O("G6z8"),gt=O("QqLw"),Ne=O("yHx3"),st=O("wrZu"),Dt=O("+iFO"),pt=O("Z0cm"),$e=O("DSRE"),Ct=O("zEVN"),et=O("GoyQ"),kt=O("1+5i"),Je=O("7GkX"),Xe=O("mTTR"),jr=1,Dr=2,Jt=4,Be="[object Arguments]",Nt="[object Array]",Gt="[object Boolean]",Te="[object Date]",me="[object Error]",Re="[object Function]",Ut="[object GeneratorFunction]",ae="[object Map]",Ce="[object Number]",Ae="[object Object]",vt="[object RegExp]",At="[object Set]",Bt="[object String]",Ft="[object Symbol]",fr="[object WeakMap]",Tr="[object ArrayBuffer]",Br="[object DataView]",On="[object Float32Array]",Fr="[object Float64Array]",Hn="[object Int8Array]",ni="[object Int16Array]",Yn="[object Int32Array]",ei="[object Uint8Array]",ci="[object Uint8ClampedArray]",Sr="[object Uint16Array]",_r="[object Uint32Array]",Kt={};Kt[Be]=Kt[Nt]=Kt[Tr]=Kt[Br]=Kt[Gt]=Kt[Te]=Kt[On]=Kt[Fr]=Kt[Hn]=Kt[ni]=Kt[Yn]=Kt[ae]=Kt[Ce]=Kt[Ae]=Kt[vt]=Kt[At]=Kt[Bt]=Kt[Ft]=Kt[ei]=Kt[ci]=Kt[Sr]=Kt[_r]=!0,Kt[me]=Kt[Re]=Kt[fr]=!1;function Wt(Ir,je,oe,ne,D,Ee){var He,xt=je&jr,er=je&Dr,ur=je&Jt;if(oe&&(He=D?oe(Ir,ne,D,Ee):oe(Ir)),He!==void 0)return He;if(!et(Ir))return Ir;var tt=pt(Ir);if(tt){if(He=Ne(Ir),!xt)return W(Ir,He)}else{var It=gt(Ir),or=It==Re||It==Ut;if($e(Ir))return z(Ir,xt);if(It==Ae||It==Be||or&&!D){if(He=er||or?{}:Dt(Ir),!xt)return er?se(Ir,v(He,Ir)):Pe(Ir,N(He,Ir))}else{if(!Kt[It])return D?Ir:{};He=st(Ir,It,xt)}}Ee||(Ee=new j);var Cr=Ee.get(Ir);if(Cr)return Cr;Ee.set(Ir,He),kt(Ir)?Ir.forEach(function(sn){He.add(Wt(sn,je,oe,sn,Ir,Ee))}):Ct(Ir)&&Ir.forEach(function(sn,gn){He.set(gn,Wt(sn,je,oe,gn,Ir,Ee))});var Or=ur?er?ue:ve:er?Xe:Je,Nn=tt?void 0:Or(Ir);return H(Nn||Ir,function(sn,gn){Nn&&(gn=sn,sn=Ir[gn]),X(He,gn,Wt(sn,je,oe,gn,Ir,Ee))}),He}Qe.exports=Wt},"QQZ/":function(Qe,Q,O){var j=O("Sq3C"),H=O("Z1HP"),X=O("Sxd8"),N=O("dt0z");function v(z,W,Pe){z=N(z),W=X(W);var se=W?H(z):0;return W&&se<W?j(W-se,Pe)+z:z}Qe.exports=v},"R/W3":function(Qe,Q,O){var j=O("KwMD"),H=O("2ajD"),X=O("CZoQ");function N(v,z,W){return z===z?X(v,z,W):j(v,H,W)}Qe.exports=N},"RR/i":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.typeConstraint=Q.namedConstraint=Q.taggedConstraint=Q.traverseAncerstors=void 0;var j=O("xfSm"),H=O("GXnB"),X=function W(Pe,se){var ve=Pe.parentRequest;return ve!==null?se(ve)?!0:W(ve,se):!1};Q.traverseAncerstors=X;var N=function(Pe){return function(se){var ve=function(gt){return gt!==null&&gt.target!==null&&gt.target.matchesTag(Pe)(se)};return ve.metaData=new H.Metadata(Pe,se),ve}};Q.taggedConstraint=N;var v=N(j.NAMED_TAG);Q.namedConstraint=v;var z=function(Pe){return function(se){var ve=null;if(se!==null)if(ve=se.bindings[0],typeof Pe=="string"){var ue=ve.serviceIdentifier;return ue===Pe}else{var gt=se.bindings[0].implementationType;return Pe===gt}return!1}};Q.typeConstraint=z},Sk89:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.postConstruct=void 0;var j=O("MON2"),H=O("xfSm"),X=O("GXnB");function N(){return function(v,z,W){var Pe=new X.Metadata(H.POST_CONSTRUCT,z);if(Reflect.hasOwnMetadata(H.POST_CONSTRUCT,v.constructor))throw new Error(j.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(H.POST_CONSTRUCT,Pe,v.constructor)}}Q.postConstruct=N},Sq3C:function(Qe,Q,O){var j=O("sKgW"),H=O("zoYe"),X=O("wy8a"),N=O("quyA"),v=O("Z1HP"),z=O("Em2t"),W=Math.ceil;function Pe(se,ve){ve=ve===void 0?" ":H(ve);var ue=ve.length;if(ue<2)return ue?j(ve,se):ve;var gt=j(ve,W(se/v(ve)));return N(ve)?X(z(gt),0,se).join(""):gt.slice(0,se)}Qe.exports=Pe},Sxd8:function(Qe,Q,O){var j=O("ZCgT");function H(X){var N=j(X),v=N%1;return N===N?v?N-v:N:0}Qe.exports=H},TKrE:function(Qe,Q,O){var j=O("qRkn"),H=O("dt0z"),X=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,N="\\u0300-\\u036f",v="\\ufe20-\\ufe2f",z="\\u20d0-\\u20ff",W=N+v+z,Pe="["+W+"]",se=RegExp(Pe,"g");function ve(ue){return ue=H(ue),ue&&ue.replace(X,j).replace(se,"")}Qe.exports=ve},TP7S:function(Qe,Q){function O(j){return j===void 0}Qe.exports=O},"U+yc":function(Qe,Q){function O(j,H,X,N,v){var z={};return Object.keys(N).forEach(function(W){z[W]=N[W]}),z.enumerable=!!z.enumerable,z.configurable=!!z.configurable,("value"in z||z.initializer)&&(z.writable=!0),z=X.slice().reverse().reduce(function(W,Pe){return Pe(j,H,W)||W},z),v&&z.initializer!==void 0&&(z.value=z.initializer?z.initializer.call(v):void 0,z.initializer=void 0),z.initializer===void 0&&(Object.defineProperty(j,H,z),z=null),z}Qe.exports=O,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},UB5X:function(Qe,Q,O){var j=O("NykK"),H=O("ExA7"),X="[object Number]";function N(v){return typeof v=="number"||H(v)&&j(v)==X}Qe.exports=N},Ucsi:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var j=Symbol.for("INJECTION");function H(W,Pe,se,ve){function ue(){return ve&&!Reflect.hasMetadata(j,this,Pe)&&Reflect.defineMetadata(j,se(),this,Pe),Reflect.hasMetadata(j,this,Pe)?Reflect.getMetadata(j,this,Pe):se()}function gt(Ne){Reflect.defineMetadata(j,Ne,this,Pe)}Object.defineProperty(W,Pe,{configurable:!0,enumerable:!0,get:ue,set:gt})}function X(W,Pe){return function(se){return function(ve,ue){var gt=function(){return W.get(se)};H(ve,ue,gt,Pe)}}}Q.makePropertyInjectDecorator=X;function N(W,Pe){return function(se,ve){return function(ue,gt){var Ne=function(){return W.getNamed(se,ve)};H(ue,gt,Ne,Pe)}}}Q.makePropertyInjectNamedDecorator=N;function v(W,Pe){return function(se,ve,ue){return function(gt,Ne){var st=function(){return W.getTagged(se,ve,ue)};H(gt,Ne,st,Pe)}}}Q.makePropertyInjectTaggedDecorator=v;function z(W,Pe){return function(se){return function(ve,ue){var gt=function(){return W.getAll(se)};H(ve,ue,gt,Pe)}}}Q.makePropertyMultiInjectDecorator=z},VOtZ:function(Qe,Q,O){var j=O("juv8"),H=O("MvSz");function X(N,v){return j(N,H(N),v)}Qe.exports=X},VmRL:function(Qe,Q,O){"use strict";Qe.exports=j,Qe.exports.default=j;function j(ae,Ce,Ae){Ae=Ae||2;var vt=Ce&&Ce.length,At=vt?Ce[0]*Ae:ae.length,Bt=H(ae,0,At,Ae,!0),Ft=[];if(!Bt||Bt.next===Bt.prev)return Ft;var fr,Tr,Br,On,Fr,Hn,ni;if(vt&&(Bt=se(ae,Ce,Bt,Ae)),ae.length>80*Ae){fr=Br=ae[0],Tr=On=ae[1];for(var Yn=Ae;Yn<At;Yn+=Ae)Fr=ae[Yn],Hn=ae[Yn+1],Fr<fr&&(fr=Fr),Hn<Tr&&(Tr=Hn),Fr>Br&&(Br=Fr),Hn>On&&(On=Hn);ni=Math.max(Br-fr,On-Tr),ni=ni!==0?32767/ni:0}return N(Bt,Ft,Ae,fr,Tr,ni,0),Ft}function H(ae,Ce,Ae,vt,At){var Bt,Ft;if(At===Ut(ae,Ce,Ae,vt)>0)for(Bt=Ce;Bt<Ae;Bt+=vt)Ft=Te(Bt,ae[Bt],ae[Bt+1],Ft);else for(Bt=Ae-vt;Bt>=Ce;Bt-=vt)Ft=Te(Bt,ae[Bt],ae[Bt+1],Ft);return Ft&&Je(Ft,Ft.next)&&(me(Ft),Ft=Ft.next),Ft}function X(ae,Ce){if(!ae)return ae;Ce||(Ce=ae);var Ae=ae,vt;do if(vt=!1,!Ae.steiner&&(Je(Ae,Ae.next)||kt(Ae.prev,Ae,Ae.next)===0)){if(me(Ae),Ae=Ce=Ae.prev,Ae===Ae.next)break;vt=!0}else Ae=Ae.next;while(vt||Ae!==Ce);return Ce}function N(ae,Ce,Ae,vt,At,Bt,Ft){if(!!ae){!Ft&&Bt&&st(ae,vt,At,Bt);for(var fr=ae,Tr,Br;ae.prev!==ae.next;){if(Tr=ae.prev,Br=ae.next,Bt?z(ae,vt,At,Bt):v(ae)){Ce.push(Tr.i/Ae|0),Ce.push(ae.i/Ae|0),Ce.push(Br.i/Ae|0),me(ae),ae=Br.next,fr=Br.next;continue}if(ae=Br,ae===fr){Ft?Ft===1?(ae=W(X(ae),Ce,Ae),N(ae,Ce,Ae,vt,At,Bt,2)):Ft===2&&Pe(ae,Ce,Ae,vt,At,Bt):N(X(ae),Ce,Ae,vt,At,Bt,1);break}}}}function v(ae){var Ce=ae.prev,Ae=ae,vt=ae.next;if(kt(Ce,Ae,vt)>=0)return!1;for(var At=Ce.x,Bt=Ae.x,Ft=vt.x,fr=Ce.y,Tr=Ae.y,Br=vt.y,On=At<Bt?At<Ft?At:Ft:Bt<Ft?Bt:Ft,Fr=fr<Tr?fr<Br?fr:Br:Tr<Br?Tr:Br,Hn=At>Bt?At>Ft?At:Ft:Bt>Ft?Bt:Ft,ni=fr>Tr?fr>Br?fr:Br:Tr>Br?Tr:Br,Yn=vt.next;Yn!==Ce;){if(Yn.x>=On&&Yn.x<=Hn&&Yn.y>=Fr&&Yn.y<=ni&&Ct(At,fr,Bt,Tr,Ft,Br,Yn.x,Yn.y)&&kt(Yn.prev,Yn,Yn.next)>=0)return!1;Yn=Yn.next}return!0}function z(ae,Ce,Ae,vt){var At=ae.prev,Bt=ae,Ft=ae.next;if(kt(At,Bt,Ft)>=0)return!1;for(var fr=At.x,Tr=Bt.x,Br=Ft.x,On=At.y,Fr=Bt.y,Hn=Ft.y,ni=fr<Tr?fr<Br?fr:Br:Tr<Br?Tr:Br,Yn=On<Fr?On<Hn?On:Hn:Fr<Hn?Fr:Hn,ei=fr>Tr?fr>Br?fr:Br:Tr>Br?Tr:Br,ci=On>Fr?On>Hn?On:Hn:Fr>Hn?Fr:Hn,Sr=pt(ni,Yn,Ce,Ae,vt),_r=pt(ei,ci,Ce,Ae,vt),Kt=ae.prevZ,Wt=ae.nextZ;Kt&&Kt.z>=Sr&&Wt&&Wt.z<=_r;){if(Kt.x>=ni&&Kt.x<=ei&&Kt.y>=Yn&&Kt.y<=ci&&Kt!==At&&Kt!==Ft&&Ct(fr,On,Tr,Fr,Br,Hn,Kt.x,Kt.y)&&kt(Kt.prev,Kt,Kt.next)>=0||(Kt=Kt.prevZ,Wt.x>=ni&&Wt.x<=ei&&Wt.y>=Yn&&Wt.y<=ci&&Wt!==At&&Wt!==Ft&&Ct(fr,On,Tr,Fr,Br,Hn,Wt.x,Wt.y)&&kt(Wt.prev,Wt,Wt.next)>=0))return!1;Wt=Wt.nextZ}for(;Kt&&Kt.z>=Sr;){if(Kt.x>=ni&&Kt.x<=ei&&Kt.y>=Yn&&Kt.y<=ci&&Kt!==At&&Kt!==Ft&&Ct(fr,On,Tr,Fr,Br,Hn,Kt.x,Kt.y)&&kt(Kt.prev,Kt,Kt.next)>=0)return!1;Kt=Kt.prevZ}for(;Wt&&Wt.z<=_r;){if(Wt.x>=ni&&Wt.x<=ei&&Wt.y>=Yn&&Wt.y<=ci&&Wt!==At&&Wt!==Ft&&Ct(fr,On,Tr,Fr,Br,Hn,Wt.x,Wt.y)&&kt(Wt.prev,Wt,Wt.next)>=0)return!1;Wt=Wt.nextZ}return!0}function W(ae,Ce,Ae){var vt=ae;do{var At=vt.prev,Bt=vt.next.next;!Je(At,Bt)&&Xe(At,vt,vt.next,Bt)&&Be(At,Bt)&&Be(Bt,At)&&(Ce.push(At.i/Ae|0),Ce.push(vt.i/Ae|0),Ce.push(Bt.i/Ae|0),me(vt),me(vt.next),vt=ae=Bt),vt=vt.next}while(vt!==ae);return X(vt)}function Pe(ae,Ce,Ae,vt,At,Bt){var Ft=ae;do{for(var fr=Ft.next.next;fr!==Ft.prev;){if(Ft.i!==fr.i&&et(Ft,fr)){var Tr=Gt(Ft,fr);Ft=X(Ft,Ft.next),Tr=X(Tr,Tr.next),N(Ft,Ce,Ae,vt,At,Bt,0),N(Tr,Ce,Ae,vt,At,Bt,0);return}fr=fr.next}Ft=Ft.next}while(Ft!==ae)}function se(ae,Ce,Ae,vt){var At=[],Bt,Ft,fr,Tr,Br;for(Bt=0,Ft=Ce.length;Bt<Ft;Bt++)fr=Ce[Bt]*vt,Tr=Bt<Ft-1?Ce[Bt+1]*vt:ae.length,Br=H(ae,fr,Tr,vt,!1),Br===Br.next&&(Br.steiner=!0),At.push($e(Br));for(At.sort(ve),Bt=0;Bt<At.length;Bt++)Ae=ue(At[Bt],Ae);return Ae}function ve(ae,Ce){return ae.x-Ce.x}function ue(ae,Ce){var Ae=gt(ae,Ce);if(!Ae)return Ce;var vt=Gt(Ae,ae);return X(vt,vt.next),X(Ae,Ae.next)}function gt(ae,Ce){var Ae=Ce,vt=ae.x,At=ae.y,Bt=-Infinity,Ft;do{if(At<=Ae.y&&At>=Ae.next.y&&Ae.next.y!==Ae.y){var fr=Ae.x+(At-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(fr<=vt&&fr>Bt&&(Bt=fr,Ft=Ae.x<Ae.next.x?Ae:Ae.next,fr===vt))return Ft}Ae=Ae.next}while(Ae!==Ce);if(!Ft)return null;var Tr=Ft,Br=Ft.x,On=Ft.y,Fr=Infinity,Hn;Ae=Ft;do vt>=Ae.x&&Ae.x>=Br&&vt!==Ae.x&&Ct(At<On?vt:Bt,At,Br,On,At<On?Bt:vt,At,Ae.x,Ae.y)&&(Hn=Math.abs(At-Ae.y)/(vt-Ae.x),Be(Ae,ae)&&(Hn<Fr||Hn===Fr&&(Ae.x>Ft.x||Ae.x===Ft.x&&Ne(Ft,Ae)))&&(Ft=Ae,Fr=Hn)),Ae=Ae.next;while(Ae!==Tr);return Ft}function Ne(ae,Ce){return kt(ae.prev,ae,Ce.prev)<0&&kt(Ce.next,ae,ae.next)<0}function st(ae,Ce,Ae,vt){var At=ae;do At.z===0&&(At.z=pt(At.x,At.y,Ce,Ae,vt)),At.prevZ=At.prev,At.nextZ=At.next,At=At.next;while(At!==ae);At.prevZ.nextZ=null,At.prevZ=null,Dt(At)}function Dt(ae){var Ce,Ae,vt,At,Bt,Ft,fr,Tr,Br=1;do{for(Ae=ae,ae=null,Bt=null,Ft=0;Ae;){for(Ft++,vt=Ae,fr=0,Ce=0;Ce<Br&&(fr++,vt=vt.nextZ,!!vt);Ce++);for(Tr=Br;fr>0||Tr>0&&vt;)fr!==0&&(Tr===0||!vt||Ae.z<=vt.z)?(At=Ae,Ae=Ae.nextZ,fr--):(At=vt,vt=vt.nextZ,Tr--),Bt?Bt.nextZ=At:ae=At,At.prevZ=Bt,Bt=At;Ae=vt}Bt.nextZ=null,Br*=2}while(Ft>1);return ae}function pt(ae,Ce,Ae,vt,At){return ae=(ae-Ae)*At|0,Ce=(Ce-vt)*At|0,ae=(ae|ae<<8)&16711935,ae=(ae|ae<<4)&252645135,ae=(ae|ae<<2)&858993459,ae=(ae|ae<<1)&1431655765,Ce=(Ce|Ce<<8)&16711935,Ce=(Ce|Ce<<4)&252645135,Ce=(Ce|Ce<<2)&858993459,Ce=(Ce|Ce<<1)&1431655765,ae|Ce<<1}function $e(ae){var Ce=ae,Ae=ae;do(Ce.x<Ae.x||Ce.x===Ae.x&&Ce.y<Ae.y)&&(Ae=Ce),Ce=Ce.next;while(Ce!==ae);return Ae}function Ct(ae,Ce,Ae,vt,At,Bt,Ft,fr){return(At-Ft)*(Ce-fr)>=(ae-Ft)*(Bt-fr)&&(ae-Ft)*(vt-fr)>=(Ae-Ft)*(Ce-fr)&&(Ae-Ft)*(Bt-fr)>=(At-Ft)*(vt-fr)}function et(ae,Ce){return ae.next.i!==Ce.i&&ae.prev.i!==Ce.i&&!Jt(ae,Ce)&&(Be(ae,Ce)&&Be(Ce,ae)&&Nt(ae,Ce)&&(kt(ae.prev,ae,Ce.prev)||kt(ae,Ce.prev,Ce))||Je(ae,Ce)&&kt(ae.prev,ae,ae.next)>0&&kt(Ce.prev,Ce,Ce.next)>0)}function kt(ae,Ce,Ae){return(Ce.y-ae.y)*(Ae.x-Ce.x)-(Ce.x-ae.x)*(Ae.y-Ce.y)}function Je(ae,Ce){return ae.x===Ce.x&&ae.y===Ce.y}function Xe(ae,Ce,Ae,vt){var At=Dr(kt(ae,Ce,Ae)),Bt=Dr(kt(ae,Ce,vt)),Ft=Dr(kt(Ae,vt,ae)),fr=Dr(kt(Ae,vt,Ce));return!!(At!==Bt&&Ft!==fr||At===0&&jr(ae,Ae,Ce)||Bt===0&&jr(ae,vt,Ce)||Ft===0&&jr(Ae,ae,vt)||fr===0&&jr(Ae,Ce,vt))}function jr(ae,Ce,Ae){return Ce.x<=Math.max(ae.x,Ae.x)&&Ce.x>=Math.min(ae.x,Ae.x)&&Ce.y<=Math.max(ae.y,Ae.y)&&Ce.y>=Math.min(ae.y,Ae.y)}function Dr(ae){return ae>0?1:ae<0?-1:0}function Jt(ae,Ce){var Ae=ae;do{if(Ae.i!==ae.i&&Ae.next.i!==ae.i&&Ae.i!==Ce.i&&Ae.next.i!==Ce.i&&Xe(Ae,Ae.next,ae,Ce))return!0;Ae=Ae.next}while(Ae!==ae);return!1}function Be(ae,Ce){return kt(ae.prev,ae,ae.next)<0?kt(ae,Ce,ae.next)>=0&&kt(ae,ae.prev,Ce)>=0:kt(ae,Ce,ae.prev)<0||kt(ae,ae.next,Ce)<0}function Nt(ae,Ce){var Ae=ae,vt=!1,At=(ae.x+Ce.x)/2,Bt=(ae.y+Ce.y)/2;do Ae.y>Bt!=Ae.next.y>Bt&&Ae.next.y!==Ae.y&&At<(Ae.next.x-Ae.x)*(Bt-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(vt=!vt),Ae=Ae.next;while(Ae!==ae);return vt}function Gt(ae,Ce){var Ae=new Re(ae.i,ae.x,ae.y),vt=new Re(Ce.i,Ce.x,Ce.y),At=ae.next,Bt=Ce.prev;return ae.next=Ce,Ce.prev=ae,Ae.next=At,At.prev=Ae,vt.next=Ae,Ae.prev=vt,Bt.next=vt,vt.prev=Bt,vt}function Te(ae,Ce,Ae,vt){var At=new Re(ae,Ce,Ae);return vt?(At.next=vt.next,At.prev=vt,vt.next.prev=At,vt.next=At):(At.prev=At,At.next=At),At}function me(ae){ae.next.prev=ae.prev,ae.prev.next=ae.next,ae.prevZ&&(ae.prevZ.nextZ=ae.nextZ),ae.nextZ&&(ae.nextZ.prevZ=ae.prevZ)}function Re(ae,Ce,Ae){this.i=ae,this.x=Ce,this.y=Ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}j.deviation=function(ae,Ce,Ae,vt){var At=Ce&&Ce.length,Bt=At?Ce[0]*Ae:ae.length,Ft=Math.abs(Ut(ae,0,Bt,Ae));if(At)for(var fr=0,Tr=Ce.length;fr<Tr;fr++){var Br=Ce[fr]*Ae,On=fr<Tr-1?Ce[fr+1]*Ae:ae.length;Ft-=Math.abs(Ut(ae,Br,On,Ae))}var Fr=0;for(fr=0;fr<vt.length;fr+=3){var Hn=vt[fr]*Ae,ni=vt[fr+1]*Ae,Yn=vt[fr+2]*Ae;Fr+=Math.abs((ae[Hn]-ae[Yn])*(ae[ni+1]-ae[Hn+1])-(ae[Hn]-ae[ni])*(ae[Yn+1]-ae[Hn+1]))}return Ft===0&&Fr===0?0:Math.abs((Fr-Ft)/Ft)};function Ut(ae,Ce,Ae,vt){for(var At=0,Bt=Ce,Ft=Ae-vt;Bt<Ae;Bt+=vt)At+=(ae[Ft]-ae[Bt])*(ae[Bt+1]+ae[Ft+1]),Ft=Bt;return At}j.flatten=function(ae){for(var Ce=ae[0][0].length,Ae={vertices:[],holes:[],dimensions:Ce},vt=0,At=0;At<ae.length;At++){for(var Bt=0;Bt<ae[At].length;Bt++)for(var Ft=0;Ft<Ce;Ft++)Ae.vertices.push(ae[At][Bt][Ft]);At>0&&(vt+=ae[At-1].length,Ae.holes.push(vt))}return Ae}},"W6/K":function(Qe,Q,O){var j=O("eUgh"),H=O("R/W3"),X=O("2GsC"),N=O("sEf8"),v=O("Q1l4"),z=Array.prototype,W=z.splice;function Pe(se,ve,ue,gt){var Ne=gt?X:H,st=-1,Dt=ve.length,pt=se;for(se===ve&&(ve=v(ve)),ue&&(pt=j(se,N(ue)));++st<Dt;)for(var $e=0,Ct=ve[st],et=ue?ue(Ct):Ct;($e=Ne(pt,et,$e,gt))>-1;)pt!==se&&W.call(pt,$e,1),W.call(se,$e,1);return se}Qe.exports=Pe},Wnft:function(Qe,Q,O){Qe.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},WwFo:function(Qe,Q,O){var j=O("juv8"),H=O("7GkX");function X(N,v){return N&&j(v,H(v),N)}Qe.exports=X},XYm9:function(Qe,Q,O){var j=O("+K+b");function H(X,N){var v=N?j(X.buffer):X.buffer;return new X.constructor(v,X.byteOffset,X.byteLength)}Qe.exports=H},"Xt/L":function(Qe,Q){function O(j,H,X){for(var N=-1,v=j==null?0:j.length;++N<v;)if(X(H,j[N]))return!0;return!1}Qe.exports=O},Yk9n:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.inject=Q.LazyServiceIdentifer=void 0;var j=O("MON2"),H=O("xfSm"),X=O("GXnB"),N=O("Ztfv"),v=function(){function W(Pe){this._cb=Pe}return W.prototype.unwrap=function(){return this._cb()},W}();Q.LazyServiceIdentifer=v;function z(W){return function(Pe,se,ve){if(W===void 0)throw new Error(j.UNDEFINED_INJECT_ANNOTATION(Pe.name));var ue=new X.Metadata(H.INJECT_TAG,W);typeof ve=="number"?N.tagParameter(Pe,se,ve,ue):N.tagProperty(Pe,se,ue)}}Q.inject=z},Z1HP:function(Qe,Q,O){var j=O("ycre"),H=O("quyA"),X=O("q4HE");function N(v){return H(v)?X(v):j(v)}Qe.exports=N},ZCgT:function(Qe,Q,O){var j=O("tLB3"),H=1/0,X=17976931348623157e292;function N(v){if(!v)return v===0?v:0;if(v=j(v),v===H||v===-H){var z=v<0?-1:1;return z*X}return v===v?v:0}Qe.exports=N},"Znm+":function(Qe,Q,O){var j=O("NykK"),H=O("ExA7"),X="[object Boolean]";function N(v){return v===!0||v===!1||H(v)&&j(v)==X}Qe.exports=N},Ztfv:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagProperty=Q.tagParameter=Q.decorate=void 0;var j=O("MON2"),H=O("xfSm");function X(se,ve,ue,gt){var Ne=H.TAGGED;v(Ne,se,ve,gt,ue)}Q.tagParameter=X;function N(se,ve,ue){var gt=H.TAGGED_PROP;v(gt,se.constructor,ve,ue)}Q.tagProperty=N;function v(se,ve,ue,gt,Ne){var st={},Dt=typeof Ne=="number",pt=Ne!==void 0&&Dt?Ne.toString():ue;if(Dt&&ue!==void 0)throw new Error(j.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(se,ve)&&(st=Reflect.getMetadata(se,ve));var $e=st[pt];if(!Array.isArray($e))$e=[];else for(var Ct=0,et=$e;Ct<et.length;Ct++){var kt=et[Ct];if(kt.key===gt.key)throw new Error(j.DUPLICATED_METADATA+" "+kt.key.toString())}$e.push(gt),st[pt]=$e,Reflect.defineMetadata(se,st,ve)}function z(se,ve){Reflect.decorate(se,ve)}function W(se,ve){return function(ue,gt){ve(ue,gt,se)}}function Pe(se,ve,ue){typeof ue=="number"?z([W(ue,se)],ve):typeof ue=="string"?Reflect.decorate([se],ve,ue):z([se],ve)}Q.decorate=Pe},ZzCi:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.named=void 0;var j=O("xfSm"),H=O("GXnB"),X=O("Ztfv");function N(v){return function(z,W,Pe){var se=new H.Metadata(j.NAMED_TAG,v);typeof Pe=="number"?X.tagParameter(z,W,Pe,se):X.tagProperty(z,W,se)}}Q.named=N},a5Wf:function(Qe,Q,O){"use strict";O.r(Q);var j={};O.r(j),O.d(j,"getContainer",function(){return Js}),O.d(j,"trim",function(){return zs}),O.d(j,"splitWords",function(){return Oi}),O.d(j,"create",function(){return hu}),O.d(j,"remove",function(){return Yo}),O.d(j,"addClass",function(){return Hl}),O.d(j,"removeClass",function(){return hl}),O.d(j,"hasClass",function(){return pu}),O.d(j,"setClass",function(){return Ko}),O.d(j,"getClass",function(){return pl}),O.d(j,"empty",function(){return ti}),O.d(j,"setTransform",function(){return eu}),O.d(j,"triggerResize",function(){return bs}),O.d(j,"printCanvas",function(){return Ru}),O.d(j,"getViewPortScale",function(){return $a}),O.d(j,"DPR",function(){return _u}),O.d(j,"addStyle",function(){return dl}),O.d(j,"getStyleList",function(){return vl}),O.d(j,"removeStyle",function(){return pa}),O.d(j,"css2Style",function(){return No}),O.d(j,"getDiffRect",function(){return Hh}),O.d(j,"setChecked",function(){return Wl}),O.d(j,"clearChildren",function(){return ch}),O.d(j,"setUnDraggable",function(){return ml}),O.d(j,"appendElementType",function(){return tu}),O.d(j,"findParentElement",function(){return Xc});var H={};O.r(H),O.d(H,"max",function(){return Mu}),O.d(H,"mean",function(){return Xl}),O.d(H,"min",function(){return us}),O.d(H,"mode",function(){return Kc}),O.d(H,"sum",function(){return xs}),O.d(H,"statMap",function(){return Su}),O.d(H,"getColumn",function(){return Zl}),O.d(H,"getSatByColumn",function(){return Ju});var X={};O.r(X),O.d(X,"create",function(){return Ur}),O.d(X,"clone",function(){return cn}),O.d(X,"copy",function(){return Lr}),O.d(X,"identity",function(){return hn}),O.d(X,"fromValues",function(){return Qn}),O.d(X,"set",function(){return Ai}),O.d(X,"transpose",function(){return mn}),O.d(X,"invert",function(){return Kr}),O.d(X,"adjoint",function(){return Pr}),O.d(X,"determinant",function(){return ii}),O.d(X,"multiply",function(){return Xi}),O.d(X,"rotate",function(){return Cn}),O.d(X,"scale",function(){return Ui}),O.d(X,"fromRotation",function(){return Ei}),O.d(X,"fromScaling",function(){return pi}),O.d(X,"str",function(){return ca}),O.d(X,"frob",function(){return Po}),O.d(X,"LDU",function(){return fs}),O.d(X,"add",function(){return Yi}),O.d(X,"subtract",function(){return To}),O.d(X,"exactEquals",function(){return Ha}),O.d(X,"equals",function(){return Uo}),O.d(X,"multiplyScalar",function(){return Vo}),O.d(X,"multiplyScalarAndAdd",function(){return fo}),O.d(X,"mul",function(){return qo}),O.d(X,"sub",function(){return Os});var N={};O.r(N),O.d(N,"create",function(){return Ho}),O.d(N,"clone",function(){return Gi}),O.d(N,"copy",function(){return Ss}),O.d(N,"fromValues",function(){return da}),O.d(N,"set",function(){return di}),O.d(N,"identity",function(){return Di}),O.d(N,"transpose",function(){return ua}),O.d(N,"invert",function(){return hs}),O.d(N,"adjoint",function(){return iu}),O.d(N,"determinant",function(){return Ge}),O.d(N,"multiply",function(){return lr}),O.d(N,"translate",function(){return Yt}),O.d(N,"scale",function(){return En}),O.d(N,"rotate",function(){return Fi}),O.d(N,"rotateX",function(){return Ca}),O.d(N,"rotateY",function(){return de}),O.d(N,"rotateZ",function(){return Ie}),O.d(N,"fromTranslation",function(){return rt}),O.d(N,"fromScaling",function(){return nr}),O.d(N,"fromRotation",function(){return qt}),O.d(N,"fromXRotation",function(){return dt}),O.d(N,"fromYRotation",function(){return bt}),O.d(N,"fromZRotation",function(){return Tt}),O.d(N,"fromRotationTranslation",function(){return Ve}),O.d(N,"fromQuat2",function(){return yt}),O.d(N,"getTranslation",function(){return Me}),O.d(N,"getScaling",function(){return _t}),O.d(N,"getRotation",function(){return hr}),O.d(N,"fromRotationTranslationScale",function(){return mr}),O.d(N,"fromRotationTranslationScaleOrigin",function(){return zr}),O.d(N,"fromQuat",function(){return kr}),O.d(N,"frustum",function(){return Xr}),O.d(N,"perspectiveNO",function(){return Zn}),O.d(N,"perspective",function(){return Dn}),O.d(N,"perspectiveZO",function(){return zn}),O.d(N,"perspectiveFromFieldOfView",function(){return fi}),O.d(N,"orthoNO",function(){return yi}),O.d(N,"ortho",function(){return va}),O.d(N,"orthoZO",function(){return Wo}),O.d(N,"lookAt",function(){return bl}),O.d(N,"targetTo",function(){return Td}),O.d(N,"str",function(){return tl}),O.d(N,"frob",function(){return Dv}),O.d(N,"add",function(){return mc}),O.d(N,"subtract",function(){return Ip}),O.d(N,"multiplyScalar",function(){return hy}),O.d(N,"multiplyScalarAndAdd",function(){return py}),O.d(N,"exactEquals",function(){return dy}),O.d(N,"equals",function(){return kp}),O.d(N,"mul",function(){return Qh}),O.d(N,"sub",function(){return Zm});var v={};O.r(v),O.d(v,"create",function(){return Jh}),O.d(v,"clone",function(){return vy}),O.d(v,"fromValues",function(){return Qo}),O.d(v,"copy",function(){return lo}),O.d(v,"set",function(){return gy}),O.d(v,"add",function(){return Fv}),O.d(v,"subtract",function(){return $m}),O.d(v,"multiply",function(){return Ym}),O.d(v,"divide",function(){return Km}),O.d(v,"ceil",function(){return qm}),O.d(v,"floor",function(){return ep}),O.d(v,"min",function(){return tp}),O.d(v,"max",function(){return yy}),O.d(v,"round",function(){return Jo}),O.d(v,"scale",function(){return Cd}),O.d(v,"scaleAndAdd",function(){return Lf}),O.d(v,"distance",function(){return wd}),O.d(v,"squaredDistance",function(){return Od}),O.d(v,"length",function(){return Bv}),O.d(v,"squaredLength",function(){return rp}),O.d(v,"negate",function(){return nf}),O.d(v,"inverse",function(){return _y}),O.d(v,"normalize",function(){return by}),O.d(v,"dot",function(){return O_}),O.d(v,"cross",function(){return As}),O.d(v,"lerp",function(){return Nf}),O.d(v,"random",function(){return xy}),O.d(v,"transformMat2",function(){return s}),O.d(v,"transformMat2d",function(){return u}),O.d(v,"transformMat3",function(){return f}),O.d(v,"transformMat4",function(){return g}),O.d(v,"rotate",function(){return b}),O.d(v,"angle",function(){return S}),O.d(v,"zero",function(){return T}),O.d(v,"str",function(){return R}),O.d(v,"exactEquals",function(){return F}),O.d(v,"equals",function(){return V}),O.d(v,"len",function(){return $}),O.d(v,"sub",function(){return J}),O.d(v,"mul",function(){return re}),O.d(v,"div",function(){return xe}),O.d(v,"dist",function(){return ze}),O.d(v,"sqrDist",function(){return Fe}),O.d(v,"sqrLen",function(){return lt}),O.d(v,"forEach",function(){return ct});var z={};O.r(z),O.d(z,"create",function(){return wt}),O.d(z,"clone",function(){return Ht}),O.d(z,"length",function(){return ar}),O.d(z,"fromValues",function(){return Mr}),O.d(z,"copy",function(){return gr}),O.d(z,"set",function(){return un}),O.d(z,"add",function(){return fn}),O.d(z,"subtract",function(){return Fn}),O.d(z,"multiply",function(){return $n}),O.d(z,"divide",function(){return Un}),O.d(z,"ceil",function(){return In}),O.d(z,"floor",function(){return Si}),O.d(z,"min",function(){return ai}),O.d(z,"max",function(){return qn}),O.d(z,"round",function(){return ea}),O.d(z,"scale",function(){return Bi}),O.d(z,"scaleAndAdd",function(){return xa}),O.d(z,"distance",function(){return vi}),O.d(z,"squaredDistance",function(){return na}),O.d(z,"squaredLength",function(){return Qa}),O.d(z,"negate",function(){return Wa}),O.d(z,"inverse",function(){return ho}),O.d(z,"normalize",function(){return po}),O.d(z,"dot",function(){return So}),O.d(z,"cross",function(){return Rs}),O.d(z,"lerp",function(){return Go}),O.d(z,"hermite",function(){return au}),O.d(z,"bezier",function(){return Ts}),O.d(z,"random",function(){return ou}),O.d(z,"transformMat4",function(){return ps}),O.d(z,"transformMat3",function(){return es}),O.d(z,"transformQuat",function(){return ds}),O.d(z,"rotateX",function(){return fa}),O.d(z,"rotateY",function(){return aa}),O.d(z,"rotateZ",function(){return Va}),O.d(z,"angle",function(){return Ja}),O.d(z,"zero",function(){return su}),O.d(z,"str",function(){return ro}),O.d(z,"exactEquals",function(){return vo}),O.d(z,"equals",function(){return Ws}),O.d(z,"sub",function(){return la}),O.d(z,"mul",function(){return jf}),O.d(z,"div",function(){return xl}),O.d(z,"dist",function(){return gc}),O.d(z,"sqrDist",function(){return rl}),O.d(z,"len",function(){return Ms}),O.d(z,"sqrLen",function(){return zf}),O.d(z,"forEach",function(){return Uf});var W={};O.r(W),O.d(W,"create",function(){return af}),O.d(W,"clone",function(){return Rd}),O.d(W,"fromValues",function(){return of}),O.d(W,"copy",function(){return Md}),O.d(W,"set",function(){return Pd}),O.d(W,"add",function(){return Dp}),O.d(W,"subtract",function(){return Id}),O.d(W,"multiply",function(){return Fp}),O.d(W,"divide",function(){return kd}),O.d(W,"ceil",function(){return xh}),O.d(W,"floor",function(){return Bp}),O.d(W,"min",function(){return Lv}),O.d(W,"max",function(){return Lp}),O.d(W,"round",function(){return Eh}),O.d(W,"scale",function(){return Np}),O.d(W,"scaleAndAdd",function(){return Nv}),O.d(W,"distance",function(){return Dd}),O.d(W,"squaredDistance",function(){return np}),O.d(W,"length",function(){return Fd}),O.d(W,"squaredLength",function(){return Bd}),O.d(W,"negate",function(){return jp}),O.d(W,"inverse",function(){return jv}),O.d(W,"normalize",function(){return Ld}),O.d(W,"dot",function(){return Nd}),O.d(W,"cross",function(){return jd}),O.d(W,"lerp",function(){return zp}),O.d(W,"random",function(){return zd}),O.d(W,"transformMat4",function(){return ip}),O.d(W,"transformQuat",function(){return Up}),O.d(W,"zero",function(){return Ud}),O.d(W,"str",function(){return Qm}),O.d(W,"exactEquals",function(){return Jm}),O.d(W,"equals",function(){return Ey}),O.d(W,"sub",function(){return eg}),O.d(W,"mul",function(){return Sy}),O.d(W,"div",function(){return tg}),O.d(W,"dist",function(){return kb}),O.d(W,"sqrDist",function(){return R_}),O.d(W,"len",function(){return Vd}),O.d(W,"sqrLen",function(){return Io}),O.d(W,"forEach",function(){return yc});var Pe=O("IzEo"),se=O("bx4M"),ve=O("14J3"),ue=O("BMrR"),gt=O("jCWc"),Ne=O("kPKH"),st=O("fWQN"),Dt=O("mtLc"),pt=O("yKVA"),$e=O("879j"),Ct=O("aHsQ"),et=O("sGsY"),kt=O("9kvl"),Je=O("q1tI"),Xe=O.n(Je),jr=O("FRQA"),Dr=O("ZhIB"),Jt=O.n(Dr),Be=O("yP6+"),Nt=O("0Owb");function Gt(e){var r=e.style;r.height="100%";var t=parseInt("".concat(getComputedStyle(e).height),10),n=parseInt("".concat(getComputedStyle(e).paddingTop),10)+parseInt("".concat(getComputedStyle(e).paddingBottom),10);return t-n}function Te(e){if(!e)return 0;var r=e,t=Gt(r),n=r.parentNode;return n&&(t=Gt(n)),t}function me(){return function(e){var r=function(t){Object(pt.a)(i,t);var n=Object($e.a)(i);function i(){var a;Object(st.a)(this,i);for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return a=n.call.apply(n,[this].concat(l)),a.state={computedHeight:0},a.root=null,a.handleRoot=function(h){a.root=h},a}return Object(Dt.a)(i,[{key:"componentDidMount",value:function(){var o=this.props.height;if(!o&&this.root){var l=Te(this.root);this.setState({computedHeight:l}),l<1&&(l=Te(this.root),this.setState({computedHeight:l}))}}},{key:"render",value:function(){var o=this.props.height,l=this.state.computedHeight,c=o||l;return Xe.a.createElement("div",{ref:this.handleRoot},c>0&&Xe.a.createElement(e,Object(Nt.a)({},this.props,{height:c})))}}]),i}(Xe.a.Component);return r}}var Re=me,Ut=O("gPzx"),ae=Be.Guide.Arc,Ce=Be.Guide.Html,Ae=Be.Guide.Line,vt=function(r){switch(r){case"2":return"\u5DEE";case"4":return"\u4E2D";case"6":return"\u826F";case"8":return"\u4F18";default:return""}};Be.Shape.registerShape&&Be.Shape.registerShape("point","pointer",{drawShape:function(r,t){var n=r.points[0];n=this.parsePoint(n);var i=this.parsePoint({x:0,y:0});return t.addShape("line",{attrs:{x1:i.x,y1:i.y,x2:n.x,y2:n.y,stroke:r.color,lineWidth:2,lineCap:"round"}}),t.addShape("circle",{attrs:{x:i.x,y:i.y,r:6,stroke:r.color,lineWidth:3,fill:"#fff"}})}});var At=function(r){var t=r.title,n=r.height,i=n===void 0?1:n,a=r.percent,o=r.forceFit,l=o===void 0?!0:o,c=r.formatter,h=c===void 0?vt:c,_=r.color,x=_===void 0?"#2F9CFF":_,E=r.bgColor,C=E===void 0?"#F0F2F5":E,I={value:{type:"linear",min:0,max:10,tickCount:6,nice:!0}},P=[{value:a/10}],B=function(){return`
  <div style="width: 300px;text-align: center;font-size: 12px!important;">
    <div style="font-size: 14px; color: rgba(0,0,0,0.43);margin: 0;">`.concat(t,`</div>
    <div style="font-size: 24px;color: rgba(0,0,0,0.85);margin: 0;">
      `).concat((P[0].value*10).toFixed(2),`%
    </div>
  </div>`)},U={fontSize:12,fill:"rgba(0, 0, 0, 0.65)",textAlign:"center"};return Xe.a.createElement(Be.Chart,{height:i,data:P,scale:I,padding:[-16,0,16,0],forceFit:l},Xe.a.createElement(Be.Coord,{type:"polar",startAngle:-1.25*Math.PI,endAngle:.25*Math.PI,radius:.8}),Xe.a.createElement(Be.Axis,{name:"1",line:void 0}),Xe.a.createElement(Be.Axis,{line:void 0,tickLine:void 0,subTickLine:void 0,name:"value",zIndex:Ut.a.cssStyle.zIndex.zIndex_2,label:{offset:-12,formatter:h,textStyle:U}}),Xe.a.createElement(Be.Guide,null,Xe.a.createElement(Ae,{start:[3,.905],end:[3,.85],lineStyle:{stroke:x,lineDash:void 0,lineWidth:2}}),Xe.a.createElement(Ae,{start:[5,.905],end:[5,.85],lineStyle:{stroke:x,lineDash:void 0,lineWidth:3}}),Xe.a.createElement(Ae,{start:[7,.905],end:[7,.85],lineStyle:{stroke:x,lineDash:void 0,lineWidth:3}}),Xe.a.createElement(ae,{start:[0,.965],end:[10,.965],style:{stroke:C,lineWidth:10}}),Xe.a.createElement(ae,{start:[0,.965],end:[P[0].value,.965],style:{stroke:x,lineWidth:10}}),Xe.a.createElement(Ce,{position:["50%","95%"],html:B()})),Xe.a.createElement(Be.Geom,{line:!1,type:"point",position:"value*1",shape:"pointer",color:x,active:!1}))},Bt=Re()(At),Ft=O("k1fw"),fr=O("iz+Y"),Tr=O.n(fr),Br=function(r){var t=r.height,n=t===void 0?1:t,i=r.data,a=i===void 0?[]:i,o=r.forceFit,l=o===void 0?!0:o,c=r.color,h=c===void 0?"rgba(24, 144, 255, 0.2)":c,_=r.borderColor,x=_===void 0?"#1089ff":_,E=r.scale,C=E===void 0?{x:{},y:{}}:E,I=r.borderWidth,P=I===void 0?2:I,B=r.line,U=r.xAxis,ee=r.yAxis,ie=r.animate,_e=ie===void 0?!0:ie,Oe=[36,5,30,5],ke={x:Object(Ft.a)({type:"cat",range:[0,1]},C.x),y:Object(Ft.a)({min:0},C.y)},Ke=["x*y",function(Ot,Zt){return{name:Ot,value:Zt}}],ot=n+54;return Xe.a.createElement("div",{className:Tr.a.miniChart,style:{height:n}},Xe.a.createElement("div",{className:Tr.a.chartContent},n>0&&Xe.a.createElement(Be.Chart,{animate:_e,scale:ke,height:ot,forceFit:l,data:a,padding:Oe},Xe.a.createElement(Be.Axis,Object(Nt.a)({key:"axis-x",name:"x",label:null,line:null,tickLine:null,grid:null},U)),Xe.a.createElement(Be.Axis,Object(Nt.a)({key:"axis-y",name:"y",label:null,line:null,tickLine:null,grid:null},ee)),Xe.a.createElement(Be.Tooltip,{showTitle:!1,crosshairs:!1}),Xe.a.createElement(Be.Geom,{type:"area",position:"x*y",color:h,tooltip:Ke,shape:"smooth",style:{fillOpacity:1}}),B?Xe.a.createElement(Be.Geom,{type:"line",position:"x*y",shape:"smooth",color:x,size:P,tooltip:!1}):Xe.a.createElement("span",{style:{display:"none"}}))))},On=Re()(Br),Fr=O("/zsF"),Hn=O("PArb"),ni=O("jrin"),Yn=O("cQSq"),ei=O.n(Yn),ci=O("9/5/"),Sr=O.n(ci),_r=O("Jssm"),Kt=O.n(_r),Wt=O("TSYQ"),Ir=O.n(Wt),je=O("d9mD"),oe=O.n(je),ne=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){var n;Object(st.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),n.state={legendData:[],legendBlock:!1},n.chart=void 0,n.root=void 0,n.requestRef=0,n.resize=Sr()(function(){var l=n.props.hasLegend,c=n.state.legendBlock;if(!l||!n.root){window.removeEventListener("resize",n.resize);return}n.root&&n.root.parentNode&&n.root.parentNode.clientWidth<=380?c||n.setState({legendBlock:!0}):c&&n.setState({legendBlock:!1})},300),n.getG2Instance=function(l){n.chart=l,requestAnimationFrame(function(){n.getLegendData(),n.resize()})},n.getLegendData=function(){if(!!n.chart){var l=n.chart.getAllGeoms()[0];if(!!l){var c=l.get("dataArray")||[],h=c.map(function(_){var x=_[0]._origin;return x.color=_[0].color,x.checked=!0,x});n.setState({legendData:h})}}},n.handleRoot=function(l){n.root=l},n.handleLegendClick=function(l,c){var h=l;h.checked=!h.checked;var _=n.state.legendData;_[c]=h;var x=_.filter(function(E){return E.checked}).map(function(E){return E.x});n.chart&&n.chart.filter("x",function(E){return x.indexOf("".concat(E))>-1}),n.setState({legendData:_})},n}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){var i=this;window.addEventListener("resize",function(){i.requestRef=requestAnimationFrame(function(){return i.resize()})},{passive:!0})}},{key:"componentDidUpdate",value:function(i){var a=this.props.data;a!==i.data&&this.getLegendData()}},{key:"componentWillUnmount",value:function(){this.requestRef&&window.cancelAnimationFrame(this.requestRef),window.removeEventListener("resize",this.resize),this.resize&&this.resize.cancel()}},{key:"render",value:function(){var i,a=this,o=this.props,l=o.valueFormat,c=o.subTitle,h=o.total,_=o.hasLegend,x=_===void 0?!1:_,E=o.className,C=o.style,I=o.height,P=I===void 0?0:I,B=o.forceFit,U=B===void 0?!0:B,ee=o.percent,ie=o.color,_e=o.inner,Oe=_e===void 0?.75:_e,ke=o.animate,Ke=ke===void 0?!0:ke,ot=o.colors,Ot=o.lineWidth,Zt=Ot===void 0?1:Ot,ir=this.state,Hr=ir.legendData,ln=ir.legendBlock,pn=Ir()(oe.a.pie,E,(i={},Object(ni.a)(i,oe.a.hasLegend,!!x),Object(ni.a)(i,oe.a.legendBlock,ln),i)),Ci=this.props,Ba=Ci.data,Sa=Ci.selected,La=Sa===void 0?!0:Sa,wa=Ci.tooltip,Ds=wa===void 0?!0:wa,Mc=Ba||[],al=La,pf=Ds,pd=ot;Mc=Mc||[],al=al||!0,pf=pf||!0;var co,ol={x:{type:"cat",range:[0,1]},y:{min:0}};(ee||ee===0)&&(al=!1,pf=!1,co=function($i){return $i==="\u5360\u6BD4"?ie||"rgba(24, 144, 255, 0.85)":"#F0F2F5"},Mc=[{x:"\u5360\u6BD4",y:parseFloat("".concat(ee))},{x:"\u53CD\u6BD4",y:100-parseFloat("".concat(ee))}]);var Lm=["x*percent",function(qi,$i){return{name:qi,value:"".concat(($i*100).toFixed(2),"%")}}],Nm=[12,0,12,0],Li=new Yn.DataView;return Li.source(Mc).transform({type:"percent",field:"y",dimension:"x",as:"percent"}),Xe.a.createElement("div",{ref:this.handleRoot,className:pn,style:C},Xe.a.createElement(Kt.a,{maxFontSize:25},Xe.a.createElement("div",{className:oe.a.chart},Xe.a.createElement(Be.Chart,{scale:ol,height:P,forceFit:U,data:Li,padding:Nm,animate:Ke,onGetG2Instance:this.getG2Instance},!!pf&&Xe.a.createElement(Be.Tooltip,{showTitle:!1}),Xe.a.createElement(Be.Coord,{type:"theta",innerRadius:Oe}),Xe.a.createElement(Be.Geom,{style:{lineWidth:Zt,stroke:"#fff"},tooltip:pf?Lm:void 0,type:"intervalStack",position:"percent",color:["x",ee||ee===0?co:pd],selected:al})),(c||h)&&Xe.a.createElement("div",{className:oe.a.total},c&&Xe.a.createElement("h4",{className:"pie-sub-title"},c),h&&Xe.a.createElement("div",{className:"pie-stat"},typeof h=="function"?h():h)))),x&&Xe.a.createElement("ul",{className:oe.a.legend},Hr.map(function(qi,$i){return Xe.a.createElement("li",{key:qi.x,onClick:function(){return a.handleLegendClick(qi,$i)}},Xe.a.createElement("span",{className:oe.a.dot,style:{backgroundColor:qi.checked?qi.color:"#aaa"}}),Xe.a.createElement("span",{className:oe.a.legendTitle},qi.x),Xe.a.createElement(Hn.a,{type:"vertical"}),Xe.a.createElement("span",{className:oe.a.percent},"".concat((Number.isNaN(qi.percent)?0:qi.percent*100).toFixed(2),"%")),Xe.a.createElement("span",{className:oe.a.value},l?l(qi.y):qi.y))})))}}]),t}(Je.Component),D=Re()(ne),Ee=O("tJVT"),He=O("1XEM"),xt=O.n(He),er="https://gw.alipayobjects.com/zos/rmsportal/gWyeGLCdFFRavBGIDzWk.png",ur=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){var n;Object(st.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),n.state={dv:null,height:0,width:0},n.requestRef=0,n.isUnmount=!1,n.root=void 0,n.imageMask=void 0,n.resize=function(){n.requestRef=requestAnimationFrame(function(){n.renderChart(n.props)})},n.saveRootRef=function(l){n.root=l},n.initTagCloud=function(){function l(c){return Object(Ft.a)(Object(Ft.a)({},c.style),{},{fillOpacity:c.opacity,fontSize:c.origin._origin.size,rotate:c.origin._origin.rotate,text:c.origin._origin.text,textAlign:"center",fontFamily:c.origin._origin.font,fill:c.color,textBaseline:"Alphabetic"})}Be.Shape.registerShape("point","cloud",{drawShape:function(h,_){var x=l(h);return _.addShape("text",{attrs:Object(Ft.a)(Object(Ft.a)({},x),{},{x:h.x,y:h.y})})}})},n.renderChart=Sr()(function(l){var c=l||n.props,h=c.data,_=c.height;if(!(h.length<1||!n.root)){var x=_,E=n.root.offsetWidth,C=function(){var P=new ei.a.View().source(h),B=P.range("value"),U=Object(Ee.a)(B,2),ee=U[0],ie=U[1];P.transform({type:"tag-cloud",fields:["name","value"],imageMask:n.imageMask,font:"Verdana",size:[E,x],padding:0,timeInterval:5e3,rotate:function(){return 0},fontSize:function(Oe){var ke=Math.pow((Oe.value-ee)/(ie-ee),2);return ke*(17.5-5)+5}}),!n.isUnmount&&n.setState({dv:P,width:E,height:x})};n.imageMask?C():(n.imageMask=new Image,n.imageMask.crossOrigin="",n.imageMask.src=er,n.imageMask.onload=C)}},200),n}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){var i=this;requestAnimationFrame(function(){i.initTagCloud(),i.renderChart(i.props)}),window.addEventListener("resize",this.resize,{passive:!0})}},{key:"componentDidUpdate",value:function(i){var a=this.props.data;i&&JSON.stringify(i.data)!==JSON.stringify(a)&&this.renderChart(this.props)}},{key:"componentWillUnmount",value:function(){this.isUnmount=!0,window.cancelAnimationFrame(this.requestRef),window.removeEventListener("resize",this.resize)}},{key:"render",value:function(){var i=this.props,a=i.className,o=i.height,l=this.state,c=l.dv,h=l.width,_=l.height;return Xe.a.createElement("div",{className:Ir()(xt.a.tagCloud,a),style:{width:"100%",height:o},ref:this.saveRootRef},c&&Xe.a.createElement(Be.Chart,{width:h,height:_,data:c,padding:0,scale:{x:{nice:!1},y:{nice:!1}}},Xe.a.createElement(Be.Tooltip,{showTitle:!1}),Xe.a.createElement(Be.Coord,{reflect:"y"}),Xe.a.createElement(Be.Geom,{type:"point",position:"x*y",color:"text",shape:"cloud",tooltip:["text*value",function(E,C){return{name:E,value:C}}]})))}}]),t}(Je.Component),tt=Re()(ur),It=O("CIdX"),or=O.n(It),Cr=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){var n;Object(st.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),n.state={radio:1},n.timer=0,n.root=null,n.node=null,n.resize=function(){if(n.root){var l=n.props.height,c=l===void 0?1:l,h=n.root.parentNode,_=h.offsetWidth;n.setState({radio:_<c?_/c:1})}},n}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){var i=this;this.renderChart(),this.resize(),window.addEventListener("resize",function(){requestAnimationFrame(function(){return i.resize()})},{passive:!0})}},{key:"componentDidUpdate",value:function(i){var a=this.props.percent;i.percent!==a&&this.renderChart("update")}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.timer),this.node&&(this.node.innerHTML=""),window.removeEventListener("resize",this.resize)}},{key:"renderChart",value:function(i){var a=this.props,o=a.percent,l=a.color,c=l===void 0?"#1890FF":l,h=o/100,_=this;if(cancelAnimationFrame(this.timer),!this.node||h!==0&&!h)return;var x=this.node,E=x.getContext("2d");if(!E)return;var C=x.width,I=x.height,P=C/2,B=2,U=P-B;E.beginPath(),E.lineWidth=B*2;for(var ee=C-B,ie=ee/8,_e=.2,Oe=_e,ke=B,Ke=0,ot=0,Ot=.005,Zt=[],ir=P-B,Hr=-(Math.PI/2),ln=!0,pn=Hr;pn<Hr+2*Math.PI;pn+=1/(8*Math.PI))Zt.push([P+ir*Math.cos(pn),P+ir*Math.sin(pn)]);var Ci=Zt.shift();E.strokeStyle=c,E.moveTo(Ci[0],Ci[1]);function Ba(){if(!!E){E.beginPath(),E.save();for(var La=[],wa=ke;wa<=ke+ee;wa+=20/ee){var Ds=Ke+(ke+wa)/ie,Mc=Math.sin(Ds)*Oe,al=wa,pf=2*U*(1-ot)+(P-U)-ie*Mc;E.lineTo(al,pf),La.push([al,pf])}var pd=La.shift();E.lineTo(ke+ee,I),E.lineTo(ke,I),E.lineTo(pd[0],pd[1]);var co=E.createLinearGradient(0,0,0,I);co.addColorStop(0,"#ffffff"),co.addColorStop(1,c),E.fillStyle=co,E.fill(),E.restore()}}function Sa(){if(!!E){if(E.clearRect(0,0,C,I),ln&&i!=="update")if(Zt.length){var La=Zt.shift();E.lineTo(La[0],La[1]),E.stroke()}else ln=!1,E.lineTo(Ci[0],Ci[1]),E.stroke(),Zt=[],E.globalCompositeOperation="destination-over",E.beginPath(),E.lineWidth=B,E.arc(P,P,ir,0,2*Math.PI,!0),E.beginPath(),E.save(),E.arc(P,P,P-3*B,0,2*Math.PI,!0),E.restore(),E.clip(),E.fillStyle=c;else{if(h>=.85){if(Oe>_e/4){var wa=_e*.01;Oe-=wa}}else if(h<=.1){if(Oe<_e*1.5){var Ds=_e*.01;Oe+=Ds}}else{if(Oe<=_e){var Mc=_e*.01;Oe+=Mc}if(Oe>=_e){var al=_e*.01;Oe-=al}}h-ot>0&&(ot+=Ot),h-ot<0&&(ot-=Ot),Ke+=.07,Ba()}_.timer=requestAnimationFrame(Sa)}}Sa()}},{key:"render",value:function(){var i=this,a=this.state.radio,o=this.props,l=o.percent,c=o.title,h=o.height,_=h===void 0?1:h;return Xe.a.createElement("div",{className:or.a.waterWave,ref:function(E){return i.root=E},style:{transform:"scale(".concat(a,")")}},Xe.a.createElement("div",{style:{width:_,height:_,overflow:"hidden"}},Xe.a.createElement("canvas",{className:or.a.waterWaveCanvasWrapper,ref:function(E){return i.node=E},width:_*2,height:_*2})),Xe.a.createElement("div",{className:or.a.text,style:{width:_}},c&&Xe.a.createElement("span",null,c),Xe.a.createElement("h4",null,l,"%")))}}]),t}(Je.Component),Or=Re()(Cr),Nn=O("9og8"),sn=O("WmNS"),gn=O.n(sn),dn=Object(Je.createContext)({});function ri(){return Object(Je.useContext)(dn)}var mi={},ki={},Aa=function(r){return ki[r]},Pa=function(r,t){ki[r]=t},Co=function(r){return mi[r]},yo=function(r,t){mi[r]=t},Mi={},te={},K=34,fe=10,Se=13;function Le(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function mt(e,r){var t=Le(e);return function(n,i){return r(t(n),i,e)}}function St(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function ge(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function Ye(e){return e<0?"-"+ge(-e,6):e>9999?"+"+ge(e,6):ge(e,4)}function zt(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Ye(e.getUTCFullYear(),4)+"-"+ge(e.getUTCMonth()+1,2)+"-"+ge(e.getUTCDate(),2)+(i?"T"+ge(r,2)+":"+ge(t,2)+":"+ge(n,2)+"."+ge(i,3)+"Z":n?"T"+ge(r,2)+":"+ge(t,2)+":"+ge(n,2)+"Z":t||r?"T"+ge(r,2)+":"+ge(t,2)+"Z":"")}var Rr=function(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(x,E){var C,I,P=i(x,function(B,U){if(C)return C(B,U-1);I=B,C=E?mt(B,E):Le(B)});return P.columns=I||[],P}function i(x,E){var C=[],I=x.length,P=0,B=0,U,ee=I<=0,ie=!1;x.charCodeAt(I-1)===fe&&--I,x.charCodeAt(I-1)===Se&&--I;function _e(){if(ee)return te;if(ie)return ie=!1,Mi;var ke,Ke=P,ot;if(x.charCodeAt(Ke)===K){for(;P++<I&&x.charCodeAt(P)!==K||x.charCodeAt(++P)===K;);return(ke=P)>=I?ee=!0:(ot=x.charCodeAt(P++))===fe?ie=!0:ot===Se&&(ie=!0,x.charCodeAt(P)===fe&&++P),x.slice(Ke+1,ke-1).replace(/""/g,'"')}for(;P<I;){if((ot=x.charCodeAt(ke=P++))===fe)ie=!0;else if(ot===Se)ie=!0,x.charCodeAt(P)===fe&&++P;else if(ot!==t)continue;return x.slice(Ke,ke)}return ee=!0,x.slice(Ke,I)}for(;(U=_e())!==te;){for(var Oe=[];U!==Mi&&U!==te;)Oe.push(U),U=_e();E&&(Oe=E(Oe,B++))==null||C.push(Oe)}return C}function a(x,E){return x.map(function(C){return E.map(function(I){return _(C[I])}).join(e)})}function o(x,E){return E==null&&(E=St(x)),[E.map(_).join(e)].concat(a(x,E)).join(`
`)}function l(x,E){return E==null&&(E=St(x)),a(x,E).join(`
`)}function c(x){return x.map(h).join(`
`)}function h(x){return x.map(_).join(e)}function _(x){return x==null?"":x instanceof Date?zt(x):r.test(x+="")?'"'+x.replace(/"/g,'""')+'"':x}return{parse:n,parseRows:i,format:o,formatBody:l,formatRows:c,formatRow:h,formatValue:_}},Nr=Rr(","),pr=Nr.parse,Wr=Nr.parseRows,Gn=Nr.format,wn=Nr.formatBody,dr=Nr.formatRows,Sn=Nr.formatRow,bn=Nr.formatValue,we=O("VTBJ"),Kn=63710088e-1,xn={centimeters:Kn*100,centimetres:Kn*100,degrees:Kn/111325,feet:Kn*3.28084,inches:Kn*39.37,kilometers:Kn/1e3,kilometres:Kn/1e3,meters:Kn,metres:Kn,miles:Kn/1609.344,millimeters:Kn*1e3,millimetres:Kn*1e3,nauticalmiles:Kn/1852,radians:1,yards:Kn*1.0936},Vi={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Kn,yards:1.0936133},ia={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function bi(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function ta(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return Ni(r).geometry;case"LineString":return Hi(r).geometry;case"Polygon":return wi(r).geometry;case"MultiPoint":return Fs(r).geometry;case"MultiLineString":return eo(r).geometry;case"MultiPolygon":return _o(r).geometry;default:throw new Error(e+" is invalid")}}function Ni(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!$o(e[0])||!$o(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return bi(n,r,t)}function ns(e,r,t){return t===void 0&&(t={}),gi(e.map(function(n){return Ni(n,r)}),t)}function wi(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<a[a.length-1].length;o++)if(a[a.length-1][o]!==a[0][o])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return bi(l,r,t)}function Xa(e,r,t){return t===void 0&&(t={}),gi(e.map(function(n){return wi(n,r)}),t)}function Hi(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return bi(n,r,t)}function Zi(e,r,t){return t===void 0&&(t={}),gi(e.map(function(n){return Hi(n,r)}),t)}function gi(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function eo(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return bi(n,r,t)}function Fs(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return bi(n,r,t)}function _o(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return bi(n,r,t)}function ms(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return bi(n,r,t)}function oc(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function wo(e,r){r===void 0&&(r="kilometers");var t=xn[r];if(!t)throw new Error(r+" units is invalid");return e*t}function Ia(e,r){r===void 0&&(r="kilometers");var t=xn[r];if(!t)throw new Error(r+" units is invalid");return e/t}function Ol(e,r){return Na(Ia(e,r))}function Zo(e){var r=e%360;return r<0&&(r+=360),r}function Na(e){var r=e%(2*Math.PI);return r*180/Math.PI}function ao(e){var r=e%360;return r*Math.PI/180}function Ta(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return wo(Ia(e,r),t)}function Do(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=ia[r];if(!n)throw new Error("invalid original units");var i=ia[t];if(!i)throw new Error("invalid final units");return e/n*i}function $o(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function kc(e){return!!e&&e.constructor===Object}function Bs(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!$o(r))throw new Error("bbox must only contain numbers")})}function Dh(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Fo(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _a(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ft(e){if(e.length>1&&$o(e[0])&&$o(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return ft(e[0]);throw new Error("coordinates must only contain numbers")}function le(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function Ze(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function sr(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function rn(e){return e.type==="Feature"?e.geometry:e}function Pn(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ji(e,r,t){if(e!==null)for(var n,i,a,o,l,c,h,_=0,x=0,E,C=e.type,I=C==="FeatureCollection",P=C==="Feature",B=I?e.features.length:1,U=0;U<B;U++){h=I?e.features[U].geometry:P?e.geometry:e,E=h?h.type==="GeometryCollection":!1,l=E?h.geometries.length:1;for(var ee=0;ee<l;ee++){var ie=0,_e=0;if(o=E?h.geometries[ee]:h,o!==null){c=o.coordinates;var Oe=o.type;switch(_=t&&(Oe==="Polygon"||Oe==="MultiPolygon")?1:0,Oe){case null:break;case"Point":if(r(c,x,U,ie,_e)===!1)return!1;x++,ie++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(r(c[n],x,U,ie,_e)===!1)return!1;x++,Oe==="MultiPoint"&&ie++}Oe==="LineString"&&ie++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(i=0;i<c[n].length-_;i++){if(r(c[n][i],x,U,ie,_e)===!1)return!1;x++}Oe==="MultiLineString"&&ie++,Oe==="Polygon"&&_e++}Oe==="Polygon"&&ie++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(_e=0,i=0;i<c[n].length;i++){for(a=0;a<c[n][i].length-_;a++){if(r(c[n][i][a],x,U,ie,_e)===!1)return!1;x++}_e++}ie++}break;case"GeometryCollection":for(n=0;n<o.geometries.length;n++)if(ji(o.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Za(e,r,t,n){var i=t;return ji(e,function(a,o,l,c,h){o===0&&t===void 0?i=a:i=r(i,a,o,l,c,h)},n),i}function Oo(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function gs(e,r,t){var n=t;return Oo(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function Ls(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function df(e,r,t){var n=t;return Ls(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function gp(e){var r=[];return ji(e,function(t){r.push(t)}),r}function Dc(e,r){var t,n,i,a,o,l,c,h,_,x,E=0,C=e.type==="FeatureCollection",I=e.type==="Feature",P=C?e.features.length:1;for(t=0;t<P;t++){for(l=C?e.features[t].geometry:I?e.geometry:e,h=C?e.features[t].properties:I?e.properties:{},_=C?e.features[t].bbox:I?e.bbox:void 0,x=C?e.features[t].id:I?e.id:void 0,c=l?l.type==="GeometryCollection":!1,o=c?l.geometries.length:1,i=0;i<o;i++){if(a=c?l.geometries[i]:l,a===null){if(r(null,E,h,_,x)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,E,h,_,x)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],E,h,_,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function dd(e,r,t){var n=t;return Dc(e,function(i,a,o,l,c){a===0&&t===void 0?n=i:n=r(n,i,a,o,l,c)}),n}function Rl(e,r){Dc(e,function(t,n,i,a,o){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(bi(t,i,{bbox:a,id:o}),n,0)===!1?!1:void 0}var c;switch(l){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var h=0;h<t.coordinates.length;h++){var _=t.coordinates[h],x={type:c,coordinates:_};if(r(bi(x,i),n,h)===!1)return!1}})}function ys(e,r,t){var n=t;return Rl(e,function(i,a,o){a===0&&o===0&&t===void 0?n=i:n=r(n,i,a,o)}),n}function Ml(e,r){Rl(e,function(t,n,i){var a=0;if(!!t.geometry){var o=t.geometry.type;if(!(o==="Point"||o==="MultiPoint")){var l,c=0,h=0,_=0;if(ji(t,function(x,E,C,I,P){if(l===void 0||n>c||I>h||P>_){l=x,c=n,h=I,_=P,a=0;return}var B=Hi([l,x],t.properties);if(r(B,n,i,P,a)===!1)return!1;a++,l=x})===!1)return!1}}})}function sc(e,r,t){var n=t,i=!1;return Ml(e,function(a,o,l,c,h){i===!1&&t===void 0?n=a:n=r(n,a,o,l,c,h),i=!0}),n}function Gu(e,r){if(!e)throw new Error("geojson is required");Rl(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,o=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<o.length;l++)if(r(Hi(o[l],t.properties),n,i,l)===!1)return!1;break}}})}function sl(e,r,t){var n=t;return Gu(e,function(i,a,o,l){a===0&&t===void 0?n=i:n=r(n,i,a,o,l)}),n}function Pl(e,r){if(r=r||{},!kc(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,o=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":o=o||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=c.length+a-1),Hi([c[a],c[a+1]],o,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a-1),Hi([c[i][a],c[i][a+1]],o,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a-1),Hi([c[n][a],c[n][a+1]],o,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a-1),Hi([c[n][i][a],c[n][i][a+1]],o,r)}throw new Error("geojson is invalid")}function Yf(e,r){if(r=r||{},!kc(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,o=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),o=o||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":o=o||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var c=l.coordinates;switch(l.type){case"Point":return Ni(c,o,r);case"MultiPoint":return n<0&&(n=c.length+n),Ni(c[n],o,r);case"LineString":return a<0&&(a=c.length+a),Ni(c[a],o,r);case"Polygon":return i<0&&(i=c.length+i),a<0&&(a=c[i].length+a),Ni(c[i][a],o,r);case"MultiLineString":return n<0&&(n=c.length+n),a<0&&(a=c[n].length+a),Ni(c[n][a],o,r);case"MultiPolygon":return n<0&&(n=c.length+n),i<0&&(i=c[n].length+i),a<0&&(a=c[n][i].length-a),Ni(c[n][i][a],o,r)}throw new Error("geojson is invalid")}var Rt=O("vuIU"),Et=O("1OyB"),qr=O("Ji7U"),Zr=O("md7G"),ut=O("foSv"),Fh=O("s4An");function Kf(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var Bh=O("2WcH");function Fc(e,r,t){return Object(Bh.a)()?Fc=Reflect.construct.bind():Fc=function(i,a,o){var l=[null];l.push.apply(l,a);var c=Function.bind.apply(i,l),h=new c;return o&&Object(Fh.a)(h,o.prototype),h},Fc.apply(null,arguments)}function vf(e){var r=typeof Map=="function"?new Map:void 0;return vf=function(n){if(n===null||!Kf(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return Fc(n,arguments,Object(ut.a)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(Fh.a)(i,n)},vf(e)}var mf={REGISTERED_PROTOCOLS:{}};function yp(e){var r=vd();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function vd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uc=function(r){return mf.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},Xu=function(e){Object(qr.a)(t,e);var r=yp(t);function t(n,i,a,o){var l;return Object(Et.a)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=o,l}return Object(Rt.a)(t)}(vf(Error));function Lh(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var o=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new Xu(t.status,t.statusText,n.toString(),o))}},t.cancel=t.abort,t.send(e.body),t}function is(e){return new Promise(function(r,t){Lh(e,function(n,i,a,o,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:o,xhr:l})})})}function Zu(e,r){return Lh(e,r)}var Il=function(r,t){var n=uc(r.url)||Zu;return n(Object(we.a)(Object(we.a)({},r),{},{type:"json"}),t)},Ns=function(r,t){var n=uc(r.url)||Zu;return n(Object(we.a)(Object(we.a)({},r),{},{type:"arrayBuffer"}),t)},lc=function(r,t){return Zu(Object(we.a)(Object(we.a)({},r),{},{method:"POST"}),t)},mu=function(r,t){return Zu(Object(we.a)(Object(we.a)({},r),{},{method:"GET"}),t)};function kl(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Zs="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function $u(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Zs})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Zs}function ul(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var qf=function(r,t,n){var i=function(o,l){if(o)t(o);else if(l){var c=typeof createImageBitmap=="function",h=n?n(l):l;c?ul(h,t):$u(h,t)}};return r.type==="json"?Il(r,i):Ns(r,i)},_p=function(r,t){var n=typeof createImageBitmap=="function";n?ul(r,t):$u(r,t)},ba=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),Qf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gf(e,r,t){var n=e.classList;for(var i in Qf)Qf.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var yf=function(e,r,t){e.prototype=r.prototype=t,t.constructor=e};function oo(e,r){var t=Object.create(e.prototype);for(var n in r)t[n]=r[n];return t}function cc(){}var Bc=.7,as=1/Bc,$s="\\s*([+-]?\\d+)\\s*",Ys="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",_s="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Jf=/^#([0-9a-f]{3,8})$/,Lc=new RegExp("^rgb\\("+[$s,$s,$s]+"\\)$"),Ou=new RegExp("^rgb\\("+[_s,_s,_s]+"\\)$"),_f=new RegExp("^rgba\\("+[$s,$s,$s,Ys]+"\\)$"),Dl=new RegExp("^rgba\\("+[_s,_s,_s,Ys]+"\\)$"),ll=new RegExp("^hsl\\("+[Ys,_s,_s]+"\\)$"),Nh=new RegExp("^hsla\\("+[Ys,_s,_s,Ys]+"\\)$"),Nc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};yf(cc,Ks,{copy:function(r){return Object.assign(new this.constructor,this,r)},displayable:function(){return this.rgb().displayable()},hex:ka,formatHex:ka,formatHsl:eh,formatRgb:bp,toString:bp});function ka(){return this.rgb().formatHex()}function eh(){return rh(this).formatHsl()}function bp(){return this.rgb().formatRgb()}function Ks(e){var r,t;return e=(e+"").trim().toLowerCase(),(r=Jf.exec(e))?(t=r[1].length,r=parseInt(r[1],16),t===6?jc(r):t===3?new Bo(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):t===8?zc(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):t===4?zc(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=Lc.exec(e))?new Bo(r[1],r[2],r[3],1):(r=Ou.exec(e))?new Bo(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=_f.exec(e))?zc(r[1],r[2],r[3],r[4]):(r=Dl.exec(e))?zc(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=ll.exec(e))?Bl(r[1],r[2]/100,r[3]/100,1):(r=Nh.exec(e))?Bl(r[1],r[2]/100,r[3]/100,r[4]):Nc.hasOwnProperty(e)?jc(Nc[e]):e==="transparent"?new Bo(NaN,NaN,NaN,0):null}function jc(e){return new Bo(e>>16&255,e>>8&255,e&255,1)}function zc(e,r,t,n){return n<=0&&(e=r=t=NaN),new Bo(e,r,t,n)}function th(e){return e instanceof cc||(e=Ks(e)),e?(e=e.rgb(),new Bo(e.r,e.g,e.b,e.opacity)):new Bo}function gu(e,r,t,n){return arguments.length===1?th(e):new Bo(e,r,t,n==null?1:n)}function Bo(e,r,t,n){this.r=+e,this.g=+r,this.b=+t,this.opacity=+n}yf(Bo,gu,oo(cc,{brighter:function(r){return r=r==null?as:Math.pow(as,r),new Bo(this.r*r,this.g*r,this.b*r,this.opacity)},darker:function(r){return r=r==null?Bc:Math.pow(Bc,r),new Bo(this.r*r,this.g*r,this.b*r,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Fl,formatHex:Fl,formatRgb:fc,toString:fc}));function Fl(){return"#"+cl(this.r)+cl(this.g)+cl(this.b)}function fc(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function cl(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function Bl(e,r,t,n){return n<=0?e=r=t=NaN:t<=0||t>=1?e=r=NaN:r<=0&&(e=NaN),new Ro(e,r,t,n)}function rh(e){if(e instanceof Ro)return new Ro(e.h,e.s,e.l,e.opacity);if(e instanceof cc||(e=Ks(e)),!e)return new Ro;if(e instanceof Ro)return e;e=e.rgb();var r=e.r/255,t=e.g/255,n=e.b/255,i=Math.min(r,t,n),a=Math.max(r,t,n),o=NaN,l=a-i,c=(a+i)/2;return l?(r===a?o=(t-n)/l+(t<n)*6:t===a?o=(n-r)/l+2:o=(r-t)/l+4,l/=c<.5?a+i:2-a-i,o*=60):l=c>0&&c<1?0:o,new Ro(o,l,c,e.opacity)}function hc(e,r,t,n){return arguments.length===1?rh(e):new Ro(e,r,t,n==null?1:n)}function Ro(e,r,t,n){this.h=+e,this.s=+r,this.l=+t,this.opacity=+n}yf(Ro,hc,oo(cc,{brighter:function(r){return r=r==null?as:Math.pow(as,r),new Ro(this.h,this.s,this.l*r,this.opacity)},darker:function(r){return r=r==null?Bc:Math.pow(Bc,r),new Ro(this.h,this.s,this.l*r,this.opacity)},rgb:function(){var r=this.h%360+(this.h<0)*360,t=isNaN(r)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,a=2*n-i;return new Bo(bf(r>=240?r-240:r+120,a,i),bf(r,a,i),bf(r<120?r+240:r-120,a,i),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var r=this.opacity;return r=isNaN(r)?1:Math.max(0,Math.min(1,r)),(r===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(r===1?")":", "+r+")")}}));function bf(e,r,t){return(e<60?r+(t-r)*e/60:e<180?t:e<240?r+(t-r)*(240-e)/60:r)*255}function xp(e){return typeof e=="string"?!!Ks(e):!1}function oa(e){var r=Ks(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function qs(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function os(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function Ll(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],o=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var c=(e.positions[l]-a)/(o-a);i.addColorStop(c,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function xf(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],o=0;o<e.colors.length;++o){var l=Math.max((e.positions[o]-r[0])/a,0);i.addColorStop(l,e.colors[o])}n.fillStyle=i,n.fillRect(0,0,256,1);var c=n.getImageData(0,0,256,1).data,h=Ef(n,c);return t=null,n=null,h}function Nl(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var o=oa(e.colors[a]);n.data[i*4+0]=o[0]*255,n.data[i*4+1]=o[1]*255,n.data[i*4+2]=o[2]*255,n.data[i*4+3]=o[3]*255}),r=null,t=null,n}function md(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,o=Ef(t,a);return r=null,t=null,o}function nh(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!=1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var o=n.getImageData(0,0,256,1).data,l=Ef(n,o);return t=null,n=null,l}function Ef(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function Uc(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var jl={BACK:1029,FRONT:1028};function pc(e){switch(e){case"GAODE1.x":return jl.BACK;case"GAODE2.x":return jl.BACK;case"MAPBOX":return jl.FRONT;case"SIMPLE":return jl.FRONT;case"GLOBEL":return jl.BACK;case"DEBAULT":return jl.FRONT;default:return jl.FRONT}}var cr=O("KQm4"),Bn=O("ODXe"),jh=O("9nhX"),dc=O.n(jh),zh=O("BkRI"),zl=O.n(zh),ja=O("sEfC"),ih=O.n(ja),Yu=O("mwIZ"),Ul=O.n(Yu),ra=O("Znm+"),za=O.n(ra),cu=O("Y+p1"),Sf=O.n(cu),Vc=O("J2iB"),Af=O.n(Vc),Ep=O("UB5X"),ah=O.n(Ep),Tf=O("YO3V"),Vl=O.n(Tf),Lo=O("4qC0"),to=O.n(Lo),Hc=O("c6wG"),Uh=O.n(Hc),bo=O("QkVN"),kn=O.n(bo),js=O("JBE3"),Cf=O.n(js),Wc=O("hzCD"),Cs=O.n(Wc),Oa=O("DzJC"),oh=O.n(Oa),vn=O("7tbW"),fl=O.n(vn),wf=O("gQMU"),sh=O.n(wf),yu=O("lSCD"),Qs=O.n(yu),uh=O("GoyQ"),lh=O.n(uh),ws=O("TP7S"),Ku=O.n(ws),Sp=O("u6S6"),Gc=O.n(Sp),xi={isNil:Af.a,merge:kn.a,throttle:oh.a,isString:to.a,debounce:ih.a,pull:Cs.a,isTypedArray:Uh.a,isPlainObject:Vl.a,isNumber:ah.a,isBoolean:za.a,isEqual:Sf.a,cloneDeep:zl.a,uniq:fl.a,clamp:dc.a,upperFirst:sh.a,get:Ul.a,mergeWith:Cf.a,isFunction:Qs.a,isObject:lh.a,isUndefined:Ku.a,camelCase:Gc.a},Vh=xi.pull;function Js(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function zs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Oi(e){return zs(e).split(/\s+/)}function fu(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function hu(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Yo(e){var r=e.parentNode;r&&r.removeChild(e)}function Hl(e,r){if(e.classList!==void 0)for(var t=Oi(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!pu(e,r)){var a=pl(e);Ko(e,(a?a+" ":"")+r)}}function hl(e,r){if(e.classList!==void 0){var t=Oi(r);t.forEach(function(n){e.classList.remove(n)})}else Ko(e,zs((" "+pl(e)+" ").replace(" "+r+" "," ")))}function pu(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=pl(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function Ko(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function pl(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function ti(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var jn=fu(["transform","WebkitTransform"]);function eu(e,r){e.style[jn]=r}function bs(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function Ru(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function $a(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),o=Object(Bn.a)(a,1),l=o[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var _u=$a()<1?1:window.devicePixelRatio;function dl(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function vl(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function pa(e,r){var t,n=vl((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=vl(r),a=Vh.apply(void 0,[n].concat(Object(cr.a)(i)));e.setAttribute("style",a.join(";"))}function No(e){return Object.entries(e).map(function(r){var t=Object(Bn.a)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function Hh(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function Wl(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function ch(e){e.innerHTML=""}function ml(e){e.setAttribute("draggable","false")}function tu(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,Object(cr.a)(r)):e.append(r)}function Xc(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(o){var l;return(l=n)===null||l===void 0?void 0:l.matches(o)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var bu;function fh(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function Zc(){return typeof importScripts=="function"}var hh=Zc()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},vc=(bu=navigator)===null||bu===void 0?void 0:bu.userAgent,$c=!!vc.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),Yc=vc.indexOf("Android")>-1||vc.indexOf("Adr")>-1;function Wh(){for(var e=vc,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}var L=O("rePB");function xu(e,r){e.forEach(function(t){!r[t]||(r[t]=r[t].bind(r))})}var Gh=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;Object(Et.a)(this,e),Object(L.a)(this,"duration",16),Object(L.a)(this,"timestamp",new Date().getTime()),this.duration=r}return Object(Rt.a)(e,[{key:"run",value:function(t){var n=new Date().getTime(),i=n-this.timestamp;this.timestamp=n,i>=this.duration&&t()}}]),e}();function qu(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return ji(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}qu.default=qu;var Eu=qu;function Of(e){return typeof e=="number"}var Gl=2*Math.PI*6378137/2;function ph(e,r){var t=Object(Bn.a)(r,4),n=t[0],i=t[1],a=t[2],o=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=o}function dh(e){var r=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(t){var n=t.coordinates;m(r,n)}),r}function m(e,r){return Array.isArray(r[0])?r.forEach(function(t){m(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function d(e,r){return p(e,r)}function p(e,r){return Array.isArray(e[0])?e.map(function(t){return p(t,r)}):r(e)}function y(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=k(e,r);var n=e[0],i=e[1],a=n*Gl/180,o=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return o=o*Gl/180,t.enable&&(a=Number(a.toFixed(t.decimal)),o=Number(o.toFixed(t.decimal))),e.length===3?[a,o,e[2]]:[a,o]}function A(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/Gl*180,a=n/Gl*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function w(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function M(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function k(e,r){if(r===!1)return e;var t=w(e[0]),n=M(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function G(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,o=t*i;o=Math.log(Math.tan(Math.PI/4+o/2));var l=.5/Math.PI,c=.5,h=-.5/Math.PI;return i=.5,a=n*(l*a+c),o=n*(h*o+i),[Math.floor(a),Math.floor(o)]}function q(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,o=Object(Bn.a)(e,2),l=o[0],c=o[1];l=(l/a-t)/r,c=(c/a-i)/n,c=(Math.atan(Math.pow(Math.E,c))-Math.PI/4)*2,i=Math.PI/180;var h=c/i,_=l/i;return[_,h]}function pe(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function ye(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function be(e,r,t){var n=ao(r[1]-e[1]),i=ao(r[0]-e[0]),a=ao(e[1]),o=ao(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(o);return wo(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function qe(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),o=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[o,l]}function Ue(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function ht(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function We(e){return[[e[0],e[1]],[e[2],e[3]]]}function nt(e){var r=Mt(e,[0,0]);return[e[0]/r,e[1]/r]}function Mt(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Pt(e,r){return e[0]*r[0]+e[1]*r[1]}function vr(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function rr(e,r){return Math.acos(Pt(e,r)/(vr(e)*vr(r)))*180/Math.PI}function br(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function wr(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var o=e[a],l=e[a+1],c=Mt(o,l);n+=c;var h=[o[0]-l[0],o[1]-l[1]],_=br(t,h);if(a>0){var x=i[a-1].rotation;x-_>360-x+_&&(_=_+360)}i.push({start:o,end:l,dis:c,rotation:_,duration:0})}return i.map(function(E){E.duration=r*(E.dis/n)}),i}}function $r(e){if(Of(e[0]))return e;if(Of(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Of(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(o){t+=o[0],n+=o[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Qr(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,o=0,l=0,c=0;c<e.length;c+=2){var h=e[c],_=e[c+1];h&&_&&(r=Math.max(h,r),t=Math.max(_,t),n=Math.min(h,n),i=Math.min(_,i),a+=h,o+=_,l++)}return{center:[a/l,o/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function _n(e){return Eu(gi([Hi(e)]))}function Ln(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function si(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function hi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var Wi=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Qi(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,l=t;return o&&(l=Math.round(t*(a-1))/(a-1)),n?Xn(e,r,l,n,i):Xn(e,r,l,.314,i)}function An(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function Ri(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Pi(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=Ri(n,[0,0]),a=Math.atan2(n[1],n[0]),o=i/2/Math.cos(t),l=a+t,c=[o*Math.cos(l)+e[0],o*Math.sin(l)+e[1]];return c}function Xn(e,r,t,n,i){if(i===Wi["GAODE2.x"]){var a=pe(e[0],e[1]),o=pe(r[0],r[1]),l=Pi(a,o,n),c=[a[0],l[0],o[0]],h=[a[1],l[1],o[1]];return[].concat(Object(cr.a)(ye(An(c,t),An(h,t))),[0])}else{var _=Pi(e,r,n),x=[e[0],_[0],r[0]],E=[e[1],_[1],r[1]];return[An(x,t),An(E,t),0]}}function Ii(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,o=arguments.length>6?arguments[6]:void 0,l=t;return o&&(l=Math.round(t*29)/29),Ao(e,r,l,i)}function ui(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=Mt(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,o=n/2/Math.cos(a),l=i+a,c=[o*Math.cos(l)+e[0],o*Math.sin(l)+e[1]];return c}function zi(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function Ji(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Ao(e,r,t,n){var i=[ao(e[0]),ao(e[1])],a=[ao(r[0]),ao(r[1])];if(n==="GAODE2.x"){var o=ui(i,a),l=[i[0],o[0],a[0]],c=[i[1],o[1],a[1]];return[zi(l,t),zi(c,t),0]}else{var h=Ji(i,a);if(Math.abs(h-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var _=Math.sin((1-t)*h)/Math.sin(h),x=Math.sin(t*h)/Math.sin(h),E=[Math.sin(i[0]),Math.sin(i[1])],C=[Math.cos(i[0]),Math.cos(i[1])],I=[Math.sin(a[0]),Math.sin(a[1])],P=[Math.cos(a[0]),Math.cos(a[1])],B=_*C[1]*C[0]+x*P[1]*P[0],U=_*C[1]*E[0]+x*P[1]*I[0],ee=_*E[1]+x*I[1];return[Na(Math.atan2(U,B)),Na(Math.atan2(ee,Math.sqrt(B*B+U*U)))]}}function so(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],o=e[i+1],l=Ya(a,o),c=t;t+=l,n.push({p1:a,p2:o,totalDistance:t,distance:l,lastTotalDistance:c})}for(var h=t*r,_,x,E=0,C=n;E<C.length;E++){var I=C[E],P=I.totalDistance;if(P>h){var B=I.p1,U=I.p2,ee=(h-I.lastTotalDistance)/I.distance,ie=Mo(U,B,ee);_=ie[0],x=ie[1];break}}return{lng:_,lat:x,height:0}}function Mo(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function Ya(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Ka(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=ss(i,r);return Object(we.a)(Object(we.a)({},i),a)})}function ru(e,r){return new Promise(function(t){e.inited?t(Ka(e,r)):e.once("update",function(){t(Ka(e,r))})})}function ss(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,o=r.segmentNumber,l=o===void 0?30:o,c=r.autoFit,h=c===void 0?!0:c,_=e.coordinates;if(n==="line")return so(_,t);var x=_[0],E=_[1],C=typeof i=="string"?e[i]||0:i,I;switch(n){case"arc":I=Qi;break;case"greatcircle":I=Ii;break;default:I=Qi}var P=I(x,E,t,C,a,l,h),B=Object(Bn.a)(P,3),U=B[0],ee=B[1],ie=B[2];return{lng:U,lat:ee,height:ie}}var Qu=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;Object(Et.a)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return Object(Rt.a)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Mu(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function us(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function xs(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function Xl(e){if(e.length===0)throw new Error("mean requires at least one data point");return xs(e)/e.length}function Kc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Su={min:us,max:Mu,mean:Xl,sum:xs,mode:Kc};function Zl(e,r){return e.map(function(t){return t[r]})}function Ju(e,r){return Su[e](r)}var Xt=O("HaE+"),De=O("JX7q"),ls=O("o0o1"),he=O.n(ls);function Us(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var o=[t,n],l=[t,a],c=[i,a],h=[i,n];return wi([[o,h,c,l,o]],r.properties,{bbox:e,id:r.id})}var uo=O("uhBA"),nu=O.n(uo),qa=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),Da=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),xo=0,cs=1,jo=2;function Pu(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function Xh(e){e.forEach(function(r){r.properties.state=xo}),e.forEach(function(r){r.isCurrent&&!$l(r)&&du(r)}),e.forEach(function(r){r.isVisible=Boolean(r.properties.state&jo)})}function vh(e){e.forEach(function(t){t.properties.state=xo}),e.forEach(function(t){t.isCurrent&&$l(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=Boolean(t.properties.state&jo),t.children.length&&(t.isVisible||t.properties.state&cs)?t.children.forEach(function(n){n.properties.state=cs}):t.isCurrent&&du(t)})}function $l(e){for(;e;){if(e.isLoaded)return e.properties.state|=jo,!0;e=e.parent}return!1}function du(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=jo:du(r)})}var qc,Rf=256,Iu=[-Infinity,-Infinity,Infinity,Infinity],Vs=.2,yv=5,_v=(qc={},Object(L.a)(qc,qa.Realtime,Pu),Object(L.a)(qc,qa.Overlap,Xh),Object(L.a)(qc,qa.Replace,vh),qc),mh=function(){};function gd(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function bv(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var xv=function(r,t,n){var i=bv(r,t,n),a=Object(Bn.a)(i,2),o=a[0],l=a[1],c=bv(r+1,t+1,n),h=Object(Bn.a)(c,2),_=h[0],x=h[1];return[o,x,_,l]};function Ap(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?Infinity:n,a=e.minZoom,o=a===void 0?0:a,l=e.zoomOffset,c=l===void 0?0:l,h=e.extent,_=h===void 0?Iu:h,x=Math.ceil(r)+c;if(Number.isFinite(o)&&x<o)return[];Number.isFinite(i)&&x>i&&(x=i);for(var E=Object(Bn.a)(t,4),C=E[0],I=E[1],P=E[2],B=E[3],U=[Math.max(C,_[0]),Math.max(I,_[1]),Math.min(P,_[2]),Math.min(B,_[3])],ee=[],ie=gd(U[0],U[1],x),_e=Object(Bn.a)(ie,2),Oe=_e[0],ke=_e[1],Ke=gd(U[2],U[3],x),ot=Object(Bn.a)(Ke,2),Ot=ot[0],Zt=ot[1],ir=Oe;ir<=Ot;ir++)for(var Hr=Zt;Hr<=ke;Hr++)ee.push({x:ir,y:Hr,z:x});var ln=(Ot+Oe)/2,pn=(ke+Zt)/2,Ci=function(Sa,La){return Math.abs(Sa-ln)+Math.abs(La-pn)};return ee.sort(function(Ba,Sa){return Ci(Ba.x,Ba.y)-Ci(Sa.x,Sa.y)}),ee}var jm=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),o=a-1,l=a,c=r,h=t;return i&&(c<0?c=c+l:c>o&&(c=c%l)),{warpX:c,warpY:h}};function Tp(e){var r=Ev();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function Ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qc=function(e){Object(qr.a)(t,e);var r=Tp(t);function t(n){var i;Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"tileSize",256),Object(L.a)(Object(De.a)(i),"isVisible",!1),Object(L.a)(Object(De.a)(i),"isCurrent",!1),Object(L.a)(Object(De.a)(i),"isVisibleChange",!1),Object(L.a)(Object(De.a)(i),"loadedLayers",0),Object(L.a)(Object(De.a)(i),"isLayerLoaded",!1),Object(L.a)(Object(De.a)(i),"isLoad",!1),Object(L.a)(Object(De.a)(i),"isChildLoad",!1),Object(L.a)(Object(De.a)(i),"parent",null),Object(L.a)(Object(De.a)(i),"children",[]),Object(L.a)(Object(De.a)(i),"data",null),Object(L.a)(Object(De.a)(i),"properties",{}),Object(L.a)(Object(De.a)(i),"loadDataId",0);var a=n.x,o=n.y,l=n.z,c=n.tileSize,h=n.warp,_=h===void 0?!0:h;return i.x=a,i.y=o,i.z=l,i.warp=_||!0,i.tileSize=c,i}return Object(Rt.a)(t,[{key:"isLoading",get:function(){return this.loadStatus===Da.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Da.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Da.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Da.Cancelled}},{key:"isDone",get:function(){return[Da.Loaded,Da.Cancelled,Da.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return xv(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=Object(Bn.a)(this.bounds,4),a=i[0],o=i[1],l=i[2],c=i[3],h=[(l-a)/2,(c-o)/2],_=Us(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:h,meta:`
      `.concat(this.key,`
      `)}});return _}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l,c,h,_,x,E,C,I,P,B,U,ee,ie,_e,Oe,ke,Ke;return he.a.wrap(function(Ot){for(;;)switch(Ot.prev=Ot.next){case 0:return l=o.getData,c=o.onLoad,h=o.onError,this.loadDataId++,_=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Da.Loading,x=null,Ot.prev=7,C=this.x,I=this.y,P=this.z,B=this.bounds,U=this.tileSize,ee=this.warp,ie=jm(C,I,P,ee),_e=ie.warpX,Oe=ie.warpY,ke=this.abortController.signal,Ke={x:_e,y:Oe,z:P,bounds:B,tileSize:U,signal:ke,warp:ee},Ot.next=14,l(Ke,this);case 14:x=Ot.sent,Ot.next=20;break;case 17:Ot.prev=17,Ot.t0=Ot.catch(7),E=Ot.t0;case 20:if(_===this.loadDataId){Ot.next=22;break}return Ot.abrupt("return");case 22:if(!(this.isCancelled&&!x)){Ot.next=24;break}return Ot.abrupt("return");case 24:if(!(E||!x)){Ot.next=28;break}return this.loadStatus=Da.Failure,h(E,this),Ot.abrupt("return");case 28:this.loadStatus=Da.Loaded,this.data=x,c(this);case 31:case"end":return Ot.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Da.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(uo.EventEmitter),Zh=function(r,t){var n=We(r),i=Ue(n,t),a=360*3-180,o=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-o),Math.min(i[1][0],a),Math.min(i[1][1],o)];return l},zm=function(r,t){var n=We(r),i=We(t),a=ht(n,i);return a};function Jc(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Um(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function Um(e,r){if(!!e){if(typeof e=="string")return Sv(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Sv(e,r)}}function Sv(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Vm(e){var r=yd();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function yd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cp=xi.throttle,gl=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),wp=function(e){Object(qr.a)(t,e);var r=Vm(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"currentTiles",[]),Object(L.a)(Object(De.a)(i),"cacheTiles",new Map),Object(L.a)(Object(De.a)(i),"throttleUpdate",Cp(function(a,o){i.update(a,o)},16)),Object(L.a)(Object(De.a)(i),"onTileLoad",function(a){i.emit(gl.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),Object(L.a)(Object(De.a)(i),"onTileError",function(a,o){i.emit(gl.TileError,{error:a,tile:o}),i.updateTileVisible(),i.loadFinished()}),Object(L.a)(Object(De.a)(i),"onTileUnload",function(a){i.emit(gl.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,extent:Iu,getTileData:mh,warp:!0,updateStrategy:qa.Replace},i.updateOptions(n),i}return Object(Rt.a)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,o){return a.z-o.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),o=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=Object(we.a)(Object(we.a)(Object(we.a)({},this.options),i),{},{minZoom:a,maxZoom:o})}},{key:"update",value:function(i,a){var o=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&zm(this.lastViewStates.latLonBoundsBuffer,a))){var c=Zh(a,Vs);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:c},this.currentZoom=l;var h=!1,_=this.getTileIndices(l,c).filter(function(x){return o.options.warp||x.x>=0&&x.x<Math.pow(2,l)});this.emit(gl.TilesLoadStart),this.currentTiles=_.map(function(x){var E=x.x,C=x.y,I=x.z,P=o.getTile(E,C,I);if(P){var B,U,ee=((B=P)===null||B===void 0?void 0:B.isFailure)||((U=P)===null||U===void 0?void 0:U.isCancelled);return ee&&P.loadData({getData:o.options.getTileData,onLoad:o.onTileLoad,onError:o.onTileError}),P}return P=o.createTile(E,C,I),h=!0,P}),h&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=Jc(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var o=Object(Bn.a)(a.value,2),l=o[0],c=o[1];if(!this.currentTiles.includes(c)){this.cacheTiles.delete(l),this.onTileUnload(c);return}this.onTileUnload(c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(h){i.e(h)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,o){var l=this.cacheTiles.get("".concat(a,",").concat(o,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,o){var l=this.getTileByLngLat(i,a,o);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var o=this,l=this.getTileIndices(a,i);l.forEach(function(c){o.reloadTileById(c.z,c.x,c.y)})}},{key:"pruneRequests",value:function(){var i=[],a=Jc(this.cacheTiles.values()),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(h){a.e(h)}finally{a.f()}for(;i.length>0;){var c=i.shift();c.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,o){var l=this.options.zoomOffset,c=Math.ceil(o)+l,h=gd(i,a,c),_=this.tiles.filter(function(x){return x.key==="".concat(h[0],"_").concat(h[1],"_").concat(c)});return _[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,o){var l=this.tiles.filter(function(c){return c.key==="".concat(a,"_").concat(o,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=Jc(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.isLoading?o.abortLoad():this.onTileUnload(o)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,o=Jc(this.cacheTiles.values()),l;try{for(o.s();!(l=o.n()).done;){var c=l.value;a.set(c.key,c.isVisible),c.isCurrent=!1,c.isVisible=!1}}catch(I){o.e(I)}finally{o.f()}var h=Jc(this.currentTiles),_;try{for(h.s();!(_=h.n()).done;){var x=_.value;x.isCurrent=!0,x.isVisible=!0}}catch(I){h.e(I)}finally{h.f()}var E=Array.from(this.cacheTiles.values());typeof i=="function"?i(E):_v[i](E);var C=!1;Array.from(this.cacheTiles.values()).forEach(function(I){I.isVisible!==a.get(I.key)?(I.isVisibleChange=!0,C=!0):I.isVisibleChange=!1}),C&&this.emit(gl.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var o=this.options,l=o.tileSize,c=o.extent,h=o.zoomOffset,_=Math.floor(this.options.maxZoom),x=Math.ceil(this.options.minZoom),E=Ap({maxZoom:_,minZoom:x,zoomOffset:h,tileSize:l,zoom:i,latLonBounds:a,extent:c});return E}},{key:"getTileId",value:function(i,a,o){var l="".concat(i,",").concat(a,",").concat(o);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(gl.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=this.cacheTiles.get(l);return c}},{key:"createTile",value:function(i,a,o){var l=this.getTileId(i,a,o),c=new Qc({x:i,y:a,z:o,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,c),c.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),c}},{key:"resizeCacheTiles",value:function(){var i=yv*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var o=Jc(this.cacheTiles),l;try{for(o.s();!(l=o.n()).done;){var c=Object(Bn.a)(l.value,2),h=c[0],_=c[1];if(!_.isVisible&&!this.currentTiles.includes(_)&&(this.cacheTiles.delete(h),this.onTileUnload(_)),this.cacheTiles.size<=i)break}}catch(x){o.e(x)}finally{o.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=Jc(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;o.parent=null,o.children.length=0}}catch(x){i.e(x)}finally{i.f()}var l=Jc(this.cacheTiles.values()),c;try{for(l.s();!(c=l.n()).done;){var h=c.value,_=this.getNearestAncestor(h.x,h.y,h.z);h.parent=_,_!=null&&_.children&&_.children.push(h)}}catch(x){l.e(x)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,o){for(;o>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),o=o-1;var l=this.getTile(i,a,o);if(l)return l}return null}}]),t}(nu.a);function Mf(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function Op(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var o=parseInt(t[2],10),l=parseInt(t[1],10);l<=o;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function Ua(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=Op(e),o=Math.abs(t+n)%a.length,l=uc(a[o])?"".concat(a[o],"/{z}/{x}/{y}"):a[o];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,xv(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function Pf(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,o=r.version,l=o===void 0?"1.0.0":o,c=r.style,h=c===void 0?"default":c,_=r.format,x=r.service,E=x===void 0?"WMTS":x,C=r.tileMatrixset,I="".concat(e,"&SERVICE=").concat(E,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(h,"&TILEMATRIXSET=").concat(C,"&FORMAT=").concat(_,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return I}function Yl(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var ku={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},gh=ku.self||ku.window||{},If=ku.window||ku.self||{},yh=ku.self||ku.window||{},$h=ku.document||{},yl=typeof importScripts=="function",kf=typeof window!="undefined"&&typeof window.orientation!="undefined",Df=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){Yl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){Yl(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),Av=Df,_l=new Map;function Ff(e){Yl(e.source&&!e.url||!e.source&&e.url);var r=_l.get(e.source||e.url);return r||(e.url&&(r=Rp(e.url),_l.set(e.url,r)),e.source&&(r=Mp(e.source),_l.set(e.source,r))),Yl(r),r}function Rp(e){if(!e.startsWith("http"))return e;var r=_d(e);return Mp(r)}function Mp(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function _d(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function Yh(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(el(e))n.add(e);else if(el(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)Yh(e[i],r,n)}}return t===void 0?Array.from(n):[]}function el(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var Kl=function(){},Tv=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;Yl(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=Kl,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=Kl,this.onError=Kl,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||Yh(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=Ff({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),bd=Tv,Kh=function(){return Kh=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Kh.apply(this,arguments)},xd=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{h(n.next(_))}catch(x){o(x)}}function c(_){try{h(n.throw(_))}catch(x){o(x)}}function h(_){_.done?a(_.value):i(_.value).then(l,c)}h((n=n.apply(e,r||[])).next())})},ef=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(h){return function(_){return c([h,_])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=r.call(e,t)}catch(_){h=[6,_],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Hm=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=Kh(Kh({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(a,o,l){return a.done(l)}),n===void 0&&(n=function(a,o){return a.error(o)}),xd(this,void 0,void 0,function(){var i,a=this;return ef(this,function(o){switch(o.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,o.sent()]}})})},e.prototype.startQueuedJob=function(){return xd(this,void 0,void 0,function(){var r,t,n;return ef(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new Av(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new bd({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return kf?this.maxMobileConcurrency:this.maxConcurrency},e}(),ql=Hm,Bf=function(){return Bf=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Bf.apply(this,arguments)},tf=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},rf={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Cv=function(){function e(r){this.workerPools=new Map,this.props=Bf({},rf),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return bd.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=tf(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(o){r={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=Bf(Bf({},this.props),r);try{for(var i=tf(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var o=a.value;o.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new ql({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),Ql=Cv,_h=new Map,Pp=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(t){self.onmessage=function(n){if(!!Es(n)){var i=n.data,a=i.type,o=i.payload;t(a,o)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=_h.get(r);t||(t=function(i){if(!!Es(i)){var a=i.data,o=a.type,l=a.payload;r(o,l)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=_h.get(r);_h.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=Yh(t);self.postMessage(n,i)}},e}(),Eo=Pp;function Es(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function zo(e){return JSON.parse(Au(e))}function Au(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function wv(e){return""+e.name}function qh(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),Yl(i),i}var Ed=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{h(n.next(_))}catch(x){o(x)}}function c(_){try{h(n.throw(_))}catch(x){o(x)}}function h(_){_.done?a(_.value):i(_.value).then(l,c)}h((n=n.apply(e,r||[])).next())})},Ov=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(h){return function(_){return c([h,_])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=r.call(e,t)}catch(_){h=[6,_],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}};function cy(e,r){return Ql.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function Wm(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Ed(this,void 0,void 0,function(){var i,a,o,l,c,h,_,x;return Ov(this,function(E){switch(E.label){case 0:return i=wv(e),a=qh(e,t),o=Ql.getWorkerFarm(t),l=o.getWorkerPool({name:i,url:a}),c=t.jobName||e.name,[4,l.startJob(c,Gm.bind(null,n))];case 1:return h=E.sent(),_=zo(t),h.postMessage("process",{input:r,options:_}),[4,h.result];case 2:return x=E.sent(),[2,x.result]}})})}function Gm(e,r,t,n){return Ed(this,void 0,void 0,function(){var i,a,o,l,c,h,_;return Ov(this,function(x){switch(x.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,o=n.input,l=n.options,x.label=4;case 4:return x.trys.push([4,6,,7]),e.process?[4,e.process(o,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return c=x.sent(),r.postMessage("done",{id:a,result:c}),[3,7];case 6:return h=x.sent(),_=h instanceof Error?h.message:"unknown error",r.postMessage("error",{id:a,error:_}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),x.label=9;case 9:return[2]}})})}var Rv=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),Hs=Rv,Xm=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{h(n.next(_))}catch(x){o(x)}}function c(_){try{h(n.throw(_))}catch(x){o(x)}}function h(_){_.done?a(_.value):i(_.value).then(l,c)}h((n=n.apply(e,r||[])).next())})},Mv=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(h){return function(_){return c([h,_])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=r.call(e,t)}catch(_){h=[6,_],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},Sd=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(o){return new Promise(function(l,c){o=e[a](o),i(l,c,o.done,o.value)})}}function i(a,o,l,c){Promise.resolve(c).then(function(h){a({value:h,done:l})},o)}},Pv=0,bh,Iv;function fy(e,r){var t=this;if(typeof self!="undefined"){var n={process:kv};Eo.onmessage=function(i,a){return Xm(t,void 0,void 0,function(){var o,l,c,h,_,x,E,C,I,P,B;return Mv(this,function(U){switch(U.label){case 0:switch(U.trys.push([0,19,,20]),o=i,o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=U.sent(),Eo.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");bh=new Hs,Iv=a.options||{},c=r(bh,Iv,n),U.label=4;case 4:U.trys.push([4,9,10,15]),h=Sd(c),U.label=5;case 5:return[4,h.next()];case 6:if(_=U.sent(),!!_.done)return[3,8];x=_.value,Eo.postMessage("output-batch",{result:x}),U.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return E=U.sent(),P={error:E},[3,15];case 10:return U.trys.push([10,,13,14]),_&&!_.done&&(B=h.return)?[4,B.call(h)]:[3,12];case 11:U.sent(),U.label=12;case 12:return[3,14];case 13:if(P)throw P.error;return[7];case 14:return[7];case 15:return Eo.postMessage("done",{}),[3,18];case 16:return bh.push(a.input),[3,18];case 17:return bh.close(),[3,18];case 18:return[3,20];case 19:return C=U.sent(),I=C instanceof Error?C.message:"",Eo.postMessage("error",{error:I}),[3,20];case 20:return[2]}})})}}}function kv(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Pv++,a=function l(c,h){if(h.id===i)switch(c){case"done":Eo.removeEventListener(l),t(h.result);break;case"error":Eo.removeEventListener(l),n(h.error);break;default:}};Eo.addEventListener(a);var o={id:i,input:e,options:r};Eo.postMessage("process",o)})}var Ad=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(o){o(a)})}return new(t||(t=Promise))(function(a,o){function l(_){try{h(n.next(_))}catch(x){o(x)}}function c(_){try{h(n.throw(_))}catch(x){o(x)}}function h(_){_.done?a(_.value):i(_.value).then(l,c)}h((n=n.apply(e,r||[])).next())})},Y=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(h){return function(_){return c([h,_])}}function c(h){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=h[0]&2?i.return:h[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,h[1])).done)return a;switch(i=0,a&&(h=[h[0]&2,a.value]),h[0]){case 0:case 1:a=h;break;case 4:return t.label++,{value:h[1],done:!1};case 5:t.label++,i=h[1],h=[0];continue;case 7:h=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(h[0]===6||h[0]===2)){t=0;continue}if(h[0]===3&&(!a||h[1]>a[0]&&h[1]<a[3])){t.label=h[1];break}if(h[0]===6&&t.label<a[1]){t.label=a[1],a=h;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(h);break}a[2]&&t.ops.pop(),t.trys.pop();continue}h=r.call(e,t)}catch(_){h=[6,_],i=0}finally{n=a=0}if(h[0]&5)throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}},ce={};function it(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),Ad(this,void 0,void 0,function(){return Y(this,function(n){switch(n.label){case 0:return r&&(e=tr(e,r,t)),ce[e]=ce[e]||Ar(e),[4,ce[e]];case 1:return[2,n.sent()]}})})}function tr(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(Yl(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):yl?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function Ar(e){return Ad(this,void 0,void 0,function(){var r,t,n;return Y(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return yl?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,yr(n,e)]}})})}function yr(e,r){if(yl)return eval.call(yh,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Lt="0.0.3",Gr={id:"null",name:"null",module:"web-worker-helper",options:{}};function Jr(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function nn(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function tn(e){var r=e.filter;return r?[1]:[0]}function an(e,r){return[r]}var yn=O("VmRL"),Yr=O.n(yn),xr=1e-6,jt=typeof Float32Array!="undefined"?Float32Array:Array,$t=Math.random;function en(e){jt=e}var Tn=Math.PI/180;function Er(e){return e*Tn}function Jn(e,r){return Math.abs(e-r)<=xr*Math.max(1,Math.abs(e),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function Ur(){var e=new jt(4);return jt!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function cn(e){var r=new jt(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function Lr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function hn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function Qn(e,r,t,n){var i=new jt(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Ai(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function mn(e,r){if(e===r){var t=r[1];e[1]=r[2],e[2]=t}else e[0]=r[0],e[1]=r[2],e[2]=r[1],e[3]=r[3];return e}function Kr(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t*a-i*n;return o?(o=1/o,e[0]=a*o,e[1]=-n*o,e[2]=-i*o,e[3]=t*o,e):null}function Pr(e,r){var t=r[0];return e[0]=r[3],e[1]=-r[1],e[2]=-r[2],e[3]=t,e}function ii(e){return e[0]*e[3]-e[2]*e[1]}function Xi(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=t[0],c=t[1],h=t[2],_=t[3];return e[0]=n*l+a*c,e[1]=i*l+o*c,e[2]=n*h+a*_,e[3]=i*h+o*_,e}function Cn(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=Math.sin(t),c=Math.cos(t);return e[0]=n*c+a*l,e[1]=i*c+o*l,e[2]=n*-l+a*c,e[3]=i*-l+o*c,e}function Ui(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=t[0],c=t[1];return e[0]=n*l,e[1]=i*l,e[2]=a*c,e[3]=o*c,e}function Ei(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=-t,e[3]=n,e}function pi(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=r[1],e}function ca(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Po(e){return Math.hypot(e[0],e[1],e[2],e[3])}function fs(e,r,t,n){return e[2]=n[2]/n[0],t[0]=n[0],t[1]=n[1],t[3]=n[3]-e[2]*t[1],[e,r,t]}function Yi(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function To(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function Ha(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Uo(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=r[0],l=r[1],c=r[2],h=r[3];return Math.abs(t-o)<=xr*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(n-l)<=xr*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=xr*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-h)<=xr*Math.max(1,Math.abs(a),Math.abs(h))}function Vo(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function fo(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}var qo=Xi,Os=To;function Ho(){var e=new jt(16);return jt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Gi(e){var r=new jt(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Ss(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function da(e,r,t,n,i,a,o,l,c,h,_,x,E,C,I,P){var B=new jt(16);return B[0]=e,B[1]=r,B[2]=t,B[3]=n,B[4]=i,B[5]=a,B[6]=o,B[7]=l,B[8]=c,B[9]=h,B[10]=_,B[11]=x,B[12]=E,B[13]=C,B[14]=I,B[15]=P,B}function di(e,r,t,n,i,a,o,l,c,h,_,x,E,C,I,P,B){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e[4]=a,e[5]=o,e[6]=l,e[7]=c,e[8]=h,e[9]=_,e[10]=x,e[11]=E,e[12]=C,e[13]=I,e[14]=P,e[15]=B,e}function Di(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ua(e,r){if(e===r){var t=r[1],n=r[2],i=r[3],a=r[6],o=r[7],l=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=a,e[11]=r[14],e[12]=i,e[13]=o,e[14]=l}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function hs(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],h=r[7],_=r[8],x=r[9],E=r[10],C=r[11],I=r[12],P=r[13],B=r[14],U=r[15],ee=t*l-n*o,ie=t*c-i*o,_e=t*h-a*o,Oe=n*c-i*l,ke=n*h-a*l,Ke=i*h-a*c,ot=_*P-x*I,Ot=_*B-E*I,Zt=_*U-C*I,ir=x*B-E*P,Hr=x*U-C*P,ln=E*U-C*B,pn=ee*ln-ie*Hr+_e*ir+Oe*Zt-ke*Ot+Ke*ot;return pn?(pn=1/pn,e[0]=(l*ln-c*Hr+h*ir)*pn,e[1]=(i*Hr-n*ln-a*ir)*pn,e[2]=(P*Ke-B*ke+U*Oe)*pn,e[3]=(E*ke-x*Ke-C*Oe)*pn,e[4]=(c*Zt-o*ln-h*Ot)*pn,e[5]=(t*ln-i*Zt+a*Ot)*pn,e[6]=(B*_e-I*Ke-U*ie)*pn,e[7]=(_*Ke-E*_e+C*ie)*pn,e[8]=(o*Hr-l*Zt+h*ot)*pn,e[9]=(n*Zt-t*Hr-a*ot)*pn,e[10]=(I*ke-P*_e+U*ee)*pn,e[11]=(x*_e-_*ke-C*ee)*pn,e[12]=(l*Ot-o*ir-c*ot)*pn,e[13]=(t*ir-n*Ot+i*ot)*pn,e[14]=(P*ie-I*Oe-B*ee)*pn,e[15]=(_*Oe-x*ie+E*ee)*pn,e):null}function iu(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=r[4],l=r[5],c=r[6],h=r[7],_=r[8],x=r[9],E=r[10],C=r[11],I=r[12],P=r[13],B=r[14],U=r[15];return e[0]=l*(E*U-C*B)-x*(c*U-h*B)+P*(c*C-h*E),e[1]=-(n*(E*U-C*B)-x*(i*U-a*B)+P*(i*C-a*E)),e[2]=n*(c*U-h*B)-l*(i*U-a*B)+P*(i*h-a*c),e[3]=-(n*(c*C-h*E)-l*(i*C-a*E)+x*(i*h-a*c)),e[4]=-(o*(E*U-C*B)-_*(c*U-h*B)+I*(c*C-h*E)),e[5]=t*(E*U-C*B)-_*(i*U-a*B)+I*(i*C-a*E),e[6]=-(t*(c*U-h*B)-o*(i*U-a*B)+I*(i*h-a*c)),e[7]=t*(c*C-h*E)-o*(i*C-a*E)+_*(i*h-a*c),e[8]=o*(x*U-C*P)-_*(l*U-h*P)+I*(l*C-h*x),e[9]=-(t*(x*U-C*P)-_*(n*U-a*P)+I*(n*C-a*x)),e[10]=t*(l*U-h*P)-o*(n*U-a*P)+I*(n*h-a*l),e[11]=-(t*(l*C-h*x)-o*(n*C-a*x)+_*(n*h-a*l)),e[12]=-(o*(x*B-E*P)-_*(l*B-c*P)+I*(l*E-c*x)),e[13]=t*(x*B-E*P)-_*(n*B-i*P)+I*(n*E-i*x),e[14]=-(t*(l*B-c*P)-o*(n*B-i*P)+I*(n*c-i*l)),e[15]=t*(l*E-c*x)-o*(n*E-i*x)+_*(n*c-i*l),e}function Ge(e){var r=e[0],t=e[1],n=e[2],i=e[3],a=e[4],o=e[5],l=e[6],c=e[7],h=e[8],_=e[9],x=e[10],E=e[11],C=e[12],I=e[13],P=e[14],B=e[15],U=r*o-t*a,ee=r*l-n*a,ie=r*c-i*a,_e=t*l-n*o,Oe=t*c-i*o,ke=n*c-i*l,Ke=h*I-_*C,ot=h*P-x*C,Ot=h*B-E*C,Zt=_*P-x*I,ir=_*B-E*I,Hr=x*B-E*P;return U*Hr-ee*ir+ie*Zt+_e*Ot-Oe*ot+ke*Ke}function lr(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=r[4],c=r[5],h=r[6],_=r[7],x=r[8],E=r[9],C=r[10],I=r[11],P=r[12],B=r[13],U=r[14],ee=r[15],ie=t[0],_e=t[1],Oe=t[2],ke=t[3];return e[0]=ie*n+_e*l+Oe*x+ke*P,e[1]=ie*i+_e*c+Oe*E+ke*B,e[2]=ie*a+_e*h+Oe*C+ke*U,e[3]=ie*o+_e*_+Oe*I+ke*ee,ie=t[4],_e=t[5],Oe=t[6],ke=t[7],e[4]=ie*n+_e*l+Oe*x+ke*P,e[5]=ie*i+_e*c+Oe*E+ke*B,e[6]=ie*a+_e*h+Oe*C+ke*U,e[7]=ie*o+_e*_+Oe*I+ke*ee,ie=t[8],_e=t[9],Oe=t[10],ke=t[11],e[8]=ie*n+_e*l+Oe*x+ke*P,e[9]=ie*i+_e*c+Oe*E+ke*B,e[10]=ie*a+_e*h+Oe*C+ke*U,e[11]=ie*o+_e*_+Oe*I+ke*ee,ie=t[12],_e=t[13],Oe=t[14],ke=t[15],e[12]=ie*n+_e*l+Oe*x+ke*P,e[13]=ie*i+_e*c+Oe*E+ke*B,e[14]=ie*a+_e*h+Oe*C+ke*U,e[15]=ie*o+_e*_+Oe*I+ke*ee,e}function Yt(e,r,t){var n=t[0],i=t[1],a=t[2],o,l,c,h,_,x,E,C,I,P,B,U;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*a+r[12],e[13]=r[1]*n+r[5]*i+r[9]*a+r[13],e[14]=r[2]*n+r[6]*i+r[10]*a+r[14],e[15]=r[3]*n+r[7]*i+r[11]*a+r[15]):(o=r[0],l=r[1],c=r[2],h=r[3],_=r[4],x=r[5],E=r[6],C=r[7],I=r[8],P=r[9],B=r[10],U=r[11],e[0]=o,e[1]=l,e[2]=c,e[3]=h,e[4]=_,e[5]=x,e[6]=E,e[7]=C,e[8]=I,e[9]=P,e[10]=B,e[11]=U,e[12]=o*n+_*i+I*a+r[12],e[13]=l*n+x*i+P*a+r[13],e[14]=c*n+E*i+B*a+r[14],e[15]=h*n+C*i+U*a+r[15]),e}function En(e,r,t){var n=t[0],i=t[1],a=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=r[11]*a,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Fi(e,r,t,n){var i=n[0],a=n[1],o=n[2],l=Math.hypot(i,a,o),c,h,_,x,E,C,I,P,B,U,ee,ie,_e,Oe,ke,Ke,ot,Ot,Zt,ir,Hr,ln,pn,Ci;return l<xr?null:(l=1/l,i*=l,a*=l,o*=l,c=Math.sin(t),h=Math.cos(t),_=1-h,x=r[0],E=r[1],C=r[2],I=r[3],P=r[4],B=r[5],U=r[6],ee=r[7],ie=r[8],_e=r[9],Oe=r[10],ke=r[11],Ke=i*i*_+h,ot=a*i*_+o*c,Ot=o*i*_-a*c,Zt=i*a*_-o*c,ir=a*a*_+h,Hr=o*a*_+i*c,ln=i*o*_+a*c,pn=a*o*_-i*c,Ci=o*o*_+h,e[0]=x*Ke+P*ot+ie*Ot,e[1]=E*Ke+B*ot+_e*Ot,e[2]=C*Ke+U*ot+Oe*Ot,e[3]=I*Ke+ee*ot+ke*Ot,e[4]=x*Zt+P*ir+ie*Hr,e[5]=E*Zt+B*ir+_e*Hr,e[6]=C*Zt+U*ir+Oe*Hr,e[7]=I*Zt+ee*ir+ke*Hr,e[8]=x*ln+P*pn+ie*Ci,e[9]=E*ln+B*pn+_e*Ci,e[10]=C*ln+U*pn+Oe*Ci,e[11]=I*ln+ee*pn+ke*Ci,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Ca(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[4],o=r[5],l=r[6],c=r[7],h=r[8],_=r[9],x=r[10],E=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=a*i+h*n,e[5]=o*i+_*n,e[6]=l*i+x*n,e[7]=c*i+E*n,e[8]=h*i-a*n,e[9]=_*i-o*n,e[10]=x*i-l*n,e[11]=E*i-c*n,e}function de(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],h=r[8],_=r[9],x=r[10],E=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i-h*n,e[1]=o*i-_*n,e[2]=l*i-x*n,e[3]=c*i-E*n,e[8]=a*n+h*i,e[9]=o*n+_*i,e[10]=l*n+x*i,e[11]=c*n+E*i,e}function Ie(e,r,t){var n=Math.sin(t),i=Math.cos(t),a=r[0],o=r[1],l=r[2],c=r[3],h=r[4],_=r[5],x=r[6],E=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=a*i+h*n,e[1]=o*i+_*n,e[2]=l*i+x*n,e[3]=c*i+E*n,e[4]=h*i-a*n,e[5]=_*i-o*n,e[6]=x*i-l*n,e[7]=E*i-c*n,e}function rt(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function nr(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qt(e,r,t){var n=t[0],i=t[1],a=t[2],o=Math.hypot(n,i,a),l,c,h;return o<xr?null:(o=1/o,n*=o,i*=o,a*=o,l=Math.sin(r),c=Math.cos(r),h=1-c,e[0]=n*n*h+c,e[1]=i*n*h+a*l,e[2]=a*n*h-i*l,e[3]=0,e[4]=n*i*h-a*l,e[5]=i*i*h+c,e[6]=a*i*h+n*l,e[7]=0,e[8]=n*a*h+i*l,e[9]=i*a*h-n*l,e[10]=a*a*h+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function dt(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function bt(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Tt(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ve(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3],l=n+n,c=i+i,h=a+a,_=n*l,x=n*c,E=n*h,C=i*c,I=i*h,P=a*h,B=o*l,U=o*c,ee=o*h;return e[0]=1-(C+P),e[1]=x+ee,e[2]=E-U,e[3]=0,e[4]=x-ee,e[5]=1-(_+P),e[6]=I+B,e[7]=0,e[8]=E+U,e[9]=I-B,e[10]=1-(_+C),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function yt(e,r){var t=new jt(3),n=-r[0],i=-r[1],a=-r[2],o=r[3],l=r[4],c=r[5],h=r[6],_=r[7],x=n*n+i*i+a*a+o*o;return x>0?(t[0]=(l*o+_*n+c*a-h*i)*2/x,t[1]=(c*o+_*i+h*n-l*a)*2/x,t[2]=(h*o+_*a+l*i-c*n)*2/x):(t[0]=(l*o+_*n+c*a-h*i)*2,t[1]=(c*o+_*i+h*n-l*a)*2,t[2]=(h*o+_*a+l*i-c*n)*2),Ve(e,r,t),e}function Me(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function _t(e,r){var t=r[0],n=r[1],i=r[2],a=r[4],o=r[5],l=r[6],c=r[8],h=r[9],_=r[10];return e[0]=Math.hypot(t,n,i),e[1]=Math.hypot(a,o,l),e[2]=Math.hypot(c,h,_),e}function hr(e,r){var t=new jt(3);_t(t,r);var n=1/t[0],i=1/t[1],a=1/t[2],o=r[0]*n,l=r[1]*i,c=r[2]*a,h=r[4]*n,_=r[5]*i,x=r[6]*a,E=r[8]*n,C=r[9]*i,I=r[10]*a,P=o+_+I,B=0;return P>0?(B=Math.sqrt(P+1)*2,e[3]=.25*B,e[0]=(x-C)/B,e[1]=(E-c)/B,e[2]=(l-h)/B):o>_&&o>I?(B=Math.sqrt(1+o-_-I)*2,e[3]=(x-C)/B,e[0]=.25*B,e[1]=(l+h)/B,e[2]=(E+c)/B):_>I?(B=Math.sqrt(1+_-o-I)*2,e[3]=(E-c)/B,e[0]=(l+h)/B,e[1]=.25*B,e[2]=(x+C)/B):(B=Math.sqrt(1+I-o-_)*2,e[3]=(l-h)/B,e[0]=(E+c)/B,e[1]=(x+C)/B,e[2]=.25*B),e}function mr(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=r[3],c=i+i,h=a+a,_=o+o,x=i*c,E=i*h,C=i*_,I=a*h,P=a*_,B=o*_,U=l*c,ee=l*h,ie=l*_,_e=n[0],Oe=n[1],ke=n[2];return e[0]=(1-(I+B))*_e,e[1]=(E+ie)*_e,e[2]=(C-ee)*_e,e[3]=0,e[4]=(E-ie)*Oe,e[5]=(1-(x+B))*Oe,e[6]=(P+U)*Oe,e[7]=0,e[8]=(C+ee)*ke,e[9]=(P-U)*ke,e[10]=(1-(x+I))*ke,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function zr(e,r,t,n,i){var a=r[0],o=r[1],l=r[2],c=r[3],h=a+a,_=o+o,x=l+l,E=a*h,C=a*_,I=a*x,P=o*_,B=o*x,U=l*x,ee=c*h,ie=c*_,_e=c*x,Oe=n[0],ke=n[1],Ke=n[2],ot=i[0],Ot=i[1],Zt=i[2],ir=(1-(P+U))*Oe,Hr=(C+_e)*Oe,ln=(I-ie)*Oe,pn=(C-_e)*ke,Ci=(1-(E+U))*ke,Ba=(B+ee)*ke,Sa=(I+ie)*Ke,La=(B-ee)*Ke,wa=(1-(E+P))*Ke;return e[0]=ir,e[1]=Hr,e[2]=ln,e[3]=0,e[4]=pn,e[5]=Ci,e[6]=Ba,e[7]=0,e[8]=Sa,e[9]=La,e[10]=wa,e[11]=0,e[12]=t[0]+ot-(ir*ot+pn*Ot+Sa*Zt),e[13]=t[1]+Ot-(Hr*ot+Ci*Ot+La*Zt),e[14]=t[2]+Zt-(ln*ot+Ba*Ot+wa*Zt),e[15]=1,e}function kr(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t+t,l=n+n,c=i+i,h=t*o,_=n*o,x=n*l,E=i*o,C=i*l,I=i*c,P=a*o,B=a*l,U=a*c;return e[0]=1-x-I,e[1]=_+U,e[2]=E-B,e[3]=0,e[4]=_-U,e[5]=1-h-I,e[6]=C+P,e[7]=0,e[8]=E+B,e[9]=C-P,e[10]=1-h-x,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xr(e,r,t,n,i,a,o){var l=1/(t-r),c=1/(i-n),h=1/(a-o);return e[0]=a*2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(t+r)*l,e[9]=(i+n)*c,e[10]=(o+a)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*h,e[15]=0,e}function Zn(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var Dn=Zn;function zn(e,r,t,n,i){var a=1/Math.tan(r/2),o;return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==Infinity?(o=1/(n-i),e[10]=i*o,e[14]=i*n*o):(e[10]=-1,e[14]=-n),e}function fi(e,r,t,n){var i=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),o=Math.tan(r.leftDegrees*Math.PI/180),l=Math.tan(r.rightDegrees*Math.PI/180),c=2/(o+l),h=2/(i+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=h,e[6]=0,e[7]=0,e[8]=-((o-l)*c*.5),e[9]=(i-a)*h*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function yi(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),h=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=(o+a)*h,e[15]=1,e}var va=yi;function Wo(e,r,t,n,i,a,o){var l=1/(r-t),c=1/(n-i),h=1/(a-o);return e[0]=-2*l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=h,e[11]=0,e[12]=(r+t)*l,e[13]=(i+n)*c,e[14]=a*h,e[15]=1,e}function bl(e,r,t,n){var i,a,o,l,c,h,_,x,E,C,I=r[0],P=r[1],B=r[2],U=n[0],ee=n[1],ie=n[2],_e=t[0],Oe=t[1],ke=t[2];return Math.abs(I-_e)<xr&&Math.abs(P-Oe)<xr&&Math.abs(B-ke)<xr?Di(e):(_=I-_e,x=P-Oe,E=B-ke,C=1/Math.hypot(_,x,E),_*=C,x*=C,E*=C,i=ee*E-ie*x,a=ie*_-U*E,o=U*x-ee*_,C=Math.hypot(i,a,o),C?(C=1/C,i*=C,a*=C,o*=C):(i=0,a=0,o=0),l=x*o-E*a,c=E*i-_*o,h=_*a-x*i,C=Math.hypot(l,c,h),C?(C=1/C,l*=C,c*=C,h*=C):(l=0,c=0,h=0),e[0]=i,e[1]=l,e[2]=_,e[3]=0,e[4]=a,e[5]=c,e[6]=x,e[7]=0,e[8]=o,e[9]=h,e[10]=E,e[11]=0,e[12]=-(i*I+a*P+o*B),e[13]=-(l*I+c*P+h*B),e[14]=-(_*I+x*P+E*B),e[15]=1,e)}function Td(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=n[0],c=n[1],h=n[2],_=i-t[0],x=a-t[1],E=o-t[2],C=_*_+x*x+E*E;C>0&&(C=1/Math.sqrt(C),_*=C,x*=C,E*=C);var I=c*E-h*x,P=h*_-l*E,B=l*x-c*_;return C=I*I+P*P+B*B,C>0&&(C=1/Math.sqrt(C),I*=C,P*=C,B*=C),e[0]=I,e[1]=P,e[2]=B,e[3]=0,e[4]=x*B-E*P,e[5]=E*I-_*B,e[6]=_*P-x*I,e[7]=0,e[8]=_,e[9]=x,e[10]=E,e[11]=0,e[12]=i,e[13]=a,e[14]=o,e[15]=1,e}function tl(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Dv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function mc(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function Ip(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function hy(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function py(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function dy(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function kp(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=e[4],l=e[5],c=e[6],h=e[7],_=e[8],x=e[9],E=e[10],C=e[11],I=e[12],P=e[13],B=e[14],U=e[15],ee=r[0],ie=r[1],_e=r[2],Oe=r[3],ke=r[4],Ke=r[5],ot=r[6],Ot=r[7],Zt=r[8],ir=r[9],Hr=r[10],ln=r[11],pn=r[12],Ci=r[13],Ba=r[14],Sa=r[15];return Math.abs(t-ee)<=xr*Math.max(1,Math.abs(t),Math.abs(ee))&&Math.abs(n-ie)<=xr*Math.max(1,Math.abs(n),Math.abs(ie))&&Math.abs(i-_e)<=xr*Math.max(1,Math.abs(i),Math.abs(_e))&&Math.abs(a-Oe)<=xr*Math.max(1,Math.abs(a),Math.abs(Oe))&&Math.abs(o-ke)<=xr*Math.max(1,Math.abs(o),Math.abs(ke))&&Math.abs(l-Ke)<=xr*Math.max(1,Math.abs(l),Math.abs(Ke))&&Math.abs(c-ot)<=xr*Math.max(1,Math.abs(c),Math.abs(ot))&&Math.abs(h-Ot)<=xr*Math.max(1,Math.abs(h),Math.abs(Ot))&&Math.abs(_-Zt)<=xr*Math.max(1,Math.abs(_),Math.abs(Zt))&&Math.abs(x-ir)<=xr*Math.max(1,Math.abs(x),Math.abs(ir))&&Math.abs(E-Hr)<=xr*Math.max(1,Math.abs(E),Math.abs(Hr))&&Math.abs(C-ln)<=xr*Math.max(1,Math.abs(C),Math.abs(ln))&&Math.abs(I-pn)<=xr*Math.max(1,Math.abs(I),Math.abs(pn))&&Math.abs(P-Ci)<=xr*Math.max(1,Math.abs(P),Math.abs(Ci))&&Math.abs(B-Ba)<=xr*Math.max(1,Math.abs(B),Math.abs(Ba))&&Math.abs(U-Sa)<=xr*Math.max(1,Math.abs(U),Math.abs(Sa))}var Qh=lr,Zm=Ip;function Jh(){var e=new jt(2);return jt!=Float32Array&&(e[0]=0,e[1]=0),e}function vy(e){var r=new jt(2);return r[0]=e[0],r[1]=e[1],r}function Qo(e,r){var t=new jt(2);return t[0]=e,t[1]=r,t}function lo(e,r){return e[0]=r[0],e[1]=r[1],e}function gy(e,r,t){return e[0]=r,e[1]=t,e}function Fv(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function $m(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e}function Ym(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e}function Km(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e}function qm(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function ep(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function tp(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e}function yy(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e}function Jo(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function Cd(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e}function Lf(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e}function wd(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.hypot(t,n)}function Od(e,r){var t=r[0]-e[0],n=r[1]-e[1];return t*t+n*n}function Bv(e){var r=e[0],t=e[1];return Math.hypot(r,t)}function rp(e){var r=e[0],t=e[1];return r*r+t*t}function nf(e,r){return e[0]=-r[0],e[1]=-r[1],e}function _y(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function by(e,r){var t=r[0],n=r[1],i=t*t+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e}function O_(e,r){return e[0]*r[0]+e[1]*r[1]}function As(e,r,t){var n=r[0]*t[1]-r[1]*t[0];return e[0]=e[1]=0,e[2]=n,e}function Nf(e,r,t,n){var i=r[0],a=r[1];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e}function xy(e,r){r=r||1;var t=$t()*2*Math.PI;return e[0]=Math.cos(t)*r,e[1]=Math.sin(t)*r,e}function s(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i,e[1]=t[1]*n+t[3]*i,e}function u(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[2]*i+t[4],e[1]=t[1]*n+t[3]*i+t[5],e}function f(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[3]*i+t[6],e[1]=t[1]*n+t[4]*i+t[7],e}function g(e,r,t){var n=r[0],i=r[1];return e[0]=t[0]*n+t[4]*i+t[12],e[1]=t[1]*n+t[5]*i+t[13],e}function b(e,r,t,n){var i=r[0]-t[0],a=r[1]-t[1],o=Math.sin(n),l=Math.cos(n);return e[0]=i*l-a*o+t[0],e[1]=i*o+a*l+t[1],e}function S(e,r){var t=e[0],n=e[1],i=r[0],a=r[1],o=Math.sqrt(t*t+n*n)*Math.sqrt(i*i+a*a),l=o&&(t*i+n*a)/o;return Math.acos(Math.min(Math.max(l,-1),1))}function T(e){return e[0]=0,e[1]=0,e}function R(e){return"vec2("+e[0]+", "+e[1]+")"}function F(e,r){return e[0]===r[0]&&e[1]===r[1]}function V(e,r){var t=e[0],n=e[1],i=r[0],a=r[1];return Math.abs(t-i)<=xr*Math.max(1,Math.abs(t),Math.abs(i))&&Math.abs(n-a)<=xr*Math.max(1,Math.abs(n),Math.abs(a))}var $=Bv,J=$m,re=Ym,xe=Km,ze=wd,Fe=Od,lt=rp,ct=function(){var e=Jh();return function(r,t,n,i,a,o){var l,c;for(t||(t=2),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],a(e,e,o),r[l]=e[0],r[l+1]=e[1];return r}}();function wt(){var e=new jt(3);return jt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ht(e){var r=new jt(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function ar(e){var r=e[0],t=e[1],n=e[2];return Math.hypot(r,t,n)}function Mr(e,r,t){var n=new jt(3);return n[0]=e,n[1]=r,n[2]=t,n}function gr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function un(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function fn(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Fn(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function $n(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function Un(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function In(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function Si(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function ai(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function qn(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function ea(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function Bi(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function xa(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function vi(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return Math.hypot(t,n,i)}function na(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function Qa(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function Wa(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function ho(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function po(e,r){var t=r[0],n=r[1],i=r[2],a=t*t+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e[2]=r[2]*a,e}function So(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function Rs(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],l=t[1],c=t[2];return e[0]=i*c-a*l,e[1]=a*o-n*c,e[2]=n*l-i*o,e}function Go(e,r,t,n){var i=r[0],a=r[1],o=r[2];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e}function au(e,r,t,n,i,a){var o=a*a,l=o*(2*a-3)+1,c=o*(a-2)+a,h=o*(a-1),_=o*(3-2*a);return e[0]=r[0]*l+t[0]*c+n[0]*h+i[0]*_,e[1]=r[1]*l+t[1]*c+n[1]*h+i[1]*_,e[2]=r[2]*l+t[2]*c+n[2]*h+i[2]*_,e}function Ts(e,r,t,n,i,a){var o=1-a,l=o*o,c=a*a,h=l*o,_=3*a*l,x=3*c*o,E=c*a;return e[0]=r[0]*h+t[0]*_+n[0]*x+i[0]*E,e[1]=r[1]*h+t[1]*_+n[1]*x+i[1]*E,e[2]=r[2]*h+t[2]*_+n[2]*x+i[2]*E,e}function ou(e,r){r=r||1;var t=$t()*2*Math.PI,n=$t()*2-1,i=Math.sqrt(1-n*n)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=n*r,e}function ps(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[3]*n+t[7]*i+t[11]*a+t[15];return o=o||1,e[0]=(t[0]*n+t[4]*i+t[8]*a+t[12])/o,e[1]=(t[1]*n+t[5]*i+t[9]*a+t[13])/o,e[2]=(t[2]*n+t[6]*i+t[10]*a+t[14])/o,e}function es(e,r,t){var n=r[0],i=r[1],a=r[2];return e[0]=n*t[0]+i*t[3]+a*t[6],e[1]=n*t[1]+i*t[4]+a*t[7],e[2]=n*t[2]+i*t[5]+a*t[8],e}function ds(e,r,t){var n=t[0],i=t[1],a=t[2],o=t[3],l=r[0],c=r[1],h=r[2],_=i*h-a*c,x=a*l-n*h,E=n*c-i*l,C=i*E-a*x,I=a*_-n*E,P=n*x-i*_,B=o*2;return _*=B,x*=B,E*=B,C*=2,I*=2,P*=2,e[0]=l+_+C,e[1]=c+x+I,e[2]=h+E+P,e}function fa(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function aa(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Va(e,r,t,n){var i=[],a=[];return i[0]=r[0]-t[0],i[1]=r[1]-t[1],i[2]=r[2]-t[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],e[0]=a[0]+t[0],e[1]=a[1]+t[1],e[2]=a[2]+t[2],e}function Ja(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2],c=Math.sqrt(t*t+n*n+i*i),h=Math.sqrt(a*a+o*o+l*l),_=c*h,x=_&&So(e,r)/_;return Math.acos(Math.min(Math.max(x,-1),1))}function su(e){return e[0]=0,e[1]=0,e[2]=0,e}function ro(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function vo(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Ws(e,r){var t=e[0],n=e[1],i=e[2],a=r[0],o=r[1],l=r[2];return Math.abs(t-a)<=xr*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(n-o)<=xr*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=xr*Math.max(1,Math.abs(i),Math.abs(l))}var la=Fn,jf=$n,xl=Un,gc=vi,rl=na,Ms=ar,zf=Qa,Uf=function(){var e=wt();return function(r,t,n,i,a,o){var l,c;for(t||(t=3),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2];return r}}();function af(){var e=new jt(4);return jt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Rd(e){var r=new jt(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function of(e,r,t,n){var i=new jt(4);return i[0]=e,i[1]=r,i[2]=t,i[3]=n,i}function Md(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Pd(e,r,t,n,i){return e[0]=r,e[1]=t,e[2]=n,e[3]=i,e}function Dp(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e}function Id(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e}function Fp(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e[3]=r[3]*t[3],e}function kd(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e[3]=r[3]/t[3],e}function xh(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Bp(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function Lv(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e[3]=Math.min(r[3],t[3]),e}function Lp(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e[3]=Math.max(r[3],t[3]),e}function Eh(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function Np(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function Nv(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e}function Dd(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return Math.hypot(t,n,i,a)}function np(e,r){var t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2],a=r[3]-e[3];return t*t+n*n+i*i+a*a}function Fd(e){var r=e[0],t=e[1],n=e[2],i=e[3];return Math.hypot(r,t,n,i)}function Bd(e){var r=e[0],t=e[1],n=e[2],i=e[3];return r*r+t*t+n*n+i*i}function jp(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function jv(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function Ld(e,r){var t=r[0],n=r[1],i=r[2],a=r[3],o=t*t+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=t*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function Nd(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function jd(e,r,t,n){var i=t[0]*n[1]-t[1]*n[0],a=t[0]*n[2]-t[2]*n[0],o=t[0]*n[3]-t[3]*n[0],l=t[1]*n[2]-t[2]*n[1],c=t[1]*n[3]-t[3]*n[1],h=t[2]*n[3]-t[3]*n[2],_=r[0],x=r[1],E=r[2],C=r[3];return e[0]=x*h-E*c+C*l,e[1]=-(_*h)+E*o-C*a,e[2]=_*c-x*o+C*i,e[3]=-(_*l)+x*a-E*i,e}function zp(e,r,t,n){var i=r[0],a=r[1],o=r[2],l=r[3];return e[0]=i+n*(t[0]-i),e[1]=a+n*(t[1]-a),e[2]=o+n*(t[2]-o),e[3]=l+n*(t[3]-l),e}function zd(e,r){r=r||1;var t,n,i,a,o,l;do t=$t()*2-1,n=$t()*2-1,o=t*t+n*n;while(o>=1);do i=$t()*2-1,a=$t()*2-1,l=i*i+a*a;while(l>=1);var c=Math.sqrt((1-o)/l);return e[0]=r*t,e[1]=r*n,e[2]=r*i*c,e[3]=r*a*c,e}function ip(e,r,t){var n=r[0],i=r[1],a=r[2],o=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*a+t[12]*o,e[1]=t[1]*n+t[5]*i+t[9]*a+t[13]*o,e[2]=t[2]*n+t[6]*i+t[10]*a+t[14]*o,e[3]=t[3]*n+t[7]*i+t[11]*a+t[15]*o,e}function Up(e,r,t){var n=r[0],i=r[1],a=r[2],o=t[0],l=t[1],c=t[2],h=t[3],_=h*n+l*a-c*i,x=h*i+c*n-o*a,E=h*a+o*i-l*n,C=-o*n-l*i-c*a;return e[0]=_*h+C*-o+x*-c-E*-l,e[1]=x*h+C*-l+E*-o-_*-c,e[2]=E*h+C*-c+_*-l-x*-o,e[3]=r[3],e}function Ud(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Qm(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Jm(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function Ey(e,r){var t=e[0],n=e[1],i=e[2],a=e[3],o=r[0],l=r[1],c=r[2],h=r[3];return Math.abs(t-o)<=xr*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(n-l)<=xr*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=xr*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-h)<=xr*Math.max(1,Math.abs(a),Math.abs(h))}var eg=Id,Sy=Fp,tg=kd,kb=Dd,R_=np,Vd=Fd,Io=Bd,yc=function(){var e=af();return function(r,t,n,i,a,o){var l,c;for(t||(t=4),n||(n=0),i?c=Math.min(i*t+n,r.length):c=r.length,l=n;l<c;l+=t)e[0]=r[l],e[1]=r[l+1],e[2]=r[l+2],e[3]=r[l+3],a(e,e,o),r[l]=e[0],r[l+1]=e[1],r[l+2]=e[2],r[l+3]=e[3];return r}}(),zv=v.create(),ap=v.create(),vs=v.create(),Vf=v.create(),Hf=v.create();function Jl(e,r,t,n,i){v.add(e,t,n),v.normalize(e,e),r=v.fromValues(-e[1],e[0]);var a=v.fromValues(-t[1],t[0]);return[i/v.dot(r,a),r]}function _c(e,r){return v.set(e,-r[1],r[0])}function sf(e,r,t){return v.sub(e,r,t),v.normalize(e,e),e}function Vp(e,r){return e[0]===r[0]&&e[1]===r[1]}function rg(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var ng=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object(Et.a)(this,e),Object(L.a)(this,"lastFlip",-1),Object(L.a)(this,"miter",v.fromValues(0,0)),Object(L.a)(this,"started",!1),Object(L.a)(this,"dash",!1),Object(L.a)(this,"totalDistance",0),Object(L.a)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Object(Rt.a)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,h,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var E=n[l-1],C=t[l];C.push((h=n[l][2])!==null&&h!==void 0?h:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,U=this.segment_gaode2(i,o,x,C,P,E,I,B);o+=U}if(this.dash)for(var ee=0;ee<i.positions.length/6;ee++)i.positions[ee*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,h,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var E=n[l-1],C=t[l];C.push((h=n[l][2])!==null&&h!==void 0?h:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,U=this.simpleSegment(i,o,x,C,P,E,I,B);o+=U}if(this.dash)for(var ee=0;ee<i.positions.length/6;ee++)i.positions[ee*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],h=o<t.length-1?t[o+1]:null,_=this.segment(n,a,l,c,h);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],h=o<t.length-1?t[o+1]:null,_=this.simpleSegment(n,a,l,c,h);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,h){var _=0,x=t.indices,E=t.positions,C=t.normals,I=this.cap==="square",P=this.join==="bevel",B=G([c[0],c[1]]),U=G([l[0],l[1]]);sf(vs,a,i);var ee=0;if(this.dash&&(ee=this.lineSegmentDistance(B,U),this.totalDistance+=ee),this.normal||(this.normal=v.create(),_c(this.normal,vs)),!this.started)if(this.started=!0,I){var ie=v.create(),_e=v.create();v.add(ie,this.normal,vs),v.add(_e,this.normal,vs),C.push(_e[0],_e[1],0),C.push(ie[0],ie[1],0),E.push(i[0],i[1],i[2]|0,this.totalDistance-ee,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),E.push(i[0],i[1],i[2]|0,this.totalDistance-ee,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,C,i,this.normal,this.thickness,this.totalDistance-ee);if(x.push(n+0,n+1,n+2),o){Vp(a,o)&&v.add(o,a,v.normalize(o,v.subtract(o,a,i))),sf(Vf,o,a);var Ke=Jl(Hf,v.create(),vs,Vf,this.thickness),ot=Object(Bn.a)(Ke,2),Ot=ot[0],Zt=ot[1],ir=v.dot(Hf,this.normal)<0?-1:1,Hr=P;if(!Hr&&this.join==="miter"){var ln=Ot;ln>this.miterLimit&&(Hr=!0)}Hr?(C.push(this.normal[0],this.normal[1],0),C.push(Zt[0],Zt[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,Object(cr.a)(this.lastFlip!==-ir?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),_c(zv,Vf),v.copy(this.normal,zv),C.push(this.normal[0],this.normal[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(E,C,a,Zt,Ot,this.totalDistance),x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ir=-1,v.copy(this.normal,Zt),_+=2),this.lastFlip=ir}else{if(_c(this.normal,vs),I){var Oe=v.create(),ke=v.create();v.sub(ke,vs,this.normal),v.add(Oe,vs,this.normal),C.push(ke[0],ke[1],0),C.push(Oe[0],Oe[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,h=t.positions,_=t.normals,x=G([a[0],a[1]]),E=G([i[0],i[1]]);sf(vs,x,E);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,E),this.totalDistance+=C),this.normal||(this.normal=v.create(),_c(this.normal,vs)),this.started||(this.started=!0,this.extrusions(h,_,i,this.normal,this.thickness,this.totalDistance-C)),c.push(n+0,n+1,n+2),!o)_c(this.normal,vs),this.extrusions(h,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=G([o[0],o[1]]);Vp(x,I)&&v.add(I,x,v.normalize(I,v.subtract(I,x,E))),sf(Vf,I,x);var P=Jl(Hf,v.create(),vs,Vf,this.thickness),B=Object(Bn.a)(P,2),U=B[0],ee=B[1],ie=v.dot(Hf,this.normal)<0?-1:1;this.extrusions(h,_,a,ee,U,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,v.copy(this.normal,ee),l+=2,this.lastFlip=ie}return l}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,h=t.positions,_=t.normals,x=this.cap==="square",E=this.join==="bevel",C=G([a[0],a[1]]),I=G([i[0],i[1]]);sf(vs,C,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(C,I),this.totalDistance+=P),this.normal||(this.normal=v.create(),_c(this.normal,vs)),!this.started)if(this.started=!0,x){var B=v.create(),U=v.create();v.add(B,this.normal,vs),v.add(U,this.normal,vs),_.push(U[0],U[1],0),_.push(B[0],B[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),o){var _e=G([o[0],o[1]]);Vp(C,_e)&&v.add(_e,C,v.normalize(_e,v.subtract(_e,C,I))),sf(Vf,_e,C);var Oe=Jl(Hf,v.create(),vs,Vf,this.thickness),ke=Object(Bn.a)(Oe,2),Ke=ke[0],ot=ke[1],Ot=v.dot(Hf,this.normal)<0?-1:1,Zt=E;if(!Zt&&this.join==="miter"){var ir=Ke;ir>this.miterLimit&&(Zt=!0)}Zt?(_.push(this.normal[0],this.normal[1],0),_.push(ot[0],ot[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,Object(cr.a)(this.lastFlip!==-Ot?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),_c(zv,Vf),v.copy(this.normal,zv),_.push(this.normal[0],this.normal[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(h,_,a,ot,Ke,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ot=-1,v.copy(this.normal,ot),l+=2),this.lastFlip=Ot}else{if(_c(this.normal,vs),x){var ee=v.create(),ie=v.create();v.sub(ie,vs,this.normal),v.add(ee,vs,this.normal),_.push(ie[0],ie[1],0),_.push(ee[0],ee[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function Uv(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new ng({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],h=o[l];i.extrude_gaode2(c,h)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(E){i.extrude(E)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function Sh(e){var r=$r(e.coordinates);return{vertices:[].concat(Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r)),indices:[0,1,2,2,3,0],size:r.length}}function ig(e){var r=e.coordinates,t=Yr.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,o=Yr()(n,a,i);return{indices:o,vertices:n,size:i}}var Ay=function(){var e=Object(Xt.a)(he.a.mark(function r(t){var n,i,a,o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.iconMap,l={a_Color:Jr,a_Position:nn,filter:tn,a_vertexId:an,a_PickingColor:function(P){var B=P.id;return a?os(B):[0,0,0]},a_DistanceAndIndex:function(P,B,U,ee,ie,_e){return _e===void 0?[U[3],10]:[U[3],_e]},a_Total_Distance:function(P,B,U){return[U[5]]},a_Size:function(P){var B=P.size,U=B===void 0?1:B;return Array.isArray(U)?[U[0],U[1]]:[U,0]},a_Normal:function(P,B,U,ee,ie){return ie},a_Miter:function(P,B,U){return[U[4]]},a_iconMapUV:function(P){var B=P.texture,U=o[B]||{x:0,y:0},ee=U.x,ie=U.y;return[ee,ie]}},c={sizePerElement:0,elements:[]},h=0,_=[],x=3,i.forEach(function(I,P){var B=Uv(I),U=B.indices,ee=B.vertices,ie=B.normals,_e=B.size,Oe=B.indexes;U.forEach(function(Ot){_.push(Ot+h)}),x=_e;var ke=ee.length/_e;c.sizePerElement=x,c.elements.push({featureIdx:P,vertices:ee,normals:ie,offset:h}),h+=ke;for(var Ke=function(Zt){var ir=(ie==null?void 0:ie.slice(Zt*3,Zt*3+3))||[],Hr=ee.slice(Zt*_e,Zt*_e+_e),ln=0;Oe&&Oe[Zt]!==void 0&&(ln=Oe[Zt]),n.forEach(function(pn){if(pn&&l[pn.name]){var Ci;(Ci=pn.buffer.data).push.apply(Ci,Object(cr.a)(l[pn.name](I,P,Hr,Zt,ir,ln)))}})},ot=0;ot<ke;ot++)Ke(ot)}),C.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Ty=function(){var e=Object(Xt.a)(he.a.mark(function r(t){var n,i,a,o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o=t.shape2d,l={a_Color:Jr,a_Position:nn,filter:tn,a_vertexId:an,a_PickingColor:function(P){var B=P.id;return a?os(B):[0,0,0]},a_Shape:function(P){var B=P.shape,U=B===void 0?2:B,ee=o.indexOf(U);return[ee]},a_Extrude:function(P,B,U,ee){var ie=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_e=ee%4*3;return[ie[_e],ie[_e+1],ie[_e+2]]},a_Size:function(P){var B=P.size,U=B===void 0?5:B;return Array.isArray(U)?[U[0]]:[U]}},c={sizePerElement:0,elements:[]},h=0,_=[],x=3,i.forEach(function(I,P){var B=Sh(I),U=B.indices,ee=B.vertices,ie=B.normals,_e=B.size,Oe=B.indexes;U.forEach(function(Ot){_.push(Ot+h)}),x=_e;var ke=ee.length/_e;c.sizePerElement=x,c.elements.push({featureIdx:P,vertices:ee,normals:ie,offset:h}),h+=ke;for(var Ke=function(Zt){var ir=(ie==null?void 0:ie.slice(Zt*3,Zt*3+3))||[],Hr=ee.slice(Zt*_e,Zt*_e+_e),ln=0;Oe&&Oe[Zt]!==void 0&&(ln=Oe[Zt]),n.forEach(function(pn){if(pn&&l[pn.name]){var Ci;(Ci=pn.buffer.data).push.apply(Ci,Object(cr.a)(l[pn.name](I,P,Hr,Zt,ir,ln)))}})},ot=0;ot<ke;ot++)Ke(ot)}),C.abrupt("return",{descriptors:n,featureLayout:c,indices:_});case 8:case"end":return C.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Cy=function(){var e=Object(Xt.a)(he.a.mark(function r(t){var n,i,a,o,l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,o={a_Color:Jr,a_Position:nn,filter:tn,a_vertexId:an,a_PickingColor:function(I){var P=I.id;return a?os(P):[0,0,0]}},l={sizePerElement:0,elements:[]},c=0,h=[],_=3,i.forEach(function(C,I){var P=ig(C),B=P.indices,U=P.vertices,ee=P.normals,ie=P.size,_e=P.indexes;B.forEach(function(ot){h.push(ot+c)}),_=ie;var Oe=U.length/ie;l.sizePerElement=_,l.elements.push({featureIdx:I,vertices:U,normals:ee,offset:c}),c+=Oe;for(var ke=function(Ot){var Zt=(ee==null?void 0:ee.slice(Ot*3,Ot*3+3))||[],ir=U.slice(Ot*ie,Ot*ie+ie),Hr=0;_e&&_e[Ot]!==void 0&&(Hr=_e[Ot]),n.forEach(function(ln){if(ln&&o[ln.name]){var pn;(pn=ln.buffer.data).push.apply(pn,Object(cr.a)(o[ln.name](C,I,ir,Ot,Zt,Hr)))}})},Ke=0;Ke<Oe;Ke++)ke(Ke)}),E.abrupt("return",{descriptors:n,featureLayout:l,indices:h});case 8:case"end":return E.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),wy={pointFill:Ty,line:Ay,polygonFill:Cy},Du=Object(we.a)({},wy);function ag(e){return Vv.apply(this,arguments)}function Vv(){return Vv=Object(Xt.a)(he.a.mark(function e(r){var t,n;return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!Du[t]){a.next=3;break}return a.abrupt("return",Du[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),Vv.apply(this,arguments)}var bc=new Map;function M_(e,r){bc.set(e,r)}function Oy(e){var r=bc.get(e);return r}var xc="l7-worker",Hp=3,Wp=!0;function Hd(e){M_(xc,e)}function Gp(){var e=Oy(xc);if(!e)throw new Error("get worker failed by workerName: ".concat(xc,"."));return e}function P_(e,r){return Hv.apply(this,arguments)}function Hv(){return Hv=Object(Xt.a)(he.a.mark(function e(r,t){var n,i,a,o,l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n=Gp(),i=Ql.getWorkerFarm({maxConcurrency:Hp,reuseWorkers:Wp}),a=i.getWorkerPool({name:xc,source:n}),h.next=5,a.startJob(xc,function(_,x,E){return _.done(E)});case 5:return o=h.sent,o.postMessage("process",{input:{workerType:r,data:t}}),h.next=9,o.result;case 9:return l=h.sent,h.abrupt("return",l.result);case 11:case"end":return h.stop()}},e)})),Hv.apply(this,arguments)}var Ry=O("Aib3"),My=O.n(Ry);function og(e,r){return e.map(function(t){return t[r]*1})}function sg(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Ah(e){return Array.isArray(e)?e.length===0?!1:!!sg(e[0]):!1}function ug(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Wd(e){var r=Object.isFrozen(e)?xi.cloneDeep(e):e;return My()(r,!0),r}function Wv(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,o=r.coordinates,l=r.geometry,c=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(U){return U[l]&&U[l].type&&U[l].coordinates&&U[l].coordinates.length>0}).forEach(function(U,ee){var ie=Wd(U[l]);Rl(ie,function(_e){var Oe=_a(_e),ke=Object(we.a)(Object(we.a)({},U),{},{_id:ee,coordinates:Oe});c.push(ke)})}),{dataArray:c};for(var h=0;h<e.length;h++){var _=e[h],x=[];if(o){var E="Polygon";Array.isArray(o[0])||(E="Point"),Array.isArray(o[0])&&!Array.isArray(o[0][0])&&(E="LineString");var C=Wd({type:E,coordinates:_[o]});x=C.coordinates}else if(t&&n&&i&&a){var I=[parseFloat(_[t]),parseFloat(_[n])],P=[parseFloat(_[i]),parseFloat(_[a])];x=[I,P]}else t&&n&&(x=[parseFloat(_[t]),parseFloat(_[n])]);var B=Object(we.a)(Object(we.a)({},_),{},{_id:h,coordinates:x});c.push(B)}return{dataArray:c}}function Py(e,r){var t=pr(e);return Wv(t,r)}var El=O("U8pU");function Iy(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function ky(e,r){return r===void 0?null:Object(El.a)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?Iy(e.properties[r]+"")%1000019:null}function lg(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=Wd(e),e.features.length===0?{dataArray:[],featureKeys:n}:(Rl(e,function(i,a){var o=ky(i,r==null?void 0:r.featureId);o===null&&(o=a);var l=o,c=_a(i),h=Object(we.a)(Object(we.a)({},i.properties),{},{coordinates:c,_id:l});t.push(h)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function Gv(e,r,t,n){for(var i=n,a=t-r>>1,o=t-r,l,c=e[r],h=e[r+1],_=e[t],x=e[t+1],E=r+3;E<t;E+=3){var C=Gd(e[E],e[E+1],c,h,_,x);if(C>i)l=E,i=C;else if(C===i){var I=Math.abs(E-a);I<o&&(l=E,o=I)}}i>n&&(l-r>3&&Gv(e,r,l,n),e[l+2]=i,t-l>3&&Gv(e,l,t,n))}function Gd(e,r,t,n,i,a){var o=i-t,l=a-n;if(o!==0||l!==0){var c=((e-t)*o+(r-n)*l)/(o*o+l*l);c>1?(t=i,n=a):c>0&&(t+=o*c,n+=l*c)}return o=e-t,l=r-n,o*o+l*l}function Xp(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity};return Xv(i),i}function Xv(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")cg(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)cg(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)cg(e,r[n][i])}function cg(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Dy(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Zv(t,e.features[n],r,n);else e.type==="Feature"?Zv(t,e,r):Zv(t,{geometry:e},r);return t}function Zv(e,r,t,n){if(!!r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,o=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],c=r.id;if(t.promoteId?c=r.properties[t.promoteId]:t.generateId&&(c=n||0),a==="Point")Fy(i,l);else if(a==="MultiPoint")for(var h=0;h<i.length;h++)Fy(i[h],l);else if(a==="LineString")fg(i,l,o,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(h=0;h<i.length;h++)l=[],fg(i[h],l,o,!1),e.push(Xp(c,"LineString",l,r.properties));return}else hg(i,l,o,!1);else if(a==="Polygon")hg(i,l,o,!0);else if(a==="MultiPolygon")for(h=0;h<i.length;h++){var _=[];hg(i[h],_,o,!0),l.push(_)}else if(a==="GeometryCollection"){for(h=0;h<r.geometry.geometries.length;h++)Zv(e,{id:c,geometry:r.geometry.geometries[h],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Xp(c,a,l,r.properties))}}function Fy(e,r){r.push(By(e[0])),r.push(Ly(e[1])),r.push(0)}function fg(e,r,t,n){for(var i,a,o=0,l=0;l<e.length;l++){var c=By(e[l][0]),h=Ly(e[l][1]);r.push(c),r.push(h),r.push(0),l>0&&(n?o+=(i*h-c*a)/2:o+=Math.sqrt(Math.pow(c-i,2)+Math.pow(h-a,2))),i=c,a=h}var _=r.length-3;r[2]=1,Gv(r,0,_,t),r[_+2]=1,r.size=Math.abs(o),r.start=0,r.end=r.size}function hg(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];fg(e[i],a,t,n),r.push(a)}}function By(e){return e/360+.5}function Ly(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function Wf(e,r,t,n,i,a,o,l){if(t/=r,n/=r,a>=t&&o<n)return e;if(o<t||a>=n)return null;for(var c=[],h=0;h<e.length;h++){var _=e[h],x=_.geometry,E=_.type,C=i===0?_.minX:_.minY,I=i===0?_.maxX:_.maxY;if(C>=t&&I<n){c.push(_);continue}else if(I<t||C>=n)continue;var P=[];if(E==="Point"||E==="MultiPoint")I_(x,P,t,n,i);else if(E==="LineString")Ec(x,P,t,n,i,!1,l.lineMetrics);else if(E==="MultiLineString")$v(x,P,t,n,i,!1);else if(E==="Polygon")$v(x,P,t,n,i,!0);else if(E==="MultiPolygon")for(var B=0;B<x.length;B++){var U=[];$v(x[B],U,t,n,i,!0),U.length&&P.push(U)}if(P.length){if(l.lineMetrics&&E==="LineString"){for(B=0;B<P.length;B++)c.push(Xp(_.id,E,P[B],_.tags));continue}(E==="LineString"||E==="MultiLineString")&&(P.length===1?(E="LineString",P=P[0]):E="MultiLineString"),(E==="Point"||E==="MultiPoint")&&(E=P.length===3?"Point":"MultiPoint"),c.push(Xp(_.id,E,P,_.tags))}}return c.length?c:null}function I_(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=t&&o<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function Ec(e,r,t,n,i,a,o){for(var l=Xd(e),c=i===0?pg:Ny,h=e.start,_,x,E=0;E<e.length-3;E+=3){var C=e[E],I=e[E+1],P=e[E+2],B=e[E+3],U=e[E+4],ee=i===0?C:I,ie=i===0?B:U,_e=!1;o&&(_=Math.sqrt(Math.pow(C-B,2)+Math.pow(I-U,2))),ee<t?ie>t&&(x=c(l,C,I,B,U,t),o&&(l.start=h+_*x)):ee>n?ie<n&&(x=c(l,C,I,B,U,n),o&&(l.start=h+_*x)):Yv(l,C,I,P),ie<t&&ee>=t&&(x=c(l,C,I,B,U,t),_e=!0),ie>n&&ee<=n&&(x=c(l,C,I,B,U,n),_e=!0),!a&&_e&&(o&&(l.end=h+_*x),r.push(l),l=Xd(e)),o&&(h+=_)}var Oe=e.length-3;C=e[Oe],I=e[Oe+1],P=e[Oe+2],ee=i===0?C:I,ee>=t&&ee<=n&&Yv(l,C,I,P),Oe=l.length-3,a&&Oe>=3&&(l[Oe]!==l[0]||l[Oe+1]!==l[1])&&Yv(l,l[0],l[1],l[2]),l.length&&r.push(l)}function Xd(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function $v(e,r,t,n,i,a){for(var o=0;o<e.length;o++)Ec(e[o],r,t,n,i,a,!1)}function Yv(e,r,t,n){e.push(r),e.push(t),e.push(n)}function pg(e,r,t,n,i,a){var o=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*o),e.push(1),o}function Ny(e,r,t,n,i,a){var o=(a-t)/(i-t);return e.push(r+(n-r)*o),e.push(a),e.push(1),o}function kO(e,r){var t=r.buffer/r.extent,n=e,i=Wf(e,1,-1-t,t,0,-1,2,r),a=Wf(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=Wf(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=Db(i,1).concat(n)),a&&(n=n.concat(Db(a,-1)))),n}function Db(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,o;if(a==="Point"||a==="MultiPoint"||a==="LineString")o=k_(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){o=[];for(var l=0;l<i.geometry.length;l++)o.push(k_(i.geometry[l],r))}else if(a==="MultiPolygon")for(o=[],l=0;l<i.geometry.length;l++){for(var c=[],h=0;h<i.geometry[l].length;h++)c.push(k_(i.geometry[l][h],r));o.push(c)}t.push(Xp(i.id,a,o,i.tags))}return t}function k_(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function Fb(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,o,l;for(a=0;a<e.features.length;a++){var c=e.features[a],h=c.geometry,_=c.type;if(c.geometry=[],_===1)for(o=0;o<h.length;o+=2)c.geometry.push(Bb(h[o],h[o+1],r,t,n,i));else for(o=0;o<h.length;o++){var x=[];for(l=0;l<h[o].length;l+=2)x.push(Bb(h[o][l],h[o][l+1],r,t,n,i));c.geometry.push(x)}}return e.transformed=!0,e}function Bb(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function DO(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){o.numFeatures++,FO(o,e[l],a,i);var c=e[l].minX,h=e[l].minY,_=e[l].maxX,x=e[l].maxY;c<o.minX&&(o.minX=c),h<o.minY&&(o.minY=h),_>o.maxX&&(o.maxX=_),x>o.maxY&&(o.maxY=x)}return o}function FO(e,r,t,n){var i=r.geometry,a=r.type,o=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)o.push(i[l]),o.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")D_(o,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)D_(o,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var c=0;c<i.length;c++){var h=i[c];for(l=0;l<h.length;l++)D_(o,h[l],e,t,!0,l===0)}if(o.length){var _=r.tags||null;if(a==="LineString"&&n.lineMetrics){_={};for(var x in r.tags)_[x]=r.tags[x];_.mapbox_clip_start=i.start/i.size,_.mapbox_clip_end=i.end/i.size}var E={geometry:o,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:_};r.id!==null&&(E.id=r.id),e.features.push(E)}}function D_(e,r,t,n,i,a){var o=n*n;if(n>0&&r.size<(i?o:n)){t.numPoints+=r.length/3;return}for(var l=[],c=0;c<r.length;c+=3)(n===0||r[c+2]>o)&&(t.numSimplified++,l.push(r[c]),l.push(r[c+1])),t.numPoints++;i&&BO(l,a),e.push(l)}function BO(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=l}}function LO(e,r){return new jy(e,r)}function jy(e,r){r=this.options=NO(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Dy(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=kO(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}jy.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},jy.prototype.splitTile=function(e,r,t,n,i,a,o){for(var l=[e,r,t,n],c=this.options,h=c.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var _=1<<r,x=F_(r,t,n),E=this.tiles[x];if(!E&&(h>1&&console.time("creation"),E=this.tiles[x]=DO(e,r,t,n,c),this.tileCoords.push({z:r,x:t,y:n}),h)){h>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,E.numFeatures,E.numPoints,E.numSimplified),console.timeEnd("creation"));var C="z"+r;this.stats[C]=(this.stats[C]||0)+1,this.total++}if(E.source=e,i){if(r===c.maxZoom||r===i)continue;var I=1<<i-r;if(t!==Math.floor(a/I)||n!==Math.floor(o/I))continue}else if(r===c.indexMaxZoom||E.numPoints<=c.indexMaxPoints)continue;if(E.source=null,e.length!==0){h>1&&console.time("clipping");var P=.5*c.buffer/c.extent,B=.5-P,U=.5+P,ee=1+P,ie,_e,Oe,ke,Ke,ot;ie=_e=Oe=ke=null,Ke=Wf(e,_,t-P,t+U,0,E.minX,E.maxX,c),ot=Wf(e,_,t+B,t+ee,0,E.minX,E.maxX,c),e=null,Ke&&(ie=Wf(Ke,_,n-P,n+U,1,E.minY,E.maxY,c),_e=Wf(Ke,_,n+B,n+ee,1,E.minY,E.maxY,c),Ke=null),ot&&(Oe=Wf(ot,_,n-P,n+U,1,E.minY,E.maxY,c),ke=Wf(ot,_,n+B,n+ee,1,E.minY,E.maxY,c),ot=null),h>1&&console.timeEnd("clipping"),l.push(ie||[],r+1,t*2,n*2),l.push(_e||[],r+1,t*2,n*2+1),l.push(Oe||[],r+1,t*2+1,n*2),l.push(ke||[],r+1,t*2+1,n*2+1)}}},jy.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e;r=(r%o+o)%o;var l=F_(e,r,t);if(this.tiles[l])return Fb(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var c=e,h=r,_=t,x;!x&&c>0;)c--,h=Math.floor(h/2),_=Math.floor(_/2),x=this.tiles[F_(c,h,_)];return!x||!x.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",c,h,_),a>1&&console.time("drilling down"),this.splitTile(x.source,c,h,_,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?Fb(this.tiles[l],i):null)};function F_(e,r,t){return((1<<e)*t+r)*32+e}function NO(e,r){for(var t in r)e[t]=r[t];return e}var dg=function(){function e(r,t,n,i){Object(Et.a)(this,e),Object(L.a)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return Object(Rt.a)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),jO={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0};function zO(e){for(var r=0,t=0,n=e.length,i=n-1,a,o;t<n;i=t++)a=e[t],o=e[i],r+=(o.x-a.x)*(a.y+o.y);return r}function UO(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var o=zO(e[a]);o!==0&&(i===void 0&&(i=o<0),i===o<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var VO=["Unknown","Point","LineString","Polygon"];function HO(e,r,t,n,i){var a=i.geometry,o=i.type,l=i.tags,c=i.id,h=e*Math.pow(2,n),_=e*r,x=e*t,E=VO[o],C,I;function P(ee){for(var ie=0;ie<ee.length;ie++){var _e=ee[ie];if(_e[3])break;var Oe=180-(_e[1]+x)*360/h,ke=(_e[0]+_)*360/h-180,Ke=360/Math.PI*Math.atan(Math.exp(Oe*Math.PI/180))-90;ee[ie]=[ke,Ke,0,1]}}switch(o){case 1:var B=[];for(C=0;C<a.length;C++)B[C]=a[C][0];a=B,P(a);break;case 2:for(C=0;C<a.length;C++)P(a[C]);break;case 3:for(a=UO(a),C=0;C<a.length;C++)for(I=0;I<a[C].length;I++)P(a[C][I]);break}a.length===1?a=a[0]:E="Multi"+E;var U={type:"Feature",geometry:{type:E,coordinates:a},properties:l,id:c,tileOrigin:[0,0],coord:""};return U}var WO=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c){var h=n.getTile(t.z,t.x,t.y),_=h?h.features.map(function(C){return HO(a,i.x,i.y,i.z,C)}):[],x={layers:{defaultLayer:{features:_}}},E=new dg(x,t.x,t.y,t.z);c(E)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function GO(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:Object(we.a)(Object(we.a)({},r),e.geojsonvtOptions)}function XO(e,r){var t=GO(r),n=t.extent||4096,i=LO(e,t),a=function(c,h){return WO(h,i,c,n)},o=Object(we.a)(Object(we.a)(Object(we.a)({},jO),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:o,isTile:!0}}function Lb(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,o=new Promise(function(c){e instanceof HTMLImageElement||fh(e)?c([e]):ZO(e,a,function(h){c(h)})}),l={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function ZO(e,r,t){var n=[];if(typeof e=="string")qf(Object(we.a)(Object(we.a)({},r),{},{url:e}),function(o,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(o){qf(Object(we.a)(Object(we.a)({},r),{},{url:o}),function(l,c){a++,c&&n.push(c),a===i&&t(n)})})}return Lb}var $O=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a){var o,l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o={x:n.x,y:n.y,z:n.z},l=Ua(t,o),h.abrupt("return",new Promise(function(_){a?a(o,function(x,E){if(x||!E){var C={layers:{defaultLayer:{features:[]}}},I=new dg(C,n.x,n.y,n.z);_(I)}else{var P={layers:{defaultLayer:{features:E.features}}},B=new dg(P,n.x,n.y,n.z);_(B)}}):mu(Object(we.a)(Object(we.a)({},i),{},{url:l}),function(x,E){if(x||!E){var C={layers:{defaultLayer:{features:[]}}},I=new dg(C,n.x,n.y,n.z);_(I)}else{var P=JSON.parse(E),B={layers:{defaultLayer:{features:P}}},U=new dg(B,n.x,n.y,n.z);_(U)}})}));case 3:case"end":return h.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function YO(e,r){var t=function(a,o){return $O(e,o,r==null?void 0:r.requestParameters,r.getCustomData)},n=Object(we.a)(Object(we.a)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var KO=O("dA7e"),qO=O("eRUA"),QO=O.n(qO),Nb=function(){function e(r,t,n,i){Object(Et.a)(this,e),Object(L.a)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new KO.VectorTile(new QO.a(r))}return Object(Rt.a)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var o=n.feature(a),l=o.toGeoJSON(this.x,this.y,this.z);i.push(Object(we.a)(Object(we.a)({},l),{},{properties:Object(we.a)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),JO={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},eR=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a,o){var l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return l=Ua(t,n),h.abrupt("return",new Promise(function(_){if(o)o({x:i.x,y:i.y,z:i.z},function(E,C){if(E||!C)_(void 0);else{var I=new Nb(C,i.x,i.y,i.z);_(I)}});else{var x=Ns(Object(we.a)(Object(we.a)({},a),{},{url:l}),function(E,C){if(E||!C)_(void 0);else{var I=new Nb(C,i.x,i.y,i.z);_(I)}});i.xhrCancel=function(){return x.cancel()}}}));case 2:case"end":return h.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}();function tR(e,r){var t=Array.isArray(e)?e[0]:e,n=function(o,l){return eR(t,o,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=Object(we.a)(Object(we.a)(Object(we.a)({},JO),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function rR(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function vg(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(C){return C.rasterData}),o=n*i,l=[],c=JSON.stringify(e),h=0;h<o;h++){var _=JSON.parse(c),x=jb(_,a,h);if(typeof x=="number")l.push(x);else{var E=B_(_);l.push(E)}}return l}function jb(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:jb(n,r,t)}})}function nR(e){var r=Object(Bn.a)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],o=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,o]}function B_(e){var r=nR(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=B_(e[1])),Array.isArray(i)&&(i=B_(e[2])),rR(t,n,i)}var iR={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:aR}};function aR(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],o=(r==null?void 0:r.countCut)||[2,98],l=Object(Bn.a)(o,2),c=l[0],h=l[1],_=(r==null?void 0:r.RMinMax)||L_(t,c,h),x=(r==null?void 0:r.GMinMax)||L_(n,c,h),E=(r==null?void 0:r.BMinMax)||L_(i,c,h),C=0;C<t.length;C++)a.push(Math.max(0,t[C]-_[0])),a.push(Math.max(0,n[C]-x[0])),a.push(Math.max(0,i[C]-E[0]));return{rasterData:a,rMinMax:_,gMinMax:x,bMinMax:E}}function L_(e,r,t){var n=e.slice().sort(function(l,c){return l-c}),i=n.length,a=n[Math.ceil(i*r/100)],o=n[Math.ceil(i*t/100)];return[a,o]}function N_(e,r,t){return j_.apply(this,arguments)}function j_(){return j_=Object(Xt.a)(he.a.mark(function e(r,t,n){var i,a,o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(r.length!==0){x.next=2;break}return x.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return x.next=4,Promise.all(r.map(function(E){var C=E.data,I=E.bands,P=I===void 0?[0]:I;return t(C,P)}));case 4:i=x.sent,a=[],i.forEach(function(E){Array.isArray(E)?a.push.apply(a,Object(cr.a)(E)):a.push(E)}),o=a[0],l=o.width,c=o.height,x.t0=Object(El.a)(n),x.next=x.t0==="function"?11:x.t0==="object"?13:15;break;case 11:return h=n(a),x.abrupt("break",16);case 13:return Array.isArray(n)?h={rasterData:vg(n,a)}:h=oR(n,a),x.abrupt("break",16);case 15:h={rasterData:a[0].rasterData};case 16:return x.abrupt("return",Object(we.a)(Object(we.a)({},h),{},{width:l,height:c}));case 17:case"end":return x.stop()}},e)})),j_.apply(this,arguments)}function oR(e,r){var t=iR[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?sR(t.expression,r):{rasterData:vg(t.expression,r)}}function sR(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=vg(e.r||["band",0],r),n=vg(e.g||["band",0],r),i=vg(e.b||["band",0],r);return[t,n,i]}function z_(e,r,t,n){return U_.apply(this,arguments)}function U_(){return U_=Object(Xt.a)(he.a.mark(function e(r,t,n,i){var a;return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,N_(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),U_.apply(this,arguments)}function uR(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,o=r.max,l=r.format,c=r.operation,h,_,x;if(l===void 0||ug(e))h=Array.from(e),_=n,x=i;else{var E=Array.isArray(e)?e:[e];h=N_(E,l,c)}var C={_id:1,dataArray:[{_id:1,data:h,width:_,height:x,min:a,max:o,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return C}var _W=O("mNvP"),on=O("4cb6"),lR=O("APxj"),cR=O.n(lR),Qt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},fR=O("rxlC"),hR=O.n(fR);function zb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=pR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function pR(e,r){if(!!e){if(typeof e=="string")return Ub(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ub(e,r)}}function Ub(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var mg=30;function dR(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,o=e.mapping,l=o===void 0?{}:o,c=e.xOffset,h=c===void 0?0:c,_=e.yOffset,x=_===void 0?0:_,E=0,C=h;Array.from(r).forEach(function(P,B){if(!l[P]){var U=t(P,B);C+mg>a&&(C=0,E++),l[P]={x:C,y:x+E*mg,width:mg,height:mg,advance:U},C+=mg}});var I=n+i*2;return{mapping:l,xOffset:C,yOffset:x+E*I,canvasHeight:Hb(x+(E+1)*I)}}function vR(e,r,t){var n=0,i=0,a=0,o=[],l={},c=zb(e),h;try{for(c.s();!(h=c.n()).done;){var _=h.value;if(!l[_.id]){var x=_.size;n+x+r>t&&(Vb(l,o,i),n=0,i=a+i+r,a=0,o=[]),o.push({icon:_,xOffset:n}),n=n+x+r,a=Math.max(a,x)}}}catch(C){c.e(C)}finally{c.f()}o.length>0&&Vb(l,o,i);var E=Hb(a+i+r);return{mapping:l,canvasHeight:E}}function Vb(e,r,t){var n=zb(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.icon,l=a.xOffset;e[o.id]=Object(we.a)(Object(we.a)({},o),{},{x:l,y:t,image:o.image,width:o.width,height:o.height})}}catch(c){n.e(c)}finally{n.f()}}function Hb(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Wb,Gb;function Xb(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=mR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function mR(e,r){if(!!e){if(typeof e=="string")return Zb(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Zb(e,r)}}function Zb(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function gR(e){var r=yR();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function yR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _R=OR(),bR="sans-serif",xR="normal",ER=24,SR=3,AR=.25,TR=8,$b=1024,CR=1,Yb=1,wR=3,bW=["fontFamily","fontWeight","characterSet","fontSize","sdf","buffer","cutoff","radius"];function OR(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Kb(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function qb(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var RR=(Wb=Object(on.injectable)(),Wb(Gb=function(e){Object(qr.a)(t,e);var r=gR(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"fontAtlas",void 0),Object(L.a)(Object(De.a)(n),"iconFontMap",void 0),Object(L.a)(Object(De.a)(n),"iconFontGlyphs",{}),Object(L.a)(Object(De.a)(n),"fontOptions",void 0),Object(L.a)(Object(De.a)(n),"key",void 0),Object(L.a)(Object(De.a)(n),"cache",new Qu(wR)),n}return Object(Rt.a)(t,[{key:"scale",get:function(){return Yb}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:bR,fontWeight:xR,characterSet:_R,fontSize:ER,buffer:SR,sdf:!0,cutoff:AR,radius:TR,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(o){a.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=Object(we.a)(Object(we.a)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&a.length===0)){var l=this.generateFontAtlas(this.key,a,o);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var o=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){o.emit("fontloaded",{fontFamily:i})})}catch(c){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(c)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,o){var l=this.fontOptions,c=l.fontFamily,h=l.fontWeight,_=l.fontSize,x=l.buffer,E=l.sdf,C=l.radius,I=l.cutoff,P=l.iconfont,B=o&&o.data;B||(B=window.document.createElement("canvas"),B.width=$b);var U=B.getContext("2d",{willReadFrequently:!0});Kb(U,c,_,h);var ee=dR(Object(we.a)({getFontWidth:function(wa){return U.measureText(wa).width},fontHeight:_*Yb,buffer:x,characterSet:a,maxCanvasWidth:$b},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),ie=ee.mapping,_e=ee.canvasHeight,Oe=ee.xOffset,ke=ee.yOffset,Ke=U.getImageData(0,0,B.width,B.height);if(B.height=_e,U.putImageData(Ke,0,0),Kb(U,c,_,h),E){var ot=new hR.a(_,x,C,I,c,h),Ot=U.getImageData(0,0,ot.size,ot.size),Zt=Xb(a),ir;try{for(Zt.s();!(ir=Zt.n()).done;){var Hr=ir.value;if(P){var ln=String.fromCharCode(parseInt(Hr.replace("&#x","").replace(";",""),16)),pn=ot.draw(ln);qb(pn,Ot)}else qb(ot.draw(Hr),Ot);U.putImageData(Ot,ie[Hr].x,ie[Hr].y)}}catch(La){Zt.e(La)}finally{Zt.f()}}else{var Ci=Xb(a),Ba;try{for(Ci.s();!(Ba=Ci.n()).done;){var Sa=Ba.value;U.fillText(Sa,ie[Sa].x,ie[Sa].y+_*CR)}}catch(La){Ci.e(La)}finally{Ci.f()}}return{xOffset:Oe,yOffset:ke,mapping:ie,data:B,width:B.width,height:B.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,o=i.fontWeight;return"".concat(a,"_").concat(o)}},{key:"getNewChars",value:function(i,a){var o=this.cache.get(i);if(!o)return a;var l=[],c=o.mapping,h=new Set(Object.keys(c)),_=new Set(a);return _.forEach(function(x){h.has(x)||l.push(x)}),l}}]),t}(uo.EventEmitter))||Gb),Qb,Jb;function MR(e){var r=PR();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function PR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IR=3,ex=1024,gg=64,kR=(Qb=Object(on.injectable)(),Qb(Jb=function(e){Object(qr.a)(t,e);var r=MR(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"canvasHeight",128),Object(L.a)(Object(De.a)(n),"texture",void 0),Object(L.a)(Object(De.a)(n),"canvas",void 0),Object(L.a)(Object(De.a)(n),"iconData",void 0),Object(L.a)(Object(De.a)(n),"iconMap",void 0),Object(L.a)(Object(De.a)(n),"ctx",void 0),Object(L.a)(Object(De.a)(n),"loadingImageCount",0),n}return Object(Rt.a)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o,l){var c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=new Image,this.loadingImageCount++,this.hasImage(o)?console.warn("Image Id already exists"):this.iconData.push({id:o,size:gg}),this.updateIconMap(),x.next=6,this.loadImage(l);case 6:c=x.sent,h=this.iconData.find(function(E){return E.id===o}),h&&(h.image=c,h.width=c.width,h.height=c.height),this.update();case 10:case"end":return x.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,o){var l=this,c=o.getSceneConfig().canvas,h=c.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:gg}),this.updateIconMap(),this.loadImageMini(a,c).then(function(_){h=_;var x=l.iconData.find(function(E){return E.id===i});x&&(x.image=h,x.width=h.width,x.height=h.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,o){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){o(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=ex,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var o=i.iconMap[a],l=o.x,c=o.y,h=o.image,_=o.width,x=_===void 0?64:_,E=o.height,C=E===void 0?64:E,I=Math.max(x,C),P=I/gg,B=C/P,U=x/P;h&&i.ctx.drawImage(h,l+(gg-U)/2,c+(gg-B)/2,U,B)})}},{key:"updateIconMap",value:function(){var i=vR(this.iconData,IR,ex),a=i.mapping,o=i.canvasHeight;this.iconMap=a,this.canvasHeight=o}},{key:"loadImageMini",value:function(i,a){return new Promise(function(o,l){var c=a.createImage();c.crossOrigin="anonymous",c.onload=function(){o(c)},c.onerror=function(){l(new Error("Could not load image at "+i))},c.src=i})}}]),t}(uo.EventEmitter))||Jb),tx,rx,DR=(tx=Object(on.injectable)(),tx(rx=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"viewport",void 0),Object(L.a)(this,"overridedViewProjectionMatrix",void 0),Object(L.a)(this,"jitteredViewProjectionMatrix",void 0),Object(L.a)(this,"jitteredProjectionMatrix",void 0),Object(L.a)(this,"viewMatrixInverse",void 0),Object(L.a)(this,"cameraPosition",void 0)}return Object(Rt.a)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=N.create(),N.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=Object(Bn.a)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=N.fromTranslation(N.create(),[t,n,0]);this.jitteredProjectionMatrix=N.multiply(N.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=N.multiply(N.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||rx),Zd=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),nx,ix;function FR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=BR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function BR(e,r){if(!!e){if(typeof e=="string")return ax(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ax(e,r)}}function ax(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var LR={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},NR=(nx=Object(on.injectable)(),nx(ix=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"container",void 0),Object(L.a)(this,"controlCorners",void 0),Object(L.a)(this,"controlContainer",void 0),Object(L.a)(this,"scene",void 0),Object(L.a)(this,"mapsService",void 0),Object(L.a)(this,"controls",[]),Object(L.a)(this,"unAddControls",[])}return Object(Rt.a)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Qt.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Qt.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=FR(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=j.create("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],c=l.map(function(h){return n+h}).join(" ");t[l.filter(function(h){return!["row","column"].includes(h)}).join("")]=j.create("div",c,i)}function o(l){var c=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat(Object(cr.a)(c),[LR[l]])}Object.values(Zd).forEach(function(l){a(o(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&j.remove(this.controlCorners[t]);this.controlContainer&&j.remove(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(!!n)for(var i=function(){var c=o[a],h=c.match(/^(top|bottom)(left|right)$/);if(h){var _=Object(Bn.a)(h,3),x=_[1],E=_[2],C=t.controlCorners["".concat(x).concat(E)],I=new n(function(P){var B=Object(Bn.a)(P,1),U=B[0].target;C&&(C.style[x]=U.clientHeight+"px")});I.observe(t.controlCorners["".concat(E).concat(x)],{childList:!0,attributes:!0})}},a=0,o=Object.keys(this.controlCorners);a<o.length;a++)i()}}]),e}())||ix),ox,sx,jR=(ox=Object(on.injectable)(),ox(sx=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"container",void 0),Object(L.a)(this,"scene",void 0),Object(L.a)(this,"mapsService",void 0),Object(L.a)(this,"markers",[]),Object(L.a)(this,"markerLayers",[]),Object(L.a)(this,"unAddMarkers",[]),Object(L.a)(this,"unAddMarkerLayers",[])}return Object(Rt.a)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Qt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||sx),ux,lx,zR=(ux=Object(on.injectable)(),ux(lx=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"scene",void 0),Object(L.a)(this,"mapsService",void 0),Object(L.a)(this,"popups",[]),Object(L.a)(this,"unAddPopups",[])}return Object(Rt.a)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat(Object(cr.a)(this.popups),Object(cr.a)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Qt.IMapService)}}]),e}())||lx),Zp=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),$d=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),zy=function(e){return e.AND="and",e.OR="or",e}({}),vu=function(e){return e.INIT="init",e.UPDATE="update",e}({}),UR={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},VR=UR,cx,fx,HR=xi.merge,WR={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},GR={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:zy.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},XR=(cx=Object(on.injectable)(),cx(fx=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"sceneConfigCache",{}),Object(L.a)(this,"layerConfigCache",{}),Object(L.a)(this,"layerAttributeConfigCache",{})}return Object(Rt.a)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return VR[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=Object(we.a)(Object(we.a)({},WR),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=Object(we.a)({},HR({},this.sceneConfigCache[t],GR,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=Object(we.a)(Object(we.a)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||fx);function ga(e,r,t,n){!t||Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function ma(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(o,l){return l(e,r,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}function xW(e,r){throw new Error("Decorating class property failed. Please ensure that transform-class-properties is enabled and runs after the decorators transform.")}var V_=Math.PI/180,ZR=512,hx=4003e4;function px(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,o=e.highPrecision,l=o===void 0?!1:o,c=e.flipY,h=c===void 0?!1:c;a=a!==void 0?a:Math.pow(2,i);var _={},x=ZR*a,E=Math.cos(t*V_),C=x/360,I=C/E,P=x/hx/E;if(_.pixelsPerMeter=[P,-P,P],_.metersPerPixel=[1/P,-1/P,1/P],_.pixelsPerDegree=[C,-I,P],_.degreesPerPixel=[1/C,-1/I,1/P],l){var B=V_*Math.tan(t*V_)/E,U=C*B/2,ee=x/hx*B,ie=ee/I*P;_.pixelsPerDegree2=[0,-U,ee],_.pixelsPerMeter2=[ie,0,ie],h&&(_.pixelsPerDegree2[1]=-_.pixelsPerDegree2[1],_.pixelsPerMeter2[1]=-_.pixelsPerMeter2[1])}return h&&(_.pixelsPerMeter[1]=-_.pixelsPerMeter[1],_.metersPerPixel[1]=-_.metersPerPixel[1],_.pixelsPerDegree[1]=-_.pixelsPerDegree[1],_.degreesPerPixel[1]=-_.degreesPerPixel[1]),_}var ec=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),Yd={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},dx,vx,mx,H_,gx,$R=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],YR=(dx=Object(on.injectable)(),vx=Object(on.inject)(Qt.ICameraService),dx(mx=(H_=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"needRefresh",!0),ga(this,"cameraService",gx,this),Object(L.a)(this,"coordinateSystem",void 0),Object(L.a)(this,"viewportCenter",void 0),Object(L.a)(this,"viewportCenterProjection",void 0),Object(L.a)(this,"pixelsPerDegree",void 0),Object(L.a)(this,"pixelsPerDegree2",void 0),Object(L.a)(this,"pixelsPerMeter",void 0)}return Object(Rt.a)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),o=px({latitude:a[1],zoom:n}),l=o.pixelsPerMeter,c=o.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ec.LNGLAT||this.coordinateSystem===ec.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ec.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===ec.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var o=px({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=o.pixelsPerMeter,c=o.pixelsPerDegree,h=o.pixelsPerDegree2,_=this.cameraService.getViewMatrix(),x=this.cameraService.getProjectionMatrix(),E=N.multiply([],x,_),C=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=W.transformMat4([],[C[0],C[1],0,1],E),_=this.cameraService.getViewMatrixUncentered()||_,E=N.multiply([],x,_),E=N.multiply([],E,$R),this.cameraService.setViewProjectionMatrix(E),this.pixelsPerMeter=l,this.pixelsPerDegree=c,this.pixelsPerDegree2=h}}]),e}(),gx=ma(H_.prototype,"cameraService",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_))||mx),yx,_x;function KR(e){var r=qR();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function qR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QR=(yx=Object(on.injectable)(),yx(_x=function(e){Object(qr.a)(t,e);var r=KR(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"renderMap",new Map),Object(L.a)(Object(De.a)(n),"enable",!1),Object(L.a)(Object(De.a)(n),"renderEnable",!1),Object(L.a)(Object(De.a)(n),"cacheLogs",{}),n}return Object(Rt.a)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var o=this;if(!!this.enable){var l=i.split("."),c=null;l.forEach(function(h,_){c!==null?(c[h]||(c[h]={}),_!==l.length-1&&(c=c[h])):(o.cacheLogs[h]||(o.cacheLogs[h]={}),_!==l.length-1&&(c=o.cacheLogs[h])),_===l.length-1&&(c[h]=Object(we.a)(Object(we.a)({time:Date.now()},c[h]),a))})}}},{key:"getLog",value:function(i){var a=this;switch(Object(El.a)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(o){return a.cacheLogs[o]}).filter(function(o){return o!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?hi():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,Object(we.a)(Object(we.a)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var o=a.renderStart,l=Date.now();this.emit("renderEnd",Object(we.a)(Object(we.a)({},a),{},{renderEnd:l,renderDuration:l-o})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(uo.EventEmitter))||_x),JR=O("yLV6"),yg=O.n(JR),Sl=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),bx,xx,Ex,W_,Sx;function eM(e){var r=tM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function tM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rM={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},nM=(bx=Object(on.injectable)(),xx=Object(on.inject)(Qt.IMapService),bx(Ex=(W_=function(e){Object(qr.a)(t,e);var r=eM(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"indragging",!1),ga(Object(De.a)(n),"mapService",Sx,Object(De.a)(n)),Object(L.a)(Object(De.a)(n),"hammertime",void 0),Object(L.a)(Object(De.a)(n),"lastClickTime",0),Object(L.a)(Object(De.a)(n),"lastClickXY",[-1,-1]),Object(L.a)(Object(De.a)(n),"clickTimer",void 0),Object(L.a)(Object(De.a)(n),"$containter",void 0),Object(L.a)(Object(De.a)(n),"onDrag",function(l){var c=n.interactionEvent(l);c.type=rM[c.type],c.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(Sl.Drag,c)}),Object(L.a)(Object(De.a)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var c=n.interactionEvent(l);n.emit(Sl.Hover,c)}),Object(L.a)(Object(De.a)(n),"onTouch",function(l){var c=l.touches[0];n.onHover({x:c.pageX,y:c.pageY,type:"touch"})}),Object(L.a)(Object(De.a)(n),"onHover",function(l){var c=l.clientX,h=l.clientY,_=c,x=h,E=l.type,C=n.mapService.getMapContainer();if(C){var I=C.getBoundingClientRect(),P=I.top,B=I.left;_=_-B-C.clientLeft,x=x-P-C.clientTop}var U=n.mapService.containerToLngLat([_,x]);if(E==="click"){n.isDoubleTap(_,x,U);return}if(E==="touch"){n.isDoubleTap(_,x,U);return}E!=="click"&&E!=="dblclick"&&n.emit(Sl.Hover,{x:_,y:x,lngLat:U,type:E,target:l})}),n}return Object(Rt.a)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(Sl.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,o=i.y;this.emit(Sl.Hover,{x:a,y:o})}},{key:"triggerSelect",value:function(i){this.emit(Sl.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(Sl.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new yg.a.Manager(i);a.add(new yg.a.Tap({event:"dblclick",taps:2})),a.add(new yg.a.Tap({event:"click"})),a.add(new yg.a.Pan({threshold:0,pointers:0})),a.add(new yg.a.Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,o=i.pointerType,l,c;o==="touch"?(c=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(c=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var h=this.mapService.getMapContainer();if(h){var _=h.getBoundingClientRect(),x=_.top,E=_.left;l-=E,c-=x}var C=this.mapService.containerToLngLat([l,c]);return{x:l,y:c,lngLat:C,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,o){var l=this,c=new Date().getTime(),h="click";c-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),h="dblclick",this.emit(Sl.Hover,{x:i,y:a,lngLat:o,type:h})):(this.lastClickTime=c,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){h="click",l.emit(Sl.Hover,{x:i,y:a,lngLat:o,type:h})},400))}}]),t}(nu.a),Sx=ma(W_.prototype,"mapService",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_))||Ex),iM=0;function aM(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(iM++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function oM(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,o=Array.from(i.classList);if(o.includes("l7-marker")||o.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var Z=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),Ax,Tx,Cx,Ox,Rx,Mx,Px,Kd,Ix,kx,Dx,Fx,Bx,sM=(Ax=Object(on.injectable)(),Tx=Object(on.inject)(Qt.IMapService),Cx=Object(on.inject)(Qt.IRendererService),Ox=Object(on.inject)(Qt.IGlobalConfigService),Rx=Object(on.inject)(Qt.IInteractionService),Mx=Object(on.inject)(Qt.ILayerService),Ax(Px=(Kd=function(){function e(){var r=this;Object(Et.a)(this,e),Object(L.a)(this,"pickedColors",void 0),Object(L.a)(this,"pickedTileLayers",[]),ga(this,"mapService",Ix,this),ga(this,"rendererService",kx,this),ga(this,"configService",Dx,this),ga(this,"interactionService",Fx,this),ga(this,"layerService",Bx,this),Object(L.a)(this,"pickingFBO",void 0),Object(L.a)(this,"width",0),Object(L.a)(this,"height",0),Object(L.a)(this,"alreadyInPicking",!1),Object(L.a)(this,"pickBufferScale",1),Object(L.a)(this,"pickFromPickingFBO",function(t,n){var i=n.x,a=n.y,o=n.lngLat,l=n.type,c=n.target,h=!1,_=r.rendererService,x=_.readPixels,E=_.getContainer,C=r.getContainerSize(E()),I=C.width,P=C.height;I*=j.DPR,P*=j.DPR;var B=t.getLayerConfig(),U=B.enableHighlight,ee=B.enableSelect,ie=i*j.DPR,_e=a*j.DPR;if(ie>I-1*j.DPR||ie<0||_e>P-1*j.DPR||_e<0)return!1;var Oe=x({x:Math.floor(ie/r.pickBufferScale),y:Math.floor((P-(a+1)*j.DPR)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=Oe,Oe[0]!==0||Oe[1]!==0||Oe[2]!==0){var ke=qs(Oe),Ke=t.layerPickService.getFeatureById(ke);ke!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var ot={x:i,y:a,type:l,lngLat:o,featureId:ke,feature:Ke,target:c};Ke&&(h=!0,t.setCurrentPickId(ke),r.triggerHoverOnLayer(t,ot))}else{var Ot={x:i,y:a,lngLat:o,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:c,feature:null};r.triggerHoverOnLayer(t,Object(we.a)(Object(we.a)({},Ot),{},{type:"unpick"})),r.triggerHoverOnLayer(t,Ot),t.setCurrentPickId(null)}if(U&&t.layerPickService.highlightPickedFeature(Oe),ee&&l==="click"&&(Oe==null?void 0:Oe.toString())!==[0,0,0,0].toString()){var Zt=qs(Oe);t.getCurrentSelectedId()===null||Zt!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(Oe),t.setCurrentSelectedId(Zt)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return h})}return Object(Rt.a)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,o=n.getContainer,l=this.getContainerSize(o()),c=l.width,h=l.height;c*=j.DPR,h*=j.DPR,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=a({color:i({width:Math.round(c/this.pickBufferScale),height:Math.round(h/this.pickBufferScale),wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.interactionService.on(Sl.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a,o){var l=this,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:c=this.rendererService,h=c.useFramebuffer,_=c.clear,this.resizePickingFBO(),h(this.pickingFBO,function(){_({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var C=l.pickBox(i,a);o(C)});case 3:case"end":return E.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(Zt){var ir=Zt<0?0:Zt;return Math.floor(ir*j.DPR/i.pickBufferScale)}),o=Object(Bn.a)(a,4),l=o[0],c=o[1],h=o[2],_=o[3],x=this.rendererService,E=x.readPixels,C=x.getContainer,I=this.getContainerSize(C()),P=I.width,B=I.height;if(P*=j.DPR,B*=j.DPR,l>(P-1)*j.DPR/this.pickBufferScale||h<0||c>(B-1)*j.DPR/this.pickBufferScale||_<0)return[];for(var U=Math.min(P/this.pickBufferScale,h)-l,ee=Math.min(B/this.pickBufferScale,_)-c,ie=E({x:l,y:Math.floor(B/this.pickBufferScale-(_+1)),width:U,height:ee,data:new Uint8Array(U*ee*4),framebuffer:this.pickingFBO}),_e=[],Oe={},ke=0;ke<ie.length/4;ke=ke+1){var Ke=ie.slice(ke*4,ke*4+4),ot=qs(Ke);if(ot!==-1&&!Oe[ot]){var Ot=t.layerPickService.getFeatureById(ot);_e.push(Object(we.a)(Object(we.a)({},Ot),{},{pickedFeatureIdx:ot})),Oe[ot]=!0}}return _e}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,o=a===void 0?"":a,l=i.cursorEnabled;if(l){var c=this.mapService.version,h=c==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),_=h==null?void 0:h.style.getPropertyValue("cursor");n==="unmousemove"&&_!==""?h==null||h.style.setProperty("cursor",""):n==="mousemove"&&(h==null||h.style.setProperty("cursor",o))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/j.DPR,height:t.height/j.DPR}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){o.next=2;break}return o.abrupt("return");case 2:return this.alreadyInPicking=!0,o.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=j.DPR,a*=j.DPR,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){var a=this,o,l,c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=this.rendererService,l=o.useFramebuffer,c=o.clear,this.resizePickingFBO(),l(this.pickingFBO,function(){var x=a.layerService.getRenderList();x.filter(function(E){return E.needPick(i.type)}).reverse().some(function(E){c({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),E.layerPickService.pickRender(i);var C=a.pickFromPickingFBO(E,i);return a.layerService.pickedLayerId=C?+E.id:-1,C&&!E.getLayerConfig().enablePropagation})});case 3:case"end":return _.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){oM(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),Ix=ma(Kd.prototype,"mapService",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=ma(Kd.prototype,"rendererService",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=ma(Kd.prototype,"configService",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=ma(Kd.prototype,"interactionService",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=ma(Kd.prototype,"layerService",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd))||Px),uM=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;Object(Et.a)(this,e),Object(L.a)(this,"autoStart",void 0),Object(L.a)(this,"startTime",0),Object(L.a)(this,"oldTime",0),Object(L.a)(this,"running",!1),Object(L.a)(this,"elapsedTime",0),this.autoStart=r}return Object(Rt.a)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Lx,Nx,jx,zx,Ux,_g,Vx,Hx,Wx;function G_(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=lM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function lM(e,r){if(!!e){if(typeof e=="string")return Gx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Gx(e,r)}}function Gx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function cM(e){var r=fM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function fM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xx=xi.throttle,hM=(Lx=Object(on.injectable)(),Nx=Object(on.inject)(Qt.IRendererService),jx=Object(on.inject)(Qt.IMapService),zx=Object(on.inject)(Qt.IDebugService),Lx(Ux=(_g=function(e){Object(qr.a)(t,e);var r=cM(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"pickedLayerId",-1),Object(L.a)(Object(De.a)(n),"clock",new uM),Object(L.a)(Object(De.a)(n),"alreadyInRendering",!1),Object(L.a)(Object(De.a)(n),"layers",[]),Object(L.a)(Object(De.a)(n),"layerList",[]),Object(L.a)(Object(De.a)(n),"layerRenderID",void 0),Object(L.a)(Object(De.a)(n),"sceneInited",!1),Object(L.a)(Object(De.a)(n),"animateInstanceCount",0),Object(L.a)(Object(De.a)(n),"shaderPicking",!0),Object(L.a)(Object(De.a)(n),"enableRender",!0),ga(Object(De.a)(n),"renderService",Vx,Object(De.a)(n)),ga(Object(De.a)(n),"mapService",Hx,Object(De.a)(n)),ga(Object(De.a)(n),"debugService",Wx,Object(De.a)(n)),Object(L.a)(Object(De.a)(n),"reRender",Xx(function(){n.renderLayers()},32)),Object(L.a)(Object(De.a)(n),"throttleRenderLayers",Xx(function(){n.renderLayers()},16)),n}return Object(Rt.a)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o=this;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var h=Object(Xt.a)(he.a.mark(function _(x){return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(x.startInit){C.next=4;break}return C.next=3,x.init();case 3:o.updateLayerRenderList();case 4:case"end":return C.stop()}},_)}));return function(_){return h.apply(this,arguments)}}());case 2:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o,l){var c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:l?(c=l.layerChildren.indexOf(o),c>-1&&l.layerChildren.splice(c,1)):(h=this.layers.indexOf(o),h>-1&&this.layers.splice(h,1)),o.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return x.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){C.next=2;break}return C.abrupt("return");case 2:this.updateLayerRenderList(),o=this.debugService.generateRenderUid(),this.debugService.renderStart(o),this.alreadyInRendering=!0,this.clear(),this.renderService.beginFrame(),l=G_(this.layerList),C.prev=9,l.s();case 11:if((c=l.n()).done){C.next=24;break}if(h=c.value,_=h.getLayerConfig(),x=_.enableMask,h.masks.filter(function(I){return I.inited}).length>0&&x&&this.renderMask(h.masks),!h.getLayerConfig().enableMultiPassRenderer){C.next=20;break}return C.next=18,h.renderMultiPass();case 18:C.next=22;break;case 20:return C.next=22,h.render();case 22:C.next=11;break;case 24:C.next=29;break;case 26:C.prev=26,C.t0=C.catch(9),l.e(C.t0);case 29:return C.prev=29,l.f(),C.finish(29);case 32:this.renderService.endFrame(),this.debugService.renderEnd(o),this.alreadyInRendering=!1;case 35:case"end":return C.stop()}},a,this,[[9,26,29,32]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var o=i.length>1?$d.MULTIPLE:$d.SINGLE,l=G_(i),c;try{for(l.s();!(c=l.n()).done;){var h=c.value;h.render({isStencil:!0,stencilType:o,stencilIndex:a++})}}catch(_){l.e(_)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,o.hooks.beforeRenderData.promise();case 2:l=h.sent,l&&this.renderLayers();case 4:case"end":return h.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,o=i.getLayerConfig(),l=o.enableMask,c=l===void 0?!0:l,h=i.tileMask?1:0,_=i.masks.filter(function(P){return P.inited});h=h+(c?_.length:1);var x=h>1?$d.MULTIPLE:$d.SINGLE;if((i.tileMask||_.length&&c)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),_.length&&c){var E=G_(_),C;try{for(E.s();!(C=E.n()).done;){var I=C.value;I.render({isStencil:!0,stencilType:x,stencilIndex:a++})}}catch(P){E.e(P)}finally{E.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:x,stencilIndex:a++,stencilOperation:zy.OR})}},{key:"renderTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.renderTileLayerMask(o),!o.getLayerConfig().enableMultiPassRenderer){c.next=6;break}return c.next=4,o.renderMultiPass();case 4:c.next=8;break;case 6:return c.next=8,o.render();case 8:case"end":return c.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,o){return a.zIndex-o.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=oa(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(uo.EventEmitter),Vx=ma(_g.prototype,"renderService",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hx=ma(_g.prototype,"mapService",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=ma(_g.prototype,"debugService",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_g))||Ux),Th=O("Ff2n"),pM=xi.isNil,dM=function(){function e(r){var t=this;Object(Et.a)(this,e),Object(L.a)(this,"name",void 0),Object(L.a)(this,"type",void 0),Object(L.a)(this,"scale",void 0),Object(L.a)(this,"descriptor",void 0),Object(L.a)(this,"featureBufferLayout",[]),Object(L.a)(this,"needRescale",!1),Object(L.a)(this,"needRemapping",!1),Object(L.a)(this,"needRegenerateVertices",!1),Object(L.a)(this,"featureRange",{startIndex:0,endIndex:Infinity}),Object(L.a)(this,"vertexAttribute",void 0),Object(L.a)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,o){var l,c=(l=t.scale)===null||l===void 0?void 0:l.scalers[o].func,h=c(a);return h})}),this.setProps(r)}return Object(Rt.a)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,Object(cr.a)(t));if(!pM(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),vM=["buffer","update","name"],mM=["buffer","update","name"],bg,Zx,$x,Yx,X_,Kx,gM=(bg={},Object(L.a)(bg,Z.FLOAT,4),Object(L.a)(bg,Z.UNSIGNED_BYTE,1),Object(L.a)(bg,Z.UNSIGNED_SHORT,2),bg),yM=(Zx=Object(on.injectable)(),$x=Object(on.inject)(Qt.IRendererService),Zx(Yx=(X_=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"attributesAndIndices",void 0),ga(this,"rendererService",Kx,this),Object(L.a)(this,"attributes",[]),Object(L.a)(this,"triangulation",void 0),Object(L.a)(this,"featureLayout",{sizePerElement:0,elements:[]})}return Object(Rt.a)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new dM(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,o=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||o&&t[o])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute(Object(we.a)(Object(we.a)({},n),{},{name:t})));var o=n.scale;o&&a&&(a.scale=o,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(Oe){return Oe.name===t});if(l&&l.descriptor){var c=l.descriptor,h=c.update,_=c.buffer,x=c.size,E=x===void 0?0:x,C=gM[_.type||Z.FLOAT];if(h){var I=this.featureLayout,P=I.elements,B=I.sizePerElement,U=P.slice(i,a);if(!U.length)return;var ee=U[0].offset,ie=ee*E*C,_e=U.map(function(Oe,ke){for(var Ke=Oe.featureIdx,ot=Oe.vertices,Ot=Oe.normals,Zt=ot.length/B,ir=[],Hr=0;Hr<Zt;Hr++){var ln=Ot?Ot.slice(Hr*3,Hr*3+3):[];ir.push.apply(ir,Object(cr.a)(h(n[Ke],Ke,ot.slice(Hr*B,Hr*B+B),ke,ln)))}return ir}).reduce(function(Oe,ke){return Oe.push.apply(Oe,Object(cr.a)(ke)),Oe},[]);l.vertexAttribute.updateBuffer({data:_e,offset:ie}),o==null||o.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var o=this.attributes.map(function(U){return U.resetDescriptor(),U.descriptor}),l=0,c=0,h=[],_=3;t.forEach(function(U,ee){var ie=a.triangulation(U,i),_e=ie.indices,Oe=ie.vertices,ke=ie.normals,Ke=ie.size,ot=ie.indexes,Ot=ie.count;typeof Ot=="number"&&(c+=Ot),_e.forEach(function(ln){h.push(ln+l)}),_=Ke;var Zt=Oe.length/Ke;a.featureLayout.sizePerElement=_,a.featureLayout.elements.push({featureIdx:ee,vertices:Oe,normals:ke,offset:l}),l+=Zt;for(var ir=function(pn){var Ci=(ke==null?void 0:ke.slice(pn*3,pn*3+3))||[],Ba=Oe.slice(pn*Ke,pn*Ke+Ke),Sa=0;ot&&ot[pn]!==void 0&&(Sa=ot[pn]),o.forEach(function(La,wa){if(La&&La.update){var Ds;(Ds=La.buffer.data).push.apply(Ds,Object(cr.a)(La.update(U,ee,Ba,pn,Ci,Sa)))}})},Hr=0;Hr<Zt;Hr++)ir(Hr)});var x=this.rendererService,E=x.createAttribute,C=x.createBuffer,I=x.createElements,P={};o.forEach(function(U,ee){if(U){var ie=U.buffer,_e=U.update,Oe=U.name,ke=Object(Th.a)(U,vM),Ke=E(Object(we.a)({buffer:C(ie)},ke));P[U.name||""]=Ke,a.attributes[ee].vertexAttribute=Ke}});var B=I({data:h,type:Z.UNSIGNED_INT,count:h.length});return this.attributesAndIndices={attributes:P,elements:B,count:c},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(C){return C.resetDescriptor(),C.descriptor}),o=0,l=[],c=3;t.forEach(function(C,I){var P=i.triangulation(C),B=P.indices,U=P.vertices,ee=P.normals,ie=P.size,_e=P.indexes;B.forEach(function(ot){l.push(ot+o)}),c=ie;var Oe=U.length/ie;i.featureLayout.sizePerElement=c,i.featureLayout.elements.push({featureIdx:I,vertices:U,normals:ee,offset:o}),o+=Oe;for(var ke=function(Ot){var Zt=(ee==null?void 0:ee.slice(Ot*3,Ot*3+3))||[],ir=U.slice(Ot*ie,Ot*ie+ie),Hr=0;_e&&_e[Ot]!==void 0&&(Hr=_e[Ot]),a.forEach(function(ln,pn){if(ln&&ln.update){var Ci;(Ci=ln.buffer.data).push.apply(Ci,Object(cr.a)(ln.update(C,I,ir,Ot,Zt,Hr)))}})},Ke=0;Ke<Oe;Ke++)ke(Ke)});var h=this.rendererService,_=h.createAttribute,x=h.createBuffer,E={};return a.forEach(function(C,I){if(C){var P=C.buffer,B=C.update,U=C.name,ee=Object(Th.a)(C,mM),ie=_(Object(we.a)({buffer:x(P)},ee));E[C.name||""]=ie,i.attributes[I].vertexAttribute=ie}}),{attributes:E}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),Kx=ma(X_.prototype,"rendererService",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_))||Yx),Al=O("xp6e"),qx=O("iegG"),_M=O.n(qx),Qx,Jx,eE,tE,rE,nE,iE,aE,oE,sE,uE,lE,cE,fE,hE,pE,dE,vE,Tu,mE,gE,yE,_E,bE,xE,EE,SE,AE,TE,CE,wE,OE,RE,ME,PE;function bM(e){var r=xM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function xM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=(Qx=Object(on.injectable)(),Jx=Object(on.inject)(Qt.SceneID),eE=Object(on.inject)(Qt.IIconService),tE=Object(on.inject)(Qt.IFontService),rE=Object(on.inject)(Qt.IControlService),nE=Object(on.inject)(Qt.IGlobalConfigService),iE=Object(on.inject)(Qt.IMapService),aE=Object(on.inject)(Qt.ICoordinateSystemService),oE=Object(on.inject)(Qt.IRendererService),sE=Object(on.inject)(Qt.ILayerService),uE=Object(on.inject)(Qt.IDebugService),lE=Object(on.inject)(Qt.ICameraService),cE=Object(on.inject)(Qt.IInteractionService),fE=Object(on.inject)(Qt.IPickingService),hE=Object(on.inject)(Qt.IShaderModuleService),pE=Object(on.inject)(Qt.IMarkerService),dE=Object(on.inject)(Qt.IPopupService),Qx(vE=(Tu=function(e){Object(qr.a)(t,e);var r=bM(t);function t(){var n;return Object(Et.a)(this,t),n=r.call(this),Object(L.a)(Object(De.a)(n),"destroyed",!1),Object(L.a)(Object(De.a)(n),"loaded",!1),ga(Object(De.a)(n),"id",mE,Object(De.a)(n)),ga(Object(De.a)(n),"iconService",gE,Object(De.a)(n)),ga(Object(De.a)(n),"fontService",yE,Object(De.a)(n)),ga(Object(De.a)(n),"controlService",_E,Object(De.a)(n)),ga(Object(De.a)(n),"configService",bE,Object(De.a)(n)),ga(Object(De.a)(n),"map",xE,Object(De.a)(n)),ga(Object(De.a)(n),"coordinateSystemService",EE,Object(De.a)(n)),ga(Object(De.a)(n),"rendererService",SE,Object(De.a)(n)),ga(Object(De.a)(n),"layerService",AE,Object(De.a)(n)),ga(Object(De.a)(n),"debugService",TE,Object(De.a)(n)),ga(Object(De.a)(n),"cameraService",CE,Object(De.a)(n)),ga(Object(De.a)(n),"interactionService",wE,Object(De.a)(n)),ga(Object(De.a)(n),"pickingService",OE,Object(De.a)(n)),ga(Object(De.a)(n),"shaderModuleService",RE,Object(De.a)(n)),ga(Object(De.a)(n),"markerService",ME,Object(De.a)(n)),ga(Object(De.a)(n),"popupService",PE,Object(De.a)(n)),Object(L.a)(Object(De.a)(n),"inited",!1),Object(L.a)(Object(De.a)(n),"initPromise",void 0),Object(L.a)(Object(De.a)(n),"rendering",!1),Object(L.a)(Object(De.a)(n),"$container",void 0),Object(L.a)(Object(De.a)(n),"canvas",void 0),Object(L.a)(Object(De.a)(n),"markerContainer",void 0),Object(L.a)(Object(De.a)(n),"hooks",void 0),Object(L.a)(Object(De.a)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),j.triggerResize(),n.coordinateSystemService.needRefresh=!0,n.render())}),Object(L.a)(Object(De.a)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new Al.b},n}return Object(Rt.a)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Object(Xt.a)(he.a.mark(function o(){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),c.next=3,new Promise(function(h){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),h()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(Sl.Drag,a.addSceneEvent.bind(a));case 10:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Object(Xt.a)(he.a.mark(function o(){var l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,c?a.$container=c:a.$container=aM(a.configService.getSceneConfig(a.id).id||""),!a.$container){x.next=13;break}return a.canvas=j.create("canvas","",a.$container),a.setCanvas(),x.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),_M()(a.$container,a.handleWindowResized),window.matchMedia&&((h=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||h===void 0||h.addListener(a.handleWindowResized)),x.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return x.stop()}},o)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",Object(Xt.a)(he.a.mark(function o(){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,new Promise(function(h){a.map.onCameraChanged(function(_){a.cameraService.init(),a.cameraService.update(_),a.map.version!=="GAODE2.x"&&h()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(Sl.Drag,a.addSceneEvent.bind(a));case 5:case"end":return c.stop()}},o)}))),this.hooks.init.tapPromise("initRenderer",Object(Xt.a)(he.a.mark(function o(){var l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){h.next=7;break}return h.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:h.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return h.stop()}},o)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return c=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],x.next=3,this.render();case 3:return h=o==="jpg"?c==null?void 0:c.toDataURL("image/jpeg"):c==null?void 0:c.toDataURL("image/png"),x.abrupt("return",h);case 5:case"end":return x.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=j.create("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if(Object(qx.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var o;(o=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||o===void 0||o.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,o=j.DPR,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,h=this.canvas;h&&(h.width=l*o,h.height=c*o),this.rendererService.viewport({x:0,y:0,width:o*l,height:o*c})}},{key:"setCanvas",value:function(){var i,a,o=j.DPR,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,c=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,h=this.canvas;h.width=l*o,h.height=c*o,h.style.width="100%",h.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(uo.EventEmitter),mE=ma(Tu.prototype,"id",[Jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=ma(Tu.prototype,"iconService",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yE=ma(Tu.prototype,"fontService",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_E=ma(Tu.prototype,"controlService",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE=ma(Tu.prototype,"configService",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=ma(Tu.prototype,"map",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=ma(Tu.prototype,"coordinateSystemService",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=ma(Tu.prototype,"rendererService",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=ma(Tu.prototype,"layerService",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TE=ma(Tu.prototype,"debugService",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE=ma(Tu.prototype,"cameraService",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE=ma(Tu.prototype,"interactionService",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=ma(Tu.prototype,"pickingService",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE=ma(Tu.prototype,"shaderModuleService",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=ma(Tu.prototype,"markerService",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PE=ma(Tu.prototype,"popupService",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu))||vE);function SM(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var IE=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function kE(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(IE,function(n,i,a){var o=a.split(":"),l=o[0].trim(),c="";switch(o.length>1&&(c=o[1].trim()),i){case"bool":c=c==="true";break;case"float":case"int":c=Number(c);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":c?c=c.replace("[","").replace("]","").split(",").reduce(function(h,_){return h.push(Number(_.trim())),h},[]):c=new Array(SM(i)).fill(0);break;default:}return t[l]=c,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function Z_(e){var r=kE(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,o){o=o.trim().replace(/^.*$/gm,function(_){return"uniform ".concat(_)});var l=kE(o),c=l.content,h=l.uniforms;return Object.assign(n,h),"".concat(a,`{
`).concat(c,`
};`)}),{content:t,uniforms:n}}function DE(e){var r={};return e.replace(IE,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var FE,BE,AM=xi.uniq,LE="#define PI 3.14159265359",TM=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,NE=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  mat4 u_Mvp;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  vec2 u_sceneCenterMercator;
  float u_FocalDistance;
};`,jE=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,CM=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,wM=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,OM=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,RM=`layout(location = 2) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,MM=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,zE=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,PM=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,IM=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,UE=/precision\s+(high|low|medium)p\s+float/,VE=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,kM=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,DM=/void\s+main\s*\([^)]*\)\s*\{\n?/,EW=/}\n?[^{}]*$/,FM=(FE=Object(on.injectable)(),FE(BE=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"moduleCache",{}),Object(L.a)(this,"rawContentCache",{})}return Object(Rt.a)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:LE,fs:LE}),this.registerModule("decode",{vs:TM,fs:""}),this.registerModule("scene_uniforms",{vs:NE,fs:NE}),this.registerModule("picking_uniforms",{vs:jE,fs:jE}),this.registerModule("projection",{vs:zE,fs:zE}),this.registerModule("project",{vs:MM,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:IM}),this.registerModule("lighting",{vs:wM,fs:""}),this.registerModule("light",{vs:CM,fs:""}),this.registerModule("picking",{vs:RM,fs:OM}),this.registerModule("rotation_2d",{vs:PM,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,o=n.uniforms,l=n.inject,c=Z_(i),h=c.content,_=c.uniforms,x=Z_(a),E=x.content,C=x.uniforms;this.rawContentCache[t]={fs:E,inject:l,uniforms:Object(we.a)(Object(we.a)(Object(we.a)({},_),C),o),vs:h}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,o=this.rawContentCache[t].inject,l={};o!=null&&o["vs:#decl"]&&(i=(o==null?void 0:o["vs:#decl"])+i,l=Z_(o==null?void 0:o["vs:#decl"]).uniforms),o!=null&&o["vs:#main-start"]&&(i=i.replace(DM,function(U){return U+(o==null?void 0:o["vs:#main-start"])})),o!=null&&o["fs:#decl"]&&(a=(o==null?void 0:o["fs:#decl"])+a);var c=this.processModule(i,[],"vs"),h=c.content,_=c.includeList,x=this.processModule(a,[],"fs"),E=x.content,C=x.includeList,I="",P=AM(_.concat(C).concat(t)).reduce(function(U,ee){return Object(we.a)(Object(we.a)({},U),n.rawContentCache[ee].uniforms)},Object(we.a)({},l));UE.test(E)||(I=I+VE),I=I+E;var B="";return UE.test(h)||(B=B+VE),B=B+h,this.moduleCache[t]={fs:I.trim(),uniforms:P,vs:B.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,o=t.replace(kM,function(l,c){var h=c.split(" "),_=h[0].replace(/"/g,"");if(n.indexOf(_)>-1)return"";var x=a.rawContentCache[_][i];n.push(_);var E=a.processModule(x,n,i),C=E.content;return C});return{content:o,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||BE),Ea=O("ReuC"),Kv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),HE,WE,Uy=(HE=Object(on.injectable)(),HE(WE=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"shaderModuleService",void 0),Object(L.a)(this,"rendererService",void 0),Object(L.a)(this,"cameraService",void 0),Object(L.a)(this,"mapService",void 0),Object(L.a)(this,"interactionService",void 0),Object(L.a)(this,"layerService",void 0),Object(L.a)(this,"config",void 0)}return Object(Rt.a)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Kv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Qt.IRendererService),this.cameraService=t.getContainer().get(Qt.ICameraService),this.mapService=t.getContainer().get(Qt.IMapService),this.interactionService=t.getContainer().get(Qt.IInteractionService),this.layerService=t.getContainer().get(Qt.ILayerService),this.shaderModuleService=t.getContainer().get(Qt.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||WE),GE,XE;function BM(e){var r=LM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function LM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NM=(GE=Object(on.injectable)(),GE(XE=function(e){Object(qr.a)(t,e);var r=BM(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Object(Ea.a)(Object(ut.a)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Uy))||XE),ZE,$E,YE,$_,KE;function jM(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zM(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function zM(e,r){if(!!e){if(typeof e=="string")return qE(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qE(e,r)}}function qE(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var UM=(ZE=Object(on.injectable)(),$E=Object(on.inject)(Qt.IPostProcessor),ZE(YE=($_=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"passes",[]),ga(this,"postProcessor",KE,this),Object(L.a)(this,"layer",void 0),Object(L.a)(this,"renderFlag",void 0),Object(L.a)(this,"width",0),Object(L.a)(this,"height",0)}return Object(Rt.a)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){var i,a,o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:i=jM(this.passes),c.prev=1,i.s();case 3:if((a=i.n()).done){c.next=9;break}return o=a.value,c.next=7,o.render(this.layer);case 7:c.next=3;break;case 9:c.next=14;break;case 11:c.prev=11,c.t0=c.catch(1),i.e(c.t0);case 14:return c.prev=14,i.f(),c.finish(14);case 17:return c.next=19,this.postProcessor.render(this.layer);case 19:case"end":return c.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===Kv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),KE=ma($_.prototype,"postProcessor",[$E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$_))||YE),QE,JE;function VM(e){var r=HM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function HM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WM=(QE=Object(on.injectable)(),QE(JE=function(e){Object(qr.a)(t,e);var r=VM(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"pickingFBO",void 0),Object(L.a)(Object(De.a)(n),"layer",void 0),Object(L.a)(Object(De.a)(n),"width",0),Object(L.a)(Object(De.a)(n),"height",0),Object(L.a)(Object(De.a)(n),"alreadyInRendering",!1),Object(L.a)(Object(De.a)(n),"pickFromPickingFBO",function(l){var c=l.x,h=l.y,_=l.lngLat,x=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(x))){var E=n.rendererService,C=E.getViewportSize,I=E.readPixels,P=E.useFramebuffer,B=C(),U=B.width,ee=B.height,ie=n.layer.getLayerConfig(),_e=ie.enableHighlight,Oe=ie.enableSelect,ke=c*j.DPR,Ke=h*j.DPR;if(!(ke>U||ke<0||Ke>ee||Ke<0)){var ot;P(n.pickingFBO,function(){var Ot;if(ot=I({x:Math.round(ke),y:Math.round(ee-(h+1)*j.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),ot[0]!==0||ot[1]!==0||ot[2]!==0){var Zt=qs(ot),ir=n.layer.getSource().getFeatureById(Zt),Hr={x:c,y:h,type:x,lngLat:_,featureId:Zt,feature:ir};ir&&(n.layer.setCurrentPickId(Zt),n.triggerHoverOnLayer(Hr))}else{var ln={x:c,y:h,lngLat:_,type:n.layer.getCurrentPickId()===null?"un"+x:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Object(we.a)(Object(we.a)({},ln),{},{type:"unpick"})),n.triggerHoverOnLayer(ln),n.layer.setCurrentPickId(null)}_e&&n.highlightPickedFeature(ot),Oe&&x==="click"&&((Ot=ot)===null||Ot===void 0?void 0:Ot.toString())!==[0,0,0,0].toString()&&n.selectFeature(ot)})}}}),n}return Object(Rt.a)(t,[{key:"getType",value:function(){return Kv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Object(Ea.a)(Object(ut.a)(t.prototype),"init",this).call(this,i,a),this.layer=i;var o=this.rendererService,l=o.createTexture2D,c=o.createFramebuffer,h=o.getViewportSize,_=h(),x=_.width,E=_.height;this.pickingFBO=c({color:l({width:x,height:E,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.interactionService.on(Sl.Hover,this.pickFromPickingFBO),this.interactionService.on(Sl.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(Sl.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var o=this.rendererService,l=o.getViewportSize,c=o.useFramebuffer,h=o.clear,_=l(),x=_.width,E=_.height;this.alreadyInRendering=!0,(this.width!==x||this.height!==E)&&(this.pickingFBO.resize({width:x,height:E}),this.width=x,this.height=E),c(this.pickingFBO,function(){h({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var C=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(C),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=Object(Bn.a)(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeHighlight.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=Object(Bn.a)(i,3),o=a[0],l=a[1],c=a[2];this.layer.hooks.beforeSelect.call([o,l,c]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,o=os(a);this.selectFeature(new Uint8Array(o))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,o=os(a);this.highlightPickedFeature(new Uint8Array(o))}}]),t}(Uy))||JE),e2,t2,r2,Y_,n2,GM=xi.camelCase,XM=xi.isNil,ZM=xi.upperFirst,$M=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,op=(e2=Object(on.injectable)(),t2=Object(on.inject)(Qt.IShaderModuleService),e2(r2=(Y_=function(){function e(){Object(Et.a)(this,e),ga(this,"shaderModuleService",n2,this),Object(L.a)(this,"rendererService",void 0),Object(L.a)(this,"config",void 0),Object(L.a)(this,"quad",$M),Object(L.a)(this,"enabled",!0),Object(L.a)(this,"renderToScreen",!1),Object(L.a)(this,"model",void 0),Object(L.a)(this,"name",void 0),Object(L.a)(this,"optionsToUpdate",{})}return Object(Rt.a)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return Kv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Qt.IRendererService),this.shaderModuleService=t.getContainer().get(Qt.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,o=i.createBuffer,l=i.createModel,c=this.setupShaders(),h=c.vs,_=c.fs,x=c.uniforms;this.model=l({vs:h,fs:_,attributes:{a_Position:a({buffer:o({data:[-4,-4,4,-4,0,4],type:Z.FLOAT}),size:2})},uniforms:Object(we.a)(Object(we.a)({u_Texture:null},x),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),o=this.rendererService,l=o.useFramebuffer,c=o.getViewportSize,h=o.clear,_=c(),x=_.width,E=_.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){h({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var C=Object(we.a)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[x,E]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(C.u_BloomFinal=1,C.u_Texture2=n),i.model.draw({uniforms:C})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=Object(we.a)(Object(we.a)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){XM(t[i])||(n["u_".concat(ZM(GM(i)))]=t[i])}),n}}]),e}(),n2=ma(Y_.prototype,"shaderModuleService",[t2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_))||r2),i2,a2;function YM(e){var r=KM();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function KM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qM=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,QM=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,K_=xi.isNil,JM=(i2=Object(on.injectable)(),i2(a2=function(e){Object(qr.a)(t,e);var r=YM(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:QM,fs:qM});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return K_(i.bloomRadius)||(a.u_radius=i.bloomRadius),K_(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),K_(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(op))||a2),o2,s2;function eP(e){var r=tP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function tP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rP=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,nP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,iP=xi.isNil,aP=(o2=Object(on.injectable)(),o2(s2=function(e){Object(qr.a)(t,e);var r=eP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:nP,fs:rP});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return iP(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(op))||s2),u2,l2;function oP(e){var r=sP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function sP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uP=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,lP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cP=xi.isNil,fP=(u2=Object(on.injectable)(),u2(l2=function(e){Object(qr.a)(t,e);var r=oP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:lP,fs:uP});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return cP(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(op))||l2),c2,f2;function hP(e){var r=pP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function pP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dP=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,vP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mP=(c2=Object(on.injectable)(),c2(f2=function(e){Object(qr.a)(t,e);var r=hP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:vP,fs:dP});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}}]),t}(op))||f2),h2,p2;function gP(e){var r=yP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function yP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _P=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,bP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xP=(h2=Object(on.injectable)(),h2(p2=function(e){Object(qr.a)(t,e);var r=gP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:bP,fs:_P}),this.shaderModuleService.getModule("copy-pass")}}]),t}(op))||p2),d2,v2;function EP(e){var r=SP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function SP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AP=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,TP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,CP=(d2=Object(on.injectable)(),d2(v2=function(e){Object(qr.a)(t,e);var r=EP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:TP,fs:AP});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}}]),t}(op))||v2),m2,g2;function wP(e){var r=OP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function OP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RP=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,MP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,PP=(m2=Object(on.injectable)(),m2(g2=function(e){Object(qr.a)(t,e);var r=wP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:MP,fs:RP});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService.getViewportSize(),h=c.width,_=c.height;return{vs:a,fs:o,uniforms:Object(we.a)(Object(we.a)({},l),{},{u_ViewportSize:[h,_]})}}}]),t}(op))||g2),y2,_2;function IP(e){var r=kP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function kP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var DP=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,FP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,BP=(y2=Object(on.injectable)(),y2(_2=function(e){Object(qr.a)(t,e);var r=IP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:FP,fs:DP}),this.shaderModuleService.getModule("noise-pass")}}]),t}(op))||_2),b2,x2;function LP(e){var r=NP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function NP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,zP=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,UP=(b2=Object(on.injectable)(),b2(x2=function(e){Object(qr.a)(t,e);var r=LP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:jP,fs:zP}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(op))||x2),E2,S2,A2,T2,qv,C2,VP=(E2=Object(on.injectable)(),S2=Object(on.inject)(Qt.IRendererService),A2=Object(on.postConstruct)(),E2(T2=(qv=function(){function e(){Object(Et.a)(this,e),ga(this,"rendererService",C2,this),Object(L.a)(this,"passes",[]),Object(L.a)(this,"readFBO",void 0),Object(L.a)(this,"writeFBO",void 0)}return Object(Rt.a)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),o=a.width,l=a.height;return i({x:0,y:0,width:o,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a){var o,l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.getReadFBOTex();case 2:o=h.sent,l=0;case 4:if(!(l<4)){h.next=11;break}return h.next=7,a.render(i,o);case 7:this.swap(),l++,h.next=4;break;case 11:case"end":return h.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){var a,o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:a=0;case 1:if(!(a<this.passes.length)){c.next=15;break}if(o=this.passes[a],o.setRenderToScreen(this.isLastEnabledPass(a)),o.getName()!=="bloom"){c.next=9;break}return c.next=7,this.renderBloomPass(i,o);case 7:c.next=12;break;case 9:return c.next=11,o.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,c.next=1;break;case 15:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),C2=ma(qv.prototype,"rendererService",[S2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ma(qv.prototype,"init",[A2],Object.getOwnPropertyDescriptor(qv.prototype,"init"),qv.prototype),qv))||T2),w2,O2;function HP(e){var r=WP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function WP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GP=(w2=Object(on.injectable)(),w2(O2=function(e){Object(qr.a)(t,e);var r=HP(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getType",value:function(){return Kv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Object(Ea.a)(Object(ut.a)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,o=a.useFramebuffer,l=a.clear,c=i.multiPassRenderer.getPostProcessor().getReadFBO();o(c,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(h){h.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Uy))||O2),R2,M2,P2,q_,I2;function XP(e){var r=ZP();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function ZP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $P=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,k2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,YP=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function D2(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var KP=1,qP=(R2=Object(on.injectable)(),M2=Object(on.inject)(Qt.IShaderModuleService),R2(P2=(q_=function(e){Object(qr.a)(t,e);var r=XP(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),ga(Object(De.a)(n),"shaderModuleService",I2,Object(De.a)(n)),Object(L.a)(Object(De.a)(n),"haltonSequence",[]),Object(L.a)(Object(De.a)(n),"accumulatingId",0),Object(L.a)(Object(De.a)(n),"frame",0),Object(L.a)(Object(De.a)(n),"timer",void 0),Object(L.a)(Object(De.a)(n),"sampleRenderTarget",void 0),Object(L.a)(Object(De.a)(n),"prevRenderTarget",void 0),Object(L.a)(Object(De.a)(n),"outputRenderTarget",void 0),Object(L.a)(Object(De.a)(n),"copyRenderTarget",void 0),Object(L.a)(Object(De.a)(n),"blendModel",void 0),Object(L.a)(Object(De.a)(n),"outputModel",void 0),Object(L.a)(Object(De.a)(n),"copyModel",void 0),n}return Object(Rt.a)(t,[{key:"getType",value:function(){return Kv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Object(Ea.a)(Object(ut.a)(t.prototype),"init",this).call(this,i,a);var o=this.rendererService,l=o.createFramebuffer,c=o.createTexture2D;this.sampleRenderTarget=l({color:c({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:c({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:c({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:c({width:1,height:1,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE})});for(var h=0;h<30;h++)this.haltonSequence.push([D2(h,2),D2(h,3)]);this.blendModel=this.createTriangleModel("blend-pass",$P),this.outputModel=this.createTriangleModel("copy-pass",k2,{blend:{enable:!0,func:{srcRGB:Z.ONE,dstRGB:Z.ONE_MINUS_SRC_ALPHA,srcAlpha:Z.ONE,dstAlpha:Z.ONE_MINUS_SRC_ALPHA},equation:{rgb:Z.FUNC_ADD,alpha:Z.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",k2)}},{key:"render",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,h=o.useFramebuffer,_=c(),x=_.width,E=_.height;this.sampleRenderTarget.resize({width:x,height:E}),this.prevRenderTarget.resize({width:x,height:E}),this.outputRenderTarget.resize({width:x,height:E}),this.copyRenderTarget.resize({width:x,height:E}),this.resetFrame(),this.stopAccumulating();var C=i.multiPassRenderer.getPostProcessor().getReadFBO();h(C,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:C}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var I=function P(B){!a.accumulatingId||B!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){P(B)}))};this.accumulatingId=KP++,this.timer=window.setTimeout(function(){I(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.getViewportSize,h=o.useFramebuffer,_=c(),x=_.width,E=_.height,C=i.getLayerConfig(),I=C.jitterScale,P=I===void 0?1:I,B=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((B[0]*2-1)/x*P,(B[1]*2-1)/E*P),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),h(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var U=i.getLayerConfig();h(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:U.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(h(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),h(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var ee=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ee,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,o){this.shaderModuleService.registerModule(i,{vs:YP,fs:a});var l=this.shaderModuleService.getModule(i),c=l.vs,h=l.fs,_=l.uniforms,x=this.rendererService,E=x.createAttribute,C=x.createBuffer,I=x.createModel;return I(Object(we.a)({vs:c,fs:h,attributes:{a_Position:E({buffer:C({data:[-4,-4,4,-4,0,4],type:Z.FLOAT}),size:2})},uniforms:Object(we.a)({},_),depth:{enable:!1},count:3},o))}}]),t}(Uy),I2=ma(q_.prototype,"shaderModuleService",[M2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_))||P2),xg=new on.Container;xg.bind(Qt.IGlobalConfigService).to(XR).inSingletonScope(),Object(on.decorate)(Object(on.injectable)(),uo.EventEmitter),xg.bind(Qt.IEventEmitter).to(uo.EventEmitter);var F2=cR()(xg,!1),Q_=function(r){var t=F2.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},SW=function(r){var t=F2.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},tc=xg,QP=0;function JP(){var e=new on.Container;return e.parent=xg,e.bind(Qt.SceneID).toConstantValue("".concat(QP++)),e.bind(Qt.IShaderModuleService).to(FM).inSingletonScope(),e.bind(Qt.ILayerService).to(hM).inSingletonScope(),e.bind(Qt.IDebugService).to(QR).inSingletonScope(),e.bind(Qt.ISceneService).to(EM).inSingletonScope(),e.bind(Qt.ICameraService).to(DR).inSingletonScope(),e.bind(Qt.ICoordinateSystemService).to(YR).inSingletonScope(),e.bind(Qt.IInteractionService).to(nM).inSingletonScope(),e.bind(Qt.IPickingService).to(sM).inSingletonScope(),e.bind(Qt.IControlService).to(NR).inSingletonScope(),e.bind(Qt.IMarkerService).to(jR).inSingletonScope(),e.bind(Qt.IIconService).to(kR).inSingletonScope(),e.bind(Qt.IFontService).to(RR).inSingletonScope(),e.bind(Qt.IPopupService).to(zR).inSingletonScope(),e.bind(Qt.INormalPass).to(NM).whenTargetNamed("clear"),e.bind(Qt.INormalPass).to(WM).whenTargetNamed("pixelPicking"),e.bind(Qt.INormalPass).to(GP).whenTargetNamed("render"),e.bind(Qt.INormalPass).to(qP).whenTargetNamed("taa"),e.bind(Qt.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Qt.INormalPass,t)}}),e.bind(Qt.IPostProcessingPass).to(xP).whenTargetNamed("copy"),e.bind(Qt.IPostProcessingPass).to(JM).whenTargetNamed("bloom"),e.bind(Qt.IPostProcessingPass).to(aP).whenTargetNamed("blurH"),e.bind(Qt.IPostProcessingPass).to(fP).whenTargetNamed("blurV"),e.bind(Qt.IPostProcessingPass).to(BP).whenTargetNamed("noise"),e.bind(Qt.IPostProcessingPass).to(UP).whenTargetNamed("sepia"),e.bind(Qt.IPostProcessingPass).to(mP).whenTargetNamed("colorHalftone"),e.bind(Qt.IPostProcessingPass).to(CP).whenTargetNamed("hexagonalPixelate"),e.bind(Qt.IPostProcessingPass).to(PP).whenTargetNamed("ink"),e.bind(Qt.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Qt.IPostProcessingPass,t);return n.setName(t),n}}),e}function Eg(e){var r=new on.Container;return r.parent=e,r.bind(Qt.IStyleAttributeService).to(yM).inSingletonScope(),r.bind(Qt.IMultiPassRenderer).to(UM).inSingletonScope(),r.bind(Qt.IPostProcessor).to(VP).inSingletonScope(),r}var eI=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function tI(e){return eI.indexOf(e)}var B2=xi.clamp,rI=2,AW=4,nI=64,TW=128,iI=256,aI=512,CW=8192,wW=16384,OW=32768,oI=32768*2,L2=131072,RW=262144,sI=524288,MW=1048576,uI=2097152,PW=4194304,lI=8388608,cI=16777216,fI=16777216*2;function Vy(e,r){return e=B2(Math.floor(e),0,255),r=B2(Math.floor(r),0,255),256*e+r}function IW(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,o=e.opacity,l=e.stroke,c=e.strokeWidth,h=e.strokeOpacity,_=[],x=[],E=[],C=[Vy(r[0],r[1]),Vy(r[2],r[3])],I=[Vy(l[0],l[1]),Vy(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(P){var B=Object(Bn.a)(P,2),U=B[0],ee=B[1];_.push([].concat(C,[(U+1)*lI+(ee+1)*uI+tI(a)*L2+t,(n+512)*sI+(i+512)*nI])),x.push([].concat(I,[c,h])),E.push([o,0,0,0])}),{packedBuffer:_,packedBuffer2:x,packedBuffer3:E}}function kW(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*fI+t*cI+n*L2+t*oI+n*aI+t*iI+n*rI+t}var qd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Gs={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},mo=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),Qv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Rn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),Jv=["mapload","mapchange","mapAfterFrameChange"],Hy=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Fu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),hI=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(c,h){n({x:t.x,y:t.y,z:t.z},function(_,x){if(_||x.length===0){h(_);return}x&&z_([{data:x,bands:[0]}],i,a,function(E,C){E?h(E):C&&c(C)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),pI=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n){return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(o,l){n({x:t.x,y:t.y,z:t.z},function(c,h){if(c||!h){l(c);return}h instanceof ArrayBuffer?_p(h,function(_,x){_&&l(_),o(x)}):h instanceof HTMLImageElement?o(h):l(c)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function dI(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return Ua(t,r)}):e.map(function(t){return{url:Ua(t.url,r),bands:t.bands||[0]}}):Ua(e,r)}function vI(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function N2(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var mI=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a,o){var l,c,h,_,x,E;return he.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(l=vI(n.url),!(l.length>1)){I.next=15;break}return I.next=4,gI(l,n);case 4:if(c=I.sent,h=c.rasterFiles,_=c.xhrList,x=c.errList,N2(t,_),!(x.length>0)){I.next=12;break}return i(x,null),I.abrupt("return");case 12:z_(h,a,o,i),I.next=17;break;case 15:E=Ns(n,function(P,B){if(P)i(P);else if(B){var U=[{data:B,bands:l[0].bands}];z_(U,a,o,i)}}),N2(t,[E]);case 17:case"end":return I.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}();function gI(e,r){return J_.apply(this,arguments)}function J_(){return J_=Object(Xt.a)(he.a.mark(function e(r,t){var n,i,a,o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:n=[],i=[],a=[],o=0;case 4:if(!(o<r.length)){P.next=20;break}return l=r[o],c=Object(we.a)(Object(we.a)({},t),{},{url:l.url}),h=l.bands,P.next=10,is(Object(we.a)(Object(we.a)({},c),{},{type:"arrayBuffer"}));case 10:_=P.sent,x=_.err,E=_.data,C=_.xhr,x&&a.push(x),i.push(C),n.push({data:E,bands:h});case 17:o++,P.next=4;break;case 20:return P.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return P.stop()}},e)})),J_.apply(this,arguments)}var yI=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a,o){var l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return l={url:dI(t,n)},h.abrupt("return",new Promise(function(_,x){mI(i,l,function(E,C){E?x(E):C&&_(C)},a,o)}));case 2:case"end":return h.stop()}},r)}));return function(t,n,i,a,o){return e.apply(this,arguments)}}(),j2=function(){var e=Object(Xt.a)(he.a.mark(function r(t,n,i,a){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(c=(a==null?void 0:a.getURLFromTemplate)||Pf,o=c(l,Object(we.a)(Object(we.a)({},n),a.wmtsOptions))):(h=(a==null?void 0:a.getURLFromTemplate)||Ua,o=h(l,n)),x.abrupt("return",new Promise(function(E,C){var I,P=qf({url:o,type:(a==null||(I=a.requestParameters)===null||I===void 0?void 0:I.type)||"arrayBuffer"},function(B,U){B?C(B):U&&E(U)},a.transformResponse);i.xhrCancel=function(){return P.cancel()}}));case 3:case"end":return x.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),z2=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},_I={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0,warp:!0},DW=[Fu.ARRAYBUFFER,Fu.RGB];function bI(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function xI(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(bI(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Fu.IMAGE;t===Fu.RGB&&(t=Fu.ARRAYBUFFER);var n=function(o,l){switch(t){case Fu.IMAGE:return j2(e,o,l,r);case Fu.CUSTOMIMAGE:case Fu.CUSTOMTERRAINRGB:return pI(l,r==null?void 0:r.getCustomData);case Fu.ARRAYBUFFER:return yI(e,o,l,(r==null?void 0:r.format)||z2,r==null?void 0:r.operation);case Fu.CUSTOMARRAYBUFFER:case Fu.CUSTOMRGB:return hI(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||z2,r==null?void 0:r.operation);default:return j2(e,o,l,r)}},i=Object(we.a)(Object(we.a)(Object(we.a)({},_I),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var EI=["extent","min","max","width","height","format","operation"];function SI(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,o=r.height,l=r.format,c=r.operation,h=Object(Th.a)(r,EI),_;if(l===void 0||ug(e))_=Array.from(e);else{var x=Array.isArray(e)?e:[e];_=N_(x,l,c)}var E={_id:1,dataArray:[Object(we.a)(Object(we.a)({_id:1,data:_,width:a,height:o},h),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return E}var AI={tileSize:256,minZoom:0,maxZoom:Infinity,zoomOffset:0},TI=function(){var e=Object(Xt.a)(he.a.mark(function r(t){return he.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var o=Object(Bn.a)(t.bounds,4),l=o[0],c=o[1],h=o[2],_=o[3],x={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+h)/2,y:(c+_)/2},geometry:{type:"LineString",coordinates:[[h,_],[h,c],[l,c],[l,c]]}}]}}};a(x)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function CI(e,r){var t=function(a){return TI(a)},n=Object(we.a)(Object(we.a)(Object(we.a)({},AI),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var wI=O("mpbz"),U2=O.n(wI);function V2(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,o=r.minZoom,l=o===void 0?0:o,c=r.zoom,h=c===void 0?2:c;if(e.pointIndex){var _=e.pointIndex.getClusters(e.extent,Math.floor(h));return e.dataArray=OI(_),e}var x=new U2.a({radius:n,minZoom:l,maxZoom:a}),E={type:"FeatureCollection",features:[]};return E.features=e.dataArray.map(function(C){return{type:"Feature",geometry:{type:"Point",coordinates:C.coordinates},properties:Object(we.a)({},C)}}),x.load(E.features),x}function OI(e){return e.map(function(r,t){return Object(we.a)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function RI(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function MI(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function H2(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function PI(e){if(e.length===0)throw new Error("mean requires at least one data point");return H2(e)/e.length}var II={min:MI,max:RI,mean:PI,sum:H2};function kI(e){var r=DI();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function DI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FI=xi.cloneDeep,W2=xi.isFunction,BI=xi.isString,LI=xi.mergeWith;function NI(e,r){if(Array.isArray(r))return r}var jI=function(e){Object(qr.a)(t,e);var r=kI(t);function t(n,i){var a;return Object(Et.a)(this,t),a=r.call(this),Object(L.a)(Object(De.a)(a),"type","source"),Object(L.a)(Object(De.a)(a),"isTile",!1),Object(L.a)(Object(De.a)(a),"inited",!1),Object(L.a)(Object(De.a)(a),"hooks",{init:new Al.e}),Object(L.a)(Object(De.a)(a),"parser",{type:"geojson"}),Object(L.a)(Object(De.a)(a),"transforms",[]),Object(L.a)(Object(De.a)(a),"cluster",!1),Object(L.a)(Object(De.a)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),Object(L.a)(Object(De.a)(a),"invalidExtent",!1),Object(L.a)(Object(De.a)(a),"dataArrayChanged",!1),Object(L.a)(Object(De.a)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return Object(Rt.a)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,Infinity)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,o=this.clusterOptions,l=o.method,c=l===void 0?"sum":l,h=o.field,_=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,_.forEach(function(x){x.id||(x.properties.point_count=1)}),(h||W2(c))&&(_=_.map(function(x){var E=x.id;if(E){var C=a.clusterIndex.getLeaves(E,Infinity),I=C.map(function(U){return U.properties}),P;if(BI(c)&&h){var B=og(I,h);P=II[c](B)}W2(c)&&(P=c(I)),x.properties.stat=P}else x.properties.point_count=1;return x})),this.data=Aa("geojson")({type:"FeatureCollection",features:_}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,o=a.type,l=o===void 0?"geojson":o,c=a.geometry;if(l==="geojson"&&!this.cluster){var h=i<this.originData.features.length?this.originData.features[i]:"null",_=FI(h);if(_!=null&&_.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var x=this.data.dataArray.find(function(E){return E._id===i});_.properties=x}return _}else return l==="json"&&c?this.data.dataArray.find(function(E){return E._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(o){return o._id===i?Object(we.a)(Object(we.a)({},o),a):o}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var o=this.data.dataArray.find(function(l){return l[i]===a});return o==null?void 0:o._id}},{key:"setData",value:function(i,a){var o=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){o.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,o){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,o)}},{key:"reloadTileByLnglat",value:function(i,a,o){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,o)}},{key:"getTileExtent",value:function(i,a){var o;return(o=this.tileset)===null||o===void 0?void 0:o.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,o){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,o)}},{key:"reloadTileByExtent",value:function(i,a){var o;(o=this.tileset)===null||o===void 0||o.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o=this;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",new Promise(function(h,_){try{o.excuteParser(),o.initCluster(),o.executeTrans(),h({})}catch(x){_(x)}}));case 1:case"end":return c.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=LI(this.cfg,i,NI);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=Object(we.a)(Object(we.a)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",o=Aa(a);this.data=o(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=dh(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(!!i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new wp(Object(we.a)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(o){var l=o.type,c=Co(l)(i.data,o);Object.assign(i.data,c)})}},{key:"initCluster",value:function(){if(!!this.cluster){var i=this.clusterOptions||{};this.clusterIndex=V2(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(a=Ue(We(this.extent),i)),a[0].concat(a[1])}}]),t}(uo.EventEmitter);function zI(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function G2(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=UI(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function UI(e,r){if(!!e){if(typeof e=="string")return X2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return X2(e,r)}}function X2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var e1=6378e3;function VI(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*e1)*(256<<20)/2,o=HI(t,i),l=o.gridHash,c=o.gridOffset,h=ZI(l,c,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:h}}function HI(e,r){var t=Infinity,n=-Infinity,i,a=G2(e),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(ie){a.e(ie)}finally{a.f()}var c=(t+n)/2,h=WI(r,c);if(h.xOffset<=0||h.yOffset<=0)return{gridHash:{},gridOffset:h};var _={},x=G2(e),E;try{for(x.s();!(E=x.n()).done;){var C=E.value,I=C.coordinates[1],P=C.coordinates[0];if(Number.isFinite(I)&&Number.isFinite(P)){var B=Math.floor((I+90)/h.yOffset),U=Math.floor((P+180)/h.xOffset),ee="".concat(B,"-").concat(U);_[ee]=_[ee]||{count:0,points:[]},_[ee].count+=1,_[ee].points.push(C)}}}catch(ie){x.e(ie)}finally{x.f()}return{gridHash:_,gridOffset:h}}function WI(e,r){var t=GI(e),n=XI(r,e);return{yOffset:t,xOffset:n}}function GI(e){return e/e1*(180/Math.PI)}function XI(e,r){return r/e1*(180/Math.PI)/Math.cos(e*Math.PI/180)}function ZI(e,r,t){return Object.keys(e).reduce(function(n,i,a){var o=i.split("-"),l=parseInt(o[0],10),c=parseInt(o[1],10),h={};if(t.field&&t.method){var _=H.getColumn(e[i].points,t.field);h[t.method]=H.statMap[t.method](_)}return Object.assign(h,{_id:a,coordinates:G([-180+r.xOffset*(c+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(h),n},[])}var em=Math.PI/3,$I=[0,em,2*em,3*em,4*em,5*em];function YI(e){return e[0]}function KI(e){return e[1]}var qI=function(){var e=0,r=0,t=1,n=1,i=YI,a=KI,o,l,c;function h(x){var E={},C=[],I,P=x.length;for(I=0;I<P;++I)if(!(isNaN(U=+i.call(null,B=x[I],I,x))||isNaN(ee=+a.call(null,B,I,x)))){var B,U,ee,ie=Math.round(ee=ee/c),_e=Math.round(U=U/l-(ie&1)/2),Oe=ee-ie;if(Math.abs(Oe)*3>1){var ke=U-_e,Ke=_e+(U<_e?-1:1)/2,ot=ie+(ee<ie?-1:1),Ot=U-Ke,Zt=ee-ot;ke*ke+Oe*Oe>Ot*Ot+Zt*Zt&&(_e=Ke+(ie&1?1:-1)/2,ie=ot)}var ir=_e+"-"+ie,Hr=E[ir];Hr?Hr.push(B):(C.push(Hr=E[ir]=[B]),Hr.x=(_e+(ie&1)/2)*l,Hr.y=ie*c)}return C}function _(x){var E=0,C=0;return $I.map(function(I){var P=Math.sin(I)*x,B=-Math.cos(I)*x,U=P-E,ee=B-C;return E=P,C=B,[U,ee]})}return h.hexagon=function(x){return"m"+_(x==null?o:+x).join("l")+"z"},h.centers=function(){for(var x=[],E=Math.round(r/c),C=Math.round(e/l),I=E*c;I<n+o;I+=c,++E)for(var P=C*l+(E&1)*l/2;P<t+l/2;P+=l)x.push([P,I]);return x},h.mesh=function(){var x=_(o).slice(0,4).join("l");return h.centers().map(function(E){return"M"+E+"m"+x}).join("")},h.x=function(x){return arguments.length?(i=x,h):i},h.y=function(x){return arguments.length?(a=x,h):a},h.radius=function(x){return arguments.length?(o=+x,l=o*2*Math.sin(em),c=o*1.5,h):o},h.size=function(x){return arguments.length?(e=r=0,t=+x[0],n=+x[1],h):[t-e,n-r]},h.extent=function(x){return arguments.length?(e=+x[0][0],r=+x[0][1],t=+x[1][0],n=+x[1][1],h):[[e,r],[t,n]]},h.radius(1)},QI=6378e3;function JI(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,o=a===void 0?"sum":a,l=i/(2*Math.PI*QI)*(256<<20)/2,c=t.map(function(E){var C=G(E.coordinates),I=Object(Bn.a)(C,2),P=I[0],B=I[1];return Object(we.a)(Object(we.a)({},E),{},{coordinates:[P,B]})}),h=qI().radius(l).x(function(E){return E.coordinates[0]}).y(function(E){return E.coordinates[1]}),_=h(c),x={dataArray:_.map(function(E,C){var I;if(r.field&&o){var P=H.getColumn(E,r.field);E[o]=H.statMap[o](P)}return I={},Object(L.a)(I,r.method,E[o]),Object(L.a)(I,"count",E.length),Object(L.a)(I,"rawData",E),Object(L.a)(I,"coordinates",[E.x,E.y]),Object(L.a)(I,"_id",C),I}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return x}function e4(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(o){a[o[t]]=o}),e.dataArray=e.dataArray.map(function(o){var l=o[n];return Object(we.a)(Object(we.a)({},o),a[l])}),e}function t4(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}Pa("rasterTile",xI),Pa("mvt",tR),Pa("geojsonvt",XO),Pa("testTile",CI),Pa("geojson",lg),Pa("jsonTile",YO),Pa("image",Lb),Pa("csv",Py),Pa("json",Wv),Pa("raster",uR),Pa("rasterRgb",SI),yo("cluster",V2),yo("filter",zI),yo("join",e4),yo("map",t4),yo("grid",VI),yo("hexagon",JI);var Z2=jI;function r4(e){var r=n4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function n4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $2=function(e){Object(qr.a)(t,e);var r=r4(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"added",!1),Object(L.a)(Object(De.a)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=Object(we.a)(Object(we.a)({},i.getDefault()),n),xu(["update","onMove","onMapClick"],Object(De.a)(i)),i.init(),i}return Object(Rt.a)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ba.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Qt.IMapService),this.sceneSerive=i.get(Qt.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&j.remove(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var o=this.markerOption.element;return o&&j.remove(o),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.anchor;this.updatePosition(),j.setTransform(a,"".concat(Qf[o]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var i=this.markerOption,a=i.element,o=i.offsets,l=this.lngLat,c=l.lng,h=l.lat,_=this.mapsService.lngLatToContainer([c,h]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var x=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),E=x.containerHeight,C=x.containerWidth,I=x.bounds;if(!I)return;if(Math.abs(I[0][0])>180||Math.abs(I[1][0])>180){if(_.x>C){var P=this.mapsService.lngLatToContainer([c-360,h]);_.x=P.x}if(_.x<0){var B=this.mapsService.lngLatToContainer([c+360,h]);_.x=B.x}}(_.x>C||_.x<0||_.y>E||_.y<0)&&(a.style.display="none"),a.style.left=_.x+o[0]+"px",a.style.top=_.y-o[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,o=this.markerOption,l=o.color,c=o.anchor;if(!a){this.defaultMarker=!0,a=j.create("div"),this.markerOption.element=a;var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height","48px"),h.setAttributeNS(null,"width","48px"),h.setAttributeNS(null,"viewBox","0 0 1024 1024");var _=document.createElementNS("http://www.w3.org/2000/svg","path");_.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),_.setAttributeNS(null,"fill",l),h.appendChild(_),a.appendChild(h)}j.addClass(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(x){var E,C,I=((E=i.markerOption)===null||E===void 0?void 0:E.style)&&((C=i.markerOption)===null||C===void 0?void 0:C.style[x]);a&&(a.style[x]=I)}),gf(a,c,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Wh()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(uo.EventEmitter);function i4(e){var r=a4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function a4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o4=xi.merge,FW=function(e){Object(qr.a)(t,e);var r=i4(t);function t(n){var i,a;return Object(Et.a)(this,t),a=r.call(this),Object(L.a)(Object(De.a)(a),"markers",[]),Object(L.a)(Object(De.a)(a),"points",[]),Object(L.a)(Object(De.a)(a),"clusterMarkers",[]),a.markerLayerOption=o4(a.getDefault(),n),xu(["update"],Object(De.a)(a)),a.zoom=((i=a.markerLayerOption.clusterOption)===null||i===void 0?void 0:i.zoom)||-99,a}return Object(Rt.a)(t,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(i){return this.scene=i,this.mapsService=i.get(Qt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(!!this.mapsService){var i=this.mapsService.getContainer();this.containerSize={containerWidth:(i==null?void 0:i.scrollWidth)||0,containerHeight:(i==null?void 0:i.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(i){var a=this.markerLayerOption.cluster;if(i.getMarkerLayerContainerSize=this.getContainerSize.bind(this),a&&(this.addPoint(i,this.markers.length),this.mapsService)){var o=this.mapsService.getZoom(),l=this.mapsService.getBounds();this.bbox=Ue(l,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(i)}},{key:"removeMarker",value:function(i){this.markers.indexOf(i);var a=this.markers.indexOf(i);a>-1&&(this.markers.splice(a,1),this.markerLayerOption.cluster&&(this.removePoint(a),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map(function(i){i.getElement().style.opacity="0"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(i){i.getElement().style.opacity="1"}),this.clusterMarkers.map(function(i){i.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var i=this.markerLayerOption.cluster;return i?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var i=this;this.getMarkers().forEach(function(a){a.addTo(i.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(i){i.remove()}),this.clusterMarkers.forEach(function(i){i.remove()}),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(i,a){var o=i.getLnglat(),l=o.lng,c=o.lat,h={geometry:{type:"Point",coordinates:[l,c]},properties:Object(we.a)(Object(we.a)({},i.getExtData()),{},{marker_id:a})};this.points.push(h),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(i){var a=this.points.findIndex(function(o){return o.properties.marker_id===i});a>-1&&this.points.splice(a,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var i=this.markerLayerOption.clusterOption,a=i.radius,o=i.minZoom,l=o===void 0?0:o,c=i.maxZoom;this.clusterIndex=new U2.a({radius:a,minZoom:l,maxZoom:c}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(i,a){var o=this,l=i[0].concat(i[1]),c=this.clusterIndex.getClusters(l,a);this.clusterMarkers.forEach(function(h){h.remove()}),this.clusterMarkers=[],c.forEach(function(h){var _,x=o.markerLayerOption.clusterOption,E=x.field,C=x.method;if((_=h.properties)!==null&&_!==void 0&&_.cluster_id){var I,P=o.getLeaves((I=h.properties)===null||I===void 0?void 0:I.cluster_id);if(h.properties.clusterData=P,E&&C){var B=P==null?void 0:P.map(function(Oe){var ke=Object(L.a)({},E,Oe.properties[E]);return ke}),U=H.getColumn(B,E),ee=H.getSatByColumn(C,U),ie="point_"+C;h.properties[ie]=ee.toFixed(2)}}var _e=o.clusterMarker(h);o.clusterMarkers.push(_e),_e.addTo(o.scene)})}},{key:"getLeaves",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return i?this.clusterIndex.getLeaves(i,a,o):null}},{key:"clusterMarker",value:function(i){var a=this.markerLayerOption.clusterOption,o=a,l=o.element,c=l===void 0?this.generateElement.bind(this):l,h=new $2({element:c(i)}).setLnglat({lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]});return h}},{key:"normalMarker",value:function(i){var a=i.properties.marker_id;return this.markers[a]}},{key:"update",value:function(){if(!!this.mapsService&&this.markers.length!==0){var i=this.mapsService.getZoom(),a=this.mapsService.getBounds();(!this.bbox||Math.abs(i-this.zoom)>=1||!ht(this.bbox,a))&&(this.bbox=Ue(a,.5),this.zoom=Math.floor(i),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(i){var a=j.create("div","l7-marker-cluster"),o=j.create("div","",a),l=j.create("span","",o),c=this.markerLayerOption.clusterOption,h=c.field,_=c.method;i.properties.point_count=i.properties.point_count||1;var x=h&&_?i.properties["point_"+_]||i.properties[h]:i.properties.point_count;return l.textContent=x,a}}]),t}(uo.EventEmitter),BW=O("bpoo");function s4(e){var r=u4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function u4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qd=function(e){Object(qr.a)(t,e);var r=s4(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this),t.controlCount++,i.controlOption=Object(we.a)(Object(we.a)({},i.getDefault(n)),n||{}),i}return Object(Rt.a)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(o){var l=Object(Bn.a)(o,2),c=l[0],h=l[1];h===void 0&&(i[c]=a[c])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=Object(we.a)(Object(we.a)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Qt.IMapService),this.renderService=i.get(Qt.IRendererService),this.layerService=i.get(Qt.ILayerService),this.controlService=i.get(Qt.IControlService),this.configService=i.get(Qt.IGlobalConfigService),this.scene=i.get(Qt.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),j.addClass(this.container,"l7-control");var a=this.controlOption,o=a.className,l=a.style;return o&&this.setClassName(o),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;j.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return j.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;j.removeClass(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;j.addClass(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:Zd.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Zd.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,o=this.controlOption.className;o&&j.removeClass(a,o),i&&j.addClass(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var o=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?o.insertBefore(a,o.firstChild):o.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(o){return o in i})}}]),t}(nu.a);Object(L.a)(Qd,"controlCount",0);function l4(e){var r=c4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function c4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Wy=function(e){Object(qr.a)(t,e);var r=l4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"isDisable",!1),n}return Object(Rt.a)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var o;(o=this.button)===null||o===void 0||o.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return j.create("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,o=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(o),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,o=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(o),Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&j.remove(this.buttonIcon),i){var a,o=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(o){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,o)}else{var c;(c=this.button)===null||c===void 0||c.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(!!this.button)if(j.removeClass(this.button,"l7-button-control--row"),j.removeClass(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var o;a=j.create("div","l7-button-control__text"),(o=this.button)===null||o===void 0||o.appendChild(a),this.buttonText=a}a.innerText=i,j.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(j.remove(this.buttonText),this.buttonText=void 0)}}]),t}(Qd);function f4(e){var r=h4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function h4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y2=function(e){Object(qr.a)(t,e);var r=f4(t);function t(n,i){var a;return Object(Et.a)(this,t),a=r.call(this),Object(L.a)(Object(De.a)(a),"isShow",!1),Object(L.a)(Object(De.a)(a),"timeout",null),Object(L.a)(Object(De.a)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),j.removeClass(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(o){o!==Object(De.a)(a)&&o.isShow&&o.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),Object(De.a)(a)}),Object(L.a)(Object(De.a)(a),"hide",function(){return a.isShow&&(j.addClass(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),Object(De.a)(a)}),Object(L.a)(Object(De.a)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){!a.isShow||(a.hide(),a.timeout=null)},300))}),Object(L.a)(Object(De.a)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),Object(L.a)(Object(De.a)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),Object(L.a)(Object(De.a)(a),"onPopperUnClick",function(o){j.findParentElement(o.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),Object(L.a)(Object(De.a)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),Object(L.a)(Object(De.a)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push(Object(De.a)(a)),a}return Object(Rt.a)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(j.clearChildren(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),j.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,o=a.container,l=a.offset,c=l===void 0?[0,0]:l,h=a.placement,_=Object(Bn.a)(c,2),x=_[0],E=_[1],C=this.button.getBoundingClientRect(),I=o.getBoundingClientRect(),P=j.getDiffRect(C,I),B=P.left,U=P.right,ee=P.top,ie=P.bottom,_e=!1,Oe=!1;/^(left|right)/.test(h)?(h.includes("left")?i.right="".concat(C.width+U,"px"):h.includes("right")&&(i.left="".concat(C.width+B,"px")),h.includes("start")?i.top="".concat(ee,"px"):h.includes("end")?i.bottom="".concat(ie,"px"):(i.top="".concat(ee+C.height/2,"px"),Oe=!0,i.transform="translate(".concat(x,"px, calc(").concat(E,"px - 50%))"))):/^(top|bottom)/.test(h)&&(h.includes("top")?i.bottom="".concat(C.height+ie,"px"):h.includes("bottom")&&(i.top="".concat(C.height+ee,"px")),h.includes("start")?i.left="".concat(B,"px"):h.includes("end")?i.right="".concat(U,"px"):(i.left="".concat(B+C.width/2,"px"),_e=!0,i.transform="translate(calc(".concat(x,"px - 50%), ").concat(E,"px)"))),i.transform="translate(calc(".concat(x,"px - ").concat(_e?"50%":"0%","), calc(").concat(E,"px - ").concat(Oe?"50%":"0%",")");var ke=h.split("-");ke.length&&j.addClass(this.popperDOM,ke.map(function(Ke){return"l7-popper-".concat(Ke)}).join(" ")),j.addStyle(this.popperDOM,j.css2Style(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,o=i.className,l=o===void 0?"":o,c=i.content,h=j.create("div","l7-popper l7-popper-hide ".concat(l)),_=j.create("div","l7-popper-content"),x=j.create("div","l7-popper-arrow");return h.appendChild(_),h.appendChild(x),a.appendChild(h),this.popperDOM=h,this.contentDOM=_,c&&this.setContent(c),h}}]),t}(uo.EventEmitter);Object(L.a)(Y2,"conflictPopperList",[]);function p4(e){var r=d4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function d4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v4={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},m4=function(e){Object(qr.a)(t,e);var r=p4(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Object(Ea.a)(Object(ut.a)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,o=Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:o.position;return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":v4[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,o=a.popperClassName,l=a.popperPlacement,c=a.popperTrigger,h=this.mapsService.getMapContainer();return this.popper=new Y2(this.button,{className:o,placement:l,trigger:c,container:h,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(Wy);function g4(e){var r=y4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function y4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $p=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}($p||{}),K2=function(e){Object(qr.a)(t,e);var r=g4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"selectValue",[]),Object(L.a)(Object(De.a)(n),"createNormalOption",function(l){var c=n.selectValue.includes(l.value),h=j.create("div","l7-select-control-item ".concat(c?$p.ActiveOptionClassName:""));n.getIsMultiple()&&h.appendChild(n.createCheckbox(c)),l.icon&&h.appendChild(l.icon);var _=j.create("span");return _.innerText=l.text,h.appendChild(_),h}),Object(L.a)(Object(De.a)(n),"onItemClick",function(l){if(n.getIsMultiple()){var c=n.selectValue.findIndex(function(h){return h===l.value});c>-1?n.selectValue.splice(c,1):n.selectValue=[].concat(Object(cr.a)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return Object(Rt.a)(t,[{key:"setOptions",value:function(i){Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=this.transSelectValue(i);this.optionDOMList.forEach(function(c){var h=c.getAttribute($p.OptionValueAttrKey),_=a.getIsMultiple()?c.querySelector("input[type=checkbox]"):void 0;l.includes(h)?(j.addClass(c,$p.ActiveOptionClassName),_&&j.setChecked(_,!0)):(j.removeClass(c,$p.ActiveOptionClassName),_&&j.setChecked(_,!1))}),this.selectValue=l,o&&this.emit("selectChange",this.getIsMultiple()?l:l[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,o=this.isImageOptions(),l=j.create("div",o?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&j.addClass(l,"l7-select-control--multiple");var c=i.map(function(h,_){var x=o?a.createImageOption(h):a.createNormalOption(h);return x.setAttribute($p.OptionValueAttrKey,h.value),x.setAttribute($p.OptionIndexAttrKey,window.String(_)),x.addEventListener("click",a.onItemClick.bind(a,h)),x});return l.append.apply(l,Object(cr.a)(c)),this.optionDOMList=c,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),o=j.create("div","l7-select-control-item ".concat(a?$p.ActiveOptionClassName:"")),l=j.create("img");l.setAttribute("src",i.img),j.setUnDraggable(l),o.appendChild(l);var c=j.create("div","l7-select-control-item-row");this.getIsMultiple()&&o.appendChild(this.createCheckbox(a));var h=j.create("span");return h.innerText=i.text,c.appendChild(h),o.appendChild(c),o}},{key:"createCheckbox",value:function(i){var a=j.create("input");return a.setAttribute("type","checkbox"),i&&j.setChecked(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(m4),sp=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function _4(e){var r=b4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function b4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LW=function(e){Object(qr.a)(t,e);var r=_4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"onClick",Object(Xt.a)(he.a.mark(function l(){var c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(c=n.controlOption.onExport,_.t0=c==null,_.t0){_.next=8;break}return _.t1=c,_.next=6,n.getImage();case 6:_.t2=_.sent,(0,_.t1)(_.t2);case 8:case"end":return _.stop()}},l)}))),Object(L.a)(Object(De.a)(n),"mergeImage",Object(Xt.a)(he.a.mark(function l(){var c,h,_,x,E,C,I,P,B,U,ee,ie,_e,Oe,ke=arguments;return he.a.wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:for(_=n.controlOption.imageType,x=(c=(h=n.mapsService.getContainer())===null||h===void 0?void 0:h.getBoundingClientRect())!==null&&c!==void 0?c:{},E=x.width,C=E===void 0?0:E,I=x.height,P=I===void 0?0:I,B=document.createElement("canvas"),B.width=C,B.height=P,U=B.getContext("2d"),ee=ke.length,ie=new Array(ee),_e=0;_e<ee;_e++)ie[_e]=ke[_e];return ot.next=9,Promise.all(ie.map(function(Ot){return new Promise(function(Zt){var ir=new Image;ir.onload=function(){Zt(ir)},ir.src=Ot})}));case 9:return Oe=ot.sent,Oe.forEach(function(Ot){U==null||U.drawImage(Ot,0,0,C,P)}),ot.abrupt("return",B.toDataURL("image/".concat(_)));case 12:case"end":return ot.stop()}},l)}))),n}return Object(Rt.a)(t,[{key:"onAdd",value:function(){var i=Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:sp("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,this.mapsService.exportMap("png");case 2:return o=h.sent,h.next=5,this.scene.exportPng("png");case 5:return l=h.sent,h.abrupt("return",this.mergeImage.apply(this,Object(cr.a)([o,l].filter(function(_){return _}))));case 7:case"end":return h.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Wy);function x4(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=E4(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function E4(e,r){if(!!e){if(typeof e=="string")return q2(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return q2(e,r)}}function q2(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Q2=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],up=function(){if(typeof document=="undefined")return!1;for(var e=Q2[0],r={},t=0,n=Q2;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var o=x4(i.entries()),l;try{for(o.s();!(l=o.n()).done;){var c=Object(Bn.a)(l.value,2),h=c[0],_=c[1];r[e[h]]=_}}catch(x){o.e(x)}finally{o.f()}return r}}return!1}(),J2={change:up.fullscreenchange,error:up.fullscreenerror},Sc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){Sc.off("change",l),n()};Sc.on("change",a);var o=r[up.requestFullscreen](t);o instanceof Promise&&o.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!Sc.isFullscreen){r();return}var n=function a(){Sc.off("change",a),r()};Sc.on("change",n);var i=document[up.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return Sc.isFullscreen?Sc.exit():Sc.request(r,t)},onchange:function(r){Sc.on("change",r)},onerror:function(r){Sc.on("error",r)},on:function(r,t){var n=J2[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=J2[r];n&&document.removeEventListener(n,t,!1)},raw:up};Object.defineProperties(Sc,{isFullscreen:{get:function(){return Boolean(document[up.fullscreenElement])}},element:{enumerable:!0,get:function(){var r;return(r=document[up.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[up.fullscreenEnabled])}}}),up||(Sc={isEnabled:!1});var t1=Sc;function S4(e){var r=A4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function A4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NW=function(e){Object(qr.a)(t,e);var r=S4(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this,n),Object(L.a)(Object(De.a)(i),"isFullscreen",!1),Object(L.a)(Object(De.a)(i),"toggleFullscreen",Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!t1.isEnabled){l.next=3;break}return l.next=3,t1.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),Object(L.a)(Object(De.a)(i),"onClick",function(){i.toggleFullscreen()}),Object(L.a)(Object(De.a)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,o=a.btnText,l=a.btnIcon,c=a.title,h=a.exitBtnText,_=a.exitBtnIcon,x=a.exitTitle;i.isFullscreen?(i.setBtnTitle(x),i.setBtnText(h),i.setBtnIcon(_)):(i.setBtnTitle(c),i.setBtnText(o),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),t1.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return Object(Rt.a)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,o=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(o),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=j.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){Object(Ea.a)(Object(ut.a)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:sp("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:sp("l7-icon-exit-fullscreen")})}}]),t}(Wy);function T4(e){var r=C4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function C4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jW=function(e){Object(qr.a)(t,e);var r=T4(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this,n),Object(L.a)(Object(De.a)(i),"getGeoLocation",function(){return new Promise(function(a,o){window.navigator.geolocation.getCurrentPosition(function(l){var c=l.coords,h=c!=null?c:{},_=h.longitude,x=h.latitude;!isNaN(_)&&!isNaN(x)?a([_,x]):o()},function(l){o(l)})})}),Object(L.a)(Object(De.a)(i),"onClick",Object(Xt.a)(he.a.mark(function a(){var o,l,c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(window.navigator.geolocation){_.next=2;break}return _.abrupt("return");case 2:return o=i.controlOption.transform,_.next=5,i.getGeoLocation();case 5:if(l=_.sent,c=i.mapsService.getZoom(),_.t0=i.mapsService,_.t1=c>15?c:15,!o){_.next=15;break}return _.next=12,o(l);case 12:_.t2=_.sent,_.next=16;break;case 15:_.t2=l;case 16:_.t3=_.t2,_.t0.setZoomAndCenter.call(_.t0,_.t1,_.t3);case 18:case"end":return _.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return Object(Rt.a)(t,[{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:sp("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(Wy);function w4(e){var r=O4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function O4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function eS(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var zW=function(e){Object(qr.a)(t,e);var r=w4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),Object(L.a)(Object(De.a)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),Object(L.a)(Object(De.a)(n),"onSelectChange",function(){n.layers.forEach(function(l){var c=n.selectValue.includes(l.name),h=l.isVisible();c&&!h&&l.show(),!c&&h&&l.hide()})}),n}return Object(Rt.a)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var o=[];return a.forEach(function(l){if(l instanceof Object&&(eS(l)?o.push(l.layer):o.push(l)),typeof l=="string"){var c=i.getLayer(l)||i.getLayerByName(l);c&&o.push(c)}}),o}return i.getLayers()||[]}},{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:sp("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,o=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(eS(l))return{text:l.name||l.layer.name,value:l.layer.name,img:o?l.img:void 0};if(typeof l=="string"){var c=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:c==null?void 0:c.name,value:c==null?void 0:c.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers"]);Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i),a&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var i;return(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),t}(K2);function R4(e){var r=M4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function M4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tS=function(e){Object(qr.a)(t,e);var r=R4(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getDefault",value:function(){return{position:Zd.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=j.create("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(j.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,o=a.href,l=a.img,c=j.create("img");if(c.setAttribute("src",l),c.setAttribute("aria-label","AntV logo"),j.setUnDraggable(c),o){var h=j.create("a","l7-control-logo-link");h.target="_blank",h.href=o,h.rel="noopener nofollow",h.setAttribute("rel","noopener nofollow"),h.appendChild(c),i.appendChild(h)}else i.appendChild(c)}}]),t}(Qd),P4={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},I4={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function k4(e){var r=D4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function D4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var UW=function(e){Object(qr.a)(t,e);var r=k4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return Object(Rt.a)(t,[{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:sp("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?I4:P4;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var o=Object(Bn.a)(a,2),l=o[0],c=o[1];return typeof c=="string"&&l!=="blank"}).map(function(a){var o,l=Object(Bn.a)(a,2),c=l[0],h=l[1],_=(o=i[c])!==null&&o!==void 0?o:{},x=_.text,E=_.img;return{text:x!=null?x:c,value:h,img:E,key:c}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var o,l,c=this.controlOption.defaultValue;this.controlOption.defaultValue=(o=(l=this.controlOption.options.find(function(_){return _.key===c}))===null||l===void 0?void 0:l.value)!==null&&o!==void 0?o:c}else{var h=this.getMapStyle();h?this.controlOption.defaultValue=h:this.mapsService.map.once("styledata",function(){var _=a.mapsService.getMapStyle();a.controlOption.defaultValue=_,a.setSelectValue(_,!1)})}return this.on("selectChange",this.onMapThemeChange),Object(Ea.a)(Object(ut.a)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(K2);function F4(e){var r=B4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function B4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VW=function(e){Object(qr.a)(t,e);var r=F4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"location",[0,0]),Object(L.a)(Object(De.a)(n),"onMouseMove",function(l){var c=n.location,h=l.lngLat||l.lnglat,_=n.controlOption.transform;h&&(c=[h.lng,h.lat]),n.location=c,_&&(c=_(c)),n.insertLocation2HTML(c),n.emit("locationChange",c)}),n}return Object(Rt.a)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{position:Zd.BOTTOMLEFT,transform:function(o){var l=Object(Bn.a)(o,2),c=l[0],h=l[1];return[+(+c).toFixed(6),+(+h).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=j.create("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(Qd);function L4(e){var r=N4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function N4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var j4=function(e){Object(qr.a)(t,e);var r=L4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"update",function(){var l=n.mapsService,c=n.controlOption.maxWidth,h=l.getSize()[1]/2,_=l.containerToLngLat([0,h]),x=l.containerToLngLat([c,h]),E=be([_.lng,_.lat],[x.lng,x.lat]);n.updateScales(E)}),n}return Object(Rt.a)(t,[{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:Zd.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=j.create("div",i);this.resetScaleLines(a);var o=this.controlOption.updateWhenIdle;return this.mapsService.on(o?"moveend":"mapmove",this.update),this.mapsService.on(o?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,o=a.metric,l=a.imperial;o&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){j.clearChildren(i);var a=this.controlOption,o=a.metric,l=a.imperial,c=a.maxWidth,h=a.lockWidth;h&&j.addStyle(i,"width: ".concat(c,"px")),o&&(this.mScale=j.create("div","l7-control-scale-line",i)),l&&(this.iScale=j.create("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,o){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*o)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),o=i/a;return o=o>=10?10:o>=5?5:o>=3?3:o>=2?2:1,a*o}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),o=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,o,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,o,l,c;a>5280?(o=a/5280,l=this.getRoundNum(o),this.updateScale(this.iScale,l+" mi",l/o)):(c=this.getRoundNum(a),this.updateScale(this.iScale,c+" ft",c/a))}}]),t}(Qd);function z4(e){var r=U4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function U4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V4=function(e){Object(qr.a)(t,e);var r=z4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),Object(L.a)(Object(De.a)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),Object(L.a)(Object(De.a)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return Object(Rt.a)(t,[{key:"getDefault",value:function(i){return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{position:Zd.BOTTOMRIGHT,name:"zoom",zoomInText:sp("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:sp("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=j.create("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){j.clearChildren(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,o,l,c){var h=j.create("button",o,l);return typeof i=="string"?h.innerHTML=i:h.append(i),h.title=a,c&&h.addEventListener("click",c),h}}]),t}(Qd);function H4(e){var r=W4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function W4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r1=function(e){Object(qr.a)(t,e);var r=H4(t);function t(n){var i;Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"isShow",!0),Object(L.a)(Object(De.a)(i),"onMouseMove",function(o){var l,c=i.mapsService.getMapContainer(),h=(l=c==null?void 0:c.getBoundingClientRect())!==null&&l!==void 0?l:{},_=h.left,x=_===void 0?0:_,E=h.top,C=E===void 0?0:E;i.setPopupPosition(o.clientX-x,o.clientY-C)}),Object(L.a)(Object(De.a)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var o=i.lngLat,l=o.lng,c=o.lat,h=i.mapsService.lngLatToContainer([l,c]),_=h.x,x=h.y;i.setPopupPosition(_,x)}}),Object(L.a)(Object(De.a)(i),"onKeyDown",function(o){o.keyCode===27&&i.remove()}),Object(L.a)(Object(De.a)(i),"onCloseButtonClick",function(o){o.stopPropagation&&o.stopPropagation(),i.hide()}),Object(L.a)(Object(De.a)(i),"update",function(){var o=!!i.lngLat,l=i.popupOption,c=l.className,h=l.style,_=l.maxWidth,x=l.anchor,E=l.stopPropagation;if(!(!i.mapsService||!o||!i.content)){var C=i.mapsService.getMarkerContainer();if(!i.container&&C&&(i.container=j.create("div","l7-popup ".concat(c!=null?c:""," ").concat(i.isShow?"":"l7-popup-hide"),C),h&&i.container.setAttribute("style",h),i.tip=j.create("div","l7-popup-tip",i.container),i.container.appendChild(i.content),E&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(B){i.container.addEventListener(B,function(U){U.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),j.setTransform(i.container,"".concat(Qf[x])),gf(i.container,x,"popup"),_){var I=i.container.getBoundingClientRect(),P=I.width;P>parseFloat(_)&&(i.container.style.width=_)}else i.container.style.removeProperty("width")}}),i.popupOption=Object(we.a)(Object(we.a)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return Object(Rt.a)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Qt.IMapService),this.sceneService=i.get(Qt.ISceneService),this.layerService=i.get(Qt.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,o=a.html,l=a.text,c=a.title;return o?this.setHTML(o):l&&this.setText(l),c&&this.setTitle(c),this.emit("open"),this}},{key:"remove",value:function(){if(!!(this!==null&&this!==void 0&&this.isOpen()))return this.content&&j.remove(this.content),this.container&&(j.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=Object(we.a)(Object(we.a)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(j.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&j.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(!!this.isShow)return this.container&&j.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=j.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),j.clearChildren(this.contentTitle),j.appendElementType(this.contentTitle,i)):this.contentTitle&&(j.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,o=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,o]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ba.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),j.appendElementType(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,o=this.mapsService;o&&(o==null||o.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){o==null||o.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,o=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();o&&(o==null||o.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(o==null||o.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&j.remove(this.content),this.contentTitle=void 0,this.content=j.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=sp("l7-icon-guanbi");j.addClass(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(o){o.stopPropagation()}),a.addEventListener("pointerdown",function(o){o.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=j.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var o=this.popupOption.offsets;this.container.style.left=i+o[0]+"px",this.container.style.top=a-o[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(o){return o in i})}}]),t}(uo.EventEmitter);function G4(e){var r=X4();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function X4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z4=xi.get,HW=function(e){Object(qr.a)(t,e);var r=G4(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"layerClickCountByFrame",0),Object(L.a)(Object(De.a)(n),"layerConfigMap",new WeakMap),Object(L.a)(Object(De.a)(n),"onLayerClick",function(l,c){requestAnimationFrame(function(){if(n.popupOption.closeOnClick&&n.layerClickCountByFrame++,n.isShow&&n.isSameFeature(l,c.featureId))n.hide();else{var h=n.getLayerInfoFrag(l,c),_=h.title,x=h.content;n.setDOMContent(x),n.setLnglat(c.lngLat),n.setTitle(_),n.displayFeatureInfo={layer:l,featureId:c.featureId},n.show()}})}),Object(L.a)(Object(De.a)(n),"onSceneClick",function(){n.layerClickCountByFrame=0,requestAnimationFrame(function(){n.layerClickCountByFrame||n.hide()})}),Object(L.a)(Object(De.a)(n),"updateCloseOnClick",function(){}),n}return Object(Rt.a)(t,[{key:"layerConfigItems",get:function(){var i,a=this.popupOption,o=a.config,l=a.items;return(i=o!=null?o:l)!==null&&i!==void 0?i:[]}},{key:"addTo",value:function(i){return Object(Ea.a)(Object(ut.a)(t.prototype),"addTo",this).call(this,i),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return Object(Ea.a)(Object(ut.a)(t.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(i){this.unbindLayerEvent();var a=Object(we.a)({},i),o=a.trigger||this.popupOption.trigger,l=a.items||this.popupOption.items,c=(l==null?void 0:l.length)===0;return a.followCursor=o==="hover"&&!c,Object(Ea.a)(Object(ut.a)(t.prototype),"setOptions",this).call(this,a),this.bindLayerEvent(),c&&this.hide(),this}},{key:"getDefault",value:function(i){var a=i.trigger==="hover";return Object(we.a)(Object(we.a)({},Object(Ea.a)(Object(ut.a)(t.prototype),"getDefault",this).call(this,i)),{},{trigger:"hover",followCursor:a,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var i=this,a=this.popupOption,o=a.trigger,l=a.closeOnClick;this.layerConfigItems.forEach(function(c){var h,_=i.getLayerByConfig(c);if(!!_){var x=Object(we.a)({},c);if(o==="hover"){var E=i.onLayerMouseMove.bind(i,_),C=i.onLayerMouseOut.bind(i,_);x.onMouseMove=E,x.onMouseOut=C,_==null||_.on("mousemove",E),_==null||_.on("mouseout",C)}else{var I,P=i.onLayerClick.bind(i,_);x.onClick=P,_==null||_.on("click",P);var B=(I=i.mapsService)===null||I===void 0?void 0:I.getMapContainer();B&&l&&B.addEventListener("click",i.onSceneClick)}var U=_==null||(h=_.getSource)===null||h===void 0?void 0:h.call(_),ee=i.onSourceUpdate.bind(i);U==null||U.on("update",ee),x.onSourceUpdate=ee,i.layerConfigMap.set(_,x)}})}},{key:"unbindLayerEvent",value:function(){var i=this;this.layerConfigItems.forEach(function(a){var o,l=i.getLayerByConfig(a),c=l&&i.layerConfigMap.get(l);if(!!c){var h=c.onMouseMove,_=c.onMouseOut,x=c.onClick,E=c.onSourceUpdate;if(h&&l.off("mousemove",h),_&&l.off("mouseout",_),x&&l.off("click",x),E){var C;l==null||(C=l.getSource())===null||C===void 0||C.off("update",E)}var I=(o=i.mapsService)===null||o===void 0?void 0:o.getMapContainer();I&&I.removeEventListener("click",i.onSceneClick)}})}},{key:"onLayerMouseMove",value:function(i,a){if(!this.isSameFeature(i,a.featureId)){var o=this.getLayerInfoFrag(i,a),l=o.title,c=o.content;this.setDOMContent(c),this.setTitle(l),this.displayFeatureInfo={layer:i,featureId:a.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(i,a){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(i,a){var o=this.layerConfigMap.get(i),l,c=document.createDocumentFragment();if(o){var h=a.feature;h.type==="Feature"&&"properties"in h&&"geometry"in h&&(h=h.properties);var _=o.title,x=o.fields,E=o.customContent;if(_){l=document.createDocumentFragment();var C=_ instanceof Function?_(h):_;j.appendElementType(l,C)}if(E){var I=E instanceof Function?E(h):E;j.appendElementType(c,I)}else x!=null&&x.length&&(x==null||x.forEach(function(P){var B,U,ee=typeof P=="string"?{field:P}:P,ie=ee.field,_e=ee.formatField,Oe=ee.formatValue,ke=ee.getValue,Ke=j.create("div","l7-layer-popup__row"),ot=ke?ke(a.feature):Z4(h,ie),Ot=(B=_e instanceof Function?_e(ie,h):_e)!==null&&B!==void 0?B:ie,Zt=(U=Oe instanceof Function?Oe(ot,h):Oe)!==null&&U!==void 0?U:ot,ir=j.create("span","l7-layer-popup__key",Ke);j.appendElementType(ir,Ot),j.appendElementType(ir,document.createTextNode("\uFF1A"));var Hr=j.create("span","l7-layer-popup__value",Ke);Array.isArray(Zt)&&Zt.every(function(ln){return!(ln instanceof Object)})&&(Zt=Zt.map(function(ln){return String(ln)}).join(",")),j.appendElementType(Hr,Zt),c.appendChild(Ke)}))}return{title:l,content:c}}},{key:"getLayerByConfig",value:function(i){var a=i.layer;if(a instanceof Object)return a;if(typeof a=="string")return this.layerService.getLayer(a)||this.layerService.getLayerByName(a)}},{key:"isSameFeature",value:function(i,a){var o=this.displayFeatureInfo;return o&&i===o.layer&&a===o.featureId}}]),t}(r1);function $4(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}$4(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
`);var Yp,rS=(Yp={},Object(L.a)(Yp,Zp.additive,{enable:!0,func:{srcRGB:Z.ONE,dstRGB:Z.ONE,srcAlpha:1,dstAlpha:1}}),Object(L.a)(Yp,Zp.none,{enable:!1}),Object(L.a)(Yp,Zp.normal,{enable:!0,func:{srcRGB:Z.SRC_ALPHA,dstRGB:Z.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),Object(L.a)(Yp,Zp.subtractive,{enable:!0,func:{srcRGB:Z.ONE,dstRGB:Z.ONE,srcAlpha:Z.ZERO,dstAlpha:Z.ONE_MINUS_SRC_COLOR},equation:{rgb:Z.FUNC_SUBTRACT,alpha:Z.FUNC_SUBTRACT}}),Object(L.a)(Yp,Zp.max,{enable:!0,func:{srcRGB:Z.ONE,dstRGB:Z.ONE},equation:{rgb:Z.MAX_EXT}}),Object(L.a)(Yp,Zp.min,{enable:!0,func:{srcRGB:Z.ONE,dstRGB:Z.ONE},equation:{rgb:Z.MIN_EXT}}),Yp);function nS(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function iS(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),o=a.enableTAA;return o?i.add(n("taa")):i.add(n("render")),nS(r).forEach(function(l){var c=Object(Bn.a)(l,2),h=c[0],_=c[1];i.add(t(h),_)}),i.add(t("copy")),i}var Y4=function(){function e(r){Object(Et.a)(this,e),this.layer=r}return Object(Rt.a)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(Qt.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var i=this.layer.getContainer(),a=i.get(Qt.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),a.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),o=a.get(Qt.IPickingService),l=a.get(Qt.IMapService),c=this.layer.getSource().extent,h=ph(n.lngLat,c),_={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},x=i||t;if(h){var E=this.readRasterValue(t,c,l,n.x,n.y);return _.rasterValue=E,o.triggerHoverOnLayer(x,_),!0}else return _.type=n.type==="mousemove"?"mouseout":"un"+n.type,o.triggerHoverOnLayer(x,Object(we.a)(Object(we.a)({},_),{},{type:"unpick"})),o.triggerHoverOnLayer(x,_),!1}},{key:"readRasterValue",value:function(t,n,i,a,o){var l=t.getSource().data.dataArray[0],c=Object(Bn.a)(n,4),h=c[0],_=h===void 0?0:h,x=c[1],E=x===void 0?0:x,C=c[2],I=C===void 0?10:C,P=c[3],B=P===void 0?-10:P,U=i.lngLatToContainer([_,E]),ee=i.lngLatToContainer([I,B]),ie=ee.x-U.x,_e=U.y-ee.y,Oe=[(a-U.x)/ie,(o-ee.y)/_e],ke=l.width||1,Ke=l.height||1,ot=Math.floor(Oe[0]*ke),Ot=Math.floor(Oe[1]*Ke),Zt=Math.max(0,Ot-1)*ke+ot,ir=l.data[Zt];return ir}},{key:"selectFeature",value:function(t){var n=this.layer,i=Object(Bn.a)(t,3),a=i[0],o=i[1],l=i[2];n.hooks.beforeSelect.call([a,o,l])}},{key:"highlightPickedFeature",value:function(t){var n=Object(Bn.a)(t,3),i=n[0],a=n[1],o=n[2];this.layer.hooks.beforeHighlight.call([i,a,o])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),K4=function(){function e(r){Object(Et.a)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(Qt.IRendererService)}return Object(Rt.a)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),o=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=o,o}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return Nl(t);case"quantize":return md(t);case"custom":return nh(t,n);case"linear":return xf(t,n);default:return Ll(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),q4=["passes"],Q4=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],aS,n1,oS;function J4(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=e5(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function e5(e,r){if(!!e){if(typeof e=="string")return sS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return sS(e,r)}}function sS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function t5(e){var r=r5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function r5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i1=xi.isEqual,uS=xi.isFunction,lS=xi.isNumber,Bu=xi.isObject,n5=xi.isPlainObject,i5=xi.isUndefined,cS=0,Kp=(aS=Q_(Qt.IGlobalConfigService),n1=function(e){Object(qr.a)(t,e);var r=t5(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object(Et.a)(this,t),n=r.call(this),Object(L.a)(Object(De.a)(n),"id","".concat(cS++)),Object(L.a)(Object(De.a)(n),"name","".concat(cS)),Object(L.a)(Object(De.a)(n),"visible",!0),Object(L.a)(Object(De.a)(n),"zIndex",0),Object(L.a)(Object(De.a)(n),"inited",!1),Object(L.a)(Object(De.a)(n),"layerModelNeedUpdate",!1),Object(L.a)(Object(De.a)(n),"pickedFeatureID",null),Object(L.a)(Object(De.a)(n),"selectedFeatureID",null),Object(L.a)(Object(De.a)(n),"styleNeedUpdate",!1),Object(L.a)(Object(De.a)(n),"forceRender",!1),Object(L.a)(Object(De.a)(n),"clusterZoom",0),Object(L.a)(Object(De.a)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),Object(L.a)(Object(De.a)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),Object(L.a)(Object(De.a)(n),"hooks",{init:new Al.a,afterInit:new Al.d,beforeRender:new Al.d,beforeRenderData:new Al.c,afterRender:new Al.e,beforePickingEncode:new Al.e,afterPickingEncode:new Al.e,beforeHighlight:new Al.e(["pickedColor"]),afterHighlight:new Al.e,beforeSelect:new Al.e(["pickedColor"]),afterSelect:new Al.e,beforeDestroy:new Al.e,afterDestroy:new Al.e}),Object(L.a)(Object(De.a)(n),"models",[]),Object(L.a)(Object(De.a)(n),"startInit",!1),Object(L.a)(Object(De.a)(n),"layerChildren",[]),Object(L.a)(Object(De.a)(n),"masks",[]),ga(Object(De.a)(n),"configService",oS,Object(De.a)(n)),Object(L.a)(Object(De.a)(n),"animateOptions",{enable:!1}),Object(L.a)(Object(De.a)(n),"currentPickId",null),Object(L.a)(Object(De.a)(n),"encodeStyleAttribute",{}),Object(L.a)(Object(De.a)(n),"enableShaderEncodeStyles",[]),Object(L.a)(Object(De.a)(n),"enableDataEncodeStyles",[]),Object(L.a)(Object(De.a)(n),"enablg",[]),Object(L.a)(Object(De.a)(n),"pendingStyleAttributes",[]),Object(L.a)(Object(De.a)(n),"scaleOptions",{}),Object(L.a)(Object(De.a)(n),"animateStatus",!1),Object(L.a)(Object(De.a)(n),"isDestroyed",!1),Object(L.a)(Object(De.a)(n),"encodeDataLength",0),Object(L.a)(Object(De.a)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var o=n.layerSource.getSourceCfg().autoRender;o&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return Object(Rt.a)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=Object(we.a)(Object(we.a)({},this.needUpdateConfig),i);else{var o=this.container.get(Qt.SceneID);this.configService.setLayerConfig(o,this.id,Object(we.a)(Object(we.a)(Object(we.a)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o=this,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:l=this.container.get(Qt.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Qt.IIconService),this.fontService=this.container.get(Qt.IFontService),this.rendererService=this.container.get(Qt.IRendererService),this.layerService=this.container.get(Qt.ILayerService),this.debugService=this.container.get(Qt.IDebugService),this.interactionService=this.container.get(Qt.IInteractionService),this.pickingService=this.container.get(Qt.IPickingService),this.mapService=this.container.get(Qt.IMapService),c=this.getLayerConfig(),h=c.enableMultiPassRenderer,_=c.passes,h&&_!==null&&_!==void 0&&_.length&&_.length>0&&this.mapService.on("mapAfterFrameChange",function(){o.renderLayers()}),this.cameraService=this.container.get(Qt.ICameraService),this.coordinateService=this.container.get(Qt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Qt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Qt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Qt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Qt.IStyleAttributeService),h&&(this.multiPassRenderer=this.container.get(Qt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(B){var U=B.attributeName,ee=B.attributeField,ie=B.attributeValues,_e=B.updateOptions;o.styleAttributeService.updateStyleAttribute(U,{scale:Object(we.a)({field:ee},o.splitValuesAndCallbackInAttribute(ie,ee?void 0:o.getLayerConfig()[U]))},_e)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Qt.ILayerPlugin),x=J4(this.plugins);try{for(x.s();!(E=x.n()).done;)C=E.value,C.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(B){x.e(B)}finally{x.f()}return this.layerPickService=new Y4(this),this.textureService=new K4(this),this.log(Gs.LayerInitStart),P.next=31,this.hooks.init.promise();case 31:this.log(Gs.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(o,".").concat(i),c={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,c)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,o){return this.updateStyleAttribute("color",i,a,o),this}},{key:"texture",value:function(i,a,o){return this.updateStyleAttribute("texture",i,a,o),this}},{key:"rotate",value:function(i,a,o){return this.updateStyleAttribute("rotate",i,a,o),this}},{key:"size",value:function(i,a,o){return this.updateStyleAttribute("size",i,a,o),this}},{key:"filter",value:function(i,a,o){var l=this.updateStyleAttribute("filter",i,a,o);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,o){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,o);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,o){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:o}),this}},{key:"animate",value:function(i){var a={};return Bu(i)?(a.enable=!0,a=Object(we.a)(Object(we.a)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var o=this;return this.inited?(this.log(Gs.SourceInitStart,vu.UPDATE),this.layerSource.setData(i,a),this.log(Gs.SourceInitEnd,vu.UPDATE)):this.on("inited",function(){o.log(Gs.SourceInitStart,vu.UPDATE);var l=o.getSource();l?o.layerSource.setData(i,a):o.source(new Z2(i,a)),o.layerSource.once("update",function(){o.log(Gs.SourceInitEnd,vu.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,o=i.passes,l=Object(Th.a)(i,q4);o&&nS(o).forEach(function(h){var _=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(h[0]);_&&_.updateOptions(h[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var c=l;return Object.keys(l).forEach(function(h){var _=l[h];Array.isArray(_)&&_.length===2&&!lS(_[0])&&!lS(_[1])&&(c[h]={field:_[0],value:_[1]})}),this.encodeStyle(c),this.updateLayerConfig(c),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(o){[].concat(Object(cr.a)(a.enableShaderEncodeStyles),Object(cr.a)(a.enableDataEncodeStyles)).includes(o)&&n5(i[o])&&(i[o].field||i[o].value)&&!i1(a.encodeStyleAttribute[o],i[o])?(a.encodeStyleAttribute[o]=i[o],a.updateStyleAttribute(o,i[o].field,i[o].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[o]&&(delete a.encodeStyleAttribute[o],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var o=Object(we.a)({},this.scaleOptions);if(Bu(i)?this.scaleOptions=Object(we.a)(Object(we.a)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!i1(o,this.scaleOptions)){var l=Bu(i)?i:Object(L.a)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Bu(i)?!0:i,Bu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var o=this;if(Bu(i)){var l=i.x,c=l===void 0?0:l,h=i.y,_=h===void 0?0:h;this.updateLayerConfig({highlightColor:Bu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Bu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Bu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Bu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(os(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Bu(i)?!0:i,Bu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var o=this;if(Bu(i)){var l=i.x,c=l===void 0?0:l,h=i.y,_=h===void 0?0:h;this.updateLayerConfig({selectColor:Bu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Bu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:c,y:_})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Bu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Bu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(os(i)).then(function(){setTimeout(function(){o.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),o=a.visible,l=a.minZoom,c=l===void 0?-Infinity:l,h=a.maxZoom,_=h===void 0?Infinity:h;return!!o&&i>=c&&i<_}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var o=this.getLayerConfig(),l=o.passes,c=l===void 0?[]:l;this.multiPassRenderer=iS(this,c,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var h=this.rendererService.getViewportSize(),_=h.width,x=h.height;this.multiPassRenderer.resize(_,x)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),o=a.extent,l=o.some(function(c){return Math.abs(c)===Infinity});return l?this:(this.mapService.fitBounds([[o[0],o[1]],[o[2],o[3]]],i),this)}},{key:"destroy",value:function(){var i,a,o,l,c,h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(E){E.destroy()}),this.layerChildren.map(function(E){return E.destroy(!1)}),this.layerChildren=[];var _=this.getLayerConfig(),x=_.maskfence;x&&(this.masks.map(function(E){return E.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(o=this.layerModel)===null||o===void 0||o.clearModels(h),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(c=this.debugService)===null||c===void 0||c.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var o=this.mapService.getZoom();this.layerSource.updateClusterData(o)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var c=l.type;if(a.coordCenter===void 0){var h,_=a.layerSource.center;a.coordCenter=_,(h=a.mapService)!==null&&h!==void 0&&h.setCoordCenter&&a.mapService.setCoordCenter(_)}if(c==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,o,l,c=this.styleAttributeService.getLayerStyleAttribute(i),h=(c==null||(a=c.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(o=h[0].option)===null||o===void 0?void 0:o.type,field:c==null||(l=c.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var o=a.range().map(function(h){return Object(L.a)({value:a.invertExtent(h)},i,h)});return o}else if(a.ticks){var l=a.ticks().map(function(h){return Object(L.a)({value:h},i,a(h))});return l}else if(a!=null&&a.domain){var c=a.domain().filter(function(h){return!i5(h)}).map(function(h){return Object(L.a)({value:h},i,a(h))});return c}return[]}},{key:"pick",value:function(i){var a=i.x,o=i.y;this.interactionService.triggerHover({x:a,y:o})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l=this,c,h,_,x,E,C,I,P,B,U,ee,ie;return he.a.wrap(function(Oe){for(;;)switch(Oe.prev=Oe.next){case 0:return c=o.moduleName,h=o.vertexShader,_=o.fragmentShader,x=o.inject,E=o.triangulation,C=o.styleOption,I=Object(Th.a)(o,Q4),this.shaderModuleService.registerModule(c,{vs:h,fs:_,inject:x}),P=this.shaderModuleService.getModule(c),B=P.vs,U=P.fs,ee=P.uniforms,ie=this.rendererService.createModel,Oe.abrupt("return",new Promise(function(ke){var Ke=l.styleAttributeService.createAttributesAndIndices(l.encodedData,E,C),ot=Ke.attributes,Ot=Ke.elements,Zt=Ke.count,ir=Object(we.a)({attributes:ot,uniforms:ee,fs:U,vs:B,elements:Ot,blend:rS[Zp.normal],uniformBuffers:[].concat(Object(cr.a)(l.layerModel.uniformBuffers),Object(cr.a)(l.rendererService.uniformBuffers)),textures:l.layerModel.textures},I);Zt&&(ir.count=Zt);var Hr=ie(ir);ke(Hr)}));case 5:case"end":return Oe.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,o=this.styleAttributeService.createAttributes(this.encodedData,a),l=o.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),o=a.enableHighlight,l=o===void 0?!0:o,c=a.enableSelect,h=c===void 0?!0:c,_=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&h&&(_=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(_=!0),this.isVisible()&&_}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,o.render();case 2:case"end":return c.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(o){o.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,o,l){var c=this.configService.getAttributeConfig(this.id)||{};return i1(c[i],{field:a,values:o})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,Object(L.a)({},i,{field:a,values:o})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:Object(we.a)({field:a},this.splitValuesAndCallbackInAttribute(o,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:o,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.models.forEach(function(c){return c.destroy()}),this.models=[],l.next=4,this.layerModel.initModels();case 4:this.models=l.sent;case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:uS(i)?void 0:i,callback:uS(i)?i:void 0}}}]),t}(uo.EventEmitter),oS=ma(n1.prototype,"configService",[aS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n1);function a5(e,r){return{enable:e,mask:255,func:{cmp:Z.EQUAL,ref:r?1:0,mask:1}}}function fS(e){return e.maskOperation===zy.OR?{enable:!0,mask:255,func:{cmp:Z.ALWAYS,ref:1,mask:255},opFront:{fail:Z.KEEP,zfail:Z.REPLACE,zpass:Z.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===$d.SINGLE||e.stencilIndex===0?Z.ALWAYS:Z.LESS,ref:e.stencilType===$d.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:Z.KEEP,zfail:Z.REPLACE,zpass:Z.REPLACE}}}var o5={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},Gy={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function WW(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function hS(e){return Math.ceil(e/4)*4}var Xs=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e}({});function s5(e){switch(e){case"rotation":return{name:"Rotation",type:Rn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:Xs.ROTATION,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Rn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:Xs.STROKE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Rn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:Xs.OPACITY,buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Rn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:Xs.EXTRUSION_BASE,buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Rn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:Xs.OFFSETS,buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Rn.Attribute,descriptor:{name:"a_ThetaOffset",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var pS,a1,dS,vS={opacity:Xs.OPACITY,stroke:Xs.STROKE,offsets:Xs.OFFSETS,rotation:Xs.ROTATION,extrusionBase:Xs.EXTRUSION_BASE},Ga=(pS=Q_(Qt.IGlobalConfigService),a1=function(){function e(r){Object(Et.a)(this,e),Object(L.a)(this,"uniformBuffers",[]),Object(L.a)(this,"textures",[]),Object(L.a)(this,"preStyleAttribute",{}),Object(L.a)(this,"encodeStyleAttribute",{}),ga(this,"configService",dS,this),this.layer=r,this.rendererService=r.getContainer().get(Qt.IRendererService),this.pickingService=r.getContainer().get(Qt.IPickingService),this.shaderModuleService=r.getContainer().get(Qt.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Qt.IStyleAttributeService),this.mapService=r.getContainer().get(Qt.IMapService),this.iconService=r.getContainer().get(Qt.IIconService),this.fontService=r.getContainer().get(Qt.IFontService),this.cameraService=r.getContainer().get(Qt.ICameraService),this.layerService=r.getContainer().get(Qt.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return Object(Rt.a)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return rS[Zp[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,o=n.maskInside,l=o===void 0?!0:o,c=n.enableMask,h=n.maskOperation,_=h===void 0?zy.AND:h;if(this.layer.type==="MaskLayer")return fS({isStencil:!0,stencilType:$d.SINGLE});if(t.isStencil)return fS(Object(we.a)(Object(we.a)({},t),{},{maskOperation:_}));var x=a||c&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return a5(x,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(Gy[l]," u_").concat(l,";")),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(vS[l],") in ").concat(Gy[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var o="";return this.layer.enableShaderEncodeStyles.forEach(function(l){o+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(Gy[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(Gy[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":o}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],o=typeof a=="undefined"?o5[i]:a;i==="stroke"&&(o=oa(o)),n["u_"+i]=o}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=s5(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=vS[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(hS(t.uniformsLength)),isUBO:!0}),this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(hS(n.uniformsLength)),isUBO:!0}),this.uniformBuffers=[this.attributeUnifoms,this.commonUnifoms]}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,Object(cr.a)(a)),n+=a.length):(i.push(a),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=t.uniformsArray,i=this.getCommonUniformsInfo(),a=i.uniformsArray;this.attributeUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),this.commonUnifoms.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)})}}]),e}(),dS=ma(a1.prototype,"configService",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1),Sg=100,mS=36,u5=40;function gS(e){return e/180*Math.acos(-1)}function yS(e){var r=gS(e[0])+Math.PI/2,t=gS(e[1]),n=Sg+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),o=n*Math.sin(t);return[a,o,i]}function _S(e,r){var t=N.create(),n=N.create(),i=z.fromValues(0,1,0),a=z.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var o=typeof r.segments!="undefined"?r.segments:32,l=2+o,c=2*l,h=[],_=[],x=[],E=[],C=[],I=[],P=0;P<=l;P++){for(var B=P/l,U=B*Math.PI,ee=0;ee<=c;ee++){var ie=ee/c,_e=ie*Math.PI*2;N.identity(n),N.rotateZ(n,n,-U),N.identity(t),N.rotateY(t,t,_e),z.transformMat4(a,i,n),z.transformMat4(a,a,t),z.scale(a,a,-e),x.push(a.slice()),E.push.apply(E,Object(cr.a)(a.slice())),z.normalize(a,a),C.push.apply(C,Object(cr.a)(a.slice())),I.push([ie,1-B]),E.push(ie,1-B)}if(P>0)for(var Oe=x.length,ke=Oe-2*(c+1);ke+c+2<Oe;ke++)h.push([ke,ke+1,ke+c+1]),_.push(ke,ke+1,ke+c+1),h.push([ke+c+1,ke+1,ke+c+2]),_.push(ke+c+1,ke+1,ke+c+2)}return{cells:h,positions:x,uvs:I,positionsArr:E,indicesArr:_,normalArr:C}}var Xy=v.create(),GW=v.create(),uu=v.create(),qp=v.create(),tm=v.create();function o1(e,r,t,n,i){v.add(e,t,n),v.normalize(e,e),r=v.fromValues(-e[1],e[0]);var a=v.fromValues(-t[1],t[0]);return[i/v.dot(r,a),r]}function Qp(e,r){return v.set(e,-r[1],r[0])}function rm(e,r,t){return v.sub(e,r,t),v.normalize(e,e),e}function s1(e,r){return e[0]===r[0]&&e[1]===r[1]}function XW(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var l5=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object(Et.a)(this,e),Object(L.a)(this,"lastFlip",-1),Object(L.a)(this,"miter",v.fromValues(0,0)),Object(L.a)(this,"started",!1),Object(L.a)(this,"dash",!1),Object(L.a)(this,"totalDistance",0),Object(L.a)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return Object(Rt.a)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],h=o<t.length-1?t[o+1]:null,_=this.simpleSegment(n,a,l,c,h);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,h,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var E=n[l-1],C=t[l];C.push((h=n[l][2])!==null&&h!==void 0?h:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,U=this.simpleSegment(i,o,x,C,P,E,I,B);o+=U}if(this.dash)for(var ee=0;ee<i.positions.length/6;ee++)i.positions[ee*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,o=i.startIndex,l=1;l<a;l++){var c,h,_,x=t[l-1];x.push((c=n[l-1][2])!==null&&c!==void 0?c:0);var E=n[l-1],C=t[l];C.push((h=n[l][2])!==null&&h!==void 0?h:0);var I=n[l],P=l<t.length-1?[].concat(Object(cr.a)(t[l+1]),[(_=n[l+1][2])!==null&&_!==void 0?_:0]):null,B=l<n.length-1?n[l+1]:null,U=this.segment_gaode2(i,o,x,C,P,E,I,B);o+=U}if(this.dash)for(var ee=0;ee<i.positions.length/6;ee++)i.positions[ee*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,o=1;o<i;o++){var l=t[o-1],c=t[o],h=o<t.length-1?t[o+1]:null,_=this.segment(n,a,l,c,h);a+=_}if(this.dash)for(var x=0;x<n.positions.length/6;x++)n.positions[x*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,o){var l=0,c=t.indices,h=t.positions,_=t.normals,x=G([a[0],a[1]]),E=G([i[0],i[1]]);rm(uu,x,E);var C=0;if(this.dash&&(C=this.lineSegmentDistance(x,E),this.totalDistance+=C),this.normal||(this.normal=v.create(),Qp(this.normal,uu)),this.started||(this.started=!0,this.extrusions(h,_,i,this.normal,this.thickness,this.totalDistance-C)),c.push(n+0,n+1,n+2),!o)Qp(this.normal,uu),this.extrusions(h,_,a,this.normal,this.thickness,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var I=G([o[0],o[1]]);s1(x,I)&&v.add(I,x,v.normalize(I,v.subtract(I,x,E))),rm(qp,I,x);var P=o1(tm,v.create(),uu,qp,this.thickness),B=Object(Bn.a)(P,2),U=B[0],ee=B[1],ie=v.dot(tm,this.normal)<0?-1:1;this.extrusions(h,_,a,ee,U,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ie=-1,v.copy(this.normal,ee),l+=2,this.lastFlip=ie}return l}},{key:"segment_gaode2",value:function(t,n,i,a,o,l,c,h){var _=0,x=t.indices,E=t.positions,C=t.normals,I=this.cap==="square",P=this.join==="bevel",B=G([c[0],c[1]]),U=G([l[0],l[1]]);rm(uu,a,i);var ee=0;if(this.dash&&(ee=this.lineSegmentDistance(B,U),this.totalDistance+=ee),this.normal||(this.normal=v.create(),Qp(this.normal,uu)),!this.started)if(this.started=!0,I){var ie=v.create(),_e=v.create();v.add(ie,this.normal,uu),v.add(_e,this.normal,uu),C.push(_e[0],_e[1],0),C.push(ie[0],ie[1],0),E.push(i[0],i[1],i[2]|0,this.totalDistance-ee,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),E.push(i[0],i[1],i[2]|0,this.totalDistance-ee,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,C,i,this.normal,this.thickness,this.totalDistance-ee);if(x.push(n+0,n+1,n+2),o){s1(a,o)&&v.add(o,a,v.normalize(o,v.subtract(o,a,i))),rm(qp,o,a);var Ke=o1(tm,v.create(),uu,qp,this.thickness),ot=Object(Bn.a)(Ke,2),Ot=ot[0],Zt=ot[1],ir=v.dot(tm,this.normal)<0?-1:1,Hr=P;if(!Hr&&this.join==="miter"){var ln=Ot;ln>this.miterLimit&&(Hr=!0)}Hr?(C.push(this.normal[0],this.normal[1],0),C.push(Zt[0],Zt[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,x.push.apply(x,Object(cr.a)(this.lastFlip!==-ir?[n,n+2,n+3]:[n+2,n+1,n+3])),x.push(n+2,n+3,n+4),Qp(Xy,qp),v.copy(this.normal,Xy),C.push(this.normal[0],this.normal[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*ir,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,_+=3):(this.extrusions(E,C,a,Zt,Ot,this.totalDistance),x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),ir=-1,v.copy(this.normal,Zt),_+=2),this.lastFlip=ir}else{if(Qp(this.normal,uu),I){var Oe=v.create(),ke=v.create();v.sub(ke,uu,this.normal),v.add(Oe,uu,this.normal),C.push(ke[0],ke[1],0),C.push(Oe[0],Oe[1],0),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),E.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(E,C,a,this.normal,this.thickness,this.totalDistance);x.push.apply(x,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_+=2}return _}},{key:"segment",value:function(t,n,i,a,o){var l=0,c=t.indices,h=t.positions,_=t.normals,x=this.cap==="square",E=this.join==="bevel",C=G([a[0],a[1]]),I=G([i[0],i[1]]);rm(uu,C,I);var P=0;if(this.dash&&(P=this.lineSegmentDistance(C,I),this.totalDistance+=P),this.normal||(this.normal=v.create(),Qp(this.normal,uu)),!this.started)if(this.started=!0,x){var B=v.create(),U=v.create();v.add(B,this.normal,uu),v.add(U,this.normal,uu),_.push(U[0],U[1],0),_.push(B[0],B[1],0),h.push(i[0],i[1],i[2]|0,this.totalDistance-P,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),h.push(i[0],i[1],i[2]|0,this.totalDistance-P,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,_,i,this.normal,this.thickness,this.totalDistance-P);if(c.push(n+0,n+1,n+2),o){var _e=G([o[0],o[1]]);s1(C,_e)&&v.add(_e,C,v.normalize(_e,v.subtract(_e,C,I))),rm(qp,_e,C);var Oe=o1(tm,v.create(),uu,qp,this.thickness),ke=Object(Bn.a)(Oe,2),Ke=ke[0],ot=ke[1],Ot=v.dot(tm,this.normal)<0?-1:1,Zt=E;if(!Zt&&this.join==="miter"){var ir=Ke;ir>this.miterLimit&&(Zt=!0)}Zt?(_.push(this.normal[0],this.normal[1],0),_.push(ot[0],ot[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,Object(cr.a)(this.lastFlip!==-Ot?[n,n+2,n+3]:[n+2,n+1,n+3])),c.push(n+2,n+3,n+4),Qp(Xy,qp),v.copy(this.normal,Xy),_.push(this.normal[0],this.normal[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Ot,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(h,_,a,ot,Ke,this.totalDistance),c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ot=-1,v.copy(this.normal,ot),l+=2),this.lastFlip=Ot}else{if(Qp(this.normal,uu),x){var ee=v.create(),ie=v.create();v.sub(ie,uu,this.normal),v.add(ee,uu,this.normal),_.push(ie[0],ie[1],0),_.push(ee[0],ee[1],0),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),h.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(h,_,a,this.normal,this.thickness,this.totalDistance);c.push.apply(c,Object(cr.a)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,o,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-o,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,o,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function c5(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Yr.a.flatten(e),a=i.vertices,o=i.dimensions,l=[],c=[],h=0;h<a.length/o;h++)o===2?l.push(a[h*2],a[h*2+1],1):l.push(a[h*3],a[h*3+1],1);var _=Yr()(i.vertices,i.holes,i.dimensions);c.push.apply(c,Object(cr.a)(_));for(var x=function(){var I=i.vertices.slice(E*o,(E+1)*o),P=i.vertices.slice((E+1)*o,(E+2)*o);P.length===0&&(P=i.vertices.slice(0,o));var B=l.length/3;l.push(I[0],I[1],1,P[0],P[1],1,I[0],I[1],0,P[0],P[1],0),c.push.apply(c,Object(cr.a)([0,2,1,2,3,1].map(function(U){return U+B})))},E=0;E<n;E++)x();return{positions:l,index:c}}function f5(e){var r=Yr.a.flatten(e),t=Yr()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function bS(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Yr.a.flatten(e),o=a.vertices,l=a.dimensions,c=[],h=[],_=[],x=0;x<o.length/l;x++)c.push(o[x*l],o[x*l+1],1,-1,-1),_.push(0,0,1);var E=Yr()(a.vertices,a.holes,a.dimensions);h.push.apply(h,Object(cr.a)(E));for(var C=function(){var B=a.vertices.slice(I*l,(I+1)*l),U=a.vertices.slice((I+1)*l,(I+2)*l);U.length===0&&(U=a.vertices.slice(0,l));var ee=c.length/5;c.push(B[0],B[1],1,0,0,U[0],U[1],1,.1,0,B[0],B[1],0,0,.8,U[0],U[1],0,.1,.8);var ie=h5([U[0],U[1],1],[B[0],B[1],0],[B[0],B[1],1],r);_.push.apply(_,Object(cr.a)(ie).concat(Object(cr.a)(ie),Object(cr.a)(ie),Object(cr.a)(ie))),h.push.apply(h,Object(cr.a)([1,2,0,3,2,1].map(function(_e){return _e+ee})))},I=0;I<i;I++)C();return{positions:c,index:h,normals:_}}function h5(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=z.create(),a=z.create(),o=z.create();n&&(e=y(e),r=y(r),t=y(t));var l=z.fromValues.apply(z,Object(cr.a)(e)),c=z.fromValues.apply(z,Object(cr.a)(r)),h=z.fromValues.apply(z,Object(cr.a)(t));z.sub(i,h,c),z.sub(a,l,c),z.cross(o,i,a);var _=z.create();return z.normalize(_,o),_}var uf,Ag=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),Tg=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Cg(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(o){var l=Math.sin(o+Math.PI/4),c=Math.cos(o+Math.PI/4);return[l,c,0]});return a}function u1(){return Cg(30)}function xS(){return Cg(4)}function ES(){return Cg(3)}function SS(){return Cg(6,1)}function AS(){return Cg(5)}var nm=(uf={},Object(L.a)(uf,Tg.CIRCLE,u1),Object(L.a)(uf,Tg.HEXAGON,SS),Object(L.a)(uf,Tg.TRIANGLE,ES),Object(L.a)(uf,Tg.SQUARE,xS),Object(L.a)(uf,Tg.PENTAGON,AS),Object(L.a)(uf,Ag.CYLINDER,u1),Object(L.a)(uf,Ag.HEXAGONCOLUMN,SS),Object(L.a)(uf,Ag.TRIANGLECOLUMN,ES),Object(L.a)(uf,Ag.SQUARECOLUMN,xS),Object(L.a)(uf,Ag.PENTAGONCOLUMN,AS),uf),Zy={};function $y(e){var r=$r(e.coordinates);return{vertices:[].concat(Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r),Object(cr.a)(r)),indices:[0,1,2,2,3,0],size:r.length}}function TS(e){var r=$r(e.coordinates),t=yS(r);return{vertices:[].concat(Object(cr.a)(t),Object(cr.a)(t),Object(cr.a)(t),Object(cr.a)(t)),indices:[0,1,2,2,3,0],size:t.length}}function l1(e){var r=e.shape,t=_5(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function p5(e){var r=$r(e.coordinates);return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}function c1(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new l5({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var o=t;Array.isArray(o[0][0])||(o=[t]);for(var l=0;l<a.length;l++){var c=a[l],h=o[l];i.extrude_gaode2(c,h)}}else{var _=r;_[0]&&!Array.isArray(_[0][0])&&(_=[r]),_.forEach(function(E){i.extrude(E)})}var x=i.complex;return{vertices:x.positions,indices:x.indices,normals:x.normals,indexes:x.indexes,size:6}}function ZW(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r),[1,0,0],Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function d5(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var n=v5(r),i=n.results,a=n.totalDistance;return i.map(function(o){t.push(o[0],o[1],o[2],o[3],0,a)}),{vertices:t,indices:[],normals:[],size:6,count:i.length}}function $W(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=m5(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function CS(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function im(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function v5(e){var r=e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=e.flat());var t=0;if(r.length<2)return{results:r,totalDistance:0};var n=[],i=im(r[0],t);n.push(i);for(var a=1;a<r.length-1;a++){var o=CS(r[a-1],r[a]);t+=o;var l=im(r[a],t);n.push(l),n.push(l)}var c=CS(r[r.length-2],r[r.length-1]);return t+=c,n.push(im(r[r.length-1],t)),{results:n,totalDistance:t}}function m5(e){if(e.length<2)return{results:e};var r=[],t=im(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=im(e[n]);r.push(i),r.push(i)}return r.push(im(e[e.length-1])),{results:r}}function f1(e){var r=e.coordinates,t=Yr.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Yr()(n,a,i),vertices:n,size:i}}function g5(e){var r=e.coordinates,t=Yr.a.flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Yr()(n,a,i),vertices:y5(n),size:i+4}}function y5(e){for(var r=[],t=Qr(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var o=e[a],l=e[a+1];r.push.apply(r,[o,l,0].concat(Object(cr.a)(n),[i]))}return r}function h1(e){var r=e.coordinates,t=bS(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function wS(e){var r=e.shape,t=x5(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function Yy(e){var r=e.coordinates,t=[].concat(Object(cr.a)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],Object(cr.a)(r[1]),[0,1,0],Object(cr.a)(r[0]),[0,0,1],Object(cr.a)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function Ky(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],o=[],l=function(_){a.push(_,1,_,i[0][0],i[0][1],i[1][0],i[1][1],_,-1,_,i[0][0],i[0][1],i[1][0],i[1][1]),_!==n-1&&o.push.apply(o,Object(cr.a)([0,1,2,1,3,2].map(function(x){return _*2+x})))},c=0;c<n;c++)l(c);return{vertices:a,indices:o,size:7}}function OS(e){var r=e.coordinates;r.length===2&&r.push(0);var t=qy(-1,1),n=qy(1,1),i=qy(-1,-1),a=qy(1,-1),o=[].concat(Object(cr.a)(r),Object(cr.a)(t),Object(cr.a)(r),Object(cr.a)(i),Object(cr.a)(r),Object(cr.a)(a),Object(cr.a)(r),Object(cr.a)(n)),l=[0,1,2,3,0,2];return{vertices:o,indices:l,size:5}}function _5(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Zy&&Zy[e])return Zy[e];var t=nm[e]?nm[e]():nm.cylinder(),n=bS([t],r);return Zy[e]=n,n}function YW(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,o,l,c=z.create(),h=z.create(),_=z.create(),x=0,E=r.length;x<E;x+=3){a=r[x+0]*3,o=r[x+1]*3,l=r[x+2]*3;var C=[e[a],e[a+1]],I=[e[o],e[o+1]],P=[e[l],e[l+1]];n&&(C=y(C),I=y(I),P=y(P));var B=C,U=Object(Bn.a)(B,2),ee=U[0],ie=U[1],_e=z.fromValues(ee,ie,e[a+2]),Oe=I,ke=Object(Bn.a)(Oe,2),Ke=ke[0],ot=ke[1],Ot=z.fromValues(Ke,ot,e[o+2]),Zt=P,ir=Object(Bn.a)(Zt,2),Hr=ir[0],ln=ir[1],pn=z.fromValues(Hr,ln,e[l+2]);z.sub(c,pn,Ot),z.sub(h,_e,Ot),z.cross(_,c,h),i[a]+=c[0],i[a+1]+=c[1],i[a+2]+=c[2],i[o]+=c[0],i[o+1]+=c[1],i[o+2]+=c[2],i[l]+=c[0],i[l+1]+=c[1],i[l+2]+=c[2]}return b5(i),i}function b5(e){for(var r=0,t=e.length;r<t;r+=3){var n=z.fromValues(e[r],e[r+1],e[r+2]),i=z.create();z.normalize(i,n),e.set(i,r)}}function KW(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function x5(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=nm[e]?nm[e]():nm.circle(),n=r.indexOf(e)===-1?f5([t]):c5([t]);return n}function qy(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function qW(){var e=_S(Sg,{segments:mS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function QW(){var e=_S(Sg+u5,{segments:mS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function E5(e){var r=S5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function S5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A5=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,T5=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,C5=function(e){Object(qr.a)(t,e);var r=E5(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.baseColor,c=l===void 0?"rgb(16,16,16)":l,h=i.brightColor,_=h===void 0?"rgb(255,176,38)":h,x=i.windowColor,E=x===void 0?"rgb(30,60,89)":x,C=i.time,I=C===void 0?0:C,P=i.sweep,B=P===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:P;return{u_cityCenter:B.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*B.sweepRadius,u_circleSweep:B.enable?1:0,u_circleSweepColor:oa(B.sweepColor).slice(0,3),u_circleSweepSpeed:B.sweepSpeed,u_opacity:o,u_baseColor:oa(c),u_brightColor:oa(_),u_windowColor:oa(E),u_time:this.layer.getLayerAnimateTime()||I}}},{key:"calCityGeo",value:function(){var i=Object(Bn.a)(this.layer.getSource().extent,4),a=i[0],o=i[1],l=i[2],c=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(c+o)/2]);var h=this.mapService.lngLatToCoord([l,c]),_=this.mapService.lngLatToCoord([a,o]);this.cityMinSize=Math.sqrt(Math.pow(h[0]-_[0],2)+Math.pow(h[1]-_[1],2))/4}else{var x=l-a,E=c-o;this.cityCenter=[(l+a)/2,(c+o)/2],this.cityMinSize=Math.sqrt(Math.pow(x,2)+Math.pow(E,2))/4}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:T5,fragmentShader:A5,triangulation:h1,depth:{enable:!0},cull:{enable:!0,face:Z.BACK}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?10:o;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ga);function w5(e){var r=O5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function O5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R5=function(e){Object(qr.a)(t,e);var r=w5(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","CityBuildingLayer"),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new C5(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Kp);function M5(e){var r=P5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function P5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I5=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
\r
varying vec4 v_color;\r
\r
uniform vec2 u_sceneCenterMercator;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,k5=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,D5=function(e){Object(qr.a)(t,e);var r=M5(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:I5,fragmentShader:k5,triangulation:wS,primitive:Z.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Rn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ga);function F5(e){var r=B5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function B5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L5=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,N5=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,j5=function(e){Object(qr.a)(t,e);var r=F5(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||1,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:L5,fragmentShader:N5,triangulation:l1,primitive:Z.TRIANGLES,depth:{enable:!0}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size;return Array.isArray(o)?[o[0]]:[o]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Rn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ga);function z5(e,r){for(var t=[],n=[],i=[],a=e+1,o=r+1,l=e/2,c=r/2,h=0;h<o;h++)for(var _=h-c,x=0;x<a;x++){var E=x-l;n.push(E/l,-_/c,0),i.push(x/e),i.push(1-h/r)}for(var C=0;C<r;C++)for(var I=0;I<e;I++){var P=I+a*C,B=I+a*(C+1),U=I+1+a*(C+1),ee=I+1+a*C;t.push(P,B,ee),t.push(B,U,ee)}return{vertices:n,indices:t,uvs:i}}var RS,MS;function U5(e){var r=V5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function V5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H5=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,W5=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,G5=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

uniform vec2 u_ViewportSize;

float getBlurIndusty() {
    float vW = 2.0/u_ViewportSize.x;
    float vH = 2.0/u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,X5=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Z5=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,$5=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Y5=xi.isEqual,PS=(RS=Object(on.injectable)(),RS(MS=function(e){Object(qr.a)(t,e);var r=U5(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"render",value:function(i){var a=this,o=this.rendererService,l=o.clear,c=o.useFramebuffer,h=this.layer.getLayerConfig(),_=h.rampColors;c(this.heatmapFramerBuffer,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),Y5(this.preRampColors,_)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C,I,P;return he.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return l=this.rendererService,c=l.createFramebuffer,h=l.getViewportSize,_=l.createTexture2D,x=this.styleAttributeService.getLayerStyleAttribute("shape"),E=(x==null||(o=x.scale)===null||o===void 0?void 0:o.field)||"heatmap",this.shapeType=E,U.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=U.sent,this.colorModel=E==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap(),C=h(),I=C.width,P=C.height,this.heatmapFramerBuffer=c({color:_({width:Math.floor(I/4),height:Math.floor(P/4),wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE,min:Z.LINEAR,mag:Z.LINEAR}),depth:!1}),this.updateColorTexture(),U.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return U.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Rn.Attribute,descriptor:{name:"a_Dir",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=OS,c.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:$5,fragmentShader:Z5,triangulation:OS,depth:{enable:!1},cull:{enable:!0,face:pc(this.mapService.version)}});case 3:return o=c.sent,c.abrupt("return",o);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:X5,fs:G5});var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,o=i.fs,l=i.uniforms,c=this.rendererService,h=c.createAttribute,_=c.createElements,x=c.createBuffer,E=c.createModel;return E({vs:a,fs:o,attributes:{a_Position:h({buffer:x({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:Z.FLOAT}),size:3}),a_Uv:h({buffer:x({data:[0,1,1,1,0,0,1,0],type:Z.FLOAT}),size:2})},uniforms:Object(we.a)({},l),depth:{enable:!1},elements:_({data:[0,2,1,2,3,1],type:Z.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),o=a.opacity,l=a.intensity,c=l===void 0?10:l,h=a.radius,_=h===void 0?5:h;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:{u_opacity:o||1,u_radius:_,u_intensity:c},blend:{enable:!0,func:{srcRGB:Z.ONE,srcAlpha:1,dstRGB:Z.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(i){var a,o=this.layer.getLayerConfig(),l=o.opacity;(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,o=this.layer.getLayerConfig(),l=o.opacity,c=N.create();N.invert(c,this.cameraService.getViewProjectionMatrixUncentered()),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:{u_opacity:l||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:Object(cr.a)(c)},blend:{enable:!0,func:{srcRGB:Z.SRC_ALPHA,srcAlpha:1,dstRGB:Z.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),o=a.width,l=a.height,c=z5(o/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:W5,fs:H5});var h=this.shaderModuleService.getModule("heatmap3dColor"),_=h.vs,x=h.fs,E=h.uniforms,C=this.rendererService,I=C.createAttribute,P=C.createElements,B=C.createBuffer,U=C.createModel;return U({vs:_,fs:x,attributes:{a_Position:I({buffer:B({data:c.vertices,type:Z.FLOAT}),size:3}),a_Uv:I({buffer:B({data:c.uvs,type:Z.FLOAT}),size:2})},primitive:Z.TRIANGLES,uniforms:Object(we.a)({},E),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:Z.SRC_ALPHA,srcAlpha:1,dstRGB:Z.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:P({data:c.indices,type:Z.UNSIGNED_INT,count:c.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),o=a.rampColors,l=Ll(o);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE,min:Z.NEAREST,mag:Z.NEAREST,flipY:!1}),this.preRampColors=o}}]),t}(Ga))||MS);function K5(e){var r=q5();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function q5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q5=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,J5=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform vec2 u_sceneCenterMercator;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,ek=function(e){Object(qr.a)(t,e);var r=K5(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.coverage,l=i.angle;return{u_opacity:a||1,u_coverage:o||.9,u_angle:l||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:J5,fragmentShader:Q5,triangulation:wS,depth:{enable:!1},primitive:Z.TRIANGLES});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Rn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[o[0],o[1],0]}}})}}]),t}(Ga),tk={heatmap:PS,heatmap3d:PS,grid:D5,grid3d:j5,hexagon:ek},rk=tk;function nk(e){var r=ik();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function ik(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ak=function(e){Object(qr.a)(t,e);var r=nk(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","HeatMapLayer"),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new rk[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.getModelType();return o==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=this.getLayerConfig(),l=o.shape3d,c=this.getSource(),h=c.data.type,_=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return _==="heatmap"||_==="heatmap3d"?"heatmap":h==="hexagon"?(l==null?void 0:l.indexOf(_))===-1?"hexagon":"grid3d":h==="grid"?(l==null?void 0:l.indexOf(_))===-1?"grid":"grid3d":"heatmap"}}]),t}(Kp);function ok(e){var r=sk();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function sk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uk=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
  if(gl_FragColor.a < 0.01)
    discard;
}
`,lk=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,ck=function(e){Object(qr.a)(t,e);var r=ok(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity;return{u_opacity:a||1,u_texture:this.texture}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,this.texture=l({height:0,width:0}),x.next=5,o.data.images;case 5:return c=x.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,mag:Z.LINEAR,min:Z.LINEAR}),x.next=9,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:lk,fragmentShader:uk,triangulation:Yy,primitive:Z.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 9:return h=x.sent,x.abrupt("return",[h]);case 11:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ga),fk={image:ck},hk=fk;function pk(e){var r=dk();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function dk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IS=function(e){Object(qr.a)(t,e);var r=pk(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","ImageLayer"),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new hk[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Kp);function vk(e){var r=mk();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function mk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gk=`varying vec4 v_dash_array;
varying vec4 v_color;
varying float v_distance_ratio;

uniform float segmentNumber;


#pragma include "picking"

void main() {
  gl_FragColor = v_color;

  float flag = 0.;
  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  };
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,yk=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;
varying float v_distance_ratio;
#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
  // dash: index / (segmentNumber - 1.);
  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;

  v_distance_ratio = segmentIndex / segmentNumber;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
 
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  gl_PointSize = 5.0;
  setPickingColor(a_PickingColor);
}
`,_k=`
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_color;
  

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
}`,bk=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_lineData;
varying vec2 v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

 v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
 v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,xk=`varying vec4 v_color;

#pragma include "picking"

void main() {
// \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}`,Ek=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
varying vec4 v_color;
varying float v_segmentIndex;

uniform float u_lineDir: 1.0;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;




#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  v_color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Sk={solid:0,dash:1},JW=xi.isNumber,Ak=function(e){Object(qr.a)(t,e);var r=vk(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,h=i.textureBlend,_=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,C=i.dashArray,I=C===void 0?[10,5]:C,P=i.forward,B=P===void 0?!0:P,U=i.lineTexture,ee=U===void 0?!1:U,ie=i.iconStep,_e=ie===void 0?100:ie,Oe=i.segmentNumber,ke=Oe===void 0?30:Oe;I.length===2&&I.push(0,0);var Ke=0,ot=[0,0,0,0],Ot=[0,0,0,0];return l&&c&&(ot=oa(l),Ot=oa(c),Ke=1),this.rendererService.getDirty()&&this.texture.bind(),Object(we.a)({u_textureBlend:_==="normal"?0:1,segmentNumber:ke,u_line_type:Sk[E||"solid"],u_dash_array:I,u_blur:.9,u_lineDir:B?1:-1,u_texture:this.texture,u_line_texture:ee?1:0,u_icon_step:_e,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ke,u_sourceColor:ot,u_targetColor:Ot},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:gk,vert:yk,type:"Dash"}:a&&o?{frag:xk,vert:Ek,type:"Linear"}:{frag:_k,vert:bk,type:""}}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,h=this.getShaders(),_=h.frag,x=h.vert,E=h.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+E,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:Ky,depth:{enable:!1},styleOption:{segmentNumber:c}});case 4:return C=P.sent,P.abrupt("return",[C]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Rn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga);function Tk(e){var r=Ck();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function Ck(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Ok=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Rk=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Mk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Pk={solid:0,dash:1},Ik=function(e){Object(qr.a)(t,e);var r=Tk(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,h=i.lineType,_=h===void 0?"solid":h,x=i.dashArray,E=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,P=i.iconStep,B=P===void 0?100:P,U=i.segmentNumber,ee=U===void 0?30:U,ie=i.globalArcHeight,_e=ie===void 0?10:ie;E.length===2&&E.push(0,0);var Oe=0,ke=[0,0,0,0],Ke=[0,0,0,0];return a&&o&&(ke=oa(a),Ke=oa(o),Oe=1),this.rendererService.getDirty()&&this.texture.bind(),Object(we.a)({u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Sg,u_global_height:_e,u_textureBlend:c==="normal"?0:1,segmentNumber:ee,u_line_type:Pk[_]||0,u_dash_array:E,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Oe,u_sourceColor:ke,u_targetColor:Ke},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:Rk,vert:Mk,type:"Linear"}:{frag:wk,vert:Ok,type:""}}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,h=this.getShaders(),_=h.frag,x=h.vert,E=h.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+E,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:Ky,styleOption:{segmentNumber:c}});case 4:return C=P.sent,P.abrupt("return",[C]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Rn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga);function kk(e){var r=Dk();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function Dk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;
varying vec4 v_line_data;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;


varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];


#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Bk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {

  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,Lk=`
#define Animate 0.0
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_Color;

varying float v_distance_ratio;
#pragma include "picking"

void main() {

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  gl_FragColor = v_Color;

  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Nk=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;
attribute vec2 a_iconMapUV;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_distance_ratio;

varying vec4 v_dash_array;
varying vec4 v_color;
varying vec2 v_iconMapUV;
varying vec4 v_Color;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }


  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);

  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);

  v_Color.a *= opacity;

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,jk={solid:0,dash:1},zk=function(e){Object(qr.a)(t,e);var r=kk(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,h=i.textureBlend,_=h===void 0?"normal":h,x=i.lineType,E=x===void 0?"solid":x,C=i.dashArray,I=C===void 0?[10,5]:C,P=i.lineTexture,B=P===void 0?!1:P,U=i.iconStep,ee=U===void 0?100:U,ie=i.segmentNumber,_e=ie===void 0?30:ie,Oe=i.globalArcHeight,ke=Oe===void 0?10:Oe;I.length===2&&I.push(0,0);var Ke=0,ot=[0,0,0,0],Ot=[0,0,0,0];return l&&c&&(ot=oa(l),Ot=oa(c),Ke=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:Sg,u_global_height:ke,u_opacity:o,u_textureBlend:_==="normal"?0:1,segmentNumber:_e,u_line_type:jk[E]||0,u_dash_array:I,u_texture:this.texture,u_line_texture:B?1:0,u_icon_step:ee,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ke,u_sourceColor:ot,u_targetColor:Ot}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:Lk,vert:Nk,type:"Linear"}:{frag:Fk,vert:Bk,type:""}}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,h=this.getShaders(),_=h.frag,x=h.vert,E=h.type,P.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+E,vertexShader:x,fragmentShader:_,triangulation:Ky,depth:{enable:!0},styleOption:{segmentNumber:c}});case 4:return C=P.sent,P.abrupt("return",[C]);case 6:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Rn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga),kS={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},rc=1/2;function Uk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,rc*e,1*e*n,-(a+rc)*e,1*e*n,(a-rc)*e,0,rc*e,1*e*n,-(a+rc)*e,1*e*n,(a-rc)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function Vk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function Hk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function Wk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function Gk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function Xk(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,o=u1(),l=Yr.a.flatten([o]),c=Yr()(l.vertices,l.holes,l.dimensions),h=o.map(function(_){return[_[0]*n*e,_[1]*a]}).flat();return{vertices:[].concat(Object(cr.a)(h),Object(cr.a)(h)),dimensions:2,indices:c.map(function(_){return _+o.length}),outLineIndices:c,normals:[].concat(Object(cr.a)(o.map(function(_){return[_[1]*a,_[0]*n*e,1]}).flat()),Object(cr.a)(new Array(o.length*3).fill(0)))}}function Zk(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=Object(El.a)(t.source)==="object"?t.source.type:t.source,i=Object(El.a)(t.target)==="object"?t.target.type:t.target,a=Object(El.a)(t.source)==="object"?t.source:{},o=a.width,l=o===void 0?n?kS[n]:0:o,c=a.height,h=c===void 0?2:c,_=Object(El.a)(t.target)==="object"?t.target:{},x=_.width,E=x===void 0?i?kS[i]:0:x,C=_.height,I=C===void 0?2:C;return{vertices:[0,rc,1*l].concat(Object(cr.a)(e),[1,rc,-1*E],Object(cr.a)(e),[1,-rc,-1*E],Object(cr.a)(e),[0,-rc,1*l],Object(cr.a)(e),[0,rc,1*l],Object(cr.a)(e),[1,rc,-1*E],Object(cr.a)(e),[1,-rc,-1*E],Object(cr.a)(e),[0,-rc,1*l],Object(cr.a)(e)),outLineIndices:[0,1,2,0,2,3].map(function(P){return P+r}),indices:[4,5,6,4,6,7].map(function(P){return P+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function DS(e,r){var t=Object(El.a)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=Object(El.a)(e)==="object"?e:{};switch(t){case"circle":return Xk(n,i);case"triangle":return Vk(n,i);case"diamond":return Wk(n,i);case"rect":return Hk(n,i);case"classic":return Gk(n,i);case"halfTriangle":return Uk(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function $k(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r),[1,0,0],Object(cr.a)(r),[1,2,-3],Object(cr.a)(r),[1,1,-3],Object(cr.a)(r),[0,1,0],Object(cr.a)(r),[0,0,0],Object(cr.a)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Yk(e,r){return r?Kk(e,r):$k(e)}function Kk(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,o=n.source,l=o===void 0?"circle":o,c=FS(DS(l,"source"),t,0,0),h=Zk(t,c.vertices.length/7,r),_=FS(DS(a,"target"),t,1,c.vertices.length/7+h.vertices.length/7),x={vertices:[].concat(Object(cr.a)(c.vertices),Object(cr.a)(h.vertices),Object(cr.a)(_.vertices)),indices:[].concat(Object(cr.a)(c.outLineIndices),Object(cr.a)(h.outLineIndices),Object(cr.a)(_.outLineIndices),Object(cr.a)(c.indices),Object(cr.a)(h.indices),Object(cr.a)(_.indices)),normals:[].concat(Object(cr.a)(c.normals),Object(cr.a)(h.normals),Object(cr.a)(_.normals)),size:7};return x}function FS(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,o=e.indices,l=e.dimensions,c=e.outLineIndices,h=0;h<a.length;h+=l)i.push.apply(i,[t,a[h+1],a[h]].concat(Object(cr.a)(r)));return Object(we.a)(Object(we.a)({},e),{},{vertices:i,indices:o.map(function(_){return _+n}),outLineIndices:c.map(function(_){return _+n})})}function qk(e){var r=Qk();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function Qk(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jk=`#extension GL_OES_standard_derivatives : enable

varying vec4 v_color;


// line texture

#pragma include "picking"

void main() {
gl_FragColor = v_color;
gl_FragColor = filterColor(gl_FragColor);
}
`,eD=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec4 a_Instance;
attribute vec3 a_Normal;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"
varying vec4 v_color;
uniform float u_gap_width: 1.0;
uniform float u_stroke_width: 1.0;
uniform float u_stroke_opacity: 1.0;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7


  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );


  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,tD=function(e){Object(qr.a)(t,e);var r=qk(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,o=a===void 0?2:a,l=i.strokeWidth,c=l===void 0?1:l,h=i.stroke,_=h===void 0?"#000":h,x=i.strokeOpacity,E=x===void 0?1:x;return Object(we.a)({u_gap_width:o,u_stroke_width:c,u_stroke:oa(_),u_stroke_opacity:E},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:eD,fragmentShader:Jk,inject:this.getInject(),triangulation:Yk,styleOption:this.layer.getLayerConfig().symbol,primitive:Z.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Rn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(a,o,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}})}}]),t}(Ga);function rD(e){var r=nD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function nD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iD=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying vec4 v_line_data;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
     gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = gl_FragColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,aD=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

uniform float segmentNumber;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
varying vec4 v_color;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;
varying vec4 v_line_data;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }



  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,oD={solid:0,dash:1},sD=function(e){Object(qr.a)(t,e);var r=rD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,h=i.lineType,_=h===void 0?"solid":h,x=i.dashArray,E=x===void 0?[10,5]:x,C=i.lineTexture,I=C===void 0?!1:C,P=i.iconStep,B=P===void 0?100:P,U=i.segmentNumber,ee=U===void 0?30:U;E.length===2&&E.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var ie=0,_e=[0,0,0,0],Oe=[0,0,0,0];return a&&o&&(_e=oa(a),Oe=oa(o),ie=1),Object(we.a)({u_textureBlend:c==="normal"?0:1,segmentNumber:ee,u_line_type:oD[_]||0,u_dash_array:E,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ie,u_sourceColor:_e,u_targetColor:Oe},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.segmentNumber,c=l===void 0?30:l,x.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:aD,fragmentShader:iD,triangulation:Ky,styleOption:{segmentNumber:c},inject:this.getInject(),depth:{enable:!1}});case 3:return h=x.sent,x.abrupt("return",[h]);case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Rn.Attribute,descriptor:{name:"a_Instance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(o,l,c){return[c[3],c[4],c[5],c[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga),eG=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),Qy=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),uD=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),p1=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),tG=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function lD(e){var r=cD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function cD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fD=`#define LineTypeSolid 0.0
varying vec4 v_color;

// dash
varying vec4 v_dash_array;
varying float v_d_distance_ratio;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

// [animate, duration, interval, trailLength],
void main() {

  gl_FragColor = v_color;

  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    // \u5B9E\u7EBF\u90E8\u5206
  } else {
    // \u865A\u7EBF\u90E8\u5206
    discard;
  };

  gl_FragColor = filterColor(gl_FragColor);
}
`,hD=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;
uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

uniform mat4 u_ModelMatrix;

uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying float v_d_distance_ratio;


void main() {

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;


  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));
  
 float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,pD=`#extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0
uniform float u_textureBlend;

uniform float u_strokeWidth: 0.0;

uniform vec3 u_blur;
varying vec4 v_color;
varying vec4 v_stroke;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying vec2 v_iconMapUV;
varying vec4 v_texture_data;


#pragma include "picking"

uniform float u_time;
uniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8
// [animate, duration, interval, trailLength],
void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        gl_FragColor.rgb = mix(v_stroke.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  gl_FragColor = filterColor(gl_FragColor);
}
`,BS=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_stroke;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

varying vec4 v_texture_data;

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,dD=`varying vec4 v_color;
varying vec4 v_texture_data;
uniform float u_linearDir: 1.0;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


void main() {
  float linearRadio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = v_texture_data.a;
  }

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);
    gl_FragColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,vD={solid:0,dash:1},LS=function(e){Object(qr.a)(t,e);var r=lD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"textureEventFlag",!1),Object(L.a)(Object(De.a)(n),"texture",n.createTexture2D({data:[0,0,0,0],mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1,height:1})),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,h=i.lineType,_=h===void 0?"solid":h,x=i.dashArray,E=x===void 0?[10,5,0,0]:x,C=i.lineTexture,I=C===void 0?!1:C,P=i.iconStep,B=P===void 0?100:P,U=i.vertexHeightScale,ee=U===void 0?20:U,ie=i.strokeWidth,_e=ie===void 0?0:ie,Oe=i.raisingHeight,ke=Oe===void 0?0:Oe,Ke=i.heightfixed,ot=Ke===void 0?!1:Ke,Ot=i.linearDir,Zt=Ot===void 0?Qy.VERTICAL:Ot,ir=i.blur,Hr=ir===void 0?[1,1,1]:ir;E.length===2&&E.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var ln=0,pn=[0,0,0,0],Ci=[0,0,0,0];return a&&o&&(pn=oa(a),Ci=oa(o),ln=1),Object(we.a)({u_textureBlend:c===uD.NORMAL?0:1,u_line_type:vD[_],u_dash_array:E,u_blur:Hr,u_texture:this.texture,u_line_texture:I?1:0,u_icon_step:B,u_textSize:[1024,this.iconService.canvasHeight||128],u_strokeWidth:_e,u_linearDir:Zt===Qy.VERTICAL?1:0,u_linearColor:ln,u_sourceColor:pn,u_targetColor:Ci,u_heightfixed:Number(ot),u_vertexScale:ee,u_raisingHeight:Number(ke)},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!1:l,h=this.getShaders(),_=h.frag,x=h.vert,E=h.type,this.layer.triangulation=Uv,P.next=5,this.layer.buildLayerModel({moduleName:"line"+E,vertexShader:x,fragmentShader:_,triangulation:Uv,inject:this.getInject(),depth:{enable:c}});case 5:return C=P.sent,P.abrupt("return",[C]);case 7:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.lineType;return l==="dash"?{frag:fD,vert:hD,type:"Dash"}:a&&o?{frag:dD,vert:BS,type:"Linear"}:{frag:pD,vert:BS,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Rn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o,l,c,h,_,x){return x===void 0?[c[3],10]:[c[3],x]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Rn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(o,l,c,h,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Rn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga);function mD(e){var r=gD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function gD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yD=`
varying vec4 v_Color;
#pragma include "picking"
void main() {

  gl_FragColor = v_Color; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,_D=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;
uniform sampler2D u_texture;
uniform float u_linearDir: 1.0;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"


void main() {


  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  float linearRadio =currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    linearRadio = texV;
  }

  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));

  v_Color.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6



  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,rG=xi.isNumber,bD=function(e){Object(qr.a)(t,e);var r=mD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var c=n.layer.getLayerConfig(),h=c.rampColors,_=Ll(h);n.colorTexture=l({data:new Uint8Array(_.data),width:_.width,height:_.height,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE,min:Z.NEAREST,mag:Z.NEAREST,flipY:!1})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.vertexHeightScale,c=l===void 0?20:l,h=i.raisingHeight,_=h===void 0?0:h,x=i.heightfixed,E=x===void 0?!1:x,C=i.linearDir,I=C===void 0?Qy.VERTICAL:C;return this.rendererService.getDirty()&&this.colorTexture.bind(),Object(we.a)({u_linearDir:I===Qy.VERTICAL?1:0,u_texture:this.colorTexture,u_heightfixed:Number(E),u_vertexScale:c,u_raisingHeight:Number(_)},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.colorTexture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!1:l,this.layer.triangulation=c1,x.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:_D,fragmentShader:yD,triangulation:c1,inject:this.getInject(),depth:{enable:c}});case 4:return h=x.sent,x.abrupt("return",[h]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Rn.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l,c,h,_){return _===void 0?[l[3],10]:[l[3],_]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Rn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a,o,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Rn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a,o,l){return[l[4]]}}})}}]),t}(Ga);function xD(e){var r=ED();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function ED(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SD=`
varying vec4 v_color;
void main() {
  gl_FragColor = v_color;

}
`,AD=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
varying float v_distanceScale;
varying vec4 v_color;
void main() {
  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,NS=`attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;

attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;


uniform float u_vertexScale: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;



#pragma include "projection"

varying vec4 v_color;
varying float v_distanceScale;

void main() {

  v_color = a_Color; 
  v_distanceScale = a_Distance / a_Total_Distance;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,nG=xi.isNumber,TD=function(e){Object(qr.a)(t,e);var r=xD(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.sourceColor,c=i.targetColor,h=i.vertexHeightScale,_=h===void 0?20:h,x=0,E=[0,0,0,0],C=[0,0,0,0];return l&&c&&(E=oa(l),C=oa(c),x=1),Object(we.a)({u_linearColor:x,u_sourceColor:E,u_targetColor:C,u_vertexScale:_},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor;return a&&o?{frag:AD,vert:NS,type:"lineSimpleLinear"}:{frag:SD,vert:NS,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,h=o.type,E.next=3,this.layer.buildLayerModel({moduleName:h,vertexShader:c,fragmentShader:l,triangulation:d5,inject:this.getInject(),primitive:Z.LINES,depth:{enable:!1},pick:!1});case 3:return _=E.sent,E.abrupt("return",[_]);case 5:case"end":return E.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Rn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a,o,l){return[l[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Rn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a,o,l){return[l[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}})}}]),t}(Ga);function CD(e){var r=wD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function wD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OD=`#define Animate 0.0
#define LineTexture 1.0

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_textureBlend;
uniform float u_iconStepCount;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying vec2 v_iconMapUV;
varying float v_blur;
varying float v_radio;
varying vec4 v_color;
varying vec4 v_dataset;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,RD=`#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;

uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;
uniform float u_linearColor: 0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
varying vec4 v_color;
varying float v_blur;
varying float v_radio;
varying vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,MD=function(e){Object(qr.a)(t,e);var r=CD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.NEAREST,min:Z.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,o=i.targetColor,l=i.textureBlend,c=l===void 0?"normal":l,h=i.heightfixed,_=h===void 0?!1:h,x=i.lineTexture,E=x===void 0?!1:x,C=i.iconStep,I=C===void 0?100:C,P=i.iconStepCount,B=P===void 0?1:P;this.rendererService.getDirty()&&this.texture.bind();var U=0,ee=[0,0,0,0],ie=[0,0,0,0];return a&&o&&(ee=oa(a),ie=oa(o),U=1),Object(we.a)({u_heightfixed:Number(_),u_textureBlend:c==="normal"?0:1,u_texture:this.texture,u_line_texture:E?1:0,u_iconStepCount:B,u_icon_step:I,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:U,u_sourceColor:ee,u_targetColor:ie},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption;return{u_animate:this.animateOption2Array(a),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:RD,fragmentShader:OD,triangulation:c1,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Rn.Attribute,descriptor:{name:"a_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o,l,c){return[c[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Rn.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o,l,c){return[c[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=o.size,c=l===void 0?1:l;return Array.isArray(c)?[c[0],c[1]]:[c,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(o,l,c,h,_){return _}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Rn.Attribute,descriptor:{name:"a_Miter",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o,l,c){return[c[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.texture,h=l[c]||{x:0,y:0},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga),PD={arc:Ak,arc3d:Ik,greatcircle:sD,wall:MD,line:LS,simple:TD,linearline:bD,earthArc3d:zk,flowline:tD},ID=PD;function kD(e){var r=DD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function DD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var d1=function(e){Object(qr.a)(t,e);var r=kD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","LineLayer"),Object(L.a)(Object(De.a)(n),"enableShaderEncodeStyles",["opacity","offsets","stroke","thetaOffset"]),Object(L.a)(Object(De.a)(n),"arrowInsertCount",0),Object(L.a)(Object(De.a)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new ID[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(o){if(Array.isArray(o.coordinates)&&Array.isArray(o.coordinates[0])&&Array.isArray(o.coordinates[0][0])){var l=Object(we.a)({},o);o.coordinates.map(function(c){a.push(Object(we.a)(Object(we.a)({},l),{},{coordinates:c}))})}else a.push(o)}),a}}]),t}(Kp);function FD(e){var r=BD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function BD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LD=`
uniform float u_additive;
uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor = filterColor(gl_FragColor);
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,ND=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;

attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying float v_blur;
varying float v_innerRadius;



#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function jS(e){var r=e.coordinates;return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}var jD=function(e){Object(qr.a)(t,e);var r=FD(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.offsets,c=l===void 0?[0,0]:l,h=i.blend,_=i.strokeOpacity,x=_===void 0?1:_,E=i.strokeWidth,C=E===void 0?0:E,I=i.stroke,P=I===void 0?"#fff":I;return{u_additive:h==="additive"?1:0,u_opacity:o,u_offsets:c,u_stroke_opacity:x,u_stroke_width:C,u_stroke_color:oa(P)}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=jS,c.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:ND,fragmentShader:LD,triangulation:jS,depth:{enable:!1},primitive:Z.POINTS});case 3:return o=c.sent,c.abrupt("return",[o]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ga);function zD(e){var r=UD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function UD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VD=`varying vec4 v_color;
uniform float u_opacity: 1.0;

uniform float u_pickLight: 0.0;

#pragma include "picking"


uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;
varying float v_lightWeight;
varying float v_barLinearZ;
void main() {

   gl_FragColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,HD=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;

varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;
varying float v_lightWeight;
varying float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,WD=xi.isNumber,GD=function(e){Object(qr.a)(t,e);var r=zD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"raiseCount",0),Object(L.a)(Object(De.a)(n),"raiseRepeat",0),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,c=l===void 0?1:l,h=i.sourceColor,_=i.targetColor,x=i.pickLight,E=x===void 0?!1:x,C=i.heightfixed,I=C===void 0?!1:C,P=i.opacityLinear,B=P===void 0?{enable:!1,dir:"up"}:P,U=i.lightEnable,ee=U===void 0?!0:U,ie=0,_e=[0,0,0,0],Oe=[0,0,0,0];if(h&&_&&(_e=oa(h),Oe=oa(_),ie=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var ke=o.speed,Ke=ke===void 0?.01:ke;this.raiseCount+=Ke,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(E),u_heightfixed:Number(I),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:WD(c)?c:1,u_linearColor:ie,u_sourceColor:_e,u_targetColor:Oe,u_opacitylinear:Number(B.enable),u_opacitylinear_dir:B.dir==="up"?1:0,u_lightEnable:Number(ee)}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.animateOption.repeat,c=l===void 0?1:l,this.raiseRepeat=c,x.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:HD,fragmentShader:VD,triangulation:l1,depth:{enable:!0},cull:{enable:!0,face:pc(this.mapService.version)},blend:this.getBlend()});case 4:return h=x.sent,x.abrupt("return",[h]);case 6:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=a.size;if(o){var l=[];return Array.isArray(o)&&(l=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(l=[o,o,o]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Rn.Attribute,descriptor:{name:"a_Pos",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=$r(a.coordinates);return yS([o[0],o[1]])}}})}}]),t}(Ga);function XD(e){var r=ZD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function ZD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $D=`uniform float u_additive;
uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,YD=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform mat4 u_ModelMatrix;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);

  setPickingColor(a_PickingColor);
}
`,KD=function(e){Object(qr.a)(t,e);var r=XD(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.strokeOpacity,c=l===void 0?1:l,h=i.strokeWidth,_=h===void 0?0:h,x=i.stroke,E=x===void 0?"rgba(0,0,0,0)":x,C=i.blend,I=i.blur,P=I===void 0?0:I;return{u_blur:P,u_additive:C==="additive"?1:0,u_opacity:o,u_stroke_opacity:c,u_stroke_width:_,u_stroke_color:oa(E)}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.layer.triangulation=TS,c.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:YD,fragmentShader:$D,triangulation:TS,depth:{enable:!0},blend:this.getBlend()});case 3:return o=c.sent,c.abrupt("return",[o]);case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Rn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(o,l,c,h){var _=Object(Bn.a)(c,3),x=_[0],E=_[1],C=_[2],I=z.fromValues(0,0,1),P=z.fromValues(x,0,C),B=x>=0?z.angle(I,P):Math.PI*2-z.angle(I,P),U=Math.PI*2-Math.asin(E/100),ee=N.create();N.rotateY(ee,ee,B),N.rotateX(ee,ee,U);var ie=z.fromValues(1,1,0);z.transformMat4(ie,ie,ee),z.normalize(ie,ie);var _e=z.fromValues(-1,1,0);z.transformMat4(_e,_e,ee),z.normalize(_e,_e);var Oe=z.fromValues(-1,-1,0);z.transformMat4(Oe,Oe,ee),z.normalize(Oe,Oe);var ke=z.fromValues(1,-1,0);z.transformMat4(ke,ke,ee),z.normalize(ke,ke);var Ke=[].concat(Object(cr.a)(ie),Object(cr.a)(_e),Object(cr.a)(Oe),Object(cr.a)(ke)),ot=h%4*3;return[Ke[ot],Ke[ot+1],Ke[ot+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Rn.Attribute,descriptor:{name:"a_Shape",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.shape,c=l===void 0?2:l,h=i.layer.getLayerConfig().shape2d,_=h.indexOf(c);return[_]}}})}}]),t}(Ga);function qD(e){var r=QD();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function QD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JD=`in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;


layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,eF=`#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,zS=function(e){Object(qr.a)(t,e);var r=qD(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"raiseCount",0),Object(L.a)(Object(De.a)(n),"raiseRepeat",0),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),Object(we.a)(Object(we.a)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,c=i.targetColor,h=i.pickLight,_=h===void 0?!1:h,x=i.heightfixed,E=x===void 0?!1:x,C=i.opacityLinear,I=C===void 0?{enable:!1,dir:"up"}:C,P=i.lightEnable,B=P===void 0?!0:P,U=0,ee=[0,0,0,0],ie=[0,0,0,0];if(l&&c&&(ee=oa(l),ie=oa(c),U=1),this.raiseCount<1&&this.raiseRepeat>0&&o.enable){var _e=o.speed,Oe=_e===void 0?.01:_e;this.raiseCount+=Oe,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var ke={u_pickLight:Number(_),u_heightfixed:Number(E),u_r:o.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:U,u_sourceColor:ee,u_targetColor:ie,u_opacitylinear:Number(I.enable),u_opacitylinear_dir:I.dir==="up"?1:0,u_lightEnable:Number(B)},Ke=this.getUniformsBufferInfo(ke);return Ke}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return o=this.layer.getLayerConfig(),l=o.depth,c=l===void 0?!0:l,h=o.animateOption.repeat,_=h===void 0?1:h,this.raiseRepeat=_,this.initUniformsBuffer(),C.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:eF,fragmentShader:JD,triangulation:l1,inject:this.getInject(),cull:{enable:!0,face:pc(this.mapService.version)},depth:{enable:c}});case 5:return x=C.sent,C.abrupt("return",[x]);case 7:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",shaderLocation:Xs.SIZE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=a.size;if(o){var l=[];return Array.isArray(o)&&(l=o.length===2?[o[0],o[0],o[1]]:o),Array.isArray(o)||(l=[o,o,o]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",shaderLocation:Xs.NORMAL,buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Rn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Xs.EXTRUDE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a){var o=$r(a.coordinates);return[o[0],o[1],0]}}})}}]),t}(Ga);function tF(e){var r=rF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function rF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var US=`
uniform float u_additive;


varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = v_color;

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  
  // \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,nF=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,v1=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 10) in float a_Shape;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,VS=function(e){Object(qr.a)(t,e);var r=tF(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,o=a===void 0?1:a,l=i.strokeWidth,c=l===void 0?0:l,h=i.blend,_=i.blur,x=_===void 0?0:_,E=i.raisingHeight,C=E===void 0?0:E,I=i.heightfixed,P=I===void 0?!1:I,B=i.unit,U=B===void 0?"pixel":B,ee=Object(we.a)({u_blur_height_fixed:[x,Number(C),Number(P)],u_additive:h==="additive"?1:0,u_stroke_opacity:o,u_stroke_width:c,u_size_unit:p1[U]},this.getStyleAttribute()),ie=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(ie.u_stroke),Object(cr.a)(ie.u_offsets),[ie.u_opacity,ie.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(ee.u_blur_height_fixed),[ee.u_stroke_width,ee.u_stroke_opacity,ee.u_additive,ee.u_size_unit])).buffer)}),ee}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Sh)}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C,I,P;return he.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:return o=this.layer.getLayerConfig(),l=o.animateOption,c=l===void 0?{enable:!1}:l,h=this.getShaders(c),_=h.frag,x=h.vert,E=h.type,this.layer.triangulation=Sh,C=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),I=this.rendererService.createBuffer({data:new Float32Array(8),isUBO:!0}),this.uniformBuffers.push(C,I),U.next=8,this.layer.buildLayerModel({moduleName:E,vertexShader:x,fragmentShader:_,inject:this.getInject(),triangulation:Sh,depth:{enable:!1}});case 8:return P=U.sent,U.abrupt("return",[P]);case 10:case"end":return U.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){if(i.enable)switch(i.type){case"wave":return{frag:US,vert:v1,type:"pointWave"};default:return{frag:US,vert:v1,type:"pointWave"}}else return{frag:nF,vert:v1,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Rn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:Xs.EXTRUDE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(o,l,c,h){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=h%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",shaderLocation:Xs.SIZE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Rn.Attribute,descriptor:{name:"a_Shape",shaderLocation:Xs.SHAPE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.shape,c=l===void 0?2:l,h=i.indexOf(c);return[h]}}})}}]),t}(Ga);function iF(e){var r=aF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function aF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oF=`uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;
varying float v_opacity;

void main() {

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= v_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,sF=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;

uniform mat4 u_ModelMatrix;

uniform mat2 u_RotateMatrix;
uniform int u_size_unit;

varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;
varying float v_opacity;
// uniform vec2 u_offsets; // shader \u6CE8\u5165


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,uF=function(e){Object(qr.a)(t,e);var r=iF(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"meter2coord",1),Object(L.a)(Object(De.a)(n),"isMeter",!1),Object(L.a)(Object(De.a)(n),"radian",0),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.LINEAR,min:Z.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l,h=i.unit,_=h===void 0?"pixel":h;return this.rendererService.getDirty()&&this.texture.bind(),Object(we.a)({u_raisingHeight:Number(o),u_heightfixed:Number(c),u_size_unit:p1[_],u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$y)}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:sF,fragmentShader:oF,triangulation:$y,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:pc(this.mapService.version)}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.shape,h=l[c]||{x:-64,y:-64},_=h.x,x=h.y;return[_,x]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Rn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(o,l,c,h){var _=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],x=h%4*3;return[_[x],_[x+1],_[x+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}})}}]),t}(Ga);function lF(e){var r=cF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function cF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fF=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform vec2 u_textSize;

#pragma include "picking"

void main(){
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      gl_FragColor.a *= v_opacity;
      if (gl_FragColor.a < 0.01) {
         discard;
      }
      gl_FragColor = filterColor(gl_FragColor);
}
`,hF=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
varying float v_opacity;
uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;
uniform float u_heightfixed: 0.0;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,HS=function(e){Object(qr.a)(t,e);var r=lF(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:Z.LINEAR,min:Z.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.heightfixed,c=l===void 0?!1:l;return this.rendererService.getDirty()&&this.texture.bind(),Object(we.a)({u_raisingHeight:Number(o),u_heightfixed:Number(c),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:hF,fragmentShader:fF,triangulation:p5,inject:this.getInject(),depth:{enable:!1},primitive:Z.POINTS});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(o){var l=o.size,c=l===void 0?5:l;return Array.isArray(c)?[c[0]]:[c]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(o){var l=i.iconService.getIconMap(),c=o.shape,h=l[c]||{x:-64,y:-64},_=h.x,x=h.y;return[_,x]}}})}}]),t}(Ga);function pF(e){var r=dF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function dF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vF=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,mF=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function WS(e){var r=e.coordinates;return{vertices:Object(cr.a)(r),indices:[0],size:r.length}}var GS=function(e){Object(qr.a)(t,e);var r=pF(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var i=this.getStyleAttribute();return this.uniformBuffers[0].subData({offset:0,data:new Uint8Array(new Float32Array([].concat(Object(cr.a)(i.u_stroke),Object(cr.a)(i.u_offsets),[i.u_opacity,i.u_rotation])).buffer)}),this.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array([.5]).buffer)}),Object(we.a)({u_size_scale:.5},i)}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.layer.triangulation=WS,o=this.rendererService.createBuffer({data:new Float32Array(4+2+1+1),isUBO:!0}),l=this.rendererService.createBuffer({data:new Float32Array(4),isUBO:!0}),this.uniformBuffers.push(o,l),_.next=6,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:mF,fragmentShader:vF,triangulation:WS,inject:this.getInject(),depth:{enable:!1},primitive:Z.POINTS,pick:!1});case 6:return c=_.sent,_.abrupt("return",[c]);case 8:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",shaderLocation:Xs.SIZE,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?1:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ga);function gF(e){var r=yF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function yF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _F=`
uniform float u_additive;
uniform float u_opacity: 1.0;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;
#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  v_exteude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  gl_FragColor.a *= radar_v;
}
`,bF=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
uniform float u_speed: 1.0;
uniform float u_time;

uniform mat4 u_ModelMatrix;

uniform int u_size_unit;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
varying vec2 v_exteude;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_exteude = rotateMatrix * a_Extrude.xy;

  // unpack color(vec2)
  v_color = a_Color;

  // anti-alias
  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  // radius(16-bit)
  v_radius = newSize;

  vec2 offset = (extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
  offset = project_pixel(offset);
  
  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,xF=function(e){Object(qr.a)(t,e);var r=gF(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.blend,c=i.speed,h=c===void 0?1:c,_=i.unit,x=_===void 0?"pixel":_;return{u_size_unit:p1[x],u_speed:h,u_additive:l==="additive"?1:0,u_opacity:o}}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,o=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(o),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),$y)}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:bF,fragmentShader:_F,triangulation:$y,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Rn.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c){var h=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],_=c%4*3;return[h[_],h[_+1],h[_+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?5:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ga);function EF(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=SF(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function SF(e,r){if(!!e){if(typeof e=="string")return XS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return XS(e,r)}}function XS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var AF=function(){function e(r,t,n){Object(Et.a)(this,e),Object(L.a)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return Object(Rt.a)(e,[{key:"insert",value:function(t,n,i,a,o){this.forEachCell(n,i,a,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o)}},{key:"query",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!1,o)}},{key:"hitTest",value:function(t,n,i,a,o){return this.queryHitTest(t,n,i,a,!0,o)}},{key:"insertBoxCell",value:function(t,n,i,a,o,l){this.boxCells[o].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,o,l){if(i<0||t>this.width||a<0||n>this.height)return o?!1:[];var c=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var h=0;h<this.boxKeys.length;h++)c.push({key:this.boxKeys[h],x1:this.bboxes[h*4],y1:this.bboxes[h*4+1],x2:this.bboxes[h*4+2],y2:this.bboxes[h*4+3]});return l?c.filter(l):c}var _={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,c,_,l),o?c.length>0:c}},{key:"queryCell",value:function(t,n,i,a,o,l,c,h){var _=c.seenUids,x=this.boxCells[o];if(x!==null){var E=this.bboxes,C=EF(x),I;try{for(C.s();!(I=C.n()).done;){var P=I.value;if(!_.box[P]){_.box[P]=!0;var B=P*4;if(t<=E[B+2]&&n<=E[B+3]&&i>=E[B+0]&&a>=E[B+1]&&(!h||h(this.boxKeys[P]))){if(c.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[P],x1:E[B],y1:E[B+1],x2:E[B+2],y2:E[B+3]})}}}}catch(U){C.e(U)}finally{C.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,o,l,c,h){for(var _=this.convertToXCellCoord(t),x=this.convertToYCellCoord(n),E=this.convertToXCellCoord(i),C=this.convertToYCellCoord(a),I=_;I<=E;I++)for(var P=x;P<=C;P++){var B=this.xCellCount*P+I;if(o.call(this,t,n,i,a,B,l,c,h))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),TF=AF,CF=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new TF(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return Object(Rt.a)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,o)||this.grid.hitTest(n,i,a,o)?{box:[]}:{box:[n,i,a,o]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=W.fromValues(n,i,0,1),o=W.create(),l=N.fromValues.apply(N,Object(cr.a)(t));return W.transformMat4(o,a,l),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function ZS(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=wF(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function wF(e,r){if(!!e){if(typeof e=="string")return $S(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return $S(e,r)}}function $S(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function YS(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function KS(e,r,t,n,i){if(!!i){var a=e[n],o=a.glyph;if(o)for(var l=r[o].advance*a.scale,c=(e[n].x+l)*i,h=t;h<=n;h++)e[h].x-=c}}function qS(e,r,t,n,i,a,o){var l=(r-t)*i,c=(-n*o+.5)*a,h=ZS(e),_;try{for(h.s();!(_=h.n()).done;){var x=_.value;x.x+=l,x.y+=c}}catch(E){h.e(E)}finally{h.f()}}function OF(e,r,t,n,i,a,o){var l=-8,c=0,h=l,_=0,x=e.positionedGlyphs,E=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ee){if(ee.split("").forEach(function(_e){var Oe=r[_e],ke=0;Oe&&(x.push({glyph:_e,x:c,y:h+ke,vertical:!1,scale:1,metrics:Oe}),c+=Oe.advance+o)}),x.length!==C){var ie=c-o;_=Math.max(ie,_),KS(x,r,C,x.length-1,E)}c=0,h-=n+5});var I=YS(i),P=I.horizontalAlign,B=I.verticalAlign;qS(x,E,P,B,_,n,t.length);var U=h-l;e.top+=-B*U,e.bottom=e.top-U,e.left+=-P*_,e.right=e.left+_}function RF(e,r,t,n,i,a,o){var l=-8,c=0,h=l,_=0,x=e.positionedGlyphs,E=a==="right"?1:a==="left"?0:.5,C=x.length;t.forEach(function(ee){var ie=r[ee],_e=0;if(ie&&(x.push({glyph:ee,x:ie.advance/2,y:h+_e,vertical:!1,scale:1,metrics:ie}),c+=ie.advance+o),x.length!==C){var Oe=c-o;_=Math.max(Oe,_),KS(x,r,C,x.length-1,E)}c=0,h-=n+5});var I=YS(i),P=I.horizontalAlign,B=I.verticalAlign;qS(x,E,P,B,_,n,t.length);var U=h-l;e.top+=-B*U,e.bottom=e.top-U,e.left+=-P*_,e.right=e.left+_}function MF(e,r,t,n,i,a){var o=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,c=e.split(`
`),h=[],_={positionedGlyphs:h,top:o[1],bottom:o[1],left:o[0],right:o[0],lineCount:c.length,text:e};return l?RF(_,r,c,t,n,i,a):OF(_,r,c,t,n,i,a),h.length?_:!1}function PF(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],o=ZS(i),l;try{for(o.s();!(l=o.n()).done;){var c=l.value,h=c.metrics,_=4,x=h.advance*c.scale/2,E=t?[c.x+x,c.y]:[0,0],C=t?[0,0]:[c.x+x+r[0],c.y+r[1]],I=(0-_)*c.scale-x+C[0],P=(0-_)*c.scale+C[1],B=I+h.width*c.scale,U=P+h.height*c.scale,ee={x:I,y:P},ie={x:B,y:P},_e={x:I,y:U},Oe={x:B,y:U};a.push({tl:ee,tr:ie,bl:_e,br:Oe,tex:h,glyphOffset:E})}}catch(ke){o.e(ke)}finally{o.f()}return a}function IF(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kF(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function kF(e,r){if(!!e){if(typeof e=="string")return QS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return QS(e,r)}}function QS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function DF(e){var r=FF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function FF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec4 v_stroke_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;


#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  gl_FragColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (gl_FragColor.a < 0.01) {
    discard;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,eA=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying vec4 v_stroke_color;
varying float v_fontScale;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,wg=xi.isEqual;function tA(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,o=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,c){n.push.apply(n,Object(cr.a)(o).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],Object(cr.a)(o),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],Object(cr.a)(o),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],Object(cr.a)(o),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+c*4,1+c*4,2+c*4,2+c*4,3+c*4,0+c*4)}),{vertices:n,indices:i,size:7}}var rA=function(e){Object(qr.a)(t,e);var r=DF(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"glyphInfoMap",{}),Object(L.a)(Object(De.a)(n),"currentZoom",-1),Object(L.a)(Object(De.a)(n),"textureHeight",0),Object(L.a)(Object(De.a)(n),"textCount",0),Object(L.a)(Object(De.a)(n),"preTextStyle",{}),Object(L.a)(Object(De.a)(n),"mapping",Object(Xt.a)(he.a.mark(function l(){return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return n.initGlyph(),n.updateTexture(),h.next=4,n.reBuildModel();case 4:case"end":return h.stop()}},l)}))),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,o=a===void 0?"#fff":a,l=i.strokeWidth,c=l===void 0?0:l,h=i.halo,_=h===void 0?.5:h,x=i.gamma,E=x===void 0?2:x,C=i.raisingHeight,I=C===void 0?0:C,P=this.getFontServiceMapping(),B=this.getFontServiceCanvas();return P&&Object.keys(P).length!==this.textCount&&B&&(this.updateTexture(),this.textCount=Object.keys(P).length),this.preTextStyle=this.getTextStyle(),Object(we.a)({u_raisingHeight:Number(I),u_stroke_width:c,u_stroke_color:oa(o),u_sdf_map:this.texture,u_halo_blur:_,u_gamma_scale:E,u_sdf_map_size:[(B==null?void 0:B.width)||1,(B==null?void 0:B.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),l.abrupt("return",this.buildModels());case 5:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getLayerConfig(),l=o.textAllowOverlap,c=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),c||this.filterGlyphs(),x.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:eA,fragmentShader:JS,inject:this.getInject(),triangulation:tA.bind(this),depth:{enable:!1}});case 6:return h=x.sent,x.abrupt("return",[h]);case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C,I,P,B,U;return he.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:if(o=this.getTextStyle(),l=o.textAllowOverlap,c=l===void 0?!1:l,h=o.textAnchor,_=h===void 0?"center":h,x=o.textOffset,E=o.padding,C=o.fontFamily,I=o.fontWeight,!(!wg(E,this.preTextStyle.padding)||!wg(x,this.preTextStyle.textOffset)||!wg(_,this.preTextStyle.textAnchor)||!wg(C,this.preTextStyle.fontFamily)||!wg(I,this.preTextStyle.fontWeight))){ie.next=5;break}return ie.next=4,this.mapping();case 4:return ie.abrupt("return",!0);case 5:if(!c){ie.next=7;break}return ie.abrupt("return",!1);case 7:if(P=this.mapService.getZoom(),B=this.mapService.getBounds(),U=ht(this.extent,B),!(Math.abs(this.currentZoom-P)>.5||!U||c!==this.preTextStyle.textAllowOverlap)){ie.next=14;break}return ie.next=13,this.reBuildModel();case 13:return ie.abrupt("return",!0);case 14:return ie.abrupt("return",!1);case 15:case"end":return ie.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Rn.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?12:o;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Rn.Attribute,descriptor:{name:"a_tex",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Ue(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,o=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(h){var _=h.shape,x=_===void 0?"":_;x=x.toString();var E=IF(x),C;try{for(E.s();!(C=E.n()).done;){var I=C.value;c.indexOf(I)===-1&&c.push(I)}}catch(P){E.e(P)}finally{E.f()}}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:o,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,o=i.fontFamily,l=this.rawEncodeData,c=[];l.forEach(function(h){var _=h.shape,x=_===void 0?"":_;x="".concat(x),c.indexOf(x)===-1&&c.push(x)}),this.fontService.setFontOptions({characterSet:c,fontWeight:a,fontFamily:o,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l,h=i.textAllowOverlap,_=h===void 0?!1:h,x=i.padding,E=x===void 0?[0,0]:x,C=i.textAnchor,I=C===void 0?"center":C,P=i.textOffset,B=P===void 0?[0,0]:P,U=i.opacity,ee=U===void 0?1:U,ie=i.strokeOpacity,_e=ie===void 0?1:ie,Oe=i.strokeWidth,ke=Oe===void 0?0:Oe,Ke=i.stroke,ot=Ke===void 0?"#000":Ke;return{fontWeight:o,fontFamily:c,textAllowOverlap:_,padding:E,textAnchor:I,textOffset:B,opacity:ee,strokeOpacity:_e,strokeWidth:ke,stroke:ot}}},{key:"generateGlyphLayout",value:function(i){var a=this,o=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),c=l.spacing,h=c===void 0?2:c,_=l.textAnchor,x=_===void 0?"center":_,E=l.textOffset,C=this.rawEncodeData;this.glyphInfo=C.map(function(I){var P=I.shape,B=P===void 0?"":P,U=I.id,ee=I.size,ie=ee===void 0?1:ee,_e=I.textOffset?I.textOffset:E||[0,0],Oe=I.textAnchor?I.textAnchor:x||"center",ke=MF(B.toString(),o,ie,Oe,"left",h,_e,i),Ke=PF(ke,_e,!1);return I.shaping=ke,I.glyphQuads=Ke,I.centroid=$r(I.coordinates),I.originCentroid=I.version==="GAODE2.x"?$r(I.originCoordinates):I.originCentroid=I.centroid,a.glyphInfoMap[U]={shaping:ke,glyphQuads:Ke,centroid:$r(I.coordinates)},I})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(c,"_").concat(o))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,o=a===void 0?"400":a,l=i.fontFamily,c=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(c,"_").concat(o))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.padding,l=o===void 0?[0,0]:o,c=a.textAllowOverlap,h=c===void 0?!1:c;if(!h){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var _=this.rendererService.getViewportSize(),x=_.width,E=_.height,C=new CF(x,E),I=this.glyphInfo.filter(function(P){var B=P.shaping,U=P.id,ee=U===void 0?0:U,ie=P.version==="GAODE2.x"?P.originCentroid:P.centroid,_e=P.size,Oe=_e/16,ke=i.mapService.lngLatToContainer(ie),Ke=C.placeCollisionBox({x1:B.left*Oe-l[0],x2:B.right*Oe+l[0],y1:B.top*Oe-l[1],y2:B.bottom*Oe+l[1],anchorPointX:ke.x,anchorPointY:ke.y}),ot=Ke.box;return ot&&ot.length?(C.insertCollisionBox(ot,ee),!0):!1});I.forEach(function(P){i.glyphInfoMap[P.id]=P})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,o=a===void 0?!1:a;o?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(o)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:Z.LINEAR,min:Z.LINEAR,width:a.width,height:a.height})}},{key:"reBuildModel",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return this.filterGlyphs(),c.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:eA,fragmentShader:JS,triangulation:tA.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:o=c.sent,this.layer.models=[o];case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ga),BF={fillImage:uF,fill:VS,radar:xF,image:HS,normal:GS,simplePoint:jD,extrude:zS,text:rA,earthFill:KD,earthExtrude:GD},LF=BF;function NF(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=jF(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function jF(e,r){if(!!e){if(typeof e=="string")return nA(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return nA(e,r)}}function nA(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function zF(e){var r=UF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function UF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jy=function(e){Object(qr.a)(t,e);var r=zF(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","PointLayer"),Object(L.a)(Object(De.a)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),Object(L.a)(Object(De.a)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),Object(L.a)(Object(De.a)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new LF[o](this),c.next=5,this.initLayerModels();case 5:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,o=i.values,l=this.getLayerConfig(),c=l.shape2d,h=this.iconService.getIconMap();if(a&&(c==null?void 0:c.indexOf(a))!==-1)return"fill";if(o==="text")return"text";if(o&&o instanceof Array){var _=NF(o),x;try{for(_.s();!(x=_.n()).done;){var E=x.value;if(typeof E=="string"&&h.hasOwnProperty(E))return"image"}}catch(C){_.e(C)}finally{_.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=a.shape3d,c=a.billboard,h=c===void 0?!0:c,_=this.iconService.getIconMap(),x=i.find(function(C){return C.hasOwnProperty("shape")});if(x){var E=x.shape;return E==="dot"?"normal":E==="simple"?"simplePoint":E==="radar"?"radar":this.layerType==="fillImage"||h===!1?"fillImage":(o==null?void 0:o.indexOf(E))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(E))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":_.hasOwnProperty(E)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Kp);function VF(e){var r=HF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function HF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WF=`uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;

#pragma include "picking"

void main() {


     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  

  gl_FragColor = filterColor(gl_FragColor);
}
`,GF=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,XF=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
    // gl_FragColor = vec4(1.0, 0., 0., 1.0);
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ZF=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;

uniform sampler2D u_texture;


uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;
varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_linearColor: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;

  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,$F=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying vec3 v_uvs;
varying vec2 v_texture_data;

#pragma include "picking"

void main() {
  float opacity = u_opacity;
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,YF=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;


uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;

varying vec2 v_texture_data;
varying vec3 v_uvs;
varying vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,KF=function(e){Object(qr.a)(t,e);var r=VF(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,o=a===void 0?!1:a,l=i.raisingHeight,c=l===void 0?0:l,h=i.topsurface,_=h===void 0?!0:h,x=i.sidesurface,E=x===void 0?!0:x,C=i.sourceColor,I=i.targetColor,P=0,B=[1,1,1,1],U=[1,1,1,1];return C&&I&&(B=oa(C),U=oa(I),P=1),Object(we.a)({u_topsurface:Number(_),u_sidesurface:Number(E),u_heightfixed:Number(o),u_raisingHeight:Number(c),u_linearColor:P,u_sourceColor:B,u_targetColor:U,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,h=o.type,E.next=3,this.layer.buildLayerModel({moduleName:h,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:h1});case 3:return _=E.sent,E.abrupt("return",[_]);case 5:case"end":return E.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,o=i.mapTexture;return o?{frag:XF,vert:ZF,type:"polygonExtrudeTexture"}:a?{frag:$F,vert:YF,type:"polygonExtrudePickLight"}:{frag:WF,vert:GF,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,o=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],c=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var h=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],o),_=Object(Bn.a)(h,2),x=_[0],E=_[1],C=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],o),I=Object(Bn.a)(C,2),P=I[0],B=I[1];l=P-x,c=B-E,a=[x,E,P,B]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Rn.Attribute,descriptor:{name:"a_uvs",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(ee,ie,_e){var Oe=_e[0],ke=_e[1];return[(Oe-a[0])/l,(ke-a[1])/c,_e[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(ee,ie,_e,Oe,ke){return ke}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(ee){var ie=ee.size,_e=ie===void 0?10:ie;return Array.isArray(_e)?[_e[0]]:[_e]}}})}},{key:"loadTexture",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o=this,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(l=this.layer.getLayerConfig(),c=l.mapTexture,h=this.rendererService.createTexture2D,this.texture=h({height:0,width:0}),!c){x.next=5;break}return x.abrupt("return",new Promise(function(E,C){var I=new Image;I.crossOrigin="anonymous",I.src=c,I.onload=function(){return o.texture=h({data:I,width:I.width,height:I.height,wrapS:Z.CLAMP_TO_EDGE,wrapT:Z.CLAMP_TO_EDGE,min:Z.LINEAR,mag:Z.LINEAR}),E(null)},I.onerror=function(){C(new Error("image load error"))}}));case 5:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Ga);function qF(e){var r=QF();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function QF(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JF=`
uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying vec2 v_texture_data;


#pragma include "picking"

void main() {

  gl_FragColor = v_Color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,eB=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;




varying vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,tB=function(e){Object(qr.a)(t,e);var r=qF(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){return Object(we.a)({},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return o=this.getShaders(),l=o.frag,c=o.vert,h=o.type,E.next=3,this.layer.buildLayerModel({moduleName:h,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:h1});case 3:return _=E.sent,E.abrupt("return",[_]);case 5:case"end":return E.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:JF,vert:eB,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Rn.Attribute,descriptor:{name:"a_Normal",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(a,o,l,c,h){return h}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Rn.Attribute,descriptor:{name:"a_Size",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(a){var o=a.size,l=o===void 0?10:o;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Ga);function rB(e){var r=nB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function nB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iB=`varying vec4 v_color;
#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor = filterColor(gl_FragColor);
}
`,aB=`#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;
varying vec4 v_Color;


void main() {
   gl_FragColor = v_Color;
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  gl_FragColor = filterColor(gl_FragColor);
}
`,oB=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;

uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;


#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,sB=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;


uniform float u_raisingHeight: 0.0;

varying vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,uB=function(e){Object(qr.a)(t,e);var r=rB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,o=a===void 0?0:a,l=i.opacityLinear,c=l===void 0?{enable:!1,dir:"in"}:l;return Object(we.a)({u_raisingHeight:Number(o),u_opacitylinear:Number(c.enable),u_dir:c.dir==="in"?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return o=this.getModelParams(),l=o.frag,c=o.vert,h=o.triangulation,_=o.type,this.layer.triangulation=h,C.next=4,this.layer.buildLayerModel({moduleName:_,vertexShader:c,fragmentShader:l,inject:this.getInject(),triangulation:h,primitive:Z.TRIANGLES,depth:{enable:!1}});case 4:return x=C.sent,C.abrupt("return",[x]);case 6:case"end":return C.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1,dir:"in"}:a;o.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Rn.Attribute,descriptor:{name:"a_linear",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:3,update:function(c,h,_){return[_[3],_[4],_[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,o=a===void 0?{enable:!1}:a;return o.enable?{frag:aB,vert:oB,type:"polygonLinear",triangulation:g5}:{frag:iB,vert:sB,type:"polygonFill",triangulation:ig}}}]),t}(Ga);function lB(e){var r=cB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function cB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fB=`
uniform float u_time: 0.0;
uniform float u_opacity: 1.0;

varying vec2 v_uv;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = u_opacity;
  gl_FragColor = vec4(col, opacity);  
}
`,hB=`attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec2 v_uv;

#pragma include "projection"

void main() {
  v_uv = a_uv;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,pB=xi.isNumber,dB=function(e){Object(qr.a)(t,e);var r=lB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.watercolor,c=l===void 0?"#6D99A8":l,h=i.watercolor2,_=h===void 0?"#0F121C":h;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:oa(c),u_watercolor2:oa(_),u_opacity:pB(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:hB,fragmentShader:fB,triangulation:f1,primitive:Z.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,o;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(o=this.texture3)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Object(Bn.a)(i,4),o=a[0],l=a[1],c=a[2],h=a[3],_=c-o,x=h-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Rn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(C,I,P,B){var U=C.version==="GAODE2.x"?C.originCoordinates[0][B]:P,ee=Object(Bn.a)(U,2),ie=ee[0],_e=ee[1];return[(ie-o)/_,(_e-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,o={height:0,width:0};this.texture1=a(o),this.texture2=a(o),this.texture3=a(o),l(function(h){i.texture1=c(h[0]),i.texture2=c(h[1]),i.texture3=c(h[2]),i.layerService.reRender()});function l(h){var _=0,x=[],E=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];E.map(function(C){var I=new Image;I.crossOrigin="",I.src=C,x.push(I),I.onload=function(){_++,_===3&&h(x)}})}function c(h){return a({data:h,width:h.width,height:h.height,wrapS:Z.MIRRORED_REPEAT,wrapT:Z.MIRRORED_REPEAT,min:Z.LINEAR,mag:Z.LINEAR})}}}]),t}(Ga);function vB(e){var r=mB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function mB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gB=`uniform sampler2D u_texture;
uniform float u_time: 0.0;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {
  float opacity = u_opacity;
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,yB=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;


#pragma include "projection"

void main() {
  v_uv = a_uv;

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,_B=xi.isNumber,bB=function(e){Object(qr.a)(t,e);var r=vB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.speed,c=l===void 0?.5:l;return{u_texture:this.texture,u_speed:c,u_opacity:_B(o)?o:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:yB,fragmentShader:gB,triangulation:f1,primitive:Z.TRIANGLES,depth:{enable:!1}});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=Object(Bn.a)(i,4),o=a[0],l=a[1],c=a[2],h=a[3],_=c-o,x=h-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Rn.Attribute,descriptor:{name:"a_uv",buffer:{usage:Z.STATIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(C,I,P,B){var U=C.version==="GAODE2.x"?C.originCoordinates[0][B]:P,ee=Object(Bn.a)(U,2),ie=ee[0],_e=ee[1];return[(ie-o)/_,(_e-l)/x]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),o=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var c=new Image;c.crossOrigin="",o?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),c.src=o):c.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",c.onload=function(){i.texture=l({data:c,width:c.width,height:c.height,wrapS:Z.MIRRORED_REPEAT,wrapT:Z.MIRRORED_REPEAT,min:Z.LINEAR,mag:Z.LINEAR}),i.layerService.reRender()}}}]),t}(Ga),xB={fill:uB,line:LS,extrude:KF,text:rA,point_fill:VS,point_image:HS,point_normal:GS,point_extrude:zS,water:bB,ocean:dB,extrusion:tB},EB=xB;function SB(e){var r=AB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function AB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var e0=function(e){Object(qr.a)(t,e);var r=SB(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","PolygonLayer"),Object(L.a)(Object(De.a)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new EB[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),o=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return o==="fill"||!o?"fill":o==="extrude"?"extrude":o==="extrusion"?"extrusion":o==="water"?"water":o==="ocean"?"ocean":o==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),o=a.shape2d,l=a.shape3d,c=this.iconService.getIconMap(),h=i.find(function(x){return x.hasOwnProperty("shape")});if(h){var _=h.shape;return _==="dot"?"point_normal":(o==null?void 0:o.indexOf(_))!==-1?"point_fill":(l==null?void 0:l.indexOf(_))!==-1?"point_extrude":c.hasOwnProperty(_)?"point_image":"text"}else return"fill"}}]),t}(Kp);function TB(e){var r=CB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function CB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wB=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;
bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }


void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value))
      discard;
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
     discard;
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
    if(gl_FragColor.a < 0.01)
      discard;
   
  }
}
`,OB=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,iA=function(e){Object(qr.a)(t,e);var r=TB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.clampLow,c=l===void 0?!0:l,h=i.clampHigh,_=h===void 0?!0:h,x=i.noDataValue,E=x===void 0?-9999999:x,C=i.domain,I=i.rampColors,P=C||Uc(I);return this.colorTexture=this.layer.textureService.getColorTexture(I,P),{u_opacity:o||1,u_texture:this.texture,u_domain:P,u_clampLow:c,u_clampHigh:typeof _!="undefined"?_:c,u_noDataValue:E,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(!Array.isArray(o.data)){E.next=4;break}return E.abrupt("return",{data:o.data,width:o.width,height:o.height});case 4:return E.next=6,o.data;case 6:return l=E.sent,c=l.rasterData,h=l.width,_=l.height,E.abrupt("return",{data:Array.from(c),width:h,height:_});case 11:case"end":return E.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,c=o.data.dataArray[0],P.next=5,this.getRasterData(c);case 5:return h=P.sent,_=h.data,x=h.width,E=h.height,this.texture=l({data:_,width:x,height:E,format:Z.LUMINANCE,type:Z.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:OB,fragmentShader:wB,triangulation:Yy,primitive:Z.TRIANGLES,depth:{enable:!1}});case 12:return C=P.sent,P.abrupt("return",[C]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ga),RB=["data"],MB=["rasterData"];function PB(e){var r=IB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function IB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kB=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));

    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,DB=`precision mediump float;
uniform vec2 u_rminmax: vec2(0,255); 
uniform vec2 u_gminmax: vec2(0,255);
uniform vec2 u_bminmax: vec2(0,255);
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform float u_noDataValue : 0.0;
varying vec2 v_texCoord;

void main() {
  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;
  if(rgb == vec3(u_noDataValue)) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(gl_FragColor.a < 0.01)
    discard;
 
}`,FB=function(e){Object(qr.a)(t,e);var r=PB(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"dataOption",{}),n}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.noDataValue,c=l===void 0?0:l,h=this.dataOption,_=h.rMinMax,x=h.gMinMax,E=h.bMinMax;return{u_opacity:o||1,u_texture:this.texture,u_noDataValue:c,u_rminmax:_,u_gminmax:x,u_bminmax:E}}},{key:"getRasterData",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!Array.isArray(o.data)){C.next=4;break}return l=o.data,c=Object(Th.a)(o,RB),this.dataOption=c,C.abrupt("return",Object(we.a)({data:l},c));case 4:return C.next=6,o.data;case 6:if(h=C.sent,_=h.rasterData,x=Object(Th.a)(h,MB),this.dataOption=x,!Array.isArray(_)){C.next=14;break}return C.abrupt("return",Object(we.a)({data:_},x));case 14:return C.abrupt("return",Object(we.a)({data:Array.from(_)},x));case 15:case"end":return C.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,c=o.data.dataArray[0],P.next=5,this.getRasterData(c);case 5:return h=P.sent,_=h.data,x=h.width,E=h.height,this.texture=l({data:_,width:x,height:E,format:Z.RGB,type:Z.FLOAT}),P.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:kB,fragmentShader:DB,triangulation:Yy,primitive:Z.TRIANGLES,depth:{enable:!1}});case 12:return C=P.sent,P.abrupt("return",[C]);case 14:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ga);function BB(e){var r=LB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function LB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NB=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,jB=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,zB=function(e){Object(qr.a)(t,e);var r=BB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=i.clampLow,l=o===void 0?!0:o,c=i.clampHigh,h=c===void 0?!0:c,_=i.noDataValue,x=_===void 0?-9999999:_,E=i.domain,C=i.rampColors,I=i.colorTexture,P=i.rScaler,B=P===void 0?6553.6:P,U=i.gScaler,ee=U===void 0?25.6:U,ie=i.bScaler,_e=ie===void 0?.1:ie,Oe=i.offset,ke=Oe===void 0?1e4:Oe,Ke=E||Uc(C),ot=I;return I?this.layer.textureService.setColorTexture(I,C,Ke):ot=this.layer.textureService.getColorTexture(C,Ke),{u_opacity:a||1,u_texture:this.texture,u_domain:Ke,u_clampLow:l,u_clampHigh:typeof h!="undefined"?h:l,u_noDataValue:x,u_unpack:[B,ee,_e,ke],u_colorTexture:ot}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.layer.getSource(),l=this.rendererService.createTexture2D,x.next=4,o.data.images;case 4:return c=x.sent,this.texture=l({data:c[0],width:c[0].width,height:c[0].height,min:Z.LINEAR,mag:Z.LINEAR}),x.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:jB,fragmentShader:NB,triangulation:Yy,primitive:Z.TRIANGLES,depth:{enable:!1}});case 8:return h=x.sent,x.abrupt("return",[h]);case 10:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Rn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:2,update:function(a,o,l){return[l[3],l[4]]}}})}}]),t}(Ga),UB={raster:iA,rasterRgb:FB,raster3d:iA,rasterTerrainRgb:zB},VB=UB;function HB(e){var r=WB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function WB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t0=function(e){Object(qr.a)(t,e);var r=HB(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","RasterLayer"),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new VB[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Kp);function GB(e){var r=XB();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function XB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZB=`uniform float u_opacity : 1.0;
uniform vec4 u_color;

void main() {
  gl_FragColor = u_color;
  gl_FragColor.a *= u_opacity;
}
`,$B=`attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;


#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,YB=xi.isNumber,KB=function(e){Object(qr.a)(t,e);var r=GB(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,o=a===void 0?1:a,l=i.color,c=l===void 0?"#000":l;return{u_opacity:YB(o)?o:0,u_color:oa(c)}}},{key:"initModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:$B,fragmentShader:ZB,triangulation:f1,depth:{enable:!1},pick:!1});case 2:return o=c.sent,c.abrupt("return",[o]);case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Ga),qB={fill:KB},QB=qB;function JB(e){var r=eL();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function eL(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aA=function(e){Object(qr.a)(t,e);var r=JB(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","MaskLayer"),n}return Object(Rt.a)(t,[{key:"buildModels",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return o=this.getModelType(),this.layerModel=new QB[o](this),c.next=4,this.initLayerModels();case 4:case"end":return c.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Kp),oA,sA,uA,lA,r0,cA,fA,tL=xi.cloneDeep,rL=(oA=Object(on.injectable)(),sA=Object(on.inject)(Qt.IMapService),uA=Object(on.inject)(Qt.IFontService),oA(lA=(r0=function(){function e(){Object(Et.a)(this,e),ga(this,"mapService",cA,this),ga(this,"fontService",fA,this)}return Object(Rt.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",Object(Xt.a)(he.a.mark(function o(){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:t.log(Gs.MappingStart,vu.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(Gs.MappingEnd,vu.INIT);case 3:case"end":return c.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var o=Object(Xt.a)(he.a.mark(function l(c){var h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(c){x.next=2;break}return x.abrupt("return",c);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Gs.MappingStart,vu.UPDATE),h=i.generateMaping(t,{styleAttributeService:a}),t.log(Gs.MappingEnd,vu.UPDATE),x.abrupt("return",h);case 7:case"end":return x.stop()}},l)}));return function(l){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var o=t.getSource();if(!(t.layerModelNeedUpdate||!o||!o.inited)){var l=a.getLayerStyleAttributes()||[],c=a.getLayerStyleAttribute("filter"),h=o.data.dataArray;if(!(Array.isArray(h)&&h.length===0)){var _=l.filter(function(C){return C.needRemapping}),x=h;if(c!=null&&c.needRemapping&&c!==null&&c!==void 0&&c.scale&&(x=h.filter(function(C){return i.applyAttributeMapping(c,C)[0]})),_.length){var E=i.mapping(t,_,x,t.getEncodedData());t.setEncodedData(E)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,o=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),c=t.getSource().data.dataArray,h=c;l!=null&&l.scale&&(h=c.filter(function(x){return i.applyAttributeMapping(l,x)[0]})),h=t.processData(h);var _=this.mapping(t,o,h,void 0);return t.setEncodedData(_),c.length===0&&t.encodeDataLength===0?!1:(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,n,i,a){var o=this,l=n.filter(function(h){return h.scale!==void 0}).filter(function(h){return h.name!=="filter"}),c=i.map(function(h,_){var x=a?a[_]:{},E=Object(we.a)({id:h._id,coordinates:h.coordinates},x);return l.forEach(function(C){var I=o.applyAttributeMapping(C,h);(C.name==="color"||C.name==="stroke")&&(I=I.map(function(P){return oa(P)})),E[C.name]=Array.isArray(I)&&I.length===1?I[0]:I,C.name==="shape"&&(E.shape=o.fontService.getIconFontKey(E[C.name]))}),E});return n.forEach(function(h){h.needRemapping=!1}),this.adjustData2Amap2Coordinates(c,t),this.adjustData2SimpleCoordinates(c),c}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(o){return!o.originCoordinates}).map(function(o){o.version="GAODE2.x",o.originCoordinates=tL(o.coordinates),o.coordinates=i.mapService.coordToAMap2RelativeCoordinates(o.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(o){var l=[];o.map(function(c){l.push(n.mapService.simpleMapCoord.unproject(c))}),i.push(l)}),i}else{var a=[];return t.map(function(o){a.push(n.mapService.simpleMapCoord.unproject(o))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],o=[];a.forEach(function(c){var h,_=c.field;(n.hasOwnProperty(_)||((h=t.scale)===null||h===void 0?void 0:h.type)==="variable")&&o.push(n[_])});var l=t.mapping?t.mapping(o):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=nt(i),o=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return o}}]),e}(),cA=ma(r0.prototype,"mapService",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fA=ma(r0.prototype,"fontService",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0))||lA),hA,pA,nL=(hA=Object(on.injectable)(),hA(pA=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Qt.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",Object(Xt.a)(he.a.mark(function i(){var a,o,l,c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(t.log(Gs.SourceInitStart,vu.INIT),a=t.getSource(),a||(o=t.sourceOption||t.defaultSourceConfig,l=o.data,c=o.options,a=new Z2(l,c),t.setSource(a)),!a.inited){_.next=8;break}n.updateClusterData(t),t.log(Gs.SourceInitEnd,vu.INIT),_.next=10;break;case 8:return _.next=10,new Promise(function(x){a.on("update",function(E){E.type==="inited"&&(n.updateClusterData(t),t.log(Gs.SourceInitEnd,vu.INIT)),x(null)})});case 10:case"end":return _.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",Object(Xt.a)(he.a.mark(function i(){var a,o,l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return a=n.updateClusterData(t),o=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||o,h.abrupt("return",l);case 5:case"end":return h.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,o=a===void 0?0:a,l=this.mapService.getZoom()-1,c=t.dataState.dataSourceNeedUpdate;return i&&c&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(o!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||pA),Og=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},iL=function(e){return e.length===1&&(e=aL(e)),{left:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)<0?i=o+1:a=o}return i},right:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)>0?a=o:i=o+1}return i}}};function aL(e){return function(r,t){return Og(e(r),t)}}var dA=iL(Og),oL=dA.right,iG=dA.left,sL=oL,aG=function(e,r){r==null&&(r=vA);for(var t=0,n=e.length-1,i=e[0],a=new Array(n<0?0:n);t<n;)a[t]=r(i,i=e[++t]);return a};function vA(e,r){return[e,r]}var oG=function(e,r,t){var n=e.length,i=r.length,a=new Array(n*i),o,l,c,h;for(t==null&&(t=vA),o=c=0;o<n;++o)for(h=e[o],l=0;l<i;++l,++c)a[c]=t(h,r[l]);return a},sG=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},Jp=function(e){return e===null?NaN:+e},uL=function(e,r){var t=e.length,n=0,i=-1,a=0,o,l,c=0;if(r==null)for(;++i<t;)isNaN(o=Jp(e[i]))||(l=o-a,a+=l/++n,c+=l*(o-a));else for(;++i<t;)isNaN(o=Jp(r(e[i],i,e)))||(l=o-a,a+=l/++n,c+=l*(o-a));if(n>1)return c/(n-1)},lL=function(e,r){var t=uL(e,r);return t&&Math.sqrt(t)},m1=function(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]},mA=Array.prototype,cL=mA.slice,fL=mA.map,n0=function(e){return function(){return e}},hL=function(e){return e},pL=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,a=new Array(i);++n<i;)a[n]=e+n*t;return a},g1=Math.sqrt(50),y1=Math.sqrt(10),_1=Math.sqrt(2),uG=function(e,r,t){var n,i=-1,a,o,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=dL(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/l;return n&&o.reverse(),o};function dL(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=g1?10:a>=y1?5:a>=_1?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=g1?10:a>=y1?5:a>=_1?2:1)}function vL(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=g1?i*=10:a>=y1?i*=5:a>=_1&&(i*=2),r<e?-i:i}var mL=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},lG=function(){var e=hL,r=m1,t=mL;function n(i){var a,o=i.length,l,c=new Array(o);for(a=0;a<o;++a)c[a]=e(i[a],a,i);var h=r(c),_=h[0],x=h[1],E=t(c,_,x);Array.isArray(E)||(E=vL(_,x,E),E=pL(Math.ceil(_/E)*E,x,E));for(var C=E.length;E[0]<=_;)E.shift(),--C;for(;E[C-1]>x;)E.pop(),--C;var I=new Array(C+1),P;for(a=0;a<=C;++a)P=I[a]=[],P.x0=a>0?E[a-1]:_,P.x1=a<C?E[a]:x;for(a=0;a<o;++a)l=c[a],_<=l&&l<=x&&I[sL(E,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:n0(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:n0([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?n0(cL.call(i)):n0(i),n):t},n},b1=function(e,r,t){if(t==null&&(t=Jp),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return o+(l-o)*(i-a)}},cG=function(e,r,t){return e=fL.call(e,Jp).sort(Og),Math.ceil((t-r)/(2*(b1(e,.75)-b1(e,.25))*Math.pow(e.length,-1/3)))},fG=function(e,r,t){return Math.ceil((t-r)/(3.5*lL(e)*Math.pow(e.length,-1/3)))},hG=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&i>a&&(a=i);return a},pG=function(e,r){var t=e.length,n=t,i=-1,a,o=0;if(r==null)for(;++i<t;)isNaN(a=Jp(e[i]))?--n:o+=a;else for(;++i<t;)isNaN(a=Jp(r(e[i],i,e)))?--n:o+=a;if(n)return o/n},dG=function(e,r){var t=e.length,n=-1,i,a=[];if(r==null)for(;++n<t;)isNaN(i=Jp(e[n]))||a.push(i);else for(;++n<t;)isNaN(i=Jp(r(e[n],n,e)))||a.push(i);return b1(a.sort(Og),.5)},vG=function(e){for(var r=e.length,t,n=-1,i=0,a,o;++n<r;)i+=e[n].length;for(a=new Array(i);--r>=0;)for(o=e[r],t=o.length;--t>=0;)a[--i]=o[t];return a},gL=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&a>i&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&a>i&&(a=i);return a},mG=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},gG=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,a,o=e[i];for(r==null&&(r=Og);++n<t;)(r(a=e[n],o)<0||r(o,o)!==0)&&(o=a,i=n);if(r(o,o)===0)return i}},yG=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,a;n;)a=Math.random()*n--|0,i=e[n+r],e[n+r]=e[a+r],e[a+r]=i;return e},_G=function(e,r){var t=e.length,n=-1,i,a=0;if(r==null)for(;++n<t;)(i=+e[n])&&(a+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(a+=i);return a},yL=function(e){if(!(a=e.length))return[];for(var r=-1,t=gL(e,_L),n=new Array(t);++r<t;)for(var i=-1,a,o=n[r]=new Array(a);++i<a;)o[i]=e[i][r];return n};function _L(e){return e.length}var bG=function(){return yL(arguments)};function gA(e,r,t,n,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*r+(4-6*a+3*o)*t+(1+3*e+3*a-3*o)*n+o*i)/6}var bL=function(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],o=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return gA((t-n/r)*r,o,i,a,l)}},xL=function(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],o=e[(n+1)%r],l=e[(n+2)%r];return gA((t-n/r)*r,i,a,o,l)}},i0=function(e){return function(){return e}};function yA(e,r){return function(t){return e+t*r}}function EL(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function xG(e,r){var t=r-e;return t?yA(e,t>180||t<-180?t-360*Math.round(t/360):t):i0(isNaN(e)?r:e)}function SL(e){return(e=+e)==1?_A:function(r,t){return t-r?EL(r,t,e):i0(isNaN(r)?t:r)}}function _A(e,r){var t=r-e;return t?yA(e,t):i0(isNaN(e)?r:e)}var bA=function e(r){var t=SL(r);function n(i,a){var o=t((i=gu(i)).r,(a=gu(a)).r),l=t(i.g,a.g),c=t(i.b,a.b),h=_A(i.opacity,a.opacity);return function(_){return i.r=o(_),i.g=l(_),i.b=c(_),i.opacity=h(_),i+""}}return n.gamma=e,n}(1);function xA(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),o,l;for(o=0;o<t;++o)l=gu(r[o]),n[o]=l.r||0,i[o]=l.g||0,a[o]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(c){return l.r=n(c),l.g=i(c),l.b=a(c),l+""}}}var AL=xA(bL),EG=xA(xL),Jd=function(e,r){return e<r?-1:e>r?1:e>=r?0:NaN},EA=function(e){return e.length===1&&(e=TL(e)),{left:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)<0?i=o+1:a=o}return i},right:function(t,n,i,a){for(i==null&&(i=0),a==null&&(a=t.length);i<a;){var o=i+a>>>1;e(t[o],n)>0?a=o:i=o+1}return i}}};function TL(e){return function(r,t){return Jd(e(r),t)}}var SA=EA(Jd),CL=SA.right,SG=SA.left,am=CL,AG=function(e,r){r==null&&(r=AA);for(var t=0,n=e.length-1,i=e[0],a=new Array(n<0?0:n);t<n;)a[t]=r(i,i=e[++t]);return a};function AA(e,r){return[e,r]}var TG=function(e,r,t){var n=e.length,i=r.length,a=new Array(n*i),o,l,c,h;for(t==null&&(t=AA),o=c=0;o<n;++o)for(h=e[o],l=0;l<i;++l,++c)a[c]=t(h,r[l]);return a},CG=function(e,r){return r<e?-1:r>e?1:r>=e?0:NaN},ed=function(e){return e===null?NaN:+e},wL=function(e,r){var t=e.length,n=0,i=-1,a=0,o,l,c=0;if(r==null)for(;++i<t;)isNaN(o=ed(e[i]))||(l=o-a,a+=l/++n,c+=l*(o-a));else for(;++i<t;)isNaN(o=ed(r(e[i],i,e)))||(l=o-a,a+=l/++n,c+=l*(o-a));if(n>1)return c/(n-1)},OL=function(e,r){var t=wL(e,r);return t&&Math.sqrt(t)},RL=function(e,r){var t=e.length,n=-1,i,a,o;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=o=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),o<i&&(o=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=o=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),o<i&&(o=i));return[a,o]},TA=Array.prototype,ML=TA.slice,PL=TA.map,a0=function(e){return function(){return e}},IL=function(e){return e},CA=function(e,r,t){e=+e,r=+r,t=(i=arguments.length)<2?(r=e,e=0,1):i<3?1:+t;for(var n=-1,i=Math.max(0,Math.ceil((r-e)/t))|0,a=new Array(i);++n<i;)a[n]=e+n*t;return a},x1=Math.sqrt(50),E1=Math.sqrt(10),S1=Math.sqrt(2),wA=function(e,r,t){var n,i=-1,a,o,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=o0(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),o=new Array(a=Math.ceil(r-e+1));++i<a;)o[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),o=new Array(a=Math.ceil(e-r+1));++i<a;)o[i]=(e-i)/l;return n&&o.reverse(),o};function o0(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=x1?10:a>=E1?5:a>=S1?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=x1?10:a>=E1?5:a>=S1?2:1)}function s0(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=x1?i*=10:a>=E1?i*=5:a>=S1&&(i*=2),r<e?-i:i}var kL=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},wG=function(){var e=IL,r=RL,t=kL;function n(i){var a,o=i.length,l,c=new Array(o);for(a=0;a<o;++a)c[a]=e(i[a],a,i);var h=r(c),_=h[0],x=h[1],E=t(c,_,x);Array.isArray(E)||(E=s0(_,x,E),E=CA(Math.ceil(_/E)*E,x,E));for(var C=E.length;E[0]<=_;)E.shift(),--C;for(;E[C-1]>x;)E.pop(),--C;var I=new Array(C+1),P;for(a=0;a<=C;++a)P=I[a]=[],P.x0=a>0?E[a-1]:_,P.x1=a<C?E[a]:x;for(a=0;a<o;++a)l=c[a],_<=l&&l<=x&&I[am(E,l,0,C)].push(i[a]);return I}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:a0(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:a0([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?a0(ML.call(i)):a0(i),n):t},n},u0=function(e,r,t){if(t==null&&(t=ed),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),o=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return o+(l-o)*(i-a)}},OG=function(e,r,t){return e=PL.call(e,ed).sort(Jd),Math.ceil((t-r)/(2*(u0(e,.75)-u0(e,.25))*Math.pow(e.length,-1/3)))},RG=function(e,r,t){return Math.ceil((t-r)/(3.5*OL(e)*Math.pow(e.length,-1/3)))},MG=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&i>a&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&i>a&&(a=i);return a},PG=function(e,r){var t=e.length,n=t,i=-1,a,o=0;if(r==null)for(;++i<t;)isNaN(a=ed(e[i]))?--n:o+=a;else for(;++i<t;)isNaN(a=ed(r(e[i],i,e)))?--n:o+=a;if(n)return o/n},IG=function(e,r){var t=e.length,n=-1,i,a=[];if(r==null)for(;++n<t;)isNaN(i=ed(e[n]))||a.push(i);else for(;++n<t;)isNaN(i=ed(r(e[n],n,e)))||a.push(i);return u0(a.sort(Jd),.5)},kG=function(e){for(var r=e.length,t,n=-1,i=0,a,o;++n<r;)i+=e[n].length;for(a=new Array(i);--r>=0;)for(o=e[r],t=o.length;--t>=0;)a[--i]=o[t];return a},DL=function(e,r){var t=e.length,n=-1,i,a;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=i;++n<t;)(i=e[n])!=null&&a>i&&(a=i)}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=i;++n<t;)(i=r(e[n],n,e))!=null&&a>i&&(a=i);return a},DG=function(e,r){for(var t=r.length,n=new Array(t);t--;)n[t]=e[r[t]];return n},FG=function(e,r){if(!!(t=e.length)){var t,n=0,i=0,a,o=e[i];for(r==null&&(r=Jd);++n<t;)(r(a=e[n],o)<0||r(o,o)!==0)&&(o=a,i=n);if(r(o,o)===0)return i}},BG=function(e,r,t){for(var n=(t==null?e.length:t)-(r=r==null?0:+r),i,a;n;)a=Math.random()*n--|0,i=e[n+r],e[n+r]=e[a+r],e[a+r]=i;return e},LG=function(e,r){var t=e.length,n=-1,i,a=0;if(r==null)for(;++n<t;)(i=+e[n])&&(a+=i);else for(;++n<t;)(i=+r(e[n],n,e))&&(a+=i);return a},FL=function(e){if(!(a=e.length))return[];for(var r=-1,t=DL(e,BL),n=new Array(t);++r<t;)for(var i=-1,a,o=n[r]=new Array(a);++i<a;)o[i]=e[i][r];return n};function BL(e){return e.length}var NG=function(){return FL(arguments)};function Gf(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function lp(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var lf="$";function l0(){}l0.prototype=OA.prototype={constructor:l0,has:function(r){return lf+r in this},get:function(r){return this[lf+r]},set:function(r,t){return this[lf+r]=t,this},remove:function(r){var t=lf+r;return t in this&&delete this[t]},clear:function(){for(var r in this)r[0]===lf&&delete this[r]},keys:function(){var r=[];for(var t in this)t[0]===lf&&r.push(t.slice(1));return r},values:function(){var r=[];for(var t in this)t[0]===lf&&r.push(this[t]);return r},entries:function(){var r=[];for(var t in this)t[0]===lf&&r.push({key:t.slice(1),value:this[t]});return r},size:function(){var r=0;for(var t in this)t[0]===lf&&++r;return r},empty:function(){for(var r in this)if(r[0]===lf)return!1;return!0},each:function(r){for(var t in this)t[0]===lf&&r(this[t],t.slice(1),this)}};function OA(e,r){var t=new l0;if(e instanceof l0)e.each(function(l,c){t.set(c,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var o in e)t.set(o,e[o]);return t}var Rg=OA,jG=function(){var e=[],r=[],t,n,i;function a(l,c,h,_){if(c>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var x=-1,E=l.length,C=e[c++],I,P,B=Rg(),U,ee=h();++x<E;)(U=B.get(I=C(P=l[x])+""))?U.push(P):B.set(I,[P]);return B.each(function(ie,_e){_(ee,_e,a(ie,c,h,_))}),ee}function o(l,c){if(++c>e.length)return l;var h,_=r[c-1];return n!=null&&c>=e.length?h=l.entries():(h=[],l.each(function(x,E){h.push({key:E,values:o(x,c)})})),_!=null?h.sort(function(x,E){return _(x.key,E.key)}):h}return i={object:function(c){return a(c,0,LL,NL)},map:function(c){return a(c,0,RA,MA)},entries:function(c){return o(a(c,0,RA,MA),0)},key:function(c){return e.push(c),i},sortKeys:function(c){return r[e.length-1]=c,i},sortValues:function(c){return t=c,i},rollup:function(c){return n=c,i}}};function LL(){return{}}function NL(e,r,t){e[r]=t}function RA(){return Rg()}function MA(e,r,t){e.set(r,t)}function c0(){}var ev=Rg.prototype;c0.prototype=PA.prototype={constructor:c0,has:ev.has,add:function(r){return r+="",this[lf+r]=r,this},remove:ev.remove,clear:ev.clear,values:ev.keys,size:ev.size,empty:ev.empty,each:ev.each};function PA(e,r){var t=new c0;if(e instanceof c0)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var zG=PA,UG=function(e){var r=[];for(var t in e)r.push(t);return r},VG=function(e){var r=[];for(var t in e)r.push(e[t]);return r},HG=function(e){var r=[];for(var t in e)r.push({key:t,value:e[t]});return r},IA=Array.prototype,f0=IA.map,tv=IA.slice,kA={name:"implicit"};function Mg(){var e=Rg(),r=[],t=[],n=kA;function i(a){var o=a+"",l=e.get(o);if(!l){if(n!==kA)return n;e.set(o,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=Rg();for(var o=-1,l=a.length,c,h;++o<l;)e.has(h=(c=a[o])+"")||e.set(h,r.push(c));return i},i.range=function(a){return arguments.length?(t=tv.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return Mg(r,t).unknown(n)},Gf.apply(i,arguments),i}function DA(){var e=Mg().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,o=!1,l=0,c=0,h=.5;delete e.unknown;function _(){var x=r().length,E=n[1]<n[0],C=n[E-0],I=n[1-E];i=(I-C)/Math.max(1,x-l+c*2),o&&(i=Math.floor(i)),C+=(I-C-i*(x-l))*h,a=i*(1-l),o&&(C=Math.round(C),a=Math.round(a));var P=CA(x).map(function(B){return C+i*B});return t(E?P.reverse():P)}return e.domain=function(x){return arguments.length?(r(x),_()):r()},e.range=function(x){return arguments.length?(n=[+x[0],+x[1]],_()):n.slice()},e.rangeRound=function(x){return n=[+x[0],+x[1]],o=!0,_()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(x){return arguments.length?(o=!!x,_()):o},e.padding=function(x){return arguments.length?(l=Math.min(1,c=+x),_()):l},e.paddingInner=function(x){return arguments.length?(l=Math.min(1,x),_()):l},e.paddingOuter=function(x){return arguments.length?(c=+x,_()):c},e.align=function(x){return arguments.length?(h=Math.max(0,Math.min(1,x)),_()):h},e.copy=function(){return DA(r(),n).round(o).paddingInner(l).paddingOuter(c).align(h)},Gf.apply(_(),arguments)}function FA(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return FA(r())},e}function WG(){return FA(DA.apply(null,arguments).paddingInner(1))}var BA=function(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}};function LA(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}var GG=function(e,r){return(LA(r)?BA:NA)(e,r)};function NA(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),o;for(o=0;o<n;++o)i[o]=C1(e[o],r[o]);for(;o<t;++o)a[o]=r[o];return function(l){for(o=0;o<n;++o)a[o]=i[o](l);return a}}var jL=function(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}},h0=function(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}},zL=function(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=C1(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}},A1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,T1=new RegExp(A1.source,"g");function UL(e){return function(){return e}}function VL(e){return function(r){return e(r)+""}}var HL=function(e,r){var t=A1.lastIndex=T1.lastIndex=0,n,i,a,o=-1,l=[],c=[];for(e=e+"",r=r+"";(n=A1.exec(e))&&(i=T1.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,c.push({i:o,x:h0(n,i)})),t=T1.lastIndex;return t<r.length&&(a=r.slice(t),l[o]?l[o]+=a:l[++o]=a),l.length<2?c[0]?VL(c[0].x):UL(r):(r=c.length,function(h){for(var _=0,x;_<r;++_)l[(x=c[_]).i]=x.x(h);return l.join("")})},C1=function(e,r){var t=typeof r,n;return r==null||t==="boolean"?i0(r):(t==="number"?h0:t==="string"?(n=Ks(r))?(r=n,bA):HL:r instanceof Ks?bA:r instanceof Date?jL:LA(r)?BA:Array.isArray(r)?NA:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?zL:h0)(e,r)},WL=function(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}},GL=function(e){return function(){return e}},w1=function(e){return+e},jA=[0,1];function Lu(e){return e}function O1(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:GL(isNaN(r)?NaN:.5)}function zA(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function XL(e,r,t){var n=e[0],i=e[1],a=r[0],o=r[1];return i<n?(n=O1(i,n),a=t(o,a)):(n=O1(n,i),a=t(a,o)),function(l){return a(n(l))}}function ZL(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++o<n;)i[o]=O1(e[o],e[o+1]),a[o]=t(r[o],r[o+1]);return function(l){var c=am(e,l,1,n)-1;return a[c](i[c](l))}}function Pg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function p0(){var e=jA,r=jA,t=C1,n,i,a,o=Lu,l,c,h;function _(){return l=Math.min(e.length,r.length)>2?ZL:XL,c=h=null,x}function x(E){return isNaN(E=+E)?a:(c||(c=l(e.map(n),r,t)))(n(o(E)))}return x.invert=function(E){return o(i((h||(h=l(r,e.map(n),h0)))(E)))},x.domain=function(E){return arguments.length?(e=f0.call(E,w1),o===Lu||(o=zA(e)),_()):e.slice()},x.range=function(E){return arguments.length?(r=tv.call(E),_()):r.slice()},x.rangeRound=function(E){return r=tv.call(E),t=WL,_()},x.clamp=function(E){return arguments.length?(o=E?zA(e):Lu,x):o!==Lu},x.interpolate=function(E){return arguments.length?(t=E,_()):t},x.unknown=function(E){return arguments.length?(a=E,x):a},function(E,C){return n=E,i=C,_()}}function UA(e,r){return p0()(e,r)}var $L=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function d0(e){if(!(r=$L.exec(e)))throw new Error("invalid format: "+e);var r;return new R1({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}d0.prototype=R1.prototype;function R1(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}R1.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};var YL=function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)};function v0(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}var om=function(e){return e=v0(Math.abs(e)),e?e[1]:NaN},KL=function(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(om(r)/3)))*3-om(Math.abs(e)))},qL=function(e,r){return function(t,n){for(var i=t.length,a=[],o=0,l=e[0],c=0;i>0&&l>0&&(c+l+1>n&&(l=Math.max(1,n-c)),a.push(t.substring(i-=l,i+l)),!((c+=l+1)>n));)l=e[o=(o+1)%e.length];return a.reverse().join(r)}},QL=function(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}},JL=function(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e},VA,eN=function(e,r){var t=v0(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(VA=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=n.length;return a===o?n:a>o?n+new Array(a-o+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+v0(e,Math.max(0,r+a-1))[0]},HA=function(e,r){var t=v0(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")},WA={"%":function(r,t){return(r*100).toFixed(t)},b:function(r){return Math.round(r).toString(2)},c:function(r){return r+""},d:YL,e:function(r,t){return r.toExponential(t)},f:function(r,t){return r.toFixed(t)},g:function(r,t){return r.toPrecision(t)},o:function(r){return Math.round(r).toString(8)},p:function(r,t){return HA(r*100,t)},r:HA,s:eN,X:function(r){return Math.round(r).toString(16).toUpperCase()},x:function(r){return Math.round(r).toString(16)}},GA=function(e){return e},XA=Array.prototype.map,ZA=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"],tN=function(e){var r=e.grouping===void 0||e.thousands===void 0?GA:qL(XA.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?GA:QL(XA.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function h(x){x=d0(x);var E=x.fill,C=x.align,I=x.sign,P=x.symbol,B=x.zero,U=x.width,ee=x.comma,ie=x.precision,_e=x.trim,Oe=x.type;Oe==="n"?(ee=!0,Oe="g"):WA[Oe]||(ie===void 0&&(ie=12),_e=!0,Oe="g"),(B||E==="0"&&C==="=")&&(B=!0,E="0",C="=");var ke=P==="$"?t:P==="#"&&/[boxX]/.test(Oe)?"0"+Oe.toLowerCase():"",Ke=P==="$"?n:/[%p]/.test(Oe)?o:"",ot=WA[Oe],Ot=/[defgprs%]/.test(Oe);ie=ie===void 0?6:/[gprs]/.test(Oe)?Math.max(1,Math.min(21,ie)):Math.max(0,Math.min(20,ie));function Zt(ir){var Hr=ke,ln=Ke,pn,Ci,Ba;if(Oe==="c")ln=ot(ir)+ln,ir="";else{ir=+ir;var Sa=ir<0||1/ir<0;if(ir=isNaN(ir)?c:ot(Math.abs(ir),ie),_e&&(ir=JL(ir)),Sa&&+ir==0&&I!=="+"&&(Sa=!1),Hr=(Sa?I==="("?I:l:I==="-"||I==="("?"":I)+Hr,ln=(Oe==="s"?ZA[8+VA/3]:"")+ln+(Sa&&I==="("?")":""),Ot){for(pn=-1,Ci=ir.length;++pn<Ci;)if(Ba=ir.charCodeAt(pn),48>Ba||Ba>57){ln=(Ba===46?i+ir.slice(pn+1):ir.slice(pn))+ln,ir=ir.slice(0,pn);break}}}ee&&!B&&(ir=r(ir,Infinity));var La=Hr.length+ir.length+ln.length,wa=La<U?new Array(U-La+1).join(E):"";switch(ee&&B&&(ir=r(wa+ir,wa.length?U-ln.length:Infinity),wa=""),C){case"<":ir=Hr+ir+ln+wa;break;case"=":ir=Hr+wa+ir+ln;break;case"^":ir=wa.slice(0,La=wa.length>>1)+Hr+ir+ln+wa.slice(La);break;default:ir=wa+Hr+ir+ln;break}return a(ir)}return Zt.toString=function(){return x+""},Zt}function _(x,E){var C=h((x=d0(x),x.type="f",x)),I=Math.max(-8,Math.min(8,Math.floor(om(E)/3)))*3,P=Math.pow(10,-I),B=ZA[8+I/3];return function(U){return C(P*U)+B}}return{format:h,formatPrefix:_}},m0,M1,$A;rN({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function rN(e){return m0=tN(e),M1=m0.format,$A=m0.formatPrefix,m0}var nN=function(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,om(r)-om(e))+1},iN=function(e){return Math.max(0,-om(Math.abs(e)))},aN=function(e,r,t,n){var i=s0(e,r,t),a;switch(n=d0(n==null?",f":n),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=KL(i,o))&&(n.precision=a),$A(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=nN(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=iN(i))&&(n.precision=a-(n.type==="%")*2);break}}return M1(n)};function rv(e){var r=e.domain;return e.ticks=function(t){var n=r();return wA(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return aN(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,o=n[i],l=n[a],c;return l<o&&(c=o,o=l,l=c,c=i,i=a,a=c),c=o0(o,l,t),c>0?(o=Math.floor(o/c)*c,l=Math.ceil(l/c)*c,c=o0(o,l,t)):c<0&&(o=Math.ceil(o*c)/c,l=Math.floor(l*c)/c,c=o0(o,l,t)),c>0?(n[i]=Math.floor(o/c)*c,n[a]=Math.ceil(l/c)*c,r(n)):c<0&&(n[i]=Math.ceil(o*c)/c,n[a]=Math.floor(l*c)/c,r(n)),e},e}function YA(){var e=UA(Lu,Lu);return e.copy=function(){return Pg(e,YA())},Gf.apply(e,arguments),rv(e)}function oN(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=f0.call(n,w1),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return oN(e).unknown(r)},e=arguments.length?f0.call(e,w1):[0,1],rv(t)}var KA=function(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],o;return a<i&&(o=t,t=n,n=o,o=i,i=a,a=o),e[t]=r.floor(i),e[n]=r.ceil(a),e};function qA(e){return Math.log(e)}function QA(e){return Math.exp(e)}function sN(e){return-Math.log(-e)}function uN(e){return-Math.exp(-e)}function lN(e){return isFinite(e)?+("1e"+e):e<0?0:e}function cN(e){return e===10?lN:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function fN(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function JA(e){return function(r){return-e(-r)}}function P1(e){var r=e(qA,QA),t=r.domain,n=10,i,a;function o(){return i=fN(n),a=cN(n),t()[0]<0?(i=JA(i),a=JA(a),e(sN,uN)):e(qA,QA),r}return r.base=function(l){return arguments.length?(n=+l,o()):n},r.domain=function(l){return arguments.length?(t(l),o()):t()},r.ticks=function(l){var c=t(),h=c[0],_=c[c.length-1],x;(x=_<h)&&(E=h,h=_,_=E);var E=i(h),C=i(_),I,P,B,U=l==null?10:+l,ee=[];if(!(n%1)&&C-E<U){if(E=Math.round(E)-1,C=Math.round(C)+1,h>0){for(;E<C;++E)for(P=1,I=a(E);P<n;++P)if(B=I*P,!(B<h)){if(B>_)break;ee.push(B)}}else for(;E<C;++E)for(P=n-1,I=a(E);P>=1;--P)if(B=I*P,!(B<h)){if(B>_)break;ee.push(B)}}else ee=wA(E,C,Math.min(C-E,U)).map(a);return x?ee.reverse():ee},r.tickFormat=function(l,c){if(c==null&&(c=n===10?".0e":","),typeof c!="function"&&(c=M1(c)),l===Infinity)return c;l==null&&(l=10);var h=Math.max(1,n*l/r.ticks().length);return function(_){var x=_/a(Math.round(i(_)));return x*n<n-.5&&(x*=n),x<=h?c(_):""}},r.nice=function(){return t(KA(t(),{floor:function(c){return a(Math.floor(i(c)))},ceil:function(c){return a(Math.ceil(i(c)))}}))},r}function eT(){var e=P1(p0()).domain([1,10]);return e.copy=function(){return Pg(e,eT()).base(e.base())},Gf.apply(e,arguments),e}function tT(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function rT(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function I1(e){var r=1,t=e(tT(r),rT(r));return t.constant=function(n){return arguments.length?e(tT(r=+n),rT(r)):r},rv(t)}function hN(){var e=I1(p0());return e.copy=function(){return Pg(e,hN()).constant(e.constant())},Gf.apply(e,arguments)}function nT(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function pN(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function dN(e){return e<0?-e*e:e*e}function k1(e){var r=e(Lu,Lu),t=1;function n(){return t===1?e(Lu,Lu):t===.5?e(pN,dN):e(nT(t),nT(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},rv(r)}function D1(){var e=k1(p0());return e.copy=function(){return Pg(e,D1()).exponent(e.exponent())},Gf.apply(e,arguments),e}function XG(){return D1.apply(null,arguments).exponent(.5)}function iT(){var e=[],r=[],t=[],n;function i(){var o=0,l=Math.max(1,r.length);for(t=new Array(l-1);++o<l;)t[o-1]=u0(e,o/l);return a}function a(o){return isNaN(o=+o)?n:r[am(t,o)]}return a.invertExtent=function(o){var l=r.indexOf(o);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(o){if(!arguments.length)return e.slice();e=[];for(var l=0,c=o.length,h;l<c;++l)h=o[l],h!=null&&!isNaN(h=+h)&&e.push(h);return e.sort(Jd),i()},a.range=function(o){return arguments.length?(r=tv.call(o),i()):r.slice()},a.unknown=function(o){return arguments.length?(n=o,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return iT().domain(e).range(r).unknown(n)},Gf.apply(a,arguments)}function aT(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function o(c){return c<=c?i[am(n,c,0,t)]:a}function l(){var c=-1;for(n=new Array(t);++c<t;)n[c]=((c+1)*r-(c-t)*e)/(t+1);return o}return o.domain=function(c){return arguments.length?(e=+c[0],r=+c[1],l()):[e,r]},o.range=function(c){return arguments.length?(t=(i=tv.call(c)).length-1,l()):i.slice()},o.invertExtent=function(c){var h=i.indexOf(c);return h<0?[NaN,NaN]:h<1?[e,n[0]]:h>=t?[n[t-1],r]:[n[h-1],n[h]]},o.unknown=function(c){return arguments.length&&(a=c),o},o.thresholds=function(){return n.slice()},o.copy=function(){return aT().domain([e,r]).range(i).unknown(a)},Gf.apply(rv(o),arguments)}function oT(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[am(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=tv.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=tv.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var o=r.indexOf(a);return[e[o-1],e[o]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return oT().domain(e).range(r).unknown(t)},Gf.apply(i,arguments)}var F1=new Date,B1=new Date;function Cu(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var o=i(a),l=i.ceil(a);return a-o<l-a?o:l},i.offset=function(a,o){return r(a=new Date(+a),o==null?1:Math.floor(o)),a},i.range=function(a,o,l){var c=[],h;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<o)||!(l>0))return c;do c.push(h=new Date(+a)),r(a,l),e(a);while(h<a&&a<o);return c},i.filter=function(a){return Cu(function(o){if(o>=o)for(;e(o),!a(o);)o.setTime(o-1)},function(o,l){if(o>=o)if(l<0)for(;++l<=0;)for(;r(o,-1),!a(o););else for(;--l>=0;)for(;r(o,1),!a(o););})},t&&(i.count=function(a,o){return F1.setTime(+a),B1.setTime(+o),e(F1),e(B1),Math.floor(t(F1,B1))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(o){return n(o)%a==0}:function(o){return i.count(0,o)%a==0}):i}),i}var L1=Cu(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});L1.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Cu(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var sm=L1,ZG=L1.range,sT=Cu(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),vN=sT,$G=sT.range,g0=1e3,nv=6e4,y0=36e5,uT=864e5,lT=6048e5;function iv(e){return Cu(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*nv)/lT})}var N1=iv(0),_0=iv(1),mN=iv(2),gN=iv(3),um=iv(4),yN=iv(5),_N=iv(6),YG=N1.range,KG=_0.range,qG=mN.range,QG=gN.range,JG=um.range,eX=yN.range,tX=_N.range,cT=Cu(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*nv)/uT},function(e){return e.getDate()-1}),j1=cT,rX=cT.range,fT=Cu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*g0-e.getMinutes()*nv)},function(e,r){e.setTime(+e+r*y0)},function(e,r){return(r-e)/y0},function(e){return e.getHours()}),bN=fT,nX=fT.range,hT=Cu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*g0)},function(e,r){e.setTime(+e+r*nv)},function(e,r){return(r-e)/nv},function(e){return e.getMinutes()}),xN=hT,iX=hT.range,pT=Cu(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*g0)},function(e,r){return(r-e)/g0},function(e){return e.getUTCSeconds()}),dT=pT,aX=pT.range,b0=Cu(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});b0.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Cu(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):b0};var vT=b0,oX=b0.range;function av(e){return Cu(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/lT})}var z1=av(0),x0=av(1),EN=av(2),SN=av(3),lm=av(4),AN=av(5),TN=av(6),sX=z1.range,uX=x0.range,lX=EN.range,cX=SN.range,fX=lm.range,hX=AN.range,pX=TN.range,mT=Cu(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/uT},function(e){return e.getUTCDate()-1}),U1=mT,dX=mT.range,V1=Cu(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});V1.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Cu(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var cm=V1,vX=V1.range;function H1(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function W1(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ig(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function CN(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,o=e.shortDays,l=e.months,c=e.shortMonths,h=kg(i),_=Dg(i),x=kg(a),E=Dg(a),C=kg(o),I=Dg(o),P=kg(l),B=Dg(l),U=kg(c),ee=Dg(c),ie={a:Sa,A:La,b:wa,B:Ds,c:null,d:ET,e:ET,f:YN,g:a6,G:s6,H:XN,I:ZN,j:$N,L:ST,m:KN,M:qN,p:Mc,q:al,Q:RT,s:MT,S:QN,u:JN,U:e6,V:t6,w:r6,W:n6,x:null,X:null,y:i6,Y:o6,Z:u6,"%":OT},_e={a:pf,A:pd,b:co,B:ol,c:null,d:TT,e:TT,f:h6,g:E6,G:A6,H:l6,I:c6,j:f6,L:CT,m:p6,M:d6,p:Lm,q:Nm,Q:RT,s:MT,S:v6,u:m6,U:g6,V:y6,w:_6,W:b6,x:null,X:null,y:x6,Y:S6,Z:T6,"%":OT},Oe={a:Zt,A:ir,b:Hr,B:ln,c:pn,d:bT,e:bT,f:VN,g:_T,G:yT,H:xT,I:xT,j:NN,L:UN,m:LN,M:jN,p:Ot,q:BN,Q:WN,s:GN,S:zN,u:PN,U:IN,V:kN,w:MN,W:DN,x:Ci,X:Ba,y:_T,Y:yT,Z:FN,"%":HN};ie.x=ke(t,ie),ie.X=ke(n,ie),ie.c=ke(r,ie),_e.x=ke(t,_e),_e.X=ke(n,_e),_e.c=ke(r,_e);function ke(Li,qi){return function($i){var Mn=[],ac=-1,Xo=0,Pc=Li.length,Ic,gv,IO;for($i instanceof Date||($i=new Date(+$i));++ac<Pc;)Li.charCodeAt(ac)===37&&(Mn.push(Li.slice(Xo,ac)),(gv=gT[Ic=Li.charAt(++ac)])!=null?Ic=Li.charAt(++ac):gv=Ic==="e"?" ":"0",(IO=qi[Ic])&&(Ic=IO($i,gv)),Mn.push(Ic),Xo=ac+1);return Mn.push(Li.slice(Xo,ac)),Mn.join("")}}function Ke(Li,qi){return function($i){var Mn=Ig(1900,void 0,1),ac=ot(Mn,Li,$i+="",0),Xo,Pc;if(ac!=$i.length)return null;if("Q"in Mn)return new Date(Mn.Q);if("s"in Mn)return new Date(Mn.s*1e3+("L"in Mn?Mn.L:0));if(qi&&!("Z"in Mn)&&(Mn.Z=0),"p"in Mn&&(Mn.H=Mn.H%12+Mn.p*12),Mn.m===void 0&&(Mn.m="q"in Mn?Mn.q:0),"V"in Mn){if(Mn.V<1||Mn.V>53)return null;"w"in Mn||(Mn.w=1),"Z"in Mn?(Xo=W1(Ig(Mn.y,0,1)),Pc=Xo.getUTCDay(),Xo=Pc>4||Pc===0?x0.ceil(Xo):x0(Xo),Xo=U1.offset(Xo,(Mn.V-1)*7),Mn.y=Xo.getUTCFullYear(),Mn.m=Xo.getUTCMonth(),Mn.d=Xo.getUTCDate()+(Mn.w+6)%7):(Xo=H1(Ig(Mn.y,0,1)),Pc=Xo.getDay(),Xo=Pc>4||Pc===0?_0.ceil(Xo):_0(Xo),Xo=j1.offset(Xo,(Mn.V-1)*7),Mn.y=Xo.getFullYear(),Mn.m=Xo.getMonth(),Mn.d=Xo.getDate()+(Mn.w+6)%7)}else("W"in Mn||"U"in Mn)&&("w"in Mn||(Mn.w="u"in Mn?Mn.u%7:"W"in Mn?1:0),Pc="Z"in Mn?W1(Ig(Mn.y,0,1)).getUTCDay():H1(Ig(Mn.y,0,1)).getDay(),Mn.m=0,Mn.d="W"in Mn?(Mn.w+6)%7+Mn.W*7-(Pc+5)%7:Mn.w+Mn.U*7-(Pc+6)%7);return"Z"in Mn?(Mn.H+=Mn.Z/100|0,Mn.M+=Mn.Z%100,W1(Mn)):H1(Mn)}}function ot(Li,qi,$i,Mn){for(var ac=0,Xo=qi.length,Pc=$i.length,Ic,gv;ac<Xo;){if(Mn>=Pc)return-1;if(Ic=qi.charCodeAt(ac++),Ic===37){if(Ic=qi.charAt(ac++),gv=Oe[Ic in gT?qi.charAt(ac++):Ic],!gv||(Mn=gv(Li,$i,Mn))<0)return-1}else if(Ic!=$i.charCodeAt(Mn++))return-1}return Mn}function Ot(Li,qi,$i){var Mn=h.exec(qi.slice($i));return Mn?(Li.p=_[Mn[0].toLowerCase()],$i+Mn[0].length):-1}function Zt(Li,qi,$i){var Mn=C.exec(qi.slice($i));return Mn?(Li.w=I[Mn[0].toLowerCase()],$i+Mn[0].length):-1}function ir(Li,qi,$i){var Mn=x.exec(qi.slice($i));return Mn?(Li.w=E[Mn[0].toLowerCase()],$i+Mn[0].length):-1}function Hr(Li,qi,$i){var Mn=U.exec(qi.slice($i));return Mn?(Li.m=ee[Mn[0].toLowerCase()],$i+Mn[0].length):-1}function ln(Li,qi,$i){var Mn=P.exec(qi.slice($i));return Mn?(Li.m=B[Mn[0].toLowerCase()],$i+Mn[0].length):-1}function pn(Li,qi,$i){return ot(Li,r,qi,$i)}function Ci(Li,qi,$i){return ot(Li,t,qi,$i)}function Ba(Li,qi,$i){return ot(Li,n,qi,$i)}function Sa(Li){return o[Li.getDay()]}function La(Li){return a[Li.getDay()]}function wa(Li){return c[Li.getMonth()]}function Ds(Li){return l[Li.getMonth()]}function Mc(Li){return i[+(Li.getHours()>=12)]}function al(Li){return 1+~~(Li.getMonth()/3)}function pf(Li){return o[Li.getUTCDay()]}function pd(Li){return a[Li.getUTCDay()]}function co(Li){return c[Li.getUTCMonth()]}function ol(Li){return l[Li.getUTCMonth()]}function Lm(Li){return i[+(Li.getUTCHours()>=12)]}function Nm(Li){return 1+~~(Li.getUTCMonth()/3)}return{format:function(qi){var $i=ke(qi+="",ie);return $i.toString=function(){return qi},$i},parse:function(qi){var $i=Ke(qi+="",!1);return $i.toString=function(){return qi},$i},utcFormat:function(qi){var $i=ke(qi+="",_e);return $i.toString=function(){return qi},$i},utcParse:function(qi){var $i=Ke(qi+="",!0);return $i.toString=function(){return qi},$i}}}var gT={"-":"",_:" ","0":"0"},wu=/^\s*\d+/,wN=/^%/,ON=/[\\^$*+?|[\]().{}]/g;function no(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function RN(e){return e.replace(ON,"\\$&")}function kg(e){return new RegExp("^(?:"+e.map(RN).join("|")+")","i")}function Dg(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function MN(e,r,t){var n=wu.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function PN(e,r,t){var n=wu.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function IN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function kN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function DN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function yT(e,r,t){var n=wu.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function _T(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function FN(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function BN(e,r,t){var n=wu.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function LN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function bT(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function NN(e,r,t){var n=wu.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function xT(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function jN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function zN(e,r,t){var n=wu.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function UN(e,r,t){var n=wu.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function VN(e,r,t){var n=wu.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function HN(e,r,t){var n=wN.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function WN(e,r,t){var n=wu.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function GN(e,r,t){var n=wu.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function ET(e,r){return no(e.getDate(),r,2)}function XN(e,r){return no(e.getHours(),r,2)}function ZN(e,r){return no(e.getHours()%12||12,r,2)}function $N(e,r){return no(1+j1.count(sm(e),e),r,3)}function ST(e,r){return no(e.getMilliseconds(),r,3)}function YN(e,r){return ST(e,r)+"000"}function KN(e,r){return no(e.getMonth()+1,r,2)}function qN(e,r){return no(e.getMinutes(),r,2)}function QN(e,r){return no(e.getSeconds(),r,2)}function JN(e){var r=e.getDay();return r===0?7:r}function e6(e,r){return no(N1.count(sm(e)-1,e),r,2)}function AT(e){var r=e.getDay();return r>=4||r===0?um(e):um.ceil(e)}function t6(e,r){return e=AT(e),no(um.count(sm(e),e)+(sm(e).getDay()===4),r,2)}function r6(e){return e.getDay()}function n6(e,r){return no(_0.count(sm(e)-1,e),r,2)}function i6(e,r){return no(e.getFullYear()%100,r,2)}function a6(e,r){return e=AT(e),no(e.getFullYear()%100,r,2)}function o6(e,r){return no(e.getFullYear()%1e4,r,4)}function s6(e,r){var t=e.getDay();return e=t>=4||t===0?um(e):um.ceil(e),no(e.getFullYear()%1e4,r,4)}function u6(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+no(r/60|0,"0",2)+no(r%60,"0",2)}function TT(e,r){return no(e.getUTCDate(),r,2)}function l6(e,r){return no(e.getUTCHours(),r,2)}function c6(e,r){return no(e.getUTCHours()%12||12,r,2)}function f6(e,r){return no(1+U1.count(cm(e),e),r,3)}function CT(e,r){return no(e.getUTCMilliseconds(),r,3)}function h6(e,r){return CT(e,r)+"000"}function p6(e,r){return no(e.getUTCMonth()+1,r,2)}function d6(e,r){return no(e.getUTCMinutes(),r,2)}function v6(e,r){return no(e.getUTCSeconds(),r,2)}function m6(e){var r=e.getUTCDay();return r===0?7:r}function g6(e,r){return no(z1.count(cm(e)-1,e),r,2)}function wT(e){var r=e.getUTCDay();return r>=4||r===0?lm(e):lm.ceil(e)}function y6(e,r){return e=wT(e),no(lm.count(cm(e),e)+(cm(e).getUTCDay()===4),r,2)}function _6(e){return e.getUTCDay()}function b6(e,r){return no(x0.count(cm(e)-1,e),r,2)}function x6(e,r){return no(e.getUTCFullYear()%100,r,2)}function E6(e,r){return e=wT(e),no(e.getUTCFullYear()%100,r,2)}function S6(e,r){return no(e.getUTCFullYear()%1e4,r,4)}function A6(e,r){var t=e.getUTCDay();return e=t>=4||t===0?lm(e):lm.ceil(e),no(e.getUTCFullYear()%1e4,r,4)}function T6(){return"+0000"}function OT(){return"%"}function RT(e){return+e}function MT(e){return Math.floor(+e/1e3)}var fm,PT,C6,IT,w6;O6({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function O6(e){return fm=CN(e),PT=fm.format,C6=fm.parse,IT=fm.utcFormat,w6=fm.utcParse,fm}var Fg=1e3,Bg=Fg*60,Lg=Bg*60,Ng=Lg*24,R6=Ng*7,kT=Ng*30,G1=Ng*365;function M6(e){return new Date(e)}function P6(e){return e instanceof Date?+e:+new Date(+e)}function X1(e,r,t,n,i,a,o,l,c){var h=UA(Lu,Lu),_=h.invert,x=h.domain,E=c(".%L"),C=c(":%S"),I=c("%I:%M"),P=c("%I %p"),B=c("%a %d"),U=c("%b %d"),ee=c("%B"),ie=c("%Y"),_e=[[o,1,Fg],[o,5,5*Fg],[o,15,15*Fg],[o,30,30*Fg],[a,1,Bg],[a,5,5*Bg],[a,15,15*Bg],[a,30,30*Bg],[i,1,Lg],[i,3,3*Lg],[i,6,6*Lg],[i,12,12*Lg],[n,1,Ng],[n,2,2*Ng],[t,1,R6],[r,1,kT],[r,3,3*kT],[e,1,G1]];function Oe(Ke){return(o(Ke)<Ke?E:a(Ke)<Ke?C:i(Ke)<Ke?I:n(Ke)<Ke?P:r(Ke)<Ke?t(Ke)<Ke?B:U:e(Ke)<Ke?ee:ie)(Ke)}function ke(Ke,ot,Ot,Zt){if(Ke==null&&(Ke=10),typeof Ke=="number"){var ir=Math.abs(Ot-ot)/Ke,Hr=EA(function(ln){return ln[2]}).right(_e,ir);Hr===_e.length?(Zt=s0(ot/G1,Ot/G1,Ke),Ke=e):Hr?(Hr=_e[ir/_e[Hr-1][2]<_e[Hr][2]/ir?Hr-1:Hr],Zt=Hr[1],Ke=Hr[0]):(Zt=Math.max(s0(ot,Ot,Ke),1),Ke=l)}return Zt==null?Ke:Ke.every(Zt)}return h.invert=function(Ke){return new Date(_(Ke))},h.domain=function(Ke){return arguments.length?x(f0.call(Ke,P6)):x().map(M6)},h.ticks=function(Ke,ot){var Ot=x(),Zt=Ot[0],ir=Ot[Ot.length-1],Hr=ir<Zt,ln;return Hr&&(ln=Zt,Zt=ir,ir=ln),ln=ke(Ke,Zt,ir,ot),ln=ln?ln.range(Zt,ir+1):[],Hr?ln.reverse():ln},h.tickFormat=function(Ke,ot){return ot==null?Oe:c(ot)},h.nice=function(Ke,ot){var Ot=x();return(Ke=ke(Ke,Ot[0],Ot[Ot.length-1],ot))?x(KA(Ot,Ke)):h},h.copy=function(){return Pg(h,X1(e,r,t,n,i,a,o,l,c))},h}var I6=function(){return Gf.apply(X1(sm,vN,N1,j1,bN,xN,dT,vT,PT).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)},DT=Cu(function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCMonth(e.getUTCMonth()+r)},function(e,r){return r.getUTCMonth()-e.getUTCMonth()+(r.getUTCFullYear()-e.getUTCFullYear())*12},function(e){return e.getUTCMonth()}),k6=DT,mX=DT.range,FT=Cu(function(e){e.setUTCMinutes(0,0,0)},function(e,r){e.setTime(+e+r*y0)},function(e,r){return(r-e)/y0},function(e){return e.getUTCHours()}),D6=FT,gX=FT.range,BT=Cu(function(e){e.setUTCSeconds(0,0)},function(e,r){e.setTime(+e+r*nv)},function(e,r){return(r-e)/nv},function(e){return e.getUTCMinutes()}),F6=BT,yX=BT.range,_X=function(){return Gf.apply(X1(cm,k6,z1,U1,D6,F6,dT,vT,IT).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)};function E0(){var e=0,r=1,t,n,i,a,o=Lu,l=!1,c;function h(_){return isNaN(_=+_)?c:o(i===0?.5:(_=(a(_)-t)*i,l?Math.max(0,Math.min(1,_)):_))}return h.domain=function(_){return arguments.length?(t=a(e=+_[0]),n=a(r=+_[1]),i=t===n?0:1/(n-t),h):[e,r]},h.clamp=function(_){return arguments.length?(l=!!_,h):l},h.interpolator=function(_){return arguments.length?(o=_,h):o},h.unknown=function(_){return arguments.length?(c=_,h):c},function(_){return a=_,t=_(e),n=_(r),i=t===n?0:1/(n-t),h}}function td(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function LT(){var e=rv(E0()(Lu));return e.copy=function(){return td(e,LT())},lp.apply(e,arguments)}function B6(){var e=P1(E0()).domain([1,10]);return e.copy=function(){return td(e,B6()).base(e.base())},lp.apply(e,arguments)}function L6(){var e=I1(E0());return e.copy=function(){return td(e,L6()).constant(e.constant())},lp.apply(e,arguments)}function NT(){var e=k1(E0());return e.copy=function(){return td(e,NT()).exponent(e.exponent())},lp.apply(e,arguments)}function bX(){return NT.apply(null,arguments).exponent(.5)}function N6(){var e=[],r=Lu;function t(n){if(!isNaN(n=+n))return r((am(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,o;i<a;++i)o=n[i],o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(Jd),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return N6(r).domain(e)},lp.apply(t,arguments)}function S0(){var e=0,r=.5,t=1,n,i,a,o,l,c=Lu,h,_=!1,x;function E(C){return isNaN(C=+C)?x:(C=.5+((C=+h(C))-i)*(C<i?o:l),c(_?Math.max(0,Math.min(1,C)):C))}return E.domain=function(C){return arguments.length?(n=h(e=+C[0]),i=h(r=+C[1]),a=h(t=+C[2]),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),E):[e,r,t]},E.clamp=function(C){return arguments.length?(_=!!C,E):_},E.interpolator=function(C){return arguments.length?(c=C,E):c},E.unknown=function(C){return arguments.length?(x=C,E):x},function(C){return h=C,n=C(e),i=C(r),a=C(t),o=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),E}}function jT(){var e=rv(S0()(Lu));return e.copy=function(){return td(e,jT())},lp.apply(e,arguments)}function j6(){var e=P1(S0()).domain([.1,1,10]);return e.copy=function(){return td(e,j6()).base(e.base())},lp.apply(e,arguments)}function z6(){var e=I1(S0());return e.copy=function(){return td(e,z6()).constant(e.constant())},lp.apply(e,arguments)}function zT(){var e=k1(S0());return e.copy=function(){return td(e,zT()).exponent(e.exponent())},lp.apply(e,arguments)}function xX(){return zT.apply(null,arguments).exponent(.5)}function UT(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return UT(e).unknown(r)},n}var Ac,VT,HT,Z1=xi.isNil,U6=xi.isString,V6=xi.uniq,H6=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,W6=(Ac={},Object(L.a)(Ac,mo.LINEAR,YA),Object(L.a)(Ac,mo.POWER,D1),Object(L.a)(Ac,mo.LOG,eT),Object(L.a)(Ac,mo.IDENTITY,UT),Object(L.a)(Ac,mo.SEQUENTIAL,LT),Object(L.a)(Ac,mo.TIME,I6),Object(L.a)(Ac,mo.QUANTILE,iT),Object(L.a)(Ac,mo.QUANTIZE,aT),Object(L.a)(Ac,mo.THRESHOLD,oT),Object(L.a)(Ac,mo.CAT,Mg),Object(L.a)(Ac,mo.DIVERGING,jT),Ac),G6=(VT=Object(on.injectable)(),VT(HT=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"scaleOptions",{})}return Object(Rt.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",Object(Xt.a)(he.a.mark(function o(){var l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(t.log(Gs.ScaleInitStart,vu.INIT),i.scaleOptions=t.getScaleOptions(),c=a.getLayerStyleAttributes(),h=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(h)&&h.length===0)){x.next=8;break}return x.abrupt("return");case 8:i.caculateScalesForAttributes(c||[],h);case 9:t.log(Gs.ScaleInitEnd,vu.INIT);case 10:case"end":return x.stop()}},o)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var o=Object(Xt.a)(he.a.mark(function l(c){var h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(c){E.next=2;break}return E.abrupt("return",c);case 2:if(t.log(Gs.ScaleInitStart,vu.UPDATE),i.scaleOptions=t.getScaleOptions(),h=a.getLayerStyleAttributes(),_=t.getSource().data.dataArray,!(Array.isArray(_)&&_.length===0)){E.next=8;break}return E.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(h||[],_),t.log(Gs.ScaleInitEnd,vu.UPDATE),t.layerModelNeedUpdate=!0,E.abrupt("return",!0);case 12:case"end":return E.stop()}},l)}));return function(l){return o.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var o=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&o){var c=o.filter(function(h){return h.needRescale});c.length&&i.caculateScalesForAttributes(c,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var o=a.scale,l=a.scale.field;o.names=i.parseFields(Z1(l)?[]:l);var c=[];o.names.forEach(function(h){var _;c.push(i.createScale(h,a.name,(_=a.scale)===null||_===void 0?void 0:_.values,n))}),c.some(function(h){return h.type===Qv.VARIABLE})?(o.type=Qv.VARIABLE,c.forEach(function(h){if(!o.callback&&o.values!=="text"){var _;switch((_=h.option)===null||_===void 0?void 0:_.type){case mo.LOG:case mo.LINEAR:case mo.POWER:if(o.values&&o.values.length>2){var x=h.scale.ticks(o.values.length);h.scale.domain(x)}o.values?h.scale.range(o.values):h.scale.range(h.option.domain);break;case mo.QUANTILE:case mo.QUANTIZE:case mo.THRESHOLD:h.scale.range(o.values);break;case mo.IDENTITY:break;case mo.CAT:o.values?h.scale.range(o.values):h.scale.range(h.option.domain);break;case mo.DIVERGING:case mo.SEQUENTIAL:h.scale.interpolator(AL(o.values));break}}if(o.values==="text"){var E;h.scale.range((E=h.option)===null||E===void 0?void 0:E.domain)}})):(o.type=Qv.CONSTANT,o.defaultValues=c.map(function(h,_){return h.scale(o.names[_])})),o.scalers=c.map(function(h){return{field:h.field,func:h.scale,option:h.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:U6(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var o,l,c=this.scaleOptions[n]&&((o=this.scaleOptions[n])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[n]:this.scaleOptions[t],h={field:t,scale:void 0,type:Qv.VARIABLE,option:c};if(!a||!a.length)return c&&c.type?h.scale=this.createDefaultScale(c):(h.scale=Mg([t]),h.type=Qv.CONSTANT),h;var _=(l=a.find(function(C){return!Z1(C[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||Z1(_)&&!c)h.scale=Mg([t]),h.type=Qv.CONSTANT;else{var x=c&&c.type||this.getDefaultType(_);i==="text"&&(x=mo.CAT),i===void 0&&(x=mo.IDENTITY);var E=this.createScaleConfig(x,t,c,a);h.scale=this.createDefaultScale(E),h.option=E}return h}},{key:"getDefaultType",value:function(t){var n=mo.LINEAR;return typeof t=="string"&&(n=H6.test(t)?mo.TIME:mo.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var o={type:t},l=(a==null?void 0:a.map(function(_){return _[n]}))||[];if(i!=null&&i.domain)o.domain=i==null?void 0:i.domain;else if(t===mo.CAT||t===mo.IDENTITY)o.domain=V6(l);else if(t===mo.QUANTILE)o.domain=l;else if(t===mo.DIVERGING){var c=m1(l),h=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(c[0]+c[1])/2;o.domain=[c[0],h,c[1]]}else o.domain=m1(l);return Object(we.a)(Object(we.a)({},o),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,o=t.clamp,l=t.nice,c=W6[n]();return i&&c.domain&&c.domain(i),a&&c.unknown(a),o!==void 0&&c.clamp&&c.clamp(o),l!==void 0&&c.nice&&c.nice(l),c}}]),e}())||HT),WT,GT,X6=(WT=Object(on.injectable)(),WT(GT=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms(Object(we.a)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||GT),XT,ZT,Z6=(XT=Object(on.injectable)(),XT(ZT=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var o;(o=t.masks).push.apply(o,Object(cr.a)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||ZT),$6=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;Object(Et.a)(this,e),Object(L.a)(this,"tileResource",new Map),Object(L.a)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return Object(Rt.a)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var o=n.getTile(a==null?void 0:a.key);return o?(o==null?void 0:o.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){var i=this,a,o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=this.getRenderLayers(),o=a.map(function(){var h=Object(Xt.a)(he.a.mark(function _(x){return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,i.layerService.renderTileLayer(x);case 2:case"end":return C.stop()}},_)}));return function(_){return h.apply(this,arguments)}}()),c.next=4,Promise.all(o);case 4:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,Object(cr.a)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,Object(cr.a)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),Y6=O("3L5V"),K6=O.n(Y6);function q6(e,r,t){t===void 0&&(t={});var n=rn(e),i=rn(r),a=K6.a.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?wi(a[0],t.properties):_o(a,t.properties)}var Q6=q6,J6=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var o=wi(a.coordinates);n===null?n=o:n=Q6(n,o)}),i&&(n.properties=Object(we.a)({},i)),n}}]),e}(),jg="select",zg="active",e7=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;Object(Et.a)(this,e),Object(L.a)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new J6}return Object(Rt.a)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var i=this.parent.getContainer(),a=i.get(Qt.IPickingService);if(t.type==="RasterLayer"){var o=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(o&&o.getMainLayer()!==void 0){var l=o.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=Object(Bn.a)(t,3),i=n[0],a=n[1],o=n[2],l=this.color2PickId(i,a,o);this.tilePickID.set(jg,l),this.updateHighLight(i,a,o,jg)}},{key:"highlightPickedFeature",value:function(t){var n=Object(Bn.a)(t,3),i=n[0],a=n[1],o=n[2],l=this.color2PickId(i,a,o);this.tilePickID.set(zg,l),this.updateHighLight(i,a,o,zg)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(o){var l=o.getMainLayer();switch(a){case jg:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case zg:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(jg),n=this.tilePickID.get(zg);if(t){var i=this.pickId2Color(t),a=Object(Bn.a)(i,3),o=a[0],l=a[1],c=a[2];this.updateHighLight(o,l,c,jg);return}if(n){var h=this.pickId2Color(n),_=Object(Bn.a)(h,3),x=_[0],E=_[1],C=_[2];this.updateHighLight(x,E,C,zg);return}}},{key:"color2PickId",value:function(t,n,i){return qs(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return os(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,Object(cr.a)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function t7(e){return e==="PolygonLayer"?e0:e==="LineLayer"?d1:Jy}function r7(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function n7(e){var r=i7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function i7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ov=function(e){Object(qr.a)(t,e);var r=n7(t);function t(n,i){var a;return Object(Et.a)(this,t),a=r.call(this),Object(L.a)(Object(De.a)(a),"visible",!0),Object(L.a)(Object(De.a)(a),"layers",[]),Object(L.a)(Object(De.a)(a),"isLoaded",!1),Object(L.a)(Object(De.a)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return Object(Rt.a)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=Object(Bn.a)(this.sourceTile.bounds,4),o=a[0],l=a[1],c=a[2],h=a[3],_=i.lng,x=i.lat;return _>=o&&_<=c&&x>=l&&x<=h}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return Object(we.a)(Object(we.a)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:r7(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),o=a.maskLayers,l=[];return o==null||o.forEach(function(c){if(!c.tileLayer)return l.push(c),c;var h=c.tileLayer,_=h.getTile(i.sourceTile.key),x=_==null?void 0:_.getLayers()[0];x&&l.push(x)}),l}},{key:"addTileMask",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return o=new e0({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=Eg(this.parent.sceneContainer),o.setContainer(l,this.parent.sceneContainer),_.next=5,o.init();case 5:return this.tileMask=o,c=this.getMainLayer(),c!==void 0&&(c.tileMask=o),_.abrupt("return",o);case 9:case"end":return _.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o,l){var c;return he.a.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return c=Eg(this.parent.sceneContainer),l.setContainer(c,this.parent.sceneContainer),_.next=4,l.init();case 4:o.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return _.stop()}},a,this)}));function i(a,o){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(o){var l;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return o.isTileLayer=!0,l=Eg(this.parent.sceneContainer),o.setContainer(l,this.parent.sceneContainer),this.layers.push(o),h.next=6,o.init();case 6:case"end":return h.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(o){o.updateLayerConfig(Object(L.a)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(uo.EventEmitter);function a7(e){var r=o7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function o7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s7=function(e){Object(qr.a)(t,e);var r=a7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.getSourceOption(),l=o.data.features[0].properties,c=new d1().source(o.data,o.options).size(1).shape("line").color("red"),h=new Jy({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),x.next=6,this.addLayer(c);case 6:return x.next=8,this.addLayer(h);case 8:this.isLoaded=!0;case 9:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(ov);function u7(e){var r=l7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function l7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var c7=function(e){Object(qr.a)(t,e);var r=u7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),h=new IS(Object(we.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(E){var C,I,P=E;h[P]((C=o[P])===null||C===void 0?void 0:C.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(ov);function f7(e){var r=h7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function h7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p7=function(e){Object(qr.a)(t,e);var r=f7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),h=new aA(Object(we.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(E){var C,I,P=E;h[P]((C=o[P])===null||C===void 0?void 0:C.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),o=a.sourceLayer,l=a.featureId,c=this.getFeatures(o);return{data:{type:"FeatureCollection",features:c},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(ov),d7=["rasterData"];function v7(e){var r=m7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function m7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g7=function(e){Object(qr.a)(t,e);var r=v7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),h=new t0(Object(we.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(E){var C,I,P=E;h[P]((C=o[P])===null||C===void 0?void 0:C.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,o=a.rasterData,l=Object(Th.a)(a,d7);return{data:o,options:{parser:Object(we.a)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(ov);function y7(e){var r=_7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function _7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b7=function(e){Object(qr.a)(t,e);var r=y7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h;return he.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),h=new t0(Object(we.a)({},l)).source(c.data,c.options),o&&Object.keys(o).forEach(function(E){var C,I,P=E;h[P]((C=o[P])===null||C===void 0?void 0:C.field,(I=o[P])===null||I===void 0?void 0:I.values)}),x.next=7,this.addLayer(h);case 7:this.isLoaded=!0;case 8:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(ov),x7=["rasterData"];function E7(e){var r=S7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function S7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A7={positions:[0,1],colors:["#000","#fff"]},T7=function(e){Object(qr.a)(t,e);var r=E7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_,x,E;return he.a.wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=this.getSourceOption(),h=this.getLayerOptions(),_=h.rampColors,x=h.domain,this.colorTexture=this.parent.textureService.getColorTexture(_,x),E=new t0(Object(we.a)(Object(we.a)({},l),{},{colorTexture:this.colorTexture})).source(c.data,c.options),o&&Object.keys(o).forEach(function(P){var B,U,ee=P;E[ee]((B=o[ee])===null||B===void 0?void 0:B.field,(U=o[ee])===null||U===void 0?void 0:U.values)}),I.next=9,this.addLayer(E);case 9:this.isLoaded=!0;case 10:case"end":return I.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,o=a.rasterData,l=Object(Th.a)(a,x7);return{data:o,options:{parser:Object(we.a)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,o=new Array(a),l=0;l<a;l++)o[l]=arguments[l];var c=o,h=c.rampColors,_=h===void 0?A7:h,x=c.domain;this.colorTexture=this.parent.textureService.getColorTexture(_,x||Uc(_)),this.layers.forEach(function(E){return E.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(ov);function C7(e){var r=w7();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function w7(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A0=function(e){Object(qr.a)(t,e);var r=C7(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"initTileLayer",value:function(){var n=Object(Xt.a)(he.a.mark(function a(){var o,l,c,h,_;return he.a.wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(o=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),c=t7(this.parent.type),h=this.getSourceOption(),h){E.next=8;break}return this.isLoaded=!0,this.emit("loaded"),E.abrupt("return");case 8:return _=new c(Object(we.a)({},l)).source(h.data,h.options),Object.keys(o).forEach(function(C){var I,P,B=C;_[B]((I=o[B])===null||I===void 0?void 0:I.field,(P=o[B])===null||P===void 0?void 0:P.values)}),E.next=12,this.addLayer(_);case 12:if(!l.tileMask){E.next=15;break}return E.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(_),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return E.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),o=a.sourceLayer,l=o===void 0?"defaultLayer":o,c=a.featureId,h=c===void 0?"id":c,_=this.getFeatures(l);return{data:{type:"FeatureCollection",features:_},options:{parser:{type:"geojson",featureId:h},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var o=a.getSource().data.dataArray.filter(function(l){return l._id===i});return o}}]),t}(ov);function O7(e){var r=e.type;switch(r){case"PolygonLayer":return A0;case"LineLayer":return A0;case"PointLayer":return A0;case"TileDebugLayer":return s7;case"MaskLayer":return p7;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Fu.RGB:case Fu.CUSTOMRGB:return g7;case Fu.ARRAYBUFFER:case Fu.CUSTOMARRAYBUFFER:return T7;case Fu.TERRAINRGB:case Fu.CUSTOMTERRAINRGB:return b7;default:return c7}default:return A0}}var R7=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"],M7=xi.debounce,$T=function(){function e(r){var t=this;Object(Et.a)(this,e),Object(L.a)(this,"initedTileset",!1),Object(L.a)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),o=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var c=t.parent.getLayerConfig(),h=c.visible;l<2&&h?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!h&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===o.toString()||(t.lastViewStates={zoom:l,latLonBounds:o},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,o))}}),Object(L.a)(this,"viewchange",M7(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(Qt.IRendererService),this.layerService=n.get(Qt.ILayerService),this.mapService=n.get(Qt.IMapService),this.pickingService=n.get(Qt.IPickingService),this.tileLayerService=new $6({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new e7({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return Object(Rt.a)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,o=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(o,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){var i=this,a,o;return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.tilesetManager){c.next=2;break}return c.abrupt("return");case 2:return a=this.parent.getMinZoom(),o=this.parent.getMaxZoom(),c.next=6,Promise.all(this.tilesetManager.tiles.filter(function(h){return h.isLoaded}).filter(function(h){return h.isVisibleChange}).filter(function(h){return h.data}).filter(function(h){return h.z>=a&&h.z<o}).map(function(){var h=Object(Xt.a)(he.a.mark(function _(x){var E,C;return he.a.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(i.tileLayerService.hasTile(x.key)){P.next=9;break}return E=O7(i.parent),C=new E(x,i.parent),P.next=5,C.initTileLayer();case 5:i.tilePickService.setPickState(),C.getLayers().length!==0&&(i.tileLayerService.addTile(C),i.tileLayerService.updateTileVisible(x),i.layerService.reRender()),P.next=12;break;case 9:i.tileLayerService.updateTileVisible(x),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return P.stop()}},_)}));return function(_){return h.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return c.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;R7.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return a.apply(void 0,l),n.getLayers().map(function(h){h[i].apply(h,l)}),i==="style"&&n.getTiles().forEach(function(h){return h.styleUpdate.apply(h,l)}),t}})}}]),e}(),YT,KT,P7=(YT=Object(on.injectable)(),YT(KT=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"build",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return i.prepareBuildModel(),o.next=3,i.buildModels();case 3:case"end":return o.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",Object(Xt.a)(he.a.mark(function i(){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!t.getSource().isTile){o.next=4;break}return t.prepareBuildModel(),t.tileLayer=new $T(t),o.abrupt("return");case 4:return t.log(Gs.BuildModelStart,vu.INIT),o.next=7,n.initLayerModel(t);case 7:t.log(Gs.BuildModelEnd,vu.INIT);case 8:case"end":return o.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=Object(Xt.a)(he.a.mark(function a(o){return he.a.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(o){c.next=2;break}return c.abrupt("return",!1);case 2:if(!t.getSource().isTile){c.next=5;break}return t.tileLayer=new $T(t),c.abrupt("return",!1);case 5:return t.log(Gs.BuildModelStart,vu.UPDATE),c.next=8,n.prepareLayerModel(t);case 8:return t.log(Gs.BuildModelEnd,vu.UPDATE),c.abrupt("return",!0);case 10:case"end":return c.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||KT),qT,QT,I7=(qT=Object(on.injectable)(),qT(QT=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||QT),JT,eC,k7=["type"],tC={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},D7={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},F7={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},B7={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function L7(e){var r={u_DirectionalLights:new Array(3).fill(Object(we.a)({},F7)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Object(we.a)({},B7)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[D7]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=Object(Th.a)(t,k7),o=tC[i].lights,l=tC[i].num,c=r[l];r[o][c]=Object(we.a)(Object(we.a)({},r[o][c]),a),r[l]++}),r}var N7=(JT=Object(on.injectable)(),JT(eC=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms(Object(we.a)({},L7()))})})}}]),e}())||eC),rC,nC,j7=(rC=Object(on.injectable)(),rC(nC=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var c=t.getLayerConfig(),h=c.enableMultiPassRenderer,_=c.passes,x=_===void 0?[]:_;i.enabled=!!h&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=iS(t,x,o,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var c=a.getViewportSize(),h=c.width,_=c.height;t.multiPassRenderer.resize(h,_)}})}}]),e}())||nC),iC,aC,hm={NONE:0,ENCODE:1,HIGHLIGHT:2},z7=(iC=Object(on.injectable)(),iC(aC=function(){function e(){Object(Et.a)(this,e),Object(L.a)(this,"PickOption",{u_HighlightColor:[1,0,0,1],u_SelectColor:[1,0,0,1],u_PickingColor:[0,0,0],u_PickingStage:0,u_CurrentSelectedId:[0,0,0],u_PickingThreshold:10,u_PickingBuffer:0,u_shaderPick:0,u_EnableSelect:0,u_activeMix:0})}return Object(Rt.a)(e,[{key:"pickOption2Array",value:function(){return Object.values(this.PickOption).flat()}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(a){i.PickOption[a]=t[a]}),n.uniformBuffers[1].subData({offset:0,data:new Uint8Array(new Float32Array(this.pickOption2Array()))})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,o=n.styleAttributeService;if(!a.uniformBuffers[1]){var l=a.createBuffer({data:new Float32Array(this.pickOption2Array().length),isUBO:!0});a.uniformBuffers[1]=l,this.updatePickOption({},a)}t.hooks.init.tapPromise("PixelPickingPlugin",function(){var c=t.getLayerConfig(),h=c.enablePicking;o.registerStyleAttribute({name:"pickingColor",type:Rn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:Xs.PICKING_COLOR,buffer:{data:[],type:Z.FLOAT},size:3,update:function(x){var E=x.id;return h?os(E):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),h=c.enablePicking;h&&t.isVisible()&&(i.updatePickOption({u_PickingStage:hm.ENCODE},a),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:hm.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var c=t.getLayerConfig(),h=c.enablePicking;h&&t.isVisible()&&(i.updatePickOption({u_PickingStage:hm.HIGHLIGHT},a),t.models.forEach(function(_){return _.addUniforms({u_PickingStage:hm.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(c){var h=t.getLayerConfig(),_=h.highlightColor,x=h.activeMix,E=x===void 0?0:x,C=typeof _=="string"?oa(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:qs(new Uint8Array(c))});var I={u_PickingStage:hm.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:C.map(function(P){return P*255}),u_activeMix:E};i.updatePickOption(I,a),t.models.forEach(function(P){return P.addUniforms(I)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(c){var h=t.getLayerConfig(),_=h.selectColor,x=h.selectMix,E=x===void 0?0:x,C=typeof _=="string"?oa(_):_||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:qs(new Uint8Array(c))});var I={u_PickingStage:hm.HIGHLIGHT,u_PickingColor:c,u_HighlightColor:C.map(function(P){return P*255}),u_activeMix:E,u_CurrentSelectedId:c,u_SelectColor:C.map(function(P){return P*255}),u_EnableSelect:1};console.log(I),i.updatePickOption(I,a),t.models.forEach(function(P){return P.addUniforms(I)})})}}]),e}())||aC),U7=["mvt","geojsonvt","testTile"];function V7(e){var r=e.getSource();return U7.includes(r.parser.type)}function EX(e){return e.getContext?{width:e.width/j.DPR,height:e.height/j.DPR}:e.getBoundingClientRect()}var oC,sC,H7=(oC=Object(on.injectable)(),oC(sC=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){V7(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Rn.Attribute,descriptor:{name:"a_Position",shaderLocation:Xs.POSITION,buffer:{data:[],type:Z.FLOAT},size:3,update:function(i,a,o){return o.length===2?[o[0],o[1],0]:[o[0],o[1],o[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Rn.Attribute,descriptor:{name:"a_Color",shaderLocation:Xs.COLOR,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Rn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:Xs.VERTEX_ID,buffer:{usage:Z.DYNAMIC_DRAW,data:[],type:Z.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||sC),uC,lC,cC,fC,hC,pC,dC,sv,vC,mC,gC,yC,_C,W7=(uC=Object(on.injectable)(),lC=Object(on.inject)(Qt.ICameraService),cC=Object(on.inject)(Qt.ICoordinateSystemService),fC=Object(on.inject)(Qt.IRendererService),hC=Object(on.inject)(Qt.IMapService),pC=Object(on.inject)(Qt.ILayerService),uC(dC=(sv=function(){function e(){Object(Et.a)(this,e),ga(this,"cameraService",vC,this),ga(this,"coordinateSystemService",mC,this),ga(this,"rendererService",gC,this),ga(this,"mapService",yC,this),ga(this,"layerService",_C,this)}return Object(Rt.a)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*5+4*6+4),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var c=t.getLayerConfig().tileOrigin;n.coordinateSystemService.refresh(c),i==="GAODE2.x"&&(n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),o=n.mapService.getCustomCoordCenter());var h=n.rendererService.getViewportSize(),_=h.width,x=h.height,E=n.generateUBO(a,o,_,x),C=E.data,I=E.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:C}),t.models.forEach(function(P){P.addUniforms(Object(we.a)(Object(we.a)({},I),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var o,l=this.cameraService.getProjectionMatrix(),c=this.cameraService.getViewMatrix(),h=this.cameraService.getViewProjectionMatrix(),_=this.cameraService.getModelMatrix(),x=this.coordinateSystemService.getViewportCenterProjection(),E=this.coordinateSystemService.getPixelsPerDegree(),C=this.cameraService.getZoom(),I=this.coordinateSystemService.getPixelsPerDegree2(),P=this.cameraService.getZoomScale(),B=this.coordinateSystemService.getPixelsPerMeter(),U=this.coordinateSystemService.getCoordinateSystem(),ee=this.cameraService.getCameraPosition(),ie=window.devicePixelRatio,_e=this.coordinateSystemService.getViewportCenter(),Oe=[i,a],ke=this.cameraService.getFocalDistance(),Ke=[].concat(Object(cr.a)(c),Object(cr.a)(l),Object(cr.a)(h),Object(cr.a)(_),Object(cr.a)(t),Object(cr.a)(x),Object(cr.a)(E),[C],Object(cr.a)(I),[P],Object(cr.a)(B),[U],Object(cr.a)(ee),[ie],Object(cr.a)(_e),Oe,Object(cr.a)(n),[ke,0]);return{data:Ke,uniforms:(o={},Object(L.a)(o,qd.ProjectionMatrix,l),Object(L.a)(o,qd.ViewMatrix,c),Object(L.a)(o,qd.ViewProjectionMatrix,h),Object(L.a)(o,qd.Zoom,C),Object(L.a)(o,qd.ZoomScale,P),Object(L.a)(o,qd.FocalDistance,ke),Object(L.a)(o,qd.CameraPosition,ee),Object(L.a)(o,Yd.CoordinateSystem,U),Object(L.a)(o,Yd.ViewportCenter,_e),Object(L.a)(o,Yd.ViewportCenterProjection,x),Object(L.a)(o,Yd.PixelsPerDegree,E),Object(L.a)(o,Yd.PixelsPerDegree2,I),Object(L.a)(o,Yd.PixelsPerMeter,B),Object(L.a)(o,Yd.Mvp,t),Object(L.a)(o,"u_sceneCenterMercator",n),Object(L.a)(o,"u_ViewportSize",Oe),Object(L.a)(o,"u_ModelMatrix",_),Object(L.a)(o,"u_DevicePixelRatio",ie),o)}}}]),e}(),vC=ma(sv.prototype,"cameraService",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mC=ma(sv.prototype,"coordinateSystemService",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=ma(sv.prototype,"rendererService",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yC=ma(sv.prototype,"mapService",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_C=ma(sv.prototype,"layerService",[pC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv))||dC),bC,xC,G7=(bC=Object(on.injectable)(),bC(xC=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||xC),EC,SC,X7=(EC=Object(on.injectable)(),EC(SC=function(){function e(){Object(Et.a)(this,e)}return Object(Rt.a)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],o=i.getLayerStyleAttribute("filter");if(o&&o.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(o){return o.needRegenerateVertices}).forEach(function(o){i.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex),o.needRegenerateVertices=!1})}}]),e}())||SC);tc.bind(Qt.ILayerPlugin).to(nL).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(H7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(G6).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(rL).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(I7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(Z6).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(X7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(G7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(j7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(W7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(X6).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(N7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(z7).inRequestScope(),tc.bind(Qt.ILayerPlugin).to(P7).inRequestScope();var Z7=O("fbvF"),$7=O.n(Z7),Y7=function(){function e(r,t){Object(Et.a)(this,e);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,l=t.size,c=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:c||0},l&&(this.attribute.size=l)}return Object(Rt.a)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),cp,Ug,rd,cf,Vg,nd,Hg,T0,Ch,uv,Nu,wh,Oh,C0,K7=(cp={},Object(L.a)(cp,Z.POINTS,"points"),Object(L.a)(cp,Z.LINES,"lines"),Object(L.a)(cp,Z.LINE_LOOP,"line loop"),Object(L.a)(cp,Z.LINE_STRIP,"line strip"),Object(L.a)(cp,Z.TRIANGLES,"triangles"),Object(L.a)(cp,Z.TRIANGLE_FAN,"triangle fan"),Object(L.a)(cp,Z.TRIANGLE_STRIP,"triangle strip"),cp),AC=(Ug={},Object(L.a)(Ug,Z.STATIC_DRAW,"static"),Object(L.a)(Ug,Z.DYNAMIC_DRAW,"dynamic"),Object(L.a)(Ug,Z.STREAM_DRAW,"stream"),Ug),$1=(rd={},Object(L.a)(rd,Z.BYTE,"int8"),Object(L.a)(rd,Z.INT,"int32"),Object(L.a)(rd,Z.UNSIGNED_BYTE,"uint8"),Object(L.a)(rd,Z.UNSIGNED_SHORT,"uint16"),Object(L.a)(rd,Z.UNSIGNED_INT,"uint32"),Object(L.a)(rd,Z.FLOAT,"float"),rd),q7=(cf={},Object(L.a)(cf,Z.ALPHA,"alpha"),Object(L.a)(cf,Z.LUMINANCE,"luminance"),Object(L.a)(cf,Z.LUMINANCE_ALPHA,"luminance alpha"),Object(L.a)(cf,Z.RGB,"rgb"),Object(L.a)(cf,Z.RGBA,"rgba"),Object(L.a)(cf,Z.RGBA4,"rgba4"),Object(L.a)(cf,Z.RGB5_A1,"rgb5 a1"),Object(L.a)(cf,Z.RGB565,"rgb565"),Object(L.a)(cf,Z.DEPTH_COMPONENT,"depth"),Object(L.a)(cf,Z.DEPTH_STENCIL,"depth stencil"),cf),Q7=(Vg={},Object(L.a)(Vg,Z.DONT_CARE,"dont care"),Object(L.a)(Vg,Z.NICEST,"nice"),Object(L.a)(Vg,Z.FASTEST,"fast"),Vg),TC=(nd={},Object(L.a)(nd,Z.NEAREST,"nearest"),Object(L.a)(nd,Z.LINEAR,"linear"),Object(L.a)(nd,Z.LINEAR_MIPMAP_LINEAR,"mipmap"),Object(L.a)(nd,Z.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Object(L.a)(nd,Z.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Object(L.a)(nd,Z.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),nd),CC=(Hg={},Object(L.a)(Hg,Z.REPEAT,"repeat"),Object(L.a)(Hg,Z.CLAMP_TO_EDGE,"clamp"),Object(L.a)(Hg,Z.MIRRORED_REPEAT,"mirror"),Hg),J7=(T0={},Object(L.a)(T0,Z.NONE,"none"),Object(L.a)(T0,Z.BROWSER_DEFAULT_WEBGL,"browser"),T0),e8=(Ch={},Object(L.a)(Ch,Z.NEVER,"never"),Object(L.a)(Ch,Z.ALWAYS,"always"),Object(L.a)(Ch,Z.LESS,"less"),Object(L.a)(Ch,Z.LEQUAL,"lequal"),Object(L.a)(Ch,Z.GREATER,"greater"),Object(L.a)(Ch,Z.GEQUAL,"gequal"),Object(L.a)(Ch,Z.EQUAL,"equal"),Object(L.a)(Ch,Z.NOTEQUAL,"notequal"),Ch),wC=(uv={},Object(L.a)(uv,Z.FUNC_ADD,"add"),Object(L.a)(uv,Z.MIN_EXT,"min"),Object(L.a)(uv,Z.MAX_EXT,"max"),Object(L.a)(uv,Z.FUNC_SUBTRACT,"subtract"),Object(L.a)(uv,Z.FUNC_REVERSE_SUBTRACT,"reverse subtract"),uv),w0=(Nu={},Object(L.a)(Nu,Z.ZERO,"zero"),Object(L.a)(Nu,Z.ONE,"one"),Object(L.a)(Nu,Z.SRC_COLOR,"src color"),Object(L.a)(Nu,Z.ONE_MINUS_SRC_COLOR,"one minus src color"),Object(L.a)(Nu,Z.SRC_ALPHA,"src alpha"),Object(L.a)(Nu,Z.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Object(L.a)(Nu,Z.DST_COLOR,"dst color"),Object(L.a)(Nu,Z.ONE_MINUS_DST_COLOR,"one minus dst color"),Object(L.a)(Nu,Z.DST_ALPHA,"dst alpha"),Object(L.a)(Nu,Z.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Object(L.a)(Nu,Z.CONSTANT_COLOR,"constant color"),Object(L.a)(Nu,Z.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Object(L.a)(Nu,Z.CONSTANT_ALPHA,"constant alpha"),Object(L.a)(Nu,Z.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Object(L.a)(Nu,Z.SRC_ALPHA_SATURATE,"src alpha saturate"),Nu),t8=(wh={},Object(L.a)(wh,Z.NEVER,"never"),Object(L.a)(wh,Z.ALWAYS,"always"),Object(L.a)(wh,Z.LESS,"less"),Object(L.a)(wh,Z.LEQUAL,"lequal"),Object(L.a)(wh,Z.GREATER,"greater"),Object(L.a)(wh,Z.GEQUAL,"gequal"),Object(L.a)(wh,Z.EQUAL,"equal"),Object(L.a)(wh,Z.NOTEQUAL,"notequal"),wh),pm=(Oh={},Object(L.a)(Oh,Z.ZERO,"zero"),Object(L.a)(Oh,Z.KEEP,"keep"),Object(L.a)(Oh,Z.REPLACE,"replace"),Object(L.a)(Oh,Z.INVERT,"invert"),Object(L.a)(Oh,Z.INCR,"increment"),Object(L.a)(Oh,Z.DECR,"decrement"),Object(L.a)(Oh,Z.INCR_WRAP,"increment wrap"),Object(L.a)(Oh,Z.DECR_WRAP,"decrement wrap"),Oh),r8=(C0={},Object(L.a)(C0,Z.FRONT,"front"),Object(L.a)(C0,Z.BACK,"back"),C0),n8=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:AC[i||Z.STATIC_DRAW],type:$1[a||Z.UNSIGNED_BYTE]})}return Object(Rt.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),i8=function(){function e(r,t){Object(Et.a)(this,e);var n=t.data,i=t.usage,a=t.type,o=t.count;this.elements=r.elements({data:n,usage:AC[i||Z.STATIC_DRAW],type:$1[a||Z.UNSIGNED_BYTE],count:o})}return Object(Rt.a)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),a8=function(){function e(r,t){Object(Et.a)(this,e);var n=t.width,i=t.height,a=t.color,o=t.colors,l={width:n,height:i};Array.isArray(o)&&(l.colors=o.map(function(c){return c.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return Object(Rt.a)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),o8=function(r){return r==null},ff=o8,s8={}.toString,u8=function(r,t){return s8.call(r)==="[object "+t+"]"},l8=u8,c8=function(r){return l8(r,"Number")},dm=c8,f8=function(r,t,n){return r<t?t:r>n?n:r},h8=f8,Wn=O("mrSG"),p8=O("veWP"),OC=O.n(p8),at;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(at||(at={}));var Fa;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(Fa||(Fa={}));var Ra;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Ra||(Ra={}));var Wg;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Wg||(Wg={}));var nc;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(nc||(nc={}));var ya;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(ya||(ya={}));var ju;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(ju||(ju={}));var Tl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(Tl||(Tl={}));var Ps;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(Ps||(Ps={}));var lu;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(lu||(lu={}));var Is;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(Is||(Is={}));var go;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(go||(go={}));var Xf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(Xf||(Xf={}));var lv;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(lv||(lv={}));var RC;(function(e){e.LOADED="loaded"})(RC||(RC={}));var sa;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(sa||(sa={}));var Tc;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET"})(Tc||(Tc={}));var zu;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(zu||(zu={}));var nl;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(nl||(nl={}));function SX(e,r,t,n){var i=sa.TEXTURE_2D,a=1,o=Tc.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:o}}var ts;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(ts||(ts={}));var vm;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(vm||(vm={}));var mm;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(mm||(mm={}));var O0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(O0||(O0={}));var Vr;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Vr||(Vr={}));var li;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(li||(li={}));function MC(e){return e}var Vn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"})(Vn||(Vn={}));function Ti(e,r,t){return e<<16|r<<8|t}var Vt;(function(e){e[e.ALPHA=Ti(Vr.U8,li.A,Vn.None)]="ALPHA",e[e.U8_LUMINANCE=Ti(Vr.U8,li.A,Vn.None)]="U8_LUMINANCE",e[e.F16_LUMINANCE=Ti(Vr.F16,li.A,Vn.None)]="F16_LUMINANCE",e[e.F32_LUMINANCE=Ti(Vr.F32,li.A,Vn.None)]="F32_LUMINANCE",e[e.F16_R=Ti(Vr.F16,li.R,Vn.None)]="F16_R",e[e.F16_RG=Ti(Vr.F16,li.RG,Vn.None)]="F16_RG",e[e.F16_RGB=Ti(Vr.F16,li.RGB,Vn.None)]="F16_RGB",e[e.F16_RGBA=Ti(Vr.F16,li.RGBA,Vn.None)]="F16_RGBA",e[e.F32_R=Ti(Vr.F32,li.R,Vn.None)]="F32_R",e[e.F32_RG=Ti(Vr.F32,li.RG,Vn.None)]="F32_RG",e[e.F32_RGB=Ti(Vr.F32,li.RGB,Vn.None)]="F32_RGB",e[e.F32_RGBA=Ti(Vr.F32,li.RGBA,Vn.None)]="F32_RGBA",e[e.U8_R=Ti(Vr.U8,li.R,Vn.None)]="U8_R",e[e.U8_R_NORM=Ti(Vr.U8,li.R,Vn.Normalized)]="U8_R_NORM",e[e.U8_RG=Ti(Vr.U8,li.RG,Vn.None)]="U8_RG",e[e.U8_RG_NORM=Ti(Vr.U8,li.RG,Vn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=Ti(Vr.U8,li.RGB,Vn.None)]="U8_RGB",e[e.U8_RGB_NORM=Ti(Vr.U8,li.RGB,Vn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=Ti(Vr.U8,li.RGB,Vn.sRGB|Vn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=Ti(Vr.U8,li.RGBA,Vn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=Ti(Vr.U8,li.RGBA,Vn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=Ti(Vr.U8,li.RGBA,Vn.sRGB|Vn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=Ti(Vr.U16,li.R,Vn.None)]="U16_R",e[e.U16_R_NORM=Ti(Vr.U16,li.R,Vn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=Ti(Vr.U16,li.RG,Vn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=Ti(Vr.U16,li.RGBA,Vn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=Ti(Vr.U16,li.RGB,Vn.None)]="U16_RGB",e[e.U32_R=Ti(Vr.U32,li.R,Vn.None)]="U32_R",e[e.U32_RG=Ti(Vr.U32,li.RG,Vn.None)]="U32_RG",e[e.S8_R=Ti(Vr.S8,li.R,Vn.None)]="S8_R",e[e.S8_R_NORM=Ti(Vr.S8,li.R,Vn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=Ti(Vr.S8,li.RG,Vn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=Ti(Vr.S8,li.RGB,Vn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=Ti(Vr.S8,li.RGBA,Vn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=Ti(Vr.S16,li.R,Vn.None)]="S16_R",e[e.S16_RG=Ti(Vr.S16,li.RG,Vn.None)]="S16_RG",e[e.S16_RG_NORM=Ti(Vr.S16,li.RG,Vn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=Ti(Vr.S16,li.RGB,Vn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=Ti(Vr.S16,li.RGBA,Vn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=Ti(Vr.S16,li.RGBA,Vn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=Ti(Vr.S32,li.R,Vn.None)]="S32_R",e[e.U16_RGBA_5551=Ti(Vr.U16_PACKED_5551,li.RGBA,Vn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=Ti(Vr.U16_PACKED_565,li.RGB,Vn.Normalized)]="U16_RGB_565",e[e.BC1=Ti(Vr.BC1,li.RGBA,Vn.Normalized)]="BC1",e[e.BC1_SRGB=Ti(Vr.BC1,li.RGBA,Vn.Normalized|Vn.sRGB)]="BC1_SRGB",e[e.BC2=Ti(Vr.BC2,li.RGBA,Vn.Normalized)]="BC2",e[e.BC2_SRGB=Ti(Vr.BC2,li.RGBA,Vn.Normalized|Vn.sRGB)]="BC2_SRGB",e[e.BC3=Ti(Vr.BC3,li.RGBA,Vn.Normalized)]="BC3",e[e.BC3_SRGB=Ti(Vr.BC3,li.RGBA,Vn.Normalized|Vn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=Ti(Vr.BC4_UNORM,li.R,Vn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=Ti(Vr.BC4_SNORM,li.R,Vn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=Ti(Vr.BC5_UNORM,li.RG,Vn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=Ti(Vr.BC5_SNORM,li.RG,Vn.Normalized)]="BC5_SNORM",e[e.D24=Ti(Vr.D24,li.R,Vn.Depth)]="D24",e[e.D24_S8=Ti(Vr.D24S8,li.RG,Vn.Depth|Vn.Stencil)]="D24_S8",e[e.D32F=Ti(Vr.D32F,li.R,Vn.Depth)]="D32F",e[e.D32F_S8=Ti(Vr.D32FS8,li.RG,Vn.Depth|Vn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=Ti(Vr.U8,li.RGB,Vn.RenderTarget|Vn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=Ti(Vr.U8,li.RGBA,Vn.RenderTarget|Vn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=Ti(Vr.U8,li.RGBA,Vn.RenderTarget|Vn.Normalized|Vn.sRGB)]="U8_RGBA_RT_SRGB"})(Vt||(Vt={}));function R0(e){return e>>>8&255}function Rh(e){return e>>>16&255}function gm(e){return e&255}function PC(e){switch(e){case Vr.F32:case Vr.U32:case Vr.S32:return 4;case Vr.U16:case Vr.S16:case Vr.F16:return 2;case Vr.U8:case Vr.S8:return 1;default:throw new Error("whoops")}}function IC(e){return PC(Rh(e))}function AX(e){return MC(R0(e))}function d8(e){var r=PC(Rh(e)),t=MC(R0(e));return r*t}function TX(e,r){return e&4294967040|r}function CX(e,r){return e&4294902015|r<<8}function kC(e){var r=gm(e);if(r&Vn.Depth)return ts.Depth;if(r&Vn.Normalized)return ts.Float;var t=Rh(e);if(t===Vr.F16||t===Vr.F32)return ts.Float;if(t===Vr.U8||t===Vr.U16||t===Vr.U32)return ts.Uint;if(t===Vr.S8||t===Vr.S16||t===Vr.S32)return ts.Sint;throw new Error("whoops")}function Ki(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function cv(e){if(e!=null)return e;throw new Error("Missing object")}function DC(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function FC(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function BC(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function M0(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var Y1=M0(0,0,0,0),wX=M0(0,0,0,1),v8=M0(1,1,1,0),OX=M0(1,1,1,1),ym=!0;function RX(e,r){r===void 0&&(r=ym),r&&(e[10]=-e[10],e[14]=-e[14])}function MX(e,r){r===void 0&&(r=ym),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function m8(e,r){if(r===void 0&&(r=ym),r)switch(e){case Ra.LESS:return Ra.GREATER;case Ra.LEQUAL:return Ra.GEQUAL;case Ra.GEQUAL:return Ra.LEQUAL;case Ra.GREATER:return Ra.LESS;default:return e}else return e}function PX(e,r){return r===void 0&&(r=ym),r?1-e:e}function IX(e,r){return r===void 0&&(r=ym),r?-e:e}function kX(e,r,t,n){if(n===void 0&&(n=ym),t=m8(t,n),t===Ra.LESS)return e<r;if(t===Ra.LEQUAL)return e<=r;if(t===Ra.GREATER)return e>r;if(t===Ra.GEQUAL)return e>=r;throw new Error("whoops")}function P0(e){return!!(e&&(e&e-1)==0)}function _m(e,r){return e!=null?e:r}function g8(e){return e===void 0?null:e}function DX(e,r,t){e.length=r,e.fill(t)}function I0(e,r){var t=r-1;return e+t&~t}function FX(e,r){return((e+r-1)/r|0)*r}function y8(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),o=t(r,e[a]);o<0?i=a:n=a+1}return n}function BX(e,r,t){var n=y8(e,r,t);e.splice(n,0,r)}function LX(e,r,t){return t?e|=r:e&=~r,e}function _8(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function b8(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(x8(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function x8(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function NX(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function LC(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function k0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e}function NC(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),LC(e.rgbBlendState,r.rgbBlendState),LC(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function K1(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=NC(e[t],r[t])}function E8(e,r){r.attachmentsState!==void 0&&K1(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&FC(e.blendConstant,r.blendConstant),e.depthCompare=_m(r.depthCompare,e.depthCompare),e.depthWrite=_m(r.depthWrite,e.depthWrite),e.stencilWrite=_m(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&k0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&k0(e.stencilBack,r.stencilBack),e.cullMode=_m(r.cullMode,e.cullMode),e.frontFace=_m(r.frontFace,e.frontFace),e.polygonOffset=_m(r.polygonOffset,e.polygonOffset)}function bm(e){var r=Object.assign({},e);return r.attachmentsState=[],K1(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&BC(r.blendConstant),r.stencilFront=k0(void 0,e.stencilFront),r.stencilBack=k0(void 0,e.stencilBack),r}function S8(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var jC={blendMode:ju.ADD,blendSrcFactor:ya.ONE,blendDstFactor:ya.ZERO},fv={attachmentsState:[{channelWriteMask:zu.ALL,rgbBlendState:jC,alphaBlendState:jC}],blendConstant:BC(Y1),depthWrite:!0,depthCompare:Ra.LEQUAL,stencilWrite:!1,stencilFront:{compare:Ra.ALWAYS,passOp:nl.KEEP,depthFailOp:nl.KEEP,failOp:nl.KEEP},stencilBack:{compare:Ra.ALWAYS,passOp:nl.KEEP,depthFailOp:nl.KEEP,failOp:nl.KEEP},cullMode:nc.NONE,frontFace:Wg.CCW,polygonOffset:!1};function A8(e,r){e===void 0&&(e=null),r===void 0&&(r=fv);var t=bm(r);return e!==null&&E8(t,e),t}var jX=A8({depthCompare:Ra.ALWAYS,depthWrite:!1},fv);function zX(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],K1(e.attachmentsState,fv.attachmentsState)),S8(e.attachmentsState[0],r),e}var zC={texture:null,sampler:null,formatKind:ts.Float,dimension:sa.TEXTURE_2D};function xm(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Gg(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function T8(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function C8(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function UX(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!xm(e.samplerBindings,r.samplerBindings,C8)||!xm(e.uniformBufferBindings,r.uniformBufferBindings,T8))}function UC(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function w8(e,r){return!(!UC(e.rgbBlendState,r.rgbBlendState)||!UC(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function D0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp}function O8(e,r){return!xm(e.attachmentsState,r.attachmentsState,w8)||e.blendConstant&&r.blendConstant&&!DC(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!D0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!D0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function VC(e,r){return e.id===r.id}function R8(e,r){return e===r}function VX(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!O8(e.megaStateDescriptor,r.megaStateDescriptor)||!VC(e.program,r.program)||!xm(e.colorAttachmentFormats,r.colorAttachmentFormats,R8)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function M8(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function P8(e,r){return ff(e)?ff(r):ff(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&xm(e.attributes,r.attributes,M8)}function HX(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!xm(e.vertexBufferDescriptors,r.vertexBufferDescriptors,P8)||!VC(e.program,r.program))}function WX(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function I8(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function HC(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function GX(e){var r=e.samplerBindings&&Gg(e.samplerBindings,I8),t=e.uniformBufferBindings&&Gg(e.uniformBufferBindings,HC),n=e.storageBufferBindings&&Gg(e.storageBufferBindings,HC);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,pipeline:e.pipeline}}function XX(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&bm(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),o=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:o,sampleCount:l}}function k8(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function D8(e){if(ff(e))return e;var r=e.arrayStride,t=e.stepMode,n=Gg(e.attributes,k8);return{arrayStride:r,stepMode:t,attributes:n}}function ZX(e){var r=Gg(e.vertexBufferDescriptors,D8),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var ha,F8=/([^[]*)(\[[0-9]+\])?/;function B8(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(F8);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:Boolean(r[2])}}function Cl(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function rs(e,r,t,n){var i=null,a=null;return function(o,l,c){var h=r(c,t),_=h.length,x=!1;if(i===null)i=new Float32Array(_),a=_,x=!0;else{Ki(a===_,"Uniform length cannot change.");for(var E=0;E<_;++E)if(h[E]!==i[E]){x=!0;break}}return x&&(n(o,e,l,h),i.set(h)),x}}function il(e,r,t,n){e[r](t,n)}function fp(e,r,t,n){e[r](t,!1,n)}var L8={},N8={},j8={},WC=[0];function q1(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(WC[0]=e,e=WC);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var o=0;o<i;o++)a[o]=e[o];return a}function Cc(e,r){return q1(e,r,Float32Array,L8)}function id(e,r){return q1(e,r,Int32Array,N8)}function F0(e,r){return q1(e,r,Uint32Array,j8)}var z8=(ha={},ha[at.FLOAT]=rs.bind(null,"uniform1fv",Cc,1,il),ha[at.FLOAT_VEC2]=rs.bind(null,"uniform2fv",Cc,2,il),ha[at.FLOAT_VEC3]=rs.bind(null,"uniform3fv",Cc,3,il),ha[at.FLOAT_VEC4]=rs.bind(null,"uniform4fv",Cc,4,il),ha[at.INT]=rs.bind(null,"uniform1iv",id,1,il),ha[at.INT_VEC2]=rs.bind(null,"uniform2iv",id,2,il),ha[at.INT_VEC3]=rs.bind(null,"uniform3iv",id,3,il),ha[at.INT_VEC4]=rs.bind(null,"uniform4iv",id,4,il),ha[at.BOOL]=rs.bind(null,"uniform1iv",id,1,il),ha[at.BOOL_VEC2]=rs.bind(null,"uniform2iv",id,2,il),ha[at.BOOL_VEC3]=rs.bind(null,"uniform3iv",id,3,il),ha[at.BOOL_VEC4]=rs.bind(null,"uniform4iv",id,4,il),ha[at.FLOAT_MAT2]=rs.bind(null,"uniformMatrix2fv",Cc,4,fp),ha[at.FLOAT_MAT3]=rs.bind(null,"uniformMatrix3fv",Cc,9,fp),ha[at.FLOAT_MAT4]=rs.bind(null,"uniformMatrix4fv",Cc,16,fp),ha[at.UNSIGNED_INT]=rs.bind(null,"uniform1uiv",F0,1,il),ha[at.UNSIGNED_INT_VEC2]=rs.bind(null,"uniform2uiv",F0,2,il),ha[at.UNSIGNED_INT_VEC3]=rs.bind(null,"uniform3uiv",F0,3,il),ha[at.UNSIGNED_INT_VEC4]=rs.bind(null,"uniform4uiv",F0,4,il),ha[at.FLOAT_MAT2x3]=rs.bind(null,"uniformMatrix2x3fv",Cc,6,fp),ha[at.FLOAT_MAT2x4]=rs.bind(null,"uniformMatrix2x4fv",Cc,8,fp),ha[at.FLOAT_MAT3x2]=rs.bind(null,"uniformMatrix3x2fv",Cc,6,fp),ha[at.FLOAT_MAT3x4]=rs.bind(null,"uniformMatrix3x4fv",Cc,12,fp),ha[at.FLOAT_MAT4x2]=rs.bind(null,"uniformMatrix4x2fv",Cc,8,fp),ha[at.FLOAT_MAT4x3]=rs.bind(null,"uniformMatrix4x3fv",Cc,12,fp),ha[at.SAMPLER_2D]=Cl,ha[at.SAMPLER_CUBE]=Cl,ha[at.SAMPLER_3D]=Cl,ha[at.SAMPLER_2D_SHADOW]=Cl,ha[at.SAMPLER_2D_ARRAY]=Cl,ha[at.SAMPLER_2D_ARRAY_SHADOW]=Cl,ha[at.SAMPLER_CUBE_SHADOW]=Cl,ha[at.INT_SAMPLER_2D]=Cl,ha[at.INT_SAMPLER_3D]=Cl,ha[at.INT_SAMPLER_CUBE]=Cl,ha[at.INT_SAMPLER_2D_ARRAY]=Cl,ha[at.UNSIGNED_INT_SAMPLER_2D]=Cl,ha[at.UNSIGNED_INT_SAMPLER_3D]=Cl,ha[at.UNSIGNED_INT_SAMPLER_CUBE]=Cl,ha[at.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Cl,ha);function GC(e,r,t){var n=z8[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var U8={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function V8(e){return Object.prototype.toString.call(e)in U8}function Xg(e,r){return"#define ".concat(e," ").concat(r)}function H8(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function W8(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var o=Number(i);return t.push({location:isNaN(o)?r[i]:o,name:a}),""}),t}function $X(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var o=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var c=Object(Wn.e)(l.trim().split(/\s+/),2),h=c[0],_=c[1];o.push({type:h.trim(),name:_.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:o}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var o=a.trim().split(" "),l=o[0]||"",c=o[1]||"",h=c.indexOf("[")>-1;if(c=c.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var _=t.find(function(C){return l===C.type});if(_)if(h)for(var x=function(I){_.uniforms.forEach(function(P){r.push("".concat(c,"[").concat(I,"].").concat(P.name))})},E=0;E<5;E++)x(E);else _.uniforms.forEach(function(C){r.push("".concat(c,".").concat(C.name))})}c&&r.push(c)}}),""}),r}function XC(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function G8(e){var r="",t=e;return[t,r]}function ad(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var o=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,c=t.replace(`\r
`,`
`).split(`
`).map(function(ke){return ke.replace(/[/][/].*$/,"")}).filter(function(ke){var Ke=!ke||/^\s+$/.test(ke);return!Ke}),h="";n!==null&&(h=Object.keys(n).map(function(ke){return Xg(ke,n[ke])}).join(`
`));var _=c.find(function(ke){return ke.startsWith("precision")})||"precision mediump float;",x=i?c.filter(function(ke){return!ke.startsWith("precision")}).join(`
`):c.join(`
`),E="";if(e.viewportOrigin===vm.UPPER_LEFT&&(E+="".concat(Xg("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===mm.ZERO&&(E+="".concat(Xg("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var C=0,I=0,P=0;x=x.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(ke,Ke,ot,Ot){var Zt=ot?"".concat(ot,", "):"";return"layout(".concat(Zt,"set = ").concat(C,", binding = ").concat(I++,") uniform ").concat(Ot)}),C++,I=0,Ki(e.separateSamplerTextures),x=x.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ke,Ke,ot,Ot,Zt){var ir=XC(ot);ir===null&&(ir=I++);var Hr=Object(Wn.e)(G8(Ot),2),ln=Hr[0],pn=Hr[1];return r==="frag"?`
layout(set = `.concat(C,", binding = ").concat(ir*2+0,") uniform texture").concat(ln," T_").concat(Zt,`;
layout(set = `).concat(C,", binding = ").concat(ir*2+1,") uniform sampler").concat(pn," S_").concat(Zt,";").trim():""}),x=x.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(ke,Ke){return"layout(location = ".concat(P++,") ").concat(Ke)}),E+="".concat(Xg("gl_VertexID","gl_VertexIndex"),`
`),E+="".concat(Xg("gl_InstanceID","gl_InstanceIndex"),`
`),_=_.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var B=0;x=x.replace(/^(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ke,Ke,ot,Ot,Zt){var ir=XC(ot);return ir===null&&(ir=B++),"uniform sampler".concat(Ot," ").concat(Zt,"; // BINDING=").concat(ir)})}if(e.separateSamplerTextures)x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ke,Ke,ot){return"sampler".concat(Ke,"(T_").concat(ot,", S_").concat(ot,")")}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(ke,Ke){return"T_".concat(Ke)});else{var U=[];x=x.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ke,Ke,ot){return U.push([ot,Ke]),ot}),o&&U.forEach(function(ke){var Ke=Object(Wn.e)(ke,2),ot=Ke[0],Ot=Ke[1];x=x.replace(new RegExp("texture\\(".concat(ot),"g"),function(){return"texture".concat(Ot,"(").concat(ot)})}),x=x.replace(/\bTEXTURE\((.*?)\)/g,function(ke,Ke){return Ke})}var ee="".concat(o?"":e.glslVersion,`
`).concat(o&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(o&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?_:"",`
`).concat(E||"").concat(h?h+`
`:"",`
`).concat(x,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(ee=ee.replace(/^\b(out)\b/g,function(ke,Ke){return"layout(location = 0) ".concat(Ke)})),o){if(r==="frag"&&(ee=ee.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(ke,Ke,ot){return"varying ".concat(Ke," ").concat(ot,`;
`)})),r==="vert"&&(ee=ee.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ke,Ke,ot){return"varying ".concat(Ke," ").concat(ot,`;
`)}),ee=ee.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(ke,Ke,ot){return"attribute ".concat(Ke," ").concat(ot,`;
`)})),ee=ee.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(ke,Ke){return Ke.trim().replace(/^.*$/gm,function(ot){var Ot=ot.trim();return Ot.startsWith("#")?Ot:ot?"uniform ".concat(Ot):""})}),r==="frag")if(l){var ie=[];ee=ee.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(ke,Ke){return ie.push(Ke),"vec4 ".concat(Ke,`;
`)});var _e=ee.lastIndexOf("}");ee=ee.substring(0,_e)+`
    `.concat(ie.map(function(ke,Ke){return"gl_FragData[".concat(Ke,"] = ").concat(ke,`;
    `)}).join(`
`))+ee.substring(_e)}else{var Oe;if(ee=ee.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ke,Ke,ot){return Oe=ot,"".concat(Ke," ").concat(ot,`;
`)}),Oe){var _e=ee.lastIndexOf("}");ee=ee.substring(0,_e)+`
  gl_FragColor = vec4(`.concat(Oe,`);
`)+ee.substring(_e)}}ee=ee.replace(/^\s*layout\((.*)\)/gm,"")}return ee}function YX(e,r,t,n){n===void 0&&(n=null);var i=ad(e,"vert",r,n),a=ad(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var Zf=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(OC.a),X8=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.Bindings;var l=a.uniformBufferBindings,c=a.samplerBindings;return o.uniformBufferBindings=l||[],o.samplerBindings=c||[],o.bindingLayouts=o.createBindingLayouts(),o}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,o=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:o}),t+=a,n+=o,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(Zf);function oi(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function ZC(e){var r=Rh(e);switch(r){case Vr.BC1:case Vr.BC2:case Vr.BC3:case Vr.BC4_UNORM:case Vr.BC4_SNORM:case Vr.BC5_UNORM:case Vr.BC5_SNORM:return!0;default:return!1}}function $C(e){var r=gm(e);if(r&Vn.Normalized)return!1;var t=Rh(e);return t===Vr.S8||t===Vr.S16||t===Vr.S32||t===Vr.U8||t===Vr.U16||t===Vr.U32}function Z8(e){switch(e){case Xf.STATIC:return at.STATIC_DRAW;case Xf.DYNAMIC:return at.DYNAMIC_DRAW}}function YC(e){if(e&go.INDEX)return at.ELEMENT_ARRAY_BUFFER;if(e&go.VERTEX)return at.ARRAY_BUFFER;if(e&go.UNIFORM)return at.UNIFORM_BUFFER}function $8(e){switch(e){case Is.TRIANGLES:return at.TRIANGLES;case Is.POINTS:return at.POINTS;case Is.TRIANGLE_STRIP:return at.TRIANGLE_STRIP;case Is.LINES:return at.LINES;case Is.LINE_STRIP:return at.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function Y8(e){switch(e){case Vr.U8:return at.UNSIGNED_BYTE;case Vr.U16:return at.UNSIGNED_SHORT;case Vr.U32:return at.UNSIGNED_INT;case Vr.S8:return at.BYTE;case Vr.S16:return at.SHORT;case Vr.S32:return at.INT;case Vr.F16:return at.HALF_FLOAT;case Vr.F32:return at.FLOAT;default:throw new Error("whoops")}}function K8(e){switch(e){case li.R:return 1;case li.RG:return 2;case li.RGB:return 3;case li.RGBA:return 4;default:return 1}}function q8(e){var r=Rh(e),t=R0(e),n=gm(e),i=Y8(r),a=K8(t),o=!!(n&Vn.Normalized);return{size:a,type:i,normalized:o}}function Q8(e){switch(e){case Vt.U8_R:return at.UNSIGNED_BYTE;case Vt.U16_R:return at.UNSIGNED_SHORT;case Vt.U32_R:return at.UNSIGNED_INT;default:throw new Error("whoops")}}function Zg(e){switch(e){case Tl.CLAMP_TO_EDGE:return at.CLAMP_TO_EDGE;case Tl.REPEAT:return at.REPEAT;case Tl.MIRRORED_REPEAT:return at.MIRRORED_REPEAT;default:throw new Error("whoops")}}function B0(e,r){if(r===lu.LINEAR&&e===Ps.BILINEAR)return at.LINEAR_MIPMAP_LINEAR;if(r===lu.LINEAR&&e===Ps.POINT)return at.NEAREST_MIPMAP_LINEAR;if(r===lu.NEAREST&&e===Ps.BILINEAR)return at.LINEAR_MIPMAP_NEAREST;if(r===lu.NEAREST&&e===Ps.POINT)return at.NEAREST_MIPMAP_NEAREST;if(r===lu.NO_MIP&&e===Ps.BILINEAR)return at.LINEAR;if(r===lu.NO_MIP&&e===Ps.POINT)return at.NEAREST;throw new Error("Unknown texture filter mode")}function Em(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function Sm(e){var r=e;return r.gl_texture}function Q1(e){var r=e;return r.gl_sampler}function $g(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function KC(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function od(e){return e.blendMode==ju.ADD&&e.blendSrcFactor==ya.ONE&&e.blendDstFactor===ya.ZERO}function J8(e){switch(e){case O0.OcclusionConservative:return at.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function ej(e){if(e===sa.TEXTURE_2D)return at.TEXTURE_2D;if(e===sa.TEXTURE_2D_ARRAY)return at.TEXTURE_2D_ARRAY;if(e===sa.TEXTURE_CUBE_MAP)return at.TEXTURE_CUBE_MAP;if(e===sa.TEXTURE_3D)return at.TEXTURE_3D;throw new Error("whoops")}function J1(e,r,t,n){return!(e%t!=0||r%n!=0)}var tj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.Buffer;var l=a.viewOrSize,c=a.usage,h=a.hint,_=h===void 0?Xf.STATIC:h,x=i.uniformBufferMaxPageByteSize,E=i.gl,C=c&go.UNIFORM;C||(oi(E)?E.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var I=dm(l)?I0(l,4):I0(l.byteLength,4);o.gl_buffer_pages=[];var P;if(C){for(var B=I;B>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(B,x),c,_)),B-=x;P=x}else o.gl_buffer_pages.push(o.createBufferPage(I,c,_)),P=I;return o.pageByteSize=P,o.byteSize=I,o.usage=c,o.gl_target=YC(c),dm(l)||o.setSubData(0,new Uint8Array(l.buffer)),C||(oi(E)?E.bindVertexArray(o.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var o=this.device.gl,l=this.pageByteSize,c=t+a,h=t,_=t%l;h<c;){var x=oi(o)?o.COPY_WRITE_BUFFER:this.gl_target,E=Em(this,h);if(E.ubo)return;o.bindBuffer(x,E),oi(o)?o.bufferSubData(x,_,n,i,Math.min(c-h,l)):o.bufferSubData(x,_,n),h+=l,_=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,o=n&go.UNIFORM;if(!oi(a)&&o)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),c=YC(n),h=Z8(i);return a.bindBuffer(c,l),a.bufferData(c,t,h),l},r}(Zf),rj=function(e){Object(Wn.c)(r,e);function r(t){var n,i,a,o,l=t.id,c=t.device,h=t.descriptor,_,x=e.call(this,{id:l,device:c})||this;x.type=Fa.InputLayout;var E=h.vertexBufferDescriptors,C=h.indexBufferFormat,I=h.program;Ki(C===Vt.U16_R||C===Vt.U32_R||C===null);var P=C!==null?Q8(C):null,B=C!==null?IC(C):null,U=x.device.gl,ee=x.device.ensureResourceExists(oi(U)?U.createVertexArray():c.OES_vertex_array_object.createVertexArrayOES());oi(U)?U.bindVertexArray(ee):c.OES_vertex_array_object.bindVertexArrayOES(ee),U.bindBuffer(U.ARRAY_BUFFER,Em(x.device.fallbackVertexBuffer));try{for(var ie=Object(Wn.i)(h.vertexBufferDescriptors),_e=ie.next();!_e.done;_e=ie.next()){var Oe=_e.value,ke=Oe.stepMode,Ke=Oe.attributes;try{for(var ot=(a=void 0,Object(Wn.i)(Ke)),Ot=ot.next();!Ot.done;Ot=ot.next()){var Zt=Ot.value,ir=Zt.shaderLocation,Hr=Zt.format,ln=Zt.divisor,pn=ln===void 0?1:ln,Ci=oi(U)?ir:(_=I.attributes[ir])===null||_===void 0?void 0:_.location,Ba=q8(Hr);if(Zt.vertexFormat=Ba,!ff(Ci)){$C(Hr);var Sa=Ba.size,La=Ba.type,wa=Ba.normalized;U.vertexAttribPointer(Ci,Sa,La,wa,0,0),ke===lv.INSTANCE&&(oi(U)?U.vertexAttribDivisor(Ci,pn):c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Ci,pn)),U.enableVertexAttribArray(Ci)}}}catch(Ds){a={error:Ds}}finally{try{Ot&&!Ot.done&&(o=ot.return)&&o.call(ot)}finally{if(a)throw a.error}}}}catch(Ds){n={error:Ds}}finally{try{_e&&!_e.done&&(i=ie.return)&&i.call(ie)}finally{if(n)throw n.error}}return oi(U)?U.bindVertexArray(null):c.OES_vertex_array_object.bindVertexArrayOES(null),x.vertexBufferDescriptors=E,x.vao=ee,x.indexBufferFormat=C,x.indexBufferType=P,x.indexBufferCompByteSize=B,x.program=I,x}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(oi(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(Zf),eb=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=Fa.Texture,a=Object(Wn.a)({dimension:sa.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var c=l.device.gl,h,_,x=l.clampmipLevelCount(a);if(l.immutable=a.usage===Tc.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=kC(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=x>=1,!o){_=l.device.ensureResourceExists(c.createTexture());var E=l.device.translateTextureType(a.format),C=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(c.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===sa.TEXTURE_2D){if(h=at.TEXTURE_2D,c.bindTexture(h,_),l.immutable)if(oi(c))c.texStorage2D(h,x,C,a.width,a.height);else{var I=(C===at.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===Vt.D32F||l.format===Vt.D24_S8)&&!oi(c)&&!i.WEBGL_depth_texture||(c.texImage2D(h,I,C,a.width,a.height,0,C,E,null),l.mipmaps&&(l.mipmaps=!1,c.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,at.LINEAR),c.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_S,at.CLAMP_TO_EDGE),c.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_T,at.CLAMP_TO_EDGE)))}Ki(a.depthOrArrayLayers===1)}else if(a.dimension===sa.TEXTURE_2D_ARRAY)h=at.TEXTURE_2D_ARRAY,c.bindTexture(h,_),l.immutable&&oi(c)&&c.texStorage3D(h,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===sa.TEXTURE_3D)h=at.TEXTURE_3D,c.bindTexture(h,_),l.immutable&&oi(c)&&c.texStorage3D(h,x,C,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===sa.TEXTURE_CUBE_MAP)h=at.TEXTURE_CUBE_MAP,c.bindTexture(h,_),l.immutable&&oi(c)&&c.texStorage2D(h,x,C,a.width,a.height),Ki(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=_,l.gl_target=h,l.mipLevelCount=x,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;ZC(this.format);var a=this.gl_target===at.TEXTURE_3D||this.gl_target===at.TEXTURE_2D_ARRAY,o=this.gl_target===at.TEXTURE_CUBE_MAP,l=V8(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var c=t[0],h,_;l?(h=this.width,_=this.height):(h=c.width,_=c.height,this.width=h,this.height=_),i.bindTexture(this.gl_target,this.gl_texture);var x=this.device.translateTextureFormat(this.format),E=this.device.translateTextureType(this.format);this.preprocessImage();for(var C=0;C<this.depthOrArrayLayers;C++){var I=t[C],P=this.gl_target;o&&(P=at.TEXTURE_CUBE_MAP_POSITIVE_X+C%6),this.immutable?i.texSubImage2D(P,n,0,0,h,_,x,E,I):oi(i)?a?i.texImage3D(P,n,x,h,_,this.depthOrArrayLayers,0,x,E,I):i.texImage2D(P,n,x,h,_,0,x,E,I):l?i.texImage2D(P,n,x,h,_,0,x,E,I):i.texImage2D(P,n,x,x,E,I)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Sm(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===sa.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=Rh(t.format);if(n===Vr.BC1)for(var i=t.width,a=t.height,o=0;o<t.mipLevelCount;o++){if(i<=2||a<=2)return o-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(at.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(at.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(at.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!oi(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,at.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,at.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,at.TEXTURE_MIN_FILTER,at.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,at.TEXTURE_MAG_FILTER,at.LINEAR)):n.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,at.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return oi(t)?!1:!P0(this.width)||!P0(this.height)},r}(Zf),nj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var l=o.device.gl,c=a.format,h=a.width,_=a.height,x=a.sampleCount,E=x===void 0?1:x,C=a.texture,I=!1;if((c===Vt.D32F||c===Vt.D24_S8)&&C&&!oi(l)&&!i.WEBGL_depth_texture&&(C.destroy(),o.texture=null,I=!0),!I&&C)o.texture=C;else{o.gl_renderbuffer=o.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,o.gl_renderbuffer);var P=o.device.translateTextureInternalFormat(c,!0);oi(l)&&E>1?l.renderbufferStorageMultisample(at.RENDERBUFFER,E,P,h,_):l.renderbufferStorage(at.RENDERBUFFER,P,h,_)}return o.format=c,o.width=h,o.height=_,o.sampleCount=E,o}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(Zf),ic;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(ic||(ic={}));var ij=function(e){Object(Wn.c)(r,e);function r(t,n){var i=t.id,a=t.device,o=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=Fa.Program,l.uniformSetters={},l.attributes=[];var c=l.device.gl;return l.descriptor=o,l.gl_program=l.device.ensureResourceExists(c.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=ic.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){var t,n;Ki(this.compileState===ic.NeedsCompile);var i=this.descriptor,a=this.device.gl;((t=i.vertex)===null||t===void 0?void 0:t.glsl)&&((n=i.fragment)===null||n===void 0?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=ic.Compiling,oi(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=H8(this.descriptor.vertex.glsl),o=W8(this.rawVertexGLSL,a),l=function(x){var E=n.getActiveAttrib(c.gl_program,x),C=E.name,I=E.type,P=E.size,B=n.getAttribLocation(c.gl_program,C),U=(t=o.find(function(ee){return ee.name===C}))===null||t===void 0?void 0:t.location;B>=0&&!ff(U)&&(c.attributes[U]={name:C,location:B,type:I,size:P})},c=this,h=0;h<i;h++)l(h)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),o=B8(a.name).name,l=t.getUniformLocation(this.gl_program,o);if(this.uniformSetters[o]=GC(t,l,a),a&&a.size>1)for(var c=0;c<a.size;c++)l=t.getUniformLocation(this.gl_program,"".concat(o,"[").concat(c,"]")),this.uniformSetters["".concat(o,"[").concat(c,"]")]=GC(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!oi(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var o=t[a],l=this.uniformSetters[a];if(l){var c=o;c instanceof eb&&(c=c.textureIndex),l(c)}}}return this},r}(Zf),aj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.QueryPool;var l=o.device.gl;if(oi(l)){var c=a.elemCount,h=a.type;o.gl_query=_8(c,function(){return o.device.ensureResourceExists(l.createQuery())}),o.gl_query_type=J8(h)}return o}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(oi(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(oi(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(Zf),oj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=Fa.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(o,l){function c(){var h=a.clientWaitSync(t,n,0);if(h==a.WAIT_FAILED){l();return}if(h==a.TIMEOUT_EXPIRED){setTimeout(c,h8(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}o()}c()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,o,l){return Object(Wn.b)(this,void 0,void 0,function(){var c;return Object(Wn.d)(this,function(h){switch(h.label){case 0:return c=this.device.gl,oi(c)?(this.gl_sync=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0),c.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return h.sent(),c.bindBuffer(t,n),c.getBufferSubData(t,i,a,o,l),c.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,o,l,c,h){return c===void 0&&(c=0),h===void 0&&(h=l.byteLength||0),Object(Wn.b)(this,void 0,void 0,function(){var _,x,E,C,I;return Object(Wn.d)(this,function(P){return _=this.device.gl,x=t,E=this.device.translateTextureFormat(x.format),C=this.device.translateTextureType(x.format),I=d8(x.format),oi(_)?(this.gl_pbo=this.device.ensureResourceExists(_.createBuffer()),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.bufferData(_.PIXEL_PACK_BUFFER,h,_.STREAM_READ),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),_.bindFramebuffer(at.READ_FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(at.READ_FRAMEBUFFER,at.COLOR_ATTACHMENT0,at.TEXTURE_2D,x.gl_texture,0),_.bindBuffer(_.PIXEL_PACK_BUFFER,this.gl_pbo),_.readPixels(n,i,a,o,E,C,c*I),_.bindBuffer(_.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(_.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,c,0)]):[2,this.readTextureSync(t,n,i,a,o,l,c,h)]})})},r.prototype.readTextureSync=function(t,n,i,a,o,l,c,h){h===void 0&&(h=l.byteLength||0);var _=this.device.gl,x=t,E=this.device.translateTextureType(x.format);return _.bindFramebuffer(at.FRAMEBUFFER,this.device.readbackFramebuffer),_.framebufferTexture2D(at.FRAMEBUFFER,at.COLOR_ATTACHMENT0,at.TEXTURE_2D,x.gl_texture,0),_.pixelStorei(_.PACK_ALIGNMENT,4),_.readPixels(n,i,a,o,_.RGBA,E,l),l},r.prototype.readBuffer=function(t,n,i,a,o){return Object(Wn.b)(this,void 0,void 0,function(){var l;return Object(Wn.d)(this,function(c){return l=this.device.gl,oi(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Em(t,n),n,i,a,o)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),oi(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(Zf),sj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;return c.type=Fa.RenderPipeline,c.drawMode=$8((o=a.topology)!==null&&o!==void 0?o:Is.TRIANGLES),c.program=a.program,c.inputLayout=a.inputLayout,c.megaState=Object(Wn.a)(Object(Wn.a)({},bm(fv)),a.megaStateDescriptor),c.colorAttachmentFormats=a.colorAttachmentFormats.slice(),c.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,c.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,c}return r}(Zf),uj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Fa.ComputePipeline,o.descriptor=a,o}return r}(Zf),lj=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=Object(Wn.i)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(o){r={error:o}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),cj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;c.type=Fa.Sampler;var h=c.device.gl;if(oi(h)){var _=c.device.ensureResourceExists(h.createSampler());h.samplerParameteri(_,at.TEXTURE_WRAP_S,Zg(a.addressModeU)),h.samplerParameteri(_,at.TEXTURE_WRAP_T,Zg(a.addressModeV)),h.samplerParameteri(_,at.TEXTURE_WRAP_R,Zg((o=a.addressModeW)!==null&&o!==void 0?o:a.addressModeU)),h.samplerParameteri(_,at.TEXTURE_MIN_FILTER,B0(a.minFilter,a.mipmapFilter)),h.samplerParameteri(_,at.TEXTURE_MAG_FILTER,B0(a.magFilter,lu.NO_MIP)),a.lodMinClamp!==void 0&&h.samplerParameterf(_,at.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&h.samplerParameterf(_,at.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(h.samplerParameteri(_,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE),h.samplerParameteri(_,h.TEXTURE_COMPARE_FUNC,a.compareFunction));var x=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;x>1&&c.device.EXT_texture_filter_anisotropic!==null&&(Ki(a.minFilter===Ps.BILINEAR&&a.magFilter===Ps.BILINEAR&&a.mipmapFilter===lu.LINEAR),h.samplerParameterf(_,c.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x)),c.gl_sampler=_}else c.descriptor=a;return c}return r.prototype.setTextureParameters=function(t,n,i){var a,o=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?o.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,at.LINEAR):o.texParameteri(t,at.TEXTURE_MIN_FILTER,B0(l.minFilter,l.mipmapFilter)),o.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_S,Zg(l.addressModeU)),o.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_T,Zg(l.addressModeV)),o.texParameteri(t,at.TEXTURE_MAG_FILTER,B0(l.magFilter,lu.NO_MIP));var c=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;c>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Ki(l.minFilter===Ps.BILINEAR&&l.magFilter===Ps.BILINEAR&&l.mipmapFilter===lu.LINEAR),o.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c))},r.prototype.destroy=function(){e.prototype.destroy.call(this),oi(this.device.gl)&&this.device.gl.deleteSampler(Q1(this))},r.prototype.isNPOT=function(t,n){return!P0(t)||!P0(n)},r}(Zf),fj=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),qC=65536,hj=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,pj=function(){function e(r,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=bm(fv),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=vm.LOWER_LEFT,this.clipSpaceNearZ=mm.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=cv(r.getContextAttributes()),oi(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),oi(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new eb({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:sa.TEXTURE_2D,mipLevelCount:1,usage:Tc.RENDER_TARGET,format:this.contextAttributes.alpha===!1?Vt.U8_RGB_RT:Vt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=ts.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(sa.TEXTURE_2D,ts.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(sa.TEXTURE_2D,ts.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:go.VERTEX,hint:Xf.STATIC}),oi(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(sa.TEXTURE_2D_ARRAY,ts.Float),this.fallbackTexture3D=this.createFallbackTexture(sa.TEXTURE_3D,ts.Float),this.fallbackTextureCube=this.createFallbackTexture(sa.TEXTURE_CUBE_MAP,ts.Float)),this.currentMegaState.depthCompare=Ra.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=zu.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new lj)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===sa.TEXTURE_CUBE_MAP?6:1,i=t===ts.Depth?Vt.D32F:Vt.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:Tc.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===ts.Float&&a.setImageData([new Uint8Array(4*n)]),Sm(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(at.MAX_VERTEX_ATTRIBS),oi(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(at.MAX_UNIFORM_BLOCK_SIZE),qC),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?Object(Wn.h)([],Object(Wn.e)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=qC;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=g8(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case Vt.ALPHA:return at.ALPHA;case Vt.U8_LUMINANCE:case Vt.F16_LUMINANCE:case Vt.F32_LUMINANCE:return at.LUMINANCE;case Vt.F16_R:return at.R16F;case Vt.F16_RG:return at.RG16F;case Vt.F16_RGB:return at.RGB16F;case Vt.F16_RGBA:return at.RGBA16F;case Vt.F32_R:return at.R32F;case Vt.F32_RG:return at.RG32F;case Vt.F32_RGB:return at.RGB32F;case Vt.F32_RGBA:return oi(this.gl)?at.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:at.RGBA;case Vt.U8_R_NORM:return at.R8;case Vt.U8_RG_NORM:return at.RG8;case Vt.U8_RGB_NORM:case Vt.U8_RGB_RT:return at.RGB8;case Vt.U8_RGB_SRGB:return at.SRGB8;case Vt.U8_RGBA_NORM:case Vt.U8_RGBA_RT:return oi(this.gl)?at.RGBA8:t?at.RGBA4:at.RGBA;case Vt.U8_RGBA:return at.RGBA;case Vt.U8_RGBA_SRGB:case Vt.U8_RGBA_RT_SRGB:return at.SRGB8_ALPHA8;case Vt.U16_R:return at.R16UI;case Vt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case Vt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case Vt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case Vt.U16_RGBA_5551:return at.RGB5_A1;case Vt.U16_RGB_565:return at.RGB565;case Vt.U32_R:return at.R32UI;case Vt.S8_RGBA_NORM:return at.RGBA8_SNORM;case Vt.S8_RG_NORM:return at.RG8_SNORM;case Vt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case Vt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case Vt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case Vt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case Vt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case Vt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case Vt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case Vt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case Vt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case Vt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case Vt.D32F_S8:return oi(this.gl)?at.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?at.DEPTH_STENCIL:at.DEPTH_COMPONENT16;case Vt.D24_S8:return oi(this.gl)?at.DEPTH24_STENCIL8:this.WEBGL_depth_texture?at.DEPTH_STENCIL:at.DEPTH_COMPONENT16;case Vt.D32F:return oi(this.gl)?at.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?at.DEPTH_COMPONENT:at.DEPTH_COMPONENT16;case Vt.D24:return oi(this.gl)?at.DEPTH_COMPONENT24:this.WEBGL_depth_texture?at.DEPTH_COMPONENT:at.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=Rh(r);switch(t){case Vr.U8:return at.UNSIGNED_BYTE;case Vr.U16:return at.UNSIGNED_SHORT;case Vr.U32:return at.UNSIGNED_INT;case Vr.S8:return at.BYTE;case Vr.F16:return at.HALF_FLOAT;case Vr.F32:return at.FLOAT;case Vr.U16_PACKED_5551:return at.UNSIGNED_SHORT_5_5_5_1;case Vr.D32F:return oi(this.gl)?at.FLOAT:this.WEBGL_depth_texture?at.UNSIGNED_INT:at.UNSIGNED_BYTE;case Vr.D24:return oi(this.gl)?at.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?at.UNSIGNED_SHORT:at.UNSIGNED_BYTE;case Vr.D24S8:return oi(this.gl)?at.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?at.UNSIGNED_INT_24_8_WEBGL:at.UNSIGNED_BYTE;case Vr.D32FS8:return at.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateTextureFormat=function(r){if(ZC(r)||r===Vt.F32_LUMINANCE||r===Vt.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=oi(this.gl)||!oi(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case Vt.D24_S8:case Vt.D32F_S8:return t?at.DEPTH_STENCIL:at.RGBA;case Vt.D24:case Vt.D32F:return t?at.DEPTH_COMPONENT:at.RGBA}var n=$C(r),i=R0(r);switch(i){case li.A:return at.ALPHA;case li.R:return n?at.RED_INTEGER:at.RED;case li.RG:return n?at.RG_INTEGER:at.RG;case li.RGB:return n?at.RGB_INTEGER:at.RGB;case li.RGBA:return at.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(oi(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Ki(r.compileState!==ic.NeedsCompile),r.compileState===ic.Compiling&&(r.compileState=ic.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new tj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new eb({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new cj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new nj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,o=t.mipLevelCount;return Ki(o===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return((n=r.vertex)===null||n===void 0?void 0:n.glsl)&&(r.vertex.glsl=ad(this.queryVendorInfo(),"vert",r.vertex.glsl)),((i=r.fragment)===null||i===void 0?void 0:i.glsl)&&(r.fragment.glsl=ad(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new ij({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new X8({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new rj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new sj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new fj},e.prototype.createComputePipeline=function(r){return new uj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new oj({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new aj({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,o,l,c=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var h=0;h<c.length;h++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[h]=(i=r.colorAttachmentLevel[h])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[h]=(a=r.colorResolveToLevel[h])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[h]=(o=r.colorClearColor[h])!==null&&o!==void 0?o:"load",r.colorStore||(r.colorStore=[]),r.colorStore[h]=(l=r.colorStore[h])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,o=r.colorResolveToLevel,l=r.depthStencilAttachment,c=r.depthClearValue,h=r.stencilClearValue,_=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var x=0;x<t.length;x++)this.setRenderPassParametersColor(x,t[x],n[x],a[x],o[x]);this.setRenderPassParametersDepthStencil(l,_),this.validateCurrentAttachments();for(var x=0;x<t.length;x++){var E=i[x];E!=="load"&&this.setRenderPassParametersClearColor(x,E.r,E.g,E.b,E.a)}return this.setRenderPassParametersClearDepthStencil(c,h),this},e.prototype.submitPass=function(r){Ki(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,o){var l=this.gl,c=r,h=i;if(Ki(h.mipLevelCount===1),Ki(c.mipLevelCount===1),oi(l))c===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,c,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,h,0),l.blitFramebuffer(a,o,a+h.width,o+h.height,t,n,t+h.width,n+h.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(c===this.scTexture){var _=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(_,c)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case Vt.BC1_SRGB:case Vt.BC2_SRGB:case Vt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?J1(t,n,4,4):!1;case Vt.BC1:case Vt.BC2:case Vt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?J1(t,n,4,4):!1;case Vt.BC4_UNORM:case Vt.BC4_SNORM:case Vt.BC5_UNORM:case Vt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?J1(t,n,4,4):!1;case Vt.U16_R_NORM:case Vt.U16_RG_NORM:case Vt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case Vt.F32_R:case Vt.F32_RG:case Vt.F32_RGB:case Vt.F32_RGBA:return this.OES_texture_float_linear!==null;case Vt.F16_R:case Vt.F16_RG:case Vt.F16_RGB:case Vt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===ic.NeedsCompile)throw new Error("whoops");if(r.compileState===ic.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===ic.NeedsBind||r.compileState===ic.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===Fa.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)$g(n[i],"".concat(t," Page ").concat(i));else if(r.type===Fa.Texture)$g(Sm(r),t);else if(r.type===Fa.Sampler)$g(Q1(r),t);else if(r.type===Fa.RenderTarget){var a=r.gl_renderbuffer;a!==null&&$g(a,t)}else r.type===Fa.InputLayout&&$g(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Ki(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;oi(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Em(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(b8(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if(ff(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===Fa.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,at.TEXTURE_2D,Sm(n.texture),i);else if(n.type===Fa.Texture){var o=Sm(n);n.dimension===sa.TEXTURE_2D?a.framebufferTexture2D(r,t,at.TEXTURE_2D,o,i):oi(a)&&n.dimension===sa.TEXTURE_2D_ARRAY}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=ff(t)?Vn.Depth|Vn.Stencil:gm(t.format),a=!!(i&Vn.Depth),o=!!(i&Vn.Stencil);if(a&&o){var l=oi(this.gl)||!oi(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(Ki(r===a.sampleCount),Ki(t===a.width),Ki(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Ki(r===this.currentDepthStencilAttachment.sampleCount),Ki(t===this.currentDepthStencilAttachment.width),Ki(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(oi(t)?t.bindFramebuffer(at.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(at.FRAMEBUFFER,this.renderPassDrawFramebuffer),oi(t)?t.drawBuffers([at.COLOR_ATTACHMENT0,at.COLOR_ATTACHMENT1,at.COLOR_ATTACHMENT2,at.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([at.COLOR_ATTACHMENT0_WEBGL,at.COLOR_ATTACHMENT1_WEBGL,at.COLOR_ATTACHMENT2_WEBGL,at.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=oi(t)?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,a=oi(t)?at.COLOR_ATTACHMENT0:at.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,at.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,at.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var o=this.gl,l=oi(o);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,(l?at.COLOR_ATTACHMENT0:at.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(oi(n)?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var o=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==zu.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=zu.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==zu.ALL&&(o.colorMask(!0,!0,!0,!0),l.channelWriteMask=zu.ALL)}this.setScissorRectEnabled(!1),oi(o)?o.clearBufferfv(o.COLOR,r,[t,n,i,a]):(o.clearColor(t,n,i,a),o.clear(o.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Ki(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),oi(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Ki(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),oi(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t,n=this.gl,i=r,a=i.uniformBufferBindings,o=i.samplerBindings,l=i.bindingLayouts;Ki(0<l.bindingLayoutTables.length);var c=l.bindingLayoutTables[0];Ki(a.length>=c.numUniformBuffers),Ki(o.length>=c.numSamplers);for(var h=0;h<a.length;h++){var _=a[h];if(_.size!==0){var x=c.firstUniformBuffer+h,E=_.buffer,C=_.offset||0,I=_.size||E.byteSize;if(E!==this.currentUniformBuffers[x]||C!==this.currentUniformBufferByteOffsets[x]||I!==this.currentUniformBufferByteSizes[x]){var P=C%E.pageByteSize,B=E.gl_buffer_pages[C/E.pageByteSize|0];Ki(P+I<=E.pageByteSize),oi(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,x,B,P,I),this.currentUniformBuffers[x]=E,this.currentUniformBufferByteOffsets[x]=C,this.currentUniformBufferByteSizes[x]=I}}}for(var h=0;h<c.numSamplers;h++){var _=o[h],U=c.firstSampler+h,ee=_!==null&&_.sampler!==null?Q1(_.sampler):null,ie=_!==null&&_.texture!==null?Sm(_.texture):null;if(this.currentSamplers[U]!==ee&&(oi(n)&&n.bindSampler(U,ee),this.currentSamplers[U]=ee),this.currentTextures[U]!==ie){if(this.setActiveTexture(n.TEXTURE0+U),ie!==null){var _e=cv(_).texture,Oe=_e.gl_target,ke=_e.width,Ke=_e.height;_.texture.textureIndex=U,n.bindTexture(Oe,ie),oi(n)||(t=_.sampler)===null||t===void 0||t.setTextureParameters(Oe,ke,Ke),this.debugGroupStatisticsTextureBind()}else{var ot=Object(Wn.a)(Object(Wn.a)({},_),zC),Ot=ot.dimension,Zt=ot.formatKind,Oe=ej(Ot);n.bindTexture(Oe,this.getFallbackTexture(Object(Wn.a)({gl_target:Oe,formatKind:Zt},ot)))}this.currentTextures[U]=ie}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&zu.RED),!!(n.channelWriteMask&zu.GREEN),!!(n.channelWriteMask&zu.BLUE),!!(n.channelWriteMask&zu.ALPHA)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||o)&&(od(t.rgbBlendState)&&od(t.alphaBlendState)?a.enableiOES(r,i.BLEND):od(n.rgbBlendState)&&od(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),o&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&zu.RED),!!(t.channelWriteMask&zu.GREEN),!!(t.channelWriteMask&zu.BLUE),!!(t.channelWriteMask&zu.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(od(r.rgbBlendState)&&od(r.alphaBlendState)?n.enable(n.BLEND):od(t.rgbBlendState)&&od(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Ki(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(DC(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),FC(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!D0(n.stencilFront,r.stencilFront)){var a=r.stencilFront,o=a.passOp,l=a.failOp,c=a.depthFailOp,h=a.compare;(n.stencilFront.passOp!==o||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==c)&&(t.stencilOpSeparate(t.FRONT,l,c,o),n.stencilFront.passOp=o,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=c),n.stencilFront.compare!==h&&(this.setStencilReference(0),n.stencilFront.compare=h)}if(!D0(n.stencilBack,r.stencilBack)){var _=r.stencilBack,o=_.passOp,l=_.failOp,c=_.depthFailOp,h=_.compare;(n.stencilBack.passOp!==o||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==c)&&(t.stencilOpSeparate(t.BACK,l,c,o),n.stencilBack.passOp=o,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=c),n.stencilBack.compare!==h&&(this.setStencilReference(0),n.stencilBack.compare=h)}n.cullMode!==r.cullMode&&(n.cullMode===nc.NONE?t.enable(t.CULL_FACE):r.cullMode===nc.NONE&&t.disable(t.CULL_FACE),r.cullMode===nc.BACK?t.cullFace(t.BACK):r.cullMode===nc.FRONT?t.cullFace(t.FRONT):r.cullMode===nc.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Ki(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Ki(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===ic.NeedsBind){var n=this.gl,i=t.gl_program,a=t.descriptor,o=KC(a.vertex.glsl,hj);if(oi(n))for(var l=0;l<o.length;l++){var c=Object(Wn.e)(o[l],2),h=c[1],_=n.getUniformBlockIndex(i,h);_!==-1&&_!==4294967295&&n.uniformBlockBinding(i,_,l)}for(var x=KC(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<x.length;l++){var E=Object(Wn.e)(x[l],3),C=E[1],I=E[2],P=n.getUniformLocation(i,C);n.uniform1i(P,parseInt(I))}t.compileState=ic.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,o;if(r!==null){Ki(this.currentPipeline.inputLayout===r);var l=r;this.bindVAO(l.vao);for(var c=this.gl,h=0;h<l.vertexBufferDescriptors.length;h++){var _=l.vertexBufferDescriptors[h],x=_.arrayStride,E=_.attributes;try{for(var C=(i=void 0,Object(Wn.i)(E)),I=C.next();!I.done;I=C.next()){var P=I.value,B=P.shaderLocation,U=P.offset,ee=oi(c)?B:(o=l.program.attributes[B])===null||o===void 0?void 0:o.location;if(!ff(ee)){var ie=t[h];if(ie===null)continue;var _e=P.vertexFormat;c.bindBuffer(c.ARRAY_BUFFER,Em(ie.buffer));var Oe=(ie.offset||0)+U;c.vertexAttribPointer(ee,_e.size,_e.type,_e.normalized,x,Oe)}}}catch(Ke){i={error:Ke}}finally{try{I&&!I.done&&(a=C.return)&&a.call(C)}finally{if(i)throw i.error}}}if(Ki(n!==null==(l.indexBufferFormat!==null)),n!==null){var ke=n.buffer;Ki(ke.usage===go.INDEX),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,Em(ke)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Ki(this.currentPipeline.inputLayout===null),Ki(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,o=this.gl,l=this.currentPipeline;if(t){var c=[l.drawMode,n||0,r,t];oi(o)?o.drawArraysInstanced.apply(o,Object(Wn.h)([],Object(Wn.e)(c),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,Object(Wn.h)([],Object(Wn.e)(c),!1))}else o.drawArrays(l.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var o,l=this.gl,c=this.currentPipeline,h=cv(c.inputLayout),_=cv(this.currentIndexBufferByteOffset)+n*h.indexBufferCompByteSize;if(t){var x=[c.drawMode,r,h.indexBufferType,_,t];oi(l)?l.drawElementsInstanced.apply(l,Object(Wn.h)([],Object(Wn.e)(x),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,Object(Wn.h)([],Object(Wn.e)(x),!1))}else l.drawElements(c.drawMode,r,h.indexBufferType,_);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(oi(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(oi(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=oi(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var o=this.currentColorResolveTos[i],l=!1;o!==null&&(Ki(a.width===o.width&&a.height===o.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,o===this.scTexture?r.bindFramebuffer(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,o.width,o.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,o),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var c=this.currentDepthStencilAttachment;if(c){var h=this.currentDepthStencilResolveTo,l=!1;h&&(Ki(c.width===h.width&&c.height===h.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,c),this.bindFramebufferDepthStencilAttachment(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,h)),l=!0,t&&r.blitFramebuffer(0,0,c.width,c.height,0,0,h.width,h.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,c),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?at.READ_FRAMEBUFFER:at.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?at.DRAW_FRAMEBUFFER:at.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){ff(this.currentStencilRef)||(this.gl.stencilFuncSeparate(at.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(at.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===at.TEXTURE_2D)return n===ts.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===at.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===at.TEXTURE_3D)return this.fallbackTexture3D;if(t===at.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:go.VERTEX|go.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:lv.VERTEX,attributes:[{format:Vt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:Is.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[Vt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:bm(fv)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[v8]}),a=this.getCanvas(),o=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,o,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),dj=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return Object(Wn.b)(this,void 0,void 0,function(){var t,n,i,a,o,l,c,h,_,x,E;return Object(Wn.d)(this,function(C){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,o=a===void 0?!1:a,l=t.preserveDrawingBuffer,c=l===void 0?!1:l,h=t.premultipliedAlpha,_=h===void 0?!0:h,x={antialias:o,preserveDrawingBuffer:c,stencil:!0,premultipliedAlpha:_,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(E=r.getContext("webgl2",x)||r.getContext("experimental-webgl2",x)),!E&&n.includes("webgl1")&&(E=r.getContext("webgl",x)||r.getContext("experimental-webgl",x)),[2,new pj(E,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}(),ks,QC=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&QC.decode();var Yg=null;function L0(){return(Yg===null||Yg.byteLength===0)&&(Yg=new Uint8Array(ks.memory.buffer)),Yg}function N0(e,r){return e=e>>>0,QC.decode(L0().subarray(e,e+r))}var hp=new Array(128).fill(void 0);hp.push(void 0,null,!0,!1);var Kg=hp.length;function vj(e){Kg===hp.length&&hp.push(hp.length+1);var r=Kg;return Kg=hp[r],hp[r]=e,r}function j0(e){return hp[e]}function mj(e){e<132||(hp[e]=Kg,Kg=e)}function gj(e){var r=j0(e);return mj(e),r}var qg=0,z0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},yj=typeof z0.encodeInto=="function"?function(e,r){return z0.encodeInto(e,r)}:function(e,r){var t=z0.encode(e);return r.set(t),{read:e.length,written:t.length}};function tb(e,r,t){if(t===void 0){var n=z0.encode(e),i=r(n.length,1)>>>0;return L0().subarray(i,i+n.length).set(n),qg=n.length,i}for(var a=e.length,o=r(a,1)>>>0,l=L0(),c=0;c<a;c++){var h=e.charCodeAt(c);if(h>127)break;l[o+c]=h}if(c!==a){c!==0&&(e=e.slice(c)),o=t(o,a,a=c+e.length*3,1)>>>0;var _=L0().subarray(o+c,o+a),x=yj(e,_);c+=x.written}return qg=c,o}var Qg=null;function U0(){return(Qg===null||Qg.byteLength===0)&&(Qg=new Int32Array(ks.memory.buffer)),Qg}function _j(e,r,t){var n,i;try{var a=ks.__wbindgen_add_to_stack_pointer(-16),o=tb(e,ks.__wbindgen_malloc,ks.__wbindgen_realloc),l=qg,c=tb(r,ks.__wbindgen_malloc,ks.__wbindgen_realloc),h=qg;ks.glsl_compile(a,o,l,c,h,t);var _=U0()[a/4+0],x=U0()[a/4+1];return n=_,i=x,N0(_,x)}finally{ks.__wbindgen_add_to_stack_pointer(16),ks.__wbindgen_free(n,i,1)}}var JC=function(){function e(){Object(st.a)(this,e);var r=ks.wgslcomposer_new();return e.__wrap(r)}return Object(Dt.a)(e,[{key:"__destroy_into_raw",value:function(){var t=this.__wbg_ptr;return this.__wbg_ptr=0,t}},{key:"free",value:function(){var t=this.__destroy_into_raw();ks.__wbg_wgslcomposer_free(t)}},{key:"wgsl_compile",value:function(t){var n,i;try{var a=ks.__wbindgen_add_to_stack_pointer(-16),o=tb(t,ks.__wbindgen_malloc,ks.__wbindgen_realloc),l=qg;ks.wgslcomposer_wgsl_compile(a,this.__wbg_ptr,o,l);var c=U0()[a/4+0],h=U0()[a/4+1];return n=c,i=h,N0(c,h)}finally{ks.__wbindgen_add_to_stack_pointer(16),ks.__wbindgen_free(n,i,1)}}}],[{key:"__wrap",value:function(t){t=t>>>0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function bj(e,r){return rb.apply(this,arguments)}function rb(){return rb=Object(Nn.a)(gn.a.mark(function e(r,t){var n,i;return gn.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(typeof Response=="function"&&r instanceof Response)){o.next=23;break}if(typeof WebAssembly.instantiateStreaming!="function"){o.next=15;break}return o.prev=2,o.next=5,WebAssembly.instantiateStreaming(r,t);case 5:return o.abrupt("return",o.sent);case 8:if(o.prev=8,o.t0=o.catch(2),r.headers.get("Content-Type")=="application/wasm"){o.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o.t0),o.next=15;break;case 14:throw o.t0;case 15:return o.next=17,r.arrayBuffer();case 17:return n=o.sent,o.next=20,WebAssembly.instantiate(n,t);case 20:return o.abrupt("return",o.sent);case 23:return o.next=25,WebAssembly.instantiate(r,t);case 25:if(i=o.sent,!(i instanceof WebAssembly.Instance)){o.next=30;break}return o.abrupt("return",{instance:i,module:r});case 30:return o.abrupt("return",i);case 31:case"end":return o.stop()}},e,null,[[2,8]])})),rb.apply(this,arguments)}function xj(){var e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){var n=N0(r,t);return vj(n)},e.wbg.__wbindgen_object_drop_ref=function(r){gj(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(j0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(j0(r),j0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(N0(r,t))},e}function Ej(e,r){return ks=e.exports,ew.__wbindgen_wasm_module=r,Qg=null,Yg=null,ks}function ew(e){return nb.apply(this,arguments)}function nb(){return nb=Object(Nn.a)(gn.a.mark(function e(r){var t,n,i,a;return gn.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(ks===void 0){l.next=2;break}return l.abrupt("return",ks);case 2:return t=xj(),(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r)),l.t0=bj,l.next=7,r;case 7:return l.t1=l.sent,l.t2=t,l.next=11,(0,l.t0)(l.t1,l.t2);case 11:return n=l.sent,i=n.instance,a=n.module,l.abrupt("return",Ej(i,a));case 15:case"end":return l.stop()}},e)})),nb.apply(this,arguments)}var wl;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(wl||(wl={}));var ib;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(ib||(ib={}));function Sj(e){var r=0;return e&Tc.SAMPLED&&(r|=wl.TEXTURE_BINDING|wl.COPY_DST),e&Tc.RENDER_TARGET&&(r|=wl.RENDER_ATTACHMENT|wl.TEXTURE_BINDING|wl.COPY_SRC|wl.COPY_DST),r}function ab(e){if(e===Vt.U8_R_NORM)return"r8unorm";if(e===Vt.U8_RG_NORM)return"rg8unorm";if(e===Vt.U8_RGBA_RT)return"bgra8unorm";if(e===Vt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===Vt.U8_RGBA_NORM)return"rgba8unorm";if(e===Vt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===Vt.S8_R_NORM)return"r8snorm";if(e===Vt.S8_RG_NORM)return"rg8snorm";if(e===Vt.S8_RGBA_NORM)return"rgba8snorm";if(e===Vt.U32_R)return"r32uint";if(e===Vt.F16_RGBA)return"rgba16float";if(e===Vt.F32_RGBA)return"rgba32float";if(e===Vt.D24)return"depth24plus";if(e===Vt.D24_S8)return"depth24plus-stencil8";if(e===Vt.D32F)return"depth32float";if(e===Vt.D32F_S8)return"depth32float-stencil8";if(e===Vt.BC1)return"bc1-rgba-unorm";if(e===Vt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===Vt.BC2)return"bc2-rgba-unorm";if(e===Vt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===Vt.BC3)return"bc3-rgba-unorm";if(e===Vt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===Vt.BC4_SNORM)return"bc4-r-snorm";if(e===Vt.BC4_UNORM)return"bc4-r-unorm";if(e===Vt.BC5_SNORM)return"bc5-rg-snorm";if(e===Vt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function Aj(e){if(e===sa.TEXTURE_2D)return"2d";if(e===sa.TEXTURE_CUBE_MAP)return"2d";if(e===sa.TEXTURE_2D_ARRAY)return"2d";if(e===sa.TEXTURE_3D)return"3d";throw new Error("whoops")}function Tj(e){if(e===sa.TEXTURE_2D)return"2d";if(e===sa.TEXTURE_CUBE_MAP)return"cube";if(e===sa.TEXTURE_2D_ARRAY)return"2d-array";if(e===sa.TEXTURE_3D)return"3d";throw new Error("whoops")}function Cj(e){var r=0;return e&go.INDEX&&(r|=GPUBufferUsage.INDEX),e&go.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&go.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&go.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&go.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),r|=GPUBufferUsage.COPY_DST,r}function ob(e){if(e===Tl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===Tl.REPEAT)return"repeat";if(e===Tl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function tw(e){if(e===Ps.BILINEAR)return"linear";if(e===Ps.POINT)return"nearest";throw new Error("whoops")}function wj(e){if(e===lu.LINEAR)return"linear";if(e===lu.NEAREST)return"nearest";if(e===lu.NO_MIP)return"nearest";throw new Error("whoops")}function Am(e){var r=e;return r.gpuBuffer}function Oj(e){var r=e;return r.gpuSampler}function Rj(e){var r=e;return r.querySet}function Mj(e){if(e===O0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function Pj(e){switch(e){case Is.TRIANGLES:return"triangle-list";case Is.POINTS:return"point-list";case Is.TRIANGLE_STRIP:return"triangle-strip";case Is.LINES:return"line-list";case Is.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function Ij(e){if(e===nc.NONE)return"none";if(e===nc.FRONT)return"front";if(e===nc.BACK)return"back";throw new Error("whoops")}function kj(e){if(e===Wg.CCW)return"ccw";if(e===Wg.CW)return"cw";throw new Error("whoops")}function Dj(e,r){return{topology:Pj(e),cullMode:Ij(r.cullMode),frontFace:kj(r.frontFace)}}function rw(e){if(e===ya.ZERO)return"zero";if(e===ya.ONE)return"one";if(e===ya.SRC)return"src";if(e===ya.ONE_MINUS_SRC)return"one-minus-src";if(e===ya.DST)return"dst";if(e===ya.ONE_MINUS_DST)return"one-minus-dst";if(e===ya.SRC_ALPHA)return"src-alpha";if(e===ya.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===ya.DST_ALPHA)return"dst-alpha";if(e===ya.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===ya.CONST)return"constant";if(e===ya.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===ya.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Fj(e){if(e===ju.ADD)return"add";if(e===ju.SUBSTRACT)return"subtract";if(e===ju.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===ju.MIN)return"min";if(e===ju.MAX)return"max";throw new Error("whoops")}function nw(e){return{operation:Fj(e.blendMode),srcFactor:rw(e.blendSrcFactor),dstFactor:rw(e.blendDstFactor)}}function iw(e){return e.blendMode===ju.ADD&&e.blendSrcFactor===ya.ONE&&e.blendDstFactor===ya.ZERO}function Bj(e){if(!(iw(e.rgbBlendState)&&iw(e.alphaBlendState)))return{color:nw(e.rgbBlendState),alpha:nw(e.alphaBlendState)}}function Lj(e,r){return{format:ab(r),blend:Bj(e),writeMask:e.channelWriteMask}}function Nj(e,r){return r.attachmentsState.map(function(t,n){return Lj(t,e[n])})}function V0(e){if(e===Ra.NEVER)return"never";if(e===Ra.LESS)return"less";if(e===Ra.EQUAL)return"equal";if(e===Ra.LEQUAL)return"less-equal";if(e===Ra.GREATER)return"greater";if(e===Ra.NOTEQUAL)return"not-equal";if(e===Ra.GEQUAL)return"greater-equal";if(e===Ra.ALWAYS)return"always";throw new Error("whoops")}function Tm(e){if(e===nl.KEEP)return"keep";if(e===nl.REPLACE)return"replace";if(e===nl.ZERO)return"zero";if(e===nl.DECREMENT_CLAMP)return"decrement-clamp";if(e===nl.DECREMENT_WRAP)return"decrement-wrap";if(e===nl.INCREMENT_CLAMP)return"increment-clamp";if(e===nl.INCREMENT_WRAP)return"increment-wrap";if(e===nl.INVERT)return"invert";throw new Error("whoops")}function jj(e,r){if(!ff(e))return{format:ab(e),depthWriteEnabled:!!r.depthWrite,depthCompare:V0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:V0(r.stencilFront.compare),passOp:Tm(r.stencilFront.passOp),failOp:Tm(r.stencilFront.failOp),depthFailOp:Tm(r.stencilFront.depthFailOp)},stencilBack:{compare:V0(r.stencilBack.compare),passOp:Tm(r.stencilBack.passOp),failOp:Tm(r.stencilBack.failOp),depthFailOp:Tm(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function zj(e){if(e!==null){if(e===Vt.U16_R)return"uint16";if(e===Vt.U32_R)return"uint32";throw new Error("whoops")}}function Uj(e){if(e===lv.VERTEX)return"vertex";if(e===lv.INSTANCE)return"instance";throw new Error("whoops")}function Vj(e){if(e===Vt.U8_R)return"uint8x2";if(e===Vt.U8_RG)return"uint8x2";if(e===Vt.U8_RGB)return"uint8x4";if(e===Vt.U8_RGBA)return"uint8x4";if(e===Vt.U8_RG_NORM)return"unorm8x2";if(e===Vt.U8_RGBA_NORM)return"unorm8x4";if(e===Vt.S8_RGB_NORM)return"snorm8x4";if(e===Vt.S8_RGBA_NORM)return"snorm8x4";if(e===Vt.U16_RG_NORM)return"unorm16x2";if(e===Vt.U16_RGBA_NORM)return"unorm16x4";if(e===Vt.S16_RG_NORM)return"snorm16x2";if(e===Vt.S16_RGBA_NORM)return"snorm16x4";if(e===Vt.S16_RG)return"uint16x2";if(e===Vt.F16_RG)return"float16x2";if(e===Vt.F16_RGBA)return"float16x4";if(e===Vt.F32_R)return"float32";if(e===Vt.F32_RG)return"float32x2";if(e===Vt.F32_RGB)return"float32x3";if(e===Vt.F32_RGBA)return"float32x4";throw"whoops"}function Hj(e){var r=Rh(e);switch(r){case Vr.BC1:case Vr.BC2:case Vr.BC3:case Vr.BC4_SNORM:case Vr.BC4_UNORM:case Vr.BC5_SNORM:case Vr.BC5_UNORM:return!0;default:return!1}}function Wj(e){var r=Rh(e);switch(r){case Vr.BC1:case Vr.BC2:case Vr.BC3:case Vr.BC4_SNORM:case Vr.BC4_UNORM:case Vr.BC5_SNORM:case Vr.BC5_UNORM:return 4;default:return 1}}function aw(e,r,t,n){switch(t===void 0&&(t=!1),e){case Vt.S8_R:case Vt.S8_R_NORM:case Vt.S8_RG_NORM:case Vt.S8_RGB_NORM:case Vt.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case Vt.U8_R:case Vt.U8_R_NORM:case Vt.U8_RG:case Vt.U8_RG_NORM:case Vt.U8_RGB:case Vt.U8_RGB_NORM:case Vt.U8_RGB_SRGB:case Vt.U8_RGBA:case Vt.U8_RGBA_NORM:case Vt.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case Vt.S16_R:case Vt.S16_RG:case Vt.S16_RG_NORM:case Vt.S16_RGB_NORM:case Vt.S16_RGBA:case Vt.S16_RGBA_NORM:{var o=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&o.set(new Int16Array(n)),o}case Vt.U16_R:case Vt.U16_RGB:case Vt.U16_RGBA_5551:case Vt.U16_RGBA_NORM:case Vt.U16_RG_NORM:case Vt.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case Vt.S32_R:{var c=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&c.set(new Int32Array(n)),c}case Vt.U32_R:case Vt.U32_RG:{var h=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&h.set(new Uint32Array(n)),h}case Vt.F32_R:case Vt.F32_RG:case Vt.F32_RGB:case Vt.F32_RGBA:{var _=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&_.set(new Float32Array(n)),_}}var x=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&x.set(new Uint8Array(n)),x}function Gj(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*Infinity:(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}var Mh=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(OC.a),Xj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.Bindings;var l=a.pipeline;Ki(!!l);var c=a.uniformBufferBindings,h=a.storageBufferBindings,_=a.samplerBindings;o.numUniformBuffers=(c==null?void 0:c.length)||0;var x=[[],[]],E=0;if(h&&h.length)for(var C=0;C<h.length;C++){var I=a.storageBufferBindings[C],P=I.binding,B=I.size,U=I.offset,ee=I.buffer,ie={buffer:Am(ee),offset:U!=null?U:0,size:B};x[0].push({binding:P!=null?P:E++,resource:ie})}if(c&&c.length)for(var C=0;C<c.length;C++){var _e=a.uniformBufferBindings[C],P=_e.binding,B=_e.size,U=_e.offset,ee=_e.buffer,ie={buffer:Am(ee),offset:U!=null?U:0,size:B};x[0].push({binding:P!=null?P:E++,resource:ie})}if(_&&_.length){E=0;for(var C=0;C<_.length;C++){var Oe=Object(Wn.a)(Object(Wn.a)({},_[C]),zC),P=a.samplerBindings[C],ke=P.texture!==null?P.texture:o.device.getFallbackTexture(Oe);Oe.dimension=ke.dimension,Oe.formatKind=kC(ke.format);var Ke=ke.gpuTextureView;x[1].push({binding:E++,resource:Ke});var ot=P.sampler!==null?P.sampler:o.device.getFallbackSampler(Oe),Ot=Oj(ot);x[1].push({binding:E++,resource:Ot})}}return o.gpuBindGroup=x.filter(function(Zt){return Zt.length>0}).map(function(Zt,ir){return o.device.device.createBindGroup({layout:l.getBindGroupLayout(ir),entries:Zt})}),o}return r}(Mh),Zj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.Buffer;var l=a.usage,c=a.viewOrSize,h=!!(l&go.MAP_READ);o.usage=Cj(l),h&&(o.usage=go.MAP_READ|go.COPY_DST);var _=!dm(c);if(o.view=dm(c)?null:c,o.size=dm(c)?I0(c,4):I0(c.byteLength,4),dm(c))o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:h?_:!1});else{o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0});var x=c&&c.constructor||Float32Array;new x(o.gpuBuffer.getMappedRange()).set(c),o.gpuBuffer.unmap()}return o}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var o=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,c=l+a,h=a+3&~3;if(h!==a){var _=new Uint8Array(n.buffer.slice(l,c));n=new Uint8Array(h),n.set(_),i=0,l=0,c=h,a=h}for(var x=1024*1024*15,E=0;c-(l+E)>x;)this.device.device.queue.writeBuffer(o,t+E,n.buffer,l+E,x),E+=x;this.device.device.queue.writeBuffer(o,t+E,n.buffer,l+E,a-E)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(Mh),$j=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){Ki(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=cv(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=r;this.gpuComputePassEncoder.setBindGroup(0,t.gpuBindGroup[0])},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),Yj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=a;var l=a.program,c=l.computeStage;if(c===null)return o;var h={layout:"auto",compute:Object(Wn.a)({},c)};return o.gpuComputePipeline=o.device.device.createComputePipeline(h),o.name!==void 0&&(o.gpuComputePipeline.label=o.name),o}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(Mh),Kj=function(e){Object(Wn.c)(r,e);function r(t){var n,i,a,o,l=t.id,c=t.device,h=t.descriptor,_=e.call(this,{id:l,device:c})||this;_.type=Fa.InputLayout;var x=[];try{for(var E=Object(Wn.i)(h.vertexBufferDescriptors),C=E.next();!C.done;C=E.next()){var I=C.value,P=I.arrayStride,B=I.stepMode,U=I.attributes;x.push({arrayStride:P,stepMode:Uj(B),attributes:[]});try{for(var ee=(a=void 0,Object(Wn.i)(U)),ie=ee.next();!ie.done;ie=ee.next()){var _e=ie.value,Oe=_e.shaderLocation,ke=_e.format,Ke=_e.offset;x[x.length-1].attributes.push({shaderLocation:Oe,format:Vj(ke),offset:Ke})}}catch(ot){a={error:ot}}finally{try{ie&&!ie.done&&(o=ee.return)&&o.call(ee)}finally{if(a)throw a.error}}}}catch(ot){n={error:ot}}finally{try{C&&!C.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}return _.indexFormat=zj(h.indexBufferFormat),_.buffers=x,_}return r}(Mh),ow=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Fa.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=a,a.vertex&&(o.vertexStage=o.createShaderStage(a.vertex,"vertex")),a.fragment&&(o.fragmentStage=o.createShaderStage(a.fragment,"fragment")),a.compute&&(o.computeStage=o.createShaderStage(a.compute,"compute")),o}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,o=t.glsl,l=t.wgsl,c=t.entryPoint,h=!1,_=l;if(!_)try{_=this.device.glsl_compile(o,n,h)}catch(B){throw console.error(B,o),new Error("whoops")}var x=function(U){if(!_.includes(U))return"continue";_=_.replace("var T_".concat(U,": texture_2d<f32>;"),"var T_".concat(U,": texture_depth_2d;")),_=_.replace(new RegExp("textureSample\\(T_".concat(U,"(.*)\\);$"),"gm"),function(ee,ie){return"vec4<f32>(textureSample(T_".concat(U).concat(ie,"), 0.0, 0.0, 0.0);")})};try{for(var E=Object(Wn.i)(["u_TextureFramebufferDepth"]),C=E.next();!C.done;C=E.next()){var I=C.value;x(I)}}catch(B){i={error:B}}finally{try{C&&!C.done&&(a=E.return)&&a.call(E)}finally{if(i)throw i.error}}var P=this.device.device.createShaderModule({code:_});return{module:P,entryPoint:c||"main"}},r}(Mh),qj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;o.type=Fa.QueryPool;var l=a.elemCount,c=a.type;return o.querySet=o.device.device.createQuerySet({type:Mj(c),count:l}),o.resolveBuffer=o.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(Mh),Qj=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=Fa.Readback,a}return r.prototype.readTexture=function(t,n,i,a,o,l,c,h){return c===void 0&&(c=0),Object(Wn.b)(this,void 0,void 0,function(){var _,x,E,C,I,P,B,U;return Object(Wn.d)(this,function(ee){return _=t,x=0,E=this.getBlockInformationFromFormat(_.gpuTextureformat),C=Math.ceil(a/E.width)*E.length,I=Math.ceil(C/256)*256,P=I*o,B=this.device.createBuffer({usage:go.STORAGE|go.MAP_READ|go.COPY_DST,hint:Xf.STATIC,viewOrSize:P}),U=this.device.device.createCommandEncoder(),U.copyTextureToBuffer({texture:_.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(x,0)}},{buffer:B.gpuBuffer,offset:0,bytesPerRow:I},{width:a,height:o,depthOrArrayLayers:1}),this.device.device.queue.submit([U.finish()]),[2,this.readBuffer(B,0,l.byteLength===P?l:null,c,P,_.format)]})})},r.prototype.readTextureSync=function(t,n,i,a,o,l,c,h){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,o,l,c,h){var _=this;n===void 0&&(n=0),i===void 0&&(i=null),o===void 0&&(o=0),l===void 0&&(l=Vt.U8_RGB),c===void 0&&(c=!1);var x=t,E=o||x.size,C=i||x.view,I=C&&C.constructor&&C.constructor.BYTES_PER_ELEMENT||IC(l),P=x;if(!(x.usage&go.MAP_READ&&x.usage&go.COPY_DST)){var B=this.device.device.createCommandEncoder();P=this.device.createBuffer({usage:go.STORAGE|go.MAP_READ|go.COPY_DST,hint:Xf.STATIC,viewOrSize:E}),B.copyBufferToBuffer(x.gpuBuffer,n,P.gpuBuffer,0,E),this.device.device.queue.submit([B.finish()])}return new Promise(function(U,ee){P.gpuBuffer.mapAsync(ib.READ,n,E).then(function(){var ie=P.gpuBuffer.getMappedRange(n,E),_e=C;if(c)_e===null?_e=aw(l,E,!0,ie):_e=aw(l,_e.buffer,void 0,ie);else if(_e===null)switch(I){case 1:_e=new Uint8Array(E),_e.set(new Uint8Array(ie));break;case 2:_e=_.getHalfFloatAsFloatRGBAArrayBuffer(E/2,ie);break;case 4:_e=new Float32Array(E/4),_e.set(new Float32Array(ie));break}else switch(I){case 1:_e=new Uint8Array(_e.buffer),_e.set(new Uint8Array(ie));break;case 2:_e=_.getHalfFloatAsFloatRGBAArrayBuffer(E/2,ie,C);break;case 4:var Oe=C&&C.constructor||Float32Array;_e=new Oe(_e.buffer),_e.set(new Oe(ie));break}P.gpuBuffer.unmap(),U(_e)},function(ie){return ee(ie)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=Gj(a[t]);return i},r.prototype.getBlockInformationFromFormat=function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},r}(Mh),Jj=function(){function e(r){this.device=r,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(r,t){return Ki(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,o,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var c=r.colorAttachment.length;this.gfxColorAttachment.length=c,this.gfxColorResolveTo.length=c;for(var h=0;h<r.colorAttachment.length;h++){var _=r.colorAttachment[h],x=r.colorResolveTo[h];if(_===null&&x!==null&&(_=x,x=null),this.gfxColorAttachment[h]=_,this.gfxColorResolveTo[h]=x,this.gfxColorAttachmentLevel[h]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[h])||0,this.gfxColorResolveToLevel[h]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[h])||0,_!==null){this.gpuColorAttachments[h]===void 0&&(this.gpuColorAttachments[h]={});var E=this.gpuColorAttachments[h];E.view=this.getTextureView(_,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[h])||0);var C=(o=(a=r.colorClearColor)===null||a===void 0?void 0:a[h])!==null&&o!==void 0?o:"load";C==="load"?E.loadOp="load":(E.loadOp="clear",E.clearValue=C),E.storeOp=((l=r.colorStore)===null||l===void 0?void 0:l[h])?"store":"discard",E.resolveTarget=void 0,x!==null&&(_.sampleCount>1?E.resolveTarget=this.getTextureView(x,this.gfxColorResolveToLevel[h]):E.storeOp="store")}else{this.gpuColorAttachments.length=h,this.gfxColorAttachment.length=h,this.gfxColorResolveTo.length=h;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var I=r.depthStencilAttachment,E=this.gpuDepthStencilAttachment;E.view=I.gpuTextureView;var P=!!(gm(I.format)&Vn.Depth);P?(r.depthClearValue==="load"?E.depthLoadOp="load":(E.depthLoadOp="clear",E.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?E.depthStoreOp="store":E.depthStoreOp="discard"):(E.depthLoadOp=void 0,E.depthStoreOp=void 0);var B=!!(gm(I.format)&Vn.Stencil);B?(r.stencilClearValue==="load"?E.stencilLoadOp="load":(E.stencilLoadOp="clear",E.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?E.stencilStoreOp="store":E.stencilStoreOp="discard"):(E.stencilLoadOp=void 0,E.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=ff(r.occlusionQueryPool)?void 0:Rj(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r){Ki(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,o){a===void 0&&(a=0),o===void 0&&(o=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,o)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=cv(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=r;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(Am(n.buffer),cv(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var o=t[a];o!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,Am(o.buffer),o.offset)}}},e.prototype.setBindings=function(r){var t=r;this.gpuRenderPassEncoder.setBindGroup(0,t.gpuBindGroup[0]),t.gpuBindGroup[1]&&this.gpuRenderPassEncoder.setBindGroup(1,t.gpuBindGroup[1])},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.gpuRenderPassEncoder.draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.gpuRenderPassEncoder.drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndirect(Am(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndexedIndirect(Am(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var t=this.gfxColorAttachment[r],n=this.gfxColorResolveTo[r];t!==null&&n!==null&&t.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[r],t,this.gfxColorResolveToLevel[r])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(r,t,n,i){Ki(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},o={texture:r.gpuTexture,mipLevel:t};Ki(n.width>>>i==r.width>>>t),Ki(n.height>>>i==r.height>>>t),Ki(!!(n.usage&wl.COPY_SRC)),Ki(!!(r.usage&wl.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,o,[r.width,r.height,1])},e}(),ez=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=e.call(this,{id:n,device:i})||this;return o.type=Fa.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=a,o.device.createRenderPipelineInternal(o,!1),o}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(Mh),tz=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o,l,c=e.call(this,{id:n,device:i})||this;c.type=Fa.Sampler;var h=a.lodMinClamp,_=a.mipmapFilter===lu.NO_MIP?a.lodMinClamp:a.lodMaxClamp,x=(o=a.maxAnisotropy)!==null&&o!==void 0?o:1;return x>1&&Ki(a.minFilter===Ps.BILINEAR&&a.magFilter===Ps.BILINEAR&&a.mipmapFilter===lu.LINEAR),c.gpuSampler=c.device.device.createSampler({addressModeU:ob(a.addressModeU),addressModeV:ob(a.addressModeV),addressModeW:ob((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:h,lodMaxClamp:_,minFilter:tw(a.minFilter),magFilter:tw(a.magFilter),mipmapFilter:wj(a.mipmapFilter),compare:a.compareFunction!==void 0?V0(a.compareFunction):void 0,maxAnisotropy:x}),c}return r}(Mh),H0=function(e){Object(Wn.c)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,o=t.skipCreate,l=t.sampleCount,c=e.call(this,{id:n,device:i})||this;c.type=Fa.Texture;var h=a.format,_=a.dimension,x=a.width,E=a.height,C=a.depthOrArrayLayers,I=a.mipLevelCount,P=a.usage;return c.device.createTextureShared({format:h,dimension:_!=null?_:sa.TEXTURE_2D,width:x,height:E,depthOrArrayLayers:C!=null?C:1,mipLevelCount:I!=null?I:1,usage:P,sampleCount:l!=null?l:1},c,o),c}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,o=n[0].height,l={size:{width:a,height:o,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},c=t.createTexture(l),h=0;h<n.length;h++)t.queue.copyExternalImageToTexture({source:n[h]},{texture:c,origin:[0,0,h]},[a,o]);return[c,a,o]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this.device.device,o,l,c;this.isImageBitmapOrCanvases(t)?(i=Object(Wn.e)(this.textureFromImageBitmapOrCanvas(a,t,this.depthOrArrayLayers),3),o=i[0],l=i[1],c=i[2]):this.isVideo(t)&&(o=a.importExternalTexture({source:t[0]})),this.width=l,this.height=c,this.gpuTexture=o,this.gpuTextureView=o.createView({dimension:Tj(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(Mh),rz=function(){function e(r,t,n,i,a,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=wl.RENDER_ATTACHMENT|wl.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=vm.UPPER_LEFT,this.clipSpaceNearZ=mm.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(sa.TEXTURE_2D,ts.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(sa.TEXTURE_2D,ts.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(sa.TEXTURE_2D_ARRAY,ts.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(sa.TEXTURE_3D,ts.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(sa.TEXTURE_CUBE_MAP,ts.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:Tl.REPEAT,addressModeV:Tl.REPEAT,minFilter:Ps.POINT,magFilter:Ps.POINT,mipmapFilter:lu.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:Tl.REPEAT,addressModeV:Tl.REPEAT,minFilter:Ps.POINT,magFilter:Ps.POINT,mipmapFilter:lu.NEAREST,compareFunction:Ra.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new H0({id:0,device:this,descriptor:{format:Vt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:sa.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new Zj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new H0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new tz({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new H0({id:this.getNextUniqueId(),device:this,descriptor:Object(Wn.a)(Object(Wn.a)({},r),{dimension:sa.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Tc.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=Fa.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,o=t.depthOrArrayLayers,l=t.sampleCount,c=t.mipLevelCount,h=t.gpuTexture,_=t.gpuTextureView,x=t.usage;Ki(!!(x&wl.RENDER_ATTACHMENT));var E=new H0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:o,dimension:sa.TEXTURE_2D,mipLevelCount:c,usage:x},skipCreate:!0});return E.depthOrArrayLayers=o,E.sampleCount=l,E.gpuTexture=h,E.gpuTextureView=_,E},e.prototype.createProgram=function(r){var t,n;return((t=r.vertex)===null||t===void 0?void 0:t.glsl)&&(r.vertex.glsl=ad(this.queryVendorInfo(),"vert",r.vertex.glsl)),((n=r.fragment)===null||n===void 0?void 0:n.glsl)&&(r.fragment.glsl=ad(this.queryVendorInfo(),"frag",r.fragment.glsl)),new ow({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new ow({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,o=ab(r.format),l=Aj(r.dimension),c=Sj(r.usage);if(t.gpuTextureformat=o,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=c,t.sampleCount=r.sampleCount,!n){var h=this.device.createTexture({size:i,mipLevelCount:a,format:o,dimension:l,sampleCount:r.sampleCount,usage:c}),_=h.createView();t.gpuTexture=h,t.gpuTextureView=_}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===ts.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===sa.TEXTURE_2D)return n===ts.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===sa.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===sa.TEXTURE_3D)return this.fallbackTexture3D;if(t===sa.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===sa.TEXTURE_CUBE_MAP?6:1,i=t===ts.Float?Vt.U8_RGBA_NORM:Vt.D24;return this.createTexture({dimension:r,format:i,usage:Tc.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new Xj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new Kj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new Yj({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new ez({id:this.getNextUniqueId(),device:this,descriptor:Object(Wn.a)({},r)})},e.prototype.createQueryPool=function(r,t){return new qj({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,o=a.vertexStage,l=a.fragmentStage;if(!(o===null||l===null)){var c=i.megaStateDescriptor||{},h=c.stencilBack,_=c.stencilFront,x=Object(Wn.f)(c,["stencilBack","stencilFront"]),E=bm(fv);i.megaStateDescriptor=Object(Wn.a)(Object(Wn.a)(Object(Wn.a)({},E),{stencilBack:Object(Wn.a)(Object(Wn.a)({},E.stencilBack),h),stencilFront:Object(Wn.a)(Object(Wn.a)({},E.stencilFront),_)}),x);var C=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(_e,Oe){i.megaStateDescriptor.attachmentsState[Oe]||(i.megaStateDescriptor.attachmentsState[Oe]=NC(void 0,C))});var I=Dj((n=i.topology)!==null&&n!==void 0?n:Is.TRIANGLES,i.megaStateDescriptor),P=Nj(i.colorAttachmentFormats,i.megaStateDescriptor),B=jj(i.depthStencilAttachmentFormat,i.megaStateDescriptor),U=void 0;i.inputLayout!==null&&(U=i.inputLayout.buffers);var ee=i.sampleCount,ie={layout:"auto",vertex:Object(Wn.a)(Object(Wn.a)({},o),{buffers:U}),primitive:I,depthStencil:B,multisample:{count:ee},fragment:Object(Wn.a)(Object(Wn.a)({},l),{targets:P})};r.gpuRenderPipeline=this.device.createRenderPipeline(ie)}}},e.prototype.createReadback=function(){return new Qj({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();return t===void 0&&(t=new Jj(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();return r===void 0&&(r=new $j),r.commandEncoder=this.device.createCommandEncoder(),r.beginComputePass(),r},e.prototype.submitPass=function(r){var t=this.device.queue,n=r,i=n.finish();t.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,o){var l=this.device.createCommandEncoder(),c=r,h=i,_={texture:h.gpuTexture,origin:[a,o,0]},x={texture:c.gpuTexture,origin:[t,n,0]};Ki(!!(h.usage&wl.COPY_SRC)),Ki(!!(c.usage&wl.COPY_DST)),l.copyTextureToTexture(_,x,[h.width,h.height,1]),this.device.queue.submit([l.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(Hj(r)){if(!this.featureTextureCompressionBC)return!1;var i=Wj(r);return t%i!=0||n%i!=0?!1:this.featureTextureCompressionBC}switch(r){case Vt.U16_RGBA_NORM:return!1;case Vt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===Fa.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===Fa.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===Fa.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===Fa.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===Fa.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),nz=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return Object(Wn.b)(this,void 0,void 0,function(){var t,n,i,a,o,l,c,h;return Object(Wn.d)(this,function(_){switch(_.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,_.label=1;case 1:return _.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=_.sent(),[3,4];case 3:return i=_.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],o=a.filter(function(x){return t.features.has(x)}),[4,t.requestDevice({requiredFeatures:o})]);case 5:if(l=_.sent(),l&&(c=this.pluginOptions.onContextLost,l.lost.then(function(){c&&c()})),l===null)return[2,null];if(h=r.getContext("webgpu"),!h)return[2,null];_.label=6;case 6:return _.trys.push([6,8,,9]),[4,ew(this.pluginOptions.shaderCompilerPath)];case 7:return _.sent(),[3,9];case 8:return _.sent(),[3,9];case 9:return[2,new rz(t,l,r,h,_j,JC&&new JC)]}})})},e}(),iz=xi.isPlainObject,az=xi.isTypedArray,oz=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"destroyed",!1),Object(L.a)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,o=t.uniforms,l=t.primitive,c=t.count,h=t.elements,_=t.depth,x=t.cull,E=t.instances,C={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:vm.LOWER_LEFT,clipSpaceNearZ:mm.NEGATIVE_ONE,supportMRT:!1},I={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(function(U){I[U]=r.prop(U)}));var P={};Object.keys(a).forEach(function(U){P[U]=a[U].get()});var B={attributes:P,frag:DE(ad(C,"frag",i,null,!1)),uniforms:I,vert:DE(ad(C,"vert",n,null,!1)),colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:K7[l===void 0?Z.TRIANGLES:l]};E&&(B.instances=E),c?B.count=c:h&&(B.elements=h.get()),this.initDepthDrawParams({depth:_},B),this.initCullDrawParams({cull:x},B),this.drawCommand=r(B),this.drawParams=B}return Object(Rt.a)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=Object(we.a)(Object(we.a)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=Object(we.a)(Object(we.a)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(o){var l=Object(El.a)(i[o]);l==="boolean"||l==="number"||Array.isArray(i[o])||i[o].BYTES_PER_ELEMENT?a[o]=i[o]:a[o]=i[o].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:e8[i.func||Z.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,o=i.func,l=i.equation,c=i.color,h=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:w0[o&&o.srcRGB||Z.SRC_ALPHA],srcAlpha:w0[o&&o.srcAlpha||Z.SRC_ALPHA],dstRGB:w0[o&&o.dstRGB||Z.ONE_MINUS_SRC_ALPHA],dstAlpha:w0[o&&o.dstAlpha||Z.ONE_MINUS_SRC_ALPHA]},equation:{rgb:wC[l&&l.rgb||Z.FUNC_ADD],alpha:wC[l&&l.alpha||Z.FUNC_ADD]},color:h}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,o=i.mask,l=o===void 0?-1:o,c=i.func,h=c===void 0?{cmp:Z.ALWAYS,ref:0,mask:-1}:c,_=i.opFront,x=_===void 0?{fail:Z.KEEP,zfail:Z.KEEP,zpass:Z.KEEP}:_,E=i.opBack,C=E===void 0?{fail:Z.KEEP,zfail:Z.KEEP,zpass:Z.KEEP}:E;return{enable:!!a,mask:l,func:Object(we.a)(Object(we.a)({},h),{},{cmp:t8[h.cmp]}),opFront:{fail:pm[x.fail],zfail:pm[x.zfail],zpass:pm[x.zpass]},opBack:{fail:pm[C.fail],zfail:pm[C.zfail],zpass:pm[C.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,o=i.face,l=o===void 0?Z.BACK:o;n.cull={enable:!!a,face:r8[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||az(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}iz(n)&&Object.keys(n).forEach(function(l){o.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(h){o.extractUniformsRecursively(h,l[h],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}(),sz=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Z.UNSIGNED_BYTE:i,o=t.width,l=t.height,c=t.flipY,h=c===void 0?!1:c,_=t.format,x=_===void 0?Z.RGBA:_,E=t.mipmap,C=E===void 0?!1:E,I=t.wrapS,P=I===void 0?Z.CLAMP_TO_EDGE:I,B=t.wrapT,U=B===void 0?Z.CLAMP_TO_EDGE:B,ee=t.aniso,ie=ee===void 0?0:ee,_e=t.alignment,Oe=_e===void 0?1:_e,ke=t.premultiplyAlpha,Ke=ke===void 0?!1:ke,ot=t.mag,Ot=ot===void 0?Z.NEAREST:ot,Zt=t.min,ir=Zt===void 0?Z.NEAREST:Zt,Hr=t.colorSpace,ln=Hr===void 0?Z.BROWSER_DEFAULT_WEBGL:Hr,pn=t.x,Ci=pn===void 0?0:pn,Ba=t.y,Sa=Ba===void 0?0:Ba,La=t.copy,wa=La===void 0?!1:La;this.width=o,this.height=l;var Ds={width:o,height:l,type:$1[a],format:q7[x],wrapS:CC[P],wrapT:CC[U],mag:TC[Ot],min:TC[ir],alignment:Oe,flipY:h,colorSpace:J7[ln],premultiplyAlpha:Ke,aniso:ie,x:Ci,y:Sa,copy:wa};n&&(Ds.data=n),typeof C=="number"?Ds.mipmap=Q7[C]:typeof C=="boolean"&&(Ds.mipmap=C),this.texture=r.texture(Ds)}return Object(Rt.a)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),sw,uw,uz=(sw=Object(on.injectable)(),sw(uw=function(){function e(){var r=this;Object(Et.a)(this,e),Object(L.a)(this,"uniformBuffers",[]),Object(L.a)(this,"createModel",function(t){return new oz(r.gl,t)}),Object(L.a)(this,"createAttribute",function(t){return new Y7(r.gl,t)}),Object(L.a)(this,"createBuffer",function(t){return new n8(r.gl,t)}),Object(L.a)(this,"createElements",function(t){return new i8(r.gl,t)}),Object(L.a)(this,"createTexture2D",function(t){return new sz(r.gl,t)}),Object(L.a)(this,"createFramebuffer",function(t){return new a8(r.gl,t)}),Object(L.a)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),Object(L.a)(this,"clear",function(t){var n,i=t.color,a=t.depth,o=t.stencil,l=t.framebuffer,c=l===void 0?null:l,h={color:i,depth:a,stencil:o};h.framebuffer=c===null?c:c.get(),(n=r.gl)===null||n===void 0||n.clear(h)}),Object(L.a)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,o=t.height;r.gl._gl.viewport(n,i,a,o),r.width=a,r.height=o,r.gl._refresh()}),Object(L.a)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,o=t.width,l=t.height,c={x:i,y:a,width:o,height:l};return n&&(c.framebuffer=n.get()),r.gl.read(c)}),Object(L.a)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),Object(L.a)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),Object(L.a)(this,"getCanvas",function(){return r.canvas}),Object(L.a)(this,"getGLContext",function(){return r.gl._gl}),Object(L.a)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return Object(Rt.a)(e,[{key:"init",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a,o){var l=this;return he.a.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(this.canvas=i,!o){h.next=5;break}this.gl=o,h.next=8;break;case 5:return h.next=7,new Promise(function(_,x){$7()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(C,I){(C||!I)&&x(C),_(I)}})});case 7:this.gl=h.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return h.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||uw),lz=function(){function e(r,t){Object(Et.a)(this,e);var n=t.buffer,i=t.offset,a=t.stride,o=t.normalized,l=t.size,c=t.divisor,h=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:h,buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:c||0},l&&(this.attribute.size=l)}return Object(Rt.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),sd,pp,Cm,Jg,ey,Ph,W0,hv,Uu,G0=(sd={},Object(L.a)(sd,Z.FLOAT,Float32Array),Object(L.a)(sd,Z.UNSIGNED_BYTE,Uint8Array),Object(L.a)(sd,Z.SHORT,Int16Array),Object(L.a)(sd,Z.UNSIGNED_SHORT,Uint16Array),Object(L.a)(sd,Z.INT,Int32Array),Object(L.a)(sd,Z.UNSIGNED_INT,Uint32Array),sd),cz=(pp={},Object(L.a)(pp,Z.POINTS,Is.POINTS),Object(L.a)(pp,Z.LINES,Is.LINES),Object(L.a)(pp,Z.LINE_LOOP,Is.LINES),Object(L.a)(pp,Z.LINE_STRIP,Is.LINE_STRIP),Object(L.a)(pp,Z.TRIANGLES,Is.TRIANGLES),Object(L.a)(pp,Z.TRIANGLE_FAN,Is.TRIANGLES),Object(L.a)(pp,Z.TRIANGLE_STRIP,Is.TRIANGLE_STRIP),pp),fz=(Cm={},Object(L.a)(Cm,1,Vt.F32_R),Object(L.a)(Cm,2,Vt.F32_RG),Object(L.a)(Cm,3,Vt.F32_RGB),Object(L.a)(Cm,4,Vt.F32_RGBA),Cm),hz=(Jg={},Object(L.a)(Jg,Z.STATIC_DRAW,Xf.STATIC),Object(L.a)(Jg,Z.DYNAMIC_DRAW,Xf.DYNAMIC),Object(L.a)(Jg,Z.STREAM_DRAW,Xf.DYNAMIC),Jg),lw=(ey={},Object(L.a)(ey,Z.REPEAT,Tl.REPEAT),Object(L.a)(ey,Z.CLAMP_TO_EDGE,Tl.CLAMP_TO_EDGE),Object(L.a)(ey,Z.MIRRORED_REPEAT,Tl.MIRRORED_REPEAT),ey),pz=(Ph={},Object(L.a)(Ph,Z.NEVER,Ra.NEVER),Object(L.a)(Ph,Z.ALWAYS,Ra.ALWAYS),Object(L.a)(Ph,Z.LESS,Ra.LESS),Object(L.a)(Ph,Z.LEQUAL,Ra.LEQUAL),Object(L.a)(Ph,Z.GREATER,Ra.GREATER),Object(L.a)(Ph,Z.GEQUAL,Ra.GEQUAL),Object(L.a)(Ph,Z.EQUAL,Ra.EQUAL),Object(L.a)(Ph,Z.NOTEQUAL,Ra.NOTEQUAL),Ph),dz=(W0={},Object(L.a)(W0,Z.FRONT,nc.FRONT),Object(L.a)(W0,Z.BACK,nc.BACK),W0),cw=(hv={},Object(L.a)(hv,Z.FUNC_ADD,ju.ADD),Object(L.a)(hv,Z.MIN_EXT,ju.MIN),Object(L.a)(hv,Z.MAX_EXT,ju.MAX),Object(L.a)(hv,Z.FUNC_SUBTRACT,ju.SUBSTRACT),Object(L.a)(hv,Z.FUNC_REVERSE_SUBTRACT,ju.REVERSE_SUBSTRACT),hv),X0=(Uu={},Object(L.a)(Uu,Z.ZERO,ya.ZERO),Object(L.a)(Uu,Z.ONE,ya.ONE),Object(L.a)(Uu,Z.SRC_COLOR,ya.SRC),Object(L.a)(Uu,Z.ONE_MINUS_SRC_COLOR,ya.ONE_MINUS_SRC),Object(L.a)(Uu,Z.SRC_ALPHA,ya.SRC_ALPHA),Object(L.a)(Uu,Z.ONE_MINUS_SRC_ALPHA,ya.ONE_MINUS_SRC_ALPHA),Object(L.a)(Uu,Z.DST_COLOR,ya.DST),Object(L.a)(Uu,Z.ONE_MINUS_DST_COLOR,ya.ONE_MINUS_DST),Object(L.a)(Uu,Z.DST_ALPHA,ya.DST_ALPHA),Object(L.a)(Uu,Z.ONE_MINUS_DST_ALPHA,ya.ONE_MINUS_DST_ALPHA),Object(L.a)(Uu,Z.CONSTANT_COLOR,ya.CONST),Object(L.a)(Uu,Z.ONE_MINUS_CONSTANT_COLOR,ya.ONE_MINUS_CONSTANT),Object(L.a)(Uu,Z.CONSTANT_ALPHA,ya.CONST),Object(L.a)(Uu,Z.ONE_MINUS_CONSTANT_ALPHA,ya.ONE_MINUS_CONSTANT),Object(L.a)(Uu,Z.SRC_ALPHA_SATURATE,ya.SRC_ALPHA_SATURATE),Uu),vz={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Z0(e){return Object.prototype.toString.call(e)in vz}var mz=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,o=t.isUBO,l;Z0(n)?l=n:l=new G0[this.type||Z.FLOAT](n),this.type=a,this.size=l.byteLength,this.buffer=r.createBuffer({viewOrSize:l,usage:o?go.UNIFORM:go.VERTEX,hint:hz[i||Z.STATIC_DRAW]})}return Object(Rt.a)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;Z0(n)?a=n:a=new G0[this.type||Z.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),gz=function(){function e(r,t){Object(Et.a)(this,e);var n=t.data,i=t.type,a=t.count,o=a===void 0?0:a,l;Z0(n)?l=n:l=new G0[this.type||Z.UNSIGNED_INT](n),this.type=i,this.count=o,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:go.INDEX})}return Object(Rt.a)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;Z0(n)?i=n:i=new G0[this.type||Z.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function yz(e){return!1}var _z=function(){function e(r,t){Object(Et.a)(this,e),Object(L.a)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?Z.UNSIGNED_BYTE:i,o=t.width,l=t.height,c=t.flipY,h=c===void 0?!1:c,_=t.format,x=_===void 0?Z.RGBA:_,E=t.wrapS,C=E===void 0?Z.CLAMP_TO_EDGE:E,I=t.wrapT,P=I===void 0?Z.CLAMP_TO_EDGE:I,B=t.alignment,U=B===void 0?1:B;this.width=o,this.height=l;var ee=Vt.U8_RGBA_RT;if(a===Z.UNSIGNED_BYTE&&x===Z.RGBA)ee=Vt.U8_RGBA_RT;else if(x===Z.LUMINANCE&&a===Z.FLOAT)ee=Vt.F32_LUMINANCE;else if(x===Z.LUMINANCE&&a===Z.UNSIGNED_BYTE)ee=Vt.U8_LUMINANCE;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(x));this.texture=r.createTexture({format:ee,width:o,height:l,usage:Tc.SAMPLED,pixelStore:{unpackFlipY:h,packAlignment:U}}),n&&this.texture.setImageData([n]),this.sampler=r.createSampler({addressModeU:lw[C],addressModeV:lw[P],minFilter:Ps.POINT,magFilter:Ps.BILINEAR,mipmapFilter:lu.NO_MIP,lodMinClamp:0,lodMaxClamp:0})}return Object(Rt.a)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),bz=function(){function e(r,t){Object(Et.a)(this,e),this.device=r;var n=t.width,i=t.height,a=t.color;yz(a)?(this.renderTarget=r.createRenderTargetFromTexture(a.get()),this.width=a.width,this.height=a.height):n&&i&&(this.renderTarget=r.createRenderTarget({format:Vt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}return Object(Rt.a)(e,[{key:"get",value:function(){return this.renderTarget}},{key:"destroy",value:function(){this.renderTarget.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.renderTarget&&this.renderTarget.destroy(),this.renderTarget=this.device.createRenderTarget({format:Vt.U8_RGBA_RT,width:n,height:i}),this.width=n,this.height=i)}}]),e}(),xz=xi.isPlainObject,Ez=xi.isTypedArray,Sz=function(){function e(r,t){var n=this;Object(Et.a)(this,e),Object(L.a)(this,"destroyed",!1),Object(L.a)(this,"uniforms",{}),Object(L.a)(this,"vertexBuffers",[]),this.device=r,this.options=t;var i=t.vs,a=t.fs,o=t.attributes,l=t.uniforms,c=t.count,h=t.elements;this.options=t;var _=r.createProgram({vertex:{glsl:i},fragment:{glsl:a}});this.program=_,l&&(this.uniforms=this.extractUniforms(l));var x=[],E=0;Object.keys(o).forEach(function(I){var P=o[I],B=P.get();n.vertexBuffers.push(B.get());var U=P.attribute,ee=U.offset,ie=ee===void 0?0:ee,_e=U.stride,Oe=_e===void 0?0:_e,ke=U.size,Ke=ke===void 0?1:ke,ot=U.divisor,Ot=ot===void 0?0:ot,Zt=U.shaderLocation,ir=Zt===void 0?0:Zt;x.push({arrayStride:Oe||Ke*4,stepMode:lv.VERTEX,attributes:[{format:fz[Ke],shaderLocation:ir,offset:ie,divisor:Ot}]}),E=B.size/Ke}),c||(this.options.count=E),h&&(this.indexBuffer=h.get());var C=r.createInputLayout({vertexBufferDescriptors:x,indexBufferFormat:h?Vt.U32_R:null,program:_});this.inputLayout=C,this.pipeline=this.createPipeline(t)}return Object(Rt.a)(e,[{key:"createPipeline",value:function(t){var n=t.primitive,i=n===void 0?Z.TRIANGLES:n,a=t.depth,o=t.cull,l=t.blend,c=this.initDepthDrawParams({depth:a}),h=!!(c&&c.enable),_=this.initCullDrawParams({cull:o}),x=!!(_&&_.enable),E=this.getBlendDrawParams({blend:l}),C=!!(E&&E.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:cz[i],colorAttachmentFormats:[Vt.U8_RGBA_RT],depthStencilAttachmentFormat:Vt.D24_S8,megaStateDescriptor:{attachmentsState:[{channelWriteMask:zu.ALL,rgbBlendState:{blendMode:C&&E.equation.rgb||ju.ADD,blendSrcFactor:C&&E.func.srcRGB||ya.SRC_ALPHA,blendDstFactor:C&&E.func.dstRGB||ya.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:C&&E.equation.alpha||ju.ADD,blendSrcFactor:C&&E.func.srcAlpha||ya.ONE,blendDstFactor:C&&E.func.dstAlpha||ya.ONE_MINUS_SRC_ALPHA}}],blendConstant:Y1,depthWrite:h,depthCompare:h&&c.func||Ra.LESS,cullMode:x&&_.face||nc.NONE,stencilWrite:!1}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=Object(we.a)(Object(we.a)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t){var n=Object(we.a)(Object(we.a)({},this.options),t),i=n.count,a=i===void 0?0:i,o=n.instances,l=n.elements,c=n.uniforms,h=c===void 0?{}:c,_=n.uniformBuffers,x=n.textures;this.uniforms=Object(we.a)(Object(we.a)({},this.uniforms),this.extractUniforms(h));var E=this.device,C=E.width,I=E.height,P=this.device.renderPass;if(this.pipeline=this.createPipeline(n),P.setPipeline(this.pipeline),P.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(U){return{buffer:U}}),l?{buffer:this.indexBuffer,offset:0}:null),P.setViewport(0,0,C,I),_&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:_.map(function(U,ee){var ie=U;return{binding:ee,buffer:ie.get(),size:ie.size}}),samplerBindings:x==null?void 0:x.map(function(U){return{texture:U.texture,sampler:U.sampler}})})),this.bindings&&(P.setBindings(this.bindings),this.program.setUniformsLegacy(this.uniforms)),l){var B=l.count;B===0?P.draw(a,o):P.drawIndexed(B,o)}else P.draw(a,o)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:pz[n.func||Z.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,o=i.func,l=i.equation,c=i.color,h=c===void 0?[0,0,0,0]:c;return{enable:!!a,func:{srcRGB:X0[o&&o.srcRGB||Z.SRC_ALPHA],srcAlpha:X0[o&&o.srcAlpha||Z.SRC_ALPHA],dstRGB:X0[o&&o.dstRGB||Z.ONE_MINUS_SRC_ALPHA],dstAlpha:X0[o&&o.dstAlpha||Z.ONE_MINUS_SRC_ALPHA]},equation:{rgb:cw[l&&l.rgb||Z.FUNC_ADD],alpha:cw[l&&l.alpha||Z.FUNC_ADD]},color:h}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,o=a===void 0?Z.BACK:a;return{enable:!!i,face:dz[o]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var o=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Ez(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}xz(n)&&Object.keys(n).forEach(function(l){o.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,c){Object.keys(l).forEach(function(h){o.extractUniformsRecursively(h,l[h],i,"".concat(a&&a+".").concat(t,"[").concat(c,"]"))})})}}]),e}();function Az(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var fw,hw,Tz=(fw=Object(on.injectable)(),fw(hw=function(){function e(){var r=this;Object(Et.a)(this,e),Object(L.a)(this,"uniformBuffers",[]),Object(L.a)(this,"createModel",function(t){return new Sz(r.device,t)}),Object(L.a)(this,"createAttribute",function(t){return new lz(r.device,t)}),Object(L.a)(this,"createBuffer",function(t){return new mz(r.device,t)}),Object(L.a)(this,"createElements",function(t){return new gz(r.device,t)}),Object(L.a)(this,"createTexture2D",function(t){return new _z(r.device,t)}),Object(L.a)(this,"createFramebuffer",function(t){return new bz(r.device,t)}),Object(L.a)(this,"useFramebuffer",function(){}),Object(L.a)(this,"clear",function(){}),Object(L.a)(this,"viewport",function(t){var n=t.width,i=t.height;r.width=n,r.height=i,r.device.width=n,r.device.height=i}),Object(L.a)(this,"readPixels",function(){return new Uint8Array}),Object(L.a)(this,"getViewportSize",function(){return{width:r.device.width,height:r.device.height}}),Object(L.a)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),Object(L.a)(this,"getCanvas",function(){return r.canvas}),Object(L.a)(this,"getGLContext",function(){return r.device.gl}),Object(L.a)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy()})}return Object(Rt.a)(e,[{key:"init",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a){var o,l,c,h,_,x;return he.a.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return o=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,c=o?new nz({shaderCompilerPath:l}):new dj({targets:["webgl2","webgl1"],onContextLost:function(P){console.warn("context lost",P)},onContextCreationError:function(P){console.warn("context creation error",P)},onContextRestored:function(P){console.warn("context restored",P)}}),C.next=5,c.createSwapChain(i);case 5:h=C.sent,h.configureSwapChain(i.width,i.height),this.device=h.getDevice(),this.swapChain=h,_=this.device.gl,this.extensionObject={OES_texture_float:!Az(_)&&this.device.OES_texture_float},x=this.device.createTexture({format:Vt.U8_RGBA_RT,width:i.width,height:i.height,usage:Tc.RENDER_TARGET}),this.renderTarget=this.device.createRenderTargetFromTexture(x),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:Vt.D24_S8,width:i.width,height:i.height,usage:Tc.RENDER_TARGET}));case 14:case"end":return C.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"beginFrame",value:function(){var t=this.swapChain.getOnscreenTexture();this.renderPass=this.device.createRenderPass({colorAttachment:[this.renderTarget],colorResolveTo:[t],colorClearColor:[Y1],depthStencilAttachment:this.mainDepthRT,depthClearValue:1}),this.device.renderPass=this.renderPass}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||hw);function Cz(e){var r=wz();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function wz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sb=["selectstart","selecting","selectend"],Oz=function(e){Object(qr.a)(t,e);var r=Cz(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"isEnable",!1),Object(L.a)(Object(De.a)(i),"onDragStart",function(o){i.box.style.display="block",i.startEvent=i.endEvent=o,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),Object(L.a)(Object(De.a)(i),"onDragging",function(o){i.endEvent=o,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),Object(L.a)(Object(De.a)(i),"onDragEnd",function(o){i.endEvent=o,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return Object(Rt.a)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=j.create("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,o=i.y,l=this.endEvent,c=l.x,h=l.y,_=Math.min(a,c),x=Math.min(o,h),E=Math.abs(a-c),C=Math.abs(o-h);this.box.style.top="".concat(x,"px"),this.box.style.left="".concat(_,"px"),this.box.style.width="".concat(E,"px"),this.box.style.height="".concat(C,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,o=i.lat,l=this.endEvent.lngLat,c=l.lng,h=l.lat;return _n([[a,o],[c,h]])}}]),t}(uo.EventEmitter),ty=function(){function e(r){Object(Et.a)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.hasBaseMap,o=r.renderer,l=o===void 0?"regl":o,c=JP();this.container=c,n.setContainer(c,t,i,a),c.bind(Qt.IRendererService).to(l==="regl"?uz:Tz).inSingletonScope(),this.sceneService=c.get(Qt.ISceneService),this.mapService=c.get(Qt.IMapService),this.iconService=c.get(Qt.IIconService),this.fontService=c.get(Qt.IFontService),this.controlService=c.get(Qt.IControlService),this.layerService=c.get(Qt.ILayerService),this.debugService=c.get(Qt.IDebugService),this.debugService.setEnable(r.debug),this.markerService=c.get(Qt.IMarkerService),this.interactionService=c.get(Qt.IInteractionService),this.popupService=c.get(Qt.IPopupService),this.boxSelect=new Oz(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return Object(Rt.a)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i){return he.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return o.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=Eg(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var o=n.initMask(t);n.addMask(o,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,o=n.maskColor,l=o===void 0?"#000":o,c=n.maskOpacity,h=c===void 0?0:c;if(!(!i||!a)){var _=new aA().source(a).shape("fill").style({color:l,opacity:h});return _}}},{key:"addMask",value:function(t,n){if(!!t){var i=this.getLayer(n);if(i){var a=Eg(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=Object(Xt.a)(he.a.mark(function n(){return he.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=Object(Bn.a)(i,2),o=a[0],l=a[1];n.fontService.addIconFont(o,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=Object(Xt.a)(he.a.mark(function n(i,a){return he.a.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(sb.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else Hy.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(sb.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else Hy.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){Hy.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(sb.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else Hy.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,o=i.animate;this.mapService.fitBounds(t,n||Object(we.a)(Object(we.a)({},a),{},{animate:o}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Qt.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return mf.REGISTERED_PROTOCOLS[t]}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:j.getContainer(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new tS({position:i}))}}],[{key:"addProtocol",value:function(t,n){mf.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete mf.REGISTERED_PROTOCOLS[t]}}]),e}(),KX="2.7.18",Rz=O("lwsE"),wc=O.n(Rz),Mz=O("W8MJ"),Oc=O.n(Mz),Pz=O("7W2i"),$0=O.n(Pz),Iz=O("a1gu"),Y0=O.n(Iz),kz=O("Nsbk"),ud=O.n(kz),Dz=O("yG8O"),Vu=O.n(Dz),Fz=O("lSNA"),_i=O.n(Fz),Bz=O("U+yc"),Hu=O.n(Bz),qX=O("1ABj"),pw,ub,dw;function vw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?vw(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):vw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var K0=(pw=Q_(Qt.IGlobalConfigService),ub=function(){function e(r){wc()(this,e),Vu()(this,"configService",dw,this),_i()(this,"config",void 0),this.config=r}return Oc()(e,[{key:"setContainer",value:function(t,n,i,a){t.bind(Qt.MapConfig).toConstantValue(mw(mw({},this.config),{},{id:n,canvas:i,hasBaseMap:a})),t.bind(Qt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),dw=Hu()(ub.prototype,"configService",[pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ub),Lz=O("sXyB"),q0=O.n(Lz),Nz=O("RIqP"),ld=O.n(Nz),jz=O("QILm"),ry=O.n(jz),zz=O("yXPU"),ny=O.n(zz),Uz=O("J4zp"),cd=O.n(Uz),Vz=O("623A"),gw=O.n(Vz);function yw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function _w(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?yw(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):yw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Q0(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return _w(_w({},r),e)}var wm;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(wm||(wm={}));var bw={dark:"amap://styles/2a09079c3daac9420ee53b67307a8006?isPublic=true",light:"amap://styles/1fd9f8ef9751298f11f5c56968312c70?isPublic=true",normal:"amap://styles/normal",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true"},xw=Math.PI/180,Hz=function(){function e(){wc()(this,e),_i()(this,"projectionMatrix",N.create()),_i()(this,"viewMatrix",N.create()),_i()(this,"viewProjectionMatrix",N.create()),_i()(this,"ViewProjectionMatrixUncentered",N.create()),_i()(this,"viewUncenteredMatrix",N.create()),_i()(this,"zoom",void 0),_i()(this,"center",void 0)}return Oc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.pitch,o=a===void 0?0:a,l=t.bearing,c=l===void 0?0:l,h=t.center,_=h===void 0?[0,0]:h,x=t.offsetOrigin,E=x===void 0?[0,0]:x,C=t.cameraHeight,I=C===void 0?1:C,P=t.aspect,B=P===void 0?1:P,U=t.near,ee=U===void 0?.1:U,ie=t.far,_e=ie===void 0?1e3:ie,Oe=t.fov,ke=Oe===void 0?0:Oe;this.zoom=i,this.center=_;var Ke=o*xw,ot=(360-c)*xw;N.perspective(this.projectionMatrix,ke,B,ee,_e);var Ot=z.fromValues(I*Math.sin(Ke)*Math.sin(ot),-I*Math.sin(Ke)*Math.cos(ot),I*Math.cos(Ke)),Zt=z.fromValues(-Math.cos(Ke)*Math.sin(ot),Math.cos(Ke)*Math.cos(ot),Math.sin(Ke));N.lookAt(this.viewMatrix,Ot,z.fromValues(0,0,0),Zt),this.viewUncenteredMatrix=N.clone(this.viewMatrix),N.translate(this.viewMatrix,this.viewMatrix,z.fromValues(-E[0],E[1],0)),N.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),N.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=cd()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,l=Math.PI/180,c=t[0]*l,h=a*l;h=Math.log(Math.tan(Math.PI/4+h/2));var _=.5/Math.PI,x=.5,E=-.5/Math.PI;return l=.5,c=o*(_*c+x)-215440491,h=-(o*(E*h+l)-106744817),[c,h]}}]),e}(),Wz=["id","style","minZoom","maxZoom","token","mapInstance","plugin"],Ew,Sw,Aw,Tw,Cw,ww,Om,Ow,Rw,Mw,Pw;function Iw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Gz(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Iw(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Iw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Xz(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}Xz(`.amap-logo{
 display: none !important;
}
`);var Zz=0;window.forceWebGL=!0;var kw="15cd8a57710d40c9b7c0e3cc120f1200",$z="1.4.15",Yz="amap-script",lb=!1,J0=[],Kz=12,qz=(Ew=Object(on.injectable)(),Sw=Object(on.inject)(Qt.IGlobalConfigService),Aw=Object(on.inject)(Qt.MapConfig),Tw=Object(on.inject)(Qt.ICoordinateSystemService),Cw=Object(on.inject)(Qt.IEventEmitter),Ew(ww=(Om=function(){function e(){var r=this;wc()(this,e),_i()(this,"version",wm["GAODE1.x"]),_i()(this,"map",void 0),_i()(this,"dragging",!1),_i()(this,"bgColor","rgba(0, 0, 0, 0)"),Vu()(this,"configService",Ow,this),Vu()(this,"config",Rw,this),Vu()(this,"coordinateSystemService",Mw,this),Vu()(this,"eventEmitter",Pw,this),_i()(this,"markerContainer",void 0),_i()(this,"$mapContainer",void 0),_i()(this,"viewport",void 0),_i()(this,"cameraChangedCallback",void 0),_i()(this,"handleCameraChanged",function(t){var n=t.camera,i=n.fov,a=n.near,o=n.far,l=n.height,c=n.pitch,h=n.rotation,_=n.aspect,x=n.position,E=r.getCenter(),C=E.lng,I=E.lat;if(r.emit("mapchange"),r.cameraChangedCallback){r.viewport.syncWithMapCamera({aspect:_,bearing:360-h,far:o,fov:i,cameraHeight:l,near:a,pitch:c,zoom:r.map.getZoom()-1,center:[C,I],offsetOrigin:[x.x,x.y]});var P=r.config.offsetZoom,B=P===void 0?Kz:P;r.viewport.getZoom()>B?r.coordinateSystemService.setCoordinateSystem(ec.P20_OFFSET):r.coordinateSystemService.setCoordinateSystem(ec.P20),r.cameraChangedCallback(r.viewport)}})}return Oc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];this.markerContainer=j.create("div","l7-marker-container",n)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=cd()(i,2),o=a[0],l=a[1],c=Q0(t.padding),h=this.lngLatToPixel([n.lng,n.lat]),_=[(c.right-c.left)/2,(c.bottom-c.top)/2],x=this.pixelToLngLat([h.x-_[0],h.y-_[1]]);return x}var E=this.map.getCenter();return{lng:E.getLng(),lat:E.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=Q0(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],l=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([l.lng,l.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),l=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[l,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToCoord",value:function(t){var n=this.map.lngLatToGeodeticCoord(t),i=n.x,a=n.y;return[i,-a]}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=this.viewport.projectFlat(t),c=N.create();return N.translate(c,c,z.fromValues(l[0],l[1],n)),N.scale(c,c,z.fromValues(a[0],a[1],a[2])),N.rotateX(c,c,i[0]),N.rotateY(c,c,i[1]),N.rotateZ(c,c,i[2]),c}},{key:"init",value:function(){var r=ny()(he.a.mark(function n(){var i=this,a,o,l,c,h,_,x,E,C,I,P,B,U,ee;return he.a.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return a=this.config,o=a.id,l=a.style,c=l===void 0?"light":l,h=a.minZoom,_=h===void 0?0:h,x=a.maxZoom,E=x===void 0?18:x,C=a.token,I=C===void 0?kw:C,P=a.mapInstance,B=a.plugin,U=B===void 0?[]:B,ee=ry()(a,Wz),_e.next=3,new Promise(function(Oe){var ke=function(){if(P)i.map=P,i.$mapContainer=i.map.getContainer(),setTimeout(function(){i.map.on("camerachange",i.handleCameraChanged),Oe()},30);else{i.$mapContainer=i.creatAmapContainer(o);var ot=Gz({mapStyle:i.getMapStyle(c),zooms:[_,E],viewMode:"3D"},ee);ot.zoom&&(ot.zoom+=1);var Ot=new AMap.Map(i.$mapContainer,ot);Ot.on("camerachange",i.handleCameraChanged),i.map=Ot,setTimeout(function(){Oe()},10)}};!lb&&!P?(I===kw&&console.warn(i.configService.getSceneWarninfo("MapToken")),lb=!0,U.push("Map3D"),gw.a.load({key:I,version:$z,plugins:U}).then(function(Ke){ke(),J0.length&&(J0.forEach(function(ot){return ot()}),J0=[])}).catch(function(Ke){throw new Error(Ke)})):lb&&window.AMap||P?ke():J0.push(ke)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.viewport=new Hz;case 6:case"end":return _e.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(q0()(AMap.LngLat,ld()(t)),q0()(AMap.LngLat,ld()(n))),a=this.lngLatToCoord(t),o=cd()(a,2),l=o[0],c=o[1],h=this.lngLatToCoord(n),_=cd()(h,2),x=_[0],E=_[1],C=Math.sqrt(Math.pow(l-x,2)+Math.pow(c-E,2));return C/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(Yz);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"getMapStyle",value:function(t){return bw[t]?bw[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+Zz++,n.appendChild(i),i}}]),e}(),Ow=Hu()(Om.prototype,"configService",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rw=Hu()(Om.prototype,"config",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=Hu()(Om.prototype,"coordinateSystemService",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pw=Hu()(Om.prototype,"eventEmitter",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om))||ww);function Qz(e){var r=Jz();return function(){var n=ud()(e),i;if(r){var a=ud()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Y0()(this,i)}}function Jz(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eU=function(e){$0()(t,e);var r=Qz(t);function t(){return wc()(this,t),r.apply(this,arguments)}return Oc()(t,[{key:"getServiceConstructor",value:function(){return qz}}]),t}(K0);function Dw(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Fw(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Dw(Object(t),!0).forEach(function(n){tU(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Dw(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function tU(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function rU(e,r){return oU(e)||aU(e,r)||iU(e,r)||nU()}function nU(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iU(e,r){if(!!e){if(typeof e=="string")return Bw(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Bw(e,r)}}function Bw(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function aU(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function oU(e){if(Array.isArray(e))return e}var sU=Xe.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(Je.useRef)(null),c=Object(Je.useState)(),h=rU(c,2),_=h[0],x=h[1];return Object(Je.useEffect)(function(){var E=new ty(Fw(Fw({id:l.current},i),{},{map:new eU(n)}));return E.on("loaded",function(){x(E),a&&a(E)}),function(){E.destroy()}},[]),Object(Je.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(Je.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(Je.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(Je.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(Je.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),Xe.a.createElement(dn.Provider,{value:_},Xe.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),QX=sU,uU=O("4ZJM"),iy=O.n(uU);function ay(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function e_(e,r){var t=ip([],r,e);return Np(t,t,1/t[3]),t}function JX(e,r){var t=e%r;return t<0?r+t:t}function eZ(e,r,t){return t*r+(1-t)*e}function fd(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var $f=Math.PI,Lw=$f/4,dp=$f/180,Nw=180/$f,cb=512,fb=4003e4,lU=1.5;function jw(e){return Math.pow(2,e)}function cU(e){return Math.log2(e)}function t_(e,r){var t=Object(Bn.a)(e,2),n=t[0],i=t[1];fd(Number.isFinite(n)&&Number.isFinite(r)),fd(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=cb;var a=n*dp,o=i*dp,l=r*(a+$f)/(2*$f),c=r*($f-Math.log(Math.tan(Lw+o*.5)))/(2*$f);return[l,c]}function hb(e,r){var t=Object(Bn.a)(e,2),n=t[0],i=t[1];r*=cb;var a=n/r*(2*$f)-$f,o=2*(Math.atan(Math.exp($f-i/r*(2*$f)))-Lw);return[a*Nw,o*Nw]}function tZ(e){var r=e.latitude;fd(Number.isFinite(r));var t=Math.cos(r*dp);return cU(fb*t)-9}function zw(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,o=a===void 0?!1:a;i=i!==void 0?i:jw(n),fd(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},c=cb*i,h=Math.cos(r*dp),_=c/360,x=_/h,E=c/fb/h;if(l.pixelsPerMeter=[E,-E,E],l.metersPerPixel=[1/E,-1/E,1/E],l.pixelsPerDegree=[_,-x,E],l.degreesPerPixel=[1/_,-1/x,1/E],o){var C=dp*Math.tan(r*dp)/h,I=_*C/2,P=c/fb*C,B=P/x*E;l.pixelsPerDegree2=[0,-I,P],l.pixelsPerMeter2=[B,0,B]}return l}function rZ(e,r){var t=Object(Bn.a)(e,3),n=t[0],i=t[1],a=t[2],o=Object(Bn.a)(r,3),l=o[0],c=o[1],h=o[2],_=1,x=zw({longitude:n,latitude:i,scale:_,highPrecision:!0}),E=x.pixelsPerMeter,C=x.pixelsPerMeter2,I=t_(e,_);I[0]+=l*(E[0]+C[0]*c),I[1]+=c*(E[1]+C[1]*c);var P=hb(I,_),B=(a||0)+(h||0);return Number.isFinite(a)||Number.isFinite(h)?[P[0],P[1],B]:P}function fU(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,o=a===void 0?null:a,l=e.flipY,c=l===void 0?!1:l,h=ay();return Yt(h,h,[0,0,-i]),En(h,h,[1,1,1/r]),Ca(h,h,-t*dp),Ie(h,h,n*dp),c&&En(h,h,[1,-1,1]),o&&Yt(h,h,Wa([],o)),h}function hU(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?lU:n,a=e.pitch,o=a===void 0?0:a,l=e.nearZMultiplier,c=l===void 0?1:l,h=e.farZMultiplier,_=h===void 0?1:h,x=o*dp,E=Math.atan(.5/i),C=Math.sin(E)*i/Math.sin(Math.PI/2-x-E),I=Math.cos(Math.PI/2-x)*C+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:c,far:I*_}}function pU(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,o=e.farZMultiplier,l=hU({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:o}),c=l.fov,h=l.aspect,_=l.near,x=l.far,E=Dn([],c,h,_,x);return E}function dU(e,r){var t=Object(Bn.a)(e,3),n=t[0],i=t[1],a=t[2],o=a===void 0?0:a;return fd(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(o)),e_(r,[n,i,o,1])}function Uw(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Object(Bn.a)(e,3),i=n[0],a=n[1],o=n[2];if(fd(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(o)){var l=e_(r,[i,a,o,1]);return l}var c=e_(r,[i,a,0,1]),h=e_(r,[i,a,1,1]),_=c[2],x=h[2],E=_===x?0:((t||0)-_)/(x-_);return Nf([],c,h,E)}var Vw=ay(),vU=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?Vw:i,o=r.projectionMatrix,l=o===void 0?Vw:o;Object(Et.a)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var c=ay();lr(c,c,this.projectionMatrix),lr(c,c,this.viewMatrix),this.viewProjectionMatrix=c;var h=ay();En(h,h,[this.width/2,-this.height/2,1]),Yt(h,h,[1,-1,0]),lr(h,h,this.viewProjectionMatrix);var _=hs(ay(),h);if(!_)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=h,this.pixelUnprojectionMatrix=_,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Object(Rt.a)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&kp(t.projectionMatrix,this.projectionMatrix)&&kp(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=this.projectPosition(t),l=dU(o,this.pixelProjectionMatrix),c=Object(Bn.a)(l,2),h=c[0],_=c[1],x=a?_:this.height-_;return t.length===2?[h,x]:[h,x,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,o=n.targetZ,l=Object(Bn.a)(t,3),c=l[0],h=l[1],_=l[2],x=a?h:this.height-h,E=o&&o*this.pixelsPerMeter,C=Uw([c,x,_],this.pixelUnprojectionMatrix,E),I=this.unprojectPosition(C),P=Object(Bn.a)(I,3),B=P[0],U=P[1],ee=P[2];return Number.isFinite(_)?[B,U,ee]:Number.isFinite(o)?[B,U,o]:[B,U]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=Object(Bn.a)(n,2),a=i[0],o=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,o,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=Object(Bn.a)(n,2),a=i[0],o=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,o,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function mU(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,o=e.maxZoom,l=o===void 0?24:o,c=e.padding,h=c===void 0?0:c,_=e.offset,x=_===void 0?[0,0]:_,E=Object(Bn.a)(n,2),C=Object(Bn.a)(E[0],2),I=C[0],P=C[1],B=Object(Bn.a)(E[1],2),U=B[0],ee=B[1];if(Number.isFinite(h)){var ie=h;h={top:ie,bottom:ie,left:ie,right:ie}}else fd(Number.isFinite(h.top)&&Number.isFinite(h.bottom)&&Number.isFinite(h.left)&&Number.isFinite(h.right));var _e=new pb({width:r,height:t,longitude:0,latitude:0,zoom:0}),Oe=_e.project([I,ee]),ke=_e.project([U,P]),Ke=[Math.max(Math.abs(ke[0]-Oe[0]),a),Math.max(Math.abs(ke[1]-Oe[1]),a)],ot=[r-h.left-h.right-Math.abs(x[0])*2,t-h.top-h.bottom-Math.abs(x[1])*2];fd(ot[0]>0&&ot[1]>0);var Ot=ot[0]/Ke[0],Zt=ot[1]/Ke[1],ir=(h.right-h.left)/2/Ot,Hr=(h.bottom-h.top)/2/Zt,ln=[(ke[0]+Oe[0])/2+ir,(ke[1]+Oe[1])/2+Hr],pn=_e.unproject(ln),Ci=_e.zoom+Math.log2(Math.abs(Math.min(Ot,Zt)));return{longitude:pn[0],latitude:pn[1],zoom:Math.min(Ci,l)}}var pb=function(e){Object(qr.a)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,o=n.latitude,l=o===void 0?0:o,c=n.longitude,h=c===void 0?0:c,_=n.zoom,x=_===void 0?0:_,E=n.pitch,C=E===void 0?0:E,I=n.bearing,P=I===void 0?0:I,B=n.altitude,U=B===void 0?1.5:B,ee=n.nearZMultiplier,ie=n.farZMultiplier;Object(Et.a)(this,r),i=i||1,a=a||1;var _e=jw(x);U=Math.max(.75,U);var Oe=t_([h,l],_e);Oe[2]=0;var ke=pU({width:i,height:a,pitch:C,bearing:P,altitude:U,nearZMultiplier:ee||1/a,farZMultiplier:ie||1.01}),Ke=fU({height:a,center:Oe,pitch:C,bearing:P,altitude:U,flipY:!0});return t=Object(Zr.a)(this,Object(ut.a)(r).call(this,{width:i,height:a,viewMatrix:Ke,projectionMatrix:ke})),t.latitude=l,t.longitude=h,t.zoom=x,t.pitch=C,t.bearing=P,t.altitude=U,t.scale=_e,t.center=Oe,t.pixelsPerMeter=zw(Object(De.a)(Object(De.a)(t))).pixelsPerMeter[2],Object.freeze(Object(De.a)(Object(De.a)(t))),t}return Object(Rt.a)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t_(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return hb(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,o=Uw(a,this.pixelUnprojectionMatrix),l=t_(i,this.scale),c=Fv([],l,nf([],o)),h=Fv([],this.center,c);return hb(h,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,o=this.height,l=mU(Object.assign({width:a,height:o,bounds:n},i)),c=l.longitude,h=l.latitude,_=l.zoom;return new r({width:a,height:o,longitude:c,latitude:h,zoom:_})}}]),r}(vU),gU=function(){function e(){wc()(this,e),_i()(this,"viewport",void 0)}return Oc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,o=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new pb({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),Hw={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},yU=["id","attributionControl","style","token","rotation","mapInstance"],Ww,Gw,Xw,Zw,$w,Yw,Rm,Kw,qw,Qw,Jw;function e3(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function _U(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?e3(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):e3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function bU(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}bU(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=iy.a;var t3={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},xU=0,EU=12,r3="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",SU=(Ww=Object(on.injectable)(),Gw=Object(on.inject)(Qt.MapConfig),Xw=Object(on.inject)(Qt.IGlobalConfigService),Zw=Object(on.inject)(Qt.ICoordinateSystemService),$w=Object(on.inject)(Qt.IEventEmitter),Ww(Yw=(Rm=function(){function e(){var r=this;wc()(this,e),_i()(this,"version",wm.MAPBOX),_i()(this,"map",void 0),_i()(this,"dragging",!1),_i()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Vu()(this,"config",Kw,this),Vu()(this,"configService",qw,this),Vu()(this,"coordinateSystemService",Qw,this),Vu()(this,"eventEmitter",Jw,this),_i()(this,"viewport",void 0),_i()(this,"markerContainer",void 0),_i()(this,"cameraChangedCallback",void 0),_i()(this,"$mapContainer",void 0),_i()(this,"handleCameraChanged",function(){var t=r.map.getCenter().wrap(),n=t.lat,i=t.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0});var a=r.config.offsetZoom,o=a===void 0?EU:a;r.viewport.getZoom()>o?r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT),r.cameraChangedCallback(r.viewport)})}return Oc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=j.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t3[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(t3[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(t,n){this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.rotateEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToCoord",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},i=this.lngLatToMercator(t,0),a=i.x,o=i.y;return[a-n.x,o-n.y]}},{key:"lngLatToMercator",value:function(t,n){var i=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),a=i.x,o=a===void 0?0:a,l=i.y,c=l===void 0?0:l,h=i.z,_=h===void 0?0:h;return{x:o,y:c,z:_}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=window.mapboxgl.MercatorCoordinate.fromLngLat(t,n),c=l.meterInMercatorCoordinateUnits(),h=N.create();return N.translate(h,h,z.fromValues(l.x-o.x,l.y-o.y,l.z||0-o.z)),N.scale(h,h,z.fromValues(c*a[0],-c*a[1],c*a[2])),N.rotateX(h,h,i[0]),N.rotateY(h,h,i[1]),N.rotateZ(h,h,i[2]),h}},{key:"init",value:function(){var r=ny()(he.a.mark(function n(){var i=this,a,o,l,c,h,_,x,E,C,I,P,B,U;return he.a.wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,h=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,E=a.token,C=E===void 0?r3:E,I=a.rotation,P=I===void 0?0:I,B=a.mapInstance,U=ry()(a,yU),this.viewport=new gU,!B&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),C===r3&&x!=="blank"&&!window.mapboxgl.accessToken&&!B&&console.warn(this.configService.getSceneWarninfo("MapToken")),!B&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=C),B?(this.map=B,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(l),this.map=new window.mapboxgl.Map(_U({container:this.$mapContainer,style:this.getMapStyle(x),attributionControl:h,bearing:P},U))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return ie.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,n){var i=new iy.a.LngLat(t[0],t[1]),a=new iy.a.LngLat(n[0],n[1]),o=i.distanceTo(a),l=iy.a.MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),c=iy.a.MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),h=l.x,_=l.y,x=c.x,E=c.y,C=Math.sqrt(Math.pow(h-x,2)+Math.pow(_-E,2))*4194304*2;return C/o}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_mapbox_div"+xU++,n.appendChild(i),i}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:Hw[t]?Hw[t]:t}}]),e}(),Kw=Hu()(Rm.prototype,"config",[Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qw=Hu()(Rm.prototype,"configService",[Xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qw=Hu()(Rm.prototype,"coordinateSystemService",[Zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jw=Hu()(Rm.prototype,"eventEmitter",[$w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm))||Yw);function AU(e){var r=TU();return function(){var n=ud()(e),i;if(r){var a=ud()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Y0()(this,i)}}function TU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function CU(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}CU(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var wU=function(e){$0()(t,e);var r=AU(t);function t(){return wc()(this,t),r.apply(this,arguments)}return Oc()(t,[{key:"getServiceConstructor",value:function(){return SU}}]),t}(K0);function n3(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function i3(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?n3(Object(t),!0).forEach(function(n){OU(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function OU(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function RU(e,r){return kU(e)||IU(e,r)||PU(e,r)||MU()}function MU(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PU(e,r){if(!!e){if(typeof e=="string")return a3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return a3(e,r)}}function a3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function IU(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function kU(e){if(Array.isArray(e))return e}var DU=Xe.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=Object(Je.createRef)(),l=Object(Je.useState)(),c=RU(l,2),h=c[0],_=c[1];return Object(Je.useEffect)(function(){var x=new ty(i3(i3({id:o.current},i),{},{map:new wU(n)}));return x.on("loaded",function(){_(x),a&&a(x)}),function(){x.destroy()}},[]),Object(Je.useEffect)(function(){h&&n.style&&h.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(Je.useEffect)(function(){h&&n.zoom&&h.setZoom(n.zoom)},[n.zoom]),Object(Je.useEffect)(function(){h&&n.center&&h.setCenter(n.center)},[JSON.stringify(n.center)]),Object(Je.useEffect)(function(){h&&n.pitch!==void 0&&h.setPitch(n.pitch||0)},[n.pitch]),Object(Je.useEffect)(function(){h&&n.rotation&&h.setRotation(n.rotation)},[n.rotation]),Xe.a.createElement(dn.Provider,{value:h},Object(Je.createElement)("div",{ref:o,style:r,className:t},h&&e.children))}),FU=DU,o3={dark:"amap://styles/dark",light:"amap://styles/light",normal:"amap://styles/normal",blank:"amap://styles/1a91e7ec761981d85b35f3099ff781a3"},BU=function(){function e(){wc()(this,e),_i()(this,"projectionMatrix",N.create()),_i()(this,"viewMatrix",N.create()),_i()(this,"viewProjectionMatrix",N.create()),_i()(this,"ViewProjectionMatrixUncentered",N.create()),_i()(this,"viewUncenteredMatrix",N.create()),_i()(this,"zoom",void 0),_i()(this,"center",void 0)}return Oc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.zoom,i=n===void 0?1:n,a=t.center,o=a===void 0?[0,0]:a,l=t.offsetOrigin,c=l===void 0?[0,0]:l,h=t.cameraPosition,_=h===void 0?[0,0,0]:h,x=t.up,E=x===void 0?[0,1,0]:x,C=t.lookAt,I=C===void 0?[0,0,0]:C,P=t.aspect,B=P===void 0?1:P,U=t.near,ee=U===void 0?.1:U,ie=t.far,_e=ie===void 0?1e3:ie,Oe=t.fov,ke=Oe===void 0?45:Oe;this.zoom=i,this.center=o,N.perspective(this.projectionMatrix,ke/180*Math.PI,B,ee,_e);var Ke=z.fromValues.apply(z,ld()(_)),ot=z.fromValues.apply(z,ld()(I)),Ot=z.fromValues.apply(z,ld()(E));N.lookAt(this.viewMatrix,Ke,ot,Ot),this.viewUncenteredMatrix=N.clone(this.viewMatrix),N.translate(this.viewMatrix,this.viewMatrix,z.fromValues(-c[0],c[1],0)),N.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),N.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=cd()(this.center,2),n=t[0],i=t[1];return[n,i]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){var i=85.0511287798,a=Math.max(Math.min(i,t[1]),-i),o=256<<20,l=Math.PI/180,c=t[0]*l,h=a*l;h=Math.log(Math.tan(Math.PI/4+h/2));var _=.5/Math.PI,x=.5,E=-.5/Math.PI;return l=.5,c=o*(_*c+x)-215440491,h=-(o*(E*h+l)-106744817),[c,h]}}]),e}(),LU=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"],s3,u3,l3,c3,f3,h3,Mm,p3,d3,v3,m3;function g3(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function NU(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?g3(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function jU(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}jU(`.amap-logo{
 display: none !important;
}
`);var zU=0;window.forceWebGL=!0;var y3="ff533602d57df6f8ab3b0fea226ae52f",UU="2.0",VU="amap-script",db=!1,r_=[],HU=(s3=Object(on.injectable)(),u3=Object(on.inject)(Qt.IGlobalConfigService),l3=Object(on.inject)(Qt.MapConfig),c3=Object(on.inject)(Qt.ICoordinateSystemService),f3=Object(on.inject)(Qt.IEventEmitter),s3(h3=(Mm=function(){function e(){var r=this;wc()(this,e),_i()(this,"version",wm["GAODE2.x"]),_i()(this,"map",void 0),_i()(this,"dragging",!1),_i()(this,"sceneCenter",void 0),_i()(this,"sceneCenterMKT",void 0),_i()(this,"bgColor","rgba(0, 0, 0, 0)"),Vu()(this,"configService",p3,this),Vu()(this,"config",d3,this),Vu()(this,"coordinateSystemService",v3,this),Vu()(this,"eventEmitter",m3,this),_i()(this,"markerContainer",void 0),_i()(this,"$mapContainer",void 0),_i()(this,"viewport",void 0),_i()(this,"cameraChangedCallback",void 0),_i()(this,"handleViewChanged",function(t){var n=r.map.customCoords.getCameraParams(),i=n.fov,a=n.near,o=n.far,l=n.aspect,c=n.position,h=n.lookAt,_=n.up;r.emit("mapchange");var x=t.zoom,E=r.map.customCoords.getCenter();r.cameraChangedCallback&&(r.viewport.syncWithMapCamera({aspect:l,far:o,fov:i,cameraPosition:c,lookAt:h,up:_,near:a,zoom:x-1,center:E,offsetOrigin:[c[0],c[1]]}),r.coordinateSystemService.setCoordinateSystem(ec.P20_2),r.cameraChangedCallback(r.viewport))})}return Oc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"setCustomCoordCenter",value:function(t){var n;this.sceneCenter=t,this.sceneCenterMKT=(n=this.map.getProjection()).project.apply(n,ld()(this.sceneCenter))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMKT}},{key:"lngLatToCoord",value:function(t){var n=this.map.getProjection(),i=n.project;return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(i(t[0],t[1]),this.sceneCenterMKT)}},{key:"lngLatToCoords",value:function(t){var n=this;return t.map(function(i){return typeof i[0]=="number"?n.lngLatToCoord(i):i.map(function(a){return n.lngLatToCoord(a)})})}},{key:"addMarkerContainer",value:function(){if(!!this.map){var t=this.map.getContainer();if(t!==null){var n=t.getElementsByClassName("amap-maps")[0];n.style.zIndex="auto",this.markerContainer=j.create("div","l7-marker-container2",n)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(t,n)}},{key:"off",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.off(t,n):this.map.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap2"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(t!=null&&t.padding){var n=this.getCenter(),i=this.getSize(),a=cd()(i,2),o=a[0],l=a[1],c=Q0(t.padding),h=this.lngLatToPixel([n.lng,n.lat]),_=[(c.right-c.left)/2,(c.bottom-c.top)/2],x=this.pixelToLngLat([h.x-_[0],h.y-_[1]]);return x}var E=this.map.getCenter();return{lng:E.getLng(),lat:E.getLat()}}},{key:"setCenter",value:function(t,n){if(n!=null&&n.padding){var i=Q0(n.padding),a=this.lngLatToPixel(t),o=[(i.right-i.left)/2,(i.bottom-i.top)/2],l=this.pixelToLngLat([a.x+o[0],a.y+o[1]]);this.map.setCenter([l.lng,l.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds(),n=t.getNorthEast(),i=t.getSouthWest(),a=this.getCenter(),o=a.lng>n.getLng()||a.lng<i.getLng()?180-n.getLng():n.getLng(),l=a.lng<i.getLng()?i.getLng()-180:i.getLng();return[[l,i.getLat()],[o,n.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.getZooms();return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.getZooms();return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy(t,n)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,n){this.map.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyle(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"pixelToLngLat",value:function(t){var n=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:n.getLng(),lat:n.getLat()}}},{key:"lngLatToPixel",value:function(t){var n=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:n.getX(),y:n.getY()}}},{key:"containerToLngLat",value:function(t){var n=new AMap.Pixel(t[0],t[1]),i=this.map.containerToLngLat(n);return{lng:i==null?void 0:i.getLng(),lat:i==null?void 0:i.getLat()}}},{key:"lngLatToContainer",value:function(t){var n=new AMap.LngLat(t[0],t[1]),i=this.map.lngLatToContainer(n);return{x:i.getX(),y:i.getY()}}},{key:"lngLatToMercator",value:function(t,n){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},l=this.map.customCoords.lngLatToCoord(t),c=N.create();return N.translate(c,c,z.fromValues(l[0],l[1],n)),N.scale(c,c,z.fromValues(a[0],a[1],a[2])),N.rotateX(c,c,i[0]),N.rotateY(c,c,i[1]),N.rotateZ(c,c,i[2]),c}},{key:"init",value:function(){var r=ny()(he.a.mark(function n(){var i=this,a,o,l,c,h,_,x,E,C,I,P,B,U,ee,ie,_e;return he.a.wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:return a=this.config,o=a.id,l=a.style,c=l===void 0?"light":l,h=a.minZoom,_=h===void 0?0:h,x=a.maxZoom,E=x===void 0?18:x,C=a.token,I=C===void 0?y3:C,P=a.mapInstance,B=a.plugin,U=B===void 0?[]:B,ee=a.version,ie=ee===void 0?UU:ee,_e=ry()(a,LU),ke.next=3,new Promise(function(Ke){var ot=function(){if(P){var Zt;i.map=P,i.$mapContainer=i.map.getContainer();var ir=i.map.getCenter();(Zt=i.map.customCoords)===null||Zt===void 0||Zt.setCenter([ir.lng,ir.lat]),i.setCustomCoordCenter([ir.lng,ir.lat]),setTimeout(function(){i.map.on("viewchange",i.handleViewChanged),Ke()},30)}else{i.$mapContainer=i.creatAmapContainer(o);var Hr=NU({mapStyle:i.getMapStyle(c),zooms:[_,E],viewMode:"3D"},_e);Hr.zoom&&(Hr.zoom+=1);var ln=new AMap.Map(i.$mapContainer,Hr);i.map=ln;var pn=ln.getCenter();ln.customCoords.setCenter([pn.lng,pn.lat]),i.setCustomCoordCenter([pn.lng,pn.lat]),ln.on("viewchange",i.handleViewChanged),setTimeout(function(){Ke()},10)}};i.viewport=new BU,!db&&!P?(I===y3&&console.warn(i.configService.getSceneWarninfo("MapToken")),db=!0,U.push("Map3D"),gw.a.load({key:I,version:ie,plugins:U}).then(function(Ot){ot(),r_.length&&(r_.forEach(function(Zt){return Zt()}),r_=[])}).catch(function(Ot){throw new Error(Ot)})):db&&window.AMap||P?ot():r_.push(ot)});case 3:this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""});case 5:case"end":return ke.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"meterToCoord",value:function(t,n){var i=AMap.GeometryUtil.distance(q0()(AMap.LngLat,ld()(t)),q0()(AMap.LngLat,ld()(n))),a=this.lngLatToCoord(t),o=cd()(a,2),l=o[0],c=o[1],h=this.lngLatToCoord(n),_=cd()(h,2),x=_[0],E=_[1],C=Math.sqrt(Math.pow(l-x,2)+Math.pow(c-E,2));return C/i}},{key:"exportMap",value:function(t){var n,i=(n=this.getContainer())===null||n===void 0?void 0:n.getElementsByClassName("amap-layer")[0],a=t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return a}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"destroy",value:function(){var t,n;this.map.destroy(),(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),delete window.initAMap;var i=document.getElementById(VU);i&&document.head.removeChild(i)}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,n=(t=this.map.customCoords)===null||t===void 0?void 0:t.getCameraParams(),i=n.fov,a=n.near,o=n.far,l=n.aspect,c=n.position,h=n.lookAt,_=n.up;this.emit("mapchange");var x=this.map.customCoords.getCenter(),E=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:l,far:o,fov:i,cameraPosition:c,lookAt:h,near:a,up:_,zoom:E-1,center:x,offsetOrigin:[c[0],c[1]]}),this.coordinateSystemService.setCoordinateSystem(ec.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,n){var i=[0,0];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i}},{key:"getMapStyle",value:function(t){return o3[t]?o3[t]:t}},{key:"creatAmapContainer",value:function(t){var n=t;typeof t=="string"&&(n=document.getElementById(t));var i=document.createElement("div");return i.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,i.id="l7_amap_div"+zU++,n.appendChild(i),i}}]),e}(),p3=Hu()(Mm.prototype,"configService",[u3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d3=Hu()(Mm.prototype,"config",[l3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v3=Hu()(Mm.prototype,"coordinateSystemService",[c3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m3=Hu()(Mm.prototype,"eventEmitter",[f3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mm))||h3);function WU(e){var r=GU();return function(){var n=ud()(e),i;if(r){var a=ud()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Y0()(this,i)}}function GU(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XU=function(e){$0()(t,e);var r=WU(t);function t(){return wc()(this,t),r.apply(this,arguments)}return Oc()(t,[{key:"getServiceConstructor",value:function(){return HU}}]),t}(K0);function _3(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function b3(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?_3(Object(t),!0).forEach(function(n){ZU(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):_3(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ZU(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function $U(e,r){return QU(e)||qU(e,r)||KU(e,r)||YU()}function YU(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function KU(e,r){if(!!e){if(typeof e=="string")return x3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return x3(e,r)}}function x3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function qU(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function QU(e){if(Array.isArray(e))return e}var JU=Xe.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(Je.useRef)(null),c=Object(Je.useState)(),h=$U(c,2),_=h[0],x=h[1];return Object(Je.useEffect)(function(){var E=new ty(b3(b3({id:l.current},i),{},{map:new XU(n)}));return E.on("loaded",function(){x(E),a&&a(E)}),function(){E.destroy()}},[]),Object(Je.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(Je.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(Je.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(Je.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(Je.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),Xe.a.createElement(dn.Provider,{value:_},Xe.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),nZ=JU,e9=O("zvhG"),t9=O.n(e9);function r9(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=n9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function n9(e,r){if(!!e){if(typeof e=="string")return E3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return E3(e,r)}}function E3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var vb;function mb(e,r,t){var n=t-r,i=((e-r)%n+n)%n+r;return i===r?t:i}function vp(e,r,t){return Math.min(t,Math.max(r,e))}function hf(e,r,t){return e*(1-t)+r*t}function gb(e,r,t,n){var i=new t9.a(e,r,t,n);return function(a){return i.solve(a)}}var yb=gb(.25,.1,.25,1);function S3(){return vb==null&&(vb=window.matchMedia("(prefers-reduced-motion: reduce)")),vb.matches}function i9(e,r){var t={},n=r9(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a in e&&(t[a]=e[a])}}catch(o){n.e(o)}finally{n.f()}return t}var hd=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),a9=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o9=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;function n_(e){var r=a9(e);return{cancel:function(){return o9(r)}}}function s9(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];for(var i=0,a=t;i<a.length;i++){var o=a[i];for(var l in o)o[l]!==void 0&&(e[l]=o[l])}return e}var A3=63710088e-1,ko=function(){function e(r,t){if(Object(Et.a)(this,e),isNaN(r)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(r,", ").concat(t,")"));if(this.lng=+r,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return Object(Rt.a)(e,[{key:"wrap",value:function(){return new e(mb(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var n=Math.PI/180,i=this.lat*n,a=t.lat*n,o=Math.sin(i)*Math.sin(a)+Math.cos(i)*Math.cos(a)*Math.cos((t.lng-this.lng)*n),l=A3*Math.acos(Math.min(o,1));return l}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&Object(El.a)(t)==="object"&&t!==null){var n="lng"in t?t.lng:t.lon;return new e(Number(n),Number(t.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),oy=function(){function e(r,t){Object(Et.a)(this,e),r&&(t?this.setSouthWest(r).setNorthEast(t):r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}return Object(Rt.a)(e,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof ko?new ko(t.lng,t.lat):ko.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof ko?new ko(t.lng,t.lat):ko.convert(t),this}},{key:"extend",value:function(t){var n=this.sw,i=this.ne,a,o;if(t instanceof ko)a=t,o=t;else if(t instanceof e){if(a=t.sw,o=t.ne,!a||!o)return this}else{if(Array.isArray(t))if(t.length===4||t.every(Array.isArray)){var l=t;return this.extend(e.convert(l))}else{var c=t;return this.extend(ko.convert(c))}return this}return!n&&!i?(this.sw=new ko(a.lng,a.lat),this.ne=new ko(o.lng,o.lat)):(n.lng=Math.min(a.lng,n.lng),n.lat=Math.min(a.lat,n.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)),this}},{key:"getCenter",value:function(){return new ko((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new ko(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new ko(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var n=ko.convert(t),i=n.lng,a=n.lat,o=this.sw.lat<=a&&a<=this.ne.lat,l=this.sw.lng<=i&&i<=this.ne.lng;return this.sw.lng>this.ne.lng&&(l=this.sw.lng>=i&&i>=this.ne.lng),o&&l}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}}]),e}(),Ma=function(){function e(r,t){Object(Et.a)(this,e),this.x=r,this.y=t}return Object(Rt.a)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var n=Math.cos(t),i=Math.sin(t),a=n*this.x-i*this.y,o=i*this.x+n*this.y;return this.x=a,this.y=o,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,n){var i=Math.cos(t),a=Math.sin(t),o=n.x+i*(this.x-n.x)-a*(this.y-n.y),l=n.y+a*(this.x-n.x)+i*(this.y-n.y);return this.x=o,this.y=l,this}},{key:"roateAround",value:function(t,n){return this.clone()._rotateAround(t,n)}},{key:"_matMult",value:function(t){var n=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=i,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var n=t.x-this.x,i=t.y-this.y;return n*n+i*i}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)}}],[{key:"convert",value:function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}}]),e}(),u9=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;if(Object(Et.a)(this,e),isNaN(r)||r<0||isNaN(t)||t<0||isNaN(n)||n<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=t,this.left=n,this.right=i}return Object(Rt.a)(e,[{key:"interpolate",value:function(t,n,i){return n.top!=null&&t.top!=null&&(this.top=hf(t.top,n.top,i)),n.bottom!=null&&t.bottom!=null&&(this.bottom=hf(t.bottom,n.bottom,i)),n.left!=null&&t.left!=null&&(this.left=hf(t.left,n.left,i)),n.right!=null&&t.right!=null&&(this.right=hf(t.right,n.right,i)),this}},{key:"getCenter",value:function(t,n){var i=vp((this.left+t-this.right)/2,0,t),a=vp((this.top+n-this.bottom)/2,0,n);return new Ma(i,a)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),T3=2*Math.PI*A3;function C3(e){return T3*Math.cos(e*Math.PI/180)}function i_(e){return(180+e)/360}function a_(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function w3(e,r){return e/C3(r)}function l9(e){return e*360-180}function _b(e){var r=180-e*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}function c9(e,r){return e*C3(_b(r))}function f9(e){return 1/Math.cos(e*Math.PI/180)}var o_=function(){function e(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;Object(Et.a)(this,e),this.x=+r,this.y=+t,this.z=+n}return Object(Rt.a)(e,[{key:"toLngLat",value:function(){return new ko(l9(this.x),_b(this.y))}},{key:"toAltitude",value:function(){return c9(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/T3*f9(_b(this.y))}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=ko.convert(t);return new e(i_(i.lng),a_(i.lat),w3(n,i.lat))}}]),e}();function h9(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=p9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function p9(e,r){if(!!e){if(typeof e=="string")return O3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return O3(e,r)}}function O3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var iZ=8192,d9=function(){function e(r,t,n,i,a){Object(Et.a)(this,e),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=a===void 0?!0:a,this._minZoom=r||0,this._maxZoom=t||22,this._minPitch=n==null?0:n,this._maxPitch=i==null?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ko(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new u9,this.posMatrixCache={},this.alignedPosMatrixCache={}}return Object(Rt.a)(e,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Ma(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var n=-mb(t,-180,180)*Math.PI/180;this.angle!==n&&(this.unmodified=!1,this.angle=n,this.calcMatrices(),this.rotationMatrix=X.create(),X.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var n=vp(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==n&&(this.unmodified=!1,this._pitch=n,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var n=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==n&&(this.unmodified=!1,this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.center=this._center,t.zoom=this.zoom,t.angle=this.angle,t.fov=this._fov,t.pitch=this._pitch,t.unmodified=this.unmodified,t.edgeInsets=this.edgeInsets.clone(),t.calcMatrices(),t}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,n,i){this.unmodified=!1,this.edgeInsets.interpolate(t,n,i),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}},{key:"resize",value:function(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var n=vp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Ma(i_(t.lng)*this.worldSize,a_(n)*this.worldSize)}},{key:"unproject",value:function(t){return new o_(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,n){var i=this.pointCoordinate(n),a=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(t),l=new o_(o.x-(i.x-a.x),o.y-(i.y-a.y));this.center=this.coordinateLocation(l),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var n=0,i=new Float64Array([t.x,t.y,0,1]),a=new Float64Array([t.x,t.y,1,1]);W.transformMat4(i,i,this.pixelMatrixInverse),W.transformMat4(a,a,this.pixelMatrixInverse);var o=i[3],l=a[3],c=i[0]/o,h=a[0]/l,_=i[1]/o,x=a[1]/l,E=i[2]/o,C=a[2]/l,I=E===C?0:(n-E)/(C-E);return new o_(hf(c,h,I)/this.worldSize,hf(_,x,I)/this.worldSize)}},{key:"getBounds",value:function(){return new oy().extend(this.pointLocation(new Ma(0,0))).extend(this.pointLocation(new Ma(this.width,0))).extend(this.pointLocation(new Ma(this.width,this.height))).extend(this.pointLocation(new Ma(0,this.height)))}},{key:"getMaxBounds",value:function(){return!this.latRange||this.latRange.length!==2||!this.lngRange||this.lngRange.length!==2?null:new oy([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]])}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new Ma(0,0)),n=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]),i=W.transformMat4(n,n,this.pixelMatrix);return i[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,n=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Ma(0,n))}},{key:"getCameraQueryGeometry",value:function(t){var n=this.getCameraPoint();if(t.length===1)return[t[0],n];var i=n.x,a=n.y,o=n.x,l=n.y,c=h9(t),h;try{for(c.s();!(h=c.n()).done;){var _=h.value;i=Math.min(i,_.x),a=Math.min(a,_.y),o=Math.max(o,_.x),l=Math.max(l,_.y)}}catch(x){c.e(x)}finally{c.f()}return[new Ma(i,a),new Ma(o,a),new Ma(o,l),new Ma(i,l),new Ma(i,a)]}},{key:"coordinatePoint",value:function(t){var n=W.fromValues(t.x*this.worldSize,t.y*this.worldSize,0,1);return W.transformMat4(n,n,this.pixelMatrix),new Ma(n[0]/n[3],n[1]/n[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return o_.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(!(!this.center||!this.width||!this.height||this.constraining)){this.constraining=!0;var t=-90,n=90,i=-180,a=180,o,l,c,h,_=this.size,x=this.unmodified;if(this.latRange){var E=this.latRange;t=a_(E[1])*this.worldSize,n=a_(E[0])*this.worldSize,o=n-t<_.y?_.y/(n-t):0}if(this.lngRange){var C=this.lngRange;i=i_(C[0])*this.worldSize,a=i_(C[1])*this.worldSize,l=a-i<_.x?_.x/(a-i):0}var I=this.point,P=Math.max(l||0,o||0);if(P){this.center=this.unproject(new Ma(l?(a+i)/2:I.x,o?(n+t)/2:I.y)),this.zoom+=this.scaleZoom(P),this.unmodified=x,this.constraining=!1;return}if(this.latRange){var B=I.y,U=_.y/2;B-U<t&&(h=t+U),B+U>n&&(h=n-U)}if(this.lngRange){var ee=I.x,ie=_.x/2;ee-ie<i&&(c=i+ie),ee+ie>a&&(c=a-ie)}(c!==void 0||h!==void 0)&&(this.center=this.unproject(new Ma(c!==void 0?c:I.x,h!==void 0?h:I.y))),this.unmodified=x,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(!!this.height){var t=this._fov/2,n=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var i=Math.PI/2+this._pitch,a=this._fov*(.5+n.y/this.height),o=Math.sin(a)*this.cameraToCenterDistance/Math.sin(vp(Math.PI-i-a,.01,Math.PI-.01)),l=this.point,c=l.x,h=l.y,_=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,x=_*1.01,E=this.height/50,C=new Float64Array(16);N.perspective(C,this._fov,this.width/this.height,E,x),C[8]=-n.x*2/this.width,C[9]=n.y*2/this.height,N.scale(C,C,[1,-1,1]),N.translate(C,C,[0,0,-this.cameraToCenterDistance]),N.rotateX(C,C,this._pitch),N.rotateZ(C,C,this.angle),N.translate(C,C,[-c,-h,0]),this.mercatorMatrix=N.scale([],C,[this.worldSize,this.worldSize,this.worldSize]),N.scale(C,C,[1,1,w3(1,this.center.lat)*this.worldSize,1]),this.projMatrix=C,this.invProjMatrix=N.invert([],this.projMatrix);var I=this.width%2/2,P=this.height%2/2,B=Math.cos(this.angle),U=Math.sin(this.angle),ee=c-Math.round(c)+B*I+U*P,ie=h-Math.round(h)+B*P+U*I,_e=new Float64Array(C);if(N.translate(_e,_e,[ee>.5?ee-1:ee,ie>.5?ie-1:ie,0]),this.alignedProjMatrix=_e,C=N.create(),N.scale(C,C,[this.width/2,-this.height/2,1]),N.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=N.create(),N.scale(C,C,[1,-1,1]),N.translate(C,C,[-1,-1,0]),N.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=N.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),C=N.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");this.pixelMatrixInverse=C,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),e}(),v9=xi.merge,io=Object(Rt.a)(function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Object(Et.a)(this,e),v9(this,t),this.type=r});function m9(e){var r=g9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function g9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ih=xi.merge,R3=function(e){Object(qr.a)(t,e);var r=m9(t);function t(n){var i;Object(Et.a)(this,t),i=r.call(this),Object(L.a)(Object(De.a)(i),"renderFrameCallback",function(){var _=Math.min((hd()-i.easeStart)/i.easeOptions.duration,1);i.onEaseFrame(i.easeOptions.easing(_)),_<1?i.easeFrameId=i.requestRenderFrame(i.renderFrameCallback):i.stop()}),i.options=n;var a=n.minZoom,o=n.maxZoom,l=n.minPitch,c=n.maxPitch,h=n.renderWorldCopies;return i.moving=!1,i.zooming=!1,i.bearingSnap=n.bearingSnap,i.pitchEnabled=n.pitchEnabled,i.rotateEnabled=n.rotateEnabled,i.transform=new d9(a,o,l,c,h),i}return Object(Rt.a)(t,[{key:"requestRenderFrame",value:function(i){return 0}},{key:"cancelRenderFrame",value:function(i){}},{key:"getCenter",value:function(){var i=this.transform.center,a=i.lng,o=i.lat;return new ko(a,o)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(i,a){return this.jumpTo({center:i},a)}},{key:"setPitch",value:function(i,a){return this.jumpTo({pitch:i},a),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(i,a,o){return this.easeTo(Ih({center:i},a),o)}},{key:"panBy",value:function(i,a,o){return i=Ma.convert(i).mult(-1),this.panTo(this.transform.center,s9({offset:i},a||{}),o)}},{key:"zoomOut",value:function(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}},{key:"setBearing",value:function(i,a){return this.jumpTo({bearing:i},a),this}},{key:"setZoom",value:function(i,a){return this.jumpTo({zoom:i},a),this}},{key:"zoomIn",value:function(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}},{key:"zoomTo",value:function(i,a,o){return this.easeTo(Ih({zoom:i},a),o)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(i,a){return this.jumpTo({padding:i},a),this}},{key:"rotateTo",value:function(i,a,o){return this.easeTo(Ih({bearing:i},a),o)}},{key:"resetNorth",value:function(i,a){return this.rotateTo(0,Ih({duration:1e3},i),a),this}},{key:"resetNorthPitch",value:function(i,a){return this.easeTo(Ih({bearing:0,pitch:0,duration:1e3},i),a),this}},{key:"fitBounds",value:function(i,a,o){return this.fitInternal(this.cameraForBounds(i,a),a,o)}},{key:"cameraForBounds",value:function(i,a){return i=oy.convert(i),this.cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),0,a)}},{key:"snapToNorth",value:function(i,a){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(i,a):this}},{key:"jumpTo",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0;this.stop();var o=this.transform,l=!1,c=!1,h=!1;return i.zoom!==void 0&&o.zoom!==+i.zoom&&(l=!0,o.zoom=+i.zoom),i.center!==void 0&&(o.center=ko.convert(i.center)),i.bearing!==void 0&&o.bearing!==+i.bearing&&(c=!0,o.bearing=+i.bearing),i.pitch!==void 0&&o.pitch!==+i.pitch&&(h=!0,o.pitch=+i.pitch),i.padding!==void 0&&!o.isPaddingEqual(i.padding)&&(o.padding=i.padding),this.emit("movestart",new io("movestart",a)),this.emit("move",new io("move",a)),l&&(this.emit("zoomstart",new io("zoomstart",a)),this.emit("zoom",new io("zoom",a)),this.emit("zoomend",new io("zoomend",a))),c&&(this.emit("rotatestart",new io("rotatestart",a)),this.emit("rotate",new io("rotate",a)),this.emit("rotateend",new io("rotateend",a))),h&&(this.emit("pitchstart",new io("pitchstart",a)),this.emit("pitch",new io("pitch",a)),this.emit("pitchend",new io("pitchend",a))),this.emit("moveend",new io("moveend",a))}},{key:"easeTo",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;a=Ih({offset:[0,0],duration:500,easing:yb},a),(a.animate===!1||!a.essential&&S3())&&(a.duration=0);var l=this.transform,c=this.getZoom(),h=this.getBearing(),_=this.getPitch(),x=this.getPadding(),E=a.zoom?+a.zoom:c,C=a.bearing?this.normalizeBearing(a.bearing,h):h,I=a.pitch?+a.pitch:_,P=a.padding?a.padding:l.padding,B=Ma.convert(a.offset),U=l.centerPoint.add(B),ee=l.pointLocation(U),ie=ko.convert(a.center||ee);this.normalizeCenter(ie);var _e=l.project(ee),Oe=l.project(ie).sub(_e),ke=l.zoomScale(E-c),Ke,ot;a.around&&(Ke=ko.convert(a.around),ot=l.locationPoint(Ke));var Ot={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||E!==c,this.rotating=this.rotating||h!==C,this.pitching=this.pitching||I!==_,this.padding=!l.isPaddingEqual(P),this.easeId=a.easeId,this.prepareEase(o,a.noMoveStart,Ot),clearTimeout(this.easeEndTimeoutID),this.ease(function(Zt){if(i.zooming&&(l.zoom=hf(c,E,Zt)),i.rotating&&i.rotateEnabled&&(l.bearing=hf(h,C,Zt)),i.pitching&&i.pitchEnabled&&(l.pitch=hf(_,I,Zt)),i.padding&&(l.interpolatePadding(x,P,Zt),U=l.centerPoint.add(B)),Ke)l.setLocationAtPoint(Ke,ot);else{var ir=l.zoomScale(l.zoom-c),Hr=E>c?Math.min(2,ke):Math.max(.5,ke),ln=Math.pow(Hr,1-Zt),pn=l.unproject(_e.add(Oe.mult(Zt*ln)).mult(ir));l.setLocationAtPoint(l.renderWorldCopies?pn.wrap():pn,U)}i.fireMoveEvents(o)},function(Zt){i.afterEase(o,Zt)},a),this}},{key:"flyTo",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0;if(!a.essential&&S3()){var l=i9(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(l,o)}this.stop(),a=Ih({offset:[0,0],speed:1.2,curve:1.42,easing:yb},a);var c=this.transform,h=this.getZoom(),_=this.getBearing(),x=this.getPitch(),E=this.getPadding(),C=a.zoom?vp(+a.zoom,c.minZoom,c.maxZoom):h,I=a.bearing?this.normalizeBearing(a.bearing,_):_,P=a.pitch?+a.pitch:x,B="padding"in a?a.padding:c.padding,U=c.zoomScale(C-h),ee=Ma.convert(a.offset),ie=c.centerPoint.add(ee),_e=c.pointLocation(ie),Oe=ko.convert(a.center||_e);this.normalizeCenter(Oe);var ke=c.project(_e),Ke=c.project(Oe).sub(ke),ot=a.curve,Ot=Math.max(c.width,c.height),Zt=Ot/U,ir=Ke.mag();if("minZoom"in a){var Hr=vp(Math.min(a.minZoom,h,C),c.minZoom,c.maxZoom),ln=Ot/c.zoomScale(Hr-h);ot=Math.sqrt(ln/ir*2)}var pn=ot*ot;function Ci(co){var ol=(Zt*Zt-Ot*Ot+(co?-1:1)*pn*pn*ir*ir)/(2*(co?Zt:Ot)*pn*ir);return Math.log(Math.sqrt(ol*ol+1)-ol)}function Ba(co){return(Math.exp(co)-Math.exp(-co))/2}function Sa(co){return(Math.exp(co)+Math.exp(-co))/2}function La(co){return Ba(co)/Sa(co)}var wa=Ci(0),Ds=function(ol){return Sa(wa)/Sa(wa+ot*ol)},Mc=function(ol){return Ot*((Sa(wa)*La(wa+ot*ol)-Ba(wa))/pn)/ir},al=(Ci(1)-wa)/ot;if(Math.abs(ir)<1e-6||!isFinite(al)){if(Math.abs(Ot-Zt)<1e-6)return this.easeTo(a,o);var pf=Zt<Ot?-1:1;al=Math.abs(Math.log(Zt/Ot))/ot,Mc=function(){return 0},Ds=function(ol){return Math.exp(pf*ot*ol)}}if("duration"in a)a.duration=+a.duration;else{var pd="screenSpeed"in a?+a.screenSpeed/ot:+a.speed;a.duration=1e3*al/pd}return a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this.zooming=!0,this.rotating=_!==I,this.pitching=P!==x,this.padding=!c.isPaddingEqual(B),this.prepareEase(o,!1),this.ease(function(co){var ol=co*al,Lm=1/Ds(ol);c.zoom=co===1?C:h+c.scaleZoom(Lm),i.rotating&&(c.bearing=hf(_,I,co)),i.pitching&&(c.pitch=hf(x,P,co)),i.padding&&(c.interpolatePadding(E,B,co),ie=c.centerPoint.add(ee));var Nm=co===1?Oe:c.unproject(ke.add(Ke.mult(Mc(ol))).mult(Lm));c.setLocationAtPoint(c.renderWorldCopies?Nm.wrap():Nm,ie),i.fireMoveEvents(o)},function(){return i.afterEase(o)},a),this}},{key:"fitScreenCoordinates",value:function(i,a,o,l,c){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Ma.convert(i)),this.transform.pointLocation(Ma.convert(a)),o,l),l,c)}},{key:"stop",value:function(i,a){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var o=this.onEaseEnd;delete this.onEaseEnd,o.call(this,a)}return this}},{key:"normalizeBearing",value:function(i,a){i=mb(i,-180,180);var o=Math.abs(i-a);return Math.abs(i-360-a)<o&&(i-=360),Math.abs(i+360-a)<o&&(i+=360),i}},{key:"normalizeCenter",value:function(i){var a=this.transform;if(!(!a.renderWorldCopies||a.lngRange)){var o=i.lng-a.center.lng;i.lng+=o>180?-360:o<-180?360:0}}},{key:"fireMoveEvents",value:function(i){this.emit("move",new io("move",i)),this.zooming&&this.emit("zoom",new io("zoom",i)),this.rotating&&this.emit("rotate",new io("rotate",i)),this.pitching&&this.emit("rotate",new io("pitch",i))}},{key:"prepareEase",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.moving=!0,!a&&!o.moving&&this.emit("movestart",new io("movestart",i)),this.zooming&&!o.zooming&&this.emit("zoomstart",new io("zoomstart",i)),this.rotating&&!o.rotating&&this.emit("rotatestart",new io("rotatestart",i)),this.pitching&&!o.pitching&&this.emit("pitchstart",new io("pitchstart",i))}},{key:"afterEase",value:function(i,a){if(!(this.easeId&&a&&this.easeId===a)){delete this.easeId;var o=this.zooming,l=this.rotating,c=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,o&&this.emit("zoomend",new io("zoomend",i)),l&&this.emit("rotateend",new io("rotateend",i)),c&&this.emit("pitchend",new io("pitchend",i)),this.emit("moveend",new io("moveend",i))}}},{key:"ease",value:function(i,a,o){o.animate===!1||o.duration===0?(i(1),a()):(this.easeStart=hd(),this.easeOptions=o,this.onEaseFrame=i,this.onEaseEnd=a,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(i,a,o,l){var c={top:0,bottom:0,right:0,left:0};if(l=Ih({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},l),typeof l.padding=="number"){var h=l.padding;l.padding={top:h,bottom:h,right:h,left:h}}l.padding=Ih(c,l.padding);var _=this.transform,x=_.padding,E=_.project(ko.convert(i)),C=_.project(ko.convert(a)),I=E.rotate(-o*Math.PI/180),P=C.rotate(-o*Math.PI/180),B=new Ma(Math.max(I.x,P.x),Math.max(I.y,P.y)),U=new Ma(Math.min(I.x,P.x),Math.min(I.y,P.y)),ee=B.sub(U),ie=(_.width-(x.left+x.right+l.padding.left+l.padding.right))/ee.x,_e=(_.height-(x.top+x.bottom+l.padding.top+l.padding.bottom))/ee.y;if(!(_e<0||ie<0)){var Oe=Math.min(_.scaleZoom(_.scale*Math.min(ie,_e)),l.maxZoom),ke=Ma.convert(l.offset),Ke=(l.padding.left-l.padding.right)/2,ot=(l.padding.top-l.padding.bottom)/2,Ot=new Ma(ke.x+Ke,ke.y+ot),Zt=Ot.mult(_.scale/_.zoomScale(Oe)),ir=_.unproject(E.add(C).div(2).sub(Zt));return{center:ir,zoom:Oe,bearing:o}}}},{key:"fitInternal",value:function(i,a,o){return i?(a=Ih(i,a),delete a.padding,a.linear?this.easeTo(a,o):this.flyTo(a,o)):this}}]),t}(uo.EventEmitter);function M3(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=y9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function y9(e,r){if(!!e){if(typeof e=="string")return P3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return P3(e,r)}}function P3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Rc={},Wu=Rc;Rc.create=function(e,r,t){var n=window.document.createElement(e);return r!==void 0&&(n.className=r),t&&t.appendChild(n),n},Rc.createNS=function(e,r){var t=window.document.createElementNS(e,r);return t};var pv=window.document&&window.document.documentElement.style;function I3(e){if(!pv)return e[0];var r=M3(e),t;try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n in pv)return n}}catch(i){r.e(i)}finally{r.f()}return e[0]}var sy=I3(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k3;Rc.disableDrag=function(){pv&&sy&&(k3=pv[sy],pv[sy]="none")},Rc.enableDrag=function(){pv&&sy&&(pv[sy]=k3)};var _9=I3(["transform","WebkitTransform"]);Rc.setTransform=function(e,r){e.style[_9]=r};var s_=!1;try{var u_=Object.defineProperty({},"passive",{get:function(){s_=!0}});window.addEventListener("test",u_,u_),window.removeEventListener("test",u_,u_)}catch(e){s_=!1}Rc.addEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&s_?e.addEventListener(r,t,n):e.addEventListener(r,t,n.capture)},Rc.removeEventListener=function(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};"passive"in n&&s_?e.removeEventListener(r,t,n):e.removeEventListener(r,t,n.capture)};var D3=function e(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",e,!0)};Rc.suppressClick=function(){window.addEventListener("click",D3,!0),setTimeout(function(){window.removeEventListener("click",D3,!0)},0)},Rc.mousePos=function(e,r){var t=e.getBoundingClientRect();return new Ma(r.clientX-t.left-e.clientLeft,r.clientY-t.top-e.clientTop)},Rc.touchPos=function(e,r){var t=e.getBoundingClientRect(),n=[],i=M3(r),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;n.push(new Ma(o.clientX-t.left-e.clientLeft,o.clientY-t.top-e.clientTop))}}catch(l){i.e(l)}finally{i.f()}return n},Rc.mouseButton=function(e){return e.button},Rc.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};function b9(e){var r=x9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function x9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var E9=xi.merge,mp=function(e){Object(qr.a)(t,e);var r=b9(t);function t(n,i,a){var o,l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};Object(Et.a)(this,t);var c=Wu.mousePos(i.getCanvasContainer(),a),h=i.unproject(c);return o=r.call(this,n,E9({point:c,lngLat:h,originalEvent:a},l)),o.defaultPrevented=!1,o.target=i,o}return Object(Rt.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(io);function S9(e){var r=A9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function A9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l_=function(e){Object(qr.a)(t,e);var r=S9(t);function t(n,i,a){var o;Object(Et.a)(this,t);var l=n==="touchend"?a.changedTouches:a.touches,c=Wu.touchPos(i.getCanvasContainer(),l),h=c.map(function(E){return i.unproject(E)}),_=c.reduce(function(E,C,I,P){return E.add(C.div(P.length))},new Ma(0,0)),x=i.unproject(_);return o=r.call(this,n,{points:c,point:_,lngLats:h,lngLat:x,originalEvent:a}),o.defaultPrevented=!1,o}return Object(Rt.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(io);function T9(e){var r=C9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function C9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var w9=function(e){Object(qr.a)(t,e);var r=T9(t);function t(n,i,a){var o;return Object(Et.a)(this,t),o=r.call(this,n,{originalEvent:a}),o.defaultPrevented=!1,o}return Object(Rt.a)(t,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),t}(io),O9=function(){function e(r){Object(Et.a)(this,e),this.map=r}return Object(Rt.a)(e,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new mp(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new mp("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new mp(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),e}(),R9=function(){function e(r,t){Object(Et.a)(this,e),this.map=r,this.el=r.getCanvasContainer(),this.container=r.getContainer(),this.clickTolerance=t.clickTolerance||1}return Object(Rt.a)(e,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"mousedown",value:function(t,n){!this.isEnabled()||!(t.shiftKey&&t.button===0)||(Wu.disableDrag(),this.startPos=this.lastPos=n,this.active=!0)}},{key:"mousemoveWindow",value:function(t,n){if(!!this.active){var i=n;if(!(this.lastPos.equals(i)||!this.box&&i.dist(this.startPos)<this.clickTolerance)){var a=this.startPos;this.lastPos=i,this.box||(this.box=Wu.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var o=Math.min(a.x,i.x),l=Math.max(a.x,i.x),c=Math.min(a.y,i.y),h=Math.max(a.y,i.y);Wu.setTransform(this.box,"translate(".concat(o,"px,").concat(c,"px)")),this.box&&(this.box.style.width="".concat(l-o,"px"),this.box.style.height="".concat(h-c,"px"))}}}},{key:"mouseupWindow",value:function(t,n){var i=this;if(!!this.active&&t.button===0){var a=this.startPos,o=n;if(this.reset(),Wu.suppressClick(),a.x===o.x&&a.y===o.y)this.fireEvent("boxzoomcancel",t);else return this.map.emit("boxzoomend",new io("boxzoomend",{originalEvent:t})),{cameraAnimation:function(c){return c.fitScreenCoordinates(a,o,i.map.getBearing(),{linear:!0})}}}}},{key:"keydown",value:function(t){!this.active||t.keyCode===27&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(Wu.remove(this.box),this.box=null),Wu.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,n){return this.map.emit(t,new io(t,{originalEvent:n}))}}]),e}(),M9=R9,P9=function(){function e(){Object(Et.a)(this,e),this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,n){return t.preventDefault(),{cameraAnimation:function(a){a.easeTo({duration:300,zoom:a.getZoom()+(t.shiftKey?-1:1),around:a.unproject(n)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function I9(e){var r=k9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function k9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D9=function(e){Object(qr.a)(t,e);var r=I9(t);function t(){var n;Object(Et.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),Object(L.a)(Object(De.a)(n),"type","renderFrame"),n}return Object(Rt.a)(t)}(io);function F9(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=B9(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function B9(e,r){if(!!e){if(typeof e=="string")return F3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return F3(e,r)}}function F3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Pm=xi.merge,c_={linearity:.3,easing:gb(0,0,.3,1)},L9=Pm({deceleration:2500,maxSpeed:1400},c_),N9=Pm({deceleration:20,maxSpeed:1400},c_),j9=Pm({deceleration:1e3,maxSpeed:360},c_),z9=Pm({deceleration:1e3,maxSpeed:90},c_),U9=function(){function e(r){Object(Et.a)(this,e),this.map=r,this.clear()}return Object(Rt.a)(e,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:hd(),settings:t})}},{key:"drainInertiaBuffer",value:function(){for(var t=this.inertiaBuffer,n=hd(),i=160;t.length>0&&n-t[0].time>i;)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var n={zoom:0,bearing:0,pitch:0,pan:new Ma(0,0),pinchAround:void 0,around:void 0},i=F9(this.inertiaBuffer),a;try{for(i.s();!(a=i.n()).done;){var o=a.value.settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}}catch(P){i.e(P)}finally{i.f()}var l=this.inertiaBuffer[this.inertiaBuffer.length-1],c=l.time-this.inertiaBuffer[0].time,h={};if(n.pan.mag()){var _=h_(n.pan.mag(),c,Pm({},L9,t||{}));h.offset=n.pan.mult(_.amount/n.pan.mag()),h.center=this.map.transform.center,f_(h,_)}if(n.zoom){var x=h_(n.zoom,c,N9);h.zoom=this.map.transform.zoom+x.amount,f_(h,x)}if(n.bearing){var E=h_(n.bearing,c,j9);h.bearing=this.map.transform.bearing+vp(E.amount,-179,179),f_(h,E)}if(n.pitch){var C=h_(n.pitch,c,z9);h.pitch=this.map.transform.pitch+C.amount,f_(h,C)}if(h.zoom||h.bearing){var I=n.pinchAround===void 0?n.around:n.pinchAround;h.around=I?this.map.unproject(I):this.map.getCenter()}return this.clear(),Pm(h,{noMoveStart:!0})}}}]),e}();function f_(e,r){(!e.duration||e.duration<r.duration)&&(e.duration=r.duration,e.easing=r.easing)}function h_(e,r,t){var n=t.maxSpeed,i=t.linearity,a=t.deceleration,o=vp(e*i/(r/1e3),-n,n),l=Math.abs(o)/(a*i);return{easing:t.easing,duration:l*1e3,amount:o*(l/2)}}var V9={panStep:100,bearingStep:15,pitchStep:10},H9=function(){function e(){Object(Et.a)(this,e);var r=V9;this.panStep=r.panStep,this.bearingStep=r.bearingStep,this.pitchStep=r.pitchStep}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var n=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var i=0,a=0,o=0,l=0,c=0;switch(t.keyCode){case 61:case 107:case 171:case 187:i=1;break;case 189:case 109:case 173:i=-1;break;case 37:t.shiftKey?a=-1:(t.preventDefault(),l=-1);break;case 39:t.shiftKey?a=1:(t.preventDefault(),l=1);break;case 38:t.shiftKey?o=1:(t.preventDefault(),c=-1);break;case 40:t.shiftKey?o=-1:(t.preventDefault(),c=1);break;default:return}return{cameraAnimation:function(_){var x=_.getZoom();_.easeTo({duration:300,easeId:"keyboardHandler",easing:W9,zoom:i?Math.round(x)+i*(t.shiftKey?2:1):x,bearing:_.getBearing()+a*n.bearingStep,pitch:_.getPitch()+o*n.pitchStep,offset:[-l*n.panStep,-c*n.panStep],center:_.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function W9(e){return e*(2-e)}var G9=H9,X9=function(){function e(r,t){Object(Et.a)(this,e),this.map=r,this.clickTolerance=t.clickTolerance}return Object(Rt.a)(e,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new w9(t.type,this.map,t))}},{key:"mousedown",value:function(t,n){return this.mousedownPos=n,this.firePreventable(new mp(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new mp(t.type,this.map,t))}},{key:"click",value:function(t,n){this.mousedownPos&&this.mousedownPos.dist(n)>=this.clickTolerance||this.map.emit(t.type,new mp(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new mp(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new mp(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new mp(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new l_(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new l_(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new l_(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new l_(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),e}(),p_,d_=0,bb=2,Z9=(p_={},Object(L.a)(p_,d_,1),Object(L.a)(p_,bb,2),p_);function $9(e,r){var t=Z9[r];return e.buttons===void 0||(e.buttons&t)!==t}var xb=function(){function e(r){Object(Et.a)(this,e),this.reset(),this.clickTolerance=r.clickTolerance||1}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,n){if(!this.lastPoint){var i=Wu.mouseButton(t);!this.correctButton(t,i)||(this.lastPoint=n,this.eventButton=i)}}},{key:"mousemoveWindow",value:function(t,n){var i=this.lastPoint;if(!!i){if(t.preventDefault(),$9(t,this.eventButton)){this.reset();return}if(!(!this.moved&&n.dist(i)<this.clickTolerance))return this.moved=!0,this.lastPoint=n,this.move(i,n)}}},{key:"mouseupWindow",value:function(t){if(!!this.lastPoint){var n=Wu.mouseButton(t);n===this.eventButton&&(this.moved&&Wu.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,n){return!1}},{key:"move",value:function(t,n){}}]),e}();function Y9(e){var r=K9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function K9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q9=function(e){Object(qr.a)(t,e);var r=Y9(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"mousedown",value:function(i,a){Object(Ea.a)(Object(ut.a)(t.prototype),"mousedown",this).call(this,i,a),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(i,a){return{around:a,panDelta:a.sub(i)}}},{key:"correctButton",value:function(i,a){return a===d_&&!i.ctrlKey}}]),t}(xb);function Q9(e){var r=J9();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function J9(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eV=function(e){Object(qr.a)(t,e);var r=Q9(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"correctButton",value:function(i,a){return a===d_&&i.ctrlKey||a===bb}},{key:"move",value:function(i,a){var o=-.5,l=(a.y-i.y)*o;if(l)return this.active=!0,{pitchDelta:l}}},{key:"contextmenu",value:function(i){i.preventDefault()}}]),t}(xb);function tV(e){var r=rV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function rV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nV=function(e){Object(qr.a)(t,e);var r=tV(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"contextmenu",value:function(i){i.preventDefault()}},{key:"correctButton",value:function(i,a){return a===d_&&i.ctrlKey||a===bb}},{key:"move",value:function(i,a){var o=.8,l=(a.x-i.x)*o;if(l)return this.active=!0,{bearingDelta:l}}}]),t}(xb),B3=4.000244140625,iV=1/100,aV=1/450,oV=2,sV=function(){function e(r,t){var n=this;Object(Et.a)(this,e),Object(L.a)(this,"onScrollFrame",function(){if(!!n.frameId&&(n.frameId=null,!!n.isActive())){var i=n.map.transform;if(n.delta!==0){var a=n.type==="wheel"&&Math.abs(n.delta)>B3?n.wheelZoomRate:n.defaultZoomRate,o=oV/(1+Math.exp(-Math.abs(n.delta*a)));n.delta<0&&o!==0&&(o=1/o);var l=typeof n.targetZoom=="number"?i.zoomScale(n.targetZoom):i.scale;n.targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(l*o))),n.type==="wheel"&&(n.startZoom=i.zoom,n.easing=n.smoothOutEasing(200)),n.delta=0}var c=typeof n.targetZoom=="number"?n.targetZoom:i.zoom,h=n.startZoom,_=n.easing,x=!1,E;if(n.type==="wheel"&&h&&_){var C=Math.min((hd()-n.lastWheelEventTime)/200,1),I=_(C);E=hf(h,c,I),C<1?n.frameId||(n.frameId=!0):x=!0}else E=c,x=!0;return n.active=!0,x&&(n.active=!1,n.finishTimeout=setTimeout(function(){n.zooming=!1,n.handler.triggerRenderFrame(),delete n.targetZoom,delete n.finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:E-i.zoom,around:n.aroundPoint,originalEvent:n.lastWheelEvent}}}),this.map=r,this.el=r.getCanvasContainer(),this.handler=t,this.delta=0,this.defaultZoomRate=iV,this.wheelZoomRate=aV}return Object(Rt.a)(e,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||this.finishTimeout!==void 0}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&t.around==="center")}},{key:"disable",value:function(){!this.isEnabled()||(this.enabled=!1)}},{key:"wheel",value:function(t){if(!!this.isEnabled()){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?t.deltaY*40:t.deltaY,i=hd(),a=i-(this.lastWheelEventTime||0);this.lastWheelEventTime=i,n!==0&&n%B3==0?this.type="wheel":n!==0&&Math.abs(n)<4?this.type="trackpad":a>400?(this.type=null,this.lastValue=n,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(a*n)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,n+=this.lastValue)),t.shiftKey&&n&&(n=n/4),this.type&&(this.lastWheelEvent=t,this.delta-=n,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(!!this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var n=Wu.mousePos(this.el,t);this.around=ko.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(n)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var n=yb;if(this.prevEase){var i=this.prevEase,a=(hd()-i.start)/i.duration,o=i.easing(a+.01)-i.easing(a),l=.27/Math.sqrt(o*o+1e-4)*.01,c=Math.sqrt(.27*.27-l*l);n=gb(l,c,.25,1)}return this.prevEase={start:hd(),duration:t,easing:n},n}}]),e}(),uV=sV,lV=function(){function e(r,t){Object(Et.a)(this,e),this.clickZoom=r,this.tapZoom=t}return Object(Rt.a)(e,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),e}(),cV=function(){function e(r,t,n){Object(Et.a)(this,e),this.el=r,this.mousePan=t,this.touchPan=n}return Object(Rt.a)(e,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),e}(),fV=function(){function e(r,t,n){Object(Et.a)(this,e),this.pitchWithRotate=r.pitchWithRotate,this.mouseRotate=t,this.mousePitch=n}return Object(Rt.a)(e,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),e}(),hV=function(){function e(r,t,n,i){Object(Et.a)(this,e),this.el=r,this.touchZoom=t,this.touchRotate=n,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return Object(Rt.a)(e,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),e}();function Eb(e,r){for(var t={},n=0;n<e.length;n++)t[e[n].identifier]=r[n];return t}function pV(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=dV(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function dV(e,r){if(!!e){if(typeof e=="string")return L3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return L3(e,r)}}function L3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function vV(e){var r=new Ma(0,0),t=pV(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;r._add(i)}}catch(a){t.e(a)}finally{t.f()}return r.div(e.length)}var N3=500,mV=500,j3=30,gV=function(){function e(r){Object(Et.a)(this,e),this.reset(),this.numTouches=r.numTouches}return Object(Rt.a)(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),!this.aborted&&(this.startTime===void 0&&(this.startTime=t.timeStamp),i.length===this.numTouches&&(this.centroid=vV(n),this.touches=Eb(i,n)))}},{key:"touchmove",value:function(t,n,i){if(!(this.aborted||!this.centroid)){var a=Eb(i,n);for(var o in this.touches)if(this.touches[o]){var l=this.touches[o],c=a[o];(!c||c.dist(l)>j3)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,n,i){if((!this.centroid||t.timeStamp-this.startTime>mV)&&(this.aborted=!0),i.length===0){var a=!this.aborted&&this.centroid;if(this.reset(),a)return a}}}]),e}(),Sb=function(){function e(r){Object(Et.a)(this,e),this.singleTap=new gV(r),this.numTaps=r.numTaps,this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.lastTime=Infinity,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,n,i){this.singleTap.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.singleTap.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var a=this.singleTap.touchend(t,n,i);if(a){var o=t.timeStamp-this.lastTime<N3,l=!this.lastTap||this.lastTap.dist(a)<j3;if((!o||!l)&&this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=a,this.count===this.numTaps)return this.reset(),a}}}]),e}(),yV=function(){function e(){Object(Et.a)(this,e),this.tap=new Sb({numTouches:1,numTaps:1}),this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,n,i){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>N3&&this.reset(),this.tapTime?i.length>0&&(this.swipePoint=n[0],this.swipeTouch=i[0].identifier):this.tap.touchstart(t,n,i))}},{key:"touchmove",value:function(t,n,i){if(!this.tapTime)this.tap.touchmove(t,n,i);else if(this.swipePoint){if(i[0].identifier!==this.swipeTouch)return;var a=n[0],o=a.y-this.swipePoint.y;return this.swipePoint=a,t.preventDefault(),this.active=!0,{zoomDelta:o/128}}}},{key:"touchend",value:function(t,n,i){if(this.tapTime)this.swipePoint&&i.length===0&&this.reset();else{var a=this.tap.touchend(t,n,i);a&&(this.tapTime=t.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),_V=function(){function e(){Object(Et.a)(this,e),this.zoomIn=new Sb({numTouches:1,numTaps:2}),this.zoomOut=new Sb({numTouches:2,numTaps:1}),this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,n,i){this.zoomIn.touchstart(t,n,i),this.zoomOut.touchstart(t,n,i)}},{key:"touchmove",value:function(t,n,i){this.zoomIn.touchmove(t,n,i),this.zoomOut.touchmove(t,n,i)}},{key:"touchend",value:function(t,n,i){var a=this,o=this.zoomIn.touchend(t,n,i),l=this.zoomOut.touchend(t,n,i);if(o)return this.active=!0,t.preventDefault(),setTimeout(function(){return a.reset()},0),{cameraAnimation:function(h){return h.easeTo({duration:300,zoom:h.getZoom()+1,around:h.unproject(o)},{originalEvent:t})}};if(l)return this.active=!0,t.preventDefault(),setTimeout(function(){return a.reset()},0),{cameraAnimation:function(h){return h.easeTo({duration:300,zoom:h.getZoom()-1,around:h.unproject(l)},{originalEvent:t})}}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}(),bV=function(){function e(r){Object(Et.a)(this,e),this.minTouches=1,this.clickTolerance=r.clickTolerance||1,this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Ma(0,0)}},{key:"touchstart",value:function(t,n,i){return this.calculateTransform(t,n,i)}},{key:"touchmove",value:function(t,n,i){if(!!this.active)return t.preventDefault(),this.calculateTransform(t,n,i)}},{key:"touchend",value:function(t,n,i){this.calculateTransform(t,n,i),this.active&&i.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,n,i){i.length>0&&(this.active=!0);var a=Eb(i,n),o=new Ma(0,0),l=new Ma(0,0),c=0;for(var h in a)if(a[h]){var _=a[h],x=this.touches[h];x&&(o._add(_),l._add(_.sub(x)),c++,a[h]=_)}if(this.touches=a,!(c<this.minTouches||!l.mag())){var E=l.div(c);if(this.sum._add(E),!(this.sum.mag()<this.clickTolerance)){var C=o.div(c);return{around:C,panDelta:E}}}}}]),e}(),Ab=function(){function e(){Object(Et.a)(this,e),this.reset()}return Object(Rt.a)(e,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,n,i){}},{key:"touchstart",value:function(t,n,i){this.firstTwoTouches||i.length<2||(this.firstTwoTouches=[i[0].identifier,i[1].identifier],this.start([n[0],n[1]]))}},{key:"touchmove",value:function(t,n,i){if(!!this.firstTwoTouches){t.preventDefault();var a=Object(Bn.a)(this.firstTwoTouches,2),o=a[0],l=a[1],c=v_(i,n,o),h=v_(i,n,l);if(!(!c||!h)){var _=this.aroundCenter?null:c.add(h).div(2);return this.move([c,h],_,t)}}}},{key:"touchend",value:function(t,n,i){if(!!this.firstTwoTouches){var a=Object(Bn.a)(this.firstTwoTouches,2),o=a[0],l=a[1],c=v_(i,n,o),h=v_(i,n,l);c&&h||(this.active&&Wu.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&t.around==="center"}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),e}();function v_(e,r,t){for(var n=0;n<e.length;n++)if(e[n].identifier===t)return r[n]}function xV(e){var r=EV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function EV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Tb(e){return Math.abs(e.y)>Math.abs(e.x)}var SV=100,AV=function(e){Object(qr.a)(t,e);var r=xV(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"reset",value:function(){Object(Ea.a)(Object(ut.a)(t.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(i){this.lastPoints=i,Tb(i[0].sub(i[1]))&&(this.valid=!1)}},{key:"move",value:function(i,a,o){var l=i[0].sub(this.lastPoints[0]),c=i[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(l,c,o.timeStamp),!!this.valid){this.lastPoints=i,this.active=!0;var h=(l.y+c.y)/2,_=-.5;return{pitchDelta:h*_}}}},{key:"gestureBeginsVertically",value:function(i,a,o){if(this.valid!==void 0)return this.valid;var l=2,c=i.mag()>=l,h=a.mag()>=l;if(!(!c&&!h)){if(!c||!h)return this.firstMove===void 0&&(this.firstMove=o),o-this.firstMove<SV?void 0:!1;var _=i.y>0==a.y>0;return Tb(i)&&Tb(a)&&_}}}]),t}(Ab);function TV(e){var r=CV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function CV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wV=25;function z3(e,r){return e.angleWith(r)*180/Math.PI}var OV=function(e){Object(qr.a)(t,e);var r=TV(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"reset",value:function(){Object(Ea.a)(Object(ut.a)(t.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(i){this.startVector=this.vector=i[0].sub(i[1]),this.minDiameter=i[0].dist(i[1])}},{key:"move",value:function(i,a){var o=this.vector;if(this.vector=i[0].sub(i[1]),!(!this.active&&this.isBelowThreshold(this.vector)))return this.active=!0,{bearingDelta:z3(this.vector,o),pinchAround:a}}},{key:"isBelowThreshold",value:function(i){this.minDiameter=Math.min(this.minDiameter,i.mag());var a=Math.PI*this.minDiameter,o=wV/a*360,l=z3(i,this.startVector);return Math.abs(l)<o}}]),t}(Ab);function RV(e){var r=MV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function MV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PV=.1;function U3(e,r){return Math.log(e/r)/Math.LN2}var IV=function(e){Object(qr.a)(t,e);var r=RV(t);function t(){return Object(Et.a)(this,t),r.apply(this,arguments)}return Object(Rt.a)(t,[{key:"reset",value:function(){Object(Ea.a)(Object(ut.a)(t.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(i){this.startDistance=this.distance=i[0].dist(i[1])}},{key:"move",value:function(i,a){var o=this.distance;if(this.distance=i[0].dist(i[1]),!(!this.active&&Math.abs(U3(this.distance,this.startDistance))<PV))return this.active=!0,{zoomDelta:U3(this.distance,o),pinchAround:a}}}]),t}(Ab);function dv(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kV(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function kV(e,r){if(!!e){if(typeof e=="string")return V3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return V3(e,r)}}function V3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Cb=xi.merge,m_=function(r){return r.zoom||r.drag||r.pitch||r.rotate};function wb(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var DV=function(){function e(r,t){var n=this;Object(Et.a)(this,e),Object(L.a)(this,"handleWindowEvent",function(x){n.handleEvent(x,"".concat(x.type,"Window"))}),Object(L.a)(this,"handleEvent",function(x,E){if(x.type==="blur"){n.stop();return}n.updatingCamera=!0;var C=x.type==="renderFrame"?void 0:x,I={needsRenderFrame:!1},P={},B={},U=x.touches?n.getMapTouches(x.touches):void 0,ee=U?Wu.touchPos(n.el,U):Wu.mousePos(n.el,x),ie=dv(n.handlers),_e;try{for(ie.s();!(_e=ie.n()).done;){var Oe=_e.value,ke=Oe.handlerName,Ke=Oe.handler,ot=Oe.allowed;if(!!Ke.isEnabled()){var Ot=void 0;if(n.blockedByActive(B,ot,ke))Ke.reset();else{var Zt=E||x.type;Ke&&Ke[Zt]&&(Ot=Ke[Zt](x,ee,U),n.mergeIHandlerResult(I,P,Ot,ke,C),Ot&&Ot.needsRenderFrame&&n.triggerRenderFrame())}(Ot||Ke.isActive())&&(B[ke]=Ke)}}}catch(pn){ie.e(pn)}finally{ie.f()}var ir={};for(var Hr in n.previousActiveHandlers)B[Hr]||(ir[Hr]=C);n.previousActiveHandlers=B,(Object.keys(ir).length||wb(I))&&(n.changes.push([I,P,ir]),n.triggerRenderFrame()),(Object.keys(B).length||wb(I))&&n.map.stop(!0),n.updatingCamera=!1;var ln=I.cameraAnimation;ln&&(n.inertia.clear(),n.fireEvents({},{}),n.changes=[],ln(n.map))}),this.map=r,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new U9(r),this.bearingSnap=t.bearingSnap,this.rotateEnabled=t.rotateEnabled,this.pitchEnabled=t.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(t);var i=this.el;this.listeners=[],this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var a=dv(this.listeners),o;try{for(a.s();!(o=a.n()).done;){var l=Object(Bn.a)(o.value,3),c=l[0],h=l[1],_=l[2];Wu.addEventListener(c,h,c===window.document?this.handleWindowEvent:this.handleEvent,_)}}catch(x){a.e(x)}finally{a.f()}}return Object(Rt.a)(e,[{key:"destroy",value:function(){var t=dv(this.listeners),n;try{for(t.s();!(n=t.n()).done;){var i=Object(Bn.a)(n.value,3),a=i[0],o=i[1],l=i[2];Wu.removeEventListener(a,o,a===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(c){t.e(c)}finally{t.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t=dv(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;i.reset()}}catch(a){t.e(a)}finally{t.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t=dv(this.handlers),n;try{for(t.s();!(n=t.n()).done;){var i=n.value.handler;if(i.isActive())return!0}}catch(a){t.e(a)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(m_(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,n,i,a,o){if(!!i){Cb(t,i);var l={handlerName:a,originalEvent:i.originalEvent||o};i.zoomDelta!==void 0&&(n.zoom=l),i.panDelta!==void 0&&(n.drag=l),i.pitchDelta!==void 0&&(n.pitch=l),i.bearingDelta!==void 0&&(n.rotate=l)}}},{key:"triggerRenderFrame",value:function(){var t=this;this.frameId===void 0&&(this.frameId=this.map.requestRenderFrame(function(n){delete t.frameId,t.handleEvent(new D9("renderFrame",{timeStamp:n})),t.applyChanges()}))}},{key:"addDefaultHandlers",value:function(t){var n=this.map,i=n.getCanvasContainer();this.add("mapEvent",new X9(n,t));var a=n.boxZoom=new M9(n,t);this.add("boxZoom",a);var o=new _V,l=new P9;n.doubleClickZoom=new lV(l,o),this.add("tapZoom",o),this.add("clickZoom",l);var c=new yV;this.add("tapDragZoom",c);var h=n.touchPitch=new AV;this.add("touchPitch",h);var _=new eV(t),x=new nV(t);n.dragRotate=new fV(t,_,x),this.add("mouseRotate",_,["mousePitch"]),this.add("mousePitch",x,["mouseRotate"]);var E=new q9(t),C=new bV(t);n.dragPan=new cV(i,E,C),this.add("mousePan",E),this.add("touchPan",C,["touchZoom","touchRotate"]);var I=new OV,P=new IV;n.touchZoomRotate=new hV(i,P,I,c),this.add("touchRotate",I,["touchPan","touchZoom"]),this.add("touchZoom",P,["touchPan","touchRotate"]);var B=n.scrollZoom=new uV(n,this);this.add("scrollZoom",B,["mousePan"]);var U=n.keyboard=new G9;this.add("keyboard",U),this.add("blockableMapEvent",new O9(n));for(var ee=0,ie=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ee<ie.length;ee++){var _e=ie[ee];t.interactive&&t[_e]&&n[_e].enable(t[_e])}}},{key:"add",value:function(t,n,i){this.handlers.push({handlerName:t,handler:n,allowed:i}),this.handlersById[t]=n}},{key:"blockedByActive",value:function(t,n,i){for(var a in t)if(a!==i&&(!n||n.indexOf(a)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var n=[],i=dv(t),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,l=o.target;this.el.contains(l)&&n.push(o)}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"applyChanges",value:function(){var t={},n={},i={},a=dv(this.changes),o;try{for(a.s();!(o=a.n()).done;){var l=Object(Bn.a)(o.value,3),c=l[0],h=l[1],_=l[2];c.panDelta&&(t.panDelta=(t.panDelta||new Ma(0,0))._add(c.panDelta)),c.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(t.around=c.around),c.pinchAround!==void 0&&(t.pinchAround=c.pinchAround),c.noInertia&&(t.noInertia=c.noInertia),Cb(n,h),Cb(i,_)}}catch(x){a.e(x)}finally{a.f()}this.updateMapTransform(t,n,i),this.changes=[]}},{key:"updateMapTransform",value:function(t,n,i){var a=this.map,o=a.transform;if(!wb(t))return this.fireEvents(n,i);var l=t.panDelta,c=t.zoomDelta,h=t.bearingDelta,_=t.pitchDelta,x=t.pinchAround,E=t.around;x!==void 0&&(E=x),a.stop(!0),E=E||a.transform.centerPoint;var C=o.pointLocation(l?E.sub(l):E);h&&this.rotateEnabled&&(o.bearing+=h),_&&this.pitchEnabled&&(o.pitch+=_),c&&(o.zoom+=c),o.setLocationAtPoint(C,E),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(n,i)}},{key:"fireEvents",value:function(t,n){var i=this,a=m_(this.eventsInProgress),o=m_(t),l={};for(var c in t)if(t[c]){var h=t[c].originalEvent;this.eventsInProgress[c]||(l["".concat(c,"start")]=h),this.eventsInProgress[c]=t[c]}!a&&o&&this.fireEvent("movestart",o.originalEvent);for(var _ in l)l[_]&&this.fireEvent(_,l[_]);t.rotate&&(this.bearingChanged=!0),o&&this.fireEvent("move",o.originalEvent);for(var x in t)if(t[x]){var E=t[x].originalEvent;this.fireEvent(x,E)}var C={},I;for(var P in this.eventsInProgress)if(this.eventsInProgress[P]){var B=this.eventsInProgress[P],U=B.handlerName,ee=B.originalEvent;this.handlersById[U].isActive()||(delete this.eventsInProgress[P],I=n[U]||ee,C["".concat(P,"end")]=I)}for(var ie in C)C[ie]&&this.fireEvent(ie,C[ie]);var _e=m_(this.eventsInProgress);if((a||o)&&!_e){this.updatingCamera=!0;var Oe=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),ke=function(ot){return ot!==0&&-i.bearingSnap<ot&&ot<i.bearingSnap};Oe?(ke(Oe.bearing||this.map.getBearing())&&(Oe.bearing=0),this.map.easeTo(Oe,{originalEvent:I})):(this.map.emit("moveend",new io("moveend",{originalEvent:I})),ke(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,n){this.map.emit(t,new io(t,n?{originalEvent:n}:{}))}}]),e}(),H3=DV,g_=null,uy=[],FV=30,Ob=1e3/FV,Im=window.performance,km={create:"create",load:"load",fullLoad:"fullLoad"},y_={mark:function(r){Im.mark(r)},frame:function(r){var t=r;if(g_!=null){var n=t-g_;uy.push(n)}g_=t},clearMetrics:function(){g_=null,uy=[],Im.clearMeasures("loadTime"),Im.clearMeasures("fullLoadTime");for(var r in km)Im.clearMarks(km[r])},getPerformanceMetrics:function(){var r=Im.measure("loadTime",km.create,km.load).duration,t=Im.measure("fullLoadTime",km.create,km.fullLoad).duration,n=uy.length,i=uy.reduce(function(c,h){return c+h},0)/n/1e3,a=1/i,o=uy.filter(function(c){return c>Ob}).reduce(function(c,h){return c+(h-Ob)/Ob},0),l=o/(n+o)*100;return{loadTime:r,fullLoadTime:t,fps:a,percentDroppedFrames:l}}};function W3(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=BV(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(h){throw h},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,l;return{s:function(){t=t.call(e)},n:function(){var h=t.next();return a=h.done,h},e:function(h){o=!0,l=h},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(o)throw l}}}}function BV(e,r){if(!!e){if(typeof e=="string")return G3(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G3(e,r)}}function G3(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var LV=function(){function e(){Object(Et.a)(this,e),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return Object(Rt.a)(e,[{key:"add",value:function(t){var n=++this.id,i=this.queue;return i.push({callback:t,id:n,cancelled:!1}),n}},{key:"remove",value:function(t){var n=this.currentlyRunning,i=n?this.queue.concat(n):this.queue,a=W3(i),o;try{for(a.s();!(o=a.n()).done;){var l=o.value;if(l.id===t){l.cancelled=!0;return}}}catch(c){a.e(c)}finally{a.f()}}},{key:"run",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=this.currentlyRunning=this.queue;this.queue=[];var i=W3(n),a;try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!o.cancelled&&(o.callback(t),this.cleared))break}}catch(l){i.e(l)}finally{i.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),e}(),X3=LV;function NV(e){var r=jV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function jV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function zV(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}zV(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`);var __=-2,Z3=22,UV=xi.merge,Dm=0,b_=60,VV={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:__,maxZoom:Z3,minPitch:Dm,maxPitch:b_,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},aZ=function(e){Object(qr.a)(t,e);var r=NV(t);function t(n){var i;return Object(Et.a)(this,t),i=r.call(this,UV({},VV,n)),Object(L.a)(Object(De.a)(i),"renderTaskQueue",new X3),Object(L.a)(Object(De.a)(i),"trackResize",!0),Object(L.a)(Object(De.a)(i),"onWindowOnline",function(){i.update()}),Object(L.a)(Object(De.a)(i),"onWindowResize",function(a){i.trackResize&&i.resize({originalEvent:a}).update()}),i.initContainer(),i.resize(),i.handlers=new H3(Object(De.a)(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1)),i}return Object(Rt.a)(t,[{key:"resize",value:function(i){var a=this.containerDimensions(),o=a[0],l=a[1];this.transform.resize(o,l);var c=!this.moving;return c&&(this.stop(),this.emit("movestart",new Event("movestart",i)),this.emit("move",new Event("move",i))),this.emit("resize",new Event("resize",i)),c&&this.emit("moveend",new Event("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(ko.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Ma.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(oy.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?__:i,i>=__&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(__," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?Z3:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?Dm:i,i<Dm)throw new Error("minPitch must be greater than or equal to ".concat(Dm));if(i>=Dm&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(Dm," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?b_:i,i>b_)throw new Error("maxPitch must be less than or equal to ".concat(b_));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=n_(function(a){y_.frame(a),i.frame=null,i.update(a)}))}},{key:"update",value:function(i){var a=this;this.frame||(this.frame=n_(function(o){y_.frame(o),a.frame=null,a.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var a=this.canvasContainer=j.create("div","l7-canvas-container",i);this.options.interactive&&a.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var i=0,a=0;return this.container&&(i=this.container.clientWidth||400,a=this.container.clientHeight||300),[i,a]}},{key:"resizeCanvas",value:function(i,a){var o=j.DPR||1;this.canvas.width=o*i,this.canvas.height=o*a,this.canvas.style.width="".concat(i,"px"),this.canvas.style.height="".concat(a,"px")}}]),t}(R3),HV=xi.throttle,WV=function(){function e(r){var t=this;Object(Et.a)(this,e),Object(L.a)(this,"onHashChange",function(){var n=t.getCurrentHash();if(n.length>=3&&!n.some(function(a){return isNaN(+a)})){var i=t.map.dragRotate.isEnabled()&&t.map.touchZoomRotate.isEnabled()?+(n[3]||0):t.map.getBearing();return t.map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}),Object(L.a)(this,"getCurrentHash",function(){var n=window.location.hash.replace("#","");if(t.hashName){var i;return n.split("&").map(function(a){return a.split("=")}).forEach(function(a){a[0]===t.hashName&&(i=a)}),(i&&i[1]||"").split("/")}return n.split("/")}),Object(L.a)(this,"updateHashUnthrottled",function(){var n=t.getHashString();try{window.history.replaceState(window.history.state,"",n)}catch(i){}}),this.hashName=r&&encodeURIComponent(r),this.updateHash=HV(this.updateHashUnthrottled,30*1e3/100)}return Object(Rt.a)(e,[{key:"addTo",value:function(t){return this.map=t,window.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return window.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var n=this.map.getCenter(),i=Math.round(this.map.getZoom()*100)/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,a),l=Math.round(n.lng*o)/o,c=Math.round(n.lat*o)/o,h=this.map.getBearing(),_=this.map.getPitch(),x="";if(t?x+="/".concat(l,"/").concat(c,"/").concat(i):x+="".concat(i,"/").concat(c,"/").concat(l),(h||_)&&(x+="/".concat(Math.round(h*10)/10)),_&&(x+="/".concat(Math.round(_))),this.hashName){var E=this.hashName,C=!1,I=window.location.hash.slice(1).split("&").map(function(P){var B=P.split("=")[0];return B===E?(C=!0,"".concat(B,"=").concat(x)):P}).filter(function(P){return P});return C||I.push("".concat(E,"=").concat(x)),"#".concat(I.join("&"))}return"#".concat(x)}}]),e}(),GV=WV;function XV(e){var r=ZV();return function(){var n=Object(ut.a)(e),i;if(r){var a=Object(ut.a)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Object(Zr.a)(this,i)}}function ZV(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function $V(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var o=r.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(r.createTextNode(e)),i.appendChild(o),o}}$V(`.l7-map {
  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  overflow: hidden;
  position: relative;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

.l7-canvas {
  position: absolute;
  left: 0;
  top: 0;
}

.l7-map:-webkit-full-screen {
  width: 100%;
  height: 100%;
}

.l7-canary {
  background-color: salmon;
}

.l7-canvas-container.l7-interactive,
.l7-ctrl-group button.l7-ctrl-compass {
  cursor: -webkit-grab;
  cursor: grab;
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.l7-canvas-container.l7-interactive.l7-track-pointer {
  cursor: pointer;
}

.l7-canvas-container.l7-interactive:active,
.l7-ctrl-group button.l7-ctrl-compass:active {
  cursor: -webkit-grabbing;
  cursor: grabbing;
}

.l7-canvas-container.l7-touch-zoom-rotate,
.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {
  -ms-touch-action: pan-x pan-y;
      touch-action: pan-x pan-y;
}

.l7-canvas-container.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: pinch-zoom;
      touch-action: pinch-zoom;
}

.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,
.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {
  -ms-touch-action: none;
      touch-action: none;
}

.l7-ctrl-top-left,
.l7-ctrl-top-right,
.l7-ctrl-bottom-left,
.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }
.l7-ctrl-top-left     { top: 0; left: 0; }
.l7-ctrl-top-right    { top: 0; right: 0; }
.l7-ctrl-bottom-left  { bottom: 0; left: 0; }
.l7-ctrl-bottom-right { right: 0; bottom: 0; }

.l7-ctrl {
  clear: both;
  pointer-events: auto;

  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */
  -webkit-transform: translate(0, 0);
          transform: translate(0, 0);
}
.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }
.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }
.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }
.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }


.l7-crosshair,
.l7-crosshair .l7-interactive,
.l7-crosshair .l7-interactive:active {
    cursor: crosshair;
}

.l7-boxzoom {
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 0;
    background: #fff;
    border: 2px dotted #202020;
    opacity: 0.5;
    z-index: 10;
}
`),function(){if(typeof window.CustomEvent=="function")return!1;function e(r,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(r,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var x_=-2,$3=22,Y3=xi.merge,Fm=0,E_=60,YV={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:x_,maxZoom:$3,minPitch:Fm,maxPitch:E_,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},K3=function(e){Object(qr.a)(t,e);var r=XV(t);function t(n){var i;Object(Et.a)(this,t),i=r.call(this,Y3({},YV,n)),Object(L.a)(Object(De.a)(i),"renderTaskQueue",new X3),Object(L.a)(Object(De.a)(i),"trackResize",!0),Object(L.a)(Object(De.a)(i),"onWindowOnline",function(){i.update()}),Object(L.a)(Object(De.a)(i),"onWindowResize",function(o){i.trackResize&&i.resize({originalEvent:o}).update()}),i.initContainer(),i.resize(),i.handlers=new H3(Object(De.a)(i),i.options),typeof window!="undefined"&&(window.addEventListener("online",i.onWindowOnline,!1),window.addEventListener("resize",i.onWindowResize,!1),window.addEventListener("orientationchange",i.onWindowResize,!1));var a=typeof n.hash=="string"&&n.hash||void 0;return n.hash&&(i.hash=new GV(a).addTo(Object(De.a)(i))),(!i.hash||!i.hash.onHashChange())&&(i.jumpTo({center:n.center,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch}),n.bounds&&(i.resize(),i.fitBounds(n.bounds,Y3({},n.fitBoundsOptions,{duration:0})))),i}return Object(Rt.a)(t,[{key:"resize",value:function(i){var a=this.containerDimensions(),o=Object(Bn.a)(a,2),l=o[0],c=o[1];this.transform.resize(l,c);var h=!this.moving;return h&&(this.stop(),this.emit("movestart",new window.CustomEvent("movestart",i)),this.emit("move",new window.CustomEvent("move",i))),this.emit("resize",new window.CustomEvent("resize",i)),h&&this.emit("moveend",new window.CustomEvent("moveend",i)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(i){return this.transform.locationPoint(ko.convert(i))}},{key:"unproject",value:function(i){return this.transform.pointLocation(Ma.convert(i))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(i){this.transform.setMaxBounds(oy.convert(i))}},{key:"setStyle",value:function(i){}},{key:"setMinZoom",value:function(i){if(i=i==null?x_:i,i>=x_&&i<=this.transform.maxZoom)return this.transform.minZoom=i,this.getZoom()<i&&this.setZoom(i),this;throw new Error("minZoom must be between ".concat(x_," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(i){if(i=i==null?$3:i,i>=this.transform.minZoom)return this.transform.maxZoom=i,this.getZoom()>i&&this.setZoom(i),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(i){if(i=i==null?Fm:i,i<Fm)throw new Error("minPitch must be greater than or equal to ".concat(Fm));if(i>=Fm&&i<=this.transform.maxPitch)return this.transform.minPitch=i,this.getPitch()<i&&this.setPitch(i),this;throw new Error("minPitch must be between ".concat(Fm," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(i){if(i=i==null?E_:i,i>E_)throw new Error("maxPitch must be less than or equal to ".concat(E_));if(i>=this.transform.minPitch)return this.transform.maxPitch=i,this.getPitch()>i&&this.setPitch(i),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(i){this.transform.renderWorldCopies=!!i}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(i){return this.update(),this.renderTaskQueue.add(i)}},{key:"cancelRenderFrame",value:function(i){return this.renderTaskQueue.remove(i)}},{key:"triggerRepaint",value:function(){var i=this;this.frame||(this.frame=n_(function(a){y_.frame(a),i.frame=null,i.update(a)}))}},{key:"update",value:function(i){var a=this;this.frame||(this.frame=n_(function(o){y_.frame(o),a.frame=null,a.renderTaskQueue.run(i)}))}},{key:"initContainer",value:function(){if(typeof this.options.container=="string"){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else if(this.options.container instanceof HTMLElement)this.container=this.options.container;else throw new Error("Invalid type: 'container' must be a String or HTMLElement.");var i=this.container;i.classList.add("l7-map");var a=this.canvasContainer=j.create("div","l7-canvas-container",i);this.options.interactive&&a.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var i=0,a=0;return this.container&&(i=this.container.clientWidth,a=this.container.clientHeight,i=i===0?400:i,a=a===0?300:a),[i,a]}}]),t}(R3),q3=function(){function e(){wc()(this,e),_i()(this,"viewport",void 0)}return Oc()(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,o=t.bearing,l=t.viewportHeight,c=t.viewportWidth;this.viewport=new pb({width:c,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:o})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),Q3={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},KV=["id","attributionControl","style","rotation","mapInstance"],qV=["id","attributionControl","style","rotation","mapInstance","canvas","hasBaseMap"],J3,eO,tO,rO,nO,iO,Bm,aO,oO,sO,uO;function lO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function cO(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?lO(Object(t),!0).forEach(function(n){_i()(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var fO={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},hO=12,QV=(J3=Object(on.injectable)(),eO=Object(on.inject)(Qt.MapConfig),tO=Object(on.inject)(Qt.IGlobalConfigService),rO=Object(on.inject)(Qt.ICoordinateSystemService),nO=Object(on.inject)(Qt.IEventEmitter),J3(iO=(Bm=function(){function e(){var r=this;wc()(this,e),_i()(this,"version",wm.L7MAP),_i()(this,"map",void 0),_i()(this,"dragging",!1),_i()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Vu()(this,"config",aO,this),Vu()(this,"configService",oO,this),Vu()(this,"coordinateSystemService",sO,this),Vu()(this,"eventEmitter",uO,this),_i()(this,"viewport",void 0),_i()(this,"markerContainer",void 0),_i()(this,"cameraChangedCallback",void 0),_i()(this,"$mapContainer",void 0),_i()(this,"handleMiniCameraChanged",function(t,n,i,a,o){var l=r.config.offsetCoordinate,c=l===void 0?!0:l;r.viewport.syncWithMapCamera({bearing:a,center:[t,n],viewportHeight:r.map.transform.height,pitch:o,viewportWidth:r.map.transform.width,zoom:i,cameraHeight:0}),r.viewport.getZoom()>hO&&c?r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT),r.cameraChangedCallback(r.viewport)}),_i()(this,"handleCameraChanged",function(){var t=r.map.getCenter(),n=t.lat,i=t.lng,a=r.config.offsetCoordinate,o=a===void 0?!0:a;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[i,n],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.viewport.getZoom()>hO&&o?r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT_OFFSET):r.coordinateSystemService.setCoordinateSystem(ec.LNGLAT),r.cameraChangedCallback(r.viewport)})}return Oc()(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=j.create("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,n){Jv.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(fO[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(fO[t]||t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.panTo([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyle(t))}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"lngLatToMercator",value:function(t,n){throw new Error("not implement")}},{key:"getModelMatrix",value:function(t,n,i){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0};throw new Error("not implement")}},{key:"init",value:function(){var r=ny()(he.a.mark(function n(){var i=this,a,o,l,c,h,_,x,E,C,I,P;return he.a.wrap(function(U){for(;;)switch(U.prev=U.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,h=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,E=a.rotation,C=E===void 0?0:E,I=a.mapInstance,P=ry()(a,KV),this.viewport=new q3,I?(this.map=I,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(l),this.map=new K3(cO({container:this.$mapContainer,style:this.getMapStyle(x),bearing:C},P))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return i.dragging=!0,""}),this.map.on("dragend",function(){return i.dragging=!1,""}),this.handleCameraChanged();case 8:case"end":return U.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initMiniMap",value:function(){var r=ny()(he.a.mark(function n(){var i=this,a,o,l,c,h,_,x,E,C,I,P,B,U,ee,ie,_e;return he.a.wrap(function(ke){for(;;)switch(ke.prev=ke.next){case 0:a=this.config,o=a.id,l=o===void 0?"map":o,c=a.attributionControl,h=c===void 0?!1:c,_=a.style,x=_===void 0?"light":_,E=a.rotation,C=E===void 0?0:E,I=a.mapInstance,P=a.canvas,B=P===void 0?null:P,U=a.hasBaseMap,ee=U===void 0?!1:U,ie=ry()(a,qV),this.viewport=new q3,this.$mapContainer=B,this.map=new K3(cO({container:this.$mapContainer,style:this.getMapStyle(x),bearing:C,canvas:B},ie)),ee?(_e=this.map.getCenter(),this.handleMiniCameraChanged(_e.lng,_e.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),(void 0).document.addEventListener("mapCameaParams",function(Ke){var ot=Ke.e,Ot=ot.longitude,Zt=ot.latitude,ir=ot.scale,Hr=ot.bearing,ln=ot.pitch;i.handleMiniCameraChanged(Ot,Zt,ir-1.25,Hr,ln)})):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return ke.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"destroy",value:function(){var t,n;(t=this.$mapContainer)===null||t===void 0||(n=t.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++)a[o-1]=arguments[o];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatAmapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"getMapStyle",value:function(t){return typeof t!="string"?t:Q3[t]?Q3[t]:t}}]),e}(),aO=Hu()(Bm.prototype,"config",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oO=Hu()(Bm.prototype,"configService",[tO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sO=Hu()(Bm.prototype,"coordinateSystemService",[rO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=Hu()(Bm.prototype,"eventEmitter",[nO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bm))||iO);function JV(e){var r=eH();return function(){var n=ud()(e),i;if(r){var a=ud()(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return Y0()(this,i)}}function eH(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tH=function(e){$0()(t,e);var r=JV(t);function t(){return wc()(this,t),r.apply(this,arguments)}return Oc()(t,[{key:"getServiceConstructor",value:function(){return QV}}]),t}(K0);function pO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function dO(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?pO(Object(t),!0).forEach(function(n){rH(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):pO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function rH(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function nH(e,r){return sH(e)||oH(e,r)||aH(e,r)||iH()}function iH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aH(e,r){if(!!e){if(typeof e=="string")return vO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return vO(e,r)}}function vO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function oH(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function sH(e){if(Array.isArray(e))return e}var uH=Xe.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,o=e.children,l=Object(Je.useRef)(null),c=Object(Je.useState)(),h=nH(c,2),_=h[0],x=h[1];return Object(Je.useEffect)(function(){var E=new ty(dO(dO({id:l.current},i),{},{map:new tH(n)}));return E.on("loaded",function(){x(E),a&&a(E)}),function(){E.destroy()}},[]),Object(Je.useEffect)(function(){_&&n.style&&_.setMapStyle(n.style)},[JSON.stringify(n.style)]),Object(Je.useEffect)(function(){_&&n.zoom&&_.setZoom(n.zoom)},[n.zoom]),Object(Je.useEffect)(function(){_&&n.center&&_.setCenter(n.center)},[JSON.stringify(n.center)]),Object(Je.useEffect)(function(){_&&n.pitch&&_.setPitch(n.pitch)},[n.pitch]),Object(Je.useEffect)(function(){_&&n.rotation&&_.setRotation(n.rotation)},[n.rotation]),Xe.a.createElement(dn.Provider,{value:_},Xe.a.createElement("div",{ref:l,className:t,style:r},_&&o))}),oZ=uH;function lH(e,r){return pH(e)||hH(e,r)||fH(e,r)||cH()}function cH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fH(e,r){if(!!e){if(typeof e=="string")return mO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return mO(e,r)}}function mO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function hH(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function pH(e){if(Array.isArray(e))return e}var sZ=Xe.a.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.children,a=Object(Je.useRef)(null),o=Object(Je.useState)(),l=lH(o,2),c=l[0],h=l[1];return Object(Je.useEffect)(function(){var _=new ty({id:a.current,map:n});return _.on("loaded",function(){h(_)}),function(){_.destroy()}},[]),Xe.a.createElement(dn.Provider,{value:c},Xe.a.createElement("div",{ref:a,className:t,style:r},c&&i))}),dH=["type","position"];function gO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Rb(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?gO(Object(t),!0).forEach(function(n){vH(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):gO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function vH(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function mH(e,r){if(e==null)return{};var t=gH(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function gH(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var uZ=Xe.a.memo(function(r){var t=ri(),n=Object(Je.useRef)(),i=r.type,a=r.position,o=mH(r,dH);return Object(Je.useEffect)(function(){var l;switch(i){case"scale":l=new j4({position:a||"bottomright"});break;case"zoom":l=new V4(Rb({position:a||"topright"},o));break;case"logo":l=new tS(Rb({position:a||"bottomleft"},o));case"layer":l=new(void 0)(Rb({position:a||"bottomleft"},o))}return n.current=l,t.addControl(l),function(){n.current=void 0,t.removeControl(l)}},[i]),Object(Je.useEffect)(function(){n.current&&n.current.setPosition(a||"bottomleft")},[a]),null}),Mb=O("i8i4");function yO(e,r){return xH(e)||bH(e,r)||_H(e,r)||yH()}function yH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _H(e,r){if(!!e){if(typeof e=="string")return _O(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _O(e,r)}}function _O(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function bH(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function xH(e){if(Array.isArray(e))return e}var bO=Je.useEffect,xO=Je.useState,EH=/\B([A-Z])/g,SH=function(r){return r.replace(EH,"-$1").toLowerCase()};function lZ(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=xO(),o=yO(a,2),l=o[0],c=o[1],h=ri(),_=xO(function(){return document.createElement("div")}),x=yO(_,1),E=x[0];return bO(function(){var C=new Qd({position:i});return C.onAdd=function(){if(r&&(E.className=r),t){var I=Object.keys(t).map(function(P){return"".concat(SH(P),":").concat(t[P])}).join(";");E.style.cssText=I}return E},C.onRemove=function(){},c(C),h.addControl(C),function(){h.removeControl(C)}},[]),bO(function(){l&&l.setPosition(i||"bottomleft")},[i]),Object(Mb.createPortal)(n,E)}var EO=Object(Je.createContext)({});function AH(){return Object(Je.useContext)(EO)}var kh=O("LvDl"),cZ=Je.useEffect,TH=Je.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},kh.isEqual),fZ=Je.useEffect,CH=Je.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},kh.isEqual),hZ=Je.useEffect,wH=Je.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},kh.isEqual),OH=Je.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},kh.isEqual),RH=Je.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},kh.isEqual),pZ=Je.useEffect,MH=Je.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},kh.isEqual),PH=Je.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},kh.isEqual),IH=Je.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},kh.isEqual),kH=["data"];function DH(e,r){if(e==null)return{};var t=FH(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(t[n]=e[n]))}return t}function FH(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var BH=Je.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=DH(n,kH);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},kh.isEqual),dZ=Je.useEffect,LH=Je.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},kh.isEqual);function NH(e,r){return VH(e)||UH(e,r)||zH(e,r)||jH()}function jH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zH(e,r){if(!!e){if(typeof e=="string")return SO(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return SO(e,r)}}function SO(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function UH(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,a=!1,o,l;try{for(t=t.call(e);!(i=(o=t.next()).done)&&(n.push(o.value),!(r&&n.length===r));i=!0);}catch(c){a=!0,l=c}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw l}}return n}}function VH(e){if(Array.isArray(e))return e}var ly=Je.useEffect,HH=Je.useState;function vv(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,o=r.size,l=r.scale,c=r.active,h=r.select,_=r.filter,x=r.animate,E=r.options,C=r.onLayerLoaded,I=ri(),P=HH(function(){var ee;switch(e){case"polygonLayer":ee=new e0(E);break;case"lineLayer":ee=new d1(E);break;case"pointLayer":ee=new Jy(E);break;case"heatmapLayer":ee=new ak(E);break;case"rasterLayer":ee=new t0(E);break;case"imageLayer":ee=new IS(E);break;case"citybuildingLayer":ee=new R5(E);break;default:ee=new e0(E)}return ee.on("inited",function(){C&&C(ee,I)}),ee}),B=NH(P,1),U=B[0];return ly(function(){return I.addLayer(U),function(){I.removeLayer(U)}},[]),ly(function(){U.inited&&E&&U.updateLayerConfig(E)},[E==null?void 0:E.minZoom,E==null?void 0:E.maxZoom,E==null?void 0:E.visible]),ly(function(){U.inited&&(E==null?void 0:E.zIndex)&&U.setIndex(E.zIndex)},[E==null?void 0:E.zIndex]),ly(function(){U.inited&&(E==null?void 0:E.blend)&&U.setBlend(E.blend)},[E==null?void 0:E.blend]),ly(function(){I.render()}),Je.createElement(EO.Provider,{value:U},Je.createElement(BH,{layer:U,source:t}),l&&Je.createElement(RH,{layer:U,scale:l}),n&&Je.createElement(wH,{layer:U,color:n}),o&&Je.createElement(IH,{layer:U,size:o}),i&&Je.createElement(PH,{layer:U,shape:i}),a&&Je.createElement(LH,{layer:U,style:a}),c&&Je.createElement(TH,{layer:U,active:c}),h&&Je.createElement(MH,{layer:U,select:h}),_&&Je.createElement(OH,{layer:U,filter:_}),x&&Je.createElement(CH,{layer:U,animate:x}),r.children)}var vZ=Je.memo(function(r){return vv("polygonLayer",r)}),mZ=Je.memo(function(r){return vv("lineLayer",r)}),AO=Je.memo(function(r){return vv("pointLayer",r)}),WH=Je.memo(function(r){return vv("heatmapLayer",r)}),gZ=Je.memo(function(r){return vv("rasterLayer",r)}),yZ=Je.memo(function(r){return vv("imageLayer",r)}),_Z=Je.memo(function(r){return vv("citybuildingLayer",r)}),GH=Je.useEffect,bZ=Je.memo(function(e){var r=e.type,t=e.handler,n=AH();return GH(function(){return n.off(r,t),n.on(r,t),function(){n.off(r,t)}},[r,t]),null}),xZ=Je.memo(function(e){var r=[{title:"1",color:"rgb(239,243,255)"},{title:"10",color:"rgb(198,219,239)"},{title:"30",color:"rgb(158,202,225)"},{title:"50",color:"rgb(107,174,214)"},{title:"60",color:"rgb(49,130,189)"},{title:"100",color:"rgb(8,81,156)"}],t=e.items,n=t===void 0?r:t;return Je.createElement("div",null,Je.createElement("div",null,n.map(function(i,a){return Je.createElement("div",{key:a,style:{background:i.color,height:"100%",display:"inline-block",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%",padding:5}})})),Je.createElement("div",null,n.map(function(i,a){return Je.createElement("div",{key:a,style:{background:"#fff",height:"100%",display:"inline-block",textAlign:"left",cursor:"pointer",width:""+(100-n.length)/n.length+"%",marginRight:"1%"}},i.title)})))});function S_(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?S_=function(t){return typeof t}:S_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S_(e)}function TO(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function A_(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?TO(Object(t),!0).forEach(function(n){XH(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):TO(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function XH(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function ZH(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function CO(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $H(e,r,t){return r&&CO(e.prototype,r),t&&CO(e,t),e}function YH(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Pb(e,r)}function Pb(e,r){return Pb=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Pb(e,r)}function KH(e){var r=JH();return function(){var n=T_(e),i;if(r){var a=T_(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return qH(this,i)}}function qH(e,r){if(r&&(S_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return QH(e)}function QH(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JH(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function T_(e){return T_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},T_(e)}var EZ=function(e){YH(t,e);var r=KH(t);function t(n){var i;return ZH(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return $H(t,[{key:"componentDidMount",value:function(){var i,a=this.props,o=a.lnglat,l=a.children,c=a.option,h=a.lngLat,_=new r1(A_(A_({},c),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));o&&_.setLnglat(o),h&&_.setLnglat(h),l&&_.setDOMContent(this.el),this.popup=_,this.scene.addPopup(_)}},{key:"componentDidUpdate",value:function(i){var a,o,l,c,h,_,x=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(o=i.lnglat)===null||o===void 0?void 0:o.lat],E=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(c=l.lnglat)===null||c===void 0?void 0:c.lng,(h=this.props)===null||h===void 0||(_=h.lnglat)===null||_===void 0?void 0:_.lat],C=x.toString()!==E.toString();if(C){var I;this.popup.remove(),this.popup=new r1(A_(A_({},this.props.option),{},{stopPropagation:(I=this.props.option)===null||I===void 0?void 0:I.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return Je.createElement(dn.Consumer,{},function(a){return a&&(i.scene=a),Object(Mb.createPortal)(i.props.children,i.el)})}}]),t}(Je.PureComponent);function C_(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?C_=function(t){return typeof t}:C_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C_(e)}function eW(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function wO(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function tW(e,r,t){return r&&wO(e.prototype,r),t&&wO(e,t),e}function rW(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&Ib(e,r)}function Ib(e,r){return Ib=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},Ib(e,r)}function nW(e){var r=oW();return function(){var n=w_(e),i;if(r){var a=w_(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return iW(this,i)}}function iW(e,r){if(r&&(C_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aW(e)}function aW(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oW(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function w_(e){return w_=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},w_(e)}var SZ=function(e){rW(t,e);var r=nW(t);function t(n){var i;return eW(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return tW(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,o=i.children,l=i.option,c=i.onMarkerLoaded,h=new $2(l);a&&h.setLnglat(a),o&&h.setElement(this.el),this.marker=h,c&&c(h),this.scene.addMarker(h)}},{key:"componentDidUpdate",value:function(i){var a,o=(i==null?void 0:i.lnglat.toString())!==((a=this.props)===null||a===void 0?void 0:a.lnglat.toString());o&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return Je.createElement(dn.Consumer,{},function(a){return a&&(i.scene=a),Object(Mb.createPortal)(i.props.children,i.el)})}}]),t}(Je.PureComponent),sW=Je.useEffect,uW=Je.memo(function(e){var r=e.type,t=e.handler,n=ri();return sW(function(){return n.on(r,t),function(){n.off(r,t)}},[r]),null}),AZ=uW,lW=Je.useEffect,TZ=Je.memo(function(r){var t=r.name,n=r.url,i=ri();return lW(function(){i.addImage(t,n)},[t,n]),null}),cW=O("95SA"),fW=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],OO=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){var n;Object(st.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),n.state={data:null,grid:null,loading:!1},n}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){var n=Object(Nn.a)(gn.a.mark(function a(){var o,l,c,h;return gn.a.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(E){return E.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(E){return E.json()})]);case 2:o=x.sent,l=Object(Ee.a)(o,2),c=l[0],h=l[1],this.setState({data:c,grid:h,loading:!0});case 7:case"end":return x.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"render",value:function(){var i=this.state,a=i.data,o=i.grid,l=i.loading;return l===!1?Je.createElement(cW.a,null):Je.createElement(FU,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"}},o&&Je.createElement(WH,{key:"1",source:{data:o,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}}),a&&[Je.createElement(AO,{key:"2",options:{autoFit:!0},source:{data:a},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:fW},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}}),Je.createElement(AO,{key:"5",source:{data:a},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(h){return h>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}})])}}]),t}(Je.Component),CZ={Pie:D,WaterWave:Or,Gauge:Bt,MiniArea:On,TagCloud:tt,Map:OO},RO=O("oBTY"),hW=O("H+7v"),mv=O.n(hW);function pW(e){return e*1<10?"0".concat(e):e}function MO(){for(var e=[],r=0;r<24;r+=1)e.push({x:"".concat(pW(r),":00"),y:Math.floor(Math.random()*200)+r*50});return e}var dW=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){var n;Object(st.a)(this,t);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=r.call.apply(r,[this].concat(a)),n.state={activeData:MO()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:MO()},function(){n.loopData()})},1e3)})},n}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var i=this.state.activeData,a=i===void 0?[]:i;return Xe.a.createElement("div",{className:mv.a.activeChart},Xe.a.createElement(et.a,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),Xe.a.createElement("div",{style:{marginTop:32}},Xe.a.createElement(On,{animate:!1,line:!0,borderWidth:2,height:84,scale:{y:{tickCount:3}},yAxis:{tickLine:void 0,label:void 0,title:void 0,line:void 0},data:a})),a&&Xe.a.createElement("div",null,Xe.a.createElement("div",{className:mv.a.activeChartGrid},Xe.a.createElement("p",null,Object(RO.a)(a).sort()[a.length-1].y+200," \u4EBF\u5143"),Xe.a.createElement("p",null,Object(RO.a)(a).sort()[Math.floor(a.length/2)].y," \u4EBF\u5143")),Xe.a.createElement("div",{className:mv.a.dashedLine},Xe.a.createElement("div",{className:mv.a.line})),Xe.a.createElement("div",{className:mv.a.dashedLine},Xe.a.createElement("div",{className:mv.a.line}))),a&&Xe.a.createElement("div",{className:mv.a.activeChartLegend},Xe.a.createElement("span",null,"00:00"),Xe.a.createElement("span",null,a[Math.floor(a.length/2)].x),Xe.a.createElement("span",null,a[a.length-1].x)))}}]),t}(Je.Component),vW=O("Wnft"),PO=O.n(vW),mW=et.a.Countdown,gW=Date.now()+1e3*60*60*24*2+1e3*30,yW=function(e){Object(pt.a)(t,e);var r=Object($e.a)(t);function t(){return Object(st.a)(this,t),r.apply(this,arguments)}return Object(Dt.a)(t,[{key:"componentDidMount",value:function(){var i=this.props.dispatch;i({type:"dashboardAndmonitor/fetchTags"})}},{key:"render",value:function(){var i=this.props,a=i.dashboardAndmonitor,o=i.loading,l=a.tags;return Xe.a.createElement(jr.a,null,Xe.a.createElement(Xe.a.Fragment,null,Xe.a.createElement(ue.a,{gutter:24},Xe.a.createElement(Ne.a,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24}},Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.trading-activity",defaultMessage:"Real-Time Trading Activity"}),bordered:!1},Xe.a.createElement(ue.a,null,Xe.a.createElement(Ne.a,{md:6,sm:12,xs:24},Xe.a.createElement(et.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.total-transactions",defaultMessage:"Total transactions today"}),suffix:"\u5143",value:Jt()(124543233).format("0,0")})),Xe.a.createElement(Ne.a,{md:6,sm:12,xs:24},Xe.a.createElement(et.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.sales-target",defaultMessage:"Sales target completion rate"}),value:"92%"})),Xe.a.createElement(Ne.a,{md:6,sm:12,xs:24},Xe.a.createElement(mW,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.remaining-time",defaultMessage:"Remaining time of activity"}),value:gW,format:"HH:mm:ss:SSS"})),Xe.a.createElement(Ne.a,{md:6,sm:12,xs:24},Xe.a.createElement(et.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.total-transactions-per-second",defaultMessage:"Total transactions per second"}),suffix:"\u5143",value:Jt()(234).format("0,0")}))),Xe.a.createElement("div",{className:PO.a.mapChart},Xe.a.createElement(OO,null)))),Xe.a.createElement(Ne.a,{xl:6,lg:24,md:24,sm:24,xs:24},Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.activity-forecast",defaultMessage:"Activity forecast"}),style:{marginBottom:24},bordered:!1},Xe.a.createElement(dW,null)),Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.efficiency",defaultMessage:"Efficiency"}),style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1},Xe.a.createElement(Bt,{title:Object(kt.d)({id:"dashboardandmonitor.monitor.ratio",defaultMessage:"Ratio"}),height:180,percent:87})))),Xe.a.createElement(ue.a,{gutter:24},Xe.a.createElement(Ne.a,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24}},Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.proportion-per-category",defaultMessage:"Proportion Per Category"}),bordered:!1,className:PO.a.pieCard},Xe.a.createElement(ue.a,{style:{padding:"16px 0"}},Xe.a.createElement(Ne.a,{span:8},Xe.a.createElement(D,{animate:!1,percent:28,title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.fast-food",defaultMessage:"Fast food"}),total:"28%",height:128,lineWidth:2})),Xe.a.createElement(Ne.a,{span:8},Xe.a.createElement(D,{animate:!1,color:"#5DDECF",percent:22,title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.western-food",defaultMessage:"Western food"}),total:"22%",height:128,lineWidth:2})),Xe.a.createElement(Ne.a,{span:8},Xe.a.createElement(D,{animate:!1,color:"#2FC25B",percent:32,title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.hot-pot",defaultMessage:"Hot pot"}),total:"32%",height:128,lineWidth:2}))))),Xe.a.createElement(Ne.a,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24}},Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.popular-searches",defaultMessage:"Popular Searches"}),loading:o,bordered:!1,bodyStyle:{overflow:"hidden"}},Xe.a.createElement(tt,{data:l||[],height:161}))),Xe.a.createElement(Ne.a,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24}},Xe.a.createElement(se.a,{title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.resource-surplus",defaultMessage:"Resource Surplus"}),bodyStyle:{textAlign:"center",fontSize:0},bordered:!1},Xe.a.createElement(Or,{height:161,title:Xe.a.createElement(kt.a,{id:"dashboardandmonitor.monitor.fund-surplus",defaultMessage:"Fund Surplus"}),percent:34}))))))}}]),t}(Je.Component),wZ=Q.default=Object(kt.c)(function(e){var r=e.dashboardAndmonitor,t=e.loading;return{dashboardAndmonitor:r,loading:t.models.dashboardAndmonitor}})(yW)},aHsQ:function(Qe,Q,O){"use strict";var j=O("EFp3"),H=O.n(j),X=O("6D9b"),N=O.n(X),v=O("cWXX")},aPG5:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolve=void 0;var j=O("MON2"),H=O("FV85"),X=O("qK8v"),N=O("ujMp"),v=O("cSJO"),z=function(ve,ue,gt){try{return gt()}catch(Ne){throw X.isStackOverflowExeption(Ne)?new Error(j.CIRCULAR_DEPENDENCY_IN_FACTORY(ve,ue.toString())):Ne}},W=function se(ve){return function(ue){ue.parentContext.setCurrentRequest(ue);var gt=ue.bindings,Ne=ue.childRequests,st=ue.target&&ue.target.isArray(),Dt=!ue.parentRequest||!ue.parentRequest.target||!ue.target||!ue.parentRequest.target.matchesArray(ue.target.serviceIdentifier);if(st&&Dt)return Ne.map(function(Je){var Xe=se(ve);return Xe(Je)});var pt=null;if(ue.target.isOptional()&&gt.length===0)return;var $e=gt[0],Ct=$e.scope===H.BindingScopeEnum.Singleton,et=$e.scope===H.BindingScopeEnum.Request;if(Ct&&$e.activated)return $e.cache;if(et&&ve!==null&&ve.has($e.id))return ve.get($e.id);if($e.type===H.BindingTypeEnum.ConstantValue)pt=$e.cache,$e.activated=!0;else if($e.type===H.BindingTypeEnum.Function)pt=$e.cache,$e.activated=!0;else if($e.type===H.BindingTypeEnum.Constructor)pt=$e.implementationType;else if($e.type===H.BindingTypeEnum.DynamicValue&&$e.dynamicValue!==null)pt=z("toDynamicValue",$e.serviceIdentifier,function(){return $e.dynamicValue(ue.parentContext)});else if($e.type===H.BindingTypeEnum.Factory&&$e.factory!==null)pt=z("toFactory",$e.serviceIdentifier,function(){return $e.factory(ue.parentContext)});else if($e.type===H.BindingTypeEnum.Provider&&$e.provider!==null)pt=z("toProvider",$e.serviceIdentifier,function(){return $e.provider(ue.parentContext)});else if($e.type===H.BindingTypeEnum.Instance&&$e.implementationType!==null)pt=v.resolveInstance($e.implementationType,Ne,se(ve));else{var kt=N.getServiceIdentifierAsString(ue.serviceIdentifier);throw new Error(j.INVALID_BINDING_TYPE+" "+kt)}return typeof $e.onActivation=="function"&&(pt=$e.onActivation(ue.parentContext,pt)),Ct&&($e.cache=pt,$e.activated=!0),et&&ve!==null&&!ve.has($e.id)&&ve.set($e.id,pt),pt}};function Pe(se){var ve=W(se.plan.rootRequest.requestScope);return ve(se.plan.rootRequest)}Q.resolve=Pe},asDA:function(Qe,Q){function O(j,H,X,N){var v=-1,z=j==null?0:j.length;for(N&&z&&(X=j[++v]);++v<z;)X=H(X,j[v],v,j);return X}Qe.exports=O},b2z7:function(Qe,Q){var O=/\w*$/;function j(H){var X=new H.constructor(H.source,O.exec(H));return X.lastIndex=H.lastIndex,X}Qe.exports=j},b48C:function(Qe,Q){function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(j){return!1}}Qe.exports=O,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},bpoo:function(Qe,Q){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(O){try{var j=function(){se||(se=!0,W())},H=function ue(){try{Pe.documentElement.doScroll("left")}catch(gt){return void setTimeout(ue,50)}j()},X=(X=document.getElementsByTagName("script"))[X.length-1],N=X.getAttribute("data-injectcss"),X=X.getAttribute("data-disable-injectsvg");if(!X){var v,z,W,Pe,se,ve=function(gt,Ne){Ne.parentNode.insertBefore(gt,Ne)};if(N&&!O.__iconfont__svg__cssinject__){O.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(ue){console&&console.log(ue)}}v=function(){var gt,Ne=document.createElement("div");Ne.innerHTML=O._iconfont_svg_string_3580659,(Ne=Ne.getElementsByTagName("svg")[0])&&(Ne.setAttribute("aria-hidden","true"),Ne.style.position="absolute",Ne.style.width=0,Ne.style.height=0,Ne.style.overflow="hidden",Ne=Ne,(gt=document.body).firstChild?ve(Ne,gt.firstChild):gt.appendChild(Ne))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(v,0):(z=function(){document.removeEventListener("DOMContentLoaded",z,!1),v()},document.addEventListener("DOMContentLoaded",z,!1)):document.attachEvent&&(W=v,Pe=O.document,se=!1,H(),Pe.onreadystatechange=function(){Pe.readyState=="complete"&&(Pe.onreadystatechange=null,j())})}}catch(ue){}}(window)},cSJO:function(Qe,Q,O){"use strict";var j=this&&this.__spreadArray||function(se,ve){for(var ue=0,gt=ve.length,Ne=se.length;ue<gt;ue++,Ne++)se[Ne]=ve[ue];return se};Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolveInstance=void 0;var H=O("MON2"),X=O("FV85"),N=O("xfSm");function v(se,ve,ue){var gt=ve.filter(function(st){return st.target!==null&&st.target.type===X.TargetTypeEnum.ClassProperty}),Ne=gt.map(ue);return gt.forEach(function(st,Dt){var pt="";pt=st.target.name.value();var $e=Ne[Dt];se[pt]=$e}),se}function z(se,ve){return new(se.bind.apply(se,j([void 0],ve)))}function W(se,ve){if(Reflect.hasMetadata(N.POST_CONSTRUCT,se)){var ue=Reflect.getMetadata(N.POST_CONSTRUCT,se);try{ve[ue.value]()}catch(gt){throw new Error(H.POST_CONSTRUCT_ERROR(se.name,gt.message))}}}function Pe(se,ve,ue){var gt=null;if(ve.length>0){var Ne=ve.filter(function(Dt){return Dt.target!==null&&Dt.target.type===X.TargetTypeEnum.ConstructorArgument}),st=Ne.map(ue);gt=z(se,st),gt=v(gt,ve,ue)}else gt=new se;return W(se,gt),gt}Q.resolveInstance=Pe},cWXX:function(Qe,Q,O){"use strict";var j=O("EFp3"),H=O.n(j),X=O("oIFs"),N=O.n(X)},cZ5Q:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.injectable=void 0;var j=O("MON2"),H=O("xfSm");function X(){return function(N){if(Reflect.hasOwnMetadata(H.PARAM_TYPES,N))throw new Error(j.DUPLICATED_INJECTABLE_DECORATOR);var v=Reflect.getMetadata(H.DESIGN_PARAM_TYPES,N)||[];return Reflect.defineMetadata(H.PARAM_TYPES,v,N),N}}Q.injectable=X},d9O0:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.id=void 0;var j=0;function H(){return j++}Q.id=H},d9mD:function(Qe,Q,O){Qe.exports={pie:"pie___2nzPi",chart:"chart____y02v",hasLegend:"hasLegend___2tvLi",legend:"legend___aOylG",dot:"dot___3cUod",line:"line___3wzdx",legendTitle:"legendTitle___3d-qz",percent:"percent___1EUip",value:"value___3oEZu",title:"title___3EZr5",total:"total___2C3lg",legendBlock:"legendBlock___1RfCR"}},dA7e:function(Qe,Q,O){Qe.exports.VectorTile=O("B93f"),Qe.exports.VectorTileFeature=O("HfwV"),Qe.exports.VectorTileLayer=O("DiGy")},dQpi:function(Qe,Q,O){var j=O("yGk4"),H=O("vN+2"),X=O("rEGp"),N=1/0,v=j&&1/X(new j([,-0]))[1]==N?function(z){return new j(z)}:H;Qe.exports=v},dVn5:function(Qe,Q){var O=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function j(H){return H.match(O)||[]}Qe.exports=j},dX1H:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Target=void 0;var j=O("xfSm"),H=O("d9O0"),X=O("GXnB"),N=O("zxMA"),v=function(){function z(W,Pe,se,ve){this.id=H.id(),this.type=W,this.serviceIdentifier=se,this.name=new N.QueryableString(Pe||""),this.metadata=new Array;var ue=null;typeof ve=="string"?ue=new X.Metadata(j.NAMED_TAG,ve):ve instanceof X.Metadata&&(ue=ve),ue!==null&&this.metadata.push(ue)}return z.prototype.hasTag=function(W){for(var Pe=0,se=this.metadata;Pe<se.length;Pe++){var ve=se[Pe];if(ve.key===W)return!0}return!1},z.prototype.isArray=function(){return this.hasTag(j.MULTI_INJECT_TAG)},z.prototype.matchesArray=function(W){return this.matchesTag(j.MULTI_INJECT_TAG)(W)},z.prototype.isNamed=function(){return this.hasTag(j.NAMED_TAG)},z.prototype.isTagged=function(){return this.metadata.some(function(W){return j.NON_CUSTOM_TAG_KEYS.every(function(Pe){return W.key!==Pe})})},z.prototype.isOptional=function(){return this.matchesTag(j.OPTIONAL_TAG)(!0)},z.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(W){return W.key===j.NAMED_TAG})[0]:null},z.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(W){return j.NON_CUSTOM_TAG_KEYS.every(function(Pe){return W.key!==Pe})}):null},z.prototype.matchesNamedTag=function(W){return this.matchesTag(j.NAMED_TAG)(W)},z.prototype.matchesTag=function(W){var Pe=this;return function(se){for(var ve=0,ue=Pe.metadata;ve<ue.length;ve++){var gt=ue[ve];if(gt.key===W&&gt.value===se)return!0}return!1}},z}();Q.Target=v},doU7:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingCount=void 0;var j={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Q.BindingCount=j},dxzI:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.AsyncContainerModule=Q.ContainerModule=void 0;var j=O("d9O0"),H=function(){function N(v){this.id=j.id(),this.registry=v}return N}();Q.ContainerModule=H;var X=function(){function N(v){this.id=j.id(),this.registry=v}return N}();Q.AsyncContainerModule=X},eRUA:function(Qe,Q,O){"use strict";Qe.exports=H;var j=O("kVK+");function H(Te){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Te)?Te:new Uint8Array(Te||0),this.pos=0,this.type=0,this.length=this.buf.length}H.Varint=0,H.Fixed64=1,H.Bytes=2,H.Fixed32=5;var X=(1<<16)*(1<<16),N=1/X,v=12,z=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");H.prototype={destroy:function(){this.buf=null},readFields:function(me,Re,Ut){for(Ut=Ut||this.length;this.pos<Ut;){var ae=this.readVarint(),Ce=ae>>3,Ae=this.pos;this.type=ae&7,me(Ce,Re,this),this.pos===Ae&&this.skip(ae)}return Re},readMessage:function(me,Re){return this.readFields(me,Re,this.readVarint()+this.pos)},readFixed32:function(){var me=jr(this.buf,this.pos);return this.pos+=4,me},readSFixed32:function(){var me=Jt(this.buf,this.pos);return this.pos+=4,me},readFixed64:function(){var me=jr(this.buf,this.pos)+jr(this.buf,this.pos+4)*X;return this.pos+=8,me},readSFixed64:function(){var me=jr(this.buf,this.pos)+Jt(this.buf,this.pos+4)*X;return this.pos+=8,me},readFloat:function(){var me=j.read(this.buf,this.pos,!0,23,4);return this.pos+=4,me},readDouble:function(){var me=j.read(this.buf,this.pos,!0,52,8);return this.pos+=8,me},readVarint:function(me){var Re=this.buf,Ut,ae;return ae=Re[this.pos++],Ut=ae&127,ae<128||(ae=Re[this.pos++],Ut|=(ae&127)<<7,ae<128)||(ae=Re[this.pos++],Ut|=(ae&127)<<14,ae<128)||(ae=Re[this.pos++],Ut|=(ae&127)<<21,ae<128)?Ut:(ae=Re[this.pos],Ut|=(ae&15)<<28,W(Ut,me,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var me=this.readVarint();return me%2==1?(me+1)/-2:me/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var me=this.readVarint()+this.pos,Re=this.pos;return this.pos=me,me-Re>=v&&z?Nt(this.buf,Re,me):Be(this.buf,Re,me)},readBytes:function(){var me=this.readVarint()+this.pos,Re=this.buf.subarray(this.pos,me);return this.pos=me,Re},readPackedVarint:function(me,Re){if(this.type!==H.Bytes)return me.push(this.readVarint(Re));var Ut=Pe(this);for(me=me||[];this.pos<Ut;)me.push(this.readVarint(Re));return me},readPackedSVarint:function(me){if(this.type!==H.Bytes)return me.push(this.readSVarint());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readSVarint());return me},readPackedBoolean:function(me){if(this.type!==H.Bytes)return me.push(this.readBoolean());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readBoolean());return me},readPackedFloat:function(me){if(this.type!==H.Bytes)return me.push(this.readFloat());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readFloat());return me},readPackedDouble:function(me){if(this.type!==H.Bytes)return me.push(this.readDouble());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readDouble());return me},readPackedFixed32:function(me){if(this.type!==H.Bytes)return me.push(this.readFixed32());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readFixed32());return me},readPackedSFixed32:function(me){if(this.type!==H.Bytes)return me.push(this.readSFixed32());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readSFixed32());return me},readPackedFixed64:function(me){if(this.type!==H.Bytes)return me.push(this.readFixed64());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readFixed64());return me},readPackedSFixed64:function(me){if(this.type!==H.Bytes)return me.push(this.readSFixed64());var Re=Pe(this);for(me=me||[];this.pos<Re;)me.push(this.readSFixed64());return me},skip:function(me){var Re=me&7;if(Re===H.Varint)for(;this.buf[this.pos++]>127;);else if(Re===H.Bytes)this.pos=this.readVarint()+this.pos;else if(Re===H.Fixed32)this.pos+=4;else if(Re===H.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+Re)},writeTag:function(me,Re){this.writeVarint(me<<3|Re)},realloc:function(me){for(var Re=this.length||16;Re<this.pos+me;)Re*=2;if(Re!==this.length){var Ut=new Uint8Array(Re);Ut.set(this.buf),this.buf=Ut,this.length=Re}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(me){this.realloc(4),Dr(this.buf,me,this.pos),this.pos+=4},writeSFixed32:function(me){this.realloc(4),Dr(this.buf,me,this.pos),this.pos+=4},writeFixed64:function(me){this.realloc(8),Dr(this.buf,me&-1,this.pos),Dr(this.buf,Math.floor(me*N),this.pos+4),this.pos+=8},writeSFixed64:function(me){this.realloc(8),Dr(this.buf,me&-1,this.pos),Dr(this.buf,Math.floor(me*N),this.pos+4),this.pos+=8},writeVarint:function(me){if(me=+me||0,me>268435455||me<0){ve(me,this);return}this.realloc(4),this.buf[this.pos++]=me&127|(me>127?128:0),!(me<=127)&&(this.buf[this.pos++]=(me>>>=7)&127|(me>127?128:0),!(me<=127)&&(this.buf[this.pos++]=(me>>>=7)&127|(me>127?128:0),!(me<=127)&&(this.buf[this.pos++]=me>>>7&127)))},writeSVarint:function(me){this.writeVarint(me<0?-me*2-1:me*2)},writeBoolean:function(me){this.writeVarint(Boolean(me))},writeString:function(me){me=String(me),this.realloc(me.length*4),this.pos++;var Re=this.pos;this.pos=Gt(this.buf,me,this.pos);var Ut=this.pos-Re;Ut>=128&&Ne(Re,Ut,this),this.pos=Re-1,this.writeVarint(Ut),this.pos+=Ut},writeFloat:function(me){this.realloc(4),j.write(this.buf,me,this.pos,!0,23,4),this.pos+=4},writeDouble:function(me){this.realloc(8),j.write(this.buf,me,this.pos,!0,52,8),this.pos+=8},writeBytes:function(me){var Re=me.length;this.writeVarint(Re),this.realloc(Re);for(var Ut=0;Ut<Re;Ut++)this.buf[this.pos++]=me[Ut]},writeRawMessage:function(me,Re){this.pos++;var Ut=this.pos;me(Re,this);var ae=this.pos-Ut;ae>=128&&Ne(Ut,ae,this),this.pos=Ut-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(me,Re,Ut){this.writeTag(me,H.Bytes),this.writeRawMessage(Re,Ut)},writePackedVarint:function(me,Re){Re.length&&this.writeMessage(me,st,Re)},writePackedSVarint:function(me,Re){Re.length&&this.writeMessage(me,Dt,Re)},writePackedBoolean:function(me,Re){Re.length&&this.writeMessage(me,Ct,Re)},writePackedFloat:function(me,Re){Re.length&&this.writeMessage(me,pt,Re)},writePackedDouble:function(me,Re){Re.length&&this.writeMessage(me,$e,Re)},writePackedFixed32:function(me,Re){Re.length&&this.writeMessage(me,et,Re)},writePackedSFixed32:function(me,Re){Re.length&&this.writeMessage(me,kt,Re)},writePackedFixed64:function(me,Re){Re.length&&this.writeMessage(me,Je,Re)},writePackedSFixed64:function(me,Re){Re.length&&this.writeMessage(me,Xe,Re)},writeBytesField:function(me,Re){this.writeTag(me,H.Bytes),this.writeBytes(Re)},writeFixed32Field:function(me,Re){this.writeTag(me,H.Fixed32),this.writeFixed32(Re)},writeSFixed32Field:function(me,Re){this.writeTag(me,H.Fixed32),this.writeSFixed32(Re)},writeFixed64Field:function(me,Re){this.writeTag(me,H.Fixed64),this.writeFixed64(Re)},writeSFixed64Field:function(me,Re){this.writeTag(me,H.Fixed64),this.writeSFixed64(Re)},writeVarintField:function(me,Re){this.writeTag(me,H.Varint),this.writeVarint(Re)},writeSVarintField:function(me,Re){this.writeTag(me,H.Varint),this.writeSVarint(Re)},writeStringField:function(me,Re){this.writeTag(me,H.Bytes),this.writeString(Re)},writeFloatField:function(me,Re){this.writeTag(me,H.Fixed32),this.writeFloat(Re)},writeDoubleField:function(me,Re){this.writeTag(me,H.Fixed64),this.writeDouble(Re)},writeBooleanField:function(me,Re){this.writeVarintField(me,Boolean(Re))}};function W(Te,me,Re){var Ut=Re.buf,ae,Ce;if(Ce=Ut[Re.pos++],ae=(Ce&112)>>4,Ce<128||(Ce=Ut[Re.pos++],ae|=(Ce&127)<<3,Ce<128)||(Ce=Ut[Re.pos++],ae|=(Ce&127)<<10,Ce<128)||(Ce=Ut[Re.pos++],ae|=(Ce&127)<<17,Ce<128)||(Ce=Ut[Re.pos++],ae|=(Ce&127)<<24,Ce<128)||(Ce=Ut[Re.pos++],ae|=(Ce&1)<<31,Ce<128))return se(Te,ae,me);throw new Error("Expected varint not more than 10 bytes")}function Pe(Te){return Te.type===H.Bytes?Te.readVarint()+Te.pos:Te.pos+1}function se(Te,me,Re){return Re?me*4294967296+(Te>>>0):(me>>>0)*4294967296+(Te>>>0)}function ve(Te,me){var Re,Ut;if(Te>=0?(Re=Te%4294967296|0,Ut=Te/4294967296|0):(Re=~(-Te%4294967296),Ut=~(-Te/4294967296),Re^4294967295?Re=Re+1|0:(Re=0,Ut=Ut+1|0)),Te>=18446744073709552e3||Te<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),ue(Re,Ut,me),gt(Ut,me)}function ue(Te,me,Re){Re.buf[Re.pos++]=Te&127|128,Te>>>=7,Re.buf[Re.pos++]=Te&127|128,Te>>>=7,Re.buf[Re.pos++]=Te&127|128,Te>>>=7,Re.buf[Re.pos++]=Te&127|128,Te>>>=7,Re.buf[Re.pos]=Te&127}function gt(Te,me){var Re=(Te&7)<<4;me.buf[me.pos++]|=Re|((Te>>>=3)?128:0),!!Te&&(me.buf[me.pos++]=Te&127|((Te>>>=7)?128:0),!!Te&&(me.buf[me.pos++]=Te&127|((Te>>>=7)?128:0),!!Te&&(me.buf[me.pos++]=Te&127|((Te>>>=7)?128:0),!!Te&&(me.buf[me.pos++]=Te&127|((Te>>>=7)?128:0),!!Te&&(me.buf[me.pos++]=Te&127)))))}function Ne(Te,me,Re){var Ut=me<=16383?1:me<=2097151?2:me<=268435455?3:Math.floor(Math.log(me)/(Math.LN2*7));Re.realloc(Ut);for(var ae=Re.pos-1;ae>=Te;ae--)Re.buf[ae+Ut]=Re.buf[ae]}function st(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeVarint(Te[Re])}function Dt(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeSVarint(Te[Re])}function pt(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeFloat(Te[Re])}function $e(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeDouble(Te[Re])}function Ct(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeBoolean(Te[Re])}function et(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeFixed32(Te[Re])}function kt(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeSFixed32(Te[Re])}function Je(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeFixed64(Te[Re])}function Xe(Te,me){for(var Re=0;Re<Te.length;Re++)me.writeSFixed64(Te[Re])}function jr(Te,me){return(Te[me]|Te[me+1]<<8|Te[me+2]<<16)+Te[me+3]*16777216}function Dr(Te,me,Re){Te[Re]=me,Te[Re+1]=me>>>8,Te[Re+2]=me>>>16,Te[Re+3]=me>>>24}function Jt(Te,me){return(Te[me]|Te[me+1]<<8|Te[me+2]<<16)+(Te[me+3]<<24)}function Be(Te,me,Re){for(var Ut="",ae=me;ae<Re;){var Ce=Te[ae],Ae=null,vt=Ce>239?4:Ce>223?3:Ce>191?2:1;if(ae+vt>Re)break;var At,Bt,Ft;vt===1?Ce<128&&(Ae=Ce):vt===2?(At=Te[ae+1],(At&192)==128&&(Ae=(Ce&31)<<6|At&63,Ae<=127&&(Ae=null))):vt===3?(At=Te[ae+1],Bt=Te[ae+2],(At&192)==128&&(Bt&192)==128&&(Ae=(Ce&15)<<12|(At&63)<<6|Bt&63,(Ae<=2047||Ae>=55296&&Ae<=57343)&&(Ae=null))):vt===4&&(At=Te[ae+1],Bt=Te[ae+2],Ft=Te[ae+3],(At&192)==128&&(Bt&192)==128&&(Ft&192)==128&&(Ae=(Ce&15)<<18|(At&63)<<12|(Bt&63)<<6|Ft&63,(Ae<=65535||Ae>=1114112)&&(Ae=null))),Ae===null?(Ae=65533,vt=1):Ae>65535&&(Ae-=65536,Ut+=String.fromCharCode(Ae>>>10&1023|55296),Ae=56320|Ae&1023),Ut+=String.fromCharCode(Ae),ae+=vt}return Ut}function Nt(Te,me,Re){return z.decode(Te.subarray(me,Re))}function Gt(Te,me,Re){for(var Ut=0,ae,Ce;Ut<me.length;Ut++){if(ae=me.charCodeAt(Ut),ae>55295&&ae<57344)if(Ce)if(ae<56320){Te[Re++]=239,Te[Re++]=191,Te[Re++]=189,Ce=ae;continue}else ae=Ce-55296<<10|ae-56320|65536,Ce=null;else{ae>56319||Ut+1===me.length?(Te[Re++]=239,Te[Re++]=191,Te[Re++]=189):Ce=ae;continue}else Ce&&(Te[Re++]=239,Te[Re++]=191,Te[Re++]=189,Ce=null);ae<128?Te[Re++]=ae:(ae<2048?Te[Re++]=ae>>6|192:(ae<65536?Te[Re++]=ae>>12|224:(Te[Re++]=ae>>18|240,Te[Re++]=ae>>12&63|128),Te[Re++]=ae>>6&63|128),Te[Re++]=ae&63|128)}return Re}},fbrv:function(Qe,Q,O){"use strict";var j=this&&this.__spreadArray||function(Dt,pt){for(var $e=0,Ct=pt.length,et=Dt.length;$e<Ct;$e++,et++)Dt[et]=pt[$e];return Dt};Object.defineProperty(Q,"__esModule",{value:!0}),Q.getFunctionName=Q.getBaseClassDependencyCount=Q.getDependencies=void 0;var H=O("Yk9n"),X=O("MON2"),N=O("FV85"),v=O("xfSm"),z=O("ujMp");Object.defineProperty(Q,"getFunctionName",{enumerable:!0,get:function(){return z.getFunctionName}});var W=O("dX1H");function Pe(Dt,pt){var $e=z.getFunctionName(pt),Ct=se(Dt,$e,pt,!1);return Ct}Q.getDependencies=Pe;function se(Dt,pt,$e,Ct){var et=Dt.getConstructorMetadata($e),kt=et.compilerGeneratedMetadata;if(kt===void 0){var Je=X.MISSING_INJECTABLE_ANNOTATION+" "+pt+".";throw new Error(Je)}var Xe=et.userGeneratedMetadata,jr=Object.keys(Xe),Dr=$e.length===0&&jr.length>0,Jt=jr.length>$e.length,Be=Dr||Jt?jr.length:$e.length,Nt=ue(Ct,pt,kt,Xe,Be),Gt=gt(Dt,$e),Te=j(j([],Nt),Gt);return Te}function ve(Dt,pt,$e,Ct,et){var kt=et[Dt.toString()]||[],Je=st(kt),Xe=Je.unmanaged!==!0,jr=Ct[Dt],Dr=Je.inject||Je.multiInject;if(jr=Dr||jr,jr instanceof H.LazyServiceIdentifer&&(jr=jr.unwrap()),Xe){var Jt=jr===Object,Be=jr===Function,Nt=jr===void 0,Gt=Jt||Be||Nt;if(!pt&&Gt){var Te=X.MISSING_INJECT_ANNOTATION+" argument "+Dt+" in class "+$e+".";throw new Error(Te)}var me=new W.Target(N.TargetTypeEnum.ConstructorArgument,Je.targetName,jr);return me.metadata=kt,me}return null}function ue(Dt,pt,$e,Ct,et){for(var kt=[],Je=0;Je<et;Je++){var Xe=Je,jr=ve(Xe,Dt,pt,$e,Ct);jr!==null&&kt.push(jr)}return kt}function gt(Dt,pt){for(var $e=Dt.getPropertiesMetadata(pt),Ct=[],et=Object.keys($e),kt=0,Je=et;kt<Je.length;kt++){var Xe=Je[kt],jr=$e[Xe],Dr=st($e[Xe]),Jt=Dr.targetName||Xe,Be=Dr.inject||Dr.multiInject,Nt=new W.Target(N.TargetTypeEnum.ClassProperty,Jt,Be);Nt.metadata=jr,Ct.push(Nt)}var Gt=Object.getPrototypeOf(pt.prototype).constructor;if(Gt!==Object){var Te=gt(Dt,Gt);Ct=j(j([],Ct),Te)}return Ct}function Ne(Dt,pt){var $e=Object.getPrototypeOf(pt.prototype).constructor;if($e!==Object){var Ct=z.getFunctionName($e),et=se(Dt,Ct,$e,!0),kt=et.map(function(jr){return jr.metadata.filter(function(Dr){return Dr.key===v.UNMANAGED_TAG})}),Je=[].concat.apply([],kt).length,Xe=et.length-Je;return Xe>0?Xe:Ne(Dt,$e)}else return 0}Q.getBaseClassDependencyCount=Ne;function st(Dt){var pt={};return Dt.forEach(function($e){pt[$e.key.toString()]=$e.value}),{inject:pt[v.INJECT_TAG],multiInject:pt[v.MULTI_INJECT_TAG],targetName:pt[v.NAME_TAG],unmanaged:pt[v.UNMANAGED_TAG]}}},fbvF:function(Qe,Q,O){(function(j,H){Qe.exports=H()})(this,function(){"use strict";var j=function(ce){return ce instanceof Uint8Array||ce instanceof Uint16Array||ce instanceof Uint32Array||ce instanceof Int8Array||ce instanceof Int16Array||ce instanceof Int32Array||ce instanceof Float32Array||ce instanceof Float64Array||ce instanceof Uint8ClampedArray},H=function(ce,it){for(var tr=Object.keys(it),Ar=0;Ar<tr.length;++Ar)ce[tr[Ar]]=it[tr[Ar]];return ce},X=`
`;function N(Y){return typeof atob!="undefined"?atob(Y):"base64:"+Y}function v(Y){var ce=new Error("(regl) "+Y);throw console.error(ce),ce}function z(Y,ce){Y||v(ce)}function W(Y){return Y?": "+Y:""}function Pe(Y,ce,it){Y in ce||v("unknown parameter ("+Y+")"+W(it)+". possible values: "+Object.keys(ce).join())}function se(Y,ce){j(Y)||v("invalid parameter type"+W(ce)+". must be a typed array")}function ve(Y,ce){switch(ce){case"number":return typeof Y=="number";case"object":return typeof Y=="object";case"string":return typeof Y=="string";case"boolean":return typeof Y=="boolean";case"function":return typeof Y=="function";case"undefined":return typeof Y=="undefined";case"symbol":return typeof Y=="symbol"}}function ue(Y,ce,it){ve(Y,ce)||v("invalid parameter type"+W(it)+". expected "+ce+", got "+typeof Y)}function gt(Y,ce){Y>=0&&(Y|0)===Y||v("invalid parameter type, ("+Y+")"+W(ce)+". must be a nonnegative integer")}function Ne(Y,ce,it){ce.indexOf(Y)<0&&v("invalid value"+W(it)+". must be one of: "+ce)}var st=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Dt(Y){Object.keys(Y).forEach(function(ce){st.indexOf(ce)<0&&v('invalid regl constructor argument "'+ce+'". must be one of '+st)})}function pt(Y,ce){for(Y=Y+"";Y.length<ce;)Y=" "+Y;return Y}function $e(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ct(Y,ce){this.number=Y,this.line=ce,this.errors=[]}function et(Y,ce,it){this.file=Y,this.line=ce,this.message=it}function kt(){var Y=new Error,ce=(Y.stack||Y).toString(),it=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ce);if(it)return it[1];var tr=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ce);return tr?tr[1]:"unknown"}function Je(){var Y=new Error,ce=(Y.stack||Y).toString(),it=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ce);if(it)return it[1];var tr=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ce);return tr?tr[1]:"unknown"}function Xe(Y,ce){var it=Y.split(`
`),tr=1,Ar=0,yr={unknown:new $e,0:new $e};yr.unknown.name=yr[0].name=ce||kt(),yr.unknown.lines.push(new Ct(0,""));for(var Lt=0;Lt<it.length;++Lt){var Gr=it[Lt],Jr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Gr);if(Jr)switch(Jr[1]){case"line":var nn=/(\d+)(\s+\d+)?/.exec(Jr[2]);nn&&(tr=nn[1]|0,nn[2]&&(Ar=nn[2]|0,Ar in yr||(yr[Ar]=new $e)));break;case"define":var tn=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Jr[2]);tn&&(yr[Ar].name=tn[1]?N(tn[2]):tn[2]);break}yr[Ar].lines.push(new Ct(tr++,Gr))}return Object.keys(yr).forEach(function(an){var yn=yr[an];yn.lines.forEach(function(Yr){yn.index[Yr.number]=Yr})}),yr}function jr(Y){var ce=[];return Y.split(`
`).forEach(function(it){if(!(it.length<5)){var tr=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(it);tr?ce.push(new et(tr[1]|0,tr[2]|0,tr[3].trim())):it.length>0&&ce.push(new et("unknown",0,it))}}),ce}function Dr(Y,ce){ce.forEach(function(it){var tr=Y[it.file];if(tr){var Ar=tr.index[it.line];if(Ar){Ar.errors.push(it),tr.hasErrors=!0;return}}Y.unknown.hasErrors=!0,Y.unknown.lines[0].errors.push(it)})}function Jt(Y,ce,it,tr,Ar){if(!Y.getShaderParameter(ce,Y.COMPILE_STATUS)){var yr=Y.getShaderInfoLog(ce),Lt=tr===Y.FRAGMENT_SHADER?"fragment":"vertex";Ut(it,"string",Lt+" shader source must be a string",Ar);var Gr=Xe(it,Ar),Jr=jr(yr);Dr(Gr,Jr),Object.keys(Gr).forEach(function(nn){var tn=Gr[nn];if(!tn.hasErrors)return;var an=[""],yn=[""];function Yr(xr,jt){an.push(xr),yn.push(jt||"")}Yr("file number "+nn+": "+tn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),tn.lines.forEach(function(xr){if(xr.errors.length>0){Yr(pt(xr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Yr(xr.line+X,"color:red; background-color:yellow; font-weight:bold");var jt=0;xr.errors.forEach(function($t){var en=$t.message,Tn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(en);if(Tn){var Er=Tn[1];switch(en=Tn[2],Er){case"assign":Er="=";break}jt=Math.max(xr.line.indexOf(Er,jt),0)}else jt=0;Yr(pt("| ",6)),Yr(pt("^^^",jt+3)+X,"font-weight:bold"),Yr(pt("| ",6)),Yr(en+X,"font-weight:bold")}),Yr(pt("| ",6)+X)}else Yr(pt(xr.number,4)+"|  "),Yr(xr.line+X,"color:red")}),typeof document!="undefined"&&!window.chrome?(yn[0]=an.join("%c"),console.log.apply(console,yn)):console.log(an.join(""))}),z.raise("Error compiling "+Lt+" shader, "+Gr[0].name)}}function Be(Y,ce,it,tr,Ar){if(!Y.getProgramParameter(ce,Y.LINK_STATUS)){var yr=Y.getProgramInfoLog(ce),Lt=Xe(it,Ar),Gr=Xe(tr,Ar),Jr='Error linking program with vertex shader, "'+Gr[0].name+'", and fragment shader "'+Lt[0].name+'"';typeof document!="undefined"?console.log("%c"+Jr+X+"%c"+yr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Jr+X+yr),z.raise(Jr)}}function Nt(Y){Y._commandRef=kt()}function Gt(Y,ce,it,tr){Nt(Y);function Ar(Jr){return Jr?tr.id(Jr):0}Y._fragId=Ar(Y.static.frag),Y._vertId=Ar(Y.static.vert);function yr(Jr,nn){Object.keys(nn).forEach(function(tn){Jr[tr.id(tn)]=!0})}var Lt=Y._uniformSet={};yr(Lt,ce.static),yr(Lt,ce.dynamic);var Gr=Y._attributeSet={};yr(Gr,it.static),yr(Gr,it.dynamic),Y._hasCount="count"in Y.static||"count"in Y.dynamic||"elements"in Y.static||"elements"in Y.dynamic}function Te(Y,ce){var it=Je();v(Y+" in command "+(ce||kt())+(it==="unknown"?"":" called from "+it))}function me(Y,ce,it){Y||Te(ce,it||kt())}function Re(Y,ce,it,tr){Y in ce||Te("unknown parameter ("+Y+")"+W(it)+". possible values: "+Object.keys(ce).join(),tr||kt())}function Ut(Y,ce,it,tr){ve(Y,ce)||Te("invalid parameter type"+W(it)+". expected "+ce+", got "+typeof Y,tr||kt())}function ae(Y){Y()}function Ce(Y,ce,it){Y.texture?Ne(Y.texture._texture.internalformat,ce,"unsupported texture format for attachment"):Ne(Y.renderbuffer._renderbuffer.format,it,"unsupported renderbuffer format for attachment")}var Ae=33071,vt=9728,At=9984,Bt=9985,Ft=9986,fr=9987,Tr=5120,Br=5121,On=5122,Fr=5123,Hn=5124,ni=5125,Yn=5126,ei=32819,ci=32820,Sr=33635,_r=34042,Kt=36193,Wt={};Wt[Tr]=Wt[Br]=1,Wt[On]=Wt[Fr]=Wt[Kt]=Wt[Sr]=Wt[ei]=Wt[ci]=2,Wt[Hn]=Wt[ni]=Wt[Yn]=Wt[_r]=4;function Ir(Y,ce){return Y===ci||Y===ei||Y===Sr?2:Y===_r?4:Wt[Y]*ce}function je(Y){return!(Y&Y-1)&&!!Y}function oe(Y,ce,it){var tr,Ar=ce.width,yr=ce.height,Lt=ce.channels;z(Ar>0&&Ar<=it.maxTextureSize&&yr>0&&yr<=it.maxTextureSize,"invalid texture shape"),(Y.wrapS!==Ae||Y.wrapT!==Ae)&&z(je(Ar)&&je(yr),"incompatible wrap mode for texture, both width and height must be power of 2"),ce.mipmask===1?Ar!==1&&yr!==1&&z(Y.minFilter!==At&&Y.minFilter!==Ft&&Y.minFilter!==Bt&&Y.minFilter!==fr,"min filter requires mipmap"):(z(je(Ar)&&je(yr),"texture must be a square power of 2 to support mipmapping"),z(ce.mipmask===(Ar<<1)-1,"missing or incomplete mipmap data")),ce.type===Yn&&(it.extensions.indexOf("oes_texture_float_linear")<0&&z(Y.minFilter===vt&&Y.magFilter===vt,"filter not supported, must enable oes_texture_float_linear"),z(!Y.genMipmaps,"mipmap generation not supported with float textures"));var Gr=ce.images;for(tr=0;tr<16;++tr)if(Gr[tr]){var Jr=Ar>>tr,nn=yr>>tr;z(ce.mipmask&1<<tr,"missing mipmap data");var tn=Gr[tr];if(z(tn.width===Jr&&tn.height===nn,"invalid shape for mip images"),z(tn.format===ce.format&&tn.internalformat===ce.internalformat&&tn.type===ce.type,"incompatible type for mip image"),!tn.compressed)if(tn.data){var an=Math.ceil(Ir(tn.type,Lt)*Jr/tn.unpackAlignment)*tn.unpackAlignment;z(tn.data.byteLength===an*nn,"invalid data for image, buffer size is inconsistent with image format")}else tn.element||tn.copy}else Y.genMipmaps||z((ce.mipmask&1<<tr)==0,"extra mipmap data");ce.compressed&&z(!Y.genMipmaps,"mipmap generation for compressed images not supported")}function ne(Y,ce,it,tr){var Ar=Y.width,yr=Y.height,Lt=Y.channels;z(Ar>0&&Ar<=tr.maxTextureSize&&yr>0&&yr<=tr.maxTextureSize,"invalid texture shape"),z(Ar===yr,"cube map must be square"),z(ce.wrapS===Ae&&ce.wrapT===Ae,"wrap mode not supported by cube map");for(var Gr=0;Gr<it.length;++Gr){var Jr=it[Gr];z(Jr.width===Ar&&Jr.height===yr,"inconsistent cube map face shape"),ce.genMipmaps&&(z(!Jr.compressed,"can not generate mipmap for compressed textures"),z(Jr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var nn=Jr.images,tn=0;tn<16;++tn){var an=nn[tn];if(an){var yn=Ar>>tn,Yr=yr>>tn;z(Jr.mipmask&1<<tn,"missing mipmap data"),z(an.width===yn&&an.height===Yr,"invalid shape for mip images"),z(an.format===Y.format&&an.internalformat===Y.internalformat&&an.type===Y.type,"incompatible type for mip image"),an.compressed||(an.data?z(an.data.byteLength===yn*Yr*Math.max(Ir(an.type,Lt),an.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):an.element||an.copy)}}}}var D=H(z,{optional:ae,raise:v,commandRaise:Te,command:me,parameter:Pe,commandParameter:Re,constructor:Dt,type:ue,commandType:Ut,isTypedArray:se,nni:gt,oneOf:Ne,shaderError:Jt,linkError:Be,callSite:Je,saveCommandRef:Nt,saveDrawInfo:Gt,framebufferFormat:Ce,guessCommand:kt,texture2D:oe,textureCube:ne}),Ee=0,He=0;function xt(Y,ce){this.id=Ee++,this.type=Y,this.data=ce}function er(Y){return Y.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ur(Y){if(Y.length===0)return[];var ce=Y.charAt(0),it=Y.charAt(Y.length-1);if(Y.length>1&&ce===it&&(ce==='"'||ce==="'"))return['"'+er(Y.substr(1,Y.length-2))+'"'];var tr=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(Y);if(tr)return ur(Y.substr(0,tr.index)).concat(ur(tr[1])).concat(ur(Y.substr(tr.index+tr[0].length)));var Ar=Y.split(".");if(Ar.length===1)return['"'+er(Y)+'"'];for(var yr=[],Lt=0;Lt<Ar.length;++Lt)yr=yr.concat(ur(Ar[Lt]));return yr}function tt(Y){return"["+ur(Y).join("][")+"]"}function It(Y,ce){return new xt(Y,tt(ce+""))}function or(Y){return typeof Y=="function"&&!Y._reglType||Y instanceof xt}function Cr(Y,ce){return typeof Y=="function"?new xt(He,Y):Y}var Or={DynamicVariable:xt,define:It,isDynamic:or,unbox:Cr,accessor:tt},Nn={next:typeof requestAnimationFrame=="function"?function(Y){return requestAnimationFrame(Y)}:function(Y){return setTimeout(Y,16)},cancel:typeof cancelAnimationFrame=="function"?function(Y){return cancelAnimationFrame(Y)}:clearTimeout},sn=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function gn(){var Y={"":0},ce=[""];return{id:function(tr){var Ar=Y[tr];return Ar||(Ar=Y[tr]=ce.length,ce.push(tr),Ar)},str:function(tr){return ce[tr]}}}function dn(Y,ce,it){var tr=document.createElement("canvas");H(tr.style,{border:0,margin:0,padding:0,top:0,left:0}),Y.appendChild(tr),Y===document.body&&(tr.style.position="absolute",H(Y.style,{margin:0,padding:0}));function Ar(){var Gr=window.innerWidth,Jr=window.innerHeight;if(Y!==document.body){var nn=Y.getBoundingClientRect();Gr=nn.right-nn.left,Jr=nn.bottom-nn.top}tr.width=it*Gr,tr.height=it*Jr,H(tr.style,{width:Gr+"px",height:Jr+"px"})}var yr;Y!==document.body&&typeof ResizeObserver=="function"?(yr=new ResizeObserver(function(){setTimeout(Ar)}),yr.observe(Y)):window.addEventListener("resize",Ar,!1);function Lt(){yr?yr.disconnect():window.removeEventListener("resize",Ar),Y.removeChild(tr)}return Ar(),{canvas:tr,onDestroy:Lt}}function ri(Y,ce){function it(tr){try{return Y.getContext(tr,ce)}catch(Ar){return null}}return it("webgl")||it("experimental-webgl")||it("webgl-experimental")}function mi(Y){return typeof Y.nodeName=="string"&&typeof Y.appendChild=="function"&&typeof Y.getBoundingClientRect=="function"}function ki(Y){return typeof Y.drawArrays=="function"||typeof Y.drawElements=="function"}function Aa(Y){return typeof Y=="string"?Y.split():(D(Array.isArray(Y),"invalid extension array"),Y)}function Pa(Y){return typeof Y=="string"?(D(typeof document!="undefined","not supported outside of DOM"),document.querySelector(Y)):Y}function Co(Y){var ce=Y||{},it,tr,Ar,yr,Lt={},Gr=[],Jr=[],nn=typeof window=="undefined"?1:window.devicePixelRatio,tn=!1,an=function(jt){jt&&D.raise(jt)},yn=function(){};if(typeof ce=="string"?(D(typeof document!="undefined","selector queries only supported in DOM enviroments"),it=document.querySelector(ce),D(it,"invalid query string for element")):typeof ce=="object"?mi(ce)?it=ce:ki(ce)?(yr=ce,Ar=yr.canvas):(D.constructor(ce),"gl"in ce?yr=ce.gl:"canvas"in ce?Ar=Pa(ce.canvas):"container"in ce&&(tr=Pa(ce.container)),"attributes"in ce&&(Lt=ce.attributes,D.type(Lt,"object","invalid context attributes")),"extensions"in ce&&(Gr=Aa(ce.extensions)),"optionalExtensions"in ce&&(Jr=Aa(ce.optionalExtensions)),"onDone"in ce&&(D.type(ce.onDone,"function","invalid or missing onDone callback"),an=ce.onDone),"profile"in ce&&(tn=!!ce.profile),"pixelRatio"in ce&&(nn=+ce.pixelRatio,D(nn>0,"invalid pixel ratio"))):D.raise("invalid arguments to regl"),it&&(it.nodeName.toLowerCase()==="canvas"?Ar=it:tr=it),!yr){if(!Ar){D(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Yr=dn(tr||document.body,an,nn);if(!Yr)return null;Ar=Yr.canvas,yn=Yr.onDestroy}Lt.premultipliedAlpha===void 0&&(Lt.premultipliedAlpha=!0),yr=ri(Ar,Lt)}return yr?{gl:yr,canvas:Ar,container:tr,extensions:Gr,optionalExtensions:Jr,pixelRatio:nn,profile:tn,onDone:an,onDestroy:yn}:(yn(),an("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function yo(Y,ce){var it={};function tr(Lt){D.type(Lt,"string","extension name must be string");var Gr=Lt.toLowerCase(),Jr;try{Jr=it[Gr]=Y.getExtension(Gr)}catch(nn){}return!!Jr}for(var Ar=0;Ar<ce.extensions.length;++Ar){var yr=ce.extensions[Ar];if(!tr(yr))return ce.onDestroy(),ce.onDone('"'+yr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ce.optionalExtensions.forEach(tr),{extensions:it,restore:function(){Object.keys(it).forEach(function(Gr){if(it[Gr]&&!tr(Gr))throw new Error("(regl): error restoring extension "+Gr)})}}}function Mi(Y,ce){for(var it=Array(Y),tr=0;tr<Y;++tr)it[tr]=ce(tr);return it}var te=5120,K=5121,fe=5122,Se=5123,Le=5124,mt=5125,St=5126;function ge(Y){for(var ce=16;ce<=1<<28;ce*=16)if(Y<=ce)return ce;return 0}function Ye(Y){var ce,it;return ce=(Y>65535)<<4,Y>>>=ce,it=(Y>255)<<3,Y>>>=it,ce|=it,it=(Y>15)<<2,Y>>>=it,ce|=it,it=(Y>3)<<1,Y>>>=it,ce|=it,ce|Y>>1}function zt(){var Y=Mi(8,function(){return[]});function ce(yr){var Lt=ge(yr),Gr=Y[Ye(Lt)>>2];return Gr.length>0?Gr.pop():new ArrayBuffer(Lt)}function it(yr){Y[Ye(yr.byteLength)>>2].push(yr)}function tr(yr,Lt){var Gr=null;switch(yr){case te:Gr=new Int8Array(ce(Lt),0,Lt);break;case K:Gr=new Uint8Array(ce(Lt),0,Lt);break;case fe:Gr=new Int16Array(ce(2*Lt),0,Lt);break;case Se:Gr=new Uint16Array(ce(2*Lt),0,Lt);break;case Le:Gr=new Int32Array(ce(4*Lt),0,Lt);break;case mt:Gr=new Uint32Array(ce(4*Lt),0,Lt);break;case St:Gr=new Float32Array(ce(4*Lt),0,Lt);break;default:return null}return Gr.length!==Lt?Gr.subarray(0,Lt):Gr}function Ar(yr){it(yr.buffer)}return{alloc:ce,free:it,allocType:tr,freeType:Ar}}var Rr=zt();Rr.zero=zt();var Nr=3408,pr=3410,Wr=3411,Gn=3412,wn=3413,dr=3414,Sn=3415,bn=33901,we=33902,Kn=3379,xn=3386,Vi=34921,ia=36347,bi=36348,ta=35661,Ni=35660,ns=34930,wi=36349,Xa=34076,Hi=34024,Zi=7936,gi=7937,eo=7938,Fs=35724,_o=34047,ms=36063,oc=34852,wo=3553,Ia=34067,Ol=34069,Zo=33984,Na=6408,ao=5126,Ta=5121,Do=36160,$o=36053,kc=36064,Bs=16384,Dh=function(ce,it){var tr=1;it.ext_texture_filter_anisotropic&&(tr=ce.getParameter(_o));var Ar=1,yr=1;it.webgl_draw_buffers&&(Ar=ce.getParameter(oc),yr=ce.getParameter(ms));var Lt=!!it.oes_texture_float;if(Lt){var Gr=ce.createTexture();ce.bindTexture(wo,Gr),ce.texImage2D(wo,0,Na,1,1,0,Na,ao,null);var Jr=ce.createFramebuffer();if(ce.bindFramebuffer(Do,Jr),ce.framebufferTexture2D(Do,kc,wo,Gr,0),ce.bindTexture(wo,null),ce.checkFramebufferStatus(Do)!==$o)Lt=!1;else{ce.viewport(0,0,1,1),ce.clearColor(1,0,0,1),ce.clear(Bs);var nn=Rr.allocType(ao,4);ce.readPixels(0,0,1,1,Na,ao,nn),ce.getError()?Lt=!1:(ce.deleteFramebuffer(Jr),ce.deleteTexture(Gr),Lt=nn[0]===1),Rr.freeType(nn)}}var tn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),an=!0;if(!tn){var yn=ce.createTexture(),Yr=Rr.allocType(Ta,36);ce.activeTexture(Zo),ce.bindTexture(Ia,yn),ce.texImage2D(Ol,0,Na,3,3,0,Na,Ta,Yr),Rr.freeType(Yr),ce.bindTexture(Ia,null),ce.deleteTexture(yn),an=!ce.getError()}return{colorBits:[ce.getParameter(pr),ce.getParameter(Wr),ce.getParameter(Gn),ce.getParameter(wn)],depthBits:ce.getParameter(dr),stencilBits:ce.getParameter(Sn),subpixelBits:ce.getParameter(Nr),extensions:Object.keys(it).filter(function(xr){return!!it[xr]}),maxAnisotropic:tr,maxDrawbuffers:Ar,maxColorAttachments:yr,pointSizeDims:ce.getParameter(bn),lineWidthDims:ce.getParameter(we),maxViewportDims:ce.getParameter(xn),maxCombinedTextureUnits:ce.getParameter(ta),maxCubeMapSize:ce.getParameter(Xa),maxRenderbufferSize:ce.getParameter(Hi),maxTextureUnits:ce.getParameter(ns),maxTextureSize:ce.getParameter(Kn),maxAttributes:ce.getParameter(Vi),maxVertexUniforms:ce.getParameter(ia),maxVertexTextureUnits:ce.getParameter(Ni),maxVaryingVectors:ce.getParameter(bi),maxFragmentUniforms:ce.getParameter(wi),glsl:ce.getParameter(Fs),renderer:ce.getParameter(gi),vendor:ce.getParameter(Zi),version:ce.getParameter(eo),readFloat:Lt,npotTextureCube:an}};function Fo(Y){return!!Y&&typeof Y=="object"&&Array.isArray(Y.shape)&&Array.isArray(Y.stride)&&typeof Y.offset=="number"&&Y.shape.length===Y.stride.length&&(Array.isArray(Y.data)||j(Y.data))}var _a=function(ce){return Object.keys(ce).map(function(it){return ce[it]})},ft={shape:ji,flatten:Pn};function le(Y,ce,it){for(var tr=0;tr<ce;++tr)it[tr]=Y[tr]}function Ze(Y,ce,it,tr){for(var Ar=0,yr=0;yr<ce;++yr)for(var Lt=Y[yr],Gr=0;Gr<it;++Gr)tr[Ar++]=Lt[Gr]}function sr(Y,ce,it,tr,Ar,yr){for(var Lt=yr,Gr=0;Gr<ce;++Gr)for(var Jr=Y[Gr],nn=0;nn<it;++nn)for(var tn=Jr[nn],an=0;an<tr;++an)Ar[Lt++]=tn[an]}function rn(Y,ce,it,tr,Ar){for(var yr=1,Lt=it+1;Lt<ce.length;++Lt)yr*=ce[Lt];var Gr=ce[it];if(ce.length-it==4){var Jr=ce[it+1],nn=ce[it+2],tn=ce[it+3];for(Lt=0;Lt<Gr;++Lt)sr(Y[Lt],Jr,nn,tn,tr,Ar),Ar+=yr}else for(Lt=0;Lt<Gr;++Lt)rn(Y[Lt],ce,it+1,tr,Ar),Ar+=yr}function Pn(Y,ce,it,tr){var Ar=1;if(ce.length)for(var yr=0;yr<ce.length;++yr)Ar*=ce[yr];else Ar=0;var Lt=tr||Rr.allocType(it,Ar);switch(ce.length){case 0:break;case 1:le(Y,ce[0],Lt);break;case 2:Ze(Y,ce[0],ce[1],Lt);break;case 3:sr(Y,ce[0],ce[1],ce[2],Lt,0);break;default:rn(Y,ce,0,Lt,0)}return Lt}function ji(Y){for(var ce=[],it=Y;it.length;it=it[0])ce.push(it.length);return ce}var Za={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Oo=5120,gs=5122,Ls=5124,df=5121,gp=5123,Dc=5125,dd=5126,Rl=5126,ys={int8:Oo,int16:gs,int32:Ls,uint8:df,uint16:gp,uint32:Dc,float:dd,float32:Rl},Ml=35048,sc=35040,Gu={dynamic:Ml,stream:sc,static:35044},sl=ft.flatten,Pl=ft.shape,Yf=35044,Rt=35040,Et=5121,qr=5126,Zr=[];Zr[5120]=1,Zr[5122]=2,Zr[5124]=4,Zr[5121]=1,Zr[5123]=2,Zr[5125]=4,Zr[5126]=4;function ut(Y){return Za[Object.prototype.toString.call(Y)]|0}function Fh(Y,ce){for(var it=0;it<ce.length;++it)Y[it]=ce[it]}function Kf(Y,ce,it,tr,Ar,yr,Lt){for(var Gr=0,Jr=0;Jr<it;++Jr)for(var nn=0;nn<tr;++nn)Y[Gr++]=ce[Ar*Jr+yr*nn+Lt]}function Bh(Y,ce,it,tr){var Ar=0,yr={};function Lt(jt){this.id=Ar++,this.buffer=Y.createBuffer(),this.type=jt,this.usage=Yf,this.byteLength=0,this.dimension=1,this.dtype=Et,this.persistentData=null,it.profile&&(this.stats={size:0})}Lt.prototype.bind=function(){Y.bindBuffer(this.type,this.buffer)},Lt.prototype.destroy=function(){yn(this)};var Gr=[];function Jr(jt,$t){var en=Gr.pop();return en||(en=new Lt(jt)),en.bind(),an(en,$t,Rt,0,1,!1),en}function nn(jt){Gr.push(jt)}function tn(jt,$t,en){jt.byteLength=$t.byteLength,Y.bufferData(jt.type,$t,en)}function an(jt,$t,en,Tn,Er,Jn){var Ur;if(jt.usage=en,Array.isArray($t)){if(jt.dtype=Tn||qr,$t.length>0){var cn;if(Array.isArray($t[0])){Ur=Pl($t);for(var Lr=1,hn=1;hn<Ur.length;++hn)Lr*=Ur[hn];jt.dimension=Lr,cn=sl($t,Ur,jt.dtype),tn(jt,cn,en),Jn?jt.persistentData=cn:Rr.freeType(cn)}else if(typeof $t[0]=="number"){jt.dimension=Er;var Qn=Rr.allocType(jt.dtype,$t.length);Fh(Qn,$t),tn(jt,Qn,en),Jn?jt.persistentData=Qn:Rr.freeType(Qn)}else j($t[0])?(jt.dimension=$t[0].length,jt.dtype=Tn||ut($t[0])||qr,cn=sl($t,[$t.length,$t[0].length],jt.dtype),tn(jt,cn,en),Jn?jt.persistentData=cn:Rr.freeType(cn)):D.raise("invalid buffer data")}}else if(j($t))jt.dtype=Tn||ut($t),jt.dimension=Er,tn(jt,$t,en),Jn&&(jt.persistentData=new Uint8Array(new Uint8Array($t.buffer)));else if(Fo($t)){Ur=$t.shape;var Ai=$t.stride,mn=$t.offset,Kr=0,Pr=0,ii=0,Xi=0;Ur.length===1?(Kr=Ur[0],Pr=1,ii=Ai[0],Xi=0):Ur.length===2?(Kr=Ur[0],Pr=Ur[1],ii=Ai[0],Xi=Ai[1]):D.raise("invalid shape"),jt.dtype=Tn||ut($t.data)||qr,jt.dimension=Pr;var Cn=Rr.allocType(jt.dtype,Kr*Pr);Kf(Cn,$t.data,Kr,Pr,ii,Xi,mn),tn(jt,Cn,en),Jn?jt.persistentData=Cn:Rr.freeType(Cn)}else $t instanceof ArrayBuffer?(jt.dtype=Et,jt.dimension=Er,tn(jt,$t,en),Jn&&(jt.persistentData=new Uint8Array(new Uint8Array($t)))):D.raise("invalid buffer data")}function yn(jt){ce.bufferCount--,tr(jt);var $t=jt.buffer;D($t,"buffer must not be deleted already"),Y.deleteBuffer($t),jt.buffer=null,delete yr[jt.id]}function Yr(jt,$t,en,Tn){ce.bufferCount++;var Er=new Lt($t);yr[Er.id]=Er;function Jn(Lr){var hn=Yf,Qn=null,Ai=0,mn=0,Kr=1;return Array.isArray(Lr)||j(Lr)||Fo(Lr)||Lr instanceof ArrayBuffer?Qn=Lr:typeof Lr=="number"?Ai=Lr|0:Lr&&(D.type(Lr,"object","buffer arguments must be an object, a number or an array"),"data"in Lr&&(D(Qn===null||Array.isArray(Qn)||j(Qn)||Fo(Qn),"invalid data for buffer"),Qn=Lr.data),"usage"in Lr&&(D.parameter(Lr.usage,Gu,"invalid buffer usage"),hn=Gu[Lr.usage]),"type"in Lr&&(D.parameter(Lr.type,ys,"invalid buffer type"),mn=ys[Lr.type]),"dimension"in Lr&&(D.type(Lr.dimension,"number","invalid dimension"),Kr=Lr.dimension|0),"length"in Lr&&(D.nni(Ai,"buffer length must be a nonnegative integer"),Ai=Lr.length|0)),Er.bind(),Qn?an(Er,Qn,hn,mn,Kr,Tn):(Ai&&Y.bufferData(Er.type,Ai,hn),Er.dtype=mn||Et,Er.usage=hn,Er.dimension=Kr,Er.byteLength=Ai),it.profile&&(Er.stats.size=Er.byteLength*Zr[Er.dtype]),Jn}function Ur(Lr,hn){D(hn+Lr.byteLength<=Er.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Lr.byteLength+" starting from offset "+hn+" to a buffer of size "+Er.byteLength),Y.bufferSubData(Er.type,hn,Lr)}function cn(Lr,hn){var Qn=(hn||0)|0,Ai;if(Er.bind(),j(Lr)||Lr instanceof ArrayBuffer)Ur(Lr,Qn);else if(Array.isArray(Lr)){if(Lr.length>0)if(typeof Lr[0]=="number"){var mn=Rr.allocType(Er.dtype,Lr.length);Fh(mn,Lr),Ur(mn,Qn),Rr.freeType(mn)}else if(Array.isArray(Lr[0])||j(Lr[0])){Ai=Pl(Lr);var Kr=sl(Lr,Ai,Er.dtype);Ur(Kr,Qn),Rr.freeType(Kr)}else D.raise("invalid buffer data")}else if(Fo(Lr)){Ai=Lr.shape;var Pr=Lr.stride,ii=0,Xi=0,Cn=0,Ui=0;Ai.length===1?(ii=Ai[0],Xi=1,Cn=Pr[0],Ui=0):Ai.length===2?(ii=Ai[0],Xi=Ai[1],Cn=Pr[0],Ui=Pr[1]):D.raise("invalid shape");var Ei=Array.isArray(Lr.data)?Er.dtype:ut(Lr.data),pi=Rr.allocType(Ei,ii*Xi);Kf(pi,Lr.data,ii,Xi,Cn,Ui,Lr.offset),Ur(pi,Qn),Rr.freeType(pi)}else D.raise("invalid data for buffer subdata");return Jn}return en||Jn(jt),Jn._reglType="buffer",Jn._buffer=Er,Jn.subdata=cn,it.profile&&(Jn.stats=Er.stats),Jn.destroy=function(){yn(Er)},Jn}function xr(){_a(yr).forEach(function(jt){jt.buffer=Y.createBuffer(),Y.bindBuffer(jt.type,jt.buffer),Y.bufferData(jt.type,jt.persistentData||jt.byteLength,jt.usage)})}return it.profile&&(ce.getTotalBufferSize=function(){var jt=0;return Object.keys(yr).forEach(function($t){jt+=yr[$t].stats.size}),jt}),{create:Yr,createStream:Jr,destroyStream:nn,clear:function(){_a(yr).forEach(yn),Gr.forEach(yn)},getBuffer:function($t){return $t&&$t._buffer instanceof Lt?$t._buffer:null},restore:xr,_initBuffer:an}}var Fc=0,vf=0,mf=1,yp=1,vd=4,uc=4,Xu={points:Fc,point:vf,lines:mf,line:yp,triangles:vd,triangle:uc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Lh=0,is=1,Zu=4,Il=5120,Ns=5121,lc=5122,mu=5123,kl=5124,Zs=5125,$u=34963,ul=35040,qf=35044;function _p(Y,ce,it,tr){var Ar={},yr=0,Lt={uint8:Ns,uint16:mu};ce.oes_element_index_uint&&(Lt.uint32=Zs);function Gr(xr){this.id=yr++,Ar[this.id]=this,this.buffer=xr,this.primType=Zu,this.vertCount=0,this.type=0}Gr.prototype.bind=function(){this.buffer.bind()};var Jr=[];function nn(xr){var jt=Jr.pop();return jt||(jt=new Gr(it.create(null,$u,!0,!1)._buffer)),an(jt,xr,ul,-1,-1,0,0),jt}function tn(xr){Jr.push(xr)}function an(xr,jt,$t,en,Tn,Er,Jn){xr.buffer.bind();var Ur;if(jt){var cn=Jn;!Jn&&(!j(jt)||Fo(jt)&&!j(jt.data))&&(cn=ce.oes_element_index_uint?Zs:mu),it._initBuffer(xr.buffer,jt,$t,cn,3)}else Y.bufferData($u,Er,$t),xr.buffer.dtype=Ur||Ns,xr.buffer.usage=$t,xr.buffer.dimension=3,xr.buffer.byteLength=Er;if(Ur=Jn,!Jn){switch(xr.buffer.dtype){case Ns:case Il:Ur=Ns;break;case mu:case lc:Ur=mu;break;case Zs:case kl:Ur=Zs;break;default:D.raise("unsupported type for element array")}xr.buffer.dtype=Ur}xr.type=Ur,D(Ur!==Zs||!!ce.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Lr=Tn;Lr<0&&(Lr=xr.buffer.byteLength,Ur===mu?Lr>>=1:Ur===Zs&&(Lr>>=2)),xr.vertCount=Lr;var hn=en;if(en<0){hn=Zu;var Qn=xr.buffer.dimension;Qn===1&&(hn=Lh),Qn===2&&(hn=is),Qn===3&&(hn=Zu)}xr.primType=hn}function yn(xr){tr.elementsCount--,D(xr.buffer!==null,"must not double destroy elements"),delete Ar[xr.id],xr.buffer.destroy(),xr.buffer=null}function Yr(xr,jt){var $t=it.create(null,$u,!0),en=new Gr($t._buffer);tr.elementsCount++;function Tn(Er){if(!Er)$t(),en.primType=Zu,en.vertCount=0,en.type=Ns;else if(typeof Er=="number")$t(Er),en.primType=Zu,en.vertCount=Er|0,en.type=Ns;else{var Jn=null,Ur=qf,cn=-1,Lr=-1,hn=0,Qn=0;Array.isArray(Er)||j(Er)||Fo(Er)?Jn=Er:(D.type(Er,"object","invalid arguments for elements"),"data"in Er&&(Jn=Er.data,D(Array.isArray(Jn)||j(Jn)||Fo(Jn),"invalid data for element buffer")),"usage"in Er&&(D.parameter(Er.usage,Gu,"invalid element buffer usage"),Ur=Gu[Er.usage]),"primitive"in Er&&(D.parameter(Er.primitive,Xu,"invalid element buffer primitive"),cn=Xu[Er.primitive]),"count"in Er&&(D(typeof Er.count=="number"&&Er.count>=0,"invalid vertex count for elements"),Lr=Er.count|0),"type"in Er&&(D.parameter(Er.type,Lt,"invalid buffer type"),Qn=Lt[Er.type]),"length"in Er?hn=Er.length|0:(hn=Lr,Qn===mu||Qn===lc?hn*=2:(Qn===Zs||Qn===kl)&&(hn*=4))),an(en,Jn,Ur,cn,Lr,hn,Qn)}return Tn}return Tn(xr),Tn._reglType="elements",Tn._elements=en,Tn.subdata=function(Er,Jn){return $t.subdata(Er,Jn),Tn},Tn.destroy=function(){yn(en)},Tn}return{create:Yr,createStream:nn,destroyStream:tn,getElements:function(jt){return typeof jt=="function"&&jt._elements instanceof Gr?jt._elements:null},clear:function(){_a(Ar).forEach(yn)}}}var ba=new Float32Array(1),Qf=new Uint32Array(ba.buffer),gf=5123;function yf(Y){for(var ce=Rr.allocType(gf,Y.length),it=0;it<Y.length;++it)if(isNaN(Y[it]))ce[it]=65535;else if(Y[it]===Infinity)ce[it]=31744;else if(Y[it]===-Infinity)ce[it]=64512;else{ba[0]=Y[it];var tr=Qf[0],Ar=tr>>>31<<15,yr=(tr<<1>>>24)-127,Lt=tr>>13&(1<<10)-1;if(yr<-24)ce[it]=Ar;else if(yr<-14){var Gr=-14-yr;ce[it]=Ar+(Lt+(1<<10)>>Gr)}else yr>15?ce[it]=Ar+31744:ce[it]=Ar+(yr+15<<10)+Lt}return ce}function oo(Y){return Array.isArray(Y)||j(Y)}var cc=function(ce){return!(ce&ce-1)&&!!ce},Bc=34467,as=3553,$s=34067,Ys=34069,_s=6408,Jf=6406,Lc=6407,Ou=6409,_f=6410,Dl=32854,ll=32855,Nh=36194,Nc=32819,ka=32820,eh=33635,bp=34042,Ks=6402,jc=34041,zc=35904,th=35906,gu=36193,Bo=33776,Fl=33777,fc=33778,cl=33779,Bl=35986,rh=35987,hc=34798,Ro=35840,bf=35841,xp=35842,oa=35843,qs=36196,os=5121,Ll=5123,xf=5125,Nl=5126,md=10242,nh=10243,Ef=10497,Uc=33071,jl=33648,pc=10240,cr=10241,Bn=9728,jh=9729,dc=9984,zh=9985,zl=9986,ja=9987,ih=33170,Yu=4352,Ul=4353,ra=4354,za=34046,cu=3317,Sf=37440,Vc=37441,Af=37443,Ep=37444,ah=33984,Tf=[dc,zl,zh,ja],Vl=[0,Ou,_f,Lc,_s],Lo={};Lo[Ou]=Lo[Jf]=Lo[Ks]=1,Lo[jc]=Lo[_f]=2,Lo[Lc]=Lo[zc]=3,Lo[_s]=Lo[th]=4;function to(Y){return"[object "+Y+"]"}var Hc=to("HTMLCanvasElement"),Uh=to("OffscreenCanvas"),bo=to("CanvasRenderingContext2D"),kn=to("ImageBitmap"),js=to("HTMLImageElement"),Cf=to("HTMLVideoElement"),Wc=Object.keys(Za).concat([Hc,Uh,bo,kn,js,Cf]),Cs=[];Cs[os]=1,Cs[Nl]=4,Cs[gu]=2,Cs[Ll]=2,Cs[xf]=4;var Oa=[];Oa[Dl]=2,Oa[ll]=2,Oa[Nh]=2,Oa[jc]=4,Oa[Bo]=.5,Oa[Fl]=.5,Oa[fc]=1,Oa[cl]=1,Oa[Bl]=.5,Oa[rh]=1,Oa[hc]=1,Oa[Ro]=.5,Oa[bf]=.25,Oa[xp]=.5,Oa[oa]=.25,Oa[qs]=.5;function oh(Y){return Array.isArray(Y)&&(Y.length===0||typeof Y[0]=="number")}function vn(Y){if(!Array.isArray(Y))return!1;var ce=Y.length;return!(ce===0||!oo(Y[0]))}function fl(Y){return Object.prototype.toString.call(Y)}function wf(Y){return fl(Y)===Hc}function sh(Y){return fl(Y)===Uh}function yu(Y){return fl(Y)===bo}function Qs(Y){return fl(Y)===kn}function uh(Y){return fl(Y)===js}function lh(Y){return fl(Y)===Cf}function ws(Y){if(!Y)return!1;var ce=fl(Y);return Wc.indexOf(ce)>=0?!0:oh(Y)||vn(Y)||Fo(Y)}function Ku(Y){return Za[Object.prototype.toString.call(Y)]|0}function Sp(Y,ce){var it=ce.length;switch(Y.type){case os:case Ll:case xf:case Nl:var tr=Rr.allocType(Y.type,it);tr.set(ce),Y.data=tr;break;case gu:Y.data=yf(ce);break;default:D.raise("unsupported texture type, must specify a typed array")}}function Gc(Y,ce){return Rr.allocType(Y.type===gu?Nl:Y.type,ce)}function xi(Y,ce){Y.type===gu?(Y.data=yf(ce),Rr.freeType(ce)):Y.data=ce}function Vh(Y,ce,it,tr,Ar,yr){for(var Lt=Y.width,Gr=Y.height,Jr=Y.channels,nn=Lt*Gr*Jr,tn=Gc(Y,nn),an=0,yn=0;yn<Gr;++yn)for(var Yr=0;Yr<Lt;++Yr)for(var xr=0;xr<Jr;++xr)tn[an++]=ce[it*Yr+tr*yn+Ar*xr+yr];xi(Y,tn)}function Js(Y,ce,it,tr,Ar,yr){var Lt;if(typeof Oa[Y]!="undefined"?Lt=Oa[Y]:Lt=Lo[Y]*Cs[ce],yr&&(Lt*=6),Ar){for(var Gr=0,Jr=it;Jr>=1;)Gr+=Lt*Jr*Jr,Jr/=2;return Gr}else return Lt*it*tr}function zs(Y,ce,it,tr,Ar,yr,Lt){var Gr={"don't care":Yu,"dont care":Yu,nice:ra,fast:Ul},Jr={repeat:Ef,clamp:Uc,mirror:jl},nn={nearest:Bn,linear:jh},tn=H({mipmap:ja,"nearest mipmap nearest":dc,"linear mipmap nearest":zh,"nearest mipmap linear":zl,"linear mipmap linear":ja},nn),an={none:0,browser:Ep},yn={uint8:os,rgba4:Nc,rgb565:eh,"rgb5 a1":ka},Yr={alpha:Jf,luminance:Ou,"luminance alpha":_f,rgb:Lc,rgba:_s,rgba4:Dl,"rgb5 a1":ll,rgb565:Nh},xr={};ce.ext_srgb&&(Yr.srgb=zc,Yr.srgba=th),ce.oes_texture_float&&(yn.float32=yn.float=Nl),ce.oes_texture_half_float&&(yn.float16=yn["half float"]=gu),ce.webgl_depth_texture&&(H(Yr,{depth:Ks,"depth stencil":jc}),H(yn,{uint16:Ll,uint32:xf,"depth stencil":bp})),ce.webgl_compressed_texture_s3tc&&H(xr,{"rgb s3tc dxt1":Bo,"rgba s3tc dxt1":Fl,"rgba s3tc dxt3":fc,"rgba s3tc dxt5":cl}),ce.webgl_compressed_texture_atc&&H(xr,{"rgb atc":Bl,"rgba atc explicit alpha":rh,"rgba atc interpolated alpha":hc}),ce.webgl_compressed_texture_pvrtc&&H(xr,{"rgb pvrtc 4bppv1":Ro,"rgb pvrtc 2bppv1":bf,"rgba pvrtc 4bppv1":xp,"rgba pvrtc 2bppv1":oa}),ce.webgl_compressed_texture_etc1&&(xr["rgb etc1"]=qs);var jt=Array.prototype.slice.call(Y.getParameter(Bc));Object.keys(xr).forEach(function(Ge){var lr=xr[Ge];jt.indexOf(lr)>=0&&(Yr[Ge]=lr)});var $t=Object.keys(Yr);it.textureFormats=$t;var en=[];Object.keys(Yr).forEach(function(Ge){var lr=Yr[Ge];en[lr]=Ge});var Tn=[];Object.keys(yn).forEach(function(Ge){var lr=yn[Ge];Tn[lr]=Ge});var Er=[];Object.keys(nn).forEach(function(Ge){var lr=nn[Ge];Er[lr]=Ge});var Jn=[];Object.keys(tn).forEach(function(Ge){var lr=tn[Ge];Jn[lr]=Ge});var Ur=[];Object.keys(Jr).forEach(function(Ge){var lr=Jr[Ge];Ur[lr]=Ge});var cn=$t.reduce(function(Ge,lr){var Yt=Yr[lr];return Yt===Ou||Yt===Jf||Yt===Ou||Yt===_f||Yt===Ks||Yt===jc||ce.ext_srgb&&(Yt===zc||Yt===th)?Ge[Yt]=Yt:Yt===ll||lr.indexOf("rgba")>=0?Ge[Yt]=_s:Ge[Yt]=Lc,Ge},{});function Lr(){this.internalformat=_s,this.format=_s,this.type=os,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ep,this.width=0,this.height=0,this.channels=0}function hn(Ge,lr){Ge.internalformat=lr.internalformat,Ge.format=lr.format,Ge.type=lr.type,Ge.compressed=lr.compressed,Ge.premultiplyAlpha=lr.premultiplyAlpha,Ge.flipY=lr.flipY,Ge.unpackAlignment=lr.unpackAlignment,Ge.colorSpace=lr.colorSpace,Ge.width=lr.width,Ge.height=lr.height,Ge.channels=lr.channels}function Qn(Ge,lr){if(!(typeof lr!="object"||!lr)){if("premultiplyAlpha"in lr&&(D.type(lr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ge.premultiplyAlpha=lr.premultiplyAlpha),"flipY"in lr&&(D.type(lr.flipY,"boolean","invalid texture flip"),Ge.flipY=lr.flipY),"alignment"in lr&&(D.oneOf(lr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ge.unpackAlignment=lr.alignment),"colorSpace"in lr&&(D.parameter(lr.colorSpace,an,"invalid colorSpace"),Ge.colorSpace=an[lr.colorSpace]),"type"in lr){var Yt=lr.type;D(ce.oes_texture_float||!(Yt==="float"||Yt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),D(ce.oes_texture_half_float||!(Yt==="half float"||Yt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),D(ce.webgl_depth_texture||!(Yt==="uint16"||Yt==="uint32"||Yt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(Yt,yn,"invalid texture type"),Ge.type=yn[Yt]}var En=Ge.width,Fi=Ge.height,Ca=Ge.channels,de=!1;"shape"in lr?(D(Array.isArray(lr.shape)&&lr.shape.length>=2,"shape must be an array"),En=lr.shape[0],Fi=lr.shape[1],lr.shape.length===3&&(Ca=lr.shape[2],D(Ca>0&&Ca<=4,"invalid number of channels"),de=!0),D(En>=0&&En<=it.maxTextureSize,"invalid width"),D(Fi>=0&&Fi<=it.maxTextureSize,"invalid height")):("radius"in lr&&(En=Fi=lr.radius,D(En>=0&&En<=it.maxTextureSize,"invalid radius")),"width"in lr&&(En=lr.width,D(En>=0&&En<=it.maxTextureSize,"invalid width")),"height"in lr&&(Fi=lr.height,D(Fi>=0&&Fi<=it.maxTextureSize,"invalid height")),"channels"in lr&&(Ca=lr.channels,D(Ca>0&&Ca<=4,"invalid number of channels"),de=!0)),Ge.width=En|0,Ge.height=Fi|0,Ge.channels=Ca|0;var Ie=!1;if("format"in lr){var rt=lr.format;D(ce.webgl_depth_texture||!(rt==="depth"||rt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),D.parameter(rt,Yr,"invalid texture format");var nr=Ge.internalformat=Yr[rt];Ge.format=cn[nr],rt in yn&&("type"in lr||(Ge.type=yn[rt])),rt in xr&&(Ge.compressed=!0),Ie=!0}!de&&Ie?Ge.channels=Lo[Ge.format]:de&&!Ie?Ge.channels!==Vl[Ge.format]&&(Ge.format=Ge.internalformat=Vl[Ge.channels]):Ie&&de&&D(Ge.channels===Lo[Ge.format],"number of channels inconsistent with specified format")}}function Ai(Ge){Y.pixelStorei(Sf,Ge.flipY),Y.pixelStorei(Vc,Ge.premultiplyAlpha),Y.pixelStorei(Af,Ge.colorSpace),Y.pixelStorei(cu,Ge.unpackAlignment)}function mn(){Lr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Kr(Ge,lr){var Yt=null;if(ws(lr)?Yt=lr:lr&&(D.type(lr,"object","invalid pixel data type"),Qn(Ge,lr),"x"in lr&&(Ge.xOffset=lr.x|0),"y"in lr&&(Ge.yOffset=lr.y|0),ws(lr.data)&&(Yt=lr.data)),D(!Ge.compressed||Yt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),lr.copy){D(!Yt,"can not specify copy and data field for the same texture");var En=Ar.viewportWidth,Fi=Ar.viewportHeight;Ge.width=Ge.width||En-Ge.xOffset,Ge.height=Ge.height||Fi-Ge.yOffset,Ge.needsCopy=!0,D(Ge.xOffset>=0&&Ge.xOffset<En&&Ge.yOffset>=0&&Ge.yOffset<Fi&&Ge.width>0&&Ge.width<=En&&Ge.height>0&&Ge.height<=Fi,"copy texture read out of bounds")}else if(!Yt)Ge.width=Ge.width||1,Ge.height=Ge.height||1,Ge.channels=Ge.channels||4;else if(j(Yt))Ge.channels=Ge.channels||4,Ge.data=Yt,!("type"in lr)&&Ge.type===os&&(Ge.type=Ku(Yt));else if(oh(Yt))Ge.channels=Ge.channels||4,Sp(Ge,Yt),Ge.alignment=1,Ge.needsFree=!0;else if(Fo(Yt)){var Ca=Yt.data;!Array.isArray(Ca)&&Ge.type===os&&(Ge.type=Ku(Ca));var de=Yt.shape,Ie=Yt.stride,rt,nr,qt,dt,bt,Tt;de.length===3?(qt=de[2],Tt=Ie[2]):(D(de.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qt=1,Tt=1),rt=de[0],nr=de[1],dt=Ie[0],bt=Ie[1],Ge.alignment=1,Ge.width=rt,Ge.height=nr,Ge.channels=qt,Ge.format=Ge.internalformat=Vl[qt],Ge.needsFree=!0,Vh(Ge,Ca,dt,bt,Tt,Yt.offset)}else if(wf(Yt)||sh(Yt)||yu(Yt))wf(Yt)||sh(Yt)?Ge.element=Yt:Ge.element=Yt.canvas,Ge.width=Ge.element.width,Ge.height=Ge.element.height,Ge.channels=4;else if(Qs(Yt))Ge.element=Yt,Ge.width=Yt.width,Ge.height=Yt.height,Ge.channels=4;else if(uh(Yt))Ge.element=Yt,Ge.width=Yt.naturalWidth,Ge.height=Yt.naturalHeight,Ge.channels=4;else if(lh(Yt))Ge.element=Yt,Ge.width=Yt.videoWidth,Ge.height=Yt.videoHeight,Ge.channels=4;else if(vn(Yt)){var Ve=Ge.width||Yt[0].length,yt=Ge.height||Yt.length,Me=Ge.channels;oo(Yt[0][0])?Me=Me||Yt[0][0].length:Me=Me||1;for(var _t=ft.shape(Yt),hr=1,mr=0;mr<_t.length;++mr)hr*=_t[mr];var zr=Gc(Ge,hr);ft.flatten(Yt,_t,"",zr),xi(Ge,zr),Ge.alignment=1,Ge.width=Ve,Ge.height=yt,Ge.channels=Me,Ge.format=Ge.internalformat=Vl[Me],Ge.needsFree=!0}Ge.type===Nl?D(it.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ge.type===gu&&D(it.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Pr(Ge,lr,Yt){var En=Ge.element,Fi=Ge.data,Ca=Ge.internalformat,de=Ge.format,Ie=Ge.type,rt=Ge.width,nr=Ge.height;Ai(Ge),En?Y.texImage2D(lr,Yt,de,de,Ie,En):Ge.compressed?Y.compressedTexImage2D(lr,Yt,Ca,rt,nr,0,Fi):Ge.needsCopy?(tr(),Y.copyTexImage2D(lr,Yt,de,Ge.xOffset,Ge.yOffset,rt,nr,0)):Y.texImage2D(lr,Yt,de,rt,nr,0,de,Ie,Fi||null)}function ii(Ge,lr,Yt,En,Fi){var Ca=Ge.element,de=Ge.data,Ie=Ge.internalformat,rt=Ge.format,nr=Ge.type,qt=Ge.width,dt=Ge.height;Ai(Ge),Ca?Y.texSubImage2D(lr,Fi,Yt,En,rt,nr,Ca):Ge.compressed?Y.compressedTexSubImage2D(lr,Fi,Yt,En,Ie,qt,dt,de):Ge.needsCopy?(tr(),Y.copyTexSubImage2D(lr,Fi,Yt,En,Ge.xOffset,Ge.yOffset,qt,dt)):Y.texSubImage2D(lr,Fi,Yt,En,qt,dt,rt,nr,de)}var Xi=[];function Cn(){return Xi.pop()||new mn}function Ui(Ge){Ge.needsFree&&Rr.freeType(Ge.data),mn.call(Ge),Xi.push(Ge)}function Ei(){Lr.call(this),this.genMipmaps=!1,this.mipmapHint=Yu,this.mipmask=0,this.images=Array(16)}function pi(Ge,lr,Yt){var En=Ge.images[0]=Cn();Ge.mipmask=1,En.width=Ge.width=lr,En.height=Ge.height=Yt,En.channels=Ge.channels=4}function ca(Ge,lr){var Yt=null;if(ws(lr))Yt=Ge.images[0]=Cn(),hn(Yt,Ge),Kr(Yt,lr),Ge.mipmask=1;else if(Qn(Ge,lr),Array.isArray(lr.mipmap))for(var En=lr.mipmap,Fi=0;Fi<En.length;++Fi)Yt=Ge.images[Fi]=Cn(),hn(Yt,Ge),Yt.width>>=Fi,Yt.height>>=Fi,Kr(Yt,En[Fi]),Ge.mipmask|=1<<Fi;else Yt=Ge.images[0]=Cn(),hn(Yt,Ge),Kr(Yt,lr),Ge.mipmask=1;hn(Ge,Ge.images[0]),Ge.compressed&&(Ge.internalformat===Bo||Ge.internalformat===Fl||Ge.internalformat===fc||Ge.internalformat===cl)&&D(Ge.width%4==0&&Ge.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Po(Ge,lr){for(var Yt=Ge.images,En=0;En<Yt.length;++En){if(!Yt[En])return;Pr(Yt[En],lr,En)}}var fs=[];function Yi(){var Ge=fs.pop()||new Ei;Lr.call(Ge),Ge.mipmask=0;for(var lr=0;lr<16;++lr)Ge.images[lr]=null;return Ge}function To(Ge){for(var lr=Ge.images,Yt=0;Yt<lr.length;++Yt)lr[Yt]&&Ui(lr[Yt]),lr[Yt]=null;fs.push(Ge)}function Ha(){this.minFilter=Bn,this.magFilter=Bn,this.wrapS=Uc,this.wrapT=Uc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Yu}function Uo(Ge,lr){if("min"in lr){var Yt=lr.min;D.parameter(Yt,tn),Ge.minFilter=tn[Yt],Tf.indexOf(Ge.minFilter)>=0&&!("faces"in lr)&&(Ge.genMipmaps=!0)}if("mag"in lr){var En=lr.mag;D.parameter(En,nn),Ge.magFilter=nn[En]}var Fi=Ge.wrapS,Ca=Ge.wrapT;if("wrap"in lr){var de=lr.wrap;typeof de=="string"?(D.parameter(de,Jr),Fi=Ca=Jr[de]):Array.isArray(de)&&(D.parameter(de[0],Jr),D.parameter(de[1],Jr),Fi=Jr[de[0]],Ca=Jr[de[1]])}else{if("wrapS"in lr){var Ie=lr.wrapS;D.parameter(Ie,Jr),Fi=Jr[Ie]}if("wrapT"in lr){var rt=lr.wrapT;D.parameter(rt,Jr),Ca=Jr[rt]}}if(Ge.wrapS=Fi,Ge.wrapT=Ca,"anisotropic"in lr){var nr=lr.anisotropic;D(typeof nr=="number"&&nr>=1&&nr<=it.maxAnisotropic,"aniso samples must be between 1 and "),Ge.anisotropic=lr.anisotropic}if("mipmap"in lr){var qt=!1;switch(typeof lr.mipmap){case"string":D.parameter(lr.mipmap,Gr,"invalid mipmap hint"),Ge.mipmapHint=Gr[lr.mipmap],Ge.genMipmaps=!0,qt=!0;break;case"boolean":qt=Ge.genMipmaps=lr.mipmap;break;case"object":D(Array.isArray(lr.mipmap),"invalid mipmap type"),Ge.genMipmaps=!1,qt=!0;break;default:D.raise("invalid mipmap type")}qt&&!("min"in lr)&&(Ge.minFilter=dc)}}function Vo(Ge,lr){Y.texParameteri(lr,cr,Ge.minFilter),Y.texParameteri(lr,pc,Ge.magFilter),Y.texParameteri(lr,md,Ge.wrapS),Y.texParameteri(lr,nh,Ge.wrapT),ce.ext_texture_filter_anisotropic&&Y.texParameteri(lr,za,Ge.anisotropic),Ge.genMipmaps&&(Y.hint(ih,Ge.mipmapHint),Y.generateMipmap(lr))}var fo=0,qo={},Os=it.maxTextureUnits,Ho=Array(Os).map(function(){return null});function Gi(Ge){Lr.call(this),this.mipmask=0,this.internalformat=_s,this.id=fo++,this.refCount=1,this.target=Ge,this.texture=Y.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ha,Lt.profile&&(this.stats={size:0})}function Ss(Ge){Y.activeTexture(ah),Y.bindTexture(Ge.target,Ge.texture)}function da(){var Ge=Ho[0];Ge?Y.bindTexture(Ge.target,Ge.texture):Y.bindTexture(as,null)}function di(Ge){var lr=Ge.texture;D(lr,"must not double destroy texture");var Yt=Ge.unit,En=Ge.target;Yt>=0&&(Y.activeTexture(ah+Yt),Y.bindTexture(En,null),Ho[Yt]=null),Y.deleteTexture(lr),Ge.texture=null,Ge.params=null,Ge.pixels=null,Ge.refCount=0,delete qo[Ge.id],yr.textureCount--}H(Gi.prototype,{bind:function(){var lr=this;lr.bindCount+=1;var Yt=lr.unit;if(Yt<0){for(var En=0;En<Os;++En){var Fi=Ho[En];if(Fi){if(Fi.bindCount>0)continue;Fi.unit=-1}Ho[En]=lr,Yt=En;break}Yt>=Os&&D.raise("insufficient number of texture units"),Lt.profile&&yr.maxTextureUnits<Yt+1&&(yr.maxTextureUnits=Yt+1),lr.unit=Yt,Y.activeTexture(ah+Yt),Y.bindTexture(lr.target,lr.texture)}return Yt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&di(this)}});function Di(Ge,lr){var Yt=new Gi(as);qo[Yt.id]=Yt,yr.textureCount++;function En(de,Ie){var rt=Yt.texInfo;Ha.call(rt);var nr=Yi();return typeof de=="number"?typeof Ie=="number"?pi(nr,de|0,Ie|0):pi(nr,de|0,de|0):de?(D.type(de,"object","invalid arguments to regl.texture"),Uo(rt,de),ca(nr,de)):pi(nr,1,1),rt.genMipmaps&&(nr.mipmask=(nr.width<<1)-1),Yt.mipmask=nr.mipmask,hn(Yt,nr),D.texture2D(rt,nr,it),Yt.internalformat=nr.internalformat,En.width=nr.width,En.height=nr.height,Ss(Yt),Po(nr,as),Vo(rt,as),da(),To(nr),Lt.profile&&(Yt.stats.size=Js(Yt.internalformat,Yt.type,nr.width,nr.height,rt.genMipmaps,!1)),En.format=en[Yt.internalformat],En.type=Tn[Yt.type],En.mag=Er[rt.magFilter],En.min=Jn[rt.minFilter],En.wrapS=Ur[rt.wrapS],En.wrapT=Ur[rt.wrapT],En}function Fi(de,Ie,rt,nr){D(!!de,"must specify image data");var qt=Ie|0,dt=rt|0,bt=nr|0,Tt=Cn();return hn(Tt,Yt),Tt.width=0,Tt.height=0,Kr(Tt,de),Tt.width=Tt.width||(Yt.width>>bt)-qt,Tt.height=Tt.height||(Yt.height>>bt)-dt,D(Yt.type===Tt.type&&Yt.format===Tt.format&&Yt.internalformat===Tt.internalformat,"incompatible format for texture.subimage"),D(qt>=0&&dt>=0&&qt+Tt.width<=Yt.width&&dt+Tt.height<=Yt.height,"texture.subimage write out of bounds"),D(Yt.mipmask&1<<bt,"missing mipmap data"),D(Tt.data||Tt.element||Tt.needsCopy,"missing image data"),Ss(Yt),ii(Tt,as,qt,dt,bt),da(),Ui(Tt),En}function Ca(de,Ie){var rt=de|0,nr=Ie|0||rt;if(rt===Yt.width&&nr===Yt.height)return En;En.width=Yt.width=rt,En.height=Yt.height=nr,Ss(Yt);for(var qt=0;Yt.mipmask>>qt;++qt){var dt=rt>>qt,bt=nr>>qt;if(!dt||!bt)break;Y.texImage2D(as,qt,Yt.format,dt,bt,0,Yt.format,Yt.type,null)}return da(),Lt.profile&&(Yt.stats.size=Js(Yt.internalformat,Yt.type,rt,nr,!1,!1)),En}return En(Ge,lr),En.subimage=Fi,En.resize=Ca,En._reglType="texture2d",En._texture=Yt,Lt.profile&&(En.stats=Yt.stats),En.destroy=function(){Yt.decRef()},En}function ua(Ge,lr,Yt,En,Fi,Ca){var de=new Gi($s);qo[de.id]=de,yr.cubeCount++;var Ie=new Array(6);function rt(dt,bt,Tt,Ve,yt,Me){var _t,hr=de.texInfo;for(Ha.call(hr),_t=0;_t<6;++_t)Ie[_t]=Yi();if(typeof dt=="number"||!dt){var mr=dt|0||1;for(_t=0;_t<6;++_t)pi(Ie[_t],mr,mr)}else if(typeof dt=="object")if(bt)ca(Ie[0],dt),ca(Ie[1],bt),ca(Ie[2],Tt),ca(Ie[3],Ve),ca(Ie[4],yt),ca(Ie[5],Me);else if(Uo(hr,dt),Qn(de,dt),"faces"in dt){var zr=dt.faces;for(D(Array.isArray(zr)&&zr.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)D(typeof zr[_t]=="object"&&!!zr[_t],"invalid input for cube map face"),hn(Ie[_t],de),ca(Ie[_t],zr[_t])}else for(_t=0;_t<6;++_t)ca(Ie[_t],dt);else D.raise("invalid arguments to cube map");for(hn(de,Ie[0]),it.npotTextureCube||D(cc(de.width)&&cc(de.height),"your browser does not support non power or two texture dimensions"),hr.genMipmaps?de.mipmask=(Ie[0].width<<1)-1:de.mipmask=Ie[0].mipmask,D.textureCube(de,hr,Ie,it),de.internalformat=Ie[0].internalformat,rt.width=Ie[0].width,rt.height=Ie[0].height,Ss(de),_t=0;_t<6;++_t)Po(Ie[_t],Ys+_t);for(Vo(hr,$s),da(),Lt.profile&&(de.stats.size=Js(de.internalformat,de.type,rt.width,rt.height,hr.genMipmaps,!0)),rt.format=en[de.internalformat],rt.type=Tn[de.type],rt.mag=Er[hr.magFilter],rt.min=Jn[hr.minFilter],rt.wrapS=Ur[hr.wrapS],rt.wrapT=Ur[hr.wrapT],_t=0;_t<6;++_t)To(Ie[_t]);return rt}function nr(dt,bt,Tt,Ve,yt){D(!!bt,"must specify image data"),D(typeof dt=="number"&&dt===(dt|0)&&dt>=0&&dt<6,"invalid face");var Me=Tt|0,_t=Ve|0,hr=yt|0,mr=Cn();return hn(mr,de),mr.width=0,mr.height=0,Kr(mr,bt),mr.width=mr.width||(de.width>>hr)-Me,mr.height=mr.height||(de.height>>hr)-_t,D(de.type===mr.type&&de.format===mr.format&&de.internalformat===mr.internalformat,"incompatible format for texture.subimage"),D(Me>=0&&_t>=0&&Me+mr.width<=de.width&&_t+mr.height<=de.height,"texture.subimage write out of bounds"),D(de.mipmask&1<<hr,"missing mipmap data"),D(mr.data||mr.element||mr.needsCopy,"missing image data"),Ss(de),ii(mr,Ys+dt,Me,_t,hr),da(),Ui(mr),rt}function qt(dt){var bt=dt|0;if(bt!==de.width){rt.width=de.width=bt,rt.height=de.height=bt,Ss(de);for(var Tt=0;Tt<6;++Tt)for(var Ve=0;de.mipmask>>Ve;++Ve)Y.texImage2D(Ys+Tt,Ve,de.format,bt>>Ve,bt>>Ve,0,de.format,de.type,null);return da(),Lt.profile&&(de.stats.size=Js(de.internalformat,de.type,rt.width,rt.height,!1,!0)),rt}}return rt(Ge,lr,Yt,En,Fi,Ca),rt.subimage=nr,rt.resize=qt,rt._reglType="textureCube",rt._texture=de,Lt.profile&&(rt.stats=de.stats),rt.destroy=function(){de.decRef()},rt}function hs(){for(var Ge=0;Ge<Os;++Ge)Y.activeTexture(ah+Ge),Y.bindTexture(as,null),Ho[Ge]=null;_a(qo).forEach(di),yr.cubeCount=0,yr.textureCount=0}Lt.profile&&(yr.getTotalTextureSize=function(){var Ge=0;return Object.keys(qo).forEach(function(lr){Ge+=qo[lr].stats.size}),Ge});function iu(){for(var Ge=0;Ge<Os;++Ge){var lr=Ho[Ge];lr&&(lr.bindCount=0,lr.unit=-1,Ho[Ge]=null)}_a(qo).forEach(function(Yt){Yt.texture=Y.createTexture(),Y.bindTexture(Yt.target,Yt.texture);for(var En=0;En<32;++En)if((Yt.mipmask&1<<En)!=0)if(Yt.target===as)Y.texImage2D(as,En,Yt.internalformat,Yt.width>>En,Yt.height>>En,0,Yt.internalformat,Yt.type,null);else for(var Fi=0;Fi<6;++Fi)Y.texImage2D(Ys+Fi,En,Yt.internalformat,Yt.width>>En,Yt.height>>En,0,Yt.internalformat,Yt.type,null);Vo(Yt.texInfo,Yt.target)})}return{create2D:Di,createCube:ua,clear:hs,getTexture:function(lr){return null},restore:iu}}var Oi=36161,fu=32854,hu=32855,Yo=36194,Hl=33189,hl=36168,pu=34041,Ko=35907,pl=34836,ti=34842,jn=34843,eu=[];eu[fu]=2,eu[hu]=2,eu[Yo]=2,eu[Hl]=2,eu[hl]=1,eu[pu]=4,eu[Ko]=4,eu[pl]=16,eu[ti]=8,eu[jn]=6;function bs(Y,ce,it){return eu[Y]*ce*it}var Ru=function(ce,it,tr,Ar,yr){var Lt={rgba4:fu,rgb565:Yo,"rgb5 a1":hu,depth:Hl,stencil:hl,"depth stencil":pu};it.ext_srgb&&(Lt.srgba=Ko),it.ext_color_buffer_half_float&&(Lt.rgba16f=ti,Lt.rgb16f=jn),it.webgl_color_buffer_float&&(Lt.rgba32f=pl);var Gr=[];Object.keys(Lt).forEach(function(xr){var jt=Lt[xr];Gr[jt]=xr});var Jr=0,nn={};function tn(xr){this.id=Jr++,this.refCount=1,this.renderbuffer=xr,this.format=fu,this.width=0,this.height=0,yr.profile&&(this.stats={size:0})}tn.prototype.decRef=function(){--this.refCount<=0&&an(this)};function an(xr){var jt=xr.renderbuffer;D(jt,"must not double destroy renderbuffer"),ce.bindRenderbuffer(Oi,null),ce.deleteRenderbuffer(jt),xr.renderbuffer=null,xr.refCount=0,delete nn[xr.id],Ar.renderbufferCount--}function yn(xr,jt){var $t=new tn(ce.createRenderbuffer());nn[$t.id]=$t,Ar.renderbufferCount++;function en(Er,Jn){var Ur=0,cn=0,Lr=fu;if(typeof Er=="object"&&Er){var hn=Er;if("shape"in hn){var Qn=hn.shape;D(Array.isArray(Qn)&&Qn.length>=2,"invalid renderbuffer shape"),Ur=Qn[0]|0,cn=Qn[1]|0}else"radius"in hn&&(Ur=cn=hn.radius|0),"width"in hn&&(Ur=hn.width|0),"height"in hn&&(cn=hn.height|0);"format"in hn&&(D.parameter(hn.format,Lt,"invalid renderbuffer format"),Lr=Lt[hn.format])}else typeof Er=="number"?(Ur=Er|0,typeof Jn=="number"?cn=Jn|0:cn=Ur):Er?D.raise("invalid arguments to renderbuffer constructor"):Ur=cn=1;if(D(Ur>0&&cn>0&&Ur<=tr.maxRenderbufferSize&&cn<=tr.maxRenderbufferSize,"invalid renderbuffer size"),!(Ur===$t.width&&cn===$t.height&&Lr===$t.format))return en.width=$t.width=Ur,en.height=$t.height=cn,$t.format=Lr,ce.bindRenderbuffer(Oi,$t.renderbuffer),ce.renderbufferStorage(Oi,Lr,Ur,cn),D(ce.getError()===0,"invalid render buffer format"),yr.profile&&($t.stats.size=bs($t.format,$t.width,$t.height)),en.format=Gr[$t.format],en}function Tn(Er,Jn){var Ur=Er|0,cn=Jn|0||Ur;return Ur===$t.width&&cn===$t.height||(D(Ur>0&&cn>0&&Ur<=tr.maxRenderbufferSize&&cn<=tr.maxRenderbufferSize,"invalid renderbuffer size"),en.width=$t.width=Ur,en.height=$t.height=cn,ce.bindRenderbuffer(Oi,$t.renderbuffer),ce.renderbufferStorage(Oi,$t.format,Ur,cn),D(ce.getError()===0,"invalid render buffer format"),yr.profile&&($t.stats.size=bs($t.format,$t.width,$t.height))),en}return en(xr,jt),en.resize=Tn,en._reglType="renderbuffer",en._renderbuffer=$t,yr.profile&&(en.stats=$t.stats),en.destroy=function(){$t.decRef()},en}yr.profile&&(Ar.getTotalRenderbufferSize=function(){var xr=0;return Object.keys(nn).forEach(function(jt){xr+=nn[jt].stats.size}),xr});function Yr(){_a(nn).forEach(function(xr){xr.renderbuffer=ce.createRenderbuffer(),ce.bindRenderbuffer(Oi,xr.renderbuffer),ce.renderbufferStorage(Oi,xr.format,xr.width,xr.height)}),ce.bindRenderbuffer(Oi,null)}return{create:yn,clear:function(){_a(nn).forEach(an)},restore:Yr}},$a=36160,_u=36161,dl=3553,vl=34069,pa=36064,No=36096,Hh=36128,Wl=33306,ch=36053,ml=36054,tu=36055,Xc=36057,bu=36061,fh=36193,Zc=5121,hh=5126,vc=6407,$c=6408,Yc=6402,Wh=[vc,$c],L=[];L[$c]=4,L[vc]=3;var xu=[];xu[Zc]=1,xu[hh]=4,xu[fh]=2;var Gh=32854,qu=32855,Eu=36194,Of=33189,Gl=36168,ph=34041,dh=35907,m=34836,d=34842,p=34843,y=[Gh,qu,Eu,dh,d,p,m],A={};A[ch]="complete",A[ml]="incomplete attachment",A[Xc]="incomplete dimensions",A[tu]="incomplete, missing attachment",A[bu]="unsupported";function w(Y,ce,it,tr,Ar,yr){var Lt={cur:null,next:null,dirty:!1,setFBO:null},Gr=["rgba"],Jr=["rgba4","rgb565","rgb5 a1"];ce.ext_srgb&&Jr.push("srgba"),ce.ext_color_buffer_half_float&&Jr.push("rgba16f","rgb16f"),ce.webgl_color_buffer_float&&Jr.push("rgba32f");var nn=["uint8"];ce.oes_texture_half_float&&nn.push("half float","float16"),ce.oes_texture_float&&nn.push("float","float32");function tn(mn,Kr,Pr){this.target=mn,this.texture=Kr,this.renderbuffer=Pr;var ii=0,Xi=0;Kr?(ii=Kr.width,Xi=Kr.height):Pr&&(ii=Pr.width,Xi=Pr.height),this.width=ii,this.height=Xi}function an(mn){mn&&(mn.texture&&mn.texture._texture.decRef(),mn.renderbuffer&&mn.renderbuffer._renderbuffer.decRef())}function yn(mn,Kr,Pr){if(!!mn)if(mn.texture){var ii=mn.texture._texture,Xi=Math.max(1,ii.width),Cn=Math.max(1,ii.height);D(Xi===Kr&&Cn===Pr,"inconsistent width/height for supplied texture"),ii.refCount+=1}else{var Ui=mn.renderbuffer._renderbuffer;D(Ui.width===Kr&&Ui.height===Pr,"inconsistent width/height for renderbuffer"),Ui.refCount+=1}}function Yr(mn,Kr){Kr&&(Kr.texture?Y.framebufferTexture2D($a,mn,Kr.target,Kr.texture._texture.texture,0):Y.framebufferRenderbuffer($a,mn,_u,Kr.renderbuffer._renderbuffer.renderbuffer))}function xr(mn){var Kr=dl,Pr=null,ii=null,Xi=mn;typeof mn=="object"&&(Xi=mn.data,"target"in mn&&(Kr=mn.target|0)),D.type(Xi,"function","invalid attachment data");var Cn=Xi._reglType;return Cn==="texture2d"?(Pr=Xi,D(Kr===dl)):Cn==="textureCube"?(Pr=Xi,D(Kr>=vl&&Kr<vl+6,"invalid cube map target")):Cn==="renderbuffer"?(ii=Xi,Kr=_u):D.raise("invalid regl object for attachment"),new tn(Kr,Pr,ii)}function jt(mn,Kr,Pr,ii,Xi){if(Pr){var Cn=tr.create2D({width:mn,height:Kr,format:ii,type:Xi});return Cn._texture.refCount=0,new tn(dl,Cn,null)}else{var Ui=Ar.create({width:mn,height:Kr,format:ii});return Ui._renderbuffer.refCount=0,new tn(_u,null,Ui)}}function $t(mn){return mn&&(mn.texture||mn.renderbuffer)}function en(mn,Kr,Pr){mn&&(mn.texture?mn.texture.resize(Kr,Pr):mn.renderbuffer&&mn.renderbuffer.resize(Kr,Pr),mn.width=Kr,mn.height=Pr)}var Tn=0,Er={};function Jn(){this.id=Tn++,Er[this.id]=this,this.framebuffer=Y.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Ur(mn){mn.colorAttachments.forEach(an),an(mn.depthAttachment),an(mn.stencilAttachment),an(mn.depthStencilAttachment)}function cn(mn){var Kr=mn.framebuffer;D(Kr,"must not double destroy framebuffer"),Y.deleteFramebuffer(Kr),mn.framebuffer=null,yr.framebufferCount--,delete Er[mn.id]}function Lr(mn){var Kr;Y.bindFramebuffer($a,mn.framebuffer);var Pr=mn.colorAttachments;for(Kr=0;Kr<Pr.length;++Kr)Yr(pa+Kr,Pr[Kr]);for(Kr=Pr.length;Kr<it.maxColorAttachments;++Kr)Y.framebufferTexture2D($a,pa+Kr,dl,null,0);Y.framebufferTexture2D($a,Wl,dl,null,0),Y.framebufferTexture2D($a,No,dl,null,0),Y.framebufferTexture2D($a,Hh,dl,null,0),Yr(No,mn.depthAttachment),Yr(Hh,mn.stencilAttachment),Yr(Wl,mn.depthStencilAttachment);var ii=Y.checkFramebufferStatus($a);!Y.isContextLost()&&ii!==ch&&D.raise("framebuffer configuration not supported, status = "+A[ii]),Y.bindFramebuffer($a,Lt.next?Lt.next.framebuffer:null),Lt.cur=Lt.next,Y.getError()}function hn(mn,Kr){var Pr=new Jn;yr.framebufferCount++;function ii(Cn,Ui){var Ei;D(Lt.next!==Pr,"can not update framebuffer which is currently in use");var pi=0,ca=0,Po=!0,fs=!0,Yi=null,To=!0,Ha="rgba",Uo="uint8",Vo=1,fo=null,qo=null,Os=null,Ho=!1;if(typeof Cn=="number")pi=Cn|0,ca=Ui|0||pi;else if(!Cn)pi=ca=1;else{D.type(Cn,"object","invalid arguments for framebuffer");var Gi=Cn;if("shape"in Gi){var Ss=Gi.shape;D(Array.isArray(Ss)&&Ss.length>=2,"invalid shape for framebuffer"),pi=Ss[0],ca=Ss[1]}else"radius"in Gi&&(pi=ca=Gi.radius),"width"in Gi&&(pi=Gi.width),"height"in Gi&&(ca=Gi.height);("color"in Gi||"colors"in Gi)&&(Yi=Gi.color||Gi.colors,Array.isArray(Yi)&&D(Yi.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),Yi||("colorCount"in Gi&&(Vo=Gi.colorCount|0,D(Vo>0,"invalid color buffer count")),"colorTexture"in Gi&&(To=!!Gi.colorTexture,Ha="rgba4"),"colorType"in Gi&&(Uo=Gi.colorType,To?(D(ce.oes_texture_float||!(Uo==="float"||Uo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),D(ce.oes_texture_half_float||!(Uo==="half float"||Uo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Uo==="half float"||Uo==="float16"?(D(ce.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ha="rgba16f"):(Uo==="float"||Uo==="float32")&&(D(ce.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ha="rgba32f"),D.oneOf(Uo,nn,"invalid color type")),"colorFormat"in Gi&&(Ha=Gi.colorFormat,Gr.indexOf(Ha)>=0?To=!0:Jr.indexOf(Ha)>=0?To=!1:To?D.oneOf(Gi.colorFormat,Gr,"invalid color format for texture"):D.oneOf(Gi.colorFormat,Jr,"invalid color format for renderbuffer"))),("depthTexture"in Gi||"depthStencilTexture"in Gi)&&(Ho=!!(Gi.depthTexture||Gi.depthStencilTexture),D(!Ho||ce.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Gi&&(typeof Gi.depth=="boolean"?Po=Gi.depth:(fo=Gi.depth,fs=!1)),"stencil"in Gi&&(typeof Gi.stencil=="boolean"?fs=Gi.stencil:(qo=Gi.stencil,Po=!1)),"depthStencil"in Gi&&(typeof Gi.depthStencil=="boolean"?Po=fs=Gi.depthStencil:(Os=Gi.depthStencil,Po=!1,fs=!1))}var da=null,di=null,Di=null,ua=null;if(Array.isArray(Yi))da=Yi.map(xr);else if(Yi)da=[xr(Yi)];else for(da=new Array(Vo),Ei=0;Ei<Vo;++Ei)da[Ei]=jt(pi,ca,To,Ha,Uo);D(ce.webgl_draw_buffers||da.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),D(da.length<=it.maxColorAttachments,"too many color attachments, not supported"),pi=pi||da[0].width,ca=ca||da[0].height,fo?di=xr(fo):Po&&!fs&&(di=jt(pi,ca,Ho,"depth","uint32")),qo?Di=xr(qo):fs&&!Po&&(Di=jt(pi,ca,!1,"stencil","uint8")),Os?ua=xr(Os):!fo&&!qo&&fs&&Po&&(ua=jt(pi,ca,Ho,"depth stencil","depth stencil")),D(!!fo+!!qo+!!Os<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var hs=null;for(Ei=0;Ei<da.length;++Ei)if(yn(da[Ei],pi,ca),D(!da[Ei]||da[Ei].texture&&Wh.indexOf(da[Ei].texture._texture.format)>=0||da[Ei].renderbuffer&&y.indexOf(da[Ei].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ei+" is invalid"),da[Ei]&&da[Ei].texture){var iu=L[da[Ei].texture._texture.format]*xu[da[Ei].texture._texture.type];hs===null?hs=iu:D(hs===iu,"all color attachments much have the same number of bits per pixel.")}return yn(di,pi,ca),D(!di||di.texture&&di.texture._texture.format===Yc||di.renderbuffer&&di.renderbuffer._renderbuffer.format===Of,"invalid depth attachment for framebuffer object"),yn(Di,pi,ca),D(!Di||Di.renderbuffer&&Di.renderbuffer._renderbuffer.format===Gl,"invalid stencil attachment for framebuffer object"),yn(ua,pi,ca),D(!ua||ua.texture&&ua.texture._texture.format===ph||ua.renderbuffer&&ua.renderbuffer._renderbuffer.format===ph,"invalid depth-stencil attachment for framebuffer object"),Ur(Pr),Pr.width=pi,Pr.height=ca,Pr.colorAttachments=da,Pr.depthAttachment=di,Pr.stencilAttachment=Di,Pr.depthStencilAttachment=ua,ii.color=da.map($t),ii.depth=$t(di),ii.stencil=$t(Di),ii.depthStencil=$t(ua),ii.width=Pr.width,ii.height=Pr.height,Lr(Pr),ii}function Xi(Cn,Ui){D(Lt.next!==Pr,"can not resize a framebuffer which is currently in use");var Ei=Math.max(Cn|0,1),pi=Math.max(Ui|0||Ei,1);if(Ei===Pr.width&&pi===Pr.height)return ii;for(var ca=Pr.colorAttachments,Po=0;Po<ca.length;++Po)en(ca[Po],Ei,pi);return en(Pr.depthAttachment,Ei,pi),en(Pr.stencilAttachment,Ei,pi),en(Pr.depthStencilAttachment,Ei,pi),Pr.width=ii.width=Ei,Pr.height=ii.height=pi,Lr(Pr),ii}return ii(mn,Kr),H(ii,{resize:Xi,_reglType:"framebuffer",_framebuffer:Pr,destroy:function(){cn(Pr),Ur(Pr)},use:function(Ui){Lt.setFBO({framebuffer:ii},Ui)}})}function Qn(mn){var Kr=Array(6);function Pr(Xi){var Cn;D(Kr.indexOf(Lt.next)<0,"can not update framebuffer which is currently in use");var Ui={color:null},Ei=0,pi=null,ca="rgba",Po="uint8",fs=1;if(typeof Xi=="number")Ei=Xi|0;else if(!Xi)Ei=1;else{D.type(Xi,"object","invalid arguments for framebuffer");var Yi=Xi;if("shape"in Yi){var To=Yi.shape;D(Array.isArray(To)&&To.length>=2,"invalid shape for framebuffer"),D(To[0]===To[1],"cube framebuffer must be square"),Ei=To[0]}else"radius"in Yi&&(Ei=Yi.radius|0),"width"in Yi?(Ei=Yi.width|0,"height"in Yi&&D(Yi.height===Ei,"must be square")):"height"in Yi&&(Ei=Yi.height|0);("color"in Yi||"colors"in Yi)&&(pi=Yi.color||Yi.colors,Array.isArray(pi)&&D(pi.length===1||ce.webgl_draw_buffers,"multiple render targets not supported")),pi||("colorCount"in Yi&&(fs=Yi.colorCount|0,D(fs>0,"invalid color buffer count")),"colorType"in Yi&&(D.oneOf(Yi.colorType,nn,"invalid color type"),Po=Yi.colorType),"colorFormat"in Yi&&(ca=Yi.colorFormat,D.oneOf(Yi.colorFormat,Gr,"invalid color format for texture"))),"depth"in Yi&&(Ui.depth=Yi.depth),"stencil"in Yi&&(Ui.stencil=Yi.stencil),"depthStencil"in Yi&&(Ui.depthStencil=Yi.depthStencil)}var Ha;if(pi)if(Array.isArray(pi))for(Ha=[],Cn=0;Cn<pi.length;++Cn)Ha[Cn]=pi[Cn];else Ha=[pi];else{Ha=Array(fs);var Uo={radius:Ei,format:ca,type:Po};for(Cn=0;Cn<fs;++Cn)Ha[Cn]=tr.createCube(Uo)}for(Ui.color=Array(Ha.length),Cn=0;Cn<Ha.length;++Cn){var Vo=Ha[Cn];D(typeof Vo=="function"&&Vo._reglType==="textureCube","invalid cube map"),Ei=Ei||Vo.width,D(Vo.width===Ei&&Vo.height===Ei,"invalid cube map shape"),Ui.color[Cn]={target:vl,data:Ha[Cn]}}for(Cn=0;Cn<6;++Cn){for(var fo=0;fo<Ha.length;++fo)Ui.color[fo].target=vl+Cn;Cn>0&&(Ui.depth=Kr[0].depth,Ui.stencil=Kr[0].stencil,Ui.depthStencil=Kr[0].depthStencil),Kr[Cn]?Kr[Cn](Ui):Kr[Cn]=hn(Ui)}return H(Pr,{width:Ei,height:Ei,color:Ha})}function ii(Xi){var Cn,Ui=Xi|0;if(D(Ui>0&&Ui<=it.maxCubeMapSize,"invalid radius for cube fbo"),Ui===Pr.width)return Pr;var Ei=Pr.color;for(Cn=0;Cn<Ei.length;++Cn)Ei[Cn].resize(Ui);for(Cn=0;Cn<6;++Cn)Kr[Cn].resize(Ui);return Pr.width=Pr.height=Ui,Pr}return Pr(mn),H(Pr,{faces:Kr,resize:ii,_reglType:"framebufferCube",destroy:function(){Kr.forEach(function(Cn){Cn.destroy()})}})}function Ai(){Lt.cur=null,Lt.next=null,Lt.dirty=!0,_a(Er).forEach(function(mn){mn.framebuffer=Y.createFramebuffer(),Lr(mn)})}return H(Lt,{getFramebuffer:function(Kr){if(typeof Kr=="function"&&Kr._reglType==="framebuffer"){var Pr=Kr._framebuffer;if(Pr instanceof Jn)return Pr}return null},create:hn,createCube:Qn,clear:function(){_a(Er).forEach(cn)},restore:Ai})}var M=5126,k=34962;function G(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=M,this.offset=0,this.stride=0,this.divisor=0}function q(Y,ce,it,tr,Ar){for(var yr=it.maxAttributes,Lt=new Array(yr),Gr=0;Gr<yr;++Gr)Lt[Gr]=new G;var Jr=0,nn={},tn={Record:G,scope:{},state:Lt,currentVAO:null,targetVAO:null,restore:yn()?Er:function(){},createVAO:Jn,getVAO:xr,destroyBuffer:an,setVAO:yn()?jt:$t,clear:yn()?en:function(){}};function an(Ur){for(var cn=0;cn<Lt.length;++cn){var Lr=Lt[cn];Lr.buffer===Ur&&(Y.disableVertexAttribArray(cn),Lr.buffer=null)}}function yn(){return ce.oes_vertex_array_object}function Yr(){return ce.angle_instanced_arrays}function xr(Ur){return typeof Ur=="function"&&Ur._vao?Ur._vao:null}function jt(Ur){if(Ur!==tn.currentVAO){var cn=yn();Ur?cn.bindVertexArrayOES(Ur.vao):cn.bindVertexArrayOES(null),tn.currentVAO=Ur}}function $t(Ur){if(Ur!==tn.currentVAO){if(Ur)Ur.bindAttrs();else for(var cn=Yr(),Lr=0;Lr<Lt.length;++Lr){var hn=Lt[Lr];hn.buffer?(Y.enableVertexAttribArray(Lr),Y.vertexAttribPointer(Lr,hn.size,hn.type,hn.normalized,hn.stride,hn.offfset),cn&&cn.vertexAttribDivisorANGLE(Lr,hn.divisor)):(Y.disableVertexAttribArray(Lr),Y.vertexAttrib4f(Lr,hn.x,hn.y,hn.z,hn.w))}tn.currentVAO=Ur}}function en(){_a(nn).forEach(function(Ur){Ur.destroy()})}function Tn(){this.id=++Jr,this.attributes=[];var Ur=yn();Ur?this.vao=Ur.createVertexArrayOES():this.vao=null,nn[this.id]=this,this.buffers=[]}Tn.prototype.bindAttrs=function(){for(var Ur=Yr(),cn=this.attributes,Lr=0;Lr<cn.length;++Lr){var hn=cn[Lr];hn.buffer?(Y.enableVertexAttribArray(Lr),Y.bindBuffer(k,hn.buffer.buffer),Y.vertexAttribPointer(Lr,hn.size,hn.type,hn.normalized,hn.stride,hn.offset),Ur&&Ur.vertexAttribDivisorANGLE(Lr,hn.divisor)):(Y.disableVertexAttribArray(Lr),Y.vertexAttrib4f(Lr,hn.x,hn.y,hn.z,hn.w))}for(var Qn=cn.length;Qn<yr;++Qn)Y.disableVertexAttribArray(Qn)},Tn.prototype.refresh=function(){var Ur=yn();Ur&&(Ur.bindVertexArrayOES(this.vao),this.bindAttrs(),tn.currentVAO=this)},Tn.prototype.destroy=function(){if(this.vao){var Ur=yn();this===tn.currentVAO&&(tn.currentVAO=null,Ur.bindVertexArrayOES(null)),Ur.deleteVertexArrayOES(this.vao),this.vao=null}nn[this.id]&&(delete nn[this.id],tr.vaoCount-=1)};function Er(){var Ur=yn();Ur&&_a(nn).forEach(function(cn){cn.refresh()})}function Jn(Ur){var cn=new Tn;tr.vaoCount+=1;function Lr(hn){D(Array.isArray(hn),"arguments to vertex array constructor must be an array"),D(hn.length<yr,"too many attributes"),D(hn.length>0,"must specify at least one attribute");for(var Qn=0;Qn<cn.buffers.length;++Qn)cn.buffers[Qn].destroy();cn.buffers.length=0;var Ai=cn.attributes;Ai.length=hn.length;for(var mn=0;mn<hn.length;++mn){var Kr=hn[mn],Pr=Ai[mn]=new G;if(Array.isArray(Kr)||j(Kr)||Fo(Kr)){var ii=Ar.create(Kr,k,!1,!0);Pr.buffer=Ar.getBuffer(ii),Pr.size=Pr.buffer.dimension|0,Pr.normalized=!1,Pr.type=Pr.buffer.dtype,Pr.offset=0,Pr.stride=0,Pr.divisor=0,Pr.state=1,cn.buffers.push(ii)}else Ar.getBuffer(Kr)?(Pr.buffer=Ar.getBuffer(Kr),Pr.size=Pr.buffer.dimension|0,Pr.normalized=!1,Pr.type=Pr.buffer.dtype,Pr.offset=0,Pr.stride=0,Pr.divisor=0,Pr.state=1):Ar.getBuffer(Kr.buffer)?(Pr.buffer=Ar.getBuffer(Kr.buffer),Pr.size=(+Kr.size||Pr.buffer.dimension)|0,Pr.normalized=!!Kr.normalized||!1,"type"in Kr?(D.parameter(Kr.type,ys,"invalid buffer type"),Pr.type=ys[Kr.type]):Pr.type=Pr.buffer.dtype,Pr.offset=(Kr.offset||0)|0,Pr.stride=(Kr.stride||0)|0,Pr.divisor=(Kr.divisor||0)|0,Pr.state=1,D(Pr.size>=1&&Pr.size<=4,"size must be between 1 and 4"),D(Pr.offset>=0,"invalid offset"),D(Pr.stride>=0&&Pr.stride<=255,"stride must be between 0 and 255"),D(Pr.divisor>=0,"divisor must be positive"),D(!Pr.divisor||!!ce.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Kr?(D(mn>0,"first attribute must not be a constant"),Pr.x=+Kr.x||0,Pr.y=+Kr.y||0,Pr.z=+Kr.z||0,Pr.w=+Kr.w||0,Pr.state=2):D(!1,"invalid attribute spec for location "+mn)}return cn.refresh(),Lr}return Lr.destroy=function(){cn.destroy()},Lr._vao=cn,Lr._reglType="vao",Lr(Ur)}return tn}var pe=35632,ye=35633,be=35718,qe=35721;function Ue(Y,ce,it,tr){var Ar={},yr={};function Lt(jt,$t,en,Tn){this.name=jt,this.id=$t,this.location=en,this.info=Tn}function Gr(jt,$t){for(var en=0;en<jt.length;++en)if(jt[en].id===$t.id){jt[en].location=$t.location;return}jt.push($t)}function Jr(jt,$t,en){var Tn=jt===pe?Ar:yr,Er=Tn[$t];if(!Er){var Jn=ce.str($t);Er=Y.createShader(jt),Y.shaderSource(Er,Jn),Y.compileShader(Er),D.shaderError(Y,Er,Jn,jt,en),Tn[$t]=Er}return Er}var nn={},tn=[],an=0;function yn(jt,$t){this.id=an++,this.fragId=jt,this.vertId=$t,this.program=null,this.uniforms=[],this.attributes=[],tr.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Yr(jt,$t,en){var Tn,Er,Jn=Jr(pe,jt.fragId),Ur=Jr(ye,jt.vertId),cn=jt.program=Y.createProgram();if(Y.attachShader(cn,Jn),Y.attachShader(cn,Ur),en)for(Tn=0;Tn<en.length;++Tn){var Lr=en[Tn];Y.bindAttribLocation(cn,Lr[0],Lr[1])}Y.linkProgram(cn),D.linkError(Y,cn,ce.str(jt.fragId),ce.str(jt.vertId),$t);var hn=Y.getProgramParameter(cn,be);tr.profile&&(jt.stats.uniformsCount=hn);var Qn=jt.uniforms;for(Tn=0;Tn<hn;++Tn)if(Er=Y.getActiveUniform(cn,Tn),Er)if(Er.size>1)for(var Ai=0;Ai<Er.size;++Ai){var mn=Er.name.replace("[0]","["+Ai+"]");Gr(Qn,new Lt(mn,ce.id(mn),Y.getUniformLocation(cn,mn),Er))}else Gr(Qn,new Lt(Er.name,ce.id(Er.name),Y.getUniformLocation(cn,Er.name),Er));var Kr=Y.getProgramParameter(cn,qe);tr.profile&&(jt.stats.attributesCount=Kr);var Pr=jt.attributes;for(Tn=0;Tn<Kr;++Tn)Er=Y.getActiveAttrib(cn,Tn),Er&&Gr(Pr,new Lt(Er.name,ce.id(Er.name),Y.getAttribLocation(cn,Er.name),Er))}tr.profile&&(it.getMaxUniformsCount=function(){var jt=0;return tn.forEach(function($t){$t.stats.uniformsCount>jt&&(jt=$t.stats.uniformsCount)}),jt},it.getMaxAttributesCount=function(){var jt=0;return tn.forEach(function($t){$t.stats.attributesCount>jt&&(jt=$t.stats.attributesCount)}),jt});function xr(){Ar={},yr={};for(var jt=0;jt<tn.length;++jt)Yr(tn[jt],null,tn[jt].attributes.map(function($t){return[$t.location,$t.name]}))}return{clear:function(){var $t=Y.deleteShader.bind(Y);_a(Ar).forEach($t),Ar={},_a(yr).forEach($t),yr={},tn.forEach(function(en){Y.deleteProgram(en.program)}),tn.length=0,nn={},it.shaderCount=0},program:function($t,en,Tn,Er){D.command($t>=0,"missing vertex shader",Tn),D.command(en>=0,"missing fragment shader",Tn);var Jn=nn[en];Jn||(Jn=nn[en]={});var Ur=Jn[$t];if(Ur&&!Er)return Ur;var cn=new yn(en,$t);return it.shaderCount++,Yr(cn,Tn,Er),Ur||(Jn[$t]=cn),tn.push(cn),cn},restore:xr,shader:Jr,frag:-1,vert:-1}}var ht=6408,We=5121,nt=3333,Mt=5126;function Pt(Y,ce,it,tr,Ar,yr,Lt){function Gr(tn){var an;ce.next===null?(D(Ar.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),an=We):(D(ce.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),an=ce.next.colorAttachments[0].texture._texture.type,yr.oes_texture_float?(D(an===We||an===Mt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),an===Mt&&D(Lt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):D(an===We,"Reading from a framebuffer is only allowed for the type 'uint8'"));var yn=0,Yr=0,xr=tr.framebufferWidth,jt=tr.framebufferHeight,$t=null;j(tn)?$t=tn:tn&&(D.type(tn,"object","invalid arguments to regl.read()"),yn=tn.x|0,Yr=tn.y|0,D(yn>=0&&yn<tr.framebufferWidth,"invalid x offset for regl.read"),D(Yr>=0&&Yr<tr.framebufferHeight,"invalid y offset for regl.read"),xr=(tn.width||tr.framebufferWidth-yn)|0,jt=(tn.height||tr.framebufferHeight-Yr)|0,$t=tn.data||null),$t&&(an===We?D($t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):an===Mt&&D($t instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),D(xr>0&&xr+yn<=tr.framebufferWidth,"invalid width for read pixels"),D(jt>0&&jt+Yr<=tr.framebufferHeight,"invalid height for read pixels"),it();var en=xr*jt*4;return $t||(an===We?$t=new Uint8Array(en):an===Mt&&($t=$t||new Float32Array(en))),D.isTypedArray($t,"data buffer for regl.read() must be a typedarray"),D($t.byteLength>=en,"data buffer for regl.read() too small"),Y.pixelStorei(nt,4),Y.readPixels(yn,Yr,xr,jt,ht,an,$t),$t}function Jr(tn){var an;return ce.setFBO({framebuffer:tn.framebuffer},function(){an=Gr(tn)}),an}function nn(tn){return!tn||!("framebuffer"in tn)?Gr(tn):Jr(tn)}return nn}function vr(Y){return Array.prototype.slice.call(Y)}function rr(Y){return vr(Y).join("")}function br(){var Y=0,ce=[],it=[];function tr(an){for(var yn=0;yn<it.length;++yn)if(it[yn]===an)return ce[yn];var Yr="g"+Y++;return ce.push(Yr),it.push(an),Yr}function Ar(){var an=[];function yn(){an.push.apply(an,vr(arguments))}var Yr=[];function xr(){var jt="v"+Y++;return Yr.push(jt),arguments.length>0&&(an.push(jt,"="),an.push.apply(an,vr(arguments)),an.push(";")),jt}return H(yn,{def:xr,toString:function(){return rr([Yr.length>0?"var "+Yr.join(",")+";":"",rr(an)])}})}function yr(){var an=Ar(),yn=Ar(),Yr=an.toString,xr=yn.toString;function jt($t,en){yn($t,en,"=",an.def($t,en),";")}return H(function(){an.apply(an,vr(arguments))},{def:an.def,entry:an,exit:yn,save:jt,set:function(en,Tn,Er){jt(en,Tn),an(en,Tn,"=",Er,";")},toString:function(){return Yr()+xr()}})}function Lt(){var an=rr(arguments),yn=yr(),Yr=yr(),xr=yn.toString,jt=Yr.toString;return H(yn,{then:function(){return yn.apply(yn,vr(arguments)),this},else:function(){return Yr.apply(Yr,vr(arguments)),this},toString:function(){var en=jt();return en&&(en="else{"+en+"}"),rr(["if(",an,"){",xr(),"}",en])}})}var Gr=Ar(),Jr={};function nn(an,yn){var Yr=[];function xr(){var Er="a"+Yr.length;return Yr.push(Er),Er}yn=yn||0;for(var jt=0;jt<yn;++jt)xr();var $t=yr(),en=$t.toString,Tn=Jr[an]=H($t,{arg:xr,toString:function(){return rr(["function(",Yr.join(),"){",en(),"}"])}});return Tn}function tn(){var an=['"use strict";',Gr,"return {"];Object.keys(Jr).forEach(function(xr){an.push('"',xr,'":',Jr[xr].toString(),",")}),an.push("}");var yn=rr(an).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Yr=Function.apply(null,ce.concat(yn));return Yr.apply(null,it)}return{global:Gr,link:tr,block:Ar,proc:nn,scope:yr,cond:Lt,compile:tn}}var wr="xyzw".split(""),$r=5121,Qr=1,_n=2,Ln=0,si=1,hi=2,Wi=3,Qi=4,An="dither",Ri="blend.enable",Pi="blend.color",Xn="blend.equation",Ii="blend.func",ui="depth.enable",zi="depth.func",Ji="depth.range",Ao="depth.mask",so="colorMask",Mo="cull.enable",Ya="cull.face",Ka="frontFace",ru="lineWidth",ss="polygonOffset.enable",Qu="polygonOffset.offset",Mu="sample.alpha",us="sample.enable",xs="sample.coverage",Xl="stencil.enable",Kc="stencil.mask",Su="stencil.func",Zl="stencil.opFront",Ju="stencil.opBack",Xt="scissor.enable",De="scissor.box",ls="viewport",he="profile",Us="framebuffer",uo="vert",nu="frag",qa="elements",Da="primitive",xo="count",cs="offset",jo="instances",Pu="vao",Xh="Width",vh="Height",$l=Us+Xh,du=Us+vh,qc=ls+Xh,Rf=ls+vh,Iu="drawingBuffer",Vs=Iu+Xh,yv=Iu+vh,_v=[Ii,Xn,Su,Zl,Ju,xs,ls,De,Qu],mh=34962,gd=34963,bv=35632,xv=35633,Ap=3553,jm=34067,Tp=2884,Ev=3042,Qc=3024,Zh=2960,zm=2929,Jc=3089,Um=32823,Sv=32926,Vm=32928,yd=5126,Cp=35664,gl=35665,wp=35666,Mf=5124,Op=35667,Ua=35668,Pf=35669,Yl=35670,ku=35671,gh=35672,If=35673,yh=35674,$h=35675,yl=35676,kf=35678,Df=35680,Av=4,_l=1028,Ff=1029,Rp=2304,Mp=2305,_d=32775,Yh=32776,el=519,Kl=7680,Tv=0,bd=1,Kh=32774,xd=513,ef=36160,Hm=36064,ql={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Bf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],tf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},rf={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Cv={frag:bv,vert:xv},Ql={cw:Rp,ccw:Mp};function _h(Y){return Array.isArray(Y)||j(Y)||Fo(Y)}function Pp(Y){return Y.sort(function(ce,it){return ce===ls?-1:it===ls?1:ce<it?-1:1})}function Eo(Y,ce,it,tr){this.thisDep=Y,this.contextDep=ce,this.propDep=it,this.append=tr}function Es(Y){return Y&&!(Y.thisDep||Y.contextDep||Y.propDep)}function zo(Y){return new Eo(!1,!1,!1,Y)}function Au(Y,ce){var it=Y.type;if(it===Ln){var tr=Y.data.length;return new Eo(!0,tr>=1,tr>=2,ce)}else if(it===Qi){var Ar=Y.data;return new Eo(Ar.thisDep,Ar.contextDep,Ar.propDep,ce)}else return new Eo(it===Wi,it===hi,it===si,ce)}var wv=new Eo(!1,!1,!1,function(){});function qh(Y,ce,it,tr,Ar,yr,Lt,Gr,Jr,nn,tn,an,yn,Yr,xr){var jt=nn.Record,$t={add:32774,subtract:32778,"reverse subtract":32779};it.ext_blend_minmax&&($t.min=_d,$t.max=Yh);var en=it.angle_instanced_arrays,Tn=it.webgl_draw_buffers,Er={dirty:!0,profile:xr.profile},Jn={},Ur=[],cn={},Lr={};function hn(de){return de.replace(".","_")}function Qn(de,Ie,rt){var nr=hn(de);Ur.push(de),Jn[nr]=Er[nr]=!!rt,cn[nr]=Ie}function Ai(de,Ie,rt){var nr=hn(de);Ur.push(de),Array.isArray(rt)?(Er[nr]=rt.slice(),Jn[nr]=rt.slice()):Er[nr]=Jn[nr]=rt,Lr[nr]=Ie}Qn(An,Qc),Qn(Ri,Ev),Ai(Pi,"blendColor",[0,0,0,0]),Ai(Xn,"blendEquationSeparate",[Kh,Kh]),Ai(Ii,"blendFuncSeparate",[bd,Tv,bd,Tv]),Qn(ui,zm,!0),Ai(zi,"depthFunc",xd),Ai(Ji,"depthRange",[0,1]),Ai(Ao,"depthMask",!0),Ai(so,so,[!0,!0,!0,!0]),Qn(Mo,Tp),Ai(Ya,"cullFace",Ff),Ai(Ka,Ka,Mp),Ai(ru,ru,1),Qn(ss,Um),Ai(Qu,"polygonOffset",[0,0]),Qn(Mu,Sv),Qn(us,Vm),Ai(xs,"sampleCoverage",[1,!1]),Qn(Xl,Zh),Ai(Kc,"stencilMask",-1),Ai(Su,"stencilFunc",[el,0,-1]),Ai(Zl,"stencilOpSeparate",[_l,Kl,Kl,Kl]),Ai(Ju,"stencilOpSeparate",[Ff,Kl,Kl,Kl]),Qn(Xt,Jc),Ai(De,"scissor",[0,0,Y.drawingBufferWidth,Y.drawingBufferHeight]),Ai(ls,ls,[0,0,Y.drawingBufferWidth,Y.drawingBufferHeight]);var mn={gl:Y,context:yn,strings:ce,next:Jn,current:Er,draw:an,elements:yr,buffer:Ar,shader:tn,attributes:nn.state,vao:nn,uniforms:Jr,framebuffer:Gr,extensions:it,timer:Yr,isBufferArgs:_h},Kr={primTypes:Xu,compareFuncs:tf,blendFuncs:ql,blendEquations:$t,stencilOps:rf,glTypes:ys,orientationType:Ql};D.optional(function(){mn.isArrayLike=oo}),Tn&&(Kr.backBuffer=[Ff],Kr.drawBuffer=Mi(tr.maxDrawbuffers,function(de){return de===0?[0]:Mi(de,function(Ie){return Hm+Ie})}));var Pr=0;function ii(){var de=br(),Ie=de.link,rt=de.global;de.id=Pr++,de.batchId="0";var nr=Ie(mn),qt=de.shared={props:"a0"};Object.keys(mn).forEach(function(yt){qt[yt]=rt.def(nr,".",yt)}),D.optional(function(){de.CHECK=Ie(D),de.commandStr=D.guessCommand(),de.command=Ie(de.commandStr),de.assert=function(yt,Me,_t){yt("if(!(",Me,"))",this.CHECK,".commandRaise(",Ie(_t),",",this.command,");")},Kr.invalidBlendCombinations=Bf});var dt=de.next={},bt=de.current={};Object.keys(Lr).forEach(function(yt){Array.isArray(Er[yt])&&(dt[yt]=rt.def(qt.next,".",yt),bt[yt]=rt.def(qt.current,".",yt))});var Tt=de.constants={};Object.keys(Kr).forEach(function(yt){Tt[yt]=rt.def(JSON.stringify(Kr[yt]))}),de.invoke=function(yt,Me){switch(Me.type){case Ln:var _t=["this",qt.context,qt.props,de.batchId];return yt.def(Ie(Me.data),".call(",_t.slice(0,Math.max(Me.data.length+1,4)),")");case si:return yt.def(qt.props,Me.data);case hi:return yt.def(qt.context,Me.data);case Wi:return yt.def("this",Me.data);case Qi:return Me.data.append(de,yt),Me.data.ref}},de.attribCache={};var Ve={};return de.scopeAttrib=function(yt){var Me=ce.id(yt);if(Me in Ve)return Ve[Me];var _t=nn.scope[Me];_t||(_t=nn.scope[Me]=new jt);var hr=Ve[Me]=Ie(_t);return hr},de}function Xi(de){var Ie=de.static,rt=de.dynamic,nr;if(he in Ie){var qt=!!Ie[he];nr=zo(function(bt,Tt){return qt}),nr.enable=qt}else if(he in rt){var dt=rt[he];nr=Au(dt,function(bt,Tt){return bt.invoke(Tt,dt)})}return nr}function Cn(de,Ie){var rt=de.static,nr=de.dynamic;if(Us in rt){var qt=rt[Us];return qt?(qt=Gr.getFramebuffer(qt),D.command(qt,"invalid framebuffer object"),zo(function(bt,Tt){var Ve=bt.link(qt),yt=bt.shared;Tt.set(yt.framebuffer,".next",Ve);var Me=yt.context;return Tt.set(Me,"."+$l,Ve+".width"),Tt.set(Me,"."+du,Ve+".height"),Ve})):zo(function(bt,Tt){var Ve=bt.shared;Tt.set(Ve.framebuffer,".next","null");var yt=Ve.context;return Tt.set(yt,"."+$l,yt+"."+Vs),Tt.set(yt,"."+du,yt+"."+yv),"null"})}else if(Us in nr){var dt=nr[Us];return Au(dt,function(bt,Tt){var Ve=bt.invoke(Tt,dt),yt=bt.shared,Me=yt.framebuffer,_t=Tt.def(Me,".getFramebuffer(",Ve,")");D.optional(function(){bt.assert(Tt,"!"+Ve+"||"+_t,"invalid framebuffer object")}),Tt.set(Me,".next",_t);var hr=yt.context;return Tt.set(hr,"."+$l,_t+"?"+_t+".width:"+hr+"."+Vs),Tt.set(hr,"."+du,_t+"?"+_t+".height:"+hr+"."+yv),_t})}else return null}function Ui(de,Ie,rt){var nr=de.static,qt=de.dynamic;function dt(Ve){if(Ve in nr){var yt=nr[Ve];D.commandType(yt,"object","invalid "+Ve,rt.commandStr);var Me=!0,_t=yt.x|0,hr=yt.y|0,mr,zr;return"width"in yt?(mr=yt.width|0,D.command(mr>=0,"invalid "+Ve,rt.commandStr)):Me=!1,"height"in yt?(zr=yt.height|0,D.command(zr>=0,"invalid "+Ve,rt.commandStr)):Me=!1,new Eo(!Me&&Ie&&Ie.thisDep,!Me&&Ie&&Ie.contextDep,!Me&&Ie&&Ie.propDep,function(Zn,Dn){var zn=Zn.shared.context,fi=mr;"width"in yt||(fi=Dn.def(zn,".",$l,"-",_t));var yi=zr;return"height"in yt||(yi=Dn.def(zn,".",du,"-",hr)),[_t,hr,fi,yi]})}else if(Ve in qt){var kr=qt[Ve],Xr=Au(kr,function(Zn,Dn){var zn=Zn.invoke(Dn,kr);D.optional(function(){Zn.assert(Dn,zn+"&&typeof "+zn+'==="object"',"invalid "+Ve)});var fi=Zn.shared.context,yi=Dn.def(zn,".x|0"),va=Dn.def(zn,".y|0"),Wo=Dn.def('"width" in ',zn,"?",zn,".width|0:","(",fi,".",$l,"-",yi,")"),bl=Dn.def('"height" in ',zn,"?",zn,".height|0:","(",fi,".",du,"-",va,")");return D.optional(function(){Zn.assert(Dn,Wo+">=0&&"+bl+">=0","invalid "+Ve)}),[yi,va,Wo,bl]});return Ie&&(Xr.thisDep=Xr.thisDep||Ie.thisDep,Xr.contextDep=Xr.contextDep||Ie.contextDep,Xr.propDep=Xr.propDep||Ie.propDep),Xr}else return Ie?new Eo(Ie.thisDep,Ie.contextDep,Ie.propDep,function(Zn,Dn){var zn=Zn.shared.context;return[0,0,Dn.def(zn,".",$l),Dn.def(zn,".",du)]}):null}var bt=dt(ls);if(bt){var Tt=bt;bt=new Eo(bt.thisDep,bt.contextDep,bt.propDep,function(Ve,yt){var Me=Tt.append(Ve,yt),_t=Ve.shared.context;return yt.set(_t,"."+qc,Me[2]),yt.set(_t,"."+Rf,Me[3]),Me})}return{viewport:bt,scissor_box:dt(De)}}function Ei(de,Ie){var rt=de.static,nr=typeof rt[nu]=="string"&&typeof rt[uo]=="string";if(nr){if(Object.keys(Ie.dynamic).length>0)return null;var qt=Ie.static,dt=Object.keys(qt);if(dt.length>0&&typeof qt[dt[0]]=="number"){for(var bt=[],Tt=0;Tt<dt.length;++Tt)D(typeof qt[dt[Tt]]=="number","must specify all vertex attribute locations when using vaos"),bt.push([qt[dt[Tt]]|0,dt[Tt]]);return bt}}return null}function pi(de,Ie,rt){var nr=de.static,qt=de.dynamic;function dt(Me){if(Me in nr){var _t=ce.id(nr[Me]);D.optional(function(){tn.shader(Cv[Me],_t,D.guessCommand())});var hr=zo(function(){return _t});return hr.id=_t,hr}else if(Me in qt){var mr=qt[Me];return Au(mr,function(zr,kr){var Xr=zr.invoke(kr,mr),Zn=kr.def(zr.shared.strings,".id(",Xr,")");return D.optional(function(){kr(zr.shared.shader,".shader(",Cv[Me],",",Zn,",",zr.command,");")}),Zn})}return null}var bt=dt(nu),Tt=dt(uo),Ve=null,yt;return Es(bt)&&Es(Tt)?(Ve=tn.program(Tt.id,bt.id,null,rt),yt=zo(function(Me,_t){return Me.link(Ve)})):yt=new Eo(bt&&bt.thisDep||Tt&&Tt.thisDep,bt&&bt.contextDep||Tt&&Tt.contextDep,bt&&bt.propDep||Tt&&Tt.propDep,function(Me,_t){var hr=Me.shared.shader,mr;bt?mr=bt.append(Me,_t):mr=_t.def(hr,".",nu);var zr;Tt?zr=Tt.append(Me,_t):zr=_t.def(hr,".",uo);var kr=hr+".program("+zr+","+mr;return D.optional(function(){kr+=","+Me.command}),_t.def(kr+")")}),{frag:bt,vert:Tt,progVar:yt,program:Ve}}function ca(de,Ie){var rt=de.static,nr=de.dynamic;function qt(){if(qa in rt){var Me=rt[qa];_h(Me)?Me=yr.getElements(yr.create(Me,!0)):Me&&(Me=yr.getElements(Me),D.command(Me,"invalid elements",Ie.commandStr));var _t=zo(function(mr,zr){if(Me){var kr=mr.link(Me);return mr.ELEMENTS=kr,kr}return mr.ELEMENTS=null,null});return _t.value=Me,_t}else if(qa in nr){var hr=nr[qa];return Au(hr,function(mr,zr){var kr=mr.shared,Xr=kr.isBufferArgs,Zn=kr.elements,Dn=mr.invoke(zr,hr),zn=zr.def("null"),fi=zr.def(Xr,"(",Dn,")"),yi=mr.cond(fi).then(zn,"=",Zn,".createStream(",Dn,");").else(zn,"=",Zn,".getElements(",Dn,");");return D.optional(function(){mr.assert(yi.else,"!"+Dn+"||"+zn,"invalid elements")}),zr.entry(yi),zr.exit(mr.cond(fi).then(Zn,".destroyStream(",zn,");")),mr.ELEMENTS=zn,zn})}return null}var dt=qt();function bt(){if(Da in rt){var Me=rt[Da];return D.commandParameter(Me,Xu,"invalid primitve",Ie.commandStr),zo(function(hr,mr){return Xu[Me]})}else if(Da in nr){var _t=nr[Da];return Au(_t,function(hr,mr){var zr=hr.constants.primTypes,kr=hr.invoke(mr,_t);return D.optional(function(){hr.assert(mr,kr+" in "+zr,"invalid primitive, must be one of "+Object.keys(Xu))}),mr.def(zr,"[",kr,"]")})}else if(dt)return Es(dt)?dt.value?zo(function(hr,mr){return mr.def(hr.ELEMENTS,".primType")}):zo(function(){return Av}):new Eo(dt.thisDep,dt.contextDep,dt.propDep,function(hr,mr){var zr=hr.ELEMENTS;return mr.def(zr,"?",zr,".primType:",Av)});return null}function Tt(Me,_t){if(Me in rt){var hr=rt[Me]|0;return D.command(!_t||hr>=0,"invalid "+Me,Ie.commandStr),zo(function(zr,kr){return _t&&(zr.OFFSET=hr),hr})}else if(Me in nr){var mr=nr[Me];return Au(mr,function(zr,kr){var Xr=zr.invoke(kr,mr);return _t&&(zr.OFFSET=Xr,D.optional(function(){zr.assert(kr,Xr+">=0","invalid "+Me)})),Xr})}else if(_t&&dt)return zo(function(zr,kr){return zr.OFFSET="0",0});return null}var Ve=Tt(cs,!0);function yt(){if(xo in rt){var Me=rt[xo]|0;return D.command(typeof Me=="number"&&Me>=0,"invalid vertex count",Ie.commandStr),zo(function(){return Me})}else if(xo in nr){var _t=nr[xo];return Au(_t,function(zr,kr){var Xr=zr.invoke(kr,_t);return D.optional(function(){zr.assert(kr,"typeof "+Xr+'==="number"&&'+Xr+">=0&&"+Xr+"===("+Xr+"|0)","invalid vertex count")}),Xr})}else if(dt)if(Es(dt)){if(dt)return Ve?new Eo(Ve.thisDep,Ve.contextDep,Ve.propDep,function(zr,kr){var Xr=kr.def(zr.ELEMENTS,".vertCount-",zr.OFFSET);return D.optional(function(){zr.assert(kr,Xr+">=0","invalid vertex offset/element buffer too small")}),Xr}):zo(function(zr,kr){return kr.def(zr.ELEMENTS,".vertCount")});var hr=zo(function(){return-1});return D.optional(function(){hr.MISSING=!0}),hr}else{var mr=new Eo(dt.thisDep||Ve.thisDep,dt.contextDep||Ve.contextDep,dt.propDep||Ve.propDep,function(zr,kr){var Xr=zr.ELEMENTS;return zr.OFFSET?kr.def(Xr,"?",Xr,".vertCount-",zr.OFFSET,":-1"):kr.def(Xr,"?",Xr,".vertCount:-1")});return D.optional(function(){mr.DYNAMIC=!0}),mr}return null}return{elements:dt,primitive:bt(),count:yt(),instances:Tt(jo,!1),offset:Ve}}function Po(de,Ie){var rt=de.static,nr=de.dynamic,qt={};return Ur.forEach(function(dt){var bt=hn(dt);function Tt(Ve,yt){if(dt in rt){var Me=Ve(rt[dt]);qt[bt]=zo(function(){return Me})}else if(dt in nr){var _t=nr[dt];qt[bt]=Au(_t,function(hr,mr){return yt(hr,mr,hr.invoke(mr,_t))})}}switch(dt){case Mo:case Ri:case An:case Xl:case ui:case Xt:case ss:case Mu:case us:case Ao:return Tt(function(Ve){return D.commandType(Ve,"boolean",dt,Ie.commandStr),Ve},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,"typeof "+Me+'==="boolean"',"invalid flag "+dt,Ve.commandStr)}),Me});case zi:return Tt(function(Ve){return D.commandParameter(Ve,tf,"invalid "+dt,Ie.commandStr),tf[Ve]},function(Ve,yt,Me){var _t=Ve.constants.compareFuncs;return D.optional(function(){Ve.assert(yt,Me+" in "+_t,"invalid "+dt+", must be one of "+Object.keys(tf))}),yt.def(_t,"[",Me,"]")});case Ji:return Tt(function(Ve){return D.command(oo(Ve)&&Ve.length===2&&typeof Ve[0]=="number"&&typeof Ve[1]=="number"&&Ve[0]<=Ve[1],"depth range is 2d array",Ie.commandStr),Ve},function(Ve,yt,Me){D.optional(function(){Ve.assert(yt,Ve.shared.isArrayLike+"("+Me+")&&"+Me+".length===2&&typeof "+Me+'[0]==="number"&&typeof '+Me+'[1]==="number"&&'+Me+"[0]<="+Me+"[1]","depth range must be a 2d array")});var _t=yt.def("+",Me,"[0]"),hr=yt.def("+",Me,"[1]");return[_t,hr]});case Ii:return Tt(function(Ve){D.commandType(Ve,"object","blend.func",Ie.commandStr);var yt="srcRGB"in Ve?Ve.srcRGB:Ve.src,Me="srcAlpha"in Ve?Ve.srcAlpha:Ve.src,_t="dstRGB"in Ve?Ve.dstRGB:Ve.dst,hr="dstAlpha"in Ve?Ve.dstAlpha:Ve.dst;return D.commandParameter(yt,ql,bt+".srcRGB",Ie.commandStr),D.commandParameter(Me,ql,bt+".srcAlpha",Ie.commandStr),D.commandParameter(_t,ql,bt+".dstRGB",Ie.commandStr),D.commandParameter(hr,ql,bt+".dstAlpha",Ie.commandStr),D.command(Bf.indexOf(yt+", "+_t)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+yt+", "+_t+")",Ie.commandStr),[ql[yt],ql[_t],ql[Me],ql[hr]]},function(Ve,yt,Me){var _t=Ve.constants.blendFuncs;D.optional(function(){Ve.assert(yt,Me+"&&typeof "+Me+'==="object"',"invalid blend func, must be an object")});function hr(zn,fi){var yi=yt.def('"',zn,fi,'" in ',Me,"?",Me,".",zn,fi,":",Me,".",zn);return D.optional(function(){Ve.assert(yt,yi+" in "+_t,"invalid "+dt+"."+zn+fi+", must be one of "+Object.keys(ql))}),yi}var mr=hr("src","RGB"),zr=hr("dst","RGB");D.optional(function(){var zn=Ve.constants.invalidBlendCombinations;Ve.assert(yt,zn+".indexOf("+mr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var kr=yt.def(_t,"[",mr,"]"),Xr=yt.def(_t,"[",hr("src","Alpha"),"]"),Zn=yt.def(_t,"[",zr,"]"),Dn=yt.def(_t,"[",hr("dst","Alpha"),"]");return[kr,Zn,Xr,Dn]});case Xn:return Tt(function(Ve){if(typeof Ve=="string")return D.commandParameter(Ve,$t,"invalid "+dt,Ie.commandStr),[$t[Ve],$t[Ve]];if(typeof Ve=="object")return D.commandParameter(Ve.rgb,$t,dt+".rgb",Ie.commandStr),D.commandParameter(Ve.alpha,$t,dt+".alpha",Ie.commandStr),[$t[Ve.rgb],$t[Ve.alpha]];D.commandRaise("invalid blend.equation",Ie.commandStr)},function(Ve,yt,Me){var _t=Ve.constants.blendEquations,hr=yt.def(),mr=yt.def(),zr=Ve.cond("typeof ",Me,'==="string"');return D.optional(function(){function kr(Xr,Zn,Dn){Ve.assert(Xr,Dn+" in "+_t,"invalid "+Zn+", must be one of "+Object.keys($t))}kr(zr.then,dt,Me),Ve.assert(zr.else,Me+"&&typeof "+Me+'==="object"',"invalid "+dt),kr(zr.else,dt+".rgb",Me+".rgb"),kr(zr.else,dt+".alpha",Me+".alpha")}),zr.then(hr,"=",mr,"=",_t,"[",Me,"];"),zr.else(hr,"=",_t,"[",Me,".rgb];",mr,"=",_t,"[",Me,".alpha];"),yt(zr),[hr,mr]});case Pi:return Tt(function(Ve){return D.command(oo(Ve)&&Ve.length===4,"blend.color must be a 4d array",Ie.commandStr),Mi(4,function(yt){return+Ve[yt]})},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,Ve.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","blend.color must be a 4d array")}),Mi(4,function(_t){return yt.def("+",Me,"[",_t,"]")})});case Kc:return Tt(function(Ve){return D.commandType(Ve,"number",bt,Ie.commandStr),Ve|0},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,"typeof "+Me+'==="number"',"invalid stencil.mask")}),yt.def(Me,"|0")});case Su:return Tt(function(Ve){D.commandType(Ve,"object",bt,Ie.commandStr);var yt=Ve.cmp||"keep",Me=Ve.ref||0,_t="mask"in Ve?Ve.mask:-1;return D.commandParameter(yt,tf,dt+".cmp",Ie.commandStr),D.commandType(Me,"number",dt+".ref",Ie.commandStr),D.commandType(_t,"number",dt+".mask",Ie.commandStr),[tf[yt],Me,_t]},function(Ve,yt,Me){var _t=Ve.constants.compareFuncs;D.optional(function(){function kr(){Ve.assert(yt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}kr(Me+"&&typeof ",Me,'==="object"'),kr('!("cmp" in ',Me,")||(",Me,".cmp in ",_t,")")});var hr=yt.def('"cmp" in ',Me,"?",_t,"[",Me,".cmp]",":",Kl),mr=yt.def(Me,".ref|0"),zr=yt.def('"mask" in ',Me,"?",Me,".mask|0:-1");return[hr,mr,zr]});case Zl:case Ju:return Tt(function(Ve){D.commandType(Ve,"object",bt,Ie.commandStr);var yt=Ve.fail||"keep",Me=Ve.zfail||"keep",_t=Ve.zpass||"keep";return D.commandParameter(yt,rf,dt+".fail",Ie.commandStr),D.commandParameter(Me,rf,dt+".zfail",Ie.commandStr),D.commandParameter(_t,rf,dt+".zpass",Ie.commandStr),[dt===Ju?Ff:_l,rf[yt],rf[Me],rf[_t]]},function(Ve,yt,Me){var _t=Ve.constants.stencilOps;D.optional(function(){Ve.assert(yt,Me+"&&typeof "+Me+'==="object"',"invalid "+dt)});function hr(mr){return D.optional(function(){Ve.assert(yt,'!("'+mr+'" in '+Me+")||("+Me+"."+mr+" in "+_t+")","invalid "+dt+"."+mr+", must be one of "+Object.keys(rf))}),yt.def('"',mr,'" in ',Me,"?",_t,"[",Me,".",mr,"]:",Kl)}return[dt===Ju?Ff:_l,hr("fail"),hr("zfail"),hr("zpass")]});case Qu:return Tt(function(Ve){D.commandType(Ve,"object",bt,Ie.commandStr);var yt=Ve.factor|0,Me=Ve.units|0;return D.commandType(yt,"number",bt+".factor",Ie.commandStr),D.commandType(Me,"number",bt+".units",Ie.commandStr),[yt,Me]},function(Ve,yt,Me){D.optional(function(){Ve.assert(yt,Me+"&&typeof "+Me+'==="object"',"invalid "+dt)});var _t=yt.def(Me,".factor|0"),hr=yt.def(Me,".units|0");return[_t,hr]});case Ya:return Tt(function(Ve){var yt=0;return Ve==="front"?yt=_l:Ve==="back"&&(yt=Ff),D.command(!!yt,bt,Ie.commandStr),yt},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,Me+'==="front"||'+Me+'==="back"',"invalid cull.face")}),yt.def(Me,'==="front"?',_l,":",Ff)});case ru:return Tt(function(Ve){return D.command(typeof Ve=="number"&&Ve>=tr.lineWidthDims[0]&&Ve<=tr.lineWidthDims[1],"invalid line width, must be a positive number between "+tr.lineWidthDims[0]+" and "+tr.lineWidthDims[1],Ie.commandStr),Ve},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,"typeof "+Me+'==="number"&&'+Me+">="+tr.lineWidthDims[0]+"&&"+Me+"<="+tr.lineWidthDims[1],"invalid line width")}),Me});case Ka:return Tt(function(Ve){return D.commandParameter(Ve,Ql,bt,Ie.commandStr),Ql[Ve]},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,Me+'==="cw"||'+Me+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),yt.def(Me+'==="cw"?'+Rp+":"+Mp)});case so:return Tt(function(Ve){return D.command(oo(Ve)&&Ve.length===4,"color.mask must be length 4 array",Ie.commandStr),Ve.map(function(yt){return!!yt})},function(Ve,yt,Me){return D.optional(function(){Ve.assert(yt,Ve.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","invalid color.mask")}),Mi(4,function(_t){return"!!"+Me+"["+_t+"]"})});case xs:return Tt(function(Ve){D.command(typeof Ve=="object"&&Ve,bt,Ie.commandStr);var yt="value"in Ve?Ve.value:1,Me=!!Ve.invert;return D.command(typeof yt=="number"&&yt>=0&&yt<=1,"sample.coverage.value must be a number between 0 and 1",Ie.commandStr),[yt,Me]},function(Ve,yt,Me){D.optional(function(){Ve.assert(yt,Me+"&&typeof "+Me+'==="object"',"invalid sample.coverage")});var _t=yt.def('"value" in ',Me,"?+",Me,".value:1"),hr=yt.def("!!",Me,".invert");return[_t,hr]})}}),qt}function fs(de,Ie){var rt=de.static,nr=de.dynamic,qt={};return Object.keys(rt).forEach(function(dt){var bt=rt[dt],Tt;if(typeof bt=="number"||typeof bt=="boolean")Tt=zo(function(){return bt});else if(typeof bt=="function"){var Ve=bt._reglType;Ve==="texture2d"||Ve==="textureCube"?Tt=zo(function(yt){return yt.link(bt)}):Ve==="framebuffer"||Ve==="framebufferCube"?(D.command(bt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+dt+'"',Ie.commandStr),Tt=zo(function(yt){return yt.link(bt.color[0])})):D.commandRaise('invalid data for uniform "'+dt+'"',Ie.commandStr)}else oo(bt)?Tt=zo(function(yt){var Me=yt.global.def("[",Mi(bt.length,function(_t){return D.command(typeof bt[_t]=="number"||typeof bt[_t]=="boolean","invalid uniform "+dt,yt.commandStr),bt[_t]}),"]");return Me}):D.commandRaise('invalid or missing data for uniform "'+dt+'"',Ie.commandStr);Tt.value=bt,qt[dt]=Tt}),Object.keys(nr).forEach(function(dt){var bt=nr[dt];qt[dt]=Au(bt,function(Tt,Ve){return Tt.invoke(Ve,bt)})}),qt}function Yi(de,Ie){var rt=de.static,nr=de.dynamic,qt={};return Object.keys(rt).forEach(function(dt){var bt=rt[dt],Tt=ce.id(dt),Ve=new jt;if(_h(bt))Ve.state=Qr,Ve.buffer=Ar.getBuffer(Ar.create(bt,mh,!1,!0)),Ve.type=0;else{var yt=Ar.getBuffer(bt);if(yt)Ve.state=Qr,Ve.buffer=yt,Ve.type=0;else if(D.command(typeof bt=="object"&&bt,"invalid data for attribute "+dt,Ie.commandStr),"constant"in bt){var Me=bt.constant;Ve.buffer="null",Ve.state=_n,typeof Me=="number"?Ve.x=Me:(D.command(oo(Me)&&Me.length>0&&Me.length<=4,"invalid constant for attribute "+dt,Ie.commandStr),wr.forEach(function(Zn,Dn){Dn<Me.length&&(Ve[Zn]=Me[Dn])}))}else{_h(bt.buffer)?yt=Ar.getBuffer(Ar.create(bt.buffer,mh,!1,!0)):yt=Ar.getBuffer(bt.buffer),D.command(!!yt,'missing buffer for attribute "'+dt+'"',Ie.commandStr);var _t=bt.offset|0;D.command(_t>=0,'invalid offset for attribute "'+dt+'"',Ie.commandStr);var hr=bt.stride|0;D.command(hr>=0&&hr<256,'invalid stride for attribute "'+dt+'", must be integer betweeen [0, 255]',Ie.commandStr);var mr=bt.size|0;D.command(!("size"in bt)||mr>0&&mr<=4,'invalid size for attribute "'+dt+'", must be 1,2,3,4',Ie.commandStr);var zr=!!bt.normalized,kr=0;"type"in bt&&(D.commandParameter(bt.type,ys,"invalid type for attribute "+dt,Ie.commandStr),kr=ys[bt.type]);var Xr=bt.divisor|0;"divisor"in bt&&(D.command(Xr===0||en,'cannot specify divisor for attribute "'+dt+'", instancing not supported',Ie.commandStr),D.command(Xr>=0,'invalid divisor for attribute "'+dt+'"',Ie.commandStr)),D.optional(function(){var Zn=Ie.commandStr,Dn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(bt).forEach(function(zn){D.command(Dn.indexOf(zn)>=0,'unknown parameter "'+zn+'" for attribute pointer "'+dt+'" (valid parameters are '+Dn+")",Zn)})}),Ve.buffer=yt,Ve.state=Qr,Ve.size=mr,Ve.normalized=zr,Ve.type=kr||yt.dtype,Ve.offset=_t,Ve.stride=hr,Ve.divisor=Xr}}qt[dt]=zo(function(Zn,Dn){var zn=Zn.attribCache;if(Tt in zn)return zn[Tt];var fi={isStream:!1};return Object.keys(Ve).forEach(function(yi){fi[yi]=Ve[yi]}),Ve.buffer&&(fi.buffer=Zn.link(Ve.buffer),fi.type=fi.type||fi.buffer+".dtype"),zn[Tt]=fi,fi})}),Object.keys(nr).forEach(function(dt){var bt=nr[dt];function Tt(Ve,yt){var Me=Ve.invoke(yt,bt),_t=Ve.shared,hr=Ve.constants,mr=_t.isBufferArgs,zr=_t.buffer;D.optional(function(){Ve.assert(yt,Me+"&&(typeof "+Me+'==="object"||typeof '+Me+'==="function")&&('+mr+"("+Me+")||"+zr+".getBuffer("+Me+")||"+zr+".getBuffer("+Me+".buffer)||"+mr+"("+Me+'.buffer)||("constant" in '+Me+"&&(typeof "+Me+'.constant==="number"||'+_t.isArrayLike+"("+Me+".constant))))",'invalid dynamic attribute "'+dt+'"')});var kr={isStream:yt.def(!1)},Xr=new jt;Xr.state=Qr,Object.keys(Xr).forEach(function(fi){kr[fi]=yt.def(""+Xr[fi])});var Zn=kr.buffer,Dn=kr.type;yt("if(",mr,"(",Me,")){",kr.isStream,"=true;",Zn,"=",zr,".createStream(",mh,",",Me,");",Dn,"=",Zn,".dtype;","}else{",Zn,"=",zr,".getBuffer(",Me,");","if(",Zn,"){",Dn,"=",Zn,".dtype;",'}else if("constant" in ',Me,"){",kr.state,"=",_n,";","if(typeof "+Me+'.constant === "number"){',kr[wr[0]],"=",Me,".constant;",wr.slice(1).map(function(fi){return kr[fi]}).join("="),"=0;","}else{",wr.map(function(fi,yi){return kr[fi]+"="+Me+".constant.length>"+yi+"?"+Me+".constant["+yi+"]:0;"}).join(""),"}}else{","if(",mr,"(",Me,".buffer)){",Zn,"=",zr,".createStream(",mh,",",Me,".buffer);","}else{",Zn,"=",zr,".getBuffer(",Me,".buffer);","}",Dn,'="type" in ',Me,"?",hr.glTypes,"[",Me,".type]:",Zn,".dtype;",kr.normalized,"=!!",Me,".normalized;");function zn(fi){yt(kr[fi],"=",Me,".",fi,"|0;")}return zn("size"),zn("offset"),zn("stride"),zn("divisor"),yt("}}"),yt.exit("if(",kr.isStream,"){",zr,".destroyStream(",Zn,");","}"),kr}qt[dt]=Au(bt,Tt)}),qt}function To(de,Ie){var rt=de.static,nr=de.dynamic;if(Pu in rt){var qt=rt[Pu];return qt!==null&&nn.getVAO(qt)===null&&(qt=nn.createVAO(qt)),zo(function(bt){return bt.link(nn.getVAO(qt))})}else if(Pu in nr){var dt=nr[Pu];return Au(dt,function(bt,Tt){var Ve=bt.invoke(Tt,dt);return Tt.def(bt.shared.vao+".getVAO("+Ve+")")})}return null}function Ha(de){var Ie=de.static,rt=de.dynamic,nr={};return Object.keys(Ie).forEach(function(qt){var dt=Ie[qt];nr[qt]=zo(function(bt,Tt){return typeof dt=="number"||typeof dt=="boolean"?""+dt:bt.link(dt)})}),Object.keys(rt).forEach(function(qt){var dt=rt[qt];nr[qt]=Au(dt,function(bt,Tt){return bt.invoke(Tt,dt)})}),nr}function Uo(de,Ie,rt,nr,qt){var dt=de.static,bt=de.dynamic;D.optional(function(){var zn=[Us,uo,nu,qa,Da,cs,xo,jo,he,Pu].concat(Ur);function fi(yi){Object.keys(yi).forEach(function(va){D.command(zn.indexOf(va)>=0,'unknown parameter "'+va+'"',qt.commandStr)})}fi(dt),fi(bt)});var Tt=Ei(de,Ie),Ve=Cn(de,qt),yt=Ui(de,Ve,qt),Me=ca(de,qt),_t=Po(de,qt),hr=pi(de,qt,Tt);function mr(zn){var fi=yt[zn];fi&&(_t[zn]=fi)}mr(ls),mr(hn(De));var zr=Object.keys(_t).length>0,kr={framebuffer:Ve,draw:Me,shader:hr,state:_t,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(kr.profile=Xi(de,qt),kr.uniforms=fs(rt,qt),kr.drawVAO=kr.scopeVAO=To(de,qt),!kr.drawVAO&&hr.program&&!Tt&&it.angle_instanced_arrays){var Xr=!0,Zn=hr.program.attributes.map(function(zn){var fi=Ie.static[zn];return Xr=Xr&&!!fi,fi});if(Xr&&Zn.length>0){var Dn=nn.getVAO(nn.createVAO(Zn));kr.drawVAO=new Eo(null,null,null,function(zn,fi){return zn.link(Dn)}),kr.useVAO=!0}}return Tt?kr.useVAO=!0:kr.attributes=Yi(Ie,qt),kr.context=Ha(nr,qt),kr}function Vo(de,Ie,rt){var nr=de.shared,qt=nr.context,dt=de.scope();Object.keys(rt).forEach(function(bt){Ie.save(qt,"."+bt);var Tt=rt[bt];dt(qt,".",bt,"=",Tt.append(de,Ie),";")}),Ie(dt)}function fo(de,Ie,rt,nr){var qt=de.shared,dt=qt.gl,bt=qt.framebuffer,Tt;Tn&&(Tt=Ie.def(qt.extensions,".webgl_draw_buffers"));var Ve=de.constants,yt=Ve.drawBuffer,Me=Ve.backBuffer,_t;rt?_t=rt.append(de,Ie):_t=Ie.def(bt,".next"),nr||Ie("if(",_t,"!==",bt,".cur){"),Ie("if(",_t,"){",dt,".bindFramebuffer(",ef,",",_t,".framebuffer);"),Tn&&Ie(Tt,".drawBuffersWEBGL(",yt,"[",_t,".colorAttachments.length]);"),Ie("}else{",dt,".bindFramebuffer(",ef,",null);"),Tn&&Ie(Tt,".drawBuffersWEBGL(",Me,");"),Ie("}",bt,".cur=",_t,";"),nr||Ie("}")}function qo(de,Ie,rt){var nr=de.shared,qt=nr.gl,dt=de.current,bt=de.next,Tt=nr.current,Ve=nr.next,yt=de.cond(Tt,".dirty");Ur.forEach(function(Me){var _t=hn(Me);if(!(_t in rt.state)){var hr,mr;if(_t in bt){hr=bt[_t],mr=dt[_t];var zr=Mi(Er[_t].length,function(Xr){return yt.def(hr,"[",Xr,"]")});yt(de.cond(zr.map(function(Xr,Zn){return Xr+"!=="+mr+"["+Zn+"]"}).join("||")).then(qt,".",Lr[_t],"(",zr,");",zr.map(function(Xr,Zn){return mr+"["+Zn+"]="+Xr}).join(";"),";"))}else{hr=yt.def(Ve,".",_t);var kr=de.cond(hr,"!==",Tt,".",_t);yt(kr),_t in cn?kr(de.cond(hr).then(qt,".enable(",cn[_t],");").else(qt,".disable(",cn[_t],");"),Tt,".",_t,"=",hr,";"):kr(qt,".",Lr[_t],"(",hr,");",Tt,".",_t,"=",hr,";")}}}),Object.keys(rt.state).length===0&&yt(Tt,".dirty=false;"),Ie(yt)}function Os(de,Ie,rt,nr){var qt=de.shared,dt=de.current,bt=qt.current,Tt=qt.gl;Pp(Object.keys(rt)).forEach(function(Ve){var yt=rt[Ve];if(!(nr&&!nr(yt))){var Me=yt.append(de,Ie);if(cn[Ve]){var _t=cn[Ve];Es(yt)?Me?Ie(Tt,".enable(",_t,");"):Ie(Tt,".disable(",_t,");"):Ie(de.cond(Me).then(Tt,".enable(",_t,");").else(Tt,".disable(",_t,");")),Ie(bt,".",Ve,"=",Me,";")}else if(oo(Me)){var hr=dt[Ve];Ie(Tt,".",Lr[Ve],"(",Me,");",Me.map(function(mr,zr){return hr+"["+zr+"]="+mr}).join(";"),";")}else Ie(Tt,".",Lr[Ve],"(",Me,");",bt,".",Ve,"=",Me,";")}})}function Ho(de,Ie){en&&(de.instancing=Ie.def(de.shared.extensions,".angle_instanced_arrays"))}function Gi(de,Ie,rt,nr,qt){var dt=de.shared,bt=de.stats,Tt=dt.current,Ve=dt.timer,yt=rt.profile;function Me(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var _t,hr;function mr(zn){_t=Ie.def(),zn(_t,"=",Me(),";"),typeof qt=="string"?zn(bt,".count+=",qt,";"):zn(bt,".count++;"),Yr&&(nr?(hr=Ie.def(),zn(hr,"=",Ve,".getNumPendingQueries();")):zn(Ve,".beginQuery(",bt,");"))}function zr(zn){zn(bt,".cpuTime+=",Me(),"-",_t,";"),Yr&&(nr?zn(Ve,".pushScopeStats(",hr,",",Ve,".getNumPendingQueries(),",bt,");"):zn(Ve,".endQuery();"))}function kr(zn){var fi=Ie.def(Tt,".profile");Ie(Tt,".profile=",zn,";"),Ie.exit(Tt,".profile=",fi,";")}var Xr;if(yt){if(Es(yt)){yt.enable?(mr(Ie),zr(Ie.exit),kr("true")):kr("false");return}Xr=yt.append(de,Ie),kr(Xr)}else Xr=Ie.def(Tt,".profile");var Zn=de.block();mr(Zn),Ie("if(",Xr,"){",Zn,"}");var Dn=de.block();zr(Dn),Ie.exit("if(",Xr,"){",Dn,"}")}function Ss(de,Ie,rt,nr,qt){var dt=de.shared;function bt(Ve){switch(Ve){case Cp:case Op:case ku:return 2;case gl:case Ua:case gh:return 3;case wp:case Pf:case If:return 4;default:return 1}}function Tt(Ve,yt,Me){var _t=dt.gl,hr=Ie.def(Ve,".location"),mr=Ie.def(dt.attributes,"[",hr,"]"),zr=Me.state,kr=Me.buffer,Xr=[Me.x,Me.y,Me.z,Me.w],Zn=["buffer","normalized","offset","stride"];function Dn(){Ie("if(!",mr,".buffer){",_t,".enableVertexAttribArray(",hr,");}");var fi=Me.type,yi;if(Me.size?yi=Ie.def(Me.size,"||",yt):yi=yt,Ie("if(",mr,".type!==",fi,"||",mr,".size!==",yi,"||",Zn.map(function(Wo){return mr+"."+Wo+"!=="+Me[Wo]}).join("||"),"){",_t,".bindBuffer(",mh,",",kr,".buffer);",_t,".vertexAttribPointer(",[hr,yi,fi,Me.normalized,Me.stride,Me.offset],");",mr,".type=",fi,";",mr,".size=",yi,";",Zn.map(function(Wo){return mr+"."+Wo+"="+Me[Wo]+";"}).join(""),"}"),en){var va=Me.divisor;Ie("if(",mr,".divisor!==",va,"){",de.instancing,".vertexAttribDivisorANGLE(",[hr,va],");",mr,".divisor=",va,";}")}}function zn(){Ie("if(",mr,".buffer){",_t,".disableVertexAttribArray(",hr,");",mr,".buffer=null;","}if(",wr.map(function(fi,yi){return mr+"."+fi+"!=="+Xr[yi]}).join("||"),"){",_t,".vertexAttrib4f(",hr,",",Xr,");",wr.map(function(fi,yi){return mr+"."+fi+"="+Xr[yi]+";"}).join(""),"}")}zr===Qr?Dn():zr===_n?zn():(Ie("if(",zr,"===",Qr,"){"),Dn(),Ie("}else{"),zn(),Ie("}"))}nr.forEach(function(Ve){var yt=Ve.name,Me=rt.attributes[yt],_t;if(Me){if(!qt(Me))return;_t=Me.append(de,Ie)}else{if(!qt(wv))return;var hr=de.scopeAttrib(yt);D.optional(function(){de.assert(Ie,hr+".state","missing attribute "+yt)}),_t={},Object.keys(new jt).forEach(function(mr){_t[mr]=Ie.def(hr,".",mr)})}Tt(de.link(Ve),bt(Ve.info.type),_t)})}function da(de,Ie,rt,nr,qt){for(var dt=de.shared,bt=dt.gl,Tt,Ve=0;Ve<nr.length;++Ve){var yt=nr[Ve],Me=yt.name,_t=yt.info.type,hr=rt.uniforms[Me],mr=de.link(yt),zr=mr+".location",kr;if(hr){if(!qt(hr))continue;if(Es(hr)){var Xr=hr.value;if(D.command(Xr!==null&&typeof Xr!="undefined",'missing uniform "'+Me+'"',de.commandStr),_t===kf||_t===Df){D.command(typeof Xr=="function"&&(_t===kf&&(Xr._reglType==="texture2d"||Xr._reglType==="framebuffer")||_t===Df&&(Xr._reglType==="textureCube"||Xr._reglType==="framebufferCube")),"invalid texture for uniform "+Me,de.commandStr);var Zn=de.link(Xr._texture||Xr.color[0]._texture);Ie(bt,".uniform1i(",zr,",",Zn+".bind());"),Ie.exit(Zn,".unbind();")}else if(_t===yh||_t===$h||_t===yl){D.optional(function(){D.command(oo(Xr),"invalid matrix for uniform "+Me,de.commandStr),D.command(_t===yh&&Xr.length===4||_t===$h&&Xr.length===9||_t===yl&&Xr.length===16,"invalid length for matrix uniform "+Me,de.commandStr)});var Dn=de.global.def("new Float32Array(["+Array.prototype.slice.call(Xr)+"])"),zn=2;_t===$h?zn=3:_t===yl&&(zn=4),Ie(bt,".uniformMatrix",zn,"fv(",zr,",false,",Dn,");")}else{switch(_t){case yd:D.commandType(Xr,"number","uniform "+Me,de.commandStr),Tt="1f";break;case Cp:D.command(oo(Xr)&&Xr.length===2,"uniform "+Me,de.commandStr),Tt="2f";break;case gl:D.command(oo(Xr)&&Xr.length===3,"uniform "+Me,de.commandStr),Tt="3f";break;case wp:D.command(oo(Xr)&&Xr.length===4,"uniform "+Me,de.commandStr),Tt="4f";break;case Yl:D.commandType(Xr,"boolean","uniform "+Me,de.commandStr),Tt="1i";break;case Mf:D.commandType(Xr,"number","uniform "+Me,de.commandStr),Tt="1i";break;case ku:D.command(oo(Xr)&&Xr.length===2,"uniform "+Me,de.commandStr),Tt="2i";break;case Op:D.command(oo(Xr)&&Xr.length===2,"uniform "+Me,de.commandStr),Tt="2i";break;case gh:D.command(oo(Xr)&&Xr.length===3,"uniform "+Me,de.commandStr),Tt="3i";break;case Ua:D.command(oo(Xr)&&Xr.length===3,"uniform "+Me,de.commandStr),Tt="3i";break;case If:D.command(oo(Xr)&&Xr.length===4,"uniform "+Me,de.commandStr),Tt="4i";break;case Pf:D.command(oo(Xr)&&Xr.length===4,"uniform "+Me,de.commandStr),Tt="4i";break}Ie(bt,".uniform",Tt,"(",zr,",",oo(Xr)?Array.prototype.slice.call(Xr):Xr,");")}continue}else kr=hr.append(de,Ie)}else{if(!qt(wv))continue;kr=Ie.def(dt.uniforms,"[",ce.id(Me),"]")}_t===kf?Ie("if(",kr,"&&",kr,'._reglType==="framebuffer"){',kr,"=",kr,".color[0];","}"):_t===Df&&Ie("if(",kr,"&&",kr,'._reglType==="framebufferCube"){',kr,"=",kr,".color[0];","}"),D.optional(function(){function bl(mc,Ip){de.assert(Ie,mc,'bad data or missing for uniform "'+Me+'".  '+Ip)}function Td(mc){bl("typeof "+kr+'==="'+mc+'"',"invalid type, expected "+mc)}function tl(mc,Ip){bl(dt.isArrayLike+"("+kr+")&&"+kr+".length==="+mc,"invalid vector, should have length "+mc,de.commandStr)}function Dv(mc){bl("typeof "+kr+'==="function"&&'+kr+'._reglType==="texture'+(mc===Ap?"2d":"Cube")+'"',"invalid texture type",de.commandStr)}switch(_t){case Mf:Td("number");break;case Op:tl(2,"number");break;case Ua:tl(3,"number");break;case Pf:tl(4,"number");break;case yd:Td("number");break;case Cp:tl(2,"number");break;case gl:tl(3,"number");break;case wp:tl(4,"number");break;case Yl:Td("boolean");break;case ku:tl(2,"boolean");break;case gh:tl(3,"boolean");break;case If:tl(4,"boolean");break;case yh:tl(4,"number");break;case $h:tl(9,"number");break;case yl:tl(16,"number");break;case kf:Dv(Ap);break;case Df:Dv(jm);break}});var fi=1;switch(_t){case kf:case Df:var yi=Ie.def(kr,"._texture");Ie(bt,".uniform1i(",zr,",",yi,".bind());"),Ie.exit(yi,".unbind();");continue;case Mf:case Yl:Tt="1i";break;case Op:case ku:Tt="2i",fi=2;break;case Ua:case gh:Tt="3i",fi=3;break;case Pf:case If:Tt="4i",fi=4;break;case yd:Tt="1f";break;case Cp:Tt="2f",fi=2;break;case gl:Tt="3f",fi=3;break;case wp:Tt="4f",fi=4;break;case yh:Tt="Matrix2fv";break;case $h:Tt="Matrix3fv";break;case yl:Tt="Matrix4fv";break}if(Ie(bt,".uniform",Tt,"(",zr,","),Tt.charAt(0)==="M"){var va=Math.pow(_t-yh+2,2),Wo=de.global.def("new Float32Array(",va,")");Ie("false,(Array.isArray(",kr,")||",kr," instanceof Float32Array)?",kr,":(",Mi(va,function(bl){return Wo+"["+bl+"]="+kr+"["+bl+"]"}),",",Wo,")")}else fi>1?Ie(Mi(fi,function(bl){return kr+"["+bl+"]"})):Ie(kr);Ie(");")}}function di(de,Ie,rt,nr){var qt=de.shared,dt=qt.gl,bt=qt.draw,Tt=nr.draw;function Ve(){var yi=Tt.elements,va,Wo=Ie;return yi?((yi.contextDep&&nr.contextDynamic||yi.propDep)&&(Wo=rt),va=yi.append(de,Wo)):va=Wo.def(bt,".",qa),va&&Wo("if("+va+")"+dt+".bindBuffer("+gd+","+va+".buffer.buffer);"),va}function yt(){var yi=Tt.count,va,Wo=Ie;return yi?((yi.contextDep&&nr.contextDynamic||yi.propDep)&&(Wo=rt),va=yi.append(de,Wo),D.optional(function(){yi.MISSING&&de.assert(Ie,"false","missing vertex count"),yi.DYNAMIC&&de.assert(Wo,va+">=0","missing vertex count")})):(va=Wo.def(bt,".",xo),D.optional(function(){de.assert(Wo,va+">=0","missing vertex count")})),va}var Me=Ve();function _t(yi){var va=Tt[yi];return va?va.contextDep&&nr.contextDynamic||va.propDep?va.append(de,rt):va.append(de,Ie):Ie.def(bt,".",yi)}var hr=_t(Da),mr=_t(cs),zr=yt();if(typeof zr=="number"){if(zr===0)return}else rt("if(",zr,"){"),rt.exit("}");var kr,Xr;en&&(kr=_t(jo),Xr=de.instancing);var Zn=Me+".type",Dn=Tt.elements&&Es(Tt.elements);function zn(){function yi(){rt(Xr,".drawElementsInstancedANGLE(",[hr,zr,Zn,mr+"<<(("+Zn+"-"+$r+")>>1)",kr],");")}function va(){rt(Xr,".drawArraysInstancedANGLE(",[hr,mr,zr,kr],");")}Me?Dn?yi():(rt("if(",Me,"){"),yi(),rt("}else{"),va(),rt("}")):va()}function fi(){function yi(){rt(dt+".drawElements("+[hr,zr,Zn,mr+"<<(("+Zn+"-"+$r+")>>1)"]+");")}function va(){rt(dt+".drawArrays("+[hr,mr,zr]+");")}Me?Dn?yi():(rt("if(",Me,"){"),yi(),rt("}else{"),va(),rt("}")):va()}en&&(typeof kr!="number"||kr>=0)?typeof kr=="string"?(rt("if(",kr,">0){"),zn(),rt("}else if(",kr,"<0){"),fi(),rt("}")):zn():fi()}function Di(de,Ie,rt,nr,qt){var dt=ii(),bt=dt.proc("body",qt);return D.optional(function(){dt.commandStr=Ie.commandStr,dt.command=dt.link(Ie.commandStr)}),en&&(dt.instancing=bt.def(dt.shared.extensions,".angle_instanced_arrays")),de(dt,bt,rt,nr),dt.compile().body}function ua(de,Ie,rt,nr){Ho(de,Ie),rt.useVAO?rt.drawVAO?Ie(de.shared.vao,".setVAO(",rt.drawVAO.append(de,Ie),");"):Ie(de.shared.vao,".setVAO(",de.shared.vao,".targetVAO);"):(Ie(de.shared.vao,".setVAO(null);"),Ss(de,Ie,rt,nr.attributes,function(){return!0})),da(de,Ie,rt,nr.uniforms,function(){return!0}),di(de,Ie,Ie,rt)}function hs(de,Ie){var rt=de.proc("draw",1);Ho(de,rt),Vo(de,rt,Ie.context),fo(de,rt,Ie.framebuffer),qo(de,rt,Ie),Os(de,rt,Ie.state),Gi(de,rt,Ie,!1,!0);var nr=Ie.shader.progVar.append(de,rt);if(rt(de.shared.gl,".useProgram(",nr,".program);"),Ie.shader.program)ua(de,rt,Ie,Ie.shader.program);else{rt(de.shared.vao,".setVAO(null);");var qt=de.global.def("{}"),dt=rt.def(nr,".id"),bt=rt.def(qt,"[",dt,"]");rt(de.cond(bt).then(bt,".call(this,a0);").else(bt,"=",qt,"[",dt,"]=",de.link(function(Tt){return Di(ua,de,Ie,Tt,1)}),"(",nr,");",bt,".call(this,a0);"))}Object.keys(Ie.state).length>0&&rt(de.shared.current,".dirty=true;")}function iu(de,Ie,rt,nr){de.batchId="a1",Ho(de,Ie);function qt(){return!0}Ss(de,Ie,rt,nr.attributes,qt),da(de,Ie,rt,nr.uniforms,qt),di(de,Ie,Ie,rt)}function Ge(de,Ie,rt,nr){Ho(de,Ie);var qt=rt.contextDep,dt=Ie.def(),bt="a0",Tt="a1",Ve=Ie.def();de.shared.props=Ve,de.batchId=dt;var yt=de.scope(),Me=de.scope();Ie(yt.entry,"for(",dt,"=0;",dt,"<",Tt,";++",dt,"){",Ve,"=",bt,"[",dt,"];",Me,"}",yt.exit);function _t(Zn){return Zn.contextDep&&qt||Zn.propDep}function hr(Zn){return!_t(Zn)}if(rt.needsContext&&Vo(de,Me,rt.context),rt.needsFramebuffer&&fo(de,Me,rt.framebuffer),Os(de,Me,rt.state,_t),rt.profile&&_t(rt.profile)&&Gi(de,Me,rt,!1,!0),nr)rt.useVAO?rt.drawVAO?_t(rt.drawVAO)?Me(de.shared.vao,".setVAO(",rt.drawVAO.append(de,Me),");"):yt(de.shared.vao,".setVAO(",rt.drawVAO.append(de,yt),");"):yt(de.shared.vao,".setVAO(",de.shared.vao,".targetVAO);"):(yt(de.shared.vao,".setVAO(null);"),Ss(de,yt,rt,nr.attributes,hr),Ss(de,Me,rt,nr.attributes,_t)),da(de,yt,rt,nr.uniforms,hr),da(de,Me,rt,nr.uniforms,_t),di(de,yt,Me,rt);else{var mr=de.global.def("{}"),zr=rt.shader.progVar.append(de,Me),kr=Me.def(zr,".id"),Xr=Me.def(mr,"[",kr,"]");Me(de.shared.gl,".useProgram(",zr,".program);","if(!",Xr,"){",Xr,"=",mr,"[",kr,"]=",de.link(function(Zn){return Di(iu,de,rt,Zn,2)}),"(",zr,");}",Xr,".call(this,a0[",dt,"],",dt,");")}}function lr(de,Ie){var rt=de.proc("batch",2);de.batchId="0",Ho(de,rt);var nr=!1,qt=!0;Object.keys(Ie.context).forEach(function(mr){nr=nr||Ie.context[mr].propDep}),nr||(Vo(de,rt,Ie.context),qt=!1);var dt=Ie.framebuffer,bt=!1;dt?(dt.propDep?nr=bt=!0:dt.contextDep&&nr&&(bt=!0),bt||fo(de,rt,dt)):fo(de,rt,null),Ie.state.viewport&&Ie.state.viewport.propDep&&(nr=!0);function Tt(mr){return mr.contextDep&&nr||mr.propDep}qo(de,rt,Ie),Os(de,rt,Ie.state,function(mr){return!Tt(mr)}),(!Ie.profile||!Tt(Ie.profile))&&Gi(de,rt,Ie,!1,"a1"),Ie.contextDep=nr,Ie.needsContext=qt,Ie.needsFramebuffer=bt;var Ve=Ie.shader.progVar;if(Ve.contextDep&&nr||Ve.propDep)Ge(de,rt,Ie,null);else{var yt=Ve.append(de,rt);if(rt(de.shared.gl,".useProgram(",yt,".program);"),Ie.shader.program)Ge(de,rt,Ie,Ie.shader.program);else{rt(de.shared.vao,".setVAO(null);");var Me=de.global.def("{}"),_t=rt.def(yt,".id"),hr=rt.def(Me,"[",_t,"]");rt(de.cond(hr).then(hr,".call(this,a0,a1);").else(hr,"=",Me,"[",_t,"]=",de.link(function(mr){return Di(Ge,de,Ie,mr,2)}),"(",yt,");",hr,".call(this,a0,a1);"))}}Object.keys(Ie.state).length>0&&rt(de.shared.current,".dirty=true;")}function Yt(de,Ie){var rt=de.proc("scope",3);de.batchId="a2";var nr=de.shared,qt=nr.current;Vo(de,rt,Ie.context),Ie.framebuffer&&Ie.framebuffer.append(de,rt),Pp(Object.keys(Ie.state)).forEach(function(bt){var Tt=Ie.state[bt],Ve=Tt.append(de,rt);oo(Ve)?Ve.forEach(function(yt,Me){rt.set(de.next[bt],"["+Me+"]",yt)}):rt.set(nr.next,"."+bt,Ve)}),Gi(de,rt,Ie,!0,!0),[qa,cs,xo,jo,Da].forEach(function(bt){var Tt=Ie.draw[bt];!Tt||rt.set(nr.draw,"."+bt,""+Tt.append(de,rt))}),Object.keys(Ie.uniforms).forEach(function(bt){rt.set(nr.uniforms,"["+ce.id(bt)+"]",Ie.uniforms[bt].append(de,rt))}),Object.keys(Ie.attributes).forEach(function(bt){var Tt=Ie.attributes[bt].append(de,rt),Ve=de.scopeAttrib(bt);Object.keys(new jt).forEach(function(yt){rt.set(Ve,"."+yt,Tt[yt])})}),Ie.scopeVAO&&rt.set(nr.vao,".targetVAO",Ie.scopeVAO.append(de,rt));function dt(bt){var Tt=Ie.shader[bt];Tt&&rt.set(nr.shader,"."+bt,Tt.append(de,rt))}dt(uo),dt(nu),Object.keys(Ie.state).length>0&&(rt(qt,".dirty=true;"),rt.exit(qt,".dirty=true;")),rt("a1(",de.shared.context,",a0,",de.batchId,");")}function En(de){if(!(typeof de!="object"||oo(de))){for(var Ie=Object.keys(de),rt=0;rt<Ie.length;++rt)if(Or.isDynamic(de[Ie[rt]]))return!0;return!1}}function Fi(de,Ie,rt){var nr=Ie.static[rt];if(!nr||!En(nr))return;var qt=de.global,dt=Object.keys(nr),bt=!1,Tt=!1,Ve=!1,yt=de.global.def("{}");dt.forEach(function(_t){var hr=nr[_t];if(Or.isDynamic(hr)){typeof hr=="function"&&(hr=nr[_t]=Or.unbox(hr));var mr=Au(hr,null);bt=bt||mr.thisDep,Ve=Ve||mr.propDep,Tt=Tt||mr.contextDep}else{switch(qt(yt,".",_t,"="),typeof hr){case"number":qt(hr);break;case"string":qt('"',hr,'"');break;case"object":Array.isArray(hr)&&qt("[",hr.join(),"]");break;default:qt(de.link(hr));break}qt(";")}});function Me(_t,hr){dt.forEach(function(mr){var zr=nr[mr];if(!!Or.isDynamic(zr)){var kr=_t.invoke(hr,zr);hr(yt,".",mr,"=",kr,";")}})}Ie.dynamic[rt]=new Or.DynamicVariable(Qi,{thisDep:bt,contextDep:Tt,propDep:Ve,ref:yt,append:Me}),delete Ie.static[rt]}function Ca(de,Ie,rt,nr,qt){var dt=ii();dt.stats=dt.link(qt),Object.keys(Ie.static).forEach(function(Tt){Fi(dt,Ie,Tt)}),_v.forEach(function(Tt){Fi(dt,de,Tt)});var bt=Uo(de,Ie,rt,nr,dt);return hs(dt,bt),Yt(dt,bt),lr(dt,bt),dt.compile()}return{next:Jn,current:Er,procs:function(){var de=ii(),Ie=de.proc("poll"),rt=de.proc("refresh"),nr=de.block();Ie(nr),rt(nr);var qt=de.shared,dt=qt.gl,bt=qt.next,Tt=qt.current;nr(Tt,".dirty=false;"),fo(de,Ie),fo(de,rt,null,!0);var Ve;en&&(Ve=de.link(en)),it.oes_vertex_array_object&&rt(de.link(it.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var yt=0;yt<tr.maxAttributes;++yt){var Me=rt.def(qt.attributes,"[",yt,"]"),_t=de.cond(Me,".buffer");_t.then(dt,".enableVertexAttribArray(",yt,");",dt,".bindBuffer(",mh,",",Me,".buffer.buffer);",dt,".vertexAttribPointer(",yt,",",Me,".size,",Me,".type,",Me,".normalized,",Me,".stride,",Me,".offset);").else(dt,".disableVertexAttribArray(",yt,");",dt,".vertexAttrib4f(",yt,",",Me,".x,",Me,".y,",Me,".z,",Me,".w);",Me,".buffer=null;"),rt(_t),en&&rt(Ve,".vertexAttribDivisorANGLE(",yt,",",Me,".divisor);")}return rt(de.shared.vao,".currentVAO=null;",de.shared.vao,".setVAO(",de.shared.vao,".targetVAO);"),Object.keys(cn).forEach(function(hr){var mr=cn[hr],zr=nr.def(bt,".",hr),kr=de.block();kr("if(",zr,"){",dt,".enable(",mr,")}else{",dt,".disable(",mr,")}",Tt,".",hr,"=",zr,";"),rt(kr),Ie("if(",zr,"!==",Tt,".",hr,"){",kr,"}")}),Object.keys(Lr).forEach(function(hr){var mr=Lr[hr],zr=Er[hr],kr,Xr,Zn=de.block();if(Zn(dt,".",mr,"("),oo(zr)){var Dn=zr.length;kr=de.global.def(bt,".",hr),Xr=de.global.def(Tt,".",hr),Zn(Mi(Dn,function(zn){return kr+"["+zn+"]"}),");",Mi(Dn,function(zn){return Xr+"["+zn+"]="+kr+"["+zn+"];"}).join("")),Ie("if(",Mi(Dn,function(zn){return kr+"["+zn+"]!=="+Xr+"["+zn+"]"}).join("||"),"){",Zn,"}")}else kr=nr.def(bt,".",hr),Xr=nr.def(Tt,".",hr),Zn(kr,");",Tt,".",hr,"=",kr,";"),Ie("if(",kr,"!==",Xr,"){",Zn,"}");rt(Zn)}),de.compile()}(),compile:Ca}}function Ed(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Ov=34918,cy=34919,Wm=35007,Gm=function(ce,it){if(!it.ext_disjoint_timer_query)return null;var tr=[];function Ar(){return tr.pop()||it.ext_disjoint_timer_query.createQueryEXT()}function yr(Tn){tr.push(Tn)}var Lt=[];function Gr(Tn){var Er=Ar();it.ext_disjoint_timer_query.beginQueryEXT(Wm,Er),Lt.push(Er),xr(Lt.length-1,Lt.length,Tn)}function Jr(){it.ext_disjoint_timer_query.endQueryEXT(Wm)}function nn(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var tn=[];function an(){return tn.pop()||new nn}function yn(Tn){tn.push(Tn)}var Yr=[];function xr(Tn,Er,Jn){var Ur=an();Ur.startQueryIndex=Tn,Ur.endQueryIndex=Er,Ur.sum=0,Ur.stats=Jn,Yr.push(Ur)}var jt=[],$t=[];function en(){var Tn,Er,Jn=Lt.length;if(Jn!==0){$t.length=Math.max($t.length,Jn+1),jt.length=Math.max(jt.length,Jn+1),jt[0]=0,$t[0]=0;var Ur=0;for(Tn=0,Er=0;Er<Lt.length;++Er){var cn=Lt[Er];it.ext_disjoint_timer_query.getQueryObjectEXT(cn,cy)?(Ur+=it.ext_disjoint_timer_query.getQueryObjectEXT(cn,Ov),yr(cn)):Lt[Tn++]=cn,jt[Er+1]=Ur,$t[Er+1]=Tn}for(Lt.length=Tn,Tn=0,Er=0;Er<Yr.length;++Er){var Lr=Yr[Er],hn=Lr.startQueryIndex,Qn=Lr.endQueryIndex;Lr.sum+=jt[Qn]-jt[hn];var Ai=$t[hn],mn=$t[Qn];mn===Ai?(Lr.stats.gpuTime+=Lr.sum/1e6,yn(Lr)):(Lr.startQueryIndex=Ai,Lr.endQueryIndex=mn,Yr[Tn++]=Lr)}Yr.length=Tn}}return{beginQuery:Gr,endQuery:Jr,pushScopeStats:xr,update:en,getNumPendingQueries:function(){return Lt.length},clear:function(){tr.push.apply(tr,Lt);for(var Er=0;Er<tr.length;Er++)it.ext_disjoint_timer_query.deleteQueryEXT(tr[Er]);Lt.length=0,tr.length=0},restore:function(){Lt.length=0,tr.length=0}}},Rv=16384,Hs=256,Xm=1024,Mv=34962,Sd="webglcontextlost",Pv="webglcontextrestored",bh=1,Iv=2,fy=3;function kv(Y,ce){for(var it=0;it<Y.length;++it)if(Y[it]===ce)return it;return-1}function Ad(Y){var ce=Co(Y);if(!ce)return null;var it=ce.gl,tr=it.getContextAttributes(),Ar=it.isContextLost(),yr=yo(it,ce);if(!yr)return null;var Lt=gn(),Gr=Ed(),Jr=yr.extensions,nn=Gm(it,Jr),tn=sn(),an=it.drawingBufferWidth,yn=it.drawingBufferHeight,Yr={tick:0,time:0,viewportWidth:an,viewportHeight:yn,framebufferWidth:an,framebufferHeight:yn,drawingBufferWidth:an,drawingBufferHeight:yn,pixelRatio:ce.pixelRatio},xr={},jt={elements:null,primitive:4,count:-1,offset:0,instances:-1},$t=Dh(it,Jr),en=Bh(it,Gr,ce,Er),Tn=q(it,Jr,$t,Gr,en);function Er(di){return Tn.destroyBuffer(di)}var Jn=_p(it,Jr,en,Gr),Ur=Ue(it,Lt,Gr,ce),cn=zs(it,Jr,$t,function(){Qn.procs.poll()},Yr,Gr,ce),Lr=Ru(it,Jr,$t,Gr,ce),hn=w(it,Jr,$t,cn,Lr,Gr),Qn=qh(it,Lt,Jr,$t,en,Jn,cn,hn,xr,Tn,Ur,jt,Yr,nn,ce),Ai=Pt(it,hn,Qn.procs.poll,Yr,tr,Jr,$t),mn=Qn.next,Kr=it.canvas,Pr=[],ii=[],Xi=[],Cn=[ce.onDestroy],Ui=null;function Ei(){if(Pr.length===0){nn&&nn.update(),Ui=null;return}Ui=Nn.next(Ei),Os();for(var di=Pr.length-1;di>=0;--di){var Di=Pr[di];Di&&Di(Yr,null,0)}it.flush(),nn&&nn.update()}function pi(){!Ui&&Pr.length>0&&(Ui=Nn.next(Ei))}function ca(){Ui&&(Nn.cancel(Ei),Ui=null)}function Po(di){di.preventDefault(),Ar=!0,ca(),ii.forEach(function(Di){Di()})}function fs(di){it.getError(),Ar=!1,yr.restore(),Ur.restore(),en.restore(),cn.restore(),Lr.restore(),hn.restore(),Tn.restore(),nn&&nn.restore(),Qn.procs.refresh(),pi(),Xi.forEach(function(Di){Di()})}Kr&&(Kr.addEventListener(Sd,Po,!1),Kr.addEventListener(Pv,fs,!1));function Yi(){Pr.length=0,ca(),Kr&&(Kr.removeEventListener(Sd,Po),Kr.removeEventListener(Pv,fs)),Ur.clear(),hn.clear(),Lr.clear(),cn.clear(),Jn.clear(),en.clear(),Tn.clear(),nn&&nn.clear(),Cn.forEach(function(di){di()})}function To(di){D(!!di,"invalid args to regl({...})"),D.type(di,"object","invalid args to regl({...})");function Di(qt){var dt=H({},qt);delete dt.uniforms,delete dt.attributes,delete dt.context,delete dt.vao,"stencil"in dt&&dt.stencil.op&&(dt.stencil.opBack=dt.stencil.opFront=dt.stencil.op,delete dt.stencil.op);function bt(Tt){if(Tt in dt){var Ve=dt[Tt];delete dt[Tt],Object.keys(Ve).forEach(function(yt){dt[Tt+"."+yt]=Ve[yt]})}}return bt("blend"),bt("depth"),bt("cull"),bt("stencil"),bt("polygonOffset"),bt("scissor"),bt("sample"),"vao"in qt&&(dt.vao=qt.vao),dt}function ua(qt){var dt={},bt={};return Object.keys(qt).forEach(function(Tt){var Ve=qt[Tt];Or.isDynamic(Ve)?bt[Tt]=Or.unbox(Ve,Tt):dt[Tt]=Ve}),{dynamic:bt,static:dt}}var hs=ua(di.context||{}),iu=ua(di.uniforms||{}),Ge=ua(di.attributes||{}),lr=ua(Di(di)),Yt={gpuTime:0,cpuTime:0,count:0},En=Qn.compile(lr,Ge,iu,hs,Yt),Fi=En.draw,Ca=En.batch,de=En.scope,Ie=[];function rt(qt){for(;Ie.length<qt;)Ie.push(null);return Ie}function nr(qt,dt){var bt;if(Ar&&D.raise("context lost"),typeof qt=="function")return de.call(this,null,qt,0);if(typeof dt=="function")if(typeof qt=="number")for(bt=0;bt<qt;++bt)de.call(this,null,dt,bt);else if(Array.isArray(qt))for(bt=0;bt<qt.length;++bt)de.call(this,qt[bt],dt,bt);else return de.call(this,qt,dt,0);else if(typeof qt=="number"){if(qt>0)return Ca.call(this,rt(qt|0),qt|0)}else if(Array.isArray(qt)){if(qt.length)return Ca.call(this,qt,qt.length)}else return Fi.call(this,qt)}return H(nr,{stats:Yt})}var Ha=hn.setFBO=To({framebuffer:Or.define.call(null,bh,"framebuffer")});function Uo(di,Di){var ua=0;Qn.procs.poll();var hs=Di.color;hs&&(it.clearColor(+hs[0]||0,+hs[1]||0,+hs[2]||0,+hs[3]||0),ua|=Rv),"depth"in Di&&(it.clearDepth(+Di.depth),ua|=Hs),"stencil"in Di&&(it.clearStencil(Di.stencil|0),ua|=Xm),D(!!ua,"called regl.clear with no buffer specified"),it.clear(ua)}function Vo(di){if(D(typeof di=="object"&&di,"regl.clear() takes an object as input"),"framebuffer"in di)if(di.framebuffer&&di.framebuffer_reglType==="framebufferCube")for(var Di=0;Di<6;++Di)Ha(H({framebuffer:di.framebuffer.faces[Di]},di),Uo);else Ha(di,Uo);else Uo(null,di)}function fo(di){D.type(di,"function","regl.frame() callback must be a function"),Pr.push(di);function Di(){var ua=kv(Pr,di);D(ua>=0,"cannot cancel a frame twice");function hs(){var iu=kv(Pr,hs);Pr[iu]=Pr[Pr.length-1],Pr.length-=1,Pr.length<=0&&ca()}Pr[ua]=hs}return pi(),{cancel:Di}}function qo(){var di=mn.viewport,Di=mn.scissor_box;di[0]=di[1]=Di[0]=Di[1]=0,Yr.viewportWidth=Yr.framebufferWidth=Yr.drawingBufferWidth=di[2]=Di[2]=it.drawingBufferWidth,Yr.viewportHeight=Yr.framebufferHeight=Yr.drawingBufferHeight=di[3]=Di[3]=it.drawingBufferHeight}function Os(){Yr.tick+=1,Yr.time=Gi(),qo(),Qn.procs.poll()}function Ho(){qo(),Qn.procs.refresh(),nn&&nn.update()}function Gi(){return(sn()-tn)/1e3}Ho();function Ss(di,Di){D.type(Di,"function","listener callback must be a function");var ua;switch(di){case"frame":return fo(Di);case"lost":ua=ii;break;case"restore":ua=Xi;break;case"destroy":ua=Cn;break;default:D.raise("invalid event, must be one of frame,lost,restore,destroy")}return ua.push(Di),{cancel:function(){for(var iu=0;iu<ua.length;++iu)if(ua[iu]===Di){ua[iu]=ua[ua.length-1],ua.pop();return}}}}var da=H(To,{clear:Vo,prop:Or.define.bind(null,bh),context:Or.define.bind(null,Iv),this:Or.define.bind(null,fy),draw:To({}),buffer:function(Di){return en.create(Di,Mv,!1,!1)},elements:function(Di){return Jn.create(Di,!1)},texture:cn.create2D,cube:cn.createCube,renderbuffer:Lr.create,framebuffer:hn.create,framebufferCube:hn.createCube,vao:Tn.createVAO,attributes:tr,frame:fo,on:Ss,limits:$t,hasExtension:function(Di){return $t.extensions.indexOf(Di.toLowerCase())>=0},read:Ai,destroy:Yi,_gl:it,_refresh:Ho,poll:function(){Os(),nn&&nn.update()},now:Gi,stats:Gr});return ce.onDone(null,da),da}return Ad})},fo6e:function(Qe,Q){var O=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function j(H){return O.test(H)}Qe.exports=j},g4R6:function(Qe,Q){function O(j,H,X){return j===j&&(X!==void 0&&(j=j<=X?j:X),H!==void 0&&(j=j>=H?j:H)),j}Qe.exports=O},gFfm:function(Qe,Q){function O(j,H){for(var X=-1,N=j==null?0:j.length;++X<N&&H(j[X],X,j)!==!1;);return j}Qe.exports=O},gzZq:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingToSyntax=void 0;var j=O("MON2"),H=O("FV85"),X=O("D9lx"),N=O("LKzl"),v=function(){function z(W){this._binding=W}return z.prototype.to=function(W){return this._binding.type=H.BindingTypeEnum.Instance,this._binding.implementationType=W,new X.BindingInWhenOnSyntax(this._binding)},z.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+j.INVALID_TO_SELF_VALUE);var W=this._binding.serviceIdentifier;return this.to(W)},z.prototype.toConstantValue=function(W){return this._binding.type=H.BindingTypeEnum.ConstantValue,this._binding.cache=W,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=H.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},z.prototype.toDynamicValue=function(W){return this._binding.type=H.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=W,this._binding.implementationType=null,new X.BindingInWhenOnSyntax(this._binding)},z.prototype.toConstructor=function(W){return this._binding.type=H.BindingTypeEnum.Constructor,this._binding.implementationType=W,this._binding.scope=H.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},z.prototype.toFactory=function(W){return this._binding.type=H.BindingTypeEnum.Factory,this._binding.factory=W,this._binding.scope=H.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},z.prototype.toFunction=function(W){if(typeof W!="function")throw new Error(j.INVALID_FUNCTION_BINDING);var Pe=this.toConstantValue(W);return this._binding.type=H.BindingTypeEnum.Function,this._binding.scope=H.BindingScopeEnum.Singleton,Pe},z.prototype.toAutoFactory=function(W){return this._binding.type=H.BindingTypeEnum.Factory,this._binding.factory=function(Pe){var se=function(){return Pe.container.get(W)};return se},this._binding.scope=H.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},z.prototype.toProvider=function(W){return this._binding.type=H.BindingTypeEnum.Provider,this._binding.provider=W,this._binding.scope=H.BindingScopeEnum.Singleton,new N.BindingWhenOnSyntax(this._binding)},z.prototype.toService=function(W){this.toDynamicValue(function(Pe){return Pe.container.get(W)})},z}();Q.BindingToSyntax=v},h7MG:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getBindingDictionary=Q.createMockRequest=Q.plan=void 0;var j=O("doU7"),H=O("MON2"),X=O("FV85"),N=O("xfSm"),v=O("qK8v"),z=O("ujMp"),W=O("oy+k"),Pe=O("GXnB"),se=O("yMAV"),ve=O("fbrv"),ue=O("xiII"),gt=O("dX1H");function Ne(Je){return Je._bindingDictionary}Q.getBindingDictionary=Ne;function st(Je,Xe,jr,Dr,Jt,Be){var Nt=Je?N.MULTI_INJECT_TAG:N.INJECT_TAG,Gt=new Pe.Metadata(Nt,jr),Te=new gt.Target(Xe,Dr,jr,Gt);if(Jt!==void 0){var me=new Pe.Metadata(Jt,Be);Te.metadata.push(me)}return Te}function Dt(Je,Xe,jr,Dr,Jt){var Be=Ct(jr.container,Jt.serviceIdentifier),Nt=[];return Be.length===j.BindingCount.NoBindingsAvailable&&jr.container.options.autoBindInjectable&&typeof Jt.serviceIdentifier=="function"&&Je.getConstructorMetadata(Jt.serviceIdentifier).compilerGeneratedMetadata&&(jr.container.bind(Jt.serviceIdentifier).toSelf(),Be=Ct(jr.container,Jt.serviceIdentifier)),Xe?Nt=Be:Nt=Be.filter(function(Gt){var Te=new ue.Request(Gt.serviceIdentifier,jr,Dr,Gt,Jt);return Gt.constraint(Te)}),pt(Jt.serviceIdentifier,Nt,Jt,jr.container),Nt}function pt(Je,Xe,jr,Dr){switch(Xe.length){case j.BindingCount.NoBindingsAvailable:if(jr.isOptional())return Xe;var Jt=z.getServiceIdentifierAsString(Je),Be=H.NOT_REGISTERED;throw Be+=z.listMetadataForTarget(Jt,jr),Be+=z.listRegisteredBindingsForServiceIdentifier(Dr,Jt,Ct),new Error(Be);case j.BindingCount.OnlyOneBindingAvailable:if(!jr.isArray())return Xe;case j.BindingCount.MultipleBindingsAvailable:default:if(jr.isArray())return Xe;var Jt=z.getServiceIdentifierAsString(Je),Be=H.AMBIGUOUS_MATCH+" "+Jt;throw Be+=z.listRegisteredBindingsForServiceIdentifier(Dr,Jt,Ct),new Error(Be)}}function $e(Je,Xe,jr,Dr,Jt,Be){var Nt,Gt;if(Jt===null){Nt=Dt(Je,Xe,Dr,null,Be),Gt=new ue.Request(jr,Dr,null,Nt,Be);var Te=new se.Plan(Dr,Gt);Dr.addPlan(Te)}else Nt=Dt(Je,Xe,Dr,Jt,Be),Gt=Jt.addChildRequest(Be.serviceIdentifier,Nt,Be);Nt.forEach(function(me){var Re=null;if(Be.isArray())Re=Gt.addChildRequest(me.serviceIdentifier,me,Be);else{if(me.cache)return;Re=Gt}if(me.type===X.BindingTypeEnum.Instance&&me.implementationType!==null){var Ut=ve.getDependencies(Je,me.implementationType);if(!Dr.container.options.skipBaseClassChecks){var ae=ve.getBaseClassDependencyCount(Je,me.implementationType);if(Ut.length<ae){var Ce=H.ARGUMENTS_LENGTH_MISMATCH(ve.getFunctionName(me.implementationType));throw new Error(Ce)}}Ut.forEach(function(Ae){$e(Je,!1,Ae.serviceIdentifier,Dr,Re,Ae)})}})}function Ct(Je,Xe){var jr=[],Dr=Ne(Je);return Dr.hasKey(Xe)?jr=Dr.get(Xe):Je.parent!==null&&(jr=Ct(Je.parent,Xe)),jr}function et(Je,Xe,jr,Dr,Jt,Be,Nt,Gt){Gt===void 0&&(Gt=!1);var Te=new W.Context(Xe),me=st(jr,Dr,Jt,"",Be,Nt);try{return $e(Je,Gt,Jt,Te,null,me),Te}catch(Re){throw v.isStackOverflowExeption(Re)&&Te.plan&&z.circularDependencyToException(Te.plan.rootRequest),Re}}Q.plan=et;function kt(Je,Xe,jr,Dr){var Jt=new gt.Target(X.TargetTypeEnum.Variable,"",Xe,new Pe.Metadata(jr,Dr)),Be=new W.Context(Je),Nt=new ue.Request(Xe,Be,null,[],Jt);return Nt}Q.createMockRequest=kt},hzCD:function(Qe,Q,O){var j=O("EA7m"),H=O("0Q2g"),X=j(H);Qe.exports=X},iegG:function(Qe,Q){function O(H){var X=H.target||H.srcElement;X.__resizeRAF__&&cancelAnimationFrame(X.__resizeRAF__),X.__resizeRAF__=requestAnimationFrame(function(){var N=X.__resizeTrigger__,v=N&&N.__resizeListeners__;v&&v.forEach(function(z){z.call(N,H)})})}var j=function(X,N){var v=this,z=v.document,W,Pe=z.attachEvent;typeof navigator!="undefined"&&(W=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function se(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",O)}if(!X.__resizeListeners__)if(X.__resizeListeners__=[],Pe)X.__resizeTrigger__=X,X.attachEvent("onresize",O);else{getComputedStyle(X).position==="static"&&(X.style.position="relative");var ve=X.__resizeTrigger__=z.createElement("object");ve.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ve.setAttribute("class","resize-sensor"),ve.setAttribute("tabindex","-1"),ve.setAttribute("title",""),ve.__resizeElement__=X,ve.onload=se,ve.type="text/html",W&&X.appendChild(ve),ve.data="about:blank",W||X.appendChild(ve)}X.__resizeListeners__.push(N)};Qe.exports=typeof window=="undefined"?j:j.bind(window),Qe.exports.unbind=function(H,X){var N=document.attachEvent,v=H.__resizeListeners__||[];if(X){var z=v.indexOf(X);z!==-1&&v.splice(z,1)}else v=H.__resizeListeners__=[];if(!v.length){if(N)H.detachEvent("onresize",O);else if(H.__resizeTrigger__){var W=H.__resizeTrigger__.contentDocument,Pe=W&&W.defaultView;Pe&&(Pe.removeEventListener("resize",O),delete Pe.__resizeTrigger__),H.__resizeTrigger__=!H.removeChild(H.__resizeTrigger__)}delete H.__resizeListeners__}}},"iz+Y":function(Qe,Q,O){Qe.exports={miniChart:"miniChart___27WlV",chartContent:"chartContent___2FNqq",chartLoading:"chartLoading___2DxhP"}},"jIg/":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiInject=void 0;var j=O("xfSm"),H=O("GXnB"),X=O("Ztfv");function N(v){return function(z,W,Pe){var se=new H.Metadata(j.MULTI_INJECT_TAG,v);typeof Pe=="number"?X.tagParameter(z,W,Pe,se):X.tagProperty(z,W,se)}}Q.multiInject=N},jYx5:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.optional=void 0;var j=O("xfSm"),H=O("GXnB"),X=O("Ztfv");function N(){return function(v,z,W){var Pe=new H.Metadata(j.OPTIONAL_TAG,!0);typeof W=="number"?X.tagParameter(v,z,W,Pe):X.tagProperty(v,z,Pe)}}Q.optional=N},"jbM+":function(Qe,Q,O){var j=O("R/W3");function H(X,N){var v=X==null?0:X.length;return!!v&&j(X,N,0)>-1}Qe.exports=H},mNvP:function(Qe,Q,O){(function(j,H){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var X;(function(N){(function(v){var z=typeof H=="object"?H:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),W=Pe(N);typeof z.Reflect=="undefined"?z.Reflect=N:W=Pe(z.Reflect,W),v(W);function Pe(se,ve){return function(ue,gt){typeof se[ue]!="function"&&Object.defineProperty(se,ue,{configurable:!0,writable:!0,value:gt}),ve&&ve(ue,gt)}}})(function(v){var z=Object.prototype.hasOwnProperty,W=typeof Symbol=="function",Pe=W&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",se=W&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ve=typeof Object.create=="function",ue={__proto__:[]}instanceof Array,gt=!ve&&!ue,Ne={create:ve?function(){return ur(Object.create(null))}:ue?function(){return ur({__proto__:null})}:function(){return ur({})},has:gt?function(tt,It){return z.call(tt,It)}:function(tt,It){return It in tt},get:gt?function(tt,It){return z.call(tt,It)?tt[It]:void 0}:function(tt,It){return tt[It]}},st=Object.getPrototypeOf(Function),Dt=typeof j=="object"&&j["env"]&&j["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",pt=!Dt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:He(),$e=!Dt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:xt(),Ct=!Dt&&typeof WeakMap=="function"?WeakMap:er(),et=new Ct;function kt(tt,It,or,Cr){if(Tr(or)){if(!Sr(tt))throw new TypeError;if(!Kt(It))throw new TypeError;return me(tt,It)}else{if(!Sr(tt))throw new TypeError;if(!Fr(It))throw new TypeError;if(!Fr(Cr)&&!Tr(Cr)&&!Br(Cr))throw new TypeError;return Br(Cr)&&(Cr=void 0),or=ci(or),Re(tt,It,or,Cr)}}v("decorate",kt);function Je(tt,It){function or(Cr,Or){if(!Fr(Cr))throw new TypeError;if(!Tr(Or)&&!Wt(Or))throw new TypeError;At(tt,It,Cr,Or)}return or}v("metadata",Je);function Xe(tt,It,or,Cr){if(!Fr(or))throw new TypeError;return Tr(Cr)||(Cr=ci(Cr)),At(tt,It,or,Cr)}v("defineMetadata",Xe);function jr(tt,It,or){if(!Fr(It))throw new TypeError;return Tr(or)||(or=ci(or)),ae(tt,It,or)}v("hasMetadata",jr);function Dr(tt,It,or){if(!Fr(It))throw new TypeError;return Tr(or)||(or=ci(or)),Ce(tt,It,or)}v("hasOwnMetadata",Dr);function Jt(tt,It,or){if(!Fr(It))throw new TypeError;return Tr(or)||(or=ci(or)),Ae(tt,It,or)}v("getMetadata",Jt);function Be(tt,It,or){if(!Fr(It))throw new TypeError;return Tr(or)||(or=ci(or)),vt(tt,It,or)}v("getOwnMetadata",Be);function Nt(tt,It){if(!Fr(tt))throw new TypeError;return Tr(It)||(It=ci(It)),Bt(tt,It)}v("getMetadataKeys",Nt);function Gt(tt,It){if(!Fr(tt))throw new TypeError;return Tr(It)||(It=ci(It)),Ft(tt,It)}v("getOwnMetadataKeys",Gt);function Te(tt,It,or){if(!Fr(It))throw new TypeError;Tr(or)||(or=ci(or));var Cr=Ut(It,or,!1);if(Tr(Cr)||!Cr.delete(tt))return!1;if(Cr.size>0)return!0;var Or=et.get(It);return Or.delete(or),Or.size>0||et.delete(It),!0}v("deleteMetadata",Te);function me(tt,It){for(var or=tt.length-1;or>=0;--or){var Cr=tt[or],Or=Cr(It);if(!Tr(Or)&&!Br(Or)){if(!Kt(Or))throw new TypeError;It=Or}}return It}function Re(tt,It,or,Cr){for(var Or=tt.length-1;Or>=0;--Or){var Nn=tt[Or],sn=Nn(It,or,Cr);if(!Tr(sn)&&!Br(sn)){if(!Fr(sn))throw new TypeError;Cr=sn}}return Cr}function Ut(tt,It,or){var Cr=et.get(tt);if(Tr(Cr)){if(!or)return;Cr=new pt,et.set(tt,Cr)}var Or=Cr.get(It);if(Tr(Or)){if(!or)return;Or=new pt,Cr.set(It,Or)}return Or}function ae(tt,It,or){var Cr=Ce(tt,It,or);if(Cr)return!0;var Or=Ee(It);return Br(Or)?!1:ae(tt,Or,or)}function Ce(tt,It,or){var Cr=Ut(It,or,!1);return Tr(Cr)?!1:Yn(Cr.has(tt))}function Ae(tt,It,or){var Cr=Ce(tt,It,or);if(Cr)return vt(tt,It,or);var Or=Ee(It);if(!Br(Or))return Ae(tt,Or,or)}function vt(tt,It,or){var Cr=Ut(It,or,!1);if(!Tr(Cr))return Cr.get(tt)}function At(tt,It,or,Cr){var Or=Ut(or,Cr,!0);Or.set(tt,It)}function Bt(tt,It){var or=Ft(tt,It),Cr=Ee(tt);if(Cr===null)return or;var Or=Bt(Cr,It);if(Or.length<=0)return or;if(or.length<=0)return Or;for(var Nn=new $e,sn=[],gn=0,dn=or;gn<dn.length;gn++){var ri=dn[gn],mi=Nn.has(ri);mi||(Nn.add(ri),sn.push(ri))}for(var ki=0,Aa=Or;ki<Aa.length;ki++){var ri=Aa[ki],mi=Nn.has(ri);mi||(Nn.add(ri),sn.push(ri))}return sn}function Ft(tt,It){var or=[],Cr=Ut(tt,It,!1);if(Tr(Cr))return or;for(var Or=Cr.keys(),Nn=je(Or),sn=0;;){var gn=ne(Nn);if(!gn)return or.length=sn,or;var dn=oe(gn);try{or[sn]=dn}catch(ri){try{D(Nn)}finally{throw ri}}sn++}}function fr(tt){if(tt===null)return 1;switch(typeof tt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return tt===null?1:6;default:return 6}}function Tr(tt){return tt===void 0}function Br(tt){return tt===null}function On(tt){return typeof tt=="symbol"}function Fr(tt){return typeof tt=="object"?tt!==null:typeof tt=="function"}function Hn(tt,It){switch(fr(tt)){case 0:return tt;case 1:return tt;case 2:return tt;case 3:return tt;case 4:return tt;case 5:return tt}var or=It===3?"string":It===5?"number":"default",Cr=Ir(tt,Pe);if(Cr!==void 0){var Or=Cr.call(tt,or);if(Fr(Or))throw new TypeError;return Or}return ni(tt,or==="default"?"number":or)}function ni(tt,It){if(It==="string"){var or=tt.toString;if(_r(or)){var Cr=or.call(tt);if(!Fr(Cr))return Cr}var Or=tt.valueOf;if(_r(Or)){var Cr=Or.call(tt);if(!Fr(Cr))return Cr}}else{var Or=tt.valueOf;if(_r(Or)){var Cr=Or.call(tt);if(!Fr(Cr))return Cr}var Nn=tt.toString;if(_r(Nn)){var Cr=Nn.call(tt);if(!Fr(Cr))return Cr}}throw new TypeError}function Yn(tt){return!!tt}function ei(tt){return""+tt}function ci(tt){var It=Hn(tt,3);return On(It)?It:ei(It)}function Sr(tt){return Array.isArray?Array.isArray(tt):tt instanceof Object?tt instanceof Array:Object.prototype.toString.call(tt)==="[object Array]"}function _r(tt){return typeof tt=="function"}function Kt(tt){return typeof tt=="function"}function Wt(tt){switch(fr(tt)){case 3:return!0;case 4:return!0;default:return!1}}function Ir(tt,It){var or=tt[It];if(or!=null){if(!_r(or))throw new TypeError;return or}}function je(tt){var It=Ir(tt,se);if(!_r(It))throw new TypeError;var or=It.call(tt);if(!Fr(or))throw new TypeError;return or}function oe(tt){return tt.value}function ne(tt){var It=tt.next();return It.done?!1:It}function D(tt){var It=tt.return;It&&It.call(tt)}function Ee(tt){var It=Object.getPrototypeOf(tt);if(typeof tt!="function"||tt===st||It!==st)return It;var or=tt.prototype,Cr=or&&Object.getPrototypeOf(or);if(Cr==null||Cr===Object.prototype)return It;var Or=Cr.constructor;return typeof Or!="function"||Or===tt?It:Or}function He(){var tt={},It=[],or=function(){function sn(gn,dn,ri){this._index=0,this._keys=gn,this._values=dn,this._selector=ri}return sn.prototype["@@iterator"]=function(){return this},sn.prototype[se]=function(){return this},sn.prototype.next=function(){var gn=this._index;if(gn>=0&&gn<this._keys.length){var dn=this._selector(this._keys[gn],this._values[gn]);return gn+1>=this._keys.length?(this._index=-1,this._keys=It,this._values=It):this._index++,{value:dn,done:!1}}return{value:void 0,done:!0}},sn.prototype.throw=function(gn){throw this._index>=0&&(this._index=-1,this._keys=It,this._values=It),gn},sn.prototype.return=function(gn){return this._index>=0&&(this._index=-1,this._keys=It,this._values=It),{value:gn,done:!0}},sn}();return function(){function sn(){this._keys=[],this._values=[],this._cacheKey=tt,this._cacheIndex=-2}return Object.defineProperty(sn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),sn.prototype.has=function(gn){return this._find(gn,!1)>=0},sn.prototype.get=function(gn){var dn=this._find(gn,!1);return dn>=0?this._values[dn]:void 0},sn.prototype.set=function(gn,dn){var ri=this._find(gn,!0);return this._values[ri]=dn,this},sn.prototype.delete=function(gn){var dn=this._find(gn,!1);if(dn>=0){for(var ri=this._keys.length,mi=dn+1;mi<ri;mi++)this._keys[mi-1]=this._keys[mi],this._values[mi-1]=this._values[mi];return this._keys.length--,this._values.length--,gn===this._cacheKey&&(this._cacheKey=tt,this._cacheIndex=-2),!0}return!1},sn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=tt,this._cacheIndex=-2},sn.prototype.keys=function(){return new or(this._keys,this._values,Cr)},sn.prototype.values=function(){return new or(this._keys,this._values,Or)},sn.prototype.entries=function(){return new or(this._keys,this._values,Nn)},sn.prototype["@@iterator"]=function(){return this.entries()},sn.prototype[se]=function(){return this.entries()},sn.prototype._find=function(gn,dn){return this._cacheKey!==gn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=gn)),this._cacheIndex<0&&dn&&(this._cacheIndex=this._keys.length,this._keys.push(gn),this._values.push(void 0)),this._cacheIndex},sn}();function Cr(sn,gn){return sn}function Or(sn,gn){return gn}function Nn(sn,gn){return[sn,gn]}}function xt(){return function(){function tt(){this._map=new pt}return Object.defineProperty(tt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),tt.prototype.has=function(It){return this._map.has(It)},tt.prototype.add=function(It){return this._map.set(It,It),this},tt.prototype.delete=function(It){return this._map.delete(It)},tt.prototype.clear=function(){this._map.clear()},tt.prototype.keys=function(){return this._map.keys()},tt.prototype.values=function(){return this._map.values()},tt.prototype.entries=function(){return this._map.entries()},tt.prototype["@@iterator"]=function(){return this.keys()},tt.prototype[se]=function(){return this.keys()},tt}()}function er(){var tt=16,It=Ne.create(),or=Cr();return function(){function dn(){this._key=Cr()}return dn.prototype.has=function(ri){var mi=Or(ri,!1);return mi!==void 0?Ne.has(mi,this._key):!1},dn.prototype.get=function(ri){var mi=Or(ri,!1);return mi!==void 0?Ne.get(mi,this._key):void 0},dn.prototype.set=function(ri,mi){var ki=Or(ri,!0);return ki[this._key]=mi,this},dn.prototype.delete=function(ri){var mi=Or(ri,!1);return mi!==void 0?delete mi[this._key]:!1},dn.prototype.clear=function(){this._key=Cr()},dn}();function Cr(){var dn;do dn="@@WeakMap@@"+gn();while(Ne.has(It,dn));return It[dn]=!0,dn}function Or(dn,ri){if(!z.call(dn,or)){if(!ri)return;Object.defineProperty(dn,or,{value:Ne.create()})}return dn[or]}function Nn(dn,ri){for(var mi=0;mi<ri;++mi)dn[mi]=Math.random()*255|0;return dn}function sn(dn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(dn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(dn)):Nn(new Uint8Array(dn),dn):Nn(new Array(dn),dn)}function gn(){var dn=sn(tt);dn[6]=dn[6]&79|64,dn[8]=dn[8]&191|128;for(var ri="",mi=0;mi<tt;++mi){var ki=dn[mi];(mi===4||mi===6||mi===8)&&(ri+="-"),ki<16&&(ri+="0"),ri+=ki.toString(16).toLowerCase()}return ri}}function ur(tt){return tt.__=void 0,delete tt.__,tt}})})(X||(X={}))}).call(this,O("Q2Ig"),O("IyRk"))},mpbz:function(Qe,Q,O){(function(j,H){Qe.exports=H()})(this,function(){"use strict";function j(Jt,Be,Nt,Gt,Te,me){if(!(Te-Gt<=Nt)){var Re=Gt+Te>>1;H(Jt,Be,Re,Gt,Te,me%2),j(Jt,Be,Nt,Gt,Re-1,me+1),j(Jt,Be,Nt,Re+1,Te,me+1)}}function H(Jt,Be,Nt,Gt,Te,me){for(;Te>Gt;){if(Te-Gt>600){var Re=Te-Gt+1,Ut=Nt-Gt+1,ae=Math.log(Re),Ce=.5*Math.exp(2*ae/3),Ae=.5*Math.sqrt(ae*Ce*(Re-Ce)/Re)*(Ut-Re/2<0?-1:1),vt=Math.max(Gt,Math.floor(Nt-Ut*Ce/Re+Ae)),At=Math.min(Te,Math.floor(Nt+(Re-Ut)*Ce/Re+Ae));H(Jt,Be,Nt,vt,At,me)}var Bt=Be[2*Nt+me],Ft=Gt,fr=Te;for(X(Jt,Be,Gt,Nt),Be[2*Te+me]>Bt&&X(Jt,Be,Gt,Te);Ft<fr;){for(X(Jt,Be,Ft,fr),Ft++,fr--;Be[2*Ft+me]<Bt;)Ft++;for(;Be[2*fr+me]>Bt;)fr--}Be[2*Gt+me]===Bt?X(Jt,Be,Gt,fr):(fr++,X(Jt,Be,fr,Te)),fr<=Nt&&(Gt=fr+1),Nt<=fr&&(Te=fr-1)}}function X(Jt,Be,Nt,Gt){N(Jt,Nt,Gt),N(Be,2*Nt,2*Gt),N(Be,2*Nt+1,2*Gt+1)}function N(Jt,Be,Nt){var Gt=Jt[Be];Jt[Be]=Jt[Nt],Jt[Nt]=Gt}function v(Jt,Be,Nt,Gt,Te,me,Re){for(var Ut=[0,Jt.length-1,0],ae=[],Ce,Ae;Ut.length;){var vt=Ut.pop(),At=Ut.pop(),Bt=Ut.pop();if(At-Bt<=Re){for(var Ft=Bt;Ft<=At;Ft++)Ce=Be[2*Ft],Ae=Be[2*Ft+1],Ce>=Nt&&Ce<=Te&&Ae>=Gt&&Ae<=me&&ae.push(Jt[Ft]);continue}var fr=Math.floor((Bt+At)/2);Ce=Be[2*fr],Ae=Be[2*fr+1],Ce>=Nt&&Ce<=Te&&Ae>=Gt&&Ae<=me&&ae.push(Jt[fr]);var Tr=(vt+1)%2;(vt===0?Nt<=Ce:Gt<=Ae)&&(Ut.push(Bt),Ut.push(fr-1),Ut.push(Tr)),(vt===0?Te>=Ce:me>=Ae)&&(Ut.push(fr+1),Ut.push(At),Ut.push(Tr))}return ae}function z(Jt,Be,Nt,Gt,Te,me){for(var Re=[0,Jt.length-1,0],Ut=[],ae=Te*Te;Re.length;){var Ce=Re.pop(),Ae=Re.pop(),vt=Re.pop();if(Ae-vt<=me){for(var At=vt;At<=Ae;At++)W(Be[2*At],Be[2*At+1],Nt,Gt)<=ae&&Ut.push(Jt[At]);continue}var Bt=Math.floor((vt+Ae)/2),Ft=Be[2*Bt],fr=Be[2*Bt+1];W(Ft,fr,Nt,Gt)<=ae&&Ut.push(Jt[Bt]);var Tr=(Ce+1)%2;(Ce===0?Nt-Te<=Ft:Gt-Te<=fr)&&(Re.push(vt),Re.push(Bt-1),Re.push(Tr)),(Ce===0?Nt+Te>=Ft:Gt+Te>=fr)&&(Re.push(Bt+1),Re.push(Ae),Re.push(Tr))}return Ut}function W(Jt,Be,Nt,Gt){var Te=Jt-Nt,me=Be-Gt;return Te*Te+me*me}var Pe=function(Be){return Be[0]},se=function(Be){return Be[1]},ve=function(Be,Nt,Gt,Te,me){Nt===void 0&&(Nt=Pe),Gt===void 0&&(Gt=se),Te===void 0&&(Te=64),me===void 0&&(me=Float64Array),this.nodeSize=Te,this.points=Be;for(var Re=Be.length<65536?Uint16Array:Uint32Array,Ut=this.ids=new Re(Be.length),ae=this.coords=new me(Be.length*2),Ce=0;Ce<Be.length;Ce++)Ut[Ce]=Ce,ae[2*Ce]=Nt(Be[Ce]),ae[2*Ce+1]=Gt(Be[Ce]);j(Ut,ae,Te,0,Ut.length-1,0)};ve.prototype.range=function(Be,Nt,Gt,Te){return v(this.ids,this.coords,Be,Nt,Gt,Te,this.nodeSize)},ve.prototype.within=function(Be,Nt,Gt){return z(this.ids,this.coords,Be,Nt,Gt,this.nodeSize)};var ue={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Be){return Be}},gt=Math.fround||function(Jt){return function(Be){return Jt[0]=+Be,Jt[0]}}(new Float32Array(1)),Ne=function(Be){this.options=Xe(Object.create(ue),Be),this.trees=new Array(this.options.maxZoom+1)};Ne.prototype.load=function(Be){var Nt=this.options,Gt=Nt.log,Te=Nt.minZoom,me=Nt.maxZoom,Re=Nt.nodeSize;Gt&&console.time("total time");var Ut="prepare "+Be.length+" points";Gt&&console.time(Ut),this.points=Be;for(var ae=[],Ce=0;Ce<Be.length;Ce++)!Be[Ce].geometry||ae.push(Dt(Be[Ce],Ce));this.trees[me+1]=new ve(ae,jr,Dr,Re,Float32Array),Gt&&console.timeEnd(Ut);for(var Ae=me;Ae>=Te;Ae--){var vt=+Date.now();ae=this._cluster(ae,Ae),this.trees[Ae]=new ve(ae,jr,Dr,Re,Float32Array),Gt&&console.log("z%d: %d clusters in %dms",Ae,ae.length,+Date.now()-vt)}return Gt&&console.timeEnd("total time"),this},Ne.prototype.getClusters=function(Be,Nt){var Gt=((Be[0]+180)%360+360)%360-180,Te=Math.max(-90,Math.min(90,Be[1])),me=Be[2]===180?180:((Be[2]+180)%360+360)%360-180,Re=Math.max(-90,Math.min(90,Be[3]));if(Be[2]-Be[0]>=360)Gt=-180,me=180;else if(Gt>me){var Ut=this.getClusters([Gt,Te,180,Re],Nt),ae=this.getClusters([-180,Te,me,Re],Nt);return Ut.concat(ae)}for(var Ce=this.trees[this._limitZoom(Nt)],Ae=Ce.range(Ct(Gt),et(Re),Ct(me),et(Te)),vt=[],At=0,Bt=Ae;At<Bt.length;At+=1){var Ft=Bt[At],fr=Ce.points[Ft];vt.push(fr.numPoints?pt(fr):this.points[fr.index])}return vt},Ne.prototype.getChildren=function(Be){var Nt=this._getOriginId(Be),Gt=this._getOriginZoom(Be),Te="No cluster with the specified id.",me=this.trees[Gt];if(!me)throw new Error(Te);var Re=me.points[Nt];if(!Re)throw new Error(Te);for(var Ut=this.options.radius/(this.options.extent*Math.pow(2,Gt-1)),ae=me.within(Re.x,Re.y,Ut),Ce=[],Ae=0,vt=ae;Ae<vt.length;Ae+=1){var At=vt[Ae],Bt=me.points[At];Bt.parentId===Be&&Ce.push(Bt.numPoints?pt(Bt):this.points[Bt.index])}if(Ce.length===0)throw new Error(Te);return Ce},Ne.prototype.getLeaves=function(Be,Nt,Gt){Nt=Nt||10,Gt=Gt||0;var Te=[];return this._appendLeaves(Te,Be,Nt,Gt,0),Te},Ne.prototype.getTile=function(Be,Nt,Gt){var Te=this.trees[this._limitZoom(Be)],me=Math.pow(2,Be),Re=this.options,Ut=Re.extent,ae=Re.radius,Ce=ae/Ut,Ae=(Gt-Ce)/me,vt=(Gt+1+Ce)/me,At={features:[]};return this._addTileFeatures(Te.range((Nt-Ce)/me,Ae,(Nt+1+Ce)/me,vt),Te.points,Nt,Gt,me,At),Nt===0&&this._addTileFeatures(Te.range(1-Ce/me,Ae,1,vt),Te.points,me,Gt,me,At),Nt===me-1&&this._addTileFeatures(Te.range(0,Ae,Ce/me,vt),Te.points,-1,Gt,me,At),At.features.length?At:null},Ne.prototype.getClusterExpansionZoom=function(Be){for(var Nt=this._getOriginZoom(Be)-1;Nt<=this.options.maxZoom;){var Gt=this.getChildren(Be);if(Nt++,Gt.length!==1)break;Be=Gt[0].properties.cluster_id}return Nt},Ne.prototype._appendLeaves=function(Be,Nt,Gt,Te,me){for(var Re=this.getChildren(Nt),Ut=0,ae=Re;Ut<ae.length;Ut+=1){var Ce=ae[Ut],Ae=Ce.properties;if(Ae&&Ae.cluster?me+Ae.point_count<=Te?me+=Ae.point_count:me=this._appendLeaves(Be,Ae.cluster_id,Gt,Te,me):me<Te?me++:Be.push(Ce),Be.length===Gt)break}return me},Ne.prototype._addTileFeatures=function(Be,Nt,Gt,Te,me,Re){for(var Ut=0,ae=Be;Ut<ae.length;Ut+=1){var Ce=ae[Ut],Ae=Nt[Ce],vt=Ae.numPoints,At=void 0,Bt=void 0,Ft=void 0;if(vt)At=$e(Ae),Bt=Ae.x,Ft=Ae.y;else{var fr=this.points[Ae.index];At=fr.properties,Bt=Ct(fr.geometry.coordinates[0]),Ft=et(fr.geometry.coordinates[1])}var Tr={type:1,geometry:[[Math.round(this.options.extent*(Bt*me-Gt)),Math.round(this.options.extent*(Ft*me-Te))]],tags:At},Br=void 0;vt?Br=Ae.id:this.options.generateId?Br=Ae.index:this.points[Ae.index].id&&(Br=this.points[Ae.index].id),Br!==void 0&&(Tr.id=Br),Re.features.push(Tr)}},Ne.prototype._limitZoom=function(Be){return Math.max(this.options.minZoom,Math.min(Math.floor(+Be),this.options.maxZoom+1))},Ne.prototype._cluster=function(Be,Nt){for(var Gt=[],Te=this.options,me=Te.radius,Re=Te.extent,Ut=Te.reduce,ae=Te.minPoints,Ce=me/(Re*Math.pow(2,Nt)),Ae=0;Ae<Be.length;Ae++){var vt=Be[Ae];if(!(vt.zoom<=Nt)){vt.zoom=Nt;for(var At=this.trees[Nt+1],Bt=At.within(vt.x,vt.y,Ce),Ft=vt.numPoints||1,fr=Ft,Tr=0,Br=Bt;Tr<Br.length;Tr+=1){var On=Br[Tr],Fr=At.points[On];Fr.zoom>Nt&&(fr+=Fr.numPoints||1)}if(fr>Ft&&fr>=ae){for(var Hn=vt.x*Ft,ni=vt.y*Ft,Yn=Ut&&Ft>1?this._map(vt,!0):null,ei=(Ae<<5)+(Nt+1)+this.points.length,ci=0,Sr=Bt;ci<Sr.length;ci+=1){var _r=Sr[ci],Kt=At.points[_r];if(!(Kt.zoom<=Nt)){Kt.zoom=Nt;var Wt=Kt.numPoints||1;Hn+=Kt.x*Wt,ni+=Kt.y*Wt,Kt.parentId=ei,Ut&&(Yn||(Yn=this._map(vt,!0)),Ut(Yn,this._map(Kt)))}}vt.parentId=ei,Gt.push(st(Hn/fr,ni/fr,ei,fr,Yn))}else if(Gt.push(vt),fr>1)for(var Ir=0,je=Bt;Ir<je.length;Ir+=1){var oe=je[Ir],ne=At.points[oe];ne.zoom<=Nt||(ne.zoom=Nt,Gt.push(ne))}}}return Gt},Ne.prototype._getOriginId=function(Be){return Be-this.points.length>>5},Ne.prototype._getOriginZoom=function(Be){return(Be-this.points.length)%32},Ne.prototype._map=function(Be,Nt){if(Be.numPoints)return Nt?Xe({},Be.properties):Be.properties;var Gt=this.points[Be.index].properties,Te=this.options.map(Gt);return Nt&&Te===Gt?Xe({},Te):Te};function st(Jt,Be,Nt,Gt,Te){return{x:gt(Jt),y:gt(Be),zoom:Infinity,id:Nt,parentId:-1,numPoints:Gt,properties:Te}}function Dt(Jt,Be){var Nt=Jt.geometry.coordinates,Gt=Nt[0],Te=Nt[1];return{x:gt(Ct(Gt)),y:gt(et(Te)),zoom:Infinity,index:Be,parentId:-1}}function pt(Jt){return{type:"Feature",id:Jt.id,properties:$e(Jt),geometry:{type:"Point",coordinates:[kt(Jt.x),Je(Jt.y)]}}}function $e(Jt){var Be=Jt.numPoints,Nt=Be>=1e4?Math.round(Be/1e3)+"k":Be>=1e3?Math.round(Be/100)/10+"k":Be;return Xe(Xe({},Jt.properties),{cluster:!0,cluster_id:Jt.id,point_count:Be,point_count_abbreviated:Nt})}function Ct(Jt){return Jt/360+.5}function et(Jt){var Be=Math.sin(Jt*Math.PI/180),Nt=.5-.25*Math.log((1+Be)/(1-Be))/Math.PI;return Nt<0?0:Nt>1?1:Nt}function kt(Jt){return(Jt-.5)*360}function Je(Jt){var Be=(180-Jt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Be))/Math.PI-90}function Xe(Jt,Be){for(var Nt in Be)Jt[Nt]=Be[Nt];return Jt}function jr(Jt){return Jt.x}function Dr(Jt){return Jt.y}return Ne})},mwIZ:function(Qe,Q,O){var j=O("ZWtO");function H(X,N,v){var z=X==null?void 0:j(X,N);return z===void 0?v:z}Qe.exports=H},n2J3:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.unmanaged=void 0;var j=O("xfSm"),H=O("GXnB"),X=O("Ztfv");function N(){return function(v,z,W){var Pe=new H.Metadata(j.UNMANAGED_TAG,!0);X.tagParameter(v,z,W,Pe)}}Q.unmanaged=N},"oCl/":function(Qe,Q,O){var j=O("CH3K"),H=O("LcsW"),X=O("MvSz"),N=O("0ycA"),v=Object.getOwnPropertySymbols,z=v?function(W){for(var Pe=[];W;)j(Pe,X(W)),W=H(W);return Pe}:N;Qe.exports=z},oIFs:function(Qe,Q,O){},oaX6:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.targetName=void 0;var j=O("xfSm"),H=O("GXnB"),X=O("Ztfv");function N(v){return function(z,W,Pe){var se=new H.Metadata(j.NAME_TAG,v);X.tagParameter(z,W,Pe,se)}}Q.targetName=N},"otv/":function(Qe,Q,O){var j=O("nmnc"),H=j?j.prototype:void 0,X=H?H.valueOf:void 0;function N(v){return X?Object(X.call(v)):{}}Qe.exports=N},"oy+k":function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Context=void 0;var j=O("d9O0"),H=function(){function X(N){this.id=j.id(),this.container=N}return X.prototype.addPlan=function(N){this.plan=N},X.prototype.setCurrentRequest=function(N){this.currentRequest=N},X}();Q.Context=H},q4HE:function(Qe,Q){var O="\\ud800-\\udfff",j="\\u0300-\\u036f",H="\\ufe20-\\ufe2f",X="\\u20d0-\\u20ff",N=j+H+X,v="\\ufe0e\\ufe0f",z="["+O+"]",W="["+N+"]",Pe="\\ud83c[\\udffb-\\udfff]",se="(?:"+W+"|"+Pe+")",ve="[^"+O+"]",ue="(?:\\ud83c[\\udde6-\\uddff]){2}",gt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ne="\\u200d",st=se+"?",Dt="["+v+"]?",pt="(?:"+Ne+"(?:"+[ve,ue,gt].join("|")+")"+Dt+st+")*",$e=Dt+st+pt,Ct="(?:"+[ve+W+"?",W,ue,gt,z].join("|")+")",et=RegExp(Pe+"(?="+Pe+")|"+Ct+$e,"g");function kt(Je){for(var Xe=et.lastIndex=0;et.test(Je);)++Xe;return Xe}Qe.exports=kt},qK8v:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.isStackOverflowExeption=void 0;var j=O("MON2");function H(X){return X instanceof RangeError||X.message===j.STACK_OVERFLOW}Q.isStackOverflowExeption=H},qRkn:function(Qe,Q,O){var j=O("3cYt"),H={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},X=j(H);Qe.exports=X},rxlC:function(Qe,Q,O){"use strict";Qe.exports=H,Qe.exports.default=H;var j=1e20;function H(W,Pe,se,ve,ue,gt){this.fontSize=W||24,this.buffer=Pe===void 0?3:Pe,this.cutoff=ve||.25,this.fontFamily=ue||"sans-serif",this.fontWeight=gt||"normal",this.radius=se||8;var Ne=this.size=this.fontSize+this.buffer*2,st=Ne+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ne,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(st*st),this.gridInner=new Float64Array(st*st),this.f=new Float64Array(st),this.z=new Float64Array(st+1),this.v=new Uint16Array(st),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ne/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function X(W,Pe,se,ve,ue,gt,Ne){gt.fill(j,0,Pe*se),Ne.fill(0,0,Pe*se);for(var st=(Pe-ve)/2,Dt=0;Dt<ue;Dt++)for(var pt=0;pt<ve;pt++){var $e=(Dt+st)*Pe+pt+st,Ct=W.data[4*(Dt*ve+pt)+3]/255;if(Ct===1)gt[$e]=0,Ne[$e]=j;else if(Ct===0)gt[$e]=j,Ne[$e]=0;else{var et=Math.max(0,.5-Ct),kt=Math.max(0,Ct-.5);gt[$e]=et*et,Ne[$e]=kt*kt}}}function N(W,Pe,se,ve,ue,gt,Ne){for(var st=0;st<Pe*se;st++){var Dt=Math.sqrt(ve[st])-Math.sqrt(ue[st]);W[st]=Math.round(255-255*(Dt/gt+Ne))}}H.prototype._draw=function(W,Pe){var se=this.ctx.measureText(W),ve=se.width,ue=2*this.buffer,gt,Ne,st,Dt,pt,$e,Ct,et;Pe&&this.useMetrics?(pt=Math.floor(se.actualBoundingBoxAscent),et=this.buffer+Math.ceil(se.actualBoundingBoxAscent),$e=this.buffer,Ct=this.buffer,Ne=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Dt=Math.min(this.size-$e,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),gt=Ne+ue,st=Dt+ue,this.ctx.textBaseline="alphabetic"):(gt=Ne=this.size,st=Dt=this.size,pt=19*this.fontSize/24,$e=Ct=0,et=this.middle,this.ctx.textBaseline="middle");var kt;Ne&&Dt&&(this.ctx.clearRect(Ct,$e,Ne,Dt),this.ctx.fillText(W,this.buffer,et),kt=this.ctx.getImageData(Ct,$e,Ne,Dt));var Je=new Uint8ClampedArray(gt*st);return X(kt,gt,st,Ne,Dt,this.gridOuter,this.gridInner),v(this.gridOuter,gt,st,this.f,this.v,this.z),v(this.gridInner,gt,st,this.f,this.v,this.z),N(Je,gt,st,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Je,metrics:{width:Ne,height:Dt,sdfWidth:gt,sdfHeight:st,top:pt,left:0,advance:ve}}},H.prototype.draw=function(W){return this._draw(W,!1).data},H.prototype.drawWithMetrics=function(W){return this._draw(W,!0)};function v(W,Pe,se,ve,ue,gt){for(var Ne=0;Ne<Pe;Ne++)z(W,Ne,Pe,se,ve,ue,gt);for(var st=0;st<se;st++)z(W,st*Pe,1,Pe,ve,ue,gt)}function z(W,Pe,se,ve,ue,gt,Ne){var st,Dt,pt,$e;for(gt[0]=0,Ne[0]=-j,Ne[1]=j,st=0;st<ve;st++)ue[st]=W[Pe+st*se];for(st=1,Dt=0,pt=0;st<ve;st++){do $e=gt[Dt],pt=(ue[st]-ue[$e]+st*st-$e*$e)/(st-$e)/2;while(pt<=Ne[Dt]&&--Dt>-1);Dt++,gt[Dt]=st,Ne[Dt]=pt,Ne[Dt+1]=j}for(st=0,Dt=0;st<ve;st++){for(;Ne[Dt+1]<st;)Dt++;$e=gt[Dt],W[Pe+st*se]=ue[$e]+(st-$e)*(st-$e)}}},sGsY:function(Qe,Q,O){"use strict";var j=O("rePB"),H=O("wx14"),X=O("q1tI"),N=O("TSYQ"),v=O.n(N),z=O("H84U"),W=O("/ezw"),Pe=O("B6l+"),se=O.n(Pe),ve=function(Ut){var ae=Ut.value,Ce=Ut.formatter,Ae=Ut.precision,vt=Ut.decimalSeparator,At=Ut.groupSeparator,Bt=At===void 0?"":At,Ft=Ut.prefixCls,fr;if(typeof Ce=="function")fr=Ce(ae);else{var Tr=String(ae),Br=Tr.match(/^(-?)(\d*)(\.(\d+))?$/);if(!Br||Tr==="-")fr=Tr;else{var On=Br[1],Fr=Br[2]||"0",Hn=Br[4]||"";Fr=Fr.replace(/\B(?=(\d{3})+(?!\d))/g,Bt),typeof Ae=="number"&&(Hn=se()(Hn,Ae,"0").slice(0,Ae)),Hn&&(Hn="".concat(vt).concat(Hn)),fr=[X.createElement("span",{key:"int",className:"".concat(Ft,"-content-value-int")},On,Fr),Hn&&X.createElement("span",{key:"decimal",className:"".concat(Ft,"-content-value-decimal")},Hn)]}}return X.createElement("span",{className:"".concat(Ft,"-content-value")},fr)},ue=ve,gt=function(Ut){var ae=Ut.prefixCls,Ce=Ut.className,Ae=Ut.style,vt=Ut.valueStyle,At=Ut.value,Bt=At===void 0?0:At,Ft=Ut.title,fr=Ut.valueRender,Tr=Ut.prefix,Br=Ut.suffix,On=Ut.loading,Fr=Ut.direction,Hn=Ut.onMouseEnter,ni=Ut.onMouseLeave,Yn=X.createElement(ue,Object(H.a)({},Ut,{value:Bt})),ei=v()(ae,Object(j.a)({},"".concat(ae,"-rtl"),Fr==="rtl"),Ce);return X.createElement("div",{className:ei,style:Ae,onMouseEnter:Hn,onMouseLeave:ni},Ft&&X.createElement("div",{className:"".concat(ae,"-title")},Ft),X.createElement(W.a,{paragraph:!1,loading:On},X.createElement("div",{style:vt,className:"".concat(ae,"-content")},Tr&&X.createElement("span",{className:"".concat(ae,"-content-prefix")},Tr),fr?fr(Yn):Yn,Br&&X.createElement("span",{className:"".concat(ae,"-content-suffix")},Br))))};gt.defaultProps={decimalSeparator:".",groupSeparator:",",loading:!1};var Ne=Object(z.c)({prefixCls:"statistic"})(gt),st=Ne,Dt=O("1OyB"),pt=O("vuIU"),$e=O("Ji7U"),Ct=O("LK+K"),et=O("ODXe"),kt=O("QQZ/"),Je=O.n(kt),Xe=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function jr(Re,Ut){var ae=Re,Ce=/\[[^\]]*]/g,Ae=(Ut.match(Ce)||[]).map(function(Ft){return Ft.slice(1,-1)}),vt=Ut.replace(Ce,"[]"),At=Xe.reduce(function(Ft,fr){var Tr=Object(et.a)(fr,2),Br=Tr[0],On=Tr[1];if(Ft.indexOf(Br)!==-1){var Fr=Math.floor(ae/On);return ae-=Fr*On,Ft.replace(new RegExp("".concat(Br,"+"),"g"),function(Hn){var ni=Hn.length;return Je()(Fr.toString(),ni,"0")})}return Ft},vt),Bt=0;return At.replace(Ce,function(){var Ft=Ae[Bt];return Bt+=1,Ft})}function Dr(Re,Ut){var ae=Ut.format,Ce=ae===void 0?"":ae,Ae=new Date(Re).getTime(),vt=Date.now(),At=Math.max(Ae-vt,0);return jr(At,Ce)}var Jt=O("0n0R"),Be=1e3/30;function Nt(Re){return new Date(Re).getTime()}var Gt=function(Re){Object($e.a)(ae,Re);var Ut=Object(Ct.a)(ae);function ae(){var Ce;return Object(Dt.a)(this,ae),Ce=Ut.apply(this,arguments),Ce.syncTimer=function(){var Ae=Ce.props.value,vt=Nt(Ae);vt>=Date.now()?Ce.startTimer():Ce.stopTimer()},Ce.startTimer=function(){if(!Ce.countdownId){var Ae=Ce.props,vt=Ae.onChange,At=Ae.value,Bt=Nt(At);Ce.countdownId=window.setInterval(function(){Ce.forceUpdate(),vt&&Bt>Date.now()&&vt(Bt-Date.now())},Be)}},Ce.stopTimer=function(){var Ae=Ce.props,vt=Ae.onFinish,At=Ae.value;if(Ce.countdownId){clearInterval(Ce.countdownId),Ce.countdownId=void 0;var Bt=Nt(At);vt&&Bt<Date.now()&&vt()}},Ce.formatCountdown=function(Ae,vt){var At=Ce.props.format;return Dr(Ae,Object(H.a)(Object(H.a)({},vt),{format:At}))},Ce.valueRender=function(Ae){return Object(Jt.a)(Ae,{title:void 0})},Ce}return Object(pt.a)(ae,[{key:"componentDidMount",value:function(){this.syncTimer()}},{key:"componentDidUpdate",value:function(){this.syncTimer()}},{key:"componentWillUnmount",value:function(){this.stopTimer()}},{key:"render",value:function(){return X.createElement(st,Object(H.a)({valueRender:this.valueRender},this.props,{formatter:this.formatCountdown}))}}]),ae}(X.Component);Gt.defaultProps={format:"HH:mm:ss"};var Te=Gt;st.Countdown=Te;var me=Q.a=st},sKgW:function(Qe,Q){var O=9007199254740991,j=Math.floor;function H(X,N){var v="";if(!X||N<1||N>O)return v;do N%2&&(v+=X),N=j(N/2),N&&(X+=X);while(N);return v}Qe.exports=H},sXyB:function(Qe,Q,O){var j=O("SksO"),H=O("b48C");function X(N,v,z){return H()?(Qe.exports=X=Reflect.construct.bind(),Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports):(Qe.exports=X=function(Pe,se,ve){var ue=[null];ue.push.apply(ue,se);var gt=Function.bind.apply(Pe,ue),Ne=new gt;return ve&&j(Ne,ve.prototype),Ne},Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports),X.apply(null,arguments)}Qe.exports=X,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},sgoq:function(Qe,Q,O){var j=O("asDA"),H=O("TKrE"),X=O("6nK8"),N="['\u2019]",v=RegExp(N,"g");function z(W){return function(Pe){return j(X(H(Pe).replace(v,"")),W,"")}}Qe.exports=z},u6S6:function(Qe,Q,O){var j=O("6acW"),H=O("sgoq"),X=H(function(N,v,z){return v=v.toLowerCase(),N+(z?j(v):v)});Qe.exports=X},uhBA:function(Qe,Q,O){"use strict";var j=Object.prototype.hasOwnProperty,H="~";function X(){}Object.create&&(X.prototype=Object.create(null),new X().__proto__||(H=!1));function N(Pe,se,ve){this.fn=Pe,this.context=se,this.once=ve||!1}function v(Pe,se,ve,ue,gt){if(typeof ve!="function")throw new TypeError("The listener must be a function");var Ne=new N(ve,ue||Pe,gt),st=H?H+se:se;return Pe._events[st]?Pe._events[st].fn?Pe._events[st]=[Pe._events[st],Ne]:Pe._events[st].push(Ne):(Pe._events[st]=Ne,Pe._eventsCount++),Pe}function z(Pe,se){--Pe._eventsCount==0?Pe._events=new X:delete Pe._events[se]}function W(){this._events=new X,this._eventsCount=0}W.prototype.eventNames=function(){var se=[],ve,ue;if(this._eventsCount===0)return se;for(ue in ve=this._events)j.call(ve,ue)&&se.push(H?ue.slice(1):ue);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(ve)):se},W.prototype.listeners=function(se){var ve=H?H+se:se,ue=this._events[ve];if(!ue)return[];if(ue.fn)return[ue.fn];for(var gt=0,Ne=ue.length,st=new Array(Ne);gt<Ne;gt++)st[gt]=ue[gt].fn;return st},W.prototype.listenerCount=function(se){var ve=H?H+se:se,ue=this._events[ve];return ue?ue.fn?1:ue.length:0},W.prototype.emit=function(se,ve,ue,gt,Ne,st){var Dt=H?H+se:se;if(!this._events[Dt])return!1;var pt=this._events[Dt],$e=arguments.length,Ct,et;if(pt.fn){switch(pt.once&&this.removeListener(se,pt.fn,void 0,!0),$e){case 1:return pt.fn.call(pt.context),!0;case 2:return pt.fn.call(pt.context,ve),!0;case 3:return pt.fn.call(pt.context,ve,ue),!0;case 4:return pt.fn.call(pt.context,ve,ue,gt),!0;case 5:return pt.fn.call(pt.context,ve,ue,gt,Ne),!0;case 6:return pt.fn.call(pt.context,ve,ue,gt,Ne,st),!0}for(et=1,Ct=new Array($e-1);et<$e;et++)Ct[et-1]=arguments[et];pt.fn.apply(pt.context,Ct)}else{var kt=pt.length,Je;for(et=0;et<kt;et++)switch(pt[et].once&&this.removeListener(se,pt[et].fn,void 0,!0),$e){case 1:pt[et].fn.call(pt[et].context);break;case 2:pt[et].fn.call(pt[et].context,ve);break;case 3:pt[et].fn.call(pt[et].context,ve,ue);break;case 4:pt[et].fn.call(pt[et].context,ve,ue,gt);break;default:if(!Ct)for(Je=1,Ct=new Array($e-1);Je<$e;Je++)Ct[Je-1]=arguments[Je];pt[et].fn.apply(pt[et].context,Ct)}}return!0},W.prototype.on=function(se,ve,ue){return v(this,se,ve,ue,!1)},W.prototype.once=function(se,ve,ue){return v(this,se,ve,ue,!0)},W.prototype.removeListener=function(se,ve,ue,gt){var Ne=H?H+se:se;if(!this._events[Ne])return this;if(!ve)return z(this,Ne),this;var st=this._events[Ne];if(st.fn)st.fn===ve&&(!gt||st.once)&&(!ue||st.context===ue)&&z(this,Ne);else{for(var Dt=0,pt=[],$e=st.length;Dt<$e;Dt++)(st[Dt].fn!==ve||gt&&!st[Dt].once||ue&&st[Dt].context!==ue)&&pt.push(st[Dt]);pt.length?this._events[Ne]=pt.length===1?pt[0]:pt:z(this,Ne)}return this},W.prototype.removeAllListeners=function(se){var ve;return se?(ve=H?H+se:se,this._events[ve]&&z(this,ve)):(this._events=new X,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=H,W.EventEmitter=W,Qe.exports=W},ujMp:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.circularDependencyToException=Q.listMetadataForTarget=Q.listRegisteredBindingsForServiceIdentifier=Q.getServiceIdentifierAsString=Q.getFunctionName=void 0;var j=O("MON2");function H(se){if(typeof se=="function"){var ve=se;return ve.name}else{if(typeof se=="symbol")return se.toString();var ve=se;return ve}}Q.getServiceIdentifierAsString=H;function X(se,ve,ue){var gt="",Ne=ue(se,ve);return Ne.length!==0&&(gt=`
Registered bindings:`,Ne.forEach(function(st){var Dt="Object";st.implementationType!==null&&(Dt=Pe(st.implementationType)),gt=gt+`
 `+Dt,st.constraint.metaData&&(gt=gt+" - "+st.constraint.metaData)})),gt}Q.listRegisteredBindingsForServiceIdentifier=X;function N(se,ve){return se.parentRequest===null?!1:se.parentRequest.serviceIdentifier===ve?!0:N(se.parentRequest,ve)}function v(se){function ve(gt,Ne){Ne===void 0&&(Ne=[]);var st=H(gt.serviceIdentifier);return Ne.push(st),gt.parentRequest!==null?ve(gt.parentRequest,Ne):Ne}var ue=ve(se);return ue.reverse().join(" --> ")}function z(se){se.childRequests.forEach(function(ve){if(N(ve,ve.serviceIdentifier)){var ue=v(ve);throw new Error(j.CIRCULAR_DEPENDENCY+" "+ue)}else z(ve)})}Q.circularDependencyToException=z;function W(se,ve){if(ve.isTagged()||ve.isNamed()){var ue="",gt=ve.getNamedTag(),Ne=ve.getCustomTags();return gt!==null&&(ue+=gt.toString()+`
`),Ne!==null&&Ne.forEach(function(st){ue+=st.toString()+`
`})," "+se+`
 `+se+" - "+ue}else return" "+se}Q.listMetadataForTarget=W;function Pe(se){if(se.name)return se.name;var ve=se.toString(),ue=ve.match(/^function\s*([^\s(]+)/);return ue?ue[1]:"Anonymous function: "+ve}Q.getFunctionName=Pe},"vN+2":function(Qe,Q){function O(){}Qe.exports=O},veWP:function(Qe,Q,O){"use strict";var j=Object.prototype.hasOwnProperty,H="~";function X(){}Object.create&&(X.prototype=Object.create(null),new X().__proto__||(H=!1));function N(Pe,se,ve){this.fn=Pe,this.context=se,this.once=ve||!1}function v(Pe,se,ve,ue,gt){if(typeof ve!="function")throw new TypeError("The listener must be a function");var Ne=new N(ve,ue||Pe,gt),st=H?H+se:se;return Pe._events[st]?Pe._events[st].fn?Pe._events[st]=[Pe._events[st],Ne]:Pe._events[st].push(Ne):(Pe._events[st]=Ne,Pe._eventsCount++),Pe}function z(Pe,se){--Pe._eventsCount==0?Pe._events=new X:delete Pe._events[se]}function W(){this._events=new X,this._eventsCount=0}W.prototype.eventNames=function(){var se=[],ve,ue;if(this._eventsCount===0)return se;for(ue in ve=this._events)j.call(ve,ue)&&se.push(H?ue.slice(1):ue);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(ve)):se},W.prototype.listeners=function(se){var ve=H?H+se:se,ue=this._events[ve];if(!ue)return[];if(ue.fn)return[ue.fn];for(var gt=0,Ne=ue.length,st=new Array(Ne);gt<Ne;gt++)st[gt]=ue[gt].fn;return st},W.prototype.listenerCount=function(se){var ve=H?H+se:se,ue=this._events[ve];return ue?ue.fn?1:ue.length:0},W.prototype.emit=function(se,ve,ue,gt,Ne,st){var Dt=H?H+se:se;if(!this._events[Dt])return!1;var pt=this._events[Dt],$e=arguments.length,Ct,et;if(pt.fn){switch(pt.once&&this.removeListener(se,pt.fn,void 0,!0),$e){case 1:return pt.fn.call(pt.context),!0;case 2:return pt.fn.call(pt.context,ve),!0;case 3:return pt.fn.call(pt.context,ve,ue),!0;case 4:return pt.fn.call(pt.context,ve,ue,gt),!0;case 5:return pt.fn.call(pt.context,ve,ue,gt,Ne),!0;case 6:return pt.fn.call(pt.context,ve,ue,gt,Ne,st),!0}for(et=1,Ct=new Array($e-1);et<$e;et++)Ct[et-1]=arguments[et];pt.fn.apply(pt.context,Ct)}else{var kt=pt.length,Je;for(et=0;et<kt;et++)switch(pt[et].once&&this.removeListener(se,pt[et].fn,void 0,!0),$e){case 1:pt[et].fn.call(pt[et].context);break;case 2:pt[et].fn.call(pt[et].context,ve);break;case 3:pt[et].fn.call(pt[et].context,ve,ue);break;case 4:pt[et].fn.call(pt[et].context,ve,ue,gt);break;default:if(!Ct)for(Je=1,Ct=new Array($e-1);Je<$e;Je++)Ct[Je-1]=arguments[Je];pt[et].fn.apply(pt[et].context,Ct)}}return!0},W.prototype.on=function(se,ve,ue){return v(this,se,ve,ue,!1)},W.prototype.once=function(se,ve,ue){return v(this,se,ve,ue,!0)},W.prototype.removeListener=function(se,ve,ue,gt){var Ne=H?H+se:se;if(!this._events[Ne])return this;if(!ve)return z(this,Ne),this;var st=this._events[Ne];if(st.fn)st.fn===ve&&(!gt||st.once)&&(!ue||st.context===ue)&&z(this,Ne);else{for(var Dt=0,pt=[],$e=st.length;Dt<$e;Dt++)(st[Dt].fn!==ve||gt&&!st[Dt].once||ue&&st[Dt].context!==ue)&&pt.push(st[Dt]);pt.length?this._events[Ne]=pt.length===1?pt[0]:pt:z(this,Ne)}return this},W.prototype.removeAllListeners=function(se){var ve;return se?(ve=H?H+se:se,this._events[ve]&&z(this,ve)):(this._events=new X,this._eventsCount=0),this},W.prototype.off=W.prototype.removeListener,W.prototype.addListener=W.prototype.on,W.prefixed=H,W.EventEmitter=W,Qe.exports=W},"w/wX":function(Qe,Q,O){var j=O("QqLw"),H=O("ExA7"),X="[object Set]";function N(v){return H(v)&&j(v)==X}Qe.exports=N},wnjb:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.MetadataReader=void 0;var j=O("xfSm"),H=function(){function X(){}return X.prototype.getConstructorMetadata=function(N){var v=Reflect.getMetadata(j.PARAM_TYPES,N),z=Reflect.getMetadata(j.TAGGED,N);return{compilerGeneratedMetadata:v,userGeneratedMetadata:z||{}}},X.prototype.getPropertiesMetadata=function(N){var v=Reflect.getMetadata(j.TAGGED_PROP,N)||[];return v},X}();Q.MetadataReader=H},wrZu:function(Qe,Q,O){var j=O("+K+b"),H=O("XYm9"),X=O("b2z7"),N=O("otv/"),v=O("yP5f"),z="[object Boolean]",W="[object Date]",Pe="[object Map]",se="[object Number]",ve="[object RegExp]",ue="[object Set]",gt="[object String]",Ne="[object Symbol]",st="[object ArrayBuffer]",Dt="[object DataView]",pt="[object Float32Array]",$e="[object Float64Array]",Ct="[object Int8Array]",et="[object Int16Array]",kt="[object Int32Array]",Je="[object Uint8Array]",Xe="[object Uint8ClampedArray]",jr="[object Uint16Array]",Dr="[object Uint32Array]";function Jt(Be,Nt,Gt){var Te=Be.constructor;switch(Nt){case st:return j(Be);case z:case W:return new Te(+Be);case Dt:return H(Be,Gt);case pt:case $e:case Ct:case et:case kt:case Je:case Xe:case jr:case Dr:return v(Be,Gt);case Pe:return new Te;case se:case gt:return new Te(Be);case ve:return X(Be);case ue:return new Te;case Ne:return N(Be)}}Qe.exports=Jt},xfSm:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NON_CUSTOM_TAG_KEYS=Q.POST_CONSTRUCT=Q.DESIGN_PARAM_TYPES=Q.PARAM_TYPES=Q.TAGGED_PROP=Q.TAGGED=Q.MULTI_INJECT_TAG=Q.INJECT_TAG=Q.OPTIONAL_TAG=Q.UNMANAGED_TAG=Q.NAME_TAG=Q.NAMED_TAG=void 0,Q.NAMED_TAG="named",Q.NAME_TAG="name",Q.UNMANAGED_TAG="unmanaged",Q.OPTIONAL_TAG="optional",Q.INJECT_TAG="inject",Q.MULTI_INJECT_TAG="multi_inject",Q.TAGGED="inversify:tagged",Q.TAGGED_PROP="inversify:tagged_props",Q.PARAM_TYPES="inversify:paramtypes",Q.DESIGN_PARAM_TYPES="design:paramtypes",Q.POST_CONSTRUCT="post_construct";function j(){return[Q.INJECT_TAG,Q.MULTI_INJECT_TAG,Q.NAME_TAG,Q.UNMANAGED_TAG,Q.NAMED_TAG,Q.OPTIONAL_TAG]}Q.NON_CUSTOM_TAG_KEYS=j()},xiII:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Request=void 0;var j=O("d9O0"),H=function(){function X(N,v,z,W,Pe){this.id=j.id(),this.serviceIdentifier=N,this.parentContext=v,this.parentRequest=z,this.target=Pe,this.childRequests=[],this.bindings=Array.isArray(W)?W:[W],this.requestScope=z===null?new Map:null}return X.prototype.addChildRequest=function(N,v,z){var W=new X(N,this.parentContext,this,v,z);return this.childRequests.push(W),W},X}();Q.Request=H},xnQO:function(Qe,Q,O){"use strict";Qe.exports=j;function j(H,X){this.x=H,this.y=X}j.prototype={clone:function(){return new j(this.x,this.y)},add:function(X){return this.clone()._add(X)},sub:function(X){return this.clone()._sub(X)},multByPoint:function(X){return this.clone()._multByPoint(X)},divByPoint:function(X){return this.clone()._divByPoint(X)},mult:function(X){return this.clone()._mult(X)},div:function(X){return this.clone()._div(X)},rotate:function(X){return this.clone()._rotate(X)},rotateAround:function(X,N){return this.clone()._rotateAround(X,N)},matMult:function(X){return this.clone()._matMult(X)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(X){return this.x===X.x&&this.y===X.y},dist:function(X){return Math.sqrt(this.distSqr(X))},distSqr:function(X){var N=X.x-this.x,v=X.y-this.y;return N*N+v*v},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(X){return Math.atan2(this.y-X.y,this.x-X.x)},angleWith:function(X){return this.angleWithSep(X.x,X.y)},angleWithSep:function(X,N){return Math.atan2(this.x*N-this.y*X,this.x*X+this.y*N)},_matMult:function(X){var N=X[0]*this.x+X[1]*this.y,v=X[2]*this.x+X[3]*this.y;return this.x=N,this.y=v,this},_add:function(X){return this.x+=X.x,this.y+=X.y,this},_sub:function(X){return this.x-=X.x,this.y-=X.y,this},_mult:function(X){return this.x*=X,this.y*=X,this},_div:function(X){return this.x/=X,this.y/=X,this},_multByPoint:function(X){return this.x*=X.x,this.y*=X.y,this},_divByPoint:function(X){return this.x/=X.x,this.y/=X.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var X=this.y;return this.y=this.x,this.x=-X,this},_rotate:function(X){var N=Math.cos(X),v=Math.sin(X),z=N*this.x-v*this.y,W=v*this.x+N*this.y;return this.x=z,this.y=W,this},_rotateAround:function(X,N){var v=Math.cos(X),z=Math.sin(X),W=N.x+v*(this.x-N.x)-z*(this.y-N.y),Pe=N.y+z*(this.x-N.x)+v*(this.y-N.y);return this.x=W,this.y=Pe,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},j.convert=function(H){return H instanceof j?H:Array.isArray(H)?new j(H[0],H[1]):H}},xp6e:function(Qe,Q,O){"use strict";(function(j){O.d(Q,"a",function(){return ei}),O.d(Q,"b",function(){return Yn}),O.d(Q,"c",function(){return ci}),O.d(Q,"d",function(){return ni}),O.d(Q,"e",function(){return Bt});function H(Sr,_r,Kt,Wt){function Ir(je){return je instanceof Kt?je:new Kt(function(oe){oe(je)})}return new(Kt||(Kt=Promise))(function(je,oe){function ne(He){try{Ee(Wt.next(He))}catch(xt){oe(xt)}}function D(He){try{Ee(Wt.throw(He))}catch(xt){oe(xt)}}function Ee(He){He.done?je(He.value):Ir(He.value).then(ne,D)}Ee((Wt=Wt.apply(Sr,_r||[])).next())})}function X(Sr,_r){var Kt={label:0,sent:function(){if(je[0]&1)throw je[1];return je[1]},trys:[],ops:[]},Wt,Ir,je,oe;return oe={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(oe[Symbol.iterator]=function(){return this}),oe;function ne(Ee){return function(He){return D([Ee,He])}}function D(Ee){if(Wt)throw new TypeError("Generator is already executing.");for(;Kt;)try{if(Wt=1,Ir&&(je=Ee[0]&2?Ir.return:Ee[0]?Ir.throw||((je=Ir.return)&&je.call(Ir),0):Ir.next)&&!(je=je.call(Ir,Ee[1])).done)return je;switch(Ir=0,je&&(Ee=[Ee[0]&2,je.value]),Ee[0]){case 0:case 1:je=Ee;break;case 4:return Kt.label++,{value:Ee[1],done:!1};case 5:Kt.label++,Ir=Ee[1],Ee=[0];continue;case 7:Ee=Kt.ops.pop(),Kt.trys.pop();continue;default:if(je=Kt.trys,!(je=je.length>0&&je[je.length-1])&&(Ee[0]===6||Ee[0]===2)){Kt=0;continue}if(Ee[0]===3&&(!je||Ee[1]>je[0]&&Ee[1]<je[3])){Kt.label=Ee[1];break}if(Ee[0]===6&&Kt.label<je[1]){Kt.label=je[1],je=Ee;break}if(je&&Kt.label<je[2]){Kt.label=je[2],Kt.ops.push(Ee);break}je[2]&&Kt.ops.pop(),Kt.trys.pop();continue}Ee=_r.call(Sr,Kt)}catch(He){Ee=[6,He],Ir=0}finally{Wt=je=0}if(Ee[0]&5)throw Ee[1];return{value:Ee[0]?Ee[1]:void 0,done:!0}}}function N(Sr,_r){var Kt=typeof Symbol=="function"&&Sr[Symbol.iterator];if(!Kt)return Sr;var Wt=Kt.call(Sr),Ir,je=[],oe;try{for(;(_r===void 0||_r-- >0)&&!(Ir=Wt.next()).done;)je.push(Ir.value)}catch(ne){oe={error:ne}}finally{try{Ir&&!Ir.done&&(Kt=Wt.return)&&Kt.call(Wt)}finally{if(oe)throw oe.error}}return je}function v(Sr,_r,Kt){if(Kt||arguments.length===2)for(var Wt=0,Ir=_r.length,je;Wt<Ir;Wt++)(je||!(Wt in _r))&&(je||(je=Array.prototype.slice.call(_r,0,Wt)),je[Wt]=_r[Wt]);return Sr.concat(je||Array.prototype.slice.call(_r))}function z(Sr){return Sr&&Sr.__esModule&&Object.prototype.hasOwnProperty.call(Sr,"default")?Sr.default:Sr}var W={exports:{}},Pe={exports:{}},se={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=Kt;function Kt(Wt){return Wt&&typeof Wt.length=="number"&&Wt.length>=0&&Wt.length%1==0}Sr.exports=_r.default})(se,se.exports);var ve={},ue={exports:{}},gt={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=function(Kt){return function(){for(var Wt=[],Ir=arguments.length;Ir--;)Wt[Ir]=arguments[Ir];var je=Wt.pop();return Kt.call(this,Wt,je)}},Sr.exports=_r.default})(gt,gt.exports);var Ne={};Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.fallback=$e,Ne.wrap=Ct;var st=Ne.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,Dt=Ne.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,pt=Ne.hasNextTick=typeof j=="object"&&typeof j.nextTick=="function";function $e(Sr){setTimeout(Sr,0)}function Ct(Sr){return function(_r){for(var Kt=[],Wt=arguments.length-1;Wt-- >0;)Kt[Wt]=arguments[Wt+1];return Sr(function(){return _r.apply(void 0,Kt)})}}var et;st?et=queueMicrotask:Dt?et=setImmediate:pt?et=j.nextTick:et=$e,Ne.default=Ct(et),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=D;var Kt=gt.exports,Wt=ne(Kt),Ir=Ne,je=ne(Ir),oe=ve;function ne(xt){return xt&&xt.__esModule?xt:{default:xt}}function D(xt){return(0,oe.isAsync)(xt)?function(){for(var er=[],ur=arguments.length;ur--;)er[ur]=arguments[ur];var tt=er.pop(),It=xt.apply(this,er);return Ee(It,tt)}:(0,Wt.default)(function(er,ur){var tt;try{tt=xt.apply(this,er)}catch(It){return ur(It)}if(tt&&typeof tt.then=="function")return Ee(tt,ur);ur(null,tt)})}function Ee(xt,er){return xt.then(function(ur){He(er,null,ur)},function(ur){He(er,ur&&ur.message?ur:new Error(ur))})}function He(xt,er,ur){try{xt(er,ur)}catch(tt){(0,je.default)(function(It){throw It},tt)}}Sr.exports=_r.default}(ue,ue.exports),Object.defineProperty(ve,"__esModule",{value:!0}),ve.isAsyncIterable=ve.isAsyncGenerator=ve.isAsync=void 0;var kt=ue.exports,Je=Xe(kt);function Xe(Sr){return Sr&&Sr.__esModule?Sr:{default:Sr}}function jr(Sr){return Sr[Symbol.toStringTag]==="AsyncFunction"}function Dr(Sr){return Sr[Symbol.toStringTag]==="AsyncGenerator"}function Jt(Sr){return typeof Sr[Symbol.asyncIterator]=="function"}function Be(Sr){if(typeof Sr!="function")throw new Error("expected a function");return jr(Sr)?(0,Je.default)(Sr):Sr}ve.default=Be,ve.isAsync=jr,ve.isAsyncGenerator=Dr,ve.isAsyncIterable=Jt;var Nt={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=Kt;function Kt(Wt,Ir){if(Ir===void 0&&(Ir=Wt.length),!Ir)throw new Error("arity is undefined");function je(){for(var oe=this,ne=[],D=arguments.length;D--;)ne[D]=arguments[D];return typeof ne[Ir-1]=="function"?Wt.apply(this,ne):new Promise(function(Ee,He){ne[Ir-1]=function(xt){for(var er=[],ur=arguments.length-1;ur-- >0;)er[ur]=arguments[ur+1];if(xt)return He(xt);Ee(er.length>1?er:er[0])},Wt.apply(oe,ne)})}return je}Sr.exports=_r.default})(Nt,Nt.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=se.exports,Wt=D(Kt),Ir=ve,je=D(Ir),oe=Nt.exports,ne=D(oe);function D(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}_r.default=(0,ne.default)(function(Ee,He,xt){var er=(0,Wt.default)(He)?[]:{};Ee(He,function(ur,tt,It){(0,je.default)(ur)(function(or){for(var Cr,Or=[],Nn=arguments.length-1;Nn-- >0;)Or[Nn]=arguments[Nn+1];Or.length<2&&(Cr=Or,Or=Cr[0]),er[tt]=Or,It(or)})},function(ur){return xt(ur,er)})},3),Sr.exports=_r.default}(Pe,Pe.exports);var Gt={exports:{}},Te={exports:{}},me={exports:{}},Re={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=Kt;function Kt(Wt){function Ir(){for(var je=[],oe=arguments.length;oe--;)je[oe]=arguments[oe];if(Wt!==null){var ne=Wt;Wt=null,ne.apply(this,je)}}return Object.assign(Ir,Wt),Ir}Sr.exports=_r.default})(Re,Re.exports);var Ut={exports:{}},ae={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=function(Kt){return Kt[Symbol.iterator]&&Kt[Symbol.iterator]()},Sr.exports=_r.default})(ae,ae.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=He;var Kt=se.exports,Wt=oe(Kt),Ir=ae.exports,je=oe(Ir);function oe(xt){return xt&&xt.__esModule?xt:{default:xt}}function ne(xt){var er=-1,ur=xt.length;return function(){return++er<ur?{value:xt[er],key:er}:null}}function D(xt){var er=-1;return function(){var tt=xt.next();return tt.done?null:(er++,{value:tt.value,key:er})}}function Ee(xt){var er=xt?Object.keys(xt):[],ur=-1,tt=er.length;return function It(){var or=er[++ur];return or==="__proto__"?It():ur<tt?{value:xt[or],key:or}:null}}function He(xt){if((0,Wt.default)(xt))return ne(xt);var er=(0,je.default)(xt);return er?D(er):Ee(xt)}Sr.exports=_r.default}(Ut,Ut.exports);var Ce={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=Kt;function Kt(Wt){return function(){for(var Ir=[],je=arguments.length;je--;)Ir[je]=arguments[je];if(Wt===null)throw new Error("Callback was already called.");var oe=Wt;Wt=null,oe.apply(this,Ir)}}Sr.exports=_r.default})(Ce,Ce.exports);var Ae={exports:{}},vt={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt={};_r.default=Kt,Sr.exports=_r.default})(vt,vt.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=je;var Kt=vt.exports,Wt=Ir(Kt);function Ir(oe){return oe&&oe.__esModule?oe:{default:oe}}function je(oe,ne,D,Ee){var He=!1,xt=!1,er=!1,ur=0,tt=0;function It(){ur>=ne||er||He||(er=!0,oe.next().then(function(Or){var Nn=Or.value,sn=Or.done;if(!(xt||He)){if(er=!1,sn){He=!0,ur<=0&&Ee(null);return}ur++,D(Nn,tt,or),tt++,It()}}).catch(Cr))}function or(Or,Nn){if(ur-=1,!xt){if(Or)return Cr(Or);if(Or===!1){He=!0,xt=!0;return}if(Nn===Wt.default||He&&ur<=0)return He=!0,Ee(null);It()}}function Cr(Or){xt||(er=!1,He=!0,Ee(Or))}It()}Sr.exports=_r.default}(Ae,Ae.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=Re.exports,Wt=ur(Kt),Ir=Ut.exports,je=ur(Ir),oe=Ce.exports,ne=ur(oe),D=ve,Ee=Ae.exports,He=ur(Ee),xt=vt.exports,er=ur(xt);function ur(tt){return tt&&tt.__esModule?tt:{default:tt}}_r.default=function(tt){return function(It,or,Cr){if(Cr=(0,Wt.default)(Cr),tt<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!It)return Cr(null);if((0,D.isAsyncGenerator)(It))return(0,He.default)(It,tt,or,Cr);if((0,D.isAsyncIterable)(It))return(0,He.default)(It[Symbol.asyncIterator](),tt,or,Cr);var Or=(0,je.default)(It),Nn=!1,sn=!1,gn=0,dn=!1;function ri(ki,Aa){if(!sn)if(gn-=1,ki)Nn=!0,Cr(ki);else if(ki===!1)Nn=!0,sn=!0;else{if(Aa===er.default||Nn&&gn<=0)return Nn=!0,Cr(null);dn||mi()}}function mi(){for(dn=!0;gn<tt&&!Nn;){var ki=Or();if(ki===null){Nn=!0,gn<=0&&Cr(null);return}gn+=1,or(ki.value,ki.key,(0,ne.default)(ri))}dn=!1}mi()}},Sr.exports=_r.default}(me,me.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=me.exports,Wt=D(Kt),Ir=ve,je=D(Ir),oe=Nt.exports,ne=D(oe);function D(He){return He&&He.__esModule?He:{default:He}}function Ee(He,xt,er,ur){return(0,Wt.default)(xt)(He,(0,je.default)(er),ur)}_r.default=(0,ne.default)(Ee,4),Sr.exports=_r.default}(Te,Te.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=Te.exports,Wt=oe(Kt),Ir=Nt.exports,je=oe(Ir);function oe(D){return D&&D.__esModule?D:{default:D}}function ne(D,Ee,He){return(0,Wt.default)(D,1,Ee,He)}_r.default=(0,je.default)(ne,3),Sr.exports=_r.default}(Gt,Gt.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=ne;var Kt=Pe.exports,Wt=oe(Kt),Ir=Gt.exports,je=oe(Ir);function oe(D){return D&&D.__esModule?D:{default:D}}function ne(D,Ee){return(0,Wt.default)(je.default,D,Ee)}Sr.exports=_r.default}(W,W.exports);var At=z(W.exports),Bt=function(){function Sr(){this.args=[],this.tasks=[]}return Sr.prototype.call=function(){for(var _r=arguments,Kt=[],Wt=0;Wt<arguments.length;Wt++)Kt[Wt]=_r[Wt];return this.args=Kt,At(this.tasks)},Sr.prototype.tap=function(_r,Kt){var Wt=this;this.tasks.push(function(Ir){Kt.apply(void 0,v([],N(Wt.args),!1)),Ir(null,_r)})},Sr}(),Ft={exports:{}},fr={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=se.exports,Wt=or(Kt),Ir=vt.exports,je=or(Ir),oe=Te.exports,ne=or(oe),D=Re.exports,Ee=or(D),He=Ce.exports,xt=or(He),er=ve,ur=or(er),tt=Nt.exports,It=or(tt);function or(sn){return sn&&sn.__esModule?sn:{default:sn}}function Cr(sn,gn,dn){dn=(0,Ee.default)(dn);var ri=0,mi=0,ki=sn.length,Aa=!1;ki===0&&dn(null);function Pa(Co,yo){Co===!1&&(Aa=!0),Aa!==!0&&(Co?dn(Co):(++mi===ki||yo===je.default)&&dn(null))}for(;ri<ki;ri++)gn(sn[ri],ri,(0,xt.default)(Pa))}function Or(sn,gn,dn){return(0,ne.default)(sn,Infinity,gn,dn)}function Nn(sn,gn,dn){var ri=(0,Wt.default)(sn)?Cr:Or;return ri(sn,(0,ur.default)(gn),dn)}_r.default=(0,It.default)(Nn,3),Sr.exports=_r.default})(fr,fr.exports),function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0}),_r.default=ne;var Kt=fr.exports,Wt=oe(Kt),Ir=Pe.exports,je=oe(Ir);function oe(D){return D&&D.__esModule?D:{default:D}}function ne(D,Ee){return(0,je.default)(Wt.default,D,Ee)}Sr.exports=_r.default}(Ft,Ft.exports);var Tr=z(Ft.exports),Br=function(){function Sr(){this.tasks=[]}return Sr.prototype.promise=function(){return Tr(this.tasks)},Sr.prototype.tapPromise=function(_r,Kt){var Wt=this;this.tasks.push(function(Ir){return H(Wt,void 0,void 0,function(){return X(this,function(je){switch(je.label){case 0:return[4,Kt()];case 1:return je.sent(),Ir(null,_r),[2]}})})})},Sr}(),On={exports:{}};(function(Sr,_r){Object.defineProperty(_r,"__esModule",{value:!0});var Kt=Re.exports,Wt=He(Kt),Ir=Ce.exports,je=He(Ir),oe=ve,ne=He(oe),D=Nt.exports,Ee=He(D);function He(er){return er&&er.__esModule?er:{default:er}}function xt(er,ur){if(ur=(0,Wt.default)(ur),!Array.isArray(er))return ur(new Error("First argument to waterfall must be an array of functions"));if(!er.length)return ur();var tt=0;function It(Cr){var Or=(0,ne.default)(er[tt++]);Or.apply(void 0,Cr.concat([(0,je.default)(or)]))}function or(Cr){for(var Or=[],Nn=arguments.length-1;Nn-- >0;)Or[Nn]=arguments[Nn+1];if(Cr!==!1){if(Cr||tt===er.length)return ur.apply(void 0,[Cr].concat(Or));It(Or)}}It([])}_r.default=(0,Ee.default)(xt),Sr.exports=_r.default})(On,On.exports);var Fr=z(On.exports),Hn=function(){function Sr(){this.tasks=[]}return Sr.prototype.call=function(){return Fr(this.tasks)},Sr.prototype.tap=function(_r,Kt){this.tasks.length===0?this.tasks.push(function(Wt){var Ir=Kt();Wt(Ir?null:!1,Ir)}):this.tasks.push(function(Wt,Ir){var je=Kt.apply(void 0,v([],N(Wt),!1));Ir(je?null:!1,_r)})},Sr}(),ni=function(){function Sr(){this.tasks=[]}return Sr.prototype.call=function(){return At(this.tasks)},Sr.prototype.tap=function(_r,Kt){this.tasks.push(function(Wt){var Ir=Kt();Wt(Ir,_r)})},Sr}(),Yn=function(){function Sr(){this.args=[],this.tasks=[]}return Sr.prototype.promise=function(){for(var _r=arguments,Kt=[],Wt=0;Wt<arguments.length;Wt++)Kt[Wt]=_r[Wt];return this.args=Kt,At(this.tasks)},Sr.prototype.tapPromise=function(_r,Kt){var Wt=this;this.tasks.push(function(Ir){return H(Wt,void 0,void 0,function(){return X(this,function(je){switch(je.label){case 0:return[4,Kt.apply(void 0,v([],N(this.args),!1))];case 1:return je.sent(),Ir(null,_r),[2]}})})})},Sr}(),ei=function(){function Sr(){this.args=[],this.tasks=[]}return Sr.prototype.promise=function(){for(var _r=arguments,Kt=[],Wt=0;Wt<arguments.length;Wt++)Kt[Wt]=_r[Wt];return this.args=Kt,At(this.tasks)},Sr.prototype.tapPromise=function(_r,Kt){var Wt=this;this.tasks.push(function(Ir){return H(Wt,void 0,void 0,function(){var je;return X(this,function(oe){switch(oe.label){case 0:return[4,Kt.apply(void 0,v([],N(this.args),!1))];case 1:return je=oe.sent(),Ir(je,_r),[2]}})})})},Sr}(),ci=function(){function Sr(){this.tasks=[]}return Sr.prototype.promise=function(){return Fr(this.tasks)},Sr.prototype.tapPromise=function(_r,Kt){this.tasks.length===0?this.tasks.push(function(Wt){Kt().then(function(Ir){Wt(null,Ir)})}):this.tasks.push(function(Wt,Ir){Kt(Wt).then(function(je){Ir(null,je)})})},Sr}()}).call(this,O("Q2Ig"))},yG8O:function(Qe,Q){function O(j,H,X,N){!X||Object.defineProperty(j,H,{enumerable:X.enumerable,configurable:X.configurable,writable:X.writable,value:X.initializer?X.initializer.call(N):void 0})}Qe.exports=O,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},yHx3:function(Qe,Q){var O=Object.prototype,j=O.hasOwnProperty;function H(X){var N=X.length,v=new X.constructor(N);return N&&typeof X[0]=="string"&&j.call(X,"index")&&(v.index=X.index,v.input=X.input),v}Qe.exports=H},yLV6:function(Qe,Q,O){var j;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(H,X,N,v){"use strict";var z=["","webkit","Moz","MS","ms","o"],W=X.createElement("div"),Pe="function",se=Math.round,ve=Math.abs,ue=Date.now;function gt(ft,le,Ze){return setTimeout(kt(ft,Ze),le)}function Ne(ft,le,Ze){return Array.isArray(ft)?(st(ft,Ze[le],Ze),!0):!1}function st(ft,le,Ze){var sr;if(!!ft)if(ft.forEach)ft.forEach(le,Ze);else if(ft.length!==v)for(sr=0;sr<ft.length;)le.call(Ze,ft[sr],sr,ft),sr++;else for(sr in ft)ft.hasOwnProperty(sr)&&le.call(Ze,ft[sr],sr,ft)}function Dt(ft,le,Ze){var sr="DEPRECATED METHOD: "+le+`
`+Ze+` AT 
`;return function(){var rn=new Error("get-stack-trace"),Pn=rn&&rn.stack?rn.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ji=H.console&&(H.console.warn||H.console.log);return ji&&ji.call(H.console,sr,Pn),ft.apply(this,arguments)}}var pt;typeof Object.assign!="function"?pt=function(le){if(le===v||le===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ze=Object(le),sr=1;sr<arguments.length;sr++){var rn=arguments[sr];if(rn!==v&&rn!==null)for(var Pn in rn)rn.hasOwnProperty(Pn)&&(Ze[Pn]=rn[Pn])}return Ze}:pt=Object.assign;var $e=Dt(function(le,Ze,sr){for(var rn=Object.keys(Ze),Pn=0;Pn<rn.length;)(!sr||sr&&le[rn[Pn]]===v)&&(le[rn[Pn]]=Ze[rn[Pn]]),Pn++;return le},"extend","Use `assign`."),Ct=Dt(function(le,Ze){return $e(le,Ze,!0)},"merge","Use `assign`.");function et(ft,le,Ze){var sr=le.prototype,rn;rn=ft.prototype=Object.create(sr),rn.constructor=ft,rn._super=sr,Ze&&pt(rn,Ze)}function kt(ft,le){return function(){return ft.apply(le,arguments)}}function Je(ft,le){return typeof ft==Pe?ft.apply(le&&le[0]||v,le):ft}function Xe(ft,le){return ft===v?le:ft}function jr(ft,le,Ze){st(Nt(le),function(sr){ft.addEventListener(sr,Ze,!1)})}function Dr(ft,le,Ze){st(Nt(le),function(sr){ft.removeEventListener(sr,Ze,!1)})}function Jt(ft,le){for(;ft;){if(ft==le)return!0;ft=ft.parentNode}return!1}function Be(ft,le){return ft.indexOf(le)>-1}function Nt(ft){return ft.trim().split(/\s+/g)}function Gt(ft,le,Ze){if(ft.indexOf&&!Ze)return ft.indexOf(le);for(var sr=0;sr<ft.length;){if(Ze&&ft[sr][Ze]==le||!Ze&&ft[sr]===le)return sr;sr++}return-1}function Te(ft){return Array.prototype.slice.call(ft,0)}function me(ft,le,Ze){for(var sr=[],rn=[],Pn=0;Pn<ft.length;){var ji=le?ft[Pn][le]:ft[Pn];Gt(rn,ji)<0&&sr.push(ft[Pn]),rn[Pn]=ji,Pn++}return Ze&&(le?sr=sr.sort(function(Oo,gs){return Oo[le]>gs[le]}):sr=sr.sort()),sr}function Re(ft,le){for(var Ze,sr,rn=le[0].toUpperCase()+le.slice(1),Pn=0;Pn<z.length;){if(Ze=z[Pn],sr=Ze?Ze+rn:le,sr in ft)return sr;Pn++}return v}var Ut=1;function ae(){return Ut++}function Ce(ft){var le=ft.ownerDocument||ft;return le.defaultView||le.parentWindow||H}var Ae=/mobile|tablet|ip(ad|hone|od)|android/i,vt="ontouchstart"in H,At=Re(H,"PointerEvent")!==v,Bt=vt&&Ae.test(navigator.userAgent),Ft="touch",fr="pen",Tr="mouse",Br="kinect",On=25,Fr=1,Hn=2,ni=4,Yn=8,ei=1,ci=2,Sr=4,_r=8,Kt=16,Wt=ci|Sr,Ir=_r|Kt,je=Wt|Ir,oe=["x","y"],ne=["clientX","clientY"];function D(ft,le){var Ze=this;this.manager=ft,this.callback=le,this.element=ft.element,this.target=ft.options.inputTarget,this.domHandler=function(sr){Je(ft.options.enable,[ft])&&Ze.handler(sr)},this.init()}D.prototype={handler:function(){},init:function(){this.evEl&&jr(this.element,this.evEl,this.domHandler),this.evTarget&&jr(this.target,this.evTarget,this.domHandler),this.evWin&&jr(Ce(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Dr(this.element,this.evEl,this.domHandler),this.evTarget&&Dr(this.target,this.evTarget,this.domHandler),this.evWin&&Dr(Ce(this.element),this.evWin,this.domHandler)}};function Ee(ft){var le,Ze=ft.options.inputClass;return Ze?le=Ze:At?le=Mi:Bt?le=ge:vt?le=Nr:le=ki,new le(ft,He)}function He(ft,le,Ze){var sr=Ze.pointers.length,rn=Ze.changedPointers.length,Pn=le&Fr&&sr-rn==0,ji=le&(ni|Yn)&&sr-rn==0;Ze.isFirst=!!Pn,Ze.isFinal=!!ji,Pn&&(ft.session={}),Ze.eventType=le,xt(ft,Ze),ft.emit("hammer.input",Ze),ft.recognize(Ze),ft.session.prevInput=Ze}function xt(ft,le){var Ze=ft.session,sr=le.pointers,rn=sr.length;Ze.firstInput||(Ze.firstInput=tt(le)),rn>1&&!Ze.firstMultiple?Ze.firstMultiple=tt(le):rn===1&&(Ze.firstMultiple=!1);var Pn=Ze.firstInput,ji=Ze.firstMultiple,Za=ji?ji.center:Pn.center,Oo=le.center=It(sr);le.timeStamp=ue(),le.deltaTime=le.timeStamp-Pn.timeStamp,le.angle=Nn(Za,Oo),le.distance=Or(Za,Oo),er(Ze,le),le.offsetDirection=Cr(le.deltaX,le.deltaY);var gs=or(le.deltaTime,le.deltaX,le.deltaY);le.overallVelocityX=gs.x,le.overallVelocityY=gs.y,le.overallVelocity=ve(gs.x)>ve(gs.y)?gs.x:gs.y,le.scale=ji?gn(ji.pointers,sr):1,le.rotation=ji?sn(ji.pointers,sr):0,le.maxPointers=Ze.prevInput?le.pointers.length>Ze.prevInput.maxPointers?le.pointers.length:Ze.prevInput.maxPointers:le.pointers.length,ur(Ze,le);var Ls=ft.element;Jt(le.srcEvent.target,Ls)&&(Ls=le.srcEvent.target),le.target=Ls}function er(ft,le){var Ze=le.center,sr=ft.offsetDelta||{},rn=ft.prevDelta||{},Pn=ft.prevInput||{};(le.eventType===Fr||Pn.eventType===ni)&&(rn=ft.prevDelta={x:Pn.deltaX||0,y:Pn.deltaY||0},sr=ft.offsetDelta={x:Ze.x,y:Ze.y}),le.deltaX=rn.x+(Ze.x-sr.x),le.deltaY=rn.y+(Ze.y-sr.y)}function ur(ft,le){var Ze=ft.lastInterval||le,sr=le.timeStamp-Ze.timeStamp,rn,Pn,ji,Za;if(le.eventType!=Yn&&(sr>On||Ze.velocity===v)){var Oo=le.deltaX-Ze.deltaX,gs=le.deltaY-Ze.deltaY,Ls=or(sr,Oo,gs);Pn=Ls.x,ji=Ls.y,rn=ve(Ls.x)>ve(Ls.y)?Ls.x:Ls.y,Za=Cr(Oo,gs),ft.lastInterval=le}else rn=Ze.velocity,Pn=Ze.velocityX,ji=Ze.velocityY,Za=Ze.direction;le.velocity=rn,le.velocityX=Pn,le.velocityY=ji,le.direction=Za}function tt(ft){for(var le=[],Ze=0;Ze<ft.pointers.length;)le[Ze]={clientX:se(ft.pointers[Ze].clientX),clientY:se(ft.pointers[Ze].clientY)},Ze++;return{timeStamp:ue(),pointers:le,center:It(le),deltaX:ft.deltaX,deltaY:ft.deltaY}}function It(ft){var le=ft.length;if(le===1)return{x:se(ft[0].clientX),y:se(ft[0].clientY)};for(var Ze=0,sr=0,rn=0;rn<le;)Ze+=ft[rn].clientX,sr+=ft[rn].clientY,rn++;return{x:se(Ze/le),y:se(sr/le)}}function or(ft,le,Ze){return{x:le/ft||0,y:Ze/ft||0}}function Cr(ft,le){return ft===le?ei:ve(ft)>=ve(le)?ft<0?ci:Sr:le<0?_r:Kt}function Or(ft,le,Ze){Ze||(Ze=oe);var sr=le[Ze[0]]-ft[Ze[0]],rn=le[Ze[1]]-ft[Ze[1]];return Math.sqrt(sr*sr+rn*rn)}function Nn(ft,le,Ze){Ze||(Ze=oe);var sr=le[Ze[0]]-ft[Ze[0]],rn=le[Ze[1]]-ft[Ze[1]];return Math.atan2(rn,sr)*180/Math.PI}function sn(ft,le){return Nn(le[1],le[0],ne)+Nn(ft[1],ft[0],ne)}function gn(ft,le){return Or(le[0],le[1],ne)/Or(ft[0],ft[1],ne)}var dn={mousedown:Fr,mousemove:Hn,mouseup:ni},ri="mousedown",mi="mousemove mouseup";function ki(){this.evEl=ri,this.evWin=mi,this.pressed=!1,D.apply(this,arguments)}et(ki,D,{handler:function(le){var Ze=dn[le.type];Ze&Fr&&le.button===0&&(this.pressed=!0),Ze&Hn&&le.which!==1&&(Ze=ni),!!this.pressed&&(Ze&ni&&(this.pressed=!1),this.callback(this.manager,Ze,{pointers:[le],changedPointers:[le],pointerType:Tr,srcEvent:le}))}});var Aa={pointerdown:Fr,pointermove:Hn,pointerup:ni,pointercancel:Yn,pointerout:Yn},Pa={2:Ft,3:fr,4:Tr,5:Br},Co="pointerdown",yo="pointermove pointerup pointercancel";H.MSPointerEvent&&!H.PointerEvent&&(Co="MSPointerDown",yo="MSPointerMove MSPointerUp MSPointerCancel");function Mi(){this.evEl=Co,this.evWin=yo,D.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}et(Mi,D,{handler:function(le){var Ze=this.store,sr=!1,rn=le.type.toLowerCase().replace("ms",""),Pn=Aa[rn],ji=Pa[le.pointerType]||le.pointerType,Za=ji==Ft,Oo=Gt(Ze,le.pointerId,"pointerId");Pn&Fr&&(le.button===0||Za)?Oo<0&&(Ze.push(le),Oo=Ze.length-1):Pn&(ni|Yn)&&(sr=!0),!(Oo<0)&&(Ze[Oo]=le,this.callback(this.manager,Pn,{pointers:Ze,changedPointers:[le],pointerType:ji,srcEvent:le}),sr&&Ze.splice(Oo,1))}});var te={touchstart:Fr,touchmove:Hn,touchend:ni,touchcancel:Yn},K="touchstart",fe="touchstart touchmove touchend touchcancel";function Se(){this.evTarget=K,this.evWin=fe,this.started=!1,D.apply(this,arguments)}et(Se,D,{handler:function(le){var Ze=te[le.type];if(Ze===Fr&&(this.started=!0),!!this.started){var sr=Le.call(this,le,Ze);Ze&(ni|Yn)&&sr[0].length-sr[1].length==0&&(this.started=!1),this.callback(this.manager,Ze,{pointers:sr[0],changedPointers:sr[1],pointerType:Ft,srcEvent:le})}}});function Le(ft,le){var Ze=Te(ft.touches),sr=Te(ft.changedTouches);return le&(ni|Yn)&&(Ze=me(Ze.concat(sr),"identifier",!0)),[Ze,sr]}var mt={touchstart:Fr,touchmove:Hn,touchend:ni,touchcancel:Yn},St="touchstart touchmove touchend touchcancel";function ge(){this.evTarget=St,this.targetIds={},D.apply(this,arguments)}et(ge,D,{handler:function(le){var Ze=mt[le.type],sr=Ye.call(this,le,Ze);!sr||this.callback(this.manager,Ze,{pointers:sr[0],changedPointers:sr[1],pointerType:Ft,srcEvent:le})}});function Ye(ft,le){var Ze=Te(ft.touches),sr=this.targetIds;if(le&(Fr|Hn)&&Ze.length===1)return sr[Ze[0].identifier]=!0,[Ze,Ze];var rn,Pn,ji=Te(ft.changedTouches),Za=[],Oo=this.target;if(Pn=Ze.filter(function(gs){return Jt(gs.target,Oo)}),le===Fr)for(rn=0;rn<Pn.length;)sr[Pn[rn].identifier]=!0,rn++;for(rn=0;rn<ji.length;)sr[ji[rn].identifier]&&Za.push(ji[rn]),le&(ni|Yn)&&delete sr[ji[rn].identifier],rn++;if(!!Za.length)return[me(Pn.concat(Za),"identifier",!0),Za]}var zt=2500,Rr=25;function Nr(){D.apply(this,arguments);var ft=kt(this.handler,this);this.touch=new ge(this.manager,ft),this.mouse=new ki(this.manager,ft),this.primaryTouch=null,this.lastTouches=[]}et(Nr,D,{handler:function(le,Ze,sr){var rn=sr.pointerType==Ft,Pn=sr.pointerType==Tr;if(!(Pn&&sr.sourceCapabilities&&sr.sourceCapabilities.firesTouchEvents)){if(rn)pr.call(this,Ze,sr);else if(Pn&&Gn.call(this,sr))return;this.callback(le,Ze,sr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function pr(ft,le){ft&Fr?(this.primaryTouch=le.changedPointers[0].identifier,Wr.call(this,le)):ft&(ni|Yn)&&Wr.call(this,le)}function Wr(ft){var le=ft.changedPointers[0];if(le.identifier===this.primaryTouch){var Ze={x:le.clientX,y:le.clientY};this.lastTouches.push(Ze);var sr=this.lastTouches,rn=function(){var ji=sr.indexOf(Ze);ji>-1&&sr.splice(ji,1)};setTimeout(rn,zt)}}function Gn(ft){for(var le=ft.srcEvent.clientX,Ze=ft.srcEvent.clientY,sr=0;sr<this.lastTouches.length;sr++){var rn=this.lastTouches[sr],Pn=Math.abs(le-rn.x),ji=Math.abs(Ze-rn.y);if(Pn<=Rr&&ji<=Rr)return!0}return!1}var wn=Re(W.style,"touchAction"),dr=wn!==v,Sn="compute",bn="auto",we="manipulation",Kn="none",xn="pan-x",Vi="pan-y",ia=Ni();function bi(ft,le){this.manager=ft,this.set(le)}bi.prototype={set:function(le){le==Sn&&(le=this.compute()),dr&&this.manager.element.style&&ia[le]&&(this.manager.element.style[wn]=le),this.actions=le.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var le=[];return st(this.manager.recognizers,function(Ze){Je(Ze.options.enable,[Ze])&&(le=le.concat(Ze.getTouchAction()))}),ta(le.join(" "))},preventDefaults:function(le){var Ze=le.srcEvent,sr=le.offsetDirection;if(this.manager.session.prevented){Ze.preventDefault();return}var rn=this.actions,Pn=Be(rn,Kn)&&!ia[Kn],ji=Be(rn,Vi)&&!ia[Vi],Za=Be(rn,xn)&&!ia[xn];if(Pn){var Oo=le.pointers.length===1,gs=le.distance<2,Ls=le.deltaTime<250;if(Oo&&gs&&Ls)return}if(!(Za&&ji)&&(Pn||ji&&sr&Wt||Za&&sr&Ir))return this.preventSrc(Ze)},preventSrc:function(le){this.manager.session.prevented=!0,le.preventDefault()}};function ta(ft){if(Be(ft,Kn))return Kn;var le=Be(ft,xn),Ze=Be(ft,Vi);return le&&Ze?Kn:le||Ze?le?xn:Vi:Be(ft,we)?we:bn}function Ni(){if(!dr)return!1;var ft={},le=H.CSS&&H.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ze){ft[Ze]=le?H.CSS.supports("touch-action",Ze):!0}),ft}var ns=1,wi=2,Xa=4,Hi=8,Zi=Hi,gi=16,eo=32;function Fs(ft){this.options=pt({},this.defaults,ft||{}),this.id=ae(),this.manager=null,this.options.enable=Xe(this.options.enable,!0),this.state=ns,this.simultaneous={},this.requireFail=[]}Fs.prototype={defaults:{},set:function(le){return pt(this.options,le),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(le){if(Ne(le,"recognizeWith",this))return this;var Ze=this.simultaneous;return le=oc(le,this),Ze[le.id]||(Ze[le.id]=le,le.recognizeWith(this)),this},dropRecognizeWith:function(le){return Ne(le,"dropRecognizeWith",this)?this:(le=oc(le,this),delete this.simultaneous[le.id],this)},requireFailure:function(le){if(Ne(le,"requireFailure",this))return this;var Ze=this.requireFail;return le=oc(le,this),Gt(Ze,le)===-1&&(Ze.push(le),le.requireFailure(this)),this},dropRequireFailure:function(le){if(Ne(le,"dropRequireFailure",this))return this;le=oc(le,this);var Ze=Gt(this.requireFail,le);return Ze>-1&&this.requireFail.splice(Ze,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(le){return!!this.simultaneous[le.id]},emit:function(le){var Ze=this,sr=this.state;function rn(Pn){Ze.manager.emit(Pn,le)}sr<Hi&&rn(Ze.options.event+_o(sr)),rn(Ze.options.event),le.additionalEvent&&rn(le.additionalEvent),sr>=Hi&&rn(Ze.options.event+_o(sr))},tryEmit:function(le){if(this.canEmit())return this.emit(le);this.state=eo},canEmit:function(){for(var le=0;le<this.requireFail.length;){if(!(this.requireFail[le].state&(eo|ns)))return!1;le++}return!0},recognize:function(le){var Ze=pt({},le);if(!Je(this.options.enable,[this,Ze])){this.reset(),this.state=eo;return}this.state&(Zi|gi|eo)&&(this.state=ns),this.state=this.process(Ze),this.state&(wi|Xa|Hi|gi)&&this.tryEmit(Ze)},process:function(le){},getTouchAction:function(){},reset:function(){}};function _o(ft){return ft&gi?"cancel":ft&Hi?"end":ft&Xa?"move":ft&wi?"start":""}function ms(ft){return ft==Kt?"down":ft==_r?"up":ft==ci?"left":ft==Sr?"right":""}function oc(ft,le){var Ze=le.manager;return Ze?Ze.get(ft):ft}function wo(){Fs.apply(this,arguments)}et(wo,Fs,{defaults:{pointers:1},attrTest:function(le){var Ze=this.options.pointers;return Ze===0||le.pointers.length===Ze},process:function(le){var Ze=this.state,sr=le.eventType,rn=Ze&(wi|Xa),Pn=this.attrTest(le);return rn&&(sr&Yn||!Pn)?Ze|gi:rn||Pn?sr&ni?Ze|Hi:Ze&wi?Ze|Xa:wi:eo}});function Ia(){wo.apply(this,arguments),this.pX=null,this.pY=null}et(Ia,wo,{defaults:{event:"pan",threshold:10,pointers:1,direction:je},getTouchAction:function(){var le=this.options.direction,Ze=[];return le&Wt&&Ze.push(Vi),le&Ir&&Ze.push(xn),Ze},directionTest:function(le){var Ze=this.options,sr=!0,rn=le.distance,Pn=le.direction,ji=le.deltaX,Za=le.deltaY;return Pn&Ze.direction||(Ze.direction&Wt?(Pn=ji===0?ei:ji<0?ci:Sr,sr=ji!=this.pX,rn=Math.abs(le.deltaX)):(Pn=Za===0?ei:Za<0?_r:Kt,sr=Za!=this.pY,rn=Math.abs(le.deltaY))),le.direction=Pn,sr&&rn>Ze.threshold&&Pn&Ze.direction},attrTest:function(le){return wo.prototype.attrTest.call(this,le)&&(this.state&wi||!(this.state&wi)&&this.directionTest(le))},emit:function(le){this.pX=le.deltaX,this.pY=le.deltaY;var Ze=ms(le.direction);Ze&&(le.additionalEvent=this.options.event+Ze),this._super.emit.call(this,le)}});function Ol(){wo.apply(this,arguments)}et(Ol,wo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Kn]},attrTest:function(le){return this._super.attrTest.call(this,le)&&(Math.abs(le.scale-1)>this.options.threshold||this.state&wi)},emit:function(le){if(le.scale!==1){var Ze=le.scale<1?"in":"out";le.additionalEvent=this.options.event+Ze}this._super.emit.call(this,le)}});function Zo(){Fs.apply(this,arguments),this._timer=null,this._input=null}et(Zo,Fs,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[bn]},process:function(le){var Ze=this.options,sr=le.pointers.length===Ze.pointers,rn=le.distance<Ze.threshold,Pn=le.deltaTime>Ze.time;if(this._input=le,!rn||!sr||le.eventType&(ni|Yn)&&!Pn)this.reset();else if(le.eventType&Fr)this.reset(),this._timer=gt(function(){this.state=Zi,this.tryEmit()},Ze.time,this);else if(le.eventType&ni)return Zi;return eo},reset:function(){clearTimeout(this._timer)},emit:function(le){this.state===Zi&&(le&&le.eventType&ni?this.manager.emit(this.options.event+"up",le):(this._input.timeStamp=ue(),this.manager.emit(this.options.event,this._input)))}});function Na(){wo.apply(this,arguments)}et(Na,wo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Kn]},attrTest:function(le){return this._super.attrTest.call(this,le)&&(Math.abs(le.rotation)>this.options.threshold||this.state&wi)}});function ao(){wo.apply(this,arguments)}et(ao,wo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Wt|Ir,pointers:1},getTouchAction:function(){return Ia.prototype.getTouchAction.call(this)},attrTest:function(le){var Ze=this.options.direction,sr;return Ze&(Wt|Ir)?sr=le.overallVelocity:Ze&Wt?sr=le.overallVelocityX:Ze&Ir&&(sr=le.overallVelocityY),this._super.attrTest.call(this,le)&&Ze&le.offsetDirection&&le.distance>this.options.threshold&&le.maxPointers==this.options.pointers&&ve(sr)>this.options.velocity&&le.eventType&ni},emit:function(le){var Ze=ms(le.offsetDirection);Ze&&this.manager.emit(this.options.event+Ze,le),this.manager.emit(this.options.event,le)}});function Ta(){Fs.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}et(Ta,Fs,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[we]},process:function(le){var Ze=this.options,sr=le.pointers.length===Ze.pointers,rn=le.distance<Ze.threshold,Pn=le.deltaTime<Ze.time;if(this.reset(),le.eventType&Fr&&this.count===0)return this.failTimeout();if(rn&&Pn&&sr){if(le.eventType!=ni)return this.failTimeout();var ji=this.pTime?le.timeStamp-this.pTime<Ze.interval:!0,Za=!this.pCenter||Or(this.pCenter,le.center)<Ze.posThreshold;this.pTime=le.timeStamp,this.pCenter=le.center,!Za||!ji?this.count=1:this.count+=1,this._input=le;var Oo=this.count%Ze.taps;if(Oo===0)return this.hasRequireFailures()?(this._timer=gt(function(){this.state=Zi,this.tryEmit()},Ze.interval,this),wi):Zi}return eo},failTimeout:function(){return this._timer=gt(function(){this.state=eo},this.options.interval,this),eo},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Zi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Do(ft,le){return le=le||{},le.recognizers=Xe(le.recognizers,Do.defaults.preset),new Bs(ft,le)}Do.VERSION="2.0.7",Do.defaults={domEvents:!1,touchAction:Sn,enable:!0,inputTarget:null,inputClass:null,preset:[[Na,{enable:!1}],[Ol,{enable:!1},["rotate"]],[ao,{direction:Wt}],[Ia,{direction:Wt},["swipe"]],[Ta],[Ta,{event:"doubletap",taps:2},["tap"]],[Zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $o=1,kc=2;function Bs(ft,le){this.options=pt({},Do.defaults,le||{}),this.options.inputTarget=this.options.inputTarget||ft,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ft,this.input=Ee(this),this.touchAction=new bi(this,this.options.touchAction),Dh(this,!0),st(this.options.recognizers,function(Ze){var sr=this.add(new Ze[0](Ze[1]));Ze[2]&&sr.recognizeWith(Ze[2]),Ze[3]&&sr.requireFailure(Ze[3])},this)}Bs.prototype={set:function(le){return pt(this.options,le),le.touchAction&&this.touchAction.update(),le.inputTarget&&(this.input.destroy(),this.input.target=le.inputTarget,this.input.init()),this},stop:function(le){this.session.stopped=le?kc:$o},recognize:function(le){var Ze=this.session;if(!Ze.stopped){this.touchAction.preventDefaults(le);var sr,rn=this.recognizers,Pn=Ze.curRecognizer;(!Pn||Pn&&Pn.state&Zi)&&(Pn=Ze.curRecognizer=null);for(var ji=0;ji<rn.length;)sr=rn[ji],Ze.stopped!==kc&&(!Pn||sr==Pn||sr.canRecognizeWith(Pn))?sr.recognize(le):sr.reset(),!Pn&&sr.state&(wi|Xa|Hi)&&(Pn=Ze.curRecognizer=sr),ji++}},get:function(le){if(le instanceof Fs)return le;for(var Ze=this.recognizers,sr=0;sr<Ze.length;sr++)if(Ze[sr].options.event==le)return Ze[sr];return null},add:function(le){if(Ne(le,"add",this))return this;var Ze=this.get(le.options.event);return Ze&&this.remove(Ze),this.recognizers.push(le),le.manager=this,this.touchAction.update(),le},remove:function(le){if(Ne(le,"remove",this))return this;if(le=this.get(le),le){var Ze=this.recognizers,sr=Gt(Ze,le);sr!==-1&&(Ze.splice(sr,1),this.touchAction.update())}return this},on:function(le,Ze){if(le!==v&&Ze!==v){var sr=this.handlers;return st(Nt(le),function(rn){sr[rn]=sr[rn]||[],sr[rn].push(Ze)}),this}},off:function(le,Ze){if(le!==v){var sr=this.handlers;return st(Nt(le),function(rn){Ze?sr[rn]&&sr[rn].splice(Gt(sr[rn],Ze),1):delete sr[rn]}),this}},emit:function(le,Ze){this.options.domEvents&&Fo(le,Ze);var sr=this.handlers[le]&&this.handlers[le].slice();if(!(!sr||!sr.length)){Ze.type=le,Ze.preventDefault=function(){Ze.srcEvent.preventDefault()};for(var rn=0;rn<sr.length;)sr[rn](Ze),rn++}},destroy:function(){this.element&&Dh(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Dh(ft,le){var Ze=ft.element;if(!!Ze.style){var sr;st(ft.options.cssProps,function(rn,Pn){sr=Re(Ze.style,Pn),le?(ft.oldCssProps[sr]=Ze.style[sr],Ze.style[sr]=rn):Ze.style[sr]=ft.oldCssProps[sr]||""}),le||(ft.oldCssProps={})}}function Fo(ft,le){var Ze=X.createEvent("Event");Ze.initEvent(ft,!0,!0),Ze.gesture=le,le.target.dispatchEvent(Ze)}pt(Do,{INPUT_START:Fr,INPUT_MOVE:Hn,INPUT_END:ni,INPUT_CANCEL:Yn,STATE_POSSIBLE:ns,STATE_BEGAN:wi,STATE_CHANGED:Xa,STATE_ENDED:Hi,STATE_RECOGNIZED:Zi,STATE_CANCELLED:gi,STATE_FAILED:eo,DIRECTION_NONE:ei,DIRECTION_LEFT:ci,DIRECTION_RIGHT:Sr,DIRECTION_UP:_r,DIRECTION_DOWN:Kt,DIRECTION_HORIZONTAL:Wt,DIRECTION_VERTICAL:Ir,DIRECTION_ALL:je,Manager:Bs,Input:D,TouchAction:bi,TouchInput:ge,MouseInput:ki,PointerEventInput:Mi,TouchMouseInput:Nr,SingleTouchInput:Se,Recognizer:Fs,AttrRecognizer:wo,Tap:Ta,Pan:Ia,Swipe:ao,Pinch:Ol,Rotate:Na,Press:Zo,on:jr,off:Dr,each:st,merge:Ct,extend:$e,assign:pt,inherit:et,bindFn:kt,prefixed:Re});var _a=typeof H!="undefined"?H:typeof self!="undefined"?self:{};_a.Hammer=Do,j=function(){return Do}.call(Q,O,Q,Qe),j!==v&&(Qe.exports=j)})(window,document,"Hammer")},yMAV:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Plan=void 0;var j=function(){function H(X,N){this.parentContext=X,this.rootRequest=N}return H}();Q.Plan=j},yXPU:function(Qe,Q){function O(H,X,N,v,z,W,Pe){try{var se=H[W](Pe),ve=se.value}catch(ue){N(ue);return}se.done?X(ve):Promise.resolve(ve).then(v,z)}function j(H){return function(){var X=this,N=arguments;return new Promise(function(v,z){var W=H.apply(X,N);function Pe(ve){O(W,v,z,Pe,se,"next",ve)}function se(ve){O(W,v,z,Pe,se,"throw",ve)}Pe(void 0)})}}Qe.exports=j,Qe.exports.__esModule=!0,Qe.exports.default=Qe.exports},ycre:function(Qe,Q,O){var j=O("711d"),H=j("length");Qe.exports=H},z4Hk:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenSyntax=void 0;var j=O("406g"),H=O("RR/i"),X=function(){function N(v){this._binding=v}return N.prototype.when=function(v){return this._binding.constraint=v,new j.BindingOnSyntax(this._binding)},N.prototype.whenTargetNamed=function(v){return this._binding.constraint=H.namedConstraint(v),new j.BindingOnSyntax(this._binding)},N.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(v){var z=v.target!==null&&!v.target.isNamed()&&!v.target.isTagged();return z},new j.BindingOnSyntax(this._binding)},N.prototype.whenTargetTagged=function(v,z){return this._binding.constraint=H.taggedConstraint(v)(z),new j.BindingOnSyntax(this._binding)},N.prototype.whenInjectedInto=function(v){return this._binding.constraint=function(z){return H.typeConstraint(v)(z.parentRequest)},new j.BindingOnSyntax(this._binding)},N.prototype.whenParentNamed=function(v){return this._binding.constraint=function(z){return H.namedConstraint(v)(z.parentRequest)},new j.BindingOnSyntax(this._binding)},N.prototype.whenParentTagged=function(v,z){return this._binding.constraint=function(W){return H.taggedConstraint(v)(z)(W.parentRequest)},new j.BindingOnSyntax(this._binding)},N.prototype.whenAnyAncestorIs=function(v){return this._binding.constraint=function(z){return H.traverseAncerstors(z,H.typeConstraint(v))},new j.BindingOnSyntax(this._binding)},N.prototype.whenNoAncestorIs=function(v){return this._binding.constraint=function(z){return!H.traverseAncerstors(z,H.typeConstraint(v))},new j.BindingOnSyntax(this._binding)},N.prototype.whenAnyAncestorNamed=function(v){return this._binding.constraint=function(z){return H.traverseAncerstors(z,H.namedConstraint(v))},new j.BindingOnSyntax(this._binding)},N.prototype.whenNoAncestorNamed=function(v){return this._binding.constraint=function(z){return!H.traverseAncerstors(z,H.namedConstraint(v))},new j.BindingOnSyntax(this._binding)},N.prototype.whenAnyAncestorTagged=function(v,z){return this._binding.constraint=function(W){return H.traverseAncerstors(W,H.taggedConstraint(v)(z))},new j.BindingOnSyntax(this._binding)},N.prototype.whenNoAncestorTagged=function(v,z){return this._binding.constraint=function(W){return!H.traverseAncerstors(W,H.taggedConstraint(v)(z))},new j.BindingOnSyntax(this._binding)},N.prototype.whenAnyAncestorMatches=function(v){return this._binding.constraint=function(z){return H.traverseAncerstors(z,v)},new j.BindingOnSyntax(this._binding)},N.prototype.whenNoAncestorMatches=function(v){return this._binding.constraint=function(z){return!H.traverseAncerstors(z,v)},new j.BindingOnSyntax(this._binding)},N}();Q.BindingWhenSyntax=X},zEVN:function(Qe,Q,O){var j=O("Gi0A"),H=O("sEf8"),X=O("mdPL"),N=X&&X.isMap,v=N?H(N):j;Qe.exports=v},zvhG:function(Qe,Q){Qe.exports=O;function O(j,H,X,N){this.cx=3*j,this.bx=3*(X-j)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*H,this.by=3*(N-H)-this.cy,this.ay=1-this.cy-this.by,this.p1x=j,this.p1y=N,this.p2x=X,this.p2y=N}O.prototype.sampleCurveX=function(j){return((this.ax*j+this.bx)*j+this.cx)*j},O.prototype.sampleCurveY=function(j){return((this.ay*j+this.by)*j+this.cy)*j},O.prototype.sampleCurveDerivativeX=function(j){return(3*this.ax*j+2*this.bx)*j+this.cx},O.prototype.solveCurveX=function(j,H){typeof H=="undefined"&&(H=1e-6);var X,N,v,z,W;for(v=j,W=0;W<8;W++){if(z=this.sampleCurveX(v)-j,Math.abs(z)<H)return v;var Pe=this.sampleCurveDerivativeX(v);if(Math.abs(Pe)<1e-6)break;v=v-z/Pe}if(X=0,N=1,v=j,v<X)return X;if(v>N)return N;for(;X<N;){if(z=this.sampleCurveX(v),Math.abs(z-j)<H)return v;j>z?X=v:N=v,v=(N-X)*.5+X}return v},O.prototype.solve=function(j,H){return this.sampleCurveY(this.solveCurveX(j,H))}},zxMA:function(Qe,Q,O){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.QueryableString=void 0;var j=function(){function H(X){this.str=X}return H.prototype.startsWith=function(X){return this.str.indexOf(X)===0},H.prototype.endsWith=function(X){var N="",v=X.split("").reverse().join("");return N=this.str.split("").reverse().join(""),this.startsWith.call({str:N},v)},H.prototype.contains=function(X){return this.str.indexOf(X)!==-1},H.prototype.equals=function(X){return this.str===X},H.prototype.value=function(){return this.str},H}();Q.QueryableString=j}}]);
